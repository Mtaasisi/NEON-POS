â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                  â•‘
â•‘     ğŸ”§ CUSTOMER PORTAL TROUBLESHOOTING GUIDE ğŸ”§                 â•‘
â•‘                                                                  â•‘
â•‘          What to do if products don't load                       â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸš¨ CRITICAL: Products Not Showing for Customers
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Products are THE MOST IMPORTANT feature for customers!
Follow this guide step-by-step to diagnose and fix.


ğŸ“‹ STEP-BY-STEP DEBUGGING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STEP 1: Run Diagnostic Test
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

$ node test-customer-portal-products.mjs

This will check:
âœ“ If lats_products table exists
âœ“ How many products are in database
âœ“ Which variants table you have
âœ“ Sample product data
âœ“ Categories and brands available

Expected output:
âœ… lats_products table exists with X products
âœ… Found lats_variants table with X variants
âœ… Categories: X (Electronics, Phones, ...)
âœ… Brands: X (Samsung, Apple, ...)


STEP 2: Check Browser Console
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Open customer portal: /customer-portal/products
2. Open DevTools (F12)
3. Go to Console tab
4. Look for these logs:

GOOD (Working):
ğŸ›’ CustomerPortalService: Starting to fetch products...
âœ… Fetched 25 products from lats_products table
ğŸ” Fetching variants for 25 products...
âœ… Fetched 48 variants from lats_variants table
ğŸ“Š Grouped variants for 25 products
âœ… Successfully transformed 25 products
ğŸ“¦ Products with variants: 25
ğŸ“¦ Products in stock: 20

BAD (Problem):
âŒ Error fetching products: [error message]
âŒ CRITICAL ERROR in getProducts: ...


STEP 3: Check Database Directly
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Run these queries in your database:

-- 1. Do products exist?
SELECT COUNT(*) FROM lats_products;
-- Expected: > 0

-- 2. Sample products
SELECT id, name, category, brand, image_url 
FROM lats_products 
LIMIT 5;
-- Expected: Shows products

-- 3. Which variants table exists?
SELECT COUNT(*) FROM lats_variants;
-- OR
SELECT COUNT(*) FROM lats_product_variants;

-- 4. Are variants linked to products?
SELECT 
  p.name as product_name,
  v.variant_name,
  v.unit_price,
  v.total_quantity
FROM lats_products p
JOIN lats_variants v ON v.product_id = p.id
LIMIT 10;


ğŸ”§ COMMON PROBLEMS & SOLUTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEM 1: "No products found in database"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SYMPTOM:
â€¢ Empty products page
â€¢ Console: "âš ï¸  No products found in database"

CAUSE:
â€¢ lats_products table is empty

SOLUTION:
1. Add products through admin panel:
   Admin â†’ Inventory â†’ Add Product
2. Or import products from Excel
3. Or insert via SQL:
   INSERT INTO lats_products (name, category, brand)
   VALUES ('iPhone 15', 'Phones', 'Apple');


PROBLEM 2: "Error fetching products" / Database Error
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SYMPTOM:
â€¢ Error screen with retry button
â€¢ Console: âŒ Error fetching products: [error]

CAUSE:
â€¢ Database connection issue
â€¢ Wrong credentials
â€¢ Table doesn't exist
â€¢ RLS policies blocking

SOLUTION:
1. Check .env file has correct DATABASE_URL
2. Test connection: node test-db-connection.mjs
3. Verify tables exist in database
4. Check RLS policies in Supabase:
   ALTER TABLE lats_products ENABLE ROW LEVEL SECURITY;
   CREATE POLICY "Allow public read" ON lats_products FOR SELECT TO anon USING (true);


PROBLEM 3: Products Load But All "Out of Stock"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SYMPTOM:
â€¢ Products show but can't add to cart
â€¢ All products say "Out of Stock"

CAUSE:
â€¢ Variants exist but quantity = 0
â€¢ Variants table not linked properly

SOLUTION:
1. Check variant quantities:
   SELECT product_id, variant_name, total_quantity 
   FROM lats_variants;

2. Update quantities:
   UPDATE lats_variants 
   SET total_quantity = 10 
   WHERE product_id = '...';

3. Or update through admin panel:
   Admin â†’ Inventory â†’ Edit Product â†’ Update Stock


PROBLEM 4: Products Show But No Prices
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SYMPTOM:
â€¢ Products display as "Tsh 0"

CAUSE:
â€¢ Variants have no price
â€¢ Price column is NULL

SOLUTION:
1. Check variant prices:
   SELECT variant_name, unit_price, selling_price 
   FROM lats_variants;

2. Update prices:
   UPDATE lats_variants 
   SET unit_price = 50000 
   WHERE id = '...';


PROBLEM 5: Images Don't Load
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SYMPTOM:
â€¢ Products show but gray placeholder instead of images

CAUSE:
â€¢ image_url is NULL or invalid URL

SOLUTION:
1. Check image URLs:
   SELECT name, image_url FROM lats_products LIMIT 5;

2. Update image URLs:
   UPDATE lats_products 
   SET image_url = 'https://example.com/image.jpg' 
   WHERE id = '...';

3. Or upload through admin panel


PROBLEM 6: "Table lats_variants does not exist"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SYMPTOM:
â€¢ Console: Error fetching from lats_variants

CAUSE:
â€¢ You're using older schema with lats_product_variants

SOLUTION:
âœ… NO ACTION NEEDED!
The service automatically falls back to lats_product_variants.
Products will still load!


ğŸ¯ VERIFICATION CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Before opening to customers, verify:

DATABASE:
â–¡ lats_products table exists and has data
â–¡ At least one of: lats_variants OR lats_product_variants exists
â–¡ Products have variants with prices > 0
â–¡ Variants have quantity > 0
â–¡ Products have image URLs (optional but recommended)
â–¡ Categories and brands are set

UI:
â–¡ Products page loads without errors
â–¡ Product cards display correctly
â–¡ Product images show (or placeholder)
â–¡ Prices display correctly
â–¡ "In Stock" indicators show correctly
â–¡ Categories filter works
â–¡ Brands filter works
â–¡ Search works
â–¡ Product detail page loads
â–¡ Variant selection works

BROWSER CONSOLE:
â–¡ No âŒ error messages
â–¡ See âœ… success messages
â–¡ Product counts match database


ğŸ” DEBUGGING COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Test database connection and products
$ node test-customer-portal-products.mjs

# Check if dev server is running
$ npm run dev

# Check database connection
$ node -e "console.log(process.env.DATABASE_URL)"

# View all environment variables
$ cat .env | grep DATABASE_URL


ğŸ’¡ QUICK FIX SCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If you need to quickly add test products:

-- Create test product
INSERT INTO lats_products (name, description, category, brand, image_url)
VALUES 
  ('Test Product', 'Test Description', 'Electronics', 'TestBrand', 
   'https://via.placeholder.com/300');

-- Get the product ID from above insert, then add variant:
INSERT INTO lats_variants (product_id, variant_name, unit_price, total_quantity)
VALUES 
  ('PRODUCT_ID_HERE', 'Standard', 50000, 10);

-- Refresh customer portal - product should appear!


ğŸ“ SUPPORT CONTACTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If issues persist:

1. Check browser console logs (most informative!)
2. Run test script: test-customer-portal-products.mjs
3. Verify database connection works in admin panel
4. Check database dashboard directly


âœ¨ ENHANCED FEATURES NOW ACTIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Automatic table detection (lats_variants OR lats_product_variants)
âœ… Flexible column mapping (handles both schemas)
âœ… Comprehensive error logging
âœ… Retry functionality in UI
âœ… User-friendly error messages
âœ… Troubleshooting tips shown to users
âœ… No blank screens - always shows something
âœ… Graceful degradation (works even without variants)


ğŸ¯ EXPECTED BEHAVIOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SCENARIO 1: Everything Perfect
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Products load instantly
â€¢ Images show
â€¢ Prices display
â€¢ Stock indicators correct
â€¢ Filters work
â€¢ Search works

SCENARIO 2: Connection Issue
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Shows loading spinner
â€¢ After timeout, shows error screen
â€¢ "Retry" button appears
â€¢ Customer can retry
â€¢ If connection restored â†’ products load

SCENARIO 3: No Products in Database
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Shows "No Products Available" message
â€¢ Friendly message: "Check back soon!"
â€¢ No confusing errors

SCENARIO 4: No Variants (Only Products)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Products still show
â€¢ No variant selector (products without options)
â€¢ Still functional for simple items


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

            ğŸ‰ PRODUCTS FETCH IS NOW BULLETPROOF! ğŸ‰

   âœ“ Works with multiple database schemas
   âœ“ Comprehensive error handling
   âœ“ Detailed logging for debugging
   âœ“ Retry functionality
   âœ“ Customer-friendly error messages
   âœ“ Never leaves customers with blank screen
   âœ“ Graceful degradation
   âœ“ Easy to diagnose issues

   Run the test script to verify everything works!
   $ node test-customer-portal-products.mjs

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

