import{s as l}from"./index-61458a34.js";const c={enabled:!0,allowEmployeeChoice:!0,availableSecurityModes:["auto-location","manual-location","wifi-only"],defaultSecurityMode:"auto-location",requireLocation:!0,requireWifi:!0,requirePhoto:!1,allowMobileData:!0,gpsAccuracy:50,checkInRadius:100,checkInTime:"08:00",checkOutTime:"17:00",gracePeriod:15,offices:[{name:"Arusha Main Office",lat:-3.359178,lng:36.661366,radius:100,address:"Main Office, Arusha, Tanzania",networks:[{ssid:"Office_WiFi",bssid:"00:11:22:33:44:55",description:"Main office WiFi network"},{ssid:"Office_Guest",description:"Guest WiFi network"},{ssid:"4G_Mobile",description:"Mobile data connection"}]}]},u=async()=>{try{const{data:t,error:e}=await l.from("settings").select("value").eq("key","attendance").maybeSingle();if(e)return e.code!=="PGRST116"&&console.error("Error fetching attendance settings:",e),c;if(t)try{return JSON.parse(t.value)}catch(n){return console.error("Error parsing attendance settings:",n),c}return c}catch(t){return console.error("Error fetching attendance settings:",t),c}},w=async t=>{try{const{error:e}=await l.from("settings").upsert({key:"attendance",value:JSON.stringify(t),updated_at:new Date().toISOString()});if(e)throw console.error("Error saving attendance settings:",e),e}catch(e){throw console.error("Error saving attendance settings:",e),e}},h=(t,e,n,r)=>{const a=t*Math.PI/180,s=n*Math.PI/180,o=(n-t)*Math.PI/180,f=(r-e)*Math.PI/180,d=Math.sin(o/2)*Math.sin(o/2)+Math.cos(a)*Math.cos(s)*Math.sin(f/2)*Math.sin(f/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))},g=async(t,e)=>{try{const n=await u();if(n.offices.length===0)return{office:null,distance:1/0,isWithinRange:!1};let r=null,i=1/0;for(const s of n.offices){const o=h(t,e,s.lat,s.lng);o<i&&(i=o,r=s)}if(!r)return{office:null,distance:1/0,isWithinRange:!1};const a=i<=r.radius;return{office:r,distance:i,isWithinRange:a}}catch(n){return console.error("Error detecting nearest office:",n),{office:null,distance:1/0,isWithinRange:!1}}},p=async(t,e,n)=>{try{const r=await u();if(t){const i=r.offices.find(a=>a.name.toLowerCase().includes(t.toLowerCase()));if(i)return{office:i,detectionMethod:"name"}}if(e!==void 0&&n!==void 0){const i=await g(e,n);return{office:i.office,distance:i.distance,isWithinRange:i.isWithinRange,detectionMethod:"nearest"}}return{office:r.offices[0]||null,detectionMethod:"default"}}catch(r){return console.error("Error getting office:",r),{office:null,detectionMethod:"default"}}};export{g as a,p as b,c as d,u as g,w as s};
