import{j as e,a as G}from"./index-61458a34.js";import{r as l}from"./vendor-36d2c7c1.js";import{c as I,M as X}from"./customerPortalService-0d37743c.js";import{O as K,cH as Y,ax as Z,k as ee,N as se,z as H,v as te,X as _,cI as ae,ab as re,aa as le,af as oe}from"./ui-28e30067.js";import{a as ie}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";const E=({product:t,onProductClick:N,onAddToCart:u,onToggleFavorite:d,isFavorite:b=!1})=>{var i;const x=t.compareAtPrice&&t.compareAtPrice>t.price,w=x?Math.round((t.compareAtPrice-t.price)/t.compareAtPrice*100):0,j=n=>{n.stopPropagation(),u&&t.inStock&&u(t)},m=n=>{n.stopPropagation(),d&&d(t.id)};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden max-w-sm mx-auto",children:[e.jsxs("div",{className:"relative w-full aspect-square bg-gray-100 rounded-t-2xl overflow-hidden",children:[t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300",children:e.jsx(K,{size:64,strokeWidth:1.5})}),x&&e.jsxs("div",{className:"absolute top-3 left-3 bg-red-500 text-white text-xs font-semibold px-2.5 py-1 rounded-md shadow",children:["-",w,"%"]}),d&&e.jsx("button",{onClick:m,className:"absolute top-3 right-3 bg-white rounded-full p-2 shadow hover:shadow-md transition-shadow",children:e.jsx(Y,{size:18,className:b?"fill-red-500 text-red-500":"text-gray-600"})}),!t.inStock&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:e.jsx("span",{className:"bg-white text-gray-900 px-3 py-1 rounded-full text-sm font-medium",children:"Out of Stock"})})]}),e.jsxs("div",{onClick:()=>N(t),className:"p-5 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t.name}),t.brand&&e.jsx("div",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(Z,{size:14,className:"text-white",strokeWidth:3})})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:[t.brand&&e.jsx("span",{className:"font-medium",children:t.brand}),t.brand&&t.category&&e.jsx("span",{children:" â€¢ "}),t.category]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["Tsh ",t.price.toLocaleString()]}),x&&e.jsx("span",{className:"text-xs text-gray-400 line-through",children:(i=t.compareAtPrice)==null?void 0:i.toLocaleString()})]}),t.rating!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{size:14,className:"fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:t.rating.toFixed(1)}),t.reviewCount&&e.jsxs("span",{className:"text-sm text-gray-500",children:["(",t.reviewCount,")"]})]})]}),u&&t.inStock&&e.jsxs("button",{onClick:j,className:"flex items-center gap-1.5 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-900 rounded-lg text-sm font-medium transition-colors",children:[e.jsx(se,{size:16,strokeWidth:2.5}),e.jsx("span",{children:"Add"})]})]}),t.inStock&&t.stockQuantity!==void 0&&t.stockQuantity<10&&e.jsxs("div",{className:"mt-3 text-xs text-orange-600 font-medium",children:["Only ",t.stockQuantity," left in stock"]})]})]})},ge=()=>{const t=ie(),{startLoading:N,completeLoading:u,failLoading:d}=G(),[b,x]=l.useState([]),[w,j]=l.useState(!0),[m,i]=l.useState(null),[n,O]=l.useState(0),[o,g]=l.useState(""),[h,y]=l.useState("all"),[f,v]=l.useState("all"),[k,L]=l.useState("popular"),[C,z]=l.useState("grid"),[S,Q]=l.useState(!1),[F,A]=l.useState([]),[W,q]=l.useState([]),[J,U]=l.useState([]);l.useEffect(()=>{B(),D()},[]);const B=async(s=!1)=>{const a=N("Loading products...");try{console.log("ðŸ›’ ProductsPage: Loading products...",s?`(Retry ${n+1})`:""),j(!0),i(null);const r=await I.getProducts();if(console.log(`âœ… ProductsPage: Received ${r.length} products from service`),r.length===0)console.warn("âš ï¸  ProductsPage: No products returned - checking database connection..."),i("no_products"),d(a,"No products found");else{x(r),i(null);const c=[...new Set(r.map(P=>P.category).filter(Boolean))],R=[...new Set(r.map(P=>P.brand).filter(Boolean))];q(c),U(R),console.log(`ðŸ“Š Categories: ${c.length}, Brands: ${R.length}`),u(a)}}catch(r){console.error("âŒ ProductsPage: Error loading products:",r),i("fetch_failed"),d(a,"Failed to load products"),H.error("Failed to load products. Please check your connection.",{duration:5e3})}finally{j(!1)}},V=()=>{O(s=>s+1),B(!0)},D=()=>{const s=localStorage.getItem("customer_favorites");s&&A(JSON.parse(s))},T=s=>{A(a=>{const r=a.includes(s)?a.filter(c=>c!==s):[...a,s];return localStorage.setItem("customer_favorites",JSON.stringify(r)),H.success(r.includes(s)?"Added to favorites":"Removed from favorites"),r})},p=l.useMemo(()=>{let s=b;switch(o&&(s=s.filter(a=>{var r,c;return a.name.toLowerCase().includes(o.toLowerCase())||((r=a.description)==null?void 0:r.toLowerCase().includes(o.toLowerCase()))||((c=a.brand)==null?void 0:c.toLowerCase().includes(o.toLowerCase()))})),h!=="all"&&(s=s.filter(a=>a.category===h)),f!=="all"&&(s=s.filter(a=>a.brand===f)),k){case"price-low":s.sort((a,r)=>a.price-r.price);break;case"price-high":s.sort((a,r)=>r.price-a.price);break;case"newest":break;case"popular":s.sort((a,r)=>(r.rating||0)-(a.rating||0));break}return s},[b,o,h,f,k]),$=s=>{t(`/customer-portal/products/${s.id}`)},M=s=>{t(`/customer-portal/products/${s.id}`)};return e.jsxs(X,{title:"Shop",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 p-4 sticky top-14 z-40",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search products...",value:o,onChange:s=>g(s.target.value),className:"w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),o&&e.jsx("button",{onClick:()=>g(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(_,{size:20})})]}),e.jsx("button",{onClick:()=>Q(!S),className:`p-3 border rounded-lg ${S?"bg-blue-600 text-white border-blue-600":"border-gray-300 text-gray-700"}`,children:e.jsx(ae,{size:20})})]})}),S&&e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"View Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>z("grid"),className:`p-2 rounded-lg ${C==="grid"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600"}`,children:e.jsx(re,{size:18})}),e.jsx("button",{onClick:()=>z("list"),className:`p-2 rounded-lg ${C==="list"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600"}`,children:e.jsx(le,{size:18})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Category"}),e.jsxs("select",{value:h,onChange:s=>y(s.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),W.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Brand"}),e.jsxs("select",{value:f,onChange:s=>v(s.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Brands"}),J.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Sort By"}),e.jsxs("select",{value:k,onChange:s=>L(s.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"popular",children:"Most Popular"}),e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"price-low",children:"Price: Low to High"}),e.jsx("option",{value:"price-high",children:"Price: High to Low"})]})]}),e.jsx("button",{onClick:()=>{y("all"),v("all"),L("popular"),g("")},className:"w-full py-2 text-blue-600 font-medium hover:bg-blue-50 rounded-lg transition-colors",children:"Clear All Filters"})]}),e.jsxs("div",{className:"bg-gray-50 px-4 py-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[p.length," ",p.length===1?"product":"products"]}),(h!=="all"||f!=="all"||o)&&e.jsx("button",{onClick:()=>{y("all"),v("all"),g("")},className:"text-sm text-blue-600 font-medium",children:"Clear filters"})]}),w?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading products..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Please wait"})]}):m?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[e.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(_,{size:40,className:"text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m==="no_products"?"No Products Available":"Failed to Load Products"}),e.jsx("p",{className:"text-gray-600 text-center mb-4 max-w-sm",children:m==="no_products"?"There are no products in the catalog yet. Please check back soon!":"We couldn't load the products. This might be a connection issue."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:V,className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-medium flex items-center gap-2 hover:bg-blue-700 active:scale-95 transition-all",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Retry ",n>0&&`(${n+1})`]}),m==="fetch_failed"&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50",children:"Refresh Page"})]}),e.jsxs("div",{className:"mt-6 p-3 bg-gray-100 rounded-lg text-xs text-gray-600 max-w-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Troubleshooting:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Check your internet connection"}),e.jsx("li",{children:"Verify database is accessible"}),e.jsx("li",{children:"Contact support if issue persists"})]})]})]}):p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[e.jsx(oe,{size:64,className:"text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 text-center mb-4",children:"Try adjusting your filters or search terms"}),e.jsx("button",{onClick:()=>{y("all"),v("all"),g("")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium",children:"Clear Filters"})]}):C==="grid"?e.jsx("div",{className:"p-4",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(160px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},children:p.map(s=>e.jsx(E,{product:s,onProductClick:$,onAddToCart:M,onToggleFavorite:T,isFavorite:F.includes(s.id)},s.id))}):e.jsx("div",{className:"p-4 space-y-4",children:p.map(s=>e.jsx(E,{product:s,onProductClick:$,onAddToCart:M,onToggleFavorite:T,isFavorite:F.includes(s.id)},s.id))})]})};export{ge as default};
