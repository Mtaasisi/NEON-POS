import{j as e,u as Ne,b as fe,c as be,y as we,a as Ce,av as he,e as ue}from"./index-61458a34.js";import{r as d}from"./vendor-36d2c7c1.js";import{r as ee}from"./reminderApi-be7f32c2.js";import{B as ke}from"./BackButton-02a80e74.js";import{ax as se,N as ce,c as ye,Z as Se,r as X,y as re,R as Te,n as $,al as te,e as oe,v as je,X as ae,a9 as De,U as le,S as ne,aT as Re,Y as Le,aL as me,ay as xe}from"./ui-28e30067.js";import{a as Ie}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";const ge=({value:o,onChange:v,options:f,placeholder:l="Type to search...",label:y,required:T=!1,disabled:N=!1,createNew:k=!1,onCreateNew:z,fuzzyMatch:t=!0,showRecent:i=!0,recentKey:R,icon:w,error:j,helperText:O,maxSuggestions:u=10,className:m=""})=>{const[S,b]=d.useState(!1),[g,P]=d.useState(o),[C,B]=d.useState(-1),[H,_]=d.useState([]),Z=d.useRef(null),W=d.useRef(null),s=d.useMemo(()=>f.map(r=>typeof r=="string"?{value:r,label:r,icon:void 0}:r),[f]);d.useEffect(()=>{if(i&&R){const r=localStorage.getItem(`recent_${R}`);r&&_(JSON.parse(r))}},[i,R]),d.useEffect(()=>{const r=s.find(c=>c.value===o);P(r?r.label:o)},[o,s]);const n=(r,c)=>{r=r.toLowerCase(),c=c.toLowerCase();let h=0,L=0;for(let q=0;q<c.length;q++)if(c[q]===r[L]&&(h+=r.length-L,L++,L===r.length))return h;return L===r.length?h:0},x=d.useMemo(()=>{if(!g.trim()){if(i&&H.length>0){const r=s.filter(h=>H.includes(h.value)),c=s.filter(h=>!H.includes(h.value)).slice(0,u-r.length);return[...r,...c]}return s.slice(0,u)}return t?s.map(r=>({...r,score:n(g,r.label)})).filter(r=>r.score>0).sort((r,c)=>c.score-r.score).slice(0,u):s.filter(r=>r.label.toLowerCase().includes(g.toLowerCase())).slice(0,u)},[g,s,t,H,i,u]),D=r=>{if(i&&R){const c=[r,...H.filter(h=>h!==r)].slice(0,5);_(c),localStorage.setItem(`recent_${R}`,JSON.stringify(c))}},E=r=>{const c=s.find(h=>h.value===r);v(r),P(c?c.label:r),D(r),b(!1),B(-1)},G=r=>{if(!S&&r.key!=="Escape"){b(!0);return}switch(r.key){case"ArrowDown":r.preventDefault(),B(c=>c<x.length-1?c+1:c);break;case"ArrowUp":r.preventDefault(),B(c=>c>0?c-1:-1);break;case"Enter":r.preventDefault(),C>=0&&C<x.length?E(x[C].value):k&&g.trim()&&z?(z(g.trim()),D(g.trim()),b(!1)):g.trim()&&(v(g.trim()),D(g.trim()),b(!1));break;case"Escape":r.preventDefault(),b(!1),B(-1);break;case"Tab":C>=0&&C<x.length?(r.preventDefault(),E(x[C].value)):b(!1);break}};d.useEffect(()=>{const r=c=>{var h;W.current&&!W.current.contains(c.target)&&!((h=Z.current)!=null&&h.contains(c.target))&&(b(!1),B(-1))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),d.useEffect(()=>{if(C>=0&&W.current){const r=W.current.children[C];r&&r.scrollIntoView({block:"nearest",behavior:"smooth"})}},[C]);const F=k&&g.trim()&&!x.some(r=>r.value.toLowerCase()===g.toLowerCase());return e.jsxs("div",{className:`relative ${m}`,children:[y&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[y,T&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:Z,type:"text",value:g,onChange:r=>{P(r.target.value),b(!0),B(-1)},onFocus:()=>{P(""),b(!0)},onKeyDown:G,placeholder:l,disabled:N,required:T,className:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-colors ${w?"pl-11":""} ${j?"border-red-500 focus:border-red-500":o?"border-green-500 focus:border-green-500 bg-green-50":"border-gray-200 focus:border-blue-500"} ${N?"bg-gray-100 cursor-not-allowed":"bg-white"}`,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),w&&e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:w}),S&&!N&&e.jsx("div",{ref:W,className:"absolute z-[9999] w-full mt-1 bg-white border-2 border-gray-200 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:x.length===0&&!F?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 text-center",children:"No matches found"}):e.jsxs(e.Fragment,{children:[x.map((r,c)=>{const h=H.includes(r.value),L=c===C;return e.jsxs("button",{type:"button",onClick:()=>E(r.value),className:`w-full px-4 py-3 text-left flex items-center gap-3 transition-colors ${L?"bg-blue-50 text-blue-700":"hover:bg-gray-50"} ${c===0?"rounded-t-lg":""} ${c===x.length-1&&!F?"rounded-b-lg":""}`,children:[r.icon&&e.jsx("div",{className:"flex-shrink-0 text-gray-400",children:r.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:r.label}),h&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Recent)"})]}),o===r.value&&e.jsx(se,{size:16,className:"text-blue-600 flex-shrink-0"})]},r.value)}),F&&e.jsxs("button",{type:"button",onClick:()=>{z?z(g.trim()):v(g.trim()),D(g.trim()),b(!1)},className:`w-full px-4 py-3 text-left flex items-center gap-3 border-t-2 border-gray-100 transition-colors ${C===x.length?"bg-blue-50 text-blue-700":"hover:bg-gray-50"} rounded-b-lg`,children:[e.jsx(ce,{size:16,className:"text-blue-600 flex-shrink-0"}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:['Create "',g.trim(),'"']})]})]})})]}),(j||O)&&e.jsx("p",{className:`mt-1 text-sm ${j?"text-red-600":"text-gray-500"}`,children:j||O}),S&&!N&&e.jsxs("div",{className:"mt-1 text-xs text-gray-400 flex items-center gap-3",children:[e.jsx("span",{children:"â†‘â†“ Navigate"}),e.jsx("span",{children:"Enter Select"}),e.jsx("span",{children:"Esc Close"}),F&&e.jsx("span",{children:"Tab Create"})]})]})},ze=({actions:o,className:v=""})=>{const f=(l="secondary")=>{switch(l){case"primary":return"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100";case"success":return"bg-green-50 text-green-700 border-green-200 hover:bg-green-100";case"warning":return"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-100";default:return"bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100"}};return e.jsx("div",{className:`flex flex-wrap gap-2 ${v}`,children:o.map((l,y)=>e.jsxs("button",{type:"button",onClick:l.action,title:l.tooltip||l.label,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium border-2 transition-all hover:shadow-sm ${f(l.variant)}`,children:[l.icon,e.jsx("span",{children:l.label})]},y))})},de={copyFromLast:o=>({label:"Copy from Last",icon:e.jsx(ye,{size:16}),action:o,variant:"secondary",tooltip:"Copy data from the last entry"}),useMyInfo:o=>({label:"Use My Info",icon:e.jsx(Se,{size:16}),action:o,variant:"primary",tooltip:"Autofill with your information"}),todayPlusWeek:o=>({label:"Today + 7 Days",icon:e.jsx(X,{size:16}),action:o,variant:"success",tooltip:"Set date to 7 days from today"}),nowPlusHour:o=>({label:"In 1 Hour",icon:e.jsx(re,{size:16}),action:o,variant:"warning",tooltip:"Set time to 1 hour from now"}),reset:o=>({label:"Reset",icon:e.jsx(Te,{size:16}),action:o,variant:"secondary",tooltip:"Reset form to default values"})};function Ee(o,v){let f=null;const l=function(...y){const T=()=>{f=null,o(...y)};f&&clearTimeout(f),f=setTimeout(T,v)};return l.cancel=function(){f&&(clearTimeout(f),f=null)},l}const Me=o=>{const{key:v,data:f,enabled:l=!0,debounceMs:y=1e3,exclude:T=[]}=o,N=`form_draft_${v}`,k=d.useRef(!0),z=d.useCallback(u=>{const m={...u};return T.forEach(S=>{delete m[S]}),m},[T]),t=d.useCallback(u=>{if(l)try{const S={data:z(u),timestamp:new Date().toISOString()};localStorage.setItem(N,JSON.stringify(S))}catch(m){console.error("Error saving form draft:",m)}},[l,N,z]),i=d.useRef(Ee(u=>t(u),y)).current,R=d.useCallback(()=>{try{localStorage.removeItem(N)}catch(u){console.error("Error clearing form draft:",u)}},[N]),w=d.useCallback(()=>{try{return localStorage.getItem(N)!==null}catch{return!1}},[N]),j=d.useCallback(()=>{try{const u=localStorage.getItem(N);if(!u)return null;const m=JSON.parse(u);return{data:m.data,timestamp:m.timestamp}}catch(u){return console.error("Error loading form draft:",u),null}},[N]),O=d.useCallback(()=>{const u=j();if(!u)return null;const m=new Date(u.timestamp),b=new Date().getTime()-m.getTime();return Math.floor(b/6e4)},[j]);return d.useEffect(()=>{if(k.current){k.current=!1;return}if(!l||!f)return;Object.values(f).some(m=>typeof m=="string"?m.trim()!=="":typeof m=="number"?m!==0:Array.isArray(m)?m.length>0:m!=null)&&i(f)},[f,l,i]),d.useEffect(()=>()=>{i.cancel()},[i]),{saveDraft:t,clearDraft:R,hasDraft:w,loadDraft:j,getDraftAge:O}},ve=()=>{const o=new Date;return{today:o.toISOString().split("T")[0],tomorrow:new Date(o.getTime()+24*60*60*1e3).toISOString().split("T")[0],nextWeek:new Date(o.getTime()+7*24*60*60*1e3).toISOString().split("T")[0],todayPlus7:new Date(o.getTime()+7*24*60*60*1e3).toISOString().split("T")[0],todayPlus14:new Date(o.getTime()+14*24*60*60*1e3).toISOString().split("T")[0],currentTime:o.toTimeString().slice(0,5),oneHourLater:new Date(o.getTime()+60*60*1e3).toTimeString().slice(0,5),twoHoursLater:new Date(o.getTime()+2*60*60*1e3).toTimeString().slice(0,5),nineAM:"09:00",fivePM:"17:00"}},$e={reminderTimes:[{label:"In 15 minutes",value:15},{label:"In 30 minutes",value:30},{label:"In 1 hour",value:60},{label:"In 2 hours",value:120},{label:"In 1 day",value:1440}],deviceReturnDays:[{label:"Same day",value:0},{label:"3 days",value:3},{label:"1 week",value:7},{label:"2 weeks",value:14},{label:"1 month",value:30}],priorities:[{value:"low",label:"Low",color:"blue"},{value:"medium",label:"Medium",color:"orange"},{value:"high",label:"High",color:"red"}],employeePositions:["Technician","Senior Technician","Customer Care","Manager","Sales Representative","Administrator","Inventory Manager","Finance Officer"],deviceBrands:["Apple","Samsung","Huawei","Xiaomi","OnePlus","Google","Sony","LG","Motorola","Nokia","Oppo","Vivo","Realme","Tecno","Infinix"],commonIssues:["Screen Broken","Battery Issue","Charging Problem","Water Damage","Software Issue","Network Problem","Speaker Not Working","Microphone Not Working","Camera Issue","Power Button Stuck","Volume Button Not Working","WiFi Not Working","Bluetooth Issue","Overheating"]},pe=o=>{const{formType:v,currentData:f}=o,l=ve();switch(v){case"device":return{expectedReturnDate:l.todayPlus7,commonIssues:f.brand==="Apple"?["Screen Broken","Battery Issue","Camera Issue"]:$e.commonIssues};case"reminder":return{date:l.today,time:l.oneHourLater,notifyBefore:15,priority:"medium"};case"customer":return{loyaltyLevel:"interested",colorTag:"new"};case"employee":return{hireDate:l.today,status:"active",performance:3,attendance:100};default:return{}}},Qe=()=>{Ie();const{currentUser:o}=Ne(),{customers:v}=fe(),{devices:f}=be(),{currentBranch:l}=we(),{startLoading:y,completeLoading:T,failLoading:N}=Ce(),[k,z]=d.useState([]),[t,i]=d.useState(!0),[R,w]=d.useState(!1),[j,O]=d.useState("all"),[u,m]=d.useState(""),[S,b]=d.useState(null);d.useEffect(()=>{console.log("ðŸ”„ [Reminders] useEffect triggered, currentBranch:",l),l?(console.log("âœ… [Reminders] Branch available, loading reminders..."),g()):console.warn("âš ï¸ [Reminders] No current branch, waiting...")},[l]);const g=async()=>{const s=y("Loading reminders...");try{i(!0),console.log("ðŸ“ [Reminders] Loading reminders for branch:",{branchId:l==null?void 0:l.id,branchName:l==null?void 0:l.name,userId:o==null?void 0:o.id});const n=await ee.getReminders(l==null?void 0:l.id);console.log("âœ… [Reminders] Reminders loaded successfully:",{count:n.length,reminders:n}),z(n),T(s)}catch(n){console.error("âŒ [Reminders] Error loading reminders:",n),N(s,"Failed to load reminders"),$.error("Failed to load reminders")}finally{i(!1)}};he([{key:"n",meta:!0,action:()=>{b(null),w(!0)},description:"Create new reminder"},{key:"Escape",action:()=>{R&&w(!1)},description:"Close modal"}]);const P=d.useMemo(()=>{console.log("ðŸ” [Reminders] Filtering reminders:",{totalReminders:k.length,filterStatus:j,searchQuery:u});const s=k.filter(n=>{var E,G,F,r,c,h,L,q,K,Y,a,I,V,A,J;let x=!1;if(j==="all")x=!0;else if(j==="pending")x=n.status==="pending";else if(j==="completed")x=n.status==="completed";else if(j==="overdue"){const p=new Date,Q=p.toISOString().split("T")[0],M=p.toTimeString().split(" ")[0].slice(0,5);x=n.status==="pending"&&(n.date<Q||n.date===Q&&n.time<M)}let D=!0;if(u.trim()){const p=u.toLowerCase();let Q=!1;if(((E=n.relatedTo)==null?void 0:E.type)==="customer"&&((G=n.relatedTo)!=null&&G.id)){const M=v.find(ie=>{var U;return ie.id===((U=n.relatedTo)==null?void 0:U.id)});M&&(Q=M.name.toLowerCase().includes(p)||((F=M.phone)==null?void 0:F.toLowerCase().includes(p))||!1||((r=M.email)==null?void 0:r.toLowerCase().includes(p))||!1)}else if(((c=n.relatedTo)==null?void 0:c.type)==="device"&&((h=n.relatedTo)!=null&&h.id)){const M=f.find(ie=>{var U;return ie.id===((U=n.relatedTo)==null?void 0:U.id)});M&&(Q=((L=M.model)==null?void 0:L.toLowerCase().includes(p))||!1||((q=M.brand)==null?void 0:q.toLowerCase().includes(p))||!1||((K=M.serialNumber)==null?void 0:K.toLowerCase().includes(p))||!1||((Y=M.imei)==null?void 0:Y.toLowerCase().includes(p))||!1)}D=n.title.toLowerCase().includes(p)||((a=n.description)==null?void 0:a.toLowerCase().includes(p))||!1||String(n.date).toLowerCase().includes(p)||String(n.time).toLowerCase().includes(p)||n.priority.toLowerCase().includes(p)||n.category.toLowerCase().includes(p)||n.status.toLowerCase().includes(p)||((V=(I=n.relatedTo)==null?void 0:I.name)==null?void 0:V.toLowerCase().includes(p))||!1||((J=(A=n.relatedTo)==null?void 0:A.type)==null?void 0:J.toLowerCase().includes(p))||!1||Q}return x&&D});return console.log("âœ… [Reminders] Filtered results:",{filteredCount:s.length,reminders:s}),s},[k,j,u,v,f]),C={total:k.length,pending:k.filter(s=>s.status==="pending").length,completed:k.filter(s=>s.status==="completed").length,overdue:k.filter(s=>{const n=new Date,x=n.toISOString().split("T")[0],D=n.toTimeString().split(" ")[0].slice(0,5);return s.status==="pending"&&(s.date<x||s.date===x&&s.time<D)}).length},B=async s=>{try{console.log("âœ… [Reminders] Marking reminder as complete:",s),await ee.completeReminder(s),$.success("Reminder completed!"),g()}catch(n){console.error("âŒ [Reminders] Failed to complete reminder:",n),$.error("Failed to complete reminder")}},H=async s=>{if(confirm("Are you sure you want to delete this reminder?"))try{console.log("ðŸ—‘ï¸ [Reminders] Deleting reminder:",s),await ee.deleteReminder(s),$.success("Reminder deleted"),g()}catch(n){console.error("âŒ [Reminders] Failed to delete reminder:",n),$.error("Failed to delete reminder")}},_=s=>{console.log("ðŸ“‹ [Reminders] Duplicating reminder:",s),b({...s,id:"",status:"pending",title:`${s.title} (Copy)`}),w(!0)},Z=s=>{switch(s){case"high":return"bg-red-100 text-red-700";case"medium":return"bg-orange-100 text-orange-700";case"low":return"bg-blue-100 text-blue-700";default:return"bg-gray-100 text-gray-700"}},W=s=>{switch(s){case"device":return"bg-purple-50 text-purple-700";case"customer":return"bg-blue-50 text-blue-700";case"appointment":return"bg-green-50 text-green-700";case"payment":return"bg-yellow-50 text-yellow-700";default:return"bg-gray-50 text-gray-700"}};return t?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#3498db]"}),e.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading reminders..."})]})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ke,{to:"/dashboard"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reminders"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Smart reminder system with auto-complete and templates"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>{b(null),w(!0)},className:"flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(ce,{size:18}),"New Reminder",e.jsx("span",{className:"hidden sm:inline text-xs opacity-75 ml-2",children:"âŒ˜N"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.total})]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-5 hover:bg-orange-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-7 h-7 text-orange-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.pending})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-5 hover:bg-red-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-7 h-7 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.overdue})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.completed})]})]})})]}),e.jsx(ue,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 w-full md:w-auto min-w-[300px]",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search reminders by title, customer, device, category, priority...",value:u,onChange:s=>m(s.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"}),u&&e.jsx("button",{onClick:()=>m(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filter:"}),e.jsx("div",{className:"flex rounded-full bg-gray-100 p-1 gap-1",children:["all","pending","overdue","completed"].map(s=>{const n=()=>{if(j!==s)return"text-gray-600 hover:text-gray-900";switch(s){case"all":return"bg-blue-500 text-white";case"pending":return"bg-amber-500 text-white";case"overdue":return"bg-red-500 text-white";case"completed":return"bg-green-500 text-white";default:return"bg-white text-gray-900 shadow-sm"}};return e.jsx("button",{onClick:()=>O(s),className:`px-3 py-1.5 text-sm font-medium rounded-full transition-colors ${n()}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s)})})]})]})}),e.jsx(ue,{className:"p-6",children:P.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No reminders found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:j==="all"?"Create your first reminder to get started":`No ${j} reminders`}),e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors mx-auto",children:[e.jsx(ce,{size:18}),"Add Reminder"]})]}):e.jsx("div",{className:"space-y-3",children:P.map(s=>{const n=s.status==="pending"&&(s.date<new Date().toISOString().split("T")[0]||s.date===new Date().toISOString().split("T")[0]&&s.time<new Date().toTimeString().split(" ")[0].slice(0,5));return e.jsx("div",{className:`border-2 rounded-lg p-4 hover:border-gray-300 transition-colors ${s.status==="completed"?"bg-gray-50 border-gray-200":n?"bg-red-50 border-red-200":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:`text-lg font-semibold ${s.status==="completed"?"text-gray-500 line-through":"text-gray-900"}`,children:s.title}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${Z(s.priority)}`,children:s.priority}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${W(s.category)}`,children:s.category})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{size:14}),e.jsx("span",{children:new Date(s.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{size:14}),e.jsx("span",{children:s.time})]}),n&&s.status==="pending"&&e.jsxs("span",{className:"text-red-600 font-medium flex items-center gap-1",children:[e.jsx(oe,{size:14}),"Overdue"]})]}),s.relatedTo&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm",children:[s.relatedTo.type==="customer"&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-50 text-blue-700 rounded-md",children:[e.jsx(le,{size:14}),e.jsx("span",{className:"font-medium",children:s.relatedTo.name}),(()=>{const x=v.find(D=>{var E;return D.id===((E=s.relatedTo)==null?void 0:E.id)});return x!=null&&x.phone?e.jsxs("span",{className:"text-blue-600",children:["â€¢ ",x.phone]}):null})()]}),s.relatedTo.type==="device"&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-purple-50 text-purple-700 rounded-md",children:[e.jsx(ne,{size:14}),e.jsx("span",{className:"font-medium",children:s.relatedTo.name})]}),s.relatedTo.type==="appointment"&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-green-50 text-green-700 rounded-md",children:[e.jsx(X,{size:14}),e.jsx("span",{className:"font-medium",children:s.relatedTo.name})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsx("button",{onClick:()=>B(s.id),className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-green-600 text-white hover:bg-green-700 transition-colors",title:"Mark as complete",children:e.jsx(se,{size:13})}),e.jsx("button",{onClick:()=>_(s),className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",title:"Duplicate",children:e.jsx(ye,{size:13})}),e.jsx("button",{onClick:()=>{b(s),w(!0)},className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-gray-600 text-white hover:bg-gray-700 transition-colors",title:"Edit",children:e.jsx(Re,{size:13})}),e.jsx("button",{onClick:()=>H(s.id),className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-red-600 text-white hover:bg-red-700 transition-colors",title:"Delete",children:e.jsx(Le,{size:13})})]})]})},s.id)})})}),R&&e.jsx(Oe,{isOpen:R,onClose:()=>{w(!1),b(null)},onSuccess:()=>{w(!1),b(null),g()},reminder:S,currentUser:o,branchId:l==null?void 0:l.id})]})},Oe=({isOpen:o,onClose:v,onSuccess:f,reminder:l,currentUser:y,branchId:T})=>{var n,x,D,E,G,F,r,c,h,L,q,K,Y;const{customers:N}=fe(),{devices:k}=be(),z=ve();d.useEffect(()=>{o&&console.log("ðŸŽ¨ [Modal] EnhancedReminderModal opened:",{isOpen:o,reminder:l,userId:y==null?void 0:y.id,branchId:T})},[o]);const[t,i]=d.useState({title:"",description:"",date:"",time:"",priority:"medium",category:"general",notifyBefore:15,relatedTo:void 0,recurring:{enabled:!1,type:"daily",interval:1,endDate:void 0}}),[R,w]=d.useState(!1),[j,O]=d.useState(!1),[u,m]=d.useState(""),[S,b]=d.useState(!1),g=d.useMemo(()=>{var I,V;const a=u.toLowerCase().trim();return((I=t.relatedTo)==null?void 0:I.type)==="customer"?N.filter(A=>{var J,p;return A.name.toLowerCase().includes(a)||((J=A.email)==null?void 0:J.toLowerCase().includes(a))||((p=A.phone)==null?void 0:p.toLowerCase().includes(a))}).slice(0,50):((V=t.relatedTo)==null?void 0:V.type)==="device"?k.filter(A=>{var J,p,Q;return((J=A.model)==null?void 0:J.toLowerCase().includes(a))||((p=A.serialNumber)==null?void 0:p.toLowerCase().includes(a))||((Q=A.brand)==null?void 0:Q.toLowerCase().includes(a))}).slice(0,50):[]},[(n=t.relatedTo)==null?void 0:n.type,u,N,k]),{clearDraft:P,hasDraft:C,loadDraft:B,getDraftAge:H}=Me({key:"enhanced_reminder",data:t,enabled:!l,debounceMs:1e3});d.useEffect(()=>{if(l)i({title:l.title,description:l.description||"",date:l.date,time:l.time,priority:l.priority,category:l.category,notifyBefore:l.notifyBefore||15,relatedTo:l.relatedTo,recurring:l.recurring||{enabled:!1,type:"daily",interval:1,endDate:void 0}});else{const a=pe({formType:"reminder",currentData:{}});i({title:"",description:"",date:a.date,time:a.time,priority:a.priority,category:"general",notifyBefore:a.notifyBefore,relatedTo:void 0,recurring:{enabled:!1,type:"daily",interval:1,endDate:void 0}})}},[l]),he([{key:"s",meta:!0,action:a=>{a.preventDefault(),_(a)},description:"Save reminder"}]);const _=async a=>{if(a.preventDefault(),S){console.log("â³ Already submitting, ignoring duplicate request");return}if(!t.title||!t.date||!t.time){$.error("Please fill in all required fields");return}b(!0);try{if(l)console.log("ðŸ“ Updating reminder:",l.id,t),await ee.updateReminder(l.id,t),$.success("Reminder updated successfully");else{if(console.log("ðŸ“ Creating reminder:",{formData:t,userId:y==null?void 0:y.id,branchId:T}),!(y!=null&&y.id)){$.error("User not authenticated"),b(!1);return}if(!T){$.error("No branch selected"),b(!1);return}const I=await ee.createReminder(t,y.id,T);if(!I)throw new Error("Failed to create reminder - no data returned");console.log("âœ… Reminder created:",I),$.success("Reminder created successfully"),P()}f()}catch(I){console.error("âŒ Error saving reminder:",I);const V=(I==null?void 0:I.message)||"Failed to save reminder";$.error(V)}finally{b(!1)}},Z=()=>{i({...t,time:z.oneHourLater})},W=()=>{i({...t,date:z.tomorrow})},s=()=>{const a=pe({formType:"reminder",currentData:{}});i({title:"",description:"",date:a.date,time:a.time,priority:a.priority,category:"general",notifyBefore:a.notifyBefore})};return o?e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[99999]",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:l?"Edit Reminder":"Create New Reminder"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Smart reminder with autocomplete and templates"})]})]}),e.jsx("button",{onClick:v,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ae,{className:"w-6 h-6"})})]}),e.jsx(ze,{actions:[de.nowPlusHour(Z),de.todayPlusWeek(W),de.reset(s)],className:"mb-4"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsx(ge,{label:"Title",value:t.title,onChange:a=>i({...t,title:a}),options:["Follow up on device repair","Call customer about pickup","Check parts inventory","Team meeting","Send payment reminder"],placeholder:"Enter reminder title or create your own",required:!0,fuzzyMatch:!0,showRecent:!0,recentKey:"reminder_titles",createNew:!0,icon:e.jsx(te,{size:16})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:t.date,onChange:a=>i({...t,date:a.target.value}),className:"w-full pl-11 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Time ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"time",value:t.time,onChange:a=>i({...t,time:a.target.value}),className:"w-full pl-11 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>i({...t,priority:"low"}),className:`px-4 py-3 rounded-lg border-2 font-medium transition-all flex items-center justify-center gap-2 ${t.priority==="low"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-blue-300"}`,children:[e.jsx("span",{className:"text-blue-600 text-xl",children:"â—‰"})," Low"]}),e.jsxs("button",{type:"button",onClick:()=>i({...t,priority:"medium"}),className:`px-4 py-3 rounded-lg border-2 font-medium transition-all flex items-center justify-center gap-2 ${t.priority==="medium"?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-200 bg-white text-gray-700 hover:border-orange-300"}`,children:[e.jsx("span",{className:"text-orange-600 text-xl",children:"â—‰"})," Medium"]}),e.jsxs("button",{type:"button",onClick:()=>i({...t,priority:"high"}),className:`px-4 py-3 rounded-lg border-2 font-medium transition-all flex items-center justify-center gap-2 ${t.priority==="high"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 bg-white text-gray-700 hover:border-red-300"}`,children:[e.jsx("span",{className:"text-red-600 text-xl",children:"â—‰"})," High"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(ge,{label:"Category",value:t.category,onChange:a=>i({...t,category:a}),options:[{value:"general",label:"General",icon:e.jsx(te,{size:16})},{value:"device",label:"Device",icon:e.jsx(ne,{size:16})},{value:"customer",label:"Customer",icon:e.jsx(le,{size:16})},{value:"appointment",label:"Appointment",icon:e.jsx(X,{size:16})},{value:"payment",label:"Payment",icon:e.jsx(re,{size:16})},{value:"other",label:"Other",icon:e.jsx(oe,{size:16})}],placeholder:"Select category"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notify Before (minutes)"}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"number",value:t.notifyBefore,onChange:a=>i({...t,notifyBefore:parseInt(a.target.value)}),placeholder:"15",min:"0",className:"w-full pl-11 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:t.description,onChange:a=>i({...t,description:a.target.value}),placeholder:"Enter description (optional)",rows:3,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900 resize-none"})]}),e.jsxs("div",{className:"border-t-2 border-gray-100 pt-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Advanced Options"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{type:"button",onClick:()=>w(!0),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg border-2 transition-all ${(x=t.recurring)!=null&&x.enabled?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-400"}`,children:[e.jsx(me,{size:18}),e.jsx("span",{className:"font-medium",children:(D=t.recurring)!=null&&D.enabled?"Recurring: Enabled":"Add Recurring"})]}),e.jsxs("button",{type:"button",onClick:()=>O(!0),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg border-2 transition-all ${t.relatedTo?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-white text-gray-700 hover:border-green-400"}`,children:[e.jsx(xe,{size:18}),e.jsx("span",{className:"font-medium",children:t.relatedTo?`Linked to ${t.relatedTo.type}`:"Link Entity"})]})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 p-6 pt-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:v,disabled:S,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed bg-white",children:"Cancel"}),e.jsx("button",{type:"button",onClick:_,disabled:S,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[l?"Update":"Create"," Reminder",e.jsx("span",{className:"text-xs opacity-75",children:"âŒ˜S"})]})})]})})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"flex-shrink-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{size:24}),e.jsx("h3",{className:"text-xl font-bold",children:"Recurring Options"})]}),e.jsx("button",{onClick:()=>w(!1),className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-all",children:e.jsx(ae,{size:20})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("input",{type:"checkbox",id:"enableRecurringModal",checked:((E=t.recurring)==null?void 0:E.enabled)||!1,onChange:a=>i({...t,recurring:{...t.recurring,enabled:a.target.checked}}),className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer"}),e.jsx("label",{htmlFor:"enableRecurringModal",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Enable recurring reminder"})]}),((G=t.recurring)==null?void 0:G.enabled)&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Recurring Type"}),e.jsxs("select",{value:((F=t.recurring)==null?void 0:F.type)||"daily",onChange:a=>i({...t,recurring:{...t.recurring,type:a.target.value}}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Repeat Every ",((r=t.recurring)==null?void 0:r.type)==="daily"?"days":((c=t.recurring)==null?void 0:c.type)==="weekly"?"weeks":"months"]}),e.jsx("input",{type:"number",min:"1",value:((h=t.recurring)==null?void 0:h.interval)||1,onChange:a=>i({...t,recurring:{...t.recurring,interval:parseInt(a.target.value)||1}}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:((L=t.recurring)==null?void 0:L.endDate)||"",onChange:a=>i({...t,recurring:{...t.recurring,endDate:a.target.value||void 0}}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors"})]})]})]}),e.jsx("div",{className:"flex-shrink-0 p-6 pt-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:e.jsx("button",{onClick:()=>w(!1),className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Done"})})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"flex-shrink-0 bg-gradient-to-r from-green-600 to-green-700 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{size:24}),e.jsx("h3",{className:"text-xl font-bold",children:"Link Entity"})]}),e.jsx("button",{onClick:()=>{O(!1),m("")},className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-all",children:e.jsx(ae,{size:20})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Link Type"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{i({...t,relatedTo:{type:"customer",id:"",name:""}}),m("")},className:`flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all ${((q=t.relatedTo)==null?void 0:q.type)==="customer"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white text-gray-600 hover:border-green-300"}`,children:[e.jsx(le,{size:20}),e.jsx("span",{className:"text-xs font-medium",children:"Customer"})]}),e.jsxs("button",{type:"button",onClick:()=>{i({...t,relatedTo:{type:"device",id:"",name:""}}),m("")},className:`flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all ${((K=t.relatedTo)==null?void 0:K.type)==="device"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white text-gray-600 hover:border-green-300"}`,children:[e.jsx(ne,{size:20}),e.jsx("span",{className:"text-xs font-medium",children:"Device"})]}),e.jsxs("button",{type:"button",onClick:()=>{i({...t,relatedTo:{type:"appointment",id:"",name:""}}),m("")},className:`flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all ${((Y=t.relatedTo)==null?void 0:Y.type)==="appointment"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white text-gray-600 hover:border-green-300"}`,children:[e.jsx(X,{size:20}),e.jsx("span",{className:"text-xs font-medium",children:"Appointment"})]})]})]}),t.relatedTo&&t.relatedTo.type!=="appointment"&&e.jsxs("div",{className:"animate-in fade-in duration-200 space-y-3",children:[!t.relatedTo.id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:`Search ${t.relatedTo.type==="customer"?"customers":"devices"}...`,value:u,onChange:a=>m(a.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 transition-colors"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto border-2 border-gray-200 rounded-lg",children:g.length>0?e.jsx("div",{className:"divide-y",children:g.map(a=>e.jsxs("button",{type:"button",onClick:()=>{i({...t,relatedTo:{type:t.relatedTo.type,id:a.id,name:t.relatedTo.type==="customer"?a.name:`${a.brand||""} ${a.model||""}`.trim()}})},className:`w-full text-left p-3 hover:bg-green-50 transition-colors flex items-center gap-3 ${t.relatedTo.id===a.id?"bg-green-50 border-l-4 border-green-500":""}`,children:[t.relatedTo.type==="customer"?e.jsxs(e.Fragment,{children:[e.jsx(le,{size:18,className:"text-gray-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.name}),e.jsxs("div",{className:"text-sm text-gray-500 truncate",children:[a.phone&&e.jsx("span",{children:a.phone}),a.email&&e.jsx("span",{className:"ml-2",children:a.email})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:18,className:"text-gray-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[a.brand&&`${a.brand} `,a.model]}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:a.serialNumber&&e.jsxs("span",{children:["SN: ",a.serialNumber]})})]})]}),t.relatedTo.id===a.id&&e.jsx(se,{size:18,className:"text-green-600 flex-shrink-0"})]},a.id))}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsxs("div",{className:"mb-2",children:["No ",t.relatedTo.type==="customer"?"customers":"devices"," found"]}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})})]}),t.relatedTo.id&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"p-3 bg-green-50 border-2 border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:16,className:"text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-700",children:["Selected: ",t.relatedTo.name]})]}),e.jsx("button",{type:"button",onClick:()=>{i({...t,relatedTo:{type:t.relatedTo.type,id:"",name:""}}),m("")},className:"text-sm text-green-600 hover:text-green-700 font-medium underline",children:"Change"})]})})})]}),t.relatedTo&&t.relatedTo.type==="appointment"&&e.jsxs("div",{className:"animate-in fade-in duration-200",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(X,{size:16,className:"text-gray-600"}),"Appointment Title"]}),e.jsx("input",{type:"text",value:t.relatedTo.name,onChange:a=>i({...t,relatedTo:{...t.relatedTo,name:a.target.value}}),placeholder:"Enter appointment title",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 transition-colors"})]})]}),e.jsx("div",{className:"flex-shrink-0 p-6 pt-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:e.jsxs("div",{className:"flex gap-3",children:[t.relatedTo&&e.jsx("button",{onClick:()=>{i({...t,relatedTo:void 0}),m("")},className:"flex-1 px-4 py-3 border-2 border-red-200 text-red-600 rounded-lg font-medium hover:bg-red-50 transition-colors bg-white",children:"Remove Link"}),e.jsx("button",{onClick:()=>{O(!1),m("")},className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors",children:"Done"})]})})]})})]}):null};export{Oe as EnhancedReminderModal,Qe as default};
