import{s as $,j as e,au as q}from"./index-61458a34.js";import{r as m,R as C,b as A}from"./vendor-36d2c7c1.js";import{n as h,u as y,q as N,r as M,X as D,aA as O,d as z,m as V,Y as F,U as P,bo as E,k as B,P as S,M as L,o as Q,s as T,aE as k}from"./ui-28e30067.js";import{G as Z}from"./GlassTabs-05c8a392.js";import{a as U}from"./routing-eb8c310c.js";const I=s=>{if(!s)return[];const t=s.match(/Product Categories:\s*([^\n]+)/);return t?t[1].split(",").map(l=>l.trim()).filter(l=>l.length>0):[]},W=s=>{const t=["bg-blue-50 border-blue-300 text-blue-900","bg-purple-50 border-purple-300 text-purple-900","bg-green-50 border-green-300 text-green-900","bg-orange-50 border-orange-300 text-orange-900","bg-pink-50 border-pink-300 text-pink-900","bg-indigo-50 border-indigo-300 text-indigo-900","bg-teal-50 border-teal-300 text-teal-900","bg-cyan-50 border-cyan-300 text-cyan-900"],r=s.split("").reduce((l,i)=>l+i.charCodeAt(0),0);return t[r%t.length]},H=({supplierId:s,supplierName:t})=>{const[r,l]=m.useState([]),[i,o]=m.useState(!0),[c,b]=m.useState({totalOrders:0,totalValue:0,avgOrderValue:0,lastOrderDate:null,currency:"TZS",hasMultipleCurrencies:!1});m.useEffect(()=>{u()},[s]);const u=async()=>{var a,x;try{o(!0);const{data:n,error:d}=await $.from("lats_purchase_orders").select(`
          id,
          po_number,
          order_date,
          expected_delivery_date,
          total_amount,
          currency,
          status,
          notes,
          created_at
        `).eq("supplier_id",s).order("order_date",{ascending:!1});if(d)throw d;if(l(n||[]),n&&n.length>0){const v=n.reduce((f,R)=>f+(parseFloat(R.total_amount)||0),0),p=[...new Set(n.map(f=>f.currency||"TZS"))],w=p.length>1,_=((a=n[0])==null?void 0:a.currency)||"TZS";w&&console.warn(`⚠️ Multiple currencies in supplier orders: ${p.join(", ")}. Using ${_} for stats.`),b({totalOrders:n.length,totalValue:v,avgOrderValue:v/n.length,lastOrderDate:(x=n[0])==null?void 0:x.order_date,currency:_,hasMultipleCurrencies:w})}}catch(n){console.error("Error loading order history:",n),h.error("Failed to load order history")}finally{o(!1)}},g=a=>a%1===0?a.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),j=a=>{const x={pending:"bg-yellow-100 text-yellow-700",approved:"bg-blue-100 text-blue-700",ordered:"bg-purple-100 text-purple-700",received:"bg-green-100 text-green-700",cancelled:"bg-red-100 text-red-700"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x[a]||"bg-gray-100 text-gray-700"}`,children:a.charAt(0).toUpperCase()+a.slice(1)})};return i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading orders..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-4 border-2 border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700",children:"Total Orders"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:c.totalOrders})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-semibold text-green-700",children:"Total Value"})]}),e.jsxs("div",{className:"text-lg font-bold text-green-900",children:[g(c.totalValue)," ",c.currency]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-4 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700",children:"Avg Value"})]}),e.jsxs("div",{className:"text-lg font-bold text-blue-900",children:[g(c.avgOrderValue)," ",c.currency]})]})]}),r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(y,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"No orders found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"No purchase orders for this supplier"})]}):e.jsx("div",{className:"space-y-3",children:r.map(a=>e.jsx("div",{className:"border-2 rounded-xl bg-white shadow-sm transition-all duration-300 hover:shadow-md border-gray-200 hover:border-orange-300",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"text-base font-bold text-gray-900",children:a.order_number||a.po_number||`Order #${a.id.slice(0,8)}`}),j(a.status)]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:new Date(a.order_date).toLocaleDateString()})]}),a.expected_delivery_date&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["Expected: ",new Date(a.expected_delivery_date).toLocaleDateString()]})})]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:[g(a.total_amount||0)," ",a.currency||"TZS"]})})]}),a.notes&&e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsx("p",{className:"text-sm text-gray-600",children:a.notes})})]})},a.id))})]})},se=({supplier:s,onClose:t,onUpdate:r,onEdit:l,onSupplierSelect:i})=>{const o=U(),[c,b]=m.useState("overview"),u=C.useRef(null),g=async()=>{if(confirm(`⚠️ Are you sure you want to delete "${s.name}"? This action cannot be undone.`))try{await q(s.id),h.success("Supplier deleted successfully"),t(),r&&r()}catch(d){console.error("Error deleting supplier:",d),h.error(d.message||"Failed to delete supplier")}},j=()=>{l?l(s):h.error("Edit functionality not available")},a=()=>{i?(i(s),t()):(o(`/lats/purchase-order/create?supplierId=${s.id}`),h.success(`Creating purchase order for ${s.name}`),t())};C.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]);const x=[{id:"overview",label:"Overview",icon:e.jsx(P,{size:16})},{id:"orders",label:"Orders",icon:e.jsx(E,{size:16})}],n=()=>{switch(c){case"overview":return e.jsx(G,{supplier:s});case"orders":return e.jsx(H,{supplierId:s.id,supplierName:s.name});default:return null}};return A.createPortal(e.jsx("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[99999]",style:{top:0,left:0,right:0,bottom:0},role:"dialog","aria-modal":"true","aria-labelledby":"supplier-detail-modal-title",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:t,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(O,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"supplier-detail-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.company_name||"Supplier Details"})]})]})}),e.jsx("div",{className:"px-6 pt-4 pb-0 bg-white flex-shrink-0",children:e.jsx(Z,{tabs:x.map(d=>({id:d.id,label:d.label,icon:d.icon,badge:d.badge})),activeTab:c,onTabChange:d=>b(d),variant:"modern",size:"sm"})}),e.jsx("div",{ref:u,className:"flex-1 overflow-y-auto px-6 py-4",style:{minHeight:0},children:n()}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:a,className:"flex-1 px-6 py-3.5 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg hover:shadow-xl text-lg flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Select Supplier"]}),e.jsxs("button",{type:"button",onClick:j,className:"px-6 py-3.5 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl text-lg flex items-center justify-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Edit"]}),e.jsxs("button",{type:"button",onClick:g,className:"px-6 py-3.5 bg-red-500 hover:bg-red-600 text-white rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl text-lg flex items-center justify-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Delete"]})]})})]})}),document.body)},G=({supplier:s})=>{const t=s,[r,l]=m.useState(null),i=I(s.notes);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-4 border-2 border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700",children:"Orders"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:t.total_orders||t.ordersCount||0})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-semibold text-green-700",children:"Rating"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:t.average_rating||s.rating?Number(t.average_rating||s.rating).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-4 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700",children:"Currency"})]}),e.jsx("div",{className:"text-lg font-bold text-blue-900",children:s.preferred_currency||s.currency||"TZS"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(S,{className:"w-5 h-5 text-orange-600"}),e.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Contact Information"})]}),e.jsxs("div",{className:"space-y-3",children:[s.contact_person&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.contact_person})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.email})]}),s.whatsapp&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.whatsapp})]}),t.wechat&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-[#09B83E] rounded flex items-center justify-center",children:e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-3 h-3",fill:"white",children:[e.jsx("path",{d:"M8.5 6c-2.8 0-5 1.9-5 4.3 0 1.4.7 2.6 1.8 3.4l-.5 1.5 1.7-.9c.6.2 1.3.3 2 .3 2.8 0 5-1.9 5-4.3S11.3 6 8.5 6zm-1 5.8c-.4 0-.8-.3-.8-.8s.3-.8.8-.8.8.3.8.8-.4.8-.8.8zm2.5 0c-.4 0-.8-.3-.8-.8s.3-.8.8-.8.8.3.8.8-.4.8-.8.8z"}),e.jsx("path",{d:"M15.5 11c-.3 0-.5 0-.8.1 0 .1 0 .3 0 .4 0 2.9-2.6 5.2-5.7 5.2-.4 0-.7 0-1.1-.1 1 1.3 2.8 2.2 4.9 2.2.5 0 1-.1 1.5-.2l1.3.7-.4-1.2c.9-.6 1.5-1.6 1.5-2.7 0-1.8-1.5-3.4-3.2-4.4z"})]})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.wechat})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.address})]}),(s.city||s.country)&&!s.address&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.city&&s.country?`${s.city}, ${s.country}`:s.city||s.country})]})]})]}),s.country==="China"&&(t.wechat_qr_code||t.alipay_qr_code)&&e.jsxs("div",{className:"bg-white border-2 border-orange-200 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(k,{className:"w-5 h-5 text-orange-600"}),e.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Payment Methods"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.wechat_qr_code&&e.jsxs("div",{onClick:()=>l({type:"wechat",url:t.wechat_qr_code}),className:"cursor-pointer bg-green-50 rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-all",children:[e.jsx("div",{className:"text-xs font-semibold text-green-700 mb-2",children:"WeChat Pay"}),e.jsx("img",{src:t.wechat_qr_code,alt:"WeChat QR",className:"w-full h-24 object-contain rounded"})]}),t.alipay_qr_code&&e.jsxs("div",{onClick:()=>l({type:"alipay",url:t.alipay_qr_code}),className:"cursor-pointer bg-blue-50 rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-all",children:[e.jsx("div",{className:"text-xs font-semibold text-blue-700 mb-2",children:"Alipay"}),e.jsx("img",{src:t.alipay_qr_code,alt:"Alipay QR",className:"w-full h-24 object-contain rounded"})]})]})]}),i.length>0&&e.jsxs("div",{className:"bg-white border-2 border-purple-200 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(y,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Product Categories"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map((o,c)=>e.jsx("span",{className:`px-3 py-1.5 text-sm font-semibold rounded-lg border ${W(o)}`,children:o},c))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(O,{className:"w-5 h-5 text-orange-600"}),e.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Business Information"})]}),e.jsxs("div",{className:"space-y-3",children:[s.company_name&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Company Name"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:s.company_name})]}),s.country&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Country"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:s.country})]}),s.preferred_currency&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Currency"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:s.preferred_currency})]}),s.payment_terms&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Payment Terms"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:s.payment_terms})]}),s.tax_id&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Tax ID"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:s.tax_id})]}),s.exchange_rate&&s.preferred_currency&&s.preferred_currency!=="TZS"&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Exchange Rate"}),e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["1 ",s.preferred_currency," = ",s.exchange_rate," TZS"]})]}),(t.leadTimeDays||t.lead_time_days)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Lead Time"}),e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:[t.leadTimeDays||t.lead_time_days," days"]})]})]})]}),s.country==="China"&&t.bank_account_details&&e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(k,{className:"w-5 h-5 text-orange-600"}),e.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Bank Account Details"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsx("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-mono leading-relaxed",children:t.bank_account_details})})]})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[100000] p-4",onClick:()=>l(null),children:e.jsxs("div",{className:"relative bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{onClick:()=>l(null),className:"absolute -top-3 -right-3 w-10 h-10 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-lg transition-all flex items-center justify-center",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full ${r.type==="wechat"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:e.jsx("span",{className:"font-bold text-sm",children:r.type==="wechat"?"WeChat Pay QR Code":"Alipay QR Code"})})}),e.jsx("div",{className:`p-6 rounded-xl ${r.type==="wechat"?"bg-gradient-to-br from-green-50 to-emerald-100 border-2 border-green-300":"bg-gradient-to-br from-blue-50 to-cyan-100 border-2 border-blue-300"}`,children:e.jsx("img",{src:r.url,alt:`${r.type==="wechat"?"WeChat":"Alipay"} QR Code`,className:"w-full h-auto rounded-lg shadow-lg"})})]})})]})};export{se as S,I as e,W as g};
