import{s as S,j as e}from"./index-61458a34.js";import{r as i}from"./vendor-36d2c7c1.js";import{n as p,j as C,X as L,v as A,p as W,ax as P,e as T}from"./ui-28e30067.js";import{e as H}from"./employeeService-efe40e70.js";const G=({isOpen:f,onClose:g,onImportComplete:k})=>{const[y,U]=i.useState([]),[t,h]=i.useState(new Set),[R,b]=i.useState(!1),[u,j]=i.useState(!1),[m,I]=i.useState(""),[x,_]=i.useState("without");i.useEffect(()=>{f&&w()},[f]);const w=async()=>{b(!0);try{const{data:s,error:r}=await S.from("users").select("id, email, full_name, phone, role, department, is_active").eq("is_active",!0).order("full_name",{ascending:!0});if(r)throw r;const{data:l,error:c}=await S.from("employees").select("user_id").neq("user_id",null);if(c)throw c;const a=new Set((l==null?void 0:l.map(d=>d.user_id).filter(Boolean))||[]),o=(s||[]).map(d=>({...d,hasEmployeeRecord:a.has(d.id)}));U(o)}catch(s){console.error("Error loading users:",s),p.error("Failed to load users")}finally{b(!1)}},N=s=>{const r=new Set(t);r.has(s)?r.delete(s):r.add(s),h(r)},z=()=>{const s=v();t.size===s.length?h(new Set):h(new Set(s.map(r=>r.id)))},$=async()=>{if(t.size===0){p.error("Please select at least one user to import");return}j(!0);let s=0,r=0;const l=[];try{for(const c of t){const a=y.find(o=>o.id===c);if(a)try{if(a.hasEmployeeRecord){l.push(`${a.full_name}: Already has employee record`),r++;continue}const o=a.full_name.split(" "),d=o[0]||"Unknown",F=o.slice(1).join(" ")||"User";await H.createEmployee({userId:a.id,firstName:d,lastName:F,email:a.email,phone:a.phone||"",position:a.role||"Staff",department:a.department||"General",hireDate:new Date().toISOString().split("T")[0],salary:0,currency:"TZS",status:"active",employmentType:"full-time",performanceRating:3,skills:null}),s++}catch(o){console.error(`Error importing user ${a.email}:`,o),l.push(`${a.full_name}: ${o.message||"Failed to import"}`),r++}}s>0&&p.success(`Successfully imported ${s} employee${s!==1?"s":""}`,{duration:4e3}),r>0&&(console.error("Import errors:",l),p.error(`Failed to import ${r} user${r!==1?"s":""}. Check console for details.`,{duration:5e3})),s>0?(k(),g()):await w()}catch(c){console.error("Error during import:",c),p.error("An error occurred during import")}finally{j(!1),h(new Set)}},v=()=>y.filter(s=>{const r=m===""||s.full_name.toLowerCase().includes(m.toLowerCase())||s.email.toLowerCase().includes(m.toLowerCase())||s.role.toLowerCase().includes(m.toLowerCase()),l=x==="all"||x==="without"&&!s.hasEmployeeRecord||x==="with"&&s.hasEmployeeRecord;return r&&l}),n=v(),E=y.filter(s=>!s.hasEmployeeRecord).length;return f?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(C,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Import Employees from Users"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[E," user",E!==1?"s":""," without employee records"]})]})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:u,children:e.jsx(L,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, email, or role...",value:m,onChange:s=>I(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:x,onChange:s=>_(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"without",children:"Without Employee Record"}),e.jsx("option",{value:"with",children:"With Employee Record"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.length>0&&t.size===n.length,onChange:z,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:t.size>0?e.jsxs("span",{className:"font-medium text-blue-600",children:[t.size," user",t.size!==1?"s":""," selected"]}):"Select users to import"})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[n.length," user",n.length!==1?"s":""," shown"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:R?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading users..."})]}):n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(W,{className:"w-16 h-16 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No users found"}),e.jsx("p",{className:"text-sm mt-1",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"space-y-2",children:n.map(s=>e.jsx("div",{className:`p-4 border rounded-lg transition-all cursor-pointer ${t.has(s.id)?"border-blue-500 bg-blue-50":s.hasEmployeeRecord?"border-gray-200 bg-gray-50 opacity-60":"border-gray-200 hover:border-blue-300 hover:bg-gray-50"}`,onClick:()=>!s.hasEmployeeRecord&&N(s.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.has(s.id),onChange:()=>N(s.id),disabled:s.hasEmployeeRecord,className:"mt-1 w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:opacity-50",onClick:r=>r.stopPropagation()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.full_name}),s.hasEmployeeRecord&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full",children:[e.jsx(P,{className:"w-3 h-3"}),"Has Employee Record"]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[e.jsx("span",{children:s.email}),s.phone&&e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 text-xs rounded-full",children:s.role}),s.department&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-200 text-gray-700 text-xs rounded-full",children:s.department})]})]})]})},s.id))})}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Employee records will be created with basic info. You can edit them later."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:g,disabled:u,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:t.size===0||u,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Importing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4"}),e.jsxs("span",{children:["Import ",t.size>0?`(${t.size})`:""]})]})})]})]})]})}):null};export{G as I};
