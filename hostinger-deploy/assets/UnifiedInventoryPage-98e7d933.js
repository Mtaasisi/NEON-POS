import{j as e,s as pe,M as Js,e as _t,G as Mt,y as Ys,d as Ft,u as Zs,aU as Ds,ah as ea,aj as ta,aF as sa,aI as aa,aJ as ra,aO as ia,a as na,an as os}from"./index-61458a34.js";import{r as n,b as qt,R as Et}from"./vendor-36d2c7c1.js";import{B as la}from"./BackButton-02a80e74.js";import{P as oa}from"./PageErrorBoundary-3d3e48b8.js";import{u as ca}from"./useErrorHandler-ecda4689.js";import{E as da}from"./ErrorState-8ed6c2f9.js";import{X as st,u as at,e as Ut,bj as ms,af as Pt,b_ as ss,a8 as zs,J as ma,N as Vt,S as $t,bM as Bt,ax as Us,I as At,n as f,T as rs,v as us,bJ as ua,ah as Qs,d as jt,ag as Bs,D as Ht,a3 as Yt,m as It,a0 as cs,bi as Ms,c as Ps,Y as ps,b0 as xa,g as ha,i as Qt,a6 as xs,s as Dt,aA as Hs,b$ as ga,a9 as pa,b as Ks,an as ba,f as ds,t as Gs,A as as,O as Jt,av as vs,b7 as js,bN as es,bw as fa,a4 as ya,q as Xt,c0 as Ls,k as hs,ao as Vs,aU as va,bq as ja,b3 as Na,aB as wa,G as Ns,a as ka,Q as gs,r as ts,aE as Sa,p as _a,aa as Ca,ab as ws,cV as $s,cO as Pa,cW as Ia,cN as Ea,l as Aa,a7 as Da,az as Ma,R as qs,cX as La}from"./ui-28e30067.js";import{checkIMEIExists as Va,addIMEIToParentVariant as $a}from"./imeiVariantService-4ce4b8b1.js";import{C as qa,a as Fa}from"./CategoryFormModal-0cc6b6de.js";import{_ as xt}from"./supabase-cf010ec4.js";import{u as bs}from"./useBodyScrollLock-341c8b9f.js";import{u as Ta}from"./useDialog-6eb5c329.js";import{utils as ks,writeFile as Ra}from"./utils-ebb5cecb.js";import{S as Oa}from"./SupplierForm-59afd126.js";import{P as za,a as Ua,A as Qa}from"./AddProductModal-144ca68a.js";import{generateSKU as Ba}from"./skuUtils-60e0a165.js";import{o as Ha,s as Wt,p as Ss,e as Ka,r as Ga,c as Fs,a as Wa,Z as Xa}from"./forms-ebbdb905.js";import{S as Ja}from"./SearchBar-c613e419.js";import{G as Ya}from"./GlassSelect-e243562f.js";import{e as Za,V as er}from"./VariantProductCard-04300406.js";import{u as tr}from"./useBluetoothPrinter-0ea2abfe.js";import{R as _s}from"./robustImageService-f15af7ef.js";import{format as Ee}from"./format-aff4c6a2.js";import{f as sr}from"./specificationUtils-0c00478d.js";import{i as Ts,g as Rs,a as zt,f as ar,b as rr}from"./variantUtils-827870e5.js";import{u as ir,O as nr}from"./OrderManagementModal-72b00066.js";import{c as Cs,a as lr,b as or,d as cr,e as dr,g as mr}from"./productCalculations-9f6c3068.js";import{loadChildIMEIs as Os}from"./variantHelpers-318d278a.js";import{a as Ws}from"./routing-eb8c310c.js";import{Q as ur}from"./qr-3af4041b.js";import{D as xr}from"./SkeletonLoaders-da70324a.js";import"./zod-78f78e6c.js";import"./GlassInput-0475021a.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";import"./GlassBadge-9ae09fa8.js";import"./CategoryInput-e47eba98.js";import"./QualityCheckModal-849e9065.js";import"./LoadingSpinner-251d9268.js";import"./PaymentsPopupModal-6fe61f19.js";import"./currencyUtils-59109a41.js";import"./SetPricingModal-84ffdd49.js";const hr=[{value:"purchase",label:"Purchase Order"},{value:"sale",label:"Sale"},{value:"return",label:"Customer Return"},{value:"damage",label:"Damaged Goods"},{value:"expiry",label:"Expired Goods"},{value:"theft",label:"Theft/Loss"},{value:"adjustment",label:"Manual Adjustment"},{value:"transfer",label:"Location Transfer"},{value:"audit",label:"Stock Audit"},{value:"other",label:"Other"}],Is=({product:y,isOpen:T,onClose:s,onSubmit:te,loading:U=!1})=>{var $;const[B,be]=n.useState(null),[m,z]=n.useState("in"),[_,J]=n.useState(0),[Z,he]=n.useState(""),[ie,F]=n.useState(""),[ce,xe]=n.useState([""]),[a,r]=n.useState(!1),[u,W]=n.useState(!1);n.useEffect(()=>{T&&y&&(be(null),z("in"),J(0),he(""),F(""),xe([""]),r(!1))},[T,y]),n.useEffect(()=>{m==="in"&&_>0&&a?xe(j=>Array(_).fill("").map((Pe,we)=>j[we]||"")):(m!=="in"||!a)&&(xe([""]),m!=="in"&&r(!1))},[_,m,a]);const ve=(()=>{if(!B)return 0;const j=B.quantity||0;switch(m){case"in":return j+_;case"out":return Math.max(0,j-_);case"set":return _;default:return j}})(),ee=j=>B?j<=(B.minQuantity||0)?"low":B.maxQuantity&&j>=B.maxQuantity?"high":"normal":"normal",v=B?ee(B.quantity||0):"normal",b=B?ee(ve):"normal",D=j=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(j),ae=(j,X)=>{const Pe=[...ce];Pe[j]=X,xe(Pe)},G=async()=>{if(!B||!y)return;if(_<=0){f.error("Quantity must be greater than 0");return}if(!Z){f.error("Please select a reason");return}const j=ce.filter(X=>X.trim().length>0);if(m==="in"&&_>0&&a&&j.length>0){if(j.length!==_){f.error(`If providing IMEI/Serial numbers, please enter one for each of the ${_} unit(s)`);return}if(new Set(j.map(Pe=>Pe.trim())).size!==j.length){f.error("Duplicate IMEI/Serial numbers detected. Each unit must have a unique identifier.");return}}W(!0);try{const{data:{user:X}}=await pe.auth.getUser(),Pe=X==null?void 0:X.id,we=Js();if(m==="in"&&a&&j.length>0){let Me=B.id;if(!B.is_parent&&B.variant_type!=="parent"){const{error:Le}=await pe.from("lats_product_variants").update({is_parent:!0,variant_type:"parent",updated_at:new Date().toISOString()}).eq("id",B.id);Le&&console.error("Error converting variant to parent:",Le)}const We=[];for(const Le of j){const Qe=Le.trim();if(!Qe)continue;if(await Va(Qe)){f.error(`IMEI ${Qe} already exists in system`);continue}const ct=await $a(Me,{imei:Qe,serial_number:Qe,cost_price:B.costPrice||0,selling_price:B.sellingPrice||0,condition:"new",source:"purchase"});ct.success?We.push(Qe):f.error(`Failed to add IMEI ${Qe}: ${ct.error}`)}We.length>0&&f.success(`Added ${We.length} IMEI/Serial number(s) as child variants`)}const ne=m==="out"?-_:m==="set"?ve-(B.quantity||0):_,{error:Ue}=await pe.from("lats_stock_movements").insert({product_id:y.id,variant_id:B.id,movement_type:m==="set"?"adjustment":m,quantity:ne,reason:Z,notes:ie||`Stock ${m==="in"?"added":m==="out"?"removed":"set"}`,created_by:Pe,created_at:new Date().toISOString()});Ue&&(console.error("Error creating stock movement:",Ue),f.error("Failed to record stock movement")),te&&await te({variant:B,adjustmentType:m,quantity:_,reason:Z,notes:ie,imeis:j}),f.success("Stock adjustment completed successfully"),s==null||s()}catch(X){console.error("Stock adjustment error:",X),f.error("Failed to adjust stock")}finally{W(!1)}};if(!T||!y)return null;const de=_>0&&Z.length>0&&B!==null;return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[99999]",role:"dialog","aria-modal":"true",onClick:j=>{j.target===j.currentTarget&&(s==null||s())},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",onClick:j=>j.stopPropagation(),children:[e.jsx("button",{onClick:s,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(st,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(at,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Adjust Stock Level"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[y.name," - Select variant to adjust"]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[!B&&e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Select Variant"}),e.jsx("div",{className:"space-y-3",children:($=y.variants)==null?void 0:$.map(j=>e.jsx("div",{onClick:()=>be(j),className:"p-6 border-2 border-gray-300 rounded-xl cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-900 mb-1",children:j.name}),e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:["SKU: ",j.sku]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Current Stock"}),e.jsx("div",{className:"font-bold text-gray-900",children:j.quantity||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Min Level"}),e.jsx("div",{className:"font-bold text-gray-900",children:j.minQuantity||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Price"}),e.jsx("div",{className:"font-bold text-gray-900",children:D(j.sellingPrice||0)})]})]})]}),e.jsxs("div",{className:"ml-4",children:[ee(j.quantity||0)==="low"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 border border-red-200",children:[e.jsx(Ut,{className:"w-3 h-3"}),"Low Stock"]}),ee(j.quantity||0)==="normal"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200",children:[e.jsx(ms,{className:"w-3 h-3"}),"Normal"]})]})]})},j.id))})]}),B&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Current Stock"}),e.jsx("button",{onClick:()=>be(null),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Change Variant"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:B.quantity||0}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Current Stock"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-700",children:B.minQuantity||0}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Min Level"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-700",children:B.maxQuantity||"N/A"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Max Level"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-700",children:D(B.sellingPrice||0)}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Unit Price"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[v==="low"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 border border-red-200",children:[e.jsx(Ut,{className:"w-3 h-3"}),"Low Stock"]}),v==="high"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700 border border-orange-200",children:[e.jsx(Ut,{className:"w-3 h-3"}),"Overstocked"]}),v==="normal"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200",children:[e.jsx(ms,{className:"w-3 h-3"}),"Normal"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Adjustment Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adjustment Type *"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>z("in"),className:`px-4 py-3 rounded-xl border-2 font-semibold transition-all ${m==="in"?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-white text-gray-700 hover:border-green-300"}`,children:[e.jsx(Pt,{className:"w-5 h-5 mx-auto mb-1"}),"Stock In"]}),e.jsxs("button",{type:"button",onClick:()=>z("out"),className:`px-4 py-3 rounded-xl border-2 font-semibold transition-all ${m==="out"?"border-red-500 bg-red-50 text-red-700":"border-gray-300 bg-white text-gray-700 hover:border-red-300"}`,children:[e.jsx(ss,{className:"w-5 h-5 mx-auto mb-1"}),"Stock Out"]}),e.jsxs("button",{type:"button",onClick:()=>z("set"),className:`px-4 py-3 rounded-xl border-2 font-semibold transition-all ${m==="set"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-blue-300"}`,children:[e.jsx(zs,{className:"w-5 h-5 mx-auto mb-1"}),"Set Stock"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>J(Math.max(.01,(_||0)-1)),className:"w-12 h-12 flex items-center justify-center border-2 border-gray-300 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all font-bold text-gray-700 hover:text-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:_<=.01,children:e.jsx(ma,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",value:_||"",onChange:j=>J(parseFloat(j.target.value)||0),min:.01,step:.01,placeholder:"0",className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-xl font-bold bg-white text-center"}),e.jsx("button",{type:"button",onClick:()=>J((_||0)+1),className:"w-12 h-12 flex items-center justify-center border-2 border-gray-300 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all font-bold text-gray-700 hover:text-blue-700",children:e.jsx(Vt,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:m==="set"?"Set stock to this quantity":m==="in"?"Add to current stock":"Remove from current stock"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),e.jsxs("select",{value:Z,onChange:j=>he(j.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white",children:[e.jsx("option",{value:"",children:"Select reason"}),hr.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:ie,onChange:j=>F(j.target.value),rows:3,placeholder:"Additional notes about this adjustment",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white resize-none"})]}),m==="in"&&_>0&&e.jsxs("div",{className:"border-2 border-indigo-200 rounded-2xl bg-gradient-to-br from-indigo-50/80 to-purple-50/50 overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-indigo-100/50 transition-colors",onClick:()=>{const j=!a;r(j),j&&ce.length===0?xe(Array(_).fill("")):j||xe([""])},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${a?"bg-indigo-600 shadow-lg shadow-indigo-200":"bg-gray-200"}`,children:e.jsx($t,{className:`w-5 h-5 ${a?"text-white":"text-gray-500"}`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:"Track Individual Items"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Add IMEI/Serial numbers for each unit"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a&&ce.filter(j=>j.trim()).length>0&&e.jsxs("div",{className:"px-3 py-1.5 bg-indigo-600 text-white text-xs font-bold rounded-full shadow-md",children:[ce.filter(j=>j.trim()).length," item",ce.filter(j=>j.trim()).length!==1?"s":""]}),e.jsx("div",{className:`w-12 h-6 rounded-full transition-all duration-300 ${a?"bg-indigo-600":"bg-gray-300"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-300 mt-0.5 ${a?"translate-x-6":"translate-x-0.5"}`})})]})]})}),a&&e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-2",children:ce.map((j,X)=>e.jsxs("div",{className:"group relative flex items-center gap-2 p-2 bg-white rounded-xl border-2 border-gray-200 hover:border-indigo-300 transition-all shadow-sm hover:shadow-md",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center bg-indigo-100 rounded-lg text-xs font-bold text-indigo-700 flex-shrink-0",children:X+1}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Bt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:j,onChange:Pe=>ae(X,Pe.target.value),placeholder:`Enter IMEI or Serial #${X+1}`,className:"w-full pl-10 pr-10 py-2.5 border-0 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm text-gray-900 bg-transparent font-medium"}),j.trim()&&e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:e.jsx(Us,{className:"w-4 h-4 text-green-500"})})]})]},X))}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-indigo-100/50 rounded-xl border border-indigo-200",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-indigo-600 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(At,{className:"w-3 h-3 text-white"})}),e.jsx("p",{className:"text-xs text-indigo-800 leading-relaxed",children:"Each IMEI/Serial number will be created as a child variant. Stock quantity will be automatically calculated from the number of items added."})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Preview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Current Stock"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:B.quantity||0}),v==="low"&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 mt-2",children:"Low"}),v==="high"&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700 mt-2",children:"High"}),v==="normal"&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 mt-2",children:"Normal"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"New Stock"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:ve}),b==="low"&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 mt-2",children:"Low"}),b==="high"&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700 mt-2",children:"High"}),b==="normal"&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 mt-2",children:"Normal"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 pt-4 border-t border-gray-200",children:[m==="in"&&e.jsxs("span",{className:"text-sm font-semibold text-green-700",children:["+",_," units"]}),m==="out"&&e.jsxs("span",{className:"text-sm font-semibold text-red-700",children:["-",_," units"]}),m==="set"&&e.jsxs("span",{className:"text-sm font-semibold text-blue-700",children:["Set to ",_," units"]})]})]})]})]})]}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{type:"button",onClick:G,disabled:!de||u||U,className:"flex-1 px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg",children:u||U?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):"Apply Adjustment"}),e.jsx("button",{type:"button",onClick:s,disabled:u||U,className:"flex-1 sm:flex-none px-6 py-3.5 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})})]})})};Is.displayName="EnhancedStockAdjustModal";const gr=({isOpen:y,onClose:T,categories:s,onCategoryUpdate:te})=>{const[U,B]=n.useState(""),[be,m]=n.useState(!1),[z,_]=n.useState(null),[J,Z]=n.useState(!1),[he,ie]=n.useState(!1);Ta(),bs(y),n.useEffect(()=>{if(y){const r=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=r}}},[y]);const F=n.useMemo(()=>{let r=s.filter(u=>{var A;return!U||u.name.toLowerCase().includes(U.toLowerCase())||((A=u.description)==null?void 0:A.toLowerCase().includes(U.toLowerCase()))});return r.sort((u,W)=>u.sort_order!==W.sort_order?u.sort_order-W.sort_order:u.name.localeCompare(W.name)),r},[s,U]);if(!y)return null;const ce=r=>{_(r),Z(!0)},xe=async r=>{try{if(ie(!0),z){const{updateCategory:u}=await xt(()=>import("./index-61458a34.js").then(W=>W.bg),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);await u(z.id,r),f.success("Category updated successfully")}else{const{createCategory:u}=await xt(()=>import("./index-61458a34.js").then(W=>W.bg),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);await u(r),f.success("Category created successfully")}Z(!1),m(!1),_(null),te==null||te()}catch(u){console.error("Error saving category:",u),f.error("Failed to save category")}finally{ie(!1)}},a=r=>{ce(r)};return qt.createPortal(e.jsxs("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[70]",style:{top:0,left:0,right:0,bottom:0,overflow:"hidden",overscrollBehavior:"none"},role:"dialog","aria-modal":"true","aria-labelledby":"category-modal-title",onClick:r=>{r.target===r.currentTarget&&T()},children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:T,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(st,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(rs,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"category-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Manage Categories"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View, edit, and manage your product categories"})]})]})}),e.jsxs("div",{className:"p-6 pb-0 flex-shrink-0",children:[e.jsx("div",{className:"flex gap-3 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(us,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:U,onChange:r=>B(r.target.value),placeholder:"Search categories by name or description...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]})}),e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[F.length," of ",s.length," categories"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F.map(r=>e.jsxs("div",{onClick:()=>a(r),className:"bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-indigo-400 hover:shadow-lg transition-all duration-200 flex flex-col cursor-pointer",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 text-2xl",style:{backgroundColor:r.color?`${r.color}20`:"#EEF2FF"},children:r.icon||"üìÅ"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-bold text-gray-900 text-sm truncate",children:r.name}),r.is_active&&e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full flex-shrink-0"})]}),r.description&&e.jsx("p",{className:"text-xs text-gray-600 truncate",children:r.description})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-3 pb-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ua,{className:"w-4 h-4"}),e.jsxs("span",{children:["Products: ",e.jsx("strong",{children:r.productsCount||0})]})]}),r.color&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:r.color}})})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Order: ",r.sort_order]})]},r.id))}),F.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(rs,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No categories found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or create a new category"})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:e.jsxs("button",{onClick:()=>{_(null),m(!0),Z(!0)},className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition-colors font-semibold shadow-md hover:shadow-lg",children:[e.jsx(Vt,{className:"w-5 h-5"}),"Add New Category"]})})]}),J&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[80]",onClick:r=>r.stopPropagation(),children:e.jsx("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:e.jsx(qa,{category:z||void 0,parentCategories:s,onSubmit:xe,onCancel:()=>{Z(!1),m(!1),_(null)},loading:he})})})]}),document.body)},pr=({isOpen:y,onClose:T,onImportComplete:s})=>{const[te,U]=n.useState(null),[B,be]=n.useState([]),[m,z]=n.useState([]),[_,J]=n.useState(!1),[Z,he]=n.useState(!1),[ie,F]=n.useState("upload"),[ce,xe]=n.useState(0),[a,r]=n.useState([]),[u,W]=n.useState([]),[A,ve]=n.useState(!1),[ee,v]=n.useState([]),[b,D]=n.useState(!1),[ae,G]=n.useState(new Set),[de,$]=n.useState(0),[j,X]=n.useState(new Set),[Pe,we]=n.useState(new Set),[ne,Ue]=n.useState(!1),[Me,We]=n.useState("migrate"),[Le,Qe]=n.useState(!1),Te=n.useRef(null);n.useEffect(()=>{if(!y)return;const h=Ie=>{Ie.preventDefault(),Ie.stopPropagation()},V=Ie=>{h(Ie)},le=Ie=>{h(Ie)};return window.addEventListener("dragover",V,!1),window.addEventListener("drop",le,!1),()=>{window.removeEventListener("dragover",V,!1),window.removeEventListener("drop",le,!1)}},[y]),n.useEffect(()=>{ie==="preview"&&m.length>0&&de===null&&$(0)},[ie,m.length,de]);const ct=()=>{const h=A?ee:m,V=new Set(h.map((le,Ie)=>Ie));X(V)},Ze=()=>{X(new Set)},nt=h=>{const V=new Set(j);V.has(h)?V.delete(h):V.add(h),X(V)},tt=()=>{if(j.size===0){f.error("No products selected");return}if(!window.confirm(`Are you sure you want to delete ${j.size} product(s)?`))return;const h=A?ee:m,V=Array.from(j).sort((Ie,Re)=>Re-Ie),le=[...h];V.forEach(Ie=>{le.splice(Ie,1)}),A?(v(le),f.success(`Deleted ${j.size} product(s)`)):(z(le),f.success(`Deleted ${j.size} product(s)`)),X(new Set),de!==null&&V.includes(de)&&$(le.length>0?0:null)},rt=()=>{if(j.size===0){f.error("No products selected");return}const h=A?ee:m,V=Array.from(j).sort((Re,i)=>Re-i),le=[];V.forEach(Re=>{const i=h[Re],M=JSON.parse(JSON.stringify(i));M.name=`${M.name} (Copy)`,M.sku&&(M.sku=`${M.sku}-COPY`),le.push(M)});const Ie=[...h,...le];A?(v(Ie),f.success(`Duplicated ${j.size} product(s)`)):(z(Ie),f.success(`Duplicated ${j.size} product(s)`)),X(new Set)},Xe=()=>{window.confirm("Are you sure you want to reset all changes? This will restore the original preview data.")&&(v(JSON.parse(JSON.stringify(m))),X(new Set),f.success("Changes reset successfully"))},Ve=h=>{if(!h)return"new";const V=h.toLowerCase().trim();return{new:"new",used:"used",refurbished:"refurbished",refurb:"refurbished","like-new":"new",good:"used",excellent:"new",fair:"used",poor:"used",damaged:"used",broken:"used"}[V]||"new"},lt=(h,V)=>{const le=[];if((!h.name||h.name.trim().length<2)&&le.push("Product name must be at least 2 characters long"),h.variants&&h.variants.length>0){const Ie=new Set(h.variants.map(i=>i.variantSku).filter(Boolean)),Re=h.variants.some(i=>i.isParent||i.variantType==="parent"||i.variantSku===h.sku);h.variants.forEach((i,M)=>{var P;i.variantType==="imei_child"&&i.imei&&(/^\d{15}$/.test(i.imei)||le.push(`Variant ${M+1}: IMEI must be exactly 15 digits`)),i.parentVariantSku&&(Ie.has(i.parentVariantSku)||i.parentVariantSku===h.sku||Re||(P=h.variants)!=null&&P.some(N=>N.variantSku===i.parentVariantSku&&(N.isParent||N.variantType==="parent"))||i.parentVariantSku.startsWith(h.sku)||i.parentVariantSku===h.sku||le.push(`Variant ${M+1}: Parent variant SKU "${i.parentVariantSku}" not found in product variants`)),i.variantSellingPrice!==void 0&&i.variantSellingPrice<0&&le.push(`Variant ${M+1}: Selling price cannot be negative`),i.variantCostPrice!==void 0&&i.variantCostPrice<0&&le.push(`Variant ${M+1}: Cost price cannot be negative`),i.variantQuantity!==void 0&&i.variantQuantity<0&&le.push(`Variant ${M+1}: Quantity cannot be negative`)})}return h.price!==void 0&&h.price<0&&le.push("Price cannot be negative"),h.costPrice!==void 0&&h.costPrice<0&&le.push("Cost price cannot be negative"),le},Se=h=>{var le;const V=(le=h.target.files)==null?void 0:le[0];V&&(U(V),ft(V))},ht=h=>{h.preventDefault(),h.stopPropagation(),Qe(!0)},gt=h=>{h.preventDefault(),h.stopPropagation(),Qe(!1)},dt=h=>{h.preventDefault(),h.stopPropagation(),Qe(!1);const V=h.dataTransfer.files;if(V.length>0){const le=V[0],Ie=[".xlsx",".xls",".csv"],Re=le.name.toLowerCase().substring(le.name.lastIndexOf("."));Ie.includes(Re)?(U(le),ft(le)):f.error("Invalid file type. Please upload .xlsx, .xls, or .csv files only.")}},ft=async h=>{J(!0),W([]);try{const V=await xt(()=>import("./utils-ebb5cecb.js"),[]),{generateSKU:le}=await xt(()=>import("./skuUtils-60e0a165.js"),[]),Ie=await h.arrayBuffer(),Re=V.read(Ie,{type:"array"}),i=Re.SheetNames[0],M=Re.Sheets[i],P=V.utils.sheet_to_json(M,{header:1,defval:""});if(P.length<2)throw new Error("Excel file must contain at least a header row and one data row");const Y=P[0].map(t=>(t||"").toLowerCase().trim()),N=t=>{for(const l of t){const d=l.toLowerCase();let w=Y.findIndex(Q=>Q===d);if(w>=0||(w=Y.findIndex(Q=>Q.includes(d)),w>=0)||(w=Y.findIndex(Q=>d.includes(Q)),w>=0))return w}return-1},Ae=N(["product name","name","product"]),je=N(["product sku","sku","product_sku"]),Be=N(["description","desc"]),ke=N(["short description","short_description","short desc"]),ze=N(["barcode","product code","product_code","code"]),me=N(["category name","category","category_id","category id"]),De=N(["category id","category_id"]),c=N(["supplier name","supplier","supplier_id","supplier id"]),Je=N(["condition"]),Ne=N(["price","selling price","unit price","sale price"]),fe=N(["cost","cost price"]),R=N(["stock quantity","stock_quantity","quantity","total stock"]),Ce=N(["min stock level","min_stock_level","min stock","min_stock"]),ye=N(["max stock level","max_stock_level","max stock","max_stock"]),He=N(["reorder qty","reorder_quantity","reorder quantity","reorder qty"]),p=N(["tax rate","tax_rate","tax","vat rate","vat_rate"]),x=N(["brand"]),L=N(["model"]),K=N(["specification","spec","specs"]),I=N(["internal notes","internal_notes","notes","internal note"]),H=N(["status","is active","is_active","active"]),oe=N(["total value","total_value","value"]),Fe=N(["variant sku","variant_sku"]),Ye=N(["variant name","variant_name"]),qe=N(["variant barcode","variant_barcode"]),re=N(["variant type","variant_type","type"]),Ke=N(["is parent","is_parent","parent"]),g=N(["parent sku","parent_sku","parent variant sku","parent variant sku"]),o=N(["variant price","variant selling price","variant_selling_price"]),k=N(["variant cost","variant cost price","variant_cost_price"]),E=N(["variant quantity","variant_quantity","variant stock","variant_stock"]),C=N(["variant min quantity","variant_min_quantity","variant min stock"]),S=N(["variant weight","variant_weight","weight"]),q=N(["variant dimensions","variant_dimensions","dimensions"]),O=N(["variant is active","variant_is_active","variant active"]),se=N(["imei"]),_e=N(["serial","serial number","serial_number"]),Ge=new Map,$e=[];console.log("üîç Column indices found:",{name:Ae,sku:je,category:me,categoryId:De,supplier:c,price:Ne,cost:fe,stock:R,minStock:Ce,variantPrice:o,variantCost:k,variantQty:E}),console.log("üìã Headers:",Y);for(let t=1;t<P.length;t++){const l=P[t];if(!(!l||l.length===0))try{const d=(l[Ae]||"").toString().trim();if(!d){$e.push(`Row ${t+1}: Product name is required`);continue}const w=d;let Q=Ge.get(w);if(!Q){const Rt=me>=0?(l[me]||"").toString().trim():"",Zt=De>=0?(l[De]||"").toString().trim():"",fs=le();let is=!0;if(H>=0){const Nt=(l[H]||"").toString().trim().toLowerCase();is=Nt==="active"||Nt==="true"||Nt==="1"||Nt==="yes"||Nt===""}const Ot={};p>=0&&l[p]&&(Ot.taxRate=parseFloat(l[p])||0),He>=0&&l[He]&&(Ot.reorderQuantity=parseInt(l[He])||0),oe>=0&&l[oe]&&(Ot.totalValue=parseFloat(l[oe])||0);const St={};x>=0&&l[x]&&(St.brand=(l[x]||"").toString().trim()),L>=0&&l[L]&&(St.model=(l[L]||"").toString().trim());let Kt;if(K>=0&&l[K]){const Nt=(l[K]||"").toString().trim();Kt=Nt,St.specification=Nt}const Gt=Nt=>{if(!Nt)return 0;const Xs=Nt.toString().trim().replace(/[TSh\s,]/gi,"").replace(/[^\d.-]/g,""),As=parseFloat(Xs);return isNaN(As)?0:As},ys=Ne>=0?Gt(l[Ne]):0,ns=fe>=0?Gt(l[fe]):0,ls=R>=0&&parseInt((l[R]||"").toString().replace(/[^\d]/g,""))||0;Ne>=0&&l[Ne]&&console.log(`üí∞ [Import] Product "${d}" - Raw price: "${l[Ne]}", Parsed: ${ys}`),fe>=0&&l[fe]&&console.log(`üí∞ [Import] Product "${d}" - Raw cost: "${l[fe]}", Parsed: ${ns}`),Q={name:d,sku:fs,description:(l[Be]||"").toString().trim(),shortDescription:ke>=0?(l[ke]||"").toString().trim():void 0,specifications:Kt,barcode:ze>=0?(l[ze]||"").toString().trim():void 0,categoryId:Zt||void 0,categoryName:Rt||void 0,supplierName:(l[c]||"").toString().trim(),condition:Ve((l[Je]||"new").toString().trim()),price:ys,costPrice:ns,stockQuantity:ls,minStockLevel:parseInt((l[Ce]||"5").toString().replace(/[^\d]/g,""))||5,internalNotes:I>=0?(l[I]||"").toString().trim():void 0,isActive:is,variants:[],maxStockLevel:ye>=0&&parseInt((l[ye]||"").toString().replace(/[^\d]/g,""))||void 0,metadata:Object.keys(Ot).length>0?Ot:void 0,attributes:Object.keys(St).length>0?St:void 0},Ge.set(w,Q)}const ue=(l[Fe]||"").toString().trim(),ge=(l[Ye]||"").toString().trim(),ut=(l[qe]||"").toString().trim(),yt="parent",Ct=(l[se]||"").toString().trim(),Lt=(l[_e]||"").toString().trim(),Tt=l[S]?parseFloat(l[S]):void 0,wt=(l[q]||"").toString().trim(),kt=l[O]!==void 0?l[O]===!0||l[O]==="true"||l[O]==="TRUE"||l[O]==="Yes"||l[O]==="yes"||l[O]===1:!0;if(ue||ge||Ct||Lt||ut){const Rt=le(),Zt=(Kt,Gt=0)=>{if(!Kt&&Gt>0)return Gt;if(!Kt)return 0;const ns=Kt.toString().trim().replace(/[TSh\s,]/gi,"").replace(/[^\d.-]/g,""),ls=parseFloat(ns);return isNaN(ls)?Gt:ls},fs=k>=0?Zt(l[k],Q.costPrice):Q.costPrice,is=o>=0?Zt(l[o],Q.price):Q.price,Ot=E>=0&&parseInt((l[E]||"").toString().replace(/[^\d]/g,""))||0,St={variantSku:Rt,variantName:ge||void 0,variantBarcode:ut||void 0,variantType:"parent",isParent:!0,parentVariantSku:void 0,variantCostPrice:fs,variantSellingPrice:is,variantQuantity:Ot,variantMinQuantity:parseInt((l[C]||"5").toString().replace(/[^\d]/g,""))||5,variantIsActive:kt,weight:Tt,dimensions:wt||void 0};(Ct||Lt)&&(St.imei=Ct,St.serialNumber=Lt,St.variantAttributes=JSON.stringify({imei:Ct||null,serial_number:Lt||null})),Q.variants||(Q.variants=[]),Q.variants.push(St)}}catch(d){$e.push(`Row ${t+1}: ${d.message||"Unknown error"}`)}}const Oe=Array.from(Ge.values());$e.length>0&&(W($e),f.error(`Found ${$e.length} validation errors. Please review and fix them.`)),Oe.length>0?(z(Oe),F("preview"),f.success(`Successfully parsed ${Oe.length} products with variants from Excel file`)):f.error("No valid products found in the Excel file")}catch(V){console.error("Error processing file:",V),f.error(`Failed to process Excel file: ${V.message}`),W([V.message])}finally{J(!1)}},vt=async()=>{var M,P,Y,N,Ae,je,Be,ke,ze,me;he(!0),xe(0),F("import");const h=[],V=A&&ee.length>0?ee:m,le=V.length,{createProduct:Ie}=await xt(()=>import("./index-61458a34.js").then(De=>De.bf),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);let Re;try{const{data:{session:De},error:c}=await pe.auth.getSession();if(c){console.error("Session error:",c);const{data:fe,error:R}=await pe.auth.refreshSession();if(R||!fe.session){f.error("Session expired. Please log in again to import products"),he(!1);return}}const{data:{user:Je},error:Ne}=await pe.auth.getUser();if(Ne){console.error("User error:",Ne),f.error("Authentication error. Please log in again to import products"),he(!1);return}if(!Je){f.error("You must be logged in to import products. Please refresh the page and try again."),he(!1);return}Re=Je}catch(De){console.error("Auth check error:",De),f.error("Authentication failed. Please log in again to import products"),he(!1);return}for(let De=0;De<le;De++){const c=V[De],Je=lt(c);if(Je.length>0){h.push({success:!1,error:Je.join(", "),rowNumber:De+1}),xe((De+1)/le*100);continue}try{const Ne=localStorage.getItem("current_branch_id");console.log(`üîÑ [Import] Processing product "${c.name}" - Original SKU from Excel: "${c.sku||"N/A"}" (will be ignored)`);const{generateSKU:fe}=await xt(()=>import("./skuUtils-60e0a165.js"),[]);let R=fe(),Ce=!1,ye=0;const He=10;for(;ye<He;){const{data:g,error:o}=await pe.from("lats_products").select("id").eq("sku",R).maybeSingle();if(o&&o.code!=="PGRST116"&&console.warn("‚ö†Ô∏è [Import] Error checking SKU uniqueness:",o),!g){console.log(`‚úÖ [Import] Generated unique SKU for "${c.name}": "${R}"`);break}Ce=!0,console.log(`‚ö†Ô∏è [Import] SKU "${R}" exists, generating new one...`),R=fe(),ye++}ye>=He&&(R=`SKU-${Date.now()}-${Math.random().toString(36).substring(2,8).toUpperCase()}`,console.warn(`‚ö†Ô∏è [Import] Could not generate unique SKU after ${He} attempts, using fallback: "${R}"`)),console.log(`‚úÖ [Import] Final SKU for "${c.name}": "${R}" (original was "${c.sku||"N/A"}")`);let p=null,x=null;const{data:L}=await pe.from("lats_products").select("id, name, sku").eq("name",c.name.trim()).maybeSingle();if(L)p=L.id,x=L.name;else{const{data:g}=await pe.from("lats_products").select("id, name, sku").ilike("name",c.name.trim()).maybeSingle();g&&(p=g.id,x=g.name)}if(p){if(Me==="delete"){const{error:g}=await pe.from("lats_products").delete().eq("id",p);if(g)throw new Error(`Failed to delete existing product: ${g.message}`);console.log(`üóëÔ∏è Deleted existing product: ${x} (ID: ${p})`),p=null}else if(Me==="skip"){h.push({success:!1,error:`Product "${c.name}" already exists. Skipped.`,rowNumber:De+1}),xe((De+1)/le*100);continue}}let K=c.categoryId;if(K){const{data:g}=await pe.from("lats_categories").select("id").eq("id",K).maybeSingle();g||(console.warn(`‚ö†Ô∏è Category ID "${K}" not found, will try to use category name or create new one`),K=void 0)}if(!K&&c.categoryName){const g=c.categoryName.trim(),{data:o}=await pe.from("lats_categories").select("id").eq("name",g).maybeSingle();if(o)K=o.id;else{const{data:k}=await pe.from("lats_categories").select("id").ilike("name",g).maybeSingle();if(k)K=k.id;else{console.log(`üì¶ Auto-creating category: "${g}"`);const{data:E,error:C}=await pe.from("lats_categories").insert({name:g,description:"Auto-created during product import",branch_id:Ne,is_active:!0}).select("id").single();if(C)throw console.error("Error creating category:",C),new Error(`Failed to create category "${g}": ${C.message}`);E&&(K=E.id,console.log(`‚úÖ Created category "${g}" with ID: ${K}`))}}}if(!K){console.log('üì¶ No category provided, using or creating "Uncategorized"');const{data:g}=await pe.from("lats_categories").select("id").eq("name","Uncategorized").maybeSingle();if(g)K=g.id;else{const{data:o,error:k}=await pe.from("lats_categories").insert({name:"Uncategorized",description:"Default category for products without a category",branch_id:Ne,is_active:!0}).select("id").single();if(k)throw new Error(`Failed to create default category: ${k.message}`);o&&(K=o.id)}}let I=c.supplierId;if(!I&&c.supplierName){const g=c.supplierName.trim(),{data:o}=await pe.from("lats_suppliers").select("id").ilike("name",g).maybeSingle();if(o)I=o.id;else{console.log(`üè¢ Auto-creating supplier: "${g}"`);const{data:k,error:E}=await pe.from("lats_suppliers").insert({name:g,description:"Auto-created during product import",branch_id:Ne,is_active:!0,is_shared:!0}).select("id").single();E?(console.warn("‚ö†Ô∏è Failed to create supplier, continuing without supplier:",E.message),I=void 0):k&&(I=k.id,console.log(`‚úÖ Created supplier "${g}" with ID: ${I}`))}}const H=[],oe=new Map;if(c.variants&&c.variants.length>0){const g=new Set;c.variants.forEach(o=>{o.parentVariantSku&&g.add(o.parentVariantSku)});for(const o of c.variants)if(o.variantType==="parent"||o.isParent){const k=o.variantSku||c.sku;H.push({sku:k,name:o.variantName||"Parent Variant",sellingPrice:o.variantSellingPrice||c.price||0,costPrice:o.variantCostPrice||c.costPrice||0,quantity:o.variantQuantity||0,minQuantity:o.variantMinQuantity||5,attributes:o.variantAttributes?JSON.parse(o.variantAttributes):{},isParent:!0,variantType:"parent"}),oe.set(k,"pending")}for(const o of Array.from(g))if(!oe.has(o)){const k=o===c.sku;!c.variants.some(C=>C.variantSku===o&&(C.isParent||C.variantType==="parent"))&&(k||o.startsWith(c.sku))&&(H.push({sku:o,name:"Parent Variant",sellingPrice:c.price||0,costPrice:c.costPrice||0,quantity:0,minQuantity:5,attributes:{},isParent:!0,variantType:"parent"}),oe.set(o,"pending"))}for(const o of c.variants)if(o.variantType!=="parent"&&!o.isParent){let k;o.parentVariantSku&&(k=oe.get(o.parentVariantSku),!k&&o.parentVariantSku===c.sku&&H.find(S=>S.isParent&&S.sku===c.sku)&&(k=oe.get(c.sku)));const E=o.variantAttributes?JSON.parse(o.variantAttributes):{};o.imei&&(E.imei=o.imei),o.serialNumber&&(E.serial_number=o.serialNumber),H.push({sku:o.variantSku||`${c.sku}-CHILD-${H.length+1}`,name:o.variantName||(o.imei?`IMEI: ${o.imei}`:"Child Variant"),sellingPrice:o.variantSellingPrice||c.price||0,costPrice:o.variantCostPrice||c.costPrice||0,quantity:o.variantQuantity||0,minQuantity:o.variantMinQuantity||5,attributes:E,variantType:o.variantType||"standard",parentVariantId:k})}}if(H.length>0){const g=H.map(S=>{var q;return(q=S.name)==null?void 0:q.toLowerCase().trim()}).filter(Boolean),o=new Set(g);if(g.length!==o.size){const S=g.find((q,O)=>g.indexOf(q)!==O);throw new Error(`Duplicate variant name "${S}" found in product "${c.name}". Each variant must have a unique name.`)}const k=[];for(const S of H){const q=((M=S.attributes)==null?void 0:M.imei)||((P=S.attributes)==null?void 0:P.serial_number);q&&typeof q=="string"&&q.trim()&&k.push(q.trim())}const E=new Set,C=[];for(const S of k){const q=S.toLowerCase();E.has(q)?C.push(S):E.add(q)}if(C.length>0)throw new Error(`Duplicate IMEI/Serial numbers found in product "${c.name}": ${C.join(", ")}. Each item must be unique.`)}if(H.length>0){const g=new Set,{generateSKU:o}=await xt(()=>import("./skuUtils-60e0a165.js"),[]);for(let k=0;k<H.length;k++){const E=H[k];let C=E.sku;if(!C||g.has(C)){C=o();let S=0;const q=10;for(;S<q&&(g.has(C)||!C);){const{data:O}=await pe.from("lats_product_variants").select("sku").eq("sku",C).maybeSingle();if(!O&&!g.has(C))break;C=o(),S++}(S>=q||g.has(C))&&(C=`SKU-${Date.now()}-${k}-${Math.random().toString(36).substring(2,8).toUpperCase()}`)}else{const{data:S}=await pe.from("lats_product_variants").select("sku").eq("sku",C).maybeSingle();if(S){C=o();let q=0;const O=10;for(;q<O&&(g.has(C)||!C);){const{data:se}=await pe.from("lats_product_variants").select("sku").eq("sku",C).maybeSingle();if(!se&&!g.has(C))break;C=o(),q++}(q>=O||g.has(C))&&(C=`SKU-${Date.now()}-${k}-${Math.random().toString(36).substring(2,8).toUpperCase()}`)}}E.sku=C,g.add(C),(oe.has(E.sku)||oe.has(C))&&oe.set(C,oe.get(E.sku)||oe.get(C)||"pending")}console.log(`‚úÖ [Import] Ensured ${H.length} variant SKUs are unique`)}console.log(`üì¶ [Import] Creating product "${c.name}" with SKU: "${R}"`);const Fe=c.specifications||((Y=c.attributes)==null?void 0:Y.specification)||"",Ye={};c.attributes&&Object.keys(c.attributes).length>0&&Object.assign(Ye,c.attributes),Fe&&(Ye.specification=Fe);let qe={name:c.name,sku:R,description:c.description,shortDescription:c.shortDescription,categoryId:K,supplierId:I,barcode:c.barcode,costPrice:c.costPrice||0,sellingPrice:c.price||0,quantity:c.stockQuantity||0,minQuantity:c.minStockLevel||5,isActive:c.isActive!==!1,variants:H.length>0?H:void 0};Fe&&(qe.specification=Fe),c.maxStockLevel!==void 0&&(qe.maxStockLevel=c.maxStockLevel),c.internalNotes&&(qe.internalNotes=c.internalNotes),c.metadata&&Object.keys(c.metadata).length>0&&(qe.metadata=c.metadata),Object.keys(Ye).length>0&&(qe.attributes=Ye);let re=null;const Ke=p!==null&&Me==="migrate";try{if(Ke){const{updateProduct:g}=await xt(()=>import("./index-61458a34.js").then(o=>o.bf),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);re=await g(p,qe,Re.id),console.log(`‚úÖ Migrated/Updated existing product: ${c.name} (ID: ${p})`)}else re=await Ie(qe,Re.id),console.log(Ce?`‚úÖ Created new product with auto-generated SKU: ${c.name} (SKU: ${R})`:`‚úÖ Created new product: ${c.name}`)}catch(g){if(g.code==="23505"&&(((N=g.message)==null?void 0:N.includes("sku"))||((Ae=g.message)==null?void 0:Ae.includes("SKU"))||((je=g.message)==null?void 0:je.includes("duplicate key"))||((Be=g.message)==null?void 0:Be.includes("lats_product_variants_sku_key")))){if(console.warn("‚ö†Ô∏è SKU conflict during creation, generating new SKUs and retrying:",g),(((ke=g.message)==null?void 0:ke.includes("lats_product_variants_sku_key"))||((ze=g.message)==null?void 0:ze.includes("product_variants")))&&qe.variants&&qe.variants.length>0){const{generateSKU:E}=await xt(()=>import("./skuUtils-60e0a165.js"),[]),C=new Set;for(let S=0;S<qe.variants.length;S++){const q=qe.variants[S];let O=E(),se=0;const _e=10;for(;se<_e;){if(!C.has(O)){const{data:Ge}=await pe.from("lats_product_variants").select("sku").eq("sku",O).maybeSingle();if(!Ge){C.add(O),q.sku=O;break}}O=E(),se++}(se>=_e||C.has(O))&&(q.sku=`SKU-${Date.now()}-${S}-${Math.random().toString(36).substring(2,8).toUpperCase()}`,C.add(q.sku))}console.log(`‚úÖ Regenerated ${qe.variants.length} variant SKUs to resolve conflicts`)}else{const{generateSKU:E}=await xt(()=>import("./skuUtils-60e0a165.js"),[]);let C=E(),S=0,q=!1;for(;S<10&&!q;){const{data:O}=await pe.from("lats_products").select("id").eq("sku",C).maybeSingle();O?(S++,C=E()):(q=!0,qe.sku=C)}if(!q)throw new Error("Could not generate unique product SKU after multiple attempts. Please try again.")}try{re=await Ie(qe,Re.id),console.log("‚úÖ Resolved SKU conflict and successfully created product")}catch(E){throw console.error("‚ùå Retry after SKU conflict resolution also failed:",E),g}}else throw g}if(c.variants&&c.variants.length>0){const{data:g}=await pe.from("lats_product_variants").select("id, sku, variant_type, is_parent").eq("product_id",re.id);if(g){g.forEach(o=>{oe.set(o.sku,o.id)});for(const o of c.variants)if(o.parentVariantSku&&o.variantSku){let k=oe.get(o.parentVariantSku);if(!k&&o.parentVariantSku===c.sku){const C=g.find(S=>(S.is_parent||S.variant_type==="parent")&&(S.sku===c.sku||S.sku.startsWith(c.sku)));C&&(k=C.id)}const E=oe.get(o.variantSku);k&&E?await pe.from("lats_product_variants").update({parent_variant_id:k}).eq("id",E):o.parentVariantSku&&!k&&console.warn(`Parent variant SKU "${o.parentVariantSku}" not found for child "${o.variantSku}"`)}}}h.push({success:!0,product:re,rowNumber:De+1,wasUpdated:Ke})}catch(Ne){let fe=Ne.message||"Failed to import product";Ne.code==="23505"&&((me=Ne.message)!=null&&me.includes("sku")?fe="SKU conflict: The system attempted to auto-generate a unique SKU but encountered an issue. Please try again.":fe=`Database constraint error: ${Ne.message}`),h.push({success:!1,error:fe,rowNumber:De+1})}xe((De+1)/le*100),await new Promise(Ne=>setTimeout(Ne,50))}r(h),he(!1);const i=h.filter(De=>De.success);if(i.length>0){const De=i.map(fe=>fe.product).filter(Boolean);s(De);const c=h.filter(fe=>fe.success&&fe.wasUpdated).length,Je=i.length-c;let Ne=`Successfully imported ${i.length} product${i.length!==1?"s":""}`;c>0&&Je>0?Ne+=` (${c} updated, ${Je} created)`:c>0&&(Ne+=` (${c} updated)`),Ne+=" with variants",f.success(Ne)}else f.error("No products were imported successfully")},et=()=>{U(null),be([]),z([]),v([]),F("upload"),xe(0),r([]),W([]),J(!1),he(!1),ve(!1),D(!1),G(new Set),$(0),X(new Set),we(new Set),Ue(!1),We("migrate"),Te.current&&(Te.current.value=""),T()},mt=async()=>{try{const h=await xt(()=>import("./utils-ebb5cecb.js"),[]),V=h.utils.book_new(),Re=[["Product Name","Category Name","Supplier Name","Price","Cost Price","Stock Quantity","Min Stock Level","Specification","Variant Name","Variant Quantity","Variant Min Quantity"],...[["iPhone 14 Pro","Smartphones","Apple Supplier","1200000","1000000","50","10",'128GB Storage, 6.1" Display',"128GB Storage","50","10"],["iPhone 12","Smartphones","Apple Supplier","1000000","800000","30","5","128GB Storage","128GB Storage","30","5"],["iPhone 12","Smartphones","","1000000","800000","25","5","256GB Storage","256GB Storage","25","5"],["USB Cable","Accessories","Cable Supplier","5000","3000","100","20","1 meter length","","",""]]],i=h.utils.aoa_to_sheet(Re);i["!cols"]=[{wch:20},{wch:18},{wch:18},{wch:12},{wch:12},{wch:12},{wch:12},{wch:25},{wch:20},{wch:15},{wch:15}],h.utils.book_append_sheet(V,i,"Products"),h.writeFile(V,"product_import_template_with_variants.xlsx"),f.success("Template downloaded successfully!")}catch(h){console.error("Error creating template:",h),f.error("Failed to create template file")}};if(n.useEffect(()=>(y?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[y]),!y)return null;const ot=a.filter(h=>h.success).length,pt=a.filter(h=>!h.success).length,it=a.length;return qt.createPortal(e.jsx("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[99999]",style:{top:0,left:0,right:0,bottom:0},role:"dialog","aria-modal":"true","aria-labelledby":"import-modal-title",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:et,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(st,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Qs,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"import-modal-title",className:"text-2xl font-bold text-gray-900 mb-3",children:"Import Products from Excel"}),ie==="import"&&e.jsxs("div",{className:"flex items-center gap-4",children:[ot>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(jt,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-bold text-green-700",children:[ot," Success"]})]}),pt>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ut,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{className:"text-sm font-bold text-red-700",children:[pt," Failed"]})]}),Z&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm font-bold text-blue-700",children:[Math.round(ce),"%"]})]})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:[ie==="upload"&&e.jsx("div",{className:"py-6 space-y-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{onDragOver:ht,onDragLeave:gt,onDrop:dt,className:`
                      relative border-2 border-dashed rounded-2xl p-8 mb-6 transition-all
                      ${Le?"border-blue-500 bg-blue-50 scale-[1.02]":"border-gray-300 bg-gray-50 hover:border-gray-400 hover:bg-gray-100"}
                      ${_?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                    `,onClick:()=>{var h;return!_&&((h=Te.current)==null?void 0:h.click())},children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center transition-all ${Le?"bg-blue-100 scale-110":"bg-blue-100"}`,children:e.jsx(at,{className:"w-10 h-10 transition-colors text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:Le?"Drop your file here":"Upload Excel File"}),e.jsx("p",{className:"text-gray-600",children:Le?"Release to upload your file":"Drag and drop your file here, or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Supports .xlsx, .xls, or .csv files"})]}),!Le&&e.jsxs("div",{className:"flex gap-4 justify-center mt-2",children:[e.jsxs("button",{onClick:h=>{var V;h.stopPropagation(),(V=Te.current)==null||V.click()},disabled:_,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl",children:[e.jsx(Bs,{className:"w-5 h-5"}),_?"Processing...":"Choose File"]}),e.jsxs("button",{onClick:h=>{h.stopPropagation(),mt()},className:"flex items-center gap-2 px-6 py-3 bg-white hover:bg-gray-50 text-gray-700 border-2 border-gray-300 rounded-xl font-semibold transition-all shadow-sm hover:shadow-md",children:[e.jsx(Ht,{className:"w-5 h-5"}),"Download Template"]})]})]}),_&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 rounded-2xl flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-gray-700 font-medium",children:"Processing file..."})]})})]}),e.jsx("input",{ref:Te,type:"file",accept:".xlsx,.xls,.csv",onChange:Se,className:"hidden"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(At,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3",children:"Import Guidelines"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"‚Ä¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Required fields:"})," Product Name, Category Name, Price, Cost Price, Stock Quantity, Min Stock Level"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"‚Ä¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Optional fields:"}),' Supplier Name (will be auto-created if provided), Description, Condition (defaults to "new")']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"‚Ä¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Auto-generated:"})," All SKUs (Product SKU and Variant SKU) are automatically generated. Barcode is auto-generated. No need to provide SKUs!"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"‚Ä¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Variants:"}),' Variant Name, Variant Quantity, Variant Min Quantity. All variants are automatically set as "parent" type with no parent relationships.']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"‚Ä¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"IMEI Tracking:"})," For IMEI children, include 15-digit IMEI number"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"‚Ä¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Prices:"})," Should be in Tanzanian Shillings (TZS)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"‚Ä¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Template:"})," Download template for complete field list and examples"]})]})]})]})]})})]})}),ie==="preview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 pb-0 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(Yt,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-bold text-blue-700",children:[m.length," Product",m.length!==1?"s":""]})]}),A&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(It,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-sm font-bold text-yellow-700",children:"Edit Mode"})]}),j.size>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx(cs,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm font-bold text-purple-700",children:[j.size," Selected"]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:()=>{const h=!A;h?(ee.length===0&&m.length>0&&v(JSON.parse(JSON.stringify(m))),ve(!0)):(ee.length>0&&z(JSON.parse(JSON.stringify(ee))),ve(!1)),h||X(new Set)},className:`px-4 py-2 text-sm rounded-xl transition-all font-semibold shadow-lg flex items-center gap-2 ${A?"bg-yellow-500 hover:bg-yellow-600 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:A?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"w-4 h-4"}),"View Mode"]}):e.jsxs(e.Fragment,{children:[e.jsx(It,{className:"w-4 h-4"}),"Edit Mode"]})})})]}),A&&e.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:ct,className:"px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-colors shadow-sm flex items-center gap-2",children:[e.jsx(cs,{className:"w-4 h-4"}),"Select All"]}),e.jsxs("button",{onClick:Ze,className:"px-3 py-1.5 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-semibold transition-colors shadow-sm flex items-center gap-2",children:[e.jsx(Ms,{className:"w-4 h-4"}),"Select None"]})]}),j.size>0&&e.jsxs("span",{className:"px-3 py-1.5 bg-blue-100 text-blue-800 rounded-lg text-sm font-bold border border-blue-300",children:[j.size," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[j.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:rt,className:"px-3 py-1.5 text-sm bg-green-600 hover:bg-green-700 text-white rounded-xl font-semibold transition-colors shadow-sm flex items-center gap-2",children:[e.jsx(Ps,{className:"w-4 h-4"}),"Duplicate (",j.size,")"]}),e.jsxs("button",{onClick:tt,className:"px-3 py-1.5 text-sm bg-red-600 hover:bg-red-700 text-white rounded-xl font-semibold transition-colors shadow-sm flex items-center gap-2",children:[e.jsx(ps,{className:"w-4 h-4"}),"Delete (",j.size,")"]})]}),e.jsxs("button",{onClick:Xe,className:"px-3 py-1.5 text-sm bg-orange-600 hover:bg-orange-700 text-white rounded-xl font-semibold transition-colors shadow-sm flex items-center gap-2",children:[e.jsx(xa,{className:"w-4 h-4"}),"Reset Changes"]})]})]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 whitespace-nowrap",children:"If Product Name Exists:"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflictResolution",value:"migrate",checked:Me==="migrate",onChange:h=>We(h.target.value),className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Migrate/Update"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflictResolution",value:"skip",checked:Me==="skip",onChange:h=>We(h.target.value),className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Skip"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflictResolution",value:"delete",checked:Me==="delete",onChange:h=>We(h.target.value),className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Delete & Replace"})]})]})]}),u.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ut,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-2",children:[u.length," Validation Error",u.length!==1?"s":""]}),e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:u.map((h,V)=>e.jsx("div",{className:"text-sm text-red-800 bg-white rounded p-2 border border-red-200",children:h},V))})]})]})}),A&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Edit Mode:"})," You are viewing editable data. Changes will be saved when you import."]})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsx("div",{className:"space-y-4 py-4",children:(A?ee:m).map((h,V)=>{var Re,i;const le=de===V,Ie=j.has(V);return e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${le?"border-blue-500 shadow-xl":Ie&&A?"border-blue-400 bg-blue-50 shadow-md":A?"border-yellow-300 hover:border-yellow-400 hover:shadow-md":"border-gray-200 hover:border-blue-300 hover:shadow-md"}`,children:[e.jsx("div",{className:"flex items-start justify-between p-6 cursor-pointer",onClick:()=>$(le?null:V),children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[A&&e.jsx("div",{className:"flex-shrink-0 mt-1",onClick:M=>{M.stopPropagation(),nt(V)},children:Ie?e.jsx(cs,{className:"w-6 h-6 text-blue-600 cursor-pointer hover:text-blue-700 transition-colors"}):e.jsx(Ms,{className:"w-6 h-6 text-gray-400 cursor-pointer hover:text-gray-500 transition-colors"})}),e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${le?"bg-blue-500":"bg-gray-200"}`,children:e.jsx("svg",{className:`w-4 h-4 text-white transition-transform duration-200 ${le?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[A&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs font-semibold rounded",children:"Editable"}),A?e.jsx("input",{type:"text",value:h.name||"",onChange:M=>{M.stopPropagation();const P=[...ee];P[V].name=M.target.value,v(P)},onClick:M=>M.stopPropagation(),className:"text-lg font-bold text-gray-900 border-2 border-gray-300 rounded-lg px-3 py-1 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"Product Name"}):e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:h.name}),e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-bold ${h.isActive!==!1?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:h.isActive!==!1?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-white rounded-md border border-gray-200 shadow-xs",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-400 uppercase tracking-wider",children:"SKU"}),e.jsx("span",{className:"font-mono text-xs text-gray-700 font-semibold",children:h.sku})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-white rounded-md border border-gray-200 shadow-xs",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-400 uppercase tracking-wider",children:"Category"}),e.jsx("span",{className:"text-xs text-gray-700 font-semibold",children:h.categoryName||h.categoryId||"N/A"})]}),h.stockQuantity!==void 0&&e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-md border shadow-xs ${h.stockQuantity>=(h.minStockLevel||5)?"bg-green-50 border-green-200":"bg-orange-50 border-orange-200"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${h.stockQuantity>=(h.minStockLevel||5)?"bg-green-500":"bg-orange-500"}`}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`text-[10px] font-semibold uppercase tracking-wider ${h.stockQuantity>=(h.minStockLevel||5)?"text-green-700":"text-orange-700"}`,children:"Stock"}),e.jsx("span",{className:`text-sm font-bold ${h.stockQuantity>=(h.minStockLevel||5)?"text-green-800":"text-orange-800"}`,children:h.stockQuantity})]})]}),!A&&h.price&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-emerald-50 rounded-md border border-emerald-200 shadow-xs",children:[e.jsx("span",{className:"text-[10px] font-medium text-emerald-600 uppercase tracking-wider",children:"Price"}),e.jsxs("span",{className:"text-xs text-emerald-700 font-bold",children:[h.price.toLocaleString()," TZS"]})]})]})]})]})}),le&&e.jsxs("div",{className:"px-6 pb-6",children:[A&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Price:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:h.price||"",onChange:M=>{const P=[...ee];P[V].price=parseFloat(M.target.value)||0,v(P)},className:"flex-1 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500 text-gray-800",placeholder:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 text-sm",children:"TZS"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cost Price:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:h.costPrice||"",onChange:M=>{const P=[...ee];P[V].costPrice=parseFloat(M.target.value)||0,v(P)},className:"flex-1 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500 text-gray-800",placeholder:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 text-sm",children:"TZS"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity:"}),e.jsx("input",{type:"number",value:h.stockQuantity||"",onChange:M=>{const P=[...ee];P[V].stockQuantity=parseInt(M.target.value)||0,v(P)},className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500 text-gray-800",placeholder:"0",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Min Stock:"}),e.jsx("input",{type:"number",value:h.minStockLevel||"",onChange:M=>{const P=[...ee];P[V].minStockLevel=parseInt(M.target.value)||0,v(P)},className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500 text-gray-800",placeholder:"0",min:"0"})]})]}),(h.description||A)&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description:"}),A?e.jsx("textarea",{value:h.description||"",onChange:M=>{const P=[...ee];P[V].description=M.target.value,v(P)},className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500 text-sm text-gray-800",placeholder:"Product description",rows:2}):e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 rounded-lg p-3 border border-gray-200",children:h.description||"No description"})]}),(h.specifications||((Re=h.attributes)==null?void 0:Re.specification)||A)&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx("div",{className:"w-1 h-4 bg-gradient-to-b from-blue-500 to-purple-500 rounded-full"}),e.jsx("label",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Specifications"})]}),A?e.jsx("textarea",{value:h.specifications||((i=h.attributes)==null?void 0:i.specification)||"",onChange:M=>{const P=[...ee];P[V].specifications=M.target.value,P[V].attributes||(P[V].attributes={}),P[V].attributes.specification=M.target.value,v(P)},className:"w-full border border-gray-200 rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-300 text-sm text-gray-800 bg-white transition-all",placeholder:"Enter specifications separated by commas (e.g., 128GB, 8GB RAM, 6.1 inch)",rows:2}):e.jsx("div",{className:"px-3 py-2.5 bg-gradient-to-br from-gray-50 to-blue-50/30 rounded-lg border border-gray-200",children:(()=>{var Be;const P=(h.specifications||((Be=h.attributes)==null?void 0:Be.specification)||"").toString().split(",").map(ke=>ke.trim()).filter(ke=>ke),Y=Pe.has(V),N=4,Ae=Y?P:P.slice(0,N),je=P.length>N;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[Ae.map((ke,ze)=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-white rounded-md border border-gray-200 text-gray-700 text-xs font-medium shadow-xs",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full"}),ke]},ze)),je&&e.jsx("button",{onClick:ke=>{ke.stopPropagation();const ze=new Set(Pe);Y?ze.delete(V):ze.add(V),we(ze)},className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-50 rounded-md border border-blue-200 text-blue-600 text-xs font-medium shadow-xs hover:bg-blue-100 hover:border-blue-300 transition-colors cursor-pointer",children:Y?e.jsx(e.Fragment,{children:e.jsx("span",{children:"See Less"})}):e.jsx(e.Fragment,{children:e.jsxs("span",{children:["+",P.length-N," more"]})})})]})})})()})]}),h.variants&&h.variants.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(at,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"text-base font-semibold text-gray-900",children:[h.variants.length," Variant",h.variants.length>1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 w-full",children:(()=>{const M=h.variants.filter(N=>N.variantType==="parent"||N.isParent||!N.parentVariantSku),P=h.variants.filter(N=>N.variantType==="imei_child"&&N.parentVariantSku),Y=new Map;return P.forEach(N=>{const Ae=N.parentVariantSku||h.sku;Y.has(Ae)||Y.set(Ae,[]),Y.get(Ae).push(N)}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-purple-600",children:[e.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),e.jsx("polyline",{points:"2 17 12 22 22 17"}),e.jsx("polyline",{points:"2 12 12 17 22 12"})]}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variants"})]}),e.jsxs("div",{className:"space-y-2",children:[M.map((N,Ae)=>{const je=`${h.sku}-${N.variantSku||Ae}`,Be=ae.has(je),ke=Y.get(N.variantSku||h.sku)||[],ze=ke.length>0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer w-full",onClick:ze?()=>{const me=new Set(ae);Be?me.delete(je):me.add(je),G(me)}:void 0,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${N.variantType==="parent"?"bg-purple-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:N.variantName||N.variantSku||`Variant ${Ae+1}`}),ze&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-700",children:[ke.length," device",ke.length>1?"s":""]})]}),e.jsx("div",{className:"flex items-center gap-3 text-sm",children:N.variantSellingPrice&&N.variantSellingPrice!==0&&e.jsxs("span",{className:"font-semibold text-gray-900",children:["TSh¬†",N.variantSellingPrice.toLocaleString()]})})]}),ze&&Be&&e.jsx("div",{className:"ml-6 mt-2 space-y-1",children:ke.map((me,De)=>e.jsxs("div",{className:"flex justify-between items-center py-1.5 px-2 bg-blue-50 rounded-md border border-blue-100 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:me.variantName||me.variantSku||`Device ${De+1}`}),me.imei&&e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 text-green-700",children:["IMEI: ",me.imei]}),me.serialNumber&&e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-600",children:["SN: ",me.serialNumber]})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs",children:me.variantSellingPrice&&me.variantSellingPrice!==0&&e.jsxs("span",{className:"font-semibold text-green-600",children:["TSh¬†",me.variantSellingPrice.toLocaleString()]})})]},De))})]},Ae)}),P.filter(N=>{const Ae=N.parentVariantSku||h.sku;return!M.some(je=>(je.variantSku||h.sku)===Ae)}).map((N,Ae)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-orange-50 rounded-lg border border-orange-200 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:N.variantName||N.variantSku||`Variant ${Ae+1}`}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-700",children:"IMEI Device"}),N.parentVariantSku&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-600",children:["Parent: ",N.parentVariantSku]}),N.imei&&e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 text-green-700",children:["IMEI: ",N.imei]})]}),e.jsx("div",{className:"flex items-center gap-2 text-sm",children:N.variantSellingPrice&&N.variantSellingPrice!==0&&e.jsxs("span",{className:"font-semibold text-gray-900",children:["TSh¬†",N.variantSellingPrice.toLocaleString()]})})]},`orphan-${Ae}`))]})]})})()})]})]})]},V)})})})]}),ie==="import"&&e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Import Results"}),Z&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-semibold text-blue-900",children:"Importing products..."}),e.jsxs("span",{className:"text-xl font-bold text-blue-700",children:[Math.round(ce),"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-full rounded-full transition-all duration-300 shadow-sm",style:{width:`${ce}%`}})})]})}),!Z&&it>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(jt,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-900",children:ot}),e.jsx("p",{className:"text-sm font-semibold text-green-700",children:"Successful"})]})]})}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ut,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-900",children:pt}),e.jsx("p",{className:"text-sm font-semibold text-red-700",children:"Failed"})]})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yt,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:it}),e.jsx("p",{className:"text-sm font-semibold text-blue-700",children:"Total"})]})]})})]}),pt>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6",children:[e.jsxs("h4",{className:"font-bold text-red-900 mb-4 flex items-center gap-2",children:[e.jsx(Ut,{className:"w-5 h-5"}),"Failed Imports"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:a.filter(h=>!h.success).map((h,V)=>e.jsxs("div",{className:"text-sm text-red-800 bg-white rounded-lg p-3 border border-red-200",children:[e.jsxs("strong",{children:["Row ",h.rowNumber,":"]})," ",h.error]},V))})]})]})]})]}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3 justify-end",children:[ie==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>F("upload"),className:"px-6 py-3 bg-white hover:bg-gray-50 text-gray-700 border-2 border-gray-300 rounded-xl font-semibold transition-all shadow-sm hover:shadow-md",children:"Back"}),e.jsx("button",{type:"button",onClick:vt,disabled:Z||m.length===0,className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl",children:Z?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Importing..."]}):"Import Products"})]}),ie==="import"&&!Z&&e.jsx("button",{type:"button",onClick:et,className:"px-6 py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all shadow-lg hover:shadow-xl",children:"Close"})]})})]})}),document.body)},br=()=>{const[y,T]=n.useState(!1),[s,te]=n.useState(0),U=async()=>{T(!0),te(0);try{f.loading("Preparing product data for export...",{id:"export"}),te(20);const{data:B,error:be}=await pe.from("lats_products").select(`
          *,
          category:lats_categories!category_id(name, description, color),
          supplier:lats_suppliers!supplier_id(name, contact_person, email, phone, address, website_url, notes),
          variants:lats_product_variants!product_id(
            *,
            parent_variant:lats_product_variants!parent_variant_id(id, sku, name, variant_name)
          )
        `).order("name");if(be)throw new Error(`Failed to fetch products: ${be.message}`);te(40),f.loading("Processing product data...",{id:"export"});const m=[];B==null||B.forEach(a=>{const r=a.category,u=a.supplier,W=a.variants;let A=[];Array.isArray(W)?A=W:W&&typeof W=="object"?A=[W]:A=[];const ve=A.length>0?A.reduce((v,b)=>(b.quantity||0)>(v.quantity||0)?b:v):null,ee=Array.isArray(A)&&A.length>0?A.reduce((v,b)=>v+(b.selling_price||0)*(b.quantity||0),0):0;A.length===0?m.push({id:a.id,name:a.name,description:a.description,shortDescription:a.short_description||a.description||"",sku:a.sku,barcode:a.barcode,categoryId:a.category_id,supplierId:a.supplier_id,images:a.images||[],isActive:a.is_active,totalQuantity:a.total_quantity||0,totalValue:a.total_value||0,condition:a.condition,debutDate:a.debut_date||null,debutNotes:a.debut_notes||null,debutFeatures:a.debut_features||null,metadata:a.metadata,createdAt:a.created_at,updatedAt:a.updated_at,categoryName:(r==null?void 0:r.name)||"Uncategorized",supplierName:(u==null?void 0:u.name)||"No Supplier",allVariants:[],variantId:"",variantSku:"",variantName:"",variantBarcode:"",variantType:"standard",isParent:!1,parentVariantId:void 0,parentVariantSku:void 0,parentVariantName:void 0,costPrice:0,sellingPrice:0,quantity:0,minQuantity:0,maxQuantity:0,weight:void 0,dimensions:"",variantAttributes:void 0,imei:void 0,serialNumber:void 0,variantIsActive:!0,branchId:void 0,variantCount:0,totalVariantsValue:0,lastStockMovement:void 0,category:r,supplier:u}):A.forEach(v=>{var b,D,ae,G,de;m.push({id:a.id,name:a.name,description:a.description,shortDescription:a.short_description||a.description||"",sku:a.sku,barcode:a.barcode,categoryId:a.category_id,supplierId:a.supplier_id,images:a.images||[],isActive:a.is_active,totalQuantity:a.total_quantity||0,totalValue:a.total_value||0,condition:a.condition,debutDate:a.debut_date||null,debutNotes:a.debut_notes||null,debutFeatures:a.debut_features||null,metadata:a.metadata,createdAt:a.created_at,updatedAt:a.updated_at,categoryName:(r==null?void 0:r.name)||"Uncategorized",supplierName:(u==null?void 0:u.name)||"No Supplier",allVariants:A.map($=>{var j,X,Pe,we,ne;return{id:$.id,sku:$.sku,name:$.name,variantName:$.variant_name,barcode:$.barcode,attributes:$.attributes,variantAttributes:$.variant_attributes,costPrice:$.cost_price,sellingPrice:$.selling_price,quantity:$.quantity,minQuantity:$.min_quantity,maxQuantity:null,dimensions:$.dimensions,weight:$.weight,variantType:$.variant_type||"standard",isParent:$.is_parent||!1,parentVariantId:$.parent_variant_id,parentVariantSku:((j=$.parent_variant)==null?void 0:j.sku)||null,parentVariantName:((X=$.parent_variant)==null?void 0:X.name)||((Pe=$.parent_variant)==null?void 0:Pe.variant_name)||null,imei:((we=$.variant_attributes)==null?void 0:we.imei)||null,serialNumber:((ne=$.variant_attributes)==null?void 0:ne.serial_number)||null,isActive:$.is_active,branchId:$.branch_id,createdAt:$.created_at,updatedAt:$.updated_at}}),variantId:v.id,variantSku:v.sku,variantName:v.name||v.variant_name,variantBarcode:v.barcode,costPrice:v.cost_price,sellingPrice:v.selling_price,quantity:v.quantity,minQuantity:v.min_quantity,maxQuantity:null,dimensions:v.dimensions?`${v.dimensions.length||0}L x ${v.dimensions.width||0}W x ${v.dimensions.height||0}H`:"",variantType:v.variant_type||"standard",isParent:v.is_parent||!1,parentVariantId:v.parent_variant_id,parentVariantSku:((b=v.parent_variant)==null?void 0:b.sku)||null,parentVariantName:((D=v.parent_variant)==null?void 0:D.name)||((ae=v.parent_variant)==null?void 0:ae.variant_name)||null,imei:((G=v.variant_attributes)==null?void 0:G.imei)||null,serialNumber:((de=v.variant_attributes)==null?void 0:de.serial_number)||null,weight:v.weight,variantAttributes:v.variant_attributes,variantIsActive:v.is_active!==!1,branchId:v.branch_id,variantCount:A.length,totalVariantsValue:ee,lastStockMovement:void 0,category:r,supplier:u})})}),te(60),f.loading("Generating Excel file...",{id:"export"});const J=[{key:"productId",header:"Product ID",isHidden:!0,isEmpty:()=>!1},{key:"productName",header:"Product Name",isHidden:!1,isEmpty:a=>!a.some(r=>r.name)},{key:"description",header:"Description",isHidden:!1,isEmpty:a=>!a.some(r=>r.description)},{key:"shortDescription",header:"Short Description",isHidden:!1,isEmpty:a=>!a.some(r=>r.shortDescription)},{key:"sku",header:"SKU",isHidden:!1,isEmpty:a=>!a.some(r=>r.sku)},{key:"barcode",header:"Barcode",isHidden:!1,isEmpty:a=>!a.some(r=>r.barcode)},{key:"categoryId",header:"Category ID",isHidden:!0,isEmpty:()=>!1},{key:"categoryName",header:"Category Name",isHidden:!1,isEmpty:a=>!a.some(r=>r.categoryName)},{key:"categoryDescription",header:"Category Description",isHidden:!0,isEmpty:()=>!1},{key:"categoryColor",header:"Category Color",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.category)==null?void 0:u.color})},{key:"supplierId",header:"Supplier ID",isHidden:!0,isEmpty:()=>!1},{key:"supplierName",header:"Supplier Name",isHidden:!1,isEmpty:a=>!a.some(r=>r.supplierName&&r.supplierName!=="No Supplier")},{key:"supplierContactPerson",header:"Supplier Contact Person",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.supplier)==null?void 0:u.contact_person})},{key:"supplierEmail",header:"Supplier Email",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.supplier)==null?void 0:u.email})},{key:"supplierPhone",header:"Supplier Phone",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.supplier)==null?void 0:u.phone})},{key:"supplierAddress",header:"Supplier Address",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.supplier)==null?void 0:u.address})},{key:"supplierWebsite",header:"Supplier Website",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.supplier)==null?void 0:u.website_url})},{key:"supplierNotes",header:"Supplier Notes",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.supplier)==null?void 0:u.notes})},{key:"images",header:"Images",isHidden:!1,isEmpty:a=>!a.some(r=>r.images&&r.images.length>0)},{key:"isActive",header:"Active",isHidden:!1,isEmpty:()=>!1},{key:"totalQuantity",header:"Total Quantity",isHidden:!1,isEmpty:()=>!1},{key:"totalValue",header:"Total Value",isHidden:!1,isEmpty:()=>!1},{key:"condition",header:"Condition",isHidden:!1,isEmpty:a=>!a.some(r=>r.condition)},{key:"debutDate",header:"Debut Date",isHidden:!1,isEmpty:a=>!a.some(r=>r.debutDate)},{key:"debutNotes",header:"Debut Notes",isHidden:!1,isEmpty:a=>!a.some(r=>r.debutNotes)},{key:"debutFeatures",header:"Debut Features",isHidden:!1,isEmpty:a=>!a.some(r=>r.debutFeatures&&r.debutFeatures.length>0)},{key:"metadata",header:"Metadata",isHidden:!1,isEmpty:a=>!a.some(r=>r.metadata&&Object.keys(r.metadata).length>0)},{key:"variantId",header:"Variant ID",isHidden:!0,isEmpty:()=>!1},{key:"variantSku",header:"Variant SKU",isHidden:!1,isEmpty:a=>!a.some(r=>r.variantSku)},{key:"variantName",header:"Variant Name",isHidden:!1,isEmpty:a=>!a.some(r=>r.variantName)},{key:"variantBarcode",header:"Variant Barcode",isHidden:!1,isEmpty:a=>!a.some(r=>r.variantBarcode)},{key:"variantType",header:"Variant Type",isHidden:!1,isEmpty:()=>!1},{key:"isParent",header:"Is Parent",isHidden:!1,isEmpty:()=>!1},{key:"parentVariantId",header:"Parent Variant ID",isHidden:!0,isEmpty:()=>!1},{key:"parentVariantSku",header:"Parent Variant SKU",isHidden:!1,isEmpty:a=>!a.some(r=>r.parentVariantSku)},{key:"parentVariantName",header:"Parent Variant Name",isHidden:!1,isEmpty:a=>!a.some(r=>r.parentVariantName)},{key:"costPrice",header:"Cost Price",isHidden:!1,isEmpty:()=>!1},{key:"sellingPrice",header:"Selling Price",isHidden:!1,isEmpty:()=>!1},{key:"quantity",header:"Quantity",isHidden:!1,isEmpty:()=>!1},{key:"minQuantity",header:"Min Quantity",isHidden:!1,isEmpty:()=>!1},{key:"weight",header:"Weight",isHidden:!1,isEmpty:a=>!a.some(r=>r.weight)},{key:"dimensions",header:"Dimensions (LxWxH)",isHidden:!1,isEmpty:a=>!a.some(r=>r.dimensions)},{key:"variantAttributes",header:"Variant Attributes",isHidden:!1,isEmpty:a=>!a.some(r=>r.variantAttributes&&Object.keys(r.variantAttributes||{}).length>0)},{key:"imei",header:"IMEI",isHidden:!1,isEmpty:a=>!a.some(r=>r.imei)},{key:"serialNumber",header:"Serial Number",isHidden:!1,isEmpty:a=>!a.some(r=>r.serialNumber)},{key:"variantIsActive",header:"Variant Is Active",isHidden:!0,isEmpty:()=>!1},{key:"branchId",header:"Branch ID",isHidden:!0,isEmpty:()=>!1},{key:"allVariantsCount",header:"All Variants Count",isHidden:!1,isEmpty:()=>!1},{key:"allVariantsData",header:"All Variants Data (JSON)",isHidden:!1,isEmpty:a=>!a.some(r=>r.allVariants&&r.allVariants.length>0)},{key:"variantCount",header:"Variant Count",isHidden:!1,isEmpty:()=>!1},{key:"totalVariantsValue",header:"Total Variants Value",isHidden:!0,isEmpty:()=>!1},{key:"createdAt",header:"Created Date",isHidden:!0,isEmpty:()=>!1},{key:"updatedAt",header:"Updated Date",isHidden:!0,isEmpty:()=>!1},{key:"lastStockMovementType",header:"Last Stock Movement Type",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.lastStockMovement)==null?void 0:u.type})},{key:"lastStockMovementQuantity",header:"Last Stock Movement Quantity",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.lastStockMovement)==null?void 0:u.quantity})},{key:"lastStockMovementReason",header:"Last Stock Movement Reason",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.lastStockMovement)==null?void 0:u.reason})},{key:"lastStockMovementDate",header:"Last Stock Movement Date",isHidden:!1,isEmpty:a=>!a.some(r=>{var u;return(u=r.lastStockMovement)==null?void 0:u.date})}].filter(a=>!a.isHidden).filter(a=>!a.isEmpty(m)),Z=J.map(a=>a.header),he=m.map(a=>{const r={};return J.forEach(u=>{var W,A,ve,ee,v,b,D,ae,G,de,$,j,X;switch(u.key){case"productId":r[u.header]=a.id;break;case"productName":r[u.header]=a.name||"";break;case"description":r[u.header]=a.description||"";break;case"shortDescription":r[u.header]=a.shortDescription||"";break;case"sku":r[u.header]=a.sku||"";break;case"barcode":r[u.header]=a.barcode||"";break;case"categoryId":r[u.header]=a.categoryId||"";break;case"categoryName":r[u.header]=a.categoryName||"";break;case"categoryDescription":r[u.header]=((W=a.category)==null?void 0:W.description)||"";break;case"categoryColor":r[u.header]=((A=a.category)==null?void 0:A.color)||"";break;case"supplierId":r[u.header]=a.supplierId||"";break;case"supplierName":r[u.header]=a.supplierName||"";break;case"supplierContactPerson":r[u.header]=((ve=a.supplier)==null?void 0:ve.contact_person)||"";break;case"supplierEmail":r[u.header]=((ee=a.supplier)==null?void 0:ee.email)||"";break;case"supplierPhone":r[u.header]=((v=a.supplier)==null?void 0:v.phone)||"";break;case"supplierAddress":r[u.header]=((b=a.supplier)==null?void 0:b.address)||"";break;case"supplierWebsite":r[u.header]=((D=a.supplier)==null?void 0:D.website_url)||"";break;case"supplierNotes":r[u.header]=((ae=a.supplier)==null?void 0:ae.notes)||"";break;case"images":r[u.header]=(a.images||[]).join(", ");break;case"isActive":r[u.header]=a.isActive?"Yes":"No";break;case"totalQuantity":r[u.header]=a.totalQuantity||0;break;case"totalValue":r[u.header]=a.totalValue||0;break;case"condition":r[u.header]=a.condition||"";break;case"debutDate":r[u.header]=a.debutDate||"";break;case"debutNotes":r[u.header]=a.debutNotes||"";break;case"debutFeatures":r[u.header]=(a.debutFeatures||[]).join(", ");break;case"metadata":r[u.header]=a.metadata?JSON.stringify(a.metadata):"";break;case"variantId":r[u.header]=a.variantId||"";break;case"variantSku":r[u.header]=a.variantSku||"";break;case"variantName":r[u.header]=a.variantName||"";break;case"variantBarcode":r[u.header]=a.variantBarcode||"";break;case"variantType":r[u.header]=a.variantType||"standard";break;case"isParent":r[u.header]=a.isParent?"Yes":"No";break;case"parentVariantId":r[u.header]=a.parentVariantId||"";break;case"parentVariantSku":r[u.header]=a.parentVariantSku||"";break;case"parentVariantName":r[u.header]=a.parentVariantName||"";break;case"costPrice":r[u.header]=a.costPrice||0;break;case"sellingPrice":r[u.header]=a.sellingPrice||0;break;case"quantity":r[u.header]=a.quantity||0;break;case"minQuantity":r[u.header]=a.minQuantity||0;break;case"weight":r[u.header]=a.weight||"";break;case"dimensions":r[u.header]=a.dimensions||"";break;case"variantAttributes":r[u.header]=a.variantAttributes?JSON.stringify(a.variantAttributes):"";break;case"imei":r[u.header]=a.imei||"";break;case"serialNumber":r[u.header]=a.serialNumber||"";break;case"variantIsActive":r[u.header]=a.variantIsActive!==!1?"Yes":"No";break;case"branchId":r[u.header]=a.branchId||"";break;case"allVariantsCount":r[u.header]=((G=a.allVariants)==null?void 0:G.length)||0;break;case"allVariantsData":r[u.header]=a.allVariants?JSON.stringify(a.allVariants):"";break;case"variantCount":r[u.header]=a.variantCount||0;break;case"totalVariantsValue":r[u.header]=a.totalVariantsValue||0;break;case"createdAt":r[u.header]=new Date(a.createdAt).toLocaleDateString();break;case"updatedAt":r[u.header]=new Date(a.updatedAt).toLocaleDateString();break;case"lastStockMovementType":r[u.header]=((de=a.lastStockMovement)==null?void 0:de.type)||"";break;case"lastStockMovementQuantity":r[u.header]=(($=a.lastStockMovement)==null?void 0:$.quantity)||0;break;case"lastStockMovementReason":r[u.header]=((j=a.lastStockMovement)==null?void 0:j.reason)||"";break;case"lastStockMovementDate":r[u.header]=((X=a.lastStockMovement)==null?void 0:X.date)||"";break;default:r[u.header]=""}}),r});te(80),f.loading("Creating Excel file...",{id:"export"});const ie=ks.book_new(),F=ks.json_to_sheet(he),ce=J.map(a=>{const r=Math.max(a.header.length,...he.map(u=>{const W=u[a.header];return W?String(W).length:0}));return{wch:Math.min(Math.max(r+2,10),50)}});F["!cols"]=ce,ks.book_append_sheet(ie,F,"Products"),te(90),f.loading("Downloading file...",{id:"export"});const xe=`lats_products_export_${new Date().toISOString().split("T")[0]}.xlsx`;Ra(ie,xe),te(100),f.success(`‚úÖ Successfully exported ${m.length} products!`,{id:"export"})}catch(B){console.error("Export error:",B),f.error(`‚ùå Export failed: ${B.message}`,{id:"export"})}finally{T(!1),te(0)}};return e.jsxs(_t,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Qs,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Export All Products"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Download complete product catalog with all fields"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(At,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"What's included in the export:"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ All product details (name, description, SKU, barcode, etc.)"}),e.jsx("li",{children:"‚Ä¢ Complete category and supplier information"}),e.jsx("li",{children:"‚Ä¢ All variant details with parent-child relationships"}),e.jsx("li",{children:"‚Ä¢ Variant types (standard, parent, imei_child) and hierarchy"}),e.jsx("li",{children:"‚Ä¢ IMEI and serial numbers for tracked items"}),e.jsx("li",{children:"‚Ä¢ Variant attributes, dimensions, weight, and pricing"}),e.jsx("li",{children:"‚Ä¢ Product status, metadata, and debut information"}),e.jsx("li",{children:"‚Ä¢ Stock movement history and tracking"}),e.jsx("li",{children:"‚Ä¢ One row per variant for complete data coverage"}),e.jsx("li",{children:"‚Ä¢ All timestamps and audit information"})]})]})]})}),y&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Exporting products..."}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[s,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${s}%`}})})]}),e.jsx(Mt,{onClick:U,disabled:y,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:y?e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ht,{className:"w-4 h-4 mr-2"}),"Export All Products to Excel"]})}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(jt,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"Export Tips:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"‚Ä¢ File will be saved as Excel (.xlsx) format"}),e.jsx("li",{children:"‚Ä¢ Large exports may take a few moments"}),e.jsx("li",{children:"‚Ä¢ Useless columns (IDs) are automatically excluded"}),e.jsx("li",{children:"‚Ä¢ Automatic columns (timestamps) are excluded for easier editing"}),e.jsx("li",{children:"‚Ä¢ Empty columns are automatically removed"}),e.jsx("li",{children:"‚Ä¢ All special characters are properly escaped"}),e.jsx("li",{children:"‚Ä¢ Dates are formatted for easy reading"}),e.jsx("li",{children:"‚Ä¢ One row per variant for complete data coverage"}),e.jsx("li",{children:"‚Ä¢ JSON data (attributes, metadata) is preserved"}),e.jsx("li",{children:"‚Ä¢ All relationships and foreign keys are resolved"})]})]})]})})]})]})},fr=()=>{const[y,T]=n.useState(!1),[s,te]=n.useState(!1),[U,B]=n.useState(null);return{showAddModal:y,openAddModal:()=>{T(!0)},closeAddModal:()=>{T(!1)},showEditModal:s,editingProductId:U,openEditModal:J=>{B(J),te(!0)},closeEditModal:()=>{te(!1),B(null)}}},yr=Ha({name:Wt().min(1,"Product name must be provided").max(100,"Product name must be less than 100 characters"),description:Ss(y=>y===""||y===null||y===void 0?void 0:y,Wt().max(200,"Description must be less than 200 characters").optional()),specification:Ss(y=>y===""||y===null||y===void 0?void 0:y,Wt().max(1e3,"Specification must be less than 1000 characters").optional().refine(y=>{if(!y||y.trim()==="")return!0;try{return JSON.parse(y),!0}catch{return!1}},{message:"Specification must be valid JSON"})),sku:Ss(y=>y===""||y===null||y===void 0?void 0:y,Wt().max(50,"SKU must be less than 50 characters").optional()),categoryId:Wt().min(1,"Category must be selected"),condition:Ka(["new","used","refurbished"],{errorMap:()=>({message:"Please select a condition"})}),metadata:Ga(Wt(),Fs()).optional().default({}),variants:Wa(Fs()).optional().default([])}),vr=({isOpen:y,onClose:T,productId:s,onProductUpdated:te,onSuccess:U})=>{var He;const{currentBranch:B}=Ys(),{loadProducts:be}=Ft(),[m,z]=n.useState([]),[_,J]=n.useState({}),[Z,he]=n.useState(!1),ie=()=>Ba(),[F,ce]=n.useState({name:"",sku:"",categoryId:"",condition:"new",description:"",specification:"",metadata:{},variants:[]}),[xe,a]=n.useState(!1),[r,u]=n.useState([]),[W,A]=n.useState(!0),[ve,ee]=n.useState(!1),[v,b]=n.useState(!1),[D,ae]=n.useState(null),[G,de]=n.useState(!1),[$,j]=n.useState(null),[X,Pe]=n.useState(""),[we,ne]=n.useState("");n.useState("laptop");const[Ue,Me]=n.useState(0),[We,Le]=n.useState(!1),[Qe,Te]=n.useState([]),[ct,Ze]=n.useState(!1),[nt,tt]=n.useState(-1),rt=n.useRef(null),[Xe,Ve]=n.useState([]),[lt,Se]=n.useState(!1),[ht,gt]=n.useState(-1),dt=n.useRef(null),[ft,vt]=n.useState({top:0,left:0,width:0}),[et,mt]=n.useState({top:0,left:0,width:0}),ot=["processor","cpu","gpu","graphics","ram","memory","storage","storage_type","expandable_storage","cloud_storage","sd_card_slot","screen_size","display","display_type","resolution","refresh_rate","high_refresh_rate","aspect_ratio","panel_type","color_gamut","color_accuracy","contrast_ratio","brightness","response_time","curved","touch","touchscreen","touch_screen","oled_display","amoled_display","hdr_support","battery","battery_capacity","battery_life","fast_charging","wireless_charging","reverse_charging","removable_battery","power_consumption","energy_rating","camera","front_camera","rear_camera","optical_zoom","video_recording","color","weight","dimensions","size","thickness","material","stand_height","wifi","wifi_6","bluetooth","network","5g_support","cellular","ethernet","dual_sim","esim_support","nfc","gps","usb_c_port","usb_c_ports","usb_a_ports","usb_hub","thunderbolt","hdmi_port","hdmi_ports","displayport_ports","headphone_jack","audio_out","connector_type","audio_type","os","operating_system","fingerprint_scanner","face_id","security_chip","encryption","waterproof","dust_resistant","drop_resistant","scratch_resistant","military_grade","protection_level","backlit_keyboard","stylus_support","convertible","detachable","keyboard_support","haptic_feedback","g_sync","freesync","wall_mountable","stereo_speakers","noise_cancellation","built_in_speakers","microphone","tilt","swivel","height_adjustable","pivot","webcam","type","compatibility","power_output","cable_length","transparency","magnetic","kickstand","warranty","warranty_period"];bs(y||G),n.useEffect(()=>{if(G){if(X.trim()){const p=ot.filter(x=>x.toLowerCase().includes(X.toLowerCase()));Te(p),Ze(p.length>0)}else Te(ot),Ze(!0);if(tt(-1),rt.current){const p=rt.current.getBoundingClientRect();mt({top:p.bottom+window.scrollY,left:p.left+window.scrollX,width:p.width})}}else Te([]),Ze(!1)},[X,G]);const pt=p=>{if(Pe(p),rt.current){const x=rt.current.getBoundingClientRect();mt({top:x.bottom+window.scrollY,left:x.left+window.scrollX,width:x.width})}},it=p=>{var x;Pe(p),Ze(!1),tt(-1),(x=rt.current)==null||x.focus()},h=p=>{!ct||Qe.length===0||(p.key==="ArrowDown"?(p.preventDefault(),tt(x=>x<Qe.length-1?x+1:x)):p.key==="ArrowUp"?(p.preventDefault(),tt(x=>x>0?x-1:-1)):p.key==="Enter"&&nt>=0?(p.preventDefault(),it(Qe[nt])):p.key==="Escape"&&(Ze(!1),tt(-1)))},V=(p,x)=>{const L=p.toLowerCase(),K=x.toLowerCase().trim(),I=[];if(L.includes("storage")&&!L.includes("type")){const H=K.match(/\d+/),oe=H?parseInt(H[0]):null;oe?(oe<=512?(I.push(`${oe}GB SSD`),I.push(`${oe}GB NVMe SSD`),oe>=256&&I.push(`${oe}GB`)):(I.push(`${oe}GB HDD`),I.push(`${oe}GB`)),oe>=1e3&&I.push(`${oe/1e3}TB HDD`)):(I.push("128GB SSD","256GB SSD","512GB SSD","1TB SSD","2TB SSD"),I.push("500GB HDD","1TB HDD","2TB HDD","4TB HDD"),I.push("128GB NVMe SSD","256GB NVMe SSD","512GB NVMe SSD","1TB NVMe SSD"))}if(L.includes("storage_type")&&I.push("SSD","HDD","NVMe SSD","eMMC","UFS"),L.includes("ram")||L.includes("memory")){const H=K.match(/\d+/);if(H){const oe=parseInt(H[0]);I.push(`${oe}GB`),oe>=8&&I.push(`DDR4 ${oe}GB`,`DDR5 ${oe}GB`)}else I.push("4GB","8GB","16GB","32GB","64GB","128GB"),I.push("DDR4","DDR5","LPDDR4","LPDDR5")}if(L.includes("screen_size")||L.includes("display")&&L.includes("size")){const H=K.match(/\d+(\.\d+)?/);H?(I.push(`${H[0]}"`),I.push(`${H[0]} inch`)):I.push('11"','12"','13"','13.3"','14"','15"','15.6"','16"','17"','21"','24"','27"','32"')}if(L.includes("resolution")&&(I.push("HD (1366x768)","FHD (1920x1080)","QHD (2560x1440)","4K (3840x2160)","8K (7680x4320)"),I.push("HD+","FHD+","QHD+")),L.includes("refresh_rate")){const H=K.match(/\d+/);H?I.push(`${H[0]}Hz`):I.push("60Hz","75Hz","90Hz","120Hz","144Hz","165Hz","240Hz")}if(L.includes("battery")&&(L.includes("capacity")||!L.includes("life"))){const H=K.match(/\d+/);if(H){const oe=parseInt(H[0]);oe<1e3?I.push(`${oe}mAh`):I.push(`${oe}mAh`,`${oe/1e3}Ah`)}else I.push("2000mAh","3000mAh","4000mAh","5000mAh","6000mAh","8000mAh","10000mAh")}if(L.includes("battery_life")){const H=K.match(/\d+/);H?I.push(`${H[0]} hours`,`${H[0]}h`):I.push("8 hours","10 hours","12 hours","15 hours","20 hours","24 hours")}if((L.includes("processor")||L.includes("cpu"))&&(K.includes("intel")||K.includes("i3")||K.includes("i5")||K.includes("i7")||K.includes("i9")?(I.push("Intel Core i3","Intel Core i5","Intel Core i7","Intel Core i9"),I.push("Intel Core i5-11th Gen","Intel Core i7-11th Gen","Intel Core i9-11th Gen"),I.push("Intel Core i5-12th Gen","Intel Core i7-12th Gen","Intel Core i9-12th Gen"),I.push("Intel Core i5-13th Gen","Intel Core i7-13th Gen","Intel Core i9-13th Gen")):K.includes("amd")||K.includes("ryzen")?(I.push("AMD Ryzen 3","AMD Ryzen 5","AMD Ryzen 7","AMD Ryzen 9"),I.push("AMD Ryzen 5 5000","AMD Ryzen 7 5000","AMD Ryzen 9 5000"),I.push("AMD Ryzen 5 6000","AMD Ryzen 7 6000","AMD Ryzen 9 6000")):K.includes("snapdragon")||K.includes("qualcomm")?(I.push("Snapdragon 888","Snapdragon 8 Gen 1","Snapdragon 8 Gen 2","Snapdragon 8 Gen 3"),I.push("Snapdragon 870","Snapdragon 778G","Snapdragon 695")):K.includes("apple")||K.includes("a1")||K.includes("m1")||K.includes("m2")?(I.push("Apple A14 Bionic","Apple A15 Bionic","Apple A16 Bionic","Apple A17 Pro"),I.push("Apple M1","Apple M1 Pro","Apple M1 Max","Apple M2","Apple M2 Pro","Apple M2 Max","Apple M3")):(I.push("Intel Core i5","Intel Core i7","AMD Ryzen 5","AMD Ryzen 7"),I.push("Snapdragon 888","Apple A15 Bionic","Apple M1"))),(L.includes("gpu")||L.includes("graphics"))&&(K.includes("nvidia")||K.includes("rtx")||K.includes("gtx")?(I.push("NVIDIA RTX 3050","NVIDIA RTX 3060","NVIDIA RTX 3070","NVIDIA RTX 3080","NVIDIA RTX 3090"),I.push("NVIDIA RTX 4050","NVIDIA RTX 4060","NVIDIA RTX 4070","NVIDIA RTX 4080","NVIDIA RTX 4090"),I.push("NVIDIA GTX 1650","NVIDIA GTX 1660")):K.includes("amd")||K.includes("radeon")?(I.push("AMD Radeon RX 6600","AMD Radeon RX 6700","AMD Radeon RX 6800","AMD Radeon RX 6900"),I.push("AMD Radeon RX 7600","AMD Radeon RX 7700","AMD Radeon RX 7800","AMD Radeon RX 7900")):I.push("Intel UHD Graphics","Intel Iris Xe","NVIDIA RTX 3060","AMD Radeon RX 6600")),L.includes("color")){const H=["Black","White","Silver","Gray","Space Gray","Gold","Rose Gold","Blue","Red","Green","Purple","Pink"];if(K){const oe=H.filter(Fe=>Fe.toLowerCase().includes(K));I.push(...oe)}else I.push(...H)}if(L.includes("weight")){const H=K.match(/\d+(\.\d+)?/);H?parseFloat(H[0])<10?I.push(`${H[0]}kg`,`${H[0]} kg`):I.push(`${H[0]}g`,`${H[0]} g`):I.push("1.5kg","2kg","2.5kg","180g","200g","250g")}if(L.includes("wifi")&&I.push("Wi-Fi 5","Wi-Fi 6","Wi-Fi 6E","Wi-Fi 7","802.11ac","802.11ax"),L.includes("bluetooth")&&I.push("4.0","4.2","5.0","5.1","5.2","5.3"),(L.includes("os")||L.includes("operating_system"))&&I.push("Windows 11","Windows 10","macOS","iOS","Android","Linux","Chrome OS"),L.includes("camera")){const H=K.match(/\d+/);H?I.push(`${H[0]}MP`,`${H[0]} MP`):(I.push("12MP","48MP","50MP","64MP","108MP"),I.push("12MP + 12MP","48MP + 12MP + 5MP","50MP + 12MP + 8MP"))}return L.includes("panel_type")&&I.push("IPS","VA","TN","OLED","AMOLED","Mini LED"),L.includes("display_type")&&I.push("LCD","OLED","AMOLED","Super AMOLED","IPS LCD","TFT"),L.includes("waterproof")&&I.push("IP67","IP68","IPX7","IPX8","Yes","No"),(L.includes("touch")||L.includes("wireless")||L.includes("fast_charging")||L.includes("fingerprint")||L.includes("face_id")||L.includes("nfc")||L.includes("5g")||L.includes("stereo")||L.includes("backlit"))&&(!K||K==="y"||K==="yes"?I.push("Yes"):K==="n"||K==="no"?I.push("No"):I.push("Yes","No")),I.slice(0,8)};n.useEffect(()=>{if(X.trim()&&G){const p=V(X,we);if(Ve(p),Se(p.length>0),gt(-1),dt.current){const x=dt.current.getBoundingClientRect();vt({top:x.bottom+window.scrollY,left:x.left+window.scrollX,width:x.width})}}else Ve([]),Se(!1)},[we,X,G]);const le=p=>{const x=p.toLowerCase();return x.includes("touch")||x.includes("wireless")||x.includes("fast_charging")||x.includes("fingerprint")||x.includes("face_id")||x.includes("nfc")||x.includes("5g")||x.includes("stereo")||x.includes("backlit")||x.includes("waterproof")||x.includes("dust_resistant")||x.includes("drop_resistant")||x.includes("convertible")||x.includes("detachable")||x.includes("expandable_storage")||x.includes("g_sync")||x.includes("freesync")||x.includes("curved")||x.includes("oled_display")||x.includes("hdr_support")||x.includes("reverse_charging")||x.includes("removable_battery")||x.includes("dual_sim")||x.includes("esim_support")||x.includes("gps")||x.includes("cellular")||x.includes("headphone_jack")||x.includes("hdmi_port")||x.includes("thunderbolt")||x.includes("usb_c_port")||x.includes("stylus_support")||x.includes("keyboard_support")||x.includes("noise_cancellation")||x.includes("haptic_feedback")||x.includes("wall_mountable")||x.includes("height_adjustable")||x.includes("tilt")||x.includes("swivel")||x.includes("pivot")||x.includes("webcam")||x.includes("microphone")||x.includes("built_in_speakers")||x.includes("audio_out")||x.includes("ethernet")||x.includes("transparency")||x.includes("magnetic")||x.includes("kickstand")},Ie=p=>{if(le(X)){const x=p.toLowerCase().trim();ne(x==="yes"||x==="y"?"Yes":x==="no"||x==="n"?"No":p)}else ne(p);if(dt.current){const x=dt.current.getBoundingClientRect();vt({top:x.bottom+window.scrollY,left:x.left+window.scrollX,width:x.width})}},Re=p=>{var x;ne(p),Se(!1),gt(-1),(x=dt.current)==null||x.focus()},i=p=>{!lt||Xe.length===0||(p.key==="ArrowDown"?(p.preventDefault(),gt(x=>x<Xe.length-1?x+1:x)):p.key==="ArrowUp"?(p.preventDefault(),gt(x=>x>0?x-1:-1)):p.key==="Enter"&&ht>=0?(p.preventDefault(),Re(Xe[ht])):p.key==="Escape"&&(Se(!1),gt(-1)))},[M,P]=n.useState(!1),[Y,N]=n.useState(!1),[Ae,je]=n.useState(""),Be=n.useRef(null),{currentUser:ke}=Zs(),ze=p=>{ee(p),A(p||r.length>0)};n.useEffect(()=>{r.length>0&&(ee(!0),A(!0))},[r.length]),n.useEffect(()=>{r.length>0&&F.sku&&u(p=>p.map((x,L)=>({...x,sku:`${F.sku}-V${(L+1).toString().padStart(2,"0")}`})))},[F.sku]);const me=n.useCallback(async()=>{var p,x;if(s){if(Be.current===s){console.log("üîÑ [EditProductModal] Product data already loaded, skipping reload");return}Be.current&&Be.current!==s&&(console.log("üîÑ [EditProductModal] Loading different product, resetting loaded state"),Be.current=null),he(!0);try{const L=await Ds(s,{forceRefresh:!0}),K=((p=L.attributes)==null?void 0:p.condition)||L.condition||"new",I=["new","used","refurbished"].includes(K)?K:"new",H=((x=L.attributes)==null?void 0:x.specification)||L.specification||"";let oe="";if(H)if(typeof H=="string")try{JSON.parse(H),oe=H}catch{oe=JSON.stringify(H)}else oe=JSON.stringify(H);const Fe=L.categoryId?String(L.categoryId):"";if(ce({name:L.name||"",sku:L.sku||ie(),categoryId:Fe,condition:I,description:L.description||"",specification:oe,metadata:L.metadata||{},variants:[]}),je(L.name||""),Be.current=s,L.variants&&L.variants.length>0){const Ye=L.variants.map(async re=>{let Ke=[],g=!1;if(re.is_parent||re.variant_type==="parent")try{const{data:o,error:k}=await pe.from("lats_product_variants").select("variant_attributes").eq("parent_variant_id",re.id).eq("is_active",!0).eq("variant_type","imei_child");!k&&o&&o.length>0&&(Ke=o.map(E=>{var S,q,O,se;return((S=E.variant_attributes)==null?void 0:S.imei)||((q=E.variant_attributes)==null?void 0:q.serial_number)||((O=E.variant_attributes)==null?void 0:O.imei)||((se=E.variant_attributes)==null?void 0:se.serial_number)||""}).filter(E=>E.trim().length>0),g=Ke.length>0)}catch(o){console.warn("Error loading children variants for variant",re.id,o)}return{id:re.id,name:re.name||re.variant_name||"Default",sku:re.sku||"",costPrice:re.costPrice||re.cost_price||0,price:re.price||re.sellingPrice||re.selling_price||0,stockQuantity:re.stockQuantity||re.quantity||0,minStockLevel:re.minStockLevel||re.minQuantity||0,specification:re.specification||"",attributes:re.attributes||re.variant_attributes||{},childrenVariants:g?Ke:[],useChildrenVariants:g}}),qe=await Promise.all(Ye);u(qe),ee(!0),A(!0)}else u([]),ee(!1)}catch(L){console.error("Error loading product:",L),f.error(L.message||"Failed to load product data"),T()}finally{he(!1)}}},[s,T]);n.useEffect(()=>{y?((async()=>{try{const x=await ea();z(x)}catch(x){console.error("Error loading categories:",x),f.error("Failed to load categories")}})(),me()):(ce({name:"",sku:"",categoryId:"",condition:"new",description:"",specification:"",metadata:{},variants:[]}),u([]),J({}),ee(!1),A(!0),je(""),Be.current=null,he(!1))},[y,me]);const De=async p=>{if(!p.trim()){N(!1);return}if(p.trim()===Ae.trim()){N(!1);return}P(!0);try{const{data:x,error:L}=await pe.from("lats_products").select("id").ilike("name",p.trim()).neq("id",s).limit(1);if(L)throw L;N(x&&x.length>0)}catch(x){console.error("Error checking product name:",x)}finally{P(!1)}},c=p=>{j(p),de(!0)},Je=async p=>{p&&p.preventDefault();try{yr.parse(F)}catch(x){if(x instanceof Xa){const L={};console.error("Validation errors:",x.errors),x.errors.forEach(I=>{I.path.length>0&&(L[I.path[0]]=I.message)}),J(L);const K=x.errors.slice(0,2).map(I=>`${I.path[0]||"form"}: ${I.message}`).join(", ");console.error("Validation errors:",x.errors),console.error("Form data that failed validation:",F),K?f.error(`Validation error: ${K}`):f.error("Please fix the validation errors");return}}if(!(B!=null&&B.id)){f.error("No branch selected");return}a(!0);try{const x={...F.metadata||{},...F.specification?{specification:F.specification}:{},...F.condition?{condition:F.condition}:{}},L={name:F.name,description:F.description||null,sku:F.sku,categoryId:F.categoryId||null,condition:F.condition,attributes:x,metadata:{...F.metadata||{},useVariants:ve,variantCount:ve?r.length:0,updatedBy:ke==null?void 0:ke.id,updatedAt:new Date().toISOString()}};if(r.length>0){const Fe=r.map(re=>{var Ke;return(Ke=re.name)==null?void 0:Ke.toLowerCase().trim()}).filter(Boolean),Ye=new Set(Fe);if(Fe.length!==Ye.size){const re=Fe.find((Ke,g)=>Fe.indexOf(Ke)!==g);f.error(`Duplicate variant name detected: "${re}". Each variant must have a unique name.`),a(!1);return}console.log("üîÑ [EditProductModal] Preparing variants for product:",s);const qe=r.map(re=>({id:re.id,sku:re.sku||`${F.sku}-V${r.indexOf(re)+1}`,name:re.name,costPrice:re.costPrice||0,sellingPrice:re.price||0,price:re.price||0,quantity:re.stockQuantity||0,stockQuantity:re.stockQuantity||0,minQuantity:re.minStockLevel||0,minStockLevel:re.minStockLevel||0,attributes:re.attributes||{},is_parent:re.useChildrenVariants&&re.childrenVariants&&re.childrenVariants.filter(Ke=>Ke.trim()).length>0,variant_type:re.useChildrenVariants&&re.childrenVariants&&re.childrenVariants.filter(Ke=>Ke.trim()).length>0?"parent":null}));L.variants=qe}console.log("üîÑ [EditProductModal] Updating product with data:",L);const{updateProduct:K}=await xt(()=>import("./index-61458a34.js").then(Fe=>Fe.bf),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),I=await K(s,L,(ke==null?void 0:ke.id)||"");if(r.length>0&&I){const{addIMEIToParentVariant:Fe,checkIMEIExists:Ye}=await xt(()=>import("./imeiVariantService-4ce4b8b1.js"),["assets/imeiVariantService-4ce4b8b1.js","assets/supabase-cf010ec4.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),qe=await Ds(s,{forceRefresh:!0});if(qe&&qe.variants){const re=[],Ke=new Map;for(let S=0;S<r.length;S++){const q=r[S],O=qe.variants.find(se=>se.id===q.id||se.name===q.name&&se.sku===q.sku);if(O&&q.useChildrenVariants&&q.childrenVariants&&q.childrenVariants.length>0){const se=q.childrenVariants.filter(_e=>_e.trim().length>0);if(se.length>0){const{data:_e}=await pe.from("lats_product_variants").select("variant_attributes").eq("parent_variant_id",O.id).eq("is_active",!0).eq("variant_type","imei_child"),Ge=(_e||[]).map(Oe=>{var t,l;return(((t=Oe.variant_attributes)==null?void 0:t.imei)||((l=Oe.variant_attributes)==null?void 0:l.serial_number)||"").toString().trim().toLowerCase()}).filter(Oe=>Oe.length>0),$e=se.map(Oe=>Oe.trim()).filter(Oe=>!Ge.includes(Oe.toLowerCase()));re.push(...$e),Ke.set(O.id,$e)}}}const g=new Set,o=[];for(const S of re){const q=S.toLowerCase();g.has(q)?o.push(S):g.add(q)}if(o.length>0){f.error(`Duplicate IMEI/Serial numbers found: ${o.join(", ")}. Each item must be unique across all variants.`),a(!1);return}const{data:k}=await pe.from("lats_product_variants").select("variant_attributes, name, variant_name").eq("product_id",s).eq("is_active",!0).eq("variant_type","imei_child"),E=(k||[]).map(S=>{var q,O;return(((q=S.variant_attributes)==null?void 0:q.imei)||((O=S.variant_attributes)==null?void 0:O.serial_number)||S.name||S.variant_name||"").toString().trim().toLowerCase()}).filter(S=>S.length>0),C=[];for(const S of re)E.includes(S.toLowerCase())&&C.push(S);if(C.length>0){f.error(`IMEI/Serial numbers already exist in this product: ${C.join(", ")}. Each item must be unique.`),a(!1);return}for(let S=0;S<r.length;S++){const q=r[S],O=qe.variants.find(_e=>_e.id===q.id||_e.name===q.name&&_e.sku===q.sku);if(!O)continue;const se=Ke.get(O.id)||[];if(q.useChildrenVariants&&q.childrenVariants&&q.childrenVariants.length>0&&se.length>0&&se.length>0){console.log(`üîÑ [EditProductModal] Adding ${se.length} new children variants for variant ${O.id}`),O.is_parent||await pe.from("lats_product_variants").update({is_parent:!0,variant_type:"parent",updated_at:new Date().toISOString()}).eq("id",O.id);const _e=[];for(const Ge of se){const $e=Ge.trim();if(await Ye($e)){console.warn(`‚ö†Ô∏è [EditProductModal] IMEI/Serial ${$e} already exists, skipping`);continue}const t=await Fe(O.id,{imei:$e,serial_number:$e,cost_price:q.costPrice||O.cost_price||0,selling_price:q.price||O.selling_price||0,condition:"new",source:"purchase"});t.success?_e.push($e):console.error(`‚ùå [EditProductModal] Failed to add child variant ${$e}:`,t.error)}_e.length>0&&console.log(`‚úÖ [EditProductModal] Created ${_e.length} new children variants for variant ${O.id}`)}}}}console.log("üîÑ [EditProductModal] Clearing product caches..."),ta.clearProducts();const{invalidateCachePattern:H}=await xt(()=>import("./index-61458a34.js").then(Fe=>Fe.be),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);H("products:*");const{smartCache:oe}=await xt(()=>import("./enhancedCacheManager-afe341e0.js"),["assets/enhancedCacheManager-afe341e0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);oe.invalidateCache("products");try{const{getProduct:Fe}=Ft.getState(),Ye=await Fe(s);if(Ye.ok&&Ye.data){const{updateProductInStore:qe}=Ft.getState();qe(Ye.data),console.log("‚úÖ [EditProductModal] Product updated in store without full reload")}else throw new Error(Ye.message||"Failed to fetch updated product")}catch(Fe){console.warn("‚ö†Ô∏è [EditProductModal] Failed to update product in store, falling back to full reload:",Fe),await be(null,!0)}f.success("Product updated successfully!"),te&&te(),U&&U(),T()}catch(x){console.error("‚ùå [EditProductModal] Error updating product:",x),console.error("Error details:",JSON.stringify(x,null,2)),x.code==="23505"?f.error("A product with this SKU already exists."):f.error(x.message||"Failed to update product. Please try again.")}finally{a(!1)}};if(!y)return null;const Ne=[F.name,F.categoryId,F.condition].filter(Boolean).length,fe=r.filter(p=>p.name&&p.price>0).length,R=Ne+fe,ye=3+r.length-R;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[99999]",onClick:T,"aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100000] p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative pointer-events-auto",onClick:p=>p.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"edit-product-modal-title",children:[e.jsx("button",{onClick:T,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",disabled:xe||Z,children:e.jsx(st,{className:"w-5 h-5"})}),Z&&e.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading product data..."})]})}),!Z&&e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(at,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"edit-product-modal-title",className:"text-2xl font-bold text-gray-900 mb-3",children:"Edit Product"}),e.jsxs("div",{className:"flex items-center gap-4",children:[R>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),e.jsxs("span",{className:"text-sm font-bold text-green-700",children:[R," Complete"]})]}),ye>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg animate-pulse",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[ye," Pending"]})]})]})]})]})}),!Z&&e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-4",children:[e.jsx(za,{formData:F,setFormData:ce,categories:m,currentErrors:_,isCheckingName:M,nameExists:Y,onNameCheck:De,useVariants:ve,onGenerateSKU:ie}),e.jsx(Ua,{variants:r,setVariants:u,useVariants:ve,setUseVariants:ze,showVariants:W,setShowVariants:A,isReorderingVariants:v,setIsReorderingVariants:b,draggedVariantIndex:D,setDraggedVariantIndex:ae,onVariantSpecificationsClick:c,baseSku:F.sku})]})}),!Z&&e.jsxs("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:[ye>0&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 border border-orange-200 rounded-lg flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-orange-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"Please complete all required fields before updating the product."})]}),e.jsx("form",{onSubmit:Je,children:e.jsx("button",{type:"submit",disabled:xe||M||!F.name||!F.categoryId||!F.condition,className:"w-full px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg",children:xe?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):"Update Product"})})]})]})}),G&&$!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100002]",onClick:()=>{de(!1),Me(0),Pe(""),ne(""),Le(!1)}}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100003] p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden relative pointer-events-auto max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true",onClick:p=>p.stopPropagation(),children:[e.jsx("button",{onClick:()=>{de(!1),Me(0),Pe(""),ne(""),Le(!1)},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-10","aria-label":"Close modal",children:e.jsx(st,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Qt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Variant Specifications"}),e.jsx("p",{className:"text-sm text-purple-700 font-medium",children:((He=r[$])==null?void 0:He.name)||`Variant ${$!==null?$+1:""}`})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100 relative",children:$!==null&&r[$]&&e.jsxs("div",{className:"py-4 space-y-4",children:[r[$].attributes&&Object.keys(r[$].attributes||{}).length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Current Specifications"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(r[$].attributes||{}).map(([p,x])=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-xl",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[p.replace(/_/g," "),":"]}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:String(x)})]}),e.jsx("button",{type:"button",onClick:()=>{const L={...r[$].attributes};delete L[p],u(K=>K.map((I,H)=>H===$?{...I,attributes:L}:I))},className:"text-red-500 hover:text-red-700 hover:bg-red-50 px-3 py-1.5 rounded-lg transition-colors text-sm font-medium flex-shrink-0 ml-2",children:"Remove"})]},p))})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Add Specification"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Attribute Name"}),e.jsx("input",{ref:rt,type:"text",value:X,onChange:p=>pt(p.target.value),onKeyDown:h,onFocus:()=>{if(rt.current){const p=rt.current.getBoundingClientRect();mt({top:p.bottom+window.scrollY,left:p.left+window.scrollX,width:p.width})}if(X.trim()){const p=ot.filter(x=>x.toLowerCase().includes(X.toLowerCase()));Te(p),Ze(p.length>0)}else Te(ot),Ze(!0)},onBlur:()=>{setTimeout(()=>Ze(!1),200)},placeholder:"e.g., Color, Size, Storage, Processor",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-sm",autoComplete:"off"}),ct&&Qe.length>0&&qt.createPortal(e.jsx("div",{className:"fixed z-[999999] bg-white border-2 border-purple-200 rounded-xl shadow-2xl max-h-60 overflow-y-auto",style:{top:`${et.top}px`,left:`${et.left}px`,width:`${et.width}px`,maxWidth:"100vw"},children:Qe.map((p,x)=>e.jsx("button",{type:"button",onClick:()=>it(p),className:`w-full text-left px-4 py-2.5 text-sm hover:bg-purple-50 transition-colors ${x===nt?"bg-purple-100":""} ${x===0?"rounded-t-xl":""} ${x===Qe.length-1?"rounded-b-xl":""}`,children:e.jsx("span",{className:"font-medium text-gray-800",children:p})},p))}),document.body)]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Value"}),e.jsx("input",{ref:dt,type:"text",value:we,onChange:p=>Ie(p.target.value),onKeyDown:p=>{if(i(p),p.key==="Enter"&&!lt&&X&&we){const x=we.toLowerCase().trim();if(le(X)&&(x==="no"||x==="n")){p.preventDefault(),f.error('Boolean attributes with "No" value are not added. Only "Yes" values are stored.'),ne("");return}let L=we;le(X)&&(x==="yes"||x==="y")&&(L="Yes");const K={...r[$].attributes,[X]:L};u(I=>I.map((H,oe)=>oe===$?{...H,attributes:K}:H)),Pe(""),ne("")}},onFocus:()=>{if(dt.current){const p=dt.current.getBoundingClientRect();vt({top:p.bottom+window.scrollY,left:p.left+window.scrollX,width:p.width})}if(X.trim()&&we.trim()){const p=V(X,we);Ve(p),Se(p.length>0)}else if(X.trim()){const p=V(X,"");Ve(p),Se(p.length>0)}},onBlur:()=>{setTimeout(()=>Se(!1),200)},placeholder:"e.g., Black, Large, 256GB",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-sm",autoComplete:"off"}),lt&&Xe.length>0&&qt.createPortal(e.jsx("div",{className:"fixed z-[999999] bg-white border-2 border-purple-200 rounded-xl shadow-2xl max-h-60 overflow-y-auto p-2",style:{top:`${ft.top}px`,left:`${ft.left}px`,width:`${ft.width}px`,maxWidth:"100vw"},children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Xe.map((p,x)=>e.jsx("button",{type:"button",onClick:()=>Re(p),className:`w-full text-left px-3 py-2 text-sm hover:bg-purple-50 transition-colors rounded-lg border ${x===ht?"bg-purple-100 border-purple-300":"border-gray-200 hover:border-purple-200"}`,children:e.jsx("span",{className:"font-medium text-gray-800",children:p})},p))})}),document.body)]}),e.jsx("button",{type:"button",onClick:()=>{if(X&&we){const p=we.toLowerCase().trim();if(le(X)&&(p==="no"||p==="n")){f.error('Boolean attributes with "No" value are not added. Only "Yes" values are stored.'),ne("");return}let x=we;le(X)&&(p==="yes"||p==="y")&&(x="Yes");const L={...r[$].attributes,[X]:x};u(K=>K.map((I,H)=>H===$?{...I,attributes:L}:I)),Pe(""),ne("")}},disabled:!X||!we,className:"w-full px-4 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors text-sm font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:"Add Specification"})]})]})]})}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsx("button",{type:"button",onClick:()=>{de(!1),Me(0),Pe(""),ne(""),Le(!1),f.success("Specifications saved!")},className:"w-full px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all shadow-lg hover:shadow-xl text-lg",children:"Save & Close"})})]})})]})]})},bt=({size:y=64,strokeWidth:T=4,className:s="",color:te="blue"})=>{const U=(y-T)/2,B=U*2*Math.PI,be=y/2,z={blue:{primary:"#3B82F6",secondary:"#BFDBFE",gradient:["#3B82F6","#2563EB","#1D4ED8","#1E40AF","#60A5FA"]},green:{primary:"#10B981",secondary:"#BBF7D0",gradient:["#34D399","#10B981","#059669"]},purple:{primary:"#8B5CF6",secondary:"#DDD6FE",gradient:["#A78BFA","#8B5CF6","#7C3AED"]},orange:{primary:"#F97316",secondary:"#FED7AA",gradient:["#FB923C","#F97316","#EA580C"]},white:{primary:"#FFFFFF",secondary:"rgba(255, 255, 255, 0.3)",gradient:["#FFFFFF","#F0F0F0","#FFFFFF"]}}[te];return e.jsx("div",{className:`inline-flex items-center justify-center ${s}`,children:e.jsxs("svg",{width:y,height:y,className:"animate-spin",style:{animationDuration:"1.2s"},children:[e.jsx("defs",{children:e.jsx("linearGradient",{id:`gradient-${te}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:z.gradient.map((_,J)=>e.jsx("stop",{offset:`${J/(z.gradient.length-1)*100}%`,stopColor:_},J))})}),e.jsx("circle",{cx:be,cy:be,r:U,fill:"none",stroke:z.secondary,strokeWidth:T}),e.jsx("circle",{cx:be,cy:be,r:U,fill:"none",stroke:`url(#gradient-${te})`,strokeWidth:T,strokeLinecap:"round",strokeDasharray:B,strokeDashoffset:B*.25,transform:`rotate(-90 ${be} ${be})`,style:{transition:"stroke-dashoffset 0.3s ease"}})]})})},jr=({message:y,size:T=80,color:s="blue",fullscreen:te=!0,zIndex:U=9999})=>te?e.jsx("div",{className:"fixed inset-0 bg-gray-900/40 backdrop-blur-sm flex items-center justify-center",style:{zIndex:U},children:e.jsxs("div",{className:"relative text-center bg-white rounded-3xl shadow-2xl border border-gray-200 p-10",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-800/10 via-blue-800/10 to-gray-800/10 rounded-3xl"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{size:T,strokeWidth:6,color:s}),y&&e.jsx("p",{className:"mt-4 text-sm font-medium text-gray-600",children:y})]})]})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:T,strokeWidth:6,color:s}),y&&e.jsx("p",{className:"mt-4 text-sm font-medium text-gray-600",children:y})]})}),Nr=({isOpen:y,onClose:T,product:s,formatMoney:te})=>{const{isConnected:U,isPrinting:B,printLabel:be,connectedDevice:m}=tr();bs(y);const[z,_]=n.useState({title:s.name,barcode:s.barcode||s.sku,qrCode:`https://latschance.com/product/${s.id}`,text:`${s.brand||""} ${s.category||""}`.trim(),price:te(s.price),sku:s.sku,size:s.size||"",color:s.color||""}),[J,Z]=n.useState(1);if(!y)return null;const he=async()=>{try{await be(z)}catch(F){console.error("Failed to print label:",F),alert("Failed to print label. Please check your printer connection.")}},ie=F=>`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(F)}`;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:T,children:e.jsxs(_t,{className:"max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(rs,{className:"w-6 h-6"}),"Print Product Label"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Print label for ",s.name]})]}),e.jsx("button",{onClick:T,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(st,{className:"w-6 h-6 text-gray-500"})})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${U?"bg-green-100":"bg-gray-100"}`,children:U?e.jsx(xs,{className:"w-4 h-4 text-green-600"}):e.jsx(st,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:U?"Bluetooth Printer Connected":"Bluetooth Printer Not Connected"}),e.jsx("p",{className:"text-xs text-gray-600",children:U?m==null?void 0:m.name:"Connect a Bluetooth printer to print labels"})]})]}),!U&&e.jsx(Mt,{onClick:()=>window.open("/bluetooth-printer","_blank"),variant:"primary",size:"sm",children:"Connect Printer"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Label Preview"}),e.jsx("div",{className:"border-2 border-gray-300 rounded-lg p-4 bg-white",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-lg font-bold",children:z.title}),z.text&&e.jsx("div",{className:"text-sm text-gray-600",children:z.text}),z.barcode&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-mono",children:z.barcode})]}),z.qrCode&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4 text-gray-500"}),e.jsx("img",{src:ie(z.qrCode),alt:"QR Code",className:"w-16 h-16"})]}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:z.price}),e.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",z.sku]}),(z.size||z.color)&&e.jsx("div",{className:"text-sm text-gray-600",children:[z.size,z.color].filter(Boolean).join(" | ")})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Label Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:z.title,onChange:F=>_({...z,title:F.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price"}),e.jsx("input",{type:"text",value:z.price,onChange:F=>_({...z,price:F.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"QrCode"}),e.jsx("input",{type:"text",value:z.barcode,onChange:F=>_({...z,barcode:F.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU"}),e.jsx("input",{type:"text",value:z.sku,onChange:F=>_({...z,sku:F.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Size"}),e.jsx("input",{type:"text",value:z.size,onChange:F=>_({...z,size:F.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color"}),e.jsx("input",{type:"text",value:z.color,onChange:F=>_({...z,color:F.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:z.text,onChange:F=>_({...z,text:F.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Copies"}),e.jsx("input",{type:"number",min:"1",max:"10",value:J,onChange:F=>Z(Number(F.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs(Mt,{onClick:he,variant:"primary",disabled:!U||B,className:"w-full py-4 text-lg font-semibold",children:[e.jsx(xs,{className:"w-5 h-5 mr-2"}),B?"Printing...":`Print Label${J>1?` (${J} copies)`:""}`]})})]})})},wr=({formData:y,setFormData:T,currentErrors:s})=>{const{open:te}=sa(),[U,B]=n.useState([]),[be,m]=n.useState({}),[z,_]=n.useState(!1),[J,Z]=n.useState(!1),[he,ie]=n.useState(""),[F,ce]=n.useState(""),[xe,a]=n.useState("");n.useEffect(()=>{r()},[]),n.useEffect(()=>{U.length>0&&u()},[U]),n.useEffect(()=>{var b;J&&ie(y.storageRoomId||((b=U[0])==null?void 0:b.id)||"")},[J,y.storageRoomId,U]);const r=async()=>{try{_(!0);const b=await aa.getAll();B(b||[])}catch(b){console.error("Error loading storage rooms:",b),B([])}finally{_(!1)}},u=async()=>{try{const b={};for(const D of U){const ae=await ra.getShelvesByStorageRoom(D.id);b[D.id]=ae||[]}m(b)}catch(b){console.error("Error loading shelves:",b),m({})}},W=(b,D)=>{T(ae=>({...ae,storageRoomId:b,shelfId:D})),Z(!1)},A=()=>{var ae;if(!y.storageRoomId||!y.shelfId)return"Select storage location";const b=U.find(G=>G.id===y.storageRoomId),D=(ae=be[y.storageRoomId])==null?void 0:ae.find(G=>G.id===y.shelfId);return b&&D?`${b.code} - ${D.code}`:"Select storage location"},ve=()=>(be[he]||[]).filter(D=>D&&D.code).sort((D,ae)=>{const G=D.name||D.code||"",de=ae.name||ae.code||"",$=G.toLowerCase().localeCompare(de.toLowerCase());return $!==0?$:D.id.localeCompare(ae.id)}),ee=()=>{let b=ve();return F&&(b=b.filter(D=>D.code.toLowerCase().includes(F.toLowerCase())||D.name&&D.name.toLowerCase().includes(F.toLowerCase()))),xe&&(b=b.filter(D=>D.code.toUpperCase().includes(xe))),b},v=()=>{const b=ve(),D=new Set;return b.forEach(ae=>{const G=ae.code.toUpperCase();for(let de=0;de<G.length;de++){const $=G[de];if($>="A"&&$<="Z"){D.add($);break}}}),Array.from(D).sort()};return e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Dt,{size:18,className:"text-blue-600"}),"Storage Location"]}),U.length===0&&!z&&e.jsx("div",{className:"mb-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3 text-amber-800",children:[e.jsx(at,{size:24,className:"text-amber-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:"No Storage Data Available"}),e.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:["You need to create storage rooms and shelves before adding products. Go to ",e.jsx("strong",{children:"Settings ‚Üí Storage Management"})," to set up your storage infrastructure."]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:"Storage Location (optional)"}),e.jsxs("button",{type:"button",onClick:async()=>{try{const b=await te();b&&T(D=>({...D,storageRoomId:b.roomId,shelfId:b.shelfId}))}catch(b){console.error("Error opening global storage picker:",b)}},disabled:z||U.length===0,className:`relative w-full py-3 pl-10 pr-4 bg-white border-2 rounded text-left ${s.storageRoomId||s.shelfId?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500 hover:border-blue-400"} ${z||U.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(Dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx("span",{className:y.storageRoomId&&y.shelfId?"text-gray-900 font-medium":"text-gray-500",children:A()}),y.storageRoomId&&y.shelfId&&e.jsx(Us,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-green-500",size:18})]}),(s.storageRoomId||s.shelfId)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.storageRoomId||s.shelfId})]}),J&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[85vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Dt,{size:20,className:"text-gray-700"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Select Storage Location"})]}),e.jsx("button",{onClick:()=>Z(!1),className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(st,{size:20,className:"text-gray-500"})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-gray-50",children:e.jsx("div",{className:"flex overflow-x-auto px-4 py-2 gap-2",children:U.map(b=>e.jsx("button",{onClick:()=>ie(b.id),className:`flex-shrink-0 px-4 py-2 rounded font-medium text-sm ${he===b.id?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{size:14}),e.jsx("span",{children:b.name}),e.jsxs("span",{className:"text-xs opacity-75",children:["(",b.code,")"]})]})},b.id))})}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(us,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search shelves...",value:F,onChange:b=>ce(b.target.value),className:"w-full pl-10 pr-3 py-2 bg-white border border-gray-300 rounded focus:outline-none focus:border-blue-500"})]}),e.jsx("div",{className:"flex gap-1",children:v().map(b=>e.jsx("button",{onClick:()=>a(xe===b?"":b),className:`px-3 py-2 rounded font-medium text-sm ${xe===b?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:b},b))})]})}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[50vh]",children:ee().length>0?e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3",children:ee().map((b,D)=>{var we;if(!b||!b.code)return null;const ae=U.find(ne=>ne.id===he),G=(ae==null?void 0:ae.code)||"",de=b.code.startsWith(G)?b.code:`${G}${b.code}`,$=y.storageRoomId===he&&y.shelfId===b.id,j=(we=b.code.toUpperCase().match(/[A-Z]/))==null?void 0:we[0],Pe=j?(ne=>({A:"bg-blue-500",B:"bg-green-500",C:"bg-purple-500",D:"bg-orange-500",E:"bg-red-500",F:"bg-teal-500",G:"bg-pink-500",H:"bg-indigo-500",I:"bg-emerald-500",J:"bg-cyan-500",K:"bg-lime-500",L:"bg-amber-500",M:"bg-rose-500",N:"bg-violet-500",O:"bg-sky-500",P:"bg-fuchsia-500",Q:"bg-slate-500",R:"bg-zinc-500",S:"bg-stone-500",T:"bg-neutral-500",U:"bg-yellow-500",V:"bg-orange-600",W:"bg-red-600",X:"bg-pink-600",Y:"bg-purple-600",Z:"bg-indigo-600"})[ne]||"bg-gray-500")(j):"bg-gray-500";return e.jsx("button",{onClick:()=>W(he,b.id),className:`py-3 px-2 rounded border-2 font-bold text-center text-white text-sm ${$?`${Pe} border-white ring-2 ring-blue-600`:`${Pe} border-transparent hover:border-white`}`,children:de},b.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ga,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Shelves Found"}),e.jsx("p",{className:"text-sm text-gray-600",children:F||xe?"Try adjusting your search or filter.":"No shelves available in this room."})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[ee().length," shelf",ee().length!==1?"ves":""," found"]}),e.jsx("button",{onClick:()=>Z(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded",children:"Cancel"})]})]})})]})},kr=({productId:y,variants:T,showFinancials:s=!0,showSearch:te=!0,onChildClick:U})=>{const[B,be]=n.useState({}),[m,z]=n.useState({}),[_,J]=n.useState({}),[Z,he]=n.useState(""),[ie,F]=n.useState("all");n.useState(!1);const[ce,xe]=n.useState({totalDevices:0,availableDevices:0});n.useEffect(()=>{(()=>{const b=Object.values(m).flat().length,D=Object.values(m).flat().filter(G=>G.is_active&&G.quantity>0).length,ae=T.filter(G=>!m[G.id]).reduce((G,de)=>{const $=de.available_imeis!==void 0?de.available_imeis:de.quantity||0;return G+$},0);xe({totalDevices:b+ae,availableDevices:D+ae})})()},[T,m]);const a=async v=>{const b=!B[v];if(be(D=>({...D,[v]:b})),b&&!m[v]){J(D=>({...D,[v]:!0}));try{const D=await Os(v);z(ae=>({...ae,[v]:D}))}catch(D){console.error("Error loading children:",D)}finally{J(D=>({...D,[v]:!1}))}}},r=async()=>{const v={};T.forEach(b=>{v[b.id]=!0}),be(v);for(const b of T)if(!m[b.id]){J(D=>({...D,[b.id]:!0}));try{const D=await Os(b.id);z(ae=>({...ae,[b.id]:D}))}catch(D){console.error("Error loading children:",D)}finally{J(D=>({...D,[b.id]:!1}))}}},u=()=>{be({})},W=v=>{if(!v)return{bg:"bg-gray-100",text:"text-gray-700",label:"N/A"};const b={new:{bg:"bg-green-100",text:"text-green-700",label:"New"},excellent:{bg:"bg-blue-100",text:"text-blue-700",label:"Excellent"},good:{bg:"bg-yellow-100",text:"text-yellow-700",label:"Good"},fair:{bg:"bg-orange-100",text:"text-orange-700",label:"Fair"},poor:{bg:"bg-red-100",text:"text-red-700",label:"Poor"},used:{bg:"bg-gray-100",text:"text-gray-700",label:"Used"}};return b[v.toLowerCase()]||b.used},A=v=>v?v.filter(b=>{var X,Pe,we;const D=((X=b.variant_attributes)==null?void 0:X.imei)||"",ae=((Pe=b.variant_attributes)==null?void 0:Pe.serial_number)||"",G=((we=b.variant_attributes)==null?void 0:we.mac_address)||"",de=Z===""||D.toLowerCase().includes(Z.toLowerCase())||ae.toLowerCase().includes(Z.toLowerCase())||G.toLowerCase().includes(Z.toLowerCase()),$=b.is_active&&b.quantity>0;return de&&(ie==="all"||ie==="available"&&$||ie==="sold"&&!$)}):[],ve=(v,b=0)=>{const D=m[v]||[],ae=D.filter($=>$.is_active&&$.quantity>0).length,G=D.filter($=>!$.is_active||$.quantity===0).length,de=D.filter($=>$.is_active&&$.quantity>0).reduce(($,j)=>{const X=j.selling_price&&j.selling_price>0?j.selling_price:b;return $+X},0);return{total:D.length,available:ae,sold:G,totalValue:de}},ee=T.filter(v=>{if(!Z)return!0;const b=v.variant_name||v.name||"",D=v.sku||"";return b.toLowerCase().includes(Z.toLowerCase())||D.toLowerCase().includes(Z.toLowerCase())});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-600 rounded",children:e.jsx(Qt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Variant Hierarchy"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[ee.length," parent variant",ee.length!==1?"s":""," ‚Ä¢ ",ce.totalDevices," devices"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700",children:"Expand All"}),e.jsx("button",{onClick:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded hover:bg-gray-300",children:"Collapse All"})]})]}),te&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(us,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:Z,onChange:v=>he(v.target.value),placeholder:"Search variants, IMEIs, serial numbers...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded focus:outline-none focus:border-blue-500 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 border border-gray-300 rounded bg-white",children:[e.jsx(pa,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:ie,onChange:v=>F(v.target.value),className:"text-sm border-none focus:outline-none bg-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"sold",children:"Sold"})]})]})]}),e.jsx("div",{className:"space-y-3",children:ee.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded border border-gray-300",children:[e.jsx(at,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold mb-1",children:"No variants found"}),e.jsx("p",{className:"text-sm text-gray-500",children:Z?"Try adjusting your search or filter criteria":"This product has no variants yet"})]}):ee.map(v=>{const b=B[v.id],D=m[v.id]||[],ae=_[v.id],G=ve(v.id,v.selling_price||0),de=A(D),$=v.is_parent||v.variant_type==="parent";return e.jsxs("div",{className:"bg-white rounded border-2 border-gray-200 hover:border-purple-400",children:[e.jsx("div",{onClick:()=>a(v.id),className:"p-4 cursor-pointer hover:bg-gray-50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:b?e.jsx(Ks,{className:"w-5 h-5 text-gray-600"}):e.jsx(ba,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-purple-100 rounded flex items-center justify-center",children:e.jsx(Qt,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900 truncate",children:v.variant_name||v.name||"Unnamed Variant"}),$&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-purple-100 text-purple-700 rounded",children:"Parent"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",v.sku]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Stock"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:$&&D.length>0?G.available:v.quantity||0})]}),$&&D.length>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Devices"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:[G.available," / ",G.total]})]}),s&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Price"}),e.jsx("div",{className:"text-base font-bold text-green-600",children:Ee.money(v.selling_price||0)})]})]})]})})}),b&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50",children:ae?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-300 border-t-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading devices..."})]}):D.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx($t,{className:"w-10 h-10 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-700 font-medium mb-1",children:"No child devices"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This parent variant has no IMEI children yet"})]}):de.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(us,{className:"w-10 h-10 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-700 font-medium mb-1",children:"No matches found"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Try adjusting your search or filter criteria"})]}):e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-300",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[G.total," Device",G.total!==1?"s":""]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[G.available," available ‚Ä¢ ",G.sold," sold"]})]}),s&&G.totalValue>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total Value"}),e.jsx("p",{className:"text-base font-bold text-green-600",children:Ee.money(G.totalValue)})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2",children:de.map((j,X)=>{var Le,Qe,Te,ct,Ze;const Pe=((Le=j.variant_attributes)==null?void 0:Le.imei)||((Qe=j.variant_attributes)==null?void 0:Qe.serial_number)||"N/A",we=(Te=j.variant_attributes)==null?void 0:Te.mac_address,ne=(ct=j.variant_attributes)==null?void 0:ct.condition,Ue=(Ze=j.variant_attributes)==null?void 0:Ze.location,Me=j.is_active&&j.quantity>0,We=W(ne);return e.jsxs("div",{onClick:()=>U==null?void 0:U(j),className:`p-3 rounded border-2 ${Me?"bg-white border-gray-200 hover:border-blue-400 cursor-pointer":"bg-gray-100 border-gray-300 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx($t,{className:`w-4 h-4 flex-shrink-0 ${Me?"text-blue-600":"text-gray-400"}`}),e.jsx("span",{className:"font-mono text-sm font-semibold text-gray-900 truncate",children:Pe})]}),Me?e.jsx(jt,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(ds,{className:"w-4 h-4 text-red-500 flex-shrink-0"})]}),e.jsxs("div",{className:"space-y-1",children:[we&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(Gs,{className:"w-3 h-3"}),e.jsxs("span",{className:"truncate",children:["MAC: ",we]})]}),Ue&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(Dt,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:Ue})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-2 border-t border-gray-200",children:[e.jsx("span",{className:`inline-flex px-2 py-0.5 rounded text-xs font-medium ${We.bg} ${We.text}`,children:We.label}),s&&e.jsx("span",{className:"text-xs font-bold text-green-600",children:Ee.money(j.selling_price&&j.selling_price>0?j.selling_price:v.selling_price||0)})]})]})]},j.id)})})]})})]},v.id)})})]})},Sr=({isOpen:y,onClose:T,product:s,onEdit:te})=>{var E,C,S,q,O,se,_e,Ge,$e,Oe;const U=Ws(),{adjustStock:B,getProduct:be}=Ft(),[m,z]=n.useState(s);bs(y);const[_,J]=n.useState(!1),[Z,he]=n.useState(null),[ie,F]=n.useState(0),[ce,xe]=n.useState(""),[a,r]=n.useState(!1),[u,W]=n.useState(null),[A,ve]=n.useState(null),[ee,v]=n.useState(!1),[b,D]=n.useState({name:"",sku:"",costPrice:0,sellingPrice:0,quantity:0,minQuantity:2}),[ae,G]=n.useState(!1),[de,$]=n.useState({storageRoomId:s.storageRoomId||"",shelfId:s.shelfId||""}),[j,X]=n.useState(!1),[Pe,we]=n.useState(null),[ne,Ue]=n.useState("overview"),[Me,We]=n.useState(new Set(["overview"])),[Le,Qe]=n.useState(!1),[Te,ct]=n.useState([]),[Ze,nt]=n.useState(!1),[tt,rt]=n.useState(!1);n.useEffect(()=>{if(!y||!s){y||(We(new Set(["overview"])),Ue("overview"),Ce(!0),De(null),Je(null),fe({}));return}const t=s!=null&&s.variants&&s.variants.length>0?s.variants.reduce((w,Q)=>w+(Q.quantity||0),0):0,l=((s==null?void 0:s.totalQuantity)||(s==null?void 0:s.total_quantity)||(s==null?void 0:s.stockQuantity)||(s==null?void 0:s.stock_quantity)||0)>t?(s==null?void 0:s.totalQuantity)||(s==null?void 0:s.total_quantity)||(s==null?void 0:s.stockQuantity)||(s==null?void 0:s.stock_quantity)||0:t,d={...s,totalQuantity:l};z(d),s.variants&&s.variants.length>0&&je(s.variants[0])},[s==null?void 0:s.id,y]),n.useEffect(()=>{ne==="purchase-orders"&&!Le&&Qe(!0)},[ne,Le]),n.useEffect(()=>{ne==="movements"&&!tt&&rt(!0)},[ne,tt]),n.useEffect(()=>{(async()=>{if(!(!tt||!(s!=null&&s.id)||!y)){nt(!0);try{const{data:l,error:d}=await pe.from("lats_stock_movements").select("*").eq("product_id",s.id).order("created_at",{ascending:!1}).limit(200);if(d)throw d;ct(l||[])}catch(l){console.error("Error fetching stock movements:",l),f.error("Failed to load stock movements"),ct([])}finally{nt(!1)}}})()},[tt,s==null?void 0:s.id,y]);const Xe=t=>{Ue(t),We(l=>new Set([...l,t]))};n.useEffect(()=>{const t=l=>{const{updatedProducts:d}=l.detail;s&&d.includes(s.id)&&z({...s})};return window.addEventListener("productDataUpdated",t),()=>{window.removeEventListener("productDataUpdated",t)}},[s]);const[Ve,lt]=n.useState([]),[Se,ht]=n.useState(0),[gt,dt]=n.useState(!1),[ft,vt]=n.useState(""),[et,mt]=n.useState(!1),[ot,pt]=n.useState(!1),it=Et.useRef(null),{history:h,stats:V,isLoading:le}=ir(Le?s==null?void 0:s.id:void 0);n.useState(!1);const[Ie,Re]=n.useState(!1),i=Et.useRef(null),[M,P]=n.useState(!1),[Y,N]=n.useState(!1),[Ae,je]=n.useState(()=>s!=null&&s.variants&&s.variants.length>0?s.variants[0]:null);n.useEffect(()=>{const t=d=>{const w=d.target;Re(w.scrollTop>20)},l=i.current;if(l)return l.addEventListener("scroll",t),()=>l.removeEventListener("scroll",t)},[]),n.useEffect(()=>{y&&s&&(async()=>{if(s!=null&&s.id)try{pt(!0);const l=await _s.getProductImages(s.id);lt(l)}catch(l){console.error("Error loading images:",l)}finally{pt(!1)}})()},[y,s==null?void 0:s.id]);const Be=async t=>{const l=t.target.files;if(!(!l||l.length===0||!(s!=null&&s.id))){mt(!0);try{const d=l[0];if(!d.type.startsWith("image/")){f.error("Please select an image file"),mt(!1);return}if(d.size>10*1024*1024){f.error("Image size must be less than 10MB"),mt(!1);return}f.loading("Uploading image...",{id:"image-upload"});let w=null;try{const ge=localStorage.getItem("user");if(ge){const ut=JSON.parse(ge);w=ut.id&&ut.id!=="system"?ut.id:null}}catch(ge){console.warn("Could not get user ID:",ge)}const Q=await _s.uploadImage(d,s.id,w,Ve.length===0);if(!Q.success)throw new Error(Q.error||"Upload failed");const ue=await _s.getProductImages(s.id);lt(ue),f.success("Image uploaded successfully!",{id:"image-upload"}),it.current&&(it.current.value="")}catch(d){console.error("Error uploading image:",d);const w=d instanceof Error?d.message:"Failed to upload image";f.error(w,{id:"image-upload"})}finally{mt(!1)}}},ke=()=>{it.current&&it.current.click()},ze=async t=>{if(confirm("Are you sure you want to delete this image?"))try{f.loading("Deleting image...",{id:"delete-image"});const{error:l}=await pe.from("product_images").delete().eq("id",t);if(l)throw l;const d=Ve.find(Q=>Q.id===t);if(d!=null&&d.url){const Q=d.url.split("/").pop();if(Q){const{error:ue}=await pe.storage.from("product-images").remove([Q]);ue&&console.warn("Storage deletion error:",ue)}}const w=Ve.filter(Q=>Q.id!==t);lt(w),Se>=w.length&&ht(Math.max(0,w.length-1)),f.success("Image deleted successfully!",{id:"delete-image"})}catch(l){console.error("Error deleting image:",l),f.error("Failed to delete image",{id:"delete-image"})}},[me,De]=n.useState(null),[c,Je]=n.useState(null),[Ne,fe]=n.useState({}),[R,Ce]=n.useState(!0);if(n.useEffect(()=>{if(!y||!(s!=null&&s.variants))return;Ce(!0);const t=setTimeout(()=>{let l=null;if(s.variants.length>0){const d=s.variants.find(w=>(w.quantity||0)>0);if(d)l=d;else{const w=[...s.variants].sort((Q,ue)=>(ue.sellingPrice||0)-(Q.sellingPrice||0))[0];l=(w==null?void 0:w.sellingPrice)>0?w:s.variants[0]}}Je(l),s.variants.length>0&&De({totalStock:Cs(s.variants),totalCostValue:lr(s.variants),totalRetailValue:or(s.variants),potentialProfit:cr(s.variants),profitMargin:dr(s.variants),stockStatus:mr(s.variants)}),Ce(!1)},0);return()=>clearTimeout(t)},[s==null?void 0:s.variants,y]),n.useEffect(()=>{var d,w;if(!y||ne!=="overview"){fe({});return}const t=s.specification||((d=c==null?void 0:c.attributes)==null?void 0:d.specification)||((w=s.attributes)==null?void 0:w.specification)||null;if(!t){fe({});return}const l=setTimeout(()=>{try{const Q=JSON.parse(t);typeof Q=="object"&&Q!==null&&!Array.isArray(Q)?fe(Q):fe({_raw:t})}catch{fe({_raw:t})}},0);return()=>clearTimeout(l)},[s,c,ne,y]),!y||!s)return null;if(!s.variants||s.variants.length===0)return qt.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Product Has No Variants"}),e.jsx("button",{onClick:T,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(st,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(as,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Product ",e.jsxs("strong",{children:['"',s.name,'"']})," has no variants configured."]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Please add at least one variant to this product before viewing details."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Mt,{onClick:T,variant:"secondary",className:"flex-1",children:"Close"}),te&&e.jsx(Mt,{onClick:()=>{T(),te(s)},className:"flex-1",children:"Edit Product"})]})]})]})}),document.body);const He=()=>{try{const t=`${window.location.origin}/lats/products/${s.id}/edit`,l=`Product: ${s.name}
SKU: ${(c==null?void 0:c.sku)||"N/A"}
Price: ${Ee.money((c==null?void 0:c.sellingPrice)||0)}
Details: ${t}`,d=`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(l)}`;vt(d),dt(!0),f.success("QR Code generated!")}catch{f.error("Failed to generate QR code")}},p=()=>{var t;try{const l={name:s.name,sku:(c==null?void 0:c.sku)||"",categoryId:s.categoryId,condition:(c==null?void 0:c.condition)||"",description:s.description||"",specification:((t=c==null?void 0:c.attributes)==null?void 0:t.specification)||"",price:(c==null?void 0:c.sellingPrice)||0,costPrice:(c==null?void 0:c.costPrice)||0,stockQuantity:(c==null?void 0:c.quantity)||0,minStockLevel:(c==null?void 0:c.minQuantity)||0,storageRoomId:"",shelfId:"",images:[],metadata:s.metadata||{},variants:[]},d=s.variants||[],w=Za(l,d),Q=new Blob([w],{type:"application/json"}),ue=window.URL.createObjectURL(Q),ge=document.createElement("a");ge.href=ue,ge.download=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),window.URL.revokeObjectURL(ue),f.success("Product exported!")}catch{f.error("Export failed")}},x=()=>{try{localStorage.setItem("pos_quick_add",JSON.stringify({productId:s.id,variantId:c==null?void 0:c.id,timestamp:Date.now()})),f.success("Redirecting to POS..."),setTimeout(()=>{window.open("/lats/pos","_blank")},1e3)}catch{f.error("Failed to add to cart")}},L=()=>{var l;const t=`
Product: ${m.name}
SKU: ${(c==null?void 0:c.sku)||"N/A"}
Price: ${Ee.money((c==null?void 0:c.sellingPrice)||0)}
Stock: ${(me==null?void 0:me.totalStock)||0} units
Category: ${((l=m.category)==null?void 0:l.name)||"N/A"}
Status: ${m.isActive?"Active":"Inactive"}
    `.trim();navigator.clipboard.writeText(t),f.success("Product info copied to clipboard!")},K=()=>{try{localStorage.setItem("po_quick_add",JSON.stringify({productId:s.id,productName:s.name,variantId:c==null?void 0:c.id,sku:c==null?void 0:c.sku,timestamp:Date.now()})),f.success("Opening Purchase Orders..."),setTimeout(()=>{U("/lats/purchase-orders")},500)}catch{f.error("Failed to add to purchase order")}},I=()=>{try{localStorage.setItem("stock_transfer_quick_add",JSON.stringify({productId:s.id,productName:s.name,variants:s.variants||[],timestamp:Date.now()})),f.success("Opening stock transfer..."),setTimeout(()=>{U("/lats/stock-transfers?autoOpen=true")},500)}catch{f.error("Failed to initiate transfer")}},H=(t,l)=>t===0?e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:"Out of Stock"}):t<=l?e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 text-xs font-medium rounded-full",children:"Low Stock"}):e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:"In Stock"}),oe=async()=>{if(!de.storageRoomId||!de.shelfId){f.error("Please select both storage room and shelf");return}X(!0);try{const{error:t}=await pe.from("lats_products").update({storage_room_id:de.storageRoomId,shelf_id:de.shelfId,updated_at:new Date().toISOString()}).eq("id",s.id);if(t)throw t;z({...m,storageRoomId:de.storageRoomId,shelfId:de.shelfId}),f.success("Storage location updated!"),G(!1),window.dispatchEvent(new CustomEvent("productDataUpdated",{detail:{updatedProducts:[s.id]}}))}catch(t){console.error("Error updating storage location:",t),f.error("Failed to update storage location")}finally{X(!1)}},Fe=t=>{W(t.id),ve({name:zt(t),sku:t.sku,costPrice:t.costPrice||0,sellingPrice:t.sellingPrice||0,quantity:t.quantity||0,minQuantity:t.minQuantity||2})},Ye=()=>{W(null),ve(null)},qe=async()=>{if(!(!u||!A))try{const t=A.name.trim();if(m.variants&&m.variants.length>0&&m.variants.find(Q=>Q.id!==u&&(Q.name||Q.variant_name||"").toLowerCase().trim()===t.toLowerCase())){f.error(`A variant with the name "${t}" already exists in this product`);return}const{error:l}=await pe.from("lats_product_variants").update({variant_name:A.name,sku:A.sku,cost_price:A.costPrice,selling_price:A.sellingPrice,quantity:A.quantity,min_quantity:A.minQuantity}).eq("id",u);if(l)throw l;f.success("Variant updated!"),W(null),ve(null);const d=await be(s.id);d.ok&&d.data&&z(d.data)}catch(t){console.error("Error updating variant:",t),f.error(`Failed: ${t.message}`)}},re=async(t,l)=>{if(confirm(`Delete variant "${l}"?`))try{const{data:d,error:w}=await pe.from("lats_stock_movements").select("id").eq("variant_id",t).limit(1);if(w){console.error("Failed to check stock movements:",w),f.error("Failed to verify variant status");return}if(d&&d.length>0){f.error("Cannot delete variant: has stock movement history");return}const{error:Q}=await pe.from("lats_product_variants").delete().eq("id",t);if(Q){if(Q.code==="23503")f.error("Cannot delete: variant is referenced by other records");else throw Q;return}f.success("Variant deleted!");const ue=await be(s.id);ue.ok&&ue.data&&z(ue.data)}catch(d){console.error("Error deleting variant:",d),f.error(`Failed: ${d.message}`)}},Ke=async()=>{if(!b.name||!b.sku){f.error("Please fill in name and SKU");return}try{const t=b.name.trim();if(m.variants&&m.variants.length>0&&m.variants.find(ue=>(ue.name||ue.variant_name||"").toLowerCase().trim()===t.toLowerCase())){f.error(`A variant with the name "${t}" already exists in this product`);return}const l=s.branch_id||s.branchId||localStorage.getItem("current_branch_id");if(!l){f.error("Branch ID is missing. Please refresh and try again.");return}const{error:d}=await pe.from("lats_product_variants").insert({product_id:s.id,branch_id:l,variant_name:b.name,sku:b.sku,cost_price:b.costPrice,selling_price:b.sellingPrice,quantity:b.quantity,min_quantity:b.minQuantity,is_active:!0});if(d){if(d.code==="23505")f.error("SKU already exists");else throw d;return}f.success("Variant added!"),v(!1),D({name:"",sku:"",costPrice:0,sellingPrice:0,quantity:0,minQuantity:2});const w=await be(s.id);w.ok&&w.data&&z(w.data)}catch(t){console.error("Error adding variant:",t),f.error(`Failed: ${t.message}`)}},g=async()=>{if(!Z||ie===0||!ce.trim()){f.error("Please fill all fields");return}r(!0);try{const t=await B(s.id,Z.id,ie,ce);if(t.ok){f.success("Stock adjusted!"),J(!1),he(null),F(0),xe("");const l=await be(s.id);l.ok&&l.data&&z(l.data)}else f.error(t.message||"Failed to adjust stock")}catch{f.error("Failed to adjust stock")}finally{r(!1)}},o=()=>{J(!1)},k=()=>{Cs(m.variants||[])<=((c==null?void 0:c.minQuantity)||0)&&f.success(`Creating PO for low stock item: ${s.name}`),U("/lats/purchase-order/create",{state:{productId:s.id,productName:s.name,supplierId:s.supplierId}}),T()};return qt.createPortal(e.jsx("div",{className:"fixed bg-black/30 backdrop-blur-sm animate-fade-in flex items-center justify-center p-2 sm:p-4 overflow-y-auto",style:{top:0,left:0,right:0,bottom:0,zIndex:99999},onClick:T,children:e.jsxs("div",{className:"relative bg-white rounded-lg sm:rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] sm:max-h-[85vh] overflow-hidden flex flex-col my-2 sm:my-4 animate-scale-in",onClick:t=>t.stopPropagation(),style:{pointerEvents:"auto"},children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-gray-100 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(at,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900",children:s.name})}),e.jsx("p",{className:"text-xs text-gray-500",children:(c==null?void 0:c.sku)||"No SKU"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(Cs(m.variants||[])<=((c==null?void 0:c.minQuantity)||0)||s.supplierId)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:k,className:"hidden sm:flex items-center gap-2 px-3 py-2 bg-orange-500/90 hover:bg-orange-600 text-white rounded-lg shadow-lg backdrop-blur-sm transition-all duration-200 transform hover:scale-105 text-sm font-medium",title:"Create purchase order for this product",children:[e.jsx(Jt,{className:"w-4 h-4"}),e.jsx("span",{children:"Create PO"})]}),e.jsx("button",{onClick:k,className:"flex sm:hidden p-2.5 bg-orange-500/90 hover:bg-orange-600 text-white rounded-lg shadow-lg backdrop-blur-sm transition-all duration-200 transform hover:scale-105",title:"Create purchase order",children:e.jsx(Jt,{className:"w-5 h-5"})})]}),te&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{T(),te(s)},className:"hidden sm:flex items-center gap-2 px-3 py-2 bg-blue-500/90 hover:bg-blue-600 text-white rounded-lg shadow-lg backdrop-blur-sm transition-all duration-200 transform hover:scale-105 text-sm font-medium",title:"Edit product",children:[e.jsx(It,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]}),e.jsx("button",{onClick:()=>{T(),te(s)},className:"flex sm:hidden p-2.5 bg-blue-500/90 hover:bg-blue-600 text-white rounded-lg shadow-lg backdrop-blur-sm transition-all duration-200 transform hover:scale-105",title:"Edit product",children:e.jsx(It,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:T,className:"p-2.5 bg-red-500/90 hover:bg-red-600 text-white rounded-full shadow-lg backdrop-blur-sm transition-all duration-200 transform hover:scale-110 flex-shrink-0",title:"Close modal",children:e.jsx(st,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex w-full overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300",children:[e.jsx("button",{onClick:()=>Xe("overview"),className:`flex-1 min-w-fit py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ne==="overview"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]})}),e.jsx("button",{onClick:()=>Xe("financials"),className:`flex-1 min-w-fit py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ne==="financials"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Financials"}),e.jsx("span",{className:"sm:hidden",children:"Money"})]})}),e.jsx("button",{onClick:()=>Xe("inventory"),className:`flex-1 min-w-fit py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ne==="inventory"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Inventory"}),e.jsx("span",{className:"sm:hidden",children:"Stock"})]})}),e.jsx("button",{onClick:()=>Xe("variants"),className:`flex-1 min-w-fit py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ne==="variants"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4"}),e.jsx("span",{children:"Variants"})]})}),e.jsx("button",{onClick:()=>Xe("purchase-orders"),className:`flex-1 min-w-fit py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ne==="purchase-orders"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(js,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Orders"}),e.jsx("span",{className:"sm:hidden",children:"PO"})]})}),e.jsx("button",{onClick:()=>Xe("movements"),className:`flex-1 min-w-fit py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ne==="movements"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Movements"}),e.jsx("span",{className:"sm:hidden",children:"Move"})]})}),Ts(m.variants)&&e.jsx("button",{onClick:()=>Xe("tradein"),className:`flex-1 min-w-fit py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ne==="tradein"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx($t,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Trade-In"}),e.jsx("span",{className:"sm:hidden",children:"TI"})]})}),e.jsx("button",{onClick:()=>Xe("details"),className:`flex-1 min-w-fit py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ne==="details"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Yt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Details"}),e.jsx("span",{className:"sm:hidden",children:"More"})]})})]})}),e.jsxs("div",{ref:i,className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 scroll-smooth p-3 sm:p-4 pb-6",style:{minHeight:0},children:[Ie&&e.jsx("button",{onClick:()=>{var t;return(t=i.current)==null?void 0:t.scrollTo({top:0,behavior:"smooth"})},className:"fixed bottom-24 right-6 p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 z-50 group",children:e.jsx(fa,{className:"w-5 h-5 group-hover:animate-bounce"})}),e.jsxs("div",{children:[M&&e.jsxs("div",{className:"mb-6 bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-yellow-300",children:[e.jsx(ya,{className:"w-5 h-5 text-yellow-700"}),e.jsx("h3",{className:"text-sm font-bold text-yellow-900",children:"Debug Panel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-2",children:"Product Info"}),e.jsxs("div",{className:"space-y-1 text-gray-700 font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"ID:"})," ",s.id]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Name:"})," ",s.name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Active:"})," ",s.isActive?"‚úÖ":"‚ùå"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-2",children:"Variants"}),e.jsxs("div",{className:"space-y-1 text-gray-700 font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Count:"})," ",((E=m.variants)==null?void 0:E.length)||0]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Stock:"})," ",m.totalQuantity||0]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-2",children:"UI State"}),e.jsxs("div",{className:"space-y-1 text-gray-700 font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tab:"})," ",ne]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Images:"})," ",Ve.length]})]})]})]})]}),ne==="overview"&&Me.has("overview")&&e.jsx(e.Fragment,{children:R?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading product details..."})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{ref:it,type:"file",accept:"image/*",onChange:Be,className:"hidden"}),e.jsxs("div",{className:`aspect-square relative rounded-lg overflow-hidden bg-gray-50 border-2 border-dashed transition-all ${Ve.length>0?"border-gray-200":et||ot?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-blue-50/30 cursor-pointer"}`,onClick:Ve.length===0&&!ot?ke:void 0,children:[ot&&Ve.length===0?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx(bt,{size:80,strokeWidth:6,color:"blue"}),e.jsx("p",{className:"text-sm font-medium text-blue-600 mt-4",children:"Loading images..."})]}):Ve.length>0?e.jsxs(e.Fragment,{children:[(()=>{const t=Ve[Se]||Ve[0],l=(t==null?void 0:t.url)||(t==null?void 0:t.thumbnailUrl);return l&&(l.includes(".png")||l.includes("image/png"))?e.jsx("div",{className:"absolute inset-0 bg-white"}):null})(),e.jsx("img",{src:((C=Ve[Se])==null?void 0:C.url)||((S=Ve[Se])==null?void 0:S.thumbnailUrl)||((q=Ve[0])==null?void 0:q.url)||((O=Ve[0])==null?void 0:O.thumbnailUrl),alt:s.name,className:"w-full h-full object-contain relative z-10 cursor-pointer hover:scale-105 transition-transform",onClick:()=>N(!0),loading:"eager"}),e.jsx("button",{onClick:()=>N(!0),className:"absolute top-3 left-3 p-2 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg hover:bg-white transition-colors z-20",title:"View Gallery",children:e.jsx(at,{className:"w-5 h-5 text-gray-700"})})]}):e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-400 group hover:text-blue-500 transition-colors",children:et?e.jsxs(e.Fragment,{children:[e.jsx(bt,{size:80,strokeWidth:6,color:"blue"}),e.jsx("p",{className:"text-sm font-medium text-blue-600 mt-4",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-20 h-20 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("p",{className:"text-sm font-medium group-hover:text-blue-600",children:"Click to upload"}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"PNG, JPG, WEBP (Max 10MB)"})]})}),Ve.length>0&&e.jsx("button",{onClick:t=>{t.stopPropagation(),ke()},disabled:et,className:"absolute bottom-3 right-3 bg-white/90 backdrop-blur-sm hover:bg-blue-500 hover:text-white text-gray-700 p-2 rounded-full shadow-lg transition-all duration-200",children:e.jsx(Vt,{className:"w-5 h-5"})})]}),Ve.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Ve.map((t,l)=>e.jsxs("button",{onClick:()=>ht(l),className:`flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden border-2 transition-all relative ${l===Se?"border-blue-500":"border-gray-200 hover:border-gray-300"}`,children:[(()=>{const d=t.thumbnailUrl||t.url;return d&&(d.includes(".png")||d.includes("image/png"))?e.jsx("div",{className:"absolute inset-0 bg-white"}):null})(),e.jsx("img",{src:t.thumbnailUrl||t.url,alt:`${s.name} ${l+1}`,className:"w-full h-full object-cover relative z-10"})]},t.id))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(At,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Basic Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((se=m.category)==null?void 0:se.name)||"Uncategorized"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),e.jsx("p",{className:`text-sm font-medium ${s.isActive?"text-green-600":"text-red-600"}`,children:s.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Variants"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((_e=s.variants)==null?void 0:_e.length)||0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Stock"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.totalQuantity||0})]})]})]}),Object.keys(Ne).length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(at,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Specifications"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Product technical details"})]})]}),Ne._raw?e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Ne._raw.split(",").map((t,l)=>{const d=t.trim();return d?e.jsx("span",{className:"bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md text-sm border border-gray-200",children:d},l):null})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(Ne).map(([t,l])=>{const d=sr(t,l),w=t.toLowerCase(),Q=()=>w.includes("ram")||w.includes("memory")?"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 text-emerald-900":w.includes("storage")||w.includes("capacity")?"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 text-blue-900":w.includes("processor")||w.includes("cpu")||w.includes("snapdragon")||w.includes("chip")?"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200 text-purple-900":w.includes("screen")||w.includes("display")||w.includes("amoled")?"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200 text-orange-900":w.includes("battery")||w.includes("mah")?"bg-gradient-to-br from-teal-50 to-teal-100 border-teal-200 text-teal-900":w.includes("camera")||w.includes("mp")?"bg-gradient-to-br from-pink-50 to-pink-100 border-pink-200 text-pink-900":w.includes("android")||w.includes("os")?"bg-gradient-to-br from-green-50 to-green-100 border-green-200 text-green-900":w.includes("5g")||w.includes("wifi")||w.includes("bluetooth")?"bg-gradient-to-br from-cyan-50 to-cyan-100 border-cyan-200 text-cyan-900":w.includes("weight")||w.includes("dimension")?"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200 text-slate-900":"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 text-gray-900",ue=()=>w.includes("ram")||w.includes("memory")?"üíæ":w.includes("storage")||w.includes("capacity")?"üíø":w.includes("processor")||w.includes("cpu")||w.includes("snapdragon")?"‚öôÔ∏è":w.includes("screen")||w.includes("display")?"üì±":w.includes("battery")?"üîã":w.includes("camera")?"üì∑":w.includes("android")||w.includes("os")?"ü§ñ":w.includes("5g")?"üì∂":"‚ú®";return e.jsx("div",{className:`${Q()} rounded-xl p-4 border-2 shadow-sm hover:shadow-md transition-all duration-200 hover:scale-[1.02]`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-xl flex-shrink-0",children:ue()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide opacity-70 mb-1",children:t.replace(/_/g," ")}),e.jsx("div",{className:"text-base font-bold break-words",children:d})]})]})},t)})})]}),s.description&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Description"}),e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed bg-gray-50 rounded-lg p-3",children:s.description})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-center w-7 h-7 bg-green-50 rounded-lg",children:e.jsx(Xt,{className:"w-3.5 h-3.5 text-green-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Pricing"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-2 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[e.jsx(Pt,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"text-[9px] font-bold text-green-700 uppercase tracking-wide",children:"Price"})]}),(()=>{var Q;const t=((Q=m.variants)==null?void 0:Q.map(ue=>ue.sellingPrice||ue.price||0).filter(ue=>ue>0))||[],l=Math.min(...t),d=Math.max(...t);return t.length>1&&l!==d?e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-700",children:[Ee.money(l)," - ",Ee.money(d)]}),e.jsx("p",{className:"text-[8px] text-green-600 mt-0.5",children:"Varies by variant"})]}):e.jsx("p",{className:"text-lg font-bold text-green-700",children:Ee.money((c==null?void 0:c.sellingPrice)||(c==null?void 0:c.price)||0)})})()]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-2 border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[e.jsx(ss,{className:"w-3 h-3 text-red-600"}),e.jsx("span",{className:"text-[9px] font-bold text-red-700 uppercase tracking-wide",children:"Cost"})]}),(()=>{var Q;const t=((Q=m.variants)==null?void 0:Q.map(ue=>ue.costPrice||0).filter(ue=>ue>0))||[],l=t.length>0?Math.min(...t):0,d=t.length>0?Math.max(...t):0;return t.length>1&&l!==d?e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-red-700",children:[Ee.money(l)," - ",Ee.money(d)]}),e.jsx("p",{className:"text-[8px] text-red-600 mt-0.5",children:"Varies by variant"})]}):e.jsx("p",{className:"text-lg font-bold text-red-700",children:Ee.money((c==null?void 0:c.costPrice)||0)})})()]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2 border border-blue-200",children:[e.jsx("span",{className:"text-[9px] font-bold text-blue-700 uppercase tracking-wide block mb-0.5",children:"Profit"}),(()=>{var Q;const t=((Q=m.variants)==null?void 0:Q.map(ue=>{const ge=ue.sellingPrice||ue.price||0,ut=ue.costPrice||0;return ge-ut}).filter(ue=>!isNaN(ue)))||[];if(t.length===0)return e.jsx("p",{className:"text-sm font-bold text-blue-700",children:"TSh 0"});const l=Math.min(...t),d=Math.max(...t);return t.length>1&&l!==d?e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-blue-700",children:[Ee.money(l)," - ",Ee.money(d)]}),e.jsx("p",{className:"text-[8px] text-blue-600 mt-0.5",children:"Varies"})]}):e.jsx("p",{className:"text-sm font-bold text-blue-700",children:Ee.money(t[0]||0)})})()]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-2 border border-purple-200",children:[e.jsx("span",{className:"text-[9px] font-bold text-purple-700 uppercase tracking-wide block mb-0.5",children:"Markup"}),(()=>{var Q,ue;const t=((Q=m.variants)==null?void 0:Q.map(ge=>{const ut=ge.sellingPrice||ge.price||0,yt=ge.costPrice||0;return yt>0?(ut-yt)/yt*100:0}).filter(ge=>!isNaN(ge)&&ge>0))||[];if(t.length===0)return e.jsx("p",{className:"text-sm font-bold text-purple-700",children:"0.0%"});const l=Math.min(...t),d=Math.max(...t);return t.length>1&&l!==d?e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-purple-700",children:[l.toFixed(1),"% - ",d.toFixed(1),"%"]}),e.jsx("p",{className:"text-[8px] text-purple-600 mt-0.5",children:"Varies"})]}):e.jsxs("p",{className:"text-sm font-bold text-purple-700",children:[((ue=t[0])==null?void 0:ue.toFixed(1))||"0.0","%"]})})()]})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-2.5 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:"text-[9px] font-bold text-orange-700 uppercase tracking-wide",children:"Total Value"}),e.jsx(Ls,{className:"w-3.5 h-3.5 text-orange-600"})]}),e.jsx("p",{className:"text-lg font-bold text-orange-700",children:Ee.money((me==null?void 0:me.totalRetailValue)||0)})]})]}),s.variants&&s.variants.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Qt,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variants"})]}),e.jsxs("div",{className:"space-y-2",children:[s.variants.slice(0,3).map((t,l)=>{const d=Rs(t);let w=zt(t,`Variant ${l+1}`);if(w.length>45&&w.includes("IMEI:")){const Q=w.split("IMEI:");if(Q[1]){const ue=Q[1].trim();ue.length>10&&(w=Q[0]+"IMEI:..."+ue.slice(-6))}}return e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:w}),d&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${d.className}`,children:d.text})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${(t.quantity||0)===0?"bg-red-100 text-red-700":(t.quantity||0)<=(t.minQuantity||0)?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:["Stock: ",t.quantity||0]}),e.jsx("span",{className:"font-semibold text-gray-900",children:Ee.money(t.sellingPrice||t.price||0)})]})]},t.id||l)}),s.variants.length>3&&e.jsxs("button",{onClick:()=>Xe("variants"),className:"text-xs text-gray-500 text-center py-2 bg-gray-50 rounded-lg w-full hover:bg-gray-100 hover:text-gray-700 transition-colors cursor-pointer",children:["+",s.variants.length-3," more variants"]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200",children:[e.jsx(jt,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Product Status"})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"Condition"})]}),e.jsx("span",{className:"px-3 py-1 bg-purple-500 text-white text-sm font-semibold rounded capitalize",children:s.condition||"New"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white border border-green-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium uppercase",children:"In Stock"}),e.jsx(jt,{className:"w-3 h-3 text-green-500"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:s.variants?s.variants.filter(t=>(t.quantity||0)>=(t.minQuantity||5)).length:0}),e.jsx("div",{className:"text-xs text-gray-500",children:"variants"})]}),e.jsxs("div",{className:`bg-white rounded-lg p-4 text-center ${(s.variants?s.variants.filter(t=>{const l=t.quantity||0,d=t.minQuantity||5;return l>0&&l<d}).length:0)>0?"border-2 border-orange-500":"border border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium uppercase",children:"Low Stock"}),(s.variants?s.variants.filter(t=>{const l=t.quantity||0,d=t.minQuantity||5;return l>0&&l<d}).length:0)>0&&e.jsx(as,{className:"w-3 h-3 text-orange-500"})]}),e.jsx("div",{className:"text-3xl font-bold text-orange-600 mb-1",children:s.variants?s.variants.filter(t=>{const l=t.quantity||0,d=t.minQuantity||5;return l>0&&l<d}).length:0}),e.jsx("div",{className:"text-xs text-gray-500",children:"variants < 5"})]}),e.jsxs("div",{className:`bg-white rounded-lg p-4 text-center ${(s.variants?s.variants.filter(t=>(t.quantity||0)===0).length:0)>0?"border-2 border-red-300":"border border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium uppercase",children:"No Stock"}),(s.variants?s.variants.filter(t=>(t.quantity||0)===0).length:0)>0&&e.jsx(st,{className:"w-3 h-3 text-red-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-600 mb-1",children:s.variants?s.variants.filter(t=>(t.quantity||0)===0).length:0}),e.jsx("div",{className:"text-xs text-gray-500",children:"variants"})]})]}),s.variants&&s.variants.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold",children:"Stock Health"}),e.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:[s.variants.filter(t=>(t.quantity||0)>=(t.minQuantity||5)).length," of ",s.variants.length," healthy"]})]}),e.jsx("div",{className:"relative w-full h-2 bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded transition-all duration-500",style:{width:`${(s.variants.filter(t=>(t.quantity||0)>=(t.minQuantity||5)).length/s.variants.length*100).toFixed(0)}%`}})})]})]})]})]})})}),ne==="financials"&&!Me.has("financials")&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading financials..."})]})}),ne==="financials"&&Me.has("financials")&&me&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xt,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 uppercase",children:"Total Cost Value"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:Ee.money(me.totalCostValue)}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"Investment"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xt,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 uppercase",children:"Total Retail Value"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:Ee.money(me.totalRetailValue)}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Revenue Potential"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pt,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-700 uppercase",children:"Potential Profit"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:Ee.money(me.potentialProfit)}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"If all sold"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Vs,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"text-xs font-medium text-orange-700 uppercase",children:"Profit Margin"})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[me.profitMargin.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-orange-700 mt-1",children:"Average margin"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(va,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Average Pricing"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Avg Cost Price"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:Ee.money(me.totalStock>0?me.totalCostValue/me.totalStock:0)})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Avg Selling Price"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:Ee.money(me.totalStock>0?me.totalRetailValue/me.totalStock:0)})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Avg Profit/Unit"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:Ee.money(me.totalStock>0?me.potentialProfit/me.totalStock:0)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(ja,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Variant Profitability Analysis"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Variant"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Stock"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Cost"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Price"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Profit/Unit"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Total Profit"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Markup %"})]})}),e.jsx("tbody",{children:(Array.isArray(m.variants)?m.variants:[]).map((t,l)=>{const d=(t.sellingPrice||0)-(t.costPrice||0),w=d*(t.quantity||0),Q=t.costPrice>0?d/t.costPrice*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:zt(t,`Variant ${l+1}`)}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:t.sku})]}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:`font-medium ${(t.quantity||0)===0?"text-red-600":(t.quantity||0)<=(t.minQuantity||0)?"text-orange-600":"text-green-600"}`,children:t.quantity||0})}),e.jsx("td",{className:"p-3 text-right font-medium text-red-600",children:Ee.money(t.costPrice||0)}),e.jsx("td",{className:"p-3 text-right font-medium text-green-600",children:Ee.money(t.sellingPrice||0)}),e.jsx("td",{className:"p-3 text-right font-bold text-blue-600",children:Ee.money(d)}),e.jsx("td",{className:"p-3 text-right font-bold text-purple-600",children:Ee.money(w)}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("span",{className:`font-bold ${Q>50?"text-green-600":Q>20?"text-orange-600":"text-red-600"}`,children:[Q.toFixed(1),"%"]})})]},t.id)})})]})})]})]}),ne==="inventory"&&!Me.has("inventory")&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading inventory..."})]})}),ne==="inventory"&&Me.has("inventory")&&e.jsx("div",{className:"space-y-6",children:me?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Na,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 uppercase",children:"Total Stock"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:me.totalStock}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"units across all variants"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(jt,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 uppercase",children:"In Stock"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-900",children:((Ge=m.variants)==null?void 0:Ge.filter(t=>(t.quantity||0)>0).length)||0}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"variants available"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(as,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-xs font-medium text-red-700 uppercase",children:"Needs Attention"})]}),e.jsx("div",{className:"text-3xl font-bold text-red-900",children:(($e=m.variants)==null?void 0:$e.filter(t=>(t.quantity||0)<=(t.minQuantity||0)).length)||0}),e.jsx("div",{className:"text-xs text-red-700 mt-1",children:"low or out of stock"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(wa,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Stock by Variant"})]}),e.jsx("div",{className:"space-y-3",children:(Array.isArray(m.variants)?m.variants:[]).map((t,l)=>{const d=t.minQuantity>0?Math.min((t.quantity||0)/t.minQuantity*100,100):100,w=(t.quantity||0)===0?"empty":(t.quantity||0)<=t.minQuantity?"low":"good";return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:zt(t,`Variant ${l+1}`)}),H(t.quantity||0,t.minQuantity||0)]}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:t.sku})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.quantity||0}),e.jsxs("div",{className:"text-xs text-gray-600",children:["/ ",t.minQuantity||0," min"]})]})]}),e.jsx("div",{className:"relative w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`absolute top-0 left-0 h-full transition-all ${w==="empty"?"bg-red-500":w==="low"?"bg-orange-500":"bg-green-500"}`,style:{width:`${Math.min(d,100)}%`}})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Current"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.quantity||0," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Min Level"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.minQuantity||0," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Value"}),e.jsx("span",{className:"font-medium text-gray-900",children:Ee.money((t.quantity||0)*(t.sellingPrice||0))})]})]})]},t.id)})})]}),(m.storageRoomName||m.shelfName)&&e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(Dt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Storage Location"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.storageRoomName&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("span",{className:"text-xs text-green-700 block mb-1",children:"Storage Room"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:m.storageRoomName})]}),m.shelfName&&e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"text-xs text-purple-700 block mb-1",children:"Shelf"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:m.shelfName})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(at,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No inventory data available"})]})})}),ne==="variants"&&!Me.has("variants")&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading variants..."})]})}),ne==="variants"&&Me.has("variants")&&e.jsxs("div",{className:"space-y-6",children:[m.variants&&m.variants.length>0&&e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-xl p-6",children:e.jsx(kr,{productId:m.id,variants:m.variants,showFinancials:!0,showSearch:!0,onChildClick:t=>{var l;f.success(`Selected: ${((l=t.variant_attributes)==null?void 0:l.imei)||"Device"}`)}})}),m.variants&&m.variants.length>0&&e.jsx("div",{className:"border-t-2 border-gray-200 pt-6",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(It,{className:"w-5 h-5 text-gray-600"}),"Variant Management"]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Manage Variants (",((Oe=m.variants)==null?void 0:Oe.length)||0,")"]}),e.jsxs("button",{onClick:()=>v(!ee),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Vt,{className:"w-4 h-4"}),"Add Variant"]})]}),ee&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Vt,{className:"w-5 h-5 text-blue-600"}),"New Variant"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name*"}),e.jsx("input",{type:"text",value:b.name,onChange:t=>D({...b,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 256GB Blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU*"}),e.jsx("input",{type:"text",value:b.sku,onChange:t=>D({...b,sku:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., PROD-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Price"}),e.jsx("input",{type:"number",value:b.costPrice,onChange:t=>D({...b,costPrice:parseFloat(t.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selling Price"}),e.jsx("input",{type:"number",value:b.sellingPrice,onChange:t=>D({...b,sellingPrice:parseFloat(t.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",value:b.quantity,onChange:t=>D({...b,quantity:parseInt(t.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Level"}),e.jsx("input",{type:"number",value:b.minQuantity,onChange:t=>D({...b,minQuantity:parseInt(t.target.value)||2}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Ke,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Save"]}),e.jsx("button",{onClick:()=>{v(!1),D({name:"",sku:"",costPrice:0,sellingPrice:0,quantity:0,minQuantity:2})},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors text-sm font-medium",children:"Cancel"})]})]}),m.variants&&m.variants.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Qt,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variant List"})]}),e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Stock"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden md:table-cell",children:"Min"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden lg:table-cell",children:"Cost"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Price"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden lg:table-cell",children:"Markup"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:m.variants.map(t=>{const l=t.costPrice>0?(t.sellingPrice-t.costPrice)/t.costPrice*100:0,d=u===t.id,w=Pe===t.id,Q=Rs(t),ue=ar(t);return d&&A?e.jsxs("tr",{className:"border-b border-gray-100 bg-blue-50",children:[e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"text",value:A.name,onChange:ge=>ve({...A,name:ge.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:A.quantity,onChange:ge=>ve({...A,quantity:parseInt(ge.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"})}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:e.jsx("input",{type:"number",value:A.minQuantity,onChange:ge=>ve({...A,minQuantity:parseInt(ge.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:e.jsx("input",{type:"number",value:A.costPrice,onChange:ge=>ve({...A,costPrice:parseFloat(ge.target.value)||0}),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm",step:"0.01"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:A.sellingPrice,onChange:ge=>ve({...A,sellingPrice:parseFloat(ge.target.value)||0}),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm",step:"0.01"})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:"-"}),e.jsx("td",{className:"p-3",children:"-"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:qe,className:"p-1 text-green-600 hover:bg-green-50 rounded",children:e.jsx(Ns,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Ye,className:"p-1 text-gray-600 hover:bg-gray-50 rounded",children:e.jsx(st,{className:"w-4 h-4"})})]})})]},t.id):e.jsxs(Et.Fragment,{children:[e.jsxs("tr",{className:`border-b border-gray-100 transition-colors ${t.quantity<=0?"bg-gray-100/50 opacity-75":w?"bg-blue-50 hover:bg-blue-100":"hover:bg-gray-50"} ${ue.length>0?"cursor-pointer":""}`,onClick:()=>{ue.length>0&&we(w?null:t.id)},children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.isPrimary&&e.jsx(hs,{className:"w-4 h-4 text-yellow-500"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`font-medium text-sm ${t.quantity<=0?"text-gray-500 line-through":""}`,children:zt(t)}),t.quantity<=0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-bold bg-gray-500 text-white",children:[e.jsx(st,{className:"w-3 h-3"}),"Out of Stock"]}),Q&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${Q.className}`,children:Q.text})]})})]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`font-medium text-sm ${t.quantity<=0?"text-red-600":t.quantity<=t.minQuantity?"text-orange-600":"text-green-600"}`,children:t.quantity})}),e.jsx("td",{className:"p-3 text-gray-600 text-sm hidden md:table-cell",children:t.minQuantity}),e.jsx("td",{className:"p-3 font-medium text-sm hidden lg:table-cell",children:Ee.money(t.costPrice)}),e.jsx("td",{className:"p-3 font-medium text-sm",children:Ee.money(t.sellingPrice)}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:e.jsxs("span",{className:`font-medium text-sm ${l>50?"text-green-600":l>20?"text-orange-600":"text-red-600"}`,children:[l.toFixed(1),"%"]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t.quantity>t.minQuantity?"bg-green-100 text-green-700":t.quantity>0?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700 font-bold"}`,children:t.quantity>t.minQuantity?e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-3 h-3"}),"Available"]}):t.quantity>0?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-3 h-3"}),"Low Stock"]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"w-3 h-3"}),"Out of Stock"]})})}),e.jsx("td",{className:"p-3",onClick:ge=>ge.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[ue.length>0&&e.jsx("button",{onClick:()=>we(w?null:t.id),className:"p-1 text-gray-600 hover:bg-gray-50 rounded",children:w?e.jsx(ka,{className:"w-4 h-4"}):e.jsx(Ks,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Fe(t),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit variant",children:e.jsx(It,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>re(t.id,zt(t)),disabled:m.variants&&m.variants.length===1,className:`p-1 rounded ${m.variants&&m.variants.length===1?"text-gray-300 cursor-not-allowed":"text-red-600 hover:bg-red-50"}`,title:m.variants&&m.variants.length===1?"Cannot delete the last variant. At least one variant is required.":"Delete variant",children:e.jsx(ps,{className:"w-4 h-4"})})]})})]}),w&&ue.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-50 rounded-lg",children:e.jsx(At,{className:"w-4 h-4 text-blue-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variant Details"}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500 font-medium",children:[ue.length," ",ue.length===1?"attribute":"attributes"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:ue.map((ge,ut)=>{const yt=(wt,kt)=>{const Rt=kt.toLowerCase();if((Rt.includes("date")||Rt.includes("warranty")||Rt.includes("created"))&&wt.match(/^\d{4}-\d{2}-\d{2}/))try{return new Date(wt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return wt}return wt},Ct=wt=>{const kt=wt.toLowerCase();return kt.includes("imei")?e.jsx($t,{className:"w-3.5 h-3.5 text-indigo-600"}):kt.includes("serial")?e.jsx(Bt,{className:"w-3.5 h-3.5 text-blue-600"}):kt.includes("condition")?e.jsx(ms,{className:"w-3.5 h-3.5 text-green-600"}):kt.includes("warranty")?e.jsx(ts,{className:"w-3.5 h-3.5 text-purple-600"}):kt.includes("created")?e.jsx(ts,{className:"w-3.5 h-3.5 text-orange-600"}):kt.includes("location")?e.jsx(Dt,{className:"w-3.5 h-3.5 text-red-600"}):null},Lt=ge.label.toLowerCase()==="condition",Tt=Ct(ge.label);return e.jsxs("div",{className:"space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[Tt&&e.jsx("span",{className:"opacity-70 group-hover:opacity-100 transition-opacity",children:Tt}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:ge.label})]}),Lt?e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-semibold ${ge.value.toLowerCase()==="new"?"bg-purple-100 text-purple-700 ring-1 ring-purple-200":ge.value.toLowerCase()==="excellent"?"bg-green-100 text-green-700 ring-1 ring-green-200":ge.value.toLowerCase()==="good"?"bg-blue-100 text-blue-700 ring-1 ring-blue-200":"bg-gray-100 text-gray-700 ring-1 ring-gray-200"}`,children:ge.value}):e.jsx("p",{className:"text-sm font-semibold text-gray-900 break-words leading-snug",children:yt(ge.value,ge.label)})]},ut)})})]})})})]},t.id)})})]})})]}),(!m.variants||m.variants.length===0)&&!ee&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx(Qt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No variants found"}),e.jsxs("button",{onClick:()=>v(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Vt,{className:"w-4 h-4"}),"Add First Variant"]})]})]}),ne==="purchase-orders"&&e.jsx("div",{className:"space-y-6",children:le?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading purchase history..."})]})}):!V||h.length===0?e.jsxs("div",{className:"text-center py-12 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border-2 border-dashed border-gray-300",children:[e.jsx(gs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No Purchase History"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This product has no purchase order history yet"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(js,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 uppercase",children:"Total Orders"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:V.totalOrders})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Jt,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-700 uppercase",children:"Total Ordered"})]}),e.jsx("div",{className:"text-3xl font-bold text-purple-900",children:V.totalQuantityOrdered})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xt,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 uppercase",children:"Avg Cost"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:Ee.money(V.averageCostPrice,{currency:V.currency})}),V.hasMultipleCurrencies&&e.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Mixed currencies"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl p-4 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ts,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-xs font-medium text-amber-700 uppercase",children:"Last Order"})]}),e.jsx("div",{className:"text-sm font-bold text-amber-900",children:V.lastOrderDate?new Date(V.lastOrderDate).toLocaleDateString():"N/A"})]})]}),V.lowestCostPrice&&V.highestCostPrice&&e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Price Trend"})]}),V.lastCostPrice&&e.jsx("div",{className:"flex items-center gap-2",children:V.lastCostPrice<V.averageCostPrice?e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Below Average"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm text-red-600 font-medium",children:"Above Average"})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-xs text-green-700 mb-2",children:"Lowest"}),e.jsx("div",{className:"text-xl font-bold text-green-900",children:Ee.money(V.lowestCostPrice,{currency:V.currency})})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-xs text-blue-700 mb-2",children:"Average"}),e.jsx("div",{className:"text-xl font-bold text-blue-900",children:Ee.money(V.averageCostPrice,{currency:V.currency})})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-xs text-red-700 mb-2",children:"Highest"}),e.jsx("div",{className:"text-xl font-bold text-red-900",children:Ee.money(V.highestCostPrice,{currency:V.currency})})]})]}),V.hasMultipleCurrencies&&e.jsxs("div",{className:"mt-3 text-xs text-amber-700 bg-amber-50 p-2 rounded border border-amber-200",children:["‚ö†Ô∏è Note: Statistics shown in ",V.currency,". Multiple currencies detected in order history."]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(es,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Order History"}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["(",h.length," orders)"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:h.map(t=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-mono text-sm font-medium text-blue-600",children:["#",t.orderNumber]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${t.poStatus==="completed"||t.poStatus==="received"?"bg-green-100 text-green-700":t.poStatus==="cancelled"?"bg-red-100 text-red-700":t.poStatus==="shipped"||t.poStatus==="partial_received"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:t.poStatus.replace(/_/g," ")})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block text-xs",children:"Supplier"}),e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.supplierName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block text-xs",children:"Date"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(t.orderDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block text-xs",children:"Quantity"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[t.receivedQuantity,"/",t.quantity," units",t.receivedQuantity===t.quantity&&e.jsx(ms,{className:"w-4 h-4 text-green-600 inline ml-1"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block text-xs",children:"Cost/Unit"}),e.jsx("div",{className:"font-bold text-gray-900",children:Ee.money(t.costPrice,{currency:t.currency||"TZS"})})]})]})]},t.id))})]})]})}),ne==="tradein"&&!Me.has("tradein")&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading trade-in details..."})]})}),ne==="tradein"&&Me.has("tradein")&&e.jsx("div",{className:"space-y-6",children:(()=>{var w;const t=((w=m.variants)==null?void 0:w.filter(Q=>rr(Q)))||[];if(t.length===0)return e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx($t,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No trade-in information available"})]});const l=t[0],d=l.attributes||{};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx($t,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Trade-In Device"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Original device information and details"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-100 text-xs mb-1",children:"Device"}),e.jsx("div",{className:"font-semibold",children:d.device_model||m.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-100 text-xs mb-1",children:"Condition"}),e.jsx("div",{className:"font-semibold capitalize",children:d.condition_rating||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-100 text-xs mb-1",children:"Storage"}),e.jsx("div",{className:"font-semibold",children:d.storage_capacity||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-100 text-xs mb-1",children:"Value"}),e.jsx("div",{className:"font-semibold text-xl",children:Ee.money(d.trade_in_value||d.agreed_value||0)})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-200",children:[e.jsx($t,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Device Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[d.device_model&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",children:[e.jsx("span",{className:"text-xs text-blue-700 uppercase tracking-wide block mb-2 font-semibold",children:"Device Model"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:d.device_model})]}),d.imei&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",children:[e.jsx("span",{className:"text-xs text-purple-700 uppercase tracking-wide block mb-2 font-semibold",children:"IMEI"}),e.jsx("p",{className:"text-base font-mono font-bold text-gray-900",children:d.imei})]}),d.serial_number&&e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-lg p-4 border border-indigo-200",children:[e.jsx("span",{className:"text-xs text-indigo-700 uppercase tracking-wide block mb-2 font-semibold",children:"Serial Number"}),e.jsx("p",{className:"text-base font-mono font-bold text-gray-900",children:d.serial_number})]}),d.condition_rating&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200",children:[e.jsx("span",{className:"text-xs text-green-700 uppercase tracking-wide block mb-2 font-semibold",children:"Condition"}),e.jsx("p",{className:"text-base font-bold text-gray-900 capitalize",children:d.condition_rating})]}),d.storage_capacity&&e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",children:[e.jsx("span",{className:"text-xs text-orange-700 uppercase tracking-wide block mb-2 font-semibold",children:"Storage"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:d.storage_capacity})]}),d.color&&e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg p-4 border border-pink-200",children:[e.jsx("span",{className:"text-xs text-pink-700 uppercase tracking-wide block mb-2 font-semibold",children:"Color"}),e.jsx("p",{className:"text-base font-bold text-gray-900 capitalize",children:d.color})]})]})]}),(d.trade_in_value||d.agreed_value)&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-green-200 mb-4",children:[e.jsx(Sa,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Financial Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Agreed Trade-In Value"}),e.jsx(Xt,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:Ee.money(d.trade_in_value||d.agreed_value||0)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Selling Price"}),e.jsx(Ls,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:Ee.money(l.sellingPrice||0)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Potential Profit"}),e.jsx(Pt,{className:"w-5 h-5 text-purple-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:Ee.money((l.sellingPrice||0)-(d.trade_in_value||d.agreed_value||0))})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Markup Percentage"}),e.jsx(Vs,{className:"w-5 h-5 text-orange-500"})]}),e.jsxs("p",{className:"text-3xl font-bold text-orange-600",children:[((d.trade_in_value||d.agreed_value||0)>0?((l.sellingPrice||0)-(d.trade_in_value||d.agreed_value||0))/(d.trade_in_value||d.agreed_value||0)*100:0).toFixed(1),"%"]})]})]})]}),(d.customer_name||d.customer_phone||d.customer_email)&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-200 mb-4",children:[e.jsx(_a,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Original Customer"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[d.customer_name&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block mb-2",children:"Full Name"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:d.customer_name})]}),d.customer_phone&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block mb-2",children:"Phone Number"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:d.customer_phone})]}),d.customer_email&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block mb-2",children:"Email Address"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:d.customer_email})]})]})]}),d.condition_description&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-200 mb-4",children:[e.jsx(Yt,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Condition Assessment"})]}),e.jsx("div",{className:"bg-amber-50 rounded-lg p-4 border border-amber-200",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed whitespace-pre-wrap",children:d.condition_description})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-200 mb-4",children:[e.jsx(At,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Additional Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.trade_in_date&&e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx(ts,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block",children:"Trade-In Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Date(d.trade_in_date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx(at,{className:"w-5 h-5 text-purple-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block",children:"Current Stock"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[l.quantity||0," units"]})]})]})]})]}),e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(At,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Trade-In Product"}),e.jsx("p",{className:"text-sm text-blue-800",children:"This product was acquired through a trade-in transaction. The information above reflects the original device details and customer information at the time of trade-in."})]})]})})]})})()}),ne==="movements"&&!Me.has("movements")&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading movements..."})]})}),ne==="movements"&&Me.has("movements")&&e.jsx("div",{className:"space-y-6",children:Ze?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading stock movements..."})]})}):Te.length===0?e.jsxs("div",{className:"text-center py-12 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border-2 border-dashed border-gray-300",children:[e.jsx(es,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No Stock Movements"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This product has no stock movement history yet"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(es,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 uppercase",children:"Total Movements"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:Te.length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pt,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 uppercase",children:"Stock In"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-900",children:Te.filter(t=>t.movement_type==="in"||t.movement_type==="purchase"||t.quantity&&t.quantity>0).length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ss,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-xs font-medium text-red-700 uppercase",children:"Stock Out"})]}),e.jsx("div",{className:"text-3xl font-bold text-red-900",children:Te.filter(t=>t.movement_type==="out"||t.movement_type==="sale"||t.quantity&&t.quantity<0).length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(vs,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-700 uppercase",children:"Adjustments"})]}),e.jsx("div",{className:"text-3xl font-bold text-purple-900",children:Te.filter(t=>t.movement_type==="adjustment").length})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(es,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Stock Movement History"}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["(",Te.length," records)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Type"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Variant"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Quantity"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700 hidden lg:table-cell",children:"Previous"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700 hidden lg:table-cell",children:"New"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Reason"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden md:table-cell",children:"Reference"})]})}),e.jsx("tbody",{children:Te.map(t=>{var Tt;const l=t.movement_type||"adjustment";let d=t.quantity||0;const w=l==="in"||l==="purchase"||l==="return",Q=l==="out"||l==="sale",ue=l==="adjustment";Q&&d>0&&(d=-d),w&&d<0&&(d=Math.abs(d));const ge=d>0||w,ut=d<0||Q,yt=(Tt=m.variants)==null?void 0:Tt.find(wt=>wt.id===t.variant_id),Ct=yt?zt(yt):"N/A",Lt=t.created_at?new Date(t.created_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"font-medium text-gray-900",children:Lt})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold ${ge?"bg-green-100 text-green-700 ring-1 ring-green-200":ut?"bg-red-100 text-red-700 ring-1 ring-red-200":"bg-blue-100 text-blue-700 ring-1 ring-blue-200"}`,children:[ge&&e.jsx(Pt,{className:"w-3 h-3 mr-1"}),ut&&e.jsx(ss,{className:"w-3 h-3 mr-1"}),ue&&e.jsx(vs,{className:"w-3 h-3 mr-1"}),l.charAt(0).toUpperCase()+l.slice(1)]})}),e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900 max-w-xs truncate",title:Ct,children:Ct}),(yt==null?void 0:yt.sku)&&e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:yt.sku})]}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("span",{className:`font-bold ${ge?"text-green-600":ut?"text-red-600":"text-blue-600"}`,children:[d>0?"+":"",d]})}),e.jsx("td",{className:"p-3 text-right font-medium text-gray-600 hidden lg:table-cell",children:t.previous_quantity!==null&&t.previous_quantity!==void 0?t.previous_quantity:"-"}),e.jsx("td",{className:"p-3 text-right font-medium text-gray-600 hidden lg:table-cell",children:t.new_quantity!==null&&t.new_quantity!==void 0?t.new_quantity:"-"}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"text-sm text-gray-700 max-w-xs truncate",title:t.reason||t.notes||"No reason provided",children:t.reason||t.notes||"-"})}),e.jsx("td",{className:"p-3 text-sm text-gray-600 hidden md:table-cell",children:t.reference?e.jsx("span",{className:"font-mono text-xs bg-gray-100 px-2 py-1 rounded",children:t.reference}):"-"})]},t.id)})})]})})]})]})}),ne==="details"&&!Me.has("details")&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(bt,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading details..."})]})}),ne==="details"&&Me.has("details")&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Gs,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Identification"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"SKU"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:(c==null?void 0:c.sku)||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Product ID"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:s.id})]})]}),e.jsx("div",{className:"flex gap-3 pt-3",children:e.jsxs("button",{onClick:He,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Bt,{className:"w-4 h-4"}),"QR Code"]})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Dt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Storage"})]}),e.jsxs("button",{onClick:()=>G(!0),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors",children:[e.jsx(It,{className:"w-3.5 h-3.5"}),"Edit"]})]}),s.storageRoomName||s.shelfName?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.storageRoomName&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Room"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.storageRoomName})]}),s.shelfName&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Shelf"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.shelfName})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Dt,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No location assigned"})]})]}),(()=>{const t=Ts(m.variants);return m.supplier&&!t?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Hs,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Supplier Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.supplier.name})]}),m.supplier.contactPerson&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Contact"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.supplier.contactPerson})]}),m.supplier.phone&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Phone"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.supplier.phone})]}),m.supplier.email&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.supplier.email})]})]})]}):null})(),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(ts,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Timestamps"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.createdAt?new Date(m.createdAt).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.updatedAt?new Date(m.updatedAt).toLocaleString():"N/A"})]})]})]})]})]})]}),e.jsx("div",{className:`flex-shrink-0 border-t border-gray-200 bg-white p-3 sm:p-4 transition-shadow ${Ie?"shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]":""}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-3",children:[e.jsxs("button",{onClick:x,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors",children:[e.jsx(Jt,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to POS"})]}),e.jsxs("button",{onClick:I,disabled:!c||((c==null?void 0:c.quantity)||0)===0,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Transfer to another branch",children:[e.jsx(gs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Transfer"}),e.jsx("span",{className:"sm:hidden",children:"Transfer"})]}),e.jsxs("button",{onClick:K,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition-colors",title:"Add to Purchase Order",children:[e.jsx(js,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add to PO"}),e.jsx("span",{className:"sm:hidden",children:"PO"})]}),e.jsxs("button",{onClick:He,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(Bt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"QR Code"}),e.jsx("span",{className:"sm:hidden",children:"QR"})]}),e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors",children:[e.jsx(Ps,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy Info"}),e.jsx("span",{className:"sm:hidden",children:"Copy"})]}),e.jsxs("button",{onClick:p,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700 transition-colors",children:[e.jsx(Ht,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"}),e.jsx("span",{className:"sm:hidden",children:"Save"})]}),te&&e.jsxs("button",{onClick:()=>te(s),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(It,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]})]})}),gt&&qt.createPortal(e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center p-4",style:{zIndex:1e5},children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:()=>dt(!1)}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"QR Code"}),e.jsx("button",{onClick:()=>dt(!1),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(st,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200 inline-block",children:e.jsx("img",{src:ft,alt:"QR Code",className:"w-64 h-64 object-contain"})}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{children:["SKU: ",c==null?void 0:c.sku]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Mt,{onClick:()=>{const t=document.createElement("a");t.href=ft,t.download=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_QR.png`,t.click(),f.success("Downloaded!")},className:"flex-1",children:[e.jsx(Ht,{className:"w-4 h-4 mr-2"}),"Download"]})})]})]})]}),document.body),Y&&Ve.length>0&&qt.createPortal(e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center p-4",style:{zIndex:1e5},children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>N(!1)}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Image Gallery"}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(st,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[Ve.map((t,l)=>e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:"aspect-square relative rounded-lg overflow-hidden bg-gray-100",children:[(()=>{const d=t.url;return d&&(d.includes(".png")||d.includes("image/png"))?e.jsx("div",{className:"absolute inset-0 bg-white"}):null})(),e.jsx("img",{src:t.url,alt:`${m.name} ${l+1}`,className:"w-full h-full object-contain relative z-10 cursor-pointer",onClick:()=>{ht(l),N(!1)}}),t.isPrimary&&e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full font-medium",children:"Primary"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),ze(t.id)},className:"absolute top-2 right-2 p-2 bg-red-500/90 hover:bg-red-600 text-white rounded-full shadow-xl backdrop-blur-sm transition-all duration-200 transform hover:scale-110 z-20",title:"Delete image",children:e.jsx(st,{className:"w-4 h-4"})})]})},t.id)),e.jsx("div",{className:"relative group",children:e.jsxs("button",{onClick:ke,disabled:et,className:"aspect-square relative rounded-lg overflow-hidden bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-dashed border-blue-300 hover:border-blue-500 transition-all duration-200 w-full flex flex-col items-center justify-center gap-3 group-hover:from-blue-100 group-hover:to-indigo-100",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 group-hover:bg-blue-200 flex items-center justify-center transition-colors",children:e.jsx(Vt,{className:"w-8 h-8 text-blue-600 group-hover:scale-110 transition-transform"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600 group-hover:text-blue-700",children:"Add More"}),e.jsx("p",{className:"text-xs text-blue-500 mt-1",children:"Upload image"})]})]})})]})})]})]}),document.body),_&&e.jsx(Is,{product:m,isOpen:_,onClose:o,onSubmit:async t=>{await g()},loading:a}),ae&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[85vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Dt,{size:20,className:"text-gray-700"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Assign Storage"})]}),e.jsx("button",{onClick:()=>G(!1),className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(st,{size:20,className:"text-gray-500"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(85vh-140px)]",children:e.jsx(wr,{formData:de,setFormData:$,currentErrors:{}})}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:()=>G(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded",children:"Cancel"}),e.jsx("button",{onClick:oe,disabled:j,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx(bt,{size:16,strokeWidth:2,color:"white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{size:16}),"Save"]})})]})]})})]})}),document.body)},_r=({products:y,metrics:T,setSearchQuery:s,selectedCategory:te,setSelectedCategory:U,selectedStatus:B,setSelectedStatus:be,showLowStockOnly:m,setShowLowStockOnly:z,showFeaturedOnly:_,setShowFeaturedOnly:J,viewMode:Z,setViewMode:he,sortBy:ie,setSortBy:F,selectedProducts:ce,setSelectedProducts:xe,categories:a,suppliers:r,formatMoney:u,getStatusColor:W,handleBulkAction:A,setShowStockAdjustModal:ve,setSelectedProductForHistory:ee,setShowDeleteConfirmation:v,toggleProductSelection:b,toggleSelectAll:D,productModals:ae,navigate:G,deleteProduct:de})=>{n.useEffect(()=>{},[y]);const $=i=>i>=1e9?`TSh ${(i/1e9).toFixed(1)}B`:i>=1e6?`TSh ${(i/1e6).toFixed(1)}M`:i>=1e3?`TSh ${(i/1e3).toFixed(1)}K`:`TSh ${i.toFixed(0)}`,[j,X]=n.useState(!1),[Pe,we]=n.useState(null),[ne,Ue]=n.useState(!1),[Me,We]=n.useState(null);n.useState({current:0,total:0,action:""});const[Le,Qe]=n.useState(!1),[Te,ct]=n.useState(""),[Ze,nt]=n.useState(null);n.useState(!1),n.useState(null);const[tt,rt]=n.useState(!1),[Xe,Ve]=n.useState(!1),lt=[{id:"product",label:"Product",required:!0},{id:"sku",label:"SKU",required:!1},{id:"category",label:"Category",required:!1},{id:"supplier",label:"Supplier",required:!1},{id:"shelf",label:"Shelf",required:!1},{id:"price",label:"Price",required:!1},{id:"stock",label:"Stock",required:!1},{id:"actions",label:"Actions",required:!0}],[Se,ht]=n.useState(()=>{try{const i=localStorage.getItem("inventory-visible-columns");return i?JSON.parse(i).filter(P=>P!=="sku"):lt.map(M=>M.id).filter(M=>M!=="sku")}catch{return lt.map(i=>i.id).filter(i=>i!=="sku")}}),[gt,dt]=n.useState(!1);n.useEffect(()=>{(y==null?void 0:y.length)>0&&gt&&(console.log("‚úÖ [EnhancedInventoryTab] Products loaded successfully:",y.length),dt(!1))},[y,gt]);const[ft,vt]=n.useState(!1);n.useEffect(()=>{y&&y.length>0},[y,ft]);const[et,mt]=Et.useState("detailed"),[ot,pt]=Et.useState(!1),[it,h]=Et.useState(()=>{try{const i=localStorage.getItem("inventory-grid-columns");return i?parseInt(i):4}catch{return 4}});Et.useEffect(()=>{try{localStorage.setItem("inventory-grid-columns",it.toString())}catch(i){console.error("Failed to save grid columns preference:",i)}},[it]),Et.useEffect(()=>{try{localStorage.setItem("inventory-visible-columns",JSON.stringify(Se))}catch(i){console.error("Failed to save visible columns preference:",i)}},[Se]);const V=i=>{const M=lt.find(P=>P.id===i);M!=null&&M.required||ht(P=>P.includes(i)?P.filter(Y=>Y!==i):[...P,i])},le=async i=>{var M;try{const P={...i,name:`${i.name} (Copy)`,id:void 0,sku:void 0,variants:(M=i.variants)==null?void 0:M.map(Y=>{var N;return{...Y,id:void 0,sku:void 0,name:Y.name||Y.variant_name||((N=Y.attributes)==null?void 0:N.color)||"Variant",costPrice:Y.costPrice||Y.cost_price||0,sellingPrice:Y.sellingPrice||Y.selling_price||0,quantity:0,attributes:Y.attributes||{},specification:Y.specification||""}})};sessionStorage.setItem("duplicateProductData",JSON.stringify(P)),onAddProduct?onAddProduct():G("/lats/add-product?duplicate=true"),f.success("Opening duplicate product form with new SKUs...",{duration:2e3})}catch(P){console.error("Failed to duplicate product:",P),f.error("Failed to duplicate product")}},Ie=i=>{var M;try{const P={productId:i.id,productName:i.name,variants:((M=i.variants)==null?void 0:M.map(Y=>{var N;return{id:Y.id,variant_name:Y.name||((N=Y.attributes)==null?void 0:N.color)||"Default",sku:Y.sku,quantity:Y.quantity||0,selling_price:Y.sellingPrice||Y.price||0,cost_price:Y.costPrice||0,product_id:i.id,product:{name:i.name}}}))||[]};sessionStorage.setItem("preselectedTransferProduct",JSON.stringify(P)),G("/lats/stock-transfers?autoOpen=true"),f.success(`Product "${i.name}" ready for transfer`)}catch(P){console.error("Failed to prepare stock transfer:",P),f.error("Failed to prepare stock transfer")}},Re=(i,M,P,Y,N)=>e.jsx("div",{className:"min-w-[120px]",children:e.jsx(Ya,{options:[{value:"all",label:`All ${Y}s`},...(i||[]).map(Ae=>({value:Ae.name,label:Ae.name}))],value:M,onChange:P,placeholder:`${Y} (${N})`})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:[e.jsx(_t,{className:"bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Products"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[T.totalItems," ",e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",T.activeProducts," active)"]})]})]}),e.jsx("div",{className:"p-2 bg-blue-50/20 rounded-full",children:e.jsx(at,{className:"w-5 h-5 text-blue-600"})})]})}),e.jsx(_t,{className:"bg-gradient-to-br from-orange-50 to-orange-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"In Stock"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:[T.totalItems-T.lowStockItems-T.outOfStockItems," ",e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",T.lowStockItems," low, ",T.outOfStockItems," out)"]})]})]}),e.jsx("div",{className:"p-2 bg-orange-50/20 rounded-full",children:e.jsx(jt,{className:"w-5 h-5 text-orange-600"})})]})}),e.jsx(_t,{className:"bg-gradient-to-br from-red-50 to-red-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Reorder Alerts"}),e.jsxs("p",{className:"text-2xl font-bold text-red-900",children:[T.reorderAlerts," ",e.jsx("span",{className:"text-sm font-normal text-gray-600",children:"(Need attention)"})]})]}),e.jsx("div",{className:"p-2 bg-red-50/20 rounded-full",children:e.jsx(as,{className:"w-5 h-5 text-red-600"})})]})}),e.jsx(_t,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[$(T.totalValue)," ",e.jsx("span",{className:"text-sm font-normal text-gray-600",children:"(Cost)"})]})]}),e.jsx("div",{className:"p-2 bg-green-50/20 rounded-full",children:e.jsx(Xt,{className:"w-5 h-5 text-green-600"})})]})}),e.jsx(_t,{className:"bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Retail Value"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:[$(T.retailValue||0)," ",e.jsx("span",{className:"text-sm font-normal text-gray-600",children:"(Selling)"})]})]}),e.jsx("div",{className:"p-2 bg-purple-50/20 rounded-full",children:e.jsx(Pt,{className:"w-5 h-5 text-purple-600"})})]})})]}),e.jsx("div",{className:"bg-white/60 backdrop-blur-sm rounded-lg border border-white/20 p-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(Ja,{onSearch:s,placeholder:"Search products, SKU, brand...",className:"w-full",suggestions:[...y.map(i=>i.name),...y.map(i=>{var M,P;return((P=(M=i.variants)==null?void 0:M[0])==null?void 0:P.sku)||""}).filter(Boolean),...y.map(i=>{var M;return((M=a.find(P=>P.id===i.categoryId))==null?void 0:M.name)||""}).filter(Boolean)],searchKey:"enhanced_inventory_search"})}),Re(a,te,U,"Category",(a==null?void 0:a.length)||0),e.jsx("div",{className:"min-w-[100px]",children:e.jsxs("select",{value:B,onChange:i=>be(i.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-200 rounded-md bg-white/80 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"in-stock",children:"In Stock"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"out-of-stock",children:"Out of Stock"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})}),e.jsx("div",{className:"min-w-[100px]",children:e.jsxs("select",{value:ie,onChange:i=>F(i.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-200 rounded-md bg-white/80 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"price",children:"Price (High to Low)"}),e.jsx("option",{value:"stock",children:"Stock Level"}),e.jsx("option",{value:"created",children:"Recently Added"}),e.jsx("option",{value:"updated",children:"Recently Updated"})]})}),e.jsx("button",{onClick:()=>he(Z==="grid"?"list":"grid"),className:"px-2 py-1.5 border border-gray-200 rounded-md hover:bg-gray-50 transition-colors",title:`Switch to ${Z==="grid"?"list":"grid"} view`,children:Z==="grid"?e.jsx(Ca,{size:16}):e.jsx(ws,{size:16})}),Z==="grid"&&e.jsx("button",{onClick:()=>mt(et==="detailed"?"default":"detailed"),className:"px-2 py-1.5 border border-gray-200 rounded-md hover:bg-gray-50 transition-colors",title:`Switch to ${et==="detailed"?"compact":"detailed"} cards`,children:et==="detailed"?e.jsx(at,{size:16}):e.jsx(ws,{size:16})}),Z==="list"&&e.jsx("button",{onClick:()=>rt(!0),className:"px-2 py-1.5 border border-gray-200 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-1",title:"Customize columns",children:e.jsx($s,{size:16})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:i=>z(i.target.checked),className:"w-3 h-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-600",children:"Low Stock"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:i=>J(i.target.checked),className:"w-3 h-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-600",children:"Featured"})]})]}),e.jsxs("button",{onClick:()=>G("/lats/purchase-order/create"),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg text-sm font-medium hover:from-orange-600 hover:to-orange-700 active:scale-95 transition-all shadow-md hover:shadow-lg ml-auto",title:"Create new purchase order",children:[e.jsx(Jt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Create PO"})]})]})}),ce.length>0&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-5 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-600 text-white rounded-full p-2",children:e.jsx(jt,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-bold text-blue-900",children:[ce.length," product",ce.length!==1?"s":""," selected"]}),e.jsx("div",{className:"text-xs text-blue-700",children:"Choose an action below"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>A("export"),className:"flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Export selected products to CSV",children:[e.jsx(Ht,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),e.jsxs("button",{onClick:()=>A("feature"),className:"flex items-center gap-2 px-4 py-2.5 bg-yellow-500 text-white rounded-lg text-sm font-medium hover:bg-yellow-600 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Toggle featured status",children:[e.jsx(hs,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Feature"})]}),e.jsxs("button",{onClick:()=>A("activate"),className:"flex items-center gap-2 px-4 py-2.5 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Activate selected products",children:[e.jsx(cs,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Activate"})]}),e.jsxs("button",{onClick:()=>A("deactivate"),className:"flex items-center gap-2 px-4 py-2.5 bg-orange-600 text-white rounded-lg text-sm font-medium hover:bg-orange-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Deactivate selected products",children:[e.jsx(Pa,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Deactivate"})]}),e.jsxs("button",{onClick:()=>{var M,P,Y,N,Ae,je,Be,ke,ze,me,De,c,Je,Ne;const i=y.find(fe=>ce.includes(fe.id));i?(we({id:i.id,name:i.name,sku:((P=(M=i.variants)==null?void 0:M[0])==null?void 0:P.sku)||i.id,barcode:((N=(Y=i.variants)==null?void 0:Y[0])==null?void 0:N.sku)||i.id,price:((je=(Ae=i.variants)==null?void 0:Ae[0])==null?void 0:je.sellingPrice)||0,size:((ze=(ke=(Be=i.variants)==null?void 0:Be[0])==null?void 0:ke.attributes)==null?void 0:ze.size)||"",color:((c=(De=(me=i.variants)==null?void 0:me[0])==null?void 0:De.attributes)==null?void 0:c.color)||"",brand:((Je=i.brand)==null?void 0:Je.name)||"",category:((Ne=a.find(fe=>fe.id===i.categoryId))==null?void 0:Ne.name)||""}),X(!0)):f.error("Please select at least one product")},className:"flex items-center gap-2 px-4 py-2.5 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Print product labels",children:[e.jsx(xs,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Labels"})]}),e.jsxs("button",{onClick:()=>A("duplicate"),className:"flex items-center gap-2 px-4 py-2.5 bg-teal-600 text-white rounded-lg text-sm font-medium hover:bg-teal-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Duplicate selected products",children:[e.jsx(Ia,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Duplicate"})]}),e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Delete all selected products",children:[e.jsx(ps,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Delete"})]}),e.jsxs("button",{onClick:()=>xe([]),className:"flex items-center gap-2 px-4 py-2.5 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Clear selection",children:[e.jsx(ds,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Clear"})]})]})]})}),Z==="list"?e.jsx(_t,{className:"overflow-visible",children:e.jsx("div",{className:"overflow-x-auto overflow-y-visible",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200/50",children:[e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:e.jsx("input",{type:"checkbox",checked:ce.length===y.length&&y.length>0,onChange:D,className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2"})}),Se.includes("product")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Product"}),Se.includes("sku")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"SKU"}),Se.includes("category")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Category"}),Se.includes("supplier")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Supplier"}),Se.includes("shelf")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Shelf"}),Se.includes("price")&&e.jsx("th",{className:"text-right py-4 px-4 font-medium text-gray-700",children:"Price"}),Se.includes("stock")&&e.jsx("th",{className:"text-right py-4 px-4 font-medium text-gray-700",children:"Stock"}),Se.includes("actions")&&e.jsx("th",{className:"text-center py-4 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:y.map(i=>{var Je,Ne,fe;y.indexOf(i);const M=i.category||a.find(R=>R.id===i.categoryId),P=(()=>{if(!i.variants||i.variants.length===0)return null;const R=i.variants.find(ye=>(ye.quantity||0)>0);if(R)return R;const Ce=[...i.variants].sort((ye,He)=>(He.sellingPrice||He.price||0)-(ye.sellingPrice||ye.price||0))[0];return Ce&&(Ce.sellingPrice>0||Ce.price>0)?Ce:i.variants[0]})(),N=(()=>{if(P){if(P.sellingPrice>0)return P.sellingPrice;if(P.price>0)return P.price;if(P.unit_price>0)return P.unit_price;if(P.selling_price>0)return P.selling_price}if(i.variants&&i.variants.length>0)for(const R of i.variants){if(R.sellingPrice>0)return R.sellingPrice;if(R.price>0)return R.price;if(R.unit_price>0)return R.unit_price;if(R.selling_price>0)return R.selling_price}return i.price>0?i.price:i.sellingPrice>0?i.sellingPrice:i.unit_price>0?i.unit_price:i.selling_price>0?i.selling_price:0})(),Ae=i.variants&&i.variants.length>0,je=Ae?i.variants.filter(R=>!(R.parent_variant_id||R.parentVariantId||R.variant_type==="imei_child"||R.variantType==="imei_child"||R.name&&R.name.toLowerCase().includes("imei:"))).reduce((R,Ce)=>R+(Ce.quantity||0),0):0,Be=Ae?je:i.stockQuantity||i.stock_quantity||0,ke=((Je=i.variants)==null?void 0:Je.reduce((R,Ce)=>R+(Ce.reservedQuantity||Ce.reserved_quantity||0),0))||0,ze=Be-ke,me=ze<=0?"out-of-stock":ze<=10?"low-stock":"in-stock";return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-blue-50 transition-colors cursor-pointer group",onClick:async()=>{var R,Ce;console.log("üü¢ [Table View] Clicking product row:",i.name,i.id),Ve(!0);try{const ye=await Ft.getState().getProduct(i.id);if(console.log("üü¢ [Table View] Fresh product result:",{ok:ye==null?void 0:ye.ok,hasData:!!(ye!=null&&ye.data),variantCount:((Ce=(R=ye==null?void 0:ye.data)==null?void 0:R.variants)==null?void 0:Ce.length)||0}),!(ye!=null&&ye.ok)||!(ye!=null&&ye.data)){console.error("‚ùå [Table View] Failed to fetch product:",ye==null?void 0:ye.message),Ve(!1),alert("Failed to load product details. Please try again.");return}We(ye.data),Ue(!0)}finally{setTimeout(()=>Ve(!1),100)}},title:"Click to view product details",children:[e.jsx("td",{className:"py-3 px-4",onClick:R=>R.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:ce.includes(i.id),onChange:R=>{R.stopPropagation(),b(i.id)},className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2"})}),Se.includes("product")&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[i.images&&i.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border-2 border-blue-200 bg-white",children:e.jsx("img",{src:i.images[0],alt:i.name,className:"w-full h-full object-cover",onError:R=>{var p;const Ce=((p=i.variants)==null?void 0:p.length)||0,ye=R.currentTarget;ye.style.display="none";const He=ye.parentElement;if(He){He.innerHTML=`
                                            <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center border-2 border-blue-200">
                                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500">
                                                <path d="M16.5 9.4 7.55 4.24"></path>
                                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                                <polyline points="3.29 7 12 12 20.71 7"></polyline>
                                                <line x1="12" x2="12" y1="22" y2="12"></line>
                                              </svg>
                                            </div>
                                          `;const x=He.parentElement;if(x){const L=document.createElement("div");L.className="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",L.innerHTML='<span class="text-xs font-bold text-white">'+Ce+"</span>",x.appendChild(L)}}}})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center z-10",children:e.jsx("span",{className:"text-xs font-bold text-white",children:((Ne=i.variants)==null?void 0:Ne.length)||0})})]}):e.jsxs("div",{className:"w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center border-2 border-blue-200 relative",children:[e.jsx(at,{className:"w-6 h-6 text-blue-500",strokeWidth:2}),e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:((fe=i.variants)==null?void 0:fe.length)||0})})]}),i.isFeatured&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center border-2 border-white",children:e.jsx(hs,{className:"w-3 h-3 text-white fill-current"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[250px]",title:i.name,children:i.name}),i.description&&e.jsx("p",{className:"text-sm text-gray-500 truncate max-w-[300px]",children:i.description})]})]})}),Se.includes("sku")&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-mono text-gray-700",children:(P==null?void 0:P.sku)||i.sku||"N/A"}),e.jsx("button",{onClick:R=>{R.stopPropagation(),ct((P==null?void 0:P.sku)||i.sku||"N/A"),Qe(!0)},className:"text-blue-600 hover:text-blue-800 transition-colors",title:"View QR Code",children:e.jsx(Bt,{size:16})})]})}),Se.includes("category")&&e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-blue-500 text-white shadow-sm inline-block max-w-[150px] truncate",title:(M==null?void 0:M.name)||"Uncategorized",children:(M==null?void 0:M.name)||(i.categoryId?"Loading...":"Uncategorized")})}),Se.includes("supplier")&&e.jsx("td",{className:"py-3 px-4",children:(()=>{var Ce;const R=i.supplier||(i.supplierId?r.find(ye=>ye.id===i.supplierId):null);return(Ce=R==null?void 0:R.name)!=null&&Ce.startsWith("Trade-In:")?e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-blue-600",children:R.name.replace("Trade-In: ","")}),e.jsx("div",{className:"text-xs text-gray-500",children:"Trade-In Customer"})]}):e.jsx("span",{className:"text-sm text-gray-600",children:(R==null?void 0:R.name)||(i.supplierId?"Loading...":"N/A")})})()}),Se.includes("shelf")&&e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-sm text-gray-600",children:i.shelfName||i.shelfCode||"N/A"})}),Se.includes("price")&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:N>0?u(N):e.jsx("span",{className:"text-gray-400 italic",children:"No price set"})}),((P==null?void 0:P.costPrice)||i.costPrice)>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Cost: ",u((P==null?void 0:P.costPrice)||i.costPrice||0)]})]})}),Se.includes("stock")&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-semibold shadow-sm inline-block max-w-[120px] truncate ${me==="out-of-stock"?"bg-red-500 text-white":me==="low-stock"?"bg-orange-500 text-white":"bg-green-500 text-white"}`,title:`${ze} in stock${ke>0?` (${ke} reserved)`:""}`,children:[ze," in stock"]}),ke>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1 truncate max-w-[120px]",title:`${ke} reserved`,children:[ke," reserved"]})]})}),Se.includes("actions")&&e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:R=>{R.stopPropagation(),nt(Ze===i.id?null:i.id)},className:"p-2 text-gray-600 hover:text-white hover:bg-blue-500 rounded-lg transition-all duration-200 hover:shadow-md",title:"Actions",children:e.jsx(Ea,{className:"w-5 h-5"})}),Ze===i.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[998]",onClick:R=>{R.stopPropagation(),nt(null)}}),e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-2xl border border-gray-100 z-[999] overflow-hidden",children:e.jsxs("div",{className:"py-2",children:[e.jsxs("button",{onClick:R=>{R.stopPropagation(),ae.openEditModal(i.id),nt(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-blue-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 group-hover:bg-blue-500 flex items-center justify-center transition-colors",children:e.jsx(It,{className:"w-4 h-4 text-blue-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-blue-600",children:"Edit Product"})]}),e.jsxs("button",{onClick:async R=>{R.stopPropagation();const Ce=await Ft.getState().getProduct(i.id);We(Ce||i),Ue(!0),nt(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-green-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 group-hover:bg-green-500 flex items-center justify-center transition-colors",children:e.jsx(Aa,{className:"w-4 h-4 text-green-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-green-600",children:"View Details"})]}),e.jsx("div",{className:"my-1 border-t border-gray-100"}),e.jsxs("button",{onClick:R=>{R.stopPropagation(),ee(i.id),ve(!0),nt(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-orange-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-orange-100 group-hover:bg-orange-500 flex items-center justify-center transition-colors",children:e.jsx(Da,{className:"w-4 h-4 text-orange-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-orange-600",children:"Adjust Stock"})]}),e.jsxs("button",{onClick:R=>{var Ce,ye,He,p,x,L,K,I,H,oe,Fe,Ye,qe,re;R.stopPropagation(),we({id:i.id,name:i.name,sku:((ye=(Ce=i.variants)==null?void 0:Ce[0])==null?void 0:ye.sku)||i.id,barcode:((p=(He=i.variants)==null?void 0:He[0])==null?void 0:p.sku)||i.id,price:((L=(x=i.variants)==null?void 0:x[0])==null?void 0:L.sellingPrice)||0,size:((H=(I=(K=i.variants)==null?void 0:K[0])==null?void 0:I.attributes)==null?void 0:H.size)||"",color:((Ye=(Fe=(oe=i.variants)==null?void 0:oe[0])==null?void 0:Fe.attributes)==null?void 0:Ye.color)||"",brand:((qe=i.brand)==null?void 0:qe.name)||"",category:((re=a.find(Ke=>Ke.id===i.categoryId))==null?void 0:re.name)||""}),X(!0),nt(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-purple-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-100 group-hover:bg-purple-500 flex items-center justify-center transition-colors",children:e.jsx(xs,{className:"w-4 h-4 text-purple-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-purple-600",children:"Print Label"})]}),e.jsx("div",{className:"my-1 border-t border-gray-100"}),e.jsxs("button",{onClick:R=>{R.stopPropagation(),Ie(i),nt(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-indigo-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-100 group-hover:bg-indigo-500 flex items-center justify-center transition-colors",children:e.jsx(Ma,{className:"w-4 h-4 text-indigo-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-indigo-600",children:"Stock Transfer"})]}),e.jsxs("button",{onClick:R=>{R.stopPropagation(),le(i),nt(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-teal-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-teal-100 group-hover:bg-teal-500 flex items-center justify-center transition-colors",children:e.jsx(Ps,{className:"w-4 h-4 text-teal-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-teal-600",children:"Duplicate"})]})]})})]})]})})]},i.id)})})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"mb-4 bg-gradient-to-r from-gray-50 to-blue-50 border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[y.length," Products"]})]}),ce.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[ce.length," Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ot?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:D,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 rounded-lg transition-colors",children:ce.length===y.length&&y.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"w-4 h-4"}),"Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-4 h-4"}),"Select All"]})}),e.jsxs("button",{onClick:()=>{pt(!1),xe([])},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-white text-red-600 hover:bg-red-50 border border-red-300 rounded-lg transition-colors",children:[e.jsx(ds,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs("button",{onClick:()=>pt(!0),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 border border-blue-600 rounded-lg transition-colors shadow-sm",children:[e.jsx(jt,{className:"w-4 h-4"}),"Select"]}),et==="default"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Per Row:"}),e.jsx("input",{type:"number",min:"1",max:"12",value:it,onChange:i=>{const M=parseInt(i.target.value);M>=1&&M<=12&&h(M)},className:"w-16 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("button",{onClick:()=>mt(et==="detailed"?"default":"detailed"),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 rounded-lg transition-colors",title:`Switch to ${et==="detailed"?"compact":"detailed"} view`,children:et==="detailed"?e.jsxs(e.Fragment,{children:[e.jsx(ws,{className:"w-4 h-4"}),"Compact"]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-4 h-4"}),"Detailed"]})})]})]})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:et==="detailed"?"repeat(auto-fit, minmax(min(280px, 100%), 1fr))":`repeat(${it}, minmax(0, 1fr))`,gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},children:y.map(i=>{const M=a.find(Y=>Y.id===i.categoryId),P=i.brand;return e.jsx(er,{product:{...i,categoryName:M==null?void 0:M.name,brandName:P==null?void 0:P.name},className:"w-full h-full",onView:async Y=>{var N,Ae;console.log("üîµ [Grid View] Clicking product:",Y.name,Y.id),Ve(!0);try{const je=await Ft.getState().getProduct(Y.id);if(console.log("üîµ [Grid View] Fresh product result:",{ok:je==null?void 0:je.ok,hasData:!!(je!=null&&je.data),variantCount:((Ae=(N=je==null?void 0:je.data)==null?void 0:N.variants)==null?void 0:Ae.length)||0}),!(je!=null&&je.ok)||!(je!=null&&je.data)){console.error("‚ùå [Grid View] Failed to fetch product:",je==null?void 0:je.message),Ve(!1),alert("Failed to load product details. Please try again.");return}We(je.data),Ue(!0)}finally{setTimeout(()=>Ve(!1),100)}},onEdit:Y=>{ae.openEditModal(Y.id)},onDelete:Y=>{confirm("Are you sure you want to delete this product?")&&de(Y.id)},showActions:!0,variant:et,isSelected:ce.includes(i.id),onSelect:b,showCheckbox:ot},i.id)})})]}),y.length===0&&e.jsxs(_t,{className:"text-center py-12",children:[e.jsx(at,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search or filter criteria"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsx(Mt,{onClick:()=>{onAddProduct?onAddProduct():G("/lats/add-product")},icon:e.jsx(at,{size:18}),children:"Add Your First Product"})})]}),Pe&&e.jsx(Nr,{isOpen:j,onClose:()=>{X(!1),we(null)},product:Pe,formatMoney:u}),Me&&e.jsx(Sr,{isOpen:ne,onClose:()=>{Ue(!1),We(null)},product:Me,onEdit:i=>{Ue(!1),We(null),ae.openEditModal(i.id)}}),Le&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 relative",children:[e.jsx("button",{onClick:()=>Qe(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(st,{size:24})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Product QR Code"}),e.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-gray-200 inline-block mb-4",children:e.jsx(ur,{value:Te,size:200,level:"H"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"SKU"}),e.jsx("p",{className:"font-mono text-lg font-semibold text-gray-900",children:Te})]})]})]})}),tt&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full p-6 relative",children:[e.jsx("button",{onClick:()=>rt(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(st,{size:24})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx($s,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Customize Columns"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose which columns to display in the table"})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:lt.map(i=>e.jsxs("label",{className:`flex items-center gap-3 p-4 rounded-lg border transition-all ${i.required?"cursor-not-allowed bg-gray-50 border-gray-200":"cursor-pointer hover:bg-blue-50 border-gray-200 hover:border-blue-300"}`,children:[e.jsx("input",{type:"checkbox",checked:Se.includes(i.id),onChange:()=>V(i.id),disabled:i.required,className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i.label}),i.required&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(always visible)"})]}),i.required&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]},i.id))}),e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{ht(lt.map(i=>i.id)),f.success("All columns enabled")},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Show All Columns"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>rt(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>rt(!1),className:"px-4 py-2 text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors",children:"Done"})]})]})]})}),Xe&&e.jsx(jr,{})]})},Cr=n.memo(_r,(y,T)=>{const s=["products","metrics","categories","suppliers","selectedProducts","selectedCategory","selectedStatus","showLowStockOnly","showFeaturedOnly","viewMode","sortBy"];for(const te of s)if(y[te]!==T[te])return!1;return!0});class Es{static clearCache(){this.cache.data=null,this.cache.timestamp=0,console.log("üóëÔ∏è [LiveInventoryService] Cache cleared")}static async getLiveInventoryMetrics(){const T=Date.now();if(this.cache.data&&T-this.cache.timestamp<this.CACHE_DURATION)return this.cache.data;try{const s=localStorage.getItem("current_branch_id");console.log("üè™ [LiveInventoryService] Current branch:",s);const te=await ia();let U=pe.from("lats_product_variants").select("id, product_id, quantity, cost_price, unit_price, selling_price, min_quantity, branch_id, is_shared"),B=null;if(s)try{const{data:W}=await pe.from("store_locations").select("data_isolation_mode, share_inventory").eq("id",s).single();B=W}catch{console.warn("‚ö†Ô∏è [LiveInventoryService] Could not fetch branch settings")}s&&B?B.data_isolation_mode==="isolated"?(U=U.eq("branch_id",s),console.log(`üîí [LiveInventoryService] ISOLATED MODE - Variants: Only showing from branch ${s}`)):B.data_isolation_mode==="shared"?console.log("üìä [LiveInventoryService] SHARED MODE - Variants: Showing all variants"):B.data_isolation_mode==="hybrid"&&(B.share_inventory?(U=U.or(`branch_id.eq.${s},is_shared.eq.true,branch_id.is.null`),console.log(`‚öñÔ∏è [LiveInventoryService] HYBRID MODE - Variants are SHARED - Showing branch ${s} + shared variants`)):(U=U.eq("branch_id",s),console.log(`‚öñÔ∏è [LiveInventoryService] HYBRID MODE - Variants are NOT SHARED - Only showing branch ${s}`))):s?U=U.or(`branch_id.eq.${s},branch_id.is.null`):console.log("‚ö†Ô∏è [LiveInventoryService] No branch selected - showing all data");const{data:be,error:m}=await U;if(m)throw console.error("‚ùå [LiveInventoryService] Error fetching variants:",m),m;const z=te.map(W=>({id:W.id,name:W.name,is_active:W.isActive,branch_id:W.branchId,is_shared:W.isShared})),_=be.reduce((W,A)=>(W[A.product_id]||(W[A.product_id]=[]),W[A.product_id].push(A),W),{}),J=z.map(W=>({...W,lats_product_variants:_[W.id]||[]}));let Z=0,he=0,ie=0,F=(J==null?void 0:J.length)||0,ce=0,xe=0,a=0,r=0;J==null||J.forEach(W=>{const A=W.lats_product_variants||[];W.is_active&&ce++;const ee=A.reduce((ae,G)=>ae+(G.quantity||0),0);ie+=ee;const v=A.reduce((ae,G)=>{const de=G.cost_price||0,$=G.quantity||0,j=de*$;return ae+j},0);Z+=v;const b=A.reduce((ae,G)=>{const de=G.selling_price||0,$=G.quantity||0,j=de*$;return ae+j},0);he+=b,ee<=0?a++:ee<=10&&xe++;const D=A[0];D!=null&&D.min_quantity&&ee<=D.min_quantity&&r++});const u={totalValue:Z,retailValue:he,totalStock:ie,totalProducts:F,activeProducts:ce,lowStockItems:xe,outOfStockItems:a,reorderAlerts:r,lastUpdated:new Date().toISOString()};return this.cache.data=u,this.cache.timestamp=T,u}catch(s){throw console.error("‚ùå [LiveInventoryService] Error calculating live metrics:",s),s}}static async getLiveInventoryValue(){try{console.log("üîç [LiveInventoryService] Fetching live inventory value breakdown...");const{data:T,error:s}=await pe.from("lats_product_variants").select("id, quantity, cost_price, unit_price, product_id");if(s)throw console.error("‚ùå [LiveInventoryService] Error fetching variants:",s),s;const te=(T==null?void 0:T.map(ie=>ie.product_id).filter(Boolean))||[],{data:U,error:B}=await pe.from("lats_products").select("id").eq("is_active",!0).in("id",te);B&&console.warn("‚ö†Ô∏è [LiveInventoryService] Error fetching active products:",B);const be=new Set((U==null?void 0:U.map(ie=>ie.id))||[]),m=(T==null?void 0:T.filter(ie=>be.has(ie.product_id)))||[];console.log(`üì¶ [LiveInventoryService] Fetched ${(m==null?void 0:m.length)||0} active variants for value calculation`);let z=0,_=0;m==null||m.forEach(ie=>{const F=ie.quantity||0,ce=ie.cost_price||0,xe=ie.selling_price||0;z+=ce*F,_+=xe*F});const J=_-z,Z=z>0?J/z*100:0,he={costValue:z,retailValue:_,potentialProfit:J,profitMargin:Z};return console.log("‚úÖ [LiveInventoryService] Live value calculated:",{costValue:he.costValue,retailValue:he.retailValue,potentialProfit:he.potentialProfit,profitMargin:he.profitMargin}),he}catch(T){throw console.error("‚ùå [LiveInventoryService] Error calculating live value:",T),T}}static async getLiveCategoryMetrics(T){try{console.log(`üîç [LiveInventoryService] Fetching live metrics for category: ${T}`);const[s,te]=await Promise.allSettled([pe.from("lats_products").select("id, name, is_active, category_id").eq("category_id",T),pe.from("lats_product_variants").select("id, product_id, quantity, cost_price, unit_price, selling_price, min_quantity")]);if(s.status==="rejected")throw console.error("‚ùå [LiveInventoryService] Error fetching category products:",s.reason),s.reason;const U=s.value.data||[],B=te.status==="fulfilled"?te.value.data||[]:[],be=new Set(U.map(a=>a.id)),z=B.filter(a=>be.has(a.product_id)).reduce((a,r)=>(a[r.product_id]||(a[r.product_id]=[]),a[r.product_id].push(r),a),{}),_=U.map(a=>({...a,lats_product_variants:z[a.id]||[]}));let J=0,Z=0,he=(_==null?void 0:_.length)||0,ie=0,F=0,ce=0,xe=0;return _==null||_.forEach(a=>{const r=a.lats_product_variants||[];a.is_active&&ie++;const W=r.reduce((ee,v)=>ee+(v.quantity||0),0);Z+=W;const A=r.reduce((ee,v)=>{const b=v.cost_price||0,D=v.quantity||0;return ee+b*D},0);J+=A,W<=0?ce++:W<=10&&F++;const ve=r[0];ve!=null&&ve.min_quantity&&W<=ve.min_quantity&&xe++}),{totalValue:J,totalStock:Z,totalProducts:he,activeProducts:ie,lowStockItems:F,outOfStockItems:ce,reorderAlerts:xe,lastUpdated:new Date().toISOString()}}catch(s){throw console.error("‚ùå [LiveInventoryService] Error calculating category metrics:",s),s}}static async getLiveSupplierMetrics(T){try{console.log(`üîç [LiveInventoryService] Fetching live metrics for supplier: ${T}`);const[s,te]=await Promise.allSettled([pe.from("lats_products").select("id, name, is_active, supplier_id").eq("supplier_id",T),pe.from("lats_product_variants").select("id, product_id, quantity, cost_price, unit_price, selling_price, min_quantity")]);if(s.status==="rejected")throw console.error("‚ùå [LiveInventoryService] Error fetching supplier products:",s.reason),s.reason;const U=s.value.data||[],B=te.status==="fulfilled"?te.value.data||[]:[],be=new Set(U.map(a=>a.id)),z=B.filter(a=>be.has(a.product_id)).reduce((a,r)=>(a[r.product_id]||(a[r.product_id]=[]),a[r.product_id].push(r),a),{}),_=U.map(a=>({...a,lats_product_variants:z[a.id]||[]}));let J=0,Z=0,he=(_==null?void 0:_.length)||0,ie=0,F=0,ce=0,xe=0;return _==null||_.forEach(a=>{const r=a.lats_product_variants||[];a.is_active&&ie++;const W=r.reduce((ee,v)=>ee+(v.quantity||0),0);Z+=W;const A=r.reduce((ee,v)=>{const b=v.cost_price||0,D=v.quantity||0;return ee+b*D},0);J+=A,W<=0?ce++:W<=10&&F++;const ve=r[0];ve!=null&&ve.min_quantity&&W<=ve.min_quantity&&xe++}),{totalValue:J,totalStock:Z,totalProducts:he,activeProducts:ie,lowStockItems:F,outOfStockItems:ce,reorderAlerts:xe,lastUpdated:new Date().toISOString()}}catch(s){throw console.error("‚ùå [LiveInventoryService] Error calculating supplier metrics:",s),s}}}Es.cache={data:null,timestamp:0};Es.CACHE_DURATION=3e4;const fi=()=>{const y=Ws(),T=fr(),{startLoading:s,updateProgress:te,completeLoading:U,failLoading:B}=na(),{errorState:be,clearError:m,withErrorHandling:z}=ca({maxRetries:3,showToast:!0,logToConsole:!0}),{products:_,categories:J,suppliers:Z,stockMovements:he,sales:ie,isLoading:F,loadProducts:ce,loadCategories:xe,loadSuppliers:a,loadStockMovements:r,loadSales:u,createCategory:W,createSupplier:A,updateProduct:ve,deleteProduct:ee,adjustStock:v,forceRefreshProducts:b}=Ft(),[D,ae]=n.useState("connecting"),[G,de]=n.useState(!1),[$,j]=n.useState(0),X=3e3,[Pe,we]=n.useState(!0),[ne,Ue]=n.useState({categories:!1,suppliers:!1,products:!1,stockMovements:!1,sales:!1}),[Me,We]=n.useState({categories:null,suppliers:null,products:null,stockMovements:null,sales:null}),[Le,Qe]=n.useState(null),[Te,ct]=n.useState(!1),[Ze,nt]=n.useState("inventory"),[tt,rt]=n.useState(""),[Xe,Ve]=n.useState("all"),lt=Et.useRef(null),[Se,ht]=n.useState("all"),[gt,dt]=n.useState("all"),[ft,vt]=n.useState(!1),[et,mt]=n.useState(!1),[ot,pt]=n.useState(!1),[it,h]=n.useState(!1),[V,le]=n.useState("list"),[Ie,Re]=n.useState("created"),[i,M]=n.useState([]),[P,Y]=n.useState(!1),[N,Ae]=n.useState(!1),[je,Be]=n.useState(!1),[ke,ze]=n.useState(!1),[me,De]=n.useState(!1),[c,Je]=n.useState(null),[Ne,fe]=n.useState(!1),[R,Ce]=n.useState(!1),[ye,He]=n.useState(!1);n.useEffect(()=>{const g=o=>{o.target.closest(".more-actions-dropdown")||fe(!1)};return Ne&&document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[Ne]),n.useEffect(()=>{(async()=>{if(G)return;if(Date.now()-$<X&&Me.products&&Me.categories){we(!1);return}const k=s("Loading inventory data...");await z(async()=>{de(!0),ae("connecting"),we(!0),te(k,10);try{const E=Date.now();Ue({categories:!1,suppliers:!1,products:!1,stockMovements:!1,sales:!1});const C=[xe().then(()=>{Ue(O=>({...O,categories:!0}))}).catch(O=>{console.error("‚ùå Failed to load categories:",O),Ue(se=>({...se,categories:!0}))}),a().then(()=>{Ue(O=>({...O,suppliers:!0}))}).catch(O=>{console.error("‚ùå Failed to load suppliers:",O),Ue(se=>({...se,suppliers:!0}))})];await Promise.allSettled(C),te(k,40),await ce({page:1,limit:100}).catch(O=>{console.error("‚ùå Failed to load products:",O)}),Ue(O=>({...O,products:!0})),te(k,70);const S=[r().then(()=>{Ue(O=>({...O,stockMovements:!0}))}).catch(O=>{console.error("‚ùå Failed to load stock movements:",O),Ue(se=>({...se,stockMovements:!0}))}),u().then(()=>{Ue(O=>({...O,sales:!0}))}).catch(O=>{console.error("‚ùå Failed to load sales:",O),Ue(se=>({...se,sales:!0}))})];await Promise.allSettled(S),te(k,100),We({categories:J,suppliers:Z,products:_,stockMovements:he,sales:ie});const q=Date.now()-E;ae("connected"),j(Date.now()),we(!1),U(k)}catch{f.error("Failed to load data from database"),ae("error"),we(!1),B(k,"Failed to load inventory data")}finally{de(!1)}},"Loading unified inventory data")})()},[]);const p=n.useCallback(async()=>{if(!Te){ct(!0);try{const g=await Es.getLiveInventoryMetrics();Qe(g)}catch{}finally{ct(!1)}}},[]);n.useEffect(()=>{if(_.length>0&&!Te){const g=setTimeout(()=>{p()},1e3);return()=>clearTimeout(g)}},[_.length]),n.useEffect(()=>{const g=se=>{setTimeout(()=>{p()},500)},o=se=>{setTimeout(()=>{p()},500)},k=se=>{setTimeout(()=>{p()},500)},E=se=>{console.log("üì¶ [UnifiedInventoryPage] Purchase order received, refreshing inventory...",se),setTimeout(async()=>{await ce({page:1,limit:100}),p()},1e3)},C=os.subscribe("lats:stock.updated",g),S=os.subscribe("lats:product.updated",o),q=os.subscribe("lats:sale.completed",k),O=os.subscribe("lats:purchase-order.received",E);return()=>{C(),S(),q(),O()}},[p,ce]);const x=n.useCallback(()=>{try{const g=`data:text/csv;charset=utf-8,Name,SKU,Category,Price,Stock,Status,Description
`+_.map(E=>{var q;const C=J.find(O=>O.id===E.categoryId),S=(q=E.variants)==null?void 0:q[0];return`"${E.name}","${(S==null?void 0:S.sku)||"N/A"}","${(C==null?void 0:C.name)||"Uncategorized"}","${(S==null?void 0:S.sellingPrice)||0}","${E.totalQuantity||0}","Active","${E.description||""}"`}).join(`
`),o=encodeURI(g),k=document.createElement("a");k.setAttribute("href",o),k.setAttribute("download",`product-inventory-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(k),k.click(),document.body.removeChild(k),f.success("Product inventory exported successfully!")}catch{f.error("Failed to export product inventory")}},[_,J]);n.useEffect(()=>{const g=o=>{var k,E,C;if((o.ctrlKey||o.metaKey)&&o.key==="k"&&(o.preventDefault(),(k=lt.current)==null||k.focus(),(E=lt.current)==null||E.select()),(o.ctrlKey||o.metaKey)&&o.key==="n"&&(o.preventDefault(),Ce(!0)),(o.ctrlKey||o.metaKey)&&o.key==="i"&&(o.preventDefault(),y("/lats/bulk-import")),(o.ctrlKey||o.metaKey)&&o.key==="e"&&(o.preventDefault(),x()),o.key==="Escape"&&tt&&(rt(""),(C=lt.current)==null||C.blur()),o.key==="1"&&!o.ctrlKey&&!o.metaKey&&!o.altKey){const S=o.target;S.tagName!=="INPUT"&&S.tagName!=="TEXTAREA"&&nt("inventory")}};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[y,tt,x]);const L=n.useMemo(()=>{if(Le)return{totalItems:Le.totalProducts,lowStockItems:Le.lowStockItems,outOfStockItems:Le.outOfStockItems,reorderAlerts:Le.reorderAlerts,totalValue:Le.totalValue,retailValue:Le.retailValue||0,activeProducts:Le.activeProducts,featuredProducts:_.filter(se=>se.isFeatured).length,lastUpdated:Le.lastUpdated};const g=_.length,o=_.filter(se=>{var Ge;const _e=((Ge=se.variants)==null?void 0:Ge.reduce(($e,Oe)=>$e+(Oe.quantity||0),0))||0;return _e>0&&_e<=10}).length,k=_.filter(se=>{var Ge;return(((Ge=se.variants)==null?void 0:Ge.reduce(($e,Oe)=>$e+(Oe.quantity||0),0))||0)<=0}).length,E=_.filter(se=>{var $e,Oe;const _e=($e=se.variants)==null?void 0:$e[0],Ge=((Oe=se.variants)==null?void 0:Oe.reduce((t,l)=>t+(l.quantity||0),0))||0;return(_e==null?void 0:_e.minQuantity)&&Ge<=_e.minQuantity}).length,C=_.reduce((se,_e)=>{var $e;const Ge=(($e=_e.variants)==null?void 0:$e.reduce((Oe,t)=>{const l=t.costPrice||0,d=t.quantity||0;return Oe+l*d},0))||0;return se+Ge},0),S=_.reduce((se,_e)=>{var $e;const Ge=(($e=_e.variants)==null?void 0:$e.reduce((Oe,t)=>{const l=t.sellingPrice||t.price||0,d=t.quantity||0;return Oe+l*d},0))||0;return se+Ge},0),q=_.length,O=_.filter(se=>se.isFeatured).length;return{totalItems:g,lowStockItems:o,outOfStockItems:k,reorderAlerts:E,totalValue:C,retailValue:S,activeProducts:q,featuredProducts:O,lastUpdated:new Date().toISOString()}},[_,Le]),K=n.useMemo(()=>{let g=_;if(tt){const o=tt.toLowerCase();g.length,g=g.filter(k=>{var E,C,S;return k.name.toLowerCase().includes(o)||((E=k.description)==null?void 0:E.toLowerCase().includes(o))||((C=k.category)==null?void 0:C.name.toLowerCase().includes(o))||((S=k.variants)==null?void 0:S.some(q=>{var O,se,_e;return((O=q.name)==null?void 0:O.toLowerCase().includes(o))||((se=q.sku)==null?void 0:se.toLowerCase().includes(o))||((_e=q.barcode)==null?void 0:_e.toLowerCase().includes(o))}))})}return Xe!=="all"&&(g=g.filter(o=>{var k;return((k=J.find(E=>E.id===o.categoryId))==null?void 0:k.name)===Xe})),Ze==="inventory"&&(Se==="in-stock"?g=g.filter(o=>{var E;return(((E=o.variants)==null?void 0:E.reduce((C,S)=>C+(S.quantity||0),0))||0)>10}):Se==="low-stock"?g=g.filter(o=>{var E;const k=((E=o.variants)==null?void 0:E.reduce((C,S)=>C+(S.quantity||0),0))||0;return k>0&&k<=10}):Se==="out-of-stock"&&(g=g.filter(o=>{var E;return(((E=o.variants)==null?void 0:E.reduce((C,S)=>C+(S.quantity||0),0))||0)<=0}))),Ze==="inventory"&&ot&&(g=g.filter(o=>{var E;const k=((E=o.variants)==null?void 0:E.reduce((C,S)=>C+(S.quantity||0),0))||0;return k>0&&k<=10})),Ze==="inventory"&&it&&(g=g.filter(o=>o.isFeatured)),g.sort((o,k)=>{var E,C,S,q,O,se;switch(Ie){case"name":return o.name.localeCompare(k.name);case"price":return(((C=(E=o.variants)==null?void 0:E[0])==null?void 0:C.sellingPrice)||0)-(((q=(S=k.variants)==null?void 0:S[0])==null?void 0:q.sellingPrice)||0);case"stock":const _e=((O=o.variants)==null?void 0:O.reduce(($e,Oe)=>$e+(Oe.quantity||0),0))||0;return(((se=k.variants)==null?void 0:se.reduce(($e,Oe)=>$e+(Oe.quantity||0),0))||0)-_e;case"created":return new Date(k.createdAt).getTime()-new Date(o.createdAt).getTime();default:return 0}}),g},[_,tt,Xe,Se,ot,it,Ie,Ze,J]),I=g=>Ee.money(g),H=g=>{switch(g){case"in-stock":return"bg-green-100 text-green-800";case"low-stock":return"bg-yellow-100 text-yellow-800";case"out-of-stock":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},oe=async(g,o,k,E)=>{try{await v(g,o,k,E),f.success("Stock adjusted successfully"),setTimeout(()=>{p()},1e3)}catch{f.error("Failed to adjust stock")}},Fe=async g=>{if(i.length===0){f.error("Please select products first");return}switch(g){case"export":try{const o=`data:text/csv;charset=utf-8,Name,SKU,Category,Price,Stock,Status
`+i.map(C=>{var se;const S=_.find(_e=>_e.id===C);if(!S)return"";const q=J.find(_e=>_e.id===S.categoryId),O=(se=S.variants)==null?void 0:se[0];return`${S.name},${(O==null?void 0:O.sku)||"N/A"},${(q==null?void 0:q.name)||"Uncategorized"},${(O==null?void 0:O.sellingPrice)||0},${S.totalQuantity||0},Active`}).filter(C=>C!=="").join(`
`),k=encodeURI(o),E=document.createElement("a");E.setAttribute("href",k),E.setAttribute("download",`products-export-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(E),E.click(),document.body.removeChild(E),f.success(`Exported ${i.length} products successfully!`)}catch{f.error("Failed to export products")}break;case"delete":if(confirm(`Are you sure you want to delete ${i.length} products? This action cannot be undone.`))try{const o=i.map(k=>ee(k));await Promise.all(o),f.success(`Successfully deleted ${i.length} products`),M([])}catch{f.error("Failed to delete some products")}break;case"feature":try{const o=i.map(async C=>{const S=_.find(q=>q.id===C);if(S){const q=!S.isFeatured;await ve(C,{isFeatured:q,isActive:!0})}});await Promise.all(o);const k=_.find(C=>C.id===i[0]),E=k!=null&&k.isFeatured?"unfeatured":"featured";f.success(`Successfully ${E} ${i.length} product${i.length!==1?"s":""}`),M([])}catch(o){console.error("Feature error:",o),f.error("Failed to update product featured status")}break;case"print-labels":try{f.success(`Preparing labels for ${i.length} product${i.length!==1?"s":""}...`)}catch(o){console.error("Print labels error:",o),f.error("Failed to print labels")}break;case"duplicate":try{const o=i.map(E=>{var S;const C=_.find(q=>q.id===E);return C?{name:C.name,categoryId:C.categoryId,variants:(S=C.variants)==null?void 0:S.map(q=>({sku:q.sku,sellingPrice:q.sellingPrice,costPrice:q.costPrice,quantity:q.quantity,attributes:q.attributes}))}:null}).filter(Boolean),k=JSON.stringify(o,null,2);navigator.clipboard.writeText(k),f.success(`Copied ${i.length} product${i.length!==1?"s":""} data to clipboard!
You can use this to create new products.`,{duration:4e3})}catch(o){console.error("Duplicate error:",o),f.error("Failed to copy product data to clipboard")}break;default:f.error("Unknown action")}},Ye=()=>{vt(!0)},qe=async g=>{vt(!1),f.success(`Successfully imported ${g.length} products!`),await Promise.all([ce({page:1,limit:50}),xe(),a()])},re=g=>{M(o=>o.includes(g)?o.filter(k=>k!==g):[...o,g])},Ke=()=>{i.length===K.length?M([]):M(K.map(g=>g.id))};return be.hasError?e.jsx(da,{error:be.error||"An unexpected error occurred",action:{label:"Retry",onClick:()=>window.location.reload(),variant:"primary"},secondaryAction:{label:"Clear Error",onClick:m,variant:"secondary"}}):Pe&&_.length===0?e.jsx(xr,{}):e.jsxs(oa,{pageName:"Unified Inventory Management",showDetails:!0,children:[e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 group",children:[e.jsxs("button",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-3 py-2 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2 text-sm font-medium",onClick:()=>fe(!Ne),children:[e.jsx("span",{children:"‚å®Ô∏è"}),e.jsx("span",{className:"hidden md:inline",children:"Shortcuts"})]}),e.jsxs("div",{className:"absolute bottom-14 right-0 w-64 bg-white/95 backdrop-blur-xl rounded-xl shadow-2xl border border-gray-200/50 p-4 opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity duration-200",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-800 mb-2",children:"‚å®Ô∏è Keyboard Shortcuts"}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Focus Search"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"‚åòK"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Add Product"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"‚åòN"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Bulk Import"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"‚åòI"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Export Data"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"‚åòE"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Clear Search"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"ESC"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Manage Orders"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"Click Button"})]})]})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(la,{to:"/dashboard"}),e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(at,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage products and inventory in one place"})]})]})}),e.jsx("div",{className:"px-8 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100/50 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>ze(!0),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg hover:from-indigo-600 hover:to-purple-700",children:[e.jsx(rs,{size:18}),e.jsx("span",{children:"Manage Categories"})]}),e.jsxs("button",{onClick:()=>Ce(!0),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg hover:from-blue-600 hover:to-blue-700",title:"Add a new product (‚åòN)",children:[e.jsx(Vt,{size:18}),e.jsx("span",{children:"Add Product"})]}),e.jsxs("button",{onClick:()=>y("/lats/purchase-order/create"),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-orange-500 to-amber-600 text-white shadow-lg hover:from-orange-600 hover:to-amber-700",children:[e.jsx(gs,{size:18}),e.jsx("span",{children:"Create PO"})]}),e.jsxs("button",{onClick:Ye,className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg hover:from-green-600 hover:to-emerald-700",children:[e.jsx(Bs,{size:18}),e.jsx("span",{children:"Import Excel"})]}),e.jsxs("button",{onClick:()=>mt(!0),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-cyan-500 to-teal-600 text-white shadow-lg hover:from-cyan-600 hover:to-teal-700",children:[e.jsx(Ht,{size:18}),e.jsx("span",{children:"Export Excel"})]}),e.jsxs("button",{onClick:async()=>{de(!0);try{await Promise.all([p(),b()]),f.success("Data refreshed successfully!")}catch{f.error("Failed to refresh data")}finally{de(!1)}},disabled:Te||G,className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-gray-500 to-gray-600 text-white shadow-lg hover:from-gray-600 hover:to-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(qs,{size:18,className:Te||G?"animate-spin":""}),e.jsx("span",{children:Te||G?"Refreshing...":"Refresh"})]})]})}),e.jsx("div",{className:"px-8 py-2 bg-white flex-shrink-0 border-b border-gray-100",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"relative more-actions-dropdown",children:[e.jsxs("button",{onClick:()=>fe(!Ne),className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors text-sm bg-white shadow-sm hover:shadow-md",title:"More actions",children:[e.jsx(La,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"More"})]}),Ne&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-64 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-50 to-gray-50 px-4 py-3 border-b border-gray-100",children:e.jsxs("h3",{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(zs,{size:16,className:"text-slate-600"}),"More Actions"]})}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{He(!0),fe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-purple-50 transition-colors text-left group",children:[e.jsx("div",{className:"w-9 h-9 bg-purple-500/10 rounded-lg flex items-center justify-center",children:e.jsx(Jt,{size:16,className:"text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:"Manage Orders"}),e.jsx("div",{className:"text-xs text-gray-500",children:"View purchase orders"})]})]}),e.jsx("div",{className:"border-t border-gray-100 my-2"}),D==="error"&&e.jsxs("button",{onClick:async()=>{ae("connecting");try{await Promise.all([ce({page:1,limit:100}),xe(),a()]),ae("connected"),f.success("Reconnected successfully!")}catch{ae("error"),f.error("Failed to reconnect")}finally{fe(!1)}},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-red-50 transition-colors text-left group mt-1",children:[e.jsx("div",{className:"w-9 h-9 bg-red-500/10 rounded-lg flex items-center justify-center",children:e.jsx(qs,{size:16,className:"text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:"Retry Connection"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Reconnect to database"})]})]}),e.jsx("div",{className:"border-t border-gray-100 my-2"}),e.jsxs("button",{onClick:()=>{Be(!0),fe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition-colors text-left group",children:[e.jsx("div",{className:"w-9 h-9 bg-blue-500/10 rounded-lg flex items-center justify-center",children:e.jsx(rs,{size:16,className:"text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:"Add Category"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Organize products"})]})]}),e.jsxs("button",{onClick:()=>{De(!0),fe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-purple-50 transition-colors text-left group mt-1",children:[e.jsx("div",{className:"w-9 h-9 bg-purple-500/10 rounded-lg flex items-center justify-center",children:e.jsx(gs,{size:16,className:"text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:"Add Supplier"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Manage suppliers"})]})]}),e.jsx("div",{className:"border-t border-gray-100 my-2"}),e.jsxs("button",{onClick:()=>{y("/excel-templates"),fe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-indigo-50 transition-colors text-left group",children:[e.jsx("div",{className:"w-9 h-9 bg-indigo-500/10 rounded-lg flex items-center justify-center",children:e.jsx(Yt,{size:16,className:"text-indigo-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:"Download Template"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Excel templates"})]})]}),e.jsxs("button",{onClick:()=>{x(),fe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-orange-50 transition-colors text-left group mt-1",children:[e.jsx("div",{className:"w-9 h-9 bg-orange-500/10 rounded-lg flex items-center justify-center",children:e.jsx(Ht,{size:16,className:"text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:"Export CSV"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Download CSV data"})]})]})]})]})]})})})]}),Pe&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(8)].map((g,o)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},o))})]})}),e.jsx(Cr,{products:K,metrics:L,searchQuery:tt,setSearchQuery:rt,selectedCategory:Xe,setSelectedCategory:Ve,selectedBrand:gt,setSelectedBrand:dt,selectedStatus:Se,setSelectedStatus:ht,showLowStockOnly:ot,setShowLowStockOnly:pt,showFeaturedOnly:it,setShowFeaturedOnly:h,viewMode:V,setViewMode:le,sortBy:Ie,setSortBy:Re,selectedProducts:i,setSelectedProducts:M,categories:J,suppliers:Z,brands:[],formatMoney:I,getStatusColor:H,handleStockAdjustment:oe,handleBulkAction:Fe,setShowStockAdjustModal:Ae,setSelectedProductForHistory:Je,setShowDeleteConfirmation:Y,toggleProductSelection:re,toggleSelectAll:Ke,navigate:y,productModals:T,deleteProduct:ee,onAddProduct:()=>Ce(!0)}),N&&c&&e.jsx(Is,{product:_.find(g=>g.id===c)||void 0,isOpen:N,onClose:()=>{Ae(!1),Je(null)},onSubmit:async g=>{const{variant:o,...k}=g;let E=k.quantity;k.adjustmentType==="out"?E=-E:k.adjustmentType==="set"&&(E=E-o.quantity),await oe(c,o.id,E,k.reason)},loading:F}),e.jsx(Fa,{isOpen:je,onClose:()=>Be(!1),onSubmit:async g=>{try{await W(g),f.success("Category created successfully"),Be(!1)}catch{f.error("Failed to create category")}},parentCategories:J,loading:F}),ke&&e.jsx(gr,{isOpen:ke,onClose:()=>ze(!1),categories:J||[],onCategoryUpdate:async()=>{await xe()}}),me&&e.jsx(Oa,{onSubmit:async g=>{try{const o={...g,leadTimeDays:7,isActive:!0,country:g.country||"TZ",currency:g.currency||"TZS"};await A(o),f.success("Supplier created successfully"),De(!1)}catch{f.error("Failed to create supplier")}},onClose:()=>De(!1)}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>Y(!1),children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(ps,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Products"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),e.jsxs("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold",children:i.length})," product",i.length!==1?"s":"","? This action will permanently remove them from your inventory."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(Mt,{variant:"secondary",onClick:()=>Y(!1),className:"text-sm",children:"Cancel"}),e.jsxs(Mt,{onClick:()=>{Fe("delete"),Y(!1)},className:"text-sm bg-red-600 hover:bg-red-700 text-white",children:["Delete ",i.length," Product",i.length!==1?"s":""]})]})]})})]}),e.jsx(pr,{isOpen:ft,onClose:()=>vt(!1),onImportComplete:qe}),et&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[99999]",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:()=>mt(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(st,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx(br,{})})]})}),e.jsx(Qa,{isOpen:R,onClose:()=>Ce(!1),onProductCreated:async()=>{Ce(!1),await ce(),f.success("Product created successfully!")}}),e.jsx(vr,{isOpen:T.showEditModal,onClose:T.closeEditModal,productId:T.editingProductId||"",onProductUpdated:async()=>{await ce(),f.success("Product updated successfully!")},onSuccess:()=>{T.closeEditModal()}}),e.jsx(nr,{isOpen:ye,onClose:()=>He(!1)})]})};export{fi as default};
