import{j as e,e as B,G as k,s as v}from"./index-61458a34.js";import{r as l}from"./vendor-36d2c7c1.js";import{r as A,X as R,A as L,U as y,y as q,n as z}from"./ui-28e30067.js";import{u as G,S as F}from"./useSuccessModal-081786c4.js";import{S as T}from"./SuccessModalIcons-fe811e4d.js";import{f as H}from"./appointments-0b344a33.js";import{u as W}from"./useBodyScrollLock-341c8b9f.js";const O=({isOpen:m,onClose:h,customer:r,appointment:n,onSave:E,mode:d})=>{const[a,o]=l.useState({customer_id:(r==null?void 0:r.id)||"",service_type:"",appointment_date:"",appointment_time:"",notes:"",duration_minutes:60,priority:"medium",location:"",technician_id:""}),[p,j]=l.useState(!1),[N,g]=l.useState(null),[w,_]=l.useState(null),[P,$]=l.useState([]),[f,S]=l.useState([]),[c,C]=l.useState(""),b=G();l.useEffect(()=>{m&&(async()=>{try{const{data:s}=await v.from("users").select("id, full_name, name").in("role",["tech","technician","admin","manager"]).order("full_name");$((s==null?void 0:s.map(u=>({id:u.id,name:u.full_name||u.name||"Unknown"})))||[]);const{data:i}=await v.from("customers").select("id, name, phone").limit(50).order("name");S(i||[])}catch(s){console.error("Error loading dropdown data:",s)}})()},[m]),l.useEffect(()=>{const s=setTimeout(async()=>{if(!(!c||c.length<2))try{const{data:i}=await v.from("customers").select("id, name, phone").or(`name.ilike.%${c}%,phone.ilike.%${c}%`).limit(20).order("name");i&&S(i)}catch(i){console.error("Error searching customers:",i)}},300);return()=>clearTimeout(s)},[c]),l.useEffect(()=>{m&&(d==="edit"&&n?o({customer_id:n.customer_id,service_type:n.service_type,appointment_date:n.appointment_date,appointment_time:n.appointment_time,notes:n.notes||"",duration_minutes:n.duration_minutes,priority:n.priority,location:n.location||"",technician_id:n.technician_id||""}):d==="create"&&r&&o({customer_id:r.id,service_type:"",appointment_date:"",appointment_time:"",notes:"",duration_minutes:60,priority:"medium",location:"",technician_id:""}),g(null))},[m,d,n,r]);const M=async()=>{if(!(!a.appointment_date||!a.appointment_time))try{const t=await H(),s=new Date(`${a.appointment_date}T${a.appointment_time}`),i=new Date(s.getTime()+(a.duration_minutes||60)*6e4),u=t.filter(x=>{if(d==="edit"&&n&&x.id===n.id)return!1;const D=new Date(`${x.appointment_date}T${x.appointment_time}`),U=new Date(D.getTime()+(x.duration_minutes||60)*6e4);return s<U&&i>D});u.length>0?_(`âš ï¸ Warning: ${u.length} overlapping appointment(s) found at this time.`):_(null)}catch(t){console.error("Error checking conflicts:",t)}};l.useEffect(()=>{a.appointment_date&&a.appointment_time&&M()},[a.appointment_date,a.appointment_time,a.duration_minutes]);const I=async t=>{t.preventDefault(),j(!0),g(null);try{if(!a.customer_id||!a.service_type||!a.appointment_date||!a.appointment_time)throw new Error("Please fill in all required fields");if(await E(a),d==="create"){const s=new Date(a.appointment_date).toLocaleDateString();b.show(`Appointment for ${(r==null?void 0:r.name)||"customer"} has been scheduled on ${s} at ${a.appointment_time}!`,{title:"Appointment Booked! ðŸ“…",icon:T.appointmentBooked,autoCloseDelay:3e3})}else b.show("Appointment has been updated successfully!",{title:"Appointment Updated! âœ…",icon:T.appointmentBooked,autoCloseDelay:3e3});h()}catch(s){const i=s instanceof Error?s.message:"Failed to save appointment";g(i),z.error(i)}finally{j(!1)}};return W(m),m?e.jsxs("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:[e.jsxs(B,{className:"w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:d==="create"?"New Appointment":"Edit Appointment"}),e.jsx("p",{className:"text-sm text-gray-600",children:d==="create"?"Schedule a new customer appointment":"Update appointment details"})]})]}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",type:"button",children:e.jsx(R,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:I,className:"p-6 space-y-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[N&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("span",{className:"text-sm text-red-700",children:N})}),w&&e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg flex items-start gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-yellow-700",children:w})]}),r?e.jsxs("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(y,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Customer Information"})]}),e.jsxs("div",{className:"text-sm text-gray-900 ml-10",children:[e.jsx("p",{className:"font-semibold text-base",children:r.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:r.phone}),r.email&&e.jsx("p",{className:"text-gray-600",children:r.email})]})]}):e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Customer ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{type:"text",value:c,onChange:t=>C(t.target.value),placeholder:"Type name or phone to search...",className:"w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",autoComplete:"off"})]}),c&&f.length>0&&e.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:f.map(t=>e.jsxs("button",{type:"button",onClick:()=>{o(s=>({...s,customer_id:t.id})),C(`${t.name} - ${t.phone}`)},className:"w-full px-4 py-3 text-left hover:bg-blue-50 border-b border-gray-100 last:border-b-0 transition-colors",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1 mt-0.5",children:[e.jsx(y,{className:"w-3 h-3"}),t.phone]})]},t.id))}),c&&f.length===0&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"No customers found. Try a different search."}),!a.customer_id&&c&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:"Please select a customer from the list"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Service Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.service_type,onChange:t=>o(s=>({...s,service_type:t.target.value})),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white",required:!0,children:[e.jsx("option",{value:"",children:"-- Select Service Type --"}),e.jsxs("optgroup",{label:"ðŸ“‹ Consultations & Meetings",children:[e.jsx("option",{value:"Consultation",children:"Consultation"}),e.jsx("option",{value:"Product Demonstration",children:"Product Demonstration"}),e.jsx("option",{value:"Business Meeting",children:"Business Meeting"}),e.jsx("option",{value:"Follow-up Appointment",children:"Follow-up Appointment"})]}),e.jsxs("optgroup",{label:"ðŸšš Sales & Service",children:[e.jsx("option",{value:"Product Delivery",children:"Product Delivery"}),e.jsx("option",{value:"Product Installation",children:"Product Installation"}),e.jsx("option",{value:"Product Pickup",children:"Product Pickup"}),e.jsx("option",{value:"Service Maintenance",children:"Service Maintenance"})]}),e.jsxs("optgroup",{label:"ðŸ”§ Technical Services",children:[e.jsx("option",{value:"Device Repair",children:"Device Repair"}),e.jsx("option",{value:"Device Diagnosis",children:"Device Diagnosis"}),e.jsx("option",{value:"Software Installation",children:"Software Installation"}),e.jsx("option",{value:"Hardware Upgrade",children:"Hardware Upgrade"}),e.jsx("option",{value:"Data Recovery",children:"Data Recovery"}),e.jsx("option",{value:"Virus Removal",children:"Virus Removal"}),e.jsx("option",{value:"Network Setup",children:"Network Setup"}),e.jsx("option",{value:"System Configuration",children:"System Configuration"})]}),e.jsxs("optgroup",{label:"ðŸ“š Training & Support",children:[e.jsx("option",{value:"Training Session",children:"Training Session"}),e.jsx("option",{value:"Customer Support",children:"Customer Support"}),e.jsx("option",{value:"Technical Support",children:"Technical Support"})]}),e.jsxs("optgroup",{label:"ðŸ“¦ Other Services",children:[e.jsx("option",{value:"General Service",children:"General Service"}),e.jsx("option",{value:"Custom Service",children:"Custom Service (Specify in notes)"})]})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Choose the type of service for this appointment"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Appointment Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none z-10"}),e.jsx("input",{type:"date",value:a.appointment_date,onChange:t=>o(s=>({...s,appointment_date:t.target.value})),min:new Date().toISOString().split("T")[0],className:"w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Appointment Time ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none z-10"}),e.jsx("input",{type:"time",value:a.appointment_time,onChange:t=>o(s=>({...s,appointment_time:t.target.value})),className:"w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (minutes)"}),e.jsx("input",{type:"number",value:a.duration_minutes,onChange:t=>o(s=>({...s,duration_minutes:parseInt(t.target.value)||60})),min:"15",step:"15",placeholder:"60",className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Duration in 15-minute increments"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority Level"}),e.jsxs("select",{value:a.priority,onChange:t=>o(s=>({...s,priority:t.target.value})),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white",children:[e.jsx("option",{value:"low",children:"ðŸŸ¢ Low Priority"}),e.jsx("option",{value:"medium",children:"ðŸŸ¡ Medium Priority"}),e.jsx("option",{value:"high",children:"ðŸŸ  High Priority"}),e.jsx("option",{value:"urgent",children:"ðŸ”´ Urgent"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Technician"}),e.jsxs("select",{value:a.technician_id,onChange:t=>o(s=>({...s,technician_id:t.target.value})),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white",children:[e.jsx("option",{value:"",children:"-- No Assignment --"}),P.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional - can assign later"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Service Location"}),e.jsx("input",{type:"text",value:a.location,onChange:t=>o(s=>({...s,location:t.target.value})),placeholder:"Shop, Customer's Home, Office...",className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{value:a.notes,onChange:t=>o(s=>({...s,notes:t.target.value})),rows:3,placeholder:"Add any special instructions or notes for this appointment...",className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50",children:[e.jsx(k,{type:"button",variant:"secondary",onClick:h,disabled:p,className:"min-w-[100px]",children:"Cancel"}),e.jsx(k,{type:"submit",variant:"primary",disabled:p,loading:p,onClick:t=>{const s=document.querySelector("form");if(s){const i=new Event("submit",{bubbles:!0,cancelable:!0});s.dispatchEvent(i)}},className:"min-w-[100px]",children:p?"Saving...":d==="create"?"Create Appointment":"Update Appointment"})]})]}),e.jsx(F,{...b.props})]}):null};export{O as A};
