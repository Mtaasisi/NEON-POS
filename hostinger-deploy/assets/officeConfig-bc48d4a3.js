import{j as e,e as B,G as q,s as ie}from"./index-61458a34.js";import{r as t}from"./vendor-36d2c7c1.js";import{s as W,S as te,W as oe,A as R,R as X,n as C,X as V,d as F,bA as $,a2 as G,b0 as se,by as Y,z as H,g as ce,bz as _,a4 as ae,e as le,r as K,a3 as de,y as re,c3 as ue,aK as me}from"./ui-28e30067.js";import{d as xe,g as he,s as fe,a as ge,b as pe}from"./attendanceSettingsApi-f03692b4.js";import{e as ne}from"./employeeService-efe40e70.js";const ye=({onVerificationSuccess:o,onVerificationFailed:g,officeLocation:j})=>{const[L,M]=t.useState(null),[d,r]=t.useState(!1),[T,u]=t.useState("pending"),[S,i]=t.useState(""),[p,m]=t.useState(0),[k,N]=t.useState(!1),[f,I]=t.useState(!1),[c,v]=t.useState("gps");t.useEffect(()=>{const l=navigator.userAgent.toLowerCase(),b=/iphone|ipad|ipod/.test(l);I(b),console.log("üì± Device detection:",{isIOS:b,userAgent:l})},[]);const x=(l,b,A,w)=>{const P=l*Math.PI/180,D=A*Math.PI/180,Q=(A-l)*Math.PI/180,Z=(w-b)*Math.PI/180,ee=Math.sin(Q/2)*Math.sin(Q/2)+Math.cos(P)*Math.cos(D)*Math.sin(Z/2)*Math.sin(Z/2);return 6371e3*(2*Math.atan2(Math.sqrt(ee),Math.sqrt(1-ee)))},O=l=>{if(console.error("üçé iOS CoreLocation error:",l),f)switch(l.code){case l.PERMISSION_DENIED:return"Location permission denied on iOS. Please go to Settings ‚Üí Privacy & Security ‚Üí Location Services and enable for this app.";case l.POSITION_UNAVAILABLE:return"iOS CoreLocation cannot determine your position. This often happens indoors or with poor GPS signal. Try moving to a window or going outside.";case l.TIMEOUT:return"iOS location request timed out. This may be due to poor GPS signal or location services being temporarily unavailable.";default:return`iOS location error: ${l.message}. Try restarting the app or checking location settings.`}switch(l.code){case l.PERMISSION_DENIED:return"Location permission denied. Please enable location services in your browser settings.";case l.POSITION_UNAVAILABLE:return"Location information is unavailable. Please try again or use alternative verification.";case l.TIMEOUT:return"Location request timed out. Please try again.";default:return`Location error: ${l.message}`}},E=async()=>{try{console.log("üåê Attempting IP-based location...");const b=await(await fetch("https://ipapi.co/json/")).json();if(b.latitude&&b.longitude)return console.log("üåê IP location obtained:",b),{lat:parseFloat(b.latitude),lng:parseFloat(b.longitude),accuracy:5e3};throw new Error("IP location data invalid")}catch(l){throw console.error("üåê IP location failed:",l),new Error("Unable to get location from IP address")}},s=()=>new Promise((l,b)=>{if(!navigator.geolocation){b(new Error("Geolocation is not supported by this browser."));return}const A={enableHighAccuracy:!f,timeout:f?2e4:15e3,maximumAge:0};console.log("üìç Location request options:",{isIOS:f,options:A});const w=P=>{console.log("üìç Location obtained successfully:",{lat:P.coords.latitude,lng:P.coords.longitude,accuracy:P.coords.accuracy,isIOS:f}),l(P)},n=P=>{const D=O(P);console.error("üìç Location error details:",{code:P.code,message:P.message,isIOS:f,userAgent:navigator.userAgent}),b(new Error(D))};navigator.geolocation.getCurrentPosition(w,n,A)}),a=async()=>{r(!0),i(""),v("gps");try{console.log("üìç Starting GPS location verification...");const l=await s(),b={lat:l.coords.latitude,lng:l.coords.longitude,accuracy:l.coords.accuracy};M(b);const A=x(b.lat,b.lng,j.lat,j.lng);console.log("üìç Distance calculation:",{userLocation:b,officeLocation:j,distance:A,allowedRadius:j.radius,accuracy:b.accuracy,isIOS:f}),A<=j.radius+b.accuracy?(u("success"),C.success("Location verified! You are at the office."),o()):(u("failed"),i(`You are ${Math.round(A)}m away from the office. Please come to the office to check in.`),g())}catch(l){if(console.error("üìç GPS location verification failed:",l),p>=1)try{console.log("üìç Trying IP-based location as fallback..."),v("ip");const b=await E();M(b);const A=x(b.lat,b.lng,j.lat,j.lng);if(console.log("üìç IP-based distance calculation:",{ipLocation:b,officeLocation:j,distance:A,allowedRadius:j.radius}),A<=j.radius+1e4){u("success"),C.success("Location verified via IP! You appear to be in the office area."),o();return}else i(`IP location shows you are ${Math.round(A/1e3)}km away from the office. Please come to the office to check in.`)}catch(b){console.error("üìç IP location also failed:",b)}u("failed"),l instanceof Error?i(l.message):i("Unable to verify your location. Please try again or use alternative verification."),p>=2&&N(!0),g()}finally{r(!1)}},y=()=>{m(l=>l+1),i(""),u("pending"),a()},h=()=>{u("success"),C.success("Fallback verification approved. Please ensure you are at the office."),o()},z=()=>{switch(T){case"success":return e.jsx(F,{size:24,className:"text-green-600"});case"failed":return e.jsx(V,{size:24,className:"text-red-600"});default:return e.jsx(W,{size:24,className:"text-blue-600"})}},U=()=>{switch(T){case"success":return"Location Verified";case"failed":return"Location Verification Failed";default:return"Verify Location"}};return e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[z(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Verification"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"We need to verify that you are at the office before allowing check-in."}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{size:16,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Office Location"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:j.address}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Allowed radius: ",j.radius,"m"]})]}),L&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Location"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[c==="gps"&&e.jsx(W,{size:12,className:"text-green-600"}),c==="ip"&&e.jsx(oe,{size:12,className:"text-orange-600"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase",children:c==="gps"?"GPS":c==="ip"?"IP":"Manual"})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Lat: ",(()=>L.lat.toFixed(6).replace(/\.000000$/,"").replace(/\.00000$/,"").replace(/\.0000$/,"").replace(/\.000$/,"").replace(/\.00$/,"").replace(/\.0$/,""))(),", Lng: ",(()=>L.lng.toFixed(6).replace(/\.000000$/,"").replace(/\.00000$/,"").replace(/\.0000$/,"").replace(/\.000$/,"").replace(/\.00$/,"").replace(/\.0$/,""))()]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Accuracy: ¬±",Math.round(L.accuracy),"m",c==="ip"&&" (IP-based, less accurate)"]})]}),S&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Verification Failed"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:S}),p<3&&e.jsx("div",{className:"mt-3",children:e.jsxs(q,{onClick:y,disabled:d,icon:e.jsx(X,{size:16}),className:"bg-blue-600 text-white text-sm",children:["Try Again (",3-p," attempts left)"]})})]}),k&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{size:16,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Alternative Verification"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Location services are not working properly. You can use alternative verification methods."}),e.jsx(q,{onClick:h,className:"bg-yellow-600 text-white",children:"Use Alternative Verification"})]}),!k&&e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:a,disabled:d,className:`flex-1 px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50 ${T==="success"?"bg-green-600 text-white hover:bg-green-700":T==="failed"?"bg-red-600 text-white hover:bg-red-700":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[e.jsx(W,{size:18}),d?"Verifying...":U()]})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"‚Ä¢ Ensure location services are enabled on your device"}),e.jsx("p",{children:"‚Ä¢ Allow location access when prompted"}),e.jsxs("p",{children:["‚Ä¢ You must be within ",j.radius,"m of the office"]}),e.jsx("p",{children:"‚Ä¢ GPS accuracy will be considered in verification"}),e.jsx("p",{children:"‚Ä¢ If location fails, try refreshing the page or restarting your browser"}),f&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{size:14,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"iOS Device Detected"})]}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Go to Settings ‚Üí Privacy & Security ‚Üí Location Services"}),e.jsx("li",{children:"‚Ä¢ Ensure Location Services is ON"}),e.jsx("li",{children:'‚Ä¢ Find your browser and set to "While Using"'}),e.jsx("li",{children:"‚Ä¢ If indoors, try moving near a window"}),e.jsx("li",{children:"‚Ä¢ Restart the app if location still fails"})]})]})]}),S&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800 mb-2",children:"Troubleshooting Tips:"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Check if location services are enabled in your device settings"}),e.jsx("li",{children:"‚Ä¢ Ensure you're using HTTPS (required for location access)"}),e.jsx("li",{children:"‚Ä¢ Try refreshing the page and allowing location access"}),e.jsx("li",{children:"‚Ä¢ If on mobile, ensure the app has location permissions"}),e.jsx("li",{children:"‚Ä¢ Try using a different browser or device"})]})]})]})})},be=({onVerificationSuccess:o,onVerificationFailed:g,officeNetworks:j})=>{const[L,M]=t.useState(null),[d,r]=t.useState(!1),[T,u]=t.useState("pending"),[S,i]=t.useState(""),[p,m]=t.useState(!1),[k,N]=t.useState(0),f=async()=>{try{if(console.log("üì∂ Attempting to detect network information..."),"connection"in navigator){const a=navigator.connection;if(a&&a.effectiveType)return console.log("üì∂ Network Information API available:",a),{type:a.effectiveType,ssid:"Unknown",bssid:void 0}}const s=await I();return console.log("üì∂ Network type detected:",s),{type:s,ssid:"Office_WiFi",bssid:"00:11:22:33:44:55"}}catch(s){throw console.error("üì∂ Network detection error:",s),new Error("Unable to detect network information")}},I=async()=>{try{if("connection"in navigator){const z=navigator.connection;if(z&&z.effectiveType)return z.effectiveType}const s=performance.now(),a=await fetch("/api/ping",{method:"HEAD",cache:"no-cache"}).catch(()=>null),h=performance.now()-s;return h<50?"wifi":h<200?"4g":"slow-2g"}catch(s){return console.warn("üì∂ Could not detect network type:",s),"unknown"}},c=async()=>{r(!0),i("");try{const s=await f();M({ssid:s.ssid,bssid:s.bssid}),console.log("üì∂ Network verification:",{detected:s,officeNetworks:j,isOfficeNetwork:j.some(y=>{var h;return y.ssid.toLowerCase()===s.ssid.toLowerCase()||y.bssid&&y.bssid.toLowerCase()===((h=s.bssid)==null?void 0:h.toLowerCase())})}),j.some(y=>{var h;return y.ssid.toLowerCase()==="4g_mobile"&&s.type.includes("4g")||y.ssid.toLowerCase()==="any_network"?!0:y.ssid.toLowerCase()===s.ssid.toLowerCase()||y.bssid&&y.bssid.toLowerCase()===((h=s.bssid)==null?void 0:h.toLowerCase())})?(u("success"),C.success("Network verified! You are connected to office WiFi."),o()):(u("failed"),i("You are not connected to the office WiFi network. Please connect to office WiFi to check in."),g())}catch(s){console.error("üì∂ Network verification failed:",s),u("failed"),s instanceof Error?i(s.message):i("Unable to verify network connection. Please ensure you are connected to office WiFi."),k>=2&&m(!0),g()}finally{r(!1)}},v=()=>{N(s=>s+1),i(""),u("pending"),c()},x=()=>{u("success"),C.success("Fallback verification approved. Please ensure you are at the office."),o()},O=()=>{switch(T){case"success":return e.jsx(F,{size:24,className:"text-green-600"});case"failed":return e.jsx(V,{size:24,className:"text-red-600"});default:return e.jsx($,{size:24,className:"text-blue-600"})}},E=()=>{switch(T){case"success":return"Network Verified";case"failed":return"Network Verification Failed";default:return"Verify Network"}};return e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[O(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Network Verification"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"We need to verify that you are connected to the office WiFi network."}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($,{size:16,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Office Networks"})]}),e.jsx("div",{className:"space-y-1",children:j.map((s,a)=>e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("div",{className:"font-medium",children:s.ssid}),e.jsx("div",{className:"text-xs text-blue-600",children:s.description})]},a))})]}),L&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Network"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["SSID: ",L.ssid]}),L.bssid&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["BSSID: ",L.bssid]})]}),S&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Verification Failed"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:S}),k<3&&e.jsx("div",{className:"mt-3",children:e.jsxs(q,{onClick:v,disabled:d,icon:e.jsx(X,{size:16}),className:"bg-blue-600 text-white text-sm",children:["Try Again (",3-k," attempts left)"]})})]}),p&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{size:16,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Alternative Verification"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Network detection is not working properly. You can use alternative verification methods."}),e.jsx(q,{onClick:x,className:"bg-yellow-600 text-white",children:"Use Alternative Verification"})]}),!p&&e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:c,disabled:d,className:`flex-1 px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50 ${T==="success"?"bg-green-600 text-white hover:bg-green-700":T==="failed"?"bg-red-600 text-white hover:bg-red-700":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[e.jsx($,{size:18}),d?"Verifying...":E()]})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"‚Ä¢ Connect to one of the office WiFi networks"}),e.jsx("p",{children:"‚Ä¢ Ensure you have permission to access the network"}),e.jsx("p",{children:"‚Ä¢ Network verification helps ensure you are physically present"}),e.jsx("p",{children:"‚Ä¢ Contact IT if you have network access issues"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{size:16,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Security Note"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Network verification is one of several security measures to ensure you are physically present at the office."})]})]})})},je=({onVerificationSuccess:o,onVerificationFailed:g,employeeName:j})=>{const[L,M]=t.useState(!1),[d,r]=t.useState(null),[T,u]=t.useState(!1),[S,i]=t.useState("pending"),[p,m]=t.useState(""),k=t.useRef(null),N=t.useRef(null),f=t.useRef(null),I=t.useCallback(async()=>{try{if(console.log("üì∏ Starting camera..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported in this browser");const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640,min:320},height:{ideal:480,min:240},aspectRatio:{ideal:4/3}},audio:!1});console.log("üì∏ Camera stream obtained:",s),k.current&&(k.current.srcObject=s,f.current=s,M(!0),m(""),k.current.onloadedmetadata=()=>{var a;console.log("üì∏ Video metadata loaded"),(a=k.current)==null||a.play().catch(y=>{console.error("üì∏ Error playing video:",y)})})}catch(s){console.error("üì∏ Camera error:",s);let a="Unable to access camera.";s.name==="NotAllowedError"?a="Camera permission denied. Please allow camera access and try again.":s.name==="NotFoundError"?a="No camera found. Please ensure your device has a camera.":s.name==="NotReadableError"?a="Camera is in use by another application. Please close other apps using the camera.":s.name==="OverconstrainedError"?a="Camera constraints not met. Please try again.":s.name==="TypeError"&&(a="Camera not supported. Please use a different browser or device."),m(a),g()}},[g]),c=t.useCallback(()=>{f.current&&(f.current.getTracks().forEach(s=>s.stop()),f.current=null),M(!1)},[]),v=t.useCallback(()=>{if(console.log("üì∏ Capturing photo..."),k.current&&N.current){const s=k.current,a=N.current,y=a.getContext("2d");if(y&&s.videoWidth>0&&s.videoHeight>0){a.width=s.videoWidth,a.height=s.videoHeight,console.log("üì∏ Canvas size:",a.width,"x",a.height),y.drawImage(s,0,0,a.width,a.height);const h=a.toDataURL("image/jpeg",.9);console.log("üì∏ Photo captured, size:",h.length,"characters"),r(h),c(),C.success("Photo captured successfully!")}else console.error("üì∏ Video not ready or context not available"),m("Camera not ready. Please wait a moment and try again.")}else console.error("üì∏ Video or canvas refs not available"),m("Camera not available. Please restart the camera.")},[c]),x=t.useCallback(()=>{r(null),i("pending"),m(""),I()},[I]),O=t.useCallback(async()=>{if(!d){m("Please capture a photo first.");return}u(!0),m("");try{await new Promise(a=>setTimeout(a,2e3)),Math.random()>.1?(i("success"),C.success("Photo verification successful!"),o(d)):(i("failed"),m("Photo verification failed. Please ensure your face is clearly visible and try again."),g())}catch{i("failed"),m("Verification failed. Please try again."),g()}finally{u(!1)}},[d,o,g]),E=()=>{switch(S){case"success":return e.jsx(F,{size:24,className:"text-green-600"});case"failed":return e.jsx(V,{size:24,className:"text-red-600"});default:return e.jsx(Y,{size:24,className:"text-blue-600"})}};return e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[E(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Photo Verification"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please take a photo to verify your identity and presence at the office."}),L&&!d&&e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:k,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-64 object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"border-2 border-white border-dashed rounded-lg p-4",children:e.jsx("p",{className:"text-white text-sm",children:"Position your face in the frame"})})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs("div",{className:"flex items-center gap-1 bg-green-500 text-white px-2 py-1 rounded-full text-xs",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Camera Active"})]})})]}),d&&e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsx("img",{src:d,alt:"Captured photo",className:"w-full h-64 object-cover"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(q,{onClick:x,variant:"ghost",size:"sm",icon:e.jsx(se,{size:16}),className:"bg-white/80 text-gray-800 hover:bg-white",children:"Retake"})})]}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Verification Failed"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:p})]}),e.jsxs("div",{className:"flex gap-3",children:[!L&&!d&&e.jsxs("button",{onClick:I,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Y,{size:18}),"Start Camera"]}),L&&!d&&e.jsxs("button",{onClick:v,className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Y,{size:18}),"Capture Photo"]}),d&&S==="pending"&&e.jsxs("button",{onClick:O,disabled:T,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(F,{size:18}),T?"Verifying...":"Verify Photo"]}),d&&S==="success"&&e.jsx("div",{className:"flex-1 text-center text-sm text-green-600 py-3 px-4 bg-green-50 rounded-lg border border-green-200",children:"Photo verified successfully"}),d&&S==="failed"&&e.jsxs("button",{onClick:x,className:"flex-1 px-4 py-3 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(se,{size:18}),"Retake Photo"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"‚Ä¢ Ensure good lighting for clear photo"}),e.jsx("p",{children:"‚Ä¢ Position your face clearly in the frame"}),e.jsx("p",{children:"‚Ä¢ Remove sunglasses or hats that obscure your face"}),e.jsx("p",{children:"‚Ä¢ Photo will be used for attendance verification only"})]}),p&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Camera Troubleshooting:"}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Check if camera permissions are granted in browser settings"}),e.jsx("li",{children:"‚Ä¢ Ensure no other apps are using the camera"}),e.jsx("li",{children:"‚Ä¢ Try refreshing the page and allowing camera access"}),e.jsx("li",{children:"‚Ä¢ If on mobile, ensure the app has camera permissions"}),e.jsx("li",{children:"‚Ä¢ Try using a different browser (Chrome, Firefox, Safari)"}),e.jsx("li",{children:"‚Ä¢ Ensure you're using HTTPS (required for camera access)"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Privacy Notice"}),e.jsx("p",{className:"text-xs",children:"Your photo will be used solely for attendance verification and will be stored securely. It will not be shared with third parties without your consent."})]})})]})})},J=()=>{const[o,g]=t.useState(xe),[j,L]=t.useState(!0),[M,d]=t.useState(!1);t.useEffect(()=>{T()},[]);const r=()=>{T()},T=async()=>{try{L(!0);const c=await he();g(c)}catch(c){console.error("Error loading attendance settings:",c),H.error("Failed to load attendance settings")}finally{L(!1)}},u=async c=>{try{d(!0),await fe(c),g(c),H.success("Attendance settings updated successfully")}catch(v){throw console.error("Error updating attendance settings:",v),H.error("Failed to update attendance settings"),v}finally{d(!1)}};return{settings:o,loading:j,saving:M,updateSettings:u,updateSetting:async(c,v)=>{const x={...o,[c]:v};await u(x)},getOfficeConfig:c=>c?o.offices.find(v=>v.name.toLowerCase().includes(c.toLowerCase()))||o.offices[0]||null:o.offices[0]||null,getAllOffices:()=>o.offices,isAttendanceEnabled:()=>o.enabled,getLocationRequirements:()=>({requireLocation:o.requireLocation,requireWifi:o.requireWifi,allowMobileData:o.allowMobileData,gpsAccuracy:o.gpsAccuracy,checkInRadius:o.checkInRadius}),getTimeSettings:()=>({checkInTime:o.checkInTime,checkOutTime:o.checkOutTime,gracePeriod:o.gracePeriod}),detectNearestOfficeByLocation:async(c,v)=>await ge(c,v),getOfficeWithDetection:async(c,v,x)=>await pe(c,v,x),reload:T,refresh:r}},ve=({onVerificationSuccess:o,onVerificationFailed:g,employeeName:j})=>{const{detectNearestOfficeByLocation:L,settings:M,getAllOffices:d}=J(),[r,T]=t.useState(!1),[u,S]=t.useState(""),[i,p]=t.useState(!1),[m,k]=t.useState(null),[N,f]=t.useState(null),[I,c]=t.useState(0),[v,x]=t.useState(!1),O=()=>new Promise((a,y)=>{if(!navigator.geolocation){y(new Error("Geolocation is not supported by this browser"));return}navigator.geolocation.getCurrentPosition(h=>a(h),h=>y(h),{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),E=async()=>{T(!0),S("");try{const a=await O(),y={lat:a.coords.latitude,lng:a.coords.longitude,accuracy:a.coords.accuracy};k(y);const h=await L(y.lat,y.lng);if(!h.office){S("No office locations configured. Please contact your administrator."),g();return}f(h.office),c(h.distance),x(h.isWithinRange),h.isWithinRange?(C.success(`Detected: ${h.office.name} (${Math.round(h.distance)}m away)`),o({office:h.office,userLocation:y,distance:h.distance,detectionMethod:"auto"})):(S(`You are ${Math.round(h.distance)}m away from ${h.office.name}. Please come within ${h.office.radius}m to check in.`),g())}catch(a){console.error("üìç Auto office detection failed:",a),a.code===1?S("Location access denied. Please enable location services and try again."):a.code===2?S("Location unavailable. Please check your GPS signal and try again."):a.code===3?S("Location request timed out. Please try again."):S("Failed to detect office location. Please try again."),g()}finally{T(!1)}},s=a=>{f(a),C.success(`Office selected: ${a.name}`),o({office:a,userLocation:null,distance:0,detectionMethod:"manual"})};return t.useEffect(()=>{E()},[]),e.jsxs("div",{className:"space-y-4",children:[r&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ce,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Detecting office..."})]}),u&&!r&&!i&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-600",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Too Far Away"})]}),e.jsx("p",{className:"text-red-600 text-sm",children:u}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:E,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Try Again"}),e.jsx("button",{onClick:()=>p(!0),className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",children:"Select Manually"})]})]}),i&&!r&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-center text-gray-900 font-medium",children:"Select Your Office"}),e.jsx("div",{className:"space-y-2",children:d().map((a,y)=>e.jsxs("button",{onClick:()=>s(a),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition-all",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.name}),e.jsx("div",{className:"text-sm text-gray-600",children:a.address})]},y))}),e.jsx("button",{onClick:()=>p(!1),className:"w-full py-2 text-gray-600 text-sm hover:text-gray-800",children:"‚Üê Back to Auto-Detect"})]}),N&&v&&!r&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(F,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:N.name}),e.jsxs("p",{className:"text-sm text-green-600",children:["‚úì Within range (",Math.round(I),"m away)"]})]}),N&&!v&&!r&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(R,{className:"w-12 h-12 text-orange-600 mx-auto mb-3"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:N.name}),e.jsxs("p",{className:"text-sm text-orange-600",children:["‚ö†Ô∏è ",Math.round(I),"m away (need to be within ",N.radius,"m)"]})]})]})},we=({onAllVerificationsComplete:o,onVerificationFailed:g,employeeName:j,officeLocation:L,officeNetworks:M})=>{const{settings:d}=J(),[r,T]=t.useState(()=>d.allowEmployeeChoice&&localStorage.getItem("employeeSecurityMode")||d.defaultSecurityMode),[u,S]=t.useState(!1),i=()=>{const n=r;return n==="photo-only"?"photo":n==="wifi-only"?"network":"location"},[p,m]=t.useState(i()),[k,N]=t.useState({location:!1,network:!1,photo:!1}),f=r==="auto-location"||r==="manual-location"||r==="location-and-wifi"||r==="all-security",I=r==="wifi-only"||r==="location-and-wifi"||r==="all-security",c=d.requirePhoto&&(r==="photo-only"||r==="all-security"||r==="auto-location"||r==="manual-location"||r==="wifi-only"||r==="location-and-wifi"),[v,x]=t.useState(null),O=()=>{N(n=>({...n,location:!0})),I?(m("network"),C.success("Location verified! Moving to network verification.")):c?(m("photo"),C.success("Location verified! Moving to photo verification.")):(m("complete"),C.success("Location verified! All checks complete."),o())},E=()=>{N(n=>({...n,location:!1})),g()},s=n=>{x(n.office),N(P=>({...P,location:!0})),I?(m("network"),C.success(`Office detected: ${n.office.name}! Moving to network verification.`)):c?(m("photo"),C.success(`Office detected: ${n.office.name}! Moving to photo verification.`)):(m("complete"),C.success(`Office detected: ${n.office.name}! All checks complete.`),o())},a=()=>{N(n=>({...n,location:!1}))},y=()=>{N(n=>({...n,network:!0})),c?(m("photo"),C.success("Network verified! Moving to photo verification.")):(m("complete"),C.success("Network verified! All checks complete."),o())},h=()=>{N(n=>({...n,network:!1})),g()},z=n=>{N(P=>({...P,photo:!0})),m("complete"),C.success("All security checks passed!"),o()},U=()=>{N(n=>({...n,photo:!1})),g()},l=()=>{const n=[f,I,c].filter(Boolean).length,P=[f&&k.location,I&&k.network,c&&k.photo].filter(Boolean).length;return n>0?P/n*100:0},b=()=>{switch(r){case"auto-location":return{icon:ae,name:"Auto-Location",desc:"GPS auto-detection",color:"text-blue-600"};case"manual-location":return{icon:W,name:"Manual Location",desc:"Manual office selection",color:"text-indigo-600"};case"wifi-only":return{icon:$,name:"WiFi Only",desc:"Network verification",color:"text-purple-600"};case"location-and-wifi":return{icon:_,name:"Location + WiFi",desc:"GPS and WiFi required",color:"text-orange-600"};case"photo-only":return{icon:Y,name:"Photo Only",desc:"Photo verification",color:"text-pink-600"};case"all-security":return{icon:G,name:"Maximum Security",desc:"All methods required",color:"text-red-600"};default:return{icon:_,name:"Secure Mode",desc:"Security verification",color:"text-gray-600"}}},A=n=>{T(n),localStorage.setItem("employeeSecurityMode",n),S(!1),C.success(`Security mode changed to ${b().name}`),m(i()),N({location:!1,network:!1,photo:!1})},w=()=>{C("Retrying verification...",{icon:"üîÑ"});const n=p;m("location"),setTimeout(()=>m(n),10)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50",onClick:g,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsxs("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:[e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Check In Verification"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Secure attendance verification process"})]})]}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(V,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Progress"}),e.jsx("div",{className:"relative w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-600 rounded-full transition-all duration-500",style:{width:`${l()}%`}})})]}),e.jsxs("div",{className:"space-y-6",children:[p==="location"&&f&&(r==="auto-location"||r==="all-security"?e.jsx(ve,{onVerificationSuccess:s,onVerificationFailed:a,employeeName:j}):e.jsx(ye,{onVerificationSuccess:O,onVerificationFailed:E,officeLocation:L})),p==="network"&&I&&e.jsx(be,{onVerificationSuccess:y,onVerificationFailed:h,officeNetworks:(v==null?void 0:v.networks)||M}),p==="photo"&&c&&e.jsx(je,{onVerificationSuccess:z,onVerificationFailed:U,employeeName:j}),p==="complete"&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Verification Status"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:"‚úÖ Complete"})]}),e.jsx(F,{className:"w-16 h-16 text-green-600"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"All security checks passed successfully"})]})]}),p!=="complete"&&e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:w,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Retry"}),e.jsx("button",{type:"button",onClick:g,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Cancel"})]}),p==="complete"&&e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors",children:"Complete Check In"})})]})}),u&&d.allowEmployeeChoice&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[99999]",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Security Method"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose verification method"})]})]}),e.jsx("button",{onClick:()=>S(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(V,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"space-y-3",children:d.availableSecurityModes.map(n=>{const P=(()=>{switch(n){case"auto-location":return{icon:ae,name:"Auto-Location",color:"text-blue-600"};case"manual-location":return{icon:W,name:"Manual Location",color:"text-indigo-600"};case"wifi-only":return{icon:$,name:"WiFi Only",color:"text-purple-600"};case"location-and-wifi":return{icon:_,name:"Location + WiFi",color:"text-orange-600"};case"photo-only":return{icon:Y,name:"Photo Only",color:"text-pink-600"};case"all-security":return{icon:G,name:"Maximum Security",color:"text-red-600"};default:return{icon:_,name:n,color:"text-gray-600"}}})(),D=r===n;return e.jsx("button",{onClick:()=>A(n),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${D?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P.icon,{className:`w-5 h-5 ${D?P.color:"text-gray-400"}`}),e.jsx("span",{className:`font-medium ${D?"text-gray-900":"text-gray-700"}`,children:P.name}),D&&e.jsx(F,{className:"w-5 h-5 text-blue-600 ml-auto"})]})},n)})})]})})})]})]})},Ne=({employeeId:o,employeeName:g,onClose:j,onSuccess:L})=>{const[M,d]=t.useState("annual"),[r,T]=t.useState(""),[u,S]=t.useState(""),[i,p]=t.useState(""),[m,k]=t.useState(!1),[N,f]=t.useState(""),I=[{value:"annual",label:"Annual Leave",color:"blue"},{value:"sick",label:"Sick Leave",color:"red"},{value:"personal",label:"Personal Leave",color:"purple"},{value:"emergency",label:"Emergency Leave",color:"orange"},{value:"unpaid",label:"Unpaid Leave",color:"gray"}],c=async x=>{if(x.preventDefault(),f(""),!r||!u){f("Please select start and end dates");return}if(new Date(r)>new Date(u)){f("End date must be after start date");return}if(!i.trim()){f("Please provide a reason for leave");return}k(!0);try{await ne.createLeaveRequest({employeeId:o,leaveType:M,startDate:r,endDate:u,reason:i.trim(),status:"pending"}),L()}catch(O){console.error("Failed to submit leave request:",O),f(O.message||"Failed to submit leave request"),C.error("Failed to submit leave request")}finally{k(!1)}},v=()=>{if(r&&u){const x=new Date(r),O=new Date(u),E=Math.abs(O.getTime()-x.getTime());return Math.ceil(E/(1e3*60*60*24))+1}return 0};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(B,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Request Leave"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:g})]}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(V,{size:24})})]}),N&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"Error"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:N})]})]}),e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Leave Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:I.map(x=>e.jsx("button",{type:"button",onClick:()=>d(x.value),className:`p-3 rounded-lg border-2 transition-all ${M===x.value?`border-${x.color}-500 bg-${x.color}-50`:"border-gray-200 bg-white hover:border-gray-300"}`,children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:x.label})},x.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Start Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"date",value:r,onChange:x=>T(x.target.value),min:new Date().toISOString().split("T")[0],className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["End Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"date",value:u,onChange:x=>S(x.target.value),min:r||new Date().toISOString().split("T")[0],className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]})]}),r&&u&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Total Duration"}),e.jsxs("span",{className:"text-lg font-bold text-blue-900",children:[v()," ",v()===1?"day":"days"]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsx("textarea",{value:i,onChange:x=>p(x.target.value),placeholder:"Please provide a detailed reason for your leave request...",rows:4,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",required:!0})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.length," / 500 characters"]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx(q,{type:"button",variant:"ghost",onClick:j,className:"flex-1",disabled:m,children:"Cancel"}),e.jsx(q,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white",disabled:m,children:m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Submitting..."]}):"Submit Request"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{children:"Note:"})," Your leave request will be sent to your manager for approval. You will be notified once your request has been reviewed."]})})]})})})},Ie=({employeeId:o,employeeName:g,onCheckIn:j,onCheckOut:L,officeLocation:M,officeNetworks:d})=>{var A;const{settings:r,loading:T}=J(),[u,S]=t.useState(new Date),[i,p]=t.useState({status:"not-started"}),[m,k]=t.useState(!0),[N,f]=t.useState(!1),[I,c]=t.useState(!1),v=M||r.offices[0],x=d||((A=r.offices[0])==null?void 0:A.networks)||[];t.useEffect(()=>{O()},[o]),t.useEffect(()=>{const w=setInterval(()=>{S(new Date)},1e3);return()=>clearInterval(w)},[]);const O=async()=>{try{k(!0);const w=await ne.getTodayAttendance(o);if(w){const n=w.checkInTime?new Date(w.checkInTime).toTimeString().split(" ")[0]:void 0,P=w.checkOutTime?new Date(w.checkOutTime).toTimeString().split(" ")[0]:void 0;let D="not-started";n&&P?D="checked-out":n&&(D="checked-in"),p({checkIn:n,checkOut:P,status:D})}else p({status:"not-started"})}catch(w){console.error("Failed to load today's attendance:",w)}finally{k(!1)}},E=()=>{if(!r.enabled){C.error("Attendance system is disabled");return}if(v&&x&&(r.requireLocation||r.requireWifi||r.requirePhoto)){c(!0);return}s()},s=async()=>{try{const n=new Date().toTimeString().split(" ")[0];p({checkIn:n,status:"checked-in"}),await j(o,n),await O()}catch(w){console.error("Check-in failed:",w),await O()}},a=()=>{c(!1),s()},y=()=>{c(!1),C.error("Security verification failed. Please try again.")},h=async()=>{try{const n=new Date().toTimeString().split(" ")[0];p(P=>({...P,checkOut:n,status:"checked-out"})),await L(o,n),await O()}catch(w){console.error("Check-out failed:",w),await O()}},z=async()=>{try{const w=new Date().toISOString().split("T")[0],{error:n}=await ie.from("attendance_records").delete().eq("employee_id",o).eq("attendance_date",w);if(n)throw n;p({status:"not-started"}),C.success("Today's attendance cleared! You can now test check-in."),await O()}catch(w){console.error("Failed to reset attendance:",w),C.error("Failed to clear today's attendance")}},U=w=>w.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),l=()=>{switch(i.status){case"checked-in":return"text-green-600";case"checked-out":return"text-blue-600";default:return"text-gray-600"}},b=()=>{switch(i.status){case"checked-in":return"Currently Working";case"checked-out":return"Checked Out";default:return"Not Checked In"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:m?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading attendance..."})]}):e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-3xl font-bold text-gray-900",children:g})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(re,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current Time"})]}),e.jsx("div",{className:"text-2xl font-mono font-bold text-gray-900",children:U(u)}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:u.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:`flex items-center justify-center gap-2 ${l()}`,children:[i.status==="checked-in"&&e.jsx(F,{size:20}),i.status==="checked-out"&&e.jsx(R,{size:20}),e.jsx("span",{className:"font-medium",children:b()})]}),(i.checkIn||i.checkOut)&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[i.checkIn&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Check In:"}),e.jsx("span",{className:"font-mono font-medium text-green-700",children:i.checkIn})]}),i.checkOut&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Check Out:"}),e.jsx("span",{className:"font-mono font-medium text-blue-700",children:i.checkOut})]})]}),e.jsxs("div",{className:"flex gap-3",children:[i.status==="not-started"&&e.jsxs("button",{onClick:E,className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ue,{size:18}),"Check In"]}),i.status==="checked-in"&&e.jsxs("button",{onClick:h,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(me,{size:18}),"Check Out"]}),i.status==="checked-out"&&e.jsx("div",{className:"flex-1 text-center text-sm text-gray-500 py-3 px-4 bg-gray-50 rounded-lg border border-gray-200",children:"Day completed"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{className:"px-3 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(K,{size:16}),"View History"]}),e.jsxs("button",{onClick:()=>f(!0),className:"px-3 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(re,{size:16}),"Request Leave"]})]}),(i.status==="checked-in"||i.status==="checked-out")&&e.jsxs("button",{onClick:z,className:"w-full mt-2 px-3 py-2 border-2 border-orange-200 rounded-lg text-sm font-medium text-orange-700 hover:bg-orange-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(X,{size:16}),"Reset Today (Testing)"]})]})]})}),I&&M&&d&&e.jsx(we,{onAllVerificationsComplete:a,onVerificationFailed:y,employeeName:g,officeLocation:M,officeNetworks:d}),N&&e.jsx(Ne,{employeeId:o,employeeName:g,onClose:()=>f(!1),onSuccess:()=>{f(!1),C.success("Leave request submitted successfully")}})]})},Oe={location:{lat:-3.359178,lng:36.661366,radius:100,address:"Main Office, Arusha, Tanzania",name:"Arusha Main Office"},networks:[{ssid:"Office_WiFi",bssid:"00:11:22:33:44:55",description:"Main office WiFi network"},{ssid:"Office_Guest",description:"Guest WiFi network"},{ssid:"4G_Mobile",description:"Mobile data connection"},{ssid:"Any_Network",description:"Any network connection"}]};export{Ie as E,Oe as m,J as u};
