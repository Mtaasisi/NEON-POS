import{_ as dt}from"./supabase-cf010ec4.js";import{j as e,G as mt,u as Fs,z as vl,aW as jl,aV as Nl,aX as wl,y as Rs,e as ms,s as Te,aY as Sl,a1 as Hr,p as Qr,o as kl,X as jn,a5 as Pl,M as Cl,d as Hs,b as _l,J as Dl,aZ as Il,a_ as El,a$ as Tl,b0 as Al,b1 as Ml,a as Ol,aa as $l,an as Kr,b2 as Ll}from"./index-61458a34.js";import{R as qt,r as s,b as ea}from"./vendor-36d2c7c1.js";import{r as ht,V as Fl,D as Jr}from"./rbac-6ed8a520.js";import{u as Rl,a as ta}from"./routing-eb8c310c.js";import{an as zl,H as ct,bz as Yr,q as ft,v as zt,a3 as $a,aE as js,Y as ls,r as Rt,a8 as _a,R as La,S as Ls,aZ as Nn,aG as ql,aI as Ul,n as x,u as ut,bM as Bl,X as Je,cX as Vl,ab as Zl,aa as wn,A as rs,T as Qs,J as Da,N as Wt,m as Fa,O as Ns,ap as Xs,P as Jt,U as xt,bP as Ia,ao as $s,b as ws,a as Ea,aL as Wl,t as Xr,j as en,Q as ka,s as Ra,d as Yt,y as ds,I as Gl,M as za,ax as Sn,e as Zt,$ as Hl,ae as kn,G as Ql,av as Js,af as ns,p as tn,D as sa,g as ss,aA as Kl,a7 as Jl,bH as Yl,aj as Xl,l as Pn,br as Ks,k as Ss,aq as sn,o as eo,a5 as to,b$ as so,bb as ao,a9 as ro,b7 as an,f as no,b6 as lo,a6 as oo}from"./ui-28e30067.js";import{u as Xt}from"./usePOSClickSounds-e5b9fd69.js";import{g as Ys,V as io,R as qa,u as co,a as mo,b as uo,i as xo,P as rn,c as Cn}from"./VariantProductCard-04300406.js";import{searchIMEIVariants as go}from"./imeiVariantService-4ce4b8b1.js";import{G as as}from"./GlassBadge-9ae09fa8.js";import{format as Ze}from"./format-aff4c6a2.js";import{S as Ta}from"./SafeImage-a3ef104e.js";import{a as ho,b as po,f as fo}from"./specificationUtils-0c00478d.js";import{P as nn}from"./PriceInput-aa1a05e9.js";import{C as bo}from"./CategoryInput-e47eba98.js";import{A as Aa}from"./AddCustomerModal-175a5a1a.js";import{s as Ma}from"./search-cbe15294.js";import{u as Ua}from"./useBodyScrollLock-341c8b9f.js";import{customerCacheService as vs}from"./customerCacheService-9b459c09.js";import{L as Ba}from"./LoadingSpinner-251d9268.js";import{u as Va}from"./useDialog-6eb5c329.js";import{C as ln}from"./CustomerDetailModal-ad4a2166.js";import{G as yo}from"./GlassInput-0475021a.js";import{s as ts}from"./saleProcessingService-f5a8fb75.js";import{T as vo}from"./TradeInContractModal-15d48929.js";import{C as jo}from"./ComprehensivePaymentModal-83b44bf0.js";import{I as No}from"./InstallmentManagementModal-0b553ce1.js";import{P as wo}from"./PaymentsPopupModal-6fe61f19.js";import{u as So}from"./useBusinessInfo-62d31733.js";import{d as Gt}from"./draftService-00fb159f.js";import{u as ko,S as on}from"./useSuccessModal-081786c4.js";import{S as Os}from"./SuccessModalIcons-fe811e4d.js";import{S as cn}from"./ShareReceiptModal-8db20b0e.js";import{G as Po,Q as Co}from"./GlobalSearchShortcut-c0731781.js";const Pa={"/lats/quick-cash":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/quick-cash",name:"Quick Cash"}],"/lats/unified-inventory":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/unified-inventory",name:"Unified Inventory Management"}],"/lats/customers":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/customers",name:"Customer Management"}],"/lats/analytics":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/analytics",name:"Business Analytics"}],"/lats/sales-analytics":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/sales-analytics",name:"Sales Analytics"}],"/lats/sales-reports":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/sales-reports",name:"Sales Reports"}],"/lats/loyalty":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/loyalty",name:"Customer Loyalty"}],"/lats/add-product":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/unified-inventory",name:"Unified Inventory Management"},{path:"/lats/add-product",name:"Add Product"}],"/lats/products/:productId/edit":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/unified-inventory",name:"Unified Inventory Management"},{path:"/lats/products/:productId/edit",name:"Edit Product"}],"/lats/inventory/new":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/unified-inventory",name:"Unified Inventory Management"},{path:"/lats/inventory/new",name:"Add Product"}],"/lats/inventory/products/new":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/unified-inventory",name:"Unified Inventory Management"},{path:"/lats/inventory/products/new",name:"Add Product"}],"/lats/payment-settings":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/payment-settings",name:"Payment Settings"}],"/lats/payment-history":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/payment-history",name:"Payment History"}],"/lats/payment-analytics":[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats/payment-analytics",name:"Payment Analytics"}]},_o=({className:t=""})=>{const l=Rl(),c=ta(),u=(()=>{const r=l.pathname;if(Pa[r])return Pa[r];for(const[d,g]of Object.entries(Pa))if(r.startsWith(d+"/"))return g;return r.startsWith("/lats/")?[{path:"/dashboard",name:"Dashboard",icon:ct},{path:"/lats",name:"LATS System"}]:[{path:"/dashboard",name:"Dashboard",icon:ct}]})();return u.length<=1?null:e.jsx("nav",{className:`flex items-center space-x-2 text-sm ${t}`,children:u.map((r,d)=>{const g=r.icon,N=d===u.length-1;return e.jsxs(qt.Fragment,{children:[e.jsxs(mt,{onClick:()=>c(r.path),variant:N?"secondary":"ghost",className:`${N?"text-gray-900 font-medium cursor-default":"text-gray-600 hover:text-gray-900"} px-2 py-1 text-sm`,disabled:N,children:[g&&e.jsx(g,{size:14,className:"mr-1"}),r.name]}),!N&&e.jsx(zl,{size:14,className:"text-gray-400"})]},r.path)})})},Do=({cartItemsCount:t,totalAmount:l,onProcessPayment:c,onClearCart:o,onPreviewInvoice:u,onScanQrCode:r,onAddCustomer:d,onViewReceipts:g,onViewSales:N,onOpenPaymentTracking:O,onOpenDrafts:P,isProcessingPayment:w,hasSelectedCustomer:p,draftCount:v=0,todaysSales:_=0,isDailyClosed:S=!1,onCloseDay:m,canCloseDay:k=!1,onViewAnalytics:A,onCustomers:Z,onReports:se,onRefreshData:y,onSettings:T,onOpenInstallments:q,onOpenExpense:j})=>{const{currentUser:F,logout:Y}=Fs(),{playPaymentSound:M,playDeleteSound:re,playClickSound:n}=Xt(),{openSearch:$}=vl(),[V,ie]=s.useState(new Date);s.useEffect(()=>{const L=setInterval(()=>{ie(new Date)},6e4);return()=>clearInterval(L)},[]);const ce=()=>{M(),c()},pe=()=>{re(),o()},ee=ta(),[X,be]=s.useState(!1),[ke,We]=s.useState(()=>{const L=localStorage.getItem("pos_view_mode");return L==="mobile"||L==="desktop"?L:"desktop"}),we=F==null?void 0:F.role;ht.can(we,"reports","view"),ht.can(we,"settings","view"),qt.useEffect(()=>{const L=()=>{be(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",L),document.addEventListener("webkitfullscreenchange",L),document.addEventListener("mozfullscreenchange",L),document.addEventListener("MSFullscreenChange",L),()=>{document.removeEventListener("fullscreenchange",L),document.removeEventListener("webkitfullscreenchange",L),document.removeEventListener("mozfullscreenchange",L),document.removeEventListener("MSFullscreenChange",L)}},[]),qt.useEffect(()=>{document.body.setAttribute("data-view-mode",ke),console.log(`ðŸ“± View mode set to: ${ke}`)},[ke]);const ze=L=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(L),et=()=>{ee("/dashboard")},C=async()=>{try{if(document.fullscreenElement)document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen(),n(),x.success("Exited fullscreen mode");else{const L=document.documentElement;L.requestFullscreen?await L.requestFullscreen():L.webkitRequestFullscreen?await L.webkitRequestFullscreen():L.mozRequestFullScreen?await L.mozRequestFullScreen():L.msRequestFullscreen&&await L.msRequestFullscreen(),n(),x.success("Entered fullscreen mode")}}catch(L){console.error("Fullscreen error:",L),x.error("Failed to toggle fullscreen")}},I=()=>{const L=ke==="desktop"?"mobile":"desktop";We(L),localStorage.setItem("pos_view_mode",L),n(),x.success(`Switched to ${L} view`,{icon:L==="mobile"?"ðŸ“±":"ðŸ–¥ï¸",duration:2e3}),window.dispatchEvent(new Event("viewModeChanged")),window.dispatchEvent(new Event("resize"))};return e.jsx("header",{className:"sticky top-0 z-20 bg-white/95 backdrop-blur-sm border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"px-4 sm:px-6 py-2.5 sm:py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-base sm:text-xl font-bold text-gray-900",children:"POS"}),S&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs font-medium",children:[e.jsx(Yr,{size:12}),e.jsx("span",{className:"hidden lg:inline",children:"Closed"})]})]})}),e.jsxs("div",{className:"hidden lg:flex items-center gap-3",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 rounded-lg border border-gray-200 min-h-[44px] flex items-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:V.toLocaleTimeString("en-TZ",{hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-xs text-gray-600",children:V.toLocaleDateString("en-TZ",{month:"short",day:"numeric"})})]})}),e.jsxs("button",{onClick:()=>{n(),N()},className:"flex items-center justify-center gap-2 px-5 py-3 min-w-[110px] rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",title:"View Sales Report",children:[e.jsx(ft,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:ze(_)})]}),e.jsxs("button",{onClick:()=>{n(),$()},className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 transition-all duration-200 shadow-sm hover:shadow-md min-h-[44px]",title:"Global Search (âŒ˜K)",children:[e.jsx(zt,{size:18}),e.jsx("span",{className:"text-sm font-medium hidden xl:inline",children:"Search"})]}),j&&(F==null?void 0:F.role)==="admin"&&e.jsxs("button",{onClick:()=>{n(),j()},className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white transition-all duration-200 shadow-sm hover:shadow-md min-h-[44px]",title:"Quick Expense (âš¡ Fast Entry)",children:[e.jsx(ft,{size:18}),e.jsx("span",{className:"text-sm font-medium hidden xl:inline",children:"Expense"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsxs("button",{onClick:u,disabled:!p,className:"flex items-center justify-center gap-2 px-4 py-3 min-w-[100px] rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 disabled:from-gray-400 disabled:to-gray-400 text-white transition-all duration-300 shadow-sm hover:shadow-md",title:p?"Preview invoice with current prices":"Please select a customer first",children:[e.jsx($a,{size:18}),e.jsx("span",{className:"hidden md:inline text-sm font-medium",children:"Invoice"}),e.jsx("span",{className:"md:hidden text-xs font-medium",children:"Inv"})]}),e.jsxs("button",{onClick:ce,disabled:w||!p,className:"flex items-center justify-center gap-2 px-5 py-3 min-w-[110px] rounded-lg bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 disabled:from-gray-400 disabled:to-gray-400 text-white transition-all duration-300 shadow-sm hover:shadow-md",title:p?w?"Processing payment...":"Process payment":"Please select a customer first",children:[e.jsx(js,{size:18}),e.jsx("span",{className:"hidden md:inline text-sm font-medium",children:w?"Processing...":"Pay"}),e.jsx("span",{className:"md:hidden text-xs font-medium",children:w?"...":"Pay"})]}),e.jsxs("button",{onClick:pe,className:"flex items-center justify-center gap-2 px-5 py-3 min-w-[110px] rounded-lg bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",title:"Clear Cart",children:[e.jsx(ls,{size:18}),e.jsx("span",{className:"hidden md:inline text-sm font-medium",children:"Clear"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[q&&e.jsxs("button",{onClick:()=>{n(),q()},className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white transition-all duration-200 shadow-sm hover:shadow-md font-medium",title:"Installment Plans",children:[e.jsx(Rt,{size:18}),e.jsx("span",{className:"hidden lg:inline",children:"Installments"})]}),m&&k&&!S&&e.jsxs("button",{onClick:()=>{n(),m()},className:"flex items-center justify-center gap-2 px-5 py-3 min-w-[110px] rounded-lg bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",title:"Close Daily Sales",children:[e.jsx(Yr,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Close Day"})]})]}),e.jsx("button",{onClick:()=>{n(),$()},className:"lg:hidden flex items-center justify-center p-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 shadow-sm min-h-[40px] min-w-[40px]",title:"Global Search",children:e.jsx(zt,{size:18})}),e.jsx("div",{className:"hidden md:block h-8 w-px bg-gray-300 mx-1"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>{n(),et()},className:"p-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 shadow-sm min-h-[40px] min-w-[40px] flex items-center justify-center",title:"Exit to Dashboard",children:e.jsx(ct,{size:18})}),T&&(F==null?void 0:F.role)==="admin"&&e.jsx("button",{onClick:()=>{n(),T()},className:"hidden md:flex p-2.5 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 shadow-sm min-h-[40px] min-w-[40px] items-center justify-center",title:"POS Settings",children:e.jsx(_a,{size:18})}),y&&e.jsx("button",{onClick:()=>{n(),y()},className:"hidden md:flex p-2.5 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 shadow-sm min-h-[40px] min-w-[40px] items-center justify-center",title:"Refresh Data",children:e.jsx(La,{size:18})}),e.jsx("button",{onClick:I,className:`hidden lg:flex p-2.5 rounded-lg transition-all duration-200 shadow-sm min-h-[40px] min-w-[40px] items-center justify-center ${ke==="mobile"?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:ke==="mobile"?"Switch to Desktop View":"Switch to Mobile View",children:ke==="mobile"?e.jsx(Ls,{size:18}):e.jsx(Nn,{size:18})}),e.jsx("button",{onClick:C,className:"hidden lg:flex p-2.5 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 shadow-sm min-h-[40px] min-w-[40px] items-center justify-center",title:X?"Exit Fullscreen":"Enter Fullscreen",children:X?e.jsx(ql,{size:18}):e.jsx(Ul,{size:18})})]})]})]})})})};function Io(){const[,t]=s.useState({});return s.useEffect(()=>jl(()=>{console.log("ðŸ”„ Locale changed, re-rendering component..."),t({})}),[]),{t:Nl,locale:wl()}}const Eo=({products:t,searchQuery:l,setSearchQuery:c,isSearching:o,showAdvancedFilters:u,setShowAdvancedFilters:r,selectedCategory:d,setSelectedCategory:g,selectedBrand:N,setSelectedBrand:O,priceRange:P,setPriceRange:w,stockFilter:p,setStockFilter:v,sortBy:_,setSortBy:S,sortOrder:m,setSortOrder:k,categories:A,brands:Z,onAddToCart:se,onAddExternalProduct:y,onSearch:T,onScanQrCode:q,currentPage:j,setCurrentPage:F,totalPages:Y,productsPerPage:M})=>{const{currentUser:re}=Fs(),n=re==null?void 0:re.role,$=ht.can(n,"products","create"),{playClickSound:V}=Xt(),{t:ie}=Io();s.useEffect(()=>{F(1)},[M,F]),s.useState(!1),s.useState([]);const[ce,pe]=s.useState(!1),[ee,X]=s.useState(!1),[be,ke]=s.useState("grid"),[We,we]=s.useState(new Set),{currentBranch:ze}=Rs(),et=(U,J)=>{const he={"Android Phones":{bg:"bg-green-50",text:"text-green-700",border:"border-green-200",selected:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white border-green-700"},"Android Tablets":{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",selected:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white border-blue-700"},iPhones:{bg:"bg-slate-50",text:"text-slate-700",border:"border-slate-200",selected:"bg-gradient-to-r from-slate-500 to-slate-600 hover:from-slate-600 hover:to-slate-700 text-white border-slate-700"},iPhone:{bg:"bg-slate-50",text:"text-slate-700",border:"border-slate-200",selected:"bg-gradient-to-r from-slate-500 to-slate-600 hover:from-slate-600 hover:to-slate-700 text-white border-slate-700"},iPad:{bg:"bg-sky-50",text:"text-sky-700",border:"border-sky-200",selected:"bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 text-white border-sky-700"},iPads:{bg:"bg-sky-50",text:"text-sky-700",border:"border-sky-200",selected:"bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 text-white border-sky-700"},"iOS Devices":{bg:"bg-slate-50",text:"text-slate-700",border:"border-slate-200",selected:"bg-gradient-to-r from-slate-500 to-slate-600 hover:from-slate-600 hover:to-slate-700 text-white border-slate-700"},"Smart Watches":{bg:"bg-pink-50",text:"text-pink-700",border:"border-pink-200",selected:"bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white border-pink-700"},Smartwatches:{bg:"bg-pink-50",text:"text-pink-700",border:"border-pink-200",selected:"bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white border-pink-700"},Laptops:{bg:"bg-indigo-50",text:"text-indigo-700",border:"border-indigo-200",selected:"bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white border-indigo-700"},Laptop:{bg:"bg-indigo-50",text:"text-indigo-700",border:"border-indigo-200",selected:"bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white border-indigo-700"},Computers:{bg:"bg-emerald-50",text:"text-emerald-700",border:"border-emerald-200",selected:"bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white border-emerald-700"},Computer:{bg:"bg-emerald-50",text:"text-emerald-700",border:"border-emerald-200",selected:"bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white border-emerald-700"},"Computer Parts":{bg:"bg-teal-50",text:"text-teal-700",border:"border-teal-200",selected:"bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 text-white border-teal-700"},Monitors:{bg:"bg-lime-50",text:"text-lime-700",border:"border-lime-200",selected:"bg-gradient-to-r from-lime-500 to-lime-600 hover:from-lime-600 hover:to-lime-700 text-white border-lime-700"},Monitor:{bg:"bg-lime-50",text:"text-lime-700",border:"border-lime-200",selected:"bg-gradient-to-r from-lime-500 to-lime-600 hover:from-lime-600 hover:to-lime-700 text-white border-lime-700"},Soundbars:{bg:"bg-rose-50",text:"text-rose-700",border:"border-rose-200",selected:"bg-gradient-to-r from-rose-500 to-rose-600 hover:from-rose-600 hover:to-rose-700 text-white border-rose-700"},Soundbar:{bg:"bg-rose-50",text:"text-rose-700",border:"border-rose-200",selected:"bg-gradient-to-r from-rose-500 to-rose-600 hover:from-rose-600 hover:to-rose-700 text-white border-rose-700"},"Bluetooth Speakers":{bg:"bg-amber-50",text:"text-amber-700",border:"border-amber-200",selected:"bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white border-amber-700"},"Bluetooth Speaker":{bg:"bg-amber-50",text:"text-amber-700",border:"border-amber-200",selected:"bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white border-amber-700"},"Audio & Sound":{bg:"bg-fuchsia-50",text:"text-fuchsia-700",border:"border-fuchsia-200",selected:"bg-gradient-to-r from-fuchsia-500 to-fuchsia-600 hover:from-fuchsia-600 hover:to-fuchsia-700 text-white border-fuchsia-700"},"Audio Accessories":{bg:"bg-violet-50",text:"text-violet-700",border:"border-violet-200",selected:"bg-gradient-to-r from-violet-500 to-violet-600 hover:from-violet-600 hover:to-violet-700 text-white border-violet-700"},Headphones:{bg:"bg-orange-50",text:"text-orange-700",border:"border-orange-200",selected:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white border-orange-700"},Headphone:{bg:"bg-orange-50",text:"text-orange-700",border:"border-orange-200",selected:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white border-orange-700"},Speakers:{bg:"bg-amber-50",text:"text-amber-700",border:"border-amber-200",selected:"bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white border-amber-700"},Accessories:{bg:"bg-purple-50",text:"text-purple-700",border:"border-purple-200",selected:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white border-purple-700"},Accessory:{bg:"bg-purple-50",text:"text-purple-700",border:"border-purple-200",selected:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white border-purple-700"},Chargers:{bg:"bg-yellow-50",text:"text-yellow-700",border:"border-yellow-200",selected:"bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white border-yellow-700"},Charger:{bg:"bg-yellow-50",text:"text-yellow-700",border:"border-yellow-200",selected:"bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white border-yellow-700"},"Cases & Covers":{bg:"bg-teal-50",text:"text-teal-700",border:"border-teal-200",selected:"bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 text-white border-teal-700"},Cases:{bg:"bg-teal-50",text:"text-teal-700",border:"border-teal-200",selected:"bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 text-white border-teal-700"},"Screen Protectors":{bg:"bg-cyan-50",text:"text-cyan-700",border:"border-cyan-200",selected:"bg-gradient-to-r from-cyan-500 to-cyan-600 hover:from-cyan-600 hover:to-cyan-700 text-white border-cyan-700"},"Screen Protector":{bg:"bg-cyan-50",text:"text-cyan-700",border:"border-cyan-200",selected:"bg-gradient-to-r from-cyan-500 to-cyan-600 hover:from-cyan-600 hover:to-cyan-700 text-white border-cyan-700"},Cables:{bg:"bg-zinc-50",text:"text-zinc-700",border:"border-zinc-200",selected:"bg-gradient-to-r from-zinc-500 to-zinc-600 hover:from-zinc-600 hover:to-zinc-700 text-white border-zinc-700"},Cable:{bg:"bg-zinc-50",text:"text-zinc-700",border:"border-zinc-200",selected:"bg-gradient-to-r from-zinc-500 to-zinc-600 hover:from-zinc-600 hover:to-zinc-700 text-white border-zinc-700"},"Spare Parts":{bg:"bg-stone-50",text:"text-stone-700",border:"border-stone-200",selected:"bg-gradient-to-r from-stone-500 to-stone-600 hover:from-stone-600 hover:to-stone-700 text-white border-stone-700"},"Repair Parts":{bg:"bg-red-50",text:"text-red-700",border:"border-red-200",selected:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white border-red-700"},"LCD Screens":{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",selected:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white border-blue-700"},"LCD Screen":{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",selected:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white border-blue-700"},"MacBook LCD Screens":{bg:"bg-indigo-50",text:"text-indigo-700",border:"border-indigo-200",selected:"bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white border-indigo-700"},Electronics:{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",selected:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white border-blue-700"},Electronic:{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",selected:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white border-blue-700"},Uncategorized:{bg:"bg-gray-50",text:"text-gray-700",border:"border-gray-200",selected:"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white border-gray-700"}},Ce={bg:"bg-gradient-to-br from-blue-50 to-indigo-50",text:"text-blue-700",border:"border-blue-200",selected:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white border-blue-700"};return he[U]||Ce},[C,I]=s.useState(new Map),[L,K]=s.useState(!1);s.useEffect(()=>{(async()=>{if(!(!t||t.length===0))try{K(!0);const J=t.map(qe=>qe.id),Ce=await qa.getInstance().getStockLevels(J),ye=new Map;Object.entries(Ce).forEach(([qe,He])=>{const Ue=He.reduce((Ge,Qe)=>Ge+Qe.quantity,0);ye.set(qe,Ue)}),I(ye)}catch(J){console.error("âŒ [ProductSearchSection] Error fetching batch stock:",J)}finally{K(!1)}})()},[t]),s.useEffect(()=>{const U=async()=>{if(!l.trim()||l.trim().length<2){we(new Set);return}try{const he=await go(l.trim(),ze==null?void 0:ze.id),Ce=new Set;he.forEach(ye=>{var He;const qe=ye.product_id||((He=ye.product)==null?void 0:He.id);qe&&Ce.add(qe)}),we(Ce)}catch(he){console.error("âŒ [ProductSearchSection] Error searching children variants:",he),we(new Set)}},J=setTimeout(()=>{U()},300);return()=>clearTimeout(J)},[l,ze==null?void 0:ze.id,t]);const de=U=>{const J=U.target.value;c(J),pe(!1)},fe=U=>{U.key==="Enter"&&(U.preventDefault(),l.trim()&&T(l.trim()))},Pe=U=>{/^\d{8,}$/.test(U)?q?q():x("QrCode scanning not available"):T(U)},G=t.filter(U=>{var ye,qe,He,Ue,Ge;if(l.trim()&&!We.has(U.id)){const D=l.toLowerCase();if(!(((ye=U.name)==null?void 0:ye.toLowerCase().includes(D))||((qe=U.sku)==null?void 0:qe.toLowerCase().includes(D))||((He=U.category)==null?void 0:He.name)&&U.category.name.toLowerCase().includes(D)||U.variants&&U.variants.some(ve=>{var At,kt,tt;return((At=ve.name)==null?void 0:At.toLowerCase().includes(D))||((kt=ve.sku)==null?void 0:kt.toLowerCase().includes(D))||((tt=ve.barcode)==null?void 0:tt.toLowerCase().includes(D))})))return!1}if(d&&d!=="All Product"&&d!=="all"&&d!==""&&(((Ue=U.category)==null?void 0:Ue.name)||U.categoryName||"")!==d)return!1;const J=(Ge=U.variants)==null?void 0:Ge[0],he=(J==null?void 0:J.sellingPrice)||U.price||0,Ce=Ys(U);if(P.min&&he<parseFloat(P.min)||P.max&&he>parseFloat(P.max))return!1;switch(p){case"in-stock":if(Ce<=0)return!1;break;case"low-stock":if(Ce>10||Ce<=0)return!1;break;case"out-of-stock":if(Ce>0)return!1;break}return!0}),ge=[...G].sort((U,J)=>{var te,ve;const he=(te=U.variants)==null?void 0:te[0],Ce=(ve=J.variants)==null?void 0:ve[0],ye=(he==null?void 0:he.sellingPrice)||U.price||0,qe=(Ce==null?void 0:Ce.sellingPrice)||J.price||0,He=Ys(U),Ue=Ys(J),Ge=He>0,Qe=Ue>0;if(Ge&&!Qe)return-1;if(!Ge&&Qe)return 1;let D=0;switch(_){case"name":D=U.name.localeCompare(J.name);break;case"price":D=ye-qe;break;case"stock":D=He-Ue;break;case"recent":D=U.id.localeCompare(J.id);break;case"sales":D=Ue-He;break}return m==="asc"?D:-D}),ae=ge;return s.useEffect(()=>{},[t.length,G.length,ge.length,ae.length,l,d,p]),e.jsx("div",{className:"h-full flex flex-col",children:e.jsxs(ms,{className:"p-6 h-full flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 mb-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-xl border border-gray-200 shadow-md p-4 mb-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(zt,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-500 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:`${ie("common.search")} ${ie("common.products").toLowerCase()}...`,value:l,onChange:de,onKeyPress:fe,className:"w-full min-h-[52px] pl-12 pr-24 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all text-sm font-medium placeholder:text-gray-400 shadow-sm hover:shadow-md"}),e.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[$&&e.jsx("button",{onClick:()=>{V(),y()},className:"p-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-all duration-200 shadow-sm hover:shadow-md",title:"Add Product",children:e.jsx(ut,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{V(),l.trim()&&Pe(l.trim())},className:"p-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-all duration-200 shadow-sm hover:shadow-md",title:"Scan Barcode",children:e.jsx(Bl,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex rounded-lg overflow-hidden shadow-sm border border-gray-300",children:[e.jsxs("select",{value:_,onChange:U=>S(U.target.value),className:"min-h-[44px] px-4 py-2.5 focus:outline-none focus:ring-0 bg-gradient-to-br from-gray-50 to-gray-100 text-sm font-medium border-none hover:from-gray-100 hover:to-gray-200 transition-all cursor-pointer",children:[e.jsx("option",{value:"sales",children:"ðŸ”¥ Best Selling"}),e.jsx("option",{value:"name",children:"ðŸ”¤ Name"}),e.jsx("option",{value:"price",children:"ðŸ’° Price"}),e.jsx("option",{value:"stock",children:"ðŸ“¦ Stock"})]}),e.jsx("button",{onClick:()=>{V(),k(m==="asc"?"desc":"asc")},className:"min-h-[44px] min-w-[44px] flex items-center justify-center px-3 py-2 text-lg font-bold bg-gradient-to-br from-gray-50 to-gray-100 border-l border-gray-300 text-gray-700 hover:from-gray-100 hover:to-gray-200 transition-all",title:m==="asc"?"Ascending":"Descending",children:m==="asc"?"â†‘":"â†“"})]}),(P.min||P.max)&&e.jsxs("div",{className:"flex rounded-lg overflow-hidden shadow-sm border border-blue-300 bg-gradient-to-br from-blue-50 to-blue-100",children:[e.jsx("div",{className:"flex items-center px-2 text-blue-700",children:e.jsx(ft,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",placeholder:"Min",value:P.min,onChange:U=>w({...P,min:U.target.value}),className:"min-h-[44px] px-3 py-2.5 focus:outline-none focus:ring-0 bg-transparent text-sm font-medium text-blue-900 w-20 border-none placeholder:text-blue-400"}),e.jsx("div",{className:"flex items-center px-1 text-blue-700 font-bold",children:"â€”"}),e.jsx("input",{type:"number",placeholder:"Max",value:P.max,onChange:U=>w({...P,max:U.target.value}),className:"min-h-[44px] px-3 py-2.5 focus:outline-none focus:ring-0 bg-transparent text-sm font-medium text-blue-900 w-20 border-none placeholder:text-blue-400"}),e.jsx("button",{onClick:()=>{V(),w({min:"",max:""})},className:"min-h-[44px] px-3 py-2 text-blue-600 hover:text-red-600 hover:bg-red-50 transition-all border-l border-blue-300",title:"Clear price filter",children:e.jsx(Je,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>{V(),g("")},className:`min-h-[44px] px-4 sm:px-5 py-2 sm:py-3 text-xs sm:text-sm font-medium rounded-lg transition-all duration-300 border shadow-sm ${d===""?"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white border-blue-700 shadow-md":"bg-gradient-to-br from-gray-50 to-gray-100 text-gray-700 border-gray-300 hover:shadow-md hover:scale-105"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[d===""&&e.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"All Products"]})}),(ee?A:A.slice(0,3)).map(U=>{const J=et(U),he=d===U;return e.jsx("button",{onClick:()=>{V(),g(U)},className:`min-h-[44px] px-4 sm:px-5 py-2 sm:py-3 text-xs sm:text-sm font-medium rounded-lg transition-all duration-300 border shadow-sm hover:scale-105 ${he?J.selected+" shadow-md":`${J.bg} ${J.text} ${J.border} hover:shadow-md`}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[he&&e.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),U]})},U)}),A.length>3&&e.jsx("button",{onClick:()=>{V(),X(!ee)},className:"min-h-[44px] min-w-[44px] flex items-center justify-center px-3 py-2 text-sm bg-gradient-to-br from-gray-50 to-gray-100 text-gray-700 border border-gray-300 hover:bg-gradient-to-br hover:from-gray-100 hover:to-gray-200 hover:shadow-md hover:scale-105 transition-all duration-300 rounded-lg shadow-sm",title:ee?"Show less":"Show all categories",children:ee?e.jsx(Je,{className:"w-5 h-5"}):e.jsx(Vl,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>{V(),v("all")},className:`min-h-[44px] px-4 sm:px-5 py-2 sm:py-3 text-xs sm:text-sm font-medium rounded-lg transition-all duration-300 border shadow-sm hover:scale-105 ${p==="all"?"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white border-blue-700 shadow-md":"bg-gradient-to-br from-blue-50 to-blue-100 text-blue-700 border-blue-200 hover:shadow-md"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[p==="all"&&e.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"All Stock"]})}),e.jsx("button",{onClick:()=>{V(),v("in-stock")},className:`min-h-[44px] px-4 sm:px-5 py-2 sm:py-3 text-xs sm:text-sm font-medium rounded-lg transition-all duration-300 border shadow-sm hover:scale-105 ${p==="in-stock"?"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white border-green-700 shadow-md":"bg-gradient-to-br from-green-50 to-green-100 text-green-700 border-green-200 hover:shadow-md"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[p==="in-stock"&&e.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"In Stock"]})}),e.jsx("button",{onClick:()=>{V(),v("low-stock")},className:`min-h-[44px] px-4 sm:px-5 py-2 sm:py-3 text-xs sm:text-sm font-medium rounded-lg transition-all duration-300 border shadow-sm hover:scale-105 ${p==="low-stock"?"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white border-orange-700 shadow-md":"bg-gradient-to-br from-orange-50 to-orange-100 text-orange-700 border-orange-200 hover:shadow-md"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[p==="low-stock"&&e.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"Low Stock"]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{V(),ke("grid")},className:`min-h-[44px] min-w-[44px] flex items-center justify-center px-3 sm:px-4 py-2 sm:py-3 text-sm transition-all duration-300 rounded-lg border shadow-sm hover:scale-105 ${be==="grid"?"bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-800 hover:to-gray-900 text-white border-gray-900 shadow-md":"bg-gradient-to-br from-gray-50 to-gray-100 text-gray-700 border-gray-300 hover:shadow-md"}`,title:"Grid View",children:e.jsx(Zl,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{V(),ke("list")},className:`min-h-[44px] min-w-[44px] flex items-center justify-center px-3 sm:px-4 py-2 sm:py-3 text-sm transition-all duration-300 rounded-lg border shadow-sm hover:scale-105 ${be==="list"?"bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-800 hover:to-gray-900 text-white border-gray-900 shadow-md":"bg-gradient-to-br from-gray-50 to-gray-100 text-gray-700 border-gray-300 hover:shadow-md"}`,title:"List View",children:e.jsx(wn,{className:"w-5 h-5"})})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden pos-products-scroll pr-2",style:{minHeight:0},children:ae.length>0?be==="grid"?e.jsxs("div",{className:"w-full max-w-full pb-6",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(320px, 100%), 1fr))",gap:"clamp(1rem, 2vw, 1.5rem)",gridAutoRows:"1fr"},children:ae.map(U=>e.jsx(io,{product:U,onAddToCart:se,realTimeStockData:C,className:"w-full h-full"},U.id))}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Showing ",ae.length," of ",ge.length," products"]})})]}):e.jsxs("div",{className:"pb-6",children:[e.jsx("div",{className:"space-y-3 mb-6",children:ae.map(U=>{var Qe,D;const J=(Qe=U.variants)==null?void 0:Qe.map(te=>({...te,id:te.id,name:te.name||te.variant_name,sku:te.sku,barcode:te.barcode,price:te.selling_price||te.sellingPrice||te.price||0,sellingPrice:te.selling_price||te.sellingPrice||te.price||0,costPrice:te.costPrice||te.cost_price||0,quantity:te.quantity??te.stockQuantity??te.stock_quantity??0,stockQuantity:te.stockQuantity??te.quantity??te.stock_quantity??0,minStockLevel:te.minStockLevel||te.min_stock_level||te.minQuantity||te.min_quantity||0,attributes:te.attributes||{}})),he=J==null?void 0:J[0],Ce=J&&J.length>1,ye=Number((he==null?void 0:he.sellingPrice)||U.price||0);let qe=0;const He=C.get(U.id);He!=null?qe=He:he?qe=he.stockQuantity||0:qe=U.stockQuantity??U.totalQuantity??0;const Ue=qe<=0,Ge=qe>0&&qe<=10;return e.jsx("div",{className:"group bg-gradient-to-r from-white to-gray-50/30 rounded-xl border border-gray-200/80 hover:border-blue-300 hover:shadow-lg transition-all duration-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl overflow-hidden shadow-sm ring-2 ring-white group-hover:ring-blue-100 transition-all",children:U.image?e.jsx("img",{src:U.image,alt:U.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-50",children:e.jsx(ut,{className:"w-10 h-10 text-blue-300"})})}),e.jsx("div",{className:`absolute -top-1 -right-1 w-6 h-6 rounded-full border-2 border-white shadow-sm ${Ue?"bg-red-500":Ge?"bg-orange-500":"bg-green-500"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1.5",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-lg truncate group-hover:text-blue-700 transition-colors",title:U.name,children:U.name}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[((he==null?void 0:he.sku)||U.sku)&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300"}),e.jsx("span",{className:"font-mono",children:(he==null?void 0:he.sku)||U.sku})]}),J&&J.length>1&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-purple-50 text-purple-700 border border-purple-200/50",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),J.length," Variants"]}),((D=U.category)==null?void 0:D.name)&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200/50",children:U.category.name}),e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-semibold ${Ue?"bg-red-50 text-red-700 border border-red-200/50":Ge?"bg-orange-50 text-orange-700 border border-orange-200/50":"bg-green-50 text-green-700 border border-green-200/50"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${Ue?"bg-red-500":Ge?"bg-orange-500":"bg-green-500"}`}),Ue?"Out of Stock":`${qe} units`]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:["TSh ",ye.toLocaleString()]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"per unit"})]}),e.jsx("button",{onClick:()=>{V();const te={...U,variants:J};he?se(te,he):se(te)},disabled:Ue,className:`
                              px-6 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap
                              ${Ue?"bg-gray-100 text-gray-400 cursor-not-allowed":Ce?"bg-purple-600 text-white hover:bg-purple-700 active:bg-purple-800":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"}
                            `,children:Ue?"Unavailable":Ce?"Select Variant":"Add to Cart"})]})]})},U.id)})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Showing ",ae.length," of ",ge.length," products"]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[e.jsx(ut,{className:"w-16 h-16 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No products found"}),e.jsx("p",{className:"text-sm text-center mb-4",children:t.length===0?"No products available. Please check if products are loaded from the database.":`Found ${t.length} products, but none match your current filters.`}),t.length===0&&e.jsx("button",{onClick:()=>{window.location.reload()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Reload Page"}),t.length>0&&e.jsx("p",{className:"text-sm text-center",children:"Try adjusting your search or filters to find what you're looking for."})]})})]})})},_n=({item:t,onQuantityChange:l,onRemove:c,onVariantChange:o,onTagsChange:u,onIMEISelect:r,availableVariants:d=[],showStockInfo:g=!0,variant:N="default",className:O="",autoExpand:P=!1,isExpanded:w,onToggleExpand:p})=>{const[v,_]=s.useState(!1),[S,m]=s.useState(t.quantity),[k,A]=s.useState(!1),[Z,se]=s.useState(!1),[y,T]=s.useState(""),[q,j]=s.useState(!1),[F,Y]=s.useState(!1),[M,re]=s.useState(P),[n,$]=s.useState(t.image||null),{playClickSound:V,playDeleteSound:ie}=Xt(),ce=w!==void 0?w:M;s.useEffect(()=>{P&&N==="compact"&&w===void 0&&(re(!0),p&&p(t.id))},[P,N,t.id,w,p]);const pe=()=>{p?p(t.id):re(!M)},ee=t.unitPrice*t.quantity,X=t.availableQuantity,ke=(()=>t.quantity>X?"insufficient":X<=5?"low":"normal")();qt.useEffect(()=>{(async()=>{if(t.selectedSerialNumbers&&t.selectedSerialNumbers.length>0){j(!1);return}Y(!0);try{let ge=!1;if(t.variantId&&t.variantId!=="default"){const{count:U}=await Te.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("parent_variant_id",t.variantId).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0);if(ge=(U||0)>0,ge){j(!0),Y(!1);return}else{const{data:J}=await Te.from("lats_product_variants").select("variant_attributes").eq("id",t.variantId).eq("is_active",!0).single();j(!1),Y(!1);return}}const{data:ae}=await Te.from("lats_product_variants").select("id").eq("product_id",t.productId).not("variant_attributes->>'imei'","is",null).eq("is_active",!0).gt("quantity",0).limit(1);j(ae&&ae.length>0)}catch(ge){console.error("Error checking IMEI requirement:",ge),j(!1)}finally{Y(!1)}})()},[t.productId,t.variantId,t.selectedSerialNumbers]);const We=()=>{switch(ke){case"insufficient":return e.jsx(as,{variant:"error",size:"sm",children:"Insufficient Stock"});case"low":return e.jsx(as,{variant:"warning",size:"sm",children:"Low Stock"});default:return e.jsx(as,{variant:"success",size:"sm",children:"In Stock"})}},we=G=>{G<=0?c():l(G)},ze=G=>{const ge=parseInt(G.target.value)||0;m(ge)},et=()=>{we(S),_(!1)},C=()=>{m(t.quantity),_(!1)},I=G=>{o&&o(G),A(!1)},L=()=>{if(y.trim()&&u){const G=t.tags||[];G.includes(y.trim())||(u([...G,y.trim()]),V()),T(""),se(!1)}},K=G=>{if(u){const ge=t.tags||[];u(ge.filter(ae=>ae!==G)),V()}},de=d.length>1;s.useEffect(()=>{(async()=>{if(t.image){$(t.image);return}try{const{data:ge,error:ae}=await Te.from("lats_products").select("images, thumbnail_url, image, primary_image").eq("id",t.productId).single();if(ae){console.error("Error fetching product image:",ae);return}if(ge){let U;if(ge.images&&Array.isArray(ge.images)&&ge.images.length>0){const J=ge.images[0];U=typeof J=="string"?J:(J==null?void 0:J.url)||(J==null?void 0:J.thumbnailUrl)}else U=ge.thumbnail_url||ge.image||ge.primary_image;U&&$(U)}}catch(ge){console.error("Error fetching product image:",ge)}})()},[t.productId,t.image]);const Pe=(()=>n)();return N==="compact"?e.jsxs("div",{className:`bg-white border-2 rounded-2xl shadow-sm hover:shadow-md transition-all duration-300 ${O} ${ce?"border-blue-500 shadow-xl":ke==="insufficient"?"border-red-300":ke==="low"?"border-orange-300":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between p-4 cursor-pointer",onClick:pe,children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${ce?"bg-blue-500":"bg-gray-200"}`,children:e.jsx("svg",{className:`w-4 h-4 text-white transition-transform duration-200 ${ce?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),Pe?e.jsx("div",{className:"w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 overflow-hidden",children:e.jsx(Ta,{src:Pe,alt:t.productName,className:"w-full h-full rounded-md",fallbackText:t.productName.charAt(0).toUpperCase()})}):e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center flex-shrink-0",children:e.jsx(ut,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1 min-w-0",children:e.jsx("h3",{className:"font-bold text-gray-900 truncate text-base flex-1 min-w-0 max-w-full",children:t.productName})}),t.variantName!=="Default"&&e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-600 mt-1",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:t.variantName})}),!ce&&e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1.5",children:Ze.money(ee)}),t.selectedSerialNumbers&&t.selectedSerialNumbers.length>0?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mt-1 font-medium",children:[e.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsxs("span",{children:["IMEI: ",t.selectedSerialNumbers.map(G=>G.imei||G.serial_number).join(", ")]})]}):q?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(as,{variant:"warning",size:"sm",className:"text-xs",children:[e.jsx(rs,{className:"w-3 h-3 mr-1"}),"IMEI Required"]}),r&&e.jsx(mt,{onClick:G=>{G.stopPropagation(),r(t)},variant:"primary",size:"sm",className:"text-xs px-2 py-1",children:"Select IMEI"})]}):null,t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:t.tags.map((G,ge)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-50 text-blue-700 rounded-full text-xs font-medium border border-blue-200",children:[e.jsx(Qs,{className:"w-2.5 h-2.5"}),G]},ge))})]})]})}),e.jsx("button",{type:"button",onClick:G=>{G.stopPropagation(),c()},className:"flex-shrink-0 inline-flex items-center justify-center w-9 h-9 text-sm font-medium text-white bg-red-500 hover:bg-red-600 border border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200 shadow-lg",children:e.jsx(ls,{className:"w-5 h-5"})})]}),ce&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 truncate",children:Ze.money(ee)})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("button",{type:"button",onClick:G=>{G.stopPropagation(),we(t.quantity-1)},disabled:t.quantity<=1,className:"inline-flex items-center justify-center w-12 h-12 text-base font-medium text-gray-700 bg-white border-2 border-gray-300 rounded-xl hover:bg-gray-50 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm flex-shrink-0",children:e.jsx(Da,{className:"w-5 h-5"})}),e.jsx("span",{className:"flex-1 text-center font-bold text-lg px-4 py-2 bg-white rounded-xl border-2 border-gray-300 shadow-sm",children:t.quantity}),e.jsx("button",{type:"button",onClick:G=>{G.stopPropagation(),we(t.quantity+1)},disabled:t.quantity>=X,className:"inline-flex items-center justify-center w-12 h-12 text-base font-medium text-gray-700 bg-white border-2 border-gray-300 rounded-xl hover:bg-gray-50 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm flex-shrink-0",children:e.jsx(Wt,{className:"w-5 h-5"})})]})]})]})})}),ke==="insufficient"&&e.jsx("div",{className:"mx-4 mb-4 p-3 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-800",children:[e.jsx(rs,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"font-semibold",children:"Warning:"}),e.jsxs("span",{children:["Requested quantity (",t.quantity,") exceeds available stock (",X,")"]})]})})]}):e.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-200 ${O}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[Pe?e.jsx("div",{className:"w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 overflow-hidden",children:e.jsx(Ta,{src:Pe,alt:t.productName,className:"w-full h-full rounded-md",fallbackText:t.productName.charAt(0).toUpperCase()})}):e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-md flex items-center justify-center flex-shrink-0",children:e.jsx(ut,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate min-w-0 max-w-full",children:t.productName}),t.variantName!=="Default"&&e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600 mt-1",children:e.jsx("span",{className:"text-blue-600 font-medium",children:t.variantName})}),t.selectedSerialNumbers&&t.selectedSerialNumbers.length>0?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mt-1 font-medium",children:[e.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsxs("span",{children:["IMEI: ",t.selectedSerialNumbers.map(G=>G.imei||G.serial_number).join(", ")]})]}):q?e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(as,{variant:"warning",size:"sm",children:[e.jsx(rs,{className:"w-3 h-3 mr-1"}),"IMEI Required"]}),r&&e.jsx(mt,{onClick:()=>r(t),variant:"primary",size:"sm",className:"text-xs px-3 py-1",children:"Select IMEI"})]}):null,t.attributes&&Object.keys(t.attributes).length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"space-y-1.5",children:Object.entries(t.attributes).slice(0,6).map(([G,ge])=>{const ae=ho(G),U=po(G),J=fo(G,ge),he=Ce=>{const ye=Ce.toLowerCase();return ye.includes("ram")?"bg-emerald-50 text-emerald-800 border-emerald-200":ye.includes("storage")||ye.includes("memory")?"bg-blue-50 text-blue-800 border-blue-200":ye.includes("processor")||ye.includes("cpu")?"bg-purple-50 text-purple-800 border-purple-200":ye.includes("screen")||ye.includes("display")?"bg-orange-50 text-orange-800 border-orange-200":ye.includes("battery")?"bg-teal-50 text-teal-800 border-teal-200":ye.includes("camera")?"bg-pink-50 text-pink-800 border-pink-200":ye.includes("color")?"bg-red-50 text-red-800 border-red-200":ye.includes("weight")||ye.includes("size")?"bg-gray-50 text-gray-800 border-gray-200":ye.includes("charger")||ye.includes("port")?"bg-cyan-50 text-cyan-800 border-cyan-200":"bg-slate-50 text-slate-800 border-slate-200"};return e.jsx("div",{className:`p-2 rounded-md border ${he(G)} hover:shadow-sm transition-all duration-200 cursor-help`,title:U,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ae&&e.jsx(ae,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.jsx("div",{children:e.jsx("div",{className:"text-xs font-medium capitalize text-gray-700",children:G.replace(/([A-Z])/g," $1").trim()})})]}),e.jsx("div",{className:"text-xs font-semibold",children:J})]})},G)})}),Object.keys(t.attributes).length>6&&e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full border border-gray-200 bg-gray-50 text-gray-600 text-xs font-medium",children:["+",Object.keys(t.attributes).length-6," more"]})})]}),de&&e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(Qs,{className:"w-3 h-3"}),e.jsx("span",{children:"Click to change variant"})]})]})]}),ke==="insufficient"&&We()]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:g&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Available: ",X," units"]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-2xl text-gray-900",children:Ze.money(ee)}),de&&o&&e.jsxs("button",{onClick:()=>A(!k),className:"mt-2 inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx(Fa,{className:"w-3 h-3"}),"Change Variant"]})]})]}),k&&de&&o&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Select Variant:"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:d.map(G=>{const ge=G.id===t.variantId,ae=G.quantity<=0?"out-of-stock":G.quantity<=5?"low":"normal";return e.jsx("div",{className:`p-2 rounded-lg border cursor-pointer transition-all ${ge?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>I(G.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:G.name}),e.jsx("div",{className:"text-xs text-gray-600 flex items-center gap-2",children:e.jsx("span",{className:"font-mono",children:G.sku})}),Object.entries(G.attributes).length>0&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(G.attributes).map(([U,J])=>{const he=Ce=>{const ye=Ce.toLowerCase();return ye.includes("ram")?"bg-green-100 text-green-700":ye.includes("storage")||ye.includes("memory")?"bg-blue-100 text-blue-700":ye.includes("processor")||ye.includes("cpu")?"bg-purple-100 text-purple-700":ye.includes("screen")||ye.includes("display")?"bg-orange-100 text-orange-700":ye.includes("battery")?"bg-teal-100 text-teal-700":ye.includes("camera")?"bg-pink-100 text-pink-700":ye.includes("color")?"bg-red-100 text-red-700":ye.includes("size")?"bg-gray-100 text-gray-700":"bg-indigo-100 text-indigo-700"};return e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${he(U)}`,children:[U.replace(/_/g," "),": ",J]},U)})})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-sm",children:Ze.money(G.sellingPrice)}),e.jsxs("div",{className:`text-xs ${ae==="out-of-stock"?"text-red-600":ae==="low"?"text-orange-600":"text-green-600"}`,children:["Stock: ",G.quantity]})]})]})},G.id)})})]}),u&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4 text-blue-600"}),"Product Tags"]}),e.jsx("button",{onClick:()=>{V(),se(!Z)},className:"text-xs px-2 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:Z?"Cancel":"+ Add Tag"})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.tags.map((G,ge)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 rounded-full text-xs font-medium border border-blue-200 hover:shadow-sm transition-all",children:[e.jsx(Qs,{className:"w-3 h-3"}),G,e.jsx("button",{onClick:()=>K(G),className:"ml-1 hover:bg-blue-200 rounded-full p-0.5 transition-colors",children:e.jsx(Je,{className:"w-3 h-3"})})]},ge))}),Z&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:y,onChange:G=>T(G.target.value),onKeyPress:G=>G.key==="Enter"&&L(),placeholder:"Enter tag name...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),e.jsx("button",{onClick:L,disabled:!y.trim(),className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:"Add"})]}),(!t.tags||t.tags.length===0)&&!Z&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:"No tags added yet"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantity:"}),v?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",min:"1",max:X,value:S,onChange:ze,className:"w-20 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),e.jsx("button",{onClick:et,disabled:S<=0||S>X,className:"inline-flex items-center justify-center w-8 h-8 text-sm font-medium text-white bg-green-600 border border-transparent rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"âœ“"}),e.jsx("button",{onClick:C,className:"inline-flex items-center justify-center w-8 h-8 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"âœ•"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{V(),we(t.quantity-1)},disabled:t.quantity<=1,className:"inline-flex items-center justify-center w-10 h-10 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Da,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-16 text-center font-semibold text-lg cursor-pointer hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-200",onClick:()=>{V(),_(!0)},children:t.quantity}),e.jsx("button",{onClick:()=>{V(),we(t.quantity+1)},disabled:t.quantity>=X,className:"inline-flex items-center justify-center w-10 h-10 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Wt,{className:"w-4 h-4"})})]})]}),e.jsxs("button",{onClick:()=>{ie(),c()},className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200",children:[e.jsx(ls,{className:"w-4 h-4"}),"Remove"]})]}),ke==="insufficient"&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Warning:"})," Requested quantity (",t.quantity,") exceeds available stock (",X,")"]})})]})},To=({cartItems:t,selectedCustomer:l,onRemoveCustomer:c,onShowCustomerSearch:o,onShowCustomerDetails:u,onUpdateCartItemQuantity:r,onRemoveCartItem:d,onUpdateCartItemTags:g,onIMEISelect:N,onApplyDiscount:O,onProcessPayment:P,onShowInstallmentModal:w,onShowTradeInModal:p,onShowDiscountModal:v,onClearDiscount:_,onPreviewInvoice:S,dynamicPricingEnabled:m=!1,totalAmount:k,discountAmount:A,discountPercentage:Z=0,currentDiscountType:se,taxAmount:y,taxRate:T,finalAmount:q,onEditCustomer:j,isTaxEnabled:F=!0})=>{const Y=t.reduce((I,L)=>I+L.quantity,0),{playClickSound:M,playPaymentSound:re,playDeleteSound:n}=Xt(),[$,V]=s.useState(null),[ie,ce]=s.useState(!1),[pe,ee]=s.useState(!1),X=I=>I?I.replace(/,/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,","):"",be=I=>I.replace(/,/g,""),[ke,We]=s.useState("fixed"),[we,ze]=s.useState(""),et=[...t].reverse();s.useEffect(()=>{if(et.length>0){const I=et[0];V(I.id)}},[t.length]),s.useEffect(()=>{A>0&&ee(!0)},[A]),s.useEffect(()=>{if(A===0&&ie&&pe){const I=setTimeout(()=>{ce(!1),ee(!1)},1500);return()=>clearTimeout(I)}},[A,ie,pe]);const C=I=>{V(L=>L===I?null:I)};return e.jsx("div",{className:"lg:w-[450px] flex-shrink-0 pos-cart-section",children:e.jsxs(ms,{className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 flex-shrink-0",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(Ns,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Shopping Cart"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.length," items in cart"]})]})]}),e.jsx("div",{className:"flex-shrink-0 mb-6",children:l?e.jsx("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${l.colorTag==="vip"||l.loyaltyLevel==="vip"||l.loyaltyLevel==="premium"?"border-amber-300 hover:border-amber-400 hover:shadow-md":"border-green-200 hover:border-green-300 hover:shadow-md"}`,children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg ${l.colorTag==="vip"||l.loyaltyLevel==="vip"||l.loyaltyLevel==="premium"?"bg-gradient-to-br from-amber-500 to-amber-600":"bg-gradient-to-br from-blue-500 to-blue-600"}`,children:l.name.charAt(0).toUpperCase()}),e.jsx("div",{className:`absolute -top-1 -right-1 w-6 h-6 rounded-full border-2 border-white flex items-center justify-center shadow-md ${l.colorTag==="vip"||l.loyaltyLevel==="vip"||l.loyaltyLevel==="premium"?"bg-amber-500":"bg-emerald-500"}`,children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 truncate",children:l.name}),l.colorTag==="vip"||l.loyaltyLevel==="vip"||l.loyaltyLevel==="premium"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-amber-500 text-white shadow-sm flex-shrink-0",children:[e.jsx(Xs,{className:"w-3 h-3"}),"VIP"]}):null]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(Jt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"truncate",children:l.phone})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-50 border border-blue-200 w-fit",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),e.jsxs("span",{className:"text-xs font-semibold text-blue-700",children:[l.points||0," points"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>{M(),u(l)},className:"p-2.5 text-blue-600 hover:bg-blue-100 rounded-xl transition-all duration-200 hover:scale-110 active:scale-95",title:"View customer details",children:e.jsx(xt,{className:"w-5 h-5"})}),j&&e.jsx("button",{onClick:()=>{M(),j(l)},className:"p-2.5 text-green-600 hover:bg-green-100 rounded-xl transition-all duration-200 hover:scale-110 active:scale-95",title:"Edit customer information",children:e.jsx(Ia,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:()=>{n(),c()},className:"flex-shrink-0 inline-flex items-center justify-center w-9 h-9 text-sm font-medium text-white bg-red-500 hover:bg-red-600 border border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200 shadow-lg",title:"Remove customer",children:e.jsx(ls,{className:"w-5 h-5"})})]})]})})}):e.jsx("div",{onClick:()=>{M(),o()},className:"bg-gradient-to-br from-blue-50 via-blue-50 to-blue-50 rounded-xl border-2 border-dashed border-blue-300 shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer",children:e.jsx("div",{className:"p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 via-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white shadow-lg",children:e.jsx(zt,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Select Customer"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a customer to continue"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Click here to select"})]}),e.jsxs("button",{onClick:I=>{I.stopPropagation(),M(),o()},className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md hover:shadow-lg",children:[e.jsx(Wt,{className:"w-5 h-5"}),e.jsx("span",{children:"Select Customer"})]})]})})})}),e.jsx("div",{className:"my-4 border-t border-gray-200"}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden pr-2",style:{minHeight:0},children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ns,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cart is empty"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add products to start a transaction"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"space-y-3 mb-6",children:et.map((I,L)=>e.jsx(_n,{item:I,onQuantityChange:K=>r(I.id,K),onRemove:()=>d(I.id),onTagsChange:g?K=>g(I.id,K):void 0,onIMEISelect:N,variant:"compact",autoExpand:L===0,isExpanded:$===I.id,onToggleExpand:C},I.id))})})}),t.length>0&&e.jsxs("div",{className:"flex-shrink-0 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-3 text-base",children:[e.jsxs("span",{className:"text-gray-600 font-medium",children:[Y," ",Y===1?"item":"items"]}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"Subtotal:"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["TZS ",k.toLocaleString()]})]})}),e.jsx("div",{className:"mb-4",children:ie?e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl border border-orange-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Discount Options"})]}),e.jsx("button",{onClick:()=>{M(),ce(!1)},className:"p-2 hover:bg-orange-100 rounded-lg transition-colors",title:"Collapse",children:e.jsx(Ea,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"p-4",children:A===0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-1 mb-4 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{We("fixed"),ze("")},className:`flex-1 py-2 px-3 text-sm font-medium rounded-md transition-all duration-200 ${ke==="fixed"?"bg-white text-orange-600 shadow-sm":"text-gray-600 hover:bg-gray-50"}`,children:"TZS"}),e.jsx("button",{onClick:()=>{We("percentage"),ze("")},className:`flex-1 py-2 px-3 text-sm font-medium rounded-md transition-all duration-200 ${ke==="percentage"?"bg-white text-orange-600 shadow-sm":"text-gray-600 hover:bg-gray-50"}`,children:"%"})]}),e.jsxs("div",{className:"bg-gray-50 border-2 border-gray-200 rounded-lg p-4 focus-within:border-orange-500 transition-colors",children:[e.jsx("input",{type:"text",value:X(we),onChange:I=>{const L=I.target.value.replace(/[^0-9,]/g,"");ze(be(L))},placeholder:"0",className:"w-full text-center text-3xl font-bold text-gray-900 bg-transparent border-none outline-none mb-3",autoFocus:!0,onKeyPress:I=>{var L,K,de;if(I.key==="Enter"){const fe=(de=(K=(L=I.currentTarget.parentElement)==null?void 0:L.parentElement)==null?void 0:K.parentElement)==null?void 0:de.querySelector('button[type="submit"]');fe==null||fe.click()}}}),ke==="percentage"&&e.jsx("div",{className:"flex gap-2 justify-center",children:[5,10,15,20].map(I=>e.jsxs("button",{onClick:()=>{M(),O("percentage",I.toString()),ce(!1)},className:"px-3 py-1.5 bg-white hover:bg-orange-50 text-gray-700 hover:text-orange-700 rounded-md text-sm font-medium transition-colors border border-gray-200",children:[I,"%"]},I))})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{type:"submit",onClick:()=>{M(),!(!we||parseFloat(we)<=0)&&(O(ke,we),ze(""),ce(!1))},disabled:!we||parseFloat(we)<=0,className:"w-full flex items-center justify-center gap-2 p-4 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed font-medium text-lg",children:[e.jsx($s,{className:"w-5 h-5"}),"Apply Discount"]})})]}):e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["Currently Applied: ",se==="percentage"?`${Z}% off`:"Fixed discount"]})}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["-TZS ",A.toLocaleString()]})}),e.jsxs("button",{onClick:()=>{M(),We(se||"fixed"),ze(se==="percentage"?Z.toString():A.toString())},className:"w-full flex items-center justify-center gap-2 p-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Ia,{className:"w-4 h-4"}),"Edit Discount"]})]})})]}):e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>{M(),ce(!0)},className:`w-full flex items-center justify-between p-3 rounded-xl border-2 transition-all duration-300 hover:shadow-md ${A>0?"bg-green-50 border-green-200 hover:bg-green-100":"bg-orange-50 border-orange-200 hover:bg-orange-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($s,{className:`w-5 h-5 ${A>0?"text-green-600":"text-orange-600"}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:A>0?"Discount Applied":"Add Discount"}),A>0&&e.jsxs("div",{className:"text-sm text-green-600 font-medium",children:["-TZS ",A.toLocaleString()," (",se==="percentage"?`${Z}%`:"fixed",")"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ws,{className:"w-5 h-5 text-gray-500"})})]}),A>0&&e.jsx("button",{type:"button",onClick:I=>{I.stopPropagation(),n(),_()},className:"absolute top-2 right-12 inline-flex items-center justify-center w-9 h-9 text-sm font-medium text-white bg-red-500 hover:bg-red-600 border border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200 shadow-lg",title:"Remove Discount",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),e.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),e.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]})})]})}),F&&e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600 mb-3",children:[e.jsxs("span",{className:"font-medium",children:["Tax (VAT ",T,"%):"]}),e.jsxs("span",{className:"font-bold text-gray-900",children:["TZS ",y.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center bg-green-50 border border-green-200 rounded-lg px-4 py-3",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total:"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["TZS ",q.toLocaleString()]})]})]}),!l&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-amber-50 border border-amber-200 rounded-lg mb-4 mt-4",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-amber-900",children:"Please select a customer to proceed"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[w&&e.jsxs("button",{onClick:()=>{M(),w()},disabled:t.length===0||!l,className:"bg-purple-500 hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold py-4 px-4 rounded-lg transition-colors duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-2 text-base",title:l?t.length===0?"Add items to cart first":"Create installment plan":"Please select a customer first",children:[e.jsx(js,{className:"w-5 h-5"}),e.jsx("span",{className:"truncate",children:"Installment"})]}),p&&e.jsxs("button",{onClick:()=>{M(),p()},disabled:t.length===0||!l,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold py-4 px-4 rounded-lg transition-colors duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-2 text-base",title:l?t.length===0?"Add items to cart first":"Add trade-in device":"Please select a customer first",children:[e.jsx(Wl,{className:"w-5 h-5"}),e.jsx("span",{className:"truncate",children:"Trade-In"})]})]}),S&&t.length>0&&e.jsxs("button",{onClick:()=>{M(),S()},disabled:!l,className:"w-full bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg mt-3 flex items-center justify-center gap-2",title:l?"Preview invoice with current prices":"Please select a customer first to preview invoice",children:[e.jsx($a,{className:"w-5 h-5"}),"Preview Invoice"]}),e.jsx("button",{onClick:()=>{re(),P()},disabled:t.length===0||!l,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold py-4 px-6 rounded-lg transition-colors duration-200 shadow-lg hover:shadow-xl mt-3 text-lg",title:l?t.length===0?"Add items to cart first":"Process payment":"Please select a customer first",children:"Process Payment"})]})]})})},Ao=async t=>{try{const{data:l,error:c}=await Te.from("lats_external_products").insert([t]).select().single();if(c)throw c;return l}catch(l){throw console.error("Error creating external product:",l),l}},dn=({isOpen:t,onClose:l,onProductAdded:c})=>{const[o,u]=s.useState({name:"",sku:"",price:0,quantity:1,category:"",barcode:"",notes:"",supplierName:"",supplierPhone:"",purchaseDate:"",purchasePrice:0,purchaseQuantity:1,warrantyInfo:"",returnPolicy:"",productCondition:"new"}),[r,d]=s.useState(!1),[g,N]=s.useState(!1),[O,P]=s.useState(!1),[w,p]=s.useState([]),[v,_]=s.useState(!1);s.useEffect(()=>{(async()=>{if(t){_(!0);try{const T=await Sl();p(T);const q=new Date().toISOString().split("T")[0],j=Date.now().toString().slice(-6),F=Math.random().toString(36).substring(2,5).toUpperCase(),Y=`EXT-${j}-${F}`;u(M=>({...M,purchaseDate:q,sku:Y}))}catch(T){console.error("Error fetching categories:",T)}finally{_(!1)}}})()},[t]);const S=(y,T)=>{u(q=>({...q,[y]:T}))},m=async y=>{var T,q,j,F,Y,M,re,n,$;if(y.preventDefault(),!o.name.trim()){alert("Please enter a product name");return}if(!o.sku.trim()){alert("Please enter a SKU or generate one");return}if(o.price<=0){alert("Please enter a valid price greater than 0");return}if(o.quantity<=0){alert("Please enter a valid quantity greater than 0");return}if(!o.supplierName.trim()){alert("Please enter a supplier name");return}if(o.purchasePrice<=0){alert("Please enter a valid purchase price greater than 0");return}if(o.purchaseQuantity<=0){alert("Please enter a valid purchase quantity greater than 0");return}d(!0);try{const V={name:o.name.trim(),sku:o.sku.trim(),category:o.category.trim()||null,barcode:((T=o.barcode)==null?void 0:T.trim())||null,supplier_name:o.supplierName.trim(),supplier_phone:((q=o.supplierPhone)==null?void 0:q.trim())||null,purchase_date:o.purchaseDate,purchase_price:o.purchasePrice,purchase_quantity:o.purchaseQuantity,selling_price:o.price,warranty_info:((j=o.warrantyInfo)==null?void 0:j.trim())||null,product_condition:o.productCondition,notes:((F=o.notes)==null?void 0:F.trim())||null},ie=await Ao(V);console.log("âœ… External product saved to database:",ie);const ce={name:o.name.trim(),sku:o.sku.trim(),price:o.price,quantity:o.quantity,category:o.category.trim(),barcode:((Y=o.barcode)==null?void 0:Y.trim())||"",notes:((M=o.notes)==null?void 0:M.trim())||"",supplierName:o.supplierName.trim(),supplierPhone:(re=o.supplierPhone)==null?void 0:re.trim(),purchaseDate:o.purchaseDate,purchasePrice:o.purchasePrice,purchaseQuantity:o.purchaseQuantity,warrantyInfo:(n=o.warrantyInfo)==null?void 0:n.trim(),returnPolicy:($=o.returnPolicy)==null?void 0:$.trim(),productCondition:o.productCondition};c(ce);const pe=Date.now().toString().slice(-6),ee=Math.random().toString(36).substring(2,5).toUpperCase(),X=`EXT-${pe}-${ee}`;u({name:"",sku:X,price:0,quantity:1,category:"",barcode:"",notes:"",supplierName:"",supplierPhone:"",purchaseDate:new Date().toISOString().split("T")[0],purchasePrice:0,purchaseQuantity:1,warrantyInfo:"",returnPolicy:"",productCondition:"new"}),N(!1),P(!1)}catch(V){console.error("Error adding external product:",V),alert("Failed to add external product. Please try again.")}finally{d(!1)}},A=[].filter(y=>y.name.toLowerCase().includes(o.supplierName.toLowerCase())||y.phone.includes(o.supplierName)),Z=y=>{u(T=>({...T,supplierName:y.name,supplierPhone:y.phone})),P(!1)},se=()=>{P(!1)};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/60",onClick:l,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500 rounded-lg",children:e.jsx(ut,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Add External Product"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Quick entry for products not in inventory"})]})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Je,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:m,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o.name,onChange:y=>S("name",y.target.value),className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",placeholder:"Enter product name",required:!0}),e.jsx(ut,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["SKU/QrCode/Serial ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o.sku,onChange:y=>S("sku",y.target.value),className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",placeholder:"Auto-generated SKU",required:!0}),e.jsx(Xr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx(bo,{value:o.category,onChange:y=>{const T=w.find(q=>q.id===y);S("category",(T==null?void 0:T.name)||"")},categories:w,placeholder:"Select category",disabled:v,className:"w-full"})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product Condition ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"new",label:"New",color:"bg-green-500 hover:bg-green-600 border-green-500"},{value:"used",label:"Used",color:"bg-blue-500 hover:bg-blue-600 border-blue-500"},{value:"refurbished",label:"Refurbished",color:"bg-purple-500 hover:bg-purple-600 border-purple-500"}].map(y=>e.jsx("button",{type:"button",onClick:()=>S("productCondition",y.value),className:`px-4 py-3 text-sm font-medium rounded-lg border-2 transition-all ${o.productCondition===y.value?`${y.color} text-white`:"bg-white text-gray-700 border-gray-300 hover:border-gray-400"}`,children:y.label},y.value))})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Supplier Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o.supplierName,onChange:y=>{S("supplierName",y.target.value),P(y.target.value.length>0)},onFocus:()=>P(o.supplierName.length>0),onBlur:()=>setTimeout(()=>P(!1),200),className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",placeholder:"Enter supplier name",required:!0}),e.jsx(en,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]}),O&&A.length>0&&e.jsxs("div",{className:"absolute z-50 w-full mt-2 bg-white border border-gray-300 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:[A.map(y=>e.jsxs("div",{onClick:()=>Z(y),className:"p-3 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.name}),e.jsx("div",{className:"text-sm text-gray-600",children:y.phone})]},y.id)),e.jsxs("button",{onClick:se,className:"w-full p-3 border-t border-gray-200 bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors flex items-center justify-center gap-2 font-medium",children:[e.jsx(en,{className:"w-4 h-4"}),"Create New Supplier"]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Purchase Price (TZS) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(nn,{value:o.purchasePrice,onChange:y=>S("purchasePrice",y),placeholder:"0",className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",required:!0}),e.jsx(ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Purchase Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"1",value:o.purchaseQuantity,onChange:y=>S("purchaseQuantity",parseInt(y.target.value)||1),className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",required:!0}),e.jsx(Xr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Selling Price (TZS) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(nn,{value:o.price,onChange:y=>S("price",y),placeholder:"0",className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",required:!0}),e.jsx(ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warranty (Months)"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[0,3,6,12].map(y=>e.jsx("button",{type:"button",onClick:()=>S("warrantyInfo",y===0?"No warranty":`${y} months`),className:`px-4 py-3 text-sm font-medium rounded-lg border-2 transition-all ${o.warrantyInfo===(y===0?"No warranty":`${y} months`)?"bg-orange-500 text-white border-orange-500":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"}`,children:y===0?"None":`${y}m`},y))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Additional Notes"}),e.jsx("button",{type:"button",onClick:()=>N(!g),className:"p-1.5 text-orange-600 hover:text-orange-800 hover:bg-orange-50 rounded transition-colors",children:e.jsx(Wt,{className:`w-4 h-4 transition-transform ${g?"rotate-45":""}`})})]}),g&&e.jsx("textarea",{value:o.notes,onChange:y=>S("notes",y.target.value),className:"w-full py-3 px-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors resize-none",placeholder:"Any additional notes about the product or supplier",rows:3})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-red-50 border-2 border-orange-200 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Order Summary"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["TZS ",o.price.toLocaleString()]}),e.jsxs("div",{className:"text-xs text-gray-600 font-medium mt-1",children:["Profit: TZS ",((o.price-o.purchasePrice)*o.quantity).toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsx("div",{className:"text-gray-600",children:e.jsx("span",{className:"font-medium text-gray-800",children:o.name||"Product name"})}),e.jsx("div",{className:"text-right text-gray-600",children:e.jsx("span",{className:"font-medium text-gray-800",children:o.supplierName||"Supplier"})}),e.jsx("div",{className:"text-gray-600",children:o.category||"No category"}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"px-2 py-1 bg-white rounded text-xs font-medium capitalize text-gray-700",children:o.productCondition})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 mt-6 pt-6",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white text-gray-700 border-2 border-gray-300 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r||!o.name||!o.sku||o.price<=0,className:"flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg font-medium hover:from-orange-600 hover:to-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg",children:r?"Adding Product...":"Add to Cart"})]})]})]})})})]}):null},Mo=({subtotal:t,deliverySettings:l,onDeliveryFeeChange:c})=>{const[o,u]=s.useState(l.deliveryMethod||"standard"),[r,d]=s.useState(l.deliveryDistance||0),[g,N]=s.useState(""),O=s.useCallback((p,v,_)=>{if(!(l!=null&&l.enable_delivery)||p>=l.free_delivery_threshold)return 0;let S=l.default_delivery_fee||2e3;switch(v){case"express":S*=1.5;break;case"same-day":S*=2;break;case"standard":default:S*=1;break}if(_>0){const k=Math.ceil(_/5)*500;S+=k}const m=new Date().getHours();return m>=17&&m<=19?S*=1.2:(m>=22||m<=6)&&(S*=1.3),p>=5e4?S*=.8:p>=25e3&&(S*=.9),Math.round(S)},[l]);if(qt.useEffect(()=>{const p=O(t,o,r);c(p)},[t,o,r,g,O,c]),!l.enable_delivery)return null;const P=O(t,o,r),w=t>=l.free_delivery_threshold;return e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Delivery Options"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Method"}),e.jsxs("select",{value:o,onChange:p=>u(p.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"standard",children:"Standard (2-3 days)"}),e.jsx("option",{value:"express",children:"Express (1-2 days)"}),e.jsx("option",{value:"same-day",children:"Same Day"})]})]}),l.enable_delivery_areas&&l.delivery_areas&&l.delivery_areas.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Area"}),e.jsxs("select",{value:g,onChange:p=>N(p.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select area"}),l.delivery_areas.map(p=>{var v;return e.jsxs("option",{value:p,children:[p," (",((v=l.area_delivery_fees)==null?void 0:v[p])||l.default_delivery_fee," TZS)"]},p)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Distance (km)"}),e.jsx("input",{type:"number",value:r,onChange:p=>d(Number(p.target.value)),min:"0",step:"0.5",className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter delivery distance"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Base Fee:"}),e.jsx("span",{className:"text-sm font-medium",children:g&&l.area_delivery_fees[g]?`${l.area_delivery_fees[g]} TZS (${g})`:`${l.default_delivery_fee} TZS (Default)`})]}),o!=="standard"&&e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[o==="express"?"Express Premium (+50%)":"Same Day Premium (+100%)",":"]}),e.jsxs("span",{className:"text-sm font-medium",children:["+",o==="express"?Math.round(l.default_delivery_fee*.5):l.default_delivery_fee," TZS"]})]}),r>0&&e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Distance Fee:"}),e.jsxs("span",{className:"text-sm font-medium",children:["+",Math.ceil(r/5)*500," TZS"]})]}),(()=>{const p=new Date().getHours();return p>=17&&p<=19?e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Rush Hour Fee (+20%):"}),e.jsxs("span",{className:"text-sm font-medium text-orange-600",children:["+",Math.round(P*.2)," TZS"]})]}):p>=22||p<=6?e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Late Night Fee (+30%):"}),e.jsxs("span",{className:"text-sm font-medium text-orange-600",children:["+",Math.round(P*.3)," TZS"]})]}):null})(),t>=25e3&&e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[t>=5e4?"Large Order Discount (-20%)":"Medium Order Discount (-10%)",":"]}),e.jsxs("span",{className:"text-sm font-medium text-green-600",children:["-",Math.round(P*(t>=5e4?.2:.1))," TZS"]})]}),e.jsx("div",{className:"border-t border-gray-200 mt-2 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-base font-semibold text-gray-800",children:"Total Delivery Fee:"}),e.jsx("span",{className:"text-base font-bold text-blue-600",children:w?"FREE":`${P} TZS`})]})})]}),w&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-green-600 font-medium",children:["ðŸŽ‰ Free delivery! Order value exceeds ",l.free_delivery_threshold," TZS"]})})})]})]})},Oo=({isOpen:t,onClose:l,onDeliverySet:c,selectedCustomer:o,deliverySettings:u,subtotal:r=0})=>{var v;const[d,g]=s.useState({customerName:(o==null?void 0:o.name)||"",customerPhone:(o==null?void 0:o.phone)||"",deliveryAddress:"",deliveryDate:"",deliveryTime:"",deliveryNotes:"",deliveryFee:0,deliveryMethod:"standard",deliveryArea:"",deliveryDistance:0});qt.useEffect(()=>{o&&g(_=>({..._,customerName:o.name,customerPhone:o.phone}))},[o]);const[N,O]=s.useState(!1),P=(_,S)=>{g(m=>({...m,[_]:S}))},w=async _=>{_.preventDefault(),O(!0);try{await new Promise(S=>setTimeout(S,1e3)),c(d)}catch(S){console.error("Error setting delivery:",S)}finally{O(!1)}},p=[{id:"standard",name:"Standard Delivery",time:"2-3 business days",fee:500},{id:"express",name:"Express Delivery",time:"1-2 business days",fee:1e3},{id:"same-day",name:"Same Day Delivery",time:"Same day",fee:2e3}];return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsx(ms,{className:"max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl",children:e.jsx(ka,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Delivery Setup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure delivery options for this order"})]})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Je,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),"Customer Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:d.customerName,onChange:_=>P("customerName",_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Enter customer name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",value:d.customerPhone,onChange:_=>P("customerPhone",_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Enter phone number",required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(Ra,{className:"w-4 h-4"}),"Delivery Address"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Address"}),e.jsx("textarea",{value:d.deliveryAddress,onChange:_=>P("deliveryAddress",_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Enter complete delivery address",rows:3,required:!0})]})]}),u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(ka,{className:"w-4 h-4"}),"Delivery Fee Calculator"]}),e.jsx(Mo,{subtotal:r,deliverySettings:u,onDeliveryFeeChange:_=>{P("deliveryFee",_)}})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(ka,{className:"w-4 h-4"}),"Delivery Method"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:p.map(_=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${d.deliveryMethod===_.id?"border-blue-500 bg-gradient-to-br from-blue-50 to-blue-100":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>{P("deliveryMethod",_.id),P("deliveryFee",_.fee)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:_.name}),d.deliveryMethod===_.id&&e.jsx(Yt,{className:"w-4 h-4 text-blue-600"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:_.time}),e.jsxs("p",{className:"text-sm font-medium text-blue-600",children:["TZS ",_.fee]})]},_.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(ds,{className:"w-4 h-4"}),"Delivery Schedule"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Date"}),e.jsx("input",{type:"date",value:d.deliveryDate,onChange:_=>P("deliveryDate",_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Time"}),e.jsxs("select",{value:d.deliveryTime,onChange:_=>P("deliveryTime",_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0,children:[e.jsx("option",{value:"",children:"Select time"}),e.jsx("option",{value:"morning",children:"Morning (9 AM - 12 PM)"}),e.jsx("option",{value:"afternoon",children:"Afternoon (12 PM - 3 PM)"}),e.jsx("option",{value:"evening",children:"Evening (3 PM - 6 PM)"}),e.jsx("option",{value:"anytime",children:"Anytime"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Notes"}),e.jsx("textarea",{value:d.deliveryNotes,onChange:_=>P("deliveryNotes",_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Any special instructions for delivery...",rows:2})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Delivery Summary"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery Method:"}),e.jsx("span",{className:"font-medium",children:(v=p.find(_=>_.id===d.deliveryMethod))==null?void 0:v.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery Fee:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["TZS ",d.deliveryFee]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery Date:"}),e.jsx("span",{className:"font-medium",children:d.deliveryDate||"Not set"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(mt,{type:"button",onClick:l,variant:"secondary",className:"flex-1",children:"Cancel"}),e.jsx(mt,{type:"submit",disabled:N,className:"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:N?"Setting Delivery...":"Set Delivery"})]})]})]})})}):null},mn=({isOpen:t,onClose:l,onCustomerSelect:c,selectedCustomer:o})=>{const[u,r]=s.useState(""),[d,g]=s.useState([]),[N,O]=s.useState(!1),[P,w]=s.useState(null),[p,v]=s.useState([]),[_,S]=s.useState(!1),[m,k]=s.useState(!1),{playClickSound:A}=Xt();s.useEffect(()=>{t&&(k(!1),y())},[t]);const Z=Hr(M=>M.customers),se=Hr(M=>M.isCacheValid("customers"));s.useEffect(()=>{const M=setTimeout(()=>{u.trim()?q(u):g(p.slice(0,24))},300);return()=>clearTimeout(M)},[u,p]);const y=async(M=!1)=>{var re,n;try{if(O(!0),M)console.log("ðŸ”„ [CustomerModal] Force refresh: Clearing cache..."),vs.clearCustomers();else{if(Z&&Z.length>0&&se){console.log(`âš¡ [CustomerModal] Using preloaded customers from dataStore (${Z.length} customers)`),v(Z),g(Z.slice(0,24)),O(!1),k(!0);return}const V=vs.getCustomers();if(V&&V.length>0){console.log(`âš¡ [CustomerModal] Using cached customers (${V.length} customers)`),v(V),g(V.slice(0,24)),O(!1),k(!0),vs.getCacheAge()>5*60*1e3&&Qr().then(ce=>{ce&&Array.isArray(ce)&&vs.saveCustomers(ce)}).catch(()=>{});return}}console.log("ðŸ“¡ [CustomerModal] Fetching from database...");const $=await Qr();if(console.log("ðŸ“Š fetchAllCustomersSimple result:",{type:typeof $,isArray:Array.isArray($),hasCustomers:$&&$.customers,length:Array.isArray($)?$.length:((re=$==null?void 0:$.customers)==null?void 0:re.length)||0}),$&&Array.isArray($)){v($),g($.slice(0,24)),console.log(`âœ… Loaded ${$.length} customers, showing first 24`),vs.saveCustomers($);const V=$.filter(ce=>ce.name&&ce.name.trim()),ie=$.filter(ce=>ce.phone&&ce.phone.trim());console.log(`ðŸ“Š Data quality: ${V.length}/${$.length} have names, ${ie.length}/${$.length} have phones`)}else if($&&$.customers&&Array.isArray($.customers)){v($.customers),vs.saveCustomers($.customers),g($.customers.slice(0,24)),console.log(`âœ… Loaded ${$.customers.length} customers, showing first 24`);const V=$.customers.filter(ce=>ce.name&&ce.name.trim()),ie=$.customers.filter(ce=>ce.phone&&ce.phone.trim());console.log(`ðŸ“Š Data quality: ${V.length}/${$.customers.length} have names, ${ie.length}/${$.customers.length} have phones`)}else console.warn("âš ï¸ Unexpected result format from fetchAllCustomersSimple:",$),v([]),g([])}catch($){console.error("âŒ Error loading all customers:",$),w("Failed to load customers. Please try again.");try{console.log("ðŸ”„ Trying fallback search...");const V=await Ma("",1,100);console.log("ðŸ“Š Fallback result:",{type:typeof V,hasCustomers:V&&V.customers,length:((n=V==null?void 0:V.customers)==null?void 0:n.length)||0}),V&&V.customers&&Array.isArray(V.customers)?(v(V.customers),g(V.customers.slice(0,24)),console.log(`âœ… Fallback loaded ${V.customers.length} customers, showing first 24`)):(console.warn("âš ï¸ Fallback also failed or returned unexpected format"),v([]),g([]))}catch(V){console.error("âŒ Error loading fallback customers:",V),v([]),g([])}}finally{O(!1),k(!0)}},T=async()=>{try{await y(!0),x.success("Customers refreshed successfully",{icon:"âœ…",duration:2e3})}catch(M){console.error("Error refreshing customers:",M),x.error("Failed to refresh customers",{duration:3e3})}},q=async M=>{try{O(!0),w(null);const re=await Ma(M,1,200);re&&re.customers?g(re.customers.slice(0,24)):re&&Array.isArray(re)?g(re.slice(0,24)):w("Failed to search customers")}catch(re){console.error("Error searching customers:",re),w("Failed to search customers")}finally{O(!1)}},j=M=>{A(),c(M),l(),x.success(`âœ“ Customer selected: ${M.name}`,{icon:"ðŸ‘¤",duration:2e3,style:{background:"#10b981",color:"#fff",fontWeight:"bold"}})},F=()=>{S(!0)},Y=M=>{v(re=>[M,...re.slice(0,4)]),A(),c(M),S(!1)};return Ua(t),s.useEffect(()=>{if(t){const M=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=M}}},[t]),t?ea.createPortal(e.jsxs("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[99999]",style:{top:0,left:0,right:0,bottom:0},role:"dialog","aria-modal":"true","aria-labelledby":"customer-modal-title",onClick:l,children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",onClick:M=>M.stopPropagation(),children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(xt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"customer-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Select Customer"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a customer for this sale"})]})]})}),e.jsxs("div",{className:"p-6 pb-0 flex-shrink-0",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(zt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search customers by name, phone, email, city...",value:u,onChange:M=>r(M.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200",autoFocus:!0}),u&&e.jsx("button",{onClick:()=>r(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 hover:bg-gray-200 rounded transition-colors",children:e.jsx(Je,{className:"w-4 h-4 text-gray-400"})})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[d.length," of ",p.length," customers"]}),e.jsx("button",{onClick:T,disabled:N,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",title:"Refresh customers",children:e.jsx(La,{className:`w-5 h-5 ${N?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:[N&&!m&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ba,{size:"sm",color:"blue"})}),P&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4 mb-4 mt-4",children:e.jsx("p",{className:"text-red-600 font-medium",children:P})}),d.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 py-4",children:d.map(M=>e.jsx($o,{customer:M,onSelect:j,isSelected:(o==null?void 0:o.id)===M.id,searchQuery:u},M.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(xt,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"No customers found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:u?"Try adjusting your search criteria":"No customers available"}),!u&&e.jsxs("button",{onClick:F,className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx(Wt,{className:"w-4 h-4"}),"Create Customer"]})]})]}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("button",{type:"button",onClick:F,className:"w-full px-6 py-3.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl text-lg flex items-center justify-center gap-2",children:[e.jsx(Wt,{className:"w-5 h-5"}),"Add New Customer"]})})]}),e.jsx(Aa,{isOpen:_,onClose:()=>S(!1),onCustomerCreated:Y,onAddAnother:()=>{S(!0)}})]}),document.body):null},$o=({customer:t,onSelect:l,isSelected:c,searchQuery:o})=>{var d,g;const u=N=>{const O=N||0,P=1e12,w=Math.abs(O)>P;if(w&&console.warn(`âš ï¸ Customer ${t.name} (${t.id}) has CORRUPT amount: ${O}`),!isFinite(O))return console.warn(`âš ï¸ Customer ${t.name} has invalid amount: ${N}.`),"TZS 0 âš ï¸ INVALID";const p=new Intl.NumberFormat("en-US",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(O);return w?`${p} âš ï¸`:p},r=((d=t.loyaltyLevel)==null?void 0:d.toLowerCase())==="vip"||((g=t.loyaltyLevel)==null?void 0:g.toLowerCase())==="premium";return e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 hover:shadow-lg hover:scale-[1.02] cursor-pointer relative ${c||r?"border-blue-400 shadow-lg":"border-gray-200 hover:border-blue-300"}`,onClick:N=>{N.stopPropagation(),l(t)},children:[t.email||t.city?e.jsx("button",{onClick:N=>{N.stopPropagation()},className:"absolute top-3 right-3 w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-blue-500 text-gray-600 hover:text-white rounded-lg transition-all duration-200 shadow-sm hover:shadow-md z-10",title:"View customer details",children:e.jsx(Gl,{className:"w-4 h-4"})}):null,e.jsxs("div",{className:"p-4 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg flex-shrink-0 ${r?"bg-gradient-to-br from-blue-500 via-blue-400 to-blue-600":"bg-gradient-to-br from-blue-500 to-blue-600"}`,children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 truncate",children:t.name}),r&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm flex-shrink-0",children:e.jsx(Yt,{className:"w-3 h-3"})})]}),t.phone&&e.jsx("p",{className:"text-xs text-gray-600 truncate mt-1",children:t.phone})]})]}),e.jsx("div",{className:"space-y-2 mb-4 flex-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Points"}),e.jsx("div",{className:"font-bold text-gray-900 text-sm",children:t.points||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Spent"}),e.jsx("div",{className:"font-bold text-gray-900 text-sm",children:u(t.totalSpent||0).replace("TZS","").trim()})]})]}),e.jsxs("button",{onClick:N=>{N.stopPropagation(),l(t)},className:"w-full py-2.5 px-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg font-semibold text-sm flex items-center justify-center gap-2 mt-auto",children:[e.jsx(Yt,{className:"w-4 h-4"}),"Select"]})]})]})},Lo=({value:t,onChange:l,placeholder:c="Search customers by name, phone, or email...",className:o="",disabled:u=!1})=>{const[r,d]=s.useState(""),[g,N]=s.useState([]),[O,P]=s.useState(!1),[w,p]=s.useState(!1),[v,_]=s.useState(-1),S=s.useRef(null),m=s.useRef(null);s.useEffect(()=>{const j=setTimeout(()=>{r.trim()?k(r):(N([]),P(!1))},300);return()=>clearTimeout(j)},[r]),s.useEffect(()=>{const j=F=>{S.current&&!S.current.contains(F.target)&&(P(!1),_(-1))};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const k=async j=>{try{p(!0);const F=await Ma(j,1,20);if(F&&F.customers){const Y=F.customers.map(M=>({customer:M,relevance:A(M,j),matchType:"partial"}));Y.sort((M,re)=>re.relevance-M.relevance),N(Y),P(!0)}else N([]),P(!1)}catch(F){console.error("Error searching customers:",F),x.error("Failed to search customers"),N([]),P(!1)}finally{p(!1)}},A=(j,F)=>{const Y=F.toLowerCase();let M=0;return j.name.toLowerCase().includes(Y)&&(M+=10,j.name.toLowerCase()===Y&&(M+=5)),j.phone&&j.phone.includes(Y)&&(M+=8),j.email&&j.email.toLowerCase().includes(Y)&&(M+=6),M},Z=j=>{const F=j.target.value;d(F),l(F),_(-1)},se=j=>{const F=j.name;l(F),d(F),P(!1),_(-1),x.success(`Selected: ${j.name}`)},y=j=>{if(O)switch(j.key){case"ArrowDown":j.preventDefault(),_(F=>F<g.length-1?F+1:F);break;case"ArrowUp":j.preventDefault(),_(F=>F>0?F-1:-1);break;case"Enter":j.preventDefault(),v>=0&&v<g.length&&se(g[v].customer);break;case"Escape":P(!1),_(-1);break}},T=()=>{var j;d(""),l(""),N([]),P(!1),_(-1),(j=m.current)==null||j.focus()},q=j=>j.replace(/(\d{3})(\d{3})(\d{4})/,"$1 $2 $3");return e.jsxs("div",{ref:S,className:`relative ${o}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:m,type:"text",value:r||t,onChange:Z,onKeyDown:y,onFocus:()=>{g.length>0&&P(!0)},placeholder:c,disabled:u,className:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:r||t?e.jsx("button",{type:"button",onClick:T,className:"p-0.5 hover:bg-gray-100 rounded transition-colors",title:"Clear",children:e.jsx(Je,{className:"w-3 h-3 text-gray-400"})}):e.jsx(zt,{className:"w-3 h-3 text-gray-400"})})]}),O&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto",children:w?e.jsxs("div",{className:"px-3 py-2 text-sm text-gray-500 flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Searching..."]}):g.length>0?g.map((j,F)=>e.jsxs("div",{className:`px-3 py-2 cursor-pointer flex items-center gap-3 hover:bg-gray-50 transition-colors ${F===v?"bg-blue-50":""}`,onClick:()=>se(j.customer),children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm flex-shrink-0",children:j.customer.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:j.customer.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[j.customer.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Jt,{className:"w-3 h-3"}),e.jsx("span",{children:q(j.customer.phone)})]}),j.customer.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(za,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:j.customer.email})]})]})]}),F===v&&e.jsx(Sn,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]},j.customer.id)):r?e.jsxs("div",{className:"px-3 py-2 text-sm text-gray-500",children:['No customers found for "',r,'"']}):null})]})},un=({isOpen:t,onClose:l,customer:c,onCustomerUpdated:o})=>{const{confirm:u}=Va(),[r,d]=s.useState({name:"",phone:"",whatsapp:"",gender:"other",city:"",loyaltyLevel:"interested",colorTag:"new",referredBy:"",birthMonth:"",birthDay:"",notes:"",isActive:!0,whatsappOptOut:!1}),[g,N]=s.useState(!1),[O,P]=s.useState(!1),[w,p]=s.useState(!1),[v,_]=s.useState(!1),[S,m]=s.useState(!1);Ua(t),s.useEffect(()=>{if(c){const n={name:c.name||"",phone:c.phone||"",whatsapp:c.whatsapp||"",gender:c.gender||"other",city:c.city||"",loyaltyLevel:c.loyaltyLevel||"bronze",colorTag:c.colorTag||"new",referredBy:c.referredBy||"",birthMonth:c.birthMonth||"",birthDay:c.birthDay||"",notes:c.notes?Array.isArray(c.notes)?c.notes.join(`
`):c.notes:"",isActive:c.isActive!==!1,whatsappOptOut:c.whatsappOptOut||!1};d(n),P(!1)}},[c]),s.useEffect(()=>{if(c){const n=r.name!==(c.name||"")||r.phone!==(c.phone||"")||r.whatsapp!==(c.whatsapp||"")||r.gender!==(c.gender||"other")||r.city!==(c.city||"")||r.loyaltyLevel!==(c.loyaltyLevel||"bronze")||r.colorTag!==(c.colorTag||"new")||r.referredBy!==(c.referredBy||"")||r.birthMonth!==(c.birthMonth||"")||r.birthDay!==(c.birthDay||"")||r.notes!==(c.notes?Array.isArray(c.notes)?c.notes.join(`
`):c.notes:"")||r.isActive!==(c.isActive!==!1)||r.whatsappOptOut!==(c.whatsappOptOut||!1);P(n)}},[r,c]),s.useEffect(()=>{const n=$=>{const V=$.target;w&&!V.closest("[data-region-dropdown]")&&p(!1),v&&!V.closest("[data-month-dropdown]")&&_(!1),S&&!V.closest("[data-day-dropdown]")&&m(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[w,v,S]);const k=(n,$)=>{d(V=>({...V,[n]:$}))},A=async n=>{if(n.preventDefault(),!c||!O){l();return}N(!0);try{const $={name:r.name.trim(),phone:r.phone.trim(),whatsapp:r.whatsapp.trim(),gender:r.gender,city:r.city.trim(),loyaltyLevel:r.loyaltyLevel,colorTag:r.colorTag,referredBy:r.referredBy.trim(),birthMonth:r.birthMonth.trim(),birthDay:r.birthDay.trim(),isActive:r.isActive,whatsappOptOut:r.whatsappOptOut};r.notes.trim()&&($.notes=r.notes.trim().split(`
`).filter(ie=>ie.trim())),await kl(c.id,$);const V={...c,...$};o(V),x.success("Customer information updated successfully!"),l()}catch($){console.error("Error updating customer:",$),x.error("Failed to update customer information")}finally{N(!1)}},Z=async()=>{O&&!await u("You have unsaved changes. Are you sure you want to close?")||l()},se=n=>!n||n.trim()==="",T=(()=>{if(!c)return[];const n=[];return se(c.whatsapp)&&n.push("WhatsApp"),se(c.city)&&n.push("City"),se(c.birthMonth)&&n.push("Birth Month"),se(c.birthDay)&&n.push("Birth Day"),n})(),q=["Dar es Salaam","Arusha","Mwanza","Dodoma","Mbeya","Tanga","Morogoro","Iringa","Tabora","Kigoma","Mara","Kagera","Shinyanga","Singida","Rukwa","Ruvuma","Lindi","Mtwara","Pwani","Manyara","Geita","Simiyu","Katavi","Njombe","Songwe"],j=["January","February","March","April","May","June","July","August","September","October","November","December"],F=s.useMemo(()=>q.filter(n=>n.toLowerCase().includes(r.city.toLowerCase())),[r.city]),Y=Array.from({length:31},(n,$)=>($+1).toString()),M=s.useMemo(()=>j.filter(n=>n.toLowerCase().includes(r.birthMonth.toLowerCase())||r.birthMonth===""),[r.birthMonth]),re=s.useMemo(()=>Y.filter(n=>n.includes(r.birthDay)||r.birthDay===""),[r.birthDay]);return!t||!c?null:e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[1000000]",style:{top:0,left:0,right:0,bottom:0,zIndex:1e6},role:"dialog","aria-modal":"true","aria-labelledby":"edit-customer-modal-title",onClick:n=>{n.target===n.currentTarget&&Z()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:Z,className:"absolute top-4 right-4 w-10 h-10 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50","aria-label":"Close modal",children:e.jsx(Je,{className:"w-6 h-6"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(xt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"edit-customer-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Edit Customer"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:c.name||"Customer Information"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsx("div",{className:"py-4",children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[T.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-300 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Zt,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"font-semibold text-orange-800",children:"Missing Information"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map((n,$)=>e.jsx("span",{className:"px-3 py-1.5 bg-white text-orange-700 text-sm font-medium rounded-lg border border-orange-300 shadow-sm",children:n},$))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 mb-4 border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5 text-blue-600"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:r.name,onChange:n=>k("name",n.target.value),className:"w-full px-4 py-3 pl-11 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",placeholder:"Enter full name",required:!0}),e.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",value:r.phone,onChange:n=>k("phone",n.target.value),className:"w-full px-4 py-3 pl-11 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",placeholder:"+255 123 456 789",required:!0}),e.jsx(Jt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center gap-2",children:["WhatsApp Number",se(c==null?void 0:c.whatsapp)&&e.jsx(Zt,{className:"w-4 h-4 text-orange-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",value:r.whatsapp,onChange:n=>k("whatsapp",n.target.value),className:"w-full px-4 py-3 pl-11 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",placeholder:"+255 123 456 789"}),e.jsx(Hl,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Gender ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex gap-3",children:[{value:"male",label:"Male",icon:"ðŸ‘¨",color:"bg-blue-600 text-white border-blue-600 shadow-lg",hoverColor:"hover:bg-gray-50 hover:border-gray-400 hover:shadow-md"},{value:"female",label:"Female",icon:"ðŸ‘©",color:"bg-pink-600 text-white border-pink-600 shadow-lg",hoverColor:"hover:bg-gray-50 hover:border-gray-400 hover:shadow-md"}].map(n=>{const $=r.gender===n.value;return e.jsxs("button",{type:"button",onClick:()=>k("gender",n.value),className:`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-lg border-2 text-sm font-medium transition-all duration-200 cursor-pointer
                            ${$?n.color:`bg-white text-gray-700 border-gray-300 ${n.hoverColor}`}
                            focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-opacity-50 h-[52px]`,children:[e.jsx("span",{className:"text-xl",children:n.icon}),e.jsx("span",{children:n.label}),$&&e.jsx(Sn,{className:"w-4 h-4 ml-1"})]},n.value)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Region",se(c==null?void 0:c.city)&&e.jsx(Zt,{className:"w-4 h-4 text-orange-500"})]}),e.jsxs("div",{className:"relative","data-region-dropdown":!0,children:[e.jsx("input",{type:"text",value:r.city,onChange:n=>k("city",n.target.value),onFocus:()=>p(!0),onBlur:()=>setTimeout(()=>p(!1),200),className:"w-full min-h-[48px] py-3 pl-11 pr-10 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",placeholder:"Type or select region",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ra,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),e.jsx(ws,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),w&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto",children:[F.map(n=>e.jsx("div",{className:"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors",onClick:()=>{k("city",n),p(!1)},children:n},n)),F.length===0&&e.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:"No matching regions found"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 mb-4 border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Xs,{className:"w-5 h-5 text-purple-600"}),"Customer Status"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-3",children:"Loyalty Level"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:[{value:"interested",label:"Interested",color:"bg-white text-gray-700 border-gray-300 hover:border-gray-400",activeColor:"bg-gray-500 text-white border-gray-500"},{value:"engaged",label:"Engaged",color:"bg-white text-indigo-700 border-indigo-300 hover:border-indigo-400",activeColor:"bg-indigo-500 text-white border-indigo-500"},{value:"payment_customer",label:"Payment Customer",color:"bg-white text-teal-700 border-teal-300 hover:border-teal-400",activeColor:"bg-teal-500 text-white border-teal-500"},{value:"active",label:"Active",color:"bg-white text-green-700 border-green-300 hover:border-green-400",activeColor:"bg-green-500 text-white border-green-500"},{value:"regular",label:"Regular",color:"bg-white text-blue-700 border-blue-300 hover:border-blue-400",activeColor:"bg-blue-500 text-white border-blue-500"},{value:"premium",label:"Premium",color:"bg-white text-yellow-700 border-yellow-300 hover:border-yellow-400",activeColor:"bg-yellow-500 text-white border-yellow-500"},{value:"vip",label:"VIP",color:"bg-white text-purple-700 border-purple-300 hover:border-purple-400",activeColor:"bg-purple-500 text-white border-purple-500"}].map(n=>e.jsx("button",{type:"button",onClick:()=>k("loyaltyLevel",n.value),className:`px-4 py-2.5 text-sm font-medium rounded-lg border-2 transition-all ${r.loyaltyLevel===n.value?n.activeColor:n.color}`,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-3",children:"Customer Tag"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:[{value:"new",label:"New",color:"bg-white text-green-700 border-green-300 hover:border-green-400",activeColor:"bg-green-500 text-white border-green-500"},{value:"regular",label:"Regular",color:"bg-white text-blue-700 border-blue-300 hover:border-blue-400",activeColor:"bg-blue-500 text-white border-blue-500"},{value:"premium",label:"Premium",color:"bg-white text-yellow-700 border-yellow-300 hover:border-yellow-400",activeColor:"bg-yellow-500 text-white border-yellow-500"},{value:"vip",label:"VIP",color:"bg-white text-purple-700 border-purple-300 hover:border-purple-400",activeColor:"bg-purple-500 text-white border-purple-500"}].map(n=>e.jsx("button",{type:"button",onClick:()=>k("colorTag",n.value),className:`px-4 py-2.5 text-sm font-medium rounded-lg border-2 transition-all ${r.colorTag===n.value?n.activeColor:n.color}`,children:n.label},n.value))})]})]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kn,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Referred By Customer"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Link referrer to earn points"})]})]}),e.jsx("span",{className:"px-2 py-1 bg-purple-600 text-white text-xs font-medium rounded-full",children:"Bonus Points"})]}),e.jsx(Lo,{value:r.referredBy,onChange:n=>k("referredBy",n),placeholder:"Search for the referring customer...",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors text-gray-900"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 mb-4 border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5 text-pink-600"}),"Birth Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Birth Month",se(c==null?void 0:c.birthMonth)&&e.jsx(Zt,{className:"w-4 h-4 text-orange-500"})]}),e.jsxs("div",{className:"relative","data-month-dropdown":!0,children:[e.jsx("input",{type:"text",value:r.birthMonth,onChange:n=>k("birthMonth",n.target.value),onFocus:()=>_(!0),onBlur:()=>setTimeout(()=>_(!1),200),className:"w-full py-3 pl-11 pr-10 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",placeholder:"Type or select month",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-xl pointer-events-none",children:"ðŸŽ‚"}),e.jsx(ws,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),v&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto p-2",children:[M.map(n=>e.jsx("div",{className:"px-4 py-3 hover:bg-blue-50 cursor-pointer rounded transition-colors",onClick:()=>{k("birthMonth",n),_(!1)},children:n},n)),M.length===0&&e.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:"No matching months found"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Birth Day",se(c==null?void 0:c.birthDay)&&e.jsx(Zt,{className:"w-4 h-4 text-orange-500"})]}),e.jsxs("div",{className:"relative","data-day-dropdown":!0,children:[e.jsx("input",{type:"text",value:r.birthDay,onChange:n=>k("birthDay",n.target.value),onFocus:()=>m(!0),onBlur:()=>setTimeout(()=>m(!1),200),className:"w-full py-3 pl-11 pr-10 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",placeholder:"Type or select day",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-xl pointer-events-none",children:"ðŸŽ‰"}),e.jsx(ws,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),S&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto p-2",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1",children:re.map(n=>e.jsx("div",{className:"px-2 py-2 hover:bg-blue-50 cursor-pointer rounded text-sm text-center transition-colors",onClick:()=>{k("birthDay",n),m(!1)},children:n},n))}),re.length===0&&e.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:"No matching days found"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{value:r.notes,onChange:n=>k("notes",n.target.value),rows:4,placeholder:"Add notes about this customer...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium resize-none transition-colors"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Optional: Add any important information or preferences about this customer"})]})]})})}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsx("form",{onSubmit:A,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm",children:O&&e.jsxs("span",{className:"flex items-center gap-2 text-orange-600 font-medium",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),"Unsaved changes"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:Z,disabled:g,className:"flex-1 px-6 py-3.5 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all shadow-sm",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:!O||g,className:"flex-1 px-6 py-3.5 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg flex items-center justify-center gap-2",children:[e.jsx(Ql,{className:"w-5 h-5"}),g?"Saving...":"Save Changes"]})]})]})})})]})})})};class Fo{async getSalesAnalytics(l="7d"){try{console.log("ðŸ“Š Fetching sales analytics for period:",l);const c=new Date,o=new Date;switch(l){case"1d":o.setDate(c.getDate()-1);break;case"7d":o.setDate(c.getDate()-7);break;case"30d":o.setDate(c.getDate()-30);break;case"90d":o.setDate(c.getDate()-90);break;default:o.setDate(c.getDate()-7)}let u=[],r=null;try{console.log("ðŸ”§ Using simplified sales analytics query to avoid 400 errors...");const{data:w,error:p}=await Te.from("lats_sales").select(`
            id,
            sale_number,
            customer_id,
            customer_name,
            customer_phone,
            total_amount,
            payment_method,
            status,
            created_by,
            created_at
          `).gte("created_at",o.toISOString()).lte("created_at",c.toISOString()).order("created_at",{ascending:!1});p?(console.error("Simple sales analytics query failed:",p),u=[],r=p):(u=w||[],r=null,console.log(`âœ… Loaded ${u.length} sales for analytics (simplified query)`))}catch(w){console.error("Unexpected error fetching sales for analytics:",w),u=[],r=w}if(r)return console.warn("All sales analytics queries failed:",r.message),null;if(!u||u.length===0)return console.log("No sales data found for the selected period"),this.getEmptyData();console.log(`âœ… Found ${u.length} sales records`);const d=this.processDailySales(u,o,c),g=this.processTopProducts(u),N=this.processPaymentMethods(u),O=this.processCustomerSegments(u),P=this.calculateMetrics(u,d);return{dailySales:d,topProducts:g,paymentMethods:N,customerSegments:O,metrics:P}}catch(c){return console.error("Error in getSalesAnalytics:",c),null}}processDailySales(l,c,o){const u=new Map,r=new Date(c);for(;r<=o;){const d=r.toISOString().split("T")[0];u.set(d,{sales:0,transactions:0}),r.setDate(r.getDate()+1)}return l.forEach(d=>{const g=new Date(d.created_at).toISOString().split("T")[0],N=u.get(g)||{sales:0,transactions:0};N.sales+=d.total_amount||0,N.transactions+=1,u.set(g,N)}),Array.from(u.entries()).map(([d,g])=>({date:d,sales:g.sales,transactions:g.transactions}))}processTopProducts(l){const c=new Map;l.forEach(r=>{var d;(d=r.lats_sale_items)==null||d.forEach(g=>{let N="Unknown Product";g.product_name?N=g.product_name:g.sku?N=`Product (${g.sku})`:g.product_id?N=`Product ${g.product_id.slice(0,8)}`:g.variant_id&&(N=`Variant ${g.variant_id.slice(0,8)}`);const O=c.get(N)||{sales:0,quantity:0};O.sales+=g.total_price||0,O.quantity+=g.quantity||0,c.set(N,O)})});const o=Array.from(c.values()).reduce((r,d)=>r+d.sales,0),u=Array.from(c.entries()).map(([r,d])=>({name:r,sales:d.sales,quantity:d.quantity,percentage:o>0?Math.round(d.sales/o*100):0})).sort((r,d)=>d.sales-r.sales).slice(0,5);return u.length===0?[]:u}processPaymentMethods(l){const c=new Map;l.forEach(r=>{const d=r.payment_method||"Unknown",g=c.get(d)||0;c.set(d,g+(r.total_amount||0))});const o=Array.from(c.values()).reduce((r,d)=>r+d,0),u=Array.from(c.entries()).map(([r,d])=>({method:r,amount:d,percentage:o>0?Math.round(d/o*100):0})).sort((r,d)=>d.amount-r.amount);return u.length===0?[]:u}processCustomerSegments(l){const c=new Map;l.forEach(d=>{const g=d.customer_id||"walk-in",N=c.get(g)||{sales:0,transactions:0};N.sales+=d.total_amount||0,N.transactions+=1,c.set(g,N)});const o=Array.from(c.values()).reduce((d,g)=>d+g.sales,0),u={"VIP Customers":{sales:0,customers:0},"Regular Customers":{sales:0,customers:0},"Walk-in Customers":{sales:0,customers:0}};c.forEach((d,g)=>{g==="walk-in"?(u["Walk-in Customers"].sales+=d.sales,u["Walk-in Customers"].customers+=1):d.sales>1e5?(u["VIP Customers"].sales+=d.sales,u["VIP Customers"].customers+=1):(u["Regular Customers"].sales+=d.sales,u["Regular Customers"].customers+=1)});const r=Object.entries(u).map(([d,g])=>({segment:d,sales:g.sales,customers:g.customers,percentage:o>0?Math.round(g.sales/o*100):0})).filter(d=>d.sales>0);return r.length===0?[]:r}calculateMetrics(l,c){const o=l.reduce((g,N)=>{const O=typeof N.total_amount=="number"?N.total_amount:parseFloat(N.total_amount)||0;return g+O},0),u=l.length,r=u>0?o/u:0;let d=0;if(c.length>=2){const g=c[0].sales,N=c[c.length-1].sales;g>0&&(d=(N-g)/g*100)}return{totalSales:o,totalTransactions:u,averageTransaction:r,growthRate:d}}getEmptyData(){return{dailySales:[],topProducts:[],paymentMethods:[],customerSegments:[],metrics:{totalSales:0,totalTransactions:0,averageTransaction:0,growthRate:0}}}async getSalesStats(){try{const{data:l,error:c}=await Te.from("lats_sales").select("total_amount, created_at").eq("status","completed");if(c)return console.error("Error fetching sales stats:",c),null;if(!l||l.length===0)return{total_sales:0,total_revenue:0,today_sales:0,today_revenue:0,this_month_sales:0,this_month_revenue:0,average_sale:0};const o=new Date,u=new Date(o.getFullYear(),o.getMonth(),o.getDate()),r=new Date(o.getFullYear(),o.getMonth(),1);let d=0,g=0,N=0;return l.forEach(O=>{const P=O.total_amount||0,w=new Date(O.created_at);d+=P,w>=u&&(g+=P),w>=r&&(N+=P)}),{total_sales:l.length,total_revenue:d,today_sales:l.filter(O=>new Date(O.created_at)>=u).length,today_revenue:g,this_month_sales:l.filter(O=>new Date(O.created_at)>=r).length,this_month_revenue:N,average_sale:l.length>0?d/l.length:0}}catch(l){return console.error("Error in getSalesStats:",l),null}}}const Ro=new Fo,xn=({isOpen:t,onClose:l})=>{const[c,o]=s.useState("1d"),[u,r]=s.useState(null),[d,g]=s.useState(!1),[N,O]=s.useState(null);s.useEffect(()=>{t&&P()},[t,c]);const P=async()=>{try{g(!0),O(null),console.log("ðŸ“Š Loading sales analytics for period:",c);const v=await Ro.getSalesAnalytics(c);v?(r(v),console.log("âœ… Sales analytics data loaded:",v)):O("No sales data available for the selected period")}catch(v){console.error("âŒ Error loading sales analytics:",v),O("Failed to load sales analytics data. Please try again.")}finally{g(!1)}},w=v=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS"}).format(v),p=()=>{if(!u)return;const v=`Period,Total Sales,Total Transactions,Average Transaction
${c},${u.metrics.totalSales},${u.metrics.totalTransactions},${u.metrics.averageTransaction}`,_=new Blob([v],{type:"text/csv"}),S=window.URL.createObjectURL(_),m=document.createElement("a");m.href=S,m.download=`sales-analytics-${c}.csv`,m.click(),window.URL.revokeObjectURL(S)};return Ua(t),t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs(ms,{className:"max-w-6xl w-full max-h-[90vh] overflow-y-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-xl",children:e.jsx(Js,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Sales Analytics"}),e.jsx("p",{className:"text-base text-gray-600",children:"Comprehensive sales performance insights"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:P,disabled:d,className:"p-2 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",title:"Refresh data",children:e.jsx(La,{className:`w-5 h-5 ${d?"animate-spin":""}`})}),e.jsx("button",{onClick:l,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Je,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Period:"}),e.jsx("div",{className:"flex gap-2",children:["1d","7d","30d","90d"].map(v=>e.jsx("button",{onClick:()=>o(v),disabled:d,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===v?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50"}`,children:v==="1d"?"Today":v==="7d"?"7 Days":v==="30d"?"30 Days":"90 Days"},v))})]})}),d&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ba,{size:"sm",color:"green"})}),N&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-2xl mb-4",children:"âš ï¸"}),e.jsx("div",{className:"text-gray-600 mb-4",children:N}),e.jsx("button",{onClick:P,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Retry"})]})}),!d&&!N&&u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ft,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Total Sales"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:w(u.metrics.totalSales)}),e.jsxs("div",{className:"text-sm text-blue-600",children:[u.metrics.totalTransactions," transactions"]})]}),e.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ns,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"Transactions"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:u.metrics.totalTransactions}),e.jsx("div",{className:"text-sm text-green-600",children:"Total orders"})]}),e.jsxs("div",{className:"p-6 bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Js,{className:"w-6 h-6 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Average Order"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:w(u.metrics.averageTransaction)}),e.jsx("div",{className:"text-sm text-purple-600",children:"Per transaction"})]}),e.jsxs("div",{className:"p-6 bg-gradient-to-br from-orange-50 to-amber-100 rounded-xl border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ns,{className:"w-6 h-6 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-700",children:"Growth Rate"})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[u.metrics.growthRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-orange-600",children:"Period growth"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-br from-orange-50 to-amber-100 rounded-xl border border-orange-200",children:[e.jsxs("h3",{className:"font-semibold text-orange-900 mb-4 flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5"}),"Top Products"]}),e.jsx("div",{className:"space-y-3",children:u.topProducts.length>0?u.topProducts.map((v,_)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:v.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[v.quantity," units sold"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-green-600",children:w(v.sales)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[v.percentage,"% of total"]})]})]},_)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ut,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No product sales data available"})]})})]}),e.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx(ft,{className:"w-5 h-5"}),"Payment Methods"]}),e.jsx("div",{className:"space-y-3",children:u.paymentMethods.length>0?u.paymentMethods.map((v,_)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-medium text-gray-900 capitalize",children:v.method})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-blue-600",children:w(v.amount)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[v.percentage,"% of total"]})]})]},_)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ft,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No payment method data available"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl border border-green-200",children:[e.jsxs("h3",{className:"font-semibold text-green-900 mb-4 flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5"}),"Sales by Day"]}),e.jsx("div",{className:"space-y-2",children:u.dailySales.length>0?u.dailySales.map((v,_)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900",children:v.date}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-green-600",children:w(v.sales)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[v.transactions," transactions"]})]})]},_)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ns,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No daily sales data available"})]})})]}),e.jsxs("div",{className:"p-6 bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl border border-purple-200",children:[e.jsxs("h3",{className:"font-semibold text-purple-900 mb-4 flex items-center gap-2",children:[e.jsx(tn,{className:"w-5 h-5"}),"Customer Segments"]}),e.jsx("div",{className:"space-y-3",children:u.customerSegments.length>0?u.customerSegments.map((v,_)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:v.segment}),e.jsxs("div",{className:"text-sm text-gray-600",children:[v.customers," customers"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-purple-600",children:w(v.sales)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[v.percentage,"% of total"]})]})]},_)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(tn,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No customer segment data available"})]})})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(mt,{onClick:l,variant:"secondary",className:"flex-1 py-4 text-lg font-semibold",children:"Close"}),e.jsxs(mt,{onClick:p,className:"flex-1 py-4 text-lg font-semibold bg-gradient-to-r from-purple-500 to-indigo-600 text-white flex items-center justify-center gap-2",children:[e.jsx(sa,{className:"w-5 h-5"}),"Export Analytics"]})]})]}),!d&&!N&&!u&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Js,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Analytics Data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No sales data available for the selected period"}),e.jsx("button",{onClick:P,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh Data"})]})})]})}):null},vt={API_BASE_URL:"http://localhost:8000",ENDPOINTS:{CREATE_ORDER:"/zenopay-create-order.php",CHECK_STATUS:"/zenopay-check-status.php",WEBHOOK:"/zenopay-webhook.php",USSD_POPUP:"/zenopay-ussd-popup.php",TRIGGER_USSD:"/zenopay-trigger-ussd.php"},getUrl:t=>`${vt.API_BASE_URL}${t}`,getCreateOrderUrl:()=>vt.getUrl(vt.ENDPOINTS.CREATE_ORDER),getCheckStatusUrl:t=>`${vt.getUrl(vt.ENDPOINTS.CHECK_STATUS)}?order_id=${t}`,getWebhookUrl:()=>vt.getUrl(vt.ENDPOINTS.WEBHOOK),getUssdPopupUrl:()=>vt.getUrl(vt.ENDPOINTS.USSD_POPUP),getUssdTriggerUrl:(t,l,c)=>`${vt.getUrl(vt.ENDPOINTS.TRIGGER_USSD)}?phone=${encodeURIComponent(t)}&amount=${l}&order_id=${c}`},pt={POPUP_TIMEOUT:3e5,RETRY_ATTEMPTS:3,RETRY_DELAY:1e4,MESSAGES:{INITIATING:"Initiating USSD popup on customer phone...",SENT:"USSD popup sent successfully to customer phone",PENDING:"Waiting for customer to complete USSD payment...",TIMEOUT:"USSD popup timeout. Please try again.",ERROR:"Failed to send USSD popup. Please try again.",SUCCESS:"USSD payment completed successfully!",FAILED:"USSD payment failed. Please try again.",CANCELLED:"USSD payment was cancelled by customer."},DEBUG:{ENABLED:!0,LOG_PREFIX:"[ZenoPay USSD]",LOG_LEVELS:{INFO:"info",WARN:"warn",ERROR:"error",DEBUG:"debug"}}};class gn{static debugLog(l,c,o){const u=new Date().toISOString(),r=`${pt.DEBUG.LOG_PREFIX} [${u}] [${l.toUpperCase()}] ${c}`;switch(l){case pt.DEBUG.LOG_LEVELS.ERROR:console.error(r,o);break;case pt.DEBUG.LOG_LEVELS.WARN:console.warn(r,o);break;case pt.DEBUG.LOG_LEVELS.DEBUG:console.debug(r,o);break;default:console.log(r,o)}}static async triggerUssdPopup(l,c,o,u){try{this.debugLog("info",`Triggering USSD popup for order ${o}`,{phoneNumber:l,amount:c,orderId:o,customerName:u});const r=vt.getUssdTriggerUrl(l,c,o);this.debugLog("debug",`Making USSD trigger request to: ${r}`);const d=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:l,amount:c,order_id:o,customer_name:u,timestamp:new Date().toISOString(),pos_session:`pos_${Date.now()}`})}),g=await d.json();return this.debugLog("debug","USSD trigger response received",g),d.ok&&g.success?(this.debugLog("info","USSD popup triggered successfully",g),{success:!0,message:pt.MESSAGES.SENT,data:g}):(this.debugLog("error","USSD popup trigger failed",g),{success:!1,message:g.message||pt.MESSAGES.ERROR,data:g})}catch(r){return this.debugLog("error","USSD popup trigger error",r),{success:!1,message:`USSD popup error: ${r instanceof Error?r.message:"Unknown error"}`,data:r}}}static async checkUssdStatus(l){try{this.debugLog("debug",`Checking USSD status for order ${l}`);const c=await fetch(vt.getUssdPopupUrl(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:l,check_type:"ussd_status"})}),o=await c.json();return this.debugLog("debug","USSD status check response",o),c.ok&&o.success?{success:!0,status:o.status||"pending",data:o}:{success:!1,status:"error",data:o}}catch(c){return this.debugLog("error","USSD status check error",c),{success:!1,status:"error",data:c}}}static async pollUssdStatus(l,c){const o=Date.now();let u=0;for(this.debugLog("info",`Starting USSD status polling for order ${l}`);Date.now()-o<pt.POPUP_TIMEOUT;){u++,this.debugLog("debug",`USSD status check attempt ${u} for order ${l}`);const r=await this.checkUssdStatus(l);if(r.success){if(c==null||c(r.status,r.data),r.status==="completed")return this.debugLog("info",`USSD payment completed for order ${l}`),{success:!0,finalStatus:"completed",data:r.data};if(r.status==="failed")return this.debugLog("warn",`USSD payment failed for order ${l}`),{success:!1,finalStatus:"failed",data:r.data};if(r.status==="cancelled")return this.debugLog("warn",`USSD payment cancelled for order ${l}`),{success:!1,finalStatus:"cancelled",data:r.data}}await new Promise(d=>setTimeout(d,5e3))}return this.debugLog("warn",`USSD polling timeout for order ${l} after ${u} attempts`),{success:!1,finalStatus:"timeout",data:{attempts:u,timeout:pt.POPUP_TIMEOUT}}}}const zo=(t,l)=>{if(!t||!t.trim())return{isValid:!1,error:"Reference number is required for mobile money payments"};const c=t.trim();if(!/^[0-9A-Za-z]{6,12}$/.test(c))return{isValid:!1,error:"Please enter a valid reference number (6-12 alphanumeric characters)"};if(l){const u=l.toLowerCase();if((u.includes("mpesa")||u.includes("m-pesa"))&&!/^[0-9]{7,10}$/.test(c))return{isValid:!1,error:"M-Pesa reference number should be 7-10 digits"};if(u.includes("airtel")&&!/^[0-9A-Za-z]{6,12}$/.test(c))return{isValid:!1,error:"Airtel Money reference number should be 6-12 alphanumeric characters"};if(u.includes("zenopay")&&!/^[0-9A-Za-z]{8,12}$/.test(c))return{isValid:!1,error:"ZenoPay reference number should be 8-12 alphanumeric characters"}}return{isValid:!0}},qo=t=>{if(!t)return"Enter reference number";const l=t.toLowerCase();return l.includes("mpesa")||l.includes("m-pesa")?"Enter M-Pesa reference (7-10 digits)":l.includes("airtel")?"Enter Airtel Money reference":l.includes("zenopay")?"Enter ZenoPay reference":"Enter reference number (6-12 characters)"},Uo=t=>{if(!t)return"Reference number from your mobile money transaction";const l=t.toLowerCase();return l.includes("mpesa")||l.includes("m-pesa")?"Enter the transaction reference from your M-Pesa confirmation message":l.includes("airtel")?"Enter the transaction reference from your Airtel Money confirmation message":l.includes("zenopay")?"Enter the transaction reference from your ZenoPay confirmation message":"Enter the transaction reference from your mobile money confirmation message"},Bo=({isOpen:t,onClose:l,onPaymentComplete:c,cartItems:o,total:u,customer:r})=>{const[d,g]=s.useState(!1),[N,O]=s.useState(!1),[P,w]=s.useState(!1),[p,v]=s.useState(null),[_,S]=s.useState(null),[m,k]=s.useState(""),[A,Z]=s.useState("idle"),[se,y]=s.useState(null),[T,q]=s.useState(!1),[j,F]=s.useState(""),{currentUser:Y}=Fs(),M=r&&r.phone,re=async()=>{if(!M){S("Customer phone number is required for mobile money payment");return}g(!0),S(null),k("Creating payment order...");try{const pe={buyer_email:r.email||`${r.phone}@mobile.money`,buyer_name:r.name,buyer_phone:r.phone,amount:u,metadata:{cart_items:o.map(be=>({product_id:be.productId,variant_id:be.variantId,product_name:be.productName,variant_name:be.variantName,quantity:be.quantity,price:be.unitPrice,total_price:be.totalPrice})),customer_id:r.id,pos_session_id:`pos_${Date.now()}`,order_type:"pos_sale",payment_method:"ussd_popup"}},X=await(await fetch(vt.getCreateOrderUrl(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(pe)})).json();if(X.success){const be={order_id:X.order_id,buyer_email:r.email||`${r.phone}@mobile.money`,buyer_name:r.name,buyer_phone:r.phone,amount:u,payment_status:"PENDING"};v(be),k("Payment order created successfully. Triggering USSD popup..."),await n(be.order_id)}else throw new Error(X.error||"Failed to create payment order")}catch(pe){const ee=pe instanceof Error?pe.message:"Failed to create payment order";S(ee),k("")}finally{g(!1)}},n=async pe=>{if(!(r!=null&&r.phone)){S("Customer phone number is required for USSD popup");return}w(!0),Z("triggering"),k(pt.MESSAGES.INITIATING);try{console.log("[ZenoPay USSD] Triggering USSD popup for customer:",{phone:r.phone,amount:u,orderId:pe,customerName:r.name});const ee=await gn.triggerUssdPopup(r.phone,u,pe,r.name);ee.success?(Z("sent"),k(pt.MESSAGES.PENDING),console.log("[ZenoPay USSD] USSD popup triggered successfully:",ee.data),$(pe)):(Z("error"),S(ee.message),k(""),console.error("[ZenoPay USSD] USSD popup trigger failed:",ee))}catch(ee){const X=ee instanceof Error?ee.message:"USSD popup error";Z("error"),S(X),k(""),console.error("[ZenoPay USSD] USSD popup error:",ee)}finally{w(!1)}},$=pe=>{console.log("[ZenoPay USSD] Starting USSD status polling for order:",pe);const ee=setInterval(async()=>{try{const X=await gn.checkUssdStatus(pe);console.log("[ZenoPay USSD] Status check result:",X),X.success?(Z(X.status),X.status==="completed"?(k(pt.MESSAGES.SUCCESS),clearInterval(ee),y(null),await ce(p)):X.status==="failed"?(S(pt.MESSAGES.FAILED),k(""),clearInterval(ee),y(null)):X.status==="cancelled"?(S(pt.MESSAGES.CANCELLED),k(""),clearInterval(ee),y(null)):k(pt.MESSAGES.PENDING)):console.warn("[ZenoPay USSD] Status check failed:",X)}catch(X){console.error("[ZenoPay USSD] Status polling error:",X)}},5e3);y(ee),setTimeout(()=>{ee&&(clearInterval(ee),y(null),(A==="sent"||A==="pending")&&(Z("timeout"),S(pt.MESSAGES.TIMEOUT),k(""),console.warn("[ZenoPay USSD] USSD polling timeout")))},pt.POPUP_TIMEOUT)},V=async pe=>{O(!0);try{const X=await(await fetch(vt.getCheckStatusUrl(pe))).json();if(X.success&&X.orders.length>0){const be=X.orders[0];v(be),be.payment_status==="COMPLETED"?(k("Payment completed successfully!"),await ce(be)):be.payment_status==="FAILED"?(S("Payment failed. Please try again."),k("")):be.payment_status==="CANCELLED"?(S("Payment was cancelled by the customer."),k("")):k("Payment is still pending. Please wait...")}else throw new Error(X.error||"Failed to check payment status")}catch(ee){const X=ee instanceof Error?ee.message:"Failed to check payment status";S(X)}finally{O(!1)}},ie=async()=>{if(!j.trim()){S("Please enter a reference number");return}const pe=zo(j,"ZenoPay");if(!pe.isValid){S(pe.error);return}const ee={order_id:`MANUAL_${Date.now()}`,buyer_email:r.email||`${r.phone}@mobile.money`,buyer_name:r.name,buyer_phone:r.phone,amount:u,payment_status:"COMPLETED",reference:j.trim()};await ce(ee)},ce=async pe=>{try{const ee={id:`sale_${Date.now()}`,saleNumber:`SALE-${Date.now().toString().slice(-6)}`,items:o.map(X=>({id:`item_${Date.now()}_${X.id}`,saleId:`sale_${Date.now()}`,productId:X.productId,variantId:X.variantId,productName:X.productName,variantName:X.variantName,sku:X.sku,quantity:X.quantity,unitPrice:X.unitPrice,totalPrice:X.totalPrice,costPrice:0,profit:0})),subtotal:o.reduce((X,be)=>X+be.totalPrice,0),tax:o.reduce((X,be)=>X+be.totalPrice,0)*.16,discount:0,total:u+o.reduce((X,be)=>X+be.totalPrice,0)*.16,paymentMethod:{type:"mobile_money",details:{mobileProvider:"ZenoPay",reference:pe.reference,paymentMethod:"ussd_popup"},amount:u},paymentStatus:"completed",customerId:r==null?void 0:r.id,customerName:r==null?void 0:r.name,customerPhone:r==null?void 0:r.phone,soldBy:(Y==null?void 0:Y.name)||(Y==null?void 0:Y.email)||"POS User",soldAt:new Date().toISOString(),createdAt:new Date().toISOString()};console.log("[ZenoPay USSD] Sale completed successfully:",ee),c(ee),l()}catch(ee){S("Failed to complete sale. Please contact support."),console.error("[ZenoPay USSD] Sale completion error:",ee)}};return s.useEffect(()=>{t||(v(null),S(null),k(""),g(!1),O(!1),w(!1),Z("idle"),q(!1),F(""),se&&(clearInterval(se),y(null)))},[t,se]),s.useEffect(()=>()=>{se&&clearInterval(se)},[se]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black bg-opacity-50",onClick:l,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsxs(ms,{className:"w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ls,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Mobile Money Payment"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Je,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total Amount:"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:u.toLocaleString("en-US",{style:"currency",currency:"TZS"})})]}),r&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Customer:"}),e.jsx("div",{className:"font-medium",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(Jt,{className:"w-3 h-3"}),r.phone]})]}),A!=="idle"&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(as,{variant:A==="completed"?"success":A==="failed"||A==="cancelled"||A==="timeout"?"error":A==="sent"?"primary":"warning",size:"sm",children:["USSD: ",A.toUpperCase()]}),A==="triggering"&&e.jsx(ss,{className:"w-4 h-4 animate-spin text-blue-600"})]}),A==="sent"&&e.jsxs("div",{className:"text-sm text-blue-700",children:["USSD popup sent to ",r==null?void 0:r.phone,". Waiting for customer response..."]})]}),p&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(as,{variant:"primary",size:"sm",children:["Order: ",p.order_id.slice(-8)]}),e.jsx(as,{variant:p.payment_status==="COMPLETED"?"success":p.payment_status==="FAILED"||p.payment_status==="CANCELLED"?"error":"warning",size:"sm",children:p.payment_status})]}),p.reference&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Reference: ",p.reference]})]})]}),m&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4 animate-spin text-blue-600"}),e.jsx("span",{className:"text-blue-800",children:m})]})}),_&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-red-800",children:_})]})}),e.jsxs("div",{className:"space-y-3",children:[!p&&e.jsx(mt,{onClick:re,disabled:!M||d||P,className:"w-full",size:"lg",children:d?e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4 animate-spin mr-2"}),"Creating Payment Order..."]}):P?e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4 animate-spin mr-2"}),"Sending USSD Popup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Pay with USSD Popup"]})}),(p==null?void 0:p.payment_status)==="PENDING"&&A==="idle"&&e.jsx(mt,{onClick:()=>V(p.order_id),disabled:N,variant:"outline",className:"w-full",children:N?e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4 animate-spin mr-2"}),"Checking Status..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Check Payment Status"]})}),A==="sent"&&e.jsx(mt,{onClick:()=>n(p.order_id),disabled:P,variant:"outline",className:"w-full",children:P?e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4 animate-spin mr-2"}),"Resending USSD Popup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Resend USSD Popup"]})}),!p&&e.jsxs(mt,{onClick:()=>q(!T),variant:"outline",className:"w-full",children:[e.jsx(Ia,{className:"w-4 h-4 mr-2"}),T?"Hide Manual Entry":"Enter Reference Manually"]}),T&&e.jsxs("div",{className:"space-y-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reference Number *"}),e.jsx(yo,{value:j,onChange:pe=>F(pe),placeholder:qo("ZenoPay"),maxLength:50}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:Uo("ZenoPay")})]}),e.jsxs(mt,{onClick:ie,disabled:!j.trim(),className:"w-full",size:"sm",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Complete Payment"]})]}),e.jsx(mt,{onClick:l,variant:"ghost",className:"w-full",children:"Cancel"})]}),e.jsx("div",{className:"mt-6 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium mb-1",children:"USSD Popup Instructions:"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsxs("li",{children:["â€¢ Customer will receive a USSD popup on their phone (",r==null?void 0:r.phone,")"]}),e.jsxs("li",{children:["â€¢ USSD popup will show payment amount: ",u.toLocaleString("en-US",{style:"currency",currency:"TZS"})]}),e.jsx("li",{children:"â€¢ Customer needs to confirm payment on their mobile device"}),e.jsx("li",{children:"â€¢ Payment status will update automatically"}),e.jsx("li",{children:"â€¢ Sale will complete once payment is confirmed"}),e.jsx("li",{children:"â€¢ USSD popup will timeout after 5 minutes"})]})]})}),!1]})})]}):null},Vo=({isOpen:t,onClose:l,onSuccess:c,cartItems:o,cartTotal:u,customer:r,currentUser:d})=>{const{currentBranch:g}=Rs(),[N,O]=s.useState([]),[P,w]=s.useState(!1),[p,v]=s.useState(!1),[_,S]=s.useState(!1),m=C=>{const I=typeof C=="string"?parseFloat(C.replace(/,/g,"")):C;return I%1===0?I.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):I.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})};s.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]);const[k,A]=s.useState("basic"),[Z,se]=s.useState(new Date().toISOString().split("T")[0]),[y,T]=s.useState(null),[q,j]=s.useState([]),[F,Y]=s.useState([]),[M,re]=s.useState(!0),[n,$]=s.useState({down_payment:0,number_of_installments:3,payment_frequency:"monthly",start_date:new Date().toISOString().split("T")[0],late_fee_amount:0,notes:"Created from POS",account_id:""}),V=(C,I)=>{const L=new Date(C),K=new Date(L);switch(I){case"weekly":K.setDate(L.getDate()+7);break;case"bi_weekly":K.setDate(L.getDate()+14);break;case"monthly":K.setMonth(L.getMonth()+1);break;default:K.setMonth(L.getMonth()+1)}return K.toISOString().split("T")[0]};s.useEffect(()=>{if(t){S(!1);const C=new Date().toISOString().split("T")[0];se(C);const I=V(C,n.payment_frequency);$(L=>({...L,start_date:I})),console.log("ðŸ” [POS Installment] Modal opened with props:"),console.log("   - customer:",r),console.log("   - currentUser:",d),console.log("   - cartItems:",o),console.log("   - cartTotal:",u),r||console.error("âŒ [POS Installment] Customer is null/undefined!"),d||console.error("âŒ [POS Installment] CurrentUser is null/undefined!")}else A("basic"),se(new Date().toISOString().split("T")[0])},[t,r,d,o,u]),s.useEffect(()=>{(async()=>{if(t){w(!0);try{const I=await jn.getPaymentMethods();O(I||[]),I.length===0&&x.error("No payment accounts found. Please create a payment account first.")}catch(I){console.error("Error fetching payment accounts:",I),x.error("Failed to load payment accounts"),O([])}finally{w(!1)}}})()},[t]);const ie=u-n.down_payment,ce=n.down_payment>0?n.number_of_installments-1:n.number_of_installments,pe=(C,I,L)=>{const K=C-I,de=I>0?L-1:L;if(de<=0)return[];const fe=[],Pe=K/de;let G=0;for(let ae=0;ae<de-1;ae++){const U=Math.round(Pe*100)/100;fe.push(U),G+=U}const ge=Math.round((K-G)*100)/100;return fe.push(ge),fe},ee=ce>0?ie/ce:0,X=s.useMemo(()=>{const C=[],I=new Date;I.setHours(0,0,0,0),n.down_payment>0&&C.push({number:1,dueDate:Z,amount:n.down_payment,status:"paid"});const L=n.down_payment>0?n.number_of_installments-1:n.number_of_installments;for(let K=0;K<L;K++){let de;q[K]?de=new Date(q[K]):(de=new Date(n.start_date),n.payment_frequency==="monthly"?de.setMonth(de.getMonth()+K):n.payment_frequency==="weekly"?de.setDate(de.getDate()+K*7):n.payment_frequency==="bi_weekly"&&de.setDate(de.getDate()+K*14));const Pe=de<I?"overdue":"pending",G=F[K]||ee;C.push({number:n.down_payment>0?K+2:K+1,dueDate:de.toISOString().split("T")[0],amount:G,status:Pe})}return C},[n.number_of_installments,n.start_date,n.payment_frequency,n.down_payment,q,F,ee,Z]);s.useEffect(()=>{if(n.number_of_installments&&n.start_date){const C=n.down_payment>0?n.number_of_installments-1:n.number_of_installments;if(C>0){const I=[],L=new Date(n.start_date);for(let K=0;K<C;K++){const de=new Date(L);n.payment_frequency==="monthly"?de.setMonth(L.getMonth()+K):n.payment_frequency==="weekly"?de.setDate(L.getDate()+K*7):n.payment_frequency==="bi_weekly"&&de.setDate(L.getDate()+K*14),I.push(de.toISOString().split("T")[0])}if(j(I),F.length!==C){const K=pe(u,n.down_payment,n.number_of_installments),de=[];for(let fe=0;fe<C;fe++)de.push(F[fe]||K[fe]||ee);Y(de),We(new Set)}}else j([]),Y([]),We(new Set)}},[n.number_of_installments,n.start_date,n.payment_frequency,n.down_payment,ee]),s.useEffect(()=>{if(t&&n.number_of_installments>0&&u>0){const C=u/n.number_of_installments,I=Math.round(C*100)/100;$(L=>({...L,down_payment:I}))}},[n.number_of_installments,u,t]);const be=(C,I,L)=>{const K=n.down_payment>0?n.number_of_installments-1:n.number_of_installments;let de=n.down_payment;for(let J=0;J<K;J++)J===C?de+=I:de+=L[J]||ee;const fe=u-de;if(K-1<=0){const J=u-n.down_payment;return[Math.round(J*100)/100]}const G=[...L];G[C]=Math.round(I*100)/100;const ge=[];for(let J=0;J<K;J++)J!==C&&ge.push(J);let ae=0;const U=fe/ge.length;for(let J=0;J<ge.length-1;J++){const he=ge[J],Ce=Math.round(U*100)/100;G[he]=Ce,ae+=Ce}if(ge.length>0){const J=ge[ge.length-1],he=Math.round((fe-ae)*100)/100;G[J]=he}return G},[ke,We]=s.useState(new Set);s.useEffect(()=>{if(n.down_payment>=0&&n.number_of_installments>0&&u>0&&(n.down_payment>0?n.number_of_installments-1:n.number_of_installments)>0&&ke.size===0){const I=pe(u,n.down_payment,n.number_of_installments);Y(I)}},[n.down_payment,u,n.number_of_installments]),s.useEffect(()=>{if(Z&&n.payment_frequency){const C=V(Z,n.payment_frequency);$(I=>({...I,start_date:C}))}},[Z,n.payment_frequency]);const we=()=>{k==="basic"?A("dates"):k==="dates"&&A("summary")},ze=()=>{k==="dates"?A("basic"):k==="summary"&&A("dates")},et=async C=>{var Pe,G,ge,ae,U,J,he,Ce,ye,qe,He,Ue,Ge,Qe;if(C.preventDefault(),S(!0),console.log("ðŸš€ [POS Installment] Form submitted"),console.log("ðŸ“‹ [POS Installment] Form Data:",n),console.log("ðŸ‘¤ [POS Installment] Customer:",r),console.log("ðŸ›’ [POS Installment] Cart Total:",u),console.log("ðŸ“¦ [POS Installment] Cart Items Count:",o==null?void 0:o.length),!r){console.error("âŒ [POS Installment] Customer is null/undefined"),x.error("Customer information is missing. Please select a customer.");return}if(!r.id){console.error("âŒ [POS Installment] Customer ID is missing:",r),x.error("Customer ID is missing. Please reselect the customer.");return}if(!o||o.length===0){console.error("âŒ [POS Installment] No items in cart"),x.error("Please add items to cart first");return}if(!n.account_id){console.error("âŒ [POS Installment] No payment account selected"),x.error("Please select a payment account");return}if(n.down_payment<0||n.down_payment>u){console.error("âŒ [POS Installment] Invalid down payment:",n.down_payment),x.error("Invalid down payment amount");return}const I=n.down_payment>0?n.number_of_installments-1:n.number_of_installments;let L=[...F];for(let D=0;D<I;D++)L[D]===void 0&&(L[D]=ee);let K=0;for(let D=0;D<I;D++)K+=L[D]||0;const de=n.down_payment+K,fe=Math.abs(de-u);if(fe>0&&fe<=.01&&I>0){const D=I-1,te=u-n.down_payment-K;L[D]=Math.round((L[D]+te)*100)/100,Y(L),K=0;for(let ve=0;ve<I;ve++)K+=L[ve]||0;console.log("ðŸ”§ [POS Installment] Auto-adjusted last installment for perfect balance:",{adjustment:te,lastIndex:D,newLastAmount:L[D],totalPayments:n.down_payment+K,cartTotal:u})}else if(fe>.01){console.error("âŒ [POS Installment] Payment balance mismatch:",{totalAmount:u,firstPayment:n.down_payment,totalInstallments:K,totalPayments:de,difference:fe}),x.error(`Payment amounts don't balance!

Total Amount: ${m(u)} TZS
First Payment: ${m(n.down_payment)} TZS
Installments Total: ${m(K)} TZS
Total Payments: ${m(de)} TZS

Difference: ${m(fe)} TZS

Please adjust the amounts so they equal the total amount.`);return}if(!d){console.error("âŒ [POS Installment] CurrentUser is null/undefined"),x.error("User not authenticated. Please log in again.");return}if(!d.id){console.error("âŒ [POS Installment] User ID is missing:",d),x.error("User ID is missing. Please log in again.");return}console.log("âœ… [POS Installment] All validations passed"),v(!0);try{console.log("ðŸ“ [POS Installment] Step 1: Creating sale...");const D={customerId:r.id,customerName:r.name,customerPhone:r.phone,customerEmail:r.email,items:o.map(W=>({id:W.id,productId:W.productId,variantId:W.variantId,productName:W.productName,variantName:W.variantName||"",sku:W.sku,quantity:W.quantity,unitPrice:W.unitPrice,totalPrice:W.totalPrice,costPrice:W.costPrice||0,profit:W.profit||0})),subtotal:u,tax:0,discount:0,total:u,paymentMethod:{type:"installment",amount:0,details:{accountId:n.account_id,reference:"Installment Plan - Payments tracked via installment_payments table",notes:`Installment Plan: ${n.number_of_installments} payments`}},paymentStatus:"completed",soldBy:(d==null?void 0:d.name)||(d==null?void 0:d.email)||"POS User",notes:`Installment Plan: ${n.number_of_installments} payments`};console.log("ðŸ“¤ [POS Installment] Sale Data:",JSON.stringify(D,null,2));const te=await ts.processSale(D);if(console.log("ðŸ“¥ [POS Installment] Sale Result:",te),!te.success||!te.sale)throw console.error("âŒ [POS Installment] Sale creation failed:",te.error),new Error(te.error||"Failed to create sale");console.log("âœ… [POS Installment] Sale created successfully"),console.log("ðŸ”¢ [POS Installment] Sale ID:",te.sale.id),console.log("ðŸ”¢ [POS Installment] Sale Number:",te.sale.saleNumber),console.log("ðŸ“ [POS Installment] Step 2: Creating installment plan...");const ve=N.find(W=>W.id===n.account_id),At=(ve==null?void 0:ve.type)==="cash"?"cash":(ve==null?void 0:ve.type)==="mobile_money"?"mobile_money":(ve==null?void 0:ve.type)==="bank"||(ve==null?void 0:ve.type)==="savings"?"bank_transfer":(ve==null?void 0:ve.type)==="card"?"card":"cash";console.log("ðŸ’³ [POS Installment] Payment Method from account:",{accountId:n.account_id,accountName:ve==null?void 0:ve.name,accountType:ve==null?void 0:ve.type,derivedPaymentMethod:At});const kt={customer_id:r.id,sale_id:te.sale.id,total_amount:u,down_payment:n.down_payment,number_of_installments:n.number_of_installments,payment_frequency:n.payment_frequency,start_date:n.start_date,late_fee_amount:n.late_fee_amount,notes:`${n.notes} - Sale: ${te.sale.saleNumber}`,payment_method:At,account_id:n.account_id};console.log("ðŸ“¤ [POS Installment] Installment Data:",JSON.stringify(kt,null,2)),console.log("ðŸ‘¤ [POS Installment] Created By User ID:",d.id),console.log("ðŸ’° [POS Installment] Payment Calculations:",{cartTotal:u,downPayment:n.down_payment,amountToFinance:ie,calculatedInstallmentAmount:ee,numberOfInstallments:n.number_of_installments});const tt=await Pl.createInstallmentPlan(kt,d.id,g==null?void 0:g.id);if(console.log("ðŸ“¥ [POS Installment] Installment Result:",tt),tt.success&&tt.plan)console.log("âœ… [POS Installment] Installment plan created successfully!"),console.log("ðŸ”¢ [POS Installment] Plan Number:",tt.plan.plan_number),console.log("ðŸ”¢ [POS Installment] Plan ID:",tt.plan.id),x.success(`âœ… Sale completed with installment plan!
Sale: ${te.sale.saleNumber}
Plan: ${tt.plan.plan_number}`),S(!1),c();else{const W=tt.error||"Failed to create installment plan";console.error("âŒ [POS Installment] Installment plan creation failed:",W),te.success&&te.sale?(console.warn("âš ï¸ [POS Installment] Sale was created but installment plan failed. Sale ID:",te.sale.id),x.error(`Sale was created (${te.sale.saleNumber}), but installment plan creation failed:
${W}

Please contact support.`,{duration:8e3})):x.error(W,{duration:6e3})}}catch(D){console.error("âŒ [POS Installment] Error creating installment sale:",D),console.error("âŒ [POS Installment] Error Stack:",D==null?void 0:D.stack),console.error("âŒ [POS Installment] Error Details:",{message:D==null?void 0:D.message,code:D==null?void 0:D.code,status:D==null?void 0:D.status,name:D==null?void 0:D.name,customer:r==null?void 0:r.id,cartTotal:u,formData:n});let te="An error occurred while creating the installment plan.",ve="Error";(Pe=D==null?void 0:D.message)!=null&&Pe.includes("Failed to fetch")||(G=D==null?void 0:D.message)!=null&&G.includes("NetworkError")||(ge=D==null?void 0:D.message)!=null&&ge.includes("timeout")||(D==null?void 0:D.code)==="NETWORK_ERROR"?(ve="Network Error",te="Unable to connect to the server. Please check your internet connection and try again."):(D==null?void 0:D.code)==="23505"||(ae=D==null?void 0:D.message)!=null&&ae.includes("duplicate")||(U=D==null?void 0:D.message)!=null&&U.includes("unique")?(ve="Duplicate Entry",te="An installment plan with these details already exists. Please check and try again."):(D==null?void 0:D.code)==="23502"||(J=D==null?void 0:D.message)!=null&&J.includes("null value")||(he=D==null?void 0:D.message)!=null&&he.includes("required")?(ve="Validation Error",te="Some required information is missing. Please check all fields and try again."):(D==null?void 0:D.code)==="42501"||(Ce=D==null?void 0:D.message)!=null&&Ce.includes("permission")||(ye=D==null?void 0:D.message)!=null&&ye.includes("unauthorized")?(ve="Permission Denied",te="You do not have permission to create installment plans. Please contact your administrator."):(qe=D==null?void 0:D.message)!=null&&qe.includes("Payment amounts don't balance")?(ve="Payment Balance Error",te=D.message):(He=D==null?void 0:D.message)!=null&&He.includes("sale")||(Ue=D==null?void 0:D.message)!=null&&Ue.includes("Sale")?(ve="Sale Creation Failed",te=`Failed to create the sale: ${D.message||"Unknown error"}. The installment plan was not created.`):(Ge=D==null?void 0:D.message)!=null&&Ge.includes("installment")||(Qe=D==null?void 0:D.message)!=null&&Qe.includes("plan")?(ve="Installment Plan Error",te=`Failed to create installment plan: ${D.message||"Unknown error"}`):D!=null&&D.message&&(te=D.message),x.error(`${ve}: ${te}`,{duration:6e3})}finally{console.log("ðŸ [POS Installment] Process complete, resetting submit state"),v(!1)}};return t?ea.createPortal(e.jsx("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[100000]",style:{top:0,left:0,right:0,bottom:0},role:"dialog","aria-modal":"true","aria-labelledby":"installment-modal-title",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx("div",{className:"px-6 pt-6 pb-0 border-b border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>A("basic"),className:`px-6 py-3 text-sm font-semibold border-b-2 transition-colors ${k==="basic"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Basic Info"}),e.jsx("button",{type:"button",onClick:()=>A("dates"),className:`px-6 py-3 text-sm font-semibold border-b-2 transition-colors ${k==="dates"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Dates"}),e.jsx("button",{type:"button",onClick:()=>A("summary"),className:`px-6 py-3 text-sm font-semibold border-b-2 transition-colors ${k==="summary"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Summary"})]})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(js,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"installment-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Create Installment Plan"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Set up payment terms for this sale"})]})]})}),k==="basic"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-6 pt-6 pb-4 flex-shrink-0",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-md flex-shrink-0",children:e.jsx(xt,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Customer"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 truncate",children:(r==null?void 0:r.name)||"N/A"}),(r==null?void 0:r.phone)&&e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:r.phone}),(r==null?void 0:r.email)&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:r.email})]})]})})}),e.jsx("div",{className:"px-6 pb-4 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center text-center p-4 rounded-lg bg-gradient-to-br from-emerald-50 to-emerald-100/50 border border-emerald-200",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-emerald-500 flex items-center justify-center mb-3 shadow-sm",children:e.jsx(ft,{className:"w-6 h-6 text-white"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1.5",children:"Total Amount"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-700",children:[m(u)," TZS"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(o==null?void 0:o.length)||0," item",(o==null?void 0:o.length)!==1?"s":""]})]}),e.jsxs("div",{className:"flex flex-col items-center text-center p-4 rounded-lg bg-gradient-to-br from-indigo-50 to-indigo-100/50 border border-indigo-200",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-indigo-500 flex items-center justify-center mb-3 shadow-sm",children:e.jsx(ns,{className:"w-6 h-6 text-white"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1.5",children:"To Finance"}),e.jsxs("p",{className:"text-lg font-bold text-indigo-700",children:[m(ie)," TZS"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n.down_payment>0?"After first payment":"Total to finance"})]})]}),n.down_payment>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-gradient-to-br from-blue-50 to-blue-100/50 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(js,{className:"w-4 h-4 text-blue-600"}),e.jsx("p",{className:"text-xs font-semibold text-blue-700",children:"First Payment"})]}),e.jsxs("p",{className:"text-base font-bold text-blue-900",children:[m(n.down_payment)," TZS"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-gradient-to-br from-purple-50 to-purple-100/50 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(Rt,{className:"w-4 h-4 text-purple-600"}),e.jsx("p",{className:"text-xs font-semibold text-purple-700",children:"Per Installment"})]}),e.jsxs("p",{className:"text-base font-bold text-purple-900",children:[m(ee)," TZS"]})]})]})})]})})]}),e.jsxs("form",{onSubmit:et,className:"flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-6",children:[k==="basic"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Payment Frequency ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{const C="weekly";if($(I=>({...I,payment_frequency:C})),Z){const I=V(Z,C);$(L=>({...L,start_date:I}))}},className:`px-4 py-3 rounded-xl border-2 font-semibold transition-all ${n.payment_frequency==="weekly"?"border-blue-500 bg-blue-50 text-blue-700 shadow-md":"border-gray-300 bg-white text-gray-700 hover:border-blue-300 hover:bg-blue-50/50"}`,children:"Weekly"}),e.jsx("button",{type:"button",onClick:()=>{const C="bi_weekly";if($(I=>({...I,payment_frequency:C})),Z){const I=V(Z,C);$(L=>({...L,start_date:I}))}},className:`px-4 py-3 rounded-xl border-2 font-semibold transition-all ${n.payment_frequency==="bi_weekly"?"border-blue-500 bg-blue-50 text-blue-700 shadow-md":"border-gray-300 bg-white text-gray-700 hover:border-blue-300 hover:bg-blue-50/50"}`,children:"Bi-Weekly"}),e.jsx("button",{type:"button",onClick:()=>{const C="monthly";if($(I=>({...I,payment_frequency:C})),Z){const I=V(Z,C);$(L=>({...L,start_date:I}))}},className:`px-4 py-3 rounded-xl border-2 font-semibold transition-all ${n.payment_frequency==="monthly"?"border-blue-500 bg-blue-50 text-blue-700 shadow-md":"border-gray-300 bg-white text-gray-700 hover:border-blue-300 hover:bg-blue-50/50"}`,children:"Monthly"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Number of Installments ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{n.number_of_installments>1&&$(C=>({...C,number_of_installments:C.number_of_installments-1}))},disabled:n.number_of_installments<=1,className:"w-10 h-12 flex items-center justify-center border-2 border-gray-300 rounded-xl bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Da,{className:"w-5 h-5 text-gray-600"})}),e.jsx("input",{type:"number",value:n.number_of_installments,onChange:C=>$(I=>({...I,number_of_installments:parseInt(C.target.value)||1})),className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-lg font-bold bg-white text-center",min:"1",required:!0}),e.jsx("button",{type:"button",onClick:()=>{$(C=>({...C,number_of_installments:C.number_of_installments+1}))},className:"w-10 h-12 flex items-center justify-center border-2 border-gray-300 rounded-xl bg-white hover:bg-gray-50 transition-colors",children:e.jsx(Wt,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["First Payment ",e.jsx("span",{className:"text-gray-500",children:"(Optional)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ft,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:m(n.down_payment||0),onChange:C=>{const I=C.target.value.replace(/,/g,""),L=parseFloat(I)||0;$(K=>({...K,down_payment:Math.min(L,u)}))},className:"w-full pl-12 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-lg font-bold bg-white text-center"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center",children:n.down_payment>0?"Initial payment - remaining installments will auto-adjust":"Optional initial payment"})]})]})]}),k==="dates"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Next Payment Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Rt,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:n.start_date,onChange:C=>$(I=>({...I,start_date:C.target.value})),className:"w-full pl-12 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 font-medium bg-white",required:!0})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[n.payment_frequency==="weekly"&&`Calculated: 1 week from today${n.down_payment>0?" (plan starts today with first payment)":""}`,n.payment_frequency==="bi_weekly"&&`Calculated: 2 weeks from today${n.down_payment>0?" (plan starts today with first payment)":""}`,n.payment_frequency==="monthly"&&`Calculated: 1 month from today${n.down_payment>0?" (plan starts today with first payment)":""}`]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5 text-purple-600"}),"Installment Schedule"]}),e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-purple-50 border border-purple-200 rounded-lg",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-700",children:["0 / ",n.number_of_installments," Paid"]})})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-1",children:X.map((C,I)=>{const L=y===C.number,de=new Date(C.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),fe=C.status==="overdue",Pe=C.number===1&&n.down_payment>0;return e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`p-5 rounded-2xl border-2 transition-all duration-200 bg-white ${fe?"border-red-300 shadow-md hover:shadow-lg":"border-gray-200 hover:border-gray-300 hover:shadow-sm"} cursor-pointer`,onClick:()=>T(L?null:C.number),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:`relative flex-shrink-0 w-14 h-14 rounded-full flex items-center justify-center font-bold text-lg shadow-lg ${fe?"bg-gradient-to-br from-red-500 to-red-600":"bg-gradient-to-br from-gray-400 to-gray-500"} text-white`,children:C.number}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Rt,{className:`w-4 h-4 flex-shrink-0 ${fe?"text-red-600":"text-gray-500"}`}),e.jsx("div",{className:"text-base font-bold text-gray-900",children:de})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase border ${Pe?"bg-green-100 text-green-800 border-green-200":fe?"bg-red-100 text-red-800 border-red-200":"bg-gray-100 text-gray-700 border-gray-200"}`,children:[fe&&e.jsx(rs,{className:"w-3.5 h-3.5"}),Pe?"paid":C.status]})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0 ml-4",children:[e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-2xl font-bold mb-1 ${fe?"text-red-700":"text-gray-900"}`,children:[m(C.amount)," TZS"]})}),L?e.jsx(Ea,{className:"w-5 h-5 text-gray-400"}):e.jsx(ws,{className:"w-5 h-5 text-gray-400"})]})]})}),L&&e.jsx("div",{className:"mt-2 p-4 bg-gray-50 rounded-xl border-2 border-blue-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",value:C.number===1&&n.down_payment>0?Z:q[C.number-(n.down_payment>0?2:1)]||C.dueDate,onChange:G=>{if(C.number===1&&n.down_payment>0)return;const ge=[...q],ae=C.number-(n.down_payment>0?2:1);ge[ae]=G.target.value,j(ge)},disabled:C.number===1&&n.down_payment>0,className:"w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 font-medium bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",onClick:G=>G.stopPropagation()})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ft,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:m(C.number===1&&n.down_payment>0?n.down_payment:F[C.number-(n.down_payment>0?2:1)]||C.amount),onChange:G=>{if(C.number===1&&n.down_payment>0)return;const ge=G.target.value.replace(/,/g,""),ae=parseFloat(ge)||0,U=C.number-(n.down_payment>0?2:1);We(he=>new Set([...he,U]));const J=be(U,ae,F);Y(J)},disabled:C.number===1&&n.down_payment>0,className:"w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 font-medium bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",onClick:G=>G.stopPropagation()})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:C.number===1&&n.down_payment>0?"First payment amount (edit in First Payment field)":"Edit amount - remaining installments will auto-adjust"})]}),C.number===1&&n.down_payment>0&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"First payment date is fixed to today"})]})}),I<X.length-1&&e.jsx("div",{className:`absolute left-7 top-full w-0.5 h-3 ${fe?"bg-red-300":"bg-gray-200"}`})]},C.number)})})]})]}),k==="summary"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-2xl border-2 border-gray-200 shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-6 cursor-pointer hover:from-blue-700 hover:to-indigo-700 transition-all",onClick:()=>re(!M),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-lg",children:e.jsx(js,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-white mb-1",children:"Installment Plan Summary"}),!M&&e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/20 px-3 py-1 rounded-lg backdrop-blur-sm",children:[e.jsx(xt,{className:"w-4 h-4 text-white"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:(r==null?void 0:r.name)||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white/20 px-3 py-1 rounded-lg backdrop-blur-sm",children:[e.jsx(ft,{className:"w-4 h-4 text-white"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[m(u)," TZS"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white/20 px-3 py-1 rounded-lg backdrop-blur-sm",children:[e.jsx(Rt,{className:"w-4 h-4 text-white"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[n.number_of_installments," payments"]})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:M?e.jsx(Ea,{className:"w-6 h-6 text-white"}):e.jsx(ws,{className:"w-6 h-6 text-white"})})]})}),M&&e.jsxs("div",{className:"p-6 space-y-6",children:[o&&o.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ut,{className:"w-5 h-5 text-blue-600"}),e.jsxs("h5",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide",children:["Products (",o.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-40 overflow-y-auto pr-2",children:o.map((C,I)=>{const L=C.productName||C.name||C.product_name||`Item ${I+1}`,K=C.variantName||C.variant_name,de=C.quantity||1,fe=C.unitPrice||C.unit_price||0,Pe=C.totalPrice||C.total_price||fe*de;return e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-gray-50 to-white rounded-lg border border-gray-100 hover:border-blue-200 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900 truncate",children:[L,K&&e.jsxs("span",{className:"text-gray-500 font-normal",children:[" - ",K]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Qty: ",de," ",fe>0&&`Ã— ${m(fe)}`]})]}),e.jsx("div",{className:"text-right ml-4 flex-shrink-0",children:e.jsxs("p",{className:"text-base font-bold text-gray-900",children:[m(Pe)," TZS"]})})]},I)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-5 border border-blue-200",children:[e.jsxs("h5",{className:"text-xs font-bold text-blue-900 uppercase tracking-wide mb-4 flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),"Customer Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:"Customer Name"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:(r==null?void 0:r.name)||"N/A"}),(r==null?void 0:r.phone)&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“ž"})," ",r.phone]})]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-5 border border-purple-200",children:[e.jsxs("h5",{className:"text-xs font-bold text-purple-900 uppercase tracking-wide mb-4 flex items-center gap-2",children:[e.jsx(Rt,{className:"w-4 h-4"}),"Payment Schedule"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white/60 rounded-lg",children:[e.jsx("span",{className:"text-xs font-medium text-purple-700",children:"Frequency"}),e.jsx("span",{className:"text-sm font-bold text-gray-900 capitalize px-3 py-1 bg-purple-100 rounded-md",children:n.payment_frequency.replace("_","-")})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white/60 rounded-lg",children:[e.jsx("span",{className:"text-xs font-medium text-purple-700",children:"Total Installments"}),e.jsx("span",{className:"text-lg font-bold text-purple-900",children:n.number_of_installments})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-5 border border-emerald-200",children:[e.jsxs("h5",{className:"text-xs font-bold text-emerald-900 uppercase tracking-wide mb-4 flex items-center gap-2",children:[e.jsx(ft,{className:"w-4 h-4"}),"Financial Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white/80 rounded-lg border border-emerald-100",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Total Amount"}),e.jsxs("span",{className:"text-xl font-bold text-emerald-700",children:[m(u)," TZS"]})]}),n.down_payment>0&&e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-blue-50 to-blue-100/50 rounded-lg border border-blue-200",children:[e.jsxs("span",{className:"text-sm font-semibold text-blue-700 flex items-center gap-2",children:[e.jsx(js,{className:"w-4 h-4"}),"First Payment"]}),e.jsxs("span",{className:"text-lg font-bold text-blue-900",children:[m(n.down_payment)," TZS"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white/80 rounded-lg border border-indigo-100",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Amount to Finance"}),e.jsxs("span",{className:"text-lg font-bold text-indigo-700",children:[m(ie)," TZS"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-purple-50 to-purple-100/50 rounded-lg border border-purple-200",children:[e.jsxs("span",{className:"text-sm font-semibold text-purple-700 flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Per Installment"]}),e.jsxs("span",{className:"text-lg font-bold text-purple-900",children:[m(ee)," TZS"]})]}),n.late_fee_amount>0&&e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg border border-orange-200 mt-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-orange-700 flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Late Fee"]}),e.jsxs("span",{className:"text-lg font-bold text-orange-900",children:[m(n.late_fee_amount)," TZS"]})]})]})]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5 text-purple-600"}),"Payment Schedule"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-2",children:X.map(C=>{const L=new Date(C.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),K=C.status==="overdue";return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${K?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${K?"bg-red-500 text-white":"bg-gray-400 text-white"}`,children:C.number}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:L}),e.jsx("p",{className:`text-xs ${K?"text-red-600":"text-gray-500"}`,children:C.status})]})]}),e.jsxs("p",{className:`text-sm font-bold ${K?"text-red-700":"text-gray-900"}`,children:[m(C.amount)," TZS"]})]},C.number)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-3",children:["Payment Account ",e.jsx("span",{className:"text-red-500",children:"*"})]}),P?e.jsxs("div",{className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl bg-gray-50 flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Loading accounts..."})]}):N.length===0?e.jsx("div",{className:"p-4 border-2 border-orange-300 bg-orange-50 rounded-xl",children:e.jsxs("p",{className:"text-xs text-orange-600 flex items-center gap-1",children:[e.jsx(rs,{className:"w-4 h-4"}),"No payment accounts found. Please create one in Settings."]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:N.map(C=>{const I=n.account_id===C.id,K=(C.type==="cash"?"cash":C.type==="mobile_money"?"mobile_money":C.type==="bank"||C.type==="savings"?"bank_transfer":C.type==="card"?"card":"cash").replace(/_/g," ").replace(/\b\w/g,fe=>fe.toUpperCase()),de=_&&!n.account_id;return e.jsx("button",{type:"button",onClick:()=>{$(fe=>({...fe,account_id:C.id})),_&&C.id&&S(!1)},className:`p-4 rounded-xl border-2 transition-all text-left ${I?"border-blue-500 bg-blue-50 shadow-lg":de?"border-red-300 bg-red-50":"border-gray-300 bg-white hover:border-blue-300 hover:bg-blue-50/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${I?"bg-blue-500":"bg-gray-200"}`,children:e.jsx(Kl,{className:`w-5 h-5 ${I?"text-white":"text-gray-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-bold text-sm mb-1 ${I?"text-blue-900":"text-gray-900"}`,children:C.name}),e.jsx("p",{className:"text-xs text-gray-600",children:C.type?`${C.type.charAt(0).toUpperCase()+C.type.slice(1)}`:"Account"}),I&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1 font-medium",children:["âœ“ ",K]})]}),I&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]})},C.id)})}),_&&!n.account_id&&e.jsxs("p",{className:"text-xs text-red-600 mt-3 flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"}),"Please select a payment account to continue"]})]})]})]})})]}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:k==="basic"?l:ze,className:"flex-1 px-6 py-3.5 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all shadow-sm",children:k==="basic"?"Cancel":"Previous"}),k!=="summary"?e.jsx("button",{type:"button",onClick:we,className:"flex-1 px-6 py-3.5 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-all shadow-lg hover:shadow-xl text-lg",children:"Next"}):e.jsx("button",{type:"submit",disabled:p||!n.account_id||P,className:"flex-1 px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg",children:p?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):n.account_id?"Create Installment Plan":e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5"}),"Select Account First"]})})]})})]})]})}),document.body):null},Zo=["Repair Cost","Cleaning Cost","Testing Cost","Refurbishment","Packaging","Storage","Insurance","Other"],Wo=({isOpen:t,onClose:l,transaction:c,onConfirm:o,isLoading:u=!1})=>{var se;const{confirm:r}=Va(),[d,g]=s.useState({cost_price:c.final_trade_in_value||0,additional_costs:[],total_cost:c.final_trade_in_value||0,selling_price:0,markup_percentage:30,profit_per_unit:0}),[N,O]=s.useState(!1),P=y=>{const T=typeof y=="string"?parseFloat(y):y;return T%1===0?T.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):T.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})};s.useEffect(()=>{if(t&&c){const y=c.final_trade_in_value||0,T=30,q=y*(1+T/100),j=q-y;g({cost_price:y,additional_costs:[],total_cost:y,selling_price:parseFloat(q.toFixed(2)),markup_percentage:T,profit_per_unit:parseFloat(j.toFixed(2))})}},[t,c]);const w=y=>{const T=d.total_cost,q=y-T,j=T>0?q/T*100:0;g({...d,selling_price:y,markup_percentage:parseFloat(j.toFixed(2)),profit_per_unit:parseFloat(q.toFixed(2))}),O(!0),setTimeout(()=>O(!1),600)},p=y=>{const T=d.total_cost,q=T*(1+y/100),j=q-T;g({...d,selling_price:parseFloat(q.toFixed(2)),markup_percentage:y,profit_per_unit:parseFloat(j.toFixed(2))}),O(!0),setTimeout(()=>O(!1),600)},v=()=>{const y={id:`cost-${Date.now()}-${Math.random()}`,category:"Repair Cost",amount:0,description:""},T=[...d.additional_costs,y],q=T.reduce((M,re)=>M+re.amount,0),j=d.cost_price+q,F=d.selling_price-j,Y=j>0?F/j*100:0;g({...d,additional_costs:T,total_cost:parseFloat(j.toFixed(2)),markup_percentage:parseFloat(Y.toFixed(2)),profit_per_unit:parseFloat(F.toFixed(2))})},_=y=>{const T=d.additional_costs.filter(M=>M.id!==y),q=T.reduce((M,re)=>M+re.amount,0),j=d.cost_price+q,F=d.selling_price-j,Y=j>0?F/j*100:0;g({...d,additional_costs:T,total_cost:parseFloat(j.toFixed(2)),markup_percentage:parseFloat(Y.toFixed(2)),profit_per_unit:parseFloat(F.toFixed(2))})},S=(y,T,q)=>{const j=d.additional_costs.map(n=>n.id===y?{...n,[T]:q}:n),F=j.reduce((n,$)=>n+$.amount,0),Y=d.cost_price+F,M=d.selling_price-Y,re=Y>0?M/Y*100:0;g({...d,additional_costs:j,total_cost:parseFloat(Y.toFixed(2)),markup_percentage:parseFloat(re.toFixed(2)),profit_per_unit:parseFloat(M.toFixed(2))}),T==="amount"&&(O(!0),setTimeout(()=>O(!1),600))},m=async()=>{if(d.selling_price<=0){x.error("Please set a selling price greater than 0");return}if(!(d.selling_price<d.total_cost&&!await r(`Warning: Selling price (${P(d.selling_price)} TZS) is below total cost (${P(d.total_cost)} TZS). Continue anyway?`)))try{if(d.additional_costs.length>0){const{data:{user:y}}=await Te.auth.getUser(),T=y==null?void 0:y.id,q=Cl();for(const j of d.additional_costs)if(j.amount>0)try{const{error:F}=await Te.from("expenses").insert({category:j.category,amount:j.amount,description:`${j.description||j.category} for ${c.device_name} ${c.device_model} - Trade-In Transaction ${c.id}`,date:new Date().toISOString().split("T")[0],created_by:T,branch_id:q,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});F&&console.error("Error creating expense record:",F)}catch(F){console.error("Error saving expense:",F)}d.additional_costs.filter(j=>j.amount>0).length>0&&x.success(`Recorded ${d.additional_costs.filter(j=>j.amount>0).length} expense entries`)}await o(d)}catch(y){console.error("Error confirming pricing:",y),x.error("Failed to save pricing")}};if(!t)return null;const k=d.profit_per_unit>0,A=c.needs_repair||!1,Z=d.selling_price>0;return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[99999]",role:"dialog","aria-modal":"true","aria-labelledby":"trade-in-pricing-modal-title",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsxs("div",{className:"p-8 bg-white text-center border-b border-gray-200 flex-shrink-0",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx(ft,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{id:"trade-in-pricing-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Set Resale Price - Trade-In Device"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure pricing before adding to inventory"}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-4",children:Z?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(Yt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-bold text-green-700",children:"Pricing Complete"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg animate-pulse",children:[e.jsx(Zt,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-bold text-orange-700",children:"Set Selling Price"})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 pt-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-2xl p-5 mb-6 border-2 border-orange-200 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md",children:e.jsx(Ls,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-gray-900 text-xl mb-1",children:c.device_name}),e.jsx("p",{className:"text-sm text-gray-700 font-medium mb-3",children:c.device_model}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.device_imei&&e.jsxs("span",{className:"text-xs bg-white px-3 py-1.5 rounded-lg border-2 border-gray-300 font-semibold text-gray-700",children:["ðŸ“± IMEI: ",c.device_imei]}),e.jsxs("span",{className:`text-xs px-3 py-1.5 rounded-lg border-2 font-bold ${c.condition_rating==="excellent"?"bg-green-100 border-green-300 text-green-700":c.condition_rating==="good"?"bg-blue-100 border-blue-300 text-blue-700":c.condition_rating==="fair"?"bg-yellow-100 border-yellow-300 text-yellow-700":"bg-gray-100 border-gray-300 text-gray-700"}`,children:["â­ Condition: ",(se=c.condition_rating)==null?void 0:se.toUpperCase()]}),A&&e.jsx("span",{className:"text-xs bg-red-500 text-white px-3 py-1.5 rounded-lg border-2 border-red-600 font-bold shadow-sm",children:"âš ï¸ Needs Repair"})]}),c.condition_description&&e.jsx("p",{className:"text-sm text-gray-600 mt-3 italic",children:c.condition_description})]})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Trade-In Paid"}),e.jsx("p",{className:`text-xl font-bold text-gray-900 transition-all duration-300 ${N?"scale-110 text-blue-600":""}`,children:P(d.cost_price)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"TZS"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total Cost"}),e.jsx("p",{className:`text-xl font-bold text-gray-900 transition-all duration-300 ${N?"scale-110 text-blue-600":""}`,children:P(d.total_cost)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"TZS"})]})]}),e.jsxs("div",{className:"border-2 border-blue-200 rounded-2xl p-6 mb-6 bg-blue-50/30 shadow-sm",children:[e.jsxs("h4",{className:"font-bold text-gray-900 mb-5 flex items-center gap-2 text-lg",children:[e.jsx(Jl,{className:"w-6 h-6 text-blue-600"}),"Pricing Configuration"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-200",children:[e.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-2",children:"Selling Price *"}),e.jsx("input",{type:"text",value:P(d.selling_price),onChange:y=>{const T=y.target.value.replace(/,/g,""),q=parseFloat(T)||0;w(q)},className:"w-full px-4 py-3 border-2 border-blue-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-xl font-bold bg-white",placeholder:"Enter selling price"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-200",children:[e.jsx("label",{className:"block text-xs font-medium text-purple-700 mb-2",children:"Markup %"}),e.jsx("input",{type:"text",value:d.markup_percentage%1===0?d.markup_percentage:d.markup_percentage.toFixed(2),onChange:y=>{const T=y.target.value.replace(/,/g,""),q=parseFloat(T)||0;p(q)},className:"w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-gray-900 text-xl font-bold bg-white"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-3 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Quick Add Profit:"}),e.jsx("button",{type:"button",onClick:()=>{const T=d.total_cost+1e4;w(T)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+10K"}),e.jsx("button",{type:"button",onClick:()=>{const T=d.total_cost+5e4;w(T)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+50K"}),e.jsx("button",{type:"button",onClick:()=>{const T=d.total_cost+1e5;w(T)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+100K"}),e.jsx("button",{type:"button",onClick:()=>{const T=d.total_cost+2e5;w(T)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+200K"}),e.jsx("button",{type:"button",onClick:()=>{const T=d.total_cost+5e5;w(T)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+500K"})]}),!k&&d.selling_price>0&&e.jsxs("div",{className:"mt-4 flex items-start gap-3 p-4 bg-red-50 border-2 border-red-200 rounded-xl shadow-sm",children:[e.jsx(Zt,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-red-700",children:"âš ï¸ Warning: Loss on This Item"}),e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["Selling price is below total cost. You will lose ",P(Math.abs(d.profit_per_unit))," TZS on this device."]})]})]})]}),e.jsxs("div",{className:"border-2 border-orange-200 rounded-2xl p-5 mb-4 bg-orange-50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Additional Costs"}),e.jsxs("button",{type:"button",onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white text-sm rounded-xl transition-colors font-semibold shadow-lg",children:[e.jsx(Wt,{className:"w-4 h-4"}),"Add Cost"]})]}),d.additional_costs.length>0?e.jsxs("div",{className:"space-y-3",children:[d.additional_costs.map(y=>e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white rounded-xl border-2 border-orange-200 shadow-sm",children:[e.jsx("select",{value:y.category,onChange:T=>S(y.id,"category",T.target.value),className:"flex-1 px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 font-medium",children:Zo.map(T=>e.jsx("option",{value:T,children:T},T))}),e.jsx("input",{type:"text",value:P(y.amount),onChange:T=>{const q=T.target.value.replace(/,/g,""),j=parseFloat(q)||0;S(y.id,"amount",j)},placeholder:"Amount",className:"w-44 px-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 font-bold text-lg"}),e.jsx("input",{type:"text",value:y.description,onChange:T=>S(y.id,"description",T.target.value),placeholder:"Description (optional)",className:"flex-1 px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200"}),e.jsx("button",{type:"button",onClick:()=>_(y.id),className:"p-2.5 text-red-600 hover:bg-red-100 rounded-xl transition-colors",title:"Remove cost",children:e.jsx(ls,{className:"w-5 h-5"})})]},y.id)),e.jsxs("div",{className:"mt-3 pt-3 border-t-2 border-orange-300 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700 font-bold",children:"Total Additional Costs:"}),e.jsxs("span",{className:"text-xl text-orange-700 font-bold",children:[P(d.additional_costs.reduce((y,T)=>y+T.amount,0))," TZS"]})]})]}):e.jsx("div",{className:"text-sm text-gray-600 bg-white rounded-xl p-5 border-2 border-dashed border-orange-300 text-center",children:'No additional costs. Click "Add Cost" for repair, cleaning, or refurbishment expenses.'})]})]}),e.jsxs("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:[!Z&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 border border-orange-200 rounded-lg flex items-center gap-2",children:[e.jsx(Zt,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"Please set a selling price before confirming."})]}),e.jsx("button",{type:"button",onClick:m,disabled:u||d.selling_price<=0,className:"w-full px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg",children:u?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):d.selling_price<=0?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(Zt,{className:"w-5 h-5"}),"Set Selling Price to Continue"]}):e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5"}),"Confirm & Add to Inventory"]})}),e.jsx("p",{className:"text-xs text-center text-gray-500 mt-3",children:"Device will be added to inventory with pricing information"})]})]})})},Go=({itemCount:t=8,columns:l=4,showSearchBar:c=!0,showCategories:o=!0})=>{const u={1:"grid-cols-1",2:"grid-cols-1 sm:grid-cols-2",3:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"};return e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("div",{className:"animate-pulse",children:[c&&e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 flex-1 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded"})]})}),o&&e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:[1,2,3,4,5,6].map(r=>e.jsx("div",{className:"h-8 w-24 bg-gray-200 rounded-full flex-shrink-0"},r))}),e.jsx("div",{className:`grid ${u[l]} gap-4`,children:Array.from({length:t}).map((r,d)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"h-40 bg-gradient-to-br from-gray-200 to-gray-300 rounded-lg mb-3"}),e.jsx("div",{className:"h-5 w-3/4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 w-1/2 bg-gray-200 rounded mb-3"}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{className:"h-6 w-20 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded"})]}),e.jsx("div",{className:"h-10 w-full bg-gradient-to-r from-gray-200 to-gray-300 rounded"})]},d))})]})})},hn=({isOpen:t,onClose:l,onContinue:c,closureTime:o,closedBy:u,userRole:r})=>{if(!t)return null;const d=g=>{if(!g)return"Unknown time";try{return new Date(g).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return"Unknown time"}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(rs,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Daily Sales Closed"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Post-closure sale warning"})]})]}),e.jsx("button",{onClick:l,className:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center transition-colors",children:e.jsx(Je,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ds,{className:"w-5 h-5 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-800 font-medium",children:"Daily sales have been closed"}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"This sale will be recorded for tomorrow's report and may require special handling."})]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Closed at:"}),e.jsx("span",{className:"font-medium text-gray-900",children:d(o)})]}),u&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Closed by:"}),e.jsx("span",{className:"font-medium text-gray-900",children:u})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:l,className:"flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel Sale"}),e.jsxs("button",{onClick:c,className:"flex-1 px-4 py-2.5 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(Yt,{className:"w-4 h-4"}),r==="admin"?"Override & Continue":"Continue Sale"]})]})]})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:r==="admin"?"Admin override: Post-closure sales will be logged with override reason":"Post-closure sales will be flagged in reports for review"})})]})})},pn=({isOpen:t,onClose:l,onOpenDay:c,currentUser:o,expectedPasscode:u="1234"})=>{const[r,d]=s.useState(""),[g,N]=s.useState(!1),[O,P]=s.useState(!1),w=async()=>{try{if(P(!0),r!==u){x.error("Invalid passcode"),d("");return}await c(),l()}catch(S){console.error("Error opening day:",S),x.error("Failed to open day")}finally{P(!1)}};s.useEffect(()=>{r.length===4&&!O&&w()},[r]);const p=S=>{r.length<4&&d(m=>m+S)},v=()=>{d(S=>S.slice(0,-1))},_=()=>{d("")};return t?ea.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:99999},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Yl,{className:"w-5 h-5 text-green-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Open New Day"})})]}),e.jsx("button",{onClick:l,className:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center transition-colors",children:e.jsx(Je,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter Passcode"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:g?"text":"password",value:r,onChange:S=>d(S.target.value),placeholder:"â€¢â€¢â€¢â€¢",className:"w-full px-6 py-4 pr-14 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-center text-3xl tracking-widest font-semibold",maxLength:4,readOnly:!0}),e.jsx("button",{type:"button",onClick:()=>N(!g),className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:g?e.jsx(Xl,{className:"w-6 h-6"}):e.jsx(Pn,{className:"w-6 h-6"})})]})]}),e.jsx("div",{children:e.jsx(Fl,{onKeyPress:p,onBackspace:v,onClear:_,disabled:O})})]})})})]})}),document.body):null},Ht={xs:0,sm:640,md:768,lg:1024,xl:1280,"2xl":1536},Ho=()=>{if(typeof window>"u")return!1;const t=navigator.userAgent||navigator.vendor||window.opera;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t.toLowerCase())},Qo=()=>{if(typeof window>"u")return!1;const t=navigator.userAgent||navigator.vendor||window.opera,l=/ipad|tablet|playbook|silk|kindle/i.test(t.toLowerCase()),c=window.innerWidth,o=c>=Ht.md&&c<Ht.lg;return l||o},Ko=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,Jo=t=>t>=Ht["2xl"]?"2xl":t>=Ht.xl?"xl":t>=Ht.lg?"lg":t>=Ht.md?"md":t>=Ht.sm?"sm":"xs",Yo=(t,l)=>l>t?"portrait":"landscape",Xo=()=>{const t=s.useCallback(()=>{if(typeof window>"u")return{isMobile:!1,isTablet:!1,isDesktop:!0,isTouchDevice:!1,screenWidth:1920,screenHeight:1080,orientation:"landscape",deviceType:"desktop",breakpoint:"2xl"};const o=window.innerWidth,u=window.innerHeight,r=Ko(),d=Ho(),g=Qo(),N=(o<Ht.md||d)&&!g,O=g||o>=Ht.md&&o<Ht.lg&&r,P=!N&&!O,w=N?"mobile":O?"tablet":"desktop";return{isMobile:N,isTablet:O,isDesktop:P,isTouchDevice:r,screenWidth:o,screenHeight:u,orientation:Yo(o,u),deviceType:w,breakpoint:Jo(o)}},[]),[l,c]=s.useState(t);return s.useEffect(()=>{let o;const u=()=>{clearTimeout(o),o=setTimeout(()=>{const g=t();c(N=>N.isMobile!==g.isMobile||N.isTablet!==g.isTablet||N.deviceType!==g.deviceType||N.breakpoint!==g.breakpoint||N.orientation!==g.orientation?g:N)},150)},r=()=>{setTimeout(()=>{const g=t();c(g)},100)};window.addEventListener("resize",u),window.addEventListener("orientationchange",r);const d=t();return c(d),()=>{clearTimeout(o),window.removeEventListener("resize",u),window.removeEventListener("orientationchange",r)}},[t]),l};const ei=({product:t,onAddToCart:l,onViewDetails:c,onView:o,onEdit:u,onDelete:r,variant:d="default",showStockInfo:g=!0,showCategory:N=!0,showActions:O=!1,isSelected:P=!1,onSelect:w,showCheckbox:p=!1,className:v="",primaryColor:_="blue",actionText:S="Add to Cart",allowOutOfStockSelection:m=!1,realTimeStockData:k,isVisible:A=!0,priority:Z=!1})=>{var ve,At,kt,tt,W,Be;const[se,y]=s.useState(!1),[T,q]=s.useState(new Map),j=k||T,[F,Y]=s.useState(!1),[M,re]=s.useState(null),n=co(),{showProductImages:$,showStockLevels:V,showPrices:ie,showBarcodes:ce}=n;ta();const[pe,ee]=s.useState(null),[X,be]=s.useState(!1);s.useState(!1);const[ke,We]=s.useState(!1);s.useState(1);const[we,ze]=s.useState(Z),[et,C]=s.useState(!1),[I,L]=s.useState(!1),K=s.useRef(null);Xt(),s.useEffect(()=>{y(!1)},[]),s.useEffect(()=>{if(!k&&t!=null&&t.id){const ne=setTimeout(()=>{U()},100);return()=>clearTimeout(ne)}},[t==null?void 0:t.id,k]);const fe=(()=>{switch(_){case"orange":return{hoverBorder:"hover:border-orange-300",textColor:"text-orange-600",iconColor:"text-orange-600",priceColor:"text-orange-900",errorColor:"text-orange-600"};case"green":return{hoverBorder:"hover:border-green-300",textColor:"text-green-600",iconColor:"text-green-600",priceColor:"text-green-900",errorColor:"text-green-600"};case"purple":return{hoverBorder:"hover:border-purple-300",textColor:"text-purple-600",iconColor:"text-purple-600",priceColor:"text-purple-900",errorColor:"text-purple-600"};default:return{hoverBorder:"hover:border-blue-300",textColor:"text-blue-600",iconColor:"text-blue-600",priceColor:"text-blue-900",errorColor:"text-blue-600"}}})();if(!t)return console.error("DynamicMobileProductCard: Product is null or undefined"),e.jsx("div",{className:"p-4 border border-red-200 bg-red-50 rounded-lg",children:e.jsx("p",{className:"text-red-600 text-sm",children:"Product data is missing"})});let Pe,G;try{Pe=mo(t),G=uo(t)}catch(ne){return console.error("Error getting product data:",ne),y(!0),e.jsxs("div",{className:"p-4 border border-red-200 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"text-red-600 text-sm",children:"Error loading product data"}),e.jsx("button",{onClick:()=>y(!1),className:"mt-2 text-blue-600 text-xs hover:underline",children:"Try again"})]})}const ge=()=>{if(!t.variants||t.variants.length===0)return e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200",children:"No Variants"});if(!Pe)return null;switch(G){case"out-of-stock":return e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-200",children:"Out of Stock"});case"low-stock":return e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200",children:"Low Stock"});default:return e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 border border-green-200",children:"In Stock"})}},ae=()=>{if(!t.variants||t.variants.length===0)return"No variants";const ne=t.variants.map(Ae=>Number(Ae.sellingPrice)||0).filter(Ae=>Ae>0).sort((Ae,Fe)=>Ae-Fe);return ne.length===0?"No price set":`$${ne[0].toFixed(2)}`},U=async()=>{if(!(!(t!=null&&t.id)||k))try{Y(!0);const Ae=await qa.getInstance().getStockLevels([t.id]),Fe=new Map;Object.entries(Ae).forEach(([jt,bt])=>{const Pt=bt.reduce((rt,lt)=>rt+lt.quantity,0);Fe.set(jt,Pt)}),q(Fe),re(new Date)}catch(ne){console.error("âŒ Error fetching real-time stock:",ne)}finally{Y(!1)}},J=()=>t!=null&&t.id&&j.get(t.id)||0,he=()=>{const ne=J();return ne>0||j.has(t.id)?ne:Ys(t)},Ce=async()=>{if(O&&o){o(t);return}if(!t.variants||t.variants.length===0){console.warn("âš ï¸ Cannot add product to cart: No variants available",t);return}if((!Pe||!m&&Pe.quantity<=0)&&!m)return;const ne=t.variants&&t.variants.length>1,Ae=t.variants&&t.variants.length===1;if(ne){We(!0);return}if(Ae){const Fe=t.variants[0],jt=Fe.is_parent||Fe.variant_type==="parent";let bt=!1;try{const{supabase:Pt}=await dt(()=>import("./index-61458a34.js").then(Ut=>Ut.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{count:rt}=await Pt.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("parent_variant_id",Fe.id).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0),{count:lt}=await Pt.from("inventory_items").select("id",{count:"exact",head:!0}).eq("product_id",t.id).eq("variant_id",Fe.id).not("serial_number","is",null).eq("status","available");bt=(rt||0)+(lt||0)>0,console.log(`ðŸ” Mobile: Checking variant ${Fe.id} for children: ${bt?`HAS ${(rt||0)+(lt||0)} CHILDREN`:"NO CHILDREN"} (IMEI: ${rt||0}, Legacy: ${lt||0})`)}catch(Pt){if(console.error("Error checking for children:",Pt),jt){console.log("âš ï¸ Mobile: Error checking children, but variant is marked as parent - opening modal"),We(!0);return}}if(bt){console.log("âœ… Mobile: Opening variant modal - variant has children"),We(!0);return}else jt&&console.log("â„¹ï¸ Mobile: Variant marked as parent but has no children - treating as regular variant")}if(c){c(t);return}l&&l(t,Pe,1)},ye=(ne,Ae,Fe)=>{if(c){ee(Ae),c(ne,Ae);return}l&&l(ne,Ae,Fe)};xo(t);const He=(()=>!t.images||t.images.length===0?[]:t.images.map((Ae,Fe)=>({id:`temp-${t.id}-${Fe}`,url:Ae,thumbnailUrl:Ae,fileName:`product-image-${Fe+1}`,fileSize:0,isPrimary:Fe===0,uploadedAt:new Date().toISOString()})))();if(s.useEffect(()=>{if(Z||we)return;const ne=new IntersectionObserver(Ae=>{Ae.forEach(Fe=>{Fe.isIntersecting&&(ze(!0),ne.disconnect())})},{rootMargin:"50px",threshold:.1});return K.current&&ne.observe(K.current),()=>ne.disconnect()},[Z,we]),s.useEffect(()=>{if(!we)return;const ne=setTimeout(()=>{C(!0)},100),Ae=setTimeout(()=>{L(!0)},200);return()=>{clearTimeout(ne),clearTimeout(Ae)}},[we]),d==="compact"){const ne=!t.variants||t.variants.length===0,Ae=ne||!Pe||!m&&Pe.quantity<=0;return e.jsx(e.Fragment,{children:e.jsx("div",{className:`bg-white border border-gray-200 rounded-lg p-4 transition-all duration-200 ${v} ${Ae?"opacity-50 cursor-not-allowed":`cursor-pointer ${fe.hoverBorder} hover:shadow-md active:scale-95`} ${ne?"border-gray-300 bg-gray-50":""}`,onClick:Ce,style:{minHeight:"60px"},title:ne?"This product has no variants and cannot be added to cart. Please add variants in the inventory management.":`Click to ${S.toLowerCase()}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-shrink-0 cursor-pointer hover:opacity-90 transition-opacity",onClick:Fe=>{Fe.stopPropagation()},children:e.jsx(rn,{images:He.map(Fe=>Fe.url),productName:t.name,size:"sm",className:"w-10 h-10"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:`font-medium truncate text-base ${ne?"text-gray-500":"text-gray-900"}`,title:t.name,children:t.name}),ge()]}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:(Pe==null?void 0:Pe.sku)||"N/A"}),N&&(t.categoryName||((ve=t.category)==null?void 0:ve.name))&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-purple-50 text-purple-700 border border-purple-200 font-medium",children:["ðŸ“¦ ",t.categoryName||((At=t.category)==null?void 0:At.name)]})})]}),e.jsxs("div",{className:"text-right",children:[ie&&e.jsx("div",{className:`font-semibold text-base ${ne?"text-gray-500":fe.priceColor}`,title:ae(),children:ae()}),V&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Stock: ",he()]})]})]})})})}const Ue=!t.variants||t.variants.length===0,Ge=Ue||!Pe||!m&&Pe.quantity<=0,Qe=(Pe==null?void 0:Pe.costPrice)||0,D=(Pe==null?void 0:Pe.sellingPrice)||0,te=D>0?((D-Qe)/D*100).toFixed(1):"0";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`pos-product-card relative bg-white border-2 rounded-xl transition-all duration-300 overflow-hidden ${v} ${Ge?"opacity-50 cursor-not-allowed":`cursor-pointer ${fe.hoverBorder} hover:shadow-lg active:scale-98`} ${Ue?"border-gray-300 bg-gray-50":"border-gray-200"} ${P?"ring-4 ring-blue-400 border-blue-500":""}`,onClick:ne=>{ne.target.closest(".action-button")||(p&&w?w(t.id):Ce())},title:Ue?"This product has no variants and cannot be added to cart. Please add variants in the inventory management.":O?"Click to view details":`Click to ${S.toLowerCase()}`,children:[p&&e.jsx("div",{className:"absolute top-3 left-3 z-30 action-button",onClick:ne=>ne.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:P,onChange:ne=>{ne.stopPropagation(),w&&w(t.id)},className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2 cursor-pointer"})}),V&&g&&he()>0&&e.jsxs("div",{className:`absolute top-2 right-2 p-2 rounded-full border-2 border-white shadow-lg flex items-center justify-center z-20 w-10 h-10 ${he()<=5?"bg-gradient-to-r from-red-500 to-red-600":he()<=10?"bg-gradient-to-r from-orange-500 to-orange-600":"bg-gradient-to-r from-green-500 to-emerald-500"}`,children:[e.jsx("span",{className:"text-sm font-bold text-white",children:F?"...":he()>=1e3?`${(he()/1e3).toFixed(1)}K`:he()}),F&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),e.jsxs("div",{className:"p-6 cursor-pointer flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[$&&e.jsxs("div",{className:`relative w-20 h-20 rounded-xl flex items-center justify-center text-lg font-bold ${fe.iconColor} cursor-pointer hover:opacity-90 transition-opacity`,onClick:ne=>{ne.stopPropagation(),be(!0)},children:[e.jsx(rn,{images:He.map(ne=>ne.url),productName:t.name,size:"lg",className:"w-full h-full rounded-xl"}),t.variants&&t.variants.length>1&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:t.variants.length})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-800 truncate text-xl leading-tight",title:t.name,children:t.name}),e.jsxs("div",{className:"text-2xl text-gray-700 mt-1 font-bold",children:["TSh ",ae().replace("$","").replace(".00","").replace(".0","")]})]})]})}),O?e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-3",children:[ie&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Cost"}),e.jsx("span",{className:"text-gray-900 font-semibold",children:Ze.currency(Qe)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Selling"}),e.jsx("span",{className:"text-green-700 font-semibold",children:Ze.currency(D)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Margin"}),e.jsxs("span",{className:`font-semibold ${parseFloat(te)<10?"text-red-600":parseFloat(te)<30?"text-orange-600":"text-green-600"}`,children:[te,"%"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(t.shelfCode||t.shelfName||t.storeLocationName||t.storageRoomName)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-blue-50 text-blue-700 border border-blue-200 text-xs",children:["ðŸ“ ",t.shelfCode||t.shelfName||t.storeLocationName||t.storageRoomName]}),N&&(t.categoryName||((kt=t.category)==null?void 0:kt.name))&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium",children:["ðŸ“¦ ",t.categoryName||((tt=t.category)==null?void 0:tt.name)]}),t.supplierName&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-green-50 text-green-700 border border-green-200 text-xs",children:["ðŸ¢ ",t.supplierName]}),t.isFeatured&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-yellow-50 text-yellow-700 border border-yellow-200 text-xs font-medium",children:"â­ Featured"})]}),t.variants&&t.variants.length>1&&e.jsx("div",{className:"flex items-center justify-between text-xs bg-gradient-to-r from-indigo-50 to-purple-50 px-3 py-2 rounded-lg",children:e.jsxs("span",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-indigo-700",children:t.variants.length})," variants available"]})})]}):e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-4",children:(t.shelfCode||t.shelfName||t.storeLocationName||t.storageRoomName)&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-blue-50 text-blue-700 border border-blue-200 text-xs",children:["ðŸ“¦ ",t.shelfCode||t.shelfName||t.storeLocationName||t.storageRoomName||"Shelf Info"]})})}),e.jsx("div",{className:"flex items-center gap-2",children:N&&(t.categoryName||((W=t.category)==null?void 0:W.name))&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium",children:["ðŸ“¦ ",t.categoryName||((Be=t.category)==null?void 0:Be.name)]})})]})}),e.jsx("div",{className:"flex-1"}),O?e.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-200 space-y-2 action-button",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o&&e.jsxs("button",{onClick:ne=>{ne.stopPropagation(),o(t)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(Pn,{className:"w-3.5 h-3.5"}),"View"]}),u&&e.jsxs("button",{onClick:ne=>{ne.stopPropagation(),u(t)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-green-50 text-green-700 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[e.jsx(Fa,{className:"w-3.5 h-3.5"}),"Edit"]}),r&&e.jsxs("button",{onClick:ne=>{ne.stopPropagation(),r(t)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 rounded-lg transition-colors",children:[e.jsx(ls,{className:"w-3.5 h-3.5"}),"Delete"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs px-2",children:[e.jsx("span",{className:"text-gray-500",children:"Status:"}),e.jsx("span",{className:`font-medium ${t.isActive?"text-green-600":"text-gray-400"}`,children:t.isActive?"â— Active":"â—‹ Inactive"})]})]}):Ge?null:e.jsx("div",{className:"mt-auto pt-3 border-t border-gray-100",children:e.jsxs("div",{className:`text-center text-sm font-medium ${fe.textColor} opacity-70 hover:opacity-100 transition-opacity`,children:["Click to ",S]})})]})]}),ke&&e.jsx(Cn,{isOpen:ke,onClose:()=>We(!1),product:t,onSelectVariant:ye})]})},ti=({children:t,delay:l=100,isVisible:c=!0,priority:o=!1,className:u="",fallback:r})=>{const[d,g]=s.useState(o),[N,O]=s.useState(o),P=s.useRef(null);s.useEffect(()=>{if(o||d)return;const p=new IntersectionObserver(v=>{v.forEach(_=>{_.isIntersecting&&(g(!0),p.disconnect())})},{rootMargin:"20px",threshold:.1});return P.current&&p.observe(P.current),()=>p.disconnect()},[o,d]),s.useEffect(()=>{if(!d)return;const p=setTimeout(()=>{O(!0)},l);return()=>clearTimeout(p)},[d,l]);const w=e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(ss,{size:14,className:"animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading..."})]});return e.jsx("div",{ref:P,className:`transition-all duration-300 ${N?"opacity-100":"opacity-0"} ${u}`,children:N?t:r||w})},Xe={productCard:{imageHeight:{mobile:"h-36",tablet:"sm:h-40",desktop:"lg:h-44",hd:"xl:h-48",compact:"h-32"},padding:{mobile:"p-3",tablet:"sm:p-3",desktop:"lg:p-4",hd:"xl:p-4",compact:"p-2"},textSize:{title:{mobile:"text-xs",tablet:"sm:text-sm",desktop:"lg:text-sm",hd:"xl:text-base",compact:"text-xs"},price:{mobile:"text-xs",tablet:"sm:text-sm",desktop:"lg:text-sm",hd:"xl:text-base",compact:"text-xs"},button:{mobile:"text-xs",tablet:"sm:text-xs",desktop:"lg:text-xs",hd:"xl:text-sm",compact:"text-xs"},sku:{mobile:"text-xs",tablet:"sm:text-xs",desktop:"lg:text-xs",hd:"xl:text-xs",compact:"text-xs"}}},gridLayout:{mobile:"grid-cols-1",smallMobile:"grid-cols-2",tablet:"sm:grid-cols-2 md:grid-cols-3",desktop:"lg:grid-cols-4 xl:grid-cols-4",hd:"xl:grid-cols-4 2xl:grid-cols-4",ultraHd:"2xl:grid-cols-4 3xl:grid-cols-5",adaptive:{xs:"grid-cols-1",sm:"grid-cols-2",md:"grid-cols-3",lg:"grid-cols-4",xl:"grid-cols-4","2xl":"grid-cols-4","3xl":"grid-cols-5","4xl":"grid-cols-5"}},spacing:{gap:{mobile:"gap-2",tablet:"sm:gap-3",desktop:"lg:gap-4",hd:"xl:gap-4",compact:"gap-2"},padding:{mobile:"p-3",tablet:"sm:p-4",desktop:"lg:p-4",hd:"xl:p-5",compact:"p-2"}},buttonSizes:{mobile:"py-2 px-3",tablet:"sm:py-2 sm:px-3",desktop:"lg:py-2 lg:px-4",hd:"xl:py-3 xl:px-4",compact:"py-1 px-2"},searchBar:{mobile:"py-2 px-3",tablet:"sm:py-3 sm:px-4",desktop:"lg:py-3 lg:px-4",hd:"xl:py-3 xl:px-4",compact:"py-2 px-3"}},si=(t={})=>{const{containerRef:l,minCardWidth:c=200,maxColumns:o=8,gap:u=16,containerPadding:r=32}=t,[d,g]=s.useState({minCardWidth:c,maxColumns:o,gap:u,containerPadding:r}),[N,O]=s.useState(1),[P,w]=s.useState(0),p=s.useCallback(m=>{const k=m-r,A=c+u,Z=Math.floor(k/A);return Math.max(1,Math.min(Z,o))},[c,o,u,r]),v=s.useCallback(()=>{if(l!=null&&l.current){const m=l.current.offsetWidth;w(m);const k=p(m);O(k)}else{const m=window.innerWidth;w(m);const k=p(m);O(k)}},[l,p]);s.useEffect(()=>{v();let m=null;return l!=null&&l.current&&window.ResizeObserver?(m=new ResizeObserver(()=>{v()}),m.observe(l.current)):window.addEventListener("resize",v),()=>{m?m.disconnect():window.removeEventListener("resize",v)}},[v]);const _=s.useCallback(()=>{const m="grid";return N<=1?`${m} grid-cols-1`:N<=2?`${m} grid-cols-1 sm:grid-cols-2`:N<=3?`${m} grid-cols-1 sm:grid-cols-2 md:grid-cols-3`:N<=4?`${m} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4`:N<=5?`${m} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5`:N<=6?`${m} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6`:N<=7?`${m} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 3xl:grid-cols-7`:`${m} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 3xl:grid-cols-7 4xl:grid-cols-8`},[N]),S=s.useCallback(()=>{if(P===0)return c;const m=P-r,k=(N-1)*u,A=(m-k)/N;return Math.max(c,A)},[P,N,u,r,c]);return{columns:N,containerWidth:P,gridConfig:d,getGridClasses:_,getOptimalCardWidth:S,updateGrid:v}},ai=({products:t,onAddToCart:l,isLoading:c,batchSize:o=10,enableVirtualization:u=!0,enableDynamicGrid:r=!0,minCardWidth:d=200,maxColumns:g=3})=>{const[N,O]=s.useState(o),[P,w]=s.useState(new Map),[p,v]=s.useState(!1),_=s.useRef(null);s.useEffect(()=>{(async()=>{if(!(!t||t.length===0))try{v(!0);const j=t.map(re=>re.id),Y=await qa.getInstance().getStockLevels(j),M=new Map;Object.entries(Y).forEach(([re,n])=>{const $=n.reduce((V,ie)=>V+ie.quantity,0);M.set(re,$)}),w(M)}catch(j){console.error("âŒ [DynamicMobileProductGrid] Error fetching batch stock:",j)}finally{v(!1)}})()},[t]);const{columns:S,containerWidth:m,getGridClasses:k,getOptimalCardWidth:A}=si({containerRef:_,minCardWidth:d,maxColumns:g,gap:12,containerPadding:16}),Z=t,se=s.useMemo(()=>u?Z.slice(0,N):Z,[Z,N,u]),y=s.useCallback(()=>{O(q=>Math.min(q+o,Z.length))},[o,Z.length]);qt.useEffect(()=>{O(o)},[t,o]);const T=N<Z.length;return e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:`flex-1 overflow-y-auto ${Xe.spacing.padding.mobile} ${Xe.spacing.padding.tablet} ${Xe.spacing.padding.desktop} ${Xe.spacing.padding.hd}`,children:c?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):Z.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ut,{size:48,className:"mx-auto text-gray-300 mb-4"}),e.jsxs(ti,{priority:!0,children:[e.jsx("p",{className:"text-gray-500 font-medium",children:"No products found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Try adjusting your search or filters"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:_,className:r?`${k()} ${Xe.spacing.gap.mobile} ${Xe.spacing.gap.tablet} ${Xe.spacing.gap.desktop} ${Xe.spacing.gap.hd}`:`grid ${Xe.gridLayout.mobile} ${Xe.gridLayout.tablet} ${Xe.gridLayout.desktop} ${Xe.gridLayout.hd} ${Xe.gridLayout.ultraHd} ${Xe.spacing.gap.mobile} ${Xe.spacing.gap.tablet} ${Xe.spacing.gap.desktop} ${Xe.spacing.gap.hd}`,children:se.map((q,j)=>e.jsx(ei,{product:q,onAddToCart:l,priority:j<4,realTimeStockData:P},q.id))}),T&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("button",{onClick:y,className:`${Xe.buttonSizes.mobile} ${Xe.buttonSizes.tablet} ${Xe.buttonSizes.desktop} ${Xe.buttonSizes.hd} bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition-colors text-xs`,children:["Load More (",Z.length-N," remaining)"]})})]})})})},ri=({isOpen:t,onClose:l,customerId:c,customerName:o,customerPhone:u})=>{const{playClickSound:r}=Xt(),{currentBranchId:d}=Rs(),[g,N]=s.useState("overview"),[O,P]=s.useState(!0),[w,p]=s.useState(null);s.useEffect(()=>{let m=!0;return t&&c&&v(m),()=>{m=!1}},[t,c]);const v=async(m=!0)=>{P(!0);try{const{data:k,error:A}=await Te.from("lats_customers").select("*").eq("id",c).single();if(!m)return;if(A)throw console.error("âŒ Customer error:",A),A;if(!k)throw console.error("âŒ Customer not found"),new Error("Customer not found");const{data:Z,error:se}=await Te.from("lats_sales").select("id, sale_number, total_amount, subtotal, created_at, status").eq("customer_id",c).eq("branch_id",d).order("created_at",{ascending:!1}).limit(10);se&&console.error("Sales query error:",se);const y=Z||[],T=y.reduce((n,$)=>{const V=typeof $.total_amount=="number"?$.total_amount:parseFloat($.total_amount)||0;return n+V},0),q=y.length,j=q>0?T/q:0,F=y.length>0?y[0].created_at:null;let Y=[];if(y.length>0)try{const n=y.map(V=>V.id),{data:$}=await Te.from("lats_sale_items").select("product_id, quantity").in("sale_id",n);if($&&$.length>0){const V=[...new Set($.map(pe=>pe.product_id))],{data:ie}=await Te.from("lats_products").select("id, name").in("id",V),ce={};$.forEach(pe=>{const ee=ie==null?void 0:ie.find(be=>be.id===pe.product_id),X=(ee==null?void 0:ee.name)||"Unknown Product";ce[X]=(ce[X]||0)+pe.quantity}),Y=Object.entries(ce).sort(([,pe],[,ee])=>ee-pe).slice(0,3).map(([pe])=>pe)}}catch(n){console.error("Error fetching favorite products:",n)}const M=(k==null?void 0:k.loyalty_points)||0;let re="interested";M>=1e3?re="vip":M>=700?re="premium":M>=400?re="regular":M>=200?re="active":M>=100?re="payment_customer":M>=50&&(re="engaged"),p({id:k.id,name:k.name,phone:k.phone,email:k.email,location:k.location||k.city||"N/A",joinDate:k.created_at,status:k.status||"active",loyaltyTier:re,points:M,totalSpent:T,totalPurchases:q,avgOrderValue:j,lastPurchase:F,favoriteProducts:Y,purchases:y.map(n=>({id:n.id,saleNumber:n.sale_number,date:n.created_at,amount:n.total_amount,items:0,status:n.status}))})}catch(k){const A=k instanceof Error?k.message:"Unknown error",Z=A.includes("not found")||A.includes("Customer not found");console.error("âŒ Error fetching customer data:",k),m&&!Z&&x.error("Failed to load customer data")}finally{m&&P(!1)}},_=m=>{switch(m.toLowerCase()){case"vip":return{bg:"bg-purple-500",text:"text-purple-600",icon:"ðŸ‘‘"};case"premium":return{bg:"bg-yellow-500",text:"text-yellow-600",icon:"ðŸ†"};case"regular":return{bg:"bg-blue-500",text:"text-blue-600",icon:"â­"};case"active":return{bg:"bg-green-500",text:"text-green-600",icon:"âœ“"};case"payment_customer":return{bg:"bg-teal-500",text:"text-teal-600",icon:"ðŸ’³"};case"engaged":return{bg:"bg-indigo-500",text:"text-indigo-600",icon:"ðŸ“Š"};case"interested":return{bg:"bg-gray-500",text:"text-gray-600",icon:"ðŸ‘€"};default:return{bg:"bg-gray-500",text:"text-gray-600",icon:"ðŸ‘¤"}}};if(!t)return null;if(O)return e.jsx("div",{className:"fixed inset-0 z-50 bg-white overflow-y-auto",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ss,{className:"w-12 h-12 text-blue-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading customer details..."})]})})});if(!w)return e.jsx("div",{className:"fixed inset-0 z-50 bg-white overflow-y-auto",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(xt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium mb-4",children:"Customer not found"}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Go Back"})]})})});const S=_(w.loyaltyTier);return e.jsxs("div",{className:"fixed inset-0 z-50 bg-white overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>{r(),l()},className:"flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(Je,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Back"})]}),e.jsxs("button",{onClick:()=>{r(),x.success("Edit mode coming soon!")},className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(Fa,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Edit"})]})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customer Details"})]})}),e.jsxs("div",{className:"p-3 space-y-3 pb-20",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-14 h-14 ${S.bg} rounded-lg flex items-center justify-center text-white font-bold text-xl`,children:w.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:w.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"âœ“ Active"}),e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${S.text==="text-yellow-600"?"bg-yellow-100 text-yellow-800":S.text==="text-purple-600"?"bg-purple-100 text-purple-800":"bg-orange-100 text-orange-800"}`,children:[S.icon," ",w.loyaltyTier.charAt(0).toUpperCase()+w.loyaltyTier.slice(1)]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx(Jt,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Phone"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:w.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx(za,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Email"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:w.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx(Ra,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:w.location})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx(Rt,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Member Since"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Date(w.joinDate).toLocaleDateString()})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ks,{className:"w-4 h-4 text-blue-600"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Purchases"})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:w.totalPurchases}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"orders"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ft,{className:"w-4 h-4 text-green-600"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Total Spent"})]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["TZS ",(w.totalSpent/1e6).toFixed(1),"M"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"lifetime"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ss,{className:"w-4 h-4 text-purple-600"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Points"})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:w.points}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"available"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ns,{className:"w-4 h-4 text-orange-600"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Avg Order"})]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["TZS ",(w.avgOrderValue/1e3).toFixed(0),"K"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"per order"})]})]}),e.jsxs("div",{className:"flex rounded-full bg-gray-100 p-1 gap-1",children:[e.jsx("button",{onClick:()=>{r(),N("overview")},className:`flex-1 px-4 py-2 text-sm font-medium rounded-full transition-colors ${g==="overview"?"bg-blue-500 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Overview"}),e.jsx("button",{onClick:()=>{r(),N("purchases")},className:`flex-1 px-4 py-2 text-sm font-medium rounded-full transition-colors ${g==="purchases"?"bg-blue-500 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Purchases"}),e.jsx("button",{onClick:()=>{r(),N("loyalty")},className:`flex-1 px-4 py-2 text-sm font-medium rounded-full transition-colors ${g==="loyalty"?"bg-blue-500 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Loyalty"})]}),g==="overview"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ds,{className:"w-4 h-4 text-blue-600"}),"Recent Activity"]}),e.jsxs("div",{className:"space-y-2",children:[w.lastPurchase&&e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg",children:e.jsx(Ks,{className:"w-3 h-3 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Last Purchase"}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(w.lastPurchase).toLocaleDateString()})]})]}),e.jsxs("p",{className:"text-xs font-bold text-gray-900",children:["TZS ",w.purchases.length>0?(w.purchases[0].amount/1e3).toFixed(0):"0","K"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-100 rounded-lg",children:e.jsx(Ss,{className:"w-3 h-3 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Points Earned"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Last 30 days"})]})]}),e.jsx("p",{className:"text-xs font-bold text-gray-900",children:"+250 pts"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(sn,{className:"w-4 h-4 text-orange-600"}),"Favorite Products"]}),e.jsx("div",{className:"space-y-2",children:w.favoriteProducts.length>0?w.favoriteProducts.map((m,k)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-blue-600",children:k+1})}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:m})]},k)):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(sn,{className:"w-10 h-10 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No favorite products yet"})]})})]})]}),g==="purchases"&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ks,{className:"w-4 h-4 text-blue-600"}),"Purchase History"]}),e.jsx("div",{className:"space-y-2",children:w.purchases.length>0?w.purchases.map(m=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Order #",m.saleNumber||m.id]}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(m.date).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-900",children:["TZS ",(m.amount/1e3).toFixed(0),"K"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[m.items," items"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${m.status==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:m.status==="completed"?"âœ“ Completed":m.status}),e.jsx("button",{className:"text-xs text-blue-600 font-semibold hover:text-blue-700",children:"View Details"})]})]},m.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ks,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No purchases yet"})]})})]})}),g==="loyalty"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4 text-purple-600"}),"Points Balance"]}),e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("p",{className:"text-3xl font-black text-purple-600",children:w.points}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Available Points"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Progress to Next Tier"}),e.jsxs("span",{className:"text-xs font-semibold text-gray-900",children:[Math.min(w.points/5e3*100,100).toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-purple-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${Math.min(w.points/5e3*100,100)}%`}})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:5e3-w.points>0?`${5e3-w.points} points to Platinum tier`:"Platinum tier achieved!"})]}),e.jsxs("div",{className:"p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-900 mb-2",children:"Your Benefits:"}),e.jsxs("ul",{className:"space-y-1 text-xs text-yellow-800",children:[e.jsx("li",{children:"â€¢ 7% discount on all purchases"}),e.jsx("li",{children:"â€¢ Special birthday rewards"}),e.jsx("li",{children:"â€¢ Priority customer support"}),e.jsx("li",{children:"â€¢ Exclusive member offers"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Js,{className:"w-4 h-4 text-indigo-600"}),"Points History"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Purchase Reward"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Oct 15, 2024"})]}),e.jsx("p",{className:"text-sm font-bold text-green-600",children:"+45 pts"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Purchase Reward"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Oct 10, 2024"})]}),e.jsx("p",{className:"text-sm font-bold text-green-600",children:"+29 pts"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Birthday Bonus"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Sep 01, 2024"})]}),e.jsx("p",{className:"text-sm font-bold text-green-600",children:"+100 pts"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>{r(),x.success("SMS feature coming soon!")},className:"flex items-center gap-2 px-3 py-2.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:[e.jsx(Jt,{size:16}),e.jsx("span",{children:"Send SMS"})]}),e.jsxs("button",{onClick:()=>{r(),x.success("WhatsApp feature coming soon!")},className:"flex items-center gap-2 px-3 py-2.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm font-medium",children:[e.jsx(eo,{size:16}),e.jsx("span",{children:"WhatsApp"})]}),e.jsxs("button",{onClick:()=>{r(),x.success("Rewards feature coming soon!")},className:"flex items-center gap-2 px-3 py-2.5 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium",children:[e.jsx(kn,{size:16}),e.jsx("span",{children:"Give Reward"})]}),e.jsxs("button",{onClick:()=>{r(),x.success("Email feature coming soon!")},className:"flex items-center gap-2 px-3 py-2.5 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors text-sm font-medium",children:[e.jsx(to,{size:16}),e.jsx("span",{children:"Send Email"})]})]})]})]})},ni=({cartItems:t,selectedCustomer:l,searchQuery:c,onSearchChange:o,products:u,onAddToCart:r,onUpdateCartItemQuantity:d,onRemoveCartItem:g,onProcessPayment:N,onClearCart:O,onShowCustomerSearch:P,onAddCustomer:w,onRemoveCustomer:p,onScanBarcode:v,onViewReceipts:_,onToggleSettings:S,onViewSales:m,onShowDiscountModal:k,totalAmount:A,discountAmount:Z,taxAmount:se,finalAmount:y,isProcessingPayment:T,todaysSales:q,isTaxEnabled:j,taxRate:F,isQrCodeScannerEnabled:Y})=>{var kt,tt;const{currentUser:M}=Fs(),{currentBranch:re}=Rs(),n=re==null?void 0:re.id,[$,V]=s.useState("products"),[ie,ce]=s.useState(!1),[pe,ee]=s.useState("grid"),[X,be]=s.useState(!1),[ke,We]=s.useState(null),[we,ze]=s.useState(()=>{const W=localStorage.getItem("pos_view_mode");return W==="mobile"||W==="desktop"?W:"mobile"}),[et,C]=s.useState(null),I=[...t].reverse();s.useEffect(()=>{if(I.length>0){const W=I[0];C(W.id)}},[t.length]);const L=W=>{C(Be=>Be===W?null:W)},[K,de]=s.useState([]),[fe,Pe]=s.useState(!1),[G,ge]=s.useState(0),{playClickSound:ae,playCartAddSound:U,playPaymentSound:J,playDeleteSound:he}=Xt(),Ce=t.reduce((W,Be)=>W+(Be.quantity||0),0),ye=y;s.useEffect(()=>{(async()=>{if(n){Pe(!0);try{const{count:Be}=await Te.from("lats_customers").select("id",{count:"exact",head:!0}).eq("branch_id",n);ge(Be||0);const{data:ne,error:Ae}=await Te.from("lats_customers").select("id, name, phone, email, location, city, loyalty_points, created_at").eq("branch_id",n).order("created_at",{ascending:!1}).limit(8);if(Ae){console.error("Error loading customers:",Ae);return}if(ne&&ne.length>0){const Fe=await Promise.all(ne.map(async jt=>{const{data:bt}=await Te.from("lats_sales").select("total_amount").eq("customer_id",jt.id).eq("branch_id",n),Pt=(bt==null?void 0:bt.reduce((aa,Qt)=>{const zs=typeof Qt.total_amount=="number"?Qt.total_amount:parseFloat(Qt.total_amount)||0;return aa+zs},0))||0,rt=jt.loyalty_points||0;let lt="interested",Ut="gray";return rt>=1e3?(lt="vip",Ut="purple"):rt>=700?(lt="premium",Ut="yellow"):rt>=400?(lt="regular",Ut="blue"):rt>=200?(lt="active",Ut="green"):rt>=100?(lt="payment_customer",Ut="teal"):rt>=50&&(lt="engaged",Ut="indigo"),{...jt,totalSpent:Pt,loyaltyTier:lt,tierColor:Ut}}));de(Fe)}}catch(Be){console.error("Error loading recent customers:",Be)}finally{Pe(!1)}}})()},[n]),s.useEffect(()=>{t.length>0},[t.length]),s.useEffect(()=>{document.body.setAttribute("data-view-mode",we)},[we]);const qe=()=>{const W=we==="desktop"?"mobile":"desktop";ze(W),localStorage.setItem("pos_view_mode",W),ae(),x.success(`Switched to ${W} view`,{icon:W==="mobile"?"ðŸ“±":"ðŸ–¥ï¸",duration:2e3}),window.dispatchEvent(new Event("viewModeChanged")),window.dispatchEvent(new Event("resize"))},He=()=>e.jsx("div",{className:"sticky top-0 z-40 border-b border-gray-200 shadow-md",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)"}}),Ue=()=>e.jsx("div",{className:"fixed bottom-0 left-0 right-0 border-t-2 border-gray-300 z-[9999] pb-safe",style:{minHeight:"60px",boxShadow:"0 -2px 10px rgba(0,0,0,0.1)",background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex items-center justify-around py-1",children:[e.jsxs("button",{onClick:()=>{ae(),V("products"),ce(!1)},className:`flex flex-col items-center py-2 px-3 transition-colors duration-150 ${$==="products"?"text-blue-600":"text-gray-400"}`,children:[e.jsx(ut,{size:18,className:"mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:"Products"})]}),e.jsxs("button",{onClick:()=>{ae(),V("cart"),ce(!0)},className:`flex flex-col items-center py-2 px-3 transition-colors duration-150 relative ${$==="cart"?"text-green-600":"text-gray-400"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ns,{size:18,className:"mb-1"}),Ce>0&&e.jsx("span",{className:"absolute -top-1 -right-2 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold",children:Ce>9?"9+":Ce})]}),e.jsx("span",{className:"text-xs font-medium",children:"Cart"})]}),e.jsxs("button",{onClick:()=>{ae(),V("customers"),ce(!1)},className:`flex flex-col items-center py-2 px-3 transition-colors duration-150 ${$==="customers"?"text-purple-600":"text-gray-400"}`,children:[e.jsx(xt,{size:18,className:"mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:"Customers"})]}),e.jsxs("button",{onClick:()=>{ae(),V("more"),ce(!1)},className:`flex flex-col items-center py-2 px-3 transition-colors duration-150 ${$==="more"?"text-gray-600":"text-gray-400"}`,children:[e.jsx(_a,{size:18,className:"mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:"More"})]})]})}),Ge=s.useMemo(()=>{if(!c.trim())return u;const W=c.toLowerCase();return u.filter(Be=>{var ne,Ae,Fe,jt;return!!((ne=Be.name)!=null&&ne.toLowerCase().includes(W)||(Ae=Be.sku)!=null&&Ae.toLowerCase().includes(W)||(Fe=Be.categoryName)!=null&&Fe.toLowerCase().includes(W)||(jt=Be.variants)!=null&&jt.some(bt=>{var Pt,rt,lt;return((Pt=bt.name)==null?void 0:Pt.toLowerCase().includes(W))||((rt=bt.sku)==null?void 0:rt.toLowerCase().includes(W))||((lt=bt.barcode)==null?void 0:lt.toLowerCase().includes(W))}))})},[u,c]),Qe=t.reduce((W,Be)=>W+Be.quantity,0),D=W=>({purple:"bg-purple-500",yellow:"bg-yellow-500",gray:"bg-gray-500",orange:"bg-orange-500",blue:"bg-blue-500",green:"bg-green-500",pink:"bg-pink-500",cyan:"bg-cyan-500"})[W]||"bg-blue-500",te=W=>W>=1e6?`TZS ${(W/1e6).toFixed(1)}M`:W>=1e3?`TZS ${(W/1e3).toFixed(0)}K`:`TZS ${W.toLocaleString()}`,ve=W=>{const Be=W.name.charAt(0).toUpperCase(),ne=W.location||W.city||"N/A";return e.jsx("div",{onClick:()=>{ae(),We({id:W.id,name:W.name,phone:W.phone}),be(!0)},className:`relative bg-white border border-gray-200 rounded-lg cursor-pointer transition-all duration-200 hover:border-${W.tierColor}-500`,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:`w-10 h-10 ${D(W.tierColor)} rounded-lg flex items-center justify-center text-white font-bold text-sm`,children:Be}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 truncate text-sm",children:W.name}),e.jsx("p",{className:"text-xs text-blue-600 font-medium truncate",children:W.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-1 mb-2 justify-center",children:[e.jsx(Ss,{className:`w-3 h-3 text-${W.tierColor}-500 fill-current`}),e.jsx("span",{className:"text-xs text-gray-700 font-semibold capitalize",children:W.loyaltyTier})]}),ne!=="N/A"&&e.jsx("div",{className:"space-y-1 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{className:"text-gray-400",children:"ðŸ“"}),e.jsx("span",{className:"truncate",children:ne})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ss,{className:"w-3 h-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:[W.loyalty_points||0," pts"]})]}),e.jsx("div",{className:"text-xs font-bold text-gray-900",children:te(W.totalSpent)})]})]})},W.id)},At=()=>ie&&$==="cart"&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col",style:{background:"rgba(249, 250, 251, 0.95)",backdropFilter:"blur(10px)"},children:[e.jsx("div",{className:"bg-white border-b border-gray-200 flex-shrink-0 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between p-4 safe-area-pt",children:[e.jsx("button",{onClick:()=>{ae(),ce(!1),V("products")},className:"p-2 rounded-lg hover:bg-gray-100 transition-all active:scale-95",children:e.jsx(Je,{size:24,className:"text-gray-600"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(Ns,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Shopping Cart"}),e.jsxs("p",{className:"text-xs text-gray-600",children:[t.length," items in cart"]})]})]}),e.jsx("button",{onClick:()=>{if(t.length===0){x.error("Cart is already empty");return}he(),O(),x.success("Cart cleared")},className:"text-red-500 text-sm font-bold hover:bg-red-50 px-3 py-2 rounded-lg transition-all active:scale-95",disabled:t.length===0,children:"Clear"})]})}),e.jsx("div",{className:"bg-white border-b border-gray-200 p-4 flex-shrink-0",children:l?e.jsx("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${l.colorTag==="vip"||l.loyaltyLevel==="vip"||l.loyaltyLevel==="premium"?"border-amber-300 hover:border-amber-400 hover:shadow-md":"border-green-200 hover:border-green-300 hover:shadow-md"}`,children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg ${l.colorTag==="vip"||l.loyaltyLevel==="vip"||l.loyaltyLevel==="premium"?"bg-gradient-to-br from-amber-500 to-amber-600":"bg-gradient-to-br from-blue-500 to-blue-600"}`,children:l.name.charAt(0).toUpperCase()}),e.jsx("div",{className:`absolute -top-1 -right-1 w-6 h-6 rounded-full border-2 border-white flex items-center justify-center shadow-md ${l.colorTag==="vip"||l.loyaltyLevel==="vip"||l.loyaltyLevel==="premium"?"bg-amber-500":"bg-emerald-500"}`,children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 truncate",children:l.name}),l.colorTag==="vip"||l.loyaltyLevel==="vip"||l.loyaltyLevel==="premium"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-amber-500 text-white shadow-sm flex-shrink-0",children:[e.jsx(Xs,{className:"w-3 h-3"}),"VIP"]}):null]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(Jt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"truncate",children:l.phone})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-50 border border-blue-200 w-fit",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),e.jsxs("span",{className:"text-xs font-semibold text-blue-700",children:[l.points||0," points"]})]})]})]}),e.jsx("button",{type:"button",onClick:()=>{he(),p()},className:"flex-shrink-0 inline-flex items-center justify-center w-9 h-9 text-sm font-medium text-white bg-red-500 hover:bg-red-600 border border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200 shadow-lg",title:"Remove customer",children:e.jsx(ls,{className:"w-5 h-5"})})]})})}):e.jsx("div",{onClick:()=>{ae(),P()},className:"bg-gradient-to-br from-blue-50 via-blue-50 to-blue-50 rounded-xl border-2 border-dashed border-blue-300 shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer",children:e.jsx("div",{className:"p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 via-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white shadow-lg",children:e.jsx(zt,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Select Customer"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a customer to continue"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Click here to select"})]}),e.jsxs("button",{onClick:W=>{W.stopPropagation(),ae(),P()},className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md hover:shadow-lg",children:[e.jsx(Wt,{className:"w-5 h-5"}),e.jsx("span",{children:"Select Customer"})]})]})})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 mobile-scroll",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ns,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cart is empty"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add products to start a transaction"})]}):e.jsx("div",{className:"space-y-3 pb-32",children:I.map((W,Be)=>e.jsx(_n,{item:W,onQuantityChange:ne=>d(W.id,ne),onRemove:()=>g(W.id),variant:"compact",autoExpand:Be===0,isExpanded:et===W.id,onToggleExpand:L},W.id))})}),t.length>0&&e.jsx("div",{className:"border-t-2 border-gray-300 bg-white flex-shrink-0 pb-safe shadow-lg",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50 border-2 border-gray-200 rounded-xl p-4 space-y-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[e.jsx("span",{className:"text-base font-bold text-gray-900",children:"Quantity:"}),e.jsx("span",{className:"text-lg font-extrabold text-gray-900",children:Qe})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[e.jsxs("span",{className:"text-base font-bold text-gray-900",children:["Subtotal (",Qe," ",Qe===1?"item":"items","):"]}),e.jsxs("span",{className:"text-lg font-extrabold text-gray-900",children:["TZS ",A.toLocaleString()]})]}),e.jsx("div",{className:"space-y-2",children:Z>0?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-100 border-2 border-green-300 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-200 rounded-lg",children:e.jsx($s,{className:"w-5 h-5 text-green-700"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-extrabold text-green-900",children:"Discount Applied"}),e.jsxs("div",{className:"text-sm font-bold text-green-700",children:["-TZS ",Z.toLocaleString()]})]})]}),e.jsx("button",{onClick:()=>{he(),x.success("Discount removed")},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-100 rounded-lg transition-colors",title:"Remove Discount",children:e.jsx(no,{className:"w-5 h-5"})})]}):e.jsxs("button",{onClick:()=>{ae(),k()},className:"w-full flex items-center justify-center gap-2 p-4 border-3 border-dashed border-purple-300 rounded-xl text-purple-700 hover:border-purple-500 hover:text-purple-800 hover:bg-purple-100 transition-all duration-200 shadow-sm bg-purple-50",children:[e.jsx("div",{className:"p-1.5 bg-purple-200 rounded-lg",children:e.jsx($s,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-base font-extrabold",children:"Add Discount"})]})}),j&&e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[e.jsxs("span",{className:"text-base font-bold text-gray-900",children:["Tax (VAT ",F,"%):"]}),e.jsxs("span",{className:"text-lg font-extrabold text-gray-900",children:["TZS ",se.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 rounded-lg p-3 shadow-md",children:[e.jsx("span",{className:"text-xl font-extrabold text-gray-900",children:"Total:"}),e.jsxs("span",{className:"text-2xl font-black text-green-600",children:["TZS ",y.toLocaleString()]})]})]}),!l&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-amber-100 to-orange-100 border-3 border-amber-400 rounded-xl shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3 text-base text-amber-900",children:[e.jsx("div",{className:"w-3 h-3 bg-amber-600 rounded-full animate-pulse"}),e.jsx("span",{className:"font-extrabold",children:"Please select a customer to proceed"})]})}),e.jsx("button",{onClick:()=>{if(!l){x.error("Please select a customer first");return}J(),N()},disabled:t.length===0||!l||T,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 shadow-lg",title:l?t.length===0?"Add items to cart first":"Process payment":"Please select a customer first",children:T?"Processing...":"Process Payment"})]})})]});return e.jsxs("div",{className:"h-screen flex flex-col overflow-hidden",style:{background:"transparent"},children:[e.jsx(He,{}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[$==="products"&&!ie&&e.jsxs("div",{className:"h-full flex flex-col",style:{background:"transparent"},children:[e.jsx("div",{className:"border-b border-gray-200 shadow-sm flex-shrink-0",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-800 text-xl flex items-center gap-2",children:[e.jsx(ut,{className:"w-6 h-6 text-green-600"}),"Products"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-0.5",children:[Ge.length," ",Ge.length===1?"product":"products"," available"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:qe,className:`p-2 rounded-lg transition-all shadow-sm ${we==="mobile"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,title:we==="mobile"?"Switch to Desktop View":"Switch to Mobile View",children:we==="mobile"?e.jsx(Ls,{size:18}):e.jsx(Nn,{size:18})}),e.jsxs("div",{className:"flex gap-1 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{ae(),ee("grid")},className:`p-2 rounded-lg transition-all ${pe==="grid"?"bg-white shadow-sm text-blue-600":"text-gray-600"}`,title:"Grid View",children:e.jsx(so,{size:18})}),e.jsx("button",{onClick:()=>{ae(),ee("list")},className:`p-2 rounded-lg transition-all ${pe==="list"?"bg-white shadow-sm text-blue-600":"text-gray-600"}`,title:"List View",children:e.jsx(wn,{size:18})})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(zt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:c,onChange:W=>o(W.target.value),placeholder:"Search products by name, SKU...",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"}),c&&e.jsx("button",{onClick:()=>o(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Je,{size:18})})]}),Y&&e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsxs("button",{onClick:()=>{ae(),v()},className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white font-medium rounded-lg active:scale-95 transition-all shadow-sm",children:[e.jsx(ao,{size:16}),e.jsx("span",{className:"text-sm",children:"Scan Barcode"})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pb-20 mobile-scroll",children:Ge.length===0?e.jsx("div",{className:"flex items-center justify-center h-full p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(ut,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c?`No products match "${c}"`:"No products available in the database"}),c&&e.jsx("button",{onClick:()=>o(""),className:"px-4 py-2 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition-colors",children:"Clear Search"})]})}):e.jsx("div",{className:"p-3",children:e.jsx(ai,{products:Ge,onAddToCart:(W,Be,ne)=>{r(W,Be,ne),U(),x.success(`Added ${W.name} to cart`)},isLoading:!1,minCardWidth:200,maxColumns:3,enableDynamicGrid:!0})})})]}),$==="customers"&&e.jsxs("div",{className:"h-full overflow-y-auto pb-20",style:{background:"transparent"},children:[e.jsx("div",{className:"sticky top-0 z-10 px-4 py-4 shadow-sm",style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)"},children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-xl",children:"Customer Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your customer database"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{ae(),P()},className:"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"Search Customers",children:e.jsx(zt,{size:18})}),e.jsx("button",{onClick:()=>{ae(),w()},className:"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors",title:"Add New Customer",children:e.jsx(Wt,{size:18})})]})]})}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xt,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Customers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"1,247"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1,200 active"})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ss,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Points"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"128K"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"102 avg"})]})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-5 hover:bg-purple-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Xs,{className:"w-7 h-7 text-purple-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"VIP Members"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"45"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"3.6% of total"})]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-5 hover:bg-orange-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ns,{className:"w-7 h-7 text-orange-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"TSh 8.2M"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"from customers"})]})]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Search & Filter"}),e.jsx("div",{className:"backdrop-blur-xl rounded-xl border p-4 transition-all duration-300",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(zt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search customers by name, phone, or email...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm bg-white"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ro,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filter:"})]}),e.jsxs("div",{className:"flex flex-wrap rounded-full bg-gray-100 p-1 gap-1",children:[e.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors bg-blue-500 text-white",children:"All"}),e.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors text-gray-600 hover:text-gray-900",children:"Platinum"}),e.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors text-gray-600 hover:text-gray-900",children:"Gold"}),e.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors text-gray-600 hover:text-gray-900",children:"Silver"}),e.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors text-gray-600 hover:text-gray-900",children:"Bronze"})]})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide",children:"Customer List"}),e.jsxs("button",{onClick:()=>{ae(),P()},className:"text-blue-600 text-xs font-semibold hover:text-blue-700 flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-blue-50 transition-colors",children:[e.jsx("span",{children:"View All"}),e.jsx("span",{className:"bg-blue-100 px-1.5 py-0.5 rounded-full text-blue-700",children:G.toLocaleString()})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:fe?e.jsxs("div",{className:"col-span-2 text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading customers..."})]}):K.length>0?K.map(W=>ve(W)):e.jsxs("div",{className:"col-span-2 text-center py-8",children:[e.jsx(xt,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No customers found"}),e.jsx("button",{onClick:()=>{ae(),w()},className:"mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium",children:"Add First Customer"})]})}),e.jsxs("button",{onClick:()=>{ae(),P(),x.success("Opening customer search...",{icon:"ðŸ”",duration:2e3})},className:"w-full px-4 py-3 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center gap-2",children:[e.jsx(zt,{size:18}),e.jsxs("span",{children:["View All Customers (",G.toLocaleString(),")"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Loyalty Program"}),e.jsxs("div",{className:"backdrop-blur-xl rounded-xl border p-4 transition-all duration-300 hover:shadow-xl",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Membership Tiers"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-purple-900",children:"Platinum"}),e.jsx("span",{className:"text-sm font-medium text-purple-500",children:"10% OFF"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Points Range:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"1,000+"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Benefits:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Priority + Exclusive"})]})]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-yellow-900",children:"Gold"}),e.jsx("span",{className:"text-sm font-medium text-yellow-600",children:"7% OFF"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Points Range:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"500-999"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Benefits:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Special + Birthday"})]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Silver"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"5% OFF"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Points Range:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"200-499"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Benefits:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Regular + Perks"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Analytics & Insights"}),e.jsxs("div",{className:"backdrop-blur-xl rounded-xl border p-4 transition-all duration-300 hover:shadow-xl",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Performance Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Return Rate"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"68%"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Avg Rating"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"4.2â˜…"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"New This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"+156"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Active Today"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"89"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>{ae(),P()},className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(zt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Search"})]}),e.jsxs("button",{onClick:()=>{ae(),w()},className:"flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium bg-green-600 text-white hover:bg-green-700 transition-colors text-sm",children:[e.jsx(Wt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"New"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors text-sm",children:[e.jsx(sa,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Best Practices"}),e.jsxs("div",{className:"backdrop-blur-xl rounded-xl border p-5 transition-all duration-300 hover:shadow-xl",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Customer Management Tips"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Keep customer data updated regularly"})]})}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Use loyalty programs to increase retention"})]})}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Track purchase patterns for better service"})]})}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Send personalized messages to VIP customers"})]})})]})]})]})]})]}),$==="more"&&e.jsx("div",{className:"h-full overflow-y-auto p-4 pb-20",style:{background:"transparent"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold mb-3",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)",padding:"12px",borderRadius:"12px",color:"#111827"},children:"Quick Actions"}),e.jsxs("button",{onClick:()=>{ae(),m()},className:"w-full py-4 bg-blue-500 text-white font-semibold rounded-xl active:bg-blue-600 transition-colors flex items-center justify-center gap-2 shadow-sm",children:[e.jsx(an,{size:18}),"View Sales Reports"]}),e.jsxs("button",{onClick:()=>{ae(),_()},className:"w-full py-4 bg-green-500 text-white font-semibold rounded-xl active:bg-green-600 transition-colors flex items-center justify-center gap-2 shadow-sm",children:[e.jsx(an,{size:18}),"View Receipts"]}),(((kt=M==null?void 0:M.permissions)==null?void 0:kt.includes("all"))||((tt=M==null?void 0:M.permissions)==null?void 0:tt.includes("view_settings"))||(M==null?void 0:M.role)==="admin")&&e.jsxs("button",{onClick:()=>{ae(),S()},className:"w-full py-4 bg-gray-700 text-white font-semibold rounded-xl active:bg-gray-800 transition-colors flex items-center justify-center gap-2 shadow-sm",children:[e.jsx(_a,{size:18}),"POS Settings"]}),e.jsxs("div",{className:"mt-6 p-4 rounded-xl shadow-sm border border-gray-200",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)"},children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium",children:new Date().toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Time:"}),e.jsx("span",{className:"font-medium",children:new Date().toLocaleTimeString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cart Items:"}),e.jsx("span",{className:"font-medium",children:Ce})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cart Total:"}),e.jsxs("span",{className:"font-medium",children:["TSh ",ye.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-900 font-semibold",children:"Today's Sales:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["TSh ",q.toLocaleString()]})]})]})]})]})})]}),e.jsx(Ue,{}),e.jsx(At,{}),ke&&e.jsx(ri,{isOpen:X,onClose:()=>{be(!1),We(null)},customerId:ke.id,customerName:ke.name,customerPhone:ke.phone}),e.jsx("style",{children:`
        .pb-safe {
          padding-bottom: env(safe-area-inset-bottom);
        }
        .mobile-scroll {
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: contain;
        }
      `})]})},li=({invoiceNumber:t,invoiceDate:l,dueDate:c,customer:o,items:u,subtotal:r,tax:d=0,discount:g=0,total:N,notes:O,terms:P,onPrint:w,additionalCustomerInfo:p,paymentInfo:v})=>{const{businessInfo:_,loading:S,error:m}=So(),[k,A]=s.useState([]),[Z,se]=s.useState(!0);if(s.useEffect(()=>{(async()=>{try{const F=(await jn.getFinancePaymentMethods()).filter(Y=>Y.type==="bank"&&Y.is_active);A(F)}catch(j){console.warn("Failed to load payment accounts:",j)}finally{se(!1)}})()},[]),S)return e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("p",{className:"ml-3 text-gray-600",children:"Loading business information..."})]});m&&console.warn("Failed to load business info:",m);const y=k.find(q=>q.type==="bank")||k[0],T=q=>`${q.toLocaleString("en-TZ")}/=`;return e.jsxs("div",{className:"invoice-container mx-auto bg-white shadow-lg overflow-hidden",style:{fontFamily:"Arial, sans-serif",width:"1128px",minHeight:"1536px",maxWidth:"1128px"},children:[e.jsxs("div",{className:"flex",style:{minHeight:"1536px"},children:[e.jsx("div",{className:"text-white flex flex-col justify-between relative overflow-hidden",style:{width:"370px",paddingTop:"80px",paddingLeft:"45px",paddingRight:"35px",paddingBottom:"0",minHeight:"1536px",backgroundColor:"black"},children:e.jsxs("div",{className:"relative z-10 flex flex-col",style:{height:"100%",justifyContent:"space-between"},children:[e.jsxs("div",{style:{flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{style:{marginBottom:"32px"},children:[_.logo&&e.jsx("img",{src:_.logo,alt:_.name,className:"object-contain",style:{width:"100%",maxWidth:"180px",height:"auto",display:"block",marginBottom:"12px",marginLeft:"auto",marginRight:"auto"}}),e.jsx("h1",{className:"font-bold",style:{fontFamily:"Arial, sans-serif",fontWeight:700,fontSize:"16px",textAlign:"center",width:"100%"},children:_.name||"Your Business"})]}),e.jsxs("div",{style:{marginBottom:"28px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"12px",fontSize:"10px",textAlign:"left"},children:"INVOICE TO:"}),e.jsx("h2",{className:"text-4xl font-bold leading-tight",style:{marginBottom:"16px",fontSize:"28px",lineHeight:"1.2",textAlign:"left"},children:o.name.toUpperCase()}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("p",{className:"opacity-90 text-xs uppercase",style:{marginBottom:"4px",fontSize:"10px",letterSpacing:"1px",textAlign:"left"},children:"Date"}),e.jsx("p",{className:"font-semibold text-base",style:{fontSize:"16px",textAlign:"left"},children:new Date(l).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]}),c&&e.jsxs("div",{children:[e.jsx("p",{className:"opacity-90 text-xs uppercase",style:{marginBottom:"4px",fontSize:"10px",letterSpacing:"1px",textAlign:"left"},children:"Issue"}),e.jsx("p",{className:"font-semibold text-base",style:{fontSize:"16px",textAlign:"left"},children:new Date(c).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]})]})]}),o.address&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"8px",fontSize:"10px",textAlign:"left"},children:"Address"}),e.jsx("p",{className:"text-sm leading-relaxed",style:{fontSize:"13px",lineHeight:"1.5",textAlign:"left"},children:o.address})]}),o.phone&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"8px",fontSize:"10px",textAlign:"left"},children:"Phone"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:o.phone}),o.email&&e.jsx("p",{className:"text-sm",style:{fontSize:"13px",marginTop:"6px",textAlign:"left"},children:o.email})]}),p&&e.jsxs("div",{style:{marginBottom:"20px"},children:[p.companyName&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"4px",fontSize:"10px",textAlign:"left"},children:"Company"}),e.jsx("p",{className:"text-sm font-semibold",style:{fontSize:"13px",textAlign:"left"},children:p.companyName})]}),p.additionalNotes&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"4px",fontSize:"10px",textAlign:"left"},children:"Notes"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",lineHeight:"1.5",textAlign:"left"},children:p.additionalNotes})]})]}),(p==null?void 0:p.receiverName)&&e.jsxs("div",{style:{marginBottom:"20px",paddingTop:"12px",borderTop:"1px solid rgba(255, 255, 255, 0.2)"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"12px",fontSize:"10px",textAlign:"left"},children:"RECEIVER:"}),e.jsx("h3",{className:"text-xl font-bold",style:{marginBottom:"8px",fontSize:"20px",lineHeight:"1.2",textAlign:"left"},children:p.receiverName.toUpperCase()}),p.receiverAddress&&e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"1px",marginBottom:"4px",fontSize:"10px",textAlign:"left"},children:"Address"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",lineHeight:"1.5",textAlign:"left"},children:p.receiverAddress})]}),p.receiverPhone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"1px",marginBottom:"4px",fontSize:"10px",textAlign:"left"},children:"Phone"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:p.receiverPhone})]})]}),(_.address||_.phone||_.email||_.website)&&e.jsxs("div",{style:{marginBottom:"20px"},children:[_.address&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"4px",fontSize:"10px",textAlign:"left"},children:"Business Address"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",lineHeight:"1.4",textAlign:"left"},children:_.address})]}),_.phone&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"4px",fontSize:"10px",textAlign:"left"},children:"Business Phone"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:_.phone})]}),_.email&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"4px",fontSize:"10px",textAlign:"left"},children:"Business Email"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:_.email})]}),_.website&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"4px",fontSize:"10px",textAlign:"left"},children:"Website"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:_.website})]})]})]}),e.jsxs("div",{style:{flexShrink:0,paddingTop:"20px",marginTop:"auto"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"12px",fontSize:"10px",textAlign:"left"},children:"Payment Method"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[y!=null&&y.bank_name?e.jsxs("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:["Your Bank: ",y.bank_name]}):e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:"Your Bank: Sample Bank Name"}),y!=null&&y.account_number?e.jsxs("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:["Bank Account: ",y.account_number]}):e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:"Bank Account: 1234567890"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:"Swift Code: SWIFT123456"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:"Card Payment: Accepted"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:"Paypal: yourbusiness@email.com"}),e.jsx("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:"Master Card: Accepted"})]}),v&&e.jsxs("div",{style:{marginTop:"20px",paddingTop:"20px",borderTop:"1px solid rgba(255, 255, 255, 0.2)"},children:[e.jsx("p",{className:"text-xs uppercase opacity-90",style:{letterSpacing:"2px",marginBottom:"12px",fontSize:"10px",textAlign:"left"},children:"Payment Information"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[v.paymentMethod&&e.jsxs("p",{className:"text-sm font-semibold",style:{fontSize:"13px",textAlign:"left"},children:["Method: ",v.paymentMethod]}),v.paymentReference&&e.jsxs("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:["Reference: ",v.paymentReference]}),v.transactionId&&e.jsxs("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:["Transaction ID: ",v.transactionId]}),v.paidAmount!==void 0&&e.jsxs("p",{className:"text-sm font-semibold",style:{fontSize:"13px",textAlign:"left"},children:["Paid: ",T(v.paidAmount)]}),v.balance!==void 0&&e.jsxs("p",{className:"text-sm font-semibold",style:{fontSize:"13px",textAlign:"left"},children:["Balance: ",T(v.balance)]}),v.paymentDate&&e.jsxs("p",{className:"text-sm",style:{fontSize:"13px",textAlign:"left"},children:["Date: ",new Date(v.paymentDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]})]})]})]})}),e.jsxs("div",{className:"bg-white flex flex-col",style:{width:"758px",padding:"60px",minHeight:"1536px"},children:[e.jsxs("div",{style:{height:"180px",marginBottom:"0"},children:[e.jsx("h2",{className:"text-6xl font-bold text-black lowercase",style:{fontWeight:700,letterSpacing:"-2px",marginBottom:"16px",fontSize:"64px",lineHeight:"1"},children:"invoice."}),e.jsxs("p",{className:"text-gray-600",style:{fontSize:"13px",marginTop:"8px"},children:["Account No. ",e.jsx("span",{className:"font-semibold text-black",children:t.replace(/[^0-9]/g,"")||"987654321"})]})]}),e.jsx("div",{style:{marginTop:"40px",marginBottom:"32px"},children:e.jsxs("table",{className:"border-collapse",style:{borderSpacing:0,width:"650px",tableLayout:"fixed"},children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-600 text-white",style:{height:"55px"},children:[e.jsx("th",{className:"text-left font-semibold text-sm text-white",style:{padding:"16px 20px",fontSize:"13px",fontWeight:600,width:"420px"},children:"Description"}),e.jsx("th",{className:"text-center font-semibold text-sm text-white",style:{padding:"16px 20px",fontSize:"13px",fontWeight:600,width:"80px"},children:"Qty"}),e.jsx("th",{className:"text-right font-semibold text-sm text-white",style:{padding:"16px 20px",fontSize:"13px",fontWeight:600,width:"150px"},children:"Cost"})]})}),e.jsx("tbody",{children:u.map((q,j)=>{let F="";return q.specifications&&(typeof q.specifications=="string"?F=q.specifications:typeof q.specifications=="object"&&(F=Object.entries(q.specifications).filter(([Y])=>Y!=="_raw").map(([Y,M])=>`${Y}: ${M}`).join(", "),!F&&q.specifications._raw&&(F=q.specifications._raw))),e.jsxs("tr",{className:"border-b border-gray-200",style:{height:"115px"},children:[e.jsx("td",{className:"text-gray-900 text-sm",style:{padding:"20px",lineHeight:"1.6",fontSize:"13px",width:"420px",verticalAlign:"top"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,marginBottom:F?"4px":0},children:q.description}),F&&e.jsx("div",{style:{fontSize:"11px",color:"#6B7280",marginTop:"4px",lineHeight:"1.4"},children:F})]})}),e.jsx("td",{className:"text-center text-gray-900 text-sm",style:{padding:"20px",fontSize:"13px",width:"80px",verticalAlign:"top"},children:q.quantity}),e.jsx("td",{className:"text-right font-semibold text-gray-900 text-sm",style:{padding:"20px",fontSize:"13px",width:"150px",verticalAlign:"top"},children:T(q.total)})]},j)})})]})}),e.jsxs("div",{style:{marginBottom:"40px"},children:[e.jsxs("div",{className:"bg-gray-400 text-white flex justify-between items-center",style:{padding:"16px 24px",backgroundColor:"#9CA3AF"},children:[e.jsx("span",{className:"font-semibold",style:{fontSize:"13px"},children:"Sub Total"}),e.jsx("span",{className:"font-semibold",style:{fontSize:"13px"},children:T(r)})]}),e.jsxs("div",{className:"bg-gray-500 text-white flex justify-between items-center",style:{padding:"16px 24px",backgroundColor:"#6B7280"},children:[e.jsx("span",{className:"font-semibold",style:{fontSize:"15px"},children:"Total (Include Tax)"}),e.jsx("span",{className:"font-semibold",style:{fontSize:"18px"},children:T(N)})]})]}),e.jsxs("div",{style:{marginBottom:"40px"},children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-900 uppercase",style:{letterSpacing:"1px",marginBottom:"16px",fontSize:"11px"},children:"Term & Condition"}),e.jsxs("div",{className:"flex justify-between items-start",style:{gap:"60px"},children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-700",style:{lineHeight:"1.8",fontSize:"13px",color:"#374151"},children:P||O||"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam rutrum gravida turpis. Nunc dictum, leo non blandit pharetra, erat arcu viverra libero."})}),e.jsx("div",{className:"text-right",style:{minWidth:"150px",flexShrink:0},children:e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-900 font-semibold",style:{fontFamily:"cursive, serif",marginBottom:"4px",fontSize:"16px"},children:o.name}),e.jsx("div",{className:"text-gray-600",style:{fontSize:"11px"},children:"Manager"})]})})]})]}),e.jsx("div",{className:"mt-auto border-t border-gray-200",style:{height:"250px",paddingTop:"40px",marginTop:"auto",borderTop:"1px solid #E5E7EB",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("p",{className:"text-center text-gray-600 uppercase",style:{letterSpacing:"3px",fontSize:"11px",color:"#4B5563"},children:"Thank You For The Business"})}),w&&e.jsx("div",{className:"flex justify-center mt-6 no-print",children:e.jsx("button",{onClick:w,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow-lg",children:"Print Invoice"})})]})]}),e.jsx("style",{children:`
        @media print {
          .no-print {
            display: none;
          }
          body {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
          }
          @page {
            size: A4;
            margin: 0;
          }
          /* Scale to A4 for printing: 1128px â†’ 794px (210mm at 96dpi) */
          .invoice-container {
            transform: scale(0.704);
            transform-origin: top left;
            width: 1128px;
            height: 1536px;
          }
        }
        @media screen {
          .invoice-container {
            width: 1128px;
            min-height: 1536px;
            margin: 0 auto;
          }
        }
        @media (max-width: 1200px) {
          /* Responsive scaling for smaller screens */
          .invoice-container {
            transform: scale(0.9);
            transform-origin: top left;
          }
        }
        @media (max-width: 1024px) {
          .invoice-container {
            transform: scale(0.8);
            transform-origin: top left;
          }
        }
      `})]})},oi=qt.lazy(()=>dt(()=>import("./POSSettingsModal-d175c505.js"),["assets/POSSettingsModal-d175c505.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/useBodyScrollLock-341c8b9f.js","assets/GlassTabs-05c8a392.js","assets/utils-95f4031a.js","assets/charts-d592fbd1.js","assets/format-aff4c6a2.js","assets/formatPhoneForInvoice-e7084c6d.js","assets/useBusinessInfo-62d31733.js","assets/rbac-6ed8a520.js","assets/usePOSClickSounds-e5b9fd69.js","assets/VariantProductCard-04300406.js","assets/robustImageService-f15af7ef.js","assets/imeiVariantService-4ce4b8b1.js","assets/GlassBadge-9ae09fa8.js","assets/SafeImage-a3ef104e.js","assets/specificationUtils-0c00478d.js","assets/PriceInput-aa1a05e9.js","assets/CategoryInput-e47eba98.js","assets/AddCustomerModal-175a5a1a.js","assets/CustomerForm-3440546b.js","assets/phoneUtils-a8934478.js","assets/useSuccessModal-081786c4.js","assets/SuccessModalIcons-fe811e4d.js","assets/search-cbe15294.js","assets/customerCacheService-9b459c09.js","assets/LoadingSpinner-251d9268.js","assets/useDialog-6eb5c329.js","assets/CustomerDetailModal-ad4a2166.js","assets/appointments-0b344a33.js","assets/whatsappService-09f99080.js","assets/Modal-a5e4c1ba.js","assets/returns-8e3dd741.js","assets/AppointmentModal-91a07df7.js","assets/index-5a6a7dda.js","assets/pdf-e6e38bab.js","assets/GlassInput-0475021a.js","assets/saleProcessingService-f5a8fb75.js","assets/TradeInContractModal-15d48929.js","assets/toPropertyKey-7cc7522c.js","assets/tradeInApi-5d12dbe0.js","assets/ComprehensivePaymentModal-83b44bf0.js","assets/currencyUtils-59109a41.js","assets/InstallmentManagementModal-0b553ce1.js","assets/CustomerTooltip-6a958832.js","assets/PaymentsPopupModal-6fe61f19.js","assets/draftService-00fb159f.js","assets/ShareReceiptModal-8db20b0e.js","assets/html2canvas.esm-6bd083a4.js","assets/GlobalSearchShortcut-c0731781.js","assets/SearchResults-c1876f8f.js"])),ii=qt.lazy(()=>dt(()=>import("./POSDiscountModal-ab33b435.js"),["assets/POSDiscountModal-ab33b435.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/useBodyScrollLock-341c8b9f.js"])),ci=qt.lazy(()=>dt(()=>import("./POSReceiptModal-15224c63.js"),["assets/POSReceiptModal-15224c63.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/useBluetoothPrinter-0ea2abfe.js","assets/useBusinessInfo-62d31733.js","assets/useBodyScrollLock-341c8b9f.js","assets/format-aff4c6a2.js","assets/formatPhoneForInvoice-e7084c6d.js"])),Za=()=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-center text-gray-600",children:"Loading..."})]})}),Oa=s.forwardRef((t,l)=>e.jsx(s.Suspense,{fallback:e.jsx(Za,{}),children:e.jsx(oi,{...t,ref:l})}));Oa.displayName="POSSettingsModalWrapper";const fn=t=>e.jsx(s.Suspense,{fallback:e.jsx(Za,{}),children:e.jsx(ii,{...t})}),bn=t=>e.jsx(s.Suspense,{fallback:e.jsx(Za,{}),children:e.jsx(ci,{...t})}),di=({cartItems:t,customer:l,deliveryInfo:c,notes:o})=>{const[u,r]=s.useState(null),[d,g]=s.useState(!1);s.useEffect(()=>{if(t&&t.length>0){const m=setTimeout(()=>{try{const k=Gt.savePOSDraft(t,l,c,o);r(k),g(!1)}catch(k){console.error("Failed to auto-save draft:",k)}},2e3);return()=>clearTimeout(m)}},[t,l,c,o]),s.useEffect(()=>{const S=Gt.getLatestDraft();S&&(!t||t.length===0)&&r(S.id)},[t]);const N=s.useCallback(S=>{if(!t||t.length===0)return null;try{const m=Gt.savePOSDraft(t,l,c,S||o);return r(m),g(!1),m}catch(m){return console.error("Failed to save draft:",m),null}},[t,l,c,o]),O=s.useCallback(S=>(r(S.id),g(!1),S),[]),P=s.useCallback(()=>{if(u){const S=Gt.deleteDraft(u);return S&&(r(null),g(!1)),S}return!1},[u]),w=s.useCallback(()=>{const S=Gt.clearAllDrafts();return S&&(r(null),g(!1)),S},[]),p=s.useCallback(()=>Gt.getAllDrafts(),[]),v=s.useCallback(()=>Gt.hasDrafts(),[]),_=s.useCallback(()=>{g(!0)},[]);return{currentDraftId:u,hasUnsavedChanges:d,saveDraft:N,loadDraft:O,deleteCurrentDraft:P,clearAllDrafts:w,getAllDrafts:p,hasDrafts:v,markAsChanged:_}},yn=({isOpen:t,onClose:l,onLoadDraft:c,currentDraftId:o})=>{const{confirm:u}=Va(),[r,d]=s.useState([]),[g,N]=s.useState(!1),[O,P]=s.useState(null);s.useEffect(()=>{t&&w()},[t]);const w=()=>{N(!0);try{const A=Gt.getAllDrafts();d(A)}catch(A){console.error("Failed to load drafts:",A)}finally{N(!1)}},p=A=>{P(A)},v=()=>{O&&(c(O),l())},_=async A=>{await u("Are you sure you want to delete this draft?")&&Gt.deleteDraft(A)&&w()},S=A=>new Date(A).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=A=>A.reduce((Z,se)=>Z+(se.quantity||1),0),k=A=>A.reduce((Z,se)=>{var q,j;const y=se.unitPrice||((j=(q=se.variants)==null?void 0:q[0])==null?void 0:j.price)||0,T=se.quantity||1;return Z+y*T},0);return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx(ms,{className:"w-full max-w-4xl max-h-[90vh] overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ds,{className:"w-6 h-6 text-blue-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Saved Drafts"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Je,{className:"w-5 h-5"})})]}),g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ds,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No saved drafts found"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Your cart will be automatically saved as a draft when you close the page"})]}):e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:r.map(A=>e.jsx("div",{className:`p-4 border rounded-lg transition-all cursor-pointer ${(O==null?void 0:O.id)===A.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"} ${o===A.id?"ring-2 ring-green-500":""}`,onClick:()=>p(A),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ds,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:S(A.updatedAt)}),o===A.id&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"Current"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ut,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[m(A.cartItems)," items"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsxs("span",{className:"font-semibold",children:["KES ",k(A.cartItems).toLocaleString()]})]}),A.customer&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:A.customer.name})]})]}),A.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2 italic",children:['"',A.notes,'"']})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsx(mt,{size:"sm",variant:"outline",onClick:Z=>{Z.stopPropagation(),_(A.id)},className:"text-red-600 hover:text-red-700",children:e.jsx(ls,{className:"w-4 h-4"})})})]})},A.id))}),O&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Zt,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-blue-800",children:"Load this draft?"})]}),e.jsx("p",{className:"text-sm text-blue-700 mb-4",children:"This will replace your current cart with the selected draft."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(mt,{onClick:v,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(sa,{className:"w-4 h-4 mr-2"}),"Load Draft"]}),e.jsx(mt,{variant:"outline",onClick:()=>P(null),children:"Cancel"})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[r.length," draft",r.length!==1?"s":""," saved"]}),e.jsx("button",{onClick:async()=>{await u("Are you sure you want to delete all drafts?")&&(Gt.clearAllDrafts(),w())},className:"text-red-600 hover:text-red-700",children:"Clear All"})]})})]})})}):null},vn=({draftCount:t,onViewDrafts:l,onDismiss:c,isVisible:o})=>!o||t===0?null:e.jsx("div",{className:"fixed top-4 right-4 z-40 animate-in slide-in-from-right duration-300",children:e.jsx(ms,{className:"p-4 shadow-lg border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ds,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800",children:[t," saved draft",t!==1?"s":""," available"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You can continue from where you left off"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(mt,{size:"sm",onClick:l,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(sa,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsx("button",{onClick:c,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Je,{className:"w-4 h-4 text-gray-500"})})]})]})})}),mi=t=>{const[l,c]=s.useState(t.deliveryMethod||"standard"),[o,u]=s.useState(t.deliveryDistance||0),[r,d]=s.useState(0),g=s.useCallback((v,_)=>{var F;if(!(t!=null&&t.enable_delivery))return{baseFee:0,methodMultiplier:1,distanceFee:0,timeMultiplier:1,orderDiscount:1,finalFee:0,isFreeDelivery:!1,breakdown:{base:0,method:0,distance:0,time:0,discount:0}};if(v>=t.free_delivery_threshold)return{baseFee:t.default_delivery_fee,methodMultiplier:1,distanceFee:0,timeMultiplier:1,orderDiscount:1,finalFee:0,isFreeDelivery:!0,breakdown:{base:0,method:0,distance:0,time:0,discount:0}};let S=t.default_delivery_fee||2e3;t.enable_delivery_areas&&_&&((F=t.area_delivery_fees)!=null&&F[_])&&(S=t.area_delivery_fees[_]);let m=1,k=0,A=1,Z=1;switch(l){case"express":m=1.5;break;case"same-day":m=2;break;case"standard":default:m=1;break}o>0&&(k=Math.ceil(o/5)*500);const se=new Date().getHours();se>=17&&se<=19?A=1.2:(se>=22||se<=6)&&(A=1.3),v>=5e4?Z=.8:v>=25e3&&(Z=.9);const y=S*m,T=y*A,q=T+k,j=Math.round(q*Z);return{baseFee:S,methodMultiplier:m,distanceFee:k,timeMultiplier:A,orderDiscount:Z,finalFee:j,isFreeDelivery:!1,breakdown:{base:S,method:y-S,distance:k,time:T-y,discount:q-j}}},[t,l,o]),N=s.useCallback(v=>{c(v)},[]),O=s.useCallback(v=>{u(v)},[]),P=s.useCallback(v=>{switch(v){case"express":return{name:"Express Delivery",time:"1-2 business days",multiplier:1.5};case"same-day":return{name:"Same Day Delivery",time:"Same day",multiplier:2};case"standard":default:return{name:"Standard Delivery",time:"2-3 business days",multiplier:1}}},[]),w=s.useCallback(()=>{const v=new Date().getHours();return v>=17&&v<=19?{type:"rush_hour",name:"Rush Hour",multiplier:1.2,description:"5 PM - 7 PM"}:v>=22||v<=6?{type:"late_night",name:"Late Night",multiplier:1.3,description:"10 PM - 6 AM"}:{type:"normal",name:"Normal Hours",multiplier:1,description:"Regular pricing"}},[]),p=s.useCallback(v=>v>=5e4?{type:"large_order",name:"Large Order Discount",multiplier:.8,description:"Orders over 50K TZS"}:v>=25e3?{type:"medium_order",name:"Medium Order Discount",multiplier:.9,description:"Orders over 25K TZS"}:{type:"no_discount",name:"No Discount",multiplier:1,description:"Standard pricing"},[]);return{deliveryMethod:l,deliveryDistance:o,currentFee:r,calculateDeliveryFee:g,updateDeliveryMethod:N,updateDeliveryDistance:O,getDeliveryMethodInfo:P,getTimeBasedInfo:w,getOrderDiscountInfo:p}},Ca={enableDelivery:!1,enableLoyaltyProgram:!0,enableCustomerProfiles:!0,enablePaymentTracking:!0,enableDynamicPricing:!0},ui=()=>{const[t,l]=s.useState(Ca),[c,o]=s.useState(!0);return s.useEffect(()=>{(()=>{try{const p=localStorage.getItem("lats-pos-features");if(p){const v=JSON.parse(p);l({...Ca,...v})}}catch(p){console.error("Error loading POS features:",p)}finally{o(!1)}})();const w=p=>{if(p.key==="lats-pos-features"&&p.newValue)try{const v=JSON.parse(p.newValue);l({...Ca,...v})}catch(v){console.error("Error parsing updated features:",v)}};return window.addEventListener("storage",w),()=>{window.removeEventListener("storage",w)}},[]),{features:t,isLoading:c,updateFeatures:P=>{const w={...t,...P};l(w),localStorage.setItem("lats-pos-features",JSON.stringify(w))},isDeliveryEnabled:()=>t.enableDelivery,isLoyaltyEnabled:()=>t.enableLoyaltyProgram,isCustomerProfilesEnabled:()=>t.enableCustomerProfiles,isPaymentTrackingEnabled:()=>t.enablePaymentTracking,isDynamicPricingEnabled:()=>t.enableDynamicPricing}},xi=qt.lazy(()=>dt(()=>import("./TradeInCalculator-868648b1.js"),["assets/TradeInCalculator-868648b1.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/tradeInApi-5d12dbe0.js","assets/format-aff4c6a2.js"])),gi=300,hi=(t,l)=>{const[c,o]=s.useState(t);return s.useEffect(()=>{const u=setTimeout(()=>{o(t)},l);return()=>{clearTimeout(u)}},[t,l]),c},pi=()=>{var Ur,Br,Vr,Zr,Wr,Gr;const t=ta(),{playClickSound:l,playPaymentSound:c,playDeleteSound:o}=Xt(),{isMobile:u,isTablet:r,deviceType:d}=Xo(),[g,N]=s.useState(()=>{const a=localStorage.getItem("pos_view_mode");return a==="mobile"||a==="desktop"?a:"auto"});s.useEffect(()=>{const a=()=>{const b=localStorage.getItem("pos_view_mode");(b==="mobile"||b==="desktop")&&N(b)};window.addEventListener("storage",a);const i=()=>a();return window.addEventListener("viewModeChanged",i),()=>{window.removeEventListener("storage",a),window.removeEventListener("viewModeChanged",i)}},[]);const O=g==="auto"?u:g==="mobile",P=s.useRef(!1);s.useEffect(()=>{P.current},[u,r,d,g,O]);const[w,p]=s.useState(null),{sales:v}=Hs(),_=s.useMemo(()=>{if(w)return v.filter(Q=>Q.created_at&&Q.created_at>=w).reduce((Q,R)=>{const ue=typeof R.total_amount=="number"?R.total_amount:parseFloat(R.total_amount)||0;return Q+ue},0);const a=new Date().toISOString().split("T")[0];return v.filter(h=>h.created_at?(typeof h.created_at=="string"?h.created_at:new Date(h.created_at).toISOString()).startsWith(a):!1).reduce((h,E)=>{const Q=typeof E.total_amount=="number"?E.total_amount:parseFloat(E.total_amount)||0;return h+Q},0)},[v,w]);s.useEffect(()=>{},[w]);const{customers:S}=_l(),{currentUser:m}=Fs();Rs();const k=ko(),A=m==null?void 0:m.role,Z=ht.canUser(m,"pos","view"),se=ht.canUser(m,"pos","sell");ht.canUser(m,"pos","refund"),ht.canUser(m,"pos","void"),ht.canUser(m,"pos-inventory","view");const y=ht.canUser(m,"pos-inventory","search"),T=ht.canUser(m,"pos-inventory","add-to-cart"),q=ht.canUser(m,"sales","create");ht.canUser(m,"sales","view"),ht.canUser(m,"sales","edit"),ht.canUser(m,"sales","delete"),ht.canUser(m,"sales","refund");const{settings:j}=Dl(),{settings:F}=Il(),{settings:Y}=El(),{settings:M}=Tl(),re=M?{...M,delivery_areas:M.delivery_areas||[],area_delivery_fees:M.area_delivery_fees||{}}:{delivery_areas:[],area_delivery_fees:{},enable_delivery:!1,default_delivery_fee:0,free_delivery_threshold:0};mi(re),s.useState("");const{settings:n}=Al(),{settings:$}=Ml(),V=(j==null?void 0:j.products_per_page)||20,{products:ie,categories:ce,loadProducts:pe,loadCategories:ee,loadSuppliers:X,loadSales:be}=Hs(),{startLoading:ke,updateProgress:We,completeLoading:we,failLoading:ze}=Ol(),et=s.useRef(!1),C=s.useRef(!1),I=s.useRef(!1),[L,K]=s.useState(new Map),de=s.useMemo(()=>{if(ie.length===0)return[];const a=ie;return ce.length===0?a.map(i=>{var h;const b=(h=i.variants)==null?void 0:h.map(E=>{const Q=`${i.id}-${E.id}`,R=L.get(Q)||0,ue=E.stockQuantity??E.quantity??0,B=Math.max(0,ue-R);return{...E,quantity:B,stockQuantity:B,_originalQuantity:ue}});return{...i,variants:b,categoryName:"Uncategorized",category:void 0}}):a.map(i=>{var R,ue;const b=i.categoryId||i.category_id||((R=i.category)==null?void 0:R.id);let h="Unknown Category",E=null;if(b&&ce.length>0&&(E=ce.find(B=>B.id===b),E&&(h=E.name)),!E&&i.name&&ce.length>0){const B=i.name.toLowerCase();E=ce.find(H=>{const me=H.name.toLowerCase();return B.includes(me)||me.includes(B)}),E&&(h=E.name)}const Q=(ue=i.variants)==null?void 0:ue.map(B=>{const H=`${i.id}-${B.id}`,me=L.get(H)||0,xe=B.stockQuantity??B.quantity??0,De=Math.max(0,xe-me);return{...B,quantity:De,stockQuantity:De,_originalQuantity:xe}});return{...i,variants:Q,categoryName:h,category:i.category||(E?{id:E.id,name:E.name,description:E.description,color:E.color}:void 0)}})},[ie,ce,L]),[fe,Pe]=s.useState(!1),[G,ge]=s.useState(0);s.useEffect(()=>{var a,i;if(ie.length>0&&!et.current){console.log(`âœ… [POS] ${ie.length} products loaded from database`);const b=ie.filter(R=>R.variants&&R.variants.length>0).length,h=ie.filter(R=>{var B;return(((B=R.variants)==null?void 0:B.reduce((H,me)=>H+(me.quantity||me.stockQuantity||0),0))||0)>0}).length,E=ie.filter(R=>{var B;return R.price>0||((B=R.variants)==null?void 0:B.some(H=>(H.sellingPrice||H.price||0)>0))}).length;if(console.log("ðŸ“Š [POS Diagnostic] Product data quality:",{total:ie.length,withVariants:b,withStock:h,withPrice:E,withoutVariants:ie.length-b,withoutStock:ie.length-h,withoutPrice:ie.length-E}),ie.length>0){const R=ie[0];console.log("ðŸ” [POS Diagnostic] Sample product structure:",{id:R.id,name:R.name,hasVariants:!!(R.variants&&R.variants.length>0),variantCount:((a=R.variants)==null?void 0:a.length)||0,price:R.price,variants:((i=R.variants)==null?void 0:i.map(ue=>({id:ue.id,name:ue.name,quantity:ue.quantity,stockQuantity:ue.stockQuantity,price:ue.price,sellingPrice:ue.sellingPrice})))||[]})}const Q=de.length;Q!==ie.length&&console.log(`âœ… [POS] ${Q} products after filtering`),et.current=!0}else ie.length===0&&et.current&&(console.warn("âš ï¸ [POS] dbProducts became empty! This might indicate a store reset."),et.current=!1)},[ie.length,de.length,fe,ie]),$==null||$.enable_caching;const[ae,U]=s.useState(1),[J,he]=s.useState(1),[Ce,ye]=s.useState(""),[qe,He]=s.useState(!1),Ue=(n==null?void 0:n.search_debounce_time)||gi,Ge=hi(Ce,Ue),[Qe,D]=s.useState(""),[te,ve]=s.useState(""),[At,kt]=s.useState({min:"",max:""}),[tt,W]=s.useState("all"),[Be,ne]=s.useState(!1),[Ae,Fe]=s.useState("sales"),[jt,bt]=s.useState("desc"),[Pt,rt]=s.useState(!1),{features:lt,isDeliveryEnabled:Ut,isLoyaltyEnabled:aa,isCustomerProfilesEnabled:Qt,isDynamicPricingEnabled:zs}=ui(),[Wa,fi]=s.useState(""),[Ga,bi]=s.useState(!1),[Ha,Bt]=s.useState(!1),[Dn,Qa]=s.useState(!1),[In,ks]=s.useState(!1),[En,Ka]=s.useState(!1),[Tn,Ja]=s.useState(!1),[An,Ps]=s.useState(!1),[Ct,Cs]=s.useState(null),[Mt,os]=s.useState({companyName:"",additionalNotes:"",receiverName:"",receiverAddress:"",receiverPhone:""}),[Nt,es]=s.useState({paymentMethod:"",paymentReference:"",transactionId:"",paidAmount:0,balance:0,paymentDate:""}),[ra,na]=s.useState(!1);s.useState(null);const[Ne,Ot]=s.useState([]),[yi,Mn]=s.useState(!1),[f,_t]=s.useState(null),[Ee,la]=s.useState(null),[us,On]=s.useState("");s.useState(new Set),s.useState([]),s.useState([]);const[Ya,_s]=s.useState(!1),[Xa,er]=s.useState(!1),[tr,is]=s.useState(!1),[sr,xs]=s.useState(!1),[ar,gs]=s.useState(!1),[$n,rr]=s.useState(!1),[nr,Ds]=s.useState(!1),[Ln,Fn]=s.useState(!1),[Rn,oa]=s.useState(!1);s.useState("");const[zn,qs]=s.useState(!1),[lr,ia]=s.useState(!1),[or,ca]=s.useState(null),[ir,da]=s.useState(null),{saveDraft:vi,loadDraft:cr,getAllDrafts:Is,deleteCurrentDraft:ji,hasUnsavedChanges:Ni,currentDraftId:qn}=di({cartItems:Ne,customer:f}),[Vt,hs]=s.useState(0),[dr,ps]=s.useState(!1),[Us,fs]=s.useState("percentage"),[Bs,bs]=s.useState("");s.useState({totalSales:0,totalTransactions:0,averageTransactionValue:0,topSellingProducts:[]}),s.useState(!1),s.useState([]),s.useState({startTime:new Date,totalSales:0,totalTransactions:0});const[Un,ma]=s.useState(!1),[mr,ur]=s.useState(""),[wi,Vs]=s.useState(!1);s.useState([]),s.useState({header:"",footer:"",includeLogo:!0,includeQR:!0});const[xr,Bn]=s.useState([]),[ua,Vn]=s.useState(!1),[Si,Zn]=s.useState(null),[ki,Wn]=s.useState("thermal"),[gr,yt]=s.useState(!1),[$t,Dt]=s.useState(null),[hr,Es]=s.useState(!1),[pr,Ts]=s.useState(!1),[fr,As]=s.useState(!1),[Gn,br]=s.useState(!1),[ys,yr]=s.useState(null),[xa,Hn]=s.useState({});s.useState({}),s.useState({});const[Qn,ga]=s.useState(!1),[Kn,vr]=s.useState(null),[Jn,jr]=s.useState(!1),[ha,Nr]=s.useState(""),[Yn,wr]=s.useState(""),[Sr,pa]=s.useState(!1),[Xn,kr]=s.useState(!1),[Pr,fa]=s.useState(!1);s.useState(!1),s.useState(!1),s.useState(!1);const[Cr,ba]=s.useState(!1),[el,ya]=s.useState(!1),[tl,Ms]=s.useState(!1),[Kt,_r]=s.useState(null),[_e,It]=s.useState(null),[wt,Dr]=s.useState(0),Ke=s.useRef(null),[sl,Ir]=s.useState(!1),Er=s.useRef(null);s.useRef(null),s.useRef(null),s.useRef(null),s.useRef(null),s.useRef(null),s.useRef(null),s.useRef(null),s.useRef(null),s.useRef(null),s.useRef(null),s.useRef(null);const[Tr,Zs]=s.useState(!1),[al,rl]=s.useState("general");s.useEffect(()=>{m&&On(m.name||m.email||"POS User")},[m]),s.useEffect(()=>{window.SoundManager=$l},[]),s.useEffect(()=>{if(m&&!Z){t("/dashboard");return}},[m,Z,t]);const nl=s.useMemo(()=>m?ht.canUser(m,"reports","daily-close")||m.role==="admin"||m.role==="manager"||m.role==="owner":!1,[m]);if(s.useEffect(()=>{if(Ge){const a=ke("Filtering products...");setTimeout(()=>{we(a)},300)}},[Ge,ke,we]),s.useEffect(()=>{if(Qe){const a=ke("Filtering by category...");setTimeout(()=>{we(a)},200)}},[Qe,ke,we]),s.useEffect(()=>{const a=ke("Applying filters...");setTimeout(()=>{we(a)},200)},[tt,Ae,jt,ke,we]),s.useEffect(()=>{if(C.current)return;C.current=!0,(async()=>{const b=ke("Loading POS data...");try{console.log("ðŸš€ [POS] Loading products and categories..."),await Promise.allSettled([pe({page:1,limit:200},!1),ee()]);const h=Hs.getState().products.length;console.log(`âœ… [POS] Loaded ${h} products`),we(b)}catch(h){console.error("âŒ [POS] Error loading initial data:",h),ze(b,"Failed to load POS data")}})();const i=ke("Loading additional data...");Promise.allSettled([X(),be()]).then(()=>{console.log("âœ… [POS] Background data loaded"),we(i)}).catch(b=>{console.warn("âš ï¸ [POS] Background data failed (non-critical):",b),ze(i,"Background data failed")}),Pe(!0),ge(Date.now())},[pe,ee,X,be,ke,we,ze]),s.useEffect(()=>{if(Qt()&&!f&&fe&&!I.current){const a=setTimeout(()=>{xs(!0),I.current=!0},500);return()=>clearTimeout(a)}},[Qt,f,fe]),s.useEffect(()=>{},[ce]),s.useEffect(()=>{(async()=>{})()},[]),!m||!Z)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-orange-50",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access the POS system."}),e.jsx("button",{onClick:()=>{l(),t("/dashboard")},className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Go to Dashboard"})]})});s.useEffect(()=>{console.log("ðŸ”µ [DEBUG] POSPageOptimized: Setting up event listeners");let a=null,i=null,b=0,h=0;const E=B=>{b++,console.log(`ðŸ”µ [DEBUG] POSPageOptimized: Stock update event #${b} received:`,{event:B,hasPendingTimeout:!!a,timestamp:new Date().toISOString()}),a&&(console.log("ðŸ”µ [DEBUG] POSPageOptimized: Clearing pending stock update timeout"),clearTimeout(a)),console.log("ðŸ”µ [DEBUG] POSPageOptimized: Scheduling stock update reload in 2 seconds"),a=setTimeout(()=>{console.log("ðŸ”µ [DEBUG] POSPageOptimized: Executing stock update reload now"),pe().catch(H=>{console.warn("âš ï¸ [DEBUG] POSPageOptimized: Background product reload failed:",H)}),a=null},2e3)},Q=B=>{h++,console.log(`ðŸ”µ [DEBUG] POSPageOptimized: Sale completed event #${h} received:`,{event:B,hasPendingTimeout:!!i,timestamp:new Date().toISOString()}),i&&(console.log("ðŸ”µ [DEBUG] POSPageOptimized: Clearing pending sale completed timeout"),clearTimeout(i)),console.log("ðŸ”„ [POS] Refreshing products after sale to update stock"),i=setTimeout(()=>{console.log("ðŸ”µ [DEBUG] POSPageOptimized: Executing sale completed reload now"),Promise.allSettled([pe({page:1,limit:200},!0).catch(H=>{console.warn("âš ï¸ [DEBUG] POSPageOptimized: Background product reload failed:",H)}),be().catch(H=>{console.warn("âš ï¸ [DEBUG] POSPageOptimized: Background sales reload failed:",H)})]).then(()=>{console.log("âœ… [POS] Products refreshed after sale - stock updated")}),i=null},500)};console.log("ðŸ”µ [DEBUG] POSPageOptimized: Subscribing to event bus");const R=Kr.subscribe("lats:stock.updated",E),ue=Kr.subscribe("lats:sale.completed",Q);return console.log("ðŸ”µ [DEBUG] POSPageOptimized: Event bus subscriptions created"),console.log("ðŸ”µ [DEBUG] POSPageOptimized: Adding window event listeners"),window.addEventListener("stockUpdated",E),window.addEventListener("saleCompleted",Q),console.log("ðŸ”µ [DEBUG] POSPageOptimized: Window event listeners added"),()=>{console.log("ðŸ”µ [DEBUG] POSPageOptimized: Cleaning up event listeners"),a&&(console.log("ðŸ”µ [DEBUG] POSPageOptimized: Clearing stock update timeout"),clearTimeout(a)),i&&(console.log("ðŸ”µ [DEBUG] POSPageOptimized: Clearing sale completed timeout"),clearTimeout(i)),R(),ue(),window.removeEventListener("stockUpdated",E),window.removeEventListener("saleCompleted",Q),console.log("ðŸ”µ [DEBUG] POSPageOptimized: Event listeners cleaned up")}},[]);const Ar=()=>{try{if(!f){x.success("No customer to remove.");return}_t(null),x.success("Customer removed")}catch(a){console.error("Error removing customer:",a),x.error("Failed to remove customer. Please try again.")}},ll=()=>{f&&(vr(f),ga(!0))},Mr=()=>{if(!Qt()){x.error("Customer Profiles feature is disabled. Enable it in POS Settings > Features");return}xs(!0)},va=()=>{if(!Qt()){x.error("Customer Profiles feature is disabled. Enable it in POS Settings > Features");return}is(!0)},Or=()=>{if(!zs()){x.error("Dynamic Pricing feature is disabled. Enable it in POS Settings > Features");return}pa(!0)},ol=a=>{const i=ke("Searching products...");try{/^\d{8,}$/.test(a)?(We(i,50),Ws(),we(i)):(We(i,50),Mn(!0),We(i,100),we(i))}catch{ze(i,"Search failed")}},Ws=()=>{try{if(!y)return;if(!(Y!=null&&Y.enable_barcode_scanner)){x.error("QrCode scanning is not enabled in settings.");return}if(ie.length===0){x.error("No products available for scanning. Please load products first.");return}ma(!0),Vs(!0),ur(""),x.success("QrCode scanner started. Scan a product barcode."),x.success("Please use your external barcode scanner device to scan products"),Vs(!1)}catch(a){console.error("Error starting barcode scanner:",a),x.error("Failed to start barcode scanner. Please try again."),ma(!1),Vs(!1)}},il=()=>{ma(!1),Vs(!1),ur(""),x("QrCode scanner stopped")};s.useEffect(()=>{(async()=>{var i,b,h,E,Q,R,ue,B,H,me,xe,De,st,je,z,le,$e,ot,Et,it,Ie,Oe,oe,Ve;try{const at=new Date().toISOString().split("T")[0];let Ft=null,Ye=null;try{const nt=await Te.from("daily_sales_closures").select("id, date, closed_at, closed_by").eq("date",at).maybeSingle();Ft=nt.data,Ye=nt.error}catch(nt){if((i=nt.message)!=null&&i.includes("400")||(b=nt.message)!=null&&b.includes("Bad Request")||(h=nt.message)!=null&&h.includes("relation")||(E=nt.message)!=null&&E.includes("does not exist")){console.warn("âš ï¸ Daily closure table not available - skipping closure check"),yt(!1),Dt(null),p(new Date().toISOString());return}else console.error("âŒ Unexpected error checking daily closure:",nt)}if(Ye&&Ye.code!=="PGRST116")if(Ye.code==="42P01"||Ye.code==="42703"||(Q=Ye.message)!=null&&Q.includes("400")||(R=Ye.message)!=null&&R.includes("Bad Request")){console.warn("âš ï¸ Daily closure table/columns not set up yet - skipping closure check"),yt(!1),Dt(null),p(new Date().toISOString());return}else if((ue=Ye.message)!=null&&ue.includes("No data returned from insert")||(B=Ye.message)!=null&&B.includes("RLS")||(H=Ye.message)!=null&&H.includes("policy")){console.warn("âš ï¸ Daily closure check blocked by RLS policies - using fallback mode"),yt(!1),Dt(null),p(new Date().toISOString());return}else console.warn("âš ï¸ Error checking daily closure status:",Ye.message||Ye);if(Ft)console.log("ðŸ”’ Day is closed, showing opening modal"),yt(!0),Dt({closedAt:Ft.closed_at,closedBy:Ft.closed_by}),Ts(!0),p(null);else{let nt=null,Le=null;try{const gt=await Te.from("daily_opening_sessions").select("id, date, opened_at, opened_by").eq("date",at).eq("is_active",!0).maybeSingle();nt=gt.data,Le=gt.error}catch(gt){if((me=gt.message)!=null&&me.includes("400")||(xe=gt.message)!=null&&xe.includes("Bad Request")||(De=gt.message)!=null&&De.includes("relation")||(st=gt.message)!=null&&st.includes("does not exist")){console.warn("âš ï¸ Session table not available - using fallback mode"),yt(!1),Dt(null),p(new Date().toISOString());return}else console.error("âŒ Unexpected error checking session:",gt)}if(Le&&Le.code!=="PGRST116")if(Le.code==="42P01"||Le.code==="42703"||(je=Le.message)!=null&&je.includes("400")||(z=Le.message)!=null&&z.includes("Bad Request")){console.warn("âš ï¸ Session table/columns not set up yet - using fallback"),yt(!1),Dt(null),p(new Date().toISOString());return}else console.error("âŒ Error checking session:",Le);if(nt)yt(!1),Dt(null),p(nt.opened_at);else{console.log("ðŸ†• No active session, creating one...");let gt=null,Tt=null;try{const Se=await Te.from("daily_opening_sessions").upsert([{date:at,opened_at:new Date().toISOString(),opened_by:(m==null?void 0:m.role)||"system",opened_by_user_id:m==null?void 0:m.id,is_active:!0}],{onConflict:"date,is_active"}).select().single();gt=Se.data,Tt=Se.error}catch(Se){if((le=Se.message)!=null&&le.includes("400")||($e=Se.message)!=null&&$e.includes("Bad Request")||(ot=Se.message)!=null&&ot.includes("relation")||(Et=Se.message)!=null&&Et.includes("does not exist")){console.warn("âš ï¸ Cannot create session (table not available) - using fallback mode"),p(new Date().toISOString()),yt(!1),Dt(null);return}}if(Tt)if((it=Tt.message)!=null&&it.includes("No data returned from insert")||(Ie=Tt.message)!=null&&Ie.includes("RLS")||(Oe=Tt.message)!=null&&Oe.includes("policy")){console.warn("âš ï¸ Cannot create session (RLS policies may need configuration) - using fallback mode"),p(new Date().toISOString()),yt(!1),Dt(null);return}else Tt.code==="42P01"||Tt.code==="42703"||(oe=Tt.message)!=null&&oe.includes("400")||(Ve=Tt.message)!=null&&Ve.includes("Bad Request")?(console.warn("âš ï¸ Cannot create session (table not ready) - using fallback"),p(new Date().toISOString())):(console.error("âŒ Error creating session:",Tt),p(new Date().toISOString()));else gt?(console.log("âœ… Session handled successfully:",gt),p(gt.opened_at)):(console.warn("âš ï¸ Session handling failed - using fallback mode"),p(new Date().toISOString()));yt(!1),Dt(null)}}}catch(at){console.error("âŒ Error in checkDailyClosureStatus:",at),yt(!1),Dt(null),p(new Date().toISOString())}})()},[m]);const cl=(a,i,b)=>{try{const h=ie.find(E=>E.id===a);if(!h){x.error("Product not found");return}x.success(`Stock adjusted for ${h.name}: ${i>0?"+":""}${i}`),br(!1),yr(null),pe()}catch(h){x.error("Failed to adjust stock"),console.error("Stock adjustment error:",h)}},dl=(a,i,b)=>{try{const h=S.find(E=>E.id===a);if(!h){x.error("Customer not found");return}Hn(E=>({...E,[a]:(E[a]||0)+i})),x.success(`Added ${i} loyalty points to ${h.name}`),jr(!1),Nr(""),wr("")}catch(h){x.error("Failed to add loyalty points"),console.error("Loyalty points error:",h)}},ml=async()=>{try{const a=v.map((i,b)=>{var h;return{id:i.id,saleId:i.id,date:i.created_at||i.soldAt||new Date().toISOString(),total:i.total_amount||i.total||0,customer:i.customer_name||i.customerName||"Walk-in Customer",items:((h=i.items)==null?void 0:h.length)||0}});Bn(a)}catch(a){console.error("Error loading receipt history:",a),x.error("Failed to load receipt history")}};s.useEffect(()=>{ua&&ml()},[ua,v]);const $r=s.useCallback(async a=>{try{const{data:i}=await Te.from("lats_product_variants").select("id, variant_name, name, is_parent, variant_type, quantity").eq("product_id",a.id).eq("is_active",!0).is("parent_variant_id",null).gt("quantity",0);if(!i||i.length===0)return!1;const b=i.filter(R=>R.is_parent||R.variant_type==="parent").map(R=>R.id);if(b.length===0)return!1;const{count:h}=await Te.from("lats_product_variants").select("id",{count:"exact",head:!0}).in("parent_variant_id",b).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0),{count:E}=await Te.from("inventory_items").select("id",{count:"exact",head:!0}).eq("product_id",a.id).in("variant_id",b).not("serial_number","is",null).eq("status","available"),Q=(h||0)+(E||0);return Q>0?(console.log(`âœ… Product has ${Q} children (${h||0} IMEI + ${E||0} legacy) across ${b.length} parents`),!0):!1}catch(i){return console.error("Error checking for IMEI variants:",i),!1}},[]),Gs=s.useCallback(async(a,i,b=1)=>{var h;try{if(!T){x.error("You do not have permission to add items to cart");return}if(!a||!a.id){x.error("Invalid product. Please try again."),console.error("Invalid product object:",a);return}if(!i||i.id==="default"||!i.id)if(a.variants&&a.variants.length>0)i=a.variants[0],console.log("âš ï¸ No variant specified, using first variant:",i);else if(a.variants&&a.variants.length>0)i=a.variants[0],console.log("âš¡ [addToCart] Using variant from product object (instant!)");else{const{workflowOptimizationService:me}=await dt(()=>import("./workflowOptimizationService-863010fe.js"),["assets/workflowOptimizationService-863010fe.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/customerCacheService-9b459c09.js"]);console.log("ðŸ” Product has no variants in object, fetching from database...");const{data:xe,error:De}=await Te.from("lats_product_variants").select("id, name, variant_name, selling_price, price, unit_price, quantity, sku, is_parent, variant_type, is_active").eq("product_id",a.id).eq("is_active",!0).order("created_at",{ascending:!0}).limit(10);if(De){console.error("âŒ Error fetching variants:",De),x.error("Failed to load product variants. Please try again.");return}if(xe&&xe.length>0)i={id:xe[0].id,name:xe[0].name||xe[0].variant_name||"Default",sellingPrice:xe[0].selling_price||xe[0].price||xe[0].unit_price,price:xe[0].price||xe[0].unit_price||xe[0].selling_price,sku:xe[0].sku,quantity:xe[0].quantity,is_parent:xe[0].is_parent,variant_type:xe[0].variant_type},console.log(`âœ… Found ${xe.length} variants in database, cached for future use`);else if(await $r(a)){x.error("Please select a specific device variant first"),console.log("âš ï¸ Product has IMEI variants, variant selection required");return}else console.log("â„¹ï¸ Product has no variants - creating virtual variant from product data"),i={id:a.id,name:"Default",sellingPrice:a.selling_price||a.price||a.unit_price,price:a.price||a.unit_price||a.selling_price,sku:a.sku||"N/A",quantity:a.stock_quantity||0,is_parent:!1,variant_type:"standard"},console.log("âœ… Created virtual variant for product without variants:",i)}const E=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!i.id){x.error("Invalid variant ID. Please select a valid variant."),console.error("âŒ Invalid variant ID:",i.id,"for product:",a.name);return}const Q=i.id===a.id;if(!Q&&!E.test(i.id)){x.error("Invalid variant ID format. Please select a valid variant."),console.error("âŒ Invalid variant ID format:",i.id,"for product:",a.name);return}const R=(i==null?void 0:i.sellingPrice)??(i==null?void 0:i.price)??a.price,ue=typeof R=="string"?parseFloat(R):Number(R);if(ue==null||isNaN(ue)||ue<0){x.error("Invalid product price. Please contact support."),console.error("Price validation failed:",{productId:a.id,productName:a.name,variantSellingPrice:i==null?void 0:i.sellingPrice,variantPrice:i==null?void 0:i.price,productPrice:a.price,rawPrice:R,finalPrice:ue});return}let B;if(Q){if(B=a.stock_quantity||0,B<b){x.error(`${a.name}: Insufficient stock. Available: ${B}, Requested: ${b}`);return}}else{const{workflowOptimizationService:me}=await dt(()=>import("./workflowOptimizationService-863010fe.js"),["assets/workflowOptimizationService-863010fe.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/customerCacheService-9b459c09.js"]),xe=await me.checkStockFast(i.id);if(xe!==void 0){if(xe<b){x.error(`${a.name}: Insufficient stock. Available: ${xe}, Requested: ${b}`);return}B=xe}else B=i.quantity||0,ts.checkStockAvailability(i.id,b).then(De=>{De.available||(Ot(st=>st.filter(je=>!(je.productId===a.id&&je.variantId===i.id))),x.error(`${a.name}: ${De.error||"Insufficient stock"}`))}).catch(De=>{console.warn("Background stock validation failed:",De)})}console.log("âœ… Stock check passed:",{productName:a.name,variantName:i==null?void 0:i.name,availableStock:B,requestedQuantity:b});const H=Ne.find(me=>me.productId===a.id&&(!i||me.variantId===i.id));if(H){const me=H.quantity+b,{workflowOptimizationService:xe}=await dt(()=>import("./workflowOptimizationService-863010fe.js"),["assets/workflowOptimizationService-863010fe.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/customerCacheService-9b459c09.js"]),De=await xe.checkStockFast(i.id),st=De!==void 0?De:B;if(me>st){x.error(`Only ${st} units available for ${a.name}. You already have ${H.quantity} in cart.`);return}De===void 0&&ts.checkStockAvailability(i.id,me).then(it=>{it.available||(Ot(Ie=>Ie.map(Oe=>Oe.id===H.id?{...Oe,quantity:H.quantity,totalPrice:H.quantity*Oe.unitPrice}:Oe)),x.error(`${a.name}: ${it.error||"Insufficient stock for requested quantity"}`))}).catch(it=>{console.warn("Background stock validation failed:",it)});const je=H.quantity+b,z=typeof H.unitPrice=="string"?parseFloat(H.unitPrice):Number(H.unitPrice),le=je*z;Ot(it=>it.map(Ie=>Ie.id===H.id?{...Ie,quantity:je,totalPrice:le}:Ie));const $e=`${a.id}-${(i==null?void 0:i.id)||H.variantId}`,Et=(L.get($e)||0)+b;K(it=>{const Ie=new Map(it);return Ie.set($e,Et),Ie}),B-Et<=0&&console.log(`ðŸ”´ Product now out of stock: ${a.name} (${(i==null?void 0:i.name)||"Default"})`),x.success(`${a.name} quantity updated to ${je}`)}else{if(!i||!i.id){x.error("Invalid variant. Cannot add to cart."),console.error("âŒ No valid variant for product:",a.name);return}let me;if(a.images&&Array.isArray(a.images)&&a.images.length>0){const z=a.images[0];me=typeof z=="string"?z:(z==null?void 0:z.url)||(z==null?void 0:z.thumbnailUrl)}else me=a.thumbnail_url||a.image||a.primary_image;const xe={id:`${a.id}-${i.id}-${Date.now()}`,productId:a.id,variantId:i.id,productName:a.name,variantName:i.name||"Default",sku:i.sku||a.sku||"N/A",quantity:b,unitPrice:ue,totalPrice:ue*b,availableQuantity:B,image:me,attributes:{...i.attributes||{},...i.variant_attributes||{},...i.variantAttributes||{}},selectedIMEIVariants:i&&((h=i.attributes)!=null&&h.imei||i.is_legacy||i.is_imei_child)?[i]:[]};console.log("âœ… Adding to cart:",xe),Ot(z=>[...z,xe]);const De=`${a.id}-${i.id}`,je=(L.get(De)||0)+b;K(z=>{const le=new Map(z);return le.set(De,je),le}),B-je<=0&&(console.log(`ðŸ”´ Product now out of stock: ${a.name} (${i.name||"Default"})`),x(`${a.name} is now out of stock`,{icon:"â„¹ï¸"})),x.success(`${b}x ${a.name} added to cart`)}}catch(E){console.error("âŒ Error adding to cart:",E),x.error("Failed to add item to cart. Please try again.")}},[T,Ne,$r,L]),Lr=s.useCallback(async(a,i)=>{try{if(!a){x.error("Invalid item ID. Please try again.");return}if(i<0){x.error("Quantity cannot be negative.");return}if(i===0){ja(a);return}const b=Ne.find(B=>B.id===a);if(!b){x.error("Item not found in cart.");return}const h=await ts.checkStockAvailability(b.variantId,i);if(!h.available){const B=h.error||"Insufficient stock";x.error(`${b.productName}: ${B}`);return}const E=typeof b.unitPrice=="string"?parseFloat(b.unitPrice):Number(b.unitPrice),Q=i*E,R=i-b.quantity,ue=`${b.productId}-${b.variantId}`;Ot(B=>B.map(H=>H.id===a?{...H,quantity:i,totalPrice:Q}:H)),K(B=>{const H=new Map(B),xe=(H.get(ue)||0)+R;return xe<=0?H.delete(ue):H.set(ue,xe),H})}catch(b){console.error("Error updating cart item quantity:",b),x.error("Failed to update item quantity. Please try again.")}},[Ne]),ul=s.useCallback((a,i)=>{try{if(!a){x.error("Invalid item ID. Please try again.");return}if(!Ne.find(h=>h.id===a)){x.error("Item not found in cart.");return}Ot(h=>h.map(E=>E.id===a?{...E,tags:i}:E)),console.log("âœ… Updated tags for item:",a,i)}catch(b){console.error("Error updating cart item tags:",b),x.error("Failed to update item tags. Please try again.")}},[Ne]),xl=s.useCallback(async a=>{try{console.log("ðŸ” Opening IMEI selection modal for cart item:",a);const{data:i}=await Te.from("lats_products").select(`
          *,
          product_variants:lats_product_variants(*)
        `).eq("id",a.productId).single();if(!i){x.error("Product not found");return}const b={...i,variants:i.variants||i.product_variants||[]};ca(b),ia(!0),da(a)}catch(i){console.error("Error opening IMEI selection modal:",i),x.error("Failed to open IMEI selection. Please try again.")}},[]),ja=s.useCallback(a=>{try{if(!a){x.error("Invalid item ID. Please try again.");return}const i=Ne.find(b=>b.id===a);if(i){Ot(h=>h.filter(E=>E.id!==a));const b=`${i.productId}-${i.variantId}`;K(h=>{const E=new Map(h),R=(E.get(b)||0)-i.quantity;return R<=0?E.delete(b):E.set(b,R),E}),x.success(`${i.productName} removed from cart`)}else x.error("Item not found in cart.")}catch(i){console.error("Error removing cart item:",i),x.error("Failed to remove item from cart. Please try again.")}},[Ne]),cs=s.useCallback(()=>{try{if(Ne.length===0){x.success("Cart is already empty.");return}Ot([]),K(new Map),hs(0),bs(""),fs("percentage"),x.success("Cart cleared successfully")}catch(a){console.error("Error clearing cart:",a),x.error("Failed to clear cart. Please try again.")}},[Ne]),Na=async()=>{try{if(!se||!q){x.error("You do not have permission to process sales");return}if(Ne.length===0){x.error("Cart is empty. Please add items before processing payment.");return}const a=Ne.filter(h=>!h.totalPrice||h.totalPrice<=0||isNaN(h.totalPrice)||!h.unitPrice||h.unitPrice<=0||isNaN(h.unitPrice));if(a.length>0){console.error("âŒ Invalid cart items found:",a),x.error(`Invalid prices found for: ${a.map(h=>h.productName).join(", ")}`);return}if(isNaN(Re)||Re<=0){console.error("âŒ Invalid total amount:",Re),x.error("Cart total is invalid. Please check item prices.");return}if(Lt>=Re){console.error("âŒ Discount exceeds total:",{discountAmount:Lt,totalAmount:Re}),x.error(`Discount (${Ze.money(Lt)}) cannot exceed total (${Ze.money(Re)})`);return}if(Me<=0){console.error("âŒ Invalid final amount:",{totalAmount:Re,discountAmount:Lt,finalAmount:Me}),x.error("Invalid total amount. Please check your cart items and discount.");return}!f&&Me>5e4&&x.error("Customer information is recommended for payments over 50,000 TZS");const b=(await Promise.all(Ne.map(async h=>{var E;try{console.log("ðŸ” Checking IMEI requirement for item:",{productName:h.productName,variantId:h.variantId,variantName:h.variantName,selectedSerialNumbers:h.selectedSerialNumbers,selectedIMEIVariants:h.selectedIMEIVariants});let Q=!1;if(h.variantId&&h.variantId!=="default"){const{count:R}=await Te.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("parent_variant_id",h.variantId).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0);if((R||0)>0)console.log(`ðŸ“± Variant ${h.variantId} has ${R} IMEI children - REQUIRES IMEI selection`),Q=!0;else{const{data:ue}=await Te.from("lats_product_variants").select("variant_attributes").eq("id",h.variantId).eq("is_active",!0).single();console.log(`ðŸ“± Variant ${h.variantId} IMEI check:`,{hasIMEIAttribute:!!((E=ue==null?void 0:ue.variant_attributes)!=null&&E.imei),variantAttributes:ue==null?void 0:ue.variant_attributes}),Q=!1}}else{const{data:R}=await Te.from("lats_product_variants").select("id").eq("product_id",h.productId).not("variant_attributes->>'imei'","is",null).eq("is_active",!0).gt("quantity",0).limit(1);Q=R&&R.length>0}if(Q){const R=h.selectedIMEIVariants&&h.selectedIMEIVariants.length>0;return console.log(`âš ï¸ Item ${h.productName} (${h.variantName}) REQUIRES IMEI - hasSelected: ${R}`),{item:h,requiresIMEI:!0,hasSelected:R}}return console.log(`âœ… Item ${h.productName} (${h.variantName}) does NOT require IMEI`),null}catch(Q){return console.warn("Error checking IMEI variants for item:",h,Q),null}}))).filter(h=>h!==null&&h.requiresIMEI&&!h.hasSelected);if(b.length>0){const h=b.map(E=>E.item.productName).join(", ");x.error(`Please select IMEI/Serial numbers for: ${h}`),console.error("âŒ Missing IMEI variants for items:",b);return}if(gr){Es(!0);return}qs(!0)}catch(a){console.error("Error in handleProcessPayment:",a),x.error("Failed to initialize payment. Please try again.")}},gl=()=>{qs(!1),Bt(!0)},hl=async()=>{try{const a=Hs.getState();a.invalidateCache("products"),a.invalidateCache("categories"),a.invalidateCache("suppliers"),a.invalidateCache("sales");const{productCacheService:i}=await dt(()=>import("./index-61458a34.js").then(b=>b.bi),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);i.clearCache(),await Promise.all([pe({page:1,limit:500},!0),be(),ee(),X()]),x.success("Data refreshed from database successfully")}catch(a){console.error("Error refreshing data:",a),x.error("Failed to refresh some data")}},pl=()=>{if(Ne.length===0){x.error("Add items to cart first");return}if(!f){x.error("Please select a customer first");return}ba(!0)},Fr=async a=>{if(console.log("âœ… handleTradeInComplete called with data:",a),console.log("ðŸ” Function type:",typeof Fr),console.log("ðŸ” Data type:",typeof a),console.log("ðŸ” Selected customer:",f==null?void 0:f.id,f==null?void 0:f.name),console.log("ðŸ” Cart items:",Ne.length,Ne),!f){console.error("âŒ No customer selected - cannot create trade-in"),x.error("Please select a customer before adding trade-in");return}if(Ne.length===0){console.error("âŒ No items in cart - cannot create trade-in"),x.error("Please add items to cart before trade-in");return}_r(a),Dr(a.final_trade_in_value),console.log("ðŸ’° Trade-in discount set:",a.final_trade_in_value),console.log("ðŸ“ About to start try block...");try{console.log("ðŸ“ Creating trade-in transaction - STARTING...");const{createTradeInTransaction:i}=await dt(()=>import("./tradeInApi-5d12dbe0.js").then(R=>R.o),["assets/tradeInApi-5d12dbe0.js","assets/vendor-36d2c7c1.js","assets/index-61458a34.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);console.log("ðŸ“ createTradeInTransaction imported successfully");const b=Ne[0],h=(b==null?void 0:b.product_id)||null,E=(b==null?void 0:b.variant_id)||null;console.log("ðŸ›’ Cart item for trade-in:",{product_id:h,variant_id:E,product_name:b==null?void 0:b.name});const Q=await i({customer_id:(f==null?void 0:f.id)||"",device_name:a.trade_in_details.device_name,device_model:a.trade_in_details.device_model,device_imei:a.trade_in_details.device_imei,base_trade_in_price:a.trade_in_details.base_price,condition_rating:a.trade_in_details.condition_rating,condition_description:a.trade_in_details.condition_description,damage_items:a.trade_in_details.damage_items,new_product_id:h,new_variant_id:E,new_device_price:Me,customer_payment_amount:a.customer_payment_amount});console.log("ðŸ“ Transaction creation result:",Q),Q.success&&Q.data?(console.log("âœ… Trade-in transaction created successfully:",Q.data),console.log("ðŸ“ Setting tradeInTransaction state to:",Q.data.id),It(Q.data),Ke.current=Q.data,ba(!1),x.success(`Trade-in added: ${a.trade_in_details.device_name} for ${a.final_trade_in_value.toLocaleString()} TZS`),console.log("ðŸ“„ Opening contract modal..."),ya(!0)):(console.error("âŒ Failed to create trade-in transaction:",Q.error),x.error(Q.error||"Failed to create trade-in transaction"))}catch(i){console.error("âŒ Error creating trade-in transaction:",i),console.error("âŒ Error stack:",i instanceof Error?i.stack:"No stack trace"),x.error("Failed to create trade-in transaction")}},fl=()=>{var a;x.success("Contract signed successfully!"),ya(!1),console.log("âœ… Contract signed, proceeding to payment..."),console.log("ðŸ” Trade-in transaction state at contract sign:",(_e==null?void 0:_e.id)||"none"),console.log("ðŸ” Trade-in transaction ref at contract sign:",((a=Ke.current)==null?void 0:a.id)||"none"),setTimeout(()=>{Bt(!0)},300)},bl=async a=>{if(!_e){x.error("No trade-in transaction found");return}try{console.log("ðŸ“¦ Adding traded-in device to inventory with pricing...",a);const{addTradeInDeviceToInventory:i,getOrCreateTradeInCategory:b}=await dt(()=>import("./tradeInInventoryService-e9d70304.js"),["assets/tradeInInventoryService-e9d70304.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),h=await b(),E=await i({transaction:_e,categoryId:h,locationId:void 0,needsRepair:_e.needs_repair||!1,resalePrice:a.selling_price});E.success?(console.log("âœ… Trade-in device added to inventory:",E.data),x.success("âœ… Trade-in device added to inventory with pricing!"),Ms(!1),It(null),Ke.current=null,_r(null),Dr(0),setTimeout(()=>{cs(),_t(null),console.log("ðŸŽ‰ POS: Cart cleared after trade-in pricing completed")},150)):(console.error("âŒ Failed to add trade-in to inventory:",E.error),x.error("Failed to add trade-in to inventory: "+E.error))}catch(i){console.error("âŒ Error adding trade-in to inventory:",i);const b=i instanceof Error?i.message:"Failed to add trade-in to inventory";x.error(b)}},wa=(j==null?void 0:j.tax_rate)||18,Sa=(j==null?void 0:j.enable_tax)===!0,Re=s.useMemo(()=>Ne.reduce((i,b)=>{const h=typeof b.totalPrice=="string"?parseFloat(b.totalPrice):Number(b.totalPrice||0);return isNaN(h)?i:i+h},0),[Ne]),Lt=Vt||0,yl=Re>0?Math.round(Lt/Re*100):0,Rr=Re-Lt,St=Sa?Rr*wa/100:0,Me=Rr+St,zr=s.useCallback((a,i)=>{try{fs(a),bs(i);const b=a==="percentage"?Re*parseFloat(i)/100:parseFloat(i);hs(b),ps(!1),x.success("Discount applied successfully")}catch(b){console.error("Error applying discount:",b),x.error("Failed to apply discount. Please try again.")}},[Re]),qr=Y==null?void 0:Y.enable_barcode_scanner;return O?e.jsxs(e.Fragment,{children:[e.jsx(ni,{cartItems:Ne,selectedCustomer:f,searchQuery:Ce,onSearchChange:ye,products:de,onAddToCart:Gs,onUpdateCartItemQuantity:Lr,onRemoveCartItem:ja,onProcessPayment:Na,onClearCart:cs,onShowCustomerSearch:()=>Mr(),onAddCustomer:()=>va(),onRemoveCustomer:Ar,onScanBarcode:Ws,onViewReceipts:()=>x.info("Receipts view feature coming soon!",{duration:3e3}),onToggleSettings:()=>Zs(!0),onViewSales:async()=>{await be(),t("/lats/sales-reports")},onShowDiscountModal:()=>ps(!0),totalAmount:Re,discountAmount:Lt,taxAmount:St,finalAmount:Me,isProcessingPayment:Ga,todaysSales:_,isTaxEnabled:Sa,taxRate:wa,isQrCodeScannerEnabled:qr}),e.jsx(dn,{isOpen:Ya,onClose:()=>_s(!1),onProductAdded:a=>{Gs(a),_s(!1)}}),e.jsx(mn,{isOpen:sr,onClose:()=>xs(!1),onCustomerSelect:a=>{_t(a),xs(!1),x.success(`Customer "${a.name}" selected!`)},selectedCustomer:f}),e.jsx(Aa,{isOpen:tr,onClose:()=>is(!1),onCustomerCreated:a=>{_t(a),is(!1),x.success(`New customer "${a.name}" created and selected!`)},onAddAnother:()=>{is(!0)}}),e.jsx(un,{isOpen:ar,onClose:()=>gs(!1),customer:f,onCustomerUpdated:a=>{_t(a),gs(!1),x.success("Customer updated successfully!")}}),e.jsx(ln,{isOpen:$n,onClose:()=>rr(!1),customer:f,onEdit:a=>{rr(!1),gs(!0)}}),e.jsx(fn,{isOpen:dr,onClose:()=>ps(!1),onApplyDiscount:zr,cartSubtotal:Re,discountValue:Bs,setDiscountValue:bs,discountType:Us,setDiscountType:fs,appliedDiscount:Vt}),e.jsx(Oa,{ref:Er,isOpen:Tr,onClose:()=>Zs(!1)}),e.jsx(xn,{isOpen:Sr,onClose:()=>pa(!1)}),e.jsx(bn,{isOpen:En,onClose:()=>Ka(!1),receiptData:Ee,onShare:()=>Ja(!0)}),!1,e.jsx(cn,{isOpen:Tn,onClose:()=>Ja(!1),receiptData:Ee}),e.jsx(yn,{isOpen:nr,onClose:()=>Ds(!1),onLoadDraft:cr}),e.jsx(vn,{draftCount:Is().length,onViewDrafts:()=>Ds(!0),onDismiss:()=>{},isVisible:Is().length>0}),e.jsx(Jr,{isOpen:fr,onClose:()=>As(!1),onComplete:()=>{console.log("Day closed successfully"),yt(!0),As(!1),x.success("Day closed successfully!")},currentUser:m}),e.jsx(jo,{isOpen:Ha,onClose:()=>Bt(!1),totalAmount:Re,discountAmount:Lt+wt,onProcessPayment:async a=>{var i,b;try{console.log("Processing comprehensive payment:",a);let h=[],E=0;a.method==="split"?(h=a.splitPayments.map(H=>({paymentMethod:H.methodId,amount:H.amount,reference:H.reference||null})),E=a.totalAmount):(h=[{paymentMethod:a.method,amount:a.amount,reference:a.reference||null,loyaltyPoints:a.loyaltyPoints||null,giftCardCode:a.giftCardCode||null}],E=a.amount),console.log("Converted payments:",h);const R=E||Me,ue={customerId:(f==null?void 0:f.id)||null,customerName:(f==null?void 0:f.name)||"Walk-in Customer",customerPhone:(f==null?void 0:f.phone)||null,customerEmail:(f==null?void 0:f.email)||null,items:Ne.map(H=>({id:H.id,productId:H.productId,variantId:H.variantId,productName:H.productName,variantName:H.variantName,sku:H.sku,quantity:H.quantity,unitPrice:H.unitPrice,totalPrice:H.totalPrice,costPrice:0,profit:0,selectedSerialNumbers:H.selectedSerialNumbers||[]})),subtotal:Re,tax:St,discount:Vt,discountType:Us,discountValue:parseFloat(Bs)||0,total:Me,paymentMethod:{type:h.length===1?h[0].paymentMethod:"multiple",details:{payments:h.map(H=>({method:H.paymentMethod,amount:H.amount,accountId:H.paymentAccountId,reference:H.reference,notes:H.notes,timestamp:H.timestamp})),totalPaid:R},amount:R},paymentStatus:"completed",soldBy:us||"POS User",soldAt:new Date().toISOString(),notes:h.map(H=>H.notes).filter(Boolean).join("; ")||void 0},B=await ts.processSale(ue);if(B.success){const H=E||Me,me=(i=B.sale)==null?void 0:i.saleNumber,xe=_e||Ke.current,De=A==="admin";if(xe&&xe.id)try{if(De){console.log("ðŸ“ [ADMIN] Marking trade-in transaction as completed:",xe.id);const{completeTradeInTransaction:je}=await dt(()=>import("./tradeInApi-5d12dbe0.js").then(le=>le.o),["assets/tradeInApi-5d12dbe0.js","assets/vendor-36d2c7c1.js","assets/index-61458a34.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),z=await je(xe.id);z.success?(console.log("âœ… Trade-in transaction marked as completed"),It(z.data),Ke.current=z.data):(console.error("âŒ Failed to mark trade-in as completed:",z.error),x.error("Warning: Failed to mark trade-in as completed"))}else{console.log("ðŸ“ [CUSTOMER CARE] Marking trade-in transaction as approved for admin review:",xe.id);const{data:je,error:z}=await Te.from("lats_trade_in_transactions").update({status:"approved",approved_at:new Date().toISOString(),approved_by:(m==null?void 0:m.id)||null}).eq("id",xe.id).select().single();!z&&je?(console.log("âœ… Trade-in marked as approved, awaiting admin to add to inventory"),x.success("âœ… Trade-in submitted for admin review. Admin will add device to inventory with pricing."),It(je),Ke.current=je):(console.error("âŒ Failed to mark trade-in as approved:",z),x.error("Warning: Failed to submit trade-in for approval"))}}catch(je){console.error("âŒ Error updating trade-in status:",je),x.error("Warning: Failed to update trade-in status")}const st={id:((b=B.sale)==null?void 0:b.id)||"",date:new Date().toLocaleDateString(),time:new Date().toLocaleTimeString(),items:Ne.map(je=>{var Et,it,Ie,Oe;const z=de.find(oe=>oe.id===je.productId),le=(Et=z==null?void 0:z.variants)==null?void 0:Et.find(oe=>oe.id===je.variantId);let $e=je.attributes||{};le!=null&&le.variant_attributes&&($e={...$e,...le.variant_attributes}),le!=null&&le.variantAttributes&&($e={...$e,...le.variantAttributes}),le!=null&&le.attributes&&($e={...$e,...le.attributes});const ot=((it=le==null?void 0:le.variant_attributes)==null?void 0:it.specification)||((Ie=le==null?void 0:le.variantAttributes)==null?void 0:Ie.specification)||((Oe=le==null?void 0:le.attributes)==null?void 0:Oe.specification);if(ot)try{const oe=typeof ot=="string"?JSON.parse(ot):ot;typeof oe=="object"&&oe!==null&&!Array.isArray(oe)&&($e={...$e,...oe})}catch{}return{productName:je.productName,variantName:je.variantName,quantity:je.quantity,unitPrice:je.unitPrice,totalPrice:je.totalPrice,sku:je.sku,image:je.image,selectedSerialNumbers:je.selectedSerialNumbers||[],attributes:$e}}),customerName:(f==null?void 0:f.name)||null,customerPhone:(f==null?void 0:f.phone)||null,customerEmail:(f==null?void 0:f.email)||null,customer:f?{name:f.name,phone:f.phone,email:f.email}:null,subtotal:Re,tax:St,discount:Vt,total:Me,paymentMethod:{name:h.length===1?h[0].paymentMethod:"Multiple Payments",description:h.length===1?`${h[0].paymentMethod} - ${Ze.money(h[0].amount)}`:`${h.length} payment methods - ${Ze.money(H)}`,icon:"ðŸ’³"},cashier:us||"POS User",receiptNumber:me||"N/A"};la(st),Bt(!1),console.log("ðŸŽ‰ POS: About to show success modal"),setTimeout(()=>{k.show(`Payment of ${Ze.money(H)} processed successfully!${me?` Sale #${me}`:""}`,{title:"Sale Complete! ðŸŽ‰",icon:Os.paymentReceived,autoCloseDelay:0,actionButtons:[{label:"Share Receipt",onClick:()=>{ks(!0)},variant:"primary"},{label:"View Receipt",onClick:()=>{Ka(!0)},variant:"secondary"},{label:"Continue",onClick:()=>{k.hide()},variant:"secondary"}]})},50),setTimeout(()=>{cs(),hs(0),bs(""),fs("percentage"),_t(null),(async()=>{try{const{childVariantsCacheService:je}=await dt(()=>import("./childVariantsCacheService-9368f4c7.js"),["assets/childVariantsCacheService-9368f4c7.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);je.clearCache(),console.log("âœ… Child variants cache cleared after sale")}catch(je){console.warn("âš ï¸ Failed to clear child variants cache:",je)}})().catch(je=>{console.warn("âš ï¸ Unhandled error in cache clearing:",je)}),be(),c(),console.log("ðŸ§¹ POS: Cart cleared after successful payment")},100)}else console.error("âŒ Failed to process sale:",B.error),x.error(B.error||"Failed to process sale"),Bt(!1)}catch(h){if(console.error("âŒ Payment processing error:",h),(h==null?void 0:h.name)==="ValidationError"||(h==null?void 0:h.name)==="PaymentValidationError")x.error(h.message||"Payment validation failed");else if((h==null?void 0:h.name)==="UserCancelledError")x("Payment cancelled",{icon:"âŒ",duration:2e3}),k.show("Payment was cancelled. Cart has been preserved.",{title:"Payment Received! ðŸ’°",icon:Os.paymentReceived,autoCloseDelay:3e3}),Bt(!1);else throw h}}}),e.jsx(hn,{isOpen:hr,onClose:()=>Es(!1),onContinue:()=>{Es(!1),Bt(!0)},closureTime:$t==null?void 0:$t.closedAt,closedBy:$t==null?void 0:$t.closedBy,userRole:m==null?void 0:m.role}),e.jsx(pn,{isOpen:pr,onClose:()=>Ts(!1),onOpenDay:async()=>{p(new Date().toISOString()),yt(!1),Ts(!1),x.success("Day opened successfully!")},currentUser:m}),e.jsx(on,{...k.props})]}):e.jsxs("div",{className:"flex flex-col h-screen pos-auto-scale","data-pos-page":"true",children:[e.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 py-2",children:e.jsx(_o,{})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Do,{cartItemsCount:Ne.length,totalAmount:Re,onProcessPayment:Na,onClearCart:cs,onPreviewInvoice:()=>{if(!f){x.error("Please select a customer first to preview invoice");return}if(Ne.length===0){x.error("Add items to cart first");return}const a={invoiceNumber:`PREVIEW-${Date.now()}`,invoiceDate:new Date().toISOString().split("T")[0],customer:{name:f.name,address:f.address||"",phone:f.phone||"",email:f.email||"",taxId:f.taxId||""},items:Ne.map(i=>{var Q,R,ue;const b=de.find(B=>B.id===i.productId),h=(Q=b==null?void 0:b.variants)==null?void 0:Q.find(B=>B.id===i.variantId);let E;if((R=h==null?void 0:h.attributes)!=null&&R.specification)try{const B=JSON.parse(h.attributes.specification);E=typeof B=="object"?B:h.attributes.specification}catch{E=h.attributes.specification}else if(b!=null&&b.specification)try{const B=JSON.parse(b.specification);E=typeof B=="object"?B:b.specification}catch{E=b.specification}else if((ue=b==null?void 0:b.attributes)!=null&&ue.specification)try{const B=JSON.parse(b.attributes.specification);E=typeof B=="object"?B:b.attributes.specification}catch{E=b.attributes.specification}else if(h!=null&&h.attributes&&Object.keys(h.attributes).length>0){const B={...h.attributes};delete B.imei,delete B.is_legacy,delete B.is_imei_child,Object.keys(B).length>0&&(E=B)}return{description:`${i.productName}${i.variantName?` - ${i.variantName}`:""}`,quantity:i.quantity,unitPrice:i.unitPrice,total:i.totalPrice,specifications:E}}),subtotal:Re,tax:St||0,discount:Vt||0,total:Me,notes:"This is a preview invoice. Prices may change before payment.",terms:"Net 30"};Cs(a),Ps(!0)},onScanQrCode:qr?Ws:()=>{},onAddCustomer:()=>va(),onViewReceipts:()=>{x.info("Receipts view feature coming soon!",{duration:3e3})},onViewSales:async()=>{await be(),t("/lats/sales-reports")},onOpenPaymentTracking:()=>{handleShowPaymentTracking()},onOpenDrafts:()=>Ds(!0),isProcessingPayment:Ga,hasSelectedCustomer:!!f,draftCount:Is().length,onViewAnalytics:()=>Or(),onCustomers:()=>va(),onReports:()=>Or(),onRefreshData:hl,onSettings:()=>Zs(!0),onOpenInstallments:()=>Ir(!0),onOpenExpense:()=>oa(!0),todaysSales:_,isDailyClosed:gr,onCloseDay:()=>As(!0),canCloseDay:nl})}),e.jsx("div",{className:"flex-1 min-h-0 p-4 sm:p-6 max-w-full mx-auto pos-page-container overflow-hidden",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative h-full",children:[!fe&&de.length===0?e.jsx(Go,{itemCount:8,columns:4,showSearchBar:!0,showCategories:!0}):null,!1,e.jsx(Eo,{products:de,searchQuery:Ce,setSearchQuery:ye,isSearching:qe,showAdvancedFilters:Be,setShowAdvancedFilters:ne,selectedCategory:Qe,setSelectedCategory:D,selectedBrand:te,setSelectedBrand:ve,priceRange:At,setPriceRange:kt,stockFilter:tt,setStockFilter:W,sortBy:Ae,setSortBy:Fe,sortOrder:jt,setSortOrder:bt,categories:(ce==null?void 0:ce.map(a=>a.name))||[],brands:[],onAddToCart:Gs,onAddExternalProduct:()=>_s(!0),onSearch:ol,onScanQrCode:Ws,currentPage:ae,setCurrentPage:U,totalPages:J,productsPerPage:V})]}),e.jsx(To,{cartItems:Ne,selectedCustomer:f,onRemoveCustomer:Ar,onShowCustomerSearch:()=>Mr(),onShowCustomerDetails:ll,onUpdateCartItemQuantity:Lr,onRemoveCartItem:ja,onUpdateCartItemTags:ul,onIMEISelect:xl,onApplyDiscount:(a,i)=>{const b=a==="percentage"?Re*parseFloat(i.toString())/100:parseFloat(i.toString());hs(b),ps(!1)},onProcessPayment:Na,onShowInstallmentModal:()=>fa(!0),onShowTradeInModal:pl,onShowDiscountModal:()=>ps(!0),onClearDiscount:()=>{hs(0),bs(""),fs("percentage")},onPreviewInvoice:()=>{if(!f){x.error("Please select a customer first to preview invoice");return}if(Ne.length===0){x.error("Add items to cart first");return}const a={invoiceNumber:`PREVIEW-${Date.now()}`,invoiceDate:new Date().toISOString().split("T")[0],customer:{name:f.name,address:f.address||"",phone:f.phone||"",email:f.email||"",taxId:f.taxId||""},items:Ne.map(i=>{var Q,R,ue;const b=de.find(B=>B.id===i.productId),h=(Q=b==null?void 0:b.variants)==null?void 0:Q.find(B=>B.id===i.variantId);let E;if((R=h==null?void 0:h.attributes)!=null&&R.specification)try{const B=JSON.parse(h.attributes.specification);E=typeof B=="object"?B:h.attributes.specification}catch{E=h.attributes.specification}else if(b!=null&&b.specification)try{const B=JSON.parse(b.specification);E=typeof B=="object"?B:b.specification}catch{E=b.specification}else if((ue=b==null?void 0:b.attributes)!=null&&ue.specification)try{const B=JSON.parse(b.attributes.specification);E=typeof B=="object"?B:b.attributes.specification}catch{E=b.attributes.specification}else if(h!=null&&h.attributes&&Object.keys(h.attributes).length>0){const B={...h.attributes};delete B.imei,delete B.is_legacy,delete B.is_imei_child,Object.keys(B).length>0&&(E=B)}return{description:`${i.productName}${i.variantName?` - ${i.variantName}`:""}`,quantity:i.quantity,unitPrice:i.unitPrice,total:i.totalPrice,specifications:E}}),subtotal:Re,tax:St||0,discount:Vt||0,total:Me,notes:"This is a preview invoice. Prices may change before payment.",terms:"Net 30"};Cs(a),Ps(!0)},dynamicPricingEnabled:F==null?void 0:F.enable_dynamic_pricing,totalAmount:Re,discountAmount:Lt,discountPercentage:yl,taxAmount:St,taxRate:wa,finalAmount:Me,onEditCustomer:a=>gs(!0),isTaxEnabled:Sa})]})}),e.jsx(dn,{isOpen:Ya,onClose:()=>_s(!1),onProductAdded:a=>{Gs(a),_s(!1)}}),Qt()&&e.jsxs(e.Fragment,{children:[e.jsx(mn,{isOpen:sr,onClose:()=>xs(!1),onCustomerSelect:a=>{_t(a),xs(!1),x.success(`Customer "${a.name}" selected!`)},selectedCustomer:f}),e.jsx(Aa,{isOpen:tr,onClose:()=>is(!1),onCustomerCreated:a=>{_t(a),is(!1),x.success(`New customer "${a.name}" created and selected!`)},onAddAnother:()=>{is(!0)}}),e.jsx(un,{isOpen:ar,onClose:()=>gs(!1),customer:f,onCustomerUpdated:a=>{_t(a),gs(!1)}})]}),e.jsx(yn,{isOpen:nr,onClose:()=>Ds(!1),onLoadDraft:cr,currentDraftId:qn||void 0}),zs()&&e.jsx(xn,{isOpen:Sr,onClose:()=>pa(!1)}),e.jsx(Bo,{isOpen:Xn,onClose:()=>kr(!1),cartItems:Ne,total:Me,onPaymentComplete:async a=>{var i,b,h;try{if(!f&&!Wa){x.error("Please select a customer or enter customer name");return}const E={customerId:(f==null?void 0:f.id)||null,customerName:(f==null?void 0:f.name)||Wa||"Walk-in Customer",customerPhone:(f==null?void 0:f.phone)||null,customerEmail:(f==null?void 0:f.email)||null,items:Ne.map(R=>({id:R.id,productId:R.productId,variantId:R.variantId,productName:R.productName,variantName:R.variantName,sku:R.sku,quantity:R.quantity,unitPrice:R.unitPrice,totalPrice:R.totalPrice,costPrice:0,profit:0})),subtotal:Re,tax:St,discount:Vt,discountType:Us,discountValue:parseFloat(Bs)||0,total:Me,paymentMethod:{type:"zenopay",details:{transactionId:a.id,provider:"ZenoPay"},amount:Me},paymentStatus:"completed",soldBy:us||"POS User",soldAt:new Date().toISOString(),notes:`ZenoPay Transaction ID: ${a.id||"N/A"}`},Q=await ts.processSale(E);if(Q.success){const R=_e||Ke.current,ue=A==="admin";if(R&&R.id)try{if(ue){console.log("ðŸ“ [ADMIN] Marking trade-in transaction as completed (ZenoPay):",R.id);const{completeTradeInTransaction:me}=await dt(()=>import("./tradeInApi-5d12dbe0.js").then(De=>De.o),["assets/tradeInApi-5d12dbe0.js","assets/vendor-36d2c7c1.js","assets/index-61458a34.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),xe=await me(R.id);xe.success?(console.log("âœ… Trade-in transaction marked as completed (ZenoPay)"),It(xe.data),Ke.current=xe.data,console.log("ðŸ“‹ [ADMIN] Opening pricing modal for trade-in device (ZenoPay)..."),!_e&&Ke.current&&It(Ke.current),Ms(!0)):console.error("âŒ Failed to mark trade-in as completed:",xe.error)}else{console.log("ðŸ“ [CUSTOMER CARE] Marking trade-in as approved (ZenoPay):",R.id);const{data:me,error:xe}=await Te.from("lats_trade_in_transactions").update({status:"approved",approved_at:new Date().toISOString(),approved_by:(m==null?void 0:m.id)||null}).eq("id",R.id).select().single();!xe&&me?(console.log("âœ… Trade-in marked as approved, awaiting admin"),x.success("âœ… Trade-in submitted for admin review. Admin will add device to inventory with pricing."),It(me),Ke.current=me):(console.error("âŒ Failed to mark trade-in as approved:",xe),x.error("Warning: Failed to submit trade-in for approval"))}}catch(me){console.error("âŒ Error updating trade-in status:",me)}const B={id:((i=Q.sale)==null?void 0:i.id)||"",date:new Date().toLocaleDateString(),time:new Date().toLocaleTimeString(),items:Ne.map(me=>{var je,z;const xe=de.find(le=>le.id===me.productId),De=(je=xe==null?void 0:xe.variants)==null?void 0:je.find(le=>le.id===me.variantId);let st=me.attributes||{};if(De!=null&&De.attributes&&(st={...st,...De.attributes}),(z=De==null?void 0:De.attributes)!=null&&z.specification)try{const le=typeof De.attributes.specification=="string"?JSON.parse(De.attributes.specification):De.attributes.specification;typeof le=="object"&&le!==null&&(st={...st,...le})}catch{}return{productName:me.productName,variantName:me.variantName,quantity:me.quantity,unitPrice:me.unitPrice,totalPrice:me.totalPrice,sku:me.sku,image:me.image,selectedSerialNumbers:me.selectedSerialNumbers||[],attributes:st}}),customerName:(f==null?void 0:f.name)||null,customerPhone:(f==null?void 0:f.phone)||null,customerEmail:(f==null?void 0:f.email)||null,customer:f?{name:f.name,phone:f.phone,email:f.email}:null,subtotal:Re,tax:St,discount:Vt,total:Me,paymentMethod:{name:"ZenoPay",description:`ZenoPay - ${Ze.money(Me)}`,icon:"ðŸ’³"},cashier:us||"POS User",receiptNumber:((b=Q.sale)==null?void 0:b.saleNumber)||"N/A"},H=(h=Q.sale)==null?void 0:h.saleNumber;la(B),kr(!1),setTimeout(()=>{k.show(`ZenoPay payment completed successfully!${H?` Sale #${H}`:""}`,{title:"Sale Complete! ðŸŽ‰",icon:Os.saleCompleted,autoCloseDelay:0,actionButtons:[{label:"Share Receipt",onClick:()=>{ks(!0)},variant:"primary"},{label:"New Sale",onClick:()=>{},variant:"secondary"}]})},100),setTimeout(()=>{cs(),_t(null),(async()=>{try{const{childVariantsCacheService:me}=await dt(()=>import("./childVariantsCacheService-9368f4c7.js"),["assets/childVariantsCacheService-9368f4c7.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);me.clearCache(),console.log("âœ… Child variants cache cleared after ZenoPay sale")}catch(me){console.warn("âš ï¸ Failed to clear child variants cache:",me)}})().catch(me=>{console.warn("âš ï¸ Unhandled error in cache clearing:",me)}),be(),c(),console.log("ðŸ§¹ POS: Cart cleared after successful ZenoPay payment")},150)}else throw new Error(Q.error||"Failed to process sale")}catch(E){console.error("Error handling ZenoPay payment completion:",E),x.error(`Payment completed but failed to process sale: ${E instanceof Error?E.message:"Unknown error"}`)}},customer:f}),Pr&&f&&e.jsx(Vo,{isOpen:Pr,onClose:()=>fa(!1),onSuccess:async()=>{const a=_e||Ke.current,i=A==="admin";if(a&&a.id)try{if(i){console.log("ðŸ“ [ADMIN] Marking trade-in as completed (Installment):",a.id);const{completeTradeInTransaction:b}=await dt(()=>import("./tradeInApi-5d12dbe0.js").then(E=>E.o),["assets/tradeInApi-5d12dbe0.js","assets/vendor-36d2c7c1.js","assets/index-61458a34.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),h=await b(a.id);h.success?(console.log("âœ… Trade-in transaction marked as completed (Installment)"),It(h.data),Ke.current=h.data,console.log("ðŸ“‹ [ADMIN] Opening pricing modal for trade-in device (Installment)..."),!_e&&Ke.current&&It(Ke.current),Ms(!0)):console.error("âŒ Failed to mark trade-in as completed:",h.error)}else{console.log("ðŸ“ [CUSTOMER CARE] Marking trade-in as approved (Installment):",a.id);const{data:b,error:h}=await Te.from("lats_trade_in_transactions").update({status:"approved",approved_at:new Date().toISOString(),approved_by:(m==null?void 0:m.id)||null}).eq("id",a.id).select().single();!h&&b?(console.log("âœ… Trade-in marked as approved, awaiting admin"),x.success("âœ… Trade-in submitted for admin review. Admin will add device to inventory with pricing."),It(b),Ke.current=b):(console.error("âŒ Failed to mark trade-in as approved:",h),x.error("Warning: Failed to submit trade-in for approval"))}}catch(b){console.error("âŒ Error updating trade-in status:",b)}fa(!1),cs(),x.success("âœ… Sale completed with installment plan!")},cartItems:Ne,cartTotal:Me,customer:f,currentUser:m}),Cr&&e.jsx(qt.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx(Ba,{size:"sm",color:"orange"})}),children:e.jsx(xi,{isOpen:Cr,onClose:()=>ba(!1),newDevicePrice:Me,onTradeInComplete:Fr})}),_e&&e.jsx(vo,{isOpen:el,transaction:_e,onClose:()=>ya(!1),onContractSigned:fl}),_e&&e.jsx(Wo,{isOpen:tl,transaction:_e,onClose:()=>Ms(!1),onConfirm:bl}),e.jsx(No,{isOpen:sl,onClose:()=>Ir(!1)}),zn&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-3xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col relative",children:[e.jsx("button",{type:"button",onClick:()=>qs(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ns,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Complete Sale"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review your sale details before processing payment"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5 text-blue-600"}),"Sale Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Customer Name"}),e.jsx("p",{className:"font-semibold text-gray-900 truncate",children:f.name})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center",children:f.phone?e.jsx(Jt,{className:"w-5 h-5 text-green-600"}):e.jsx(za,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Contact"}),e.jsx("p",{className:"font-semibold text-gray-900 truncate",children:f.phone||f.email||"N/A"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center",children:e.jsx(Rt,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Sale Date"}),e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),m&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center",children:e.jsx(lo,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Cashier"}),e.jsx("p",{className:"font-semibold text-gray-900 truncate",children:m.fullName||m.email})]})]})]})]}),e.jsx("div",{className:"border-b-2 border-gray-300 my-4"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5 text-purple-600"}),"Sale Items (",Ne.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Ne.map(a=>e.jsxs("div",{className:"p-3 cursor-pointer flex flex-col h-full bg-white rounded-xl border border-gray-200 hover:border-blue-400 hover:shadow-md transition-all duration-200 shadow-sm relative",children:[e.jsx("div",{className:"absolute -top-2 -right-2 p-1.5 rounded-full border-2 border-white shadow-lg flex items-center justify-center z-20 min-w-[2rem] min-h-[2rem] bg-gradient-to-r from-blue-500 to-blue-600",children:e.jsx("span",{className:"text-xs font-bold text-white whitespace-nowrap px-1",children:a.quantity})}),e.jsxs("div",{className:"flex items-start gap-2 md:gap-3",children:[a.image?e.jsx("div",{className:"relative w-16 h-16 md:w-20 md:h-20 rounded-md flex items-center justify-center flex-shrink-0 overflow-hidden",children:e.jsx(Ta,{src:a.image,alt:a.productName,className:"w-full h-full object-cover rounded-md",fallbackText:a.productName.charAt(0).toUpperCase()})}):e.jsx("div",{className:"relative w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-gray-100 to-gray-200 rounded-md flex items-center justify-center flex-shrink-0",children:e.jsx(ut,{className:"w-8 h-8 md:w-10 md:h-10 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800 truncate text-sm md:text-base leading-tight",title:a.productName,children:a.productName}),a.variantName&&a.variantName!=="Default"&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 font-medium",children:a.variantName})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-lg md:text-xl text-gray-700 font-bold",children:Ze.money(a.totalPrice)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[Ze.money(a.unitPrice)," each"]})]})]})]})]},a.id))})]}),e.jsx("div",{className:"border-b-2 border-gray-300 my-4"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ft,{className:"w-5 h-5 text-blue-600"}),"Payment Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 pb-3 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Items"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:Ne.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Quantity"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:Ne.reduce((a,i)=>a+i.quantity,0)})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsx("span",{className:"text-gray-700",children:"Subtotal"}),e.jsx("span",{className:"font-semibold text-gray-900",children:Ze.money(Re)})]}),Lt>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Discount"}),e.jsxs("span",{className:"font-semibold text-red-600",children:["-",Ze.money(Lt)]})]}),wt>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Trade-In Credit"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-",Ze.money(wt)]})]}),St>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Tax"}),e.jsx("span",{className:"font-semibold text-gray-900",children:Ze.money(St)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t-2 border-gray-300",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total Amount"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:Ze.money(wt>0?Me-wt:Me)})]})]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 flex-shrink-0 bg-white px-6 pb-6",children:[e.jsx("button",{type:"button",onClick:()=>qs(!1),className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:gl,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5"}),"Proceed to Payment"]})]})]})}),e.jsx(wo,{isOpen:Ha,onClose:()=>Bt(!1),amount:wt>0?Me-wt:Me,customerId:f==null?void 0:f.id,customerName:(f==null?void 0:f.name)||"Walk-in Customer",description:`POS Sale - ${Ne.length} items${wt>0?` (Trade-In: -${Ze.money(wt)})`:""}`,onPaymentComplete:async(a,i)=>{var b,h,E;try{if(!a||a.length===0)throw new Error("No payment data received");console.log("Processing payments:",{paymentCount:a.length,totalPaid:i,payments:a.map(z=>({method:z.paymentMethod,amount:z.amount,reference:z.reference}))});const Q=wt>0?Me-wt:Me,R=i||Q;Math.abs(R-Q)>1&&console.warn("âš ï¸ Payment amount mismatch:",{totalPaid:R,expectedAmount:Q,finalAmount:Me,tradeInDiscount:wt,difference:Math.abs(R-Q)});let ue=a.map(z=>z.notes).filter(Boolean).join("; ");if(_e&&Kt){const z=`Trade-In: ${_e.device_name} ${_e.device_model} (IMEI: ${_e.device_imei||"N/A"}) - Trade-In Value: ${Ze.money(Kt.final_trade_in_value)} - Customer Payment: ${Ze.money(Kt.customer_payment_amount)} - Transaction ID: ${_e.id}`;ue=ue?`${ue}; ${z}`:z}const B=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,H=Ne.filter(z=>!z.variantId||!B.test(z.variantId)?(console.error("âŒ Invalid cart item detected, removing:",{itemId:z.id,productName:z.productName,variantId:z.variantId}),x.error(`Removed invalid item from cart: ${z.productName} (invalid variant)`),!1):!0);if(H.length===0){x.error("No valid items in cart. Please add items before processing payment."),console.error("âŒ No valid items in cart after filtering");return}if(H.length<Ne.length){Ot(H),x(`Removed ${Ne.length-H.length} invalid item(s) from cart. Please review and try again.`,{icon:"âš ï¸"});return}console.log("ðŸ” Pre-payment stock validation for",H.length,"items...");const me=H.map(z=>({variantId:z.variantId,quantity:z.quantity})),xe=await ts.checkStockAvailabilityBatch(me),De=[];for(const z of H){const le=xe.get(z.variantId);if(!le||!le.available){const $e=`${z.productName} (${z.variantName}): ${(le==null?void 0:le.error)||"Insufficient stock"}`;De.push($e),console.error("âŒ Pre-payment stock validation failed:",{productName:z.productName,variantName:z.variantName,variantId:z.variantId,requestedQuantity:z.quantity,availableStock:(le==null?void 0:le.availableStock)||0,error:le==null?void 0:le.error})}}if(De.length>0){const z=`Cannot process payment. Stock issues detected:
${De.join(`
`)}`;console.error("âŒ Pre-payment stock validation failed:",De),x.error(z,{duration:6e3});const le=H.filter($e=>{const ot=xe.get($e.variantId);return(ot==null?void 0:ot.available)===!0});le.length<H.length&&(Ot(le),le.length===0?x.error("All items were removed due to insufficient stock. Please add items to cart."):x(`${H.length-le.length} item(s) removed due to insufficient stock.`,{icon:"âš ï¸"}));return}console.log("âœ… Pre-payment stock validation passed for all items");const st={customerId:(f==null?void 0:f.id)||null,customerName:(f==null?void 0:f.name)||"Walk-in Customer",customerPhone:(f==null?void 0:f.phone)||null,customerEmail:(f==null?void 0:f.email)||null,items:H.map(z=>({id:z.id,productId:z.productId,variantId:z.variantId,productName:z.productName,variantName:z.variantName,sku:z.sku,quantity:z.quantity,unitPrice:z.unitPrice,totalPrice:z.totalPrice,costPrice:0,profit:0,...z.tags&&z.tags.length>0&&{tags:z.tags},...z.selectedSerialNumbers&&z.selectedSerialNumbers.length>0&&{serialNumbers:z.selectedSerialNumbers}})),subtotal:Re,tax:St,discount:Vt,discountType:Us,discountValue:parseFloat(Bs)||0,tradeInDiscount:wt||0,tradeInTransactionId:(_e==null?void 0:_e.id)||null,total:Me,paymentMethod:{type:a.length===1?a[0].paymentMethod:"multiple",details:{payments:a.map(z=>({method:z.paymentMethod,amount:z.amount,accountId:z.paymentAccountId,reference:z.reference,notes:z.notes,timestamp:z.timestamp})),totalPaid:R,..._e&&{tradeIn:{transactionId:_e.id,deviceName:_e.device_name,deviceModel:_e.device_model,deviceImei:_e.device_imei,tradeInValue:(Kt==null?void 0:Kt.final_trade_in_value)||0}}},amount:R},paymentStatus:"completed",soldBy:us||"POS User",soldAt:new Date().toISOString(),notes:ue||void 0},je=await ts.processSale(st);if(je.success){const z=i||Me,le=(b=je.sale)==null?void 0:b.saleNumber;console.log("ðŸ” Checking for trade-in transaction:",(_e==null?void 0:_e.id)||"none"),console.log("ðŸ” Checking ref for trade-in transaction:",((h=Ke.current)==null?void 0:h.id)||"none");const $e=_e||Ke.current,ot=A==="admin";if($e&&$e.id)try{if(ot){console.log("ðŸ“ [ADMIN] Marking trade-in transaction as completed:",$e.id);const{completeTradeInTransaction:Ie}=await dt(()=>import("./tradeInApi-5d12dbe0.js").then(oe=>oe.o),["assets/tradeInApi-5d12dbe0.js","assets/vendor-36d2c7c1.js","assets/index-61458a34.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),Oe=await Ie($e.id);Oe.success?(console.log("âœ… Trade-in transaction marked as completed"),It(Oe.data),Ke.current=Oe.data,console.log("ðŸ“‹ [ADMIN] Opening pricing modal for trade-in device..."),!_e&&Ke.current&&It(Ke.current),Ms(!0)):(console.error("âŒ Failed to mark trade-in as completed:",Oe.error),x.error("Warning: Failed to mark trade-in as completed"))}else{console.log("ðŸ“ [CUSTOMER CARE] Marking trade-in transaction as approved for admin review:",$e.id);const{data:Ie,error:Oe}=await Te.from("lats_trade_in_transactions").update({status:"approved",approved_at:new Date().toISOString(),approved_by:(m==null?void 0:m.id)||null}).eq("id",$e.id).select().single();!Oe&&Ie?(console.log("âœ… Trade-in marked as approved, awaiting admin to add to inventory"),x.success("âœ… Trade-in submitted for admin review. Admin will add device to inventory with pricing."),It(Ie),Ke.current=Ie):(console.error("âŒ Failed to mark trade-in as approved:",Oe),x.error("Warning: Failed to submit trade-in for approval"))}}catch(Ie){console.error("âŒ Error updating trade-in status:",Ie),x.error("Warning: Failed to update trade-in status")}else console.log("âš ï¸ No trade-in transaction found - pricing modal not shown");const Et={id:((E=je.sale)==null?void 0:E.id)||"",date:new Date().toLocaleDateString(),time:new Date().toLocaleTimeString(),items:Ne.map(Ie=>{var nt,Le,gt,Tt;const Oe=de.find(Se=>Se.id===Ie.productId),oe=(nt=Oe==null?void 0:Oe.variants)==null?void 0:nt.find(Se=>Se.id===Ie.variantId);console.log("ðŸ” Receipt: Processing item:",{productId:Ie.productId,variantId:Ie.variantId,productName:Ie.productName,variantFound:!!oe,variantData:oe?{id:oe.id,hasVariantAttributes:!!oe.variant_attributes,hasAttributes:!!oe.attributes,variantAttributesType:typeof oe.variant_attributes,attributesType:typeof oe.attributes}:null});let Ve=Ie.attributes||{};const at=Se=>{if(!Se)return{};if(typeof Se=="string")try{return JSON.parse(Se)}catch{return{}}return typeof Se=="object"?Se:{}};if(oe!=null&&oe.variant_attributes){const Se=at(oe.variant_attributes);Ve={...Ve,...Se},console.log("âœ… Receipt: Merged variant_attributes:",Se)}if(oe!=null&&oe.variantAttributes){const Se=at(oe.variantAttributes);Ve={...Ve,...Se},console.log("âœ… Receipt: Merged variantAttributes:",Se)}if(oe!=null&&oe.attributes){const Se=at(oe.attributes);Ve={...Ve,...Se},console.log("âœ… Receipt: Merged attributes:",Se)}const Ft=((Le=oe==null?void 0:oe.variant_attributes)==null?void 0:Le.specification)||((gt=oe==null?void 0:oe.variantAttributes)==null?void 0:gt.specification)||((Tt=oe==null?void 0:oe.attributes)==null?void 0:Tt.specification);if(Ft)try{const Se=typeof Ft=="string"?JSON.parse(Ft):Ft;typeof Se=="object"&&Se!==null&&!Array.isArray(Se)&&(Ve={...Ve,...Se},console.log("âœ… Receipt: Merged specification:",Se))}catch(Se){console.warn("âš ï¸ Receipt: Failed to parse specification:",Se)}const Ye=oe!=null&&oe.variant_attributes?at(oe.variant_attributes):{};return Ye&&typeof Ye=="object"&&!Ye.specification&&(Object.keys(Ye).forEach(Se=>{Se!=="id"&&Se!=="created_at"&&Se!=="updated_at"&&Se!=="variant_id"&&Se!=="product_id"&&Se!=="imei"&&Se!=="is_legacy"&&Se!=="is_imei_child"&&(Ve[Se]=Ye[Se])}),console.log("âœ… Receipt: Merged all variant_attributes keys:",Object.keys(Ye))),console.log("ðŸ“‹ Receipt: Final attributes for item:",Ve),{productName:Ie.productName,variantName:Ie.variantName,quantity:Ie.quantity,unitPrice:Ie.unitPrice,totalPrice:Ie.totalPrice,sku:Ie.sku,image:Ie.image,selectedSerialNumbers:Ie.selectedSerialNumbers||[],attributes:Ve}}),customerName:(f==null?void 0:f.name)||null,customerPhone:(f==null?void 0:f.phone)||null,customerEmail:(f==null?void 0:f.email)||null,customer:f?{name:f.name,phone:f.phone,email:f.email}:null,subtotal:Re,tax:St,discount:Vt,tradeInDiscount:wt||0,tradeInDetails:_e?{deviceName:_e.device_name,deviceModel:_e.device_model,deviceImei:_e.device_imei,tradeInValue:(Kt==null?void 0:Kt.final_trade_in_value)||0,conditionRating:_e.condition_rating,transactionId:_e.id}:null,total:Me,paymentMethod:{name:a.length===1?a[0].paymentMethod:"Multiple Payments",description:a.length===1?`${a[0].paymentMethod} - ${Ze.money(a[0].amount)}`:`${a.length} payment methods - ${Ze.money(z)}`,icon:"ðŸ’³"},cashier:us||"POS User",receiptNumber:le||"N/A"};la(Et),Bt(!1),console.log("ðŸŽ‰ POS: About to show success modal"),setTimeout(()=>{k.show(`Payment of ${Ze.money(z)} processed successfully!${le?` Sale #${le}`:""}`,{title:"Sale Complete! ðŸŽ‰",icon:Os.paymentReceived,autoCloseDelay:0,actionButtons:[{label:"Share Receipt",onClick:()=>{ks(!0)},variant:"primary"},{label:"Create Invoice",onClick:()=>{const Ie={invoiceNumber:le||`INV-${Date.now()}`,invoiceDate:new Date().toISOString().split("T")[0],customer:f?{name:f.name,address:f.address||"",phone:f.phone||"",email:f.email||"",taxId:f.taxId||""}:{name:"Walk-in Customer",address:"",phone:"",email:"",taxId:""},items:Ne.map(Oe=>{var Ft,Ye,nt;const oe=de.find(Le=>Le.id===Oe.productId),Ve=(Ft=oe==null?void 0:oe.variants)==null?void 0:Ft.find(Le=>Le.id===Oe.variantId);let at;if((Ye=Ve==null?void 0:Ve.attributes)!=null&&Ye.specification)try{const Le=JSON.parse(Ve.attributes.specification);at=typeof Le=="object"?Le:Ve.attributes.specification}catch{at=Ve.attributes.specification}else if(oe!=null&&oe.specification)try{const Le=JSON.parse(oe.specification);at=typeof Le=="object"?Le:oe.specification}catch{at=oe.specification}else if((nt=oe==null?void 0:oe.attributes)!=null&&nt.specification)try{const Le=JSON.parse(oe.attributes.specification);at=typeof Le=="object"?Le:oe.attributes.specification}catch{at=oe.attributes.specification}else if(Ve!=null&&Ve.attributes&&Object.keys(Ve.attributes).length>0){const Le={...Ve.attributes};delete Le.imei,delete Le.is_legacy,delete Le.is_imei_child,Object.keys(Le).length>0&&(at=Le)}return{description:`${Oe.productName}${Oe.variantName?` - ${Oe.variantName}`:""}`,quantity:Oe.quantity,unitPrice:Oe.unitPrice,total:Oe.totalPrice,specifications:at}}),subtotal:Re,tax:St||0,discount:Vt||0,total:Me,notes:"",terms:"Net 30"};Cs(Ie),Ps(!0)},variant:"primary"},{label:"New Sale",onClick:()=>{},variant:"secondary"}]}),console.log("ðŸŽ‰ POS: Success modal shown, modal state:",k.isOpen)},100),_e||Ke.current?console.log("ðŸ“‹ Trade-in active - cart will clear after pricing is set"):setTimeout(()=>{cs(),_t(null),console.log("ðŸŽ‰ POS: Cart cleared after modal shown")},150)}else{console.error("Sale processing failed:",je.error);const z=je.error||"Failed to process sale";if(z.toLowerCase().includes("insufficient stock")||z.toLowerCase().includes("out of stock")||z.toLowerCase().includes("stock")||z.toLowerCase().includes("available:")||z.toLowerCase().includes("requested:")){console.error("âŒ Stock error detected during sale processing:",z),x.error(`Cannot complete sale: ${z}`,{duration:6e3});const $e=z.match(/for (.+?) \(/);if($e&&$e[1]){const ot=$e[1],Et=Ne.filter(it=>!it.productName.includes(ot));Et.length<Ne.length&&(Ot(Et),x(`Removed "${ot}" from cart due to insufficient stock.`,{icon:"âš ï¸"}))}throw new Error(z)}else throw new Error(z)}}catch(Q){if(console.error("Error processing payment:",Q),Q instanceof Error){const R=Q.message.toLowerCase(),ue=R.includes("insufficient stock")||R.includes("out of stock")||R.includes("stock")||R.includes("available:")||R.includes("requested:");if(["customer information is required","no payment data received","database connection error","invalid payment method","variant not found","invalid variant"].some(me=>R.includes(me))||ue||ue)throw ue?(x.error(`Payment failed: ${Q.message}`,{duration:6e3}),console.error("âŒ Stock error prevented payment:",Q.message)):x.error(`Payment failed: ${Q.message}`,{duration:4e3}),Q;{console.warn("âš ï¸ Non-critical error during payment processing:",Q.message);const me=i||Me;k.show(`Payment of ${Ze.money(me)} processed successfully!`,{title:"Payment Received! ðŸ’°",icon:Os.paymentReceived,autoCloseDelay:3e3}),Bt(!1)}}else{const R=Q instanceof Error?Q.message:"Unknown error occurred";throw x.error(`Payment failed: ${R}`,{duration:4e3}),Q}}},title:"Process POS Payment"}),e.jsx(Oa,{ref:Er,isOpen:Tr,onClose:()=>Zs(!1),activeTab:al,onTabChange:rl,onSaveSettings:async a=>{rt(!0);try{if(!a||typeof a!="object")throw new Error("Invalid settings data");await Ll.saveAllSettings(a),x.success("Settings saved successfully")}catch(i){console.error("Error saving settings:",i),i instanceof Error?i.message.includes("network")||i.message.includes("fetch")?x.error("Network error. Please check your connection and try again."):i.message.includes("permission")||i.message.includes("unauthorized")?x.error("Permission denied. Please check your access rights."):i.message.includes("validation")?x.error("Invalid settings data. Please check your input and try again."):x.error(`Failed to save settings: ${i.message}`):x.error("Failed to save settings. Please try again.")}finally{rt(!1)}},isSaving:Pt}),e.jsx(fn,{isOpen:dr,onClose:()=>ps(!1),onApplyDiscount:zr,onClearDiscount:()=>{hs(0),bs(""),fs("percentage")},currentTotal:Re,hasExistingDiscount:Lt>0}),e.jsx(bn,{isOpen:Dn,onClose:()=>Qa(!1),receipt:Ee,onPrint:a=>{Wn(a)},onEmail:a=>{}}),Un&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"QrCode Scanner"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"text-blue-600 text-2xl mb-2",children:"ðŸ“±"}),e.jsx("p",{className:"text-blue-800 font-medium",children:"External QrCode Scanner"}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:"Use your connected barcode scanner device to scan product barcodes"})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Scanner is ready and waiting for input"})]}),mr&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:mr})}),e.jsx("div",{className:"flex gap-2 justify-end",children:e.jsx("button",{onClick:()=>{l(),il()},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Stop Scanner"})})]})}),e.jsx(ln,{isOpen:Qn,onClose:()=>ga(!1),customer:Kn,onEdit:a=>{_t(a),vr(a),ga(!1)}}),e.jsx(hn,{isOpen:hr,onClose:()=>Es(!1),onContinue:()=>{Es(!1),Bt(!0)},closureTime:$t==null?void 0:$t.closedAt,closedBy:$t==null?void 0:$t.closedBy,userRole:m==null?void 0:m.role}),e.jsx(pn,{isOpen:pr,onClose:()=>Ts(!1),expectedPasscode:(j==null?void 0:j.day_closing_passcode)||"1234",onOpenDay:async()=>{try{const a=new Date().toISOString().split("T")[0],i=new Date().toISOString();console.log("ðŸ”“ Opening new day session...");const{error:b}=await Te.from("daily_sales_closures").eq("date",a).delete();b&&console.error("âŒ Error deleting closure:",b);const{data:h,error:E}=await Te.from("daily_opening_sessions").insert([{date:a,opened_at:i,opened_by:(m==null?void 0:m.role)||"system",opened_by_user_id:m==null?void 0:m.id,is_active:!0,notes:"Day opened after closure"}]).select().single();E?(console.error("âŒ Error creating session:",E),x.error("Failed to create session, but day is opened")):console.log("âœ… New session created:",h),yt(!1),Dt(null),Ts(!1),p(i),x.success("ðŸŽ‰ New day started! Counter reset."),be()}catch(a){console.error("âŒ Error opening day:",a),x.error("Error opening day")}},currentUser:m}),e.jsx(Jr,{isOpen:fr,onClose:()=>As(!1),expectedPasscode:(j==null?void 0:j.day_closing_passcode)||"1234",onComplete:()=>{yt(!0),Dt({closedAt:new Date().toISOString(),closedBy:(m==null?void 0:m.name)||(m==null?void 0:m.email)||"Unknown"}),As(!1)},currentUser:m}),Gn&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Stock Adjustment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:(ys==null?void 0:ys.id)||"",onChange:a=>{const i=ie.find(b=>b.id===a.target.value);yr(i||null)},className:"w-full p-3 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Select a product"}),ie.map(a=>{var i;return e.jsxs("option",{value:a.id,children:[a.name," (Current: ",((i=a.variants)==null?void 0:i.reduce((b,h)=>b+(h.quantity||0),0))||0,")"]},a.id)})]})]}),ys&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Adjustment Amount"}),e.jsx("input",{type:"number",placeholder:"Enter adjustment amount",className:"w-full p-3 border border-gray-300 rounded-lg",id:"adjustmentAmount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason"}),e.jsx("input",{type:"text",placeholder:"Enter reason for adjustment",className:"w-full p-3 border border-gray-300 rounded-lg",id:"adjustmentReason"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-6",children:[e.jsx("button",{onClick:()=>{l(),br(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:()=>{const a=document.getElementById("adjustmentAmount"),i=document.getElementById("adjustmentReason");ys&&a&&i&&cl(ys.id,parseInt(a.value)||0,i.value||"Manual adjustment")},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Adjust Stock"})]})]})}),aa()&&Jn&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add Loyalty Points"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer"}),e.jsxs("select",{value:(f==null?void 0:f.id)||"",onChange:a=>{const i=S.find(b=>b.id===a.target.value);_t(i||null)},className:"w-full p-3 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Select a customer"}),S.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (Current Points: ",typeof xa=="object"?xa[a.id]||0:xa,")"]},a.id))]})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Points to Add"}),e.jsx("input",{type:"number",value:ha,onChange:a=>Nr(a.target.value),placeholder:"Enter points to add",className:"w-full p-3 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason"}),e.jsx("input",{type:"text",value:Yn,onChange:a=>wr(a.target.value),placeholder:"Enter reason for points",className:"w-full p-3 border border-gray-300 rounded-lg"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-6",children:[e.jsx("button",{onClick:()=>{l(),jr(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:()=>{f&&parseInt(ha)>0&&dl(f.id,parseInt(ha))},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Add Points"})]})]})}),ua&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh]",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Receipt History"}),e.jsx("div",{className:"overflow-y-auto max-h-96",children:xr.length>0?e.jsx("div",{className:"space-y-2",children:xr.map(a=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>{Zn(a)},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Receipt #",a.id]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Date: ",new Date(a.date).toLocaleDateString()]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Customer: ",a.customer]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Items: ",a.items]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-lg",children:["$",a.total.toFixed(2)]})})]})},a.id))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No receipt history found"})}),e.jsx("div",{className:"flex gap-2 justify-end mt-4",children:e.jsx("button",{onClick:()=>{l(),Vn(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Close"})})]})}),e.jsx(vn,{draftCount:Is().length,onViewDrafts:()=>Ds(!0),onDismiss:()=>Fn(!1),isVisible:Ln&&Is().length>0}),Ut()&&Xa&&e.jsx(Oo,{isOpen:Xa,onClose:()=>er(!1),onDeliverySet:a=>{er(!1)}}),e.jsx(on,{...k.props}),e.jsx(cn,{isOpen:In,onClose:()=>ks(!1),onPrintReceipt:()=>{Qa(!0),ks(!1)},receiptData:{id:(Ee==null?void 0:Ee.id)||(Ee==null?void 0:Ee.saleId),receiptNumber:(Ee==null?void 0:Ee.receiptNumber)||"N/A",amount:(Ee==null?void 0:Ee.total)||0,customerName:((Ur=Ee==null?void 0:Ee.customer)==null?void 0:Ur.name)||(f==null?void 0:f.name),customerPhone:((Br=Ee==null?void 0:Ee.customer)==null?void 0:Br.phone)||(f==null?void 0:f.phone),customerEmail:((Vr=Ee==null?void 0:Ee.customer)==null?void 0:Vr.email)||(f==null?void 0:f.email),customerCity:((Zr=Ee==null?void 0:Ee.customer)==null?void 0:Zr.city)||(f==null?void 0:f.city),customerTag:((Wr=Ee==null?void 0:Ee.customer)==null?void 0:Wr.colorTag)||((Gr=Ee==null?void 0:Ee.customer)==null?void 0:Gr.customerTag)||(f==null?void 0:f.colorTag)||(f==null?void 0:f.customerTag),items:(Ee==null?void 0:Ee.items)||[]}}),An&&Ct&&ea.createPortal(e.jsx("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[100000]",style:{top:0,left:0,right:0,bottom:0},role:"dialog","aria-modal":"true","aria-labelledby":"invoice-modal-title",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-[95vw] max-w-[1400px] max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:()=>{Ps(!1),Cs(null),os({companyName:"",additionalNotes:"",receiverName:"",receiverAddress:"",receiverPhone:""}),es({paymentMethod:"",paymentReference:"",transactionId:"",paidAmount:0,balance:0,paymentDate:""}),na(!1)},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx($a,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"invoice-modal-title",className:"text-2xl font-bold text-gray-900 mb-3",children:Ct.invoiceNumber.startsWith("PREVIEW")?"Invoice Preview":"Invoice"}),Ct.invoiceNumber.startsWith("PREVIEW")&&e.jsx("p",{className:"text-sm text-blue-600",children:"Review prices before payment"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-4 border border-gray-200 rounded-xl bg-gray-50",children:[e.jsxs("button",{onClick:()=>na(!ra),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-100 transition-colors rounded-t-xl",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Additional Information"}),e.jsx("svg",{className:`w-5 h-5 text-gray-600 transition-transform ${ra?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),ra&&e.jsxs("div",{className:"p-4 space-y-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Customer/Receiver Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Company Name"}),e.jsx("input",{type:"text",value:Mt.companyName,onChange:a=>os({...Mt,companyName:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Receiver Name"}),e.jsx("input",{type:"text",value:Mt.receiverName,onChange:a=>os({...Mt,receiverName:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"If different from customer"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Receiver Address"}),e.jsx("textarea",{value:Mt.receiverAddress,onChange:a=>os({...Mt,receiverAddress:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"If different from customer address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Receiver Phone"}),e.jsx("input",{type:"text",value:Mt.receiverPhone,onChange:a=>os({...Mt,receiverPhone:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Additional Notes"}),e.jsx("textarea",{value:Mt.additionalNotes,onChange:a=>os({...Mt,additionalNotes:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"Any additional information about the customer"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Payment Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Payment Method"}),e.jsxs("select",{value:Nt.paymentMethod,onChange:a=>es({...Nt,paymentMethod:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select method"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"M-Pesa",children:"M-Pesa"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Card",children:"Card"}),e.jsx("option",{value:"ZenoPay",children:"ZenoPay"}),e.jsx("option",{value:"Installment",children:"Installment"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Payment Date"}),e.jsx("input",{type:"date",value:Nt.paymentDate,onChange:a=>es({...Nt,paymentDate:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Payment Reference"}),e.jsx("input",{type:"text",value:Nt.paymentReference,onChange:a=>es({...Nt,paymentReference:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Reference number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Transaction ID"}),e.jsx("input",{type:"text",value:Nt.transactionId,onChange:a=>es({...Nt,transactionId:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Transaction ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Paid Amount (TZS)"}),e.jsx("input",{type:"number",value:Nt.paidAmount||"",onChange:a=>es({...Nt,paidAmount:parseFloat(a.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Balance (TZS)"}),e.jsx("input",{type:"number",value:Nt.balance||"",onChange:a=>es({...Nt,balance:parseFloat(a.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]})]})]})]})]}),e.jsx(li,{invoiceNumber:Ct.invoiceNumber,invoiceDate:Ct.invoiceDate,customer:Ct.customer,items:Ct.items,subtotal:Ct.subtotal,tax:Ct.tax,discount:Ct.discount,total:Ct.total,notes:Ct.notes,terms:Ct.terms,onPrint:()=>window.print(),additionalCustomerInfo:Object.values(Mt).some(a=>a)?Mt:void 0,paymentInfo:Object.values(Nt).some(a=>a!==""&&a!==0)?Nt:void 0})]}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>{Ps(!1),Cs(null),os({companyName:"",additionalNotes:"",receiverName:"",receiverAddress:"",receiverPhone:""}),es({paymentMethod:"",paymentReference:"",transactionId:"",paidAmount:0,balance:0,paymentDate:""}),na(!1)},className:"flex-1 px-6 py-3.5 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 rounded-xl transition-colors font-semibold",children:"Close"}),e.jsxs("button",{onClick:()=>window.print(),className:"flex-1 px-6 py-3.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors font-semibold shadow-lg flex items-center justify-center gap-2",children:[e.jsx(oo,{className:"w-5 h-5"}),"Print Invoice"]})]})})]})}),document.body),lr&&or&&e.jsx(Cn,{isOpen:lr,onClose:()=>{ia(!1),ca(null),da(null)},product:or,onSelectVariant:(a,i,b)=>{ir&&(Ot(h=>h.map(E=>{var Q,R;return E.id===ir.id?{...E,selectedSerialNumbers:i&&((Q=i.attributes)!=null&&Q.imei||i.is_legacy||i.is_imei_child)?[i]:[],selectedIMEIVariants:i&&((R=i.attributes)!=null&&R.imei||i.is_legacy||i.is_imei_child)?[i]:[]}:E})),x.success("IMEI/Serial number selected successfully"),console.log("âœ… Updated cart item with IMEI variant:",i)),ia(!1),ca(null),da(null)}}),e.jsx(Po,{}),e.jsx(Co,{isOpen:Rn,onClose:()=>oa(!1),onSuccess:()=>{x.success("Expense recorded successfully"),oa(!1)}})]})},lc=Object.freeze(Object.defineProperty({__proto__:null,default:pi},Symbol.toStringTag,{value:"Module"}));export{lc as P,Io as u};
