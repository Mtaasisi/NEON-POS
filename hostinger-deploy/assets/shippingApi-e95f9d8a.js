import{s as o}from"./index-61458a34.js";const n={getAll:async(t=!1)=>{try{let r=o.from("lats_shipping_agents").select("*").order("is_preferred",{ascending:!1}).order("name",{ascending:!0});t&&(r=r.eq("is_active",!0));const{data:e,error:s}=await r;if(s)throw s;return e||[]}catch(r){throw console.error("Error fetching shipping agents:",r),r}},getById:async t=>{try{const{data:r,error:e}=await o.from("lats_shipping_agents").select("*").eq("id",t).single();if(e)throw e;return r}catch(r){throw console.error("Error fetching shipping agent:",r),r}},getByMethod:async t=>{try{const{data:r,error:e}=await o.from("lats_shipping_agents").select("*").contains("shipping_methods",[t]).eq("is_active",!0).order("is_preferred",{ascending:!1}).order("rating",{ascending:!1});if(e)throw e;return r||[]}catch(r){throw console.error("Error fetching agents by method:",r),r}},create:async t=>{try{const{data:r,error:e}=await o.from("lats_shipping_agents").insert(t).select().single();if(e)throw e;return r}catch(r){throw console.error("Error creating shipping agent:",r),r}},update:async(t,r)=>{try{const{data:e,error:s}=await o.from("lats_shipping_agents").update(r).eq("id",t).select().single();if(s)throw s;return e}catch(e){throw console.error("Error updating shipping agent:",e),e}},delete:async t=>{try{const{error:r}=await o.from("lats_shipping_agents").delete().eq("id",t);if(r)throw r}catch(r){throw console.error("Error deleting shipping agent:",r),r}},updateRating:async(t,r)=>{try{const{error:e}=await o.from("lats_shipping_agents").update({rating:r}).eq("id",t);if(e)throw e}catch(e){throw console.error("Error updating agent rating:",e),e}},incrementShipmentCount:async(t,r=!0)=>{try{const e=await n.getById(t);if(!e)throw new Error("Agent not found");const s={total_shipments:(e.total_shipments||0)+1};r&&(s.successful_shipments=(e.successful_shipments||0)+1),await n.update(t,s)}catch(e){throw console.error("Error incrementing shipment count:",e),e}}},h={getAll:async(t=!1)=>{try{let r=o.from("lats_shipping_methods").select("*").order("display_order",{ascending:!0}).order("name",{ascending:!0});t&&(r=r.eq("is_active",!0));const{data:e,error:s}=await r;if(s)throw s;return e||[]}catch(r){throw console.error("Error fetching shipping methods:",r),r}},getByCode:async t=>{try{const{data:r,error:e}=await o.from("lats_shipping_methods").select("*").eq("code",t).single();if(e)throw e;return r}catch(r){throw console.error("Error fetching shipping method:",r),r}},create:async t=>{try{const{data:r,error:e}=await o.from("lats_shipping_methods").insert(t).select().single();if(e)throw e;return r}catch(r){throw console.error("Error creating shipping method:",r),r}},update:async(t,r)=>{try{const{data:e,error:s}=await o.from("lats_shipping_methods").update(r).eq("id",t).select().single();if(s)throw s;return e}catch(e){throw console.error("Error updating shipping method:",e),e}},delete:async t=>{try{const{error:r}=await o.from("lats_shipping_methods").delete().eq("id",t);if(r)throw r}catch(r){throw console.error("Error deleting shipping method:",r),r}}},i={get:async()=>{try{const{data:t,error:r}=await o.from("lats_shipping_settings").select("*").limit(1).single();if(r&&r.code!=="PGRST116")throw r;return t||null}catch(t){return console.error("Error fetching shipping settings:",t),null}},save:async t=>{try{const r=await i.get();if(r){const{data:e,error:s}=await o.from("lats_shipping_settings").update(t).eq("id",r.id).select().single();if(s)throw s;return e}else{const{data:e,error:s}=await o.from("lats_shipping_settings").insert(t).select().single();if(s)throw s;return e}}catch(r){throw console.error("Error saving shipping settings:",r),r}}},c={getByPOId:async t=>{try{const{data:r,error:e}=await o.from("lats_purchase_order_shipping").select("*").eq("purchase_order_id",t).single();if(e&&e.code!=="PGRST116")throw e;return r||null}catch(r){return console.error("Error fetching PO shipping info:",r),null}},upsert:async t=>{try{const r=await c.getByPOId(t.purchase_order_id);if(r){const{data:e,error:s}=await o.from("lats_purchase_order_shipping").update(t).eq("id",r.id).select().single();if(s)throw s;return e}else{const{data:e,error:s}=await o.from("lats_purchase_order_shipping").insert(t).select().single();if(s)throw s;return e}}catch(r){throw console.error("Error upserting PO shipping info:",r),r}},updateStatus:async(t,r)=>{try{const{error:e}=await o.from("lats_purchase_order_shipping").update({shipping_status:r}).eq("purchase_order_id",t);if(e)throw e}catch(e){throw console.error("Error updating shipping status:",e),e}},updateTracking:async(t,r)=>{try{const{error:e}=await o.from("lats_purchase_order_shipping").update(r).eq("purchase_order_id",t);if(e)throw e}catch(e){throw console.error("Error updating tracking info:",e),e}},delete:async t=>{try{const{error:r}=await o.from("lats_purchase_order_shipping").delete().eq("purchase_order_id",t);if(r)throw r}catch(r){throw console.error("Error deleting shipping info:",r),r}}},p=(t,r)=>{const e=r||new Date,s=t.estimated_days_max||7,a=new Date(e);return a.setDate(a.getDate()+s),a},g=(t,r,e)=>{const s=r.code==="air"?t.base_rate_air||0:t.base_rate_sea||0,a=r.cost_multiplier||1;return s*a},l=(t,r=2)=>t*r/100,u={agents:n,methods:h,settings:i,poShipping:c,calculateEstimatedDelivery:p,calculateShippingCost:g,calculateInsurance:l};export{u as s};
