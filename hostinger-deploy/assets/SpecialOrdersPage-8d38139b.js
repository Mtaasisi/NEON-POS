import{s as S,u as st,b as at,y as lt,a as nt,j as e,X as ot}from"./index-61458a34.js";import{r as m,R as ge,b as Y}from"./vendor-36d2c7c1.js";import{B as it}from"./BackButton-02a80e74.js";import{bd as Se,N as Ie,R as ct,u as X,y as dt,d as z,q as ie,v as G,b6 as ke,a as ut,b as mt,Q as fe,a3 as xt,aT as Ze,Y as pt,X as U,s as ht,n as A,c4 as gt,e as ft}from"./ui-28e30067.js";import{T as bt}from"./SkeletonLoaders-da70324a.js";import{u as Ue}from"./useBodyScrollLock-341c8b9f.js";import{E as yt}from"./EnhancedAddSupplierModal-988446e5.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";function Ke(N,a="id"){const i=m.useRef(`render-${Date.now()}-${Math.random().toString(36).substring(2,9)}`),l=m.useMemo(()=>{const d=new Map;let o=0;return N.forEach((c,u)=>{if(!c||!c[a]){console.warn(`useDeduplicated: Item at index ${u} is missing ${String(a)}`,c);return}const E=String(c[a]);d.has(E)?o++:d.set(E,c)}),o>0&&console.warn(`useDeduplicated: Found and removed ${o} duplicate(s) from ${N.length} items using key field "${String(a)}"`),Array.from(d.values())},[N,a]);return{items:l,getKey:(d,o)=>`${i.current}-${String(d)}-${o}`,originalCount:N.length,deduplicatedCount:l.length,hasDuplicates:N.length!==l.length}}class jt{async generateOrderNumber(){const{data:a,error:i}=await S.from("customer_special_orders").select("order_number").order("created_at",{ascending:!1}).limit(1);if(i)return console.error("Error fetching last order number:",i),`SPO-${Date.now().toString().slice(-6)}`;if(!a||a.length===0)return"SPO-001";const s=a[0].order_number.match(/SPO-(\d+)/);return s?`SPO-${(parseInt(s[1])+1).toString().padStart(3,"0")}`:`SPO-${Date.now().toString().slice(-6)}`}async createSpecialOrder(a,i){try{const l=await this.generateOrderNumber(),s=a.total_amount-a.deposit_paid,d={order_number:l,customer_id:a.customer_id,product_name:a.product_name,product_description:a.product_description||null,quantity:a.quantity,unit_price:a.unit_price,total_amount:a.total_amount,deposit_paid:a.deposit_paid,balance_due:s,expected_arrival_date:a.expected_arrival_date&&a.expected_arrival_date.trim()!==""?a.expected_arrival_date:null,supplier_name:a.supplier_name||null,supplier_reference:a.supplier_reference||null,country_of_origin:a.country_of_origin||null,tracking_number:a.tracking_number||null,notes:a.notes||null,internal_notes:a.internal_notes||null,status:"deposit_received",created_by:i},{data:o,error:c}=await S.from("customer_special_orders").insert(d).select().single();if(c)throw c;if(a.deposit_paid>0){const{error:u}=await S.from("special_order_payments").insert({special_order_id:o.id,customer_id:a.customer_id,amount:a.deposit_paid,payment_method:a.payment_method,account_id:a.account_id,reference_number:`${l}-DEPOSIT`,notes:"Initial deposit",created_by:i});u&&console.error("Error recording deposit payment:",u),await this.updateFinanceAccount(a.account_id,a.deposit_paid)}return await this.sendOrderCreatedNotification(o.id,i),{success:!0,order:o}}catch(l){return console.error("Error creating special order:",l),{success:!1,error:l.message}}}async updateSpecialOrder(a,i,l){try{const s={...i,updated_at:new Date().toISOString()};"expected_arrival_date"in s&&(s.expected_arrival_date=s.expected_arrival_date&&s.expected_arrival_date.trim()!==""?s.expected_arrival_date:null),"actual_arrival_date"in s&&(s.actual_arrival_date=s.actual_arrival_date&&s.actual_arrival_date.trim()!==""?s.actual_arrival_date:null),["tracking_number","supplier_reference","notes","internal_notes"].forEach(u=>{u in s&&s[u]===""&&(s[u]=null)});const{data:o,error:c}=await S.from("customer_special_orders").update(s).eq("id",a).select().single();if(c)throw c;return i.status&&await this.sendStatusUpdateNotification(a,i.status,l),{success:!0,order:o}}catch(s){return console.error("Error updating special order:",s),{success:!1,error:s.message}}}async recordPayment(a,i){try{const{data:l,error:s}=await S.from("special_order_payments").insert({...a,created_by:i}).select().single();if(s)throw s;return await this.updateFinanceAccount(a.account_id,a.amount),await this.sendPaymentReceivedNotification(a.special_order_id,a.amount,i),{success:!0,payment:l}}catch(l){return console.error("Error recording payment:",l),{success:!1,error:l.message}}}async getAllSpecialOrders(a){try{let i=S.from("customer_special_orders").select(`
          *,
          customer:customers(id, name, phone, email),
          payments:special_order_payments!special_order_id(*)
        `).order("created_at",{ascending:!1});a&&(i=i.eq("branch_id",a));const{data:l,error:s}=await i;if(s)throw s;return l||[]}catch(i){return console.error("Error fetching special orders:",i),[]}}async getSpecialOrderById(a){try{const{data:i,error:l}=await S.from("customer_special_orders").select(`
          *,
          customer:customers(id, name, phone, email),
          payments:special_order_payments!special_order_id(*)
        `).eq("id",a).single();if(l)throw l;return i}catch(i){return console.error("Error fetching special order:",i),null}}async getCustomerSpecialOrders(a){try{const{data:i,error:l}=await S.from("customer_special_orders").select("*").eq("customer_id",a).order("created_at",{ascending:!1});if(l)throw l;return i||[]}catch(i){return console.error("Error fetching customer special orders:",i),[]}}async getStatistics(a){try{let i=S.from("customer_special_orders").select("*");a&&(i=i.eq("branch_id",a));const{data:l,error:s}=await i;if(s)throw s;const d=l||[];return{total:d.length,deposit_received:d.filter(c=>c.status==="deposit_received").length,ordered:d.filter(c=>c.status==="ordered").length,in_transit:d.filter(c=>c.status==="in_transit").length,arrived:d.filter(c=>c.status==="arrived").length,ready_for_pickup:d.filter(c=>c.status==="ready_for_pickup").length,delivered:d.filter(c=>c.status==="delivered").length,cancelled:d.filter(c=>c.status==="cancelled").length,total_value:d.reduce((c,u)=>c+Number(u.total_amount||0),0),total_deposits:d.reduce((c,u)=>c+Number(u.deposit_paid||0),0),total_balance_due:d.reduce((c,u)=>c+Number(u.balance_due||0),0)}}catch(i){return console.error("Error calculating statistics:",i),{total:0,deposit_received:0,ordered:0,in_transit:0,arrived:0,ready_for_pickup:0,delivered:0,cancelled:0,total_value:0,total_deposits:0,total_balance_due:0}}}async deleteSpecialOrder(a){try{const{error:i}=await S.from("customer_special_orders").delete().eq("id",a);if(i)throw i;return{success:!0}}catch(i){return console.error("Error deleting special order:",i),{success:!1,error:i.message}}}async updateFinanceAccount(a,i){try{const{data:l,error:s}=await S.from("finance_accounts").select("balance").eq("id",a).single();if(s||!l){console.error("Error fetching finance account:",s);return}const d=Number(l.balance)+i,{error:o}=await S.from("finance_accounts").update({balance:d,updated_at:new Date().toISOString()}).eq("id",a);o&&console.error("Error updating finance account:",o)}catch(l){console.error("Error in updateFinanceAccount:",l)}}async sendOrderCreatedNotification(a,i){try{const l=await this.getSpecialOrderById(a);if(!l||!l.customer)return;const s=`âœ… Special Order Confirmed!

Thank you for your order ${l.order_number}!

Product: ${l.product_name}
Quantity: ${l.quantity}
Total: ${this.formatCurrency(l.total_amount)}
Deposit Paid: ${this.formatCurrency(l.deposit_paid)}
Balance: ${this.formatCurrency(l.balance_due)}

${l.expected_arrival_date?`Expected Arrival: ${this.formatDate(l.expected_arrival_date)}
`:""}We'll keep you updated on your order status!`;try{await S.from("notifications").insert({user_id:i,type:"payment",category:"payment",title:"Special Order Created",message:`Order ${l.order_number} created for ${l.customer.name}`,priority:"normal",status:"unread",metadata:{orderId:l.id,orderNumber:l.order_number}})}catch(d){console.error("Error creating notification:",d)}}catch(l){console.error("Error sending order created notification:",l)}}async sendStatusUpdateNotification(a,i,l){try{const s=await this.getSpecialOrderById(a);if(!s||!s.customer)return;const d={deposit_received:"âœ… Deposit Received",ordered:"ðŸ“¦ Ordered from Supplier",in_transit:"ðŸš¢ In Transit",arrived:"âœ¨ Arrived at Store",ready_for_pickup:"ðŸŽ‰ Ready for Pickup",delivered:"âœ… Delivered",cancelled:"âŒ Cancelled"},o={deposit_received:`Your deposit of ${this.formatCurrency(s.deposit_paid)} has been received for order ${s.order_number}.`,ordered:`Good news! We've ordered your ${s.product_name} from ${s.country_of_origin||"our supplier"}. ${s.tracking_number?`Tracking: ${s.tracking_number}`:"We'll update you when it ships."}`,in_transit:`Your ${s.product_name} is on the way! ${s.expected_arrival_date?`Expected arrival: ${this.formatDate(s.expected_arrival_date)}`:""}`,arrived:`Great news! Your ${s.product_name} has arrived!${s.balance_due>0?`

Balance due: ${this.formatCurrency(s.balance_due)}
Please visit us to collect your order.`:`
Ready for pickup!`}`,ready_for_pickup:`Your ${s.product_name} is ready for pickup! Please visit our store to collect it.`,delivered:`Thank you! Your order ${s.order_number} has been completed. We hope you enjoy your ${s.product_name}!`,cancelled:`Your order ${s.order_number} has been cancelled. Please contact us if you have any questions.`},c=d[i],u=`${c}

Order: ${s.order_number}
Product: ${s.product_name}

${o[i]}`;try{await S.from("notifications").insert({user_id:l,type:"system",category:"general",title:c,message:`Order ${s.order_number} - ${s.product_name}`,priority:i==="arrived"?"high":"normal",status:"unread",metadata:{orderId:s.id,status:i}})}catch(E){console.error("Error creating notification:",E)}}catch(s){console.error("Error sending status update notification:",s)}}async sendPaymentReceivedNotification(a,i,l){try{const s=await this.getSpecialOrderById(a);if(!s||!s.customer)return;const d=`âœ… Payment Received!

Order: ${s.order_number}
Product: ${s.product_name}

Amount Paid: ${this.formatCurrency(i)}
Total Paid: ${this.formatCurrency(s.deposit_paid)}
Remaining Balance: ${this.formatCurrency(s.balance_due)}

Thank you for your payment!`;try{await S.from("notifications").insert({user_id:l,type:"payment",category:"payment",title:"Payment Received",message:`${this.formatCurrency(i)} received for order ${s.order_number}`,priority:"normal",status:"unread",metadata:{orderId:s.id,amount:i}})}catch(o){console.error("Error creating notification:",o)}}catch(s){console.error("Error sending payment received notification:",s)}}formatCurrency(a){return new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(a)}formatDate(a){return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}}const ce=new jt,Tt=()=>{const{currentUser:N}=st(),{customers:a}=at(),{currentBranch:i}=lt(),{startLoading:l,completeLoading:s,failLoading:d}=nt(),[o,c]=m.useState([]),[u,E]=m.useState(null),[x,j]=m.useState(!0),[H,K]=m.useState(!1),[W,b]=m.useState(!1),[f,P]=m.useState(!1),[M,T]=m.useState(null),[L,V]=m.useState("all"),[$,se]=m.useState(""),[F,J]=m.useState([]),[Ce,be]=m.useState(null),I=async()=>{const n=l("Loading special orders...");j(!0);try{const v=await ce.getAllSpecialOrders(i==null?void 0:i.id);c(v);const k=await ce.getStatistics(i==null?void 0:i.id);E(k),s(n)}catch(v){console.error("Error fetching special orders:",v),d(n,"Failed to load special orders"),A.error("Failed to load special orders")}finally{j(!1)}},ee=async()=>{try{const n=await ot.getPaymentMethods(),v=n.filter(y=>y?y.id?y.name?!0:(console.warn("Found account without name:",y),!1):(console.warn("Found account without ID:",y),!1):(console.warn("Found null/undefined account in payment methods"),!1)),k=new Map,D=new Set;v.forEach(y=>{k.has(y.id)?(D.add(y.id),console.warn(`Duplicate payment account ID found: ${y.id} (${y.name})`)):k.set(y.id,y)});const q=Array.from(k.values());console.log("[SpecialOrders] Payment accounts summary:",{total:n.length,valid:v.length,unique:q.length,duplicates:D.size,duplicateIds:Array.from(D)}),J(q)}catch(n){console.error("Error fetching payment accounts:",n),J([])}};m.useEffect(()=>{I(),ee()},[i]);const ae=m.useMemo(()=>o.filter(n=>{var D;const v=L==="all"||n.status===L,k=$===""||n.order_number.toLowerCase().includes($.toLowerCase())||n.product_name.toLowerCase().includes($.toLowerCase())||((D=n.customer)==null?void 0:D.name.toLowerCase().includes($.toLowerCase()));return v&&k}),[o,L,$]),te=n=>({deposit_received:"bg-blue-100 text-blue-700",ordered:"bg-purple-100 text-purple-700",in_transit:"bg-yellow-100 text-yellow-700",arrived:"bg-green-100 text-green-700",ready_for_pickup:"bg-emerald-100 text-emerald-700",delivered:"bg-gray-100 text-gray-700",cancelled:"bg-red-100 text-red-700"})[n]||"bg-gray-100 text-gray-700",ye=n=>({deposit_received:e.jsx(ie,{size:14}),ordered:e.jsx(X,{size:14}),in_transit:e.jsx(Se,{size:14}),arrived:e.jsx(gt,{size:14}),ready_for_pickup:e.jsx(ft,{size:14}),delivered:e.jsx(z,{size:14}),cancelled:e.jsx(U,{size:14})})[n],R=n=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(n),de=async n=>{if(!confirm("Are you sure you want to delete this special order?"))return;const v=await ce.deleteSpecialOrder(n);v.success?(A.success("Special order deleted successfully"),I()):A.error(v.error||"Failed to delete order")};return x?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:e.jsx(bt,{})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col max-h-[95vh]",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Se,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Special Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage pre-orders and import requests"})]})]}),e.jsx(it,{to:"/dashboard",label:"",className:"!w-12 !h-12 !p-0 !rounded-full !bg-blue-600 hover:!bg-blue-700 !shadow-lg flex items-center justify-center",iconClassName:"text-white"})]})}),e.jsx("div",{className:"px-8 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100/50 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>K(!0),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg hover:from-blue-600 hover:to-blue-700 hover:shadow-xl",children:[e.jsx(Ie,{size:18}),e.jsx("span",{children:"New Special Order"})]}),e.jsxs("button",{onClick:I,disabled:x,className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 border-2 border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-blue-300 disabled:opacity-50 bg-white shadow-sm",children:[x?e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}):e.jsx(ct,{className:"w-4 h-4"}),e.jsx("span",{children:"Refresh"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[u&&e.jsx("div",{className:"p-6 pb-0 flex-shrink-0",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(220px, 100%), 1fr))",gap:"1rem"},children:[e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-2xl p-5 hover:bg-blue-100 hover:border-blue-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(X,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.total})]})]})}),e.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-5 hover:bg-orange-100 hover:border-orange-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(dt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.deposit_received+u.ordered+u.in_transit})]})]})}),e.jsx("div",{className:"bg-green-50 border-2 border-green-200 rounded-2xl p-5 hover:bg-green-100 hover:border-green-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(z,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Ready"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.arrived+u.ready_for_pickup})]})]})}),e.jsx("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-2xl p-5 hover:bg-purple-100 hover:border-purple-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(ie,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Balance Due"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R(u.total_balance_due)})]})]})})]})}),e.jsx("div",{className:"p-6 pb-0 flex-shrink-0 border-t border-gray-100 bg-white",children:e.jsx("div",{className:"bg-white rounded-2xl border-2 border-gray-200 p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search orders, products, customers...",value:$,onChange:n=>se(n.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all text-gray-900 bg-white font-medium"})]})}),e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:e.jsxs("select",{value:L,onChange:n=>V(n.target.value),className:"px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all text-gray-900 bg-white font-medium min-w-[140px]",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"deposit_received",children:"Deposit Received"}),e.jsx("option",{value:"ordered",children:"Ordered"}),e.jsx("option",{value:"in_transit",children:"In Transit"}),e.jsx("option",{value:"arrived",children:"Arrived"}),e.jsx("option",{value:"ready_for_pickup",children:"Ready for Pickup"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]})})}),e.jsx("div",{className:"p-6",children:ae.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50 rounded-2xl p-16 text-center border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl",children:e.jsx(Se,{className:"w-12 h-12 text-white"})}),e.jsx("p",{className:"text-gray-800 text-xl font-bold mb-2",children:"No special orders found"}),e.jsx("p",{className:"text-gray-500 text-sm mb-6",children:$||L!=="all"?"Try adjusting your search or filters":"Create your first special order to get started"}),e.jsxs("button",{onClick:()=>K(!0),className:"px-8 py-3.5 rounded-xl font-semibold bg-gradient-to-r from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl inline-flex items-center gap-2",children:[e.jsx(Ie,{size:20}),"Create First Special Order"]})]}):e.jsx("div",{className:"space-y-4",children:ae.map(n=>{var k,D,q;const v=Ce===n.id;return e.jsxs("div",{className:`bg-white rounded-2xl border-2 transition-all duration-200 overflow-hidden ${v?"border-blue-400 shadow-2xl":"border-gray-200 hover:border-blue-300 hover:shadow-xl"}`,children:[e.jsx("div",{className:"p-6 cursor-pointer",onClick:()=>be(v?null:n.id),children:e.jsxs("div",{className:"flex items-start justify-between gap-6",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl shadow-sm flex-shrink-0 transition-all ${v?"bg-gradient-to-br from-blue-500 to-blue-600":"bg-gradient-to-br from-blue-100 to-blue-200"}`,children:e.jsx(Se,{className:`w-6 h-6 ${v?"text-white":"text-blue-700"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:n.order_number}),e.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 shadow-sm ${te(n.status)}`,children:[ye(n.status),n.status.replace(/_/g," ").toUpperCase()]})]}),e.jsx("p",{className:"text-base font-semibold text-gray-800 mb-2 truncate",children:n.product_name}),!v&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ke,{className:"w-4 h-4"}),(k=n.customer)==null?void 0:k.name]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"font-medium",children:["Qty: ",n.quantity]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"font-bold text-orange-600",children:[R(n.balance_due)," due"]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[!v&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:R(n.total_amount)}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total"})]}),e.jsx("button",{type:"button",onClick:y=>{y.stopPropagation(),be(v?null:n.id)},className:`p-2 rounded-lg transition-all ${v?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-blue-50 hover:text-blue-600"}`,children:v?e.jsx(ut,{className:"w-5 h-5"}):e.jsx(mt,{className:"w-5 h-5"})})]})]})}),v&&e.jsxs("div",{className:"border-t-2 border-blue-100 bg-gradient-to-br from-blue-50/30 to-purple-50/30 p-6 space-y-6 animate-in slide-in-from-top",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border-2 border-blue-200 p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"Customer Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:(D=n.customer)==null?void 0:D.name})]}),((q=n.customer)==null?void 0:q.phone)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsx("span",{className:"font-medium text-gray-900",children:n.customer.phone})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border-2 border-purple-200 p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Product Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-semibold text-gray-900 truncate ml-2",children:n.product_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Quantity:"}),e.jsx("span",{className:"font-bold text-gray-900",children:n.quantity})]}),n.product_description&&e.jsx("div",{className:"pt-2 border-t border-purple-100",children:e.jsx("span",{className:"text-xs text-gray-500",children:n.product_description})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border-2 border-green-200 p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-green-900 mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Financial Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Unit Price:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:R(n.unit_price)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Amount:"}),e.jsx("span",{className:"font-bold text-gray-900",children:R(n.total_amount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600",children:"Paid:"}),e.jsx("span",{className:"font-bold text-green-600",children:R(n.deposit_paid)})]}),n.balance_due>0&&e.jsxs("div",{className:"flex justify-between pt-2 border-t border-green-100",children:[e.jsx("span",{className:"text-orange-600 font-medium",children:"Balance Due:"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:R(n.balance_due)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border-2 border-orange-200 p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-orange-900 mb-3 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Shipping & Supplier"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[n.supplier_name&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Supplier:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:n.supplier_name})]}),n.country_of_origin&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Origin:"}),e.jsx("span",{className:"font-medium text-gray-900",children:n.country_of_origin})]}),n.tracking_number&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tracking:"}),e.jsx("span",{className:"font-mono text-xs text-gray-900",children:n.tracking_number})]}),n.expected_arrival_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expected:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(n.expected_arrival_date).toLocaleDateString()})]})]})]})]}),(n.notes||n.internal_notes)&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),"Notes"]}),e.jsxs("div",{className:"space-y-3",children:[n.notes&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Customer Notes:"}),e.jsx("div",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded-lg",children:n.notes})]}),n.internal_notes&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Internal Notes:"}),e.jsx("div",{className:"text-sm text-gray-700 bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:n.internal_notes})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[n.balance_due>0&&e.jsxs("button",{onClick:y=>{y.stopPropagation(),T(n),b(!0)},className:"px-6 py-3.5 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 transition-all shadow-lg hover:shadow-xl font-bold flex items-center justify-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Record Payment"]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),T(n),P(!0)},className:"px-6 py-3.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl font-bold flex items-center justify-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),"Update Status"]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),de(n.id)},className:"px-6 py-3.5 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 transition-all shadow-lg hover:shadow-xl font-bold flex items-center justify-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5"}),"Delete"]})]})]})]},n.id)})})})]})]}),H&&e.jsx(vt,{isOpen:H,onClose:()=>K(!1),onSuccess:()=>{K(!1),I()},customers:a,paymentAccounts:F,currentUser:N},"create-special-order-modal"),W&&M&&e.jsx(Nt,{isOpen:W,onClose:()=>{b(!1),T(null)},onSuccess:()=>{b(!1),T(null),I()},order:M,paymentAccounts:F,currentUser:N}),f&&M&&e.jsx(wt,{isOpen:f,onClose:()=>{P(!1),T(null)},onSuccess:()=>{P(!1),T(null),I()},order:M,currentUser:N})]})},vt=({isOpen:N,onClose:a,onSuccess:i,customers:l,paymentAccounts:s,currentUser:d})=>{var Le,Re,Be;const[o,c]=m.useState({customer_id:"",product_name:"",product_description:"",quantity:1,unit_price:0,total_amount:0,deposit_paid:0,supplier_name:"",supplier_reference:"",country_of_origin:"",tracking_number:"",expected_arrival_date:"",notes:"",internal_notes:"",payment_method:"cash",account_id:""}),[u,E]=m.useState(!1),[x,j]=m.useState(1),H=4,K=m.useMemo(()=>{const t=(s||[]).filter(h=>h&&h.id),r=new Map;return t.forEach(h=>{r.has(h.id)||r.set(h.id,h)}),Array.from(r.values())},[s]),{items:W,getKey:b}=Ke(K),[f,P]=m.useState(""),[M,T]=m.useState(!1),[L,V]=m.useState(-1),[$,se]=m.useState(null),F=ge.useRef(null),[J,Ce]=m.useState([]),[be,I]=m.useState(!1),[ee,ae]=m.useState(null),[te,ye]=m.useState(""),[R,de]=m.useState(!1),[n,v]=m.useState([]),[k,D]=m.useState(""),[q,y]=m.useState(!1),[Pe,le]=m.useState(-1),[O,ue]=m.useState(null),Q=ge.useRef(null),[ne,$e]=m.useState({top:0,left:0,width:0}),[oe,De]=m.useState({top:0,left:0,width:0}),[We,me]=m.useState(!1),[C,xe]=m.useState(null),[je,Oe]=m.useState(null);Ue(N),m.useEffect(()=>{const t=()=>{if(M&&F.current){const r=F.current.getBoundingClientRect();De({top:r.bottom,left:r.left,width:r.width})}if(q&&Q.current){const r=Q.current.getBoundingClientRect();$e({top:r.bottom,left:r.left,width:r.width})}};if(N)return window.addEventListener("scroll",t,!0),window.addEventListener("resize",t),t(),()=>{window.removeEventListener("scroll",t,!0),window.removeEventListener("resize",t)}},[N,M,q]);const B=ge.useMemo(()=>{const t=new Map;l.forEach(p=>{p&&p.id&&!t.has(p.id)&&t.set(p.id,p)});const r=Array.from(t.values());if(!f.trim())return r.slice(0,50);const h=f.toLowerCase();return r.filter(p=>{var w,g;return((w=p.name)==null?void 0:w.toLowerCase().includes(h))||((g=p.phone)==null?void 0:g.toLowerCase().includes(h))})},[f,l]),Fe=t=>{se(t),P(t.name),c(r=>({...r,customer_id:t.id})),T(!1),V(-1)},Ve=t=>{if(P(t),T(!0),V(-1),F.current){const r=F.current.getBoundingClientRect();De({top:r.bottom,left:r.left,width:r.width})}t.trim()||(se(null),c(r=>({...r,customer_id:""})))},Qe=t=>{!M||B.length===0||(t.key==="ArrowDown"?(t.preventDefault(),V(r=>r<B.length-1?r+1:r)):t.key==="ArrowUp"?(t.preventDefault(),V(r=>r>0?r-1:-1)):t.key==="Enter"&&L>=0?(t.preventDefault(),Fe(B[L])):t.key==="Escape"&&(T(!1),V(-1)))},qe=async()=>{try{const{data:t,error:r}=await S.from("lats_suppliers").select("*").eq("is_active",!0).order("name");if(r)throw r;Ce(t||[])}catch(t){console.error("Error loading suppliers:",t)}};m.useEffect(()=>{const t=async()=>{try{const{data:r,error:h}=await S.from("lats_products").select(`
            *,
            lats_product_variants(
              id,
              product_id,
              variant_name,
              variant_attributes,
              sku,
              selling_price,
              cost_price,
              unit_price,
              quantity,
              is_active,
              is_parent,
              parent_variant_id,
              variant_type
            )
          `).eq("is_active",!0).order("name");if(h)throw h;const p=r||[];console.log("=== Product Loading Debug ==="),console.log("Total products loaded:",p.length);const w=p.filter(_=>Array.isArray(_.lats_product_variants)&&_.lats_product_variants.length>0);console.log("Products with variants:",w.length);const g=p.find(_=>Array.isArray(_.lats_product_variants)&&_.lats_product_variants.length>1);if(g?(console.log("Sample product with variants:",g.name),console.log("  - Total variants:",g.lats_product_variants.length),console.log("  - Variants:",g.lats_product_variants.map(_=>({id:_.id,variant_name:_.variant_name,variant_attributes:_.variant_attributes,sku:_.sku})))):console.log("âš ï¸ No products with multiple variants found"),console.log("=== End Debug ==="),p.length>0){const _=p.map(Ne=>Ne.id),{data:he}=await S.from("product_images").select("id, product_id, image_url, thumbnail_url, is_primary").in("product_id",_).order("is_primary",{ascending:!1});if(he){let Ne=0;p.forEach(Te=>{const we=he.filter(_e=>_e.product_id===Te.id);if(we.length>0){Ne++;const _e=we.find(re=>re.is_primary)||we[0];Te.image_url=_e.thumbnail_url||_e.image_url,Te.images=we.map(re=>({id:re.id,url:re.thumbnail_url||re.image_url,thumbnailUrl:re.thumbnail_url,isPrimary:re.is_primary||!1}))}}),console.log(`[SpecialOrders] Loaded ${p.length} products, ${Ne} have images`)}}v(p)}catch(r){console.error("Error loading products:",r)}};N&&(qe(),t())},[N]);const Ye=async t=>{de(!1),await qe(),Ee(t),A.success("Supplier created and selected!")},Z=ge.useMemo(()=>{const t=new Map;n.forEach(p=>{p&&p.id&&!t.has(p.id)&&t.set(p.id,p)});const r=Array.from(t.values());if(!k.trim())return r.slice(0,30);const h=k.toLowerCase();return r.filter(p=>{var w,g,_;return((w=p.name)==null?void 0:w.toLowerCase().includes(h))||((g=p.sku)==null?void 0:g.toLowerCase().includes(h))||((_=p.description)==null?void 0:_.toLowerCase().includes(h))}).slice(0,30)},[k,n]),Me=t=>{console.log("=== Product Selection Debug ==="),console.log("Product:",t.name),console.log("Has variants?",!!t.lats_product_variants),console.log("Is array?",Array.isArray(t.lats_product_variants)),console.log("Variants count:",Array.isArray(t.lats_product_variants)?t.lats_product_variants.length:0);const r=Array.isArray(t.lats_product_variants)?t.lats_product_variants.filter(g=>!(g.is_active===!1||g.is_parent===!0||g.variant_type==="imei_child")):[];if(console.log("Sellable variants (after filtering):",r.length),r.length>0&&console.log("First variant:",{id:r[0].id,name:r[0].variant_name,sku:r[0].sku,price:r[0].selling_price,is_parent:r[0].is_parent,variant_type:r[0].variant_type}),r.length>1){console.log("âœ… Showing variant modal for",r.length,"variants"),xe(t),me(!0),y(!1);return}console.log("â†’ Single/no variant - selecting directly"),console.log("=== End Debug ==="),ue(t),D(t.name);const h=r[0],p=(h==null?void 0:h.selling_price)||(h==null?void 0:h.unit_price)||0;let w=t.name;if(h){const g=h.variant_attributes||{},he=[g.color,g.storage,g.size].filter(Boolean).join(" / ")||h.variant_name;he&&(w=`${t.name} (${he})`)}c(g=>({...g,product_name:w,product_description:t.description||"",unit_price:p})),y(!1),le(-1)},Ge=t=>{if(D(t),y(!0),le(-1),Q.current){const r=Q.current.getBoundingClientRect();$e({top:r.bottom,left:r.left,width:r.width})}t.trim()||ue(null)},Xe=t=>{!q||Z.length===0||(t.key==="ArrowDown"?(t.preventDefault(),le(r=>r<Z.length-1?r+1:r)):t.key==="ArrowUp"?(t.preventDefault(),le(r=>r>0?r-1:-1)):t.key==="Enter"&&Pe>=0?(t.preventDefault(),Me(Z[Pe])):t.key==="Escape"&&(y(!1),le(-1)))},Ae=ge.useMemo(()=>{if(!te.trim())return J;const t=te.toLowerCase();return J.filter(r=>{var h,p,w,g;return((h=r.name)==null?void 0:h.toLowerCase().includes(t))||((p=r.company_name)==null?void 0:p.toLowerCase().includes(t))||((w=r.city)==null?void 0:w.toLowerCase().includes(t))||((g=r.country)==null?void 0:g.toLowerCase().includes(t))})},[te,J]),He=t=>{if(!C)return;Oe(t),ue(C),D(C.name);const r=t.variant_attributes||{},p=[r.color,r.storage,r.size].filter(Boolean).join(" / ")||t.variant_name,w=p?`${C.name} (${p})`:C.name,g=t.selling_price||t.unit_price||0;c(_=>({..._,product_name:w,product_description:C.description||"",unit_price:g})),me(!1),xe(null)},Ee=t=>{ae(t),c(r=>({...r,supplier_name:t.name,country_of_origin:t.country||""})),I(!1)},Je=()=>{x<H&&j(t=>t+1)},et=()=>{x>1&&j(t=>t-1)},tt=()=>{switch(x){case 1:return!!o.customer_id&&!!o.product_name;case 2:return o.quantity>0&&o.unit_price>0;case 3:return!!o.account_id;case 4:return!0;default:return!1}};m.useEffect(()=>{N||(P(""),se(null),T(!1),V(-1),ae(null),ye(""),D(""),ue(null),y(!1),le(-1),me(!1),xe(null),Oe(null),j(1))},[N]),m.useEffect(()=>{o.quantity&&o.unit_price&&c(t=>({...t,total_amount:t.quantity*t.unit_price}))},[o.quantity,o.unit_price]);const rt=async t=>{if(t.preventDefault(),!o.customer_id||!o.product_name||!o.account_id){A.error("Please fill in all required fields");return}E(!0);try{const r=await ce.createSpecialOrder(o,d==null?void 0:d.id);r.success?(A.success("Special order created successfully!"),i()):A.error(r.error||"Failed to create special order")}catch(r){A.error(r.message||"An error occurred")}finally{E(!1)}};if(!N)return null;const ze=[o.customer_id,o.product_name,o.account_id],pe=ze.filter(Boolean).length,ve=ze.length;return Y.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[99999]",onClick:a,"aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100000] p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col overflow-hidden relative pointer-events-auto",onClick:t=>t.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"create-special-order-modal-title",children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",disabled:u,children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(X,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"create-special-order-modal-title",className:"text-2xl font-bold text-gray-900 mb-3",children:"Create Special Order"}),e.jsxs("div",{className:"flex items-center gap-4",children:[pe>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),e.jsxs("span",{className:"text-sm font-bold text-green-700",children:[pe,"/",ve," Required"]})]}),pe<ve&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg animate-pulse",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[ve-pe," Pending"]})]})]})]})]})}),e.jsxs("form",{id:"create-special-order-form",onSubmit:rt,className:"flex flex-col flex-1 overflow-hidden",children:[e.jsx("div",{className:"px-6 pt-4 pb-2 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("div",{className:`flex items-center gap-2 ${x>=1?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${x>=1?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"}`,children:x>1?e.jsx(z,{className:"w-5 h-5"}):"1"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Customer & Product"}),e.jsx("span",{className:"text-sm font-medium sm:hidden",children:"Setup"})]}),e.jsx("div",{className:`w-8 sm:w-12 h-0.5 ${x>=2?"bg-blue-600":"bg-gray-300"}`}),e.jsxs("div",{className:`flex items-center gap-2 ${x>=2?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${x>=2?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"}`,children:x>2?e.jsx(z,{className:"w-5 h-5"}):"2"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Pricing"})]}),e.jsx("div",{className:`w-8 sm:w-12 h-0.5 ${x>=3?"bg-blue-600":"bg-gray-300"}`}),e.jsxs("div",{className:`flex items-center gap-2 ${x>=3?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${x>=3?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"}`,children:x>3?e.jsx(z,{className:"w-5 h-5"}):"3"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Payment"})]}),e.jsx("div",{className:`w-8 sm:w-12 h-0.5 ${x>=4?"bg-blue-600":"bg-gray-300"}`}),e.jsxs("div",{className:`flex items-center gap-2 ${x>=4?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${x>=4?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"}`,children:"4"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Details"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-6",children:[x===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Customer Information"}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Customer ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:F,type:"text",value:f,onChange:t=>Ve(t.target.value),onKeyDown:Qe,onFocus:()=>{if(T(!0),F.current){const t=F.current.getBoundingClientRect();De({top:t.bottom,left:t.left,width:t.width})}},onBlur:()=>{setTimeout(()=>T(!1),200)},className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors text-gray-900",placeholder:"Search customer by name or phone...",required:!0,disabled:u}),!$&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsx(G,{className:"w-4 h-4"})}),$&&e.jsx("button",{type:"button",onClick:()=>{var t;P(""),se(null),c(r=>({...r,customer_id:""})),(t=F.current)==null||t.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(U,{className:"w-4 h-4"})}),!$&&e.jsxs("p",{className:"mt-1.5 text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),"Start typing to see suggestions"]})]}),M&&B.length>0&&Y.createPortal(e.jsxs("div",{className:"fixed bg-white border-2 border-blue-200 rounded-xl shadow-2xl max-h-80 overflow-y-auto",style:{zIndex:100010,top:`${oe.top+4}px`,left:`${oe.left}px`,width:`${oe.width}px`,maxWidth:"100vw"},children:[f&&e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-blue-50 to-blue-100 px-4 py-2 border-b-2 border-blue-200 flex items-center justify-between rounded-t-xl z-10",children:[e.jsxs("span",{className:"text-xs font-semibold text-blue-700",children:[B.length," ",B.length===1?"customer":"customers"," found"]}),e.jsx(G,{className:"w-4 h-4 text-blue-500"})]}),B.map((t,r)=>{var h;return e.jsx("button",{type:"button",onClick:()=>Fe(t),className:`w-full text-left px-4 py-3 hover:bg-blue-50 transition-colors border-b border-gray-100 last:border-b-0 ${r===L?"bg-blue-50":""} ${r===0?"rounded-t-xl":""} ${r===B.length-1?"rounded-b-xl":""}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-bold text-sm shadow-md flex-shrink-0",children:((h=t.name)==null?void 0:h.charAt(0).toUpperCase())||e.jsx(ke,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5 truncate",children:t.phone})]})]})},t.id)})]}),document.body),M&&f&&B.length===0&&Y.createPortal(e.jsxs("div",{className:"fixed bg-white border-2 border-gray-300 rounded-xl shadow-2xl p-4 text-center",style:{zIndex:100010,top:`${oe.top+4}px`,left:`${oe.left}px`,width:`${oe.width}px`},children:[e.jsx("p",{className:"text-sm text-gray-500",children:"No customers found"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Try a different search term"})]}),document.body),$&&e.jsx("div",{className:"mt-3 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-bold text-lg shadow-md flex-shrink-0",children:((Le=$.name)==null?void 0:Le.charAt(0).toUpperCase())||e.jsx(ke,{className:"w-7 h-7"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-blue-900 truncate",children:$.name}),e.jsx("div",{className:"text-xs text-blue-600 mt-0.5 truncate",children:$.phone})]}),e.jsx("div",{className:"flex items-center gap-1 text-blue-600 flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5"})})]})})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Product Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:Q,type:"text",value:k,onChange:t=>Ge(t.target.value),onKeyDown:Xe,onFocus:()=>{if(y(!0),Q.current){const t=Q.current.getBoundingClientRect();$e({top:t.bottom,left:t.left,width:t.width})}},onBlur:()=>{setTimeout(()=>y(!1),200)},className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-colors text-gray-900",placeholder:"Search product by name or SKU...",required:!0,disabled:u}),!O&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsx(G,{className:"w-4 h-4"})}),O&&e.jsx("button",{type:"button",onClick:()=>{var t;D(""),ue(null),c(r=>({...r,product_name:"",product_description:"",unit_price:0})),(t=Q.current)==null||t.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(U,{className:"w-4 h-4"})}),!O&&e.jsxs("p",{className:"mt-1.5 text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),"Start typing to see suggestions or click to browse"]})]}),q&&Z.length>0&&Y.createPortal(e.jsxs("div",{className:"fixed bg-white border-2 border-purple-200 rounded-xl shadow-2xl max-h-80 overflow-y-auto",style:{zIndex:100010,top:`${ne.top+4}px`,left:`${ne.left}px`,width:`${ne.width}px`,maxWidth:"100vw"},children:[k&&e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-purple-50 to-purple-100 px-4 py-2 border-b-2 border-purple-200 flex items-center justify-between rounded-t-xl z-10",children:[e.jsxs("span",{className:"text-xs font-semibold text-purple-700",children:[Z.length," ",Z.length===1?"product":"products"," found"]}),e.jsx(G,{className:"w-4 h-4 text-purple-500"})]}),Z.map((t,r)=>{var h,p;return e.jsx("button",{type:"button",onClick:()=>Me(t),className:`w-full text-left px-4 py-3 hover:bg-purple-50 transition-colors border-b border-gray-100 last:border-b-0 ${r===Pe?"bg-purple-50":""} ${r===0?"rounded-t-xl":""} ${r===Z.length-1?"rounded-b-xl":""}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-100 to-purple-200 flex items-center justify-center flex-shrink-0 overflow-hidden border border-purple-300",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover",onError:w=>{var g;w.currentTarget.style.display="none",(g=w.currentTarget.nextElementSibling)==null||g.classList.remove("hidden")}}):null,e.jsx(X,{className:`w-6 h-6 text-purple-600 ${t.image_url?"hidden":""}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm truncate flex-1",children:t.name}),(()=>{const w=Array.isArray(t.lats_product_variants)?t.lats_product_variants.filter(g=>g.is_active!==!1&&g.is_parent!==!0&&g.variant_type!=="imei_child").length:0;return w>1?e.jsxs("span",{className:"px-2 py-0.5 bg-orange-100 text-orange-700 rounded-full text-xs font-bold flex-shrink-0",children:[w," variants"]}):null})()]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[t.sku&&e.jsxs("span",{className:"text-xs text-gray-500",children:["SKU: ",t.sku]}),((p=(h=t.lats_product_variants)==null?void 0:h[0])==null?void 0:p.selling_price)&&e.jsx("span",{className:"text-xs text-green-600 font-medium",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(t.lats_product_variants[0].selling_price)})]})]})]})},t.id)})]}),document.body),q&&k&&Z.length===0&&Y.createPortal(e.jsxs("div",{className:"fixed bg-white border-2 border-gray-300 rounded-xl shadow-2xl p-4 text-center",style:{zIndex:100010,top:`${ne.top+4}px`,left:`${ne.left}px`,width:`${ne.width}px`},children:[e.jsx("p",{className:"text-sm text-gray-500",children:"No products found"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Try a different search term"})]}),document.body),O&&e.jsx("div",{className:"mt-3 p-4 bg-purple-50 border-2 border-purple-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-purple-100 to-purple-200 flex items-center justify-center flex-shrink-0 overflow-hidden border-2 border-purple-300 shadow-sm",children:[O.image_url?e.jsx("img",{src:O.image_url,alt:O.name,className:"w-full h-full object-cover",onError:t=>{var r;t.currentTarget.style.display="none",(r=t.currentTarget.nextElementSibling)==null||r.classList.remove("hidden")}}):null,e.jsx(X,{className:`w-8 h-8 text-purple-600 ${O.image_url?"hidden":""}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-purple-900 truncate",children:O.name}),je&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(()=>{const t=je.variant_attributes||{};return e.jsxs(e.Fragment,{children:[t.color&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:t.color}),t.storage&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:t.storage}),t.size&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:t.size}),je.variant_name&&!t.color&&!t.storage&&!t.size&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:je.variant_name})]})})()}),O.sku&&e.jsxs("div",{className:"text-xs text-purple-600 mt-0.5",children:["SKU: ",O.sku]}),((Be=(Re=O.lats_product_variants)==null?void 0:Re[0])==null?void 0:Be.selling_price)&&e.jsxs("div",{className:"text-xs text-green-600 font-medium mt-1",children:["Price: ",new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(O.lats_product_variants[0].selling_price)]})]}),e.jsx("div",{className:"flex items-center gap-1 text-purple-600 flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5"})})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Description"}),e.jsx("textarea",{value:o.product_description,onChange:t=>c(r=>({...r,product_description:t.target.value})),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-colors text-gray-900 resize-none",placeholder:"Additional details, color, specifications...",rows:2,disabled:u})]})]})]})]}),x===2&&e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Pricing & Quantity"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:o.quantity,onChange:t=>c(r=>({...r,quantity:parseInt(t.target.value)||1})),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors text-gray-900 font-medium",min:"1",required:!0,disabled:u})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Unit Price ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:o.unit_price,onChange:t=>c(r=>({...r,unit_price:parseFloat(t.target.value)||0})),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors text-gray-900 font-medium",min:"0",step:"1000",required:!0,disabled:u})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Deposit Paid ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:o.deposit_paid,onChange:t=>c(r=>({...r,deposit_paid:parseFloat(t.target.value)||0})),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors text-gray-900 font-medium",min:"0",step:"1000",required:!0,disabled:u})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"px-4 py-4 bg-green-50 border-2 border-green-200 rounded-xl",children:[e.jsx("div",{className:"text-xs font-semibold text-green-700 mb-1",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(o.total_amount||0)})]}),o.total_amount>0&&e.jsxs("div",{className:"px-4 py-4 bg-orange-50 border-2 border-orange-200 rounded-xl",children:[e.jsx("div",{className:"text-xs font-semibold text-orange-700 mb-1",children:"Balance Due"}),e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format((o.total_amount||0)-(o.deposit_paid||0))})]})]})]}),x===3&&e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Payment Details"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Payment Account ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:W.map((t,r)=>{const h=o.account_id===t.id;return e.jsx("button",{type:"button",onClick:()=>c(p=>({...p,account_id:t.id})),disabled:u,className:`p-4 rounded-xl border-2 transition-all text-left ${h?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 hover:border-blue-300 hover:bg-gray-50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-sm font-semibold ${h?"text-blue-900":"text-gray-900"}`,children:t.name}),t.account_type&&e.jsx("div",{className:`text-xs mt-1 ${h?"text-blue-600":"text-gray-500"}`,children:t.account_type})]}),h&&e.jsx(z,{className:"w-5 h-5 text-blue-600 flex-shrink-0 ml-2"})]})},b(t.id,r))})}),W.length===0&&e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300",children:[e.jsx(ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"No payment accounts available"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Please contact administrator"})]})]})]}),x===4&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Supplier & Shipping (Optional)"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier"}),ee?e.jsx("div",{className:"p-4 bg-orange-50 border-2 border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-orange-500 to-amber-600 flex items-center justify-center text-white font-bold text-lg shadow-md",children:ee.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-orange-900",children:ee.name}),ee.country&&e.jsx("div",{className:"text-xs text-orange-600",children:ee.country})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-orange-600",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>{ae(null),c(t=>({...t,supplier_name:"",country_of_origin:""}))},className:"text-orange-600 hover:text-orange-800",children:e.jsx(U,{className:"w-4 h-4"})})]})]})}):e.jsxs("button",{type:"button",onClick:()=>I(!0),className:"w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-orange-400 hover:bg-orange-50 transition-colors text-sm text-gray-600 hover:text-orange-600 font-medium flex items-center justify-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Choose Supplier"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reference"}),e.jsx("input",{type:"text",value:o.supplier_reference,onChange:t=>c(r=>({...r,supplier_reference:t.target.value})),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors text-gray-900",placeholder:"Invoice #",disabled:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tracking #"}),e.jsx("input",{type:"text",value:o.tracking_number,onChange:t=>c(r=>({...r,tracking_number:t.target.value})),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors text-gray-900",placeholder:"Tracking #",disabled:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expected Arrival"}),e.jsx("input",{type:"date",value:o.expected_arrival_date,onChange:t=>c(r=>({...r,expected_arrival_date:t.target.value})),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors text-gray-900",disabled:u})]})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Notes (Optional)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Notes"}),e.jsx("textarea",{value:o.notes,onChange:t=>c(r=>({...r,notes:t.target.value})),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors text-gray-900 resize-none",placeholder:"Notes visible to customer...",rows:2,disabled:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Internal Notes (Staff Only)"}),e.jsx("textarea",{value:o.internal_notes,onChange:t=>c(r=>({...r,internal_notes:t.target.value})),className:"w-full px-4 py-3 border-2 border-yellow-200 rounded-xl focus:outline-none focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 bg-yellow-50 transition-colors text-gray-900 resize-none",placeholder:"Private notes...",rows:2,disabled:u})]})]})]})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[x>1&&e.jsx("button",{type:"button",onClick:et,disabled:u,className:"flex-1 px-6 py-3 border-2 border-gray-300 rounded-xl text-gray-700 font-semibold hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"â† Back"}),x<H?e.jsx("button",{type:"button",onClick:Je,disabled:!tt(),className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:"Next â†’"}):e.jsx("button",{type:"submit",disabled:u||pe<ve,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:from-green-600 hover:to-green-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):"âœ“ Create Special Order"})]})})]})]})}),be&&Y.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100001]",onClick:()=>I(!1),"aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100002] p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden relative pointer-events-auto",onClick:t=>t.stopPropagation(),role:"dialog","aria-modal":"true",children:[e.jsx("button",{onClick:()=>I(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(fe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Select Supplier"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a supplier for this order"})]})]})}),e.jsxs("div",{className:"p-6 pb-0 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search suppliers by name, company, location...",value:te,onChange:t=>ye(t.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-3",children:[Ae.length," of ",J.length," suppliers"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:Ae.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Ae.map(t=>e.jsxs("div",{onClick:()=>Ee(t),className:"border-2 border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-lg hover:scale-[1.02] hover:border-orange-300 cursor-pointer transition-all duration-300 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-orange-500 to-amber-600 flex items-center justify-center text-white font-bold text-lg shadow-md flex-shrink-0",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 truncate",children:t.name}),t.company_name&&t.company_name!==t.name&&e.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.company_name})]})]}),(t.city||t.country)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 mb-3",children:[e.jsx(ht,{className:"w-3 h-3"}),e.jsx("span",{children:[t.city,t.country].filter(Boolean).join(", ")})]}),e.jsxs("button",{onClick:r=>{r.stopPropagation(),Ee(t)},className:"w-full py-2 px-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg font-semibold text-sm flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Select"]})]},t.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(fe,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"No suppliers found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:te?"Try adjusting your search":"No suppliers available"})]})}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("button",{type:"button",onClick:()=>{I(!1),de(!0)},className:"w-full px-6 py-3.5 bg-gradient-to-r from-orange-500 to-amber-600 text-white rounded-xl font-semibold hover:from-orange-600 hover:to-amber-700 transition-all shadow-lg hover:shadow-xl text-lg flex items-center justify-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),"Add New Supplier"]})})]})})]}),document.body),e.jsx(yt,{isOpen:R,onClose:()=>{de(!1),I(!0)},onSupplierCreated:Ye}),We&&C&&Y.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[100011]",onClick:()=>{me(!1),xe(null)},"aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100012] p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[85vh] flex flex-col overflow-hidden relative pointer-events-auto",onClick:t=>t.stopPropagation(),role:"dialog","aria-modal":"true",children:[e.jsx("button",{onClick:()=>{me(!1),xe(null)},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-6 bg-gradient-to-r from-purple-600 to-purple-700 text-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0 overflow-hidden backdrop-blur",children:C.image_url?e.jsx("img",{src:C.image_url,alt:C.name,className:"w-full h-full object-cover"}):e.jsx(X,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-2xl font-bold mb-1",children:C.name}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Select a variant to continue"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:(Array.isArray(C.lats_product_variants)?C.lats_product_variants:[]).filter(t=>!(t.is_active===!1||t.is_parent===!0||t.variant_type==="imei_child")).map(t=>{const r=t.variant_attributes||{},p=[r.color,r.storage,r.size].filter(Boolean).join(" / ")||t.variant_name||"Variant",w=t.selling_price||t.unit_price||0,g=t.quantity||0;return e.jsx("button",{type:"button",onClick:()=>He(t),className:"group p-5 border-2 border-purple-200 rounded-xl hover:border-purple-500 hover:shadow-lg transition-all bg-white hover:bg-purple-50 text-left",children:e.jsxs("div",{className:"space-y-3",children:[p&&e.jsx("div",{className:"text-base font-bold text-gray-900 group-hover:text-purple-700 transition-colors",children:p}),t.sku&&e.jsxs("div",{className:"text-xs text-gray-500 font-mono",children:["SKU: ",t.sku]}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(w)}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-semibold ${g>10?"bg-green-100 text-green-700":g>0?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:g>0?`${g} in stock`:"Out of stock"})}),e.jsx("div",{className:"pt-2 mt-2 border-t border-purple-100",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-purple-600 group-hover:text-purple-700 font-semibold text-sm",children:[e.jsx(z,{className:"w-4 h-4"}),"Select This Variant"]})})]})},t.id)})})}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"}),Array.isArray(C.lats_product_variants)?C.lats_product_variants.filter(t=>t.is_active!==!1&&t.is_parent!==!0&&t.variant_type!=="imei_child").length:0," variants available for ",C.name]})})]})})]}),document.body)]}),document.body)},Nt=({isOpen:N,onClose:a,onSuccess:i,order:l,paymentAccounts:s,currentUser:d})=>{var W;const[o,c]=m.useState({special_order_id:l.id,customer_id:l.customer_id,amount:l.balance_due,payment_method:"cash",account_id:"",reference_number:"",notes:""}),[u,E]=m.useState(!1);Ue(N);const x=m.useMemo(()=>{const b=(s||[]).filter(P=>P&&P.id),f=new Map;return b.forEach(P=>{f.has(P.id)||f.set(P.id,P)}),Array.from(f.values())},[s]),{items:j,getKey:H}=Ke(x),K=async b=>{if(b.preventDefault(),!o.account_id){A.error("Please select a payment account");return}E(!0);try{const f=await ce.recordPayment(o,d==null?void 0:d.id);f.success?(A.success("Payment recorded successfully!"),i()):A.error(f.error||"Failed to record payment")}catch(f){A.error(f.message||"An error occurred")}finally{E(!1)}};return N?Y.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[99999]",onClick:a,"aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100000] p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg flex flex-col overflow-hidden relative pointer-events-auto max-h-[90vh]",onClick:b=>b.stopPropagation(),role:"dialog","aria-modal":"true",children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ie,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Record Payment"}),e.jsx("p",{className:"text-sm text-gray-600",children:l.order_number})]})]})}),e.jsx("div",{className:"p-6 bg-gradient-to-br from-gray-50 to-blue-50 border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Product:"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:l.product_name})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Customer:"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:(W=l.customer)==null?void 0:W.name})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Amount:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(l.total_amount)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm font-medium text-green-700",children:"Paid:"}),e.jsx("span",{className:"text-base font-bold text-green-600",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(l.deposit_paid)})]}),e.jsx("div",{className:"bg-orange-100 border-2 border-orange-300 rounded-xl p-4 mt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-bold text-orange-900",children:"Balance Due:"}),e.jsx("span",{className:"text-2xl font-bold text-orange-600",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(l.balance_due)})]})})]})}),e.jsxs("form",{onSubmit:K,className:"flex-1 overflow-y-auto p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:o.amount,onChange:b=>c(f=>({...f,amount:parseFloat(b.target.value)||0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",max:l.balance_due,step:"0.01",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Method ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o.payment_method,onChange:b=>c(f=>({...f,payment_method:b.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mobile_money",children:"Mobile Money"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Account ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o.account_id,onChange:b=>c(f=>({...f,account_id:b.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select Account"}),j.filter(b=>b&&b.id&&b.name).map((b,f)=>e.jsx("option",{value:b.id,children:b.name},H(b.id,f)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number"}),e.jsx("input",{type:"text",value:o.reference_number,onChange:b=>c(f=>({...f,reference_number:b.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Transaction reference"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:o.notes,onChange:b=>c(f=>({...f,notes:b.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Payment notes...",rows:2})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-4 py-2.5 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Recording...":"Record Payment"})]})]})]})})]}),document.body):null},wt=({isOpen:N,onClose:a,onSuccess:i,order:l,currentUser:s})=>{const[d,o]=m.useState({status:l.status,tracking_number:l.tracking_number||"",supplier_reference:l.supplier_reference||"",expected_arrival_date:l.expected_arrival_date||"",actual_arrival_date:l.actual_arrival_date||"",notes:l.notes||"",internal_notes:l.internal_notes||""}),[c,u]=m.useState(!1),E=async x=>{x.preventDefault(),u(!0);try{const j=await ce.updateSpecialOrder(l.id,d,s==null?void 0:s.id);j.success?(A.success("Order updated successfully!"),i()):A.error(j.error||"Failed to update order")}catch(j){A.error(j.message||"An error occurred")}finally{u(!1)}};return N?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ze,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Order Status"}),e.jsx("p",{className:"text-sm text-gray-600",children:l.order_number})]})]}),e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(U,{size:20})})]}),e.jsxs("form",{onSubmit:E,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:d.status,onChange:x=>o(j=>({...j,status:x.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"deposit_received",children:"Deposit Received"}),e.jsx("option",{value:"ordered",children:"Ordered"}),e.jsx("option",{value:"in_transit",children:"In Transit"}),e.jsx("option",{value:"arrived",children:"Arrived"}),e.jsx("option",{value:"ready_for_pickup",children:"Ready for Pickup"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tracking Number"}),e.jsx("input",{type:"text",value:d.tracking_number,onChange:x=>o(j=>({...j,tracking_number:x.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Shipment tracking number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Reference"}),e.jsx("input",{type:"text",value:d.supplier_reference,onChange:x=>o(j=>({...j,supplier_reference:x.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Supplier order reference"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Arrival"}),e.jsx("input",{type:"date",value:d.expected_arrival_date,onChange:x=>o(j=>({...j,expected_arrival_date:x.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Actual Arrival"}),e.jsx("input",{type:"date",value:d.actual_arrival_date,onChange:x=>o(j=>({...j,actual_arrival_date:x.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Notes"}),e.jsx("textarea",{value:d.notes,onChange:x=>o(j=>({...j,notes:x.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes visible to customer...",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Internal Notes"}),e.jsx("textarea",{value:d.internal_notes,onChange:x=>o(j=>({...j,internal_notes:x.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Internal notes (not visible to customer)...",rows:2})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Updating...":"Update Order"})]})]})]})}):null};export{Tt as default};
