class f{constructor(){this.STORAGE_KEY="lats_purchase_order_drafts",this.MAX_DRAFTS=20}saveDraft(t,a,e,r,s,o,l,c){const n=this.getAllDrafts(),d=`po_draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={id:d,name:t.trim(),cartItems:[...a],supplier:e?{...e}:null,currency:r?{...r}:null,expectedDelivery:s,paymentTerms:o,notes:l||"",exchangeRates:c||"",createdAt:new Date,updatedAt:new Date};n.unshift(i),n.length>this.MAX_DRAFTS&&n.splice(this.MAX_DRAFTS);try{return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n)),d}catch(u){throw console.error("Failed to save purchase order draft:",u),new Error("Failed to save draft")}}updateDraft(t,a){const e=this.getAllDrafts(),r=e.findIndex(s=>s.id===t);if(r===-1)return!1;e[r]={...e[r],...a,updatedAt:new Date};try{return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),!0}catch(s){return console.error("Failed to update purchase order draft:",s),!1}}getAllDrafts(){try{const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})):[]}catch(t){return console.error("Failed to load purchase order drafts:",t),[]}}getDraft(t){return this.getAllDrafts().find(r=>r.id===t)||null}getLatestDraft(){const t=this.getAllDrafts();return t.length===0?null:t[0]}deleteDraft(t){const a=this.getAllDrafts(),e=a.filter(r=>r.id!==t);if(e.length===a.length)return!1;try{return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),!0}catch(r){return console.error("Failed to delete purchase order draft:",r),!1}}clearAllDrafts(){try{return localStorage.removeItem(this.STORAGE_KEY),!0}catch(t){return console.error("Failed to clear purchase order drafts:",t),!1}}hasDrafts(){return this.getAllDrafts().length>0}savePOSDraft(t,a,e,r){const s=`POS Draft ${new Date().toLocaleString()}`;return this.saveDraft(s,t,a,{code:"TZS",name:"Tanzanian Shilling"},"","",r||"","")}autoSave(t,a,e,r,s,o,l){if(t.length===0)return null;const c=`Auto-save ${new Date().toLocaleString()}`;try{return this.saveDraft(c,t,a,e,r,s,o,l)}catch(n){return console.error("Auto-save failed:",n),null}}getDraftSummary(t){var r,s;const a=t.cartItems.reduce((o,l)=>o+(l.totalPrice||0),0),e=t.cartItems.length;return{id:t.id,name:t.name,supplier:((r=t.supplier)==null?void 0:r.name)||"No supplier",itemCount:e,totalAmount:a,currency:((s=t.currency)==null?void 0:s.code)||"TZS",createdAt:t.createdAt,updatedAt:t.updatedAt}}}const h=new f,D=h;export{D as d,h as p};
