import{ao as B,j as e}from"./index-61458a34.js";import{r as i,b as F}from"./vendor-36d2c7c1.js";import{X as H,P as $,o as U,M as z,ae as Y,q as W,k as _,s as G,U as q,br as J,r as K,y as Q}from"./ui-28e30067.js";const O=({customer:r,plan:v,anchorRef:c,isOpen:n,onClose:w,formatCurrency:A=o=>`$${o.toFixed(2)}`,formatDate:N=o=>new Date(o).toLocaleDateString()})=>{var L,S;const[o,C]=i.useState({top:0,left:0}),[x,u]=i.useState(null),[p,T]=i.useState(null),[t,y]=i.useState(null),[M,k]=i.useState(!1),[E,j]=i.useState(!1),P=i.useRef(null);i.useEffect(()=>{const s="customer-tooltip-animations";if(!document.getElementById(s)){const d=document.createElement("style");d.id=s,d.textContent=`
        @keyframes tooltipEnter {
          0% {
            opacity: 0;
            transform: scale(0.2) translateY(-20px);
          }
          50% {
            opacity: 0.8;
            transform: scale(1.05) translateY(2px);
          }
          70% {
            transform: scale(0.98) translateY(-1px);
          }
          100% {
            opacity: 1;
            transform: scale(1) translateY(0);
          }
        }
        @keyframes tooltipExit {
          0% {
            opacity: 1;
            transform: scale(1) translateY(0);
          }
          30% {
            opacity: 0.8;
            transform: scale(1.02) translateY(-2px);
          }
          100% {
            opacity: 0;
            transform: scale(0.2) translateY(-20px);
          }
        }
        @keyframes backdropEnter {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }
        @keyframes backdropExit {
          from {
            opacity: 1;
          }
          to {
            opacity: 0;
          }
        }
      `,document.head.appendChild(d)}},[]);const m=()=>{j(!0),setTimeout(()=>{w(),j(!1)},600)};return i.useEffect(()=>{n&&(r!=null&&r.id)&&!t&&(k(!0),B(r.id).then(s=>{s&&y({id:s.id,name:s.name,phone:s.phone,email:s.email,city:s.city,gender:s.gender,points:s.points||0,totalSpent:s.totalSpent||0,loyaltyLevel:s.loyaltyLevel||void 0,joinedDate:s.joinedDate||void 0,lastVisit:s.lastVisit||void 0,isActive:s.isActive,locationDescription:s.locationDescription,nationalId:s.nationalId,totalPurchases:s.totalPurchases||0,lastPurchaseDate:s.lastPurchaseDate||void 0,profileImage:s.profileImage||void 0,whatsapp:s.whatsapp||s.phone||void 0})}).catch(s=>{console.error("Error fetching customer details:",s)}).finally(()=>{k(!1)}))},[n,r==null?void 0:r.id,t]),i.useEffect(()=>{n||(y(null),u(null),j(!1))},[n]),i.useEffect(()=>{if(n&&c.current){c.current.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const s=()=>{if(!c.current){m();return}const a=c.current.getBoundingClientRect();if(x||u({top:a.top+window.scrollY,left:a.left+window.scrollX,width:a.width,height:a.height}),a.width===0||a.height===0||a.top<-1e3||a.bottom>window.innerHeight+1e3){m();return}const h=600,b=v?700:400,g=a.left+a.width/2;a.top+a.height/2;let f=a.bottom+window.scrollY+8,l=a.left+window.scrollX,I="top";l+h>window.innerWidth&&(l=window.innerWidth-h-10),l<10&&(l=10),a.bottom+b>window.innerHeight&&(f=a.top+window.scrollY-b-8,I="bottom");const V=g-l,X=Math.max(30,Math.min(h-30,V));C({top:f,left:l}),T({side:I,left:X})};s();const d=()=>{s()};return window.addEventListener("scroll",d,!0),window.addEventListener("resize",s),()=>{window.removeEventListener("scroll",d,!0),window.removeEventListener("resize",s)}}else n||u(null)},[n,c,v,x]),i.useEffect(()=>{if(!n)return;let s=null;const d=setTimeout(()=>{function a(b){var f,l;const g=b.target;(f=P.current)!=null&&f.contains(g)||(l=c.current)!=null&&l.contains(g)||m()}function h(b){b.key==="Escape"&&m()}document.addEventListener("click",a),document.addEventListener("keydown",h),s=()=>{document.removeEventListener("click",a),document.removeEventListener("keydown",h)}},100);return()=>{clearTimeout(d),s&&s()}},[n,w,c]),!n||!r?null:F.createPortal(e.jsxs("div",{className:"fixed inset-0 pointer-events-none",style:{zIndex:1e6},children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-[2px] pointer-events-auto",style:{animation:E?"backdropExit 600ms ease-out forwards":"backdropEnter 600ms ease-out forwards"},onClick:s=>{s.stopPropagation(),m()}}),e.jsxs("div",{ref:P,className:"fixed bg-white/98 backdrop-blur-md rounded-2xl shadow-[0_25px_100px_rgba(0,0,0,0.25)] border-2 border-purple-200/50 overflow-visible pointer-events-auto",style:{top:`${o.top}px`,left:`${o.left}px`,width:"600px",maxHeight:"800px",boxShadow:"0 25px 100px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(139, 92, 246, 0.1), 0 0 40px rgba(139, 92, 246, 0.1)",animation:E?"tooltipExit 600ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards":"tooltipEnter 600ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards",transformOrigin:x?`${x.left+x.width/2-o.left}px ${x.top+x.height/2-o.top}px`:"center center"},onClick:s=>s.stopPropagation(),children:[p&&e.jsxs("div",{className:`absolute ${p.side==="top"?"-top-3":"-bottom-3"} left-0 z-10`,style:{left:`${p.left}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:`w-0 h-0 ${p.side==="top"?"border-l-[12px] border-r-[12px] border-b-[12px] border-l-transparent border-r-transparent border-b-purple-200/50":"border-l-[12px] border-r-[12px] border-t-[12px] border-l-transparent border-r-transparent border-t-purple-200/50"}`,style:{filter:"drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1))"}}),e.jsx("div",{className:`absolute ${p.side==="top"?"top-[2px]":"top-[-10px]"} left-1/2 -translate-x-1/2 w-0 h-0 ${p.side==="top"?"border-l-[10px] border-r-[10px] border-b-[10px] border-l-transparent border-r-transparent border-b-white/98":"border-l-[10px] border-r-[10px] border-t-[10px] border-l-transparent border-r-transparent border-t-white/98"}`})]}),e.jsxs("div",{className:"overflow-hidden rounded-2xl",children:[e.jsxs("div",{className:"bg-white p-5 border-b border-gray-200 relative overflow-hidden",children:[e.jsx("button",{onClick:m,className:"absolute top-4 right-4 w-10 h-10 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50","aria-label":"Close",children:e.jsx(H,{className:"w-6 h-6"})}),e.jsxs("div",{className:"absolute inset-0 opacity-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-500 rounded-full -mr-16 -mt-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-purple-500 rounded-full -ml-12 -mb-12"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"flex items-start justify-between mb-4 pr-12",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-14 h-14 bg-purple-600 rounded-full flex items-center justify-center border-2 border-purple-200 shadow-lg",children:t!=null&&t.profileImage?e.jsx("img",{src:t.profileImage,alt:r.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-xl font-bold text-white",children:((S=(L=r.name)==null?void 0:L.charAt(0))==null?void 0:S.toUpperCase())||"C"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-lg truncate text-gray-900",children:r.name||"Unknown Customer"}),(t==null?void 0:t.isActive)!==!1&&e.jsxs("div",{className:"flex items-center gap-1 bg-green-100 px-2 py-0.5 rounded-full border border-green-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-green-700",children:"Active"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Customer & Installment Details"})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.phone&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${r.phone}`,className:"flex items-center gap-1.5 bg-blue-50 hover:bg-blue-100 border border-blue-200 px-3 py-1.5 rounded-lg text-sm font-medium text-blue-700 transition-all hover:scale-105",onClick:s=>s.stopPropagation(),children:[e.jsx($,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Call"})]}),e.jsxs("a",{href:`https://wa.me/${r.phone.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 bg-green-50 hover:bg-green-100 border border-green-200 px-3 py-1.5 rounded-lg text-sm font-medium text-green-700 transition-all hover:scale-105",onClick:s=>s.stopPropagation(),children:[e.jsx(U,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"WhatsApp"})]})]}),r.email&&e.jsxs("a",{href:`mailto:${r.email}`,className:"flex items-center gap-1.5 bg-purple-50 hover:bg-purple-100 border border-purple-200 px-3 py-1.5 rounded-lg text-sm font-medium text-purple-700 transition-all hover:scale-105",onClick:s=>s.stopPropagation(),children:[e.jsx(z,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Email"})]})]})]})]}),e.jsxs("div",{className:"p-5 space-y-5 max-h-[700px] overflow-y-auto",children:[t&&(t.points!==void 0||t.totalSpent!==void 0)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[t.points!==void 0&&e.jsx("div",{className:"bg-amber-50 rounded-lg p-3 border border-amber-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-amber-600 mb-1 font-medium",children:"Loyalty Points"}),e.jsx("p",{className:"text-2xl font-bold text-amber-900",children:t.points.toLocaleString()})]}),e.jsx(Y,{className:"w-8 h-8 text-amber-600"})]})}),t.totalSpent!==void 0&&e.jsx("div",{className:"bg-emerald-50 rounded-lg p-3 border border-emerald-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1 font-medium",children:"Total Spent"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-900 truncate",children:A(t.totalSpent)})]}),e.jsx(W,{className:"w-8 h-8 text-emerald-600"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 uppercase tracking-wide flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-blue-600 rounded"}),"Customer Information"]}),(t==null?void 0:t.loyaltyLevel)&&e.jsxs("div",{className:"flex items-center gap-1 bg-gradient-to-r from-purple-100 to-indigo-100 px-2.5 py-1 rounded-full border border-purple-200",children:[e.jsx(_,{className:"w-3 h-3 text-purple-600"}),e.jsx("span",{className:"text-xs font-bold text-purple-700 capitalize",children:t.loyaltyLevel})]})]}),M?e.jsxs("div",{className:"bg-gray-50 rounded-xl p-8 border border-gray-200 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading customer details..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[r.phone&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-2.5 border border-blue-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx($,{className:"w-3 h-3 text-blue-600"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"Phone"})]}),e.jsx("a",{href:`tel:${r.phone}`,className:"text-xs font-semibold text-blue-700 hover:text-blue-800 hover:underline truncate block",children:r.phone})]}),r.email&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-2.5 border border-purple-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-purple-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-3 h-3 text-purple-600"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"Email"})]}),e.jsx("a",{href:`mailto:${r.email}`,className:"text-xs font-semibold text-purple-700 hover:text-purple-800 hover:underline truncate block",children:r.email})]}),((t==null?void 0:t.city)||(t==null?void 0:t.locationDescription))&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-2.5 border border-green-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-green-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx(G,{className:"w-3 h-3 text-green-600"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"Location"})]}),e.jsx("p",{className:"text-xs font-semibold text-gray-900 truncate",children:t.city||t.locationDescription||"N/A"})]}),(t==null?void 0:t.gender)&&e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg p-2.5 border border-pink-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-pink-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx(q,{className:"w-3 h-3 text-pink-600"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"Gender"})]}),e.jsx("p",{className:"text-xs font-semibold text-gray-900 capitalize",children:t.gender})]}),(t==null?void 0:t.points)!==void 0&&e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg p-2.5 border border-amber-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-amber-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx(Y,{className:"w-3 h-3 text-amber-600"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"Points"})]}),e.jsx("p",{className:"text-xs font-bold text-amber-700",children:t.points.toLocaleString()})]}),(t==null?void 0:t.totalPurchases)!==void 0&&t.totalPurchases>0&&e.jsxs("div",{className:"bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-lg p-2.5 border border-cyan-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-cyan-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx(J,{className:"w-3 h-3 text-cyan-600"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"Purchases"})]}),e.jsx("p",{className:"text-xs font-bold text-cyan-700",children:t.totalPurchases})]}),(t==null?void 0:t.joinedDate)&&e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg p-2.5 border border-slate-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-slate-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"w-3 h-3 text-slate-600"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"Joined"})]}),e.jsx("p",{className:"text-xs font-semibold text-gray-900 truncate",children:N(t.joinedDate)})]}),(t==null?void 0:t.lastVisit)&&e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-lg p-2.5 border border-teal-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-teal-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-3 h-3 text-teal-600"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"Last Visit"})]}),e.jsx("p",{className:"text-xs font-semibold text-gray-900 truncate",children:N(t.lastVisit)})]}),(t==null?void 0:t.nationalId)&&e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-violet-100 rounded-lg p-2.5 border border-violet-200 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-violet-200 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-[8px] font-bold text-violet-700",children:"ID"})}),e.jsx("p",{className:"text-[10px] text-gray-500 font-medium",children:"National ID"})]}),e.jsx("p",{className:"text-xs font-semibold text-gray-900 truncate",children:t.nationalId})]})]}),!r.phone&&!r.email&&e.jsx("div",{className:"text-sm text-gray-500 italic text-center py-4 bg-gray-50 rounded-lg border border-gray-200",children:"No contact information available"})]})]})]})]})]})]}),document.body)};export{O as C};
