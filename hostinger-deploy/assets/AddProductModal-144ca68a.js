import{_ as Ce}from"./supabase-cf010ec4.js";import{j as e,y as ut,d as ht,u as mt,ah as gt,s as te,ai as Oe,aj as xt}from"./index-61458a34.js";import{r as d,b as pt}from"./vendor-36d2c7c1.js";import{u as Ke,a3 as ft,ax as Ve,i as me,cb as bt,Y as yt,J as Ue,N as he,n as j,S as jt,bM as wt,bs as Nt,X as _e}from"./ui-28e30067.js";import{generateSKU as vt}from"./skuUtils-60e0a165.js";import{C as kt}from"./CategoryInput-e47eba98.js";import{p as He,f as St,g as Ct}from"./specificationUtils-0c00478d.js";import{u as Vt}from"./useBodyScrollLock-341c8b9f.js";import{o as _t,s as se,e as It,r as At,c as We,a as Pt,Z as Mt}from"./forms-ebbdb905.js";const Dt=({formData:o,setFormData:v,categories:re,currentErrors:f,isCheckingName:ue,nameExists:S,onNameCheck:P,onSpecificationsClick:W,useVariants:z=!1,onGenerateSKU:K})=>{const[T,M]=d.useState(!1);return e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"border-2 rounded-2xl bg-white shadow-sm border-gray-200 mb-6",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ke,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Product Information"})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{className:"space-y-6",onSubmit:i=>i.preventDefault(),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"product-name",className:`block mb-2 text-xs font-medium ${f.name?"text-red-600":"text-gray-700"}`,children:"Product Name & Model *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"product-name",type:"text",value:o.name,onChange:i=>{v(N=>({...N,name:i.target.value})),P(i.target.value)},className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none transition-colors text-gray-900 font-medium ${f.name?"border-red-500 focus:border-red-600 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}`,placeholder:"iPhone 14 Pro Max",required:!0}),ue&&e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"})})]}),f.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.name}),S&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"A product with this exact name already exists"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:`block mb-2 text-xs font-medium ${f.categoryId?"text-red-600":"text-gray-700"}`,children:"Category *"}),e.jsx(kt,{value:o.categoryId,onChange:i=>v(N=>({...N,categoryId:i})),categories:re,placeholder:"Select a category",required:!0,error:f.categoryId}),f.categoryId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.categoryId})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"condition",className:`block mb-2 text-xs font-medium ${f.condition?"text-red-600":"text-gray-700"}`,children:"Condition *"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{value:"new",label:"New",color:"bg-green-500 hover:bg-green-600 border-green-500"},{value:"used",label:"Used",color:"bg-blue-500 hover:bg-blue-600 border-blue-500"},{value:"refurbished",label:"Refurbished",color:"bg-purple-500 hover:bg-purple-600 border-purple-500"}].map(i=>e.jsx("button",{type:"button",onClick:()=>v(N=>({...N,condition:i.value})),className:`py-3 px-6 rounded-xl border-2 transition-all duration-200 font-semibold text-base ${o.condition===i.value?`${i.color} text-white shadow-lg`:"bg-white hover:bg-gray-50 border-gray-300 text-gray-700 hover:border-gray-400"} ${f.condition?"border-red-500":""}`,children:i.label},i.value))}),f.condition&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.condition})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:`block mb-2 text-xs font-medium ${f.description?"text-red-600":"text-gray-700"}`,children:"Description (optional)"}),e.jsx("div",{className:"relative",children:T?e.jsx("textarea",{id:"description",value:o.description,onChange:i=>v(N=>({...N,description:i.target.value})),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none transition-all duration-200 resize-none ${f.description?"border-red-500 focus:border-red-600 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}`,placeholder:"Brief description...",maxLength:500,rows:4,onBlur:()=>M(!1),autoFocus:!0}):e.jsx("input",{id:"description",type:"text",value:o.description,onChange:i=>v(N=>({...N,description:i.target.value})),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none transition-all duration-200 ${f.description?"border-red-500 focus:border-red-600 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}`,placeholder:"Brief description...",maxLength:200,onFocus:()=>M(!0)})}),f.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.description}),T&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[o.description.length,"/500 characters"]})]}),!z&&W&&e.jsxs("div",{children:[e.jsx("label",{className:`block mb-2 text-xs font-medium ${f.specification?"text-red-600":"text-gray-700"}`,children:"Specification (optional)"}),e.jsx("button",{type:"button",onClick:()=>W(),className:"group w-full bg-white border-2 border-gray-300 rounded-xl hover:border-blue-500 hover:shadow-lg transition-all duration-300 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center group-hover:bg-blue-600 transition-all duration-300 shadow-md",children:e.jsx(ft,{className:"w-6 h-6 text-white"})}),o.specification&&o.specification.length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center shadow-md",children:e.jsx(Ve,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h4",{className:"text-base font-bold text-gray-900 group-hover:text-blue-900 transition-colors duration-300",children:"Product Specifications"}),o.specification&&o.specification.length>0?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-16 overflow-y-auto",children:(()=>{const i=He(o.specification);return Object.entries(i).slice(0,4).map(([N,y])=>e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg px-2 py-1",children:[e.jsx("div",{className:"text-xs font-medium text-blue-800 truncate",children:N.replace(/_/g," ")}),e.jsx("div",{className:"text-xs text-blue-600 truncate",children:St(N,y)})]},N))})()}),(()=>{const i=He(o.specification);return Object.keys(i).length>4&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["+",Object.keys(i).length-4," more specifications"]})})()]}):e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Add detailed product specifications"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[o.specification&&o.specification.length>0&&e.jsx("div",{className:"px-3 py-1 bg-green-500 text-white text-sm font-bold rounded-full shadow-md",children:Ct(o.specification)}),e.jsx("div",{className:"w-8 h-8 bg-gray-100 group-hover:bg-blue-100 rounded-lg flex items-center justify-center transition-all duration-300",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500 group-hover:text-blue-600 transition-colors duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})})]})]})}),f.specification&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-red-500 rounded-full"}),f.specification]})]})]})})]})})},$t=({variants:o,setVariants:v,useVariants:re,setUseVariants:f,showVariants:ue,setShowVariants:S,isReorderingVariants:P,setIsReorderingVariants:W,draggedVariantIndex:z,setDraggedVariantIndex:K,onVariantSpecificationsClick:T,baseSku:M})=>{const i=()=>{const t=o.length>0?o[o.length-1]:null;let n=o.length+1,h=`Variant ${n}`;for(;o.some(l=>{var w;return((w=l.name)==null?void 0:w.toLowerCase().trim())===h.toLowerCase().trim()});)n++,h=`Variant ${n}`;const g={name:h,sku:J(o.length+1),costPrice:(t==null?void 0:t.costPrice)||0,price:(t==null?void 0:t.price)||0,stockQuantity:0,minStockLevel:2,attributes:t!=null&&t.attributes?{...t.attributes}:{},childrenVariants:[],useChildrenVariants:!1};v(l=>[...l,g])},N=t=>{v(n=>n.filter((h,g)=>g!==t))},y=(t,n,h)=>{if(n==="stockQuantity"){const g=o[t],l=h||0,w=g.childrenVariants||[];if(l===0&&g.useChildrenVariants){v(a=>a.map((u,m)=>m===t?{...u,[n]:h,childrenVariants:[],useChildrenVariants:!1}:u));return}if(g.useChildrenVariants&&l>0&&w.length>l){const a=w.slice(0,l);v(u=>u.map((m,b)=>b===t?{...m,[n]:h,childrenVariants:a}:m)),j.info(`Reduced IMEI/Serial number fields to ${l} to match stock quantity.`);return}}if(n==="name"&&h){const g=h.trim();if(g&&o.some((w,a)=>{var u;return a!==t&&((u=w.name)==null?void 0:u.toLowerCase().trim())===g.toLowerCase()})){j.error(`A variant with the name "${g}" already exists in this product`);return}}if(n==="childrenVariants"&&Array.isArray(h)){const l=o[t].stockQuantity||0,w=h.map(u=>u.trim()).filter(Boolean);if(h.length>l){j.error(`Cannot have more than ${l} IMEI/Serial number fields. Stock quantity is ${l}.`);const u=h.slice(0,l);v(m=>m.map((b,C)=>C===t?{...b,[n]:u}:b));return}if(w.length>l){j.error(`Cannot add more than ${l} filled IMEI/Serial numbers. Stock quantity is ${l}.`);return}const a=new Set(w.map(u=>u.toLowerCase()));if(w.length!==a.size){const u=w.find((m,b)=>w.findIndex(C=>C.toLowerCase()===m.toLowerCase())!==b);j.error(`Duplicate IMEI/Serial number "${u}" found in this variant. Each item must be unique.`);return}for(const u of w)if(o.some((b,C)=>C===t?!1:(b.childrenVariants||[]).some(Ie=>Ie.trim().toLowerCase()===u.toLowerCase()))){j.error(`IMEI/Serial number "${u}" already exists in another variant of this product. Each item must be unique across all variants.`);return}}v(g=>g.map((l,w)=>w===t?{...l,[n]:h}:l))},J=t=>`${M}-V${t.toString().padStart(2,"0")}`,p=(t,n)=>{K(n),t.dataTransfer.effectAllowed="move"},B=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},ge=(t,n)=>{t.preventDefault(),!(z===null||z===n)&&(v(h=>{const g=[...h],l=g[z];return g.splice(z,1),g.splice(n,0,l),g}),K(null))},[Z,R]=d.useState(null),[$,ae]=d.useState(null);d.useEffect(()=>{R(t=>o.length>0&&t===null?0:o.length===0?null:t!==null&&t>=o.length?o.length>0?0:null:t)},[o.length]),d.useEffect(()=>{const t=n=>{$!==null&&(n.target.closest(".help-tooltip-container")||ae(null))};if($!==null)return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[$]);const X=t=>{const n=typeof t=="string"?parseFloat(t):t;return n%1===0?n.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})};return e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"border-2 rounded-2xl bg-white shadow-sm border-gray-200 mb-6",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(me,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Product Variants"}),o.length>0&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[o.length," variant",o.length!==1?"s":""," added"]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:o.length>0&&e.jsxs("button",{type:"button",onClick:()=>W(!P),className:`text-xs px-3 py-1.5 rounded-lg font-semibold transition-colors ${P?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,title:"Toggle reorder mode",children:[e.jsx(bt,{size:14,className:"inline mr-1"}),P?"Done":"Reorder"]})})]})}),ue&&e.jsx("div",{className:"p-6 space-y-4",children:o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No variants added yet"})]}):o.map((t,n)=>{const h=Z===n,g=t.name&&t.price>0,l=t.price-t.costPrice,w=l>0;return e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${h?"border-blue-500 shadow-xl":g?"border-green-200 hover:border-green-300 hover:shadow-md":"border-orange-300 hover:border-orange-400 hover:shadow-md"}`,draggable:P,onDragStart:a=>p(a,n),onDragOver:B,onDrop:a=>ge(a,n),onDragEnd:()=>K(null),style:{cursor:P?"grabbing":"default"},children:[e.jsxs("div",{className:"flex items-start justify-between p-6 cursor-pointer",onClick:()=>R(h?null:n),children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[P&&e.jsx("div",{className:"w-6 h-6 flex items-center justify-center text-gray-400",children:e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 6h8v2H8V6zm0 5h8v2H8v-2zm0 5h8v2H8v-2z"})})}),e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center transition-colors ${h?"bg-blue-500":"bg-gray-200"}`,children:e.jsx("svg",{className:`w-4 h-4 text-white transition-transform duration-200 ${h?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:t.name||`Variant ${n+1}`}),g?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Done"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-orange-500 text-white shadow-sm animate-pulse",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Pending"]})]}),t.price>0&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Price: ",X(t.price)," TZS"]})]})]})}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[g&&t.costPrice>0&&e.jsx("div",{className:`px-4 py-2 rounded-xl text-base font-bold shadow-sm ${w?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}`,children:w?`+${X(l)} TZS`:"Loss"}),!P&&e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),N(n)},disabled:o.length===1,className:`p-2 rounded-xl transition-colors ${o.length===1?"text-gray-300 cursor-not-allowed":"text-red-500 hover:text-red-700 hover:bg-red-50"}`,"aria-label":"Remove variant",title:o.length===1?"Cannot delete the last variant. At least one variant is required.":"Remove variant",children:e.jsx(yt,{size:18})})]})]}),h&&e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Variant Name *"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>y(n,"name",a.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium",placeholder:"Enter variant name (e.g., 256GB - Space Black)",autoComplete:"off",autoCorrect:"off",spellCheck:!1})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Cost Price"}),e.jsx("input",{type:"text",value:t.costPrice?X(t.costPrice):"",onChange:a=>{const u=a.target.value.replace(/,/g,"");y(n,"costPrice",parseFloat(u)||0)},className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-gray-900 text-lg font-bold",placeholder:"0",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Selling Price *"}),e.jsx("input",{type:"text",value:t.price?X(t.price):"",onChange:a=>{const u=a.target.value.replace(/,/g,"");y(n,"price",parseFloat(u)||0)},className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-lg font-bold",placeholder:"0",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Stock Qty"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>y(n,"stockQuantity",Math.max(0,(t.stockQuantity||0)-1)),className:"w-14 h-12 flex items-center justify-center bg-gray-100 hover:bg-gray-200 border-2 border-gray-300 rounded-xl transition-colors text-gray-700 font-bold","aria-label":"Decrease stock quantity",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",value:t.stockQuantity||"",onChange:a=>y(n,"stockQuantity",Math.max(0,parseInt(a.target.value)||0)),className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-lg font-bold text-center",placeholder:"0",min:"0"}),e.jsx("button",{type:"button",onClick:()=>y(n,"stockQuantity",(t.stockQuantity||0)+1),className:"w-14 h-12 flex items-center justify-center bg-gray-100 hover:bg-gray-200 border-2 border-gray-300 rounded-xl transition-colors text-gray-700 font-bold","aria-label":"Increase stock quantity",children:e.jsx(he,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Min Stock"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>y(n,"minStockLevel",Math.max(0,(t.minStockLevel||0)-1)),className:"w-14 h-12 flex items-center justify-center bg-gray-100 hover:bg-gray-200 border-2 border-gray-300 rounded-xl transition-colors text-gray-700 font-bold","aria-label":"Decrease minimum stock level",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",value:t.minStockLevel||"",onChange:a=>y(n,"minStockLevel",Math.max(0,parseInt(a.target.value)||0)),className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-lg font-bold text-center",placeholder:"0",min:"0"}),e.jsx("button",{type:"button",onClick:()=>y(n,"minStockLevel",(t.minStockLevel||0)+1),className:"w-14 h-12 flex items-center justify-center bg-gray-100 hover:bg-gray-200 border-2 border-gray-300 rounded-xl transition-colors text-gray-700 font-bold","aria-label":"Increase minimum stock level",children:e.jsx(he,{className:"w-5 h-5"})})]})]})]}),e.jsxs("div",{className:"mt-4 border-2 border-indigo-200 rounded-2xl bg-gradient-to-br from-indigo-50/80 to-purple-50/50 overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-indigo-100/50 transition-colors",onClick:()=>{const a=!t.useChildrenVariants;y(n,"useChildrenVariants",a),a?(t.stockQuantity||0)>0?(t.childrenVariants||[]).length===0&&y(n,"childrenVariants",[""]):(j.error("Please set stock quantity first before tracking individual items."),y(n,"useChildrenVariants",!1)):y(n,"childrenVariants",[])},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${t.useChildrenVariants?"bg-indigo-600 shadow-lg shadow-indigo-200":"bg-gray-200"}`,children:e.jsx(jt,{className:`w-5 h-5 ${t.useChildrenVariants?"text-white":"text-gray-500"}`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:"Track Individual Items"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Add IMEI/Serial numbers for each unit"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.useChildrenVariants&&e.jsxs("div",{className:`px-3 py-1.5 text-white text-xs font-bold rounded-full shadow-md ${(t.childrenVariants||[]).filter(a=>a.trim()).length>(t.stockQuantity||0)?"bg-red-600":(t.childrenVariants||[]).filter(a=>a.trim()).length===(t.stockQuantity||0)?"bg-green-600":"bg-indigo-600"}`,children:[(t.childrenVariants||[]).filter(a=>a.trim()).length," / ",t.stockQuantity||0," items"]}),e.jsx("div",{className:`w-12 h-6 rounded-full transition-all duration-300 ${t.useChildrenVariants?"bg-indigo-600":"bg-gray-300"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-300 mt-0.5 ${t.useChildrenVariants?"translate-x-6":"translate-x-0.5"}`})})]})]})}),t.useChildrenVariants&&e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-2",children:(()=>{t.stockQuantity;const a=t.childrenVariants||[];return a.map((u,m)=>{const b=u&&u.trim()!=="";return e.jsxs("div",{className:`group relative flex items-center gap-2 p-2 rounded-xl border-2 transition-all shadow-sm hover:shadow-md ${b?"bg-white border-indigo-200 hover:border-indigo-300":"bg-gray-50 border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:`w-8 h-8 flex items-center justify-center rounded-lg text-xs font-bold flex-shrink-0 ${b?"bg-indigo-100 text-indigo-700":"bg-gray-200 text-gray-500"}`,children:m+1}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(wt,{className:`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${b?"text-gray-400":"text-gray-300"}`}),e.jsx("input",{type:"text",value:u,onChange:C=>{const V=[...a];V[m]=C.target.value,y(n,"childrenVariants",V)},placeholder:`Enter IMEI or Serial #${m+1}`,className:`w-full pl-10 pr-10 py-2.5 border-0 rounded-lg focus:outline-none focus:ring-2 text-sm font-medium bg-transparent ${b?"text-gray-900 focus:ring-indigo-500":"text-gray-400 focus:ring-gray-400"}`}),b&&e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:e.jsx(Ve,{className:"w-4 h-4 text-green-500"})})]}),e.jsx("button",{type:"button",onClick:C=>{C.stopPropagation();const V=[...a];V.splice(m,1),y(n,"childrenVariants",V)},className:"px-3 py-1.5 rounded-lg text-xs font-semibold transition-all bg-red-100 text-red-600 hover:bg-red-200",title:"Remove this field",children:"Skip"})]},m)})})()}),(()=>{const a=t.stockQuantity||0,m=(t.childrenVariants||[]).length,b=m<a,C=a-m;return b&&e.jsxs("button",{type:"button",onClick:()=>{const V=[...t.childrenVariants||[],""];y(n,"childrenVariants",V)},className:"w-full px-4 py-3 border-2 border-dashed border-indigo-300 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 transition-all flex items-center justify-center gap-2 text-indigo-600 text-sm font-bold shadow-sm hover:shadow-md",children:[e.jsx(he,{size:18,className:"text-indigo-600"}),"Add Field (",C," remaining)"]})})(),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"text-xs font-semibold text-indigo-900",children:["Stock: ",t.stockQuantity||0," items. Fields: ",(t.childrenVariants||[]).length," / ",t.stockQuantity||0,". Filled: ",(t.childrenVariants||[]).filter(a=>a.trim()).length]}),e.jsxs("div",{className:"relative help-tooltip-container",children:[e.jsx("button",{type:"button",onClick:()=>ae($===n?null:n),className:"w-6 h-6 flex items-center justify-center rounded-full bg-indigo-100 hover:bg-indigo-200 text-indigo-600 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500",title:"Click for help","aria-label":"Show help information","aria-expanded":$===n,children:e.jsx(Nt,{size:16})}),$===n&&e.jsxs("div",{className:"absolute right-0 bottom-full mb-2 w-72 bg-white rounded-lg shadow-xl border-2 border-indigo-200 p-4 z-50",children:[e.jsx("div",{className:"absolute bottom-0 right-4 transform translate-y-full",children:e.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-indigo-200"})}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-bold text-indigo-900",children:"Track Individual Items"}),e.jsx("button",{type:"button",onClick:()=>ae(null),className:"text-indigo-400 hover:text-indigo-600 transition-colors","aria-label":"Close help",children:e.jsx(_e,{size:14})})]}),e.jsxs("ul",{className:"text-xs text-indigo-800 space-y-1.5",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 font-bold mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Each IMEI/Serial number will be created as a child variant"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 font-bold mt-0.5",children:"â€¢"}),e.jsxs("span",{children:["Add fields as needed (up to ",t.stockQuantity||0," based on stock quantity)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 font-bold mt-0.5",children:"â€¢"}),e.jsx("span",{children:'Use the "Skip" button to remove a field'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 font-bold mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Stock quantity determines the maximum number of fields"})]})]})]})]})]})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>T(n),className:"w-full bg-white border-2 border-gray-300 rounded-xl hover:border-purple-500 hover:shadow-lg transition-all p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(me,{className:"w-6 h-6 text-white"})}),t.attributes&&Object.keys(t.attributes).length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center shadow-md",children:e.jsx(Ve,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Specifications"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:t.attributes&&Object.keys(t.attributes).length>0?`${Object.keys(t.attributes).length} spec${Object.keys(t.attributes).length!==1?"s":""} added`:"Add variant specifications"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.attributes&&Object.keys(t.attributes).length>0&&e.jsx("div",{className:"px-3 py-1.5 bg-purple-600 text-white text-sm font-bold rounded-full shadow-md",children:Object.keys(t.attributes).length}),e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})})]})]})})})]})]},n)})}),e.jsx("div",{className:"p-6 pt-0",children:e.jsxs("button",{type:"button",onClick:i,className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-xl hover:border-green-500 hover:bg-green-50 transition-all flex items-center justify-center gap-2 text-gray-600 hover:text-green-600 font-semibold",children:[e.jsx(he,{size:20}),"Add New Variant"]})})]})})},Lt=_t({name:se().min(1,"Product name must be provided").max(100,"Product name must be less than 100 characters"),description:se().max(200,"Description must be less than 200 characters").optional(),specification:se().max(1e3,"Specification must be less than 1000 characters").optional().refine(o=>{if(!o)return!0;try{return JSON.parse(o),!0}catch{return!1}},{message:"Specification must be valid JSON"}),sku:se().max(50,"SKU must be less than 50 characters").optional(),categoryId:se().min(1,"Category must be selected"),condition:It(["new","used","refurbished"],{errorMap:()=>({message:"Please select a condition"})}),metadata:At(se(),We()).optional().default({}),variants:Pt(We()).optional().default([])}),Ht=({isOpen:o,onClose:v,onProductCreated:re,onProductAdded:f,currency:ue})=>{var Re;const{currentBranch:S}=ut(),{loadProducts:P}=ht(),[W,z]=d.useState([]),[K,T]=d.useState({}),M=()=>vt(),[i,N]=d.useState({name:"",sku:M(),categoryId:"",condition:"new",description:"",specification:"",metadata:{},variants:[]}),[y,J]=d.useState(!1),[p,B]=d.useState([]),[ge,Z]=d.useState(!0),[R,$]=d.useState(!1),[ae,X]=d.useState(!1),[t,n]=d.useState(null),[h,g]=d.useState(!1),[l,w]=d.useState(null),[a,u]=d.useState(""),[m,b]=d.useState("");d.useState("laptop");const[C,V]=d.useState(0),[Ie,xe]=d.useState(!1),[O,Ae]=d.useState([]),[Pe,U]=d.useState(!1),[pe,ne]=d.useState(-1),Me=d.useRef(null),[oe,ie]=d.useState([]),[fe,F]=d.useState(!1),[be,le]=d.useState(-1),Y=d.useRef(null),[ye,De]=d.useState({top:0,left:0,width:0}),Je=["processor","cpu","gpu","graphics","ram","memory","storage","storage_type","screen_size","display","resolution","refresh_rate","display_type","battery","battery_capacity","battery_life","fast_charging","wireless_charging","camera","front_camera","rear_camera","optical_zoom","color","weight","dimensions","size","thickness","wifi","bluetooth","network","5g_support","wifi_6","os","operating_system","warranty","warranty_period","touch","touchscreen","touch_screen","oled_display","amoled_display","high_refresh_rate","hdr_support","fingerprint_scanner","face_id","security_chip","waterproof","dust_resistant","drop_resistant","military_grade","usb_c_port","usb_c_ports","usb_a_ports","thunderbolt","hdmi_port","headphone_jack","backlit_keyboard","stylus_support","convertible","detachable","dual_sim","esim_support","nfc","gps","stereo_speakers","noise_cancellation","haptic_feedback","expandable_storage","sd_card_slot"];Vt(o||h),d.useEffect(()=>{if(a.trim()&&h){const s=Je.filter(r=>r.toLowerCase().includes(a.toLowerCase()));Ae(s),U(s.length>0),ne(-1)}else Ae([]),U(!1)},[a,h]);const Ze=s=>{u(s),U(!0)},$e=s=>{var r;u(s),U(!1),ne(-1),(r=Me.current)==null||r.focus()},Xe=s=>{!Pe||O.length===0||(s.key==="ArrowDown"?(s.preventDefault(),ne(r=>r<O.length-1?r+1:r)):s.key==="ArrowUp"?(s.preventDefault(),ne(r=>r>0?r-1:-1)):s.key==="Enter"&&pe>=0?(s.preventDefault(),$e(O[pe])):s.key==="Escape"&&(U(!1),ne(-1)))},Le=s=>{const r=s.toLowerCase(),c=[];return(r.includes("processor")||r.includes("cpu"))&&(c.push("Intel Core i3","Intel Core i5","Intel Core i7","Intel Core i9"),c.push("Intel Core i5-11th Gen","Intel Core i7-11th Gen","Intel Core i9-11th Gen"),c.push("Intel Core i5-12th Gen","Intel Core i7-12th Gen","Intel Core i9-12th Gen"),c.push("Intel Core i5-13th Gen","Intel Core i7-13th Gen","Intel Core i9-13th Gen"),c.push("AMD Ryzen 3","AMD Ryzen 5","AMD Ryzen 7","AMD Ryzen 9"),c.push("AMD Ryzen 5 5000","AMD Ryzen 7 5000","AMD Ryzen 9 5000"),c.push("AMD Ryzen 5 6000","AMD Ryzen 7 6000","AMD Ryzen 9 6000"),c.push("Snapdragon 888","Snapdragon 8 Gen 1","Snapdragon 8 Gen 2","Snapdragon 8 Gen 3"),c.push("Snapdragon 870","Snapdragon 778G","Snapdragon 695"),c.push("Apple A14 Bionic","Apple A15 Bionic","Apple A16 Bionic","Apple A17 Pro"),c.push("Apple M1","Apple M1 Pro","Apple M1 Max","Apple M2","Apple M2 Pro","Apple M2 Max","Apple M3")),r.includes("storage")&&!r.includes("type")&&(c.push("128GB SSD","256GB SSD","512GB SSD","1TB SSD","2TB SSD"),c.push("500GB HDD","1TB HDD","2TB HDD","4TB HDD"),c.push("128GB NVMe SSD","256GB NVMe SSD","512GB NVMe SSD","1TB NVMe SSD")),(r.includes("ram")||r.includes("memory"))&&(c.push("4GB","8GB","16GB","32GB","64GB","128GB"),c.push("DDR4","DDR5","LPDDR4","LPDDR5")),c};d.useEffect(()=>{if(a.trim()&&h){const s=Le(a);if(m.trim()){const r=s.filter(c=>c.toLowerCase().includes(m.toLowerCase()));ie(r),F(r.length>0)}else ie(s),F(s.length>0);le(-1)}else ie([]),F(!1)},[m,a,h]);const Ee=s=>{var r;b(s),F(!1),le(-1),(r=Y.current)==null||r.focus()},Ye=s=>{!fe||oe.length===0||(s.key==="ArrowDown"?(s.preventDefault(),le(r=>r<oe.length-1?r+1:r)):s.key==="ArrowUp"?(s.preventDefault(),le(r=>r>0?r-1:-1)):s.key==="Enter"&&be>=0?(s.preventDefault(),Ee(oe[be])):s.key==="Escape"&&(F(!1),le(-1)))};d.useEffect(()=>{p.length>0&&i.sku&&B(s=>s.map((r,c)=>({...r,sku:`${i.sku}-V${(c+1).toString().padStart(2,"0")}`})))},[i.sku]);const[Be,ze]=d.useState(!1),[et,Te]=d.useState(!1),{currentUser:je}=mt(),tt=s=>{$(s),Z(s||p.length>0)};d.useEffect(()=>{p.length>0&&($(!0),Z(!0))},[p.length]),d.useEffect(()=>{o?((async()=>{try{const r=await gt();z(r)}catch(r){console.error("Error loading categories:",r),j.error("Failed to load categories")}})(),N(r=>({...r,sku:M()}))):(N({name:"",sku:M(),categoryId:"",condition:"new",description:"",specification:"",metadata:{},variants:[]}),B([]),T({}),$(!1),Z(!0))},[o]);const st=async s=>{if(!s.trim()){Te(!1);return}ze(!0);try{const{data:r,error:c}=await te.from("lats_products").select("id").ilike("name",s.trim()).limit(1);if(c)throw c;Te(r&&r.length>0)}catch(r){console.error("Error checking product name:",r)}finally{ze(!1)}},rt=s=>{w(s),g(!0)},at=async s=>{s&&s.preventDefault();try{Lt.parse(i)}catch(r){if(r instanceof Mt){const c={};r.errors.forEach(_=>{_.path.length>0&&(c[_.path[0]]=_.message)}),T(c),j.error("Please fix the validation errors");return}}if(!(S!=null&&S.id)){j.error("No branch selected");return}J(!0);try{const _=i.sku||M(),ee={...i.metadata||{},...i.specification?{specification:i.specification}:{},...i.condition?{condition:i.condition}:{}};let H=(S==null?void 0:S.id)||null;if(H){console.log("ðŸ” [AddProductModal] Validating branch_id:",H);const{data:k}=await te.from("store_locations").select("id").eq("id",H).single();k||(console.warn("âš ï¸ [AddProductModal] Current branch ID not found in store_locations, setting to null"),H=null)}const Fe={name:i.name,description:i.description||null,sku:_,category_id:i.categoryId||null,branch_id:H,cost_price:0,selling_price:0,stock_quantity:0,min_stock_level:0,total_quantity:0,total_value:0,attributes:ee,metadata:{useVariants:R,variantCount:R?p.length:0,skip_default_variant:R&&p.length>0,createdBy:je==null?void 0:je.id,createdAt:new Date().toISOString()},is_active:!0};console.log("ðŸ”„ [AddProductModal] Creating product with data:",Fe);const{data:G,error:I}=await Oe(async()=>await te.from("lats_products").insert([Fe]).select().single());if(console.log("ðŸ” [AddProductModal] INSERT result:",{data:G,error:I,hasData:!!G,hasError:!!I}),I)throw console.error("âŒ [AddProductModal] Product creation failed with error:",I),console.error("Error details:",{message:I.message,code:I.code,details:I.details,hint:I.hint}),I.code==="23503"?j.error("Invalid branch assignment. Please refresh the page and try again."):I.code==="23505"?j.error("A product with this SKU already exists."):j.error(`Product creation failed: ${I.message}`),I;if(!G){console.error("âŒ [AddProductModal] Product creation returned null WITHOUT an error!"),console.error("âŒ This usually means RLS policy allows INSERT but blocks SELECT");const{data:{user:k}}=await te.auth.getUser();console.error("âŒ Current user:",k),console.error("âŒ User ID:",k==null?void 0:k.id),j.error("Product creation failed - database returned no data. Please check your permissions.");return}if(console.log("âœ… [AddProductModal] Product created successfully:",G),G&&p.length>0){const k=p.map(x=>{var L;return(L=x.name)==null?void 0:L.toLowerCase().trim()}).filter(Boolean),ct=new Set(k);if(k.length!==ct.size){const x=k.find((L,Q)=>k.indexOf(L)!==Q);j.error(`Duplicate variant name detected: "${x}". Each variant must have a unique name.`),J(!1);return}console.log("ðŸ”„ [AddProductModal] Creating user-defined variants for product:",G.id),console.log("Variants from form:",p.map(x=>({name:x.name,sku:x.sku})));const Ge=p.map((x,L)=>({product_id:G.id,branch_id:(S==null?void 0:S.id)||null,name:x.name||`Variant ${L+1}`,variant_name:x.name||`Variant ${L+1}`,sku:x.sku||`${i.sku}-V${(L+1).toString().padStart(2,"0")}`,cost_price:x.costPrice||0,unit_price:x.price||0,selling_price:x.price||0,quantity:x.stockQuantity||0,min_quantity:x.minStockLevel||0,variant_attributes:{...x.attributes,specification:x.specification||null},attributes:x.attributes||{},is_active:!0,is_parent:x.useChildrenVariants&&x.childrenVariants&&x.childrenVariants.filter(Q=>Q.trim()).length>0,variant_type:x.useChildrenVariants&&x.childrenVariants&&x.childrenVariants.filter(Q=>Q.trim()).length>0?"parent":null}));console.log("ðŸ”„ [AddProductModal] Variant data to insert:",Ge);const{data:ce,error:Qe}=await Oe(async()=>await te.from("lats_product_variants").insert(Ge).select());if(Qe)console.error("âŒ [AddProductModal] Error creating variants:",Qe),j.error("Product created but failed to create variants");else if(console.log("âœ… [AddProductModal] Variants created successfully:",ce),ce&&ce.length>0){const{addIMEIToParentVariant:x,checkIMEIExists:L}=await Ce(()=>import("./imeiVariantService-4ce4b8b1.js"),["assets/imeiVariantService-4ce4b8b1.js","assets/supabase-cf010ec4.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),Q=[];for(const D of p)if(D.useChildrenVariants&&D.childrenVariants){const A=D.childrenVariants.filter(E=>E.trim().length>0);Q.push(...A.map(E=>E.trim()))}const qe=new Set,ve=[];for(const D of Q){const A=D.toLowerCase();qe.has(A)?ve.push(D):qe.add(A)}if(ve.length>0){j.error(`Duplicate IMEI/Serial numbers found: ${ve.join(", ")}. Each item must be unique across all variants.`),J(!1);return}for(let D=0;D<ce.length;D++){const A=ce[D],E=p[D];if(E.useChildrenVariants&&E.childrenVariants&&E.childrenVariants.length>0){const ke=E.childrenVariants.filter(de=>de.trim().length>0);if(ke.length>0){console.log(`ðŸ”„ [AddProductModal] Creating ${ke.length} children variants for variant ${A.id}`),A.is_parent||await te.from("lats_product_variants").update({is_parent:!0,variant_type:"parent",updated_at:new Date().toISOString()}).eq("id",A.id);const de=[];for(const dt of ke){const q=dt.trim();if(await L(q)){console.warn(`âš ï¸ [AddProductModal] IMEI/Serial ${q} already exists, skipping`),j.error(`IMEI/Serial ${q} already exists`);continue}const Se=await x(A.id,{imei:q,serial_number:q,cost_price:E.costPrice||A.cost_price||0,selling_price:E.price||A.selling_price||0,condition:"new",source:"purchase"});Se.success?de.push(q):(console.error(`âŒ [AddProductModal] Failed to add child variant ${q}:`,Se.error),j.error(`Failed to add IMEI/Serial ${q}: ${Se.error}`))}de.length>0&&console.log(`âœ… [AddProductModal] Created ${de.length} children variants for variant ${A.id}`)}}}}}console.log("ðŸ”„ [AddProductModal] Clearing all product caches and reloading..."),xt.clearProducts();const{invalidateCachePattern:it}=await Ce(()=>import("./index-61458a34.js").then(k=>k.be),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);it("products:*");const{smartCache:lt}=await Ce(()=>import("./enhancedCacheManager-afe341e0.js"),["assets/enhancedCacheManager-afe341e0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);lt.invalidateCache("products"),await P(null,!0),console.log("âœ… [AddProductModal] Products reloaded successfully"),j.success("Product created successfully!"),re&&re(),f&&f(G),v(),N({name:"",sku:M(),categoryId:"",condition:"new",description:"",specification:"",metadata:{},variants:[]}),B([]),T({})}catch(r){console.error("âŒ [AddProductModal] Error creating product:",r),console.error("Error details:",JSON.stringify(r,null,2)),j.error(r.message||"Failed to create product. Please try again.")}finally{J(!1)}};if(!o)return null;const nt=[i.name,i.categoryId,i.condition].filter(Boolean).length,ot=p.filter(s=>s.name&&s.price>0).length,we=nt+ot,Ne=3+p.length-we;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[99999]",onClick:v,"aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100000] p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative pointer-events-auto",onClick:s=>s.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"add-product-modal-title",children:[e.jsx("button",{onClick:v,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",disabled:y,children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ke,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"add-product-modal-title",className:"text-2xl font-bold text-gray-900 mb-3",children:"Add New Product"}),e.jsxs("div",{className:"flex items-center gap-4",children:[we>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),e.jsxs("span",{className:"text-sm font-bold text-green-700",children:[we," Complete"]})]}),Ne>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg animate-pulse",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[Ne," Pending"]})]})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-4",children:[e.jsx(Dt,{formData:i,setFormData:N,categories:W,currentErrors:K,isCheckingName:Be,nameExists:et,onNameCheck:st,useVariants:R,onGenerateSKU:M}),e.jsx($t,{variants:p,setVariants:B,useVariants:R,setUseVariants:tt,showVariants:ge,setShowVariants:Z,isReorderingVariants:ae,setIsReorderingVariants:X,draggedVariantIndex:t,setDraggedVariantIndex:n,onVariantSpecificationsClick:rt,baseSku:i.sku})]})}),e.jsxs("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:[Ne>0&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 border border-orange-200 rounded-lg flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-orange-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"Please complete all required fields before creating the product."})]}),e.jsx("form",{onSubmit:at,children:e.jsx("button",{type:"submit",disabled:y||Be||!i.name||!i.categoryId||!i.condition,className:"w-full px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg",children:y?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):"Create Product"})})]})]})}),h&&l!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100002]",onClick:()=>{g(!1),V(0),u(""),b(""),xe(!1)}}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100003] p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden relative pointer-events-auto max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{onClick:()=>{g(!1),V(0),u(""),b(""),xe(!1)},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-10","aria-label":"Close modal",children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(me,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Variant Specifications"}),e.jsx("p",{className:"text-sm text-purple-700 font-medium",children:((Re=p[l])==null?void 0:Re.name)||`Variant ${l!==null?l+1:""}`})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:l!==null&&p[l]&&e.jsxs("div",{className:"py-4 space-y-4",children:[p[l].attributes&&Object.keys(p[l].attributes||{}).length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Current Specifications"}),e.jsx("div",{className:"space-y-2",children:Object.entries(p[l].attributes||{}).map(([s,r])=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-xl",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[s.replace(/_/g," "),":"]}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:String(r)})]}),e.jsx("button",{type:"button",onClick:()=>{const c={...p[l].attributes};delete c[s],B(_=>_.map((ee,H)=>H===l?{...ee,attributes:c}:ee))},className:"text-red-500 hover:text-red-700 hover:bg-red-50 px-3 py-1.5 rounded-lg transition-colors text-sm font-medium",children:"Remove"})]},s))})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Add Specification"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Attribute Name"}),e.jsx("input",{ref:Me,type:"text",value:a,onChange:s=>Ze(s.target.value),onKeyDown:Xe,onFocus:()=>{a.trim()&&O.length>0&&U(!0)},onBlur:()=>{setTimeout(()=>U(!1),200)},placeholder:"e.g., Color, Size, Storage, Processor",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-sm",autoComplete:"off"}),Pe&&O.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border-2 border-purple-200 rounded-xl shadow-lg max-h-60 overflow-y-auto",children:O.map((s,r)=>e.jsx("button",{type:"button",onClick:()=>$e(s),className:`w-full text-left px-4 py-2.5 text-sm hover:bg-purple-50 transition-colors ${r===pe?"bg-purple-100":""} ${r===0?"rounded-t-xl":""} ${r===O.length-1?"rounded-b-xl":""}`,children:e.jsx("span",{className:"font-medium text-gray-800",children:s})},s))})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Value"}),e.jsx("input",{ref:Y,type:"text",value:m,onChange:s=>{if(b(s.target.value),Y.current){const r=Y.current.getBoundingClientRect();De({top:r.bottom+window.scrollY,left:r.left+window.scrollX,width:r.width})}},onKeyDown:s=>{if(Ye(s),s.key==="Enter"&&!fe&&a&&m){const r={...p[l].attributes,[a]:m};B(c=>c.map((_,ee)=>ee===l?{..._,attributes:r}:_)),u(""),b("")}},onFocus:()=>{if(Y.current){const s=Y.current.getBoundingClientRect();De({top:s.bottom+window.scrollY,left:s.left+window.scrollX,width:s.width})}if(a.trim()){const s=Le(a);if(m.trim()){const r=s.filter(c=>c.toLowerCase().includes(m.toLowerCase()));ie(r),F(r.length>0)}else ie(s),F(s.length>0)}},onBlur:()=>{setTimeout(()=>F(!1),200)},placeholder:"e.g., Black, Large, 256GB",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-sm",autoComplete:"off"}),fe&&oe.length>0&&pt.createPortal(e.jsx("div",{className:"fixed z-[999999] bg-white border-2 border-purple-200 rounded-xl shadow-2xl max-h-60 overflow-y-auto p-2",style:{top:`${ye.top}px`,left:`${ye.left}px`,width:`${ye.width}px`,maxWidth:"100vw"},children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:oe.map((s,r)=>e.jsx("button",{type:"button",onClick:()=>Ee(s),className:`w-full text-left px-3 py-2 text-sm hover:bg-purple-50 transition-colors rounded-lg border ${r===be?"bg-purple-100 border-purple-300":"border-gray-200 hover:border-purple-200"}`,children:e.jsx("span",{className:"font-medium text-gray-800",children:s})},s))})}),document.body)]}),e.jsx("button",{type:"button",onClick:()=>{if(a&&m){const s={...p[l].attributes,[a]:m};B(r=>r.map((c,_)=>_===l?{...c,attributes:s}:c)),u(""),b("")}},disabled:!a||!m,className:"w-full px-4 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors text-sm font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:"Add Specification"})]})]})]})}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsx("button",{type:"button",onClick:()=>{g(!1),V(0),u(""),b(""),xe(!1),j.success("Specifications saved!")},className:"w-full px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all shadow-lg hover:shadow-xl text-lg",children:"Save & Close"})})]})})]})]})};export{Ht as A,Dt as P,$t as a};
