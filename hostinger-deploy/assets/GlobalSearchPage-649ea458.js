import{j as e,e as g,b as ee,a2 as we,a3 as Ce,u as ke,c as De}from"./index-61458a34.js";import{r as o}from"./vendor-36d2c7c1.js";import{S as Re,a as Le}from"./SearchResults-c1876f8f.js";import{G as J}from"./GlassSelect-e243562f.js";import{G as q}from"./GlassInput-0475021a.js";import{f as P}from"./currencyUtils-59109a41.js";import{D as se,v as Z,a4 as Te,p as _,af as Y,av as V,r as Ae,y as te,u as Oe,aq as Ee,aa as $e,ab as Ie,G as Ue,bv as ae,g as Fe,aF as re,Z as Be,X as Me,a8 as Je}from"./ui-28e30067.js";import{a as le,u as Pe}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";import"./phoneUtils-a8934478.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";const Qe=({searchHistory:d,savedSearches:S,recentSearches:$,currentQuery:C,resultCount:A})=>{const[h,b]=o.useState({totalSearches:0,averageResults:0,topQueries:[],searchesByHour:[],mostActiveDays:[],savedSearchCount:0,searchTrends:[]});o.useEffect(()=>{I()},[d,S,$]);const I=()=>{const n=d.length,u=n>0?Math.round(d.reduce((m,x)=>m+(x.resultCount||0),0)/n):0,f=d.reduce((m,x)=>(m[x.query]=(m[x.query]||0)+1,m),{}),N=Object.entries(f).sort(([,m],[,x])=>x-m).slice(0,5).map(([m])=>m),w=new Array(24).fill(0);d.forEach(m=>{const x=new Date(m.timestamp).getHours();w[x]++});const U=d.reduce((m,x)=>{const v=new Date(x.timestamp).toLocaleDateString();return m[v]=(m[v]||0)+1,m},{}),E=Object.entries(U).sort(([,m],[,x])=>x-m).slice(0,5).map(([m])=>m),k=Array.from({length:7},(m,x)=>{const v=new Date;return v.setDate(v.getDate()-x),v.toISOString().split("T")[0]}).reverse().map(m=>{const x=d.filter(v=>v.timestamp.startsWith(m)).length;return{day:new Date(m).toLocaleDateString("en-US",{weekday:"short"}),count:x}});b({totalSearches:n,averageResults:u,topQueries:N,searchesByHour:w,mostActiveDays:E,savedSearchCount:S.length,searchTrends:k})},O=()=>{const n={analytics:h,searchHistory:d,savedSearches:S,recentSearches:$,exportDate:new Date().toISOString()},u=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),f=window.URL.createObjectURL(u),N=document.createElement("a");N.href=f,N.download=`search-analytics-${new Date().toISOString().split("T")[0]}.json`,N.click(),window.URL.revokeObjectURL(f)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Search Analytics"}),e.jsx("p",{className:"text-gray-600",children:"Insights into your search behavior and patterns"})]}),e.jsxs("button",{onClick:O,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Z,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:h.totalSearches}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Searches"})]})]})}),e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Te,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:h.averageResults}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg Results"})]})]})}),e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(_,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:h.savedSearchCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Saved Searches"})]})]})}),e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(Y,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:h.topQueries.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Top Queries"})]})]})})]}),C&&e.jsxs(g,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Current Search"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:A||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Results Found"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-medium text-gray-900 truncate",children:['"',C,'"']}),e.jsx("div",{className:"text-sm text-gray-600",children:"Current Query"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-medium text-gray-900",children:$.includes(C)?"Yes":"No"}),e.jsx("div",{className:"text-sm text-gray-600",children:"In Recent Searches"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(g,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Search Trends (Last 7 Days)"]}),e.jsx("div",{className:"space-y-3",children:h.searchTrends.map((n,u)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:n.day}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${Math.min(n.count/Math.max(...h.searchTrends.map(f=>f.count))*100,100)}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 w-8 text-right",children:n.count})]})]},u))})]}),e.jsxs(g,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(V,{className:"w-5 h-5 mr-2"}),"Top Search Queries"]}),e.jsx("div",{className:"space-y-3",children:h.topQueries.map((n,u)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium truncate flex-1",children:n}),e.jsxs("span",{className:"text-sm text-gray-600 bg-gray-100 px-2 py-1 rounded",children:[ze[n]," searches"]})]},u))})]}),e.jsxs(g,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2"}),"Most Active Days"]}),e.jsx("div",{className:"space-y-3",children:h.mostActiveDays.map((n,u)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:n}),e.jsxs("span",{className:"text-sm text-gray-600 bg-green-100 text-green-800 px-2 py-1 rounded",children:[He[n]," searches"]})]},u))})]}),e.jsxs(g,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(te,{className:"w-5 h-5 mr-2"}),"Searches by Hour"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:h.searchesByHour.map((n,u)=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-gray-600 mb-1",children:[u,":00"]}),e.jsx("div",{className:`h-8 rounded ${n>0?"bg-blue-500":"bg-gray-200"}`,style:{opacity:n>0?.3+n/Math.max(...h.searchesByHour)*.7:1}}),e.jsx("div",{className:"text-xs font-medium mt-1",children:n})]},u))})]})]}),S.length>0&&e.jsxs(g,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Saved Searches"}),e.jsx("div",{className:"space-y-3",children:S.slice(0,5).map((n,u)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:n.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:['"',n.query,'"']})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(n.createdAt).toLocaleDateString()})]},n.id))})]})]})},ze={},He={},Ge=({query:d,onQueryChange:S,userRole:$})=>{const C=le(),{customers:A}=ee(),h=we(),b=Ce(),[I,O]=o.useState([]),[n,u]=o.useState([]),[f,N]=o.useState(!1),[w,U]=o.useState("list"),[E,B]=o.useState("relevance"),[k,m]=o.useState("desc"),[x,v]=o.useState(new Set),[c,j]=o.useState({type:"all",category:"all",status:"all",dateRange:"all",amountRange:"all",location:"",tags:[],priority:"all"}),[D,R]=o.useState([]),[ce,Q]=o.useState(!1),[z,W]=o.useState(""),[F,ne]=o.useState({totalResults:0,searchTime:0,topCategories:[],resultDistribution:{}}),[H,ie]=o.useState(!1),[oe,de]=o.useState([]),[me,xe]=o.useState([]),he=[{value:"all",label:"All Time"},{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"},{value:"quarter",label:"This Quarter"},{value:"year",label:"This Year"}],ue=[{value:"all",label:"All Types"},{value:"device",label:"Devices"},{value:"customer",label:"Customers"},{value:"product",label:"Products"},{value:"employee",label:"Employees"},{value:"sale",label:"Sales"},{value:"payment",label:"Payments"},{value:"order",label:"Orders"},{value:"report",label:"Reports"}],K=o.useCallback(async()=>{if(!d.trim()){O([]),u([]);return}const s=Date.now();N(!0);try{const t=[];A.forEach(a=>{var p,L,T;((p=a.name)!=null&&p.toLowerCase().includes(d.toLowerCase())||(L=a.phone)!=null&&L.toLowerCase().includes(d.toLowerCase())||(T=a.email)!=null&&T.toLowerCase().includes(d.toLowerCase()))&&t.push({id:a.id,type:"customer",title:a.name||"Unknown Customer",subtitle:a.phone||"No Phone",description:`Points: ${a.points||0} | Spent: ${P.money(a.totalSpent||0)}`,icon:e.jsx(_,{className:"w-4 h-4"}),url:`/customers/${a.id}`,metadata:a,priority:2,status:a.isActive?"active":"inactive",amount:a.totalSpent,tags:[a.loyaltyLevel,a.colorTag].filter(Boolean)})}),b.forEach(a=>{var p,L,T;((p=a.name)!=null&&p.toLowerCase().includes(d.toLowerCase())||(L=a.sku)!=null&&L.toLowerCase().includes(d.toLowerCase())||(T=a.description)!=null&&T.toLowerCase().includes(d.toLowerCase()))&&t.push({id:a.id,type:"product",title:a.name||"Unknown Product",subtitle:`SKU: ${a.sku||"N/A"}`,description:`Stock: ${a.stock_quantity||0} | Price: ${P.money(a.price||0)}`,icon:e.jsx(Oe,{className:"w-4 h-4"}),url:`/products/${a.id}`,metadata:a,priority:3,amount:a.price,tags:a.category?[a.category]:[]})}),h.forEach(a=>{var p,L,T;((p=a.full_name)!=null&&p.toLowerCase().includes(d.toLowerCase())||(L=a.email)!=null&&L.toLowerCase().includes(d.toLowerCase())||(T=a.position)!=null&&T.toLowerCase().includes(d.toLowerCase()))&&t.push({id:a.id,type:"employee",title:a.full_name||"Unknown Employee",subtitle:a.position||"No Position",description:`Department: ${a.department||"N/A"} | Status: ${a.status}`,icon:e.jsx(_,{className:"w-4 h-4"}),url:`/employees/${a.id}`,metadata:a,priority:4,status:a.status,tags:[a.department,a.status].filter(Boolean)})}),t.sort((a,p)=>a.priority-p.priority);const l=t.map(a=>({...a,score:ge(a,d)}));O(l),u(G(l));const r=Date.now()-s,i=l.reduce((a,p)=>(a[p.type]=(a[p.type]||0)+1,a),{}),y=Object.entries(i).sort(([,a],[,p])=>p-a).slice(0,5).map(([a])=>a);ne({totalResults:l.length,searchTime:r,topCategories:y,resultDistribution:i})}catch(t){console.error("Search error:",t),O([]),u([])}finally{N(!1)}},[d,devices,A,b,h]),ge=(s,t)=>{var i;let l=0;const r=t.toLowerCase();return s.title.toLowerCase().includes(r)&&(l+=100),s.subtitle.toLowerCase().includes(r)&&(l+=50),s.description.toLowerCase().includes(r)&&(l+=25),(i=s.tags)==null||i.forEach(y=>{y.toLowerCase().includes(r)&&(l+=10)}),l+=(10-s.priority)*5,l},G=o.useCallback(s=>s.filter(t=>{if(c.type!=="all"&&t.type!==c.type||c.status!=="all"&&t.status!==c.status||c.category!=="all"&&t.category!==c.category)return!1;if(c.priority!=="all"){const l=parseInt(c.priority);if(t.priority!==l)return!1}if(c.dateRange!=="all"&&t.date){const l=new Date(t.date),r=new Date;switch(c.dateRange){case"today":if(l.toDateString()!==r.toDateString())return!1;break;case"week":const i=new Date(r.getTime()-7*24*60*60*1e3);if(l<i)return!1;break;case"month":const y=new Date(r.getFullYear(),r.getMonth()-1,r.getDate());if(l<y)return!1;break;case"quarter":const a=new Date(r.getFullYear(),r.getMonth()-3,r.getDate());if(l<a)return!1;break;case"year":const p=new Date(r.getFullYear()-1,r.getMonth(),r.getDate());if(l<p)return!1;break}}if(c.amountRange!=="all"&&t.amount!==void 0){const[l,r]=c.amountRange.includes("-")?c.amountRange.split("-").map(i=>parseFloat(i)):c.amountRange==="5000+"?[5e3,1/0]:[0,parseFloat(c.amountRange.split("-")[1])];if(t.amount<l||t.amount>r)return!1}return!(c.location&&t.location&&!t.location.toLowerCase().includes(c.location.toLowerCase())||c.tags.length>0&&!c.tags.some(r=>{var i;return(i=t.tags)==null?void 0:i.some(y=>y.toLowerCase().includes(r.toLowerCase()))}))}),[c]),M=o.useMemo(()=>{const s=[...n];return s.sort((t,l)=>{let r,i;switch(E){case"relevance":r=t.score||0,i=l.score||0;break;case"date":r=t.date?new Date(t.date).getTime():0,i=l.date?new Date(l.date).getTime():0;break;case"name":r=t.title.toLowerCase(),i=l.title.toLowerCase();break;case"amount":r=t.amount||0,i=l.amount||0;break;case"status":r=t.status||"",i=l.status||"";break;default:return 0}return k==="asc"?r>i?1:r<i?-1:0:r<i?1:r>i?-1:0}),s},[n,E,k]);o.useEffect(()=>{const s=setTimeout(()=>{K()},300);return()=>clearTimeout(s)},[K]),o.useEffect(()=>{u(G(I))},[I,G]),o.useEffect(()=>{const s=localStorage.getItem("savedSearches");if(s)try{R(JSON.parse(s))}catch(r){console.error("Error loading saved searches:",r)}const t=localStorage.getItem("searchHistory");if(t)try{de(JSON.parse(t))}catch(r){console.error("Error loading search history:",r)}const l=localStorage.getItem("recentSearches");if(l)try{xe(JSON.parse(l))}catch(r){console.error("Error loading recent searches:",r)}},[]);const pe=s=>{C(s.url)},X=s=>{const t=Array.from(x);switch(s){case"export":je(t);break;case"bookmark":ve(t);break;case"share":ye(t);break;default:console.log("Unknown bulk action:",s)}},je=s=>{const t=M.filter(a=>s.includes(a.id)),l=fe(t),r=new Blob([l],{type:"text/csv"}),i=window.URL.createObjectURL(r),y=document.createElement("a");y.href=i,y.download=`search_results_${d}_${new Date().toISOString().split("T")[0]}.csv`,y.click(),window.URL.revokeObjectURL(i)},fe=s=>{const t=["Type","Title","Subtitle","Description","Status","Amount","Date","Tags"],l=s.map(r=>{var i;return[r.type,r.title,r.subtitle,r.description,r.status||"",r.amount?P.money(r.amount):"",r.date||"",((i=r.tags)==null?void 0:i.join("; "))||""]});return[t,...l].map(r=>r.map(i=>`"${i}"`).join(",")).join(`
`)},ve=s=>{const t=M.filter(r=>s.includes(r.id)),l=JSON.parse(localStorage.getItem("searchBookmarks")||"[]");t.forEach(r=>{l.find(i=>i.id===r.id)||l.push({...r,bookmarkedAt:new Date().toISOString(),searchQuery:d})}),localStorage.setItem("searchBookmarks",JSON.stringify(l)),alert(`${t.length} results bookmarked!`)},ye=s=>{var l;const t=`Check out these search results for "${d}": ${s.length} items found`;(l=navigator.share)==null||l.call(navigator,{title:"Search Results",text:t,url:window.location.href})},be=()=>{if(!z.trim())return;const s={id:Date.now().toString(),name:z,query:d,filters:{...c},sortBy:E,sortOrder:k,createdAt:new Date().toISOString()},t=JSON.parse(localStorage.getItem("savedSearches")||"[]");t.push(s),localStorage.setItem("savedSearches",JSON.stringify(t)),R(t),Q(!1),W("")},Ne=s=>{switch(s==null?void 0:s.toLowerCase()){case"active":case"completed":return"bg-green-100 text-green-800";case"pending":case"in-progress":return"bg-yellow-100 text-yellow-800";case"inactive":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},Se=s=>{switch(s){case"device":return"bg-blue-100 text-blue-800";case"customer":return"bg-purple-100 text-purple-800";case"product":return"bg-green-100 text-green-800";case"employee":return"bg-orange-100 text-orange-800";case"sale":return"bg-pink-100 text-pink-800";case"payment":return"bg-indigo-100 text-indigo-800";default:return"bg-gray-100 text-gray-800"}};return H?e.jsx(Qe,{searchHistory:oe,savedSearches:D,recentSearches:me,currentQuery:d,resultCount:F.totalResults}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{className:"w-8 h-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:F.totalResults}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Results"})]})]})}),e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:"w-8 h-8 text-green-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[F.searchTime,"ms"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Search Time"})]})]})}),e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Y,{className:"w-8 h-8 text-purple-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:F.topCategories.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Categories"})]})]})}),e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-8 h-8 text-orange-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(F.resultDistribution).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Types Found"})]})]})})]}),e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(J,{value:c.type,onChange:s=>j(t=>({...t,type:s})),options:ue,className:"min-w-[140px]"}),e.jsx(J,{value:c.status,onChange:s=>j(t=>({...t,status:s})),options:[{value:"all",label:"All Status"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"}],className:"min-w-[140px]"}),e.jsx(J,{value:c.dateRange,onChange:s=>j(t=>({...t,dateRange:s})),options:he,className:"min-w-[140px]"}),e.jsx(q,{type:"text",placeholder:"Filter by location...",value:c.location,onChange:s=>j(t=>({...t,location:s.target.value})),className:"min-w-[160px]"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>U("list"),className:`p-2 rounded ${w==="list"?"bg-white shadow-sm":""}`,children:e.jsx($e,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U("grid"),className:`p-2 rounded ${w==="grid"?"bg-white shadow-sm":""}`,children:e.jsx(Ie,{className:"w-4 h-4"})})]}),e.jsx(J,{value:`${E}-${k}`,onChange:s=>{const[t,l]=s.split("-");B(t),m(l)},options:[{value:"relevance-desc",label:"Most Relevant"},{value:"date-desc",label:"Newest First"},{value:"date-asc",label:"Oldest First"},{value:"name-asc",label:"Name A-Z"},{value:"name-desc",label:"Name Z-A"},{value:"amount-desc",label:"Highest Amount"},{value:"amount-asc",label:"Lowest Amount"}],className:"min-w-[160px]"}),e.jsx("button",{onClick:()=>Q(!0),className:"p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",title:"Save Search",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ie(!H),className:`p-2 rounded-lg transition-colors ${H?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,title:"Search Analytics",children:e.jsx(V,{className:"w-4 h-4"})}),x.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[x.size," selected"]}),e.jsx("button",{onClick:()=>X("export"),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600",title:"Export Selected",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X("bookmark"),className:"p-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600",title:"Bookmark Selected",children:e.jsx(ae,{className:"w-4 h-4"})})]})]})]})}),f?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fe,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-500"}),e.jsx("p",{className:"text-gray-600",children:"Searching..."})]})}):M.length===0?e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(Z,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No results found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search terms or filters to find what you're looking for."})]}):e.jsx("div",{className:`space-y-4 ${w==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":""}`,children:M.map(s=>e.jsx(g,{className:`p-4 cursor-pointer hover:shadow-lg transition-all ${x.has(s.id)?"ring-2 ring-blue-500":""}`,onClick:()=>pe(s),children:e.jsxs("div",{className:"flex items-start space-x-4",children:[w==="list"&&e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("input",{type:"checkbox",checked:x.has(s.id),onChange:t=>{t.stopPropagation();const l=new Set(x);t.target.checked?l.add(s.id):l.delete(s.id),v(l)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:s.icon})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 truncate",children:s.title}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${Se(s.type)}`,children:s.type})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.subtitle}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[s.status&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${Ne(s.status)}`,children:s.status}),s.amount&&e.jsx("span",{className:"text-sm font-medium text-green-600",children:P.money(s.amount)}),s.date&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.score&&e.jsxs("span",{className:"text-xs text-gray-400",children:[Math.round(s.score),"%"]}),e.jsx(re,{className:"w-4 h-4 text-gray-400"})]})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.tags.slice(0,3).map((t,l)=>e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded",children:t},l)),s.tags.length>3&&e.jsxs("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded",children:["+",s.tags.length-3," more"]})]})]})]})},s.id))}),ce&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(g,{className:"w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Save Search"}),e.jsx(q,{type:"text",placeholder:"Enter search name...",value:z,onChange:s=>W(s.target.value),className:"w-full mb-4"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>Q(!1),className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400",children:"Cancel"}),e.jsx("button",{onClick:be,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save"})]})]})})]})},rs=()=>{const{currentUser:d}=ke();let S=[];try{const c=De();S=(c==null?void 0:c.devices)||[]}catch{}const{customers:$}=ee(),C=le(),A=Pe(),[h,b]=o.useState(""),[I,O]=o.useState("all"),[n,u]=o.useState([]),[f,N]=o.useState(!0),[w,U]=o.useState([]),[E,B]=o.useState([]);o.useEffect(()=>{const j=new URLSearchParams(A.search).get("q");j&&b(j)},[A.search]),o.useEffect(()=>{const c=localStorage.getItem("recentSearches");if(c)try{u(JSON.parse(c))}catch(R){console.error("Error loading recent searches:",R)}const j=localStorage.getItem("savedSearches");if(j)try{U(JSON.parse(j))}catch(R){console.error("Error loading saved searches:",R)}const D=localStorage.getItem("searchHistory");if(D)try{B(JSON.parse(D))}catch(R){console.error("Error loading search history:",R)}},[]);const k=c=>{if(!c.trim())return;const j=[c,...n.filter(D=>D!==c)].slice(0,10);u(j),localStorage.setItem("recentSearches",JSON.stringify(j))},m=c=>{c.preventDefault(),h.trim()&&k(h)},x=()=>{b(""),C("/search")},v=c=>{const j=n.filter(D=>D!==c);u(j),localStorage.setItem("recentSearches",JSON.stringify(j))};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white/95 backdrop-blur-xl border-b border-gray-200/50 sticky top-0 z-10 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>C(-1),className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-all duration-150",children:e.jsx(re,{size:18,className:"text-gray-700 rotate-180"})}),e.jsx("div",{className:"flex-1 max-w-2xl",children:e.jsxs("form",{onSubmit:m,className:"relative group",children:[e.jsx(Z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-blue-500 transition-colors",size:18}),e.jsx("input",{type:"text",placeholder:"Search everything...",value:h,onChange:c=>b(c.target.value),className:"w-full pl-11 pr-32 py-2.5 rounded-lg bg-gray-100 border border-gray-300 focus:outline-none focus:bg-white focus:border-blue-500 focus:shadow-sm text-gray-800 placeholder-gray-400 transition-all duration-150 text-sm",autoFocus:!0}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1",children:[e.jsx("button",{type:"button",onClick:()=>N(!f),className:`p-1 rounded transition-all duration-150 ${f?"text-blue-500 bg-blue-50":"text-gray-400 hover:text-gray-600"}`,title:f?"Enhanced Search On":"Basic Search Mode",children:e.jsx(Be,{size:14})}),h&&e.jsx("button",{type:"button",onClick:x,className:"p-1 rounded hover:bg-gray-200 transition-all duration-150",children:e.jsx(Me,{size:14,className:"text-gray-500"})})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[w.length>0&&e.jsx("div",{className:"relative",children:e.jsx("button",{onClick:()=>{},className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-all duration-150",title:"Saved Searches",children:e.jsx(ae,{size:18,className:"text-gray-700"})})}),e.jsx("button",{onClick:()=>{},className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-all duration-150",title:"Search Settings",children:e.jsx(Je,{size:18,className:"text-gray-700"})})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-6",children:h?f?e.jsx(Ge,{query:h,onQueryChange:b,userRole:d.role}):e.jsx(Le,{query:h,filter:I,onFilterChange:O,userRole:d.role,devices:S,customers:$}):e.jsx(Re,{recentSearches:n,onSearch:b,onRemoveSearch:v,userRole:d.role})})]})};export{rs as default};
