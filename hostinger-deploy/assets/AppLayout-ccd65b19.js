import{u as ce,s as J,t as Kt,v as Vt,w as Jt,d as Ut,j as e,x as at,y as Yt,b as ot,G as Y,e as Ve,z as Zt,c as kt,E as Xt}from"./index-61458a34.js";import{r as o,R as lt}from"./vendor-36d2c7c1.js";import{u as Ie,a as Pe,O as xt,L as es}from"./routing-eb8c310c.js";import{u as ts}from"./useBusinessInfo-62d31733.js";import{A as ss}from"./AddCustomerModal-175a5a1a.js";import{_ as St}from"./supabase-cf010ec4.js";import{r as Ye}from"./reminderApi-be7f32c2.js";import{R as Ze,n as D,aw as ge,b as nt,s as Xe,ax as rs,z as as,Z as we,al as je,r as se,y as ie,e as Ct,ay as os,U as ae,X as Ae,v as Ee,S as V,a3 as et,l as gt,ag as ls,$ as re,M as ns,av as be,p as H,az as fe,Q as ye,aA as Je,aB as tt,i as is,u as K,ap as cs,j as pt,O as ve,N as pe,aC as st,aD as bt,aE as $t,_ as Mt,aF as De,aG as ft,aH as ds,h as ms,q as Dt,aI as us,aJ as yt,an as hs,a as xs,a8 as vt,aK as gs,aL as ps,V as bs,aM as wt,aN as fs,k as ys,o as vs,aO as ws,aP as js}from"./ui-28e30067.js";import{smartCache as Ns}from"./enhancedCacheManager-afe341e0.js";import{Q as ks,G as Ss}from"./GlobalSearchShortcut-c0731781.js";import{M as Te}from"./Modal-a5e4c1ba.js";import{G as ze}from"./GlassInput-0475021a.js";import{G as Ue}from"./GlassSelect-e243562f.js";import{A as Cs}from"./AddProductModal-144ca68a.js";import{E as $s}from"./EnhancedAddSupplierModal-988446e5.js";import{A as Ms}from"./AppointmentModal-91a07df7.js";import{P as Ds}from"./PaymentsPopupModal-6fe61f19.js";import{c as zs}from"./appointments-0b344a33.js";import{c as _s}from"./stockTransferApi-f59c9e8a.js";import{I as As}from"./ImportEmployeesFromUsersModal-22c8484e.js";import{T as Es}from"./TransferModal-7d7a82f1.js";import{B as Is}from"./BulkSMSModal-ba796dbc.js";import{D as Ps}from"./DailyReportModal-f39ca22c.js";import{I as Ts}from"./InstallmentManagementModal-0b553ce1.js";import"./CustomerForm-3440546b.js";import"./phoneUtils-a8934478.js";import"./useSuccessModal-081786c4.js";import"./useBodyScrollLock-341c8b9f.js";import"./SuccessModalIcons-fe811e4d.js";import"./SearchResults-c1876f8f.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";import"./skuUtils-60e0a165.js";import"./CategoryInput-e47eba98.js";import"./specificationUtils-0c00478d.js";import"./forms-ebbdb905.js";import"./currencyUtils-59109a41.js";import"./employeeService-efe40e70.js";import"./LoadingSpinner-251d9268.js";import"./CustomerTooltip-6a958832.js";const Rs=!1,Fs=()=>{const t=Ie(),n=Pe(),[a,r]=o.useState(null);o.useEffect(()=>{const y=t.pathname,w=localStorage.getItem("navigationHistory");let c=[];if(w)try{c=JSON.parse(w)}catch(N){console.error("‚ùå NavigationHistory: Error parsing navigation history:",N)}if((c.length===0||c[c.length-1]!==y)&&(c.push(y),c.length>10&&(c=c.slice(-10)),localStorage.setItem("navigationHistory",JSON.stringify(c))),c.length>1){const N=c[c.length-2];N!==a&&r(N)}},[t.pathname,a]);const x=o.useCallback(()=>{n(a||"/dashboard")},[a,n]);return{previousPage:a,handleBackClick:x,navigate:n}},_e={formatTime(t){const n=new Date(t),r=new Date().getTime()-n.getTime(),x=Math.floor(r/(1e3*60)),y=Math.floor(r/(1e3*60*60)),w=Math.floor(r/(1e3*60*60*24));return x<1?"Just now":x<60?`${x}m ago`:y<24?`${y}h ago`:w<7?`${w}d ago`:n.toLocaleDateString()},getNotificationIcon(t){return{device_status_change:"üì±",new_customer:"üë§",payment_received:"üí∞",inventory_low:"üì¶",system_alert:"‚ö†Ô∏è",appointment_reminder:"üìÖ",diagnostic_complete:"üîç",repair_complete:"‚úÖ",customer_feedback:"üí¨",whatsapp_message:"üì±",backup_complete:"üíæ",security_alert:"üîí",goal_achieved:"üéØ",overdue_device:"‚è∞",new_remark:"üí≠",loyalty_points:"‚≠ê",bulk_sms_sent:"üì®",export_complete:"üìä"}[t]||"üîî"},getNotificationColor(t){const n={low:"text-gray-500 bg-gray-50",normal:"text-blue-600 bg-blue-50",high:"text-orange-600 bg-orange-50",urgent:"text-red-600 bg-red-50"};return n[t]||n.normal},getNotificationBorderColor(t){const n={low:"border-gray-200",normal:"border-blue-200",high:"border-orange-200",urgent:"border-red-200"};return n[t]||n.normal},getCategoryDisplayName(t){return{devices:"Devices",customers:"Customers",payments:"Payments",inventory:"Inventory",system:"System",appointments:"Appointments",loyalty:"Loyalty",communications:"Communications",backup:"Backup",security:"Security",goals:"Goals"}[t]||t},getPriorityDisplayName(t){return{low:"Low",normal:"Normal",high:"High",urgent:"Urgent"}[t]||t},groupNotifications(t){const n={};return t.forEach(a=>{const r=`${a.type}_${a.category}`;n[r]||(n[r]={id:r,type:a.type,category:a.category,title:this.getCategoryDisplayName(a.category),notifications:[],unreadCount:0,createdAt:a.createdAt,latestNotification:a}),n[r].notifications.push(a),a.status==="unread"&&n[r].unreadCount++,new Date(a.createdAt)>new Date(n[r].latestNotification.createdAt)&&(n[r].latestNotification=a,n[r].createdAt=a.createdAt)}),Object.values(n).sort((a,r)=>new Date(r.createdAt).getTime()-new Date(a.createdAt).getTime())},filterNotifications(t,n){return t.filter(a=>{if(n.status&&n.status.length>0&&!n.status.includes(a.status)||n.category&&n.category.length>0&&!n.category.includes(a.category)||n.priority&&n.priority.length>0&&!n.priority.includes(a.priority)||n.type&&n.type.length>0&&!n.type.includes(a.type))return!1;if(n.search){const r=n.search.toLowerCase(),x=a.title.toLowerCase().includes(r),y=a.message.toLowerCase().includes(r);if(!x&&!y)return!1}return!0})},sortNotifications(t,n="date",a="desc"){return!t||!Array.isArray(t)?(console.warn("sortNotifications received invalid input:",t),[]):[...t].sort((r,x)=>{let y=0;switch(n){case"date":y=new Date(r.createdAt).getTime()-new Date(x.createdAt).getTime();break;case"priority":const w={urgent:4,high:3,normal:2,low:1};y=w[r.priority]-w[x.priority];break;case"category":y=r.category.localeCompare(x.category);break}return a==="desc"?-y:y})},isRecent(t){const n=new Date,a=new Date(t.createdAt);return(n.getTime()-a.getTime())/(1e3*60*60)<24},getGroupSummary(t){const{notifications:n,unreadCount:a}=t;return n.length===1?n[0].message:a>0?`${a} new ${t.type.replace("_"," ")} notification${a>1?"s":""}`:`${n.length} ${t.type.replace("_"," ")} notification${n.length>1?"s":""}`},generateNotificationId(){return`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},validateNotification(t){return["type","category","title","message","priority"].every(a=>t[a]!==void 0)}};function rt(t){return{id:t.id,type:t.type,category:t.category,title:t.title,message:t.message,priority:t.priority,status:t.status,createdAt:t.created_at,readAt:t.read_at,actionedAt:t.actioned_at,dismissedAt:t.dismissed_at,actionedBy:t.actioned_by,dismissedBy:t.dismissed_by,deviceId:t.device_id,customerId:t.customer_id,userId:t.user_id,appointmentId:t.appointment_id,diagnosticId:t.diagnostic_id,metadata:t.metadata,icon:t.icon,color:t.color,actionUrl:t.action_url,actionText:t.action_text,groupId:t.group_id,isGrouped:t.is_grouped,groupCount:t.group_count}}function Ls(t){return t.map(rt)}const Os=()=>{const{currentUser:t}=ce(),[n,a]=o.useState([]),[r,x]=o.useState(!1),[y,w]=o.useState(null),[c,N]=o.useState({}),[l,_]=o.useState({total:0,unread:0,read:0,actioned:0,dismissed:0,byCategory:{},byPriority:{},byType:{},today:0,thisWeek:0,thisMonth:0}),z=o.useCallback(async()=>{if(t){x(!0),w(null);try{let i=J.from("notifications").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});c.status&&c.status.length>0&&(i=i.in("status",c.status)),c.category&&c.category.length>0&&(i=i.in("category",c.category)),c.priority&&c.priority.length>0&&(i=i.in("priority",c.priority)),c.type&&c.type.length>0&&(i=i.in("type",c.type)),c.dateRange&&(i=i.gte("created_at",c.dateRange.start).lte("created_at",c.dateRange.end)),c.deviceId&&(i=i.eq("device_id",c.deviceId)),c.customerId&&(i=i.eq("customer_id",c.customerId));const{data:v,error:p}=await i;if(p)throw p;let S=Ls(v||[]);c.search&&(S=_e.filterNotifications(S,{search:c.search})),a(S)}catch(i){console.error("Error fetching notifications:",i),w(i instanceof Error?i.message:"Failed to fetch notifications")}finally{x(!1)}}},[t,c]),P=o.useCallback(i=>{const v=new Date,p=new Date(v.getFullYear(),v.getMonth(),v.getDate()),S=new Date(p.getTime()-7*24*60*60*1e3),A=new Date(p.getFullYear(),p.getMonth()-1,p.getDate()),E={total:i.length,unread:i.filter(d=>d.status==="unread").length,read:i.filter(d=>d.status==="read").length,actioned:i.filter(d=>d.status==="actioned").length,dismissed:i.filter(d=>d.status==="dismissed").length,byCategory:{},byPriority:{},byType:{},today:i.filter(d=>new Date(d.createdAt)>=p).length,thisWeek:i.filter(d=>new Date(d.createdAt)>=S).length,thisMonth:i.filter(d=>new Date(d.createdAt)>=A).length};return i.forEach(d=>{E.byCategory[d.category]=(E.byCategory[d.category]||0)+1,E.byPriority[d.priority]=(E.byPriority[d.priority]||0)+1,E.byType[d.type]=(E.byType[d.type]||0)+1}),E},[]),g=o.useCallback(async(i,v,p)=>{if(t)try{const S={status:v};v==="read"?S.read_at=new Date().toISOString():v==="actioned"?(S.actioned_at=new Date().toISOString(),S.actioned_by=p||t.id):v==="dismissed"&&(S.dismissed_at=new Date().toISOString(),S.dismissed_by=p||t.id);const{error:A}=await J.from("notifications").update(S).eq("id",i).eq("user_id",t.id);if(A)throw A;a(E=>E.map(d=>d.id===i?{...d,...S}:d))}catch(S){console.error("Error updating notification status:",S),w(S instanceof Error?S.message:"Failed to update notification")}},[t]),h=o.useCallback(i=>g(i,"read"),[g]),C=o.useCallback((i,v)=>g(i,"actioned",v),[g]),k=o.useCallback((i,v)=>g(i,"dismissed",v),[g]),B=o.useCallback(async()=>{if(t)try{const{error:i}=await J.from("notifications").update({status:"read",read_at:new Date().toISOString()}).eq("user_id",t.id).eq("status","unread");if(i)throw i;a(v=>v.map(p=>p.status==="unread"?{...p,status:"read",readAt:new Date().toISOString()}:p))}catch(i){console.error("Error marking all as read:",i),w(i instanceof Error?i.message:"Failed to mark all as read")}},[t]),$=o.useCallback(async()=>{if(t)try{const{error:i}=await J.from("notifications").delete().eq("user_id",t.id);if(i)throw i;a([])}catch(i){console.error("Error clearing notifications:",i),w(i instanceof Error?i.message:"Failed to clear notifications")}},[t]),T=o.useMemo(()=>{let i=n;return c.status&&c.status.length>0&&(i=i.filter(v=>c.status.includes(v.status))),c.category&&c.category.length>0&&(i=i.filter(v=>c.category.includes(v.category))),c.priority&&c.priority.length>0&&(i=i.filter(v=>c.priority.includes(v.priority))),c.type&&c.type.length>0&&(i=i.filter(v=>c.type.includes(v.type))),c.search&&(i=_e.filterNotifications(i,{search:c.search})),_e.sortNotifications(i,"date","desc")},[n,c]),L=o.useMemo(()=>T.filter(i=>i.status==="unread"),[T]),m=o.useMemo(()=>T.filter(i=>_e.isRecent(i)),[T]);return o.useEffect(()=>{const i=P(n);_(i)},[n,P]),o.useEffect(()=>{z()},[z]),o.useEffect(()=>{if(!t)return;const i=J.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${t.id}`},v=>{if(v.eventType==="INSERT"){const p=rt(v.new);a(S=>[p,...S])}else if(v.eventType==="UPDATE"){const p=rt(v.new);a(S=>S.map(A=>A.id===p.id?p:A))}else v.eventType==="DELETE"&&a(p=>p.filter(S=>S.id!==v.old.id))}).subscribe();return()=>{i.unsubscribe()}},[t]),{notifications:T,unreadNotifications:L,recentNotifications:m,loading:r,error:y,stats:l,filters:c,setFilters:N,markAsRead:h,markAsActioned:C,dismissNotification:k,markAllAsRead:B,clearAllNotifications:$,refetch:z}};async function Bs(){console.log("üßπ Starting comprehensive cache clearing...");try{try{await Ns.clearAllCache(),console.log("‚úÖ Enhanced Cache Manager cleared")}catch(t){console.warn("‚ö†Ô∏è Failed to clear Enhanced Cache Manager:",t)}try{Kt.clear(),console.log("‚úÖ Query Cache cleared")}catch(t){console.warn("‚ö†Ô∏è Failed to clear Query Cache:",t)}try{Vt.clearCache(),console.log("‚úÖ Query Deduplication Cache cleared")}catch(t){console.warn("‚ö†Ô∏è Failed to clear Query Deduplication Cache:",t)}try{await Jt(),console.log("‚úÖ Offline Cache cleared")}catch(t){console.warn("‚ö†Ô∏è Failed to clear Offline Cache:",t)}try{const t=Ut.getState();t&&typeof t.clearCache=="function"&&(t.clearCache(),console.log("‚úÖ Inventory Store Cache cleared"))}catch(t){console.warn("‚ö†Ô∏è Failed to clear Inventory Store Cache:",t)}try{const t=["supabase.auth.token","sb-auth-token"],n=[];for(let a=0;a<localStorage.length;a++){const r=localStorage.key(a);r&&!t.some(x=>r.includes(x))&&n.push(r)}localStorage.getItem("sms_proxy_server_unavailable")&&(localStorage.removeItem("sms_proxy_server_unavailable"),console.log("üóëÔ∏è Removed SMS proxy server cache")),n.forEach(a=>{try{localStorage.removeItem(a),console.log(`üóëÔ∏è Removed localStorage key: ${a}`)}catch(r){console.warn(`‚ö†Ô∏è Could not remove localStorage key: ${a}`,r)}}),console.log("‚úÖ localStorage cleared (auth tokens preserved)")}catch(t){console.warn("‚ö†Ô∏è Failed to clear localStorage:",t)}try{sessionStorage.clear(),console.log("‚úÖ sessionStorage cleared")}catch(t){console.warn("‚ö†Ô∏è Failed to clear sessionStorage:",t)}try{if("serviceWorker"in navigator&&"caches"in window){const t=await caches.keys();await Promise.all(t.map(n=>(console.log(`üóëÔ∏è Deleting cache: ${n}`),caches.delete(n)))),console.log("‚úÖ Service Worker caches cleared")}}catch(t){console.warn("‚ö†Ô∏è Failed to clear Service Worker caches:",t)}try{const t=["offline-cache","pending-actions","user-goals","app-cache","product-cache","customer-cache","device-cache","pos-smart-cache","clean-app-cache"];for(const n of t)try{const a=indexedDB.deleteDatabase(n);await new Promise((r,x)=>{a.onsuccess=()=>{console.log(`üóëÔ∏è Deleted IndexedDB: ${n}`),r()},a.onerror=()=>{console.warn(`‚ö†Ô∏è Could not delete IndexedDB: ${n}`),r()},a.onblocked=()=>{console.warn(`‚ö†Ô∏è IndexedDB deletion blocked: ${n}`),r()}})}catch(a){console.warn(`‚ö†Ô∏è Error deleting IndexedDB ${n}:`,a)}console.log("‚úÖ Additional IndexedDB databases cleared")}catch(t){console.warn("‚ö†Ô∏è Failed to clear additional IndexedDB databases:",t)}try{window.__AUTH_DATA_LOADED_FLAG__&&(window.__AUTH_DATA_LOADED_FLAG__=!1,console.log("üîÑ Reset auth data loaded flag"))}catch(t){console.warn("‚ö†Ô∏è Failed to reset data loaded flags:",t)}console.log("‚úÖ All caches cleared successfully!")}catch(t){throw console.error("‚ùå Error during cache clearing:",t),t}}function jt(){"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(n=>{n.unregister(),console.log("üóëÔ∏è Unregistered service worker")})}),window.location.reload()}async function Ws(){try{await Bs(),await new Promise(t=>setTimeout(t,500)),jt()}catch(t){console.error("‚ùå Error during full refresh:",t),jt()}}const qs=({variant:t="icon",className:n="",showConfirmation:a=!0,size:r="md"})=>{const[x,y]=o.useState(!1),w=async()=>{if(!x&&!(a&&!window.confirm(`üîÑ Refresh Application?

This will clear all caches and reload the page for optimal performance. Continue?`))){y(!0);try{D.loading("Clearing caches and refreshing...",{id:"refresh",duration:2e3}),await new Promise(N=>setTimeout(N,300)),await Ws()}catch(N){console.error("Error during refresh:",N),D.error("Failed to refresh. Please reload manually.",{id:"refresh",duration:3e3}),y(!1)}}},c={sm:t==="icon"?"w-4 h-4":"px-2 py-1 text-xs",md:t==="icon"?"w-5 h-5":"px-3 py-1.5 text-sm",lg:t==="icon"?"w-6 h-6":"px-4 py-2 text-base"};return t==="icon"?e.jsx("button",{onClick:w,disabled:x,className:`
          p-2 rounded-xl transition-all duration-200 backdrop-blur-sm border shadow-sm
          disabled:opacity-50 disabled:cursor-not-allowed
          ${n}
        `,title:"Refresh Application (Clear all caches)",children:e.jsx(Ze,{className:`${c[r]} ${x?"animate-spin":""} transition-transform`})}):e.jsxs("button",{onClick:w,disabled:x,className:`
        flex items-center gap-2 rounded-xl transition-all duration-200 backdrop-blur-sm border shadow-sm
        disabled:opacity-50 disabled:cursor-not-allowed
        ${c[r]}
        ${n}
      `,title:"Refresh Application (Clear all caches)",children:[e.jsx(Ze,{className:`${c[r]} ${x?"animate-spin":""} transition-transform`}),e.jsx("span",{children:x?"Refreshing...":"Refresh"})]})},Gs=({className:t=""})=>{const{currentUser:n}=ce(),{isDark:a}=at(),[r,x]=o.useState([]),[y,w]=o.useState(""),[c,N]=o.useState(!1),[l,_]=o.useState(!0);o.useEffect(()=>{z()},[]);const z=async()=>{try{console.log("üè™ Loading branches...");const{data:h,error:C}=await J.from("store_locations").select("id, name, code, city, is_main, data_isolation_mode, is_active").eq("is_active",!0).order("is_main",{ascending:!1});if(C){console.error("Error loading branches:",C),_(!1);return}console.log("‚úÖ Branches loaded:",h),x(h||[]);const k=localStorage.getItem("current_branch_id"),B=h==null?void 0:h.find(T=>T.is_main),$=(h==null?void 0:h.find(T=>T.id===k))||B||(h==null?void 0:h[0]);$&&(w($.id),localStorage.setItem("current_branch_id",$.id),console.log("üìç [SimpleBranchSelector] Initialized branch:",$.name,$.id)),_(!1)}catch(h){console.error("Failed to load branches:",h),_(!1)}},P=async h=>{const C=r.find(k=>k.id===h);if(C){console.log("%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ","color: #ff0000; font-weight: bold;"),console.log("%cüîÑ BRANCH SWITCH INITIATED","background: #ff0000; color: white; font-size: 16px; font-weight: bold; padding: 5px;"),console.log("%c   Old Branch:","color: #ff0000;",localStorage.getItem("current_branch_id")),console.log("%c   New Branch:","color: #00cc00; font-weight: bold;",h),console.log("%c   New Branch Name:","color: #00cc00; font-weight: bold;",C.name),w(h),localStorage.setItem("current_branch_id",h),N(!1),console.log("%c‚úÖ localStorage updated!","color: #00cc00;");try{console.log("%cüóëÔ∏è Clearing cache for branch-specific data...","color: #ff9900; font-weight: bold;");const{smartCache:k}=await St(()=>import("./enhancedCacheManager-afe341e0.js"),["assets/enhancedCacheManager-afe341e0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);await Promise.all([k.invalidateCache("products"),k.invalidateCache("customers"),k.invalidateCache("sales")]),console.log("%c‚úÖ Cache cleared!","color: #00cc00; font-weight: bold;")}catch(k){console.error("Failed to clear cache:",k)}console.log("%cüîÑ PAGE WILL RELOAD IN 500ms...","background: #ffcc00; color: black; font-weight: bold; padding: 5px;"),console.log("%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ","color: #ff0000; font-weight: bold;"),as.success(`Switching to ${C.name}...`,{duration:1500}),setTimeout(()=>{console.log("%cüöÄ RELOADING NOW!","background: #00ff00; color: black; font-size: 20px; padding: 10px;"),window.location.reload()},500)}};if((n==null?void 0:n.role)!=="admin")return null;if(l)return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2.5 rounded-xl shadow-sm border backdrop-blur-sm transition-all ${a?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/80 hover:bg-white border-gray-200"} ${t}`,children:[e.jsx(ge,{className:`w-4 h-4 animate-pulse ${a?"text-gray-300":"text-gray-600"}`}),e.jsx("span",{className:`text-sm font-medium ${a?"text-gray-300":"text-gray-600"}`,children:"Loading..."})]});const g=r.find(h=>h.id===y);return g?e.jsxs("div",{className:`relative ${t}`,children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>{console.log("üñ±Ô∏è Branch selector clicked!",{isOpen:c,branchesCount:r.length}),N(!c)},className:`flex items-center gap-2 px-3 py-2.5 rounded-xl transition-all duration-200 cursor-pointer backdrop-blur-sm border shadow-sm hover:shadow-md ${a?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/80 hover:bg-white border-gray-200"}`,children:[e.jsx(ge,{className:`w-4 h-4 flex-shrink-0 ${a?"text-gray-200":"text-gray-700"}`}),e.jsx("span",{className:`text-sm font-medium truncate ${a?"text-gray-200":"text-gray-700"}`,children:g.name}),e.jsx(nt,{className:`w-3.5 h-3.5 flex-shrink-0 transition-transform duration-200 ${a?"text-gray-400":"text-gray-500"} ${c?"rotate-180":""}`})]}),e.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${a?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50 pointer-events-none`,children:[e.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent ${a?"border-b-slate-800/95":"border-b-white/95"}`}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"font-semibold",children:g.name}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px]",children:[e.jsx(Xe,{className:`w-2.5 h-2.5 ${a?"text-gray-400":"text-gray-500"}`}),e.jsx("span",{className:a?"text-gray-400":"text-gray-500",children:g.city})]})]})]})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>N(!1)}),e.jsxs("div",{className:`absolute top-full mt-2 right-0 w-80 rounded-xl shadow-xl border z-50 max-h-96 overflow-auto backdrop-blur-xl ${a?"bg-slate-800/95 border-slate-700/60":"bg-white/95 border-gray-200/60"}`,children:[e.jsx("div",{className:`px-4 py-3 border-b ${a?"border-slate-700":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:`w-4 h-4 ${a?"text-blue-400":"text-blue-600"}`}),e.jsx("h3",{className:`text-sm font-semibold ${a?"text-gray-200":"text-gray-900"}`,children:"Branches"})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${a?"bg-slate-700 text-gray-300":"bg-gray-100 text-gray-600"}`,children:r.length})]})}),e.jsx("div",{className:"p-3 space-y-1",children:r.map(h=>{const C=h.id===y;return e.jsxs("button",{onClick:()=>P(h.id),className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all duration-200 ${C?a?"bg-blue-600/20 border border-blue-500":"bg-blue-50 border border-blue-200":a?"hover:bg-slate-700/50 border border-transparent":"hover:bg-gray-50 border border-transparent"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:C?e.jsx("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${a?"bg-blue-500":"bg-blue-600"}`,children:e.jsx(rs,{className:"w-3 h-3 text-white"})}):e.jsx("div",{className:`w-4 h-4 border-2 rounded-full ${a?"border-gray-600":"border-gray-300"}`})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium truncate ${C?a?"text-blue-300":"text-blue-700":a?"text-gray-200":"text-gray-900"}`,children:h.name}),h.is_main&&e.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-semibold rounded-md ${a?"bg-emerald-900/30 text-emerald-400":"bg-emerald-100 text-emerald-700"}`,children:"MAIN"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(Xe,{className:`w-2.5 h-2.5 ${a?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`text-xs ${a?"text-gray-400":"text-gray-500"}`,children:h.city})]})]})]},h.id)})}),e.jsx("div",{className:`border-t px-4 py-3 ${a?"border-slate-700":"border-gray-200"}`,children:e.jsxs("button",{onClick:h=>{h.stopPropagation(),N(!1),window.location.href="/admin-settings?section=stores"},className:`w-full flex items-center justify-center gap-2 px-4 py-2 rounded-xl transition-all duration-200 font-medium text-sm ${a?"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white":"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white"}`,children:[e.jsx(ge,{className:"w-4 h-4"}),"Manage Stores"]})})]})]})]}):e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2.5 rounded-xl shadow-sm border backdrop-blur-sm ${a?"bg-slate-800/60 border-slate-600":"bg-white/80 border-gray-200"} ${t}`,children:[e.jsx(ge,{className:`w-4 h-4 ${a?"text-gray-400":"text-gray-500"}`}),e.jsx("span",{className:`text-sm font-medium ${a?"text-gray-400":"text-gray-600"}`,children:"No branches"})]})},Qs=({isOpen:t,onClose:n,onSuccess:a})=>{const{currentUser:r}=ce(),{currentBranch:x}=Yt(),{customers:y}=ot(),[w,c]=o.useState(!1),[N,l]=o.useState(!1),[_,z]=o.useState(""),P=o.useMemo(()=>{const m=_.toLowerCase().trim();return y.filter(i=>{var v,p;return i.name.toLowerCase().includes(m)||((v=i.email)==null?void 0:v.toLowerCase().includes(m))||((p=i.phone)==null?void 0:p.toLowerCase().includes(m))}).slice(0,20)},[_,y]),[g,h]=o.useState({title:"",description:"",date:"",time:"",priority:"medium",category:"general",notifyBefore:15,relatedTo:void 0,recurring:{enabled:!1,type:"daily",interval:1,endDate:void 0}});o.useEffect(()=>{if(t){const m=new Date,i=new Date(m);i.setDate(i.getDate()+1);const v=new Date(m.getTime()+60*60*1e3);h({title:"",description:"",date:i.toISOString().split("T")[0],time:v.toTimeString().slice(0,5),priority:"medium",category:"general",notifyBefore:15,relatedTo:void 0,recurring:{enabled:!1,type:"daily",interval:1,endDate:void 0}})}},[t]);const C=(m,i)=>{h(v=>({...v,[m]:i}))},k=async()=>{try{if(!g.title||!g.date||!g.time){D.error("Please fill in title, date, and time");return}if(!x){D.error("No branch selected");return}c(!0),await Ye.createReminder({...g,assignedTo:r==null?void 0:r.id,createdBy:r==null?void 0:r.id,branchId:x.id}),D.success("Reminder created successfully!",{duration:3e3}),h({title:"",description:"",date:"",time:"",priority:"medium",category:"general",notifyBefore:15,relatedTo:void 0,recurring:{enabled:!1,type:"daily",interval:1,endDate:void 0}}),a&&a(),n()}catch(m){console.error("Error creating reminder:",m),D.error(m.message||"Failed to create reminder")}finally{c(!1)}},B=m=>{m.key==="Enter"&&m.ctrlKey&&k()},$=[{value:"low",label:"Low Priority"},{value:"medium",label:"Medium Priority"},{value:"high",label:"High Priority"}],T=[{value:"general",label:"General"},{value:"device",label:"Device"},{value:"customer",label:"Customer"},{value:"appointment",label:"Appointment"},{value:"payment",label:"Payment"},{value:"other",label:"Other"}],L=[{value:5,label:"5 minutes before"},{value:15,label:"15 minutes before"},{value:30,label:"30 minutes before"},{value:60,label:"1 hour before"},{value:120,label:"2 hours before"},{value:240,label:"4 hours before"},{value:1440,label:"1 day before"}];return e.jsx(Te,{isOpen:t,onClose:n,title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg",children:e.jsx(we,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Reminder"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Fast reminder creation (Ctrl+Enter to save)"})]})]}),children:e.jsxs("div",{className:"space-y-4",onKeyDown:B,children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(je,{className:"w-4 h-4"}),"Reminder Title *"]}),e.jsx(ze,{type:"text",value:g.title,onChange:m=>C("title",m.target.value),placeholder:"What do you need to remember?",autoFocus:!0,className:"text-base"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(se,{className:"w-4 h-4"}),"Date *"]}),e.jsx(ze,{type:"date",value:g.date,onChange:m=>C("date",m.target.value),className:"text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ie,{className:"w-4 h-4"}),"Time *"]}),e.jsx(ze,{type:"time",value:g.time,onChange:m=>C("time",m.target.value),className:"text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{children:e.jsx(Ue,{label:"Priority",value:g.priority,onChange:m=>C("priority",m),options:$,className:"text-sm"})}),e.jsx("div",{children:e.jsx(Ue,{label:"Category",value:g.category,onChange:m=>C("category",m),options:T,className:"text-sm"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Description (optional)"]}),e.jsx(ze,{type:"text",value:g.description,onChange:m=>C("description",m.target.value),placeholder:"Additional details...",className:"text-sm"})]}),e.jsx("div",{children:e.jsx(Ue,{label:"Notify me",value:g.notifyBefore,onChange:m=>C("notifyBefore",parseInt(m)),options:L,className:"text-sm"})}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(os,{className:"w-4 h-4"}),"Link to Customer (optional)"]}),g.relatedTo?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(ae,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-blue-900",children:g.relatedTo.name}),e.jsx("div",{className:"text-sm text-blue-600",children:(()=>{const m=y.find(i=>{var v;return i.id===((v=g.relatedTo)==null?void 0:v.id)});return m!=null&&m.phone?m.phone:""})()})]}),e.jsx("button",{type:"button",onClick:()=>{h(m=>({...m,relatedTo:void 0})),z("")},className:"text-blue-600 hover:text-blue-800 transition-colors",children:e.jsx(Ae,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{type:"button",onClick:()=>l(!N),className:"w-full flex items-center gap-2 p-3 border border-gray-300 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Link to a customer"}),e.jsx(Ee,{className:"w-4 h-4 text-gray-400 ml-auto"})]}),N&&e.jsxs("div",{className:"border border-gray-200 rounded-lg bg-white shadow-sm",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",value:_,onChange:m=>z(m.target.value),placeholder:"Search customers by name, phone, or email...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",autoFocus:!0})]})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:P.length>0?e.jsx("div",{className:"space-y-1 p-2",children:P.map(m=>e.jsxs("button",{type:"button",onClick:()=>{h(i=>({...i,relatedTo:{type:"customer",id:m.id,name:m.name}})),l(!1),z("")},className:"w-full flex items-center gap-3 p-2 rounded-lg hover:bg-blue-50 transition-colors text-left",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:m.name}),e.jsxs("div",{className:"text-sm text-gray-500 truncate",children:[m.phone&&e.jsx("span",{children:m.phone}),m.email&&e.jsx("span",{className:"ml-2",children:m.email})]})]})]},m.id))}):e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:_?"No customers found":"Start typing to search customers..."})})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsx(Y,{variant:"secondary",onClick:n,className:"flex-1",disabled:w,children:"Cancel"}),e.jsx(Y,{onClick:k,className:"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700",disabled:w||!g.title||!g.date||!g.time,children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Create Reminder"]})})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 pt-2 border-t flex items-center justify-center gap-2",children:[e.jsx(we,{className:"w-3 h-3"}),e.jsxs("span",{children:["Tip: Press ",e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Ctrl"})," + ",e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Enter"})," to save quickly"]})]})]})})},Hs=({isOpen:t,onClose:n,onImportComplete:a})=>{const{currentUser:r}=ce(),[x,y]=o.useState(!1),[w,c]=o.useState(0),[N,l]=o.useState(null),[_,z]=o.useState([]),[P,g]=o.useState(!1),[h,C]=o.useState([]),[k,B]=o.useState(""),[$,T]=o.useState(new Set),[L,m]=o.useState(!1);o.useRef(null),o.useRef(null),lt.useEffect(()=>{if(!k)C(_);else{const d=_.filter(R=>R.name.toLowerCase().includes(k.toLowerCase())||R.phone.includes(k)||R.email.toLowerCase().includes(k.toLowerCase()));C(d)}},[k,_]);const i=async()=>{if(!r){D.error("Please log in to import contacts");return}y(!0),c(0);try{const d=setInterval(()=>{c(Z=>Z>=90?(clearInterval(d),90):Z+10)},500),R=await fetch("/api/import-contacts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({smsFilePath:"/Users/mtaasisi/Downloads/sms-20250919010749.xml",csvFilePath:"/Users/mtaasisi/Combined_Contacts_Merged_Names.csv",selectedContacts:Array.from($)})});if(clearInterval(d),c(100),!R.ok)throw new Error("Import failed");const q=await R.json();l(q),m(!0),D.success(`Successfully imported ${q.imported} contacts!`),a==null||a(q)}catch(d){console.error("Import error:",d),D.error("Failed to import contacts. Please try again.")}finally{y(!1),c(0)}},v=async()=>{try{const d=[{phone:"+255746605561",name:"Mtaasisi",email:"",address:"Dar es Salaam",sources:["SMS Backup","CSV Import"],messageCount:167,lastMessageDate:"Sep 4, 2025 1:46:31 PM",firstMessageDate:"Sep 4, 2022 1:06:05 AM"},{phone:"+255712378850",name:"Zana boda boda",email:"",address:"Tanzania",sources:["SMS Backup"],messageCount:1014,lastMessageDate:"Aug 30, 2025 11:57:55 AM",firstMessageDate:"Sep 4, 2022 9:29:15 AM"},{phone:"+255654841225",name:"Samal Fundi Laptop",email:"",address:"Dar es Salaam",sources:["SMS Backup"],messageCount:1013,lastMessageDate:"Sep 1, 2025 4:04:17 PM",firstMessageDate:"Sep 4, 2022 11:05:49 AM"}];z(d),C(d),g(!0),D.success("Preview generated successfully!")}catch(d){console.error("Preview error:",d),D.error("Failed to generate preview")}},p=()=>{$.size===h.length?T(new Set):T(new Set(h.map(d=>d.phone)))},S=d=>{const R=new Set($);R.has(d)?R.delete(d):R.add(d),T(R)},A=d=>{if(!d)return"";const R=d.replace(/\D/g,"");if(R.startsWith("255")){const q=R.substring(3);return`+255 ${q.substring(0,3)} ${q.substring(3,6)} ${q.substring(6)}`}return d},E=d=>d.includes("SMS Backup")?e.jsx(re,{className:"w-4 h-4 text-blue-500"}):d.includes("CSV Import")?e.jsx(et,{className:"w-4 h-4 text-green-500"}):e.jsx(H,{className:"w-4 h-4 text-gray-500"});return e.jsx(Te,{isOpen:t,onClose:n,title:"Unified Contact Import",maxWidth:"1200px",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ve,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(V,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"SMS Backup Integration"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Import contacts and communication history from SMS backup"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(et,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"CSV Contacts Integration"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Import contacts from Combined_Contacts_Merged_Names.csv"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(Y,{onClick:v,disabled:x,className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4"}),"Preview Contacts"]}),e.jsxs(Y,{onClick:i,disabled:x||_.length===0,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[x?e.jsx(Ze,{className:"w-4 h-4 animate-spin"}):e.jsx(ls,{className:"w-4 h-4"}),x?"Importing...":"Import Contacts"]})]}),x&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Import Progress"}),e.jsxs("span",{children:[w,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${w}%`}})})]})]}),P&&e.jsxs(Ve,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(gt,{className:"w-5 h-5"}),"Contact Preview (",h.length," contacts)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Search contacts...",value:k,onChange:d=>B(d.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-sm"}),e.jsx(Y,{onClick:p,className:"text-sm",children:$.size===h.length?"Deselect All":"Select All"})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:h.map(d=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${$.has(d.phone)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>S(d.phone),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:$.has(d.phone),onChange:()=>S(d.phone),className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{className:"flex items-center gap-2",children:[E(d.sources),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:d.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:A(d.phone)})]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[d.messageCount>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),d.messageCount," msgs"]}),d.email&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"w-3 h-3"}),"Email"]}),d.address&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),d.address]})]}),d.lastMessageDate&&e.jsxs("p",{className:"text-xs mt-1",children:["Last: ",new Date(d.lastMessageDate).toLocaleDateString()]})]})]})},d.phone))})]}),L&&N&&e.jsxs(Ve,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(be,{className:"w-5 h-5"}),"Import Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:N.total}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Contacts"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:N.imported}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"New Imported"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:N.updated}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Updated"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:N.communicationHistory}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Messages"})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"SMS-only contacts:"}),e.jsx("span",{className:"font-medium",children:N.smsOnly})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"CSV-only contacts:"}),e.jsx("span",{className:"font-medium",children:N.csvOnly})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Merged contacts:"}),e.jsx("span",{className:"font-medium",children:N.merged})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Skipped:"}),e.jsx("span",{className:"font-medium",children:N.skipped})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Errors:"}),e.jsx("span",{className:"font-medium text-red-600",children:N.errors})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Y,{onClick:n,variant:"outline",children:"Close"}),L&&e.jsx(Y,{onClick:()=>{m(!1),g(!1),z([]),T(new Set),B("")},className:"bg-green-600 hover:bg-green-700",children:"Import More"})]})]})})},Ks=({onMenuToggle:t,isMenuOpen:n,isNavCollapsed:a})=>{var dt,mt,ut,ht;const{currentUser:r,logout:x,isImpersonating:y,impersonateUser:w,stopImpersonation:c,getAvailableTestUsers:N}=ce(),{isDark:l}=at(),{openSearch:_}=Zt(),[z,P]=o.useState(!1),[g,h]=o.useState(!1),[C,k]=o.useState(!1),[B,$]=o.useState(!1),[T,L]=o.useState(!1),[m,i]=o.useState(!1),[v,p]=o.useState(!1),[S,A]=o.useState(!1),[E,d]=o.useState(!1),[R,q]=o.useState(!1),[Z,X]=o.useState(!1),[de,ee]=o.useState(!1),[Ne,U]=o.useState(!1),[me,b]=o.useState(!1),[G,te]=o.useState(!1),[ke,Re]=o.useState([]),[Fe,Se]=o.useState(!1),[Le,ue]=o.useState("daily"),[F,he]=o.useState({amount:0,description:"Manual payment entry"}),Oe=o.useRef(null),[I,it]=o.useState(null),[zt,Be]=o.useState(!1);let Ce=[];try{Ce=kt().devices||[]}catch{Ce=[]}const{customers:_t}=ot(),W=Pe(),Q=Ie(),{notifications:We,unreadNotifications:xe,markAsRead:At,_markAsActioned:er,dismissNotification:Et}=Os(),[qe,$e]=o.useState(!1),[oe,O]=o.useState(!1),[It,tr]=o.useState(navigator.onLine),[sr,Pt]=o.useState(new Date),[le,Tt]=o.useState(0),[Ge,Rt]=o.useState(!1),{handleBackClick:Ft,previousPage:Lt}=Fs();o.useEffect(()=>{const s=setInterval(()=>{Pt(new Date)},6e4);return()=>clearInterval(s)},[]),o.useEffect(()=>{const s=()=>{const u=Oe.current,j=(u==null?void 0:u.offsetHeight)||0,f=u?window.getComputedStyle(u):null,M=(f==null?void 0:f.marginLeft)||"0px";document.documentElement.style.setProperty("--app-topbar-height",`${j}px`),document.documentElement.style.setProperty("--app-sidebar-offset",M)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),o.useEffect(()=>{const s=requestAnimationFrame(()=>{const u=Oe.current,j=(u==null?void 0:u.offsetHeight)||0,f=u?window.getComputedStyle(u):null,M=(f==null?void 0:f.marginLeft)||"0px";document.documentElement.style.setProperty("--app-topbar-height",`${j}px`),document.documentElement.style.setProperty("--app-sidebar-offset",M)});return()=>cancelAnimationFrame(s)},[oe,qe,n,a,le,Ge,r==null?void 0:r.role]),o.useEffect(()=>{const s=async()=>{try{const[j,f]=await Promise.all([Ye.getPendingReminders(),Ye.getOverdueReminders()]);Tt(f.length)}catch(j){console.error("Error fetching reminder count:",j)}};s();const u=setInterval(s,5*60*1e3);return()=>clearInterval(u)},[]),o.useEffect(()=>{const s=()=>{try{const j=localStorage.getItem("whatsapp_bulk_campaign_active");if(j){const f=JSON.parse(j);it(f),Be(f.isMinimized===!0),console.log("üìä [TopBar] Active campaign detected:",f)}else it(null),Be(!1)}catch(j){console.error("Error checking active campaign:",j)}};s();const u=setInterval(s,2e3);return window.addEventListener("storage",s),()=>{clearInterval(u),window.removeEventListener("storage",s)}},[]);const Qe=o.useRef(null),He=o.useRef(null);o.useEffect(()=>{const s=u=>{Qe.current&&!Qe.current.contains(u.target)&&$e(!1),He.current&&!He.current.contains(u.target)&&O(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const Ot=async()=>{if((r==null?void 0:r.role)==="admin"){Se(!0);try{const s=await N();Re(s)}catch(s){console.error("Error loading test users:",s)}finally{Se(!1)}}},Bt=async s=>{await w(s)&&b(!1)},Wt=()=>{c(),b(!1)};o.useEffect(()=>{const s=()=>{Rt(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",s),document.addEventListener("webkitfullscreenchange",s),document.addEventListener("mozfullscreenchange",s),document.addEventListener("MSFullscreenChange",s),()=>{document.removeEventListener("fullscreenchange",s),document.removeEventListener("webkitfullscreenchange",s),document.removeEventListener("mozfullscreenchange",s),document.removeEventListener("MSFullscreenChange",s)}},[]);const ne=(()=>{const s=new Date;new Date(s.getTime()-24*60*60*1e3);const u=Ce.filter(M=>M.status!=="done"&&M.status!=="failed").length,j=_t.filter(M=>M.isRead===!1||M.isRead===void 0).length,f=Ce.filter(M=>M.status==="done"||M.status==="failed"||!M.expectedReturnDate?!1:new Date(M.expectedReturnDate)<s).length;return{activeDevices:u,newCustomers:j,overdueDevices:f}})(),Ke=s=>s<1e3?s.toString():s<1e4?(s/1e3).toFixed(1).replace(/\.0$/,"")+"K":s<1e6?Math.round(s/1e3)+"K":(s/1e6).toFixed(1).replace(/\.0$/,"")+"M",qt=o.useCallback(async s=>{try{await zs(s),D.success("Appointment created successfully")}catch(u){throw console.error("Failed to create appointment:",u),D.error("Failed to create appointment"),u instanceof Error?u:new Error("Failed to create appointment")}},[]),Gt=async()=>{try{if(document.fullscreenElement)document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen();else{const s=document.documentElement;s.requestFullscreen?await s.requestFullscreen():s.webkitRequestFullscreen?await s.webkitRequestFullscreen():s.mozRequestFullScreen?await s.mozRequestFullScreen():s.msRequestFullscreen&&await s.msRequestFullscreen()}}catch(s){console.error("Fullscreen error:",s)}};(()=>{const s=[],u=r.permissions||[],j=u.includes("all");return(j||u.includes("create_customers")||r.role==="admin")&&s.push({label:"Add Customer",icon:e.jsx(H,{size:16}),action:()=>W("/customers")}),(j||u.includes("add_device")||r.role==="admin"||r.role==="customer-care")&&s.push({label:"Add Device",icon:e.jsx(V,{size:16}),action:()=>W("/devices/new")}),(j||u.includes("add_products")||r.role==="admin")&&s.push({label:"Add Product",icon:e.jsx(pe,{size:16}),action:()=>k(!0)}),(j||u.includes("view_inventory")||r.role==="admin")&&s.push({label:"Unified Inventory",icon:e.jsx(K,{size:16}),action:()=>W("/lats/unified-inventory")}),(j||r.role==="admin")&&s.push({label:"SMS Centre",icon:e.jsx(re,{size:16}),action:()=>W("/sms")}),s})();const ct=o.useMemo(()=>{const s=Q.pathname,u=(r==null?void 0:r.permissions)||[],j=u.includes("all"),f=r==null?void 0:r.role,M=[];return(s.includes("/lats/unified-inventory")||s.includes("/lats/inventory"))&&(j||f==="admin"||u.includes("manage_inventory"))&&M.push({label:"Stock Transfer",icon:e.jsx(fe,{size:18}),path:"/lats/stock-transfer",color:"from-sky-500 to-blue-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"Purchase Orders",icon:e.jsx(ye,{size:18}),path:"/lats/purchase-orders",color:"from-orange-500 to-amber-600",hoverColor:"hover:from-orange-600 hover:to-amber-700"},{label:"Suppliers",icon:e.jsx(Je,{size:18}),path:"/supplier-management",color:"from-amber-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"},{label:"Storage Rooms",icon:e.jsx(tt,{size:18}),path:"/lats/storage-rooms",color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"},{label:"Categories",icon:e.jsx(is,{size:18}),path:"/lats/inventory-management?tab=categories",color:"from-green-500 to-emerald-600",hoverColor:"hover:from-green-600 hover:to-emerald-700"}),s.includes("/pos")&&(j||f==="admin"||f==="customer-care")&&M.push({label:"Inventory",icon:e.jsx(K,{size:18}),path:"/lats/unified-inventory",color:"from-orange-500 to-amber-600",hoverColor:"hover:from-orange-600 hover:to-amber-700"},{label:"Customers",icon:e.jsx(H,{size:18}),path:"/customers",color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"},{label:"Sales Reports",icon:e.jsx(be,{size:18}),path:"/lats/sales-reports",color:"from-blue-500 to-indigo-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"Loyalty",icon:e.jsx(cs,{size:18}),path:"/lats/loyalty",color:"from-yellow-500 to-amber-600",hoverColor:"hover:from-yellow-600 hover:to-amber-700"}),s.includes("/customers")&&(j||f==="admin"||f==="customer-care"||f==="technician")&&M.push({label:"Add Customer",icon:e.jsx(pt,{size:18}),path:"/customers",color:"from-emerald-500 to-green-600",hoverColor:"hover:from-green-600 hover:to-emerald-700"},{label:"Appointments",icon:e.jsx(se,{size:18}),path:"/appointments",color:"from-pink-500 to-rose-600",hoverColor:"hover:from-rose-600 hover:to-rose-700"},{label:"SMS Centre",icon:e.jsx(re,{size:18}),path:"/sms",color:"from-indigo-500 to-indigo-600",hoverColor:"hover:from-indigo-600 hover:to-indigo-700"},{label:"POS",icon:e.jsx(ve,{size:18}),path:"/pos",color:"from-emerald-500 to-teal-600",hoverColor:"hover:from-emerald-600 hover:to-teal-700"}),s.includes("/devices")&&(j||f==="admin"||f==="customer-care"||f==="technician")&&M.push({label:"Add Device",icon:e.jsx(V,{size:18}),path:"/devices/new",color:"from-blue-500 to-indigo-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"Customers",icon:e.jsx(H,{size:18}),path:"/customers",color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"},{label:"Reminders",icon:e.jsx(ie,{size:18}),path:"/reminders",color:"from-yellow-500 to-amber-600",hoverColor:"hover:from-yellow-600 hover:to-amber-700"},{label:"Appointments",icon:e.jsx(se,{size:18}),path:"/appointments",color:"from-pink-500 to-rose-600",hoverColor:"hover:from-rose-600 hover:to-rose-700"}),(s.includes("/purchase-orders")||s.includes("/purchase-order"))&&(j||f==="admin"||u.includes("manage_inventory"))&&M.push({label:"Create PO",icon:e.jsx(pe,{size:18}),path:"/lats/purchase-order/create",color:"from-orange-500 to-amber-600",hoverColor:"hover:from-orange-600 hover:to-amber-700"},{label:"Inventory",icon:e.jsx(K,{size:18}),path:"/lats/unified-inventory",color:"from-blue-500 to-indigo-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"Suppliers",icon:e.jsx(Je,{size:18}),path:"/supplier-management",color:"from-amber-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"},{label:"Stock Transfer",icon:e.jsx(fe,{size:18}),path:"/lats/stock-transfer",color:"from-sky-500 to-blue-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"}),(s.includes("/reports")||s.includes("/analytics")||s.includes("/sales-reports"))&&(j||f==="admin")&&M.push({label:"Sales Reports",icon:e.jsx(be,{size:18}),path:"/lats/sales-reports",color:"from-blue-500 to-indigo-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"POS",icon:e.jsx(ve,{size:18}),path:"/pos",color:"from-emerald-500 to-teal-600",hoverColor:"hover:from-emerald-600 hover:to-teal-700"},{label:"Inventory",icon:e.jsx(K,{size:18}),path:"/lats/unified-inventory",color:"from-orange-500 to-amber-600",hoverColor:"hover:from-orange-600 hover:to-amber-700"},{label:"Dashboard",icon:e.jsx(st,{size:18}),path:"/dashboard",color:"from-slate-500 to-slate-600",hoverColor:"hover:from-slate-600 hover:to-slate-700"}),s.includes("/storage-rooms")&&(j||f==="admin")&&M.push({label:"Inventory",icon:e.jsx(K,{size:18}),path:"/lats/unified-inventory",color:"from-orange-500 to-amber-600",hoverColor:"hover:from-orange-600 hover:to-amber-700"},{label:"Stock Transfer",icon:e.jsx(fe,{size:18}),path:"/lats/stock-transfer",color:"from-sky-500 to-blue-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"Purchase Orders",icon:e.jsx(ye,{size:18}),path:"/lats/purchase-orders",color:"from-orange-500 to-amber-600",hoverColor:"hover:from-orange-600 hover:to-amber-700"}),(s.includes("/supplier-management")||s.includes("/suppliers"))&&(j||f==="admin"||u.includes("manage_suppliers"))&&M.push({label:"Purchase Orders",icon:e.jsx(ye,{size:18}),path:"/lats/purchase-orders",color:"from-orange-500 to-amber-600",hoverColor:"hover:from-orange-600 hover:to-amber-700"},{label:"Inventory",icon:e.jsx(K,{size:18}),path:"/lats/unified-inventory",color:"from-blue-500 to-indigo-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"Create PO",icon:e.jsx(pe,{size:18}),path:"/lats/purchase-order/create",color:"from-emerald-500 to-green-600",hoverColor:"hover:from-green-600 hover:to-emerald-700"}),s.includes("/appointments")&&(j||f==="admin"||f==="customer-care"||f==="technician")&&M.push({label:"Customers",icon:e.jsx(H,{size:18}),path:"/customers",color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"},{label:"Devices",icon:e.jsx(V,{size:18}),path:"/devices",color:"from-blue-500 to-indigo-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"Reminders",icon:e.jsx(ie,{size:18}),path:"/reminders",color:"from-yellow-500 to-amber-600",hoverColor:"hover:from-yellow-600 hover:to-amber-700"},{label:"Create",icon:e.jsx(bt,{size:18}),path:"/appointments",color:"from-pink-500 to-rose-600",hoverColor:"hover:from-rose-600 hover:to-rose-700"}),s.includes("/reminders")&&(j||f==="admin"||f==="customer-care"||f==="technician")&&M.push({label:"Appointments",icon:e.jsx(se,{size:18}),path:"/appointments",color:"from-pink-500 to-rose-600",hoverColor:"hover:from-rose-600 hover:to-rose-700"},{label:"Devices",icon:e.jsx(V,{size:18}),path:"/devices",color:"from-blue-500 to-indigo-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"},{label:"Customers",icon:e.jsx(H,{size:18}),path:"/customers",color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"}),(s==="/dashboard"||s==="/")&&(j||f==="admin"||f==="customer-care")&&M.push({label:"POS",icon:e.jsx(ve,{size:18}),path:"/pos",color:"from-emerald-500 to-teal-600",hoverColor:"hover:from-emerald-600 hover:to-teal-700"},{label:"Inventory",icon:e.jsx(K,{size:18}),path:"/lats/unified-inventory",color:"from-orange-500 to-amber-600",hoverColor:"hover:from-orange-600 hover:to-amber-700"},{label:"Customers",icon:e.jsx(H,{size:18}),path:"/customers",color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"},{label:"Reports",icon:e.jsx(be,{size:18}),path:"/lats/sales-reports",color:"from-blue-500 to-indigo-600",hoverColor:"hover:from-blue-600 hover:to-indigo-700"}),M},[Q.pathname,r]),Me=o.useMemo(()=>{const s=[],u=(r==null?void 0:r.permissions)||[],j=u.includes("all"),f=r==null?void 0:r.role,M=j||f==="admin"||f==="inventory-manager"||u.includes("manage_inventory");return(M||u.includes("add_products"))&&s.push({key:"add-product",label:"Add Product",description:"Add new inventory item",icon:K,gradient:"from-orange-500 to-amber-600",hover:"hover:from-orange-600 hover:to-amber-700",action:()=>{k(!0),O(!1)}}),M&&s.push({key:"stock-transfer",label:"Stock Transfer",description:"Move stock between branches",icon:fe,gradient:"from-sky-500 to-blue-600",hover:"hover:from-blue-600 hover:to-indigo-700",action:()=>{$(!0),O(!1)}}),(f==="admin"||j||u.includes("manage_suppliers"))&&s.push({key:"add-supplier",label:"Add Supplier",description:"Manage procurement partners",icon:Je,gradient:"from-amber-500 to-orange-600",hover:"hover:from-orange-600 hover:to-orange-700",action:()=>{L(!0),O(!1)}}),(f==="admin"||j)&&s.push({key:"customer-import",label:"Import Customers",description:"Upload customer records from Excel",icon:pt,gradient:"from-emerald-500 to-green-600",hover:"hover:from-green-600 hover:to-emerald-700",action:()=>{i(!0),O(!1)}}),(f==="admin"||f==="customer-care"||f==="technician"||j)&&s.push({key:"create-appointment",label:"Create Appointment",description:"Schedule customer visit or repair",icon:bt,gradient:"from-pink-500 to-rose-600",hover:"hover:from-rose-600 hover:to-rose-700",action:()=>{p(!0),O(!1)}}),(f==="admin"||j)&&s.push({key:"payments",label:"Payment Entry",description:"Record manual payments & transfers",icon:$t,gradient:"from-slate-600 to-slate-700",hover:"hover:from-slate-700 hover:to-slate-800",action:()=>{he({amount:0,description:"Manual payment entry"}),A(!0),O(!1)}}),(j||f==="admin"||f==="customer-care")&&s.push({key:"sms-centre",label:"SMS Centre",description:"Send messages to customers",icon:re,gradient:"from-indigo-500 to-indigo-600",hover:"hover:from-indigo-600 hover:to-indigo-700",action:()=>{d(!0),O(!1)}}),(f==="admin"||j||u.includes("manage_employees"))&&s.push({key:"employee-import",label:"Import Employees",description:"Add team members from users",icon:Mt,gradient:"from-teal-500 to-cyan-600",hover:"hover:from-cyan-600 hover:to-teal-700",action:()=>{q(!0),O(!1)}}),(f==="admin"||j||u.includes("manage_finances"))&&s.push({key:"account-transfer",label:"Account Transfer",description:"Move funds between accounts",icon:De,gradient:"from-slate-500 to-slate-600",hover:"hover:from-slate-600 hover:to-slate-700",action:()=>{X(!0),O(!1)}}),(f==="admin"||j||f==="customer-care"||u.includes("manage_communications"))&&s.push({key:"bulk-sms",label:"Bulk SMS Campaign",description:"Send messages to customer groups",icon:re,gradient:"from-violet-500 to-purple-600",hover:"hover:from-purple-600 hover:to-violet-700",action:()=>{ee(!0),O(!1)}}),f&&(s.push({key:"daily-report",label:"Daily Report",description:"Submit your daily work report",icon:et,gradient:"from-blue-500 to-indigo-600",hover:"hover:from-indigo-600 hover:to-blue-700",action:()=>{ue("daily"),U(!0),O(!1)}}),s.push({key:"monthly-report",label:"Monthly Report",description:"Submit your monthly summary report",icon:se,gradient:"from-teal-500 to-cyan-600",hover:"hover:from-cyan-600 hover:to-teal-700",action:()=>{ue("monthly"),U(!0),O(!1)}})),s},[r,W,O,k,L,i,p,he,A,d,q,X,ee,U,ue]),Qt=s=>{if(!s||s<0)return"‚Äî";if(s<60)return`${s}s`;if(s<3600)return`${Math.floor(s/60)}m ${s%60}s`;const u=Math.floor(s/3600),j=Math.floor(s%3600/60);return`${u}h ${j}m`};return e.jsxs(e.Fragment,{children:[zt&&I&&e.jsxs("div",{className:"fixed right-4 bg-white rounded-2xl shadow-2xl border-4 border-green-500 overflow-hidden z-[100000]",style:{top:"50%",transform:"translateY(-50%)",width:"550px",maxHeight:"95vh",boxShadow:"0 0 0 4px rgba(34, 197, 94, 0.2), 0 20px 60px rgba(0, 0, 0, 0.3)"},children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500 text-white p-5 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/30 rounded-full flex items-center justify-center",children:e.jsx(Send,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"üì§ Campaign Active"}),e.jsx("p",{className:"text-xs text-green-100",children:"Sending in progress..."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{window.location.href="/whatsapp/inbox?expand=true"},className:"p-2.5 bg-white/20 hover:bg-white/30 rounded-lg transition-all",title:"Expand to full view",children:e.jsx(Eye,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{Be(!1),D.success("Panel hidden. Campaign continues.",{icon:"üëÅÔ∏è"})},className:"p-2.5 bg-white/20 hover:bg-white/30 rounded-lg transition-all",title:"Hide panel",children:e.jsx(ft,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"overflow-y-auto bg-white relative z-10",style:{maxHeight:"calc(95vh - 120px)"},children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"Progress"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[I.current||0," / ",I.total||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden mb-2",children:e.jsx("div",{className:"h-4 bg-gradient-to-r from-green-500 to-emerald-500 transition-all duration-300",style:{width:`${I.total>0?(I.current||0)/I.total*100:0}%`}})}),e.jsxs("p",{className:"text-center text-sm font-bold text-gray-700",children:[I.total>0?Math.round((I.current||0)/I.total*100):0,"% Complete"]})]}),((I.success||0)>0||(I.failed||0)>0)&&e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gradient-to-br from-purple-50 to-pink-50",children:[e.jsxs("h4",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Campaign Stats"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Success"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:I.success||0})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:I.failed||0})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[(I.success||0)+(I.failed||0)>0?Math.round((I.success||0)/((I.success||0)+(I.failed||0))*100):0,"%"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Duration"}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:I.startTime?Qt(Math.floor((Date.now()-I.startTime)/1e3)):"‚Äî"})]})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border-l-4 border-blue-500",children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium",children:"üí° Campaign is running in the background"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Click the eye icon above to view full details in WhatsApp Inbox"})]}),e.jsxs("div",{className:"p-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Recipients:"}),e.jsx("span",{className:"font-bold text-gray-900",children:I.total||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sent:"}),e.jsx("span",{className:"font-bold text-green-600",children:I.success||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Failed:"}),e.jsx("span",{className:"font-bold text-red-600",children:I.failed||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Remaining:"}),e.jsx("span",{className:"font-bold text-orange-600",children:(I.total||0)-(I.current||0)})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>{window.location.href="/whatsapp/inbox?expand=true"},className:"w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(Eye,{className:"w-5 h-5"}),"View Full Campaign Details"]})})]})]}),e.jsxs("header",{ref:Oe,className:`fixed top-0 left-0 right-0 z-20 transition-all duration-500 ${a?"md:ml-[5.5rem]":"md:ml-72"}`,children:[e.jsx("div",{className:`topbar ${l?"bg-slate-900/90":"bg-white/80"} backdrop-blur-xl ${l?"border-slate-700/50":"border-white/30"} border-b shadow-lg`,children:e.jsxs("div",{className:"flex items-center justify-between px-3 lg:px-6 py-2.5 lg:py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:t,className:`p-3 rounded-xl ${l?"bg-slate-800/60 hover:bg-slate-700/60":"bg-white/80 hover:bg-white"} transition-all duration-200 backdrop-blur-sm md:hidden ${l?"border-slate-600":"border-gray-200"} border shadow-sm`,children:n?e.jsx(Ae,{size:20,className:l?"text-gray-200":"text-gray-700"}):e.jsx(ds,{size:20,className:l?"text-gray-200":"text-gray-700"})}),e.jsx("button",{onClick:Ft,className:`p-3 rounded-xl ${l?"bg-slate-800/60 hover:bg-slate-700/60":"bg-white/80 hover:bg-white"} transition-all duration-200 backdrop-blur-sm ${l?"border-slate-600":"border-gray-200"} border shadow-sm`,title:Lt?"Go Back":"Go to Dashboard",children:e.jsx(ms,{size:18,className:l?"text-gray-200":"text-gray-700"})})]}),e.jsx("div",{className:"hidden md:flex items-center gap-2 flex-1 mx-2 lg:mx-4 overflow-x-auto transition-all",style:{scrollBehavior:"smooth"},children:e.jsxs("div",{className:"flex items-center gap-2 min-w-max",children:[e.jsx("button",{onClick:()=>_(),className:`p-2.5 lg:p-3 rounded-xl transition-all duration-200 flex-shrink-0 ${l?"bg-slate-800/60 hover:bg-slate-700/60 text-gray-300 border border-slate-700":"bg-white/80 hover:bg-white text-gray-700 border border-gray-200"} cursor-pointer backdrop-blur-sm shadow-sm hover:shadow-md`,title:"Search (‚åòK)",children:e.jsx(Ee,{size:18})}),e.jsx("div",{className:`h-8 w-px mx-0.5 lg:mx-1 flex-shrink-0 ${l?"bg-slate-700":"bg-gray-200"}`}),e.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center justify-center gap-1.5 lg:gap-2 px-3 lg:px-4 py-2 lg:py-2.5 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white transition-all duration-200 shadow-sm hover:shadow-md",title:"Quick Reminder (‚ö° Fast Entry)",children:[e.jsx(je,{size:16,className:"lg:w-[18px] lg:h-[18px]"}),e.jsx("span",{className:"hidden xl:inline font-medium text-sm",children:"Reminder"})]}),(r==null?void 0:r.role)==="admin"&&e.jsxs("button",{onClick:()=>P(!0),className:"flex items-center justify-center gap-1.5 lg:gap-2 px-3 lg:px-4 py-2 lg:py-2.5 rounded-xl bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white transition-all duration-200 shadow-sm hover:shadow-md",title:"Quick Expense (‚ö° Fast Entry)",children:[e.jsx(Dt,{size:16,className:"lg:w-[18px] lg:h-[18px]"}),e.jsx("span",{className:"hidden xl:inline font-medium text-sm",children:"Expense"})]})]}),e.jsx("div",{className:`h-8 w-px mx-0.5 lg:mx-1 flex-shrink-0 ${l?"bg-slate-700":"bg-gray-200"}`}),ct.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-1.5 lg:gap-2 flex-shrink-0",children:ct.slice(0,4).map((s,u)=>e.jsxs("button",{onClick:()=>W(s.path),className:`flex items-center justify-center gap-1.5 lg:gap-2 px-3 lg:px-4 py-2 lg:py-2.5 rounded-xl bg-gradient-to-r ${s.color} ${s.hoverColor} text-white transition-all duration-200 shadow-sm hover:shadow-md font-medium whitespace-nowrap text-sm`,title:s.label,children:[lt.cloneElement(s.icon,{size:16,className:"lg:w-[18px] lg:h-[18px]"}),e.jsx("span",{className:"hidden xl:inline",children:s.label})]},`${s.path}-${u}`))}),e.jsx("div",{className:`h-8 w-px mx-0.5 lg:mx-1 flex-shrink-0 ${l?"bg-slate-700":"bg-gray-200"}`})]}),e.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 flex-shrink-0",children:[((r==null?void 0:r.role)==="admin"||((dt=r==null?void 0:r.permissions)==null?void 0:dt.includes("all"))||((mt=r==null?void 0:r.permissions)==null?void 0:mt.includes("view_installments")))&&e.jsxs("button",{onClick:()=>te(!0),className:"flex items-center justify-center gap-1.5 lg:gap-2 px-3 lg:px-4 py-2 lg:py-2.5 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white transition-all duration-200 shadow-sm hover:shadow-md font-medium text-sm",title:"Installment Plans",children:[e.jsx(se,{size:16,className:"lg:w-[18px] lg:h-[18px]"}),e.jsx("span",{className:"hidden lg:inline",children:"Installments"})]}),((r==null?void 0:r.role)==="admin"||((ut=r==null?void 0:r.permissions)==null?void 0:ut.includes("manage_inventory"))||((ht=r==null?void 0:r.permissions)==null?void 0:ht.includes("all")))&&e.jsxs("button",{onClick:()=>W("/lats/purchase-order/create"),className:"flex items-center justify-center gap-1.5 lg:gap-2 px-3 lg:px-4 py-2 lg:py-2.5 rounded-xl bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 text-white transition-all duration-200 shadow-sm hover:shadow-md font-medium text-sm",title:"Create Purchase Order (‚åò‚áßO)",children:[e.jsx(ye,{size:16,className:"lg:w-[18px] lg:h-[18px]"}),e.jsx("span",{className:"hidden lg:inline",children:"PO"})]}),(r==null?void 0:r.role)!=="technician"&&e.jsxs("div",{className:"relative",ref:He,children:[e.jsxs("button",{onClick:()=>O(!oe),className:"flex items-center justify-center gap-1.5 lg:gap-2 px-3 lg:px-4 py-2 lg:py-2.5 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white transition-all duration-200 shadow-sm hover:shadow-md font-medium text-sm",title:"Create new items",children:[e.jsx(pe,{size:16,className:"lg:w-[18px] lg:h-[18px]"}),e.jsx("span",{className:"hidden lg:inline",children:"Create"}),e.jsx(nt,{size:14,className:`transition-transform duration-200 ${oe?"rotate-180":""}`})]}),oe&&e.jsx("div",{className:`absolute right-0 top-full mt-2 w-80 ${l?"bg-slate-900/95 border-slate-700/60":"bg-white/95 border-gray-200/60"} backdrop-blur-xl rounded-xl shadow-xl border z-50`,children:e.jsx("div",{className:"p-4 space-y-3",children:Me.length===0?e.jsx("div",{className:`w-full px-4 py-6 rounded-xl border text-center ${l?"bg-slate-800/70 border-slate-700 text-gray-300":"bg-gray-50 border-gray-200 text-gray-600"}`,children:e.jsx("p",{className:"text-sm font-medium",children:"No quick create actions available"})}):Me.map(s=>{const u=s.icon;return e.jsxs("button",{onClick:s.action,className:`w-full flex items-center justify-between gap-3 px-4 py-3 rounded-xl bg-gradient-to-r ${s.gradient} ${s.hover} text-white transition-all duration-200 shadow-sm hover:shadow-lg hover:-translate-y-0.5`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{size:20,className:"shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold leading-tight",children:s.label}),e.jsx("p",{className:"text-xs text-white/80 leading-tight",children:s.description})]})]}),e.jsx(De,{size:18,className:"opacity-80"})]},s.key)})})})]})]})]})}),(r==null?void 0:r.role)==="technician"&&e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs("button",{onClick:()=>W("/lats/spare-parts"),className:"flex items-center gap-1.5 lg:gap-2 px-3 lg:px-4 py-2 lg:py-2.5 rounded-xl bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white transition-all duration-200 shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(K,{size:16}),e.jsx("span",{children:"Spare Parts"})]})}),(r==null?void 0:r.role)!=="technician"&&e.jsx("div",{className:`hidden lg:block h-8 w-px mx-1 flex-shrink-0 ${l?"bg-slate-700":"bg-gray-200"}`}),(r==null?void 0:r.role)!=="technician"&&e.jsxs("div",{className:"hidden lg:flex items-center gap-1.5 flex-shrink-0",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("button",{onClick:()=>W("/pos"),className:`p-2.5 rounded-xl transition-all duration-200 backdrop-blur-sm border shadow-sm ${Q.pathname.includes("/pos")?"bg-emerald-500 text-white border-emerald-400 scale-105":l?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600 hover:scale-105":"bg-white/80 hover:bg-white border-gray-200 hover:scale-105"}`,title:"POS System",children:e.jsx(ve,{size:16,className:Q.pathname.includes("/pos")?"text-white":l?"text-gray-200":"text-gray-700"})}),e.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${l?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["POS System",e.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent ${l?"border-t-slate-800/95":"border-t-white/95"}`})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{onClick:()=>W("/customers"),className:`p-2.5 rounded-xl transition-all duration-200 backdrop-blur-sm border shadow-sm ${Q.pathname.includes("/customers")?"bg-purple-500 text-white border-purple-400 scale-105":l?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600 hover:scale-105":"bg-white/80 hover:bg-white border-gray-200 hover:scale-105"}`,title:"Customers",children:e.jsx(H,{size:16,className:Q.pathname.includes("/customers")?"text-white":l?"text-gray-200":"text-gray-700"})}),e.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${l?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["Customers",e.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent ${l?"border-t-slate-800/95":"border-t-white/95"}`})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{onClick:()=>W("/devices"),className:`p-2.5 rounded-xl transition-all duration-200 backdrop-blur-sm border shadow-sm ${Q.pathname.includes("/devices")?"bg-blue-500 text-white border-blue-400 scale-105":l?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600 hover:scale-105":"bg-white/80 hover:bg-white border-gray-200 hover:scale-105"}`,title:"Devices",children:e.jsx(V,{size:16,className:Q.pathname.includes("/devices")?"text-white":l?"text-gray-200":"text-gray-700"})}),e.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${l?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["Devices",e.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent ${l?"border-t-slate-800/95":"border-t-white/95"}`})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>W("/reminders"),className:`p-2.5 rounded-xl transition-all duration-200 backdrop-blur-sm border shadow-sm relative ${Q.pathname.includes("/reminders")?"bg-yellow-500 text-white border-yellow-400 scale-105":l?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600 hover:scale-105":"bg-white/80 hover:bg-white border-gray-200 hover:scale-105"}`,title:"Reminders",children:[e.jsx(ie,{size:16,className:Q.pathname.includes("/reminders")?"text-white":l?"text-gray-200":"text-gray-700"}),le>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center border-2 border-white shadow-sm",children:e.jsx("span",{className:"text-[10px] text-white font-bold",children:le>9?"9+":le})})]}),e.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${l?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["Reminders ",le>0?`(${le} overdue)`:"",e.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent ${l?"border-t-slate-800/95":"border-t-white/95"}`})]})]}),(r==null?void 0:r.role)==="admin"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative group",children:[e.jsx("button",{onClick:()=>W("/lats/unified-inventory"),className:`p-2.5 rounded-xl transition-all duration-200 backdrop-blur-sm border shadow-sm ${Q.pathname.includes("/lats/unified-inventory")?"bg-orange-500 text-white border-orange-400 scale-105":l?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600 hover:scale-105":"bg-white/80 hover:bg-white border-gray-200 hover:scale-105"}`,title:"Inventory",children:e.jsx(tt,{size:16,className:Q.pathname.includes("/lats/unified-inventory")?"text-white":l?"text-gray-200":"text-gray-700"})}),e.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${l?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["Inventory",e.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent ${l?"border-t-slate-800/95":"border-t-white/95"}`})]})]})})]}),e.jsx("div",{className:`hidden lg:block h-8 w-px mx-1 flex-shrink-0 ${l?"bg-slate-700":"bg-gray-200"}`}),e.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"hidden xl:flex items-center gap-1.5 mr-1.5",children:[ne.activeDevices>0&&e.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-full bg-blue-100 text-blue-700 backdrop-blur-sm border border-blue-200 shadow-sm",children:[e.jsx(V,{size:12}),e.jsx("span",{className:"text-xs font-bold",children:Ke(ne.activeDevices)})]}),ne.overdueDevices>0&&e.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-full bg-red-100 text-red-700 backdrop-blur-sm border border-red-200 shadow-sm",children:[e.jsx(ie,{size:12}),e.jsx("span",{className:"text-xs font-bold",children:Ke(ne.overdueDevices)})]}),(r==null?void 0:r.role)!=="technician"&&ne.newCustomers>0&&e.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-full bg-green-100 text-green-700 backdrop-blur-sm border border-green-200 shadow-sm",children:[e.jsx(H,{size:12}),e.jsx("span",{className:"text-xs font-bold",children:Ke(ne.newCustomers)})]})]}),e.jsx("div",{className:"hidden sm:flex items-center justify-center w-7 h-7",children:e.jsx("div",{className:`w-2 h-2 rounded-full ${It?"bg-green-500":"bg-red-500"} animate-pulse shadow-sm`})}),e.jsx("div",{className:`hidden sm:block h-8 w-px mx-0.5 flex-shrink-0 ${l?"bg-slate-700":"bg-gray-200"}`}),e.jsx("button",{onClick:Gt,className:`p-2.5 rounded-xl ${l?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/80 hover:bg-white border-gray-200"} transition-all duration-200 backdrop-blur-sm border shadow-sm`,title:Ge?"Exit Fullscreen (ESC)":"Enter Fullscreen",children:Ge?e.jsx(ft,{size:16,className:l?"text-gray-200":"text-gray-700"}):e.jsx(us,{size:16,className:l?"text-gray-200":"text-gray-700"})}),e.jsx(qs,{variant:"icon",size:"md",showConfirmation:!0,className:`${l?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/80 hover:bg-white border-gray-200"} ${l?"text-gray-200 hover:text-blue-400":"text-gray-700 hover:text-blue-600"} !p-2.5`}),e.jsxs("div",{className:"relative",ref:Qe,children:[e.jsxs("button",{onClick:()=>$e(!qe),className:`p-2.5 rounded-xl ${l?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/80 hover:bg-white border-gray-200"} transition-all duration-200 backdrop-blur-sm border relative shadow-sm`,title:"Notifications",children:[e.jsx(je,{size:16,className:l?"text-gray-200":"text-gray-700"}),xe.length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full notification-badge border-2 border-white shadow-sm flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white font-bold",children:xe.length>9?"9+":xe.length})})]}),qe&&e.jsx("div",{className:`absolute right-0 top-full mt-3 w-80 ${l?"bg-slate-800/95":"bg-white/95"} backdrop-blur-xl rounded-xl shadow-xl ${l?"border-slate-700":"border-white/30"} border z-50 max-h-96 overflow-y-auto`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:`font-semibold ${l?"text-white":"text-gray-900"}`,children:"Notifications"}),xe.length>0&&e.jsxs("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:[xe.length," unread"]})]}),e.jsx("div",{className:"space-y-2",children:We.length>0?We.slice(0,8).map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border transition-all duration-200 hover:shadow-sm cursor-pointer ${s.status==="unread"?l?"bg-blue-900/30 border-blue-700":"bg-blue-50 border-blue-200":l?"bg-slate-700/30 border-slate-600":"bg-gray-50 border-gray-200"}`,onClick:()=>{s.status==="unread"&&At(s.id),s.actionUrl&&(W(s.actionUrl),$e(!1))},children:[e.jsx("div",{className:`p-2 rounded-full text-lg ${s.color||"bg-gray-500"}`,children:s.icon||"üîî"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium ${s.status==="unread"?l?"text-white":"text-gray-900":l?"text-gray-300":"text-gray-700"}`,children:s.title}),e.jsx("p",{className:`text-xs mt-1 line-clamp-2 ${l?"text-gray-400":"text-gray-600"}`,children:s.message}),e.jsx("p",{className:"text-xs mt-1 text-gray-500",children:new Date(s.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[s.status==="unread"&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("button",{onClick:u=>{u.stopPropagation(),Et(s.id)},className:`${l?"text-gray-500 hover:text-gray-300":"text-gray-400 hover:text-gray-600"} transition-colors`,title:"Dismiss",children:e.jsx(Ae,{size:12})})]})]},s.id)):e.jsxs("div",{className:`text-center py-6 ${l?"text-gray-400":"text-gray-500"}`,children:[e.jsx(je,{size:24,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"No notifications"})]})}),We.length>8&&e.jsx("div",{className:`mt-3 pt-3 ${l?"border-slate-700":"border-gray-200"} border-t`,children:e.jsx("button",{onClick:()=>{W("/notifications"),$e(!1)},className:"w-full text-center text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View all notifications"})})]})})]}),(r==null?void 0:r.role)==="admin"&&e.jsx(Gs,{}),(r==null?void 0:r.role)==="admin"&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>{const s=!me;b(s),s&&Ot()},className:`p-2.5 rounded-xl transition-all duration-200 backdrop-blur-sm border shadow-sm ${y?"bg-red-500 text-white border-red-400 hover:bg-red-600":"bg-purple-500 text-white border-purple-400 hover:bg-purple-600"}`,title:y?"Stop User Testing (Currently impersonating)":"Test as Different User",children:e.jsx(ae,{size:16,className:"text-white"})}),me&&e.jsx("div",{className:`absolute right-0 top-full mt-2 w-80 ${l?"bg-slate-800/95 border-slate-700/60":"bg-white/95 border-gray-200/60"} backdrop-blur-xl rounded-xl shadow-xl border z-50 max-h-96 overflow-y-auto`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:`font-semibold ${l?"text-white":"text-gray-900"}`,children:y?"Stop Testing":"Test as User"}),y&&e.jsx("button",{onClick:Wt,className:"px-3 py-1 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600 transition-colors",children:"Stop Testing"})]}),y&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(ae,{size:16}),e.jsxs("span",{className:"text-sm font-medium",children:["Currently testing as: ",e.jsx("strong",{children:r==null?void 0:r.name})," (",r==null?void 0:r.role,")"]})]})}),!y&&e.jsx("div",{className:"space-y-2",children:Fe?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading users..."})]}):ke.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(ae,{size:24,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No users available for testing"})]}):ke.map(s=>{var u;return e.jsxs("button",{onClick:()=>Bt(s.id),className:`w-full flex items-center justify-between gap-3 px-3 py-2 rounded-lg transition-colors ${l?"hover:bg-slate-700/60 text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white font-bold",children:(s.full_name||s.email||"U").charAt(0).toUpperCase()})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:s.full_name||s.email}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:((u=s.role)==null?void 0:u.replace("-"," "))||"user"})]})]}),e.jsx(De,{size:16,className:"text-gray-400"})]},s.id)})}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:y?'Click "Stop Testing" to return to admin account':"Select a user to test the system from their perspective"})})]})})]})]})]})}),e.jsxs("div",{className:`md:hidden px-4 py-3 ${l?"bg-slate-900/40":"bg-white/20"} backdrop-blur-sm ${l?"border-slate-700/50":"border-white/20"} border-b`,children:[e.jsxs("div",{className:"flex items-center gap-3 justify-end",children:[e.jsx("button",{onClick:()=>_(),className:`p-2.5 rounded-lg transition-all duration-200 ${l?"bg-slate-800/60 hover:bg-slate-700/60 text-gray-300 border border-slate-700":"bg-white/60 hover:bg-white/80 text-gray-700 border border-gray-200"} cursor-pointer backdrop-blur-sm shadow-sm hover:shadow-md`,title:"Search",children:e.jsx(Ee,{size:20})}),e.jsx("button",{onClick:()=>O(!oe),className:"p-2.5 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",children:e.jsx(pe,{size:20})})]}),oe&&e.jsx("div",{className:`mt-3 p-4 ${l?"bg-slate-900/95 border-slate-700/60":"bg-white/95 border-gray-200/60"} rounded-xl shadow-xl border backdrop-blur-xl`,children:e.jsx("div",{className:"space-y-3",children:Me.length===0?e.jsx("div",{className:`w-full px-4 py-6 rounded-xl border text-center ${l?"bg-slate-800/70 border-slate-700 text-gray-300":"bg-gray-50 border-gray-200 text-gray-600"}`,children:e.jsx("p",{className:"text-sm font-medium",children:"No quick create actions available"})}):Me.map(s=>{const u=s.icon;return e.jsxs("button",{onClick:s.action,className:`w-full flex items-center justify-between gap-3 px-4 py-3 rounded-xl bg-gradient-to-r ${s.gradient} ${s.hover} text-white transition-all duration-200 shadow-sm hover:shadow-lg hover:-translate-y-0.5`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{size:20,className:"shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold leading-tight",children:s.label}),e.jsx("p",{className:"text-xs text-white/80 leading-tight",children:s.description})]})]}),e.jsx(De,{size:18,className:"opacity-80"})]},s.key)})})})]}),e.jsx(ks,{isOpen:z,onClose:()=>P(!1),onSuccess:()=>{console.log("Expense recorded successfully")}}),e.jsx(Qs,{isOpen:g,onClose:()=>h(!1),onSuccess:()=>{console.log("Reminder created successfully")}}),e.jsx(Cs,{isOpen:C,onClose:()=>k(!1),onProductCreated:()=>{k(!1),console.log("Product created successfully")}}),e.jsx(Vs,{isOpen:B,onClose:()=>$(!1),onSuccess:()=>{D.success("Stock transfer queued successfully"),$(!1)}}),e.jsx($s,{isOpen:T,onClose:()=>L(!1),onSupplierCreated:()=>{D.success("Supplier added successfully"),L(!1)}}),e.jsx(Hs,{isOpen:m,onClose:()=>i(!1),onImportComplete:s=>{const u=(s==null?void 0:s.imported)??0;D.success(`Imported ${u} customers`),i(!1)}}),e.jsx(Ms,{isOpen:v,onClose:()=>p(!1),onSave:qt,mode:"create"}),e.jsx(Ds,{isOpen:S,onClose:()=>A(!1),amount:F.amount,description:F.description,onPaymentComplete:async()=>{D.success("Payment recorded successfully"),A(!1)},title:"Quick Payment Entry",allowPriceEdit:!0,paymentType:"cash_in"}),e.jsx(Js,{isOpen:E,onClose:()=>d(!1)}),R&&e.jsx(As,{isOpen:R,onClose:()=>q(!1),onSuccess:()=>{D.success("Employees imported successfully"),q(!1)}}),Z&&e.jsx(Es,{isOpen:Z,onClose:()=>X(!1),onTransferComplete:()=>{D.success("Transfer completed successfully"),X(!1)}}),de&&e.jsx(Is,{isOpen:de,onClose:()=>ee(!1),onSuccess:s=>{const u=(s==null?void 0:s.sent)||0,j=(s==null?void 0:s.failed)||0;D.success(`SMS campaign completed: ${u} sent${j?`, ${j} failed`:""}`),ee(!1)}}),e.jsx(Ps,{isOpen:Ne,onClose:()=>U(!1),reportType:Le,onSuccess:()=>{D.success("Report submitted successfully!"),U(!1)}}),e.jsx(Ts,{isOpen:G,onClose:()=>te(!1)})]})]})},Vs=({isOpen:t,onClose:n,onSuccess:a})=>{const[r,x]=o.useState([]),[y,w]=o.useState(!1),[c,N]=o.useState(""),[l,_]=o.useState(""),[z,P]=o.useState(1),[g,h]=o.useState(""),[C,k]=o.useState(!1),[B,$]=o.useState(null),[T,L]=o.useState(null),m=typeof window<"u"&&localStorage.getItem("current_branch_id")||"",i=o.useCallback(async()=>{if(m){w(!0);try{const{data:p,error:S}=await J.from("store_locations").select("id, name, city").eq("is_active",!0).neq("id",m).order("name");if(S)throw S;x(p||[])}catch(p){console.error("Failed to load branches:",p),D.error("Failed to load destination branches")}finally{w(!1)}}},[m]);o.useEffect(()=>{t&&($(null),_(""),P(1),h(""),L(null),i())},[t,i]);const v=async p=>{var S;if(p.preventDefault(),!m){$("Please set your current branch before creating transfers."),D.error("Select an active branch to continue");return}if(!c){$("Select the destination branch.");return}if(!l.trim()){$("Enter the product SKU to transfer.");return}if(!Number.isFinite(z)||z<=0){$("Quantity must be greater than zero.");return}k(!0),$(null);try{const{data:A,error:E}=await J.from("lats_product_variants").select(`
            id,
            sku,
            quantity,
            variant_name,
            product:lats_products(name)
          `).eq("branch_id",m).eq("sku",l.trim()).single();if(E||!A)throw new Error("No stock found for that SKU in the current branch.");if((A.quantity||0)<z)throw new Error("Quantity exceeds available stock.");await _s({from_branch_id:m,to_branch_id:c,entity_type:"variant",entity_id:A.id,quantity:z,notes:g||void 0}),L({name:((S=A.product)==null?void 0:S.name)||A.variant_name||A.sku,quantity:A.quantity||0}),_(""),P(1),h(""),a?a():n()}catch(A){console.error("Quick stock transfer error:",A);const E=A instanceof Error?A.message:"Failed to create stock transfer.";$(E),D.error(E)}finally{k(!1)}};return e.jsx(Te,{isOpen:t,onClose:n,title:"Quick Stock Transfer",maxWidth:"md",children:m?e.jsxs("form",{className:"space-y-4",onSubmit:v,children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"From Branch"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-700",children:m}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Current active branch (change via branch selector if needed)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Destination Branch"}),e.jsxs("select",{value:c,onChange:p=>N(p.target.value),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20",disabled:y,children:[e.jsx("option",{value:"",children:"Select branch"}),r.map(p=>e.jsxs("option",{value:p.id,children:[p.name,p.city?` ‚Ä¢ ${p.city}`:""]},p.id))]}),y&&e.jsx("p",{className:"mt-1 text-xs text-blue-500",children:"Loading branches‚Ä¶"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product SKU"}),e.jsx("input",{type:"text",value:l,onChange:p=>_(p.target.value),placeholder:"e.g. SKU-12345",className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",min:1,value:z,onChange:p=>P(Number(p.target.value)),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notes (optional)"}),e.jsx("textarea",{value:g,onChange:p=>h(p.target.value),rows:3,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20",placeholder:"Special instructions or tracking details"})]}),T&&e.jsxs("div",{className:"rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-700",children:[e.jsx("div",{className:"font-medium",children:T.name}),e.jsxs("div",{children:["Available stock: ",T.quantity]})]}),B&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-600",children:B}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,className:"rounded-lg border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100",disabled:C,children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-blue-400",disabled:C||y,children:C?"Transferring‚Ä¶":"Create Transfer"})]})]}):e.jsxs("div",{className:"space-y-3 text-gray-600",children:[e.jsx("p",{className:"text-sm",children:"Set your active branch to create a stock transfer. Use the branch selector in the top bar to choose your current branch."}),e.jsx("button",{type:"button",onClick:n,className:"inline-flex items-center justify-center rounded-lg border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100",children:"Close"})]})})},Js=({isOpen:t,onClose:n})=>{const[a,r]=o.useState(""),[x,y]=o.useState(""),[w,c]=o.useState(!1),[N,l]=o.useState(null);o.useEffect(()=>{t&&(r(""),y(""),l(null))},[t]);const _=async z=>{if(z.preventDefault(),!a.trim()){l("Enter recipient phone number.");return}if(!x.trim()){l("Enter an SMS message.");return}c(!0),l(null);try{const{smartNotificationService:P}=await St(()=>import("./smartNotificationService-2a2d3be1.js"),["assets/smartNotificationService-2a2d3be1.js","assets/supabase-cf010ec4.js","assets/whatsappService-09f99080.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/notificationSettingsService-1df2b297.js","assets/format-aff4c6a2.js","assets/formatPhoneForInvoice-e7084c6d.js"]),g=await P.sendNotification(a.trim(),x.trim());if(!g.success)throw new Error(g.error||"Failed to send message.");const h=g.method==="whatsapp"?"WhatsApp":"SMS";D.success(`${h} sent successfully`),n()}catch(P){console.error("Quick SMS error:",P);const g=P instanceof Error?P.message:"Failed to send SMS.";l(g),D.error(g)}finally{c(!1)}};return e.jsx(Te,{isOpen:t,onClose:n,title:"Quick SMS",maxWidth:"sm",children:e.jsxs("form",{className:"space-y-4",onSubmit:_,children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("input",{type:"tel",value:a,onChange:z=>r(z.target.value),placeholder:"+255...",className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/20"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Use international format with country code."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Message"}),e.jsx("textarea",{value:x,onChange:z=>y(z.target.value),rows:4,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/20",placeholder:"Write your SMS message..."}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Standard SMS length is 160 characters. Longer messages will be split automatically."})]}),N&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-600",children:N}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,className:"rounded-lg border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100",disabled:w,children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-indigo-700 disabled:cursor-not-allowed disabled:bg-indigo-400",disabled:w,children:w?"Sending‚Ä¶":"Send SMS"})]})]})})},Us=()=>{const t=Pe(),n=Ie();return o.useEffect(()=>{const a=r=>{if((r.ctrlKey||r.metaKey)&&r.shiftKey&&r.key.toLowerCase()==="o"){if(r.preventDefault(),r.stopPropagation(),n.pathname==="/lats/purchase-order/create"){D("You are already on the Purchase Order page",{icon:"üìã"});return}t("/lats/purchase-order/create"),D.success("Opening Purchase Order creation...",{icon:"üöÄ"})}};return document.addEventListener("keydown",a,!0),()=>{document.removeEventListener("keydown",a,!0)}},[t,n]),null},Ys=[{keys:["Ctrl","K"],description:"Open Global Search",action:"Search anywhere in the app"},{keys:["Ctrl","Shift","O"],description:"Create Purchase Order",action:"Quick access to PO creation"}],Zs=()=>{const[t,n]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>n(!0),className:"fixed bottom-6 right-6 z-40 w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-full shadow-2xl hover:shadow-blue-500/50 transition-all duration-300 flex items-center justify-center group",title:"Keyboard Shortcuts (Global)",children:[e.jsx(yt,{className:"w-6 h-6 group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-pulse"})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Global Keyboard Shortcuts"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Work faster from anywhere in the app"})]})]}),e.jsx("button",{onClick:()=>n(!1),className:"w-10 h-10 flex items-center justify-center bg-white/20 hover:bg-white/30 text-white rounded-full transition-colors",children:e.jsx(Ae,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"space-y-4",children:Ys.map((a,r)=>e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl border-2 border-blue-100 hover:border-blue-300 transition-all",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:a.description}),e.jsx("p",{className:"text-sm text-gray-600",children:a.action})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:a.keys.map((x,y)=>e.jsxs(lt.Fragment,{children:[y>0&&e.jsx("span",{className:"text-gray-400 text-sm mx-1",children:"+"}),e.jsx("kbd",{className:"px-3 py-2 bg-white border-2 border-gray-300 rounded-lg text-sm font-bold text-gray-700 shadow-md min-w-[50px] text-center",children:x})]},y))})]})},r))}),e.jsx("div",{className:"mt-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(we,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900 mb-1",children:"üí° Pro Tip"}),e.jsxs("p",{className:"text-sm text-green-800",children:["These shortcuts work from ",e.jsx("strong",{children:"anywhere"})," in the application. No need to navigate through menus - just press the keys!"]})]})]})}),e.jsx("div",{className:"mt-4 p-4 bg-amber-50 border-2 border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(yt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-amber-900 mb-1",children:"üìÑ Page-Specific Shortcuts"}),e.jsxs("p",{className:"text-sm text-amber-800",children:["Many pages have their own shortcuts too! Look for the ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-white border border-amber-300 rounded text-xs font-bold",children:"?"})," button or press ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-white border border-amber-300 rounded text-xs font-bold",children:"?"})," on the Purchase Order page for more shortcuts."]})]})]})})]}),e.jsx("div",{className:"p-6 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"More shortcuts coming soon! üöÄ"}),e.jsx("button",{onClick:()=>n(!1),className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Got it!"})]})})]})})]})};function Xs(){const[t,n]=o.useState(0);o.useEffect(()=>{a();const r=J.channel("whatsapp_unread_count").on("postgres_changes",{event:"*",schema:"public",table:"whatsapp_incoming_messages"},()=>{a()}).subscribe(),x=setInterval(a,6e4);return()=>{r.unsubscribe(),clearInterval(x)}},[]);async function a(){try{const{count:r,error:x}=await J.from("whatsapp_incoming_messages").select("*",{count:"exact",head:!0}).eq("is_read",!1);if(x){console.error("Error fetching unread count:",x);return}n(r||0)}catch(r){console.error("Error fetching unread count:",r)}}return t}const Nt=({count:t,className:n="",compact:a=!1})=>{const r=typeof t=="string"?parseInt(t,10):t;return r<=0||isNaN(r)?null:a?e.jsx("div",{className:"absolute -top-1 -right-1 z-10",children:e.jsx("span",{className:"bg-red-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center border border-white shadow",children:r>99?"99+":r})}):e.jsx("span",{className:`
      inline-flex items-center justify-center
      min-w-[20px] h-5 px-1.5
      text-xs font-bold text-white
      bg-red-500 rounded-full
      ${n}
    `,children:r>99?"99+":r})},Qr=()=>{var X,de,ee,Ne,U,me;const{currentUser:t,logout:n}=ce(),{isDark:a}=at(),r=Xs();let x=[],y=[];try{const b=kt();x=(b==null?void 0:b.devices)||[]}catch{x=[]}try{const b=ot();y=(b==null?void 0:b.customers)||[]}catch{y=[]}const{businessInfo:w}=ts(),[c,N]=o.useState(!1),[l,_]=o.useState(!0),[z,P]=o.useState(!1),[g,h]=o.useState(!1),[C,k]=o.useState(!1),[B,$]=o.useState(()=>{const b=localStorage.getItem("navReadItems");return b?new Set(JSON.parse(b)):new Set}),[T,L]=o.useState(!1),m=Pe(),i=Ie(),v=o.useRef(null);o.useEffect(()=>{const b=()=>{L(window.innerWidth<768)};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]);const p=i.pathname==="/pos",S=b=>{$(G=>{const te=new Set([...G,b]);return localStorage.setItem("navReadItems",JSON.stringify([...te])),te})};o.useEffect(()=>{i.pathname&&S(i.pathname)},[i.pathname]),o.useEffect(()=>{const b=G=>{v.current&&!v.current.contains(G.target)&&(h(!1),k(!1))};return g&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[g]);const E=(()=>{const b=new Date,G=new Date(b.getTime()-24*60*60*1e3),te=new Date(b.getTime()-7*24*60*60*1e3),ke=x.length,Re=x.filter(F=>F.status!=="done"&&F.status!=="failed").length,Fe=x.filter(F=>new Date(F.createdAt||F.updatedAt)>G).length,Se=x.filter(F=>F.status==="done"||F.status==="failed"||!F.expectedReturnDate?!1:new Date(F.expectedReturnDate)<b).length,Le=y.filter(F=>F.created_at?new Date(F.created_at)>te:!1).length,ue=y.filter(F=>F.isRead===!1||F.isRead===void 0).length;return{totalDevices:ke,activeDevices:Re,recentDevices:Fe,overdueDevices:Se,recentCustomers:Le,newCustomers:ue}})();o.useEffect(()=>{t||(localStorage.setItem("postLoginRedirect",i.pathname),m("/login"))},[t,i.pathname,m]);const d=()=>{n(),m("/login")};if(!t)return null;const R=(b,G)=>!G||G<=0||B.has(b)?0:G,Z=(()=>(t==null?void 0:t.role)==="technician"?[{path:"/dashboard",label:"Dashboard",icon:e.jsx(st,{size:20,strokeWidth:1.5}),roles:["technician"],count:E.activeDevices},{path:"/devices",label:"My Devices",icon:e.jsx(V,{size:20,strokeWidth:1.5}),roles:["technician"],count:E.activeDevices+E.overdueDevices},{path:"/lats/spare-parts",label:"Spare Parts",icon:e.jsx(K,{size:20,strokeWidth:1.5}),roles:["technician"],count:Math.floor(Math.random()*2)}]:[{path:"/dashboard",label:"Dashboard",icon:e.jsx(st,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:E.activeDevices},{path:"/pos",label:"POS System",icon:e.jsx(ve,{size:20,strokeWidth:1.5}),roles:["admin","customer-care"],count:0},{path:"/lats/trade-in/management",label:"Trade-in",icon:e.jsx(ps,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/devices",label:"Devices",icon:e.jsx(V,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:E.activeDevices+E.overdueDevices},{path:"/customers",label:"Customers",icon:e.jsx(H,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:E.newCustomers},{path:"/appointments",label:"Appointments",icon:e.jsx(se,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:0},{path:"/reminders",label:"Reminders",icon:e.jsx(je,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:0},{path:"/lats/unified-inventory",label:"Inventory",icon:e.jsx(K,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/lats/spare-parts",label:"Spare Parts",icon:e.jsx(bs,{size:20,strokeWidth:1.5}),roles:["admin","technician"],count:0},{path:"/lats/storage-rooms",label:"Storage Rooms",icon:e.jsx(tt,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/lats/stock-transfers",label:"Stock Transfers",icon:e.jsx(fe,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/lats/purchase-orders",label:"Purchase Orders",icon:e.jsx(wt,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/special-orders",label:"Special Orders",icon:e.jsx(ye,{size:20,strokeWidth:1.5}),roles:["admin","sales","manager","customer-care"],count:0},{path:"/installments",label:"Installment Plans",icon:e.jsx(Dt,{size:20,strokeWidth:1.5}),roles:["admin","sales","manager","customer-care"],count:0},{path:"/lats/sales-reports",label:"Sales Reports",icon:e.jsx(fs,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/admin/reports",label:"Employee Reports",icon:e.jsx(wt,{size:20,strokeWidth:1.5}),roles:["admin","manager"],count:0},{path:"/payments",label:"Payments",icon:e.jsx($t,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/lats/loyalty",label:"Loyalty Program",icon:e.jsx(ys,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/employees",label:"Employees",icon:e.jsx(Mt,{size:20,strokeWidth:1.5}),roles:["admin","manager"],count:0},{path:"/my-attendance",label:"My Attendance",icon:e.jsx(ie,{size:20,strokeWidth:1.5}),roles:["admin","manager","cashier","customer-care","technician","inventory-manager"],count:0},{path:"/sms",label:"SMS",icon:e.jsx(re,{size:20,strokeWidth:1.5}),roles:["admin","customer-care"],count:0},{path:"/whatsapp/inbox",label:"WhatsApp Inbox",icon:e.jsx(vs,{size:20,strokeWidth:1.5}),roles:["admin","customer-care"],count:r},{path:"/customer-portal/products",label:"Customer Portal",icon:e.jsx(ws,{size:20,strokeWidth:1.5}),roles:["admin"],count:0,badge:"üåê"},{path:"/admin/error-logs",label:"Error Logs",icon:e.jsx(Ct,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/test-png-generation",label:"PNG Test",icon:e.jsx(js,{size:20,strokeWidth:1.5}),roles:["admin"],count:0}].filter(G=>G.roles.includes(t.role)))();return p?e.jsx("div",{className:"min-h-screen",style:{backgroundColor:"transparent"},children:e.jsx("main",{className:"min-h-screen relative z-10 pt-0 pb-8",children:e.jsx(xt,{})})}):e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"transparent","--sidebar-width":T?"0px":l?"88px":"288px","--topbar-height":"64px"},children:[e.jsx(Ks,{onMenuToggle:()=>N(!c),isMenuOpen:c,isNavCollapsed:l}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-30 md:hidden",onClick:()=>N(!1)}),e.jsx("div",{className:`
          fixed top-0 bottom-0 left-0 z-40 w-64 md:w-72 
          ${a?"bg-slate-900/95":"bg-white/80"} backdrop-blur-xl 
          ${a?"border-slate-700/50":"border-white/30"} border-r shadow-xl
          transition-all duration-500 transform
          ${c?"translate-x-0":"-translate-x-full md:translate-x-0"} 
          ${l?"md:w-[5.5rem]":"md:w-72"}
          sidebar-hover sidebar-bg
        `,onMouseEnter:()=>{window.innerWidth>=768&&l&&_(!1)},onMouseLeave:()=>{window.innerWidth>=768&&!l&&_(!0)},children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:`
            p-6 ${a?"border-slate-700/50":"border-white/20"} border-b flex items-center 
            ${a?"bg-slate-900/40":"bg-white/20"}
            ${l?"justify-center":""}
          `,children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[w!=null&&w.logo?e.jsx("div",{className:"relative",children:e.jsx("div",{className:`rounded-full bg-white shadow-lg overflow-hidden flex items-center justify-center ${l?"w-10 h-10":"w-12 h-12"}`,children:e.jsx("img",{src:w.logo,alt:w.name||"Business Logo",className:"w-full h-full object-cover"})})}):e.jsx("div",{className:`p-2 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 text-white shadow-lg ${l?"w-10 h-10":""}`,children:e.jsx(V,{className:`h-6 w-6 ${l?"scale-90":""}`,strokeWidth:1.5})}),e.jsxs("div",{className:`transition-opacity duration-300 ${l?"md:hidden":""} min-w-0 flex-1`,children:[e.jsx("h1",{className:`font-bold text-xl truncate ${a?"text-white":"text-gray-900"}`,children:(w==null?void 0:w.name)||"inauzwa"}),(w==null?void 0:w.address)&&e.jsx("p",{className:`text-sm truncate ${a?"text-gray-400":"text-gray-600"}`,children:w.address})]})]})}),e.jsx("nav",{className:`flex-1 ${l?"p-2 scrollbar-hide":"p-4 sidebar-scrollbar"} overflow-y-auto`,children:e.jsx("ul",{className:"space-y-1",children:Z.map(b=>e.jsx("li",{children:e.jsxs("div",{className:"relative group",children:[e.jsxs(es,{to:b.path,className:`
                        flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-300
                        ${l?"justify-center":""}
                        ${i.pathname===b.path?a?"bg-gradient-to-r from-blue-600/20 to-indigo-600/20 text-blue-400 font-medium shadow-sm backdrop-blur-sm border border-blue-500/30":"bg-gradient-to-r from-blue-500/10 to-indigo-500/10 text-blue-700 font-medium shadow-sm backdrop-blur-sm border border-blue-200/30":a?"text-gray-300 hover:bg-slate-800/60 hover:text-white":"text-gray-700 hover:bg-white/40 hover:text-gray-900"}
                      `,onClick:()=>{N(!1),S(b.path)},children:[e.jsxs("span",{className:`
                      ${i.pathname===b.path?a?"text-blue-400":"text-blue-600":a?"text-gray-400":"text-blue-500"}
                      ${l?"w-8 h-8 flex items-center justify-center":""}
                      relative
                    `,children:[b.icon,R(b.path,b.count)>0&&l&&e.jsx(Nt,{count:R(b.path,b.count),compact:!0})]}),e.jsx("span",{className:`transition-opacity duration-300 ${l?"md:hidden":""} flex-1`,children:b.label}),R(b.path,b.count)>0&&!l&&e.jsx(Nt,{count:R(b.path,b.count),className:`${l?"md:hidden":""}`}),i.pathname===b.path&&e.jsx(hs,{size:16,strokeWidth:1.5,className:`
                          ml-auto ${a?"text-blue-400":"text-blue-500"}
                          ${l?"md:hidden":""}
                        `})]}),l&&e.jsxs("div",{className:`absolute left-full ml-2 top-1/2 transform -translate-y-1/2 px-3 py-2 
                        ${a?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} 
                        backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:[b.label,e.jsx("div",{className:`absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent 
                          ${a?"border-r-slate-800/95":"border-r-white/95"}`})]})]})},b.path))})}),e.jsxs("div",{className:`${l?"p-2":"p-4"} ${a?"border-slate-700/50":"border-white/20"} border-t relative`,ref:v,children:[e.jsxs("div",{className:`
              flex items-center gap-3 p-2 
              ${g&&!l?"rounded-b-lg":"rounded-lg"}
              ${a?"bg-gradient-to-br from-slate-800 to-slate-900":"bg-gradient-to-br from-gray-100 to-gray-50"}
              backdrop-blur-sm mb-4 
              ${l?"justify-center":""}
              transition-all duration-300
              ${g&&!l?"shadow-lg ring-2 "+(a?"ring-indigo-500/30 ring-t-0":"ring-indigo-500/20 ring-t-0"):""}
              cursor-pointer
            `,children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg",children:e.jsx(ae,{size:20,strokeWidth:1.5})}),e.jsxs("div",{className:`transition-opacity duration-300 ${l?"md:hidden":""} min-w-0 flex-1`,children:[e.jsx("p",{className:`font-medium truncate ${a?"text-white":"text-gray-900"}`,children:t.name}),e.jsxs("button",{onClick:b=>{b.preventDefault(),b.stopPropagation(),h(!g),k(!1)},onMouseEnter:()=>!g&&k(!0),onMouseLeave:()=>k(!1),className:`flex items-center gap-1 w-full text-left text-sm capitalize ${a?"text-gray-400 hover:text-gray-300":"text-gray-600 hover:text-gray-800"} cursor-pointer transition-colors`,children:[e.jsx("span",{className:"truncate",children:t.role.replace("-"," ")}),g?e.jsx(xs,{size:14}):e.jsx(nt,{size:14})]})]})]}),C&&!g&&!l&&e.jsx("div",{className:`
                  absolute bottom-full left-0 right-0 mb-2 mx-4
                  ${a?"bg-gradient-to-br from-slate-800/95 to-slate-900/95":"bg-gradient-to-br from-white/95 to-gray-50/95"}
                  backdrop-blur-xl rounded-lg shadow-xl border
                  ${a?"border-slate-700/50":"border-white/20"}
                  overflow-hidden
                  animate-in fade-in duration-150
                  p-3
                `,style:{zIndex:9999},onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:`text-xs ${a?"text-gray-400":"text-gray-600"}`,children:"Click to view menu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(vt,{size:14,className:a?"text-gray-500":"text-gray-400",strokeWidth:1.5}),(((X=t.permissions)==null?void 0:X.includes("all"))||((de=t.permissions)==null?void 0:de.includes("manage_users"))||t.role==="admin")&&e.jsx(H,{size:14,className:a?"text-gray-500":"text-gray-400",strokeWidth:1.5})]})]})}),g&&!l&&e.jsx("div",{className:`
                  absolute bottom-full left-0 right-0 mb-[-1rem] mx-4
                  ${a?"bg-gradient-to-br from-slate-800 to-slate-900":"bg-gradient-to-br from-gray-100 to-gray-50"}
                  backdrop-blur-sm rounded-t-lg
                  overflow-hidden
                  animate-in slide-in-from-bottom-2 fade-in duration-300
                  origin-bottom
                  ring-2 ring-b-0 ${a?"ring-indigo-500/30":"ring-indigo-500/20"}
                  shadow-lg
                `,style:{zIndex:9999,transformOrigin:"bottom center"},children:e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{m((t==null?void 0:t.role)==="admin"?"/admin-settings":"/settings"),h(!1)},className:`
                      w-full px-3 py-2.5 text-left text-sm rounded-lg
                      ${a?"text-gray-300 hover:bg-slate-700/70 hover:text-white":"text-gray-700 hover:bg-white/70 hover:text-gray-900"}
                      transition-all duration-200 flex items-center gap-3
                      group
                    `,children:[e.jsx("div",{className:`
                      p-1.5 rounded-md
                      ${a?"bg-slate-700/50 group-hover:bg-indigo-600":"bg-gray-200/50 group-hover:bg-indigo-600"}
                      transition-all duration-200
                    `,children:e.jsx(vt,{size:16,className:"group-hover:text-white",strokeWidth:2})}),e.jsx("span",{className:"font-medium",children:"Settings"})]}),(((ee=t.permissions)==null?void 0:ee.includes("all"))||((Ne=t.permissions)==null?void 0:Ne.includes("manage_users"))||t.role==="admin")&&e.jsxs("button",{onClick:()=>{m("/users"),h(!1)},className:`
                        w-full px-3 py-2.5 text-left text-sm rounded-lg
                        ${a?"text-gray-300 hover:bg-slate-700/70 hover:text-white":"text-gray-700 hover:bg-white/70 hover:text-gray-900"}
                        transition-all duration-200 flex items-center gap-3
                        group
                      `,children:[e.jsx("div",{className:`
                        p-1.5 rounded-md
                        ${a?"bg-slate-700/50 group-hover:bg-purple-600":"bg-gray-200/50 group-hover:bg-purple-600"}
                        transition-all duration-200
                      `,children:e.jsx(H,{size:16,className:"group-hover:text-white",strokeWidth:2})}),e.jsx("span",{className:"font-medium",children:"User Management"})]})]})}),e.jsxs(Y,{onClick:d,variant:"danger",className:`w-full ${l?"justify-center px-0":"justify-start"}`,children:[e.jsx(gs,{size:18,strokeWidth:1.5}),e.jsx("span",{className:`transition-opacity duration-300 ${l?"md:hidden":""}`,children:"Logout"})]})]})]})}),e.jsxs("main",{className:`transition-all duration-500 min-h-screen relative z-10 pt-[140px] pb-8 ${l?"md:ml-[5.5rem]":"md:ml-72"}`,children:[e.jsx(Xt,{children:e.jsx(xt,{})}),(((U=t.permissions)==null?void 0:U.includes("all"))||((me=t.permissions)==null?void 0:me.includes("create_customers"))||t.role==="admin"||t.role==="customer-care")&&e.jsx(e.Fragment,{children:e.jsx(ss,{isOpen:z,onClose:()=>P(!1)})}),e.jsx(Ss,{}),e.jsx(Us,{}),e.jsx(Zs,{})]})]})};export{Qr as default};
