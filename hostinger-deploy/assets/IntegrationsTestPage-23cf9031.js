import{C as G,j as e,e as c,G as g,T,q as z}from"./index-61458a34.js";import{r as d}from"./vendor-36d2c7c1.js";import{z as r,R as h,aQ as f,e as L,S as C,y as M,f as O,d as B,aO as I,o as Q,M as U,aE as Z,aU as q,Z as W}from"./ui-28e30067.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";const V=()=>{const[m,k]=d.useState([]),[R,N]=d.useState(!0),[b,y]=d.useState(!1),[a,u]=d.useState([]);d.useState(null);const[j,A]=d.useState(""),[p,D]=d.useState("Test message from LATS POS");d.useState(""),d.useEffect(()=>{v()},[]);const v=async()=>{N(!0);try{const s=await G();k(s.filter(t=>t.is_enabled))}catch(s){console.error("Error loading integrations:",s),r.error("Failed to load integrations")}finally{N(!1)}},w=s=>{u(t=>[...t,{...s,timestamp:new Date}])},o=(s,t)=>{u(l=>{const n=[...l];return n[s]={...n[s],...t},n})},_=async()=>{if(!j){r.error("Please enter a phone number");return}const s=Date.now(),t=a.length;w({integration:"SMS",test:"Send Test SMS",status:"running"});try{if(!await T("SMS_GATEWAY"))throw new Error("SMS not configured");const n=await z.sendSMS(j,p),i=Date.now()-s;n.success?(o(t,{status:"passed",message:`SMS sent successfully in ${i}ms`,duration:i}),r.success("SMS test passed!")):(o(t,{status:"failed",message:n.error||"Unknown error",duration:i}),r.error("SMS test failed"))}catch(l){const n=Date.now()-s;o(t,{status:"failed",message:l.message,duration:n}),r.error("SMS test error: "+l.message)}},S=async s=>{const t=Date.now(),l=a.length;w({integration:s,test:"Fetch Credentials",status:"running"});try{const n=await T(s),i=Date.now()-t;n?(o(l,{status:"passed",message:`Credentials fetched successfully (${Object.keys(n).length} fields) in ${i}ms`,duration:i}),r.success(`${s} credentials loaded!`)):(o(l,{status:"failed",message:"Integration not found or not enabled",duration:i}),r.warning(`${s} not configured`))}catch(n){const i=Date.now()-t;o(l,{status:"failed",message:n.message,duration:i}),r.error("Credentials fetch error")}},E=async()=>{y(!0),u([]);for(const s of m)await S(s.integration_name),await new Promise(t=>setTimeout(t,500));y(!1),r.success("All tests completed!")},P=()=>{u([]),r.success("Results cleared")},$=s=>{switch(s){case"passed":return e.jsx(B,{className:"w-5 h-5 text-green-600"});case"failed":return e.jsx(O,{className:"w-5 h-5 text-red-600"});case"running":return e.jsx(h,{className:"w-5 h-5 text-blue-600 animate-spin"});default:return e.jsx(M,{className:"w-5 h-5 text-gray-400"})}},F=s=>{const l={sms:C,whatsapp:Q,email:U,payment:Z,analytics:q,ai:W,custom:I}[s.integration_type]||I;return e.jsx(l,{className:"w-5 h-5 text-blue-600"})},x={total:a.length,passed:a.filter(s=>s.status==="passed").length,failed:a.filter(s=>s.status==="failed").length,running:a.filter(s=>s.status==="running").length,avgDuration:a.length>0?Math.round(a.reduce((s,t)=>s+(t.duration||0),0)/a.length):0};return R?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(h,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(f,{className:"w-8 h-8 text-blue-600"}),"Integrations Testing Center"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Test all your integrations to ensure they're working correctly"})]}),a.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Tests"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.total})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Passed"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.passed})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Failed"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.failed})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Running"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.running})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Avg Duration"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[x.avgDuration,"ms"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Enabled Integrations (",m.length,")"]}),e.jsxs(g,{onClick:v,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"Refresh"]})]}),m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"No enabled integrations found"}),e.jsx("p",{className:"text-sm mt-2",children:"Go to Admin Settings â†’ Integrations to enable some"})]}):e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[F(s),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.provider_name||s.integration_name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.integration_type,s.is_test_mode&&e.jsx("span",{className:"ml-2 text-xs text-orange-600 font-medium",children:"Test Mode"})]})]})]}),e.jsxs(g,{onClick:()=>S(s.integration_name),variant:"outline",size:"sm",className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-4 h-4"}),"Test"]})]},s.id))})]}),e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{onClick:E,disabled:b||m.length===0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white flex items-center justify-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-5 h-5 animate-spin"}),"Testing All..."]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-5 h-5"}),"Test All Integrations"]})}),e.jsxs(g,{onClick:P,variant:"outline",className:"w-full flex items-center justify-center gap-2",disabled:a.length===0,children:[e.jsx(h,{className:"w-5 h-5"}),"Clear Results"]})]})]}),e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Manual Tests"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Phone Number"}),e.jsx("input",{type:"tel",value:j,onChange:s=>A(s.target.value),placeholder:"e.g., +255712345678",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Message"}),e.jsx("textarea",{value:p,onChange:s=>D(s.target.value),rows:3,placeholder:"Enter test message",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(g,{onClick:_,disabled:!j||!p,className:"flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(C,{className:"w-4 h-4"}),"Test SMS"]})})]})]})]}),e.jsx("div",{children:e.jsxs(c,{className:"p-6 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Test Results"}),a.length>0&&e.jsxs("span",{className:"text-sm text-gray-600",children:[a.length," test",a.length!==1?"s":""]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(f,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"No tests run yet"}),e.jsx("p",{className:"text-sm mt-2",children:'Click "Test All" or test individual integrations'})]}):e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:a.map((s,t)=>e.jsxs("div",{className:`p-4 border-2 rounded-lg transition-all ${s.status==="passed"?"border-green-200 bg-green-50":s.status==="failed"?"border-red-200 bg-red-50":s.status==="running"?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[$(s.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s.integration}),e.jsx("div",{className:"text-sm text-gray-600",children:s.test})]})]}),s.duration&&e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),s.duration,"ms"]})]}),s.message&&e.jsx("div",{className:`text-sm mt-2 p-2 rounded ${s.status==="passed"?"bg-green-100 text-green-800":s.status==="failed"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s.message}),s.timestamp&&e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:s.timestamp.toLocaleTimeString()})]},t))})]})})]})]})};export{V as default};
