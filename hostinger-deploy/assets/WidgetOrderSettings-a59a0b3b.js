import{u as B,j as e}from"./index-61458a34.js";import{r as h}from"./vendor-36d2c7c1.js";import{u as J,b as H,g as b,l as V,s as q}from"./useSmartGridLayout-0626d484.js";import{cF as K,G as Q,b0 as X,z as x}from"./ui-28e30067.js";const Y={revenueTrendChart:"Revenue Trend",deviceStatusChart:"Device Status",appointmentsTrendChart:"Appointments Trend",purchaseOrderChart:"Purchase Orders",paymentMethodsChart:"Payment Methods",analyticsWidget:"Analytics",salesByCategoryChart:"Sales by Category",profitMarginChart:"Profit Margin",performanceMetricsChart:"Performance Metrics",customerActivityChart:"Customer Activity",appointmentWidget:"Appointments",employeeWidget:"Employees",notificationWidget:"Notifications",financialWidget:"Financial",salesFunnelChart:"Sales Funnel",customerInsightsWidget:"Customer Insights",systemHealthWidget:"System Health",inventoryWidget:"Inventory",activityFeedWidget:"Activity Feed",purchaseOrderWidget:"Purchase Order",chatWidget:"Chat",salesWidget:"Sales",topProductsWidget:"Top Products",expensesWidget:"Expenses",staffPerformanceWidget:"Staff Performance",stockLevelChart:"Stock Level",serviceWidget:"Service",reminderWidget:"Reminders"},g=["purchaseOrderChart","revenueTrendChart","deviceStatusChart","appointmentWidget","paymentMethodsChart","analyticsWidget","salesByCategoryChart","profitMarginChart","performanceMetricsChart","customerActivityChart","appointmentWidget","employeeWidget","notificationWidget","financialWidget","salesFunnelChart","customerInsightsWidget","inventoryWidget","activityFeedWidget","purchaseOrderWidget","chatWidget","salesWidget","topProductsWidget","expensesWidget","staffPerformanceWidget"],re=({className:N=""})=>{const{currentUser:t}=B(),{autoArrangeWidgets:A}=J();H();const[F,f]=h.useState([]),[w,m]=h.useState(null),[R,p]=h.useState(null),[S,O]=h.useState(!1),[k,C]=h.useState(!0),i=h.useRef([]);h.useEffect(()=>{(async()=>{if(t!=null&&t.id)try{C(!0);const r=b(t.role),d=g.filter(a=>r[a]),o=localStorage.getItem("dashboard_widget_order");if(o)try{const n=JSON.parse(o).filter(l=>d.includes(l)),y=g.map(l=>(n.includes(l),l));f(y),i.current=n,console.log("ðŸ“‚ Loaded saved widget order:",n)}catch(a){console.error("Error parsing saved order:",a),f(g),i.current=d}else f(g),i.current=d}catch(r){console.error("Error loading widget order:",r),x.error("Failed to load widget order")}finally{C(!1)}})()},[t==null?void 0:t.id,t==null?void 0:t.role]);const D=s=>b((t==null?void 0:t.role)||"user")[s],L=(s,r)=>{if(!D(r)){s.preventDefault();return}m(r),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",r)},M=(s,r)=>{s.preventDefault(),s.dataTransfer.dropEffect="move",r&&w&&r!==w&&p(r)},_=(s,r)=>{s.preventDefault(),s.stopPropagation();const d=s.dataTransfer.getData("text/plain");if(!d||d===r){m(null),p(null);return}if(!D(r)){m(null),p(null);return}const o=[...i.current],a=o.indexOf(d),n=o.indexOf(r);if(a===-1||n===-1){m(null),p(null);return}o.splice(a,1),o.splice(n,0,d),i.current=o,m(null),p(null);const y=b((t==null?void 0:t.role)||"user");g.filter(u=>y[u]);const l=g.map(u=>(o.includes(u),u));f(l),x.success("Widget order updated! Click Save to apply.",{duration:2e3})},$=()=>{m(null),p(null)},I=async()=>{if(!(t!=null&&t.id)){x.error("User not authenticated");return}try{O(!0);const s=i.current.length>0?i.current:F;console.log("ðŸ’¾ Saving widget order:",s),localStorage.setItem("dashboard_widget_order",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("widgetOrderUpdated",{detail:{order:s}}));try{const d={...await V(t.id),widgetOrder:s};await q(t.id,d,"Widget Order")}catch{console.warn("Could not save to user settings, but saved to localStorage")}x.success("Widget order saved! Go back to dashboard to see changes.")}catch(s){console.error("Error saving widget order:",s),x.error("Failed to save widget order")}finally{O(!1)}},G=()=>{const s=b((t==null?void 0:t.role)||"user"),r=g.filter(d=>s[d]);f(r),i.current=r,localStorage.setItem("dashboard_widget_order",JSON.stringify(r)),window.dispatchEvent(new CustomEvent("widgetOrderUpdated",{detail:{order:r}})),x.success("Widget order reset to default. Check your dashboard!")};return k?e.jsx("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 p-6 ${N}`,children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading widget order..."})]})}):e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 p-6 ${N}`,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Widget Order"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This shows your currently enabled widgets arranged exactly like your dashboard. Widgets automatically expand to fill available space (no empty gaps). Each numbered position (#1, #2, #3...) matches your dashboard. Drag and drop to reorder - widgets will resize to fill space just like on your dashboard."})]}),e.jsx("div",{className:"mb-6",children:(()=>{const s=b((t==null?void 0:t.role)||"user"),r=g.filter(a=>s[a]),d=i.current.length>0?i.current.filter(a=>r.includes(a)):r,o=[];for(let a=0;a<d.length;a+=3)o.push(d.slice(a,a+3));return e.jsxs("div",{className:"space-y-4",children:[o.map((a,n)=>{const y=A(a);return e.jsx("div",{className:"dashboard-cards grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 w-full",style:{alignItems:"stretch"},children:y.widgets.map((l,u)=>{const{key:c,expanded:E,gridColumn:z}=l,P=n*3+u+1,W=w===c,j=R===c,T=parseInt(z.split(" ")[1]);return e.jsxs("div",{draggable:!0,onDragStart:v=>L(v,c),onDragOver:v=>M(v,c),onDrop:v=>_(v,c),onDragEnd:$,className:`
                            relative p-4 rounded-lg border-2 transition-all cursor-move min-h-[120px]
                            ${W?"opacity-50 border-indigo-400 bg-indigo-50":""}
                            ${j?"border-indigo-600 bg-indigo-50 scale-105":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}
                            ${!W&&!j?"hover:shadow-md":""}
                            ${T===2?"md:col-span-2":""}
                            ${T===3?"md:col-span-2 lg:col-span-3":""}
                          `,style:{height:"100%"},children:[e.jsxs("div",{className:"absolute top-2 left-2 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["#",P]}),E&&e.jsx("span",{className:"text-xs font-medium text-green-600 bg-green-100 px-1 rounded",children:"Auto-sized"})]}),W&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs font-medium text-indigo-600 bg-indigo-100 px-2 py-1 rounded",children:"Dragging..."})}),j&&!W&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs font-medium text-indigo-600 bg-indigo-100 px-2 py-1 rounded",children:"Drop here"})}),e.jsxs("div",{className:"pt-8 text-center h-full flex flex-col justify-center",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm mb-1",children:Y[c]||c}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Dashboard position #",P]}),E&&e.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Expanded to fill space"})]})]},c)})},`dashboard-row-${n}`)}),d.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-lg mb-2",children:"ðŸ“Š No widgets enabled"}),e.jsx("div",{className:"text-sm",children:"Enable widgets using the toggle section above"})]})]})})()}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:I,disabled:S,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Q,{className:"w-4 h-4"}),S?"Saving...":"Save Order"]}),e.jsxs("button",{onClick:G,disabled:S,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(X,{className:"w-4 h-4"}),"Reset to Default"]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Tip:"})," This grid shows only your enabled widgets in their current dashboard positions. Drag any widget to reorder - the layout will match your dashboard exactly."]})})]})};export{re as W};
