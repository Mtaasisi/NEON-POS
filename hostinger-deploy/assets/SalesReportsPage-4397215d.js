import{s as T,j as e,u as Le}from"./index-61458a34.js";import{r as y}from"./vendor-36d2c7c1.js";import{b7 as Re,a6 as Oe,D as Ae,X as Me,a3 as De,U as Ne,P as qe,M as Be,s as ze,aE as de,q as ke,O as Ke,n as J,av as we,R as We,bz as Ge,af as Ee,at as Ve,bn as He,d as be,y as Je,e as Ze,r as Qe}from"./ui-28e30067.js";import{r as Pe,D as Ye}from"./rbac-6ed8a520.js";import{u as Xe}from"./useBusinessInfo-62d31733.js";import{a as es}from"./routing-eb8c310c.js";import{R as ye,A as ss,C as _e,X as Se,Y as Ce,T as je,e as ts,f as as,g as rs,h as ls,B as $e,i as Ie}from"./charts-d592fbd1.js";import"./supabase-cf010ec4.js";const ns=({isOpen:i,onClose:$,saleId:p})=>{var ee,ae,se,B,H,re,he,le,ge;const[t,O]=y.useState(null),[S,ce]=y.useState(!1),[K,W]=y.useState(null),[C,G]=y.useState("Unknown");y.useEffect(()=>{if(i&&p){if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(p)){console.error("âŒ Invalid sale ID format:",p),W("Invalid sale ID format");return}Y()}},[i,p]);const Y=async()=>{var a,D,I,j;try{ce(!0),W(null),console.log("ðŸ” Fetching sale details for ID:",p);const{data:f,error:u}=await T.from("lats_sales").select("*").eq("id",p).single();if(u){console.error("âŒ Error fetching sale:",u),W(`Failed to load sale: ${u.message}`);return}if(console.log("âœ… Sale data loaded:",f),f.sold_by)try{const{data:o,error:g}=await T.from("users").select("full_name, email").eq("email",f.sold_by).single();if(!g&&o)G(o.full_name||o.email||f.sold_by);else{const U=f.sold_by.split("@")[0].replace(/[._]/g," ");G(U.charAt(0).toUpperCase()+U.slice(1))}}catch(o){console.warn("âš ï¸ Could not fetch cashier name:",o);const g=f.sold_by.split("@")[0].replace(/[._]/g," ");G(g.charAt(0).toUpperCase()+g.slice(1))}else if(f.created_by){const o=f.created_by.split("@")[0].replace(/[._]/g," ");G(o.charAt(0).toUpperCase()+o.slice(1))}let F=null;if(f.customer_id){const{data:o,error:g}=await T.from("customers").select("*").eq("id",f.customer_id).single();g?console.warn("âš ï¸ Customer data not found:",g):(F=o,console.log("âœ… Customer data loaded:",F))}const{data:E,error:M}=await T.from("lats_sale_items").select("*").eq("sale_id",p);if(M){console.error("âŒ Error fetching sale items:",M),W(`Failed to load sale items: ${M.message}`);return}console.log("âœ… Sale items loaded:",E);const A=(E==null?void 0:E.map(o=>o.product_id).filter(Boolean))||[],L=(E==null?void 0:E.map(o=>o.variant_id).filter(Boolean))||[];let q={},ne={},R={};if(A.length>0){const{data:o,error:g}=await T.from("lats_products").select("*").in("id",A);g?console.warn("âš ï¸ Products not found:",g):(q=o.reduce((U,s)=>(U[s.id]=s,U),{}),console.log("âœ… Products loaded:",q))}const pe=Object.values(q).map(o=>o.category_id).filter(Boolean);if(pe.length>0){const{data:o,error:g}=await T.from("lats_categories").select("*").in("id",pe);g?console.warn("âš ï¸ Categories not found:",g):(ne=o.reduce((U,s)=>(U[s.id]=s,U),{}),console.log("âœ… Categories loaded:",ne))}if(L.length>0){const{data:o,error:g}=await T.from("lats_product_variants").select("*").in("id",L);g?console.warn("âš ï¸ Variants not found:",g):(R=o.reduce((U,s)=>(U[s.id]=s,U),{}),console.log("âœ… Variants loaded:",R))}const{data:k,error:oe}=await T.from("sale_inventory_items").select("inventory_item_id, sale_id").eq("sale_id",p);let Z={};if(!oe&&k&&k.length>0){const o=k.map(s=>s.inventory_item_id),{data:g,error:U}=await T.from("inventory_items").select("*").in("id",o);!U&&g&&(g.forEach(s=>{const r=`${s.product_id}_${s.variant_id||"null"}`;Z[r]||(Z[r]=[]),Z[r].push(s)}),console.log("âœ… Serial numbers loaded:",Z))}const _={...f,customers:F,lats_sale_items:(E==null?void 0:E.map(o=>{var s,r,n;const g=`${o.product_id}_${o.variant_id||"null"}`,U=Z[g]||[];return{...o,serial_numbers:U,lats_products:o.product_id?{...q[o.product_id],lats_categories:(s=q[o.product_id])!=null&&s.category_id?ne[q[o.product_id].category_id]:null}:null,lats_product_variants:o.variant_id?{...R[o.variant_id],lats_products:R[o.variant_id]?{id:R[o.variant_id].product_id,name:(r=q[R[o.variant_id].product_id])==null?void 0:r.name,description:(n=q[R[o.variant_id].product_id])==null?void 0:n.description,sku:R[o.variant_id].sku,barcode:R[o.variant_id].barcode}:null}:null}}))||[]};if(!_.subtotal&&_.lats_sale_items&&(_.subtotal=_.lats_sale_items.reduce((o,g)=>o+(g.total_price||0),0),console.log("ðŸ”§ Calculated subtotal from items:",_.subtotal)),!_.discount&&_.subtotal&&_.total_amount){const o=_.subtotal-_.total_amount;o>0&&(_.discount=o,console.log("ðŸ”§ Calculated discount from difference:",o))}console.log("âœ… Combined sale data:",_),console.log("ðŸ” Financial data debug:",{subtotal:_.subtotal,discount:_.discount,total_amount:_.total_amount,customer_total_spent:(a=_.customers)==null?void 0:a.total_spent,customer_points:(D=_.customers)==null?void 0:D.points,customer_last_visit:(I=_.customers)==null?void 0:I.last_visit}),console.log("ðŸ” Sale items debug:",(j=_.lats_sale_items)==null?void 0:j.map(o=>{var g;return{product_name:(g=o.lats_products)==null?void 0:g.name,price:o.price,unit_price:o.unit_price,total_price:o.total_price,cost_price:o.cost_price}})),O(_)}catch(f){console.error("âŒ Unexpected error fetching sale details:",f),W(`Unexpected error: ${f instanceof Error?f.message:"Unknown error"}`)}finally{ce(!1)}},w=a=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),te=a=>new Date(a).toLocaleString("en-TZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),V=a=>{var D,I;if(!a)return"Unknown";if(typeof a=="string")try{const j=JSON.parse(a);if((D=j.details)!=null&&D.payments&&Array.isArray(j.details.payments)&&j.details.payments.length>1){const f=j.details.payments.map(F=>(F.method||F.paymentMethod||"Unknown").replace(/_/g," ").replace(/\b\w/g,M=>M.toUpperCase()));return`Multiple: ${[...new Set(f)].join(" + ")}`}return j.method||j.type||"Unknown"}catch{return a}if(typeof a=="object"){if((I=a.details)!=null&&I.payments&&Array.isArray(a.details.payments)&&a.details.payments.length>1){const j=a.details.payments.map(u=>(u.method||u.paymentMethod||"Unknown").replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase()));return`Multiple: ${[...new Set(j)].join(" + ")}`}return a.method||a.type||"Unknown"}return"Unknown"},X=a=>{var D,I;if(!a)return null;if(typeof a=="string")try{const j=JSON.parse(a);return(D=j.details)!=null&&D.payments&&Array.isArray(j.details.payments)&&j.details.payments.length>1?j.details.payments:null}catch{return null}return typeof a=="object"&&(I=a.details)!=null&&I.payments&&Array.isArray(a.details.payments)&&a.details.payments.length>1?a.details.payments:null},me=a=>{switch(a==null?void 0:a.toLowerCase()){case"completed":case"success":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},xe=()=>{window.print()},ue=()=>{J.success("Download functionality will be implemented")};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Re,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Sale Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:t?`Sale #${t.sale_number}`:"Loading..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:xe,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Print",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:ue,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Download",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("button",{onClick:$,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Me,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-80px)]",children:S?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading sale details..."})]}):K?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-lg mb-2",children:"âš ï¸"}),e.jsx("p",{className:"text-gray-600",children:K}),e.jsx("button",{onClick:Y,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Retry"})]})}):t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-blue-600"}),"Sale Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Sale Number"}),e.jsx("p",{className:"text-gray-900 font-mono",children:t.sale_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Status"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${me(t.status)}`,children:t.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Cashier"}),e.jsx("p",{className:"text-gray-900",children:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Date & Time"}),e.jsx("p",{className:"text-gray-900",children:te(t.created_at)})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-green-600"}),"Customer Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Name"}),e.jsx("p",{className:"text-gray-900",children:((ee=t.customers)==null?void 0:ee.name)||(t.customer_id?`Customer: ${t.customer_id.slice(0,8)}...`:"Walk-in Customer")}),((ae=t.customers)==null?void 0:ae.color_tag)&&e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full mt-1 ${t.customers.color_tag==="vip"?"bg-purple-100 text-purple-800":t.customers.color_tag==="new"?"bg-green-100 text-green-800":t.customers.color_tag==="complainer"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:t.customers.color_tag.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Phone"}),e.jsx("p",{className:"text-gray-900 flex items-center gap-2",children:(se=t.customers)!=null&&se.phone||t.customer_phone?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4"}),((B=t.customers)==null?void 0:B.phone)||t.customer_phone]}):"Not provided"}),((H=t.customers)==null?void 0:H.whatsapp)&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["WhatsApp: ",t.customers.whatsapp]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Email"}),e.jsx("p",{className:"text-gray-900 flex items-center gap-2",children:(re=t.customers)!=null&&re.email||t.customer_email?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-4 h-4"}),((he=t.customers)==null?void 0:he.email)||t.customer_email]}):"Not provided"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Location"}),e.jsx("p",{className:"text-gray-900 flex items-center gap-2",children:(le=t.customers)!=null&&le.city||t.customer_address?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-4 h-4"}),((ge=t.customers)==null?void 0:ge.city)||t.customer_address]}):"Not provided"})]}),t.customers&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Loyalty Level"}),e.jsx("p",{className:"text-gray-900",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.customers.loyalty_level==="platinum"?"bg-gray-100 text-gray-800":t.customers.loyalty_level==="gold"?"bg-yellow-100 text-yellow-800":t.customers.loyalty_level==="silver"?"bg-gray-100 text-gray-600":"bg-orange-100 text-orange-800"}`,children:t.customers.loyalty_level.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Spent"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:w(t.customers.total_spent)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Points"}),e.jsx("p",{className:"text-gray-900",children:t.customers.points.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Last Visit"}),e.jsx("p",{className:"text-gray-900",children:te(t.customers.last_visit)})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-purple-600"}),"Payment Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Payment Method(s)"}),e.jsx("p",{className:"text-gray-900",children:V(t.payment_method)}),X(t.payment_method)&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Payment Breakdown:"})]}),e.jsx("div",{className:"space-y-3",children:X(t.payment_method).map((a,D)=>e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"w-4 h-4 text-blue-600"})}),e.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:a.method?a.method.replace(/_/g," ").replace(/\b\w/g,I=>I.toUpperCase()):"Unknown Method"})]}),e.jsxs("div",{className:"space-y-1",children:[a.reference&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Reference:"})," ",a.reference]}),a.transactionId&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Transaction ID:"})," ",a.transactionId]}),a.timestamp&&e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Time:"})," ",new Date(a.timestamp).toLocaleString("en-TZ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xl font-bold text-green-600 mb-2",children:w(a.amount||a.value||0)}),a.status&&e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-semibold rounded-full ${a.status==="completed"||a.status==="success"?"bg-green-100 text-green-800":a.status==="pending"?"bg-yellow-100 text-yellow-800":a.status==="failed"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:a.status.toUpperCase()})]})]}),a.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:e.jsxs("p",{className:"text-sm text-gray-600 italic",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",a.notes]})})]},D))}),e.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-green-600"}),"Payment Summary"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Payments:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:w(X(t.payment_method).reduce((a,D)=>a+(D.amount||D.value||0),0))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Sale Total:"}),e.jsx("span",{className:"font-bold text-green-600 text-lg",children:w(t.subtotal&&t.discount?t.subtotal-t.discount:t.total_amount)})]}),Math.abs(X(t.payment_method).reduce((a,D)=>a+(D.amount||D.value||0),0)-t.total_amount)>.01&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-600",children:"âš ï¸"}),"Payment total doesn't match sale total"]})})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Amount"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:w(t.subtotal&&t.discount?t.subtotal-t.discount:t.total_amount)})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-green-600"}),"Financial Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-900",children:t.subtotal?w(t.subtotal):t.lats_sale_items?w(t.lats_sale_items.reduce((a,D)=>a+(D.total_price||0),0)):w(0)}),!t.subtotal&&t.lats_sale_items&&e.jsx("div",{className:"text-xs text-blue-600",children:"(calculated from items)"}),!t.subtotal&&!t.lats_sale_items&&e.jsx("div",{className:"text-xs text-red-600",children:"(no data available)"})]})]}),t.discount>0&&e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"Discount:"}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{children:["-",w(t.discount)]})})]})}),t.discount===0&&t.subtotal&&t.total_amount&&e.jsxs("div",{className:"text-xs text-gray-500",children:["No discount applied (subtotal: ",w(t.subtotal),", total: ",w(t.total_amount),")"]}),t.tax>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tax:"}),e.jsx("span",{className:"text-gray-900",children:w(t.tax)})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{className:"text-gray-900",children:"Total:"}),e.jsx("span",{className:"text-green-600",children:w(t.subtotal&&t.discount?t.subtotal-t.discount:t.total_amount)})]})})]})]})]})]}),t.lats_sale_items&&t.lats_sale_items.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-orange-600"}),"Sale Items (",t.lats_sale_items.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Product"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"SKU"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-600",children:"Qty"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"Unit Price"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"Total"}),t.lats_sale_items.some(a=>a.cost_price)&&e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"Profit"})]})}),e.jsx("tbody",{children:t.lats_sale_items.map((a,D)=>{var I,j,f,u,F,E,M;return e.jsxs("tr",{className:D%2===0?"bg-gray-50":"bg-white",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:((I=a.lats_products)==null?void 0:I.name)||a.product_name||`Product: ${a.product_id.slice(0,8)}...`}),((j=a.lats_products)==null?void 0:j.description)&&e.jsx("p",{className:"text-sm text-gray-500",children:a.lats_products.description}),((f=a.lats_product_variants)==null?void 0:f.name)&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Variant: ",a.lats_product_variants.name]}),((F=(u=a.lats_products)==null?void 0:u.lats_categories)==null?void 0:F.name)&&e.jsx("p",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full inline-block mt-1",children:a.lats_products.lats_categories.name}),a.notes&&e.jsxs("p",{className:"text-sm text-gray-500 italic",children:["Note: ",a.notes]}),a.serial_numbers&&a.serial_numbers.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:a.serial_numbers.map((A,L)=>e.jsx("div",{className:"flex items-start gap-2 text-xs bg-blue-50 border border-blue-200 rounded px-2 py-1",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-semibold text-blue-900",children:["S/N: ",A.serial_number]}),A.imei&&e.jsxs("span",{className:"ml-2 text-blue-700",children:["â€¢ IMEI: ",A.imei]}),A.mac_address&&e.jsxs("span",{className:"ml-2 text-blue-700",children:["â€¢ MAC: ",A.mac_address]}),A.location&&e.jsxs("span",{className:"ml-2 text-gray-600",children:["â€¢ From: ",A.location]})]})},L))})]})}),e.jsx("td",{className:"py-3 px-4 text-gray-600 font-mono text-sm",children:((E=a.lats_product_variants)==null?void 0:E.sku)||((M=a.lats_products)==null?void 0:M.sku)||a.sku||"N/A"}),e.jsx("td",{className:"py-3 px-4 text-center text-gray-900",children:a.quantity}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-900",children:w(a.price||a.unit_price||0)}),e.jsx("td",{className:"py-3 px-4 text-right font-medium text-gray-900",children:w(a.total_price)}),t.lats_sale_items.some(A=>A.cost_price)&&e.jsx("td",{className:"py-3 px-4 text-right",children:a.cost_price?e.jsx("span",{className:`font-medium ${a.total_price-a.cost_price*a.quantity>=0?"text-green-600":"text-red-600"}`,children:w(a.total_price-a.cost_price*a.quantity)}):e.jsx("span",{className:"text-gray-400",children:"N/A"})})]},a.id)})})]})})]}),(t.notes||t.metadata)&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-gray-600"}),"Additional Information"]}),t.notes&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notes"}),e.jsx("p",{className:"text-gray-900 mt-1",children:t.notes})]}),t.metadata&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Metadata"}),e.jsx("pre",{className:"text-sm text-gray-700 mt-1 bg-gray-50 p-3 rounded-lg overflow-x-auto",children:JSON.stringify(t.metadata,null,2)})]})]})]}):null})]})}):null};async function os(){try{return{connected:!0,message:"Database URL present"}}catch(i){return{connected:!1,message:(i==null?void 0:i.message)||"Unknown error"}}}const ie=i=>i?i.message?{message:i.message,code:i.code,details:i.details}:{message:String(i)}:{message:"Unknown error occurred"},is=i=>{var $;return(i==null?void 0:i.code)==="PGRST301"||(($=i==null?void 0:i.message)==null?void 0:$.includes("JWT"))},ds=i=>{var $,p;return(($=i==null?void 0:i.message)==null?void 0:$.includes("connection"))||((p=i==null?void 0:i.message)==null?void 0:p.includes("network"))},Ue=async(i,$)=>{try{const{data:p,error:t}=await i();if(t){if($)try{const O=await $();return O.error?{data:null,error:ie(O.error)}:{data:O.data,error:null}}catch(O){return{data:null,error:ie(O)}}return{data:null,error:ie(t)}}return{data:p,error:null}}catch(p){return{data:null,error:ie(p)}}},Fe={createLatsSalesListFallbackQuery:(i,$=100)=>i.from("lats_sales").select("*").order("created_at",{ascending:!1}).limit($),handleError:ie,isAuthError:is,isConnectionError:ds},bs=()=>{const{currentUser:i}=Le(),$=es(),{businessInfo:p}=Xe(),[t,O]=y.useState("1d"),[S,ce]=y.useState("daily"),[K,W]=y.useState({start:new Date().toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[C,G]=y.useState([]),[Y,w]=y.useState(!1),[te,V]=y.useState(null),[X,me]=y.useState({}),[xe,ue]=y.useState(null),[ee,ae]=y.useState(!1),[se,B]=y.useState(!1),[H,re]=y.useState(!1),[he,le]=y.useState(!1),[ge,a]=y.useState(!1),[D,I]=y.useState(null),j=s=>{var r,n;if(!s)return"Unknown";if(typeof s=="string")try{const l=JSON.parse(s);if(l.type==="multiple"&&((r=l.details)!=null&&r.payments)){const d=l.details.payments.map(c=>(c.method||c.paymentMethod||"Unknown").replace(/_/g," ").replace(/\b\w/g,b=>b.toUpperCase()));return[...new Set(d)].join(", ")}return l.method||l.type||"Unknown"}catch{return s}if(typeof s=="object"){if(s.type==="multiple"&&((n=s.details)!=null&&n.payments)){const l=s.details.payments.map(m=>(m.method||m.paymentMethod||"Unknown").replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase()));return[...new Set(l)].join(", ")}return s.method||s.type||"Unknown"}return"Unknown"};y.useEffect(()=>{const s=r=>{r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement||ee||(r.key==="Escape"&&$("/pos"),(r.ctrlKey||r.metaKey)&&r.key==="p"&&(r.preventDefault(),$("/pos")))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[$,ee]);const f=y.useMemo(()=>{if(!i)return!1;const s=i.permissions||[];return s.includes("all")||s.includes("view_financial_reports")||i.role==="admin"},[i]),u=y.useMemo(()=>{const s=new Date().toISOString().split("T")[0],r=S==="daily"&&t==="1d"?C.filter(b=>new Date(b.created_at).toISOString().split("T")[0]===s):C,n=r.reduce((b,h)=>{const x=parseFloat(h.total_amount)||0;return isNaN(x)||!isFinite(x)?(console.warn("Invalid sale amount:",h.total_amount,"for sale:",h.sale_number),b):b+x},0),l=r.length,d=new Set(r.map(b=>b.customer_id)).size,m=l>0?n/l:0;let c=0,v="0.0";return f&&(c=r.reduce((b,h)=>{var N;const x=((N=h.lats_sale_items)==null?void 0:N.reduce((P,z)=>P+(z.total_price-(z.cost_price||0)*z.quantity),0))||0;return b+x},0),v=n>0?(c/n*100).toFixed(1):"0.0"),{totalSales:n,totalTransactions:l,totalCustomers:d,averageOrder:m,totalProfit:c,profitMargin:v}},[C,f,S,t]),F=y.useMemo(()=>{const r=(()=>{switch(t){case"1d":return 1;case"7d":return 7;case"30d":return 30;case"90d":return 90;default:return 7}})(),n={},l=new Date;for(let h=r-1;h>=0;h--){const x=new Date(l);x.setDate(x.getDate()-h);const N=x.toISOString().split("T")[0],P=x.toLocaleDateString("en-US",{month:"short",day:"numeric"});n[N]={date:P,sales:0,count:0}}C.forEach(h=>{const x=new Date(h.created_at).toISOString().split("T")[0],N=parseFloat(h.total_amount)||0;!isNaN(N)&&isFinite(N)&&n[x]&&(n[x].sales+=N,n[x].count+=1)});const d=Object.values(n),m={};C.forEach(h=>{const x=j(h.payment_method),N=parseFloat(h.total_amount)||0;!isNaN(N)&&isFinite(N)&&(m[x]||(m[x]={name:x,value:0,count:0}),m[x].value+=N,m[x].count+=1)});const c={};C.forEach(h=>{const x=h.customer_name||"Walk-in",N=parseFloat(h.total_amount)||0;!isNaN(N)&&isFinite(N)&&(c[x]||(c[x]={name:x,value:0,orders:0}),c[x].value+=N,c[x].orders+=1)});const v=Object.values(c).sort((h,x)=>x.value-h.value).slice(0,5),b={};for(let h=r-1;h>=0;h--){const x=new Date(l);x.setDate(x.getDate()-h);const N=x.toISOString().split("T")[0],P=x.toLocaleDateString("en-US",{month:"short",day:"numeric"});b[N]={time:P,sales:0,transactions:0}}return C.forEach(h=>{const x=parseFloat(h.total_amount)||0;if(!isNaN(x)&&isFinite(x)){const N=new Date(h.created_at).toISOString().split("T")[0];b[N]&&(b[N].sales+=x,b[N].transactions+=1)}}),{daily:d,payments:Object.values(m),topCustomers:v,trend:Object.values(b)}},[C,t]),E=y.useMemo(()=>i?Pe.canUser(i,"reports","daily-close"):!1,[i]),M=y.useMemo(()=>{if(!i)return!1;const s=i.permissions||[];return s.includes("all")||s.includes("view_reports")||Pe.hasPermission(i.role,"reports","confirm-transactions")||i.role==="admin"},[i]),A=async s=>{if(s.length===0)return{};try{const{data:r,error:n}=await T.from("users").select("id, full_name, email").in("id",s);if(n)return console.error("Error fetching user names:",n),{};const l={};return r==null||r.forEach(d=>{l[d.id]=d.full_name||d.email||"Unknown User"}),l}catch(r){return console.error("Error in fetchUserNames:",r),{}}},L=async()=>{var s,r,n;try{w(!0),V(null);const l=typeof localStorage<"u"?localStorage.getItem("current_branch_id"):null;console.log("ðŸª Current Branch ID:",l);const d=new Date,m=new Date;if(t==="custom")m.setTime(new Date(K.start).getTime()),d.setTime(new Date(K.end).getTime()),d.setHours(23,59,59,999);else switch(t){case"1d":m.setDate(d.getDate()-1);break;case"7d":m.setDate(d.getDate()-7);break;case"30d":m.setDate(d.getDate()-30);break;case"90d":m.setDate(d.getDate()-90);break;default:m.setDate(d.getDate()-7)}console.log("ðŸ” Fetching sales for period:",t,"from",m.toISOString(),"to",d.toISOString());const c=T.from("lats_sales").select("*").order("created_at",{ascending:!1}).limit(200);let v;if(l?(console.log("ðŸ”’ TRYING BRANCH FILTER:",l),v=await Ue(()=>c.eq("branch_id",l),()=>(console.log("âš ï¸ Branch filter failed, loading all sales (branch_id column may not exist)"),Fe.createLatsSalesListFallbackQuery(T,200)))):(console.log("âš ï¸ NO BRANCH ID - LOADING ALL SALES"),v=await Ue(()=>c,()=>Fe.createLatsSalesListFallbackQuery(T,200))),v.data&&v.data.length>0){const P=v.data.map(ve=>ve.id),{data:z,error:Te}=await T.from("lats_sale_items").select("id, sale_id, quantity, total_price, cost_price").in("sale_id",P);if(Te)console.error("âŒ Error fetching sale items batch:",Te);else{const ve=(z||[]).reduce((Q,fe)=>(Q[fe.sale_id]||(Q[fe.sale_id]=[]),Q[fe.sale_id].push(fe),Q),{});v.data=v.data.map(Q=>({...Q,lats_sale_items:ve[Q.id]||[]}))}}if(v.error){console.error("âŒ Error fetching sales:",v.error);const P=((s=v.error)==null?void 0:s.message)||JSON.stringify(v.error);console.error("âŒ Error details:",P),V(`Failed to load sales data: ${P}`);return}const b=v.data;console.log(`âœ… Loaded ${(b==null?void 0:b.length)||0} total sales from database`),b&&b.length>0&&console.log("ðŸ” First sale items debug:",{sale_number:b[0].sale_number,has_items:!!b[0].lats_sale_items,items_count:((r=b[0].lats_sale_items)==null?void 0:r.length)||0,items_data:b[0].lats_sale_items});const h=(b||[]).filter(P=>{const z=new Date(P.created_at);return z>=m&&z<=d});console.log(`ðŸ“… Filtered to ${h.length} sales for period ${t}`),G(h);const N=[...new Set(h.map(P=>P.user_id).filter(Boolean))].filter(P=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(P));if(N.length>0){const P=await A(N);me(P)}}catch(l){console.error("âŒ Error fetching sales:",l),console.error("âŒ Error type:",typeof l),console.error("âŒ Error stringified:",JSON.stringify(l,null,2));const d=(l==null?void 0:l.message)||((n=l==null?void 0:l.error)==null?void 0:n.message)||(typeof l=="string"?l:"Unknown error occurred");V(`Failed to load sales data: ${d}`)}finally{w(!1)}};y.useEffect(()=>{os().then(s=>{console.log("ðŸ” Database test result:",s)}),L(),q()},[t,K]);const q=async()=>{try{const s=new Date().toISOString().split("T")[0];console.log("ðŸ” Checking daily closure status for date:",s);const{data:r,error:n}=await T.from("daily_sales_closures").select("id, date, closed_at, closed_by").eq("date",s).limit(1).maybeSingle();if(n){console.error("âŒ Error checking daily closure status:",n),B(!1);return}r?(console.log("âœ… Found daily closure record:",r),B(!0),I(r.closed_at)):(console.log("ðŸ“… No daily closure found for today"),B(!1))}catch(s){console.log("âŒ Error in checkDailyCloseStatus:",s),B(!1)}},ne=async()=>{try{re(!0);const r={date:new Date().toISOString().split("T")[0],total_sales:u.totalSales,total_transactions:u.totalTransactions,closed_at:new Date().toISOString(),closed_by:(i==null?void 0:i.role)||"customer_care",closed_by_user_id:i==null?void 0:i.id,sales_data:C},{error:n}=await T.from("daily_sales_closures").upsert(r,{onConflict:"date",ignoreDuplicates:!1});n&&console.error("Error closing daily sales (table may not exist):",n),B(!0),I(new Date().toISOString()),le(!1),J.success("Daily sales closed successfully! ðŸŽ‰"),R()}catch(s){console.error("Error closing daily sales:",s),J.error("Failed to close daily sales. Please try again.")}finally{re(!1)}},R=()=>{const s=new Date().toISOString().split("T")[0],n=[["Daily Sales Report",s],["Generated At",new Date().toLocaleString()],["Total Sales",u.totalSales],["Total Transactions",u.totalTransactions],["Total Customers",u.totalCustomers],["Average Order",u.averageOrder],...f?[["Profit Margin",u.profitMargin+"%"],["Total Profit",u.totalProfit]]:[],[""],["Transaction Details"],["Sale Number","Customer","Amount","Payment Method","Time","Status"],...C.map(c=>[c.sale_number,c.customer_name||"Walk-in",c.total_amount,j(c.payment_method),oe(c.created_at),c.status])].map(c=>c.join(",")).join(`
`),l=new Blob([n],{type:"text/csv"}),d=window.URL.createObjectURL(l),m=document.createElement("a");m.href=d,m.download=`daily-sales-report-${s}.csv`,m.click(),window.URL.revokeObjectURL(d),J.success("Daily report exported successfully! ðŸ“Š")},pe=()=>{const s=new Date().toISOString().split("T")[0],r=window.open("","_blank");if(!r){J.error("Please allow popups to print reports");return}const n=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Daily Sales Report - ${s}</title>
          <style>
            body {
              font-family: Arial, sans-serif;
              margin: 20px;
              padding: 0;
            }
            .header {
              text-align: center;
              margin-bottom: 30px;
              border-bottom: 2px solid #333;
              padding-bottom: 20px;
            }
            .logo {
              height: 60px;
              width: auto;
              margin: 0 auto 10px;
              display: block;
            }
            .business-name {
              font-size: 24px;
              font-weight: bold;
              margin: 10px 0;
            }
            .business-details {
              font-size: 12px;
              color: #666;
            }
            .report-title {
              font-size: 20px;
              font-weight: bold;
              margin: 20px 0;
            }
            .summary {
              display: grid;
              grid-template-columns: repeat(3, 1fr);
              gap: 20px;
              margin: 30px 0;
            }
            .summary-card {
              border: 1px solid #ddd;
              padding: 15px;
              border-radius: 5px;
              background: #f9f9f9;
            }
            .summary-card h3 {
              margin: 0 0 10px 0;
              font-size: 14px;
              color: #666;
            }
            .summary-card .value {
              font-size: 24px;
              font-weight: bold;
              color: #333;
            }
            table {
              width: 100%;
              border-collapse: collapse;
              margin-top: 20px;
            }
            th, td {
              border: 1px solid #ddd;
              padding: 10px;
              text-align: left;
            }
            th {
              background-color: #f2f2f2;
              font-weight: bold;
            }
            .footer {
              margin-top: 40px;
              text-align: center;
              font-size: 12px;
              color: #666;
              border-top: 1px solid #ddd;
              padding-top: 20px;
            }
            @media print {
              body { margin: 0; }
              .no-print { display: none; }
            }
          </style>
        </head>
        <body>
          <div class="header">
            ${p.logo?`<img src="${p.logo}" alt="${p.name}" class="logo" />`:""}
            <div class="business-name">${p.name}</div>
            <div class="business-details">
              ${p.address?`${p.address}<br>`:""}
              ${p.phone?`Tel: ${p.phone}<br>`:""}
              ${p.email?`Email: ${p.email}`:""}
            </div>
          </div>

          <div class="report-title">Daily Sales Report</div>
          <div style="font-size: 14px; color: #666; margin-bottom: 20px;">
            Date: ${s} | Generated: ${new Date().toLocaleString()}
          </div>

          <div class="summary">
            <div class="summary-card">
              <h3>Total Sales</h3>
              <div class="value">${k(u.totalSales)}</div>
            </div>
            <div class="summary-card">
              <h3>Transactions</h3>
              <div class="value">${u.totalTransactions}</div>
            </div>
            <div class="summary-card">
              <h3>Average Order</h3>
              <div class="value">${k(u.averageOrder)}</div>
            </div>
            ${f?`
            <div class="summary-card">
              <h3>Total Profit</h3>
              <div class="value">${k(u.totalProfit)}</div>
            </div>
            <div class="summary-card">
              <h3>Profit Margin</h3>
              <div class="value">${u.profitMargin}%</div>
            </div>
            `:""}
            <div class="summary-card">
              <h3>Total Customers</h3>
              <div class="value">${u.totalCustomers}</div>
            </div>
          </div>

          <h3>Transaction Details</h3>
          <table>
            <thead>
              <tr>
                <th>Sale Number</th>
                <th>Customer</th>
                <th>Amount</th>
                <th>Payment Method</th>
                <th>Time</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              ${C.map(l=>`
                <tr>
                  <td>${l.sale_number}</td>
                  <td>${l.customer_name||"Walk-in"}</td>
                  <td>${k(l.total_amount)}</td>
                  <td>${j(l.payment_method)}</td>
                  <td>${oe(l.created_at)}</td>
                  <td>${l.status}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>

          <div class="footer">
            <p>This report was generated by ${p.name}</p>
            <p>${p.website?`Visit us at: ${p.website}`:""}</p>
          </div>

          <script>
            window.onload = function() {
              window.print();
            };
          <\/script>
        </body>
      </html>
    `;r.document.write(n),r.document.close()},k=s=>{const r=parseFloat(String(s))||0;return isNaN(r)||!isFinite(r)?(console.warn("Invalid amount for formatting:",s),"TSh 0"):new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)},oe=s=>new Date(s).toLocaleDateString("en-TZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=s=>{console.log("ðŸ” Opening sale details for:",s.id),ue(s),ae(!0)},_=async(s,r)=>{r.stopPropagation();try{const{error:n}=await T.from("lats_sales").update({status:"confirmed"}).eq("id",s);if(n){console.error("Error confirming transaction:",n),J.error("Failed to confirm transaction");return}J.success("Transaction confirmed successfully! âœ…"),L()}catch(n){console.error("Error confirming transaction:",n),J.error("Failed to confirm transaction")}},o=async()=>{try{w(!0),V(null);const s=typeof localStorage<"u"?localStorage.getItem("current_branch_id"):null;console.log("ðŸ” Fetching all sales for branch:",s);let r=T.from("lats_sales").select(`
          id,
          sale_number,
          customer_id,
          customer_name,
          total_amount,
          payment_method,
          status,
          user_id,
          sold_by,
          created_at,
          branch_id
        `).order("created_at",{ascending:!1}).limit(100);s?(console.log("ðŸ”’ APPLYING BRANCH FILTER:",s),r=r.eq("branch_id",s)):console.log("âš ï¸ NO BRANCH FILTER - SHOWING ALL SALES");const{data:n,error:l}=await r;if(!l&&n&&n.length>0){const c=await Promise.all(n.map(async v=>{const{data:b}=await T.from("lats_sale_items").select("id, quantity, total_price, cost_price").eq("sale_id",v.id);return{...v,lats_sale_items:b||[]}}));G(c),w(!1);return}if(l){console.error("âŒ Error fetching all sales:",l),V(`Failed to load sales data: ${l.message}`);return}console.log(`âœ… Loaded ${(n==null?void 0:n.length)||0} sales (all time)`),G(n||[]);const m=[...new Set((n||[]).map(c=>c.user_id).filter(Boolean))].filter(c=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(c));if(m.length>0){const c=await A(m);me(c)}}catch(s){console.error("âŒ Unexpected error fetching all sales:",s),V(`Unexpected error: ${s instanceof Error?s.message:"Unknown error"}`)}finally{w(!1)}},g=(s,r,n,l="blue")=>{const d=Math.max(...s.map(m=>m[n]));return e.jsx("div",{className:"space-y-2",children:s.map((m,c)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-24 text-sm text-gray-600 truncate",children:m[r]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`bg-${l}-500 h-3 rounded-full transition-all duration-300`,style:{width:`${m[n]/d*100}%`}})}),e.jsx("div",{className:"w-20 text-sm font-medium text-gray-900 text-right",children:k(m[n])})]},c))})},U=()=>{switch(S){case"products":const s={};return C.forEach(l=>{var d;(d=l.lats_sale_items)==null||d.forEach(m=>{const c=m.product_id;c&&(s[c]||(s[c]={name:`Product ${c.slice(0,8)}...`,total:0,quantity:0}),s[c].total+=m.total_price||0,s[c].quantity+=m.quantity||0)})}),Object.values(s).sort((l,d)=>d.total-l.total);case"customers":const r={};return C.forEach(l=>{const d=l.customer_id||"walk-in";r[d]||(r[d]={name:d==="walk-in"?"Walk-in Customers":l.customer_name||`Customer ${d.slice(0,8)}...`,total:0,orders:0});const m=parseFloat(String(l.total_amount))||0;r[d].total+=m,r[d].orders+=1}),Object.values(r).sort((l,d)=>d.total-l.total);case"payments":const n={};return C.forEach(l=>{const d=j(l.payment_method);n[d]||(n[d]={name:d,total:0,count:0});const m=parseFloat(String(l.total_amount))||0;n[d].total+=m,n[d].count+=1}),Object.values(n).sort((l,d)=>d.total-l.total);default:return[]}};return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"transparent"},children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Sales Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor and manage daily sales performance"})]}),e.jsxs("button",{onClick:()=>$("/pos"),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-sm hover:shadow-md group",title:"Go back to POS (Press ESC or Ctrl+P)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{className:"font-medium",children:"Back to POS"}),e.jsx("div",{className:"ml-1 px-2 py-0.5 bg-white/20 rounded text-xs font-mono",children:"ESC"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:`px-4 py-2 rounded-full text-sm font-medium ${se?"bg-green-100 text-green-800 border border-green-200":"bg-orange-100 text-orange-800 border border-orange-200"}`,children:se?"ðŸ”’ Day Closed":"ðŸ• Day Open"})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm mb-8",children:[e.jsx("div",{className:"p-6 border-b border-gray-200/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Report Controls"}),e.jsx("p",{className:"text-gray-600",children:"Configure your sales report parameters"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-end gap-4",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),e.jsxs("select",{value:S,onChange:s=>ce(s.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 bg-white/80 backdrop-blur-sm transition-all duration-200 text-sm",children:[e.jsx("option",{value:"daily",children:"ðŸ“Š Daily Sales"}),e.jsx("option",{value:"products",children:"ðŸ“¦ Product Performance"}),e.jsx("option",{value:"customers",children:"ðŸ‘¥ Customer Analysis"}),e.jsx("option",{value:"payments",children:"ðŸ’³ Payment Methods"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Period"}),e.jsxs("select",{value:t,onChange:s=>{O(s.target.value),s.target.value!=="custom"&&setTimeout(()=>L(),100)},className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 bg-white/80 backdrop-blur-sm transition-all duration-200 text-sm",children:[e.jsx("option",{value:"1d",children:"ðŸ“… Today"}),e.jsx("option",{value:"7d",children:"ðŸ“… Last 7 Days"}),e.jsx("option",{value:"30d",children:"ðŸ“… Last 30 Days"}),e.jsx("option",{value:"90d",children:"ðŸ“… Last 90 Days"}),e.jsx("option",{value:"custom",children:"ðŸ—“ï¸ Custom Range"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transactions"}),e.jsx("div",{className:"px-3 py-2 border border-gray-200 rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsx("div",{className:"text-base font-bold text-gray-900",children:C.length})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:L,disabled:Y,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 disabled:opacity-50 flex items-center gap-1.5 shadow-sm hover:shadow text-sm",title:"Refresh Data",children:[e.jsx(We,{className:`w-4 h-4 ${Y?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs("button",{onClick:pe,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-1.5 shadow-sm hover:shadow text-sm",title:"Print Report",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Print"})]}),e.jsxs("button",{onClick:R,className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-200 flex items-center gap-1.5 shadow-sm hover:shadow text-sm",title:"Export to CSV",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export CSV"})]}),S==="daily"&&!se&&E&&t==="1d"&&e.jsxs("button",{onClick:()=>a(!0),disabled:H,className:"px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-all duration-200 disabled:opacity-50 flex items-center gap-1.5 shadow-sm hover:shadow text-sm",title:"Close Day",children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:H?"Closing...":"Close"})]})]})]}),t==="custom"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:K.start,onChange:s=>W(r=>({...r,start:s.target.value})),onBlur:()=>L(),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 bg-white/80 backdrop-blur-sm transition-all duration-200 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:K.end,onChange:s=>W(r=>({...r,end:s.target.value})),onBlur:()=>L(),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 bg-white/80 backdrop-blur-sm transition-all duration-200 text-sm"})]})]})]})]}),S==="daily"&&e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 ${f?"lg:grid-cols-4":"lg:grid-cols-3"} gap-6 mb-8`,children:[e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:k(u.totalSales)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ke,{className:"w-6 h-6 text-blue-600"})})]}),e.jsxs("div",{className:"mt-4 flex items-center text-sm",children:[e.jsx(Ee,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Today's Performance"})]})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.totalTransactions})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-green-600"})})]}),e.jsx("div",{className:"mt-4 flex items-center text-sm",children:e.jsxs("span",{className:"text-gray-500",children:["Avg: ",k(u.averageOrder)]})})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Customers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.totalCustomers})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"w-6 h-6 text-purple-600"})})]}),e.jsx("div",{className:"mt-4 flex items-center text-sm",children:e.jsx("span",{className:"text-gray-500",children:"Unique customers"})})]}),f&&e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[u.profitMargin,"%"]})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-orange-600"})})]}),e.jsx("div",{className:"mt-4 flex items-center text-sm",children:e.jsxs("span",{className:"text-gray-500",children:["Total: ",k(u.totalProfit)]})})]})]}),S==="daily"&&C.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sales Trend"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Revenue over time"})]}),e.jsx(Ve,{className:"w-5 h-5 text-blue-600"})]}),e.jsx(ye,{width:"100%",height:250,children:e.jsxs(ss,{data:F.trend,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),e.jsx(_e,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Se,{dataKey:"time",stroke:"#6b7280",style:{fontSize:"12px"}}),e.jsx(Ce,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:s=>`${(s/1e3).toFixed(0)}k`}),e.jsx(je,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},formatter:s=>[k(s),"Sales"]}),e.jsx(ts,{type:"monotone",dataKey:"sales",stroke:"#3b82f6",fillOpacity:1,fill:"url(#colorSales)",strokeWidth:2})]})})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Methods"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Distribution by method"})]}),e.jsx(He,{className:"w-5 h-5 text-green-600"})]}),e.jsx(ye,{width:"100%",height:250,children:e.jsxs(as,{children:[e.jsx(rs,{data:F.payments,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:r})=>`${s} ${(r*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:F.payments.map((s,r)=>e.jsx(ls,{fill:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"][r%5]},`cell-${r}`))}),e.jsx(je,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"},formatter:s=>[k(s),"Total"]})]})})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Daily Activity"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sales by day"})]}),e.jsx(we,{className:"w-5 h-5 text-purple-600"})]}),e.jsx(ye,{width:"100%",height:250,children:e.jsxs($e,{data:F.daily,children:[e.jsx(_e,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Se,{dataKey:"date",stroke:"#6b7280",style:{fontSize:"12px"},angle:-45,textAnchor:"end",height:60}),e.jsx(Ce,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:s=>`${(s/1e3).toFixed(0)}k`}),e.jsx(je,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"},formatter:s=>[k(s),"Sales"]}),e.jsx(Ie,{dataKey:"sales",fill:"#8b5cf6",radius:[8,8,0,0]})]})})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Customers"}),e.jsx("p",{className:"text-sm text-gray-600",children:"By total sales"})]}),e.jsx(Ne,{className:"w-5 h-5 text-orange-600"})]}),e.jsx(ye,{width:"100%",height:250,children:e.jsxs($e,{data:F.topCustomers,layout:"vertical",children:[e.jsx(_e,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Se,{type:"number",stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:s=>`${(s/1e3).toFixed(0)}k`}),e.jsx(Ce,{dataKey:"name",type:"category",stroke:"#6b7280",style:{fontSize:"12px"},width:100}),e.jsx(je,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"},formatter:s=>[k(s),"Total"]}),e.jsx(Ie,{dataKey:"value",fill:"#f59e0b",radius:[0,8,8,0]})]})})]})]}),S!=="daily"&&e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm mb-8",children:[e.jsx("div",{className:"p-6 border-b border-gray-200/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(Ee,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:S==="products"?"Product Performance":S==="customers"?"Customer Analysis":S==="payments"?"Payment Methods":"Report"}),e.jsx("p",{className:"text-gray-600",children:S==="products"?"Top performing products by sales":S==="customers"?"Customer spending analysis":S==="payments"?"Payment method breakdown":"Report data"})]})]})}),e.jsx("div",{className:"p-6",children:(()=>{const s=U();return s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“Š"}),e.jsxs("p",{children:["No data available for ",S," report"]})]}):e.jsxs("div",{className:"space-y-4",children:[S==="products"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:"Product Sales"}),g(s,"name","total","blue")]}),S==="customers"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:"Customer Spending"}),g(s,"name","total","green")]}),S==="payments"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:"Payment Methods"}),g(s,"name","total","purple")]})]})})()})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm",children:[e.jsx("div",{className:"p-6 border-b border-gray-200/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(de,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:S==="daily"?"Sales Transactions":"Detailed Sales List"}),e.jsxs("p",{className:"text-gray-600",children:[C.length," transactions â€¢ ",t==="1d"?"today":t==="7d"?"last 7 days":t==="30d"?"last 30 days":t==="90d"?"last 90 days":t==="custom"?"custom range":"selected period"]})]})]}),Y&&e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-blue-200 border-t-blue-600"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Loading..."})]})]})}),te?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-500 text-lg mb-2",children:"âš ï¸"}),e.jsx("p",{className:"text-gray-600",children:te}),e.jsx("button",{onClick:L,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Retry"})]}):C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“Š"}),e.jsxs("p",{children:["No sales found for ",t==="1d"?"today":t==="7d"?"the last 7 days":t==="30d"?"the last 30 days":t==="90d"?"the last 90 days":"the selected period"]}),e.jsx("p",{className:"text-sm mt-2",children:"Try selecting a different time period or view all sales"}),e.jsxs("div",{className:"flex gap-3 justify-center mt-4",children:[e.jsx("button",{onClick:()=>{console.log("ðŸ” Loading all sales..."),o()},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Show All Sales"}),e.jsx("button",{onClick:()=>O("90d"),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Try 90 Days"})]})]}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:C.map(s=>{var r;return e.jsx("div",{onClick:()=>Z(s),className:"group bg-white/80 backdrop-blur-sm border border-gray-200/50 rounded-xl p-6 hover:bg-gradient-to-r hover:from-blue-50/80 hover:to-indigo-50/80 transition-all duration-200 cursor-pointer hover:shadow-md hover:border-blue-200/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center shadow-sm ${s.status==="confirmed"?"bg-blue-100":s.status==="completed"?"bg-green-100":s.status==="pending"?"bg-yellow-100":"bg-gray-100"}`,children:s.status==="confirmed"?e.jsx(be,{className:"w-6 h-6 text-blue-600"}):s.status==="completed"?e.jsx(be,{className:"w-6 h-6 text-green-600"}):s.status==="pending"?e.jsx(Je,{className:"w-6 h-6 text-yellow-600"}):e.jsx(Ze,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h4",{className:"font-semibold text-gray-900",children:["#",s.sale_number]}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${s.status==="confirmed"?"bg-blue-100 text-blue-700":s.status==="completed"?"bg-green-100 text-green-700":s.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{children:oe(s.created_at)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{children:s.customer_name||"Walk-in"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:j(s.payment_method)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:((r=s.lats_sale_items)==null?void 0:r.length)||0}),e.jsx("div",{className:"text-xs text-gray-500",children:"items"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:k(s.total_amount)}),e.jsx("div",{className:"text-xs text-gray-500",children:s.sold_by?s.sold_by.split("@")[0].replace(/[._]/g," ").charAt(0).toUpperCase()+s.sold_by.split("@")[0].replace(/[._]/g," ").slice(1):s.user_id?X[s.user_id]||`User: ${s.user_id.slice(0,8)}...`:"System"})]}),M&&s.status==="completed"&&e.jsxs("button",{onClick:n=>_(s.id,n),className:"px-3 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),"Confirm"]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})})]})]})},s.id)})})})]})]}),xe&&e.jsx(ns,{isOpen:ee,onClose:()=>{ae(!1),ue(null)},saleId:xe.id}),e.jsx(Ye,{isOpen:ge,onClose:()=>a(!1),onComplete:()=>{B(!0),I(new Date().toISOString()),a(!1)},currentUser:i}),he&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-xl max-w-md w-full p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-orange-100 mb-6",children:e.jsx(be,{className:"h-8 w-8 text-orange-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Close Daily Sales?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This will finalize today's sales and lock the data. You won't be able to make changes after closing."}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-4 mb-6 text-left",children:[e.jsx("h4",{className:"font-semibold text-orange-800 mb-3",children:"Today's Summary:"}),e.jsxs("div",{className:"space-y-2 text-sm text-orange-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Sales:"}),e.jsx("span",{className:"font-semibold",children:k(u.totalSales)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Transactions:"}),e.jsx("span",{className:"font-semibold",children:u.totalTransactions})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Customers:"}),e.jsx("span",{className:"font-semibold",children:u.totalCustomers})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Average Order:"}),e.jsx("span",{className:"font-semibold",children:k(u.averageOrder)})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Profit Margin:"}),e.jsxs("span",{className:"font-semibold",children:[u.profitMargin,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Profit:"}),e.jsx("span",{className:"font-semibold",children:k(u.totalProfit)})]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>le(!1),className:"flex-1 px-4 py-3 border border-gray-200 rounded-xl text-gray-700 hover:bg-gray-50 transition-all duration-200 font-medium",disabled:H,children:"Cancel"}),e.jsx("button",{onClick:ne,disabled:H,className:"flex-1 px-4 py-3 bg-orange-600 text-white rounded-xl hover:bg-orange-700 transition-all duration-200 disabled:opacity-50 font-medium",children:H?"Closing...":"Close Day"})]})]})})})]})};export{bs as default};
