import{j as e,e as w,G as b,q as ot,s as S}from"./index-61458a34.js";import{r as a}from"./vendor-36d2c7c1.js";import{P as Je}from"./PriceInput-aa1a05e9.js";import{P as Qe}from"./PageHeader-f4a9cf63.js";import{c as C}from"./customerLoyaltyService-09627f23.js";import{aj as ct,a9 as dt,Z as We,cU as Ke,D as Xe,a4 as mt,o as xt,P as ut,M as gt,av as es,ae as ce,q as ht,br as pt,af as yt,y as jt,aq as bt,d as ft,a5 as vt,n as o}from"./ui-28e30067.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";const Lt=()=>{const[A,ss]=a.useState(""),[L,ts]=a.useState("all"),[D,as]=a.useState("all"),[G,ls]=a.useState(!1),[de,me]=a.useState(!0),[Y,xe]=a.useState(!1),[p,ue]=a.useState([]),[y,rs]=a.useState({totalCustomers:0,totalPoints:0,vipCustomers:0,activeCustomers:0,totalSpent:0,averagePoints:0}),[ns,is]=a.useState([]),[ge,os]=a.useState([]),[he,cs]=a.useState([]),[ds,Z]=a.useState(!1),[F,pe]=a.useState(null),[z,J]=a.useState(""),[T,ms]=a.useState("whatsapp"),[ye,je]=a.useState(!1),[xs,be]=a.useState(!1),[fe,us]=a.useState(null),[f,gs]=a.useState(null),[hs,ve]=a.useState(!1),[Ne,ps]=a.useState([]),[we,Se]=a.useState([]),[ys,js]=a.useState([]),[bs,$]=a.useState(!1),[g,Ce]=a.useState(null),[c,Q]=a.useState(null),[ke,Pe]=a.useState(!1),[_e,fs]=a.useState([]),[vs,Re]=a.useState(!1),[Ae,Ns]=a.useState([]),[d,O]=a.useState({name:"",message:"",targetTier:"all",targetStatus:"all",scheduledDate:"",type:"whatsapp"}),[Le,De]=a.useState(!1),[ws,W]=a.useState(!1),[K,Ss]=a.useState("loyalty-overview"),[X,Cs]=a.useState("30d"),[Te,Me]=a.useState(!1),[ks,Ie]=a.useState(!1),[Ee,Ps]=a.useState([]),[_s,Rs]=a.useState("all"),[As,B]=a.useState(!1),[v,V]=a.useState([]),[M,Ls]=a.useState("points"),[ee,Ds]=a.useState(0),[Fe,Ts]=a.useState(""),[Oe,ze]=a.useState(!1),[U,Ms]=a.useState(!1),[se,Is]=a.useState(""),[te,Es]=a.useState(""),[ae,Fs]=a.useState(""),[le,Os]=a.useState("");a.useState("all");const[$e,zs]=a.useState("points"),[Be,$s]=a.useState("desc"),[re,ne]=a.useState(1),[Ve,Bs]=a.useState(0),[Ue,Vs]=a.useState(!1),[Nt,Us]=a.useState(!1),[ie,qs]=a.useState(0),Hs=50;a.useEffect(()=>{k()},[L,D]),a.useEffect(()=>{ne(1),k()},[L,D]),a.useEffect(()=>{p.length>0&&tt()},[p]);const k=async(s=1,t=!1)=>{s===1?me(!0):xe(!0);try{const[l,r,n,j,i]=await Promise.all([C.fetchLoyaltyCustomersPaginated(s,Hs,A,L,D),C.calculateLoyaltyMetrics(),Promise.resolve(C.getLoyaltyTiers()),Promise.resolve(C.getAvailableRewards()),C.fetchPointHistory()]);t&&s>1?ue(_=>[..._,...l.customers]):ue(l.customers),ne(l.currentPage),Bs(l.totalPages),Vs(l.hasNextPage),Us(l.hasPreviousPage),qs(l.totalCount),s===1&&(rs(r),is(n),os(j),cs(i))}catch(l){console.error("Error fetching loyalty data:",l)}finally{me(!1),xe(!1)}},Gs=async()=>{Ue&&!Y&&await k(re+1,!0)},qe=()=>{ne(1),k(1,!1)},P=s=>{const t=s||0,l=1e12,r=Math.abs(t)>l;if(r&&console.warn(`âš ï¸ CORRUPT DATA - Amount: ${t}`),!isFinite(t))return console.warn(`âš ï¸ Invalid amount: ${s}.`),"TZS 0 âš ï¸ INVALID";const n=new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS"}).format(t);return r?`${n} âš ï¸`:n},He=s=>{switch(s){case"vip":return"text-purple-600 bg-purple-100";case"premium":return"text-yellow-600 bg-yellow-100";case"regular":return"text-blue-600 bg-blue-100";case"active":return"text-green-600 bg-green-100";case"payment_customer":return"text-teal-600 bg-teal-100";case"engaged":return"text-indigo-600 bg-indigo-100";case"interested":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},Ys=async()=>{if(!F||!z.trim()){o.error("Please select a customer and enter a message");return}je(!0);try{let s=!1;switch(T){case"sms":s=(await ot.sendSMS(F.phone,z)).success;break;case"email":if(F.email)s=!0,o.success("Email service not yet implemented");else{o.error("Customer has no email address");return}break}s?(o.success(`${T.toUpperCase()} message sent successfully!`),Z(!1),J(""),pe(null)):o.error(`Failed to send ${T.toUpperCase()} message`)}catch(s){console.error("Error sending communication:",s),o.error("Failed to send message")}finally{je(!1)}},oe=(s,t)=>{pe(s),ms(t),J(""),Z(!0)},Zs=async s=>{ve(!0);try{const t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),{data:n,error:j}=await S.from("lats_sales").select(`
          id,
          sale_number,
          customer_id,
          subtotal,
          total_amount,
          payment_method,
          status,
          created_at,
          updated_at
        `).eq("customer_id",s).gte("created_at",l.toISOString()).lt("created_at",r.toISOString()).order("created_at",{ascending:!1});let i=n,_=j;if(j){console.warn("Complex customer sales query failed, trying simpler query:",j.message);const{data:m,error:x}=await S.from("lats_sales").select("*").eq("customer_id",s).gte("created_at",l.toISOString()).lt("created_at",r.toISOString()).order("created_at",{ascending:!1});x?(console.error("Simple customer sales query also failed:",x),i=[],_=null):(i=m,_=null,console.log(`âœ… Loaded ${(i==null?void 0:i.length)||0} customer sales (without sale items)`))}else console.log(`âœ… Loaded ${(i==null?void 0:i.length)||0} customer sales`);const{data:R}=await S.from("devices").select("id").eq("customer_id",s),H=(R==null?void 0:R.map(m=>m.id))||[];let N=[],h=null;if(H.length>0){const m=await S.from("lats_spare_part_usage").select("*").in("device_id",H).gte("created_at",l.toISOString()).lt("created_at",r.toISOString()).order("created_at",{ascending:!1});N=m.data||[],h=m.error}if(!h&&N&&N.length>0){const m=[...new Set(N.map(x=>x.spare_part_id).filter(Boolean))];if(m.length>0){const{data:x}=await S.from("lats_spare_parts").select("id, name, part_number, cost_price, selling_price").in("id",m),I=(x||[]).reduce((E,Ze)=>(E[Ze.id]=Ze,E),{});N.forEach(E=>{E.spare_part_id&&(E.lats_spare_parts=I[E.spare_part_id]||null)})}}if(!_&&i)if(ps(i),i.length>0&&i[0].lats_sale_items){const m=i.flatMap(x=>(x.lats_sale_items||[]).map(I=>({...I,saleNumber:x.sale_number,saleDate:x.created_at,paymentMethod:x.payment_method,saleStatus:x.status})));Se(m)}else Se([]);!h&&N&&js(N);const u=Js(s,i||[],N||[]);gs(u)}catch(t){console.error("Error fetching customer analytics:",t),o.error("Failed to load customer analytics")}finally{ve(!1)}},Js=(s,t,l)=>{const r=t.reduce((h,u)=>{const m=typeof u.total_amount=="number"?u.total_amount:parseFloat(u.total_amount)||0;return h+m},0),n=l.reduce((h,u)=>{var x,I;const m=typeof((x=u.lats_spare_parts)==null?void 0:x.selling_price)=="number"?u.lats_spare_parts.selling_price:parseFloat((I=u.lats_spare_parts)==null?void 0:I.selling_price)||0;return h+m},0),j=r+n,i=t.length,_=i>0?r/i:0;let R=0;if(t.length>0){const h=new Date(t[0].created_at);R=Math.floor((Date.now()-h.getTime())/(1e3*60*60*24))}const H=new Set(we.map(h=>{var u;return((u=h.lats_products)==null?void 0:u.name)||"Unknown"})).size,N=we.reduce((h,u)=>h+(u.quantity||1),0);return{totalSpent:j,totalPosSpent:r,totalSpareSpent:n,orderCount:i,avgOrderValue:_,daysSinceLastPurchase:R,uniqueProducts:H,totalItems:N,purchaseFrequency:i>0?i/Math.max(R/30,1):0}},Qs=async s=>{us(s),be(!0),await Zs(s.customerId)},Ge=async s=>{try{const{data:t,error:l}=await S.from("points_transactions").select("*").eq("customer_id",s).eq("transaction_type","redeemed").order("created_at",{ascending:!1}).limit(10);!l&&t&&fs(t)}catch(t){console.error("Error fetching redemption history:",t)}},Ws=async s=>{Ce(s),Q(null),$(!0),await Ge(s.customerId)},Ks=async()=>{if(!g||!c){o.error("Please select a customer and reward");return}if(g.points<c.points){o.error("Customer does not have enough points for this reward");return}Pe(!0);try{if(await C.updateCustomerPoints(g.customerId,-c.points,`Redeemed: ${c.name}`,"redeemed")){const{error:t}=await S.from("reward_redemptions").insert({customer_id:g.customerId,reward_id:c.id,reward_name:c.name,points_used:c.points,redeemed_at:new Date().toISOString(),status:"active"});t&&console.warn("Could not record redemption:",t);const l=`Congratulations! You've successfully redeemed ${c.name} for ${c.points} points. Your new balance is ${g.points-c.points} points.`;o.success(`Reward redeemed successfully! ${c.points} points deducted.`),await k(1,!1),await Ge(g.customerId),$(!1),Ce(null),Q(null)}else o.error("Failed to redeem reward")}catch(s){console.error("Error redeeming reward:",s),o.error("Failed to redeem reward")}finally{Pe(!1)}},Ye=s=>ge.filter(t=>t.active&&s>=t.points),Xs=async()=>{try{const{data:s,error:t}=await S.from("loyalty_campaigns").select("*").order("created_at",{ascending:!1});!t&&s&&Ns(s)}catch(s){console.error("Error fetching campaigns:",s)}},et=async()=>{if(!d.name||!d.message){o.error("Please fill in all required fields");return}De(!0);try{const{error:s}=await S.from("loyalty_campaigns").insert({name:d.name,message:d.message,target_tier:d.targetTier,target_status:d.targetStatus,scheduled_date:d.scheduledDate,type:d.type,status:"scheduled",created_at:new Date().toISOString()});s?o.error("Failed to create campaign"):(o.success("Campaign created successfully!"),O({name:"",message:"",targetTier:"all",targetStatus:"all",scheduledDate:"",type:"whatsapp"}),await Xs())}catch(s){console.error("Error creating campaign:",s),o.error("Failed to create campaign")}finally{De(!1)}},st=async()=>{Me(!0);try{await new Promise(n=>setTimeout(n,2e3));const s={type:K,period:X,generatedAt:new Date().toISOString(),data:{totalCustomers:y.totalCustomers,totalPoints:y.totalPoints,totalSpent:y.totalSpent,averagePoints:y.averagePoints,vipCustomers:y.vipCustomers}},t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),r=document.createElement("a");r.href=l,r.download=`loyalty-report-${K}-${X}.json`,r.click(),URL.revokeObjectURL(l),o.success("Report generated and downloaded successfully!")}catch(s){console.error("Error generating report:",s),o.error("Failed to generate report")}finally{Me(!1)}},tt=()=>{const s=[{name:"VIP Customers",criteria:"VIP tier with high spending",count:p.filter(t=>t.tier==="vip"&&t.totalSpent>1e5).length,color:"purple"},{name:"High Value",criteria:"Premium tier or high points",count:p.filter(t=>t.tier==="premium"||t.points>500).length,color:"yellow"},{name:"Active Customers",criteria:"Recent activity within 30 days",count:p.filter(t=>{const l=new Date(t.lastVisit);return(Date.now()-l.getTime())/(1e3*60*60*24)<=30}).length,color:"green"},{name:"At Risk",criteria:"No activity for 90+ days",count:p.filter(t=>{const l=new Date(t.lastVisit);return(Date.now()-l.getTime())/(1e3*60*60*24)>90}).length,color:"red"}];Ps(s)},at=async()=>{if(v.length===0){o.error("Please select customers for bulk operation");return}ze(!0);try{let s=!0;switch(M){case"points":for(const j of v)await C.updateCustomerPoints(j,ee,"Bulk points adjustment","adjusted")||(s=!1);break;case"communication":s=!1,o.error("WhatsApp service not available");break;case"export":const t=p.filter(j=>v.includes(j.customerId)),l=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(l),n=document.createElement("a");n.href=r,n.download=`loyalty-customers-export-${new Date().toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(r);break}s?(o.success(`Bulk operation completed successfully for ${v.length} customers!`),V([]),await k(1,!1)):o.error("Some operations failed. Please check the results.")}catch(s){console.error("Error in bulk operation:",s),o.error("Failed to complete bulk operation")}finally{ze(!1)}},lt=s=>{V(t=>t.includes(s)?t.filter(l=>l!==s):[...t,s])},rt=()=>{V(p.map(s=>s.customerId))},nt=()=>{V([])},q=()=>{let s=[...p];return L!=="all"&&(s=s.filter(t=>t.tier===L)),D!=="all"&&(s=s.filter(t=>t.status===D)),A&&(s=s.filter(t=>t.name.toLowerCase().includes(A.toLowerCase())||t.phone.includes(A)||t.email&&t.email.toLowerCase().includes(A.toLowerCase()))),se&&(s=s.filter(t=>t.points>=parseInt(se))),te&&(s=s.filter(t=>t.points<=parseInt(te))),ae&&(s=s.filter(t=>t.totalSpent>=parseInt(ae))),le&&(s=s.filter(t=>t.totalSpent<=parseInt(le))),s.sort((t,l)=>{let r,n;switch($e){case"points":r=t.points,n=l.points;break;case"spent":r=t.totalSpent,n=l.totalSpent;break;case"name":r=t.name,n=l.name;break;case"lastVisit":r=new Date(t.lastVisit).getTime(),n=new Date(l.lastVisit).getTime();break;default:r=t.points,n=l.points}return Be==="asc"?r>n?1:-1:r<n?1:-1}),s},it=async(s,t,l)=>{try{await C.updateCustomerPoints(s,t,l,t>0?"earned":"adjusted")?(await k(1,!1),alert(`Points adjustment successful: ${t>0?"+":""}${t} points - ${l}`)):alert("Failed to adjust points")}catch(r){console.error("Error adjusting points:",r),alert(`Error adjusting points: ${r}`)}};return de&&re===1?e.jsxs("div",{className:"min-h-screen p-6",style:{backgroundColor:"transparent"},children:[e.jsx(Qe,{title:"Customer Loyalty",subtitle:"Manage loyalty points, rewards, and customer tiers",className:"mb-6"}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading loyalty data..."})]})})]}):e.jsxs("div",{className:"min-h-screen p-6",style:{backgroundColor:"transparent"},children:[e.jsx(Qe,{title:"Customer Loyalty",subtitle:"Manage loyalty points, rewards, and customer tiers",className:"mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6",children:[e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Customers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:y.totalCustomers})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx("span",{className:"text-blue-600 text-xl",children:"ðŸ‘¥"})})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-sm text-gray-600",children:"In loyalty program"})})]}),e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Points"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:y.totalPoints.toLocaleString()})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx("span",{className:"text-green-600 text-xl",children:"â­"})})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["Average: ",y.averagePoints]})})]}),e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"VIP Customers"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:y.vipCustomers})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:e.jsx("span",{className:"text-purple-600 text-xl",children:"ðŸ‘‘"})})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-sm text-gray-600",children:"Platinum tier"})})]}),e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Customers"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:y.activeCustomers})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx("span",{className:"text-green-600 text-xl",children:"âœ…"})})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-sm text-gray-600",children:"Recently active"})})]}),e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:P(y.totalSpent)})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx("span",{className:"text-orange-600 text-xl",children:"ðŸ’°"})})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-sm text-gray-600",children:"From all customers"})})]})]}),e.jsxs(w,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Customer Management"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(b,{variant:"secondary",onClick:()=>Ms(!U),icon:U?e.jsx(ct,{size:16}):e.jsx(dt,{size:16}),children:[U?"Hide":"Advanced"," Filters"]}),e.jsx(b,{variant:"secondary",onClick:()=>B(!0),icon:e.jsx(We,{size:16}),children:"Bulk Operations"}),e.jsx(b,{variant:"secondary",onClick:()=>Re(!0),icon:e.jsx(Ke,{size:16}),children:"Campaigns"}),e.jsx(b,{variant:"secondary",onClick:()=>W(!0),icon:e.jsx(Xe,{size:16}),children:"Reports"}),e.jsx(b,{variant:"secondary",onClick:()=>Ie(!0),icon:e.jsx(mt,{size:16}),children:"Segments"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search customers...",value:A,onChange:s=>ss(s.target.value),onKeyPress:s=>s.key==="Enter"&&qe(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Loyalty Tier"}),e.jsxs("select",{value:L,onChange:s=>ts(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"all",children:"All Tiers"}),e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:D,onChange:s=>as(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:$e,onChange:s=>zs(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"points",children:"Points"}),e.jsx("option",{value:"spent",children:"Total Spent"}),e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"lastVisit",children:"Last Visit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order"}),e.jsxs("select",{value:Be,onChange:s=>$s(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx(b,{variant:"secondary",onClick:qe,className:"flex-1",children:"Search"}),e.jsx(b,{variant:"primary",onClick:()=>alert("Add new customer to loyalty program"),className:"flex-1",children:"Add Customer"})]})]}),U&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Points"}),e.jsx("input",{type:"number",placeholder:"0",value:se,onChange:s=>Is(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Points"}),e.jsx("input",{type:"number",placeholder:"âˆž",value:te,onChange:s=>Es(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Spent"}),e.jsx(Je,{value:parseFloat(ae)||0,onChange:s=>Fs(s.toString()),placeholder:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Spent"}),e.jsx(Je,{value:parseFloat(le)||0,onChange:s=>Os(s.toString()),placeholder:"âˆž",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Loyalty Customers (",q().length," of ",ie,")"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(b,{variant:"secondary",onClick:()=>ls(!G),children:[G?"Hide":"Show"," History"]}),e.jsx(b,{variant:"secondary",onClick:()=>alert("Export loyalty data"),children:"Export"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:v.length===q().length&&q().length>0,onChange:rt,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Select All"})]}),e.jsx("button",{onClick:nt,className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear Selection"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[v.length," selected"]})]}),v.length>0&&e.jsx("div",{className:"flex space-x-2",children:e.jsxs(b,{variant:"secondary",size:"sm",onClick:()=>B(!0),children:["Bulk Actions (",v.length,")"]})})]}),e.jsx("div",{className:"space-y-4",children:q().map(s=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:v.includes(s.customerId),onChange:()=>lt(s.customerId),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.phone}),s.email&&e.jsx("div",{className:"text-sm text-gray-600",children:s.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[s.points," points"]}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${He(s.tier)}`,children:s.tier})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Spent"}),e.jsx("div",{className:"font-medium text-gray-900",children:P(s.totalSpent)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Orders"}),e.jsx("div",{className:"font-medium text-gray-900",children:s.orders})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Join Date"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(s.joinDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Last Purchase"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(s.lastPurchase).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-3",children:[e.jsxs("div",{children:["Status: ",s.status]}),e.jsxs("div",{children:["Last Visit: ",new Date(s.lastVisit).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{const t=prompt("Enter points to add (positive) or subtract (negative):");if(t!==null){const l=parseInt(t);if(!isNaN(l)){const r=prompt("Enter reason for points adjustment:")||"Manual adjustment";it(s.customerId,l,r)}}},className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Adjust Points"}),e.jsx("button",{onClick:()=>oe(s,"whatsapp"),className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700",title:"Send WhatsApp",children:e.jsx(xt,{size:14})}),e.jsx("button",{onClick:()=>oe(s,"sms"),className:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600",title:"Send SMS",children:e.jsx(ut,{size:14})}),s.email&&e.jsx("button",{onClick:()=>oe(s,"email"),className:"px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700",title:"Send Email",children:e.jsx(gt,{size:14})}),e.jsx("button",{onClick:()=>Qs(s),className:"px-3 py-1 bg-orange-600 text-white text-sm rounded hover:bg-orange-700",title:"View Analytics",children:e.jsx(es,{size:14})}),e.jsx("button",{onClick:()=>Ws(s),className:"px-3 py-1 bg-pink-600 text-white text-sm rounded hover:bg-pink-700",title:"Redeem Rewards",children:e.jsx(ce,{size:14})}),e.jsx("button",{onClick:()=>alert(`View ${s.name} loyalty details`),className:"px-3 py-1 border border-gray-300 text-gray-700 text-sm rounded hover:bg-gray-50",children:"View Details"})]}),G&&e.jsxs("div",{className:"mt-4 p-3 bg-white rounded border",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Points History"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:[he.filter(t=>t.customerId===s.customerId).slice(0,5).map((t,l)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:t.reason}),e.jsxs("span",{className:`font-medium ${t.points>0?"text-green-600":"text-red-600"}`,children:[t.points>0?"+":"",t.points]})]},l)),he.filter(t=>t.customerId===s.customerId).length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No point history available"})]})]})]},s.id))}),Ue&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx(b,{variant:"secondary",onClick:Gs,disabled:Y,className:"px-8 py-3",children:Y?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{children:"Loading..."})]}):`Load More (${p.length} of ${ie})`})}),e.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:["Showing ",p.length," of ",ie," customers",Ve>1&&e.jsxs("span",{children:[" â€¢ Page ",re," of ",Ve]})]}),p.length===0&&!de&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ‘¥"}),e.jsx("div",{children:"No loyalty customers found"}),e.jsx("div",{className:"text-sm mt-1",children:"Try adjusting your search or filters"})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Loyalty Tiers"}),e.jsx("div",{className:"space-y-3",children:ns.map((s,t)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.discount,"% discount"]})]}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:[s.minPoints," - ",s.maxPoints===999999?"âˆž":s.maxPoints," points"]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.benefits.join(", ")})]},t))})]}),e.jsxs(w,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Available Rewards"}),e.jsx("div",{className:"space-y-3",children:ge.map(s=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm font-semibold text-blue-600",children:[s.points," points"]})]}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s.active?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"}`,children:s.active?"Active":"Inactive"}),e.jsx("button",{onClick:()=>alert(`Redeem ${s.name}`),className:"text-xs text-blue-600 hover:text-blue-800",children:"Redeem"})]})]},s.id))})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(w,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("button",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx("div",{className:"text-blue-600 text-2xl mb-2",children:"ðŸŽ"}),e.jsx("div",{className:"font-medium text-gray-900",children:"Send Rewards"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Send points to customers"})]}),e.jsxs("button",{className:"p-4 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("div",{className:"text-green-600 text-2xl mb-2",children:"ðŸ“§"}),e.jsx("div",{className:"font-medium text-gray-900",children:"Email Campaign"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Send loyalty promotions"})]}),e.jsxs("button",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 transition-colors",children:[e.jsx("div",{className:"text-purple-600 text-2xl mb-2",children:"ðŸ“Š"}),e.jsx("div",{className:"font-medium text-gray-900",children:"Loyalty Analytics"}),e.jsx("div",{className:"text-sm text-gray-600",children:"View program performance"})]}),e.jsxs("button",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg hover:bg-orange-100 transition-colors",children:[e.jsx("div",{className:"text-orange-600 text-2xl mb-2",children:"âš™ï¸"}),e.jsx("div",{className:"font-medium text-gray-900",children:"Program Settings"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Configure loyalty rules"})]})]})]})}),xs&&fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:["Analytics for ",fe.name]}),e.jsx("button",{onClick:()=>be(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),hs?e.jsxs("div",{className:"flex items-center justify-center h-32",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading analytics..."})]}):f?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ht,{className:"text-blue-600 mr-2",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Spent"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:P(f.totalSpent)})]})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pt,{className:"text-green-600 mr-2",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Orders"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:f.orderCount})]})]})}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(yt,{className:"text-purple-600 mr-2",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Order"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:P(f.avgOrderValue)})]})]})}),e.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(jt,{className:"text-orange-600 mr-2",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Purchase"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[f.daysSinceLastPurchase,"d ago"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"POS Purchases"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Spent:"}),e.jsx("span",{className:"font-medium",children:P(f.totalPosSpent)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Unique Products:"}),e.jsx("span",{className:"font-medium",children:f.uniqueProducts})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Items:"}),e.jsx("span",{className:"font-medium",children:f.totalItems})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Purchase Frequency:"}),e.jsxs("span",{className:"font-medium",children:[f.purchaseFrequency.toFixed(1)," orders/month"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Spare Parts Usage"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Spent:"}),e.jsx("span",{className:"font-medium",children:P(f.totalSpareSpent)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parts Used:"}),e.jsx("span",{className:"font-medium",children:ys.length})]})]})]})]}),Ne.length>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Recent Sales"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:Ne.slice(0,5).map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:["Order #",s.sale_number]}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm",children:P(s.total_amount)}),e.jsx("p",{className:"text-xs text-gray-600",children:s.payment_method})]})]},t))})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(es,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No analytics data available for this customer"})]})]})}),bs&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:["Redeem Rewards for ",g.name]}),e.jsx("button",{onClick:()=>$(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Current Points Balance"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[g.points," points"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Loyalty Tier"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-sm font-medium rounded-full ${He(g.tier)}`,children:g.tier})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Available Rewards"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Ye(g.points).map(s=>e.jsxs("div",{onClick:()=>Q(s),className:`p-4 border-2 rounded-lg cursor-pointer transition-colors ${(c==null?void 0:c.id)===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(bt,{className:"text-yellow-500 mr-1",size:16}),e.jsxs("span",{className:"font-bold text-gray-900",children:[s.points," pts"]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s.active?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"}`,children:s.active?"Available":"Unavailable"}),(c==null?void 0:c.id)===s.id&&e.jsx(ft,{className:"text-blue-500",size:16})]})]},s.id))}),Ye(g.points).length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ce,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No rewards available for current points balance"}),e.jsx("p",{className:"text-sm mt-2",children:"Customer needs more points to redeem rewards"})]})]}),_e.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Redemptions"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:_e.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.reason||"Reward Redemption"}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-medium text-sm text-red-600",children:["-",Math.abs(s.points_change)," pts"]})})]},t))})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>$(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:Ks,disabled:ke||!c,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Redeeming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{size:16,className:"mr-2"}),"Redeem Reward"]})})]})]})}),As&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:["Bulk Operations (",v.length," customers selected)"]}),e.jsx("button",{onClick:()=>B(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operation Type"}),e.jsxs("select",{value:M,onChange:s=>Ls(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"points",children:"Adjust Points"}),e.jsx("option",{value:"communication",children:"Send Message"}),e.jsx("option",{value:"export",children:"Export Data"})]})]}),M==="points"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Points to Add/Subtract"}),e.jsx("input",{type:"number",value:ee,onChange:s=>Ds(parseInt(s.target.value)||0),placeholder:"Enter points (positive to add, negative to subtract)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),M==="communication"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),e.jsx("textarea",{value:Fe,onChange:s=>Ts(s.target.value),placeholder:"Enter message to send to all selected customers...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>B(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:at,disabled:Oe||M==="points"&&ee===0||M==="communication"&&!Fe.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:Oe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{size:16,className:"mr-2"}),"Execute Bulk Operation"]})})]})]})]})}),vs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Loyalty Campaigns"}),e.jsx("button",{onClick:()=>Re(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Create New Campaign"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Campaign Name"}),e.jsx("input",{type:"text",value:d.name,onChange:s=>O({...d,name:s.target.value}),placeholder:"Enter campaign name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),e.jsx("textarea",{value:d.message,onChange:s=>O({...d,message:s.target.value}),placeholder:"Enter campaign message",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Tier"}),e.jsxs("select",{value:d.targetTier,onChange:s=>O({...d,targetTier:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"all",children:"All Tiers"}),e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),e.jsxs("select",{value:d.type,onChange:s=>O({...d,type:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"whatsapp",children:"WhatsApp"}),e.jsx("option",{value:"sms",children:"SMS"}),e.jsx("option",{value:"email",children:"Email"})]})]})]}),e.jsx("button",{onClick:et,disabled:Le||!d.name||!d.message,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Le?"Creating...":"Create Campaign"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Active Campaigns"}),e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[Ae.map((s,t)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s.status==="active"?"bg-green-100 text-green-600":"bg-yellow-100 text-yellow-600"}`,children:s.status})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.message}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Target: ",s.target_tier," â€¢ Type: ",s.type]})]},t)),Ae.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ke,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No campaigns created yet"})]})]})]})]})]})}),ws&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Generate Reports"}),e.jsx("button",{onClick:()=>W(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),e.jsxs("select",{value:K,onChange:s=>Ss(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"loyalty-overview",children:"Loyalty Overview"}),e.jsx("option",{value:"customer-segments",children:"Customer Segments"}),e.jsx("option",{value:"points-activity",children:"Points Activity"}),e.jsx("option",{value:"reward-redemptions",children:"Reward Redemptions"}),e.jsx("option",{value:"campaign-performance",children:"Campaign Performance"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Period"}),e.jsxs("select",{value:X,onChange:s=>Cs(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"7d",children:"Last 7 Days"}),e.jsx("option",{value:"30d",children:"Last 30 Days"}),e.jsx("option",{value:"90d",children:"Last 90 Days"}),e.jsx("option",{value:"1y",children:"Last Year"}),e.jsx("option",{value:"all",children:"All Time"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>W(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:st,disabled:Te,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:Te?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:16,className:"mr-2"}),"Generate Report"]})})]})]})]})}),ks&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Customer Segmentation"}),e.jsx("button",{onClick:()=>Ie(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Segments"}),e.jsx("div",{className:"space-y-3",children:Ee.map((s,t)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("span",{className:`text-sm font-bold ${s.color==="purple"?"text-purple-600":s.color==="yellow"?"text-yellow-600":s.color==="green"?"text-green-600":"text-red-600"}`,children:[s.count," customers"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.criteria})]},t))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Segment Actions"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Segment"}),e.jsxs("select",{value:_s,onChange:s=>Rs(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"all",children:"All Customers"}),Ee.map((s,t)=>e.jsxs("option",{value:s.name,children:[s.name," (",s.count,")"]},t))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Send Campaign to Segment"}),e.jsx("button",{className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Export Segment Data"}),e.jsx("button",{className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Analyze Segment"})]})]})]})]})]})}),ds&&F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Send ",T.toUpperCase()," to ",F.name]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),e.jsx("textarea",{value:z,onChange:s=>J(s.target.value),placeholder:`Enter your ${T} message...`,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",rows:4})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>Z(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:Ys,disabled:ye||!z.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:ye?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{size:16,className:"mr-2"}),"Send ",T.toUpperCase()]})})]})]})})]})};export{Lt as default};
