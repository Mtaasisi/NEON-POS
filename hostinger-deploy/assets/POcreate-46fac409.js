import{_ as pt}from"./supabase-cf010ec4.js";import{j as e,G as Ge,ak as Nr,aD as vr,s as Qe,u as wr,d as As,e as Ts}from"./index-61458a34.js";import{r as s,b as Us,R as es}from"./vendor-36d2c7c1.js";import{a as Sr,c as Cr}from"./routing-eb8c310c.js";import{r as Lt,a3 as ts,N as Ve,aA as Xe,Y as It,R as et,G as cs,d as Be,X as Te,Q as ft,v as ss,I as kr,n as m,U as Bs,y as qs,bd as Pr,bf as Er,s as Dr,u as qe,a as Ot,b as $t,f as rs,t as Ar,T as Tr,A as We,cK as Vs,J as as,by as zs,av as Is,bj as Et,af as bt,b_ as Ir,aJ as Mt,cL as ns,bN as Yt,bM as _t,e as Tt,ah as gt,ag as Ks,D as Mr,bs as _r,O as Lr,q as ls,k as os,P as Qs,$ as Or,bv as is,m as Hs,c as Zs,M as $r,bS as Fr,a5 as Rr,l as Ur,a6 as Br,br as Jt,g as qr}from"./ui-28e30067.js";import{u as Vr}from"./useDialog-6eb5c329.js";import{u as zr}from"./usePOSClickSounds-e5b9fd69.js";import{u as Kr,P as Gs,R as Qr,i as Hr,V as Ms}from"./VariantProductCard-04300406.js";import{e as Zr,S as Gr}from"./SupplierDetailModal-41a61e96.js";import{g as Wr}from"./countryFlags-325b0823.js";import{E as Ws}from"./EnhancedAddSupplierModal-988446e5.js";import{S as Yr}from"./SupplierForm-59afd126.js";import{u as Jr}from"./useBodyScrollLock-341c8b9f.js";import{s as Xt}from"./shippingApi-e95f9d8a.js";import{A as Xr}from"./AddProductModal-144ca68a.js";import{f as ce,S as je,v as _s,g as Ls}from"./purchaseOrderUtils-7c108ebb.js";import{u as ea,e as Os,O as ta}from"./OrderManagementModal-72b00066.js";import{I as sa}from"./InstallmentManagementModal-0b553ce1.js";import{u as ra,S as aa}from"./useSuccessModal-081786c4.js";import{L as $s}from"./LoadingSpinner-251d9268.js";import{P as na}from"./PaymentsPopupModal-6fe61f19.js";import{p as la}from"./draftService-00fb159f.js";import"./robustImageService-f15af7ef.js";import"./format-aff4c6a2.js";import"./GlassTabs-05c8a392.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";import"./forms-ebbdb905.js";import"./zod-78f78e6c.js";import"./skuUtils-60e0a165.js";import"./CategoryInput-e47eba98.js";import"./specificationUtils-0c00478d.js";import"./QualityCheckModal-849e9065.js";import"./SetPricingModal-84ffdd49.js";import"./CustomerTooltip-6a958832.js";import"./currencyUtils-59109a41.js";const oa=({cartItemsCount:a,totalAmount:_,currency:r,productsCount:f,suppliersCount:b,onCreatePurchaseOrder:j,onSaveAsDraft:v,onClearCart:I,onAddSupplier:P,onAddProduct:B,onViewPurchaseOrders:R,onOpenInstallmentManagement:A,isCreatingPO:E,isSavingDraft:i=!1,hasSelectedSupplier:S})=>e.jsx("div",{className:"fixed left-[var(--app-sidebar-offset,0px)] right-0 top-[var(--app-topbar-height,0px)] z-10 bg-gradient-to-r from-orange-500 via-amber-500 to-orange-600 shadow-xl border-b-4 border-orange-300",children:e.jsx("div",{className:"px-4 sm:px-6 py-4",children:e.jsx("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[A&&e.jsx(Ge,{onClick:A,variant:"outline",className:"bg-white/20 hover:bg-white/30 text-white border-white/30 hover:border-white/50",icon:e.jsx(Lt,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"Installments"})}),R&&e.jsx(Ge,{onClick:R,variant:"outline",className:"bg-white/20 hover:bg-white/30 text-white border-white/30 hover:border-white/50",icon:e.jsx(ts,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"View Orders"})}),B&&e.jsx(Ge,{onClick:B,variant:"outline",className:"bg-white/20 hover:bg-white/30 text-white border-white/30 hover:border-white/50",icon:e.jsx(Ve,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"Add Product"})}),P&&e.jsx(Ge,{onClick:P,variant:"outline",className:"bg-white/20 hover:bg-white/30 text-white border-white/30 hover:border-white/50",icon:e.jsx(Xe,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"Add Supplier"})}),a>0&&e.jsx(Ge,{onClick:I,variant:"outline",className:"bg-red-500/20 hover:bg-red-500/30 text-white border-red-300/50 hover:border-red-300/70",icon:e.jsx(It,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"Clear"})}),v&&a>0&&e.jsxs(Ge,{onClick:v,disabled:!S||i||E,variant:"outline",className:"bg-blue-500/20 hover:bg-blue-500/30 text-white border-blue-300/50 hover:border-blue-300/70 disabled:opacity-50 disabled:cursor-not-allowed",icon:i?e.jsx(et,{size:18,className:"animate-spin"}):e.jsx(cs,{size:18}),children:[e.jsx("span",{className:"hidden sm:inline",children:i?"Saving...":"Save Draft"}),e.jsx("span",{className:"sm:hidden",children:"Draft"})]}),e.jsx(Ge,{onClick:j,disabled:!S||a===0||E||i,className:"bg-white text-orange-600 hover:bg-orange-50 disabled:opacity-50 disabled:cursor-not-allowed font-bold",icon:E?e.jsx(et,{size:18,className:"animate-spin"}):e.jsx(Be,{size:18}),children:E?"Creating...":"Create PO"})]})})})});function ia(a,_,r="TZS"){if(!(a!=null&&a.trim()))return null;const f=[/1\s*([A-Z]{3})\s*=\s*([\d,]+\.?\d*)\s*([A-Z]{3})/i,/([\d,]+\.?\d*)\s*([A-Z]{3})\s*=\s*1\s*([A-Z]{3})/i,/([\d,]+\.?\d*)/i];for(const b of f){const j=a.match(b);if(j){if(j.length===4){const v=j[1]||j[3],I=j[3]||j[1],P=parseFloat(j[2].replace(/,/g,""));if(v===_&&I===r)return{rate:P,source:"manual",date:new Date().toISOString(),fromCurrency:_,toCurrency:r};if(v===r&&I===_)return{rate:1/P,source:"manual",date:new Date().toISOString(),fromCurrency:_,toCurrency:r}}else if(j.length===2)return{rate:parseFloat(j[1].replace(/,/g,"")),source:"manual",date:new Date().toISOString(),fromCurrency:_,toCurrency:r}}}return null}function ca(a,_,r="TZS"){return ia(a,_,r)}const da=({isOpen:a,onClose:_,onSupplierSelect:r,suppliers:f})=>{const[b,j]=s.useState(""),[v,I]=s.useState(""),[P,B]=s.useState("name"),[R,A]=s.useState(!1),[E,i]=s.useState(null),[S,w]=s.useState(!1),[u,C]=s.useState(null),[Q,ee]=s.useState(!1),[te,G]=s.useState(!1);Jr(a),s.useEffect(()=>{if(a){const d=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=d}}},[a]);const h=s.useMemo(()=>{const d=new Set(f.map(L=>L.country).filter(Boolean));return Array.from(d).sort()},[f]),n=s.useMemo(()=>{let d=f.filter(L=>{var T,U,V,$,Y,O;if(b.trim()){const ae=b.toLowerCase();if(!((((T=L.name)==null?void 0:T.toLowerCase())||"").includes(ae)||(((U=L.company_name)==null?void 0:U.toLowerCase())||"").includes(ae)||(((V=L.contactPerson)==null?void 0:V.toLowerCase())||"").includes(ae)||(L.phone||"").includes(ae)||((($=L.email)==null?void 0:$.toLowerCase())||"").includes(ae)||(((Y=L.city)==null?void 0:Y.toLowerCase())||"").includes(ae)||(((O=L.country)==null?void 0:O.toLowerCase())||"").includes(ae)))return!1}return!(v&&L.country!==v)});return d.sort((L,T)=>{var $,Y;const U=(($=L.name)==null?void 0:$.toLowerCase())==="lin",V=((Y=T.name)==null?void 0:Y.toLowerCase())==="lin";if(U&&!V)return-1;if(!U&&V)return 1;switch(P){case"name":return(L.name||"").localeCompare(T.name||"");case"orders":return(T.ordersCount||0)-(L.ordersCount||0);case"recent":const O=L.lastOrderDate?new Date(L.lastOrderDate).getTime():0;return(T.lastOrderDate?new Date(T.lastOrderDate).getTime():0)-O;case"rating":return Number(T.rating||0)-Number(L.rating||0);default:return 0}}),d},[f,b,v,P]),g=d=>{const L={id:d.id,name:d.name,company_name:d.company_name,contact_person:d.contact_person||d.contactPerson,email:d.email,phone:d.phone,whatsapp:d.whatsapp,wechat:d.wechat,address:d.address,city:d.city,country:d.country,tax_id:d.tax_id,payment_terms:d.payment_terms,preferred_currency:d.preferred_currency,notes:d.notes,is_active:d.is_active??d.isActive,created_at:d.created_at||d.lastOrderDate||new Date().toISOString(),updated_at:d.updated_at||new Date().toISOString()};C(L),ee(!0),w(!1)},N=async d=>{if(u)try{G(!0);const L=await Nr(u.id,d);m.success("Supplier updated successfully!"),ee(!1),C(null)}catch(L){const T=L instanceof Error?L.message:"Failed to update supplier";m.error(T),console.error("Error updating supplier:",L)}finally{G(!1)}};return a?Us.createPortal(e.jsxs("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[99999]",style:{top:0,left:0,right:0,bottom:0,overflow:"hidden",overscrollBehavior:"none"},role:"dialog","aria-modal":"true","aria-labelledby":"supplier-modal-title",onClick:_,children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",onClick:d=>d.stopPropagation(),children:[e.jsx("button",{onClick:_,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ft,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"supplier-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Select Supplier"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a supplier for your purchase order"})]})]})}),e.jsxs("div",{className:"p-6 pb-0 flex-shrink-0",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ss,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search suppliers by name, contact, phone, email...",value:b,onChange:d=>j(d.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200"})]})}),e.jsx("div",{children:e.jsxs("select",{value:v,onChange:d=>I(d.target.value),className:"w-full px-3 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200",children:[e.jsx("option",{value:"",children:"All Countries"}),h.map(d=>e.jsx("option",{value:d,children:d},d))]})})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-4",children:[n.length," of ",f.length," suppliers"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:n.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 py-4",children:n.map(d=>{var T;const L=((T=d.name)==null?void 0:T.toLowerCase())==="lin";return Zr(d.notes),e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 hover:shadow-lg hover:scale-[1.02] cursor-pointer relative ${L?"border-orange-400 shadow-lg":"border-gray-200 hover:border-orange-300"}`,onClick:U=>{U.stopPropagation(),r(d)},children:[e.jsx("button",{onClick:U=>{U.stopPropagation(),i(d),w(!0)},className:"absolute top-3 right-3 w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-orange-500 text-gray-600 hover:text-white rounded-lg transition-all duration-200 shadow-sm hover:shadow-md z-10",title:"View supplier details",children:e.jsx(kr,{className:"w-4 h-4"})}),e.jsxs("div",{className:"p-4 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg flex-shrink-0 ${L?"bg-gradient-to-br from-orange-500 via-amber-500 to-orange-600":"bg-gradient-to-br from-orange-500 to-amber-600"}`,children:d.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 truncate",children:d.name}),L&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm flex-shrink-0",children:e.jsx(Be,{className:"w-3 h-3"})})]}),d.company_name&&d.company_name!==d.name&&e.jsx("p",{className:"text-xs text-gray-600 truncate mt-1",children:d.company_name})]})]}),e.jsx("div",{className:"space-y-2 mb-4 flex-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Orders"}),e.jsx("div",{className:"font-bold text-gray-900 text-sm",children:d.ordersCount||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Currency"}),e.jsxs("div",{className:"font-bold text-gray-900 text-sm flex items-center justify-center gap-1",children:[d.country&&e.jsx("span",{children:Wr(d.country)}),e.jsx("span",{children:d.preferred_currency||d.currency||"TZS"})]})]})]}),e.jsxs("button",{onClick:U=>{U.stopPropagation(),r(d)},className:"w-full py-2.5 px-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg font-semibold text-sm flex items-center justify-center gap-2 mt-auto",children:[e.jsx(Be,{className:"w-4 h-4"}),"Select"]})]})]},d.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(Xe,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"No suppliers found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:b||v?"Try adjusting your search criteria":"No suppliers available"})]})}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsxs("button",{type:"button",onClick:()=>A(!0),className:"w-full px-6 py-3.5 bg-gradient-to-r from-orange-500 to-amber-600 text-white rounded-xl font-semibold hover:from-orange-600 hover:to-amber-700 transition-all shadow-lg hover:shadow-xl text-lg flex items-center justify-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Add New Supplier"]})})]}),e.jsx(Ws,{isOpen:R,onClose:()=>A(!1),onSupplierCreated:()=>{A(!1)}}),E&&S&&e.jsx(Gr,{supplier:{...E,contact_person:E.contactPerson,is_active:E.isActive,created_at:E.lastOrderDate||new Date().toISOString(),updated_at:new Date().toISOString()},onClose:()=>{w(!1),i(null)},onUpdate:()=>{},onEdit:g,onSupplierSelect:d=>{r(d),w(!1),i(null)}}),Q&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:e.jsx(Yr,{supplier:u,onSubmit:N,onCancel:()=>{ee(!1),C(null)},loading:te})})})]}),document.body):null},xa=({isOpen:a,onClose:_,onLoadDraft:r,onSaveDraft:f,currentDraft:b})=>{const[j,v]=s.useState([]);s.useState(!1);const[I,P]=s.useState(""),[B,R]=s.useState(!1);s.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),s.useEffect(()=>{a&&A()},[a]);const A=()=>{try{const u=localStorage.getItem("purchase_order_drafts");if(u){const C=JSON.parse(u);v(C.sort((Q,ee)=>new Date(ee.updatedAt).getTime()-new Date(Q.updatedAt).getTime()))}}catch(u){console.error("Error loading drafts:",u),m.error("Failed to load drafts")}},E=u=>{r(u),_(),m.success(`Loaded draft: ${u.name}`)},i=()=>{if(!I.trim()){m.error("Please enter a draft name");return}if(!b||!b.supplier||!b.cartItems||b.cartItems.length===0){m.error("No purchase order data to save");return}const u={id:`draft_${Date.now()}`,name:I.trim(),supplier:b.supplier,cartItems:b.cartItems,currency:b.currency,paymentTerms:b.paymentTerms||"net_30",notes:b.notes||"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{const C=JSON.parse(localStorage.getItem("purchase_order_drafts")||"[]"),Q=[u,...C];localStorage.setItem("purchase_order_drafts",JSON.stringify(Q)),v(Q),P(""),R(!1),f(u),m.success(`Draft saved: ${u.name}`)}catch(C){console.error("Error saving draft:",C),m.error("Failed to save draft")}},S=u=>{try{const C=j.filter(Q=>Q.id!==u);localStorage.setItem("purchase_order_drafts",JSON.stringify(C)),v(C),m.success("Draft deleted")}catch(C){console.error("Error deleting draft:",C),m.error("Failed to delete draft")}},w=u=>new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Purchase Order Drafts"}),e.jsx("button",{onClick:_,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Te,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>R(!B),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(cs,{className:"w-4 h-4"}),"Save Current Draft"]}),B&&e.jsx("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:I,onChange:u=>P(u.target.value),placeholder:"Enter draft name...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Save"}),e.jsx("button",{onClick:()=>R(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cancel"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Saved Drafts"}),j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ts,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No drafts saved yet"}),e.jsx("p",{className:"text-sm",children:"Save your current purchase order as a draft to continue later"})]}):e.jsx("div",{className:"grid gap-4",children:j.map(u=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:u.name}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm text-gray-600",children:[u.supplier&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Supplier: ",u.supplier.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsxs("span",{children:[u.cartItems.length," items"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Updated: ",w(u.updatedAt)]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>E(u),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Load"}),e.jsx("button",{onClick:()=>S(u.id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:"Delete"})]})]})},u.id))})]})]})]})}):null},ma=({isOpen:a,onClose:_,onSave:r,initialData:f})=>{const[b,j]=s.useState({expectedDelivery:"",shippingAddress:{street:"",city:"Dar es Salaam",region:"Dar es Salaam",country:"Tanzania",postalCode:""},billingAddress:{street:"",city:"Dar es Salaam",region:"Dar es Salaam",country:"Tanzania",postalCode:""},shippingMethod:"standard",trackingNumber:"",notes:""}),[v,I]=s.useState(!0),[P,B]=s.useState(!1),[R,A]=s.useState([]),[E,i]=s.useState([]),[S,w]=s.useState(null),[u,C]=s.useState(""),[Q,ee]=s.useState(!0);s.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),s.useEffect(()=>{a&&te()},[a]);const te=async()=>{ee(!0);try{const[n,g,N]=await Promise.all([Xt.agents.getAll(!0),Xt.methods.getAll(!0),Xt.settings.get()]);A(n),i(g),w(N),N&&!f&&(j(d=>({...d,shippingAddress:{...d.shippingAddress,street:N.default_shipping_address_street||d.shippingAddress.street,city:N.default_shipping_address_city||d.shippingAddress.city,region:N.default_shipping_address_region||d.shippingAddress.region,country:N.default_shipping_address_country||d.shippingAddress.country,postalCode:N.default_shipping_address_postal_code||d.shippingAddress.postalCode}})),N.default_agent_id&&C(N.default_agent_id))}catch(n){console.error("Error loading shipping data:",n),m.error("Failed to load shipping configuration")}finally{ee(!1)}};s.useEffect(()=>{a&&f&&j(n=>({...n,...f,shippingAddress:{...n.shippingAddress,...f.shippingAddress},billingAddress:{...n.billingAddress,...f.billingAddress}}))},[a,f]),s.useEffect(()=>{v&&j(n=>({...n,billingAddress:n.shippingAddress}))},[v,b.shippingAddress]);const G=(n,g,N)=>{j(N?d=>({...d,[N+"Address"]:{...d[N+"Address"],[n]:g}}):d=>({...d,[n]:g}))},h=async()=>{if(!b.expectedDelivery){m.error("Please select expected delivery date");return}if(!b.shippingAddress.street||!b.shippingAddress.city){m.error("Please complete shipping address");return}if(!v&&(!b.billingAddress.street||!b.billingAddress.city)){m.error("Please complete billing address");return}B(!0);try{await r(b),m.success("Shipping configuration saved"),_()}catch(n){console.error("Error saving shipping configuration:",n),m.error("Failed to save shipping configuration")}finally{B(!1)}};return a?Q?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl p-8 max-w-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading shipping configuration..."})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Shipping Configuration"}),e.jsx("button",{onClick:_,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Te,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Lt,{className:"w-4 h-4 inline mr-2"}),"Expected Delivery Date"]}),e.jsx("input",{type:"date",value:b.expectedDelivery,onChange:n=>G("expectedDelivery",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]})]}),R.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Bs,{className:"w-4 h-4 inline mr-2"}),"Shipping Agent / Freight Forwarder"]}),e.jsxs("select",{value:u,onChange:n=>C(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select shipping agent (optional)"}),R.map(n=>e.jsxs("option",{value:n.id,children:[n.name," ",n.is_preferred&&"â­",n.company_name&&` - ${n.company_name}`]},n.id))]}),u&&(()=>{const n=R.find(g=>g.id===u);return n?e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-900 font-medium mb-1",children:[e.jsx(Xe,{className:"w-4 h-4"}),n.name]}),n.phone&&e.jsxs("div",{className:"text-blue-700",children:["ðŸ“ž ",n.phone]}),n.email&&e.jsxs("div",{className:"text-blue-700",children:["ðŸ“§ ",n.email]}),e.jsx("div",{className:"flex gap-2 mt-2",children:n.shipping_methods.map(g=>e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-blue-200 text-blue-800 rounded-full",children:[g==="sea"&&"ðŸš¢",g==="air"&&"âœˆï¸",g==="road"&&"ðŸš›"," ",g.charAt(0).toUpperCase()+g.slice(1)]},g))})]}):null})()]}),E.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ft,{className:"w-4 h-4 inline mr-2"}),"Shipping Method"]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:E.map(n=>e.jsxs("label",{className:`flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all ${b.shippingMethod===n.code?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:"shippingMethod",value:n.code,checked:b.shippingMethod===n.code,onChange:g=>G("shippingMethod",g.target.value),className:"sr-only"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.code==="sea"&&e.jsx(Pr,{className:"w-4 h-4 text-blue-600"}),n.code.includes("air")&&e.jsx(Er,{className:"w-4 h-4 text-blue-600"}),n.code==="road"&&e.jsx(ft,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:n.name})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[n.estimated_days_min,"-",n.estimated_days_max," days"]})]})]},n.id))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Dr,{className:"w-4 h-4 inline mr-2"}),"Shipping Address"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Street Address",value:b.shippingAddress.street,onChange:n=>G("street",n.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("input",{type:"text",placeholder:"City",value:b.shippingAddress.city,onChange:n=>G("city",n.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Region/State",value:b.shippingAddress.region,onChange:n=>G("region",n.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Postal Code",value:b.shippingAddress.postalCode,onChange:n=>G("postalCode",n.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Country",value:b.shippingAddress.country,onChange:n=>G("country",n.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",id:"useSameAddress",checked:v,onChange:n=>I(n.target.checked),className:"mr-2"}),e.jsx("label",{htmlFor:"useSameAddress",className:"text-sm font-medium text-gray-700",children:"Use same address for billing"})]}),!v&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Billing Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Street Address",value:b.billingAddress.street,onChange:n=>G("street",n.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("input",{type:"text",placeholder:"City",value:b.billingAddress.city,onChange:n=>G("city",n.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Region/State",value:b.billingAddress.region,onChange:n=>G("region",n.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Postal Code",value:b.billingAddress.postalCode,onChange:n=>G("postalCode",n.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Country",value:b.billingAddress.country,onChange:n=>G("country",n.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(qe,{className:"w-4 h-4 inline mr-2"}),"Tracking Number (Optional)"]}),e.jsx("input",{type:"text",placeholder:"Enter tracking number if available",value:b.trackingNumber,onChange:n=>G("trackingNumber",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Shipping Notes (Optional)"}),e.jsx("textarea",{placeholder:"Any special shipping instructions...",value:b.notes,onChange:n=>G("notes",n.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50",children:[e.jsx("button",{onClick:_,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{onClick:h,disabled:P,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(cs,{className:"w-4 h-4"}),P?"Saving...":"Save Configuration"]})]})]})}):null},ua=({item:a,index:_,currency:r,exchangeRates:f,isLatest:b=!1,onUpdateQuantity:j,onUpdateCostPrice:v,onRemove:I})=>{const[P,B]=s.useState(!1),[R,A]=s.useState(!1),[E,i]=s.useState(a.costPrice.toString());let S;try{S=Kr()}catch(g){console.warn("GeneralSettings hook not available:",g),S={show_product_images:!0,enable_animations:!0}}const w=s.useMemo(()=>!a.images||a.images.length===0?[]:a.images.map((g,N)=>({id:`temp-${a.productId}-${N}`,url:g,thumbnailUrl:g,fileName:`product-image-${N+1}`,fileSize:0,isPrimary:N===0,uploadedAt:new Date().toISOString()})),[a.images,a.productId]),u=s.useMemo(()=>{if(!(f!=null&&f.trim()))return null;const g=[/1\s*([A-Z]{3})\s*=\s*([\d,]+\.?\d*)\s*([A-Z]{3})/i,/([\d,]+\.?\d*)\s*([A-Z]{3})\s*=\s*1\s*([A-Z]{3})/i,/([\d,]+\.?\d*)/i];for(const N of g){const d=f.match(N);if(d){if(d.length===4){const L=d[1]||d[3],T=d[3]||d[1],U=parseFloat(d[2].replace(/,/g,""));if(L===r.code&&T==="TZS")return U;if(L==="TZS"&&T===r.code)return 1/U}else if(d.length===2)return parseFloat(d[1].replace(/,/g,""))}}return null},[f,r.code]),C=s.useMemo(()=>g=>r.code==="TZS"?g:u?g*u:g,[u,r.code]),Q=()=>{B(!P)},ee=g=>{const N=Math.max(1,a.quantity+g);j(a.id,N)},te=()=>{const g=parseFloat(E);!isNaN(g)&&g>0&&v(a.id,g),A(!1)},G=()=>{i(a.costPrice.toString()),A(!1)},n=(()=>{const g=a.currentStock||0;return g===0?{status:"out",color:"text-red-600",bg:"bg-red-50"}:g<=5?{status:"low",color:"text-amber-600",bg:"bg-amber-50"}:{status:"good",color:"text-green-600",bg:"bg-green-50"}})();return e.jsxs("div",{className:`bg-white border-2 rounded-xl ${S!=null&&S.enable_animations?"transition-all duration-300":""} ${P?"border-orange-300 shadow-lg":"border-gray-200 hover:border-orange-300 hover:shadow-md"} ${b?"ring-2 ring-orange-200 ring-opacity-50":""}`,children:[e.jsx("div",{className:"p-4 cursor-pointer",onClick:Q,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"relative w-12 h-12 rounded-xl overflow-hidden",children:S!=null&&S.show_product_images&&w.length>0?e.jsx(Gs,{images:w,productName:a.name,size:"lg",className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-500 to-amber-600 flex items-center justify-center text-lg font-bold text-white",children:a.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-800 truncate text-lg leading-tight",children:a.name}),a.variantName&&a.variantName!=="Default"&&e.jsx("div",{className:"text-sm text-gray-600",children:a.variantName}),e.jsxs("div",{className:"text-lg text-orange-600 mt-1 font-bold",children:[ce(a.totalPrice,r),r.code!=="TZS"&&f&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["â‰ˆ ",ce(C(a.totalPrice),{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-lg text-sm font-medium",children:[a.quantity,"Ã—"]}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg",children:P?e.jsx(Ot,{size:16}):e.jsx($t,{size:16})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),I(a.id)},className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-all duration-200",title:"Remove from cart",children:e.jsx(rs,{className:"w-4 h-4"})})]})]})}),P&&e.jsx("div",{className:"px-4 pb-4 border-t border-gray-100 bg-gradient-to-br from-orange-50/30 to-amber-50/30",children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ar,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"SKU:"}),e.jsx("span",{className:"font-medium",children:a.sku})]}),a.category&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tr,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"font-medium",children:a.category})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`flex items-center gap-2 ${n.color}`,children:[e.jsx(We,{className:"w-4 h-4"}),e.jsx("span",{className:"text-gray-600",children:"Current Stock:"}),e.jsx("span",{className:`font-medium px-2 py-1 rounded ${n.bg} ${n.color}`,children:a.currentStock||0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vs,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Unit Cost:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:ce(a.costPrice,r)}),r.code!=="TZS"&&f&&e.jsxs("div",{className:"text-xs text-blue-600",children:["â‰ˆ ",ce(C(a.costPrice),{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cost Price"}),!R&&e.jsx("button",{onClick:()=>A(!0),className:"text-xs text-orange-600 hover:text-orange-700",children:"Edit"})]}),R?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",value:E,onChange:g=>i(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",step:"0.01",min:"0",placeholder:"0.00"})}),e.jsx("button",{onClick:te,className:"px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm",children:"Save"}),e.jsx("button",{onClick:G,className:"px-3 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 text-sm",children:"Cancel"})]}):e.jsxs("div",{className:"text-lg font-bold text-orange-600",children:[ce(a.costPrice,r),r.code!=="TZS"&&f&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["â‰ˆ ",ce(C(a.costPrice),{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-lg p-3 border border-orange-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Order Quantity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>ee(-1),disabled:a.quantity<=1,className:"w-8 h-8 flex items-center justify-center border-2 border-orange-300 rounded-lg hover:bg-orange-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(as,{className:"w-4 h-4 text-orange-600"})}),e.jsx("span",{className:"w-12 text-center font-bold text-lg text-gray-900",children:a.quantity}),e.jsx("button",{onClick:()=>ee(1),className:"w-8 h-8 flex items-center justify-center border-2 border-orange-300 rounded-lg hover:bg-orange-50 transition-colors",children:e.jsx(Ve,{className:"w-4 h-4 text-orange-600"})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-orange-600 font-medium",children:"Total Cost:"}),e.jsxs("div",{className:"text-lg font-bold text-orange-700",children:[ce(a.totalPrice,r),r.code!=="TZS"&&f&&e.jsxs("div",{className:"text-xs text-blue-600",children:["â‰ˆ ",ce(C(a.totalPrice),{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-orange-600 font-medium",children:"Needed:"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[a.quantity," units to stock"]})]})]}),(a.currentStock||0)===0&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-red-600",children:[e.jsx(We,{className:"w-3 h-3"}),e.jsx("span",{children:"Out of stock - Reorder needed"})]})]})]})})]})},ha=({isOpen:a,onClose:_,product:r,currency:f,onAddToCart:b,onProductUpdated:j})=>{var me,$e,Ce;const v=je.find(o=>o.code==="TZS")||je[0],I=f||v,[P,B]=s.useState(null),[R,A]=s.useState(1),[E,i]=s.useState(""),[S,w]=s.useState(!1),[u,C]=s.useState(I),[Q,ee]=s.useState(1),[te]=s.useState(1),[G,h]=s.useState(2),[n,g]=s.useState(!1),[N,d]=s.useState(new Map),[L,T]=s.useState(!1),[U,V]=s.useState(new Set),[$,Y]=s.useState(new Map),[O,ae]=s.useState(!1),[ve,he]=s.useState(null),[pe,we]=s.useState(!1),fe=vr(),[H,ke]=s.useState("details"),[le,de]=s.useState(!1),[ue,tt]=s.useState(!1),{history:ie,stats:z,isLoading:Le}=ea(ue?r==null?void 0:r.id:void 0);s.useEffect(()=>{f&&C(f)},[f]),s.useEffect(()=>{a&&u&&u.code!==f.code&&Oe(u.code,f.code)},[a,u==null?void 0:u.code,f.code]),s.useEffect(()=>{H==="history"&&!ue&&(r!=null&&r.id)&&(console.log("ðŸ“Š User switched to History tab - loading purchase order history..."),tt(!0))},[H,ue,r==null?void 0:r.id]),s.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),s.useEffect(()=>{a||(tt(!1),ke("details"),V(new Set),d(new Map),g(!1))},[a]);const be=u||I;s.useEffect(()=>{a||(B(null),de(!1))},[a]),s.useEffect(()=>{a&&(r!=null&&r.variants)&&r.variants.length>1&&de(!P)},[a,(me=r==null?void 0:r.variants)==null?void 0:me.length,P]),s.useEffect(()=>{B(null)},[r==null?void 0:r.id]),s.useEffect(()=>{if(r&&!P){const o=r.preSelectedVariant;if(o){console.log("âœ… Using pre-selected variant:",o),B(o);return}r.variants&&r.variants.length===1&&(console.log("âœ… Auto-selecting single variant:",r.variants[0].name),B(r.variants[0]))}},[r==null?void 0:r.id,r==null?void 0:r.variants]),s.useEffect(()=>{if(!S){if(r&&(z!=null&&z.lastCostPrice)&&z.lastCostPrice>0)i(z.lastCostPrice.toString());else if(r){const o=r.costPrice||(r.price||0)*.7;o>0&&i(o.toString())}}},[z,r,S]),s.useEffect(()=>{w(!1)},[r==null?void 0:r.id]),s.useEffect(()=>{if(a&&(r!=null&&r.id)){const D=ve?new Date().getTime()-ve.getTime():1/0,y=30*1e3;if(D<y&&$.has(r.id))return;const se=setTimeout(()=>{Pe()},100);return()=>clearTimeout(se)}},[a,r==null?void 0:r.id]);const k=o=>o.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).replace(/\.00$/,"").replace(/\.0$/,""),Pe=async()=>{if(r!=null&&r.id)try{ae(!0);const D=await Qr.getInstance().getStockLevels([r.id]),y=new Map;Object.entries(D).forEach(([se,ge])=>{const Ee=ge.reduce((re,Fe)=>re+Fe.quantity,0);y.set(se,Ee)}),Y(y),he(new Date)}catch(o){console.error("Error fetching real-time stock:",o)}finally{ae(!1)}},Oe=async(o,D)=>{try{const y=await Os.getExchangeRate(o,D);return console.log(`âœ… Loaded exchange rate: ${o} to ${D} = ${y.rate} (source: ${y.source})`),ee(y.rate),y.rate}catch(y){return console.error("Error loading exchange rate:",y),ee(1),1}},ct=s.useMemo(()=>!(r!=null&&r.images)||r.images.length===0?[]:r.images.map((o,D)=>({id:`temp-${r.id}-${D}`,url:o,thumbnailUrl:o,fileName:`product-image-${D+1}`,fileSize:0,isPrimary:D===0,uploadedAt:new Date().toISOString()})),[r==null?void 0:r.images,r==null?void 0:r.id]),K=(o,D)=>{const y=new Map(N),se=y.get(o);se&&(y.set(o,{...se,quantity:Math.max(1,D)}),d(y))},Se=(o,D)=>{const y=new Map(N),se=y.get(o);se&&(y.set(o,{...se,costPrice:D}),d(y))},q=()=>{if(N.size===0){m.error("Please select at least one variant");return}let o=0;N.forEach(({variant:D,quantity:y,costPrice:se})=>{const ge=parseFloat(se)||D.costPrice||0;if(ge>0){const Ee={...D,costPrice:ge};b(r,Ee,y),o++}}),o>0&&(m.success(`Added ${o} variant(s) to purchase order`),_())};if(!a||!r||!be||!f)return null;const Ie=Hr(r),De=parseFloat(E)||0,ze=()=>r!=null&&r.id&&$.get(r.id)||0,xe=()=>{if(!r.variants||r.variants.length===0)return r.stockQuantity??r.totalQuantity??0;console.log("ðŸ” [PO Modal] Debug Stock Calculation:",{productName:r.name,totalVariants:r.variants.length,variants:r.variants.map(y=>({name:y.name,quantity:y.quantity||y.stockQuantity,parent_variant_id:y.parent_variant_id,variant_type:y.variant_type,variantType:y.variantType}))});const o=r.variants.filter(y=>!(y.parent_variant_id||y.variant_type==="imei_child"||y.variantType==="imei_child"||y.name&&y.name.toLowerCase().includes("imei:"))),D=o.reduce((y,se)=>{const ge=se.stockQuantity??se.quantity??0;return y+ge},0);return console.log("ðŸ” [PO Modal] Stock Calculation Result:",{parentVariantsCount:o.length,totalStock:D,parentVariants:o.map(y=>({name:y.name,stock:y.stockQuantity??y.quantity??0}))}),D},Ae=ze(),Ye=xe();console.log("ðŸ” [PO Modal] Final Stock Decision:",{realTimeStockValue:Ae,calculatedStock:Ye,willUse:Ae||Ye});const He=Ae||Ye,_e=(()=>He===0?{status:"Out of Stock",color:"text-red-600",bg:"bg-red-50",border:"border-red-200"}:He<=G?{status:"Below Min Stock",color:"text-red-600",bg:"bg-red-50",border:"border-red-200"}:He<=5?{status:"Low Stock",color:"text-amber-600",bg:"bg-amber-50",border:"border-amber-200"}:{status:"In Stock",color:"text-green-600",bg:"bg-green-50",border:"border-green-200"})(),dt=o=>{A(Math.max(1,R+o))},st=o=>{h(Math.max(0,G+o))},Ft=o=>{B(o);const D=(z==null?void 0:z.lastCostPrice)||r.costPrice||(r.price||0)*.7;i(D.toString())},rt=o=>be.code===f.code?o:o*Q,X=async()=>{if(!P){m.error("Please select a variant");return}if(De<=0){m.error('Please enter a cost price above 0 in the "Cost Price (per unit)" field');return}if(R<te){m.error(`Minimum order quantity is ${te} units`);return}try{we(!0);const o=be.code!==f.code?rt(De):De;if((await fe.updateProductVariantCostPrice(P.id,o)).ok&&(m.success("Cost price updated and saved!"),j)){const se={...r,costPrice:o,minimumStock:G};j(se)}const y={...P,costPrice:o};b(r,y,R),m.success(`Added ${R}x ${r.name} to purchase order`),be.code!==f.code&&Q!==1&&await Os.saveExchangeRate(be.code,f.code,Q),_()}catch(o){console.error("Error saving cost price:",o),m.error("Failed to save cost price, but product will still be added to cart");const D={...P,costPrice:be.code!==f.code?rt(De):De};b(r,D,R),m.success(`Added ${R}x ${r.name} to purchase order`),_()}finally{we(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"product-modal-title",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:_,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(qe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{id:"product-modal-title",className:"text-2xl font-bold text-gray-900 mb-3",children:r.name}),e.jsx("p",{className:"text-gray-600",children:"Review and customize before adding to purchase order"})]})]})}),e.jsx("div",{className:"border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex gap-2 px-8",children:[e.jsx("button",{onClick:()=>ke("details"),className:`px-6 py-3 font-semibold text-sm transition-all relative ${H==="details"?"text-orange-600 border-b-2 border-orange-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Product Details"}),e.jsxs("button",{onClick:()=>ke("history"),className:`px-6 py-3 font-semibold text-sm transition-all relative ${H==="history"?"text-orange-600 border-b-2 border-orange-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:["Purchase History",ie.length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-orange-100 text-orange-600 text-xs rounded-full font-medium",children:ie.length})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:[H==="details"&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 border-gray-200 p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:ct.length>0?e.jsx(Gs,{images:ct.map(o=>o.url),productName:r.name,size:"md",className:"w-24 h-24 rounded-lg"}):e.jsx("div",{className:"w-24 h-24 bg-orange-100 rounded-lg flex items-center justify-center border-2 border-dashed border-orange-400",children:e.jsx(zs,{className:"w-6 h-6 text-orange-500"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Product Name"}),e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:r.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Category"}),e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:r.categoryName||"Uncategorized"})]}),r.barcode&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Barcode"}),e.jsx("p",{className:"font-semibold text-gray-900 font-mono text-sm",children:r.barcode})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200",children:O?e.jsxs("div",{className:"flex items-center justify-center gap-2 py-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-2 border-orange-600 border-t-transparent"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Loading stock..."})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"w-3.5 h-3.5 text-gray-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Current Stock:"}),!O&&$.has(r.id)&&e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"(Live)"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${He===0?"bg-red-500":He<=5?"bg-orange-500":"bg-green-500"}`}),e.jsx("span",{className:`text-lg font-bold ${_e.color}`,children:He}),e.jsx("span",{className:`text-xs font-medium ${_e.color}`,children:"units"})]})]})})]})]})}),Ie&&e.jsxs("div",{children:[P&&!n?e.jsx("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${le?"border-blue-500 shadow-xl":"border-green-200 hover:border-green-300 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start justify-between p-6 cursor-pointer",onClick:()=>de(!le),children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center transition-colors ${le?"bg-blue-500":"bg-green-500"}`,children:e.jsx("svg",{className:`w-4 h-4 text-white transition-transform duration-200 ${le?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:P.name}),!le&&(P.quantity||0)===0?e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 border border-red-200",children:"Out of Stock"}):!le&&(P.quantity||0)<=5?e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700 border border-orange-200 animate-pulse",children:"Low Stock"}):le?null:e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Done"]})]}),le?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-600 flex items-center gap-1.5",children:[e.jsx("span",{className:`inline-flex items-center justify-center w-5 h-5 rounded-full text-xs font-bold ${(P.quantity||0)===0?"bg-red-500 text-white":(P.quantity||0)<=5?"bg-orange-500 text-white":"bg-green-500 text-white"}`,children:P.quantity||0}),e.jsx("span",{className:"text-gray-500",children:"units available"})]}),r.variants&&r.variants.length>1&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-purple-50 text-purple-700 border border-purple-200",children:[r.variants.length," devices"]})]}):e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Stock: ",P.quantity||0]})]})]})}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:!le&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:o=>{o.stopPropagation(),g(!0),T(!0)},className:"px-3 py-1.5 bg-gradient-to-r from-purple-500 to-purple-600 text-white hover:from-purple-600 hover:to-purple-700 rounded-lg text-xs font-bold transition-all flex items-center gap-1 shadow-sm hover:shadow-md",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),"Multiple"]}),e.jsxs("button",{onClick:o=>{o.stopPropagation(),de(!le)},className:"px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:from-indigo-700 hover:to-purple-700 rounded-xl text-xs font-bold transition-all flex items-center gap-1.5 shadow-md hover:shadow-lg",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Change"]})]})})]})}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{g(!1),de(!0)},className:"flex-1 px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center justify-center gap-1.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md hover:shadow-lg hover:from-indigo-700 hover:to-purple-700",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"One"]}),e.jsxs("button",{onClick:()=>{g(!0),T(!0)},className:"flex-1 px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center justify-center gap-1.5 bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-md hover:shadow-lg hover:from-purple-600 hover:to-purple-700",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),"Multiple"]})]}),le&&!n&&e.jsx("div",{className:"bg-white p-6 border-t-2 border-gray-200 rounded-b-2xl",children:e.jsx("div",{className:"space-y-3",children:($e=r.variants)==null?void 0:$e.map(o=>{const D=(P==null?void 0:P.id)===o.id;return e.jsxs("div",{onClick:()=>{Ft(o),de(!1)},className:`group relative border-2 rounded-2xl bg-white transition-all duration-300 cursor-pointer overflow-hidden ${D?"border-green-400 shadow-md":"border-gray-200 hover:border-blue-400 hover:-translate-y-0.5"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-300 ${D?"bg-gradient-to-br from-green-100 to-green-200":"bg-gradient-to-br from-gray-100 to-gray-200 group-hover:from-blue-50 group-hover:to-indigo-50"}`,children:e.jsx(qe,{className:`w-6 h-6 transition-colors ${D?"text-green-600":"text-gray-400 group-hover:text-blue-500"}`})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-900 truncate",children:o.name}),D?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Done"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-md text-sm font-medium bg-blue-50 text-blue-700 border border-blue-200",children:["Stock: ",o.quantity??o.stockQuantity??o.stock_quantity??0]})]})})]}),e.jsx("div",{className:"flex flex-col items-end gap-2 ml-4",children:e.jsx("button",{className:`px-6 py-2.5 rounded-xl font-bold transition-all transform hover:scale-105 ${D?"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white":"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white"}`,children:D?"Selected":"Select"})})]}),e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${D?"from-green-500/5 via-green-500/10 to-green-500/5":"from-blue-500/0 via-blue-500/0 to-blue-500/0 group-hover:from-blue-500/5 group-hover:via-blue-500/10 group-hover:to-blue-500/5"} transition-all duration-300 pointer-events-none rounded-2xl`})]},o.id)})})})]}),n&&N.size>0&&e.jsxs("div",{className:"border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 border-green-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Et,{className:"w-4 h-4 text-green-600"}),"Order Summary (",N.size," variants)"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-2",children:Array.from(N.values()).map(({variant:o,quantity:D,costPrice:y})=>{const se=parseFloat(y)||0,ge=se*D;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-2xl border-2 border-gray-200 shadow-sm hover:border-blue-300 transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:o.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[D," units Ã— ",ce(se,be)]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-bold text-green-600 text-lg",children:ce(ge,be)})}),e.jsxs("button",{onClick:()=>{T(!0),V(new Set([o.id]));const Ee=new Map(N),re=Ee.get(o.id);re&&(Ee.set(o.id,{...re,configured:!1}),d(Ee))},className:"px-3 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 shadow-md hover:shadow-lg",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Edit"]})]})]},o.id)})}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-2xl p-4 shadow-sm border-2 border-gray-200",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total Amount"}),e.jsx("span",{className:"text-3xl font-bold text-orange-600",children:ce(Array.from(N.values()).reduce((o,{quantity:D,costPrice:y})=>o+(parseFloat(y)||0)*D,0),be)})]})})]}),!n&&P&&e.jsx("div",{className:"border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 border-gray-200 p-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:"Cost Price (per unit) *"}),(z==null?void 0:z.lastCostPrice)&&z.lastCostPrice>0&&e.jsxs("button",{type:"button",onClick:()=>{i((z.lastCostPrice||0).toString()),w(!1),m.success("Last purchase price filled!")},className:"text-xs text-orange-600 hover:text-orange-700 font-semibold flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-orange-50 border border-orange-200 transition-colors whitespace-nowrap",children:[e.jsx(bt,{className:"w-3 h-3"}),"Last"]})]}),e.jsxs("div",{className:"border-2 border-gray-300 rounded-xl overflow-hidden focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-200 transition-all",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"border-r-2 border-gray-300 bg-gray-50",children:e.jsx("select",{value:be.code,onChange:async o=>{const D=je.find(y=>y.code===o.target.value);D&&(C(D),D.code!==f.code?await Oe(D.code,f.code):ee(1))},className:"h-full px-2 py-3 bg-transparent border-none text-gray-900 font-bold cursor-pointer focus:outline-none focus:ring-0 text-xs",children:je.map(o=>e.jsxs("option",{value:o.code,children:[o.flag," ",o.code]},o.code))})}),e.jsx("input",{type:"text",value:E?k(parseFloat(E)):"",onChange:o=>{const D=o.target.value.replace(/,/g,"");(D===""||parseFloat(D)>=0)&&(i(D),w(!0))},onFocus:o=>{E&&parseFloat(E)>0&&o.target.select()},onClick:o=>{E&&parseFloat(E)>0&&o.target.select()},placeholder:"0",className:"flex-1 px-3 py-3 border-0 focus:outline-none focus:ring-0 text-xl font-bold text-gray-900 placeholder-gray-400 bg-white",step:"0.01",min:"0"})]}),be.code!==f.code&&E&&parseFloat(E)>0&&e.jsxs("div",{className:"px-2 py-1.5 flex items-center justify-between text-xs border-t border-gray-200 bg-blue-50",children:[e.jsxs("span",{className:"text-gray-600 font-medium",children:["= ",f.code,":"]}),e.jsx("span",{className:"font-bold text-blue-600",children:ce(rt(parseFloat(E)),f).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-3",children:"Order Quantity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>dt(-1),disabled:R<=1,className:"w-12 h-12 flex items-center justify-center rounded-xl border-2 border-gray-200 text-gray-700 hover:bg-gray-100 transition disabled:opacity-40 disabled:cursor-not-allowed text-lg",children:e.jsx(as,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",value:R,onChange:o=>{const D=parseInt(o.target.value)||1;A(Math.max(1,D))},min:"1",className:"w-28 px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-200/50 text-center font-bold text-xl [appearance:textfield] [-moz-appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),e.jsx("button",{type:"button",onClick:()=>dt(1),className:"w-12 h-12 flex items-center justify-center rounded-xl border-2 border-gray-200 text-gray-700 hover:bg-gray-100 transition text-lg",children:e.jsx(Ve,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-3",children:"Minimum Stock Alert"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>st(-1),disabled:G<=0,className:"w-12 h-12 flex items-center justify-center rounded-xl border-2 border-gray-200 text-gray-700 hover:bg-gray-100 transition disabled:opacity-40 disabled:cursor-not-allowed text-lg",children:e.jsx(as,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",value:G,onChange:o=>{const D=parseInt(o.target.value)||0;h(Math.max(0,D))},min:"0",className:"w-28 px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-200/50 text-center font-bold text-xl [appearance:textfield] [-moz-appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),e.jsx("button",{type:"button",onClick:()=>st(1),className:"w-12 h-12 flex items-center justify-center rounded-xl border-2 border-gray-200 text-gray-700 hover:bg-gray-100 transition text-lg",children:e.jsx(Ve,{className:"w-5 h-5"})})]})]})]})})]}),H==="history"&&e.jsx("div",{className:"space-y-4 py-4",children:Le?e.jsx("div",{className:"border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-center py-6",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("span",{className:"ml-3 text-gray-600 text-sm",children:"Loading purchase history..."})]})}):!z||ie.length===0?e.jsx("div",{className:"border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 border-gray-200 p-8",children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:e.jsx(ft,{className:"w-8 h-8 text-blue-500"})}),e.jsx("p",{className:"text-gray-600 font-medium",children:"No purchase history"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will be the first order for this product"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 border-gray-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Is,{className:"w-4 h-4 text-blue-600"}),"Purchase Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Orders"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:z.totalOrders})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Quantity"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:z.totalQuantityOrdered}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Received: ",z.totalQuantityReceived]})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Average Cost"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:ce(z.averageCostPrice,f)})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Last Order"}),e.jsx("p",{className:"text-sm font-bold text-gray-900",children:z.lastOrderDate?new Date(z.lastOrderDate).toLocaleDateString():"N/A"})]})]})]}),z.lowestCostPrice&&z.highestCostPrice&&e.jsxs("div",{className:"border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Price Range"}),z.lastCostPrice&&e.jsx("div",{className:"flex items-center gap-1",children:z.lastCostPrice<z.averageCostPrice?e.jsxs(e.Fragment,{children:[e.jsx(Ir,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Below average"})]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm text-red-600 font-medium",children:"Above average"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Lowest"}),e.jsx("div",{className:"font-bold text-green-700 text-lg",children:ce(z.lowestCostPrice,f)})]}),e.jsx("div",{className:"flex-1 mx-6",children:e.jsx("div",{className:"h-3 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Highest"}),e.jsx("div",{className:"font-bold text-red-700 text-lg",children:ce(z.highestCostPrice,f)})]})]})]}),ie.length>0&&e.jsxs("div",{className:"border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Lt,{className:"w-4 h-4 text-purple-600"}),"Order History"]}),e.jsxs("span",{className:"text-sm font-medium text-gray-600 bg-gray-200 px-3 py-1 rounded-full",children:[ie.length," orders"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:ie.map(o=>e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 p-4 hover:border-blue-300 hover:shadow-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-mono text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded",children:["#",o.orderNumber]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-semibold ${o.poStatus==="completed"||o.poStatus==="received"?"bg-green-100 text-green-700 border border-green-300":o.poStatus==="cancelled"?"bg-red-100 text-red-700 border border-red-300":o.poStatus==="shipped"||o.poStatus==="partial_received"?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-700 border border-gray-300"}`,children:o.poStatus.replace(/_/g," ").toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Supplier"}),e.jsx("div",{className:"font-semibold text-gray-900 mt-1",children:o.supplierName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Date"}),e.jsx("div",{className:"font-semibold text-gray-900 mt-1",children:new Date(o.orderDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Quantity"}),e.jsxs("div",{className:"font-semibold text-gray-900 mt-1 flex items-center gap-1",children:[o.receivedQuantity,"/",o.quantity,o.receivedQuantity===o.quantity&&e.jsx(Et,{className:"w-4 h-4 text-green-600"})]})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cost per unit"}),e.jsx("div",{className:"font-bold text-orange-600 text-lg",children:ce(o.costPrice,f)})]})})]},o.id))})]})]})})]}),H==="details"&&e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsx("button",{type:"button",onClick:n?q:X,disabled:n?N.size===0||pe:!P||De<=0||pe,className:"w-full px-6 py-3.5 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg flex items-center justify-center gap-2",children:pe?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-5 h-5"}),e.jsx("span",{children:n?`Add ${N.size} Variant${N.size!==1?"s":""} to Order`:"Add to Order"})]})})})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[99999]",role:"dialog","aria-modal":"true","aria-labelledby":"variant-modal-title",onClick:()=>T(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{onClick:()=>T(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(qe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"variant-modal-title",className:"text-2xl font-bold text-gray-900 mb-3",children:"Select Multiple Variants"}),e.jsxs("div",{className:"flex items-center gap-4",children:[N.size>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),e.jsxs("span",{className:"text-sm font-bold text-green-700",children:[Array.from(N.values()).filter(o=>o.configured).length," Configured"]})]}),N.size>0&&Array.from(N.values()).some(o=>!o.configured)&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg animate-pulse",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[Array.from(N.values()).filter(o=>!o.configured).length," Pending"]})]})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsx("div",{className:"space-y-4 py-4",children:(Ce=r.variants)==null?void 0:Ce.slice().sort((o,D)=>{const y=N.get(o.id),se=N.get(D.id),ge=(y==null?void 0:y.configured)===!0,Ee=(se==null?void 0:se.configured)===!0;return ge&&!Ee?1:!ge&&Ee?-1:0}).map(o=>{const D=N.has(o.id),y=N.get(o.id),se=U.has(o.id),ge=D&&(y==null?void 0:y.configured)===!0,Ee=y?parseFloat(y.costPrice)*y.quantity:0;return e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${se?"border-blue-500 shadow-xl":ge?"border-green-200 hover:border-green-300 hover:shadow-md":D?"border-orange-300 hover:border-orange-400 hover:shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start justify-between p-6 cursor-pointer",onClick:()=>{var Fe;const re=new Map(N);U.forEach(at=>{const Je=re.get(at);at!==o.id&&Je&&parseFloat(Je.costPrice)>0&&Je.quantity>0&&re.set(at,{...Je,configured:!0})}),D?U.has(o.id)?(y&&parseFloat(y.costPrice)>0&&y.quantity>0&&re.set(o.id,{...y,configured:!0}),d(re),V(new Set)):(y&&re.set(o.id,{...y,configured:!1}),d(re),V(new Set([o.id]))):(re.set(o.id,{variant:o,quantity:1,costPrice:((Fe=o.costPrice)==null?void 0:Fe.toString())||E||"",configured:!1}),d(re),V(new Set([o.id])))},children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center transition-colors ${se?"bg-blue-500":"bg-gray-200"}`,children:e.jsx("svg",{className:`w-4 h-4 text-white transition-transform duration-200 ${se?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:o.name}),ge?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Done"]}):D?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-orange-500 text-white shadow-sm animate-pulse",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Pending"]}):null]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Quantity: ",(y==null?void 0:y.quantity)||0]})]})]})}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:ge&&y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-2 rounded-xl text-base font-bold shadow-sm bg-green-100 text-green-700 border border-green-200",children:[be.symbol," ",k(Ee)]}),e.jsxs("span",{className:"text-xs text-blue-600 font-medium flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Click to edit"]})]})})]}),se&&D&&y&&e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Cost Price *"}),e.jsx("input",{type:"text",value:k(parseFloat(y.costPrice)||0),onFocus:re=>{(parseFloat(y.costPrice)===0||!y.costPrice)&&re.target.select()},onChange:re=>{const Fe=re.target.value.replace(/,/g,"");(Fe===""||!isNaN(parseFloat(Fe)))&&Se(o.id,Fe)},className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-xl font-bold bg-white",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsxs("div",{className:"flex items-center border-2 border-gray-300 rounded-xl focus-within:border-purple-500 focus-within:ring-2 focus-within:ring-purple-200 bg-white",children:[e.jsx("button",{type:"button",onClick:re=>{re.stopPropagation(),K(o.id,y.quantity-1)},disabled:y.quantity<=1,className:"flex-shrink-0 px-4 py-3 text-gray-900 hover:bg-gray-100 disabled:bg-gray-100 disabled:text-gray-400 transition-colors border-r border-gray-300",children:e.jsx("span",{className:"text-2xl font-bold",children:"âˆ’"})}),e.jsx("input",{type:"number",value:y.quantity,onFocus:re=>re.target.select(),onChange:re=>K(o.id,parseInt(re.target.value)||1),onClick:re=>re.stopPropagation(),className:"flex-1 px-4 py-3 border-0 focus:outline-none focus:ring-0 text-gray-900 text-xl font-bold bg-white text-center min-w-0",min:"1"}),e.jsx("button",{type:"button",onClick:re=>{re.stopPropagation(),K(o.id,y.quantity+1)},className:"flex-shrink-0 px-4 py-3 text-gray-900 hover:bg-gray-100 transition-colors border-l border-gray-300",children:e.jsx("span",{className:"text-2xl font-bold",children:"+"})})]})]})]})})]},o.id)})})}),e.jsxs("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex gap-4 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>{d(new Map),V(new Set),T(!1),g(!1)},className:"px-8 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 rounded-xl transition-all font-bold shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Clear All"]}),e.jsxs("button",{onClick:()=>{const o=new Map(N);U.forEach(D=>{const y=o.get(D);y&&parseFloat(y.costPrice)>0&&y.quantity>0&&o.set(D,{...y,configured:!0})}),d(o),T(!1)},disabled:N.size===0,className:"flex-1 px-8 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white hover:from-green-600 hover:to-green-700 rounded-xl font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl flex items-center justify-center gap-2",children:[e.jsx(Et,{className:"w-5 h-5"}),e.jsxs("span",{children:["Confirm Selection (",N.size,")"]})]})]})]})})]})},ga=[{keys:["Ctrl","F"],description:"Focus search bar",category:"navigation"},{keys:["Ctrl","K"],description:"Focus search (alternative)",category:"navigation"},{keys:["Esc"],description:"Clear search / Close modals",category:"navigation"},{keys:["Ctrl","S"],description:"Save as Draft",category:"actions"},{keys:["Ctrl","Enter"],description:"Create Purchase Order",category:"actions"},{keys:["Ctrl","Shift","S"],description:"Open Supplier Selector",category:"actions"},{keys:["Ctrl","Shift","P"],description:"Add New Product",category:"actions"},{keys:["Ctrl","B"],description:"Toggle Barcode Scanner",category:"actions"},{keys:["Ctrl","I"],description:"Bulk Import from CSV",category:"actions"},{keys:["Ctrl","E"],description:"Export to Excel",category:"actions"},{keys:["Ctrl","Shift","C"],description:"Clear Cart",category:"cart"},{keys:["+"],description:"Increase quantity (in cart)",category:"cart"},{keys:["-"],description:"Decrease quantity (in cart)",category:"cart"},{keys:["?"],description:"Show this help",category:"modals"},{keys:["Esc"],description:"Close any modal",category:"modals"}],pa=({isOpen:a,onClose:_})=>{if(es.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),!a)return null;const r={navigation:"Navigation",actions:"Actions",cart:"Cart Management",modals:"Modals"};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(Mt,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Keyboard Shortcuts"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Speed up your workflow with these shortcuts"})]})]}),e.jsx("button",{onClick:_,className:"w-10 h-10 flex items-center justify-center bg-white/20 hover:bg-white/30 text-white rounded-full transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"space-y-6",children:Object.entries(r).map(([f,b])=>{const j=ga.filter(v=>v.category===f);return j.length===0?null:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-blue-600"}),b]}),e.jsx("div",{className:"space-y-2",children:j.map((v,I)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700",children:v.description}),e.jsx("div",{className:"flex items-center gap-1",children:v.keys.map((P,B)=>e.jsxs(es.Fragment,{children:[B>0&&e.jsx("span",{className:"text-gray-400 text-sm mx-1",children:"+"}),e.jsx("kbd",{className:"px-3 py-1.5 bg-white border-2 border-gray-300 rounded-lg text-sm font-semibold text-gray-700 shadow-sm min-w-[40px] text-center",children:P})]},B))})]},I))})]},f)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ns,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"ðŸ’¡ Pro Tip"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["Use ",e.jsx("kbd",{className:"px-2 py-1 bg-white border border-blue-300 rounded text-xs font-semibold",children:"Ctrl+F"})," to quickly find products, then ",e.jsx("kbd",{className:"px-2 py-1 bg-white border border-blue-300 rounded text-xs font-semibold",children:"Ctrl+Enter"})," to create your PO in seconds!"]})]})]})})]}),e.jsx("div",{className:"p-6 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Press ",e.jsx("kbd",{className:"px-2 py-1 bg-white border border-gray-300 rounded text-xs font-semibold",children:"?"})," anytime to show this help"]}),e.jsx("button",{onClick:_,className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Got it!"})]})})]})})},fa=({selectedSupplierId:a,selectedSupplierName:_,onAddToCart:r,className:f="",isExpanded:b=!1,onToggle:j})=>{const[v,I]=s.useState([]),[P,B]=s.useState(!1);s.useEffect(()=>{R()},[a]);const R=async()=>{var i,S;B(!0);try{let w=Qe.from("lats_product_variants").select("id, variant_name, sku, quantity, min_quantity, cost_price, product_id").eq("is_active",!0).order("quantity",{ascending:!0});const{data:u,error:C}=await w;if(C)throw C;if(!u||u.length===0){I([]);return}const Q=u.filter(O=>(O.quantity||0)<=(O.min_quantity||0)).slice(0,20),ee=[...new Set(Q.map(O=>O.product_id).filter(Boolean))],{data:te,error:G}=await Qe.from("lats_products").select(`
          id,
          name,
          supplier_id
        `).in("id",ee);if(G)throw G;const h=(te==null?void 0:te.map(O=>O.supplier_id).filter(Boolean))||[],[n,g]=await Promise.all([h.length>0?Qe.from("lats_suppliers").select("id, name").in("id",h):Promise.resolve({data:[],error:null}),Qe.from("lats_categories").select("id, name")]),N=new Map((te==null?void 0:te.map(O=>[O.id,O]))||[]),d=new Map(((i=n.data)==null?void 0:i.map(O=>[O.id,O]))||[]),L=new Map(((S=g.data)==null?void 0:S.map(O=>[O.id,O]))||[]),{data:T,error:U}=await Qe.from("lats_products").select("id, category_id").in("id",ee),V=new Map((T==null?void 0:T.map(O=>[O.id,O.category_id]))||[]),$=Q.map(O=>{var pe,we;const ae=N.get(O.product_id),ve=ae==null?void 0:ae.supplier_id,he=V.get(O.product_id);return{id:(ae==null?void 0:ae.id)||O.product_id,name:(ae==null?void 0:ae.name)||"Unknown Product",sku:O.sku,stockQuantity:O.quantity||0,minStockLevel:O.min_quantity||0,supplierId:ve,supplierName:ve&&((pe=d.get(ve))==null?void 0:pe.name)||"Unknown",costPrice:O.cost_price||0,categoryName:he&&((we=L.get(he))==null?void 0:we.name)||"Uncategorized",variantId:O.id,variantName:O.variant_name}}),Y=a?$.filter(O=>O.supplierId===a):$;I(Y)}catch(w){console.error("Error loading low stock products:",w),m.error("Failed to load low stock products")}finally{B(!1)}},A=i=>{const S=Math.max(i.minStockLevel-i.stockQuantity,i.minStockLevel),w={id:i.id,name:i.name,supplierId:i.supplierId},u={id:i.variantId,name:i.variantName,sku:i.sku,costPrice:i.costPrice};r(w,u,S),m.success(`Added ${i.name} (Qty: ${S})`)},E=()=>{if(v.length===0){m.error("No low stock products to add");return}v.forEach(i=>{A(i)}),m.success(`Added ${v.length} low stock items to cart`)};return b?e.jsxs("div",{className:`bg-gradient-to-br from-red-50 to-orange-50 border-2 border-red-200 rounded-xl shadow-lg overflow-hidden ${f}`,children:[e.jsx("div",{className:"p-4 border-b border-red-200 bg-white/50 cursor-pointer hover:bg-red-50/50 transition-colors",onClick:j,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center",children:e.jsx(We,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:["Low Stock Alert",v.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-bold rounded-full",children:v.length})]}),e.jsx("p",{className:"text-xs text-gray-600",children:a&&_?`From ${_}`:a?"From selected supplier":"All suppliers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),R()},disabled:P,className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Refresh",children:e.jsx(et,{className:`w-4 h-4 text-gray-600 ${P?"animate-spin":""}`})}),e.jsx("div",{className:"p-2 text-red-600",children:e.jsx(Ot,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"p-4",children:P?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(et,{className:"w-8 h-8 animate-spin text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading low stock items..."})]}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(qe,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"All Good! ðŸŽ‰"}),e.jsx("p",{className:"text-xs text-gray-600",children:"No low stock items found"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:E,className:"w-full mb-4 flex items-center justify-center gap-2 px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Add All ",v.length," Items to Cart"]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:v.map(i=>{const S=i.stockQuantity===0?"critical":i.stockQuantity<=Math.floor(i.minStockLevel/2)?"high":"medium",w=S==="critical"?"bg-red-600":S==="high"?"bg-orange-500":"bg-yellow-500";return e.jsx("div",{className:"bg-white border border-red-200 rounded-lg p-3 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm truncate",children:i.name}),e.jsx("span",{className:`px-2 py-0.5 ${w} text-white text-xs font-bold rounded-full flex-shrink-0`,children:S.toUpperCase()})]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:[i.variantName," â€¢ SKU: ",i.sku]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Stock:"}),e.jsx("span",{className:"font-bold text-red-600",children:i.stockQuantity}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsxs("span",{className:"text-gray-500",children:[i.minStockLevel," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Need:"}),e.jsx("span",{className:"font-bold text-orange-600",children:Math.max(i.minStockLevel-i.stockQuantity,i.minStockLevel)})]})]})]}),e.jsx("button",{onClick:()=>A(i),className:"flex-shrink-0 p-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors",title:"Add to cart",children:e.jsx(Ve,{className:"w-4 h-4"})})]})},`${i.id}-${i.variantId}`)})})]})})]}):e.jsx("div",{className:`bg-gradient-to-r from-red-50 to-orange-50 border-2 border-red-200 rounded-xl p-3 cursor-pointer hover:bg-red-50/80 transition-colors ${f}`,children:e.jsxs("div",{onClick:j,className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Low Stock Items"}),v.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-bold rounded-full",children:v.length})]}),e.jsx($t,{className:"w-5 h-5 text-red-600"})]})})},ba=({selectedSupplierId:a,currency:_,onAddToCart:r,className:f="",isExpanded:b=!1,onToggle:j})=>{const[v,I]=s.useState([]),[P,B]=s.useState(!1);s.useEffect(()=>{R()},[a]);const R=async()=>{B(!0);try{const i=new Date;i.setDate(i.getDate()-90);let S=Qe.from("lats_purchase_orders").select("id, order_date, supplier_id").gte("order_date",i.toISOString()).order("order_date",{ascending:!1});a&&(S=S.eq("supplier_id",a));const{data:w,error:u}=await S;if(u)throw u;if(!w||w.length===0){I([]),B(!1);return}const C=w.map(te=>te.id),{data:Q,error:ee}=await Qe.from("lats_purchase_order_items").select(`
          product_id,
          variant_id,
          quantity_ordered,
          unit_cost,
          purchase_order_id,
          product:lats_products(
            id,
            name
          ),
          variant:lats_product_variants(
            id,
            variant_name,
            sku
          )
        `).in("purchase_order_id",C);if(ee)throw ee;if(Q){const te=new Map(w.map(d=>[d.id,d])),G=[...new Set(w.map(d=>d.supplier_id).filter(Boolean))],{data:h}=await Qe.from("lats_suppliers").select("id, name").in("id",G),n=new Map((h==null?void 0:h.map(d=>[d.id,d]))||[]),g=new Map;Q.forEach(d=>{const L=`${d.product_id}-${d.variant_id}`,T=te.get(d.purchase_order_id);if(T)if(g.has(L)){const U=g.get(L);U.orderCount++}else{const U=T.supplier_id?n.get(T.supplier_id):null;g.set(L,{productId:d.product_id,productName:d.product.name,variantId:d.variant_id,variantName:d.variant.variant_name,sku:d.variant.sku,lastOrderedDate:T.order_date,lastOrderedQuantity:d.quantity_ordered,lastCostPrice:d.unit_cost,orderCount:1,supplierId:T.supplier_id,supplierName:(U==null?void 0:U.name)||"Unknown"})}});const N=Array.from(g.values()).sort((d,L)=>new Date(L.lastOrderedDate).getTime()-new Date(d.lastOrderedDate).getTime()).slice(0,15);I(N)}}catch(i){console.error("Error loading recently ordered products:",i),m.error("Failed to load recently ordered products")}finally{B(!1)}},A=i=>{const S={id:i.productId,name:i.productName,supplierId:i.supplierId},w={id:i.variantId,name:i.variantName,sku:i.sku,costPrice:i.lastCostPrice};r(S,w,i.lastOrderedQuantity),m.success(`Added ${i.productName} (${i.lastOrderedQuantity} units)`)},E=i=>{const S=new Date(i),u=Math.floor((new Date().getTime()-S.getTime())/(1e3*60*60*24));return u===0?"Today":u===1?"Yesterday":u<7?`${u} days ago`:u<30?`${Math.floor(u/7)} weeks ago`:`${Math.floor(u/30)} months ago`};return b?e.jsxs("div",{className:`bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl shadow-lg overflow-hidden ${f}`,children:[e.jsx("div",{className:"p-4 border-b border-blue-200 bg-white/50 cursor-pointer hover:bg-blue-50/50 transition-colors",onClick:j,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(Yt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:["Recently Ordered",v.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs font-bold rounded-full",children:v.length})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Last 90 days"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),R()},disabled:P,className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Refresh",children:e.jsx(et,{className:`w-4 h-4 text-gray-600 ${P?"animate-spin":""}`})}),e.jsx("div",{className:"p-2 text-blue-600",children:e.jsx(Ot,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"p-4",children:P?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(et,{className:"w-8 h-8 animate-spin text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading order history..."})]}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Yt,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No Recent Orders"}),e.jsx("p",{className:"text-xs text-gray-600",children:a?"No orders from this supplier in the last 90 days":"No purchase orders in the last 90 days"})]}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:v.map(i=>e.jsx("div",{className:"bg-white border border-blue-200 rounded-lg p-3 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm truncate mb-1",children:i.productName}),e.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:[i.variantName," â€¢ SKU: ",i.sku]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qs,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:E(i.lastOrderedDate)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Last qty:"}),e.jsx("span",{className:"font-semibold text-blue-600",children:i.lastOrderedQuantity})]}),i.orderCount>1&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-semibold",children:[i.orderCount,"x ordered"]})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Last price:"}),e.jsx("span",{className:"font-semibold text-gray-900 ml-1",children:ce(i.lastCostPrice,_)})]})]}),e.jsxs("button",{onClick:()=>A(i),className:"flex-shrink-0 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-xs font-medium flex items-center gap-1",title:"Reorder with same quantity",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Reorder"]})]})},`${i.productId}-${i.variantId}`))})})]}):e.jsx("div",{className:`bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-3 cursor-pointer hover:bg-blue-50/80 transition-colors ${f}`,children:e.jsxs("div",{onClick:j,className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Recently Ordered"}),v.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs font-bold rounded-full",children:v.length})]}),e.jsx($t,{className:"w-5 h-5 text-blue-600"})]})})},ya=({isOpen:a,onClose:_,onScanSuccess:r,products:f})=>{const[b,j]=s.useState("manual"),[v,I]=s.useState(""),[P,B]=s.useState([]),[R,A]=s.useState(!1),E=s.useRef(null);s.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),s.useEffect(()=>{var w;a&&b==="manual"&&((w=E.current)==null||w.focus())},[a,b]),s.useEffect(()=>{if(!a||b!=="manual")return;let w="",u;const C=Q=>{Q.target!==E.current&&Q.target.tagName==="INPUT"||(clearTimeout(u),Q.key==="Enter"&&w.length>0?(i(w),w=""):Q.key.length===1&&(w+=Q.key,u=setTimeout(()=>{w.length>=8&&i(w),w=""},100)))};return window.addEventListener("keypress",C),()=>{window.removeEventListener("keypress",C),clearTimeout(u)}},[a,b,f]);const i=async w=>{if(!w||w.trim()==="")return;A(!0);const u=w.trim();try{const C=f.find(ee=>ee.variants&&ee.variants.length>0?ee.variants.some(te=>te.sku===u||te.barcode===u):!1),Q={barcode:u,time:new Date,found:!!C};B(ee=>[Q,...ee.slice(0,9)]),C?(m.success(`Found: ${C.name}`),r(u),I("")):m.error(`Product not found for barcode: ${u}`)}catch(C){console.error("Error processing barcode:",C),m.error("Failed to process barcode")}finally{A(!1)}},S=w=>{w.preventDefault(),i(v)};return a?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(_t,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Barcode Scanner"}),e.jsx("p",{className:"text-green-100 text-sm",children:"Scan products to add to purchase order"})]})]}),e.jsx("button",{onClick:_,className:"w-10 h-10 flex items-center justify-center bg-white/20 hover:bg-white/30 text-white rounded-full transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>j("manual"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ${b==="manual"?"bg-green-600 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(Mt,{className:"w-5 h-5"}),"Manual / Scanner Input"]}),e.jsxs("button",{onClick:()=>{m("Camera scanning: Use manual input with USB barcode scanner",{icon:"ðŸ“¸"})},disabled:!0,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed opacity-60",title:"Camera scanning not available - use manual input with USB scanner",children:[e.jsx(zs,{className:"w-5 h-5"}),"Camera Scanner"]})]})}),e.jsx("div",{className:"p-6",children:b==="manual"?e.jsxs("div",{className:"space-y-6",children:[e.jsx("form",{onSubmit:S,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Enter or Scan Barcode / SKU"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:E,type:"text",value:v,onChange:w=>I(w.target.value),placeholder:"Scan barcode or type SKU...",className:"w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-xl focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all",disabled:R}),R&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-5 h-5 border-2 border-green-600 border-t-transparent rounded-full animate-spin"})})]})]}),e.jsxs("button",{type:"submit",disabled:!v.trim()||R,className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-xl font-semibold transition-colors flex items-center justify-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),R?"Processing...":"Find Product"]})]})}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-xl",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(_t,{className:"w-4 h-4"}),"How to Use"]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"USB Scanner:"})," Just scan - it will auto-submit"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Manual Entry:"})," Type SKU and press Enter or click Find"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Quick Scan:"})," Keep this window open for continuous scanning"]})]})]}),P.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(History,{className:"w-4 h-4"}),"Recent Scans (",P.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:P.map((w,u)=>e.jsxs("div",{className:`p-3 rounded-lg border-2 flex items-center justify-between ${w.found?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[w.found?e.jsx(Be,{className:"w-5 h-5 text-green-600"}):e.jsx(Tt,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-mono font-semibold text-gray-900",children:w.barcode}),e.jsx("p",{className:"text-xs text-gray-600",children:w.time.toLocaleTimeString()})]})]}),e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded ${w.found?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:w.found?"Found":"Not Found"})]},u))})]})]}):null}),e.jsx("div",{className:"p-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Press ",e.jsx("kbd",{className:"px-2 py-1 bg-white border border-gray-300 rounded text-xs font-semibold",children:"Ctrl+B"})," to toggle scanner"]}),e.jsx("button",{onClick:_,className:"px-6 py-2.5 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Close Scanner"})]})})]})}):null},ja=({isOpen:a,onClose:_,onImport:r,products:f})=>{const[b,j]=s.useState([]),[v,I]=s.useState(!1),[P,B]=s.useState(!1),R=s.useRef(null);s.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]);const A=async h=>{var L;const n=(L=h.target.files)==null?void 0:L[0];if(!n)return;const g=n.name.toLowerCase(),N=g.endsWith(".xlsx")||g.endsWith(".xls"),d=g.endsWith(".csv");if(N)await E(n);else if(d){const T=new FileReader;T.onload=U=>{var V;try{const $=(V=U.target)==null?void 0:V.result;i($)}catch{m.error("Failed to read CSV file")}},T.readAsText(n)}else m.error("Unsupported file format. Please upload CSV or Excel (.xlsx, .xls) file")},E=async h=>{I(!0);try{const n=await pt(()=>import("./utils-ebb5cecb.js"),[]),g=await h.arrayBuffer(),N=n.read(g,{type:"array"}),d=N.SheetNames[0],L=N.Sheets[d],T=n.utils.sheet_to_json(L,{header:1,defval:""});if(T.length<2){m.error("Excel file must contain at least a header row and one data row"),I(!1);return}const U=(T[0]||[]).map(fe=>String(fe||"").toLowerCase().trim()),V=fe=>{for(const H of fe){const ke=H.toLowerCase();let le=U.findIndex(de=>de===ke);if(le>=0||(le=U.findIndex(de=>de.includes(ke)),le>=0))return le}return-1},$=V(["sku","product sku","product_sku"]),Y=V(["quantity","qty","qty to order"]),O=V(["costprice","cost price","cost_price","price"]),ae=V(["notes","note","comments"]),ve=V(["variantname","variant name","variant_name"]);if($===-1)if(U.length>0&&U[0])console.log("Using position-based parsing for simplified template structure");else{m.error("Could not find SKU column in Excel file. Please check the template format."),I(!1);return}const he=[];for(let fe=1;fe<T.length;fe++){const H=T[fe];if(!H||H.length===0)continue;const ke=$>=0?String(H[$]||"").trim():String(H[0]||"").trim();let le=1;Y>=0?le=parseFloat(String(H[Y]||"0"))||1:H[1]!==void 0&&H[1]!==null&&H[1]!==""&&(le=parseFloat(String(H[1]))||1);let de;if(O>=0&&H[O]!==void 0&&H[O]!==null&&H[O]!=="")de=parseFloat(String(H[O]));else if(H[2]!==void 0&&H[2]!==null&&H[2]!==""){const be=parseFloat(String(H[2]));isNaN(be)||(de=be)}const ue=ae>=0?String(H[ae]||"").trim():H[3]?String(H[3]).trim():"",tt=ve>=0?String(H[ve]||"").trim():"";if(!ke)continue;const ie=String(H[0]||"").toLowerCase();if(ie.includes("instruction")||ie.includes("required")||ie.includes("optional")||ie.includes("auto-filled")||ie.includes("tips:")||ie.includes("quick start")||ie.includes("important:")||ie.startsWith("â•")||ie.startsWith("ðŸ“‹")||ie.startsWith("âœ…")||ie.startsWith("ðŸ”„")||ie.startsWith("ðŸ’¡")||ie.startsWith("ðŸ“")||ie.startsWith("âš ï¸"))continue;const z={sku:ke,variantName:tt,quantity:le||1,costPrice:de,notes:ue,rowIndex:fe+1,status:"pending"},Le=S(z.sku);Le?z.quantity<=0?(z.status="invalid",z.error="Invalid quantity"):(z.status="valid",z.productName=Le.product.name,z.foundVariantName=Le.variant.name,z.currentStock=Le.variant.quantity||0,z.suggestedCostPrice=Le.variant.costPrice||Le.product.costPrice,!z.costPrice&&z.suggestedCostPrice&&(z.costPrice=z.suggestedCostPrice)):(z.status="invalid",z.error="Product/Variant not found"),he.push(z)}j(he);const pe=he.filter(fe=>fe.status==="valid").length,we=he.filter(fe=>fe.status==="invalid").length;pe>0?m.success(`âœ… Parsed ${pe} valid items from Excel${we>0?` (${we} invalid)`:""}`):m.error("No valid items found in Excel file")}catch(n){console.error("Error parsing Excel:",n),m.error(`Failed to parse Excel file: ${n instanceof Error?n.message:"Unknown error"}`)}finally{I(!1)}},i=h=>{I(!0);try{const n=h.split(`
`).filter(T=>T.trim());if(n.length===0){m.error("File is empty");return}const g=n[0].toLowerCase().includes("sku")?1:0,N=[];for(let T=g;T<n.length;T++){const U=n[T].trim();if(!U||U.startsWith("#"))continue;const V=U.split(/[,;\t]/).map(O=>O.trim().replace(/^"|"$/g,""));if(V.length<2)continue;const $={sku:V[0]||"",variantName:V[1]||"",quantity:parseInt(V[2])||1,costPrice:V[3]?parseFloat(V[3]):void 0,notes:V[4]||"",rowIndex:T+1,status:"pending"},Y=S($.sku);Y?$.quantity<=0?($.status="invalid",$.error="Invalid quantity"):($.status="valid",$.productName=Y.product.name,$.foundVariantName=Y.variant.name,$.currentStock=Y.variant.quantity||0,$.suggestedCostPrice=Y.variant.costPrice||Y.product.costPrice,!$.costPrice&&$.suggestedCostPrice&&($.costPrice=$.suggestedCostPrice)):($.status="invalid",$.error="Product/Variant not found"),N.push($)}j(N);const d=N.filter(T=>T.status==="valid").length,L=N.filter(T=>T.status==="invalid").length;d>0?m.success(`Parsed ${d} valid items${L>0?` (${L} invalid)`:""}`):m.error("No valid items found in file")}catch(n){console.error("Error parsing CSV:",n),m.error("Failed to parse CSV file")}finally{I(!1)}},S=h=>{for(const n of f)if(n.variants&&n.variants.length>0){const g=n.variants.find(N=>N.sku===h||N.barcode===h);if(g)return{product:n,variant:g}}return null},w=async(h="csv")=>{if(h==="excel"){await u();return}const n=`# ============================================================================
# PURCHASE ORDER BULK IMPORT TEMPLATE - COMPREHENSIVE EDITION
# ============================================================================
# 
# REQUIRED COLUMNS (must be filled):
# 1. SKU* - Product variant SKU from your inventory (MUST match exactly)
# 2. Quantity* - Number of units to order
#
# IMPORTANT COLUMNS (recommended):
# 3. ProductName - Full product name (for reference, helps verify correct item)
# 4. VariantName - Variant specification (e.g., "128GB Black", "Size M")
# 5. CostPrice - Cost per unit (if blank, uses last purchase price)
#
# REFERENCE COLUMNS (helpful for decision making):
# 6. Category - Product category (Electronics, Clothing, etc.)
# 7. CurrentStock - Current inventory level (helps identify what needs restocking)
# 8. MinStock - Minimum stock level (reorder point)
# 9. LastPurchasePrice - Historical cost price for comparison
# 10. SellingPrice - Current selling price (for margin calculation)
# 11. Supplier - Preferred supplier name
# 12. Notes - Additional information (urgent, quality concerns, etc.)
#
# TIPS FOR SUCCESS:
# - SKU is the ONLY required field that must match your inventory exactly
# - You can delete any reference columns you don't need
# - Multiple rows can have the same product but different variants
# - Cost prices should be in your base currency (e.g., TZS, USD)
# - Use CurrentStock and MinStock columns to prioritize orders
# - The system validates all SKUs before importing
# - Lines starting with # are comments and will be ignored
#
# QUICK START:
# 1. Keep the header row (line below this)
# 2. Replace sample data with your actual order items
# 3. Fill at minimum: SKU and Quantity
# 4. Upload the file to see validation and enriched preview
#
# CSV FORMAT:
SKU,ProductName,VariantName,Category,CurrentStock,MinStock,Quantity,CostPrice,LastPurchasePrice,SellingPrice,Supplier,Notes`,g=[];f.slice(0,10).forEach($=>{if($.variants&&$.variants.length>0){const Y=$.variants[0],O=Y.sku||"SAMPLE-SKU",ae=($.name||"Sample Product").replace(/,/g,";"),ve=(Y.name||"Default").replace(/,/g,";"),he=$.categoryName||$.category||"General",pe=Y.quantity||Y.stockQuantity||0,we=$.minStock||Y.minStockLevel||5,fe=Math.max(we*2-pe,0),H=Y.costPrice||$.costPrice||"",ke=Y.sellingPrice||Y.price||$.price||"",le=$.supplierName||$.supplier||"";let de="";pe===0?de="OUT OF STOCK - URGENT":pe<=we?de="Below minimum stock - reorder":pe<=we*1.5?de="Low stock - consider restocking":de="Regular stock replenishment",g.push(`${O},"${ae}","${ve}",${he},${pe},${we},${fe||10},${H},${H},${ke},"${le}","${de}"`)}}),g.length===0&&g.push('IPHONE14-128GB,"iPhone 14 Pro","128GB Space Gray",Electronics,3,10,15,1200000,1200000,1599000,"Apple Authorized Distributor","Below minimum - urgent restock"','SAMS23-256GB,"Samsung Galaxy S23","256GB Phantom Black",Electronics,0,8,20,1000000,980000,1399000,"Samsung Tanzania Ltd","OUT OF STOCK - Priority order"','MBA-M2-256,"MacBook Air M2 2024","256GB 8GB RAM",Computers,2,5,10,7500000,7500000,9999000,"iStore Tanzania","Low stock - corporate demand"','AIRPODS-PRO2,"Apple AirPods Pro","2nd Generation",Audio,15,20,30,280000,275000,399000,"Apple Authorized Distributor","Regular restock"','GW6-44MM,"Samsung Galaxy Watch 6","44mm Graphite",Wearables,5,10,15,320000,320000,449000,"Samsung Tanzania Ltd","Moderate stock"','IPHONE-CASE-14,"iPhone 14 Pro Case","Silicone Midnight",Accessories,8,25,50,15000,15000,35000,"Mobile Accessories Ltd","Fast moving item"','HDMI-2.1-CABLE,"Premium HDMI 2.1 Cable","2 Meter 8K Support",Cables,12,30,100,8000,7500,18000,"Tech Cables Co","Bulk order - good margin"','USB-C-CHARGER,"65W USB-C Fast Charger","GaN Technology",Chargers,20,30,50,25000,24000,49000,"PowerTech Supplies","Popular accessory"','DELL-XPS13-512,"Dell XPS 13 Laptop","i7 16GB 512GB SSD",Computers,1,3,5,9500000,9500000,12999000,"Dell Tanzania","Premium segment"','SONY-WH1000XM5,"Sony WH-1000XM5","Noise Cancelling Black",Audio,6,8,12,420000,415000,599000,"Sony Electronics EA","High demand product"');const d=`

# ============================================================================
# EXAMPLE MODIFICATIONS YOU CAN MAKE:
# ============================================================================
#
# 1. SIMPLE ORDER (only required fields):
#    IPHONE14-128GB,,,,,10,,,,,,"Quick order"
#
# 2. CUSTOM PRICE:
#    SAMS23-256GB,,,,,5,950000,,,,,,"Negotiated better price"
#
# 3. URGENT ORDER:
#    MBA-M2-256,,,,,3,7500000,,,,,,"URGENT - Customer waiting"
#
# 4. MIXED QUANTITIES FROM SAME PRODUCT:
#    IPHONE14-128GB,"iPhone 14","128GB",Electronics,3,10,10,1200000,,1599000,,"Black color"
#    IPHONE14-256GB,"iPhone 14","256GB",Electronics,1,8,15,1350000,,1799000,,"Black color"
#    IPHONE14-512GB,"iPhone 14","512GB",Electronics,0,5,8,1500000,,1999000,,"OUT OF STOCK"
#
# ============================================================================
# READY TO START? Follow these steps:
# ============================================================================
# 1. DELETE all the lines starting with # (including this section)
# 2. KEEP the header row (SKU,ProductName,VariantName,...)
# 3. MODIFY the sample data rows with your actual order
# 4. SAVE the file
# 5. UPLOAD to see automatic validation and enriched details
# 6. REVIEW the preview with live stock levels and cost prices
# 7. IMPORT to add all items to your purchase order at once!
# ============================================================================`,L=n+`
`+g.join(`
`)+d,T=new Blob([L],{type:"text/csv;charset=utf-8;"}),U=URL.createObjectURL(T),V=document.createElement("a");V.href=U,V.download="purchase-order-bulk-import-template.csv",V.click(),URL.revokeObjectURL(U),m.success("ðŸ“¥ Comprehensive CSV template downloaded with 10 sample products from your inventory!")},u=async()=>{try{I(!0);const h=await pt(()=>import("./utils-ebb5cecb.js"),[]),n=h.utils.book_new(),N=[["SKU *","Quantity *","CostPrice","Notes"]];f.slice(0,10).forEach(U=>{if(U.variants&&U.variants.length>0){const V=U.variants[0],$=V.sku||"SAMPLE-SKU",Y=V.quantity||V.stockQuantity||0,O=U.minStock||V.minStockLevel||5,ae=Math.max(O*2-Y,0)||10,ve=V.costPrice||U.costPrice||"";let he="";Y===0?he="OUT OF STOCK - URGENT":Y<=O?he="Below minimum stock - reorder":Y<=O*1.5&&(he="Low stock - consider restocking"),N.push([$,ae,ve||"",he])}}),N.length===1&&N.push(["IPHONE14-128GB",15,12e5,"Below minimum - urgent restock"],["SAMS23-256GB",20,1e6,"OUT OF STOCK - Priority order"],["MBA-M2-256",10,75e5,"Low stock - corporate demand"],["AIRPODS-PRO2",30,28e4,"Regular restock"],["GW6-44MM",15,32e4,"Moderate stock"]),N.push(["","","",""]),[["â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"],["PURCHASE ORDER IMPORT TEMPLATE - INSTRUCTIONS"],["â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"],[""],["ðŸ“‹ REQUIRED COLUMNS (must be filled):"],["  1. SKU * - Product variant SKU from your inventory (MUST match exactly)"],["  2. Quantity * - Number of units to order"],[""],["âœ… OPTIONAL COLUMNS:"],["  3. CostPrice - Cost per unit (if blank, uses last purchase price automatically)"],["  4. Notes - Additional information (urgent, quality concerns, etc.)"],[""],["ðŸ”„ AUTO-FILLED COLUMNS (filled automatically during import):"],["  â€¢ ProductName - Full product name"],["  â€¢ VariantName - Variant specification"],["  â€¢ Category - Product category"],["  â€¢ CurrentStock - Current inventory level"],["  â€¢ MinStock - Minimum stock level"],["  â€¢ LastPurchasePrice - Historical cost price"],["  â€¢ SellingPrice - Current selling price"],["  â€¢ Supplier - Preferred supplier name"],[""],["ðŸ’¡ TIPS:"],["  â€¢ Only SKU and Quantity are required - fill these for each item you want to order"],["  â€¢ CostPrice is optional - if left blank, the system uses the last purchase price"],["  â€¢ All other product details are automatically filled when you upload the file"],["  â€¢ Use Notes column to mark urgent items or add special instructions"],["  â€¢ You can delete the sample rows above and add your own products"],[""],["ðŸ“ QUICK START:"],["  1. Review the sample products above (you can modify or delete them)"],["  2. Fill in SKU column with product SKUs from your inventory"],["  3. Fill in Quantity column with the number of units to order"],["  4. (Optional) Add CostPrice if different from last purchase price"],["  5. (Optional) Add Notes for any special instructions"],["  6. Save and upload the file"],["  7. Review the preview - all product details will be automatically filled"],["  8. Import to add all items to your purchase order"],[""],["âš ï¸ IMPORTANT:"],["  â€¢ SKU must match exactly with your inventory (case-sensitive)"],["  â€¢ Quantity must be a positive number"],["  â€¢ Invalid SKUs will be highlighted during preview"],["  â€¢ You can preview and validate before importing"],["  â€¢ Delete these instruction rows before uploading if you prefer"]].forEach(U=>{N.push(U)});const T=h.utils.aoa_to_sheet(N);T["!cols"]=[{wch:20},{wch:12},{wch:15},{wch:50}],h.utils.book_append_sheet(n,T,"Purchase Order Items"),h.writeFile(n,"purchase-order-bulk-import-template.xlsx"),m.success("ðŸ“¥ Excel template downloaded! Only essential columns shown - other fields auto-filled on import.")}catch(h){console.error("Error generating Excel template:",h),m.error("Failed to generate Excel template. Falling back to CSV."),w("csv")}finally{I(!1)}},C=()=>{const h=b.filter(g=>g.status==="valid");if(h.length===0){m.error("No valid items to import");return}const n=h.map(g=>({sku:g.sku,quantity:g.quantity,costPrice:g.costPrice,notes:g.notes,variantName:g.foundVariantName}));r(n),m.success(`Importing ${n.length} items...`),_(),j([])},Q=h=>{j(n=>n.filter((g,N)=>N!==h))},ee=()=>{j([]),R.current&&(R.current.value="")};if(!a)return null;const te=b.filter(h=>h.status==="valid").length,G=b.filter(h=>h.status==="invalid").length;return Us.createPortal(e.jsx("div",{className:"fixed bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",style:{top:0,left:0,right:0,bottom:0},children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-100 to-amber-100 p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(gt,{className:"w-10 h-10 text-white"})}),e.jsx("button",{onClick:_,className:"w-9 h-9 flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Bulk Import"}),e.jsx("p",{className:"text-gray-700",children:"Import multiple items from CSV or Excel file"})]}),e.jsxs("div",{className:"p-6 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>{var h;return(h=R.current)==null?void 0:h.click()},disabled:v,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl font-semibold shadow-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ks,{className:"w-5 h-5"}),"Upload File (CSV/Excel)"]})}),e.jsxs("button",{onClick:()=>w("csv"),className:"flex items-center gap-2 px-4 py-3 bg-white border-2 border-gray-300 hover:bg-gray-100 text-gray-700 rounded-xl font-semibold transition-colors",title:"Download CSV template",children:[e.jsx(Mr,{className:"w-5 h-5"}),"CSV"]}),e.jsxs("button",{onClick:()=>w("excel"),className:"flex items-center gap-2 px-4 py-3 bg-white border-2 border-blue-300 hover:bg-blue-50 text-blue-700 rounded-xl font-semibold transition-colors",title:"Download Excel template",children:[e.jsx(gt,{className:"w-5 h-5"}),"Excel"]}),b.length>0&&e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-4 py-3 bg-red-50 border-2 border-red-200 hover:bg-red-100 text-red-700 rounded-xl font-semibold transition-colors",children:[e.jsx(It,{className:"w-5 h-5"}),"Clear"]})]}),e.jsx("input",{ref:R,type:"file",accept:".csv,.xlsx,.xls",onChange:A,className:"hidden"})]}),e.jsxs("div",{className:"p-8 overflow-y-auto flex-1 relative",children:[v&&b.length===0?e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-10 rounded-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-orange-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-700 font-medium text-lg",children:"Processing file..."}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Please wait while we parse your file"})]})}):null,b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(gt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No File Uploaded"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Upload a CSV or Excel file (.xlsx, .xls) or download the template to get started"}),e.jsxs("div",{className:"max-w-4xl mx-auto bg-blue-50 border border-blue-200 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-bold text-blue-900",children:"Template Preview (Excel Format)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-normal bg-blue-100 px-2 py-1 rounded",children:"12 Columns"}),e.jsxs("button",{onClick:()=>B(!P),className:"flex items-center gap-1 px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-xs font-medium transition-colors",title:"Show detailed instructions",children:[e.jsx(_r,{className:"w-4 h-4"}),"Help"]})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white border border-gray-300 rounded-lg mb-4",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsxs("thead",{children:[e.jsxs("tr",{className:"bg-blue-600",children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"A"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"B"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"C"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"D"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"E"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"F"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"G"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"H"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"I"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"J"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"K"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-white text-[10px]",children:"L"})]}),e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 font-bold text-red-700 bg-red-50",children:"SKU*"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 font-medium text-gray-700",children:"Product"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 font-medium text-gray-700",children:"Variant"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-600",children:"Category"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-600",children:"Stock"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-600",children:"Min"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 font-bold text-red-700 bg-red-50",children:"Qty*"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 font-medium text-gray-700",children:"Cost"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-600",children:"Last"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-600",children:"Selling"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-600",children:"Supplier"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-600",children:"Notes"})]})]}),e.jsxs("tbody",{className:"text-[11px]",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 font-mono",children:"IPH14-128"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5",children:"iPhone 14 Pro"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5",children:"128GB Gray"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-500",children:"Electronics"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-center text-red-600 font-bold",children:"3"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-center",children:"10"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-center font-bold",children:"15"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-right",children:"1,200,000"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-right text-gray-500",children:"1,200,000"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-right text-gray-500",children:"1,599,000"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-500",children:"Apple"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-red-600",children:"Low stock"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 font-mono",children:"SAM23-256"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5",children:"Galaxy S23"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5",children:"256GB Black"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-500",children:"Electronics"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-center text-red-600 font-bold bg-red-50",children:"0"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-center",children:"8"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-center font-bold",children:"20"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-right",children:"1,000,000"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-right text-gray-500",children:"980,000"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-right text-gray-500",children:"1,399,000"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-gray-500",children:"Samsung"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1.5 text-red-600 font-bold",children:"OUT!"})]})]})]})}),P&&e.jsxs("div",{className:"mb-4 bg-white border border-blue-300 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Tt,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-gray-900 mb-1",children:"Required Columns (2)"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("strong",{children:"A. SKU*"})," - Product variant SKU (must match inventory exactly)"]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"G. Quantity*"})," - Number of units to order"]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-gray-900 mb-1",children:"Important Columns (3)"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("strong",{children:"B. ProductName"})," - Helps verify you have the correct item"]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("strong",{children:"C. VariantName"})," - Specifications (size, color, etc.)"]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"H. CostPrice"})," - Cost per unit (auto-fills from last purchase if blank)"]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(bt,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-gray-900 mb-1",children:"Reference Columns (7)"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("strong",{children:"D-F:"})," Category, CurrentStock, MinStock - Help prioritize orders"]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("strong",{children:"I-J:"})," LastPrice, SellingPrice - View margins and price changes"]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"K-L:"})," Supplier, Notes - Organization and priority flags"]})]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-green-900 mb-1",children:"Smart Features"}),e.jsxs("ul",{className:"text-sm text-green-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"10 real products from YOUR inventory with actual data"}),e.jsx("li",{children:"Smart quantity suggestions based on stock levels"}),e.jsx("li",{children:"Auto-generated priority notes (OUT OF STOCK, urgent, etc.)"}),e.jsx("li",{children:"Cost prices auto-fill from purchase history"}),e.jsx("li",{children:"Only SKU & Quantity required - rest is optional!"})]})]})]})}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Lr,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-amber-900 mb-1",children:"Quick Start"}),e.jsxs("ol",{className:"text-sm text-amber-800 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Download template (includes your products)"}),e.jsx("li",{children:"Open in Excel/Google Sheets"}),e.jsx("li",{children:"Delete comment lines (starting with #)"}),e.jsx("li",{children:"Modify quantities and SKUs for your order"}),e.jsx("li",{children:"Save as CSV or Excel (.xlsx) and upload here"}),e.jsx("li",{children:"Review validation and import"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(Tt,{className:"w-3 h-3 text-red-700"}),e.jsx("p",{className:"font-bold text-red-900",children:"Required (2)"})]}),e.jsx("p",{className:"text-red-700",children:"SKU & Quantity"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(bt,{className:"w-3 h-3 text-blue-700"}),e.jsx("p",{className:"font-bold text-blue-900",children:"Smart Features"})]}),e.jsx("p",{className:"text-blue-700",children:"10 real products, auto prices"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(qe,{className:"w-3 h-3 text-green-700"}),e.jsx("p",{className:"font-bold text-green-900",children:"Ready to Use"})]}),e.jsx("p",{className:"text-green-700",children:"Download & import"})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg p-6 border-2 border-orange-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(gt,{className:"w-5 h-5 text-orange-600"}),"Import Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Rows"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Valid"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:te})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Invalid"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:G})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-purple-600"}),"Import Items Preview"]}),e.jsx("div",{className:"border border-gray-200 rounded-xl overflow-hidden bg-white",children:e.jsx("div",{className:"overflow-x-auto max-h-[400px] overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"Product"}),e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"Variant"}),e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"SKU"}),e.jsx("th",{className:"text-center py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"Stock"}),e.jsx("th",{className:"text-center py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"Qty to Order"}),e.jsx("th",{className:"text-right py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"Cost Price"}),e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"Notes"}),e.jsx("th",{className:"text-center py-3 px-4 text-xs font-semibold text-gray-700 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:b.map((h,n)=>e.jsxs("tr",{className:h.status==="valid"?"bg-white hover:bg-gray-50":"bg-red-50",children:[e.jsx("td",{className:"py-3 px-4",children:h.status==="valid"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-xs font-semibold text-green-700",children:"Valid"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-xs font-semibold text-red-700",children:"Invalid"})]})}),e.jsxs("td",{className:"py-3 px-4",children:[h.productName?e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:h.productName}):e.jsx("span",{className:"text-xs text-gray-400",children:"Not found"}),h.error&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:h.error})]}),e.jsx("td",{className:"py-3 px-4",children:h.foundVariantName?e.jsx("span",{className:"text-sm text-gray-700",children:h.foundVariantName}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"font-mono text-xs text-gray-600",children:h.sku})}),e.jsx("td",{className:"py-3 px-4 text-center",children:h.currentStock!==void 0?e.jsx("span",{className:`text-sm font-medium ${h.currentStock===0?"text-red-600":h.currentStock<=5?"text-amber-600":"text-green-600"}`,children:h.currentStock}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"font-bold text-purple-600 text-lg",children:h.quantity})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("div",{className:"flex flex-col items-end",children:h.costPrice?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:["TSh ",h.costPrice.toLocaleString()]}),h.suggestedCostPrice&&h.costPrice===h.suggestedCostPrice&&e.jsx("span",{className:"text-xs text-green-600",children:"(Last price)"})]}):e.jsx("span",{className:"text-xs text-amber-600",children:"Will use last price"})})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-xs text-gray-600",children:h.notes||"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("button",{onClick:()=>Q(n),className:"p-1.5 hover:bg-red-100 text-red-600 rounded transition-colors",title:"Remove row",children:e.jsx(It,{className:"w-4 h-4"})})})]},n))})]})})})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-8 py-6 flex gap-4 border-t border-gray-200",children:[e.jsx("button",{onClick:_,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 rounded-xl transition-colors font-semibold",children:"Cancel"}),b.length>0&&te>0&&e.jsxs("button",{onClick:C,className:"flex-1 px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl transition-colors font-semibold shadow-lg flex items-center justify-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Import ",te," Items"]})]})]})}),document.body)},Na=({supplier:a,currency:_,onContactClick:r,className:f=""})=>{const[b,j]=s.useState({totalOrders:0,totalSpent:0,averageOrderValue:0}),[v,I]=s.useState(!1);s.useEffect(()=>{a&&P()},[a==null?void 0:a.id]);const P=async()=>{if(a!=null&&a.id){I(!0);try{const{data:A,error:E}=await Qe.from("lats_purchase_orders").select("id, total_amount, total_amount_base_currency, currency, exchange_rate, order_date, status").eq("supplier_id",a.id).order("order_date",{ascending:!1});if(E)throw E;if(A&&A.length>0){const i=A.reduce((u,C)=>{const Q=parseFloat(C.total_amount)||0;return u+Q},0),S=i/A.length,w=A[0].order_date;j({totalOrders:A.length,totalSpent:i,averageOrderValue:S,lastOrderDate:w,rating:a.average_rating||void 0,onTimeDeliveryRate:a.on_time_delivery_rate||void 0})}}catch(A){console.error("Error loading supplier stats:",A)}finally{I(!1)}}},B=A=>{r?r(A):A==="phone"&&a.phone?window.location.href=`tel:${a.phone}`:A==="email"&&a.email?window.location.href=`mailto:${a.email}`:A==="whatsapp"&&a.whatsapp?window.open(`https://wa.me/${a.whatsapp.replace(/[^0-9]/g,"")}`,"_blank"):m.error("Contact information not available")},R=A=>{if(!A)return"Never";const E=new Date(A),S=Math.floor((new Date().getTime()-E.getTime())/(1e3*60*60*24));return S===0?"Today":S===1?"Yesterday":S<7?`${S} days ago`:S<30?`${Math.floor(S/7)} weeks ago`:`${Math.floor(S/30)} months ago`};return a?e.jsxs("div",{className:`bg-gradient-to-br from-orange-50/30 to-amber-50/30 ${f}`,children:[e.jsxs("div",{className:"p-4 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Total Orders"})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:v?"...":b.totalOrders})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ls,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Total Spent"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:v?"...":ce(b.totalSpent,_)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(bt,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Avg Order"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:v?"...":ce(b.averageOrderValue,_)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Lt,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Last Order"})]}),e.jsx("p",{className:"text-sm font-bold text-gray-900",children:v?"...":R(b.lastOrderDate)})]})]}),(b.rating||b.onTimeDeliveryRate)&&e.jsxs("div",{className:"px-4 pb-4 space-y-2",children:[b.rating&&typeof b.rating=="number"&&e.jsx("div",{className:"bg-white rounded-lg p-3 border border-orange-200/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Rating"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"w-4 h-4 text-yellow-500 fill-current"}),e.jsx("span",{className:"font-bold text-gray-900",children:Number(b.rating).toFixed(1)}),e.jsx("span",{className:"text-xs text-gray-500",children:"/5.0"})]})]})}),b.onTimeDeliveryRate&&typeof b.onTimeDeliveryRate=="number"&&e.jsx("div",{className:"bg-white rounded-lg p-3 border border-orange-200/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"On-Time Delivery"}),e.jsxs("span",{className:"font-bold text-green-600",children:[Number(b.onTimeDeliveryRate).toFixed(0),"%"]})]})})]}),e.jsxs("div",{className:"p-4 pt-0 grid grid-cols-2 gap-2",children:[a.phone&&e.jsxs("button",{onClick:()=>B("phone"),className:"flex flex-col items-center gap-1 p-3 bg-white border border-orange-200/50 rounded-lg hover:bg-orange-50 transition-colors shadow-sm",title:a.phone,children:[e.jsx(Qs,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Call"})]}),a.whatsapp&&e.jsxs("button",{onClick:()=>B("whatsapp"),className:"flex flex-col items-center gap-1 p-3 bg-white border border-orange-200/50 rounded-lg hover:bg-green-50 transition-colors shadow-sm",title:a.whatsapp,children:[e.jsx(Or,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"WhatsApp"})]})]}),a.payment_terms&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{className:"bg-white rounded-lg p-3 border border-orange-200/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Payment Terms"}),e.jsx("span",{className:"font-semibold text-gray-900",children:a.payment_terms})]})})})]}):e.jsx("div",{className:`bg-gray-50 border-2 border-gray-200 rounded-xl p-6 ${f}`,children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Xe,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a supplier to see details"})]})})},Fs="po_templates",va=({isOpen:a,onClose:_,onLoadTemplate:r,currentData:f})=>{const[b,j]=s.useState([]),[v,I]=s.useState(!1),[P,B]=s.useState(""),[R,A]=s.useState(""),[E,i]=s.useState(null);s.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),s.useEffect(()=>{a&&S()},[a]);const S=()=>{try{const h=localStorage.getItem(Fs);if(h){const n=JSON.parse(h);j(n.sort((g,N)=>g.isFavorite&&!N.isFavorite?-1:!g.isFavorite&&N.isFavorite?1:new Date(N.updatedAt).getTime()-new Date(g.updatedAt).getTime()))}}catch(h){console.error("Error loading templates:",h),m.error("Failed to load templates")}},w=h=>{try{localStorage.setItem(Fs,JSON.stringify(h)),j(h)}catch(n){console.error("Error saving templates:",n),m.error("Failed to save templates")}},u=()=>{if(!P.trim()){m.error("Please enter a template name");return}if(!f||!f.items||f.items.length===0){m.error("No items to save as template");return}if(!f.supplierId){m.error("Please select a supplier first");return}const h={id:(E==null?void 0:E.id)||`template_${Date.now()}`,name:P.trim(),description:R.trim()||void 0,supplierId:f.supplierId,supplierName:f.supplierName||"Unknown Supplier",items:f.items.map(n=>({productId:n.productId,variantId:n.variantId,productName:n.name,variantName:n.variantName||"Default",sku:n.sku,quantity:n.quantity,costPrice:n.costPrice})),currency:f.currency,paymentTerms:f.paymentTerms,notes:f.notes,isFavorite:(E==null?void 0:E.isFavorite)||!1,createdAt:(E==null?void 0:E.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString(),useCount:(E==null?void 0:E.useCount)||0};if(E){const n=b.map(g=>g.id===E.id?h:g);w(n),m.success("Template updated!")}else{const n=[h,...b];w(n),m.success("Template saved!")}B(""),A(""),I(!1),i(null)},C=h=>{const n=b.map(g=>g.id===h.id?{...g,useCount:g.useCount+1,updatedAt:new Date().toISOString()}:g);w(n),r(h),m.success(`Loaded template: ${h.name}`),_()},Q=h=>{const n=b.map(g=>g.id===h?{...g,isFavorite:!g.isFavorite}:g);w(n)},ee=h=>{if(!confirm("Are you sure you want to delete this template?"))return;const n=b.filter(g=>g.id!==h);w(n),m.success("Template deleted")},te=h=>{i(h),B(h.name),A(h.description||""),I(!0)},G=h=>{const g=[{...h,id:`template_${Date.now()}`,name:`${h.name} (Copy)`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),useCount:0},...b];w(g),m.success("Template duplicated!")};return a?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(is,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Order Templates"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Save and reuse frequent purchase orders"})]})]}),e.jsx("button",{onClick:_,className:"w-10 h-10 flex items-center justify-center bg-white/20 hover:bg-white/30 text-white rounded-full transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]})}),!v&&f&&f.items.length>0&&e.jsx("div",{className:"p-4 bg-amber-50 border-b border-amber-200",children:e.jsxs("button",{onClick:()=>I(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-amber-600 hover:bg-amber-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Save Current Order as Template"]})}),v&&e.jsxs("div",{className:"p-6 bg-blue-50 border-b border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:E?"Edit Template":"Save as New Template"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template Name *"}),e.jsx("input",{type:"text",value:P,onChange:h=>B(h.target.value),placeholder:"e.g., Weekly iPhone Order",className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optional)"}),e.jsx("textarea",{value:R,onChange:h=>A(h.target.value),placeholder:"Add notes about this template...",rows:2,className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{I(!1),B(""),A(""),i(null)},className:"flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:E?"Update Template":"Save Template"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(is,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Templates Yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Save your current order as a template for quick reordering"})]}):e.jsx("div",{className:"space-y-3",children:b.map(h=>e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-bold text-gray-900 text-lg",children:h.name}),h.isFavorite&&e.jsx(os,{className:"w-4 h-4 text-yellow-500 fill-current"}),e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-semibold rounded",children:[h.items.length," items"]})]}),h.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:h.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["Supplier: ",e.jsx("strong",{className:"text-gray-700",children:h.supplierName})]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Currency: ",e.jsx("strong",{className:"text-gray-700",children:h.currency})]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Used ",e.jsx("strong",{className:"text-gray-700",children:h.useCount})," times"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Last updated: ",new Date(h.updatedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:()=>C(h),className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors text-sm flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"}),"Load"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>Q(h.id),className:"p-2 hover:bg-yellow-50 border border-gray-200 rounded-lg transition-colors",title:h.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(os,{className:`w-4 h-4 ${h.isFavorite?"text-yellow-500 fill-current":"text-gray-400"}`})}),e.jsx("button",{onClick:()=>te(h),className:"p-2 hover:bg-blue-50 border border-gray-200 rounded-lg transition-colors",title:"Edit template",children:e.jsx(Hs,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>G(h),className:"p-2 hover:bg-green-50 border border-gray-200 rounded-lg transition-colors",title:"Duplicate template",children:e.jsx(Zs,{className:"w-4 h-4 text-green-600"})}),e.jsx("button",{onClick:()=>ee(h.id),className:"p-2 hover:bg-red-50 border border-gray-200 rounded-lg transition-colors",title:"Delete template",children:e.jsx(It,{className:"w-4 h-4 text-red-600"})})]})]})]}),e.jsxs("details",{className:"mt-3",children:[e.jsxs("summary",{className:"text-sm text-blue-600 hover:text-blue-700 cursor-pointer font-medium",children:["View ",h.items.length," items"]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-[150px] overflow-y-auto",children:h.items.map((n,g)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded text-xs",children:[e.jsxs("span",{className:"text-gray-900",children:[n.productName," - ",n.variantName]}),e.jsxs("span",{className:"text-gray-600",children:["Qty: ",e.jsx("strong",{children:n.quantity})]})]},g))})]})]},h.id))})}),e.jsx("div",{className:"p-6 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[b.length," template",b.length!==1?"s":""," saved"]}),e.jsx("button",{onClick:_,className:"px-6 py-2.5 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Close"})]})})]})}):null},wa=({isOpen:a,onClose:_,purchaseOrder:r,supplier:f,onSend:b})=>{const[j,v]=s.useState({to:"",cc:"",bcc:"",subject:"",message:"",attachPDF:!0}),[I,P]=s.useState(!1),[B,R]=s.useState(!1),[A,E]=s.useState(!1);es.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),s.useEffect(()=>{a&&f&&r&&v({to:f.email||"",cc:"",bcc:"",subject:`Purchase Order ${r.orderNumber} from ${r.companyName||"Our Company"}`,message:i(),attachPDF:!0})},[a,f,r]);const i=()=>{var u;return`Dear ${(f==null?void 0:f.contact_person)||(f==null?void 0:f.name)||"Supplier"},

We would like to place the following purchase order:

Order Number: ${r==null?void 0:r.orderNumber}
Order Date: ${new Date((r==null?void 0:r.createdAt)||new Date).toLocaleDateString()}
Expected Delivery: ${r!=null&&r.expectedDeliveryDate?new Date(r.expectedDeliveryDate).toLocaleDateString():"TBD"}

Total Items: ${((u=r==null?void 0:r.items)==null?void 0:u.length)||0}
Total Amount: ${r!=null&&r.totalAmount?`${r.currency||"TSh"} ${r.totalAmount.toLocaleString()}`:"TBD"}

Please review the attached purchase order and confirm receipt.

${r!=null&&r.notes?`
Additional Notes:
${r.notes}`:""}

Best regards,
${(r==null?void 0:r.createdByName)||"Purchase Department"}`},S=async()=>{if(!j.to||!j.to.trim()){m.error("Please enter recipient email address");return}if(!j.subject||!j.subject.trim()){m.error("Please enter email subject");return}if(!j.message||!j.message.trim()){m.error("Please enter email message");return}P(!0);try{await b(j)?(m.success("Purchase order sent successfully!"),_()):m.error("Failed to send email. Please try again.")}catch(u){console.error("Error sending email:",u),m.error("Failed to send email")}finally{P(!1)}},w=()=>{const u=`To: ${j.to}
Subject: ${j.subject}

${j.message}`;navigator.clipboard.writeText(u),m.success("Email content copied to clipboard!")};return a?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx($r,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Email Purchase Order"}),e.jsxs("p",{className:"text-blue-100 text-sm",children:["Send PO to ",(f==null?void 0:f.name)||"supplier"]})]})]}),e.jsx("button",{onClick:_,className:"w-10 h-10 flex items-center justify-center bg-white/20 hover:bg-white/30 text-white rounded-full transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["To: ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",value:j.to,onChange:u=>v(C=>({...C,to:u.target.value})),placeholder:"supplier@example.com",className:"w-full px-4 py-2.5 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[!B&&e.jsx("button",{onClick:()=>R(!0),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Cc"}),!A&&e.jsx("button",{onClick:()=>E(!0),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Bcc"})]}),B&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cc:"}),e.jsx("input",{type:"email",value:j.cc,onChange:u=>v(C=>({...C,cc:u.target.value})),placeholder:"cc@example.com",className:"w-full px-4 py-2.5 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none"})]}),A&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bcc:"}),e.jsx("input",{type:"email",value:j.bcc,onChange:u=>v(C=>({...C,bcc:u.target.value})),placeholder:"bcc@example.com",className:"w-full px-4 py-2.5 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Subject: ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:j.subject,onChange:u=>v(C=>({...C,subject:u.target.value})),placeholder:"Purchase Order...",className:"w-full px-4 py-2.5 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Message: ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:j.message,onChange:u=>v(C=>({...C,message:u.target.value})),rows:12,placeholder:"Enter your message...",className:"w-full px-4 py-2.5 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none resize-none font-mono text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(Fr,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Attachment"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["PO_",r==null?void 0:r.orderNumber,".pdf"]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.attachPDF,onChange:u=>v(C=>({...C,attachPDF:u.target.checked})),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Attach PDF"})]})]})]})}),e.jsx("div",{className:"p-6 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:w,className:"flex items-center gap-2 px-4 py-2.5 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 rounded-lg font-medium transition-colors",children:[e.jsx(Zs,{className:"w-4 h-4"}),"Copy to Clipboard"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:_,disabled:I,className:"px-6 py-2.5 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:S,disabled:I,className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:I?e.jsxs(e.Fragment,{children:[e.jsx(RefreshCw,{className:"w-5 h-5 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Rr,{className:"w-5 h-5"}),"Send Email"]})})]})]})})]})}):null},it=()=>({defaultAddress:"Dar es Salaam, Tanzania",defaultCity:"Dar es Salaam",defaultCountry:"Tanzania"}),Rs=async a=>{var f,b,j,v;const{businessInfoService:_}=await pt(()=>import("./index-61458a34.js").then(I=>I.b7),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),r=await _.getBusinessInfo();return`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Purchase Order ${a.orderNumber}</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .company-logo { height: 60px; width: auto; margin: 0 auto 10px; display: block; }
        .company-name { font-size: 24px; font-weight: bold; color: #2563eb; }
        .order-details { margin-bottom: 30px; }
        .supplier-info { margin-bottom: 30px; }
        .items-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .items-table th { background-color: #f2f2f2; }
        .total-section { text-align: right; font-weight: bold; }
        .footer { margin-top: 30px; text-align: center; color: #666; }
      </style>
    </head>
    <body>
      <div class="header">
        ${r.logo?`<img src="${r.logo}" alt="${r.name} Logo" class="company-logo" />`:""}
        <div class="company-name">${r.name}</div>
        <div>Purchase Order</div>
      </div>
      
      <div class="order-details">
        <h3>Order Details</h3>
        <p><strong>Order Number:</strong> ${a.orderNumber}</p>
        <p><strong>Date:</strong> ${new Date(a.createdAt).toLocaleDateString()}</p>
        <p><strong>Status:</strong> ${a.status}</p>
        <p><strong>Currency:</strong> ${a.currency}</p>
      </div>
      
      <div class="supplier-info">
        <h3>Supplier Information</h3>
        <p><strong>Name:</strong> ${((f=a.supplier)==null?void 0:f.name)||"N/A"}</p>
        <p><strong>Email:</strong> ${((b=a.supplier)==null?void 0:b.email)||"N/A"}</p>
        <p><strong>Phone:</strong> ${((j=a.supplier)==null?void 0:j.phone)||"N/A"}</p>
      </div>
      
      <table class="items-table">
        <thead>
          <tr>
            <th>Product</th>
            <th>Variant</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          ${((v=a.items)==null?void 0:v.map(I=>{var P,B;return`
            <tr>
              <td>${((P=I.product)==null?void 0:P.name)||"N/A"}</td>
              <td>${((B=I.variant)==null?void 0:B.name)||"N/A"}</td>
              <td>${I.quantity}</td>
              <td>${ce(I.costPrice,a.currency)}</td>
              <td>${ce(I.totalPrice,a.currency)}</td>
            </tr>
          `}).join(""))||'<tr><td colspan="5">No items</td></tr>'}
        </tbody>
      </table>
      
      <div class="total-section">
        <p><strong>Total Amount: ${ce(a.totalAmount,a.currency)}</strong></p>
      </div>
      
      <div class="footer">
        <p>Generated on ${new Date().toLocaleString()}</p>
      </div>
    </body>
    </html>
  `},Sa=300,Dt="po_create_session",At="po_create_session_timestamp",Ca=(a,_)=>{const[r,f]=s.useState(a);return s.useEffect(()=>{const b=setTimeout(()=>{f(a)},_);return()=>{clearTimeout(b)}},[a,_]),r},dn=()=>{var Ss,Cs;console.log("ðŸ”§ POcreate component initializing...");const a=Sr(),[_]=Cr(),{currentUser:r}=wr(),{confirm:f,alert:b,confirmationDialog:j,alertDialog:v,hideConfirmation:I,hideAlert:P}=Vr(),{playClickSound:B}=zr(),R=ra(),A=_.get("edit"),E=_.get("duplicate"),i=s.useMemo(()=>!!A,[A]),S=s.useMemo(()=>!!E,[E]),{products:w,categories:u,suppliers:C,loadProducts:Q,loadCategories:ee,loadSuppliers:te,createPurchaseOrder:G,updatePurchaseOrder:h,getPurchaseOrder:n}=As(),[g,N]=s.useState(""),d=Ca(g,Sa),L=s.useRef(null),[T,U]=s.useState(""),[V,$]=s.useState({min:"",max:""}),[Y,O]=s.useState("all"),[ae,ve]=s.useState(!1),[he,pe]=s.useState("recent"),[we,fe]=s.useState("desc"),[H,ke]=s.useState(!1),[le,de]=s.useState([]),ue=s.useMemo(()=>w.length===0||u.length===0?[]:w.map(l=>{var F,ne;const c=l.categoryId||l.category_id||((F=l.category)==null?void 0:F.id);let p="Unknown Category",M=null;if(c&&u.length>0&&(M=u.find(J=>J.id===c),M&&(p=M.name)),!M&&l.name&&u.length>0){const J=l.name.toLowerCase();M=u.find(ye=>{const oe=ye.name.toLowerCase();return J.includes(oe)||oe.includes(J)}),M&&(p=M.name)}const Z=Array.isArray(l.images)?l.images.map(J=>typeof J=="string"?J:J.url||J.image_url||""):[];return{...l,categoryName:p,categoryId:(M==null?void 0:M.id)||c,images:Z.filter(Boolean),tags:[],variants:((ne=l.variants)==null?void 0:ne.map(J=>({...J,id:J.id||`variant-${Date.now()}`,sellingPrice:J.price||l.price||0,quantity:J.stockQuantity||0})))||[]}}),[w,u]),{isLoading:tt,error:ie}=As(),z=s.useMemo(()=>{if(H&&le.length>0)return le;let t=ue;if(d.trim()&&!H){const x=d.toLowerCase();t=t.filter(l=>{var M,Z,F,ne;const c=(M=l.variants)==null?void 0:M[0],p=((Z=u==null?void 0:u.find(J=>J.id===l.categoryId))==null?void 0:Z.name)||"";return(((F=l.name)==null?void 0:F.toLowerCase())||"").includes(x)||(((ne=c==null?void 0:c.sku)==null?void 0:ne.toLowerCase())||"").includes(x)||(p.toLowerCase()||"").includes(x)||l.variants&&l.variants.some(J=>{var ye,oe,Ue;return((ye=J.name)==null?void 0:ye.toLowerCase().includes(x))||((oe=J.sku)==null?void 0:oe.toLowerCase().includes(x))||((Ue=J.barcode)==null?void 0:Ue.toLowerCase().includes(x))})})}return T&&(t=t.filter(x=>x.categoryId===T)),(V.min||V.max)&&(t=t.filter(x=>{var Z;const l=(Z=x.variants)==null?void 0:Z[0],c=(l==null?void 0:l.costPrice)||0,p=V.min?parseFloat(V.min):0,M=V.max?parseFloat(V.max):1/0;return c>=p&&c<=M})),Y!=="all"&&(t=t.filter(x=>{var p;const l=(p=x.variants)==null?void 0:p[0],c=(l==null?void 0:l.stockQuantity)||0;switch(Y){case"in-stock":return c>10;case"low-stock":return c>0&&c<=10;case"out-of-stock":return c===0;default:return!0}})),t.sort((x,l)=>{var J,ye,oe,Ue,ks,Ps,Es,Ds;const c=((J=x.variants)==null?void 0:J.reduce((Wt,Me)=>Wt+((Me==null?void 0:Me.stockQuantity)||(Me==null?void 0:Me.quantity)||0),0))||0,p=((ye=l.variants)==null?void 0:ye.reduce((Wt,Me)=>Wt+((Me==null?void 0:Me.stockQuantity)||(Me==null?void 0:Me.quantity)||0),0))||0,M=c>0,Z=p>0;if(M&&!Z)return-1;if(!M&&Z)return 1;let F,ne;switch(he){case"name":F=((oe=x.name)==null?void 0:oe.toLowerCase())||"",ne=((Ue=l.name)==null?void 0:Ue.toLowerCase())||"";break;case"price":F=((Ps=(ks=x.variants)==null?void 0:ks[0])==null?void 0:Ps.costPrice)||x.price||0,ne=((Ds=(Es=l.variants)==null?void 0:Es[0])==null?void 0:Ds.costPrice)||l.price||0;break;case"stock":F=c,ne=p;break;case"recent":F=new Date(x.createdAt||"").getTime(),ne=new Date(l.createdAt||"").getTime();break;default:return 0}return we==="asc"?F>ne?1:-1:F<ne?1:-1}),t},[ue,u,d,T,V,Y,he,we,H,le]),Le=s.useCallback(async t=>{if(t){wt(!0),lt(null);try{const x=await n(t);if(x.ok&&x.data){const l=x.data;if(fs(l),l.supplierId){const c=C.find(p=>p.id===l.supplierId);c&&Pe(c)}if(l.items&&l.items.length>0){const c=l.items.map(p=>{var F,ne,J,ye,oe,Ue;const M=p.costPrice&&p.costPrice>0?p.costPrice:1,Z=p.quantity&&p.quantity>0?p.quantity:1;return{id:`${p.productId}-${p.variantId}-${Date.now()}`,productId:p.productId,variantId:p.variantId,name:((F=p.product)==null?void 0:F.name)||"Unknown Product",variantName:((ne=p.variant)==null?void 0:ne.name)||"Default Variant",sku:((J=p.variant)==null?void 0:J.sku)||"N/A",costPrice:M,quantity:Z,totalPrice:M*Z,currentStock:((ye=p.variant)==null?void 0:ye.stockQuantity)||0,category:((oe=p.product)==null?void 0:oe.categoryName)||"Unknown Category",images:((Ue=p.product)==null?void 0:Ue.images)||[]}});Se(c)}if(l.expectedDelivery&&(ze(l.expectedDelivery),o(c=>({...c,expectedDelivery:l.expectedDelivery}))),l.notes&&_e(l.notes),l.paymentTerms&&$e(l.paymentTerms),l.currency){const c=je.find(p=>p.code===l.currency);c&&Ie(c)}if(l.exchangeRate&&l.exchangeRate!==1){const c=`1 ${l.currency} = ${Math.round(l.exchangeRate)} TZS`;Ae(c)}l.status&&st(l.status),m.success("Purchase order loaded for editing")}else{const l=x.message||"Failed to load purchase order for editing";lt(l),m.error(l)}}catch(x){const l="Error loading purchase order for editing";console.error("Error loading purchase order:",x),lt(l),m.error(l)}finally{wt(!1)}}},[n,C]);s.useEffect(()=>{(async()=>{try{const[x,l,c]=await Promise.allSettled([Q({page:1,limit:100}).catch(p=>(console.error("âŒ Failed to load products:",p),[])),ee().catch(p=>(console.error("âŒ Failed to load categories:",p),[])),te().catch(p=>(console.error("âŒ Failed to load suppliers:",p),[]))]);x.status,l.status,c.status}catch(x){console.error("âŒ Error in optimized batch loading:",x)}})()},[Q,ee,te]),s.useEffect(()=>{const t=localStorage.getItem("po_latest_exchange_rate");t&&!i&&!S&&(He(t),console.log("â„¹ï¸ Suggested last exchange rate:",t))},[i,S]),s.useEffect(()=>{A&&C.length>0?Le(A):A||fs(null)},[A,C.length,Le]);const be=s.useCallback(async t=>{wt(!0),lt("");try{console.log("ðŸ“‹ Loading purchase order for duplication:",t);const x=await n(t);if(x.ok&&x.data){const l=x.data;if(console.log("âœ… Purchase order loaded for duplication:",l),l.supplierId){const c=C.find(p=>p.id===l.supplierId);c&&Pe(c)}if(l.items&&l.items.length>0){const c=l.items.map(p=>{var F,ne,J,ye,oe,Ue;const M=p.costPrice&&p.costPrice>0?p.costPrice:1,Z=p.quantity&&p.quantity>0?p.quantity:1;return{id:`${p.productId}-${p.variantId}`,productId:p.productId,variantId:p.variantId,name:((F=p.product)==null?void 0:F.name)||"Unknown Product",variantName:((ne=p.variant)==null?void 0:ne.name)||"Default Variant",sku:((J=p.variant)==null?void 0:J.sku)||"N/A",costPrice:M,quantity:Z,totalPrice:M*Z,currentStock:((ye=p.variant)==null?void 0:ye.stockQuantity)||0,category:((oe=p.product)==null?void 0:oe.categoryName)||"Unknown Category",images:((Ue=p.product)==null?void 0:Ue.images)||[]}});Se(c)}if(l.expectedDelivery&&(ze(l.expectedDelivery),o(c=>({...c,expectedDelivery:l.expectedDelivery}))),l.notes&&_e(l.notes+" (Duplicated)"),l.paymentTerms&&$e(l.paymentTerms),l.currency){const c=je.find(p=>p.code===l.currency);c&&Ie(c)}if(l.exchangeRate&&l.exchangeRate!==1){const c=`1 ${l.currency} = ${Math.round(l.exchangeRate)} TZS`;Ae(c)}st("draft"),m.success("Purchase order duplicated successfully - Review and save")}else{const l=x.message||"Failed to load purchase order for duplication";lt(l),m.error(l)}}catch(x){const l="Error loading purchase order for duplication";console.error("Error loading purchase order:",x),lt(l),m.error(l)}finally{wt(!1)}},[n,C]);s.useEffect(()=>{E&&C.length>0&&be(E)},[E,C.length,be]);const[k,Pe]=s.useState(null),[Oe,ct]=s.useState(!1);s.useEffect(()=>{if(Oe&&k&&C.length>0){const t=C.find(x=>x.id===k.id);t&&(Pe(t),console.log("ðŸ”„ [POcreate] Re-matched supplier from session with loaded suppliers"))}},[Oe,k,C]),s.useEffect(()=>{!i&&!S&&!k&&C.length>0&&!Oe&&y(!0)},[i,S,k,C.length,Oe]);const[K,Se]=s.useState([]),[q,Ie]=s.useState(()=>je.find(t=>t.code==="TZS")||je[0]);s.useEffect(()=>{if(k!=null&&k.currency){const t=je.find(x=>x.code===k.currency);t&&Ie(t)}},[k]);const[De,ze]=s.useState(""),[xe,Ae]=s.useState(""),[Ye,He]=s.useState(""),[Ne,_e]=s.useState(""),[dt,st]=s.useState("sent"),[Ft,rt]=s.useState(!1),X=ca(xe,q.code,"TZS"),[me,$e]=s.useState("Net 30"),[Ce,o]=s.useState({shippingMethod:"standard",expectedDelivery:"",shippingAddress:it().defaultAddress,shippingCity:it().defaultCity,shippingCountry:it().defaultCountry,shippingPhone:"",shippingContact:"",shippingNotes:"",trackingNumber:"",estimatedCost:0,carrier:"DHL",requireSignature:!1,enableInsurance:!1,insuranceValue:0}),[D,y]=s.useState(!1),[se,ge]=s.useState(!1),[Ee,re]=s.useState(!1),[Fe,at]=s.useState(!1),[Je,ds]=s.useState(!1),[Ys,Rt]=s.useState(!1),[Ke,xt]=s.useState(null),[xs,Ut]=s.useState(null),[nt,ms]=s.useState(!1),[Js,Xs]=s.useState(!1),[er,tr]=s.useState(!1),[W,us]=s.useState(null),[sr,hs]=s.useState(!1),[rr,gs]=s.useState(!1);s.useState(!1),s.useState(!1),s.useState(!1),s.useState(!1);const[Bt,mt]=s.useState(!1),[ar,yt]=s.useState(!1),[qt,ut]=s.useState(!1),[Vt,jt]=s.useState(!1),[zt,Nt]=s.useState(!1),[Kt,vt]=s.useState(!1),[nr,lr]=s.useState(!1),Qt=s.useRef(null),[ps,wt]=s.useState(!1),[Ht,lt]=s.useState(null),[St,fs]=s.useState(null);s.useState(new Set);const bs=t=>{if(!t.trim())return null;const x=[/1\s*([A-Z]{3})\s*=\s*([\d,]+\.?\d*)\s*([A-Z]{3})/i,/([\d,]+\.?\d*)\s*([A-Z]{3})\s*=\s*1\s*([A-Z]{3})/i,/([\d,]+\.?\d*)/i];for(const l of x){const c=t.match(l);if(c){if(c.length===4){const p=c[1]||c[3],M=c[3]||c[1],Z=parseFloat(c[2].replace(/,/g,""));if(p===q.code&&M==="TZS")return Z;if(p==="TZS"&&M===q.code)return 1/Z}else if(c.length===2)return parseFloat(c[1].replace(/,/g,""))}}return null},ys=(t,x)=>{if(x==="TZS")return t;const l=bs(xe);return l?t*l:t},Ct=K.reduce((t,x)=>t+x.totalPrice,0),or=ys(Ct,q.code),ht=Ct-0;ys(ht,q.code);const Re=s.useCallback((t,x,l=1)=>{var ne;const c=x||((ne=t.variants)==null?void 0:ne[0]);if(!c){b("Product has no variants available","No Variants");return}const p=c.costPrice??(t.price?t.price*.7:0),M=p>0?p:1,Z=c.sku||"N/A",F=c.stockQuantity||0;Se(J=>{const ye=J.find(oe=>oe.productId===t.id&&oe.variantId===c.id);if(ye)return J.map(oe=>oe.id===ye.id?{...oe,quantity:oe.quantity+l,totalPrice:(oe.quantity+l)*M}:oe);{const oe={id:`${t.id}-${c.id}-${Date.now()}`,productId:t.id,variantId:c.id,name:t.name,variantName:c.name,sku:Z,costPrice:M,sellingPrice:c.sellingPrice||c.price||0,quantity:l,totalPrice:M*l,currentStock:F,category:t.categoryName,images:t.images||[]};return[...J,oe]}})},[]),ir=s.useCallback((t,x)=>{if(x<=0){Se(l=>l.filter(c=>c.id!==t));return}Se(l=>l.map(c=>c.id===t?{...c,quantity:x,totalPrice:x*c.costPrice}:c))},[]),cr=s.useCallback(t=>{Se(x=>x.filter(l=>l.id!==t))},[]);s.useCallback(t=>{o(t),ze(t.expectedDelivery),t.shippingMethod&&o(x=>({...x,shippingMethod:t.shippingMethod}))},[]);const dr=s.useCallback((t,x)=>{Se(l=>l.map(c=>c.id===t?{...c,costPrice:x,totalPrice:c.quantity*x}:c))},[]),js=s.useCallback(()=>{if(K.length===0&&!k){console.log("â„¹ï¸ [POcreate] Skipping save - empty session");return}try{const t={purchaseCartItems:K,selectedSupplier:k,selectedCurrency:q,expectedDelivery:De,paymentTerms:me,purchaseOrderNotes:Ne,exchangeRates:xe,shippingInfo:Ce};localStorage.setItem(Dt,JSON.stringify(t)),localStorage.setItem(At,new Date().toISOString()),console.log("ðŸ’¾ [POcreate] Session saved to localStorage",{cartItems:K.length,supplier:k==null?void 0:k.name,currency:q==null?void 0:q.code})}catch(t){console.error("âŒ [POcreate] Failed to save session:",t),m.error("Failed to save session to browser storage")}},[K,k,q,De,me,Ne,xe,Ce]),Ns=s.useCallback(()=>{var t,x,l;try{const c=localStorage.getItem(Dt),p=localStorage.getItem(At);if(!c)return console.log("â„¹ï¸ [POcreate] No saved session found"),!1;const M=JSON.parse(c);return!M.purchaseCartItems||M.purchaseCartItems.length===0?(console.log("â„¹ï¸ [POcreate] Session has no cart items, skipping restore"),!1):(console.log("ðŸ”„ [POcreate] Restoring session...",{cartItems:M.purchaseCartItems.length,supplier:(t=M.selectedSupplier)==null?void 0:t.name,currency:(x=M.selectedCurrency)==null?void 0:x.code}),Se(M.purchaseCartItems||[]),Pe(M.selectedSupplier||null),Ie(M.selectedCurrency||je[0]),ze(M.expectedDelivery||""),$e(M.paymentTerms||"Net 30"),_e(M.purchaseOrderNotes||""),Ae(M.exchangeRates||""),M.shippingInfo&&o(M.shippingInfo),ct(!0),console.log("âœ… [POcreate] Session restored automatically from localStorage",{cartItems:M.purchaseCartItems.length,supplier:(l=M.selectedSupplier)==null?void 0:l.name}),!0)}catch(c){return console.error("âŒ [POcreate] Failed to load session:",c),m.error("Failed to restore previous session"),!1}},[]),Ze=s.useCallback(()=>{try{localStorage.removeItem(Dt),localStorage.removeItem(At),ct(!1),console.log("ðŸ—‘ï¸ [POcreate] Session cleared from localStorage")}catch(t){console.error("âŒ [POcreate] Failed to clear session:",t)}},[]);s.useCallback(()=>{Ze(),Se([]),Pe(null),ze(""),$e("Net 30"),_e(""),Ae(""),o({shippingMethod:"standard",expectedDelivery:"",shippingAddress:it().defaultAddress,shippingCity:it().defaultCity,shippingCountry:it().defaultCountry,shippingPhone:"",shippingContact:"",shippingNotes:"",trackingNumber:"",estimatedCost:0,carrier:"DHL",requireSignature:!1,enableInsurance:!1,insuranceValue:0}),m.success("Session discarded")},[Ze]);const kt=s.useCallback(async()=>{if(console.log("ðŸ—‘ï¸ [CLEAR BUTTON] Clear cart clicked, items:",K.length),K.length>0){const t=await f(`Are you sure you want to clear everything?

This will remove:
â€¢ All cart items
â€¢ Selected supplier
â€¢ Order notes
â€¢ Shipping details`);if(console.log("âœ… Confirmation result:",t),t){console.log("ðŸ§¹ Clearing all data...");try{Se([]),Pe(null),ze(""),Ae(""),_e(""),$e("Net 30"),o({address:"",city:"",country:"",zipCode:"",phoneNumber:"",expectedDelivery:"",shippingMethod:"standard",trackingNumber:"",shippingCost:0,notes:""}),Ze(),console.log("âœ… All data cleared successfully"),m.success("ðŸ—‘ï¸ Cart cleared! Everything has been removed.",{duration:3e3,style:{background:"#10b981",color:"#fff"}})}catch(x){console.error("âŒ Error in clear cart:",x),m.error("Failed to clear cart")}}else console.log("âŒ User cancelled clear operation")}else console.log("â„¹ï¸ No items to clear"),m.info("Cart is already empty")},[K.length,f,Ze]),vs=s.useCallback(()=>{if(K.length>0)try{la.autoSave(K,k,q,De,me,Ne,xe)}catch(t){console.error("Auto-save failed:",t)}},[K,k,q,De,me,Ne,xe]);s.useEffect(()=>{!i&&!S&&!Oe&&(console.log("ðŸ” [POcreate] Checking for saved session to restore..."),Ns()||console.log("â„¹ï¸ [POcreate] No session to restore, starting fresh"))},[i,S,Oe,Ns]),s.useEffect(()=>{if(Oe&&!i&&!S){const t=setTimeout(()=>{js(),vs()},500);return()=>clearTimeout(t)}},[K,k,q,De,me,Ne,xe,Ce,js,vs,Oe,i,S]),s.useEffect(()=>{const t=x=>{if(!i&&!S&&(K.length>0||k))try{const l={purchaseCartItems:K,selectedSupplier:k,selectedCurrency:q,expectedDelivery:De,paymentTerms:me,purchaseOrderNotes:Ne,exchangeRates:xe,shippingInfo:Ce};localStorage.setItem(Dt,JSON.stringify(l)),localStorage.setItem(At,new Date().toISOString()),console.log("ðŸ’¾ [POcreate] Session saved on page unload")}catch(l){console.error("âŒ [POcreate] Failed to save session on unload:",l)}};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[K,k,q,De,me,Ne,xe,Ce,i,S]),s.useCallback(t=>{try{Se(t.cartItems||[]),Pe(t.supplier),Ie(t.currency||je[0]),ze(t.expectedDelivery||""),$e(t.paymentTerms||"net_30"),_e(t.notes||""),Ae(t.exchangeRates||""),m.success(`Loaded draft: ${t.name}`)}catch(x){console.error("Failed to load draft:",x),m.error("Failed to load draft. Please try again.")}},[]);const xr=s.useCallback(t=>{Pe(t),xt(null);const x=t.preferred_currency||t.currency;if(x){const l=je.find(c=>c.code===x);l&&(Ie(l),m.success(`Currency automatically set to ${x} (${l.name})`))}else{const l=je.find(c=>c.code==="TZS")||je[0];Ie(l),m(`No supplier currency specified, using default: ${l.code}`)}t.exchangeRates&&(Ae(t.exchangeRates),m.success("Exchange rates loaded from supplier")),y(!1)},[]);s.useCallback(t=>{if(Pe(t),t.currency){const x=je.find(l=>l.code===t.currency);x&&(Ie(x),m.success(`Currency automatically set to ${t.currency} (${x.name})`))}else{const x=je.find(l=>l.code==="TZS")||je[0];Ie(x),m(`No supplier currency specified, using default: ${x.code}`)}t.exchangeRates&&(Ae(t.exchangeRates),m.success("Exchange rates loaded from supplier")),te()},[te]);const mr=s.useCallback(t=>{Q(),re(!1),m.success("Product added successfully!")},[Q]),ws=s.useCallback((t,x)=>{if(x){const l={...t,preSelectedVariant:x};Ut(l)}else Ut(t);ds(!0)},[]),ur=s.useCallback(t=>{const x=ue.find(l=>l.variants&&l.variants.length>0?l.variants.some(c=>c.sku===t||c.barcode===t):!1);if(x){const l=x.variants.find(c=>c.sku===t||c.barcode===t);l&&(Re(x,l,1),m.success(`Added: ${x.name}`))}else m.error(`Product not found for: ${t}`)},[ue,Re]),hr=s.useCallback(t=>{let x=0,l=0,c=0;t.forEach(p=>{const M=ue.find(Z=>Z.variants&&Z.variants.length>0?Z.variants.some(F=>F.sku===p.sku):!1);if(M){const Z=M.variants.find(F=>F.sku===p.sku);if(Z){const F=p.costPrice?{...Z,costPrice:p.costPrice}:Z;Re(M,F,p.quantity),x++,c+=p.quantity}}else l++}),x>0&&m.success(`âœ… Added ${x} item${x>1?"s":""} (${c} total units) to purchase order`),l>0&&m.error(`âŒ ${l} item${l>1?"s":""} not found`)},[ue,Re]),gr=s.useCallback(t=>{const x=C.find(c=>c.id===t.supplierId);x&&Pe(x);const l=je.find(c=>c.code===t.currency);l&&Ie(l),t.paymentTerms&&$e(t.paymentTerms),t.notes&&_e(t.notes),Se([]),setTimeout(()=>{t.items.forEach(c=>{var M;const p=ue.find(Z=>Z.id===c.productId);if(p){const Z=(M=p.variants)==null?void 0:M.find(F=>F.id===c.variantId);Z&&Re(p,Z,c.quantity)}})},100),m.success(`Loaded template: ${t.name}`)},[C,ue,Re]),pr=s.useCallback(async t=>{try{const x={to:t.to,cc:t.cc||void 0,bcc:t.bcc||void 0,subject:t.subject,message:t.message,attachPDF:t.attachPDF,purchaseOrderId:W==null?void 0:W.id,orderNumber:W==null?void 0:W.orderNumber};console.log("Sending email:",x),await new Promise(l=>setTimeout(l,2e3)),m.success("Email sent successfully!");try{await supabase.from("lats_purchase_order_audit").insert({purchase_order_id:W==null?void 0:W.id,action:"Email Sent",user_id:r==null?void 0:r.id,details:`Email sent to ${t.to}`})}catch(l){console.warn("Failed to log email audit:",l)}return!0}catch(x){return console.error("Error sending email:",x),m.error("Failed to send email. Please try again or contact support."),!1}},[W,r]),Zt=s.useCallback(async()=>{const t=_s(k,K,"",me,q.code,X==null?void 0:X.rate);if(!t.isValid){m.error(t.errors.join(`
`));return}rt(!0);try{const x=Ls(),l={...i&&A&&{id:A},supplierId:k.id,expectedDelivery:Ce.expectedDelivery||"",notes:Ne,status:"draft",currency:q.code,paymentTerms:me,createdBy:(r==null?void 0:r.id)||(r==null?void 0:r.uid)||null,exchangeRate:(X==null?void 0:X.rate)||1,baseCurrency:"TZS",exchangeRateSource:(X==null?void 0:X.source)||"manual",exchangeRateDate:(X==null?void 0:X.date)||new Date().toISOString(),items:K.map(p=>({productId:p.productId,variantId:p.variantId,quantity:p.quantity,costPrice:p.costPrice,sellingPrice:p.sellingPrice||0,minimumOrderQty:p.minimumOrderQty,notes:p.notes||""}))},c=await G(l);c.ok?(Ze(),m.success("Purchase Order saved as draft! You can edit it later."),a(`/lats/purchase-orders/${c.data.id}`)):(console.error("Failed to save draft:",c.message),m.error(c.message||"Failed to save draft"))}catch(x){console.error("Error saving draft:",x),m.error("Error saving draft. Please try again.")}finally{rt(!1)}},[k,K,Ce.expectedDelivery,xe,Ne,q,me,X,G,a,r,i,A,Ze]),Pt=s.useCallback(async()=>{const t=_s(k,K,"",me,q.code,X==null?void 0:X.rate);if(!t.isValid){m.error(t.errors.join(`
`));return}mt(!0)},[k,K,me,q,X]),fr=s.useCallback(async()=>{mt(!1),ms(!0);try{const t=i?(St==null?void 0:St.orderNumber)||"":Ls(),x={supplierId:k.id,expectedDelivery:Ce.expectedDelivery||"",notes:Ne,status:dt,currency:q.code,paymentTerms:me,createdBy:(r==null?void 0:r.id)||(r==null?void 0:r.uid)||null,exchangeRate:(X==null?void 0:X.rate)||1,baseCurrency:"TZS",exchangeRateSource:(X==null?void 0:X.source)||"manual",exchangeRateDate:(X==null?void 0:X.date)||new Date().toISOString(),items:K.map(c=>({productId:c.productId,variantId:c.variantId,quantity:c.quantity,costPrice:c.costPrice,sellingPrice:c.sellingPrice||0,minimumOrderQty:c.minimumOrderQty,notes:c.notes||""}))},l=i&&A?await h(A,x):await G(x);if(l.ok){const c={...l.data,supplier:k,orderNumber:t,currency:q.code,items:K};us(c),Ze(),xe&&xe.trim()&&(localStorage.setItem("po_latest_exchange_rate",xe),console.log("ðŸ’¾ Saved latest exchange rate:",xe)),R.show(`Purchase Order ${t} has been ${i&&!S?"updated":"created"} successfully!`,{title:`PO ${i&&!S?"Updated":"Created"}`,actionButtons:[{label:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ur,{className:"w-5 h-5"}),e.jsx("span",{children:"View Order"})]}),onClick:()=>a(`/lats/purchase-orders/${l.data.id}`),variant:"primary"},{label:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Hs,{className:"w-5 h-5"}),e.jsx("span",{children:"Edit Order"})]}),onClick:()=>a(`/lats/purchase-orders/${l.data.id}/edit`),variant:"secondary"},{label:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Br,{className:"w-5 h-5"}),e.jsx("span",{children:"Print PO"})]}),onClick:async()=>{try{const p=window.open("","_blank");if(p){const M=await Rs(c);p.document.write(M),p.document.close(),p.print(),m.success("Purchase order sent to printer")}else m.error("Could not open print window. Please check popup settings.")}catch(p){console.error("Error printing:",p),m.error("Failed to print purchase order")}},variant:"secondary"},{label:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5"}),e.jsx("span",{children:"Add Payment"})]}),onClick:()=>{us(c),yt(!0)},variant:"success"}]}),Se([]),Pe(null),o(p=>({...p,expectedDelivery:""})),_e(""),st("sent")}else console.error("Failed to create purchase order:",l.message),m.error(l.message||"Failed to create purchase order")}catch(t){console.error("Error creating purchase order:",t),m.error("Error creating purchase order. Please try again.")}finally{ms(!1)}},[k,K,Ce.expectedDelivery,xe,Ne,dt,q,G,h,a,Ze,R,i,S,A,St,r,me,X]);s.useCallback(async()=>{if(!W){m.error("No purchase order to print");return}try{const t=window.open("","_blank");if(t){const x=await Rs(W);t.document.write(x),t.document.close(),t.print(),m.success("Purchase order sent to printer")}else m.error("Could not open print window. Please check popup settings.")}catch(t){console.error("Error printing:",t),m.error("Failed to print purchase order")}},[W]),s.useCallback(()=>{if(!W){m.error("No purchase order selected");return}yt(!0)},[W]);const br=s.useCallback(async(t,x)=>{var l;if(!W){console.error("âŒ No purchase order available for payment"),m.error("No purchase order selected");return}console.log("ðŸ’° Processing payment for PO:",{id:W.id,orderNumber:W.orderNumber||W.po_number,supplier:(l=W.supplier)==null?void 0:l.name,totalAmount:W.totalAmount||W.total_amount,paymentCount:t.length});try{const{purchaseOrderPaymentService:c}=await pt(()=>import("./purchaseOrderPaymentService-dcbd50c0.js"),["assets/purchaseOrderPaymentService-dcbd50c0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{data:{user:p}}=await(await pt(()=>import("./index-61458a34.js").then(F=>F.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"])).supabase.auth.getUser();console.log("ðŸ‘¤ Current user:",p==null?void 0:p.id);const Z=(await Promise.all(t.map(async F=>{console.log("ðŸ’³ Processing payment:",{purchaseOrderId:W.id,amount:F.amount,currency:F.currency,method:F.paymentMethod});const ne=await c.processPayment({purchaseOrderId:W.id,paymentAccountId:F.paymentAccountId,amount:F.amount,currency:F.currency,paymentMethod:F.paymentMethod,paymentMethodId:F.paymentMethodId,reference:F.reference||`${W.orderNumber||W.po_number}`,notes:F.notes||`Payment via ${F.paymentMethod}`,createdBy:(p==null?void 0:p.id)||""});return console.log("âœ… Payment result:",ne),ne}))).filter(F=>!F.success);if(Z.length>0){const F=Z.map(ne=>ne.message).join("; ");console.error("âŒ Payment failures:",F),m.error(`Some payments failed: ${F}`)}else console.log("âœ… All payments processed successfully"),m.success(`Payment of ${ce(x||t.reduce((F,ne)=>F+ne.amount,0),W.currency||"TZS")} recorded successfully!`);yt(!1)}catch(c){console.error("âŒ Error processing payment:",c),m.error(c.message||"Failed to process payment")}},[W]),yr=s.useCallback(t=>{const x=t.target.value;if(N(x),x.trim()){ke(!0);const l=ue.filter(c=>{var Z,F,ne,J;const p=(Z=c.variants)==null?void 0:Z[0],M=((F=u==null?void 0:u.find(ye=>ye.id===c.categoryId))==null?void 0:F.name)||"";return(((ne=c.name)==null?void 0:ne.toLowerCase())||"").includes(x.toLowerCase())||(((J=p==null?void 0:p.sku)==null?void 0:J.toLowerCase())||"").includes(x.toLowerCase())||(M.toLowerCase()||"").includes(x.toLowerCase())});de(l)}else ke(!1),de([])},[ue,u]),jr=s.useCallback(t=>{t.key==="Enter"&&g.trim()&&t.preventDefault()},[g]),Gt=s.useCallback(t=>{var c;const x=t.target,l=x.tagName==="INPUT"||x.tagName==="TEXTAREA";if(t.key==="?"&&!l){t.preventDefault(),ut(!0);return}if((t.ctrlKey||t.metaKey)&&(t.key==="f"||t.key==="k")){t.preventDefault(),(c=L.current)==null||c.focus();return}if((t.ctrlKey||t.metaKey)&&t.key==="s"){t.preventDefault(),k&&K.length>0?Zt():m.error("Select supplier and add items first");return}if((t.ctrlKey||t.metaKey)&&t.key==="Enter"){t.preventDefault(),k&&K.length>0?Pt():m.error("Select supplier and add items first");return}if((t.ctrlKey||t.metaKey)&&t.key==="b"){t.preventDefault(),jt(p=>!p);return}if((t.ctrlKey||t.metaKey)&&t.key==="i"){t.preventDefault(),Nt(!0);return}if((t.ctrlKey||t.metaKey)&&t.key==="t"){t.preventDefault(),vt(!0);return}if((t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="S"){t.preventDefault(),y(!0);return}if((t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="P"){t.preventDefault(),re(!0);return}if((t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="C"){t.preventDefault(),kt();return}if(t.key==="Escape"){qt?ut(!1):Vt?jt(!1):zt?Nt(!1):Kt?vt(!1):Bt?mt(!1):g&&N("");return}},[kt,k,K,g,qt,Vt,zt,Kt,Bt,Zt,Pt]);s.useEffect(()=>(document.addEventListener("keydown",Gt),()=>{document.removeEventListener("keydown",Gt)}),[Gt]),s.useEffect(()=>{const t=x=>{Qt.current&&!Qt.current.contains(x.target)&&xt(null)};if(Ke)return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[Ke]);const ot=(t,x)=>ce(t,x||q);return r?e.jsxs("div",{className:"min-h-screen",children:[e.jsx(oa,{cartItemsCount:K.length,totalAmount:ht,currency:q,productsCount:ue.length,suppliersCount:C.length,onCreatePurchaseOrder:Pt,onSaveAsDraft:Zt,onClearCart:kt,onAddSupplier:()=>ge(!0),onAddProduct:()=>re(!0),onViewPurchaseOrders:()=>hs(!0),onOpenInstallmentManagement:()=>gs(!0),isCreatingPO:nt,isSavingDraft:Ft,hasSelectedSupplier:!!k}),e.jsx("div",{className:"p-4 sm:p-6 pb-20 max-w-full mx-auto space-y-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:e.jsxs(Ts,{className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ss,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-orange-500"}),e.jsx("input",{ref:L,type:"text",placeholder:i?"Search products to add to this order... (Ctrl+F focus)":"Search products to add to purchase order... (Ctrl+F focus)",value:g,onChange:yr,onKeyPress:jr,className:"w-full pl-14 pr-24 py-5 text-lg border-2 border-orange-200 rounded-xl bg-white text-gray-900 placeholder-orange-400 focus:outline-none focus:ring-4 focus:ring-orange-500/30 focus:border-orange-500 shadow-lg hover:shadow-xl transition-all duration-200",style:{minHeight:"60px"}}),g.trim()&&g.length>=8&&/^[A-Za-z0-9]+$/.test(g)&&e.jsx("div",{className:"absolute left-14 top-1/2 transform -translate-y-1/2",children:e.jsx(_t,{className:"w-4 h-4 text-green-500"})}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("button",{onClick:()=>ve(!ae),className:"p-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg transition-colors duration-200",title:"Advanced filters (Ctrl+F)",children:e.jsx(ns,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>jt(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors text-sm shadow-md",title:"Barcode Scanner (Ctrl+B)",children:[e.jsx(_t,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Scanner"})]}),e.jsxs("button",{onClick:()=>Nt(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors text-sm shadow-md",title:"Bulk Import from CSV (Ctrl+I)",children:[e.jsx(Ks,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Bulk Import"})]}),e.jsxs("button",{onClick:()=>vt(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-amber-600 hover:bg-amber-700 text-white rounded-lg font-medium transition-colors text-sm shadow-md",title:"Order Templates (Ctrl+T)",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Templates"})]}),e.jsx("button",{onClick:()=>ut(!0),className:"flex items-center gap-2 px-3 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm shadow-md",title:"Keyboard Shortcuts (?)",children:e.jsx(Mt,{className:"w-4 h-4"})})]}),tt&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($s,{size:"sm",color:"blue"})}),i&&ps&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($s,{size:"sm",color:"purple"})}),i&&Ht&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(We,{className:"w-5 h-5 text-red-600"}),e.jsxs("span",{className:"text-red-800 font-medium",children:["Edit Error: ",Ht]})]})}),S&&!ps&&!Ht&&e.jsx("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-800 font-medium",children:"Purchase order duplicated successfully"}),e.jsx("p",{className:"text-sm text-purple-700 mt-1",children:'Review the order details and click "Create PO" to save as a new purchase order'})]})]})}),ie&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(We,{className:"w-5 h-5 text-red-600"}),e.jsxs("span",{className:"text-red-800 font-medium",children:["Error: ",ie]})]})}),ae&&e.jsxs("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-orange-50 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:T,onChange:t=>U(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Categories"}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock Status"}),e.jsxs("select",{value:Y,onChange:t=>O(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"all",children:"All Items"}),e.jsx("option",{value:"in-stock",children:"In Stock"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"out-of-stock",children:"Out of Stock"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:he,onChange:t=>pe(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"price",children:"Price"}),e.jsx("option",{value:"stock",children:"Stock"}),e.jsx("option",{value:"recent",children:"Recent"})]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>{U(""),$({min:"",max:""}),O("all"),pe("name"),fe("asc")},className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:"Clear All Filters"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[H&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-700",children:["Search Results (",z.length,")"]}),e.jsx("button",{onClick:()=>ke(!1),className:"text-sm text-orange-600 hover:text-orange-800",children:"Show All Products"})]}),z.length>0?e.jsx("div",{className:"w-full max-w-full mx-auto px-3 sm:px-4 md:px-6 pb-3 sm:pb-4 md:pb-6",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(320px, 100%), 1fr))",gap:"clamp(1rem, 2vw, 1.5rem)",gridAutoRows:"1fr"},children:z.map(t=>e.jsx(Ms,{product:t,onAddToCart:Re,onViewDetails:ws,primaryColor:"orange",actionText:"View Details",allowOutOfStockSelection:!0,showCategory:!0,currencyCode:q.code,currencySymbol:q.symbol,className:"w-full h-full",disableVariantModal:!0},t.id))})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ss,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:['No products found for "',g,'"']})]})]}),!H&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-700",children:i?"Add More Products to Order":"Available Products"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[ue.length," products"]})]}),ue.length>0?e.jsx("div",{className:"w-full max-w-full mx-auto px-3 sm:px-4 md:px-6 pb-3 sm:pb-4 md:pb-6",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(320px, 100%), 1fr))",gap:"clamp(1rem, 2vw, 1.5rem)",gridAutoRows:"1fr"},children:ue.map(t=>e.jsx(Ms,{product:t,onAddToCart:Re,onViewDetails:ws,primaryColor:"orange",actionText:"View Details",allowOutOfStockSelection:!0,showCategory:!0,currencyCode:q.code,currencySymbol:q.symbol,className:"w-full h-full",disableVariantModal:!0},t.id))})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“¦"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products available"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No products found in the database"})]})]})]})]})}),e.jsx("div",{className:"lg:w-[450px] flex-shrink-0",children:e.jsxs(Ts,{className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:e.jsx(Jt,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:i?"Edit Purchase Order":S?"Duplicate Purchase Order":"Purchase Cart"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[K.length," items ",i||S?"in order":"to purchase"]})]})]}),K.length>0&&e.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),kt()},className:"p-3 text-red-500 hover:text-white hover:bg-red-600 rounded-xl transition-all duration-300 shadow-md hover:shadow-lg hover:scale-105",title:"Clear everything - Remove all items, supplier, and order details",children:e.jsx(rs,{className:"w-8 h-8"})})]}),e.jsx("div",{ref:Qt,children:e.jsx("div",{className:"mb-4",children:k?e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 via-amber-50 to-orange-50 rounded-xl border-2 border-orange-200 shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-orange-50/50 transition-colors",onClick:()=>xt(Ke==="supplier"?null:"supplier"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 via-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg",children:k.name.charAt(0)}),e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full border-2 border-white flex items-center justify-center bg-gradient-to-r from-green-400 to-emerald-500",children:e.jsx(ft,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-lg",children:k.name}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Qs,{className:"w-3 h-3"}),k.phone||"No phone"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-r from-orange-100 to-amber-100 text-orange-700 border border-orange-200",children:k.country||"Unknown Location"}),e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-600 bg-white px-2 py-1 rounded-full border border-gray-200",title:`Currency set by supplier: ${k.currency||q.code}`,children:[e.jsx(ls,{className:"w-3 h-3"}),k.currency||q.code]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 text-orange-500",children:Ke==="supplier"?e.jsx(Ot,{className:"w-5 h-5"}):e.jsx($t,{className:"w-5 h-5"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),Pe(null)},className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-all duration-200",children:e.jsx(rs,{className:"w-5 h-5"})})]})]})}),Ke==="supplier"&&e.jsx("div",{className:"animate-in slide-in-from-top-2 duration-300",children:e.jsx(Na,{supplier:k,currency:q,onContactClick:t=>{m(`Contact via ${t}: Feature ready`,{icon:"ðŸ“ž"})},className:"rounded-none border-0 shadow-none"})})]}):e.jsx("div",{className:"bg-gradient-to-br from-orange-50 via-amber-50 to-orange-50 rounded-xl border-2 border-dashed border-orange-300 shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer",onClick:()=>{B(),y(!0)},children:e.jsx("div",{className:"p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-500 via-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white shadow-lg",children:e.jsx(Xe,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Select Supplier"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a supplier to create purchase order"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Click here or press Ctrl+Shift+S"})]}),e.jsxs("button",{onClick:t=>{t.stopPropagation(),B(),y(!0)},className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-medium hover:from-orange-600 hover:to-amber-600 transition-all duration-200 shadow-md hover:shadow-lg",children:[e.jsx(Ve,{className:"w-5 h-5"}),e.jsx("span",{children:"Select Supplier"})]})]})})})})}),e.jsx("div",{className:"mb-4",children:e.jsx(fa,{selectedSupplierId:k==null?void 0:k.id,selectedSupplierName:k==null?void 0:k.name,onAddToCart:Re,isExpanded:Ke==="lowStock",onToggle:()=>xt(Ke==="lowStock"?null:"lowStock")})}),k&&e.jsx("div",{className:"mb-4",children:e.jsx(ba,{selectedSupplierId:k.id,currency:q,onAddToCart:Re,isExpanded:Ke==="recentOrders",onToggle:()=>xt(Ke==="recentOrders"?null:"recentOrders")})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:K.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Jt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cart is empty"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add products to create a purchase order"})]}):e.jsx("div",{className:"space-y-4 mb-6",children:[...K].reverse().map((t,x)=>e.jsx(ua,{item:t,index:x,currency:q,exchangeRates:xe,isLatest:x===0,onUpdateQuantity:ir,onUpdateCostPrice:dr,onRemove:cr},t.id))})}),K.length>0&&e.jsxs(e.Fragment,{children:[k&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Currency & Exchange Rate"}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white border-2 border-gray-200 rounded-lg hover:border-orange-300 focus-within:border-orange-500 transition-all duration-200",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 p-2 bg-gray-100 rounded-md",children:[e.jsx("span",{className:"text-lg",children:q.flag}),e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:q.code})]}),e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:xe,onChange:t=>Ae(t.target.value),placeholder:"Rate (e.g., 1 USD = 150 TZS)",className:"w-full border-0 focus:outline-none focus:ring-0 text-base font-bold text-gray-800 placeholder-gray-400 bg-transparent"})}),xe&&q.code!=="TZS"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"bg-green-100 text-green-700 text-xs px-2 py-1 rounded-md font-medium",children:["â‰ˆ ",Math.round(bs(xe)||0)," TZS"]})})]}),!xe&&Ye&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-500 bg-white/60 border border-dashed border-gray-300 rounded-lg px-3 py-2",children:[e.jsxs("span",{children:["Last used: ",e.jsx("span",{className:"font-semibold text-gray-700",children:Ye})]}),e.jsx("button",{type:"button",onClick:()=>Ae(Ye),className:"text-xs font-semibold text-blue-600 hover:text-blue-700 transition-colors",children:"Use rate"})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-orange-50 rounded-xl p-4 border border-gray-200 shadow-sm flex-shrink-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Items"}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900",children:[K.length," ",K.length===1?"item":"items"]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Quantity"}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900",children:[K.reduce((t,x)=>t+x.quantity,0)," units"]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Subtotal"}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-semibold text-gray-900",children:ot(Ct)})})]}),q.code!=="TZS"&&xe&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Total in TZS"}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-semibold text-green-600",children:ot(or,{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})})})]}),e.jsx("div",{className:"border-t-2 border-gray-300 pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total Amount"}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xl font-bold text-orange-600",children:ot(ht)})})]})})]})}),e.jsx("div",{className:"mt-4 space-y-3 flex-shrink-0",children:e.jsx(Ge,{onClick:Pt,icon:nt?e.jsx(qr,{size:20,className:"animate-spin"}):e.jsx(Be,{size:20}),className:"w-full h-16 bg-gradient-to-r from-purple-600 to-purple-700 text-white text-lg font-bold hover:from-purple-700 hover:to-purple-800 transition-all",disabled:!k||K.length===0||nt,children:nt?i&&!S?"Updating...":"Creating...":i&&!S?"Update PO":"Create PO"})})]})]})})]})}),D&&e.jsx(da,{isOpen:D,onClose:()=>y(!1),onSupplierSelect:xr,suppliers:C}),Js&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Shipping Configuration"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Shipping configuration will be implemented soon."}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{B(),Xs(!1)},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Close"})})]})}),Fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Draft Management"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Draft management functionality will be implemented soon."}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{B(),at(!1)},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Close"})})]})}),Ys&&k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-lg w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Supplier Details"}),e.jsx("button",{onClick:()=>Rt(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(Xe,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:k.name}),e.jsx("p",{className:"text-sm text-gray-600",children:k.category})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"text-gray-900",children:k.email||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"text-gray-900",children:k.phone||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Address"}),e.jsx("p",{className:"text-gray-900",children:k.address||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"City"}),e.jsx("p",{className:"text-gray-900",children:k.city||"Not provided"})]})]}),k.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("p",{className:"text-gray-900",children:k.notes})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{onClick:()=>Rt(!1),className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"}),e.jsx("button",{onClick:()=>{Rt(!1),ge(!0)},className:"flex-1 bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors",children:"Edit Supplier"})]})]})]})}),se&&e.jsx(Ws,{isOpen:se,onClose:()=>ge(!1),onSupplierCreated:()=>{ge(!1)}}),Ee&&e.jsx(Xr,{isOpen:Ee,onClose:()=>re(!1),onProductAdded:mr,currency:q}),Je&&xs&&e.jsx(ha,{isOpen:Je,onClose:()=>{ds(!1),Ut(null)},product:xs,currency:q,onAddToCart:Re}),e.jsx(aa,{...R.props}),e.jsx(ta,{isOpen:sr,onClose:()=>hs(!1)}),e.jsx(sa,{isOpen:rr,onClose:()=>gs(!1)}),e.jsx(xa,{isOpen:Fe,onClose:()=>at(!1),onLoadDraft:t=>{Pe(t.supplier),Se(t.cartItems),Ie(t.currency),$e(t.paymentTerms),_e(t.notes)},onSaveDraft:t=>{},currentDraft:{supplier:k,cartItems:K,currency:q,paymentTerms:me,notes:Ne}}),e.jsx(ma,{isOpen:er,onClose:()=>tr(!1),onSave:t=>{o(t)},initialData:Ce}),e.jsx(pa,{isOpen:qt,onClose:()=>ut(!1)}),e.jsx(ya,{isOpen:Vt,onClose:()=>jt(!1),onScanSuccess:ur,products:ue}),e.jsx(ja,{isOpen:zt,onClose:()=>Nt(!1),onImport:hr,products:ue}),e.jsx(va,{isOpen:Kt,onClose:()=>vt(!1),onLoadTemplate:gr,currentData:k&&K.length>0?{supplierId:k.id,supplierName:k.name,items:K,currency:q.code,paymentTerms:me,notes:Ne}:void 0}),W&&e.jsx(wa,{isOpen:nr,onClose:()=>lr(!1),purchaseOrder:W,supplier:k,onSend:pr}),W&&e.jsx(na,{isOpen:ar,onClose:()=>yt(!1),amount:W.totalAmount||W.total_amount||0,customerId:W.supplierId||W.supplier_id||((Ss=W.supplier)==null?void 0:Ss.id),customerName:((Cs=W.supplier)==null?void 0:Cs.name)||"Supplier",description:`Payment for Purchase Order ${W.orderNumber||W.po_number||"N/A"}`,onPaymentComplete:br,title:"Purchase Order Payment",paymentType:"cash_out"}),Bt&&k&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-3xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-100 to-amber-100 p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(Jt,{className:"w-10 h-10 text-white"})}),e.jsx("button",{onClick:()=>mt(!1),className:"w-9 h-9 flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:i?"Update Purchase Order":"Create Purchase Order"}),e.jsxs("p",{className:"text-gray-700",children:["Review your order details before ",i?"updating":"creating"]})]}),e.jsx("div",{className:"p-8 overflow-y-auto flex-1",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-orange-600"}),"Supplier Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Supplier Name"}),e.jsx("p",{className:"font-semibold text-gray-900",children:k.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Contact"}),e.jsx("p",{className:"font-semibold text-gray-900",children:k.phone||k.email||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-purple-600"}),"Order Items"]}),e.jsx("div",{className:"space-y-3 mb-4",children:K.map((t,x)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.variantName," â€¢ SKU: ",t.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["Qty: ",t.quantity]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[ot(t.costPrice,q)," each"]})]})]},t.id))}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:K.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Quantity"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:K.reduce((t,x)=>t+x.quantity,0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Subtotal"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:ot(Ct,q)})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg p-6 border-2 border-orange-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Vs,{className:"w-5 h-5 text-orange-600"}),"Financial Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Currency"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[q.code," - ",q.name]})]}),X&&X.rate!==1&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Exchange Rate"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["1 ",q.code," = ",X.rate," TZS"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Payment Terms"}),e.jsx("span",{className:"font-semibold text-gray-900",children:me==="net_30"?"Net 30":me==="net_60"?"Net 60":me==="cod"?"Cash on Delivery":me==="advance"?"Advance Payment":"Net 30"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-orange-200",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total Amount"}),e.jsx("span",{className:"text-2xl font-bold text-orange-600",children:ot(ht,q)})]}),X&&X.rate!==1&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Equivalent in TZS"}),e.jsxs("span",{className:"font-semibold text-gray-700",children:["TZS ",(ht*X.rate).toLocaleString()]})]})]})]}),(Ce.expectedDelivery||Ne)&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Information"}),e.jsxs("div",{className:"space-y-3",children:[Ce.expectedDelivery&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Expected Delivery"}),e.jsx("p",{className:"font-semibold text-gray-900",children:new Date(Ce.expectedDelivery).toLocaleDateString()})]}),Ne&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Notes"}),e.jsx("p",{className:"text-gray-900",children:Ne})]})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-8 py-6 flex gap-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>mt(!1),className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 rounded-xl transition-colors font-semibold",children:"Cancel"}),e.jsx("button",{onClick:fr,disabled:nt,className:"flex-1 px-6 py-3 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white rounded-xl transition-colors font-semibold shadow-lg flex items-center justify-center gap-2",children:nt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),i?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-5 h-5"}),i?"Confirm & Update":"Confirm & Create"]})})]})]})}),e.jsxs("button",{onClick:()=>ut(!0),className:"fixed bottom-6 right-6 z-40 w-14 h-14 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-full shadow-2xl hover:shadow-xl transition-all duration-200 flex items-center justify-center group",title:"Keyboard Shortcuts (?)",children:[e.jsx(Mt,{className:"w-6 h-6 group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"absolute -top-10 right-0 bg-gray-900 text-white text-xs font-medium px-3 py-1.5 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:"Press ? for shortcuts"})]}),j.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full animate-scale-in",children:[e.jsxs("div",{className:"flex items-start gap-4 p-6 pb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-red-50 flex items-center justify-center",children:e.jsx(We,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:j.title}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed whitespace-pre-line",children:j.message})]}),e.jsx("button",{onClick:I,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-3 px-6 pb-6",children:[e.jsx("button",{onClick:()=>{j.onCancel&&j.onCancel(),I()},disabled:j.loading,className:"flex-1 px-4 py-2.5 border-2 border-gray-300 rounded-xl text-gray-700 font-semibold hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j.cancelText||"Cancel"}),e.jsx("button",{onClick:()=>{j.onConfirm&&j.onConfirm(),I()},disabled:j.loading,className:"flex-1 px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-xl font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:j.loading?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Loading..."]}):j.confirmText||"Confirm"})]})]})}),v.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full animate-scale-in",children:[e.jsxs("div",{className:"flex items-start gap-4 p-6 pb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center",children:e.jsx(We,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:v.title}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed whitespace-pre-line",children:v.message})]}),e.jsx("button",{onClick:P,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex gap-3 px-6 pb-6",children:e.jsx("button",{onClick:P,className:"flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-colors shadow-lg",children:v.confirmText||"OK"})})]})})]}):null};export{dn as default};
