import{s as p,j as e}from"./index-61458a34.js";import{r as l}from"./vendor-36d2c7c1.js";import{z as i,X as ie,$,a5 as de,N as oe,bC as L,bh as W,r as ue,cN as me,l as he,Y as xe,f as Z,e as ge,R as pe,d as be}from"./ui-28e30067.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";const je=({isOpen:v,onClose:r,messageType:a="whatsapp",preselectedRecipients:o=[]})=>{const[d,f]=l.useState(1),[S,T]=l.useState(!1),[b,I]=l.useState(""),[u,D]=l.useState(a),[c,R]=l.useState(""),[m,N]=l.useState(o),[h,_]=l.useState("once"),[j,g]=l.useState(""),[y,O]=l.useState("09:00"),[C,A]=l.useState(""),[F,q]=l.useState("Africa/Dar_es_Salaam"),[k,M]=l.useState("server"),[s,n]=l.useState(!0),[w,P]=l.useState(""),[J,G]=l.useState("image"),[V,H]=l.useState(!1),[Q,Ne]=l.useState(3e3),[K,ye]=l.useState(8e3),[ee,we]=l.useState(!0),[se,ve]=l.useState(!0),[te,re]=l.useState([]),[B,ae]=l.useState("");l.useEffect(()=>{v&&le()},[v]);const le=async()=>{try{const{data:t,error:x}=await p.from("customers").select("id, name, phone").order("name");if(x)throw x;re(t||[])}catch(t){console.error("Error loading customers:",t),i.error("Failed to load customers")}},X=te.filter(t=>t.name.toLowerCase().includes(B.toLowerCase())||t.phone.includes(B)),ne=t=>{const x=m.find(E=>E.id===t.id);N(x?m.filter(E=>E.id!==t.id):[...m,t])},ce=async()=>{var t;if(!b.trim()){i.error("Please enter a campaign name");return}if(!c.trim()){i.error("Please enter a message");return}if(m.length===0){i.error("Please select at least one recipient");return}if(!j||!y){i.error("Please select date and time");return}try{T(!0);const x=new Date(`${j}T${y}:00`).toISOString();if(new Date(x)<new Date){i.error("Scheduled time must be in the future");return}const E={user_id:(t=(await p.auth.getUser()).data.user)==null?void 0:t.id,name:b,message_type:u,message_content:c,recipients:m.map(U=>({phone:U.phone,name:U.name,customerId:U.id})),total_recipients:m.length,schedule_type:h,scheduled_for:x,timezone:F,recurrence_end_date:C?new Date(C).toISOString():null,execution_mode:k,auto_execute:s,settings:{use_personalization:se,random_delay:ee,min_delay:Q,max_delay:K,use_presence:!0,batch_size:50},media_url:u==="whatsapp"?w:null,media_type:u==="whatsapp"&&w?J:null,view_once:u==="whatsapp"?V:!1},{data:Se,error:Y}=await p.from("scheduled_bulk_messages").insert(E).select().single();if(Y)throw Y;i.success("Message scheduled successfully!"),r(),I(""),R(""),N([]),g(""),O("09:00"),f(1)}catch(x){console.error("Error scheduling message:",x),i.error("Failed to schedule message: "+x.message)}finally{T(!1)}};return v?e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[99999]",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Schedule Bulk Message"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Step ",d," of 4"]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ie,{size:24})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[d===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Campaign Name *"}),e.jsx("input",{type:"text",value:b,onChange:t=>I(t.target.value),placeholder:"e.g., Monthly Newsletter",className:"w-full p-3 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Message Type *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>D("sms"),className:`p-4 border rounded-lg flex items-center justify-center gap-2 ${u==="sms"?"border-blue-500 bg-blue-50":"hover:bg-gray-50"}`,children:[e.jsx($,{size:20}),e.jsx("span",{className:"font-medium",children:"SMS"})]}),e.jsxs("button",{onClick:()=>D("whatsapp"),className:`p-4 border rounded-lg flex items-center justify-center gap-2 ${u==="whatsapp"?"border-green-500 bg-green-50":"hover:bg-gray-50"}`,children:[e.jsx($,{size:20}),e.jsx("span",{className:"font-medium",children:"WhatsApp"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Message *"}),e.jsx("textarea",{value:c,onChange:t=>R(t.target.value),placeholder:"Enter your message... Use {name}, {phone}, {date}, {time} for personalization",rows:6,className:"w-full p-3 border rounded-lg"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[c.length," characters"]})]}),u==="whatsapp"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Media URL (Optional)"}),e.jsx("input",{type:"text",value:w,onChange:t=>P(t.target.value),placeholder:"https://example.com/image.jpg",className:"w-full p-3 border rounded-lg"}),w&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("select",{value:J,onChange:t=>G(t.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"image",children:"Image"}),e.jsx("option",{value:"video",children:"Video"}),e.jsx("option",{value:"document",children:"Document"}),e.jsx("option",{value:"audio",children:"Audio"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:V,onChange:t=>H(t.target.checked)}),e.jsx("span",{className:"text-sm",children:"View Once"})]})]})]})]}),d===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Search Customers"}),e.jsx("input",{type:"text",value:B,onChange:t=>ae(t.target.value),placeholder:"Search by name or phone...",className:"w-full p-3 border rounded-lg"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium",children:[m.length," recipient(s) selected"]}),e.jsx("button",{onClick:()=>N(X),className:"text-sm text-blue-600 hover:underline",children:"Select All"})]}),e.jsx("div",{className:"border rounded-lg max-h-96 overflow-y-auto",children:X.map(t=>e.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",children:[e.jsx("input",{type:"checkbox",checked:m.some(x=>x.id===t.id),onChange:()=>ne(t),className:"w-4 h-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.phone})]})]},t.id))})]}),d===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Schedule Type *"}),e.jsxs("select",{value:h,onChange:t=>_(t.target.value),className:"w-full p-3 border rounded-lg",children:[e.jsx("option",{value:"once",children:"Send Once"}),e.jsx("option",{value:"recurring_daily",children:"Daily"}),e.jsx("option",{value:"recurring_weekly",children:"Weekly"}),e.jsx("option",{value:"recurring_monthly",children:"Monthly"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Date *"}),e.jsx("input",{type:"date",value:j,onChange:t=>g(t.target.value),min:new Date().toISOString().split("T")[0],className:"w-full p-3 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Time *"}),e.jsx("input",{type:"time",value:y,onChange:t=>O(t.target.value),className:"w-full p-3 border rounded-lg"})]})]}),h!=="once"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:C,onChange:t=>A(t.target.value),min:j||new Date().toISOString().split("T")[0],className:"w-full p-3 border rounded-lg"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Leave empty for no end date"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Execution Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>M("server"),className:`p-4 border rounded-lg text-left ${k==="server"?"border-blue-500 bg-blue-50":"hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium",children:"Server (Recommended)"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Runs in background, no browser needed"})]}),e.jsxs("button",{onClick:()=>M("browser"),className:`p-4 border rounded-lg text-left ${k==="browser"?"border-blue-500 bg-blue-50":"hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium",children:"Browser"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Runs in your browser tab"})]})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:t=>n(t.target.checked)}),e.jsx("span",{className:"text-sm",children:"Auto-execute at scheduled time"})]})]}),d===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Review Your Scheduled Message"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Campaign Name:"}),e.jsx("span",{className:"font-medium",children:b})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsx("span",{className:"font-medium",children:u.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Recipients:"}),e.jsx("span",{className:"font-medium",children:m.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Scheduled For:"}),e.jsxs("span",{className:"font-medium",children:[j," at ",y]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Schedule Type:"}),e.jsx("span",{className:"font-medium",children:h==="once"?"One-time":h.replace("recurring_","").charAt(0).toUpperCase()+h.replace("recurring_","").slice(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Execution:"}),e.jsx("span",{className:"font-medium",children:k==="server"?"Server":"Browser"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Message Preview:"}),e.jsx("div",{className:"bg-white p-3 rounded border text-sm",children:c})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"âš ï¸ Your message will be sent automatically at the scheduled time. Make sure all details are correct before confirming."})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t bg-gray-50",children:[e.jsx("button",{onClick:()=>d>1?f(d-1):r(),className:"px-6 py-2 border rounded-lg hover:bg-white",children:d===1?"Cancel":"Back"}),d<4?e.jsx("button",{onClick:()=>f(d+1),disabled:d===1&&(!b||!c)||d===2&&m.length===0||d===3&&(!j||!y),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"}):e.jsxs("button",{onClick:ce,disabled:S,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(de,{size:16}),S?"Scheduling...":"Schedule Message"]})]})]})}):null};class fe{constructor(){this.worker=null,this.isInitialized=!1,this.listeners=new Map}initialize(){if(this.isInitialized){console.log("Browser scheduler already initialized");return}try{this.worker=new Worker("/scheduler-worker.js"),this.worker.onmessage=r=>{const{type:a,payload:o}=r.data;this.handleWorkerMessage(a,o)},this.worker.onerror=r=>{console.error("Browser scheduler worker error:",r),this.emit("error",r)},this.isInitialized=!0,console.log("âœ… Browser scheduler initialized")}catch(r){throw console.error("Failed to initialize browser scheduler:",r),r}}start(){var o;this.isInitialized||this.initialize();const r="https://jxhzveborezjhsmzsgbc.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4aHp2ZWJvcmV6amhzbXpzZ2JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3MTE1MjQsImV4cCI6MjA2ODI4NzUyNH0.pIug4PlJ3Q14GxcYilW-u0blByYoyeOfN3q9RNIjgfw";(o=this.worker)==null||o.postMessage({type:"START",payload:{supabaseUrl:r,supabaseKey:a}}),console.log("ðŸ“… Starting browser scheduler...")}stop(){var r;(r=this.worker)==null||r.postMessage({type:"STOP"}),console.log("â¹ï¸  Stopping browser scheduler...")}setCheckInterval(r){var a;(a=this.worker)==null||a.postMessage({type:"SET_INTERVAL",payload:{interval:r}})}checkNow(){var r;(r=this.worker)==null||r.postMessage({type:"CHECK_NOW"})}executeMessage(r){var a;(a=this.worker)==null||a.postMessage({type:"EXECUTE",payload:{messageId:r}})}terminate(){var r;(r=this.worker)==null||r.terminate(),this.worker=null,this.isInitialized=!1,console.log("ðŸ”´ Browser scheduler terminated")}handleWorkerMessage(r,a){switch(r){case"READY":console.log("âœ… Scheduler worker ready"),this.emit("ready",a);break;case"STARTED":console.log("âœ… Scheduler started:",a.message),this.emit("started",a);break;case"STOPPED":console.log("â¹ï¸  Scheduler stopped"),this.emit("stopped",a);break;case"LOG":console.log("ðŸ“… [Scheduler]:",a),this.emit("log",a);break;case"ERROR":console.error("âŒ [Scheduler Error]:",a),this.emit("error",a);break;case"EXECUTION_STARTED":console.log("ðŸ“¤ Execution started:",a.messageId),this.emit("execution_started",a);break;case"EXECUTION_COMPLETED":console.log("âœ… Execution completed:",a),this.emit("execution_completed",a);break;case"EXECUTION_FAILED":console.error("âŒ Execution failed:",a),this.emit("execution_failed",a);break;case"PROGRESS":this.emit("progress",a);break;default:console.log("Unknown worker message:",r,a)}}on(r,a){this.listeners.has(r)||this.listeners.set(r,new Set),this.listeners.get(r).add(a)}off(r,a){const o=this.listeners.get(r);o&&o.delete(a)}emit(r,a){const o=this.listeners.get(r);o&&o.forEach(d=>d(a))}isWorkerInitialized(){return this.isInitialized}}const z=new fe,ze=()=>{const[v,r]=l.useState([]),[a,o]=l.useState(!0),[d,f]=l.useState(!1),[S,T]=l.useState("all"),[b,I]=l.useState("all"),[u,D]=l.useState(""),[c,R]=l.useState(null),[m,N]=l.useState(!1),[h,_]=l.useState(!1);l.useEffect(()=>{g();const s=p.channel("scheduled_messages_changes").on("postgres_changes",{event:"*",schema:"public",table:"scheduled_bulk_messages"},()=>{g()}).subscribe();return j(),()=>{s.unsubscribe()}},[]);const j=async()=>{try{const{data:s}=await p.from("scheduled_bulk_messages").select("id").eq("execution_mode","browser").in("status",["pending","scheduled"]).limit(1);s&&s.length>0&&(z.isWorkerInitialized()||(z.initialize(),z.start(),_(!0),i.success("Browser scheduler started")))}catch(s){console.error("Error checking browser scheduler:",s)}},g=async()=>{try{const{data:s}=await p.auth.getUser();if(!s.user)return;let n=p.from("scheduled_bulk_messages").select("*").eq("user_id",s.user.id).order("created_at",{ascending:!1});S!=="all"&&(n=n.eq("status",S)),b!=="all"&&(n=n.eq("message_type",b));const{data:w,error:P}=await n;if(P)throw P;r(w||[])}catch(s){console.error("Error loading messages:",s),i.error("Failed to load scheduled messages")}finally{o(!1)}},y=async s=>{try{(await(await fetch(`/api/scheduled-messages/${s}/execute`,{method:"POST"})).json()).success?(i.success("Message executed successfully"),g()):i.error("Failed to execute message")}catch(n){console.error("Error executing message:",n),i.error("Failed to execute message")}},O=async s=>{try{const{error:n}=await p.from("scheduled_bulk_messages").update({status:"paused"}).eq("id",s);if(n)throw n;i.success("Message paused"),g()}catch(n){console.error("Error pausing message:",n),i.error("Failed to pause message")}},C=async s=>{try{const{error:n}=await p.from("scheduled_bulk_messages").update({status:"scheduled"}).eq("id",s);if(n)throw n;i.success("Message resumed"),g()}catch(n){console.error("Error resuming message:",n),i.error("Failed to resume message")}},A=async s=>{if(confirm("Are you sure you want to delete this scheduled message?"))try{const{error:n}=await p.from("scheduled_bulk_messages").delete().eq("id",s);if(n)throw n;i.success("Message deleted"),g()}catch(n){console.error("Error deleting message:",n),i.error("Failed to delete message")}},F=()=>{h?(z.stop(),_(!1),i.success("Browser scheduler stopped")):(z.start(),_(!0),i.success("Browser scheduler started"))},q=s=>{switch(s){case"completed":return"bg-green-100 text-green-800";case"running":return"bg-blue-100 text-blue-800";case"pending":case"scheduled":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"paused":return"bg-gray-100 text-gray-800";case"cancelled":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-800"}},k=s=>{switch(s){case"completed":return e.jsx(be,{size:16});case"running":return e.jsx(pe,{size:16,className:"animate-spin"});case"failed":return e.jsx(Z,{size:16});case"paused":return e.jsx(L,{size:16});default:return e.jsx(ge,{size:16})}},M=v.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())||s.message_content.toLowerCase().includes(u.toLowerCase()));return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Scheduled Messages"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your scheduled bulk SMS and WhatsApp messages"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(oe,{size:20}),"Schedule New"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[e.jsx($,{size:18}),"Browser Scheduler"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:h?"Running - Browser-mode messages will be processed automatically":"Stopped - Start to process browser-mode messages"})]}),e.jsxs("button",{onClick:F,className:`px-4 py-2 rounded-lg flex items-center gap-2 ${h?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"}`,children:[h?e.jsx(L,{size:16}):e.jsx(W,{size:16}),h?"Stop":"Start"]})]}),e.jsx("div",{className:"bg-white rounded-lg border p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Search"}),e.jsx("input",{type:"text",value:u,onChange:s=>D(s.target.value),placeholder:"Search messages...",className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),e.jsxs("select",{value:S,onChange:s=>T(s.target.value),className:"w-full p-2 border rounded-lg",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Type"}),e.jsxs("select",{value:b,onChange:s=>I(s.target.value),className:"w-full p-2 border rounded-lg",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"sms",children:"SMS"}),e.jsx("option",{value:"whatsapp",children:"WhatsApp"})]})]})]})}),M.length===0?e.jsxs("div",{className:"bg-white rounded-lg border p-12 text-center",children:[e.jsx(ue,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Scheduled Messages"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Schedule your first bulk message to get started"}),e.jsx("button",{onClick:()=>f(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Schedule Message"})]}):e.jsx("div",{className:"space-y-4",children:M.map(s=>e.jsxs("div",{className:"bg-white rounded-lg border p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.name}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${q(s.status)}`,children:[k(s.status),s.status.toUpperCase()]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.message_type==="sms"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:s.message_type.toUpperCase()}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:s.execution_mode==="server"?"SERVER":"BROWSER"})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.message_content})]}),e.jsx("div",{className:"relative",children:e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(me,{size:20})})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Recipients"}),e.jsx("p",{className:"font-medium",children:s.total_recipients})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Scheduled For"}),e.jsx("p",{className:"font-medium",children:new Date(s.scheduled_for).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Schedule Type"}),e.jsx("p",{className:"font-medium",children:s.schedule_type.replace("recurring_","")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Executed"}),e.jsxs("p",{className:"font-medium",children:[s.execution_count," times"]})]}),s.progress&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Progress"}),e.jsxs("p",{className:"font-medium",children:[s.progress.success,"/",s.progress.total,s.progress.failed>0&&e.jsxs("span",{className:"text-red-600 ml-1",children:["(",s.progress.failed," failed)"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t",children:[(s.status==="pending"||s.status==="scheduled")&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y(s.id),className:"px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm flex items-center gap-1",children:[e.jsx(W,{size:14}),"Execute Now"]}),e.jsxs("button",{onClick:()=>O(s.id),className:"px-3 py-1.5 border rounded hover:bg-gray-50 text-sm flex items-center gap-1",children:[e.jsx(L,{size:14}),"Pause"]})]}),s.status==="paused"&&e.jsxs("button",{onClick:()=>C(s.id),className:"px-3 py-1.5 bg-green-600 text-white rounded hover:bg-green-700 text-sm flex items-center gap-1",children:[e.jsx(W,{size:14}),"Resume"]}),e.jsxs("button",{onClick:()=>{R(s),N(!0)},className:"px-3 py-1.5 border rounded hover:bg-gray-50 text-sm flex items-center gap-1",children:[e.jsx(he,{size:14}),"View"]}),e.jsxs("button",{onClick:()=>A(s.id),className:"px-3 py-1.5 border border-red-200 text-red-600 rounded hover:bg-red-50 text-sm flex items-center gap-1 ml-auto",children:[e.jsx(xe,{size:14}),"Delete"]})]})]},s.id))}),e.jsx(je,{isOpen:d,onClose:()=>{f(!1),g()}}),m&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[99999]",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-3xl max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Message Details"}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Z,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Campaign Name"}),e.jsx("p",{className:"text-gray-700",children:c.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Message"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:c.message_content})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Recipients"}),e.jsxs("p",{className:"text-gray-700",children:[c.total_recipients," recipients"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Type"}),e.jsx("p",{className:"text-gray-700",children:c.message_type.toUpperCase()})]})]}),c.progress&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Execution Progress"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.progress.success}),e.jsx("p",{className:"text-sm text-gray-600",children:"Success"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.progress.failed}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.progress.pending}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Schedule Information"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Scheduled For:"}),e.jsx("span",{className:"font-medium",children:new Date(c.scheduled_for).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Schedule Type:"}),e.jsx("span",{className:"font-medium",children:c.schedule_type})]}),c.next_execution_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Next Execution:"}),e.jsx("span",{className:"font-medium",children:new Date(c.next_execution_at).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Execution Mode:"}),e.jsx("span",{className:"font-medium",children:c.execution_mode})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Times Executed:"}),e.jsx("span",{className:"font-medium",children:c.execution_count})]})]})]})]})]})})]})};export{ze as default};
