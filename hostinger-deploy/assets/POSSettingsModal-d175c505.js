import{j as e,J as me,b2 as K,b5 as he,u as ue}from"./index-61458a34.js";import{r as x,R as D}from"./vendor-36d2c7c1.js";import{R as pe,bs as xe,aw as ge,X as G,ag as X,aZ as be,l as H,a8 as I,Z as Q,a7 as fe,a2 as ae,bz as J,z as C,af as _e,ae as ye,y as je,O as we,k as ve,cZ as Ne,c_ as Se,a3 as V,aP as ke,r as Ce,b7 as Pe,a6 as Te,o as te,u as De,Q as Re,d as U,cH as Ae,p as q,ax as Ee,S as Fe,M as Me,al as ze,v as Le,G as Oe,n as ee}from"./ui-28e30067.js";import{u as He}from"./useBodyScrollLock-341c8b9f.js";import{u as W}from"./POSPageOptimized-c894624a.js";import{G as Be}from"./GlassTabs-05c8a392.js";import{format as N}from"./format-aff4c6a2.js";import{p as $e}from"./formatPhoneForInvoice-e7084c6d.js";import{u as Ie}from"./useBusinessInfo-62d31733.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";import"./rbac-6ed8a520.js";import"./usePOSClickSounds-e5b9fd69.js";import"./VariantProductCard-04300406.js";import"./robustImageService-f15af7ef.js";import"./imeiVariantService-4ce4b8b1.js";import"./GlassBadge-9ae09fa8.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";import"./SafeImage-a3ef104e.js";import"./specificationUtils-0c00478d.js";import"./PriceInput-aa1a05e9.js";import"./CategoryInput-e47eba98.js";import"./AddCustomerModal-175a5a1a.js";import"./CustomerForm-3440546b.js";import"./phoneUtils-a8934478.js";import"./useSuccessModal-081786c4.js";import"./SuccessModalIcons-fe811e4d.js";import"./search-cbe15294.js";import"./customerCacheService-9b459c09.js";import"./LoadingSpinner-251d9268.js";import"./useDialog-6eb5c329.js";import"./CustomerDetailModal-ad4a2166.js";import"./appointments-0b344a33.js";import"./whatsappService-09f99080.js";import"./Modal-a5e4c1ba.js";import"./returns-8e3dd741.js";import"./AppointmentModal-91a07df7.js";import"./index-5a6a7dda.js";import"./pdf-e6e38bab.js";import"./GlassInput-0475021a.js";import"./saleProcessingService-f5a8fb75.js";import"./TradeInContractModal-15d48929.js";import"./toPropertyKey-7cc7522c.js";import"./tradeInApi-5d12dbe0.js";import"./ComprehensivePaymentModal-83b44bf0.js";import"./currencyUtils-59109a41.js";import"./InstallmentManagementModal-0b553ce1.js";import"./CustomerTooltip-6a958832.js";import"./PaymentsPopupModal-6fe61f19.js";import"./draftService-00fb159f.js";import"./ShareReceiptModal-8db20b0e.js";import"./html2canvas.esm-6bd083a4.js";import"./GlobalSearchShortcut-c0731781.js";import"./SearchResults-c1876f8f.js";const B=({title:l,description:d,icon:s,children:u,isLoading:m=!1})=>m?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(pe,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading settings..."})]}):e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"space-y-6",children:u})}),$=({content:l,position:d="top",maxWidth:s="300px"})=>{const[u,m]=x.useState(!1),[b,p]=x.useState(d),f=x.useRef(null),i=x.useRef(null);x.useEffect(()=>{if(u&&f.current&&i.current){const t=f.current,v=i.current.getBoundingClientRect(),_=t.getBoundingClientRect();let y=d;d==="top"&&v.top<_.height+10?y="bottom":d==="bottom"&&window.innerHeight-v.bottom<_.height+10?y="top":d==="left"&&v.left<_.width+10?y="right":d==="right"&&window.innerWidth-v.right<_.width+10&&(y="left"),p(y)}},[u,d]);const g=()=>{switch(b){case"top":return"bottom-full left-1/2 transform -translate-x-1/2 mb-2";case"bottom":return"top-full left-1/2 transform -translate-x-1/2 mt-2";case"left":return"right-full top-1/2 transform -translate-y-1/2 mr-2";case"right":return"left-full top-1/2 transform -translate-y-1/2 ml-2";default:return"bottom-full left-1/2 transform -translate-x-1/2 mb-2"}},o=()=>{switch(b){case"top":return"top-full left-1/2 transform -translate-x-1/2 border-t-gray-900 border-l-transparent border-r-transparent border-b-transparent";case"bottom":return"bottom-full left-1/2 transform -translate-x-1/2 border-b-gray-900 border-l-transparent border-r-transparent border-t-transparent";case"left":return"left-full top-1/2 transform -translate-y-1/2 border-l-gray-900 border-t-transparent border-b-transparent border-r-transparent";case"right":return"right-full top-1/2 transform -translate-y-1/2 border-r-gray-900 border-t-transparent border-b-transparent border-l-transparent";default:return"top-full left-1/2 transform -translate-x-1/2 border-t-gray-900 border-l-transparent border-r-transparent border-b-transparent"}};return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("button",{ref:i,type:"button",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),onFocus:()=>m(!0),onBlur:()=>m(!1),onClick:t=>{t.preventDefault(),t.stopPropagation(),m(!u)},className:"inline-flex items-center justify-center w-4 h-4 text-gray-400 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 rounded-full","aria-label":"Help",children:e.jsx(xe,{className:"w-4 h-4"})}),u&&e.jsxs("div",{ref:f,className:`absolute z-[9999] ${g()}`,style:{maxWidth:s},onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"bg-gray-900 text-white text-sm rounded-lg shadow-xl p-3 leading-relaxed",children:typeof l=="string"?e.jsx("p",{className:"whitespace-pre-line",children:l}):l}),e.jsx("div",{className:`absolute w-0 h-0 border-4 ${o()}`})]})]})},r=({id:l,label:d,description:s,helpText:u,checked:m,onChange:b,disabled:p=!1})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:d}),u&&e.jsx($,{content:u})]}),s&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[e.jsx("input",{type:"checkbox",id:l,checked:m,onChange:f=>b(f.target.checked),disabled:p,className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 ${p?"opacity-50 cursor-not-allowed":""}`})]})]}),F=({id:l,label:d,description:s,helpText:u,value:m,onChange:b,min:p,max:f,step:i=1,placeholder:g,disabled:o=!1})=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:l,className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx("span",{children:d}),u&&e.jsx($,{content:u})]}),e.jsx("input",{type:"number",id:l,value:m||"",onChange:t=>{const a=parseFloat(t.target.value);b(isNaN(a)?0:a)},min:p,max:f,step:i,placeholder:g,disabled:o,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"}),s&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s})]}),k=({id:l,label:d,description:s,helpText:u,value:m,onChange:b,placeholder:p,disabled:f=!1,multiline:i=!1,rows:g=3,type:o="text"})=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:l,className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx("span",{children:d}),u&&e.jsx($,{content:u})]}),i?e.jsx("textarea",{id:l,value:m,onChange:t=>b(t.target.value),placeholder:p,disabled:f,rows:g,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none disabled:opacity-50 disabled:cursor-not-allowed"}):e.jsx("input",{type:o,id:l,value:m,onChange:t=>b(t.target.value),placeholder:p,disabled:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"}),s&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s})]}),L=({id:l,label:d,description:s,helpText:u,value:m,onChange:b,options:p,disabled:f=!1,multiple:i=!1})=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:l,className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx("span",{children:d}),u&&e.jsx($,{content:u})]}),e.jsx("select",{id:l,value:m,onChange:g=>b(g.target.value),disabled:f,multiple:i,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:p.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))}),s&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s})]}),se=({id:l,label:d,description:s,helpText:u,value:m,onChange:b,disabled:p=!1})=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:l,className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx("span",{children:d}),u&&e.jsx($,{content:u})]}),e.jsx("input",{type:"time",id:l,value:m,onChange:f=>b(f.target.value),disabled:p,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"}),s&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s})]}),j=({title:l,description:d,helpText:s,icon:u,colorClass:m="bg-white border-gray-200",children:b})=>e.jsxs("div",{className:`p-6 rounded-xl border ${m}`,children:[e.jsxs("div",{className:"flex items-start gap-2 mb-4",children:[e.jsx("div",{className:"p-1 rounded mt-0.5",children:u}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:l}),s&&e.jsx($,{content:s})]}),d&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:d})]})]}),e.jsx("div",{className:"space-y-4",children:b})]}),ne=x.forwardRef((l,d)=>{const{settings:s,setSettings:u,loading:m,saving:b,error:p,saveSettings:f,updateSettings:i,resetSettings:g}=me(),{t:o}=W(),[t,a]=x.useState(s.business_logo||null),[v,_]=x.useState(!1),y=x.useRef(null);D.useEffect(()=>{s.business_logo!==t&&a(s.business_logo||null)},[s.business_logo]);const A=async()=>{const c=await f(s);return c&&window.dispatchEvent(new CustomEvent("settingsUpdated",{detail:{type:"general"}})),c},R=async()=>{await g()},n=(c,S)=>{u(M=>({...M,[c]:S})),c==="font_size"&&P(S)},P=c=>{const S=document.documentElement;switch(c){case"tiny":S.style.fontSize="11px";break;case"extra-small":S.style.fontSize="12px";break;case"small":S.style.fontSize="14px";break;case"medium":S.style.fontSize="16px";break;case"large":S.style.fontSize="18px";break}};D.useEffect(()=>{s.font_size&&P(s.font_size)},[s.font_size]);const E=async c=>{var M;const S=(M=c.target.files)==null?void 0:M[0];if(S){if(!S.type.startsWith("image/")){C.error("Please upload an image file");return}if(S.size>2*1024*1024){C.error("Image size should be less than 2MB");return}_(!0);try{const w=new FileReader;w.onloadend=()=>{const h=w.result;a(h),n("business_logo",h),C.success("Logo uploaded successfully! Remember to save settings.")},w.onerror=()=>{C.error("Failed to read image file")},w.readAsDataURL(S)}catch{C.error("Failed to upload logo")}finally{_(!1)}}},O=()=>{a(null),n("business_logo",null),y.current&&(y.current.value=""),C.success("Logo removed. Remember to save settings.")};return x.useImperativeHandle(d,()=>({saveSettings:A,resetSettings:R})),m?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading settings..."})]}):p?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-600",children:["Error: ",p]})}):e.jsxs(B,{isLoading:m,children:[e.jsx(j,{title:o("general.businessInfo"),icon:e.jsx(ge,{className:"w-5 h-5"}),helpText:o("general.businessInfoHelp"),children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center mb-3",children:t?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-48 h-48 border-2 border-gray-200 rounded-lg overflow-hidden bg-white flex items-center justify-center",children:e.jsx("img",{src:t,alt:"Business Logo",className:"max-w-full max-h-full object-contain"})}),e.jsx("button",{type:"button",onClick:O,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",title:"Remove logo",children:e.jsx(G,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"w-48 h-48 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-white",children:e.jsx(X,{className:"w-10 h-10 text-gray-400"})})}),e.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:E,className:"hidden",id:"logo-upload"}),e.jsxs("label",{htmlFor:"logo-upload",className:`w-full inline-flex items-center justify-center gap-2 px-4 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer transition-colors ${v?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(X,{className:"w-4 h-4"}),o(v?"general.uploading":t?"general.changeLogo":"general.uploadLogo")]})]})}),e.jsx("div",{className:"lg:col-span-9",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(k,{label:o("general.businessName"),value:s.business_name||"",onChange:c=>n("business_name",c),placeholder:"My Store"}),e.jsx(k,{label:o("general.businessPhone"),value:s.business_phone||"",onChange:c=>n("business_phone",c),placeholder:"+255 123 456 789"}),e.jsx(k,{label:o("general.businessEmail"),value:s.business_email||"",onChange:c=>n("business_email",c),placeholder:"info@mystore.com"}),e.jsx(k,{label:o("general.businessWebsite"),value:s.business_website||"",onChange:c=>n("business_website",c),placeholder:"www.mystore.com"}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(k,{label:o("general.businessAddress"),value:s.business_address||"",onChange:c=>n("business_address",c),placeholder:"123 Main Street, City, Country"})})]})})]})}),e.jsx(j,{title:o("interface.title"),icon:e.jsx(be,{className:"w-5 h-5"}),helpText:o("interface.help"),children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(L,{label:o("interface.theme"),value:s.theme,onChange:c=>n("theme",c),options:[{value:"light",label:o("interface.light")},{value:"dark",label:o("interface.dark")},{value:"auto",label:o("interface.auto")}]}),e.jsx(L,{label:o("interface.language"),value:s.language,onChange:c=>n("language",c),options:[{value:"en",label:o("interface.english")},{value:"sw",label:o("interface.swahili")},{value:"fr",label:o("interface.french")}]}),e.jsx(L,{label:o("interface.fontSize"),value:s.font_size,onChange:c=>n("font_size",c),options:[{value:"tiny",label:`${o("interface.tiny")} (11px)`},{value:"extra-small",label:`${o("interface.extraSmall")} (12px)`},{value:"small",label:`${o("interface.small")} (14px)`},{value:"medium",label:`${o("interface.medium")} (16px)`},{value:"large",label:`${o("interface.large")} (18px)`}]}),e.jsx(k,{label:o("interface.currency"),value:s.currency,onChange:c=>n("currency",c),placeholder:"TZS"}),e.jsx(k,{label:o("interface.dateFormat"),value:s.date_format,onChange:c=>n("date_format",c),placeholder:"DD/MM/YYYY"}),e.jsx(L,{label:o("interface.timeFormat"),value:s.time_format,onChange:c=>n("time_format",c),options:[{value:"12",label:o("interface.12hour")},{value:"24",label:o("interface.24hour")}]})]})}),e.jsx(j,{title:"Display Settings",icon:e.jsx(H,{className:"w-5 h-5"}),helpText:"Chagua ni taarifa gani zinaonekana kwenye product cards za POS.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Show Product Images",checked:s.show_product_images,onChange:c=>n("show_product_images",c),helpText:"Onyesha picha za bidhaa kwenye POS grid."}),e.jsx(r,{label:"Show Stock Levels",checked:s.show_stock_levels,onChange:c=>n("show_stock_levels",c),helpText:"Onyesha idadi ya stock kwa kila bidhaa."}),e.jsx(r,{label:"Show Prices",checked:s.show_prices,onChange:c=>n("show_prices",c),helpText:"Onyesha bei kwenye product cards."}),e.jsx(r,{label:"Show Barcodes",checked:s.show_barcodes,onChange:c=>n("show_barcodes",c),helpText:"Onyesha barcode kwenye product cards."})]})}),e.jsxs(j,{title:"Product Grid Settings",icon:e.jsx(H,{className:"w-5 h-5"}),helpText:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Dhibiti layout ya product grid kwenye POS."}),e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Recommendations:"})}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Screen ndogo: 2-3 bidhaa kwa row"}),e.jsx("li",{children:"Screen wastani: 3-4 bidhaa kwa row"}),e.jsx("li",{children:"Monitor kubwa: 4-6 bidhaa kwa row"}),e.jsx("li",{children:"Ultra-wide: 6-8 bidhaa kwa row"})]})]}),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Products Per Row",value:s.products_per_row.toString(),onChange:c=>n("products_per_row",parseInt(c)),options:[{value:"2",label:"2 Products"},{value:"3",label:"3 Products"},{value:"4",label:"4 Products (Default)"},{value:"5",label:"5 Products"},{value:"6",label:"6 Products"},{value:"8",label:"8 Products"}]}),e.jsx(F,{label:"Custom Amount",value:s.products_per_row,onChange:c=>n("products_per_row",c),min:2,max:12,step:1,helpText:"Weka namba kati ya 2 na 12."})]}),e.jsx("div",{className:"mt-4",children:e.jsx(L,{label:"Products Per Page",value:s.products_per_page.toString(),onChange:c=>n("products_per_page",parseInt(c)),options:[{value:"12",label:"12 Products"},{value:"16",label:"16 Products"},{value:"20",label:"20 Products (Default)"},{value:"24",label:"24 Products"},{value:"30",label:"30 Products"},{value:"40",label:"40 Products"},{value:"50",label:"50 Products"},{value:"100",label:"100 Products"}],helpText:"Jumla ya bidhaa za kuonyesha kwa page."})})]}),e.jsx(j,{title:"Behavior Settings",icon:e.jsx(I,{className:"w-5 h-5"}),helpText:"Dhibiti jinsi POS inavyofanya kazi wakati unachangia.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Auto Complete Search",checked:s.auto_complete_search,onChange:c=>n("auto_complete_search",c),helpText:"Onyesha search suggestions wakati unaandika."}),e.jsx(r,{label:"Confirm Delete",checked:s.confirm_delete,onChange:c=>n("confirm_delete",c),helpText:"Uliza confirmation kabla ya kufuta item."}),e.jsx(r,{label:"Show Confirmations",checked:s.show_confirmations,onChange:c=>n("show_confirmations",c),helpText:"Onyesha success messages baada ya kumaliza action."}),e.jsx(r,{label:"Enable Sound Effects",checked:s.enable_sound_effects,onChange:c=>n("enable_sound_effects",c),helpText:"Play sounds wakati unapiga buttons."}),e.jsx(r,{label:"Enable Animations",checked:s.enable_animations,onChange:c=>n("enable_animations",c),helpText:"Enable smooth transitions na animations."})]})}),e.jsx(j,{title:"Performance Settings",icon:e.jsx(Q,{className:"w-5 h-5"}),helpText:"Optimize jinsi POS inavyopakia data kwa speed ya haraka.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Enable Caching",checked:s.enable_caching,onChange:c=>n("enable_caching",c),helpText:"Save data kwa muda ili POS ipake haraka."}),e.jsx(r,{label:"Enable Lazy Loading",checked:s.enable_lazy_loading,onChange:c=>n("enable_lazy_loading",c),helpText:"Pakia picha na data wakati inahitajika tu."}),e.jsx(F,{label:"Cache Duration (seconds)",value:s.cache_duration,onChange:c=>n("cache_duration",c),min:60,max:3600,step:30,helpText:"Muda wa kukeep cached data kabla ya refresh."}),e.jsx(F,{label:"Max Search Results",value:s.max_search_results,onChange:c=>n("max_search_results",c),min:10,max:200,step:10,helpText:"Maximum ya bidhaa za kuonyesha kwenye search results."})]})}),e.jsx(j,{title:"Tax Settings",icon:e.jsx(fe,{className:"w-5 h-5"}),helpText:"Weka automatic tax calculation kwa sales.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Enable Tax",checked:s.enable_tax,onChange:c=>n("enable_tax",c),helpText:"Calculate na ongeza tax automatically kwa sales."}),s.enable_tax&&e.jsx(F,{label:"Tax Rate (%)",value:s.tax_rate,onChange:c=>n("tax_rate",c),min:0,max:50,step:.1,helpText:"Percent ya tax kwa sales (mfano: 18 kwa 18% VAT)."})]})}),e.jsx(j,{title:"Hardware Settings",icon:e.jsx(Q,{className:"w-5 h-5"}),helpText:"Weka barcode scanner na vifaa vingine.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Enable Barcode Scanner",checked:s.show_barcodes,onChange:c=>n("show_barcodes",c),helpText:"Scan barcode kuongeza bidhaa haraka kwenye cart."}),e.jsx(r,{label:"Play Sound on Scan",checked:s.enable_sound_effects,onChange:c=>n("enable_sound_effects",c),helpText:"Play sound wakati barcode imescan successfully."})]})}),e.jsx(j,{title:"Notifications & Alerts",icon:e.jsx(I,{className:"w-5 h-5"}),helpText:"Chagua ni notifications gani zinaonekana kwenye POS.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Low Stock Alerts",checked:s.show_stock_levels,onChange:c=>n("show_stock_levels",c),helpText:"Pata notification wakati stock inaisha."}),e.jsx(r,{label:"Payment Confirmations",checked:s.show_confirmations,onChange:c=>n("show_confirmations",c),helpText:"Onyesha confirmation messages baada ya payment."})]})}),e.jsx(j,{title:"Security Settings",icon:e.jsx(ae,{className:"w-5 h-5"}),helpText:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Security Tips:"})}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Tumia passcode ambayo unakumbuka lakini ni secure"}),e.jsx("li",{children:'Usitumie "1111" au "1234"'}),e.jsx("li",{children:"Badilisha passcode mara kwa mara"}),e.jsx("li",{children:"Share na wafanyakazi authorized tu"})]})]}),children:e.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(J,{className:"w-5 h-5 text-amber-600 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Day Closing Passcode"}),e.jsx("div",{className:"max-w-sm",children:e.jsx(k,{label:"",value:s.day_closing_passcode||"1234",onChange:c=>n("day_closing_passcode",c),placeholder:"Weka passcode",type:"password",helpText:"Inahitajika kufunga na kufungua siku."})})]})]})})})]})});ne.displayName="GeneralSettingsTab";const We=D.memo(ne),le=x.forwardRef((l,d)=>{const[s,u]=x.useState({enableDynamicPricing:!0,presets:{happyHour:{id:"happy_hour",name:"Happy Hour",description:"Discount during specific hours",enabled:!1,startTime:"18:00",endTime:"21:00",discountPercent:15},bulkDiscount:{id:"bulk_discount",name:"Bulk Buy Discount",description:"Discount for buying multiple items",enabled:!0,minQuantity:10,discountPercent:10},loyaltyDiscount:{id:"loyalty_discount",name:"VIP Customer Discount",description:"Automatic discount for loyal customers",enabled:!0,discountPercent:5}},showAdvanced:!1}),[m,b]=x.useState(!1);D.useEffect(()=>{(async()=>{b(!0);try{const t=await K.loadDynamicPricingSettings();t&&u({enableDynamicPricing:t.enable_dynamic_pricing??!0,presets:{happyHour:{id:"happy_hour",name:"Happy Hour",description:"Discount during specific hours",enabled:t.enable_time_based_pricing??!1,startTime:t.time_based_start_time??"18:00",endTime:t.time_based_end_time??"21:00",discountPercent:t.time_based_discount_percent??15},bulkDiscount:{id:"bulk_discount",name:"Bulk Buy Discount",description:"Discount for buying multiple items",enabled:t.enable_bulk_pricing??!0,minQuantity:t.bulk_discount_threshold??10,discountPercent:t.bulk_discount_percent??10},loyaltyDiscount:{id:"loyalty_discount",name:"VIP Customer Discount",description:"Automatic discount for loyal customers",enabled:t.enable_loyalty_pricing??!0,discountPercent:t.loyalty_discount_percent??5}},showAdvanced:!1})}catch(t){console.error("Error loading pricing settings:",t)}finally{b(!1)}})()},[]);const p=async()=>{try{const o={enable_dynamic_pricing:s.enableDynamicPricing,enable_loyalty_pricing:s.presets.loyaltyDiscount.enabled,enable_bulk_pricing:s.presets.bulkDiscount.enabled,enable_time_based_pricing:s.presets.happyHour.enabled,enable_customer_pricing:!1,enable_special_events:!1,loyalty_discount_percent:s.presets.loyaltyDiscount.discountPercent,loyalty_points_threshold:1e3,loyalty_max_discount:20,bulk_discount_enabled:s.presets.bulkDiscount.enabled,bulk_discount_threshold:s.presets.bulkDiscount.minQuantity||10,bulk_discount_percent:s.presets.bulkDiscount.discountPercent,time_based_discount_enabled:s.presets.happyHour.enabled,time_based_start_time:s.presets.happyHour.startTime||"18:00",time_based_end_time:s.presets.happyHour.endTime||"21:00",time_based_discount_percent:s.presets.happyHour.discountPercent,customer_pricing_enabled:!1,vip_customer_discount:10,regular_customer_discount:5,special_events_enabled:!1,special_event_discount_percent:20};return await K.saveDynamicPricingSettings(o),C.success("Pricing settings saved successfully!"),!0}catch(o){return console.error("Error saving pricing settings:",o),C.error("Failed to save pricing settings"),!1}},f=async()=>{const o={enableDynamicPricing:!0,presets:{happyHour:{id:"happy_hour",name:"Happy Hour",description:"Discount during specific hours",enabled:!1,startTime:"18:00",endTime:"21:00",discountPercent:15},bulkDiscount:{id:"bulk_discount",name:"Bulk Buy Discount",description:"Discount for buying multiple items",enabled:!0,minQuantity:10,discountPercent:10},loyaltyDiscount:{id:"loyalty_discount",name:"VIP Customer Discount",description:"Automatic discount for loyal customers",enabled:!0,discountPercent:5}},showAdvanced:!1};return u(o),localStorage.setItem("lats-pos-pricing",JSON.stringify(o)),C.success("Pricing settings reset to defaults"),!0},i=(o,t)=>{u(a=>({...a,presets:{...a.presets,[o]:{...a.presets[o],enabled:t}}}))},g=(o,t,a)=>{u(v=>({...v,presets:{...v.presets,[o]:{...v.presets[o],[t]:a}}}))};return x.useImperativeHandle(d,()=>({saveSettings:p,resetSettings:f})),e.jsxs(B,{isLoading:m,children:[e.jsx(j,{title:"Dynamic Pricing",icon:e.jsx(_e,{className:"w-5 h-5"}),helpText:"Enable automatic pricing rules and discounts that apply during checkout.",children:e.jsx(r,{id:"enable_dynamic_pricing",label:"Enable Dynamic Pricing",checked:s.enableDynamicPricing,onChange:o=>u(t=>({...t,enableDynamicPricing:o})),helpText:"Master switch to enable/disable all automatic pricing rules and discounts."})}),e.jsx(j,{title:"Discount Presets",icon:e.jsx(ye,{className:"w-5 h-5"}),helpText:"Pre-configured discount rules you can enable with one click.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(je,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Happy Hour"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Discount during specific hours"})]})]}),e.jsx(r,{id:"preset_happy_hour",label:"",checked:s.presets.happyHour.enabled,onChange:o=>i("happyHour",o),disabled:!s.enableDynamicPricing,helpText:"Apply discount automatically during specified time period each day."})]}),s.presets.happyHour.enabled&&s.enableDynamicPricing&&e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(se,{id:"happy_hour_start",label:"Start Time",value:s.presets.happyHour.startTime||"18:00",onChange:o=>g("happyHour","startTime",o),helpText:"When the discount period begins."}),e.jsx(se,{id:"happy_hour_end",label:"End Time",value:s.presets.happyHour.endTime||"21:00",onChange:o=>g("happyHour","endTime",o),helpText:"When the discount period ends."}),e.jsx(F,{id:"happy_hour_discount",label:"Discount %",value:s.presets.happyHour.discountPercent,onChange:o=>g("happyHour","discountPercent",o),min:1,max:50,step:1,helpText:"Percentage off during happy hour."})]})})]}),e.jsxs("div",{className:"border-2 border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Bulk Buy Discount"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Discount for buying multiple items"})]})]}),e.jsx(r,{id:"preset_bulk_discount",label:"",checked:s.presets.bulkDiscount.enabled,onChange:o=>i("bulkDiscount",o),disabled:!s.enableDynamicPricing,helpText:"Reward customers who buy in larger quantities with automatic discounts."})]}),s.presets.bulkDiscount.enabled&&s.enableDynamicPricing&&e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(F,{id:"bulk_min_quantity",label:"Minimum Quantity",value:s.presets.bulkDiscount.minQuantity||10,onChange:o=>g("bulkDiscount","minQuantity",o),min:2,max:100,step:1,helpText:"How many items needed to qualify for discount."}),e.jsx(F,{id:"bulk_discount_percent",label:"Discount %",value:s.presets.bulkDiscount.discountPercent,onChange:o=>g("bulkDiscount","discountPercent",o),min:1,max:50,step:1,helpText:"Discount percentage for bulk purchases."})]})})]}),e.jsxs("div",{className:"border-2 border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"VIP Customer Discount"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatic discount for loyal customers"})]})]}),e.jsx(r,{id:"preset_loyalty_discount",label:"",checked:s.presets.loyaltyDiscount.enabled,onChange:o=>i("loyaltyDiscount",o),disabled:!s.enableDynamicPricing,helpText:"Apply automatic discount to VIP or loyalty program members."})]}),s.presets.loyaltyDiscount.enabled&&s.enableDynamicPricing&&e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsx(F,{id:"loyalty_discount_percent",label:"Discount %",value:s.presets.loyaltyDiscount.discountPercent,onChange:o=>g("loyaltyDiscount","discountPercent",o),min:1,max:25,step:1,helpText:"Discount percentage for VIP customers."})})})]})]})})]})});le.displayName="DynamicPricingSimplifiedTab";const Ue=D.memo(le),qe=({settings:l,businessInfo:d})=>{const[s,u]=x.useState(.5),m={transactionId:"TXN-2025-001234",receiptNumber:l.enable_receipt_numbering?l.receipt_number_format.replace("{YEAR}","2025").replace("{NUMBER}","001234"):"RCP-001234",date:new Date().toLocaleDateString(),time:new Date().toLocaleTimeString(),cashier:"John Doe",customer:{name:"Jane Smith",phone:"+255 712 345 678"},items:[{name:"Product A",sku:"SKU-001",barcode:"1234567890123",qty:2,price:15e3,total:3e4},{name:"Product B",sku:"SKU-002",barcode:"9876543210987",qty:1,price:25e3,total:25e3},{name:"Product C",sku:"SKU-003",barcode:"5555555555555",qty:3,price:8e3,total:24e3}],subtotal:79e3,discount:5e3,tax:13320,grandTotal:87320,payment:{method:"Cash",amount:9e4,change:2680}},b=l.receipt_template||"standard",p=b==="compact",f=b==="detailed",i=b==="a4",g=i?"210mm":`${l.receipt_width}mm`,o=i?"14px":`${l.receipt_font_size}px`;return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 sticky top-6",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 text-center",children:[e.jsxs("div",{children:["Live Preview - ",b.charAt(0).toUpperCase()+b.slice(1)," Template"]}),i&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"A4 Size: 210mm Ã— 297mm"})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>u(Math.max(.3,s-.1)),className:"p-1 hover:bg-gray-100 rounded",title:"Zoom Out",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-mono",children:[Math.round(s*100),"%"]}),e.jsx("button",{onClick:()=>u(Math.min(1,s+.1)),className:"p-1 hover:bg-gray-100 rounded",title:"Zoom In",children:e.jsx(Se,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:i?"overflow-auto max-h-[calc(100vh-220px)] bg-gray-100 p-4":"",children:e.jsx("div",{className:`bg-white border mx-auto overflow-hidden ${i?"border-2 border-gray-400 shadow-2xl origin-top":"border border-gray-300"}`,style:{width:g,maxWidth:"100%",fontSize:o,fontFamily:i?"Arial, sans-serif":"monospace",height:i?"297mm":"auto",minHeight:i?"297mm":"auto",aspectRatio:i?"210/297":void 0,transform:i?`scale(${s})`:void 0,transformOrigin:i?"top center":void 0},children:e.jsxs("div",{className:`${i?"p-8 space-y-4":`p-4 ${p?"space-y-1":"space-y-2"}`}`,children:[i?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-between items-start border-b-2 border-gray-800 pb-4 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[l.show_business_logo&&(d==null?void 0:d.logo)&&e.jsx("img",{src:d.logo,alt:"Logo",className:"h-16 object-contain mb-2"}),l.show_business_name&&e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(d==null?void 0:d.name)||"inauzwa"}),l.show_business_address&&e.jsx("div",{className:"text-sm text-gray-700 mt-1",children:(d==null?void 0:d.address)||"123 Business Street, City"}),e.jsxs("div",{className:"text-sm text-gray-700 mt-1 space-y-0.5",children:[l.show_business_phone&&e.jsxs("div",{children:["Phone: ",(d==null?void 0:d.phone)||"+255 123 456 789"]}),l.show_business_email&&e.jsxs("div",{children:["Email: ",(d==null?void 0:d.email)||"info@business.com"]}),l.show_business_website&&e.jsxs("div",{children:["Web: ",(d==null?void 0:d.website)||"www.business.com"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:"INVOICE"}),l.enable_receipt_numbering&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Receipt #: ",e.jsx("span",{className:"font-semibold",children:m.receiptNumber})]})]})]})}):e.jsxs(e.Fragment,{children:[l.show_business_logo&&(d==null?void 0:d.logo)&&!p&&e.jsx("div",{className:"text-center mb-2",children:e.jsx("img",{src:d.logo,alt:"Logo",className:"h-12 mx-auto object-contain"})}),e.jsxs("div",{className:"text-center border-b border-dashed border-gray-400 pb-2",children:[l.show_business_name&&e.jsx("div",{className:`font-bold ${p?"text-base":"text-lg"}`,children:(d==null?void 0:d.name)||"inauzwa"}),l.show_business_address&&!p&&e.jsx("div",{className:"text-xs",children:(d==null?void 0:d.address)||"123 Business Street, City"}),l.show_business_phone&&(d==null?void 0:d.phone)&&(()=>{const t=$e(d.phone);return e.jsx("div",{className:"text-xs",children:t.map((a,v)=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a.whatsapp&&e.jsx("span",{className:"text-green-600",title:"WhatsApp",children:"ðŸ“±"}),e.jsx("span",{children:a.phone})]},v))})})(),l.show_business_email&&!p&&(f||l.show_business_email)&&e.jsx("div",{className:"text-xs",children:(d==null?void 0:d.email)||"info@business.com"}),l.show_business_website&&!p&&(f||l.show_business_website)&&e.jsx("div",{className:"text-xs",children:(d==null?void 0:d.website)||"www.business.com"})]})]}),i?e.jsxs("div",{className:"grid grid-cols-2 gap-8 text-sm bg-gray-50 p-4 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Invoice Details"}),l.show_transaction_id&&e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Transaction ID:"}),e.jsx("span",{className:"font-medium",children:m.transactionId})]}),l.show_date_time&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium",children:m.date})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Time:"}),e.jsx("span",{className:"font-medium",children:m.time})]})]}),l.show_cashier_name&&e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Cashier:"}),e.jsx("span",{className:"font-medium",children:m.cashier})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Customer Details"}),l.show_customer_name&&e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-medium",children:m.customer.name})]}),l.show_customer_phone&&e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsx("span",{className:"font-medium",children:m.customer.phone})]})]})]}):e.jsxs("div",{className:`text-xs ${p?"space-y-0.5":"space-y-1"} border-b border-dashed border-gray-400 pb-2`,children:[l.show_transaction_id&&!p&&(f||l.show_transaction_id)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Transaction ID:"}),e.jsx("span",{className:"font-semibold",children:m.transactionId})]}),l.enable_receipt_numbering&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Receipt #:"}),e.jsx("span",{className:"font-semibold",children:m.receiptNumber})]}),l.show_date_time&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Date:"}),e.jsx("span",{children:m.date})]}),!p&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Time:"}),e.jsx("span",{children:m.time})]})]}),l.show_cashier_name&&!p&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cashier:"}),e.jsx("span",{children:m.cashier})]}),l.show_customer_name&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Customer:"}),e.jsx("span",{children:m.customer.name})]}),l.show_customer_phone&&!p&&(f||l.show_customer_phone)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Phone:"}),e.jsx("span",{children:m.customer.phone})]})]}),i?e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-900 mb-3",children:"Items"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-800 text-left",children:[e.jsx("th",{className:"pb-2 font-semibold",children:"#"}),l.show_product_names&&e.jsx("th",{className:"pb-2 font-semibold",children:"Item"}),l.show_product_skus&&e.jsx("th",{className:"pb-2 font-semibold",children:"SKU"}),l.show_quantities&&e.jsx("th",{className:"pb-2 font-semibold text-center",children:"Qty"}),l.show_unit_prices&&e.jsx("th",{className:"pb-2 font-semibold text-right",children:"Price"}),e.jsx("th",{className:"pb-2 font-semibold text-right",children:"Total"})]})}),e.jsx("tbody",{children:m.items.map((t,a)=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2",children:a+1}),l.show_product_names&&e.jsxs("td",{className:"py-2",children:[e.jsx("div",{className:"font-medium",children:t.name}),l.show_product_barcodes&&e.jsx("div",{className:"text-xs text-gray-500",children:t.barcode})]}),l.show_product_skus&&e.jsx("td",{className:"py-2 text-gray-600",children:t.sku}),l.show_quantities&&e.jsx("td",{className:"py-2 text-center",children:t.qty}),l.show_unit_prices&&e.jsx("td",{className:"py-2 text-right",children:N.money(t.price)}),e.jsx("td",{className:"py-2 text-right font-medium",children:N.money(t.total)})]},a))})]})]}):e.jsxs("div",{className:"text-xs border-b border-dashed border-gray-400 pb-2",children:[e.jsx("div",{className:"font-bold mb-1",children:"ITEMS"}),m.items.map((t,a)=>e.jsx("div",{className:p?"mb-0.5":"mb-1",children:p?e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t.name," x",t.qty]}),e.jsx("span",{className:"font-semibold",children:t.total.toLocaleString()})]}):e.jsxs(e.Fragment,{children:[l.show_product_names&&e.jsx("div",{className:"font-semibold",children:t.name}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[l.show_product_skus&&!p&&e.jsxs("div",{className:"text-gray-600",children:["SKU: ",t.sku]}),l.show_product_barcodes&&(f||l.show_product_barcodes)&&!p&&e.jsx("div",{className:"text-gray-600",children:t.barcode}),l.show_quantities&&l.show_unit_prices&&e.jsxs("div",{children:[t.qty," x ",N.money(t.price)]})]}),e.jsx("div",{className:"font-semibold",children:N.money(t.total)})]})]})},a))]}),i?e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs("div",{className:"w-80 bg-gray-50 p-4 rounded border border-gray-300",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[l.show_subtotal&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:N.money(m.subtotal)})]}),l.show_discounts&&l.show_discount_total&&m.discount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{className:"font-medium",children:["-",N.money(m.discount)]})]}),l.show_tax&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Tax (18%):"}),e.jsx("span",{className:"font-medium",children:N.money(m.tax)})]}),l.show_grand_total&&e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t-2 border-gray-800 pt-2 mt-2",children:[e.jsx("span",{children:"TOTAL:"}),e.jsx("span",{children:N.money(m.grandTotal)})]})]}),(l.show_payment_method||l.show_change_amount)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-300 text-sm space-y-1",children:[l.show_payment_method&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Payment Method:"}),e.jsx("span",{className:"font-medium",children:m.payment.method})]}),l.show_change_amount&&m.payment.change>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Cash Received:"}),e.jsx("span",{className:"font-medium",children:N.money(m.payment.amount)})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-green-600",children:[e.jsx("span",{children:"Change:"}),e.jsx("span",{children:N.money(m.payment.change)})]})]})]})]})}):e.jsxs("div",{className:`text-xs ${p?"space-y-0.5":"space-y-1"}`,children:[l.show_subtotal&&!p&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:N.money(m.subtotal)})]}),l.show_discounts&&l.show_discount_total&&m.discount>0&&!p&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-",N.money(m.discount)]})]}),l.show_tax&&!p&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax (18%):"}),e.jsx("span",{children:N.money(m.tax)})]}),l.show_grand_total&&e.jsxs("div",{className:`flex justify-between font-bold ${p?"text-sm":"text-base"} border-t border-gray-400 pt-1 mt-1`,children:[e.jsx("span",{children:"TOTAL:"}),e.jsx("span",{children:N.money(m.grandTotal)})]})]}),!i&&(l.show_payment_method||l.show_change_amount)&&e.jsxs("div",{className:"text-xs space-y-1 border-t border-dashed border-gray-400 pt-2",children:[l.show_payment_method&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Payment Method:"}),e.jsx("span",{children:m.payment.method})]}),l.show_change_amount&&m.payment.change>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cash:"}),e.jsx("span",{children:N.money(m.payment.amount)})]}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Change:"}),e.jsx("span",{children:N.money(m.payment.change)})]})]})]}),(l.show_footer_message||l.show_return_policy)&&e.jsxs("div",{className:`${i?"text-sm mt-8 pt-6 border-t-2 border-gray-800":"text-xs text-center border-t border-dashed border-gray-400 pt-2 mt-2"} space-y-2`,children:[l.show_footer_message&&l.footer_message&&e.jsx("div",{className:`${i?"text-center text-base font-medium text-gray-700":"font-medium"}`,children:l.footer_message}),l.show_return_policy&&l.return_policy_text&&e.jsxs("div",{className:`${i?"text-xs text-gray-600 bg-gray-50 p-3 rounded":"text-gray-600 text-[10px]"}`,children:[e.jsx("span",{className:i?"font-semibold":"",children:"Return Policy: "}),l.return_policy_text]})]})]})})})]})},re=x.forwardRef((l,d)=>{W();const{settings:s,setSettings:u,loading:m,error:b,saveSettings:p,resetSettings:f}=he(),{businessInfo:i}=Ie(),g=async()=>await p(s),o=async()=>await f(),t=(a,v)=>{u(_=>({..._,[a]:v}))};return x.useImperativeHandle(d,()=>({saveSettings:g,resetSettings:o})),m?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading settings..."})]}):b?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-600",children:["Error: ",b]})}):e.jsx(B,{isLoading:m,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(j,{title:"Receipt Template",icon:e.jsx(V,{className:"w-5 h-5"}),helpText:"Chagua receipt template na customize size kwa printer yako.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(L,{id:"receipt_template",label:"Receipt Template",value:s.receipt_template,onChange:a=>t("receipt_template",a),options:[{value:"standard",label:"Standard - 80mm thermal (recommended)"},{value:"compact",label:"Compact - 58mm thermal"},{value:"detailed",label:"Detailed - 80mm with all info"},{value:"a4",label:"A4 - Full page invoice"},{value:"custom",label:"Custom - Your preferences"}]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[s.receipt_template==="compact"&&"ðŸ“‹ Compact: Shows only essential info - great for 58mm thermal printers!",s.receipt_template==="standard"&&"ðŸ“‹ Standard: Balanced layout for 80mm thermal printers",s.receipt_template==="detailed"&&"ðŸ“‹ Detailed: All information on 80mm thermal paper",s.receipt_template==="a4"&&"ðŸ“‹ A4: Full-page invoice format (210mm) - professional look!",s.receipt_template==="custom"&&"ðŸ“‹ Custom: Use your own settings below"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(F,{id:"receipt_width",label:"Receipt Width (mm)",value:s.receipt_width,onChange:a=>t("receipt_width",a),min:40,max:120,step:5}),e.jsx(F,{id:"receipt_font_size",label:"Font Size (px)",value:s.receipt_font_size,onChange:a=>t("receipt_font_size",a),min:8,max:16,step:1})]})]})}),e.jsx(j,{title:"Taarifa za Duka",icon:e.jsx(ke,{className:"w-5 h-5"}),helpText:"Chagua ni taarifa gani za duka zinaonekana kwenye receipt.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"show_business_logo",label:"Show Logo",checked:s.show_business_logo,onChange:a=>t("show_business_logo",a)}),e.jsx(r,{id:"show_business_name",label:"Show Name",checked:s.show_business_name,onChange:a=>t("show_business_name",a)}),e.jsx(r,{id:"show_business_address",label:"Show Address",checked:s.show_business_address,onChange:a=>t("show_business_address",a)}),e.jsx(r,{id:"show_business_phone",label:"Show Phone",checked:s.show_business_phone,onChange:a=>t("show_business_phone",a)}),e.jsx(r,{id:"show_business_email",label:"Show Email",checked:s.show_business_email,onChange:a=>t("show_business_email",a)}),e.jsx(r,{id:"show_business_website",label:"Show Website",checked:s.show_business_website,onChange:a=>t("show_business_website",a)})]})}),e.jsx(j,{title:"Transaction Details",icon:e.jsx(Ce,{className:"w-5 h-5"}),helpText:"Choose which transaction information to display on receipts.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"show_transaction_id",label:"Transaction ID",checked:s.show_transaction_id,onChange:a=>t("show_transaction_id",a)}),e.jsx(r,{id:"show_date_time",label:"Date & Time",checked:s.show_date_time,onChange:a=>t("show_date_time",a)}),e.jsx(r,{id:"show_cashier_name",label:"Cashier Name",checked:s.show_cashier_name,onChange:a=>t("show_cashier_name",a)}),e.jsx(r,{id:"show_customer_name",label:"Customer Name",checked:s.show_customer_name,onChange:a=>t("show_customer_name",a)}),e.jsx(r,{id:"show_customer_phone",label:"Customer Phone",checked:s.show_customer_phone,onChange:a=>t("show_customer_phone",a)})]})}),e.jsx(j,{title:"Product Details",icon:e.jsx(Pe,{className:"w-5 h-5"}),helpText:"Control which product information appears in the receipt line items.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"show_product_names",label:"Product Names",checked:s.show_product_names,onChange:a=>t("show_product_names",a)}),e.jsx(r,{id:"show_product_skus",label:"Product SKUs",checked:s.show_product_skus,onChange:a=>t("show_product_skus",a)}),e.jsx(r,{id:"show_product_barcodes",label:"Barcodes",checked:s.show_product_barcodes,onChange:a=>t("show_product_barcodes",a)}),e.jsx(r,{id:"show_quantities",label:"Quantities",checked:s.show_quantities,onChange:a=>t("show_quantities",a)}),e.jsx(r,{id:"show_unit_prices",label:"Item Prices",checked:s.show_unit_prices,onChange:a=>t("show_unit_prices",a)}),e.jsx(r,{id:"show_discounts",label:"Discounts",checked:s.show_discounts,onChange:a=>t("show_discounts",a)})]})}),e.jsx(j,{title:"Totals & Summary",icon:e.jsx(I,{className:"w-5 h-5"}),helpText:"Choose which summary totals to show at the bottom of receipts.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"show_subtotal",label:"Subtotal",checked:s.show_subtotal,onChange:a=>t("show_subtotal",a)}),e.jsx(r,{id:"show_tax",label:"Tax",checked:s.show_tax,onChange:a=>t("show_tax",a)}),e.jsx(r,{id:"show_discount_total",label:"Discount Total",checked:s.show_discount_total,onChange:a=>t("show_discount_total",a)}),e.jsx(r,{id:"show_grand_total",label:"Grand Total",checked:s.show_grand_total,onChange:a=>t("show_grand_total",a)}),e.jsx(r,{id:"show_payment_method",label:"Payment Method",checked:s.show_payment_method,onChange:a=>t("show_payment_method",a)}),e.jsx(r,{id:"show_change_amount",label:"Change Amount",checked:s.show_change_amount,onChange:a=>t("show_change_amount",a)})]})}),e.jsx(j,{title:"Print Settings",icon:e.jsx(Te,{className:"w-5 h-5"}),helpText:"Weka automatic printing na options za duplicate receipt.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"auto_print_receipt",label:"Auto Print",checked:s.auto_print_receipt,onChange:a=>t("auto_print_receipt",a)}),e.jsx(r,{id:"print_duplicate_receipt",label:"Print Duplicate",checked:s.print_duplicate_receipt,onChange:a=>t("print_duplicate_receipt",a)}),e.jsx(r,{id:"enable_email_receipt",label:"Email Receipt",checked:s.enable_email_receipt,onChange:a=>t("enable_email_receipt",a)}),e.jsx(r,{id:"enable_sms_receipt",label:"SMS Receipt",checked:s.enable_sms_receipt,onChange:a=>t("enable_sms_receipt",a)})]})}),e.jsx(j,{title:"WhatsApp PDF & Receipt Sharing",icon:e.jsx(te,{className:"w-5 h-5"}),helpText:"Send beautifully formatted PDF receipts directly to customers' WhatsApp.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{id:"enable_whatsapp_pdf",label:"Enable WhatsApp PDF Receipts",checked:s.enable_whatsapp_pdf??!1,onChange:a=>t("enable_whatsapp_pdf",a),helpText:"Allow sending receipts as PDF via WhatsApp"}),s.enable_whatsapp_pdf&&e.jsxs("div",{className:"pl-4 space-y-4 border-l-2 border-green-300",children:[e.jsx(r,{id:"whatsapp_pdf_auto_send",label:"Auto-send PDF after payment",checked:s.whatsapp_pdf_auto_send??!1,onChange:a=>t("whatsapp_pdf_auto_send",a),helpText:s.whatsapp_pdf_auto_send?"âœ… PDF will be sent automatically":"Manual: Staff clicks 'Send PDF' button"}),e.jsx(r,{id:"whatsapp_pdf_show_preview",label:"Show preview before sending",checked:s.whatsapp_pdf_show_preview??!1,onChange:a=>t("whatsapp_pdf_show_preview",a),helpText:"Allow staff to review PDF before sending"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(L,{id:"whatsapp_pdf_format",label:"PDF Format",value:s.whatsapp_pdf_format||"a4",onChange:a=>t("whatsapp_pdf_format",a),options:[{value:"a4",label:"A4 (210 x 297 mm) - Standard"},{value:"letter",label:"Letter (216 x 279 mm) - US Standard"},{value:"thermal",label:"Thermal (80mm width)"}]}),e.jsx(L,{id:"whatsapp_pdf_quality",label:"PDF Quality",value:s.whatsapp_pdf_quality||"standard",onChange:a=>t("whatsapp_pdf_quality",a),options:[{value:"high",label:"High Quality (larger file)"},{value:"standard",label:"Standard Quality (recommended)"},{value:"compressed",label:"Compressed (smaller file)"}]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Include in PDF"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"whatsapp_pdf_include_logo",label:"Business Logo",checked:s.whatsapp_pdf_include_logo??!0,onChange:a=>t("whatsapp_pdf_include_logo",a)}),e.jsx(r,{id:"whatsapp_pdf_include_images",label:"Item Images",checked:s.whatsapp_pdf_include_images??!1,onChange:a=>t("whatsapp_pdf_include_images",a)}),e.jsx(r,{id:"whatsapp_pdf_include_qr",label:"QR Code",checked:s.whatsapp_pdf_include_qr??!0,onChange:a=>t("whatsapp_pdf_include_qr",a)}),e.jsx(r,{id:"whatsapp_pdf_include_barcode",label:"Barcode",checked:s.whatsapp_pdf_include_barcode??!1,onChange:a=>t("whatsapp_pdf_include_barcode",a)})]})]}),e.jsx(k,{id:"whatsapp_pdf_message",label:"WhatsApp Message (sent with PDF)",value:s.whatsapp_pdf_message||"Thank you for your purchase! Please find your receipt attached.",onChange:a=>t("whatsapp_pdf_message",a),placeholder:"Message sent with PDF...",helpText:"This message will be sent along with the PDF receipt"}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",onClick:()=>{alert("PDF Preview coming soon!")},children:[e.jsx(H,{className:"w-4 h-4"}),"Preview PDF Receipt"]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Other Sharing Options"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"enable_email_pdf",label:"Enable Email PDF",checked:s.enable_email_pdf??!0,onChange:a=>t("enable_email_pdf",a)}),e.jsx(r,{id:"enable_print_pdf",label:"Enable Print PDF",checked:s.enable_print_pdf??!0,onChange:a=>t("enable_print_pdf",a)}),e.jsx(r,{id:"enable_download_pdf",label:"Enable Download PDF",checked:s.enable_download_pdf??!0,onChange:a=>t("enable_download_pdf",a)}),e.jsx(r,{id:"show_share_button",label:"Show Share Button",checked:s.show_share_button??!0,onChange:a=>t("show_share_button",a)})]})]})]})}),e.jsx(j,{title:"Receipt Numbering",icon:e.jsx(V,{className:"w-5 h-5"}),helpText:"Configure automatic receipt numbering with custom prefixes and formats.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{id:"enable_receipt_numbering",label:"Enable Receipt Numbering",checked:s.enable_receipt_numbering,onChange:a=>t("enable_receipt_numbering",a)}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(k,{id:"receipt_number_prefix",label:"Receipt Prefix",value:s.receipt_number_prefix,onChange:a=>t("receipt_number_prefix",a),placeholder:"RCP"}),e.jsx(F,{id:"receipt_number_start",label:"Start Number",value:s.receipt_number_start,onChange:a=>t("receipt_number_start",a),min:1,max:999999,step:1})]}),e.jsx(k,{id:"receipt_number_format",label:"Number Format",value:s.receipt_number_format,onChange:a=>t("receipt_number_format",a),placeholder:"RCP-{YEAR}-{NUMBER}",helpText:"Use {YEAR} for year, {NUMBER} for auto-increment number"})]})}),e.jsx(j,{title:"Footer Message",icon:e.jsx(V,{className:"w-5 h-5"}),helpText:"Weka message ya mwisho kwenye receipt yako.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{id:"show_footer_message",label:"Show Footer Message",checked:s.show_footer_message,onChange:a=>t("show_footer_message",a)}),e.jsx(k,{id:"footer_message",label:"Footer Message",value:s.footer_message,onChange:a=>t("footer_message",a),placeholder:"Asante kwa kununua!"}),e.jsx(r,{id:"show_return_policy",label:"Show Return Policy",checked:s.show_return_policy,onChange:a=>t("show_return_policy",a)}),e.jsx(k,{id:"return_policy_text",label:"Return Policy Text",value:s.return_policy_text,onChange:a=>t("return_policy_text",a),placeholder:"Returns accepted within 7 days with receipt"})]})})]}),e.jsx("div",{className:"lg:block hidden",children:e.jsx("div",{className:"sticky top-6",children:e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(H,{className:"w-6 h-6 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Live Preview"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time preview"})]})]}),e.jsx("div",{className:"mt-4 max-h-[calc(100vh-200px)] overflow-y-auto",children:e.jsx(qe,{settings:s,businessInfo:{name:(i==null?void 0:i.name)||"",address:(i==null?void 0:i.address)||"",phone:(i==null?void 0:i.phone)||"",email:(i==null?void 0:i.email)||"",website:(i==null?void 0:i.website)||"",logo:(i==null?void 0:i.logo)||void 0}})})]})})})]})})});re.displayName="ImprovedReceiptSettings";const Ve=D.memo(re),ie=x.forwardRef((l,d)=>{W();const[s,u]=x.useState({enableDelivery:!1,enableLoyaltyProgram:!0,enableCustomerProfiles:!0,enablePaymentTracking:!0,enableDynamicPricing:!0}),[m]=x.useState(!1);D.useEffect(()=>{try{const i=localStorage.getItem("lats-pos-features");i&&u(JSON.parse(i))}catch(i){console.error("Error loading features:",i)}},[]);const b=async()=>{try{return localStorage.setItem("lats-pos-features",JSON.stringify(s)),C.success("Features saved successfully!"),!0}catch(i){return console.error("Error saving features:",i),C.error("Failed to save features"),!1}},p=async()=>{const i={enableDelivery:!1,enableLoyaltyProgram:!0,enableCustomerProfiles:!0,enablePaymentTracking:!0,enableDynamicPricing:!0};return u(i),localStorage.setItem("lats-pos-features",JSON.stringify(i)),C.success("Features reset to defaults"),!0},f=(i,g)=>{u(o=>({...o,[i]:g}))};return x.useImperativeHandle(d,()=>({saveSettings:b,resetSettings:p})),e.jsx(B,{isLoading:m,children:e.jsx(j,{title:"Optional Features",icon:e.jsx(De,{className:"w-5 h-5"}),helpText:"Chagua features unazotaka. Features ambazo haziko enabled hazitaonekana kwenye POS.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(Re,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Delivery Management"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Weka delivery orders, driver assignment, na tracking."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-700 rounded",children:"Driver Tracking"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-700 rounded",children:"Delivery Areas"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-700 rounded",children:"Fee Management"})]})]})]}),e.jsx(r,{id:"enable-delivery",label:"",checked:s.enableDelivery,onChange:i=>f("enableDelivery",i)})]}),s.enableDelivery&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Active"}),e.jsx("span",{className:"text-gray-500",children:"- Delivery options zitaonekana kwenye POS"})]})})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-purple-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:e.jsx(Ae,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Loyalty Program"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Wapa customers points, track loyalty tiers, na discounts."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-purple-50 text-purple-700 rounded",children:"Points System"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-purple-50 text-purple-700 rounded",children:"Member Discounts"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-purple-50 text-purple-700 rounded",children:"Rewards"})]})]})]}),e.jsx(r,{id:"enable-loyalty",label:"",checked:s.enableLoyaltyProgram,onChange:i=>f("enableLoyaltyProgram",i)})]}),s.enableLoyaltyProgram&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Active"}),e.jsx("span",{className:"text-gray-500",children:"- Loyalty features ziko enabled kwenye POS"})]})})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-green-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(q,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Customer Profiles"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Save taarifa za customers, historia ya manunuzi, na preferences."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-green-50 text-green-700 rounded",children:"Purchase History"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-green-50 text-green-700 rounded",children:"Contact Info"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-green-50 text-green-700 rounded",children:"Preferences"})]})]})]}),e.jsx(r,{id:"enable-customer-profiles",label:"",checked:s.enableCustomerProfiles,onChange:i=>f("enableCustomerProfiles",i)})]}),s.enableCustomerProfiles&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Active"}),e.jsx("span",{className:"text-gray-500",children:"- Customer selection inapatikana kwenye POS"})]})})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-yellow-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 bg-yellow-50 rounded-lg",children:e.jsx(Q,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Dynamic Pricing"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Weka bei special kwa wakati fulani, bulk discounts, na promotions."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-yellow-50 text-yellow-700 rounded",children:"Happy Hour"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-yellow-50 text-yellow-700 rounded",children:"Bulk Discounts"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-yellow-50 text-yellow-700 rounded",children:"Promotions"})]})]})]}),e.jsx(r,{id:"enable-dynamic-pricing",label:"",checked:s.enableDynamicPricing,onChange:i=>f("enableDynamicPricing",i)})]}),s.enableDynamicPricing&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Active"}),e.jsx("span",{className:"text-gray-500",children:"- Dynamic pricing rules ziko applied"})]})})]})]})})})});ie.displayName="FeaturesTab";const Qe=D.memo(ie),oe=x.forwardRef((l,d)=>{var v,_,y,A,R,n,P,E,O,c,S,M,w;const[s,u]=x.useState({mode:"simple",defaultRole:"cashier",customPermissions:{enable_pos_access:!0,enable_sales_access:!0,enable_refunds_access:!1,enable_discount_access:!1,enable_inventory_view:!0,enable_inventory_edit:!1,enable_product_creation:!1,enable_customer_view:!0,enable_customer_creation:!0,enable_daily_reports:!1,enable_financial_reports:!1,enable_settings_access:!1,enable_user_management:!1}}),[m,b]=x.useState(!1),[p,f]=x.useState(!1);x.useState(!1),D.useEffect(()=>{try{const h=localStorage.getItem("lats-pos-permissions");h&&u(JSON.parse(h))}catch(h){console.error("Error loading permissions:",h)}},[]);const i=async()=>{b(!0);try{return localStorage.setItem("lats-pos-permissions",JSON.stringify(s)),C.success("Permissions saved successfully!"),!0}catch(h){return console.error("Error saving permissions:",h),C.error("Failed to save permissions"),!1}finally{b(!1)}},g=async()=>{const h={mode:"simple",defaultRole:"cashier",customPermissions:{enable_pos_access:!0,enable_sales_access:!0,enable_refunds_access:!1,enable_discount_access:!1,enable_inventory_view:!0,enable_inventory_edit:!1,enable_product_creation:!1,enable_customer_view:!0,enable_customer_creation:!0,enable_daily_reports:!1,enable_financial_reports:!1,enable_settings_access:!1,enable_user_management:!1}};return u(h),localStorage.setItem("lats-pos-permissions",JSON.stringify(h)),C.success("Permissions reset to defaults"),!0},o=h=>{u(T=>({...T,defaultRole:h}))},t=(h,T)=>{u(z=>({...z,customPermissions:{...z.customPermissions,[h]:T}}))};x.useImperativeHandle(d,()=>({saveSettings:i,resetSettings:g}));const a={cashier:{title:"Cashier",description:"Basic sales and customer service access",permissions:[{text:"Process sales",allowed:!0},{text:"View products and prices",allowed:!0},{text:"View inventory levels",allowed:!0},{text:"Create/edit customers",allowed:!0},{text:"Cannot issue refunds",allowed:!1},{text:"Cannot access reports",allowed:!1},{text:"Cannot change settings",allowed:!1}]},manager:{title:"Manager",description:"Full operational access with reports",permissions:[{text:"Everything Cashier can do",allowed:!0},{text:"Process refunds",allowed:!0},{text:"Apply discounts",allowed:!0},{text:"Manage inventory",allowed:!0},{text:"Create/edit products",allowed:!0},{text:"View daily reports",allowed:!0},{text:"Cannot access system settings",allowed:!1},{text:"Cannot manage users",allowed:!1}]},admin:{title:"Administrator",description:"Complete system access",permissions:[{text:"Everything Manager can do",allowed:!0},{text:"View financial reports",allowed:!0},{text:"Access system settings",allowed:!0},{text:"Manage users",allowed:!0},{text:"Configure POS",allowed:!0},{text:"Full access to all features",allowed:!0}]},custom:{title:"Custom",description:"Create your own permission set",permissions:[{text:"Configure specific permissions",allowed:!0},{text:"Mix and match access levels",allowed:!0},{text:"Fine-grained control",allowed:!0}]}};return e.jsxs(B,{isLoading:p,children:[e.jsx(j,{title:"Permission Mode",icon:e.jsx(ae,{className:"w-5 h-5"}),helpText:"Choose between simple role-based permissions or advanced custom permissions.",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Use Simple Mode"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Quick role-based permissions vs. custom granular control"})]}),e.jsxs("button",{onClick:()=>u(h=>({...h,mode:h.mode==="simple"?"advanced":"simple"})),className:"px-4 py-2 bg-white border-2 border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50 font-medium transition-colors",children:["Switch to ",s.mode==="simple"?"Advanced":"Simple"," Mode"]})]})}),s.mode==="simple"&&e.jsx(j,{title:"Role-Based Permissions",icon:e.jsx(q,{className:"w-5 h-5"}),helpText:"Choose a pre-configured role with built-in permission sets. Best for most businesses.",children:e.jsx("div",{className:"space-y-4",children:["cashier","manager","admin"].map(h=>e.jsx("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-all ${s.defaultRole===h?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 bg-white"}`,onClick:()=>o(h),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("input",{type:"radio",checked:s.defaultRole===h,onChange:()=>o(h),className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:a[h].title}),e.jsx("p",{className:"text-sm text-gray-600",children:a[h].description})]})]}),e.jsx("ul",{className:"ml-8 mt-3 space-y-1",children:a[h].permissions.map((T,z)=>e.jsxs("li",{className:"text-sm flex items-start gap-2",children:[T.allowed?e.jsx(Ee,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}):e.jsx(G,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:T.allowed?"text-green-700":"text-gray-500",children:T.text})]},z))})]}),s.defaultRole===h&&e.jsx("div",{className:"px-3 py-1 bg-blue-500 text-white text-sm font-medium rounded",children:"Selected"})]})},h))})}),s.mode==="advanced"&&e.jsxs(j,{title:"Custom Permissions",icon:e.jsx(J,{className:"w-5 h-5"}),helpText:"Fine-grained control over user permissions. Make sure you understand what each permission does to avoid security issues.",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-blue-600"}),"POS & Sales"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"perm_pos_access",label:"Enable POS Access",checked:((v=s.customPermissions)==null?void 0:v.enable_pos_access)??!0,onChange:h=>t("enable_pos_access",h),helpText:"Allow user to access the POS system."}),e.jsx(r,{id:"perm_sales_access",label:"Enable Sales Access",checked:((_=s.customPermissions)==null?void 0:_.enable_sales_access)??!0,onChange:h=>t("enable_sales_access",h),helpText:"Allow user to make sales transactions."}),e.jsx(r,{id:"perm_refunds_access",label:"Process Refunds",checked:((y=s.customPermissions)==null?void 0:y.enable_refunds_access)??!1,onChange:h=>t("enable_refunds_access",h),helpText:"Allow user to process customer refunds."}),e.jsx(r,{id:"perm_discount_access",label:"Apply Discounts",checked:((A=s.customPermissions)==null?void 0:A.enable_discount_access)??!1,onChange:h=>t("enable_discount_access",h),helpText:"Allow user to apply discounts to sales."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-green-600"}),"Inventory & Products"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"perm_inventory_view",label:"View Inventory",checked:((R=s.customPermissions)==null?void 0:R.enable_inventory_view)??!0,onChange:h=>t("enable_inventory_view",h),helpText:"View inventory levels and product information."}),e.jsx(r,{id:"perm_inventory_edit",label:"Edit Inventory",checked:((n=s.customPermissions)==null?void 0:n.enable_inventory_edit)??!1,onChange:h=>t("enable_inventory_edit",h),helpText:"Update stock quantities and inventory data."}),e.jsx(r,{id:"perm_product_creation",label:"Create Products",checked:((P=s.customPermissions)==null?void 0:P.enable_product_creation)??!1,onChange:h=>t("enable_product_creation",h),helpText:"Add new products to the system."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-purple-600"}),"Customers"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"perm_customer_view",label:"View Customers",checked:((E=s.customPermissions)==null?void 0:E.enable_customer_view)??!0,onChange:h=>t("enable_customer_view",h),helpText:"View customer information and history."}),e.jsx(r,{id:"perm_customer_creation",label:"Create/Edit Customers",checked:((O=s.customPermissions)==null?void 0:O.enable_customer_creation)??!0,onChange:h=>t("enable_customer_creation",h),helpText:"Add and update customer records."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-red-600"}),"Reports & Administration"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"perm_daily_reports",label:"View Daily Reports",checked:((c=s.customPermissions)==null?void 0:c.enable_daily_reports)??!1,onChange:h=>t("enable_daily_reports",h),helpText:"Access daily sales and activity reports."}),e.jsx(r,{id:"perm_financial_reports",label:"View Financial Reports",checked:((S=s.customPermissions)==null?void 0:S.enable_financial_reports)??!1,onChange:h=>t("enable_financial_reports",h),helpText:"View financial reports and analytics."}),e.jsx(r,{id:"perm_settings_access",label:"Access Settings",checked:((M=s.customPermissions)==null?void 0:M.enable_settings_access)??!1,onChange:h=>t("enable_settings_access",h),helpText:"Access and modify system settings."}),e.jsx(r,{id:"perm_user_management",label:"Manage Users",checked:((w=s.customPermissions)==null?void 0:w.enable_user_management)??!1,onChange:h=>t("enable_user_management",h),helpText:"Add, edit, and remove user accounts."})]})]})]})]})});oe.displayName="UserPermissionsSimplifiedTab";const Je=D.memo(oe),ce=x.forwardRef((l,d)=>{W();const[s,u]=x.useState({whatsappEnabled:!0,whatsappAutoSend:!1,whatsappShowPreview:!0,whatsappIncludeLogo:!0,whatsappIncludeItems:!0,whatsappMessage:"Thank you for your purchase! Here's your invoice:",smsEnabled:!0,smsAutoSend:!1,smsTemplate:"Thank you! Total: {total}. Balance: {balance}. Ref: {invoice_no}",smsIncludeTotal:!0,smsIncludeBalance:!0,emailEnabled:!0,emailAutoSend:!1,emailSubject:"Your Invoice from {business_name}",emailTemplate:"Thank you for your purchase. Please find your invoice attached.",emailAttachPDF:!0,notifyOnPayment:!0,notifyOnRefund:!0,notifyLowStock:!0,notifyNewCustomer:!1}),[m,b]=x.useState(!1),[p,f]=x.useState(!1),[i,g]=x.useState(!1),[o,t]=x.useState(!1);D.useEffect(()=>{try{const n=localStorage.getItem("lats-pos-notifications");n&&u(JSON.parse(n))}catch(n){console.error("Error loading notification settings:",n)}},[]);const a=async()=>{g(!0);try{return localStorage.setItem("lats-pos-notifications",JSON.stringify(s)),C.success("Notification settings saved successfully!"),!0}catch(n){return console.error("Error saving notification settings:",n),C.error("Failed to save notification settings"),!1}finally{g(!1)}},v=async()=>{const n={whatsappEnabled:!0,whatsappAutoSend:!1,whatsappShowPreview:!0,whatsappIncludeLogo:!0,whatsappIncludeItems:!0,whatsappMessage:"Asante kwa kununua! Hii hapa invoice yako:",smsEnabled:!0,smsAutoSend:!1,smsTemplate:"Asante! Jumla: {total}. Deni: {balance}. Ref: {invoice_no}",smsIncludeTotal:!0,smsIncludeBalance:!0,emailEnabled:!0,emailAutoSend:!1,emailSubject:"Your Invoice from {business_name}",emailTemplate:"Asante kwa kununua. Invoice iko attached.",emailAttachPDF:!0,notifyOnPayment:!0,notifyOnRefund:!0,notifyLowStock:!0,notifyNewCustomer:!1};return u(n),localStorage.setItem("lats-pos-notifications",JSON.stringify(n)),C.success("Notification settings reset to defaults"),!0},_=(n,P)=>{u(E=>({...E,[n]:P}))};x.useImperativeHandle(d,()=>({saveSettings:a,resetSettings:v}));const y={invoice_no:"INV-2024-001",business_name:"My Store",business_phone:"+255 123 456 789",customer_name:"John Doe",items:[{name:"Product 1",quantity:2,price:1e4},{name:"Product 2",quantity:1,price:25e3}],subtotal:45e3,tax:4500,total:49500,paid:3e4,balance:19500,date:new Date().toLocaleDateString()},A=()=>{let n=s.whatsappMessage+`

`;return n+=`ðŸ“„ Invoice: ${y.invoice_no}
`,n+=`ðŸ“… Date: ${y.date}
`,n+=`ðŸ‘¤ Customer: ${y.customer_name}

`,s.whatsappIncludeItems&&(n+=`ðŸ›’ Items:
`,y.items.forEach(P=>{n+=`  â€¢ ${P.name} x${P.quantity} - ${N.money(P.price)}
`}),n+=`
`),n+=`ðŸ’° Total: ${N.money(y.total)}
`,n+=`âœ… Paid: ${N.money(y.paid)}
`,n+=`ðŸ“Š Balance: ${N.money(y.balance)}

`,n+=`ðŸ“ž Contact: ${y.business_phone}
`,n+=`
Thank you for your business! ðŸ™`,n},R=()=>{let n=s.smsTemplate;return n=n.replace("{total}",N.money(y.total)),n=n.replace("{balance}",N.money(y.balance)),n=n.replace("{invoice_no}",y.invoice_no),n=n.replace("{business_name}",y.business_name),n=n.replace("{customer_name}",y.customer_name),n};return e.jsxs(B,{isLoading:o,children:[e.jsx(j,{title:"WhatsApp Invoice",icon:e.jsx(te,{className:"w-5 h-5"}),helpText:"Tuma invoice kwenye WhatsApp ya customer na items, totals, na payment info.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{id:"whatsapp_enabled",label:"Enable WhatsApp Integration",checked:s.whatsappEnabled,onChange:n=>_("whatsappEnabled",n),helpText:"Send detailed invoices with items, totals, and payment info directly to customers' WhatsApp."}),s.whatsappEnabled&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-4 border-green-200",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"whatsapp_auto_send",label:"Auto-send after payment",checked:s.whatsappAutoSend,onChange:n=>_("whatsappAutoSend",n),helpText:"Automatically send invoice to customer's WhatsApp after payment completion."}),e.jsx(r,{id:"whatsapp_show_preview",label:"Show preview before sending",checked:s.whatsappShowPreview,onChange:n=>_("whatsappShowPreview",n),helpText:"Allow staff to review the message before sending it."}),e.jsx(r,{id:"whatsapp_include_logo",label:"Include business logo",checked:s.whatsappIncludeLogo,onChange:n=>_("whatsappIncludeLogo",n),helpText:"Add your business logo to the WhatsApp message."}),e.jsx(r,{id:"whatsapp_include_items",label:"Include item details",checked:s.whatsappIncludeItems,onChange:n=>_("whatsappIncludeItems",n),helpText:"Show individual items and quantities in the message."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{id:"whatsapp_opening",label:"Opening Message",value:s.whatsappMessage,onChange:n=>_("whatsappMessage",n),placeholder:"Thank you for your purchase! Here's your invoice:",multiline:!0,rows:2,helpText:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Available Variables:"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[e.jsx("span",{children:"{invoice_no}"}),e.jsx("span",{children:"{customer_name}"}),e.jsx("span",{children:"{total}"}),e.jsx("span",{children:"{paid}"}),e.jsx("span",{children:"{balance}"}),e.jsx("span",{children:"{date}"}),e.jsx("span",{children:"{business_name}"}),e.jsx("span",{children:"{business_phone}"})]})]})}),e.jsx(k,{id:"whatsapp_closing",label:"Closing Message (Optional)",value:s.whatsappClosingMessage||"",onChange:n=>_("whatsappClosingMessage",n),placeholder:"Thank you for your business!",multiline:!0,rows:2,helpText:"Optional message shown at the end of the invoice."})]}),e.jsxs("button",{onClick:()=>b(!m),className:"flex items-center gap-2 px-4 py-2 border-2 border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(H,{className:"w-4 h-4"}),m?"Hide Preview":"Show Preview"]}),m&&e.jsx("div",{className:"bg-gray-50 border-2 border-gray-200 rounded-lg p-4",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 font-mono",children:A()})})]})]})}),e.jsx(j,{title:"SMS Invoice",icon:e.jsx(Fe,{className:"w-5 h-5"}),helpText:"Tuma invoice summary kwa SMS kwa customer.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{id:"sms_enabled",label:"Enable SMS Integration",checked:s.smsEnabled,onChange:n=>_("smsEnabled",n),helpText:"Send short invoice notifications to customers via SMS."}),s.smsEnabled&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-4 border-blue-200",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"sms_auto_send",label:"Auto-send after payment",checked:s.smsAutoSend,onChange:n=>_("smsAutoSend",n),helpText:"Automatically send SMS after payment completion."}),e.jsx(r,{id:"sms_include_total",label:"Include total amount",checked:s.smsIncludeTotal,onChange:n=>_("smsIncludeTotal",n),helpText:"Show total amount in the SMS message."}),e.jsx(r,{id:"sms_include_balance",label:"Include balance due",checked:s.smsIncludeBalance,onChange:n=>_("smsIncludeBalance",n),helpText:"Show remaining balance in the SMS message."})]}),e.jsx(k,{id:"sms_template",label:"SMS Template",value:s.smsTemplate,onChange:n=>_("smsTemplate",n),placeholder:"Thank you! Total: {total}. Balance: {balance}. Ref: {invoice_no}",multiline:!0,rows:3,helpText:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Variables:"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[e.jsx("span",{children:"{total}"}),e.jsx("span",{children:"{balance}"}),e.jsx("span",{children:"{paid}"}),e.jsx("span",{children:"{invoice_no}"}),e.jsx("span",{children:"{business_name}"}),e.jsx("span",{children:"{customer_name}"})]}),e.jsx("p",{className:"mt-2 text-xs",children:"Keep under 160 chars to avoid splitting."})]})}),e.jsxs("button",{onClick:()=>f(!p),className:"flex items-center gap-2 px-4 py-2 border-2 border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(H,{className:"w-4 h-4"}),p?"Hide Preview":"Show Preview"]}),p&&e.jsxs("div",{className:"bg-gray-50 border-2 border-gray-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-800 mb-2",children:R()}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Character count: ",R().length," / 160"]})]})]})]})}),e.jsx(j,{title:"Email Invoice",icon:e.jsx(Me,{className:"w-5 h-5"}),helpText:"Tuma invoice PDF kwa email ya customer.",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{id:"email_enabled",label:"Enable Email Integration",checked:s.emailEnabled,onChange:n=>_("emailEnabled",n),helpText:"Send professional invoices to customers via email."}),s.emailEnabled&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-4 border-purple-200",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"email_auto_send",label:"Auto-send after payment",checked:s.emailAutoSend,onChange:n=>_("emailAutoSend",n),helpText:"Automatically send email after payment completion."}),e.jsx(r,{id:"email_attach_pdf",label:"Attach PDF invoice",checked:s.emailAttachPDF,onChange:n=>_("emailAttachPDF",n),helpText:"Include formatted PDF as email attachment."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{id:"email_subject",label:"Email Subject",value:s.emailSubject,onChange:n=>_("emailSubject",n),placeholder:"Your Invoice from {business_name}",helpText:"Subject line for the email. Use variables like {business_name}, {invoice_no}."}),e.jsx(k,{id:"email_body",label:"Email Body",value:s.emailTemplate,onChange:n=>_("emailTemplate",n),placeholder:"Dear {customer_name}, Thank you for your purchase!",multiline:!0,rows:6,helpText:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Variables:"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[e.jsx("span",{children:"{business_name}"}),e.jsx("span",{children:"{customer_name}"}),e.jsx("span",{children:"{invoice_no}"}),e.jsx("span",{children:"{total}"}),e.jsx("span",{children:"{paid}"}),e.jsx("span",{children:"{balance}"})]})]})})]})]})]})}),e.jsx(j,{title:"General Notifications",icon:e.jsx(ze,{className:"w-5 h-5"}),helpText:"Control which system events trigger notifications to staff and customers.",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{id:"notify_on_payment",label:"Notify on successful payment",checked:s.notifyOnPayment,onChange:n=>_("notifyOnPayment",n),helpText:"Show notification when a payment is completed successfully."}),e.jsx(r,{id:"notify_on_refund",label:"Notify on refund",checked:s.notifyOnRefund,onChange:n=>_("notifyOnRefund",n),helpText:"Alert when a refund is processed."}),e.jsx(r,{id:"notify_low_stock",label:"Low stock alerts",checked:s.notifyLowStock,onChange:n=>_("notifyLowStock",n),helpText:"Get alerted when products are running low on inventory."}),e.jsx(r,{id:"notify_new_customer",label:"New customer registration",checked:s.notifyNewCustomer,onChange:n=>_("notifyNewCustomer",n),helpText:"Receive notification when a new customer is added."})]})})]})});ce.displayName="NotificationsSettingsTab";const Ge=D.memo(ce),Ye=x.forwardRef(({isOpen:l,onClose:d,activeTab:s,onTabChange:u},m)=>{const{currentUser:b}=ue(),p=(b==null?void 0:b.role)||"customer-care",f=p==="admin",{t:i}=W(),[g,o]=x.useState(s||(f?"general":"receipt")),[t,a]=x.useState(!1),[v,_]=x.useState("");D.useEffect(()=>{s&&s!==g&&o(s)},[s,g]);const y=x.useRef(null),A=x.useRef(null),R=x.useRef(null),n=x.useRef(null),P=x.useRef(null),E=x.useRef(null),O=x.useMemo(()=>[{id:"general",name:i("settings.general"),keywords:["interface","theme","language","currency","display","barcode","scanner","security","passcode"],roles:["admin"]},{id:"pricing",name:i("settings.pricing"),keywords:["pricing","discount","happy hour","bulk","loyalty","promotions"],roles:["admin"]},{id:"receipt",name:i("settings.receipt"),keywords:["receipt","print","template","logo","format"],roles:["admin","customer-care"]},{id:"notifications",name:i("settings.notifications"),keywords:["notifications","alerts","whatsapp","sms","email","invoice","send","auto","manual"],roles:["admin","customer-care"]},{id:"features",name:i("settings.features"),keywords:["features","delivery","loyalty","customer","payment tracking","enable","disable"],roles:["admin"]},{id:"permissions",name:i("settings.permissions"),keywords:["permissions","access","user","role","security","cashier","manager","admin"],roles:["admin"]}],[]),c=x.useMemo(()=>O.filter(w=>w.roles.includes(p)),[O,p]),S=x.useMemo(()=>{if(!v.trim())return c;const w=v.toLowerCase();return c.filter(T=>T.name.toLowerCase().includes(w)||T.keywords.some(z=>z.includes(w)))},[v,c]),M=async()=>{var w,h,T,z,Y,Z;a(!0);try{switch(g){case"general":if(console.log("[Settings] Checking generalSettingsRef:",!!y.current),(w=y.current)!=null&&w.saveSettings)return console.log("[Settings] Calling generalSettingsRef.saveSettings()"),await y.current.saveSettings();break;case"pricing":if(console.log("[Settings] Checking pricingSettingsRef:",!!A.current),(h=A.current)!=null&&h.saveSettings)return console.log("[Settings] Calling pricingSettingsRef.saveSettings()"),await A.current.saveSettings();break;case"receipt":if(console.log("[Settings] Checking receiptSettingsRef:",!!R.current),(T=R.current)!=null&&T.saveSettings)return console.log("[Settings] Calling receiptSettingsRef.saveSettings()"),await R.current.saveSettings();break;case"features":if(console.log("[Settings] Checking featuresSettingsRef:",!!n.current),(z=n.current)!=null&&z.saveSettings)return console.log("[Settings] Calling featuresSettingsRef.saveSettings()"),await n.current.saveSettings();break;case"permissions":if(console.log("[Settings] Checking permissionsSettingsRef:",!!P.current),(Y=P.current)!=null&&Y.saveSettings)return console.log("[Settings] Calling permissionsSettingsRef.saveSettings()"),await P.current.saveSettings();break;case"notifications":if(console.log("[Settings] Checking notificationsSettingsRef:",!!E.current),(Z=E.current)!=null&&Z.saveSettings)return console.log("[Settings] Calling notificationsSettingsRef.saveSettings()"),await E.current.saveSettings();break;default:return console.error("[Settings] Unknown settings tab:",g),ee.error(`Unknown settings tab: ${g}`),!1}throw console.error("[Settings] No save function available for tab:",g),new Error(`No save function available for ${g} settings`)}catch(de){return console.error("[Settings] Save failed:",de),ee.error(`Failed to save ${g} settings. Please try again.`),!1}finally{console.log("[Settings] Setting isSavingSettings to false"),a(!1)}};return x.useImperativeHandle(m,()=>({saveCurrentTabSettings:M})),He(l),l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50",onClick:w=>{w.target===w.currentTarget&&d()},style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col",style:{pointerEvents:"auto"},children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(I,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:i("settings.posSettings")}),e.jsx("p",{className:"text-xs text-gray-500",children:i("settings.configure")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:i("settings.searchSettings"),value:v,onChange:w=>{console.log("[Settings] Search query changed:",w.target.value),_(w.target.value)},className:"pl-10 pr-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900 w-64"})]}),e.jsx("button",{onClick:()=>{console.log("[Settings] Close button clicked"),d()},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"mt-6",children:S.length>0?e.jsx(Be,{tabs:S.map(w=>({id:w.id,label:w.name})),activeTab:g,onTabChange:w=>{o(w),u==null||u(w)},variant:"modern",size:"md"}):v?e.jsxs("div",{className:"text-gray-500 text-sm py-2 text-center mt-2",children:[i("settings.noSettingsFound"),' "',v,'"']}):null})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[g==="general"&&e.jsx(We,{ref:y}),g==="pricing"&&e.jsx(Ue,{ref:A}),g==="receipt"&&e.jsx(Ve,{ref:R}),g==="notifications"&&e.jsx(Ge,{ref:E}),g==="features"&&e.jsx(Qe,{ref:n}),g==="permissions"&&e.jsx(Je,{ref:P})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200 bg-white flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{console.log("[Settings] Cancel button clicked"),d()},className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:i("common.cancel")}),e.jsx("button",{type:"button",onClick:()=>{console.log("[Settings] Save Settings button clicked"),M()},disabled:t,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),i("settings.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-5 h-5"}),i("settings.saveSettings")]})})]})]})})]}):null});Ye.displayName="POSSettingsModal";export{Ye as default};
