import{aR as ye,aS as ve,aT as je,d as f,u as Ne,a as be,j as e,G as k,e as N}from"./index-61458a34.js";import{r as p}from"./vendor-36d2c7c1.js";import{B as we}from"./BackButton-02a80e74.js";import{Q as ae,N as le,u as Ie,y as Se,d as A,A as F,v as ke,a9 as De,R as ie,l as Ce,n as R}from"./ui-28e30067.js";import{p as q}from"./draftService-00fb159f.js";import{a as Oe}from"./purchaseOrderUtils-7c108ebb.js";import{a as Pe,d as Fe}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";const Re=ye()(ve(je((n,x)=>({isLoading:!1,isCreating:!1,isUpdating:!1,isDeleting:!1,error:null,purchaseOrders:[],currentPO:null,shippedItems:[],cartItems:[],selectedSupplier:null,selectedCurrency:{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"},expectedDelivery:"",paymentTerms:"net_30",notes:"",filters:{searchQuery:"",statusFilter:"all",supplierFilter:"",dateRange:{start:"",end:""},sortBy:"createdAt",sortOrder:"desc"},selectedOrders:[],loadPurchaseOrders:async()=>{n({isLoading:!0,error:null});try{const r=f.getState();await r.loadPurchaseOrders();const{purchaseOrders:s}=r;n({purchaseOrders:s,isLoading:!1})}catch(r){console.error("Error loading purchase orders:",r),n({error:"Failed to load purchase orders",isLoading:!1})}},getPurchaseOrder:async r=>{var s,l;console.log(`ðŸ”„ Starting getPurchaseOrder with ID: ${r}`),n({isLoading:!0,error:null});try{if(!r){const m="Purchase order ID is required";console.error("âŒ Missing purchase order ID:",{id:r,type:typeof r}),n({error:m,isLoading:!1});return}if(typeof r!="string"){const m=`Invalid purchase order ID type: Expected string, got ${typeof r}`;console.error("âŒ Invalid purchase order ID type:",{id:r,type:typeof r}),n({error:m,isLoading:!1});return}const a=r.trim();if(a===""){const m="Purchase order ID cannot be empty or whitespace only";console.error("âŒ Empty purchase order ID after trimming:",{originalId:r,trimmedId:a}),n({error:m,isLoading:!1});return}if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a)){const m=`Invalid purchase order ID format: "${a}". Expected UUID format.`;console.error("âŒ Invalid UUID format:",{originalId:r,trimmedId:a,expectedFormat:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}),n({error:m,isLoading:!1});return}console.log("ðŸ” Validated purchase order ID, fetching from inventory store:",a);const i=await f.getState().getPurchaseOrder(a);if(console.log("ðŸ” Response from inventory store:",{ok:i.ok,hasData:!!i.data,message:i.message,dataId:(s=i.data)==null?void 0:s.id}),i.ok&&i.data)console.log("âœ… Purchase order loaded successfully:",{id:i.data.id,orderNumber:i.data.orderNumber,status:i.data.status,supplierName:(l=i.data.supplier)==null?void 0:l.name}),n({currentPO:i.data,isLoading:!1});else{const m=i.message||"Failed to get purchase order from server";console.error("âŒ Failed to get purchase order:",{error:m,response:i,purchaseOrderId:a}),n({error:m,isLoading:!1})}}catch(a){console.error("âŒ Exception getting purchase order:",{error:a,purchaseOrderId:r,errorMessage:a instanceof Error?a.message:"Unknown error",errorStack:a instanceof Error?a.stack:void 0,timestamp:new Date().toISOString()});let o="Failed to get purchase order";a instanceof Error&&(a.message.includes("network")||a.message.includes("fetch")?o="Network error: Please check your internet connection and try again":a.message.includes("timeout")?o="Request timeout: The server is taking too long to respond":a.message.includes("permission")||a.message.includes("unauthorized")?o="Permission denied: You do not have access to this purchase order":a.message.includes("not found")?o=`Purchase order with ID "${r}" not found`:o=`Error: ${a.message}`),n({error:o,isLoading:!1})}},createPurchaseOrder:async r=>{n({isCreating:!0,error:null});try{const l=await f.getState().createPurchaseOrder(r);return l.ok&&(await x().loadPurchaseOrders(),x().clearCart()),n({isCreating:!1}),l}catch(s){return console.error("Error creating purchase order:",s),n({error:"Failed to create purchase order",isCreating:!1}),{ok:!1,message:"Failed to create purchase order"}}},updatePurchaseOrder:async(r,s)=>{n({isUpdating:!0,error:null});try{const a=await f.getState().updatePurchaseOrder(r,s);return a.ok&&await x().loadPurchaseOrders(),n({isUpdating:!1}),a}catch(l){return console.error("Error updating purchase order:",l),n({error:"Failed to update purchase order",isUpdating:!1}),{ok:!1,message:"Failed to update purchase order"}}},deletePurchaseOrder:async r=>{n({isDeleting:!0,error:null});try{const l=await f.getState().deletePurchaseOrder(r);return l.ok&&await x().loadPurchaseOrders(),n({isDeleting:!1}),l}catch(s){return console.error("Error deleting purchase order:",s),n({error:"Failed to delete purchase order",isDeleting:!1}),{ok:!1,message:"Failed to delete purchase order"}}},receivePurchaseOrder:async r=>{n({isUpdating:!0,error:null});try{const l=await f.getState().receivePurchaseOrder(r);return l.ok&&await x().loadPurchaseOrders(),n({isUpdating:!1}),l}catch(s){return console.error("Error receiving purchase order:",s),n({error:"Failed to receive purchase order",isUpdating:!1}),{ok:!1,message:"Failed to receive purchase order"}}},loadShippedItems:async r=>{n({isLoading:!0,error:null});try{const l=await f.getState().getShippedItems(r);l.ok&&l.data?n({shippedItems:l.data,isLoading:!1}):n({error:"Failed to load shipped items",isLoading:!1})}catch(s){console.error("Error loading shipped items:",s),n({error:"Failed to load shipped items",isLoading:!1})}},updateShippedItem:async(r,s)=>{n({isUpdating:!0,error:null});try{if((await f.getState().updateShippedItem(r,s)).ok){const c=x().shippedItems.map(i=>i.id===r?{...i,...s}:i);n({shippedItems:c,isUpdating:!1})}else n({error:"Failed to update shipped item",isUpdating:!1})}catch(l){console.error("Error updating shipped item:",l),n({error:"Failed to update shipped item",isUpdating:!1})}},markItemAsReceived:async(r,s,l)=>{n({isUpdating:!0,error:null});try{if((await f.getState().markShippedItemAsReceived(r,s,l)).ok){const i=x().shippedItems.map(m=>m.id===r?{...m,receivedQuantity:s,status:"received",notes:l||m.notes}:m);n({shippedItems:i,isUpdating:!1})}else n({error:"Failed to mark item as received",isUpdating:!1})}catch(a){console.error("Error marking item as received:",a),n({error:"Failed to mark item as received",isUpdating:!1})}},reportDamage:async(r,s)=>{n({isUpdating:!0,error:null});try{if((await f.getState().reportShippedItemDamage(r,s)).ok){const c=x().shippedItems.map(i=>i.id===r?{...i,status:"damaged",damageReport:s,notes:s}:i);n({shippedItems:c,isUpdating:!1})}else n({error:"Failed to report damage",isUpdating:!1})}catch(l){console.error("Error reporting damage:",l),n({error:"Failed to report damage",isUpdating:!1})}},addToCart:(r,s,l=1)=>{const a=s.costPrice??(r.price?r.price*.7:1);n(o=>{const c=o.cartItems.find(i=>i.productId===r.id&&i.variantId===s.id);if(c)return{cartItems:o.cartItems.map(i=>i.id===c.id?{...i,quantity:i.quantity+l,totalPrice:(i.quantity+l)*a}:i)};{const i={id:`${r.id}-${s.id}-${Date.now()}`,productId:r.id,variantId:s.id,name:r.name,variantName:s.name,sku:s.sku,costPrice:a,quantity:l,totalPrice:a*l,currentStock:s.stockQuantity,category:r.categoryName,images:r.images||[]};return{cartItems:[...o.cartItems,i]}}})},updateCartItemQuantity:(r,s)=>{if(s<=0){x().removeFromCart(r);return}n(l=>({cartItems:l.cartItems.map(a=>a.id===r?{...a,quantity:s,totalPrice:s*a.costPrice}:a)}))},updateCartItemCostPrice:(r,s)=>{n(l=>({cartItems:l.cartItems.map(a=>a.id===r?{...a,costPrice:s,totalPrice:a.quantity*s}:a)}))},removeFromCart:r=>{n(s=>({cartItems:s.cartItems.filter(l=>l.id!==r)}))},clearCart:()=>{n({cartItems:[],selectedSupplier:null,expectedDelivery:"",notes:""})},setSupplier:r=>{n({selectedSupplier:r})},updateFilters:r=>{n(s=>({filters:{...s.filters,...r}}))},toggleOrderSelection:r=>{n(s=>({selectedOrders:s.selectedOrders.includes(r)?s.selectedOrders.filter(l=>l!==r):[...s.selectedOrders,r]}))},selectAllOrders:()=>{n(r=>({selectedOrders:r.purchaseOrders.map(s=>s.id)}))},deselectAllOrders:()=>{n({selectedOrders:[]})},getFilteredPurchaseOrders:()=>{const{purchaseOrders:r,filters:s}=x();let l=[...r];if(s.searchQuery.trim()){const a=s.searchQuery.toLowerCase();l=l.filter(o=>{var c,i;return o.orderNumber.toLowerCase().includes(a)||((c=o.supplier)==null?void 0:c.name.toLowerCase().includes(a))||((i=o.notes)==null?void 0:i.toLowerCase().includes(a))})}return s.statusFilter!=="all"&&(l=l.filter(a=>a.status===s.statusFilter)),s.supplierFilter&&(l=l.filter(a=>a.supplierId===s.supplierFilter)),(s.dateRange.start||s.dateRange.end)&&(l=l.filter(a=>{const o=new Date(a.createdAt),c=s.dateRange.start?new Date(s.dateRange.start):null,i=s.dateRange.end?new Date(s.dateRange.end):null;return!(c&&o<c||i&&o>i)})),l.sort((a,o)=>{let c,i;switch(s.sortBy){case"orderNumber":c=a.orderNumber,i=o.orderNumber;break;case"totalAmount":c=a.totalAmount,i=o.totalAmount;break;case"expectedDelivery":c=new Date(a.expectedDelivery).getTime(),i=new Date(o.expectedDelivery).getTime();break;default:c=new Date(a.createdAt).getTime(),i=new Date(o.createdAt).getTime()}return s.sortOrder==="asc"?c>i?1:-1:c<i?1:-1}),l},getCartTotal:()=>{const{cartItems:r}=x(),s=r.reduce((o,c)=>o+c.totalPrice,0),l=s*.18,a=s+l;return{subtotal:s,tax:l,total:a}},saveDraft:(r,s)=>{const{cartItems:l,selectedSupplier:a,selectedCurrency:o,expectedDelivery:c,paymentTerms:i}=x();try{return q.saveDraft(r,l,a,o,c,i,s||x().notes)}catch(m){return console.error("Failed to save draft:",m),null}},loadDraft:r=>{n({cartItems:r.cartItems||[],selectedSupplier:r.supplier,selectedCurrency:r.currency||{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"},expectedDelivery:r.expectedDelivery||"",paymentTerms:r.paymentTerms||"net_30",notes:r.notes||""})},autoSaveDraft:()=>{const{cartItems:r,selectedSupplier:s,selectedCurrency:l,expectedDelivery:a,paymentTerms:o,notes:c}=x();if(r.length===0)return null;try{return q.autoSave(r,s,l,a,o,c)}catch(i){return console.error("Auto-save failed:",i),null}},clearDrafts:()=>{q.clearAllDrafts()}})),{name:"purchase-order-store"})),Qe=()=>{var ee,re;const n=Pe(),{currentUser:x}=Ne(),{purchaseOrderId:r}=Fe(),{startLoading:s,completeLoading:l,failLoading:a}=be(),{purchaseOrders:o,shippedItems:c,isLoading:i,error:m,loadPurchaseOrders:$,loadShippedItems:z,updateShippedItem:Le,markItemAsReceived:ne,reportDamage:oe}=Re(),{products:L,suppliers:Q,loadProducts:_,loadSuppliers:B}=f(),[w,V]=p.useState(""),[I,Z]=p.useState("all"),[S,G]=p.useState(r||""),[K,de]=p.useState(!1);p.useState([]);const[J,W]=p.useState(10),ce=10,Y=p.useRef(null),[ue,T]=p.useState(!1),[me,U]=p.useState(!1),[h,D]=p.useState(null),[C,E]=p.useState({quantity:0,notes:""}),[O,H]=p.useState("");p.useEffect(()=>{(async()=>{const d=s("Loading shipped items...");try{await Promise.all([$(),_({page:1,limit:100}),B()]),r&&await z(r),l(d)}catch(u){console.error("Error loading shipped items data:",u),a(d,"Failed to load shipped items")}})()},[$,_,B,z,r,s,l,a]),p.useEffect(()=>{W(10)},[w,I,S]),p.useEffect(()=>{const t=new IntersectionObserver(u=>{u[0].isIntersecting&&P&&!i&&W(v=>v+ce)},{threshold:.1}),d=Y.current;return d&&t.observe(d),()=>{d&&t.unobserve(d)}},[P,i]);const X=p.useMemo(()=>o.flatMap(t=>{var d;return((d=t.items)==null?void 0:d.map((u,v)=>{var j,b;return{id:`shipped-${u.id}`,purchaseOrderId:t.id,purchaseOrderItemId:u.id,quantity:u.quantity,shippedDate:new Date(Date.now()-Math.random()*10*24*60*60*1e3).toISOString().split("T")[0],trackingNumber:`TRK${Math.random().toString(36).substr(2,8).toUpperCase()}`,notes:"",status:["shipped","in_transit","delivered"][Math.floor(Math.random()*3)],product:L.find(g=>g.id===u.productId),variant:(b=(j=L.find(g=>g.id===u.productId))==null?void 0:j.variants)==null?void 0:b.find(g=>g.id===u.variantId),purchaseOrder:t}}))||[]}),[o,L]),y=p.useMemo(()=>{let t=X;if(w.trim()){const d=w.toLowerCase();t=t.filter(u=>{var v,j,b,g,se,te;return((j=(v=u.product)==null?void 0:v.name)==null?void 0:j.toLowerCase().includes(d))||((g=(b=u.variant)==null?void 0:b.sku)==null?void 0:g.toLowerCase().includes(d))||((se=u.trackingNumber)==null?void 0:se.toLowerCase().includes(d))||((te=u.purchaseOrder)==null?void 0:te.orderNumber.toLowerCase().includes(d))})}return I!=="all"&&(t=t.filter(d=>d.status===I)),S&&(t=t.filter(d=>d.purchaseOrderId===S)),t},[X,w,I,S]),M=y.slice(0,J),P=J<y.length,pe=async t=>{D(t),E({quantity:t.quantity,notes:""}),T(!0)},xe=async()=>{if(h)try{await ne(h.id,C.quantity,C.notes),R.success("Item marked as received successfully"),T(!1),D(null)}catch{R.error("Failed to mark item as received")}},he=async t=>{D(t),H(""),U(!0)},ge=async()=>{if(!(!h||!O.trim()))try{await oe(h.id,O),R.success("Damage report submitted successfully"),U(!1),D(null)}catch{R.error("Failed to submit damage report")}},fe=t=>({shipped:"bg-blue-100 text-blue-800",in_transit:"bg-yellow-100 text-yellow-800",delivered:"bg-green-100 text-green-800",damaged:"bg-red-100 text-red-800",lost:"bg-gray-100 text-gray-800"})[t]||"bg-gray-100 text-gray-800";return x?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-purple-50 to-violet-100",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(we,{onClick:()=>n("/lats/purchase-orders")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:e.jsx(ae,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Shipped Items"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Track and manage purchase order shipments"})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(k,{onClick:()=>n("/purchase-orders/create"),icon:e.jsx(le,{size:18}),className:"bg-gradient-to-r from-purple-500 to-violet-600 text-white",children:"New Order"})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(Ie,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Shipments"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:y.length})]})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-50 rounded-lg",children:e.jsx(Se,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"In Transit"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:y.filter(t=>t.status==="in_transit").length})]})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Delivered"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:y.filter(t=>t.status==="delivered").length})]})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-50 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Issues"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:y.filter(t=>t.status==="damaged").length})]})]})})]}),e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search shipments...",value:w,onChange:t=>V(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:()=>de(!K),className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(De,{className:"w-4 h-4"}),"Filters"]})})]}),K&&e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:I,onChange:t=>Z(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"in_transit",children:"In Transit"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"damaged",children:"Damaged"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Purchase Order"}),e.jsxs("select",{value:S,onChange:t=>G(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"All Orders"}),o.map(t=>{var d;return e.jsxs("option",{value:t.id,children:[t.orderNumber," - ",(d=Q.find(u=>u.id===t.supplierId))==null?void 0:d.name]},t.id)})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{V(""),Z("all"),G("")},className:"w-full px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:"Clear Filters"})})]})})]}),e.jsx(N,{className:"overflow-hidden",children:i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(ie,{className:"w-8 h-8 animate-spin text-purple-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading shipments..."})]}):y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No shipments found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:w||I!=="all"||S?"No shipments match your current filters":"No shipments have been created yet"}),e.jsx(k,{onClick:()=>n("/purchase-orders/create"),icon:e.jsx(le,{size:20}),className:"bg-gradient-to-r from-purple-500 to-violet-600 text-white",children:"Create Purchase Order"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-8 gap-4",children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Product"}),e.jsx("div",{className:"font-medium text-gray-700",children:"PO Number"}),e.jsx("div",{className:"font-medium text-gray-700",children:"Tracking"}),e.jsx("div",{className:"font-medium text-gray-700",children:"Quantity"}),e.jsx("div",{className:"font-medium text-gray-700",children:"Shipped Date"}),e.jsx("div",{className:"font-medium text-gray-700",children:"Status"}),e.jsx("div",{className:"font-medium text-gray-700",children:"Progress"}),e.jsx("div",{className:"font-medium text-gray-700",children:"Actions"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:M.map(t=>{var d,u,v,j;return e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"grid grid-cols-8 gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:((d=t.product)==null?void 0:d.name)||"Unknown Product"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",((u=t.variant)==null?void 0:u.sku)||"N/A"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:(v=t.purchaseOrder)==null?void 0:v.orderNumber}),e.jsx("div",{className:"text-sm text-gray-600",children:(j=Q.find(b=>{var g;return b.id===((g=t.purchaseOrder)==null?void 0:g.supplierId)}))==null?void 0:j.name})]}),e.jsx("div",{children:e.jsx("div",{className:"font-mono text-sm text-gray-900",children:t.trackingNumber})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.quantity}),t.receivedQuantity&&e.jsxs("div",{className:"text-sm text-green-600",children:["Received: ",t.receivedQuantity]})]}),e.jsx("div",{children:e.jsx("div",{className:"text-sm text-gray-900",children:Oe(t.shippedDate)})}),e.jsx("div",{children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${fe(t.status)}`,children:t.status.replace("_"," ").toUpperCase()})}),e.jsx("div",{children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.status==="delivered"?"bg-green-500":t.status==="in_transit"?"bg-yellow-500":t.status==="damaged"?"bg-red-500":"bg-blue-500"}`,style:{width:`${t.status==="delivered"?100:t.status==="in_transit"?60:t.status==="damaged"?100:30}%`}})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(`/purchase-orders/${t.purchaseOrderId}`),className:"p-1 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded",title:"View purchase order",children:e.jsx(Ce,{className:"w-4 h-4"})}),t.status!=="delivered"&&t.status!=="damaged"&&e.jsx("button",{onClick:()=>pe(t),className:"p-1 text-green-600 hover:text-green-800 hover:bg-green-50 rounded",title:"Mark as received",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>he(t),className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 rounded",title:"Report damage",children:e.jsx(F,{className:"w-4 h-4"})})]})]})},t.id)})}),y.length>0&&e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["Showing ",M.length," of ",y.length," shipments"]}),e.jsxs("div",{ref:Y,className:"py-2",children:[P&&!i&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-600",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading more shipments..."})]}),!P&&M.length>0&&e.jsx("div",{className:"text-gray-500 text-sm",children:"âœ“ All shipments loaded"})]})]})})]})})]}),ue&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx(N,{className:"w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Mark Item as Received"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product"}),e.jsx("p",{className:"text-gray-900",children:(ee=h.product)==null?void 0:ee.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity Received"}),e.jsx("input",{type:"number",max:h.quantity,min:0,value:C.quantity,onChange:t=>E(d=>({...d,quantity:parseInt(t.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Expected: ",h.quantity]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:C.notes,onChange:t=>E(d=>({...d,notes:t.target.value})),placeholder:"Any notes about the received items...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(k,{onClick:xe,icon:e.jsx(A,{size:18}),className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white",children:"Confirm Received"}),e.jsx(k,{onClick:()=>T(!1),className:"flex-1 bg-gray-100 text-gray-700",children:"Cancel"})]})]})})}),me&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx(N,{className:"w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-red-600"}),"Report Damage"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product"}),e.jsx("p",{className:"text-gray-900",children:(re=h.product)==null?void 0:re.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Tracking: ",h.trackingNumber]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Damage Report"}),e.jsx("textarea",{value:O,onChange:t=>H(t.target.value),placeholder:"Describe the damage or issue with the shipment...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 resize-none",rows:4,required:!0})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(k,{onClick:ge,icon:e.jsx(F,{size:18}),className:"flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white",disabled:!O.trim(),children:"Submit Report"}),e.jsx(k,{onClick:()=>U(!1),className:"flex-1 bg-gray-100 text-gray-700",children:"Cancel"})]})]})})})]}):null};export{Qe as default};
