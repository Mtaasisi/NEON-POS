import{s as i}from"./index-61458a34.js";import"./vendor-36d2c7c1.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";import"./ui-28e30067.js";const u=async()=>{try{const{data:o,error:t}=await i.from("admin_settings").select("*").eq("is_active",!0).order("category",{ascending:!0}).order("setting_key",{ascending:!0});if(t)throw console.error("Error fetching admin settings:",t),t;return o||[]}catch(o){throw console.error("Error fetching admin settings:",o),o}},y=async o=>{try{const{data:t,error:r}=await i.from("admin_settings").select("*").eq("category",o).eq("is_active",!0).order("setting_key",{ascending:!0});if(r)throw console.error(`Error fetching admin settings for category ${o}:`,r),r;return t||[]}catch(t){throw console.error(`Error fetching admin settings for category ${o}:`,t),t}},h=async(o,t)=>{try{const{data:r,error:e}=await i.from("admin_settings").select("*").eq("category",o).eq("setting_key",t).eq("is_active",!0).single();if(e){if(e.code==="PGRST116")return null;throw console.error(`Error fetching admin setting ${o}.${t}:`,e),e}return r}catch(r){throw console.error(`Error fetching admin setting ${o}.${t}:`,r),r}},c=async(o,t,r,e)=>{try{const{error:n}=await i.rpc("update_admin_setting",{category_name:o,key_name:t,new_value:r,reason:e||null});if(n)throw console.error(`Error updating admin setting ${o}.${t}:`,n),n;return!0}catch(n){throw console.error(`Error updating admin setting ${o}.${t}:`,n),n}},_=async o=>{try{const t=o.map(e=>({category:e.category,setting_key:e.key,setting_value:e.value,updated_at:new Date().toISOString()})),{error:r}=await i.from("admin_settings").upsert(t,{onConflict:"category,setting_key"});if(r)throw console.error("Error updating admin settings:",r),r;for(const e of o)if(e.reason)try{await c(e.category,e.key,e.value,e.reason)}catch(n){console.warn("Failed to log setting change:",n)}return!0}catch(t){throw console.error("Error updating admin settings:",t),t}},p=async(o=50,t=0)=>{try{const{data:r,error:e}=await i.from("admin_settings_log").select("*").order("created_at",{ascending:!1}).range(t,t+o-1);if(e)throw console.error("Error fetching admin settings logs:",e),e;return r||[]}catch(r){throw console.error("Error fetching admin settings logs:",r),r}},w=async(o,t=50,r=0)=>{try{const{data:e,error:n}=await i.from("admin_settings_log").select("*").eq("category",o).order("created_at",{ascending:!1}).range(r,r+t-1);if(n)throw console.error(`Error fetching admin settings logs for category ${o}:`,n),n;return e||[]}catch(e){throw console.error(`Error fetching admin settings logs for category ${o}:`,e),e}},E=async(o,t,r=50,e=0)=>{try{const{data:n,error:s}=await i.from("admin_settings_log").select("*").eq("category",o).eq("setting_key",t).order("created_at",{ascending:!1}).range(e,e+r-1);if(s)throw console.error(`Error fetching admin settings logs for ${o}.${t}:`,s),s;return n||[]}catch(n){throw console.error(`Error fetching admin settings logs for ${o}.${t}:`,n),n}},S=o=>{const t={};return o.forEach(r=>{t[r.category]||(t[r.category]={});let e=r.setting_value;if(r.setting_type==="number")e=parseFloat(r.setting_value);else if(r.setting_type==="boolean")e=r.setting_value==="true";else if(r.setting_type==="json")try{e=JSON.parse(r.setting_value)}catch{e=r.setting_value}t[r.category][r.setting_key]=e}),t},$=(o,t)=>{const r=[];return Object.entries(o[t]||{}).forEach(([e,n])=>{let s,a;typeof n=="boolean"?(s=n.toString(),a="boolean"):typeof n=="number"?(s=n.toString(),a="number"):typeof n=="object"?(s=JSON.stringify(n),a="json"):(s=String(n),a="string"),r.push({category:t,setting_key:e,setting_value:s,setting_type:a})}),r};export{$ as flattenSettingsForDatabase,h as getAdminSetting,u as getAdminSettings,y as getAdminSettingsByCategory,p as getAdminSettingsLogs,w as getAdminSettingsLogsByCategory,E as getAdminSettingsLogsBySetting,S as groupSettingsByCategory,c as updateAdminSetting,_ as updateAdminSettings};
