import{j as e,G as ye,s as P,X as nt,e as oe,u as wt,Y as gs,M as st,Z as at,_ as ps,$ as Bt}from"./index-61458a34.js";import{r as N,R as lt,b as fs}from"./vendor-36d2c7c1.js";import{P as bs}from"./PageErrorBoundary-3d3e48b8.js";import{u as ys}from"./useErrorHandler-ecda4689.js";import{G as qt}from"./GlassBadge-9ae09fa8.js";import{G as js}from"./GlassTabs-05c8a392.js";import{X as de,e as it,I as vs,d as ce,A as Fe,n as S,R as et,D as Qt,u as dt,q as pe,y as Ge,v as _t,O as ft,aA as Ue,N as $e,bj as Ns,b0 as Xt,bX as He,bY as ze,r as Pe,aE as Se,l as Kt,a8 as ws,a$ as Le,bZ as _s,S as Jt,J as Ut,G as es,b7 as bt,az as tt,a9 as rt,av as Ss,bP as ts,Y as St,af as yt,b_ as ot,f as ss,bN as Xe,a as Cs,b as Ts,a3 as ge,b$ as as,aa as rs,U as Ke,aL as Ze,c as jt,Z as zt,bC as Zt,bh as Gt,x as ks,Q as Ps,H as Ds,a2 as Es,t as pt,aw as Ht,P as As,as as Rs,c0 as $s,a6 as Fs,c1 as Ms,m as Os}from"./ui-28e30067.js";import{M as ns}from"./Modal-a5e4c1ba.js";import{u as Is}from"./useBodyScrollLock-341c8b9f.js";import{_ as vt}from"./supabase-cf010ec4.js";import{G as Je}from"./GlassSelect-e243562f.js";import{P as Ls}from"./PaymentsPopupModal-6fe61f19.js";import{G as xe}from"./GlassInput-0475021a.js";import{T as Bs}from"./TransferModal-7d7a82f1.js";import{C as qs}from"./CustomerTooltip-6a958832.js";import{smartCache as Vt}from"./enhancedCacheManager-afe341e0.js";import{E as Us}from"./ExpenseManagement-699e2bcf.js";import{format as _e}from"./format-aff4c6a2.js";import"./routing-eb8c310c.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";import"./currencyUtils-59109a41.js";import"./useSuccessModal-081786c4.js";const zs=({isOpen:m,onClose:a,onConfirm:n,title:t,message:o,type:d="warning",confirmText:c="Confirm",cancelText:p="Cancel",loading:j=!1})=>{if(Is(m),!m)return null;const g=()=>{switch(d){case"danger":return e.jsx(Fe,{className:"w-8 h-8 text-red-500"});case"success":return e.jsx(ce,{className:"w-8 h-8 text-green-500"});case"info":return e.jsx(vs,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(it,{className:"w-8 h-8 text-amber-500"})}},h=()=>{switch(d){case"danger":return"danger";case"success":return"success";case"info":return"primary";default:return"warning"}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t})]}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",disabled:j,children:e.jsx(de,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"flex-1 px-6 pb-4 overflow-y-auto",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:o})}),e.jsxs("div",{className:"flex gap-3 justify-end p-6 pt-4 border-t border-gray-100 bg-white rounded-b-2xl",children:[e.jsx(ye,{variant:"outline",onClick:a,disabled:j,size:"md",children:p}),e.jsx(ye,{variant:h(),onClick:n,loading:j,size:"md",children:c})]})]})]})},Zs=({onViewDetails:m,onMakePayment:a,onExport:n})=>{var Ee;const[t,o]=N.useState([]),[d,c]=N.useState([]),[p,j]=N.useState([]),[g,h]=N.useState(!0),[x,f]=N.useState(""),[C,v]=N.useState("all"),[U,l]=N.useState("all"),[A,G]=N.useState(null),[se,H]=N.useState(!1),[ee,k]=N.useState(null),R=u=>{if(u==null||u==="")return 0;const L=typeof u=="string"?parseFloat(u):Number(u);return Number.isFinite(L)?L:0},b=u=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(u),$=(u,L)=>{if(L!==void 0&&L<0)return"bg-orange-100 text-orange-700";switch(u){case"paid":return"bg-green-100 text-green-700";case"partial":return"bg-yellow-100 text-yellow-700";case"unpaid":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},i=lt.useMemo(()=>{const u=t.length,L=t.filter(V=>{const s=R(V.totalAmountBaseCurrency)||R(V.totalAmount),_=R(V.totalPaid);return s-_>0&&V.paymentStatus!=="paid"}).length,q=t.filter(V=>{const s=R(V.totalAmountBaseCurrency)||R(V.totalAmount),_=R(V.totalPaid);return s-_>0&&V.paymentStatus==="partial"}).length,z=t.filter(V=>{const s=R(V.totalAmountBaseCurrency)||R(V.totalAmount),_=R(V.totalPaid);return s-_<=0}).length,Z=t.filter(V=>{const s=R(V.totalAmountBaseCurrency)||R(V.totalAmount),_=R(V.totalPaid);return s-_<0}).length,D=t.reduce((V,s)=>{const _=R(s.totalAmountBaseCurrency)||R(s.totalAmount);return V+_},0),I=t.reduce((V,s)=>V+R(s.totalPaid),0),re=Math.max(0,D-I);return console.log("ðŸ“Š Summary Stats Calculated:",{totalOrders:u,totalAmount:D,totalPaid:I,totalOutstanding:re,unpaidOrders:L,overpaidOrders:Z,sampleOrder:t[0]?{poNumber:t[0].poNumber,totalAmountBaseCurrency:t[0].totalAmountBaseCurrency,totalPaid:t[0].totalPaid}:null}),{totalOrders:u,unpaidOrders:L,partialOrders:q,paidOrders:z,overpaidOrders:Z,totalAmount:D,totalPaid:I,totalOutstanding:re}},[t]),y=N.useCallback(async()=>{try{h(!0);const{data:u,error:L}=await P.from("lats_purchase_orders").select(`
          id,
          po_number,
          supplier_id,
          status,
          currency,
          exchange_rate,
          total_amount_base_currency,
          payment_terms,
          total_amount,
          total_paid,
          payment_status,
          expected_delivery,
          created_at,
          updated_at
        `).order("created_at",{ascending:!1}).limit(50);if(console.log("ðŸ” Raw data from database:",u==null?void 0:u.slice(0,3).map(D=>({po_number:D.po_number,total_amount:D.total_amount,total_amount_type:typeof D.total_amount,total_amount_base_currency:D.total_amount_base_currency,base_type:typeof D.total_amount_base_currency,total_paid:D.total_paid,paid_type:typeof D.total_paid}))),L)throw console.error("Error fetching purchase orders:",L),L;if(!u||u.length===0){o([]);return}const q=[...new Set(u.map(D=>D.supplier_id).filter(Boolean))];let z=[];if(q.length>0){const{data:D,error:I}=await P.from("lats_suppliers").select("id, name, contact_person, phone, wechat, country, wechat_qr_code, alipay_qr_code, bank_account_details").in("id",q);I?console.warn("Error fetching suppliers:",I):z=D||[]}const Z=u.map(D=>{const I=R(D.total_amount),re=R(D.total_amount_base_currency),V=R(D.total_paid),s=R(D.exchange_rate)||1;return{...D,poNumber:D.po_number,supplierId:D.supplier_id,supplier:z.find(_=>_.id===D.supplier_id),totalAmount:I,totalAmountBaseCurrency:re||I,totalPaid:V,exchange_rate:s,exchangeRate:s,paymentStatus:D.payment_status,expectedDelivery:D.expected_delivery,createdAt:D.created_at,updatedAt:D.updated_at}});console.log("âœ… Loaded purchase orders with currency data:",Z.map(D=>({poNumber:D.poNumber,currency:D.currency,totalAmount:D.totalAmount,totalAmountBaseCurrency:D.totalAmountBaseCurrency,totalPaid:D.totalPaid}))),o(Z)}catch(u){console.error("Error fetching purchase orders:",u),S.error("Failed to load purchase orders")}finally{h(!1)}},[]),T=N.useCallback(async()=>{try{const{data:u,error:L}=await P.from("purchase_order_payments").select(`
          id,
          purchase_order_id,
          amount,
          currency,
          payment_method,
          status,
          payment_date,
          reference,
          notes
        `).order("payment_date",{ascending:!1}).limit(10);if(L){console.error("Error fetching payments:",L);return}c(u||[])}catch(u){console.error("Error fetching payments:",u)}},[]),Q=N.useCallback(async()=>{try{const u=await nt.getPaymentMethods();j(u)}catch(u){console.error("Error fetching payment accounts:",u)}},[]);N.useEffect(()=>{y(),T(),Q()},[y,T,Q]),N.useEffect(()=>{console.log("ðŸ”” Setting up real-time subscriptions for purchase order payments...");const u=P.channel("purchase_order_payments_changes").on("postgres_changes",{event:"*",schema:"public",table:"purchase_order_payments"},q=>{console.log("ðŸ”” Purchase order payment change detected:",q),y(),T(),q.eventType==="INSERT"?S.success("Payment recorded successfully!"):q.eventType==="UPDATE"&&S.success("Payment updated!")}).subscribe(),L=P.channel("purchase_orders_payment_status").on("postgres_changes",{event:"UPDATE",schema:"public",table:"lats_purchase_orders",filter:"payment_status=neq.unpaid"},q=>{var Z;console.log("ðŸ”” Purchase order payment status changed:",q),y();const z=(Z=q.new)==null?void 0:Z.payment_status;z==="paid"?S.success("Purchase order fully paid!",{icon:"âœ…",duration:3e3}):z==="partial"&&S.success("Partial payment received!",{icon:"ðŸ’°",duration:3e3})}).subscribe();return()=>{console.log("ðŸ”” Cleaning up purchase order payment subscriptions..."),u.unsubscribe(),L.unsubscribe()}},[y,T]);const X=t.filter(u=>{var Z,D,I;const L=((Z=u.poNumber)==null?void 0:Z.toLowerCase().includes(x.toLowerCase()))||((I=(D=u.supplier)==null?void 0:D.name)==null?void 0:I.toLowerCase().includes(x.toLowerCase())),q=C==="all"||u.paymentStatus===C,z=U==="all"||u.currency===U;return L&&q&&z}),ie=u=>{const L=R(u.totalAmount??u.total_amount),q=R(u.totalAmountBaseCurrency??u.total_amount_base_currency??L),z=R(u.totalPaid??u.total_paid),Z=R(u.exchangeRate??u.exchange_rate??1)||1,D=!!(u.currency&&u.currency!=="TZS"&&Z>0);if(q<=0&&L<=0){S.error("Cannot make payment: Purchase order has no total amount");return}const I=q-z,re=D?L-z/Z:I;if(I<=0||re<=0){const V=D?`${u.currency} ${L.toLocaleString()}`:b(q),s=b(z);S.error(`Purchase order is fully paid. Total: ${V}, Paid: ${s}`);return}console.log("ðŸ’³ Opening payment modal for order:",{poNumber:u.poNumber,currency:u.currency,totalAmountOriginal:L,totalAmountBase:q,totalPaidTZS:z,remainingBase:I,remainingOriginal:re,exchangeRate:Z}),G(u),H(!0)},fe=u=>{if(!u)return 0;const L=R(u.totalAmount??u.total_amount),q=R(u.totalAmountBaseCurrency??u.total_amount_base_currency??L),z=R(u.totalPaid??u.total_paid),Z=R(u.exchangeRate??u.exchange_rate??1)||1;if(u.currency&&u.currency!=="TZS"&&Z>0){const I=z/Z,re=L-I;return Math.max(0,re)}const D=q-z;return Math.max(0,D)},De=async(u,L)=>{if(!A){S.error("No purchase order selected");return}try{const{purchaseOrderPaymentService:q}=await vt(()=>import("./purchaseOrderPaymentService-dcbd50c0.js"),["assets/purchaseOrderPaymentService-dcbd50c0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{data:{user:z}}=await P.auth.getUser(),D=(await Promise.all(u.map(async I=>await q.processPayment({purchaseOrderId:A.id,paymentAccountId:I.paymentAccountId,amount:I.amount,currency:I.currency,paymentMethod:I.paymentMethod,paymentMethodId:I.paymentMethodId,reference:I.reference||`${A.poNumber}`,notes:I.notes||`Payment via ${I.paymentMethod}`,createdBy:(z==null?void 0:z.id)||""})))).filter(I=>!I.success);if(D.length>0){const I=D.map(re=>re.message).join("; ");S.error(`Some payments failed: ${I}`)}else S.success("All payments processed successfully");H(!1),G(null),console.log("ðŸ’° Payment completed, refreshing data..."),await Promise.all([y(),T(),Q()]),console.log("âœ… Data refreshed after payment")}catch(q){console.error("Error processing payment:",q),S.error(q.message||"Failed to process payment")}},be=async u=>{var q,z;if(!u){S.error("No purchase order selected");return}if(ee&&ee!==u.id){S.error("Please wait for the current reversal to finish");return}if(window.confirm(`Undo the most recent payment recorded for ${u.poNumber}?`))try{k(u.id);const{purchaseOrderPaymentService:Z}=await vt(()=>import("./purchaseOrderPaymentService-dcbd50c0.js"),["assets/purchaseOrderPaymentService-dcbd50c0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{data:{user:D}}=await P.auth.getUser(),I=await Z.reverseLatestPayment(u.id,(D==null?void 0:D.id)||null);if(!I.success){S.error(I.message||"Failed to reverse payment");return}const re=((q=I.data)==null?void 0:q.amount_reversed)??((z=I.data)==null?void 0:z.reversed_amount)??0,V=typeof re=="number"?re:Number(re)||0;S.success(`Payment reversal complete for ${u.poNumber}: ${b(V)} restored.`),await Promise.all([y(),T(),Q()])}catch(Z){console.error("Error reversing payment:",Z),S.error((Z==null?void 0:Z.message)||"Failed to reverse payment")}finally{k(null)}};return g?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading purchase orders..."})]}):e.jsxs("div",{className:"min-h-screen p-6 space-y-6",style:{backgroundColor:"transparent"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Purchase Orders"}),e.jsx("p",{className:"text-gray-600",children:"Manage supplier payments and track purchase orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{y(),T()},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(et,{size:16}),"Refresh"]}),e.jsxs("button",{onClick:n,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Qt,{size:16}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(oe,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:i.totalOrders})]}),e.jsx("div",{className:"p-3 bg-blue-500 rounded-lg",children:e.jsx(dt,{className:"w-6 h-6 text-white"})})]})}),e.jsx(oe,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:b(i.totalAmount)})]}),e.jsx("div",{className:"p-3 bg-green-500 rounded-lg",children:e.jsx(pe,{className:"w-6 h-6 text-white"})})]})}),e.jsx(oe,{className:"p-6 bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Outstanding"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:b(i.totalOutstanding)})]}),e.jsx("div",{className:"p-3 bg-yellow-500 rounded-lg",children:e.jsx(it,{className:"w-6 h-6 text-white"})})]})}),e.jsx(oe,{className:"p-6 bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Unpaid Orders"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:i.unpaidOrders})]}),e.jsx("div",{className:"p-3 bg-purple-500 rounded-lg",children:e.jsx(Ge,{className:"w-6 h-6 text-white"})})]})}),e.jsx(oe,{className:"p-6 bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Overpaid Orders"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:i.overpaidOrders})]}),e.jsx("div",{className:"p-3 bg-orange-500 rounded-lg",children:e.jsx(Fe,{className:"w-6 h-6 text-white"})})]})})]}),e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search purchase orders or suppliers...",value:x,onChange:u=>f(u.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Je,{value:C,onChange:u=>v(u.target.value),className:"min-w-[140px]",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"paid",children:"Paid"})]}),e.jsxs(Je,{value:U,onChange:u=>l(u.target.value),className:"min-w-[160px]",children:[e.jsx("option",{value:"all",children:"All Currencies"}),e.jsx("option",{value:"TZS",children:"Tanzanian Shilling (TZS)"}),e.jsx("option",{value:"USD",children:"US Dollar (USD)"}),e.jsx("option",{value:"EUR",children:"Euro (EUR)"}),e.jsx("option",{value:"GBP",children:"British Pound (GBP)"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:X.map(u=>{var I;const L=R(u.totalAmountBaseCurrency)||R(u.totalAmount),q=R(u.totalPaid),z=L-q,Z=L>0?Math.min(q/L*100,100):0,D=u.currency&&u.currency!=="TZS";return e.jsxs(oe,{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ft,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:u.poNumber}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3 h-3"}),((I=u.supplier)==null?void 0:I.name)||"Unknown Supplier"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${$(u.paymentStatus||"unpaid",z)}`,children:u.paymentStatus||"unpaid"}),e.jsxs("div",{className:"flex items-center gap-2",children:[z>0?e.jsxs("button",{onClick:()=>ie(u),disabled:ee===u.id,className:"flex items-center gap-1 px-3 py-1 bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors text-xs font-medium",children:[e.jsx($e,{size:12}),"Pay"]}):e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-gray-100 text-gray-500 rounded-lg text-xs font-medium cursor-not-allowed",children:[e.jsx(Ns,{size:12}),u.paymentStatus==="overpaid"?"Overpaid":"Fully Paid"]}),q>0&&e.jsxs("button",{onClick:()=>be(u),disabled:ee===u.id,className:"flex items-center gap-1 px-3 py-1 bg-red-600 hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors text-xs font-medium",children:[e.jsx(Xt,{size:12,className:ee===u.id?"animate-spin":""}),ee===u.id?"Undoing...":"Undo"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Progress"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium",children:[Math.round(Z),"%"]}),u.paymentStatus==="overpaid"&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full",children:"Overpaid"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${u.paymentStatus==="overpaid"?"bg-gradient-to-r from-orange-400 to-orange-600":Z===100?"bg-gradient-to-r from-green-400 to-green-600":"bg-gradient-to-r from-blue-400 to-blue-600"}`,style:{width:`${Math.min(Z,100)}%`}})})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:b(L)}),D&&u.totalAmount&&e.jsxs("div",{className:"text-xs text-gray-500",children:["(",u.currency," ",u.totalAmount.toLocaleString(),")"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Paid"}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"font-medium text-green-600 flex items-center gap-1",children:[e.jsx(He,{className:"w-3 h-3"}),b(q)]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Remaining"}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:`font-medium flex items-center gap-1 ${z<0?"text-orange-600":z===0?"text-green-600":"text-red-600"}`,children:[z<0?e.jsx(He,{className:"w-3 h-3"}):e.jsx(ze,{className:"w-3 h-3"}),b(Math.abs(z))]})})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"}),"Expected: ",new Date(u.expectedDelivery).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),new Date(u.createdAt).toLocaleDateString()]})]})})]},u.id)})}),d.length>0&&e.jsxs(oe,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Payments"}),e.jsx("button",{onClick:()=>{},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:d.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg hover:from-gray-100 hover:to-gray-200 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Se,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:b(u.amount)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[u.payment_method," â€¢ ",new Date(u.payment_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${u.status==="completed"?"bg-green-100 text-green-700":u.status==="pending"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:u.status}),e.jsx("button",{onClick:()=>m(u),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Kt,{className:"w-4 h-4"})})]})]},u.id))})]}),e.jsx(Ls,{isOpen:se,onClose:()=>H(!1),amount:fe(A),customerId:(A==null?void 0:A.supplierId)||(A==null?void 0:A.supplier_id),customerName:((Ee=A==null?void 0:A.supplier)==null?void 0:Ee.name)||"Supplier",description:`Payment for Purchase Order ${A==null?void 0:A.poNumber}`,onPaymentComplete:De,title:"Purchase Order Payment",paymentType:"cash_out",currency:A==null?void 0:A.currency,exchangeRate:R((A==null?void 0:A.exchangeRate)??(A==null?void 0:A.exchange_rate)??1)||1})]})},Yt=({type:m,size:a="md",className:n=""})=>{const t={sm:{container:"w-8 h-8",icon:16},md:{container:"w-12 h-12",icon:24},lg:{container:"w-16 h-16",icon:32}},d=(c=>{switch(c){case"cash":return{icon:e.jsx(pe,{size:t[a].icon}),bgColor:"bg-gradient-to-br from-green-400 to-green-600",borderColor:"border-green-200",shadowColor:"shadow-green-200"};case"bank":return{icon:e.jsx(Ue,{size:t[a].icon}),bgColor:"bg-gradient-to-br from-blue-400 to-blue-600",borderColor:"border-blue-200",shadowColor:"shadow-blue-200"};case"mobile_money":return{icon:e.jsx(Jt,{size:t[a].icon}),bgColor:"bg-gradient-to-br from-purple-400 to-purple-600",borderColor:"border-purple-200",shadowColor:"shadow-purple-200"};case"credit_card":return{icon:e.jsx(Se,{size:t[a].icon}),bgColor:"bg-gradient-to-br from-orange-400 to-orange-600",borderColor:"border-orange-200",shadowColor:"shadow-orange-200"};case"savings":return{icon:e.jsx(_s,{size:t[a].icon}),bgColor:"bg-gradient-to-br from-indigo-400 to-indigo-600",borderColor:"border-indigo-200",shadowColor:"shadow-indigo-200"};case"wallet":return{icon:e.jsx(Le,{size:t[a].icon}),bgColor:"bg-gradient-to-br from-teal-400 to-teal-600",borderColor:"border-teal-200",shadowColor:"shadow-teal-200"};default:return{icon:e.jsx(ws,{size:t[a].icon}),bgColor:"bg-gradient-to-br from-gray-400 to-gray-600",borderColor:"border-gray-200",shadowColor:"shadow-gray-200"}}})(m);return e.jsx("div",{className:`
        ${t[a].container}
        ${d.bgColor}
        ${d.borderColor}
        ${d.shadowColor}
        rounded-xl
        border-2
        shadow-lg
        flex
        items-center
        justify-center
        text-white
        transition-all
        duration-200
        hover:scale-105
        hover:shadow-xl
        ${n}
      `,children:d.icon})},Gs=({account:m,onClose:a,onSuccess:n})=>{const[t,o]=N.useState({type:"deposit",amount:"",description:"",reference:""}),[d,c]=N.useState(!1),p=async h=>{h.preventDefault();const x=parseFloat(t.amount);if(!t.amount||isNaN(x)||x<=0){S.error("Please enter a valid amount");return}if(!t.description||t.description.trim()===""){S.error("Please enter a description");return}if(t.type==="withdrawal"&&x>(m.balance||0)){S.error("Insufficient balance for withdrawal");return}c(!0);try{const{data:f,error:C}=await P.from("finance_accounts").select("balance").eq("id",m.id).single();if(C)throw C;const v=Number(f.balance)||0,U=x;let l,A;t.type==="deposit"?(l=v+U,A="payment_received"):t.type==="withdrawal"?(l=v-U,A="expense"):(l=v+U,A="adjustment");const{error:G}=await P.from("finance_accounts").update({balance:l,updated_at:new Date().toISOString()}).eq("id",m.id);if(G)throw G;const{error:se}=await P.from("account_transactions").insert({account_id:m.id,transaction_type:A,amount:U,balance_before:v,balance_after:l,description:t.description,reference_number:t.reference||`MAN-${Date.now().toString(36).toUpperCase()}`,branch_id:m.branch_id,metadata:{manual_entry:!0,entry_type:t.type,account_name:m.name},created_at:new Date().toISOString()});if(se)throw se;S.success(t.type==="deposit"?"Deposit recorded successfully":t.type==="withdrawal"?"Withdrawal recorded successfully":"Adjustment recorded successfully"),n(),a()}catch(f){console.error("Error recording transaction:",f),S.error(f.message||"Failed to record transaction")}finally{c(!1)}},j=()=>{switch(t.type){case"deposit":return e.jsx($e,{className:"text-green-600",size:20});case"withdrawal":return e.jsx(Ut,{className:"text-red-600",size:20});default:return e.jsx(pe,{className:"text-blue-600",size:20})}},g=()=>{switch(t.type){case"deposit":return"from-green-500 to-green-600";case"withdrawal":return"from-red-500 to-red-600";default:return"from-blue-500 to-blue-600"}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[j(),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Manual Transaction"}),e.jsx("p",{className:"text-blue-100 text-sm",children:m.name})]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/20 rounded-lg transition-all",disabled:d,children:e.jsx(de,{size:20})})]})}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Current Balance"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:m.currency||"TZS"}).format(m.balance||0)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Transaction Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>o({...t,type:"deposit"}),className:`p-3 rounded-lg border-2 transition-all ${t.type==="deposit"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx($e,{size:20,className:"mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-medium",children:"Deposit"})]}),e.jsxs("button",{type:"button",onClick:()=>o({...t,type:"withdrawal"}),className:`p-3 rounded-lg border-2 transition-all ${t.type==="withdrawal"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(Ut,{size:20,className:"mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-medium",children:"Withdrawal"})]}),e.jsxs("button",{type:"button",onClick:()=>o({...t,type:"adjustment"}),className:`p-3 rounded-lg border-2 transition-all ${t.type==="adjustment"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(pe,{size:20,className:"mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-medium",children:"Adjust"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(xe,{type:"number",value:t.amount,onChange:h=>o({...t,amount:h.target.value}),placeholder:"0.00",step:"0.01",min:"0",required:!0}),t.type==="withdrawal"&&t.amount&&parseFloat(t.amount)>(m.balance||0)&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-red-600 text-sm",children:[e.jsx(it,{size:16}),e.jsx("span",{children:"Insufficient balance"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:t.description,onChange:h=>o({...t,description:h.target.value}),placeholder:"Enter transaction description...",required:!0,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 bg-white/80 backdrop-blur-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number (Optional)"}),e.jsx(xe,{value:t.reference,onChange:h=>o({...t,reference:h.target.value}),placeholder:"Auto-generated if blank"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(it,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[t.type==="deposit"&&e.jsxs(e.Fragment,{children:["This will ",e.jsx("strong",{children:"add"})," money to the account balance."]}),t.type==="withdrawal"&&e.jsxs(e.Fragment,{children:["This will ",e.jsx("strong",{children:"subtract"})," money from the account balance."]}),t.type==="adjustment"&&e.jsx(e.Fragment,{children:"Use this to correct balance discrepancies or make adjustments."})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:a,disabled:d,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:d,className:`flex-1 px-4 py-3 bg-gradient-to-r ${g()} text-white rounded-lg hover:opacity-90 transition-all font-medium flex items-center justify-center gap-2 disabled:opacity-50`,children:[e.jsx(es,{size:16}),d?"Recording...":"Record Transaction"]})]})]})]})})},Hs=({transaction:m,accountName:a,accountCurrency:n,onClose:t,onSuccess:o})=>{const[d,c]=N.useState(""),[p,j]=N.useState(!1),g=C=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:n||"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(C),h=C=>new Date(C).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),x=C=>({payment_received:"Payment Received",expense:"Expense",transfer_in:"Transfer In",transfer_out:"Transfer Out",adjustment:"Adjustment"})[C]||C,f=async()=>{if(!d||d.trim()===""){S.error("Please provide a reason for reversal");return}if(confirm("Are you sure you want to reverse this transaction? This action cannot be undone.")){j(!0);try{const{data:C,error:v}=await P.from("finance_accounts").select("balance").eq("id",m.account_id).single();if(v)throw v;const U=Number(C.balance)||0,l=m.transaction_type==="payment_received"||m.transaction_type==="transfer_in",A=m.amount,G=l?U-A:U+A;if(G<0){S.error("Reversal would result in negative balance. Cannot proceed."),j(!1);return}const{error:se}=await P.from("finance_accounts").update({balance:G,updated_at:new Date().toISOString()}).eq("id",m.account_id);if(se)throw se;const H=l?"expense":"payment_received",{error:ee}=await P.from("account_transactions").insert({account_id:m.account_id,transaction_type:"reversal",amount:A,balance_before:U,balance_after:G,description:`REVERSAL: ${m.description||x(m.transaction_type)}`,reference_number:`REV-${m.reference_number||m.id.substring(0,8)}`,related_entity_type:"transaction_reversal",related_entity_id:m.id,metadata:{reversal:!0,original_transaction_id:m.id,original_type:m.transaction_type,original_amount:m.amount,original_date:m.created_at,original_reference:m.reference_number,reversal_reason:d,reversed_at:new Date().toISOString()},created_at:new Date().toISOString()});if(ee)throw ee;const k=m.metadata||{},{error:R}=await P.from("account_transactions").update({metadata:{...k,reversed:!0,reversed_at:new Date().toISOString(),reversal_reason:d},updated_at:new Date().toISOString()}).eq("id",m.id);R&&console.warn("Failed to mark original transaction as reversed:",R),S.success("Transaction reversed successfully"),o(),t()}catch(C){console.error("Error reversing transaction:",C),S.error(C.message||"Failed to reverse transaction")}finally{j(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{size:24}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Reverse Transaction"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"This action will create a reversal entry"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-all",disabled:p,children:e.jsx(de,{size:20})})]})}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"text-orange-600 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-orange-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Important:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"This will create a reversal transaction"}),e.jsx("li",{children:"The account balance will be adjusted"}),e.jsx("li",{children:"Original transaction will be marked as reversed"}),e.jsx("li",{children:"This action cannot be undone"})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Transaction to Reverse:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Account"}),e.jsx("div",{className:"font-medium text-gray-900",children:a})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Date"}),e.jsx("div",{className:"font-medium text-gray-900",children:h(m.created_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Type"}),e.jsx("div",{className:"font-medium text-gray-900",children:x(m.transaction_type)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Amount"}),e.jsx("div",{className:"font-medium text-gray-900",children:g(m.amount)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Description"}),e.jsx("div",{className:"font-medium text-gray-900",children:m.description||"No description"})]}),m.reference_number&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Reference"}),e.jsx("div",{className:"font-medium text-gray-900",children:m.reference_number})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Impact of Reversal:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Original Transaction:"}),e.jsxs("span",{className:"font-bold text-blue-900",children:[m.transaction_type==="payment_received"||m.transaction_type==="transfer_in"?"+":"-",g(m.amount)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Reversal Effect:"}),e.jsxs("span",{className:"font-bold text-blue-900",children:[m.transaction_type==="payment_received"||m.transaction_type==="transfer_in"?"-":"+",g(m.amount)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason for Reversal ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:d,onChange:C=>c(C.target.value),placeholder:"e.g., Duplicate entry, Error in amount, Wrong account...",required:!0,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500/30 focus:border-orange-500 resize-none",disabled:p}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will be recorded in the reversal transaction"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:t,disabled:p,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:f,disabled:p||!d.trim(),className:"flex-1 px-4 py-3 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white rounded-lg transition-all font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(Xt,{size:16}),p?"Reversing...":"Reverse Transaction"]})]})]})]})})},Vs=({isOpen:m,onClose:a,transaction:n})=>{var R;const[t,o]=N.useState(null),[d,c]=N.useState(null),[p,j]=N.useState(null),[g,h]=N.useState([]),[x,f]=N.useState(null);N.useEffect(()=>(m?(document.body.style.overflow="hidden",C(),n!=null&&n.account_id&&v(n.account_id),n!=null&&n.sale_id&&U(n.sale_id)):(document.body.style.overflow="",o(null),c(null),j(null),h([]),f(null)),()=>{document.body.style.overflow=""}),[m,n]);const C=async()=>{try{const{data:b,error:$}=await P.from("payment_methods").select("*").eq("is_active",!0).order("name",{ascending:!0});if($)throw $;h(b||[])}catch(b){console.error("Error fetching payment methods:",b)}},v=async b=>{try{const{data:$,error:i}=await P.from("finance_accounts").select("name").eq("id",b).single();if(i)throw i;$&&f($.name)}catch($){console.error("Error fetching account name:",$),f(null)}},U=async b=>{try{c(null);const{data:$,error:i}=await P.from("lats_sales").select(`
          *,
          lats_sale_items (
            *,
            lats_products (*),
            lats_product_variants (*)
          ),
          customers (*)
        `).eq("id",b).single();if(i)throw i;if(!$){c("Sale not found");return}if(o($),$.cashier_id){const{data:y,error:T}=await P.from("users").select("full_name, email").eq("id",$.cashier_id).single();!T&&y&&j(y.full_name||y.email||"Unknown")}}catch($){console.error("Error fetching sale details:",$),c($.message||"Failed to fetch sale details")}},l=b=>{const $=Number(b);return!isFinite($)||isNaN($)?new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(0):new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format($)},A=b=>new Date(b).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),G=b=>{if(!b)return"Unknown";const $=g.find(i=>{var y;return i.code===b||((y=i.code)==null?void 0:y.toLowerCase())===(b==null?void 0:b.toLowerCase())});return $?$.name:b.charAt(0).toUpperCase()+b.slice(1).replace(/_/g," ")},se=b=>{var $;if(!b)return"Unknown";if(typeof b=="string")try{const i=JSON.parse(b);return se(i)}catch{return G(b)}if(typeof b=="object"){if(($=b.details)!=null&&$.payments&&Array.isArray(b.details.payments))return b.details.payments.map(T=>{const Q=T.method||T.paymentMethod||T.code;return G(Q)}).join(", ");const i=b.method||b.paymentMethod||b.code||b.type;return G(i)}return"Unknown"},H=()=>{var y;if(!n)return"Unknown";if((y=n.metadata)!=null&&y.payment_method)return G(n.metadata.payment_method);const b=n.description||"",$=b.match(/\(([^)]+)\)/);if($&&$[1])return $[1];const i=["Cash","Card","Mobile Money","Bank Transfer","Credit","Debit"];for(const T of i)if(b.toLowerCase().includes(T.toLowerCase()))return T;return"Unknown"};if(!m||!n)return null;const ee=n.transaction_type==="payment_received"||n.transaction_type==="transfer_in",k=n.transaction_type==="expense"||n.transaction_type==="payment_made"||n.transaction_type==="transfer_out";return fs.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:b=>{b.target===b.currentTarget&&a()},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 w-10 h-10 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50","aria-label":"Close modal",children:e.jsx(de,{className:"w-6 h-6"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(bt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:t?`Sale ${t.sale_number||((R=t.id)==null?void 0:R.slice(0,8))}`:"Transaction Details"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium capitalize",children:n.transaction_type.replace(/_/g," ")})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-4 space-y-4",children:[d&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl flex items-center gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:d})]}),t?e.jsxs(e.Fragment,{children:[t.customers&&e.jsx("div",{className:"bg-white rounded-xl p-6 mb-4 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Customer:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:t.customers.name||(t.customer_id?`Customer: ${t.customer_id.slice(0,8)}...`:"Walk-in Customer")})]}),(t.customers.phone||t.customers.whatsapp)&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Phone:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:t.customers.phone||t.customers.whatsapp})]}),t.customers.email&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Email:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:t.customers.email})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-bold uppercase px-3 py-1.5 rounded-lg text-xs ${t.payment_status==="completed"||t.status==="completed"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:t.payment_status==="completed"||t.status==="completed"?"Completed":"Pending"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Created:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:A(n.created_at).split(",")[0]})]})]})}),t&&e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-green-600"}),"Financial Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Total Amount"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:l(t.total_amount)})]}),t.subtotal&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Subtotal"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:l(t.subtotal)})]}),t.discount>0&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-xl border border-orange-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Discount"}),e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:["-",l(t.discount)]})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-xl border border-green-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Payment Method"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:se(t.payment_method)})]})]})]}),t&&t.lats_sale_items&&t.lats_sale_items.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(dt,{className:"w-5 h-5 text-purple-600"}),"Sale Items"]}),e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-purple-50 border border-purple-200 rounded-lg",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-700",children:[t.lats_sale_items.length," items"]})})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-1",children:t.lats_sale_items.map((b,$)=>{var y,T;const i=b.unit_price||b.price||b.total_price/b.quantity;return e.jsx("div",{className:"group relative p-5 rounded-2xl border-2 transition-all duration-200 bg-white border-gray-200 shadow-sm hover:shadow-md hover:border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"relative flex-shrink-0 w-14 h-14 rounded-full flex items-center justify-center font-bold text-lg shadow-lg bg-gradient-to-br from-blue-500 to-blue-600 text-white",children:$+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:"text-base font-bold text-gray-900",children:((y=b.lats_products)==null?void 0:y.name)||b.product_name||"Unknown Product"})}),((T=b.lats_product_variants)==null?void 0:T.name)&&b.lats_product_variants.name!=="Default Variant"&&e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["Variant: ",b.lats_product_variants.name]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-600",children:["Qty: ",b.quantity]}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"â€¢"}),e.jsxs("span",{className:"text-xs font-medium text-gray-600",children:["Unit: ",l(i)]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 text-right ml-4",children:e.jsx("div",{className:"text-2xl font-bold mb-1 text-gray-900",children:l(b.total_price)})})]})},b.id)})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-xl p-6 mb-4 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Transaction Type:"}),e.jsx("span",{className:"text-base font-bold text-gray-900 capitalize",children:n.transaction_type.replace(/_/g," ")})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Transaction ID:"}),e.jsx("span",{className:"text-base font-bold text-gray-900 font-mono text-xs",children:n.id})]}),x&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Account:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:x})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Date & Time:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:A(n.created_at)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Payment Method:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:H()})]}),n.description&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Description:"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:n.description})]}),n.reference_number&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Reference:"}),e.jsx("span",{className:"text-base font-bold text-gray-900 font-mono",children:n.reference_number})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-green-600"}),"Financial Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-xl border border-green-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Amount"}),e.jsxs("p",{className:`text-xl font-bold ${ee?"text-green-600":k?"text-red-600":"text-gray-900"}`,children:[ee&&"+",k&&"-",l(n.amount)]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Balance Before"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:l(n.balance_before)})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Balance After"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:l(n.balance_after)})]})]})]})]})]})}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsx("button",{type:"button",onClick:a,className:"w-full px-6 py-3.5 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-all shadow-lg hover:shadow-xl text-lg",children:"Close"})})]})}),document.body)},ke=m=>new Date(m).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),ct=m=>new Date(m).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),Re=(m,a="TZS")=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:0}).format(m),ls=m=>({payment_received:"Payment Received",expense:"Expense",transfer_in:"Transfer In",transfer_out:"Transfer Out",adjustment:"Adjustment"})[m]||m,Ys=(m,a)=>{const n=["Date","Time","Type","Description","Reference","Amount","Balance Before","Balance After"],t=m.map(g=>[ke(g.created_at),ct(g.created_at),ls(g.transaction_type),g.description||"",g.reference_number||"",g.amount.toFixed(2),g.balance_before.toFixed(2),g.balance_after.toFixed(2)]);let o="data:text/csv;charset=utf-8,";o+=`"${a.accountName} - Transaction History"
`,o+=`"Currency: ${a.currency}"
`,a.dateRange&&(o+=`"Period: ${ke(a.dateRange.start)} to ${ke(a.dateRange.end)}"
`),o+=`"Generated: ${ke(new Date().toISOString())} at ${ct(new Date().toISOString())}"
`,o+=`
`,o+=n.map(g=>`"${g}"`).join(",")+`
`,t.forEach(g=>{o+=g.map(h=>`"${h}"`).join(",")+`
`});const d=m.filter(g=>g.transaction_type==="payment_received"||g.transaction_type==="transfer_in").reduce((g,h)=>g+h.amount,0),c=m.filter(g=>g.transaction_type==="expense"||g.transaction_type==="transfer_out").reduce((g,h)=>g+h.amount,0);o+=`
`,o+=`"Summary:"
`,o+=`"Total Transactions:","${m.length}"
`,o+=`"Total Received:","${Re(d,a.currency)}"
`,o+=`"Total Spent:","${Re(c,a.currency)}"
`,o+=`"Net Change:","${Re(d-c,a.currency)}"
`;const p=encodeURI(o),j=document.createElement("a");j.setAttribute("href",p),j.setAttribute("download",`${a.accountName.replace(/\s+/g,"_")}_Transactions_${ke(new Date().toISOString()).replace(/\//g,"-")}.csv`),document.body.appendChild(j),j.click(),document.body.removeChild(j)},Ws=(m,a)=>{const n=window.open("","_blank");if(!n){alert("Please allow popups to export PDF");return}const t=m.filter(c=>c.transaction_type==="payment_received"||c.transaction_type==="transfer_in").reduce((c,p)=>c+p.amount,0),o=m.filter(c=>c.transaction_type==="expense"||c.transaction_type==="transfer_out").reduce((c,p)=>c+p.amount,0),d=`
    <!DOCTYPE html>
    <html>
    <head>
      <title>${a.accountName} - Transaction History</title>
      <style>
        @media print {
          @page {
            margin: 20mm;
          }
        }
        body {
          font-family: Arial, sans-serif;
          padding: 20px;
          color: #333;
        }
        .header {
          text-align: center;
          margin-bottom: 30px;
          border-bottom: 2px solid #2563eb;
          padding-bottom: 15px;
        }
        .header h1 {
          margin: 0;
          color: #1e40af;
          font-size: 24px;
        }
        .header p {
          margin: 5px 0;
          color: #666;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin: 20px 0;
          font-size: 12px;
        }
        th {
          background-color: #2563eb;
          color: white;
          padding: 10px;
          text-align: left;
          font-weight: 600;
        }
        td {
          padding: 8px;
          border-bottom: 1px solid #e5e7eb;
        }
        tr:nth-child(even) {
          background-color: #f9fafb;
        }
        .amount-in {
          color: #059669;
          font-weight: 600;
        }
        .amount-out {
          color: #dc2626;
          font-weight: 600;
        }
        .summary {
          margin-top: 30px;
          padding: 15px;
          background-color: #f3f4f6;
          border-radius: 8px;
        }
        .summary-row {
          display: flex;
          justify-content: space-between;
          padding: 8px 0;
          font-size: 14px;
        }
        .summary-row.total {
          border-top: 2px solid #2563eb;
          margin-top: 10px;
          padding-top: 15px;
          font-weight: bold;
          font-size: 16px;
        }
        .footer {
          margin-top: 30px;
          text-align: center;
          color: #6b7280;
          font-size: 11px;
          border-top: 1px solid #e5e7eb;
          padding-top: 15px;
        }
      </style>
    </head>
    <body>
      <div class="header">
        <h1>${a.accountName}</h1>
        <p><strong>Transaction History</strong></p>
        <p>Currency: ${a.currency}</p>
        ${a.dateRange?`<p>Period: ${ke(a.dateRange.start)} to ${ke(a.dateRange.end)}</p>`:""}
        <p>Generated: ${ke(new Date().toISOString())} at ${ct(new Date().toISOString())}</p>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width: 10%">Date</th>
            <th style="width: 8%">Time</th>
            <th style="width: 15%">Type</th>
            <th style="width: 30%">Description</th>
            <th style="width: 12%">Reference</th>
            <th style="width: 12%; text-align: right">Amount</th>
            <th style="width: 13%; text-align: right">Balance After</th>
          </tr>
        </thead>
        <tbody>
          ${m.map(c=>{const p=c.transaction_type==="payment_received"||c.transaction_type==="transfer_in",j=c.transaction_type==="expense"||c.transaction_type==="transfer_out";return`
              <tr>
                <td>${ke(c.created_at)}</td>
                <td>${ct(c.created_at)}</td>
                <td>${ls(c.transaction_type)}</td>
                <td>${c.description||"-"}</td>
                <td>${c.reference_number||"-"}</td>
                <td class="${p?"amount-in":j?"amount-out":""}" style="text-align: right">
                  ${p?"+":j?"-":""}${Re(c.amount,a.currency)}
                </td>
                <td style="text-align: right">${Re(c.balance_after,a.currency)}</td>
              </tr>
            `}).join("")}
        </tbody>
      </table>

      <div class="summary">
        <h3 style="margin-top: 0; color: #1e40af;">Summary</h3>
        <div class="summary-row">
          <span>Total Transactions:</span>
          <span><strong>${m.length}</strong></span>
        </div>
        <div class="summary-row">
          <span>Total Received:</span>
          <span style="color: #059669"><strong>${Re(t,a.currency)}</strong></span>
        </div>
        <div class="summary-row">
          <span>Total Spent:</span>
          <span style="color: #dc2626"><strong>${Re(o,a.currency)}</strong></span>
        </div>
        <div class="summary-row total">
          <span>Net Change:</span>
          <span style="color: ${t-o>=0?"#059669":"#dc2626"}">
            <strong>${Re(t-o,a.currency)}</strong>
          </span>
        </div>
      </div>

      <div class="footer">
        <p>This is a computer-generated document. No signature is required.</p>
        <p>Â© ${new Date().getFullYear()} ${a.accountName}</p>
      </div>

      <script>
        window.onload = function() {
          window.print();
          // Close after printing (commented out for user convenience)
          // setTimeout(() => window.close(), 100);
        };
      <\/script>
    </body>
    </html>
  `;n.document.write(d),n.document.close()},Qs=ge,Xs=()=>{const{currentUser:m}=wt(),{refreshPaymentMethods:a}=gs(),[n,t]=N.useState([]),[o,d]=N.useState(!0),[c,p]=N.useState(!1),[j,g]=N.useState(null),[h,x]=N.useState("all"),[f,C]=N.useState(!1),[v,U]=N.useState(null),[l,A]=N.useState([]),[G,se]=N.useState(!1),[H,ee]=N.useState("all"),[k,R]=N.useState({start:"",end:""}),[b,$]=N.useState(""),[i,y]=N.useState(!1),[T,Q]=N.useState(null),[X,ie]=N.useState({}),[fe,De]=N.useState({}),[be,Ee]=N.useState("timeline"),[u,L]=N.useState({}),q=N.useRef({}),[z,Z]=N.useState(!1),[D,I]=N.useState(null),[re,V]=N.useState(!1),[s,_]=N.useState(!1),[J,te]=N.useState(null),[je,ve]=N.useState(null),[Me,mt]=N.useState(!1),[E,Oe]=N.useState({name:"",type:"cash",balance:0,currency:"TZS",is_active:!0,is_payment_method:!0,requires_reference:!1,requires_account_number:!1}),Ve=r=>({payment_received:"received",payment_made:"paid",transfer_in:"transfer in",transfer_out:"transfer out"})[r]||r.replace(/_/g," "),le=(r,w="TZS")=>{const B=Number(r);return!isFinite(B)||isNaN(B)?new Intl.NumberFormat("en-TZ",{style:"currency",currency:w||"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(0):new Intl.NumberFormat("en-TZ",{style:"currency",currency:w||"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(B)},Ne=lt.useMemo(()=>{console.log(`ðŸ” [filteredAccounts] Filtering ${n.length} accounts, currency filter: ${h}`);const r=h==="all"?n:n.filter(w=>w.currency===h);return console.log(`âœ… [filteredAccounts] Result: ${r.length} accounts after filtering`),r.length>0&&console.log("   Accounts:",r.map(w=>w.name)),r},[n,h]),ut=lt.useMemo(()=>{const r=Ne.length,w=Ne.filter(M=>M.is_active).length,B=Ne.reduce((M,K)=>{const ue=Number(K.balance);return M+(isNaN(ue)?0:ue)},0),F=Ne.reduce((M,K)=>{const ue=Number(K.totalReceived);return M+(isNaN(ue)?0:ue)},0),O=Ne.reduce((M,K)=>{const ue=Number(K.totalSpent);return M+(isNaN(ue)?0:ue)},0),W=Ne.reduce((M,K)=>(M[K.type]=(M[K.type]||0)+1,M),{});return{totalAccounts:r,activeAccounts:w,totalBalance:B,totalReceived:F,totalSpent:O,netFlow:F-O,accountTypes:W}},[Ne]),xt=async(r,w,B)=>{const F=st();return!F||B||w===F?r:r.or(`branch_id.eq.${F},branch_id.is.null`)},Ae=N.useCallback(async()=>{d(!0);try{console.log("ðŸ”„ Fetching payment accounts...");const r=st();console.log("ðŸ“ Current branch ID:",r||"none");const w=await nt.getPaymentMethods();console.log(`âœ… Fetched ${w.length} payment accounts:`,w.map(F=>({name:F.name,branch_id:F.branch_id,is_shared:F.is_shared})));const B=await Promise.all(w.map(async F=>{let O=P.from("account_transactions").select("*").eq("account_id",F.id).order("created_at",{ascending:!1}).limit(5);O=await xt(O,F.branch_id||null,F.is_shared||!1);const{data:W}=await O;let M=P.from("account_transactions").select("transaction_type, amount").eq("account_id",F.id);M=await xt(M,F.branch_id||null,F.is_shared||!1);const{data:K}=await M,ue=(K==null?void 0:K.filter(he=>he.transaction_type==="payment_received"||he.transaction_type==="transfer_in").reduce((he,we)=>he+Number(we.amount),0))||0,gt=(K==null?void 0:K.filter(he=>he.transaction_type==="payment_made"||he.transaction_type==="expense"||he.transaction_type==="transfer_out").reduce((he,we)=>he+Number(we.amount),0))||0,Be=Number(F.balance)||0;return{...F,balance:Be,recentTransactions:W||[],totalReceived:ue,totalSpent:gt}}));console.log(`âœ… Setting ${B.length} accounts in state`),console.log("ðŸ“‹ Accounts being set:",B.map(F=>({id:F.id,name:F.name,branch_id:F.branch_id}))),t([...B]),setTimeout(()=>{console.log("ðŸ” State verification - accounts count:",B.length)},100)}catch(r){console.error("âŒ Error fetching accounts:",r),S.error("Failed to load payment accounts")}finally{d(!1)}},[]),ht=N.useCallback(async()=>{console.log("ðŸ”„ handleAccountChange called - refreshing accounts...");const w=`payment-methods-${st()||"all"}`;at(w),at("payment-methods-all"),await Vt.invalidateCache("payment_accounts"),console.log("ðŸ—‘ï¸ Cleared all caches"),a&&await a(),await Ae(),console.log("âœ… handleAccountChange completed")},[a,Ae]);N.useEffect(()=>{Ae()},[Ae]);const me=(r,w)=>{Oe(B=>({...B,[r]:w}))},is=async()=>{if(!E.name||E.name.trim()===""){S.error("Account name is required");return}if(!E.type){S.error("Account type is required");return}if(!E.currency){S.error("Currency is required");return}if(E.type==="bank"&&!E.bank_name){S.error("Bank name is required for bank accounts");return}if(E.type==="mobile_money"&&!E.bank_name){S.error("Mobile money provider is required");return}if(E.balance&&E.balance<0){S.error("Balance cannot be negative");return}try{if(j){const{error:r}=await P.from("finance_accounts").update({name:E.name,type:E.type,balance:E.balance,currency:E.currency,is_active:E.is_active,is_payment_method:E.is_payment_method,requires_reference:E.requires_reference,requires_account_number:E.requires_account_number,account_number:E.account_number,bank_name:E.bank_name,notes:E.notes}).eq("id",j.id);if(r)throw r;S.success("Account updated successfully")}else{console.log("ðŸ“ Creating new account with data:",E);const r=await ps("finance_accounts",{name:E.name,type:E.type,balance:E.balance||0,currency:E.currency||"TZS",is_active:E.is_active,is_payment_method:E.is_payment_method,requires_reference:E.requires_reference,requires_account_number:E.requires_account_number,account_number:E.account_number,bank_name:E.bank_name,notes:E.notes},"accounts");if(console.log("âœ… Account created successfully:",{id:r==null?void 0:r.id,name:r==null?void 0:r.name,branch_id:r==null?void 0:r.branch_id,is_shared:r==null?void 0:r.is_shared}),!r)throw new Error("Account creation returned no data");S.success("Account created successfully");const B=`payment-methods-${st()||"all"}`;if(at(B),at("payment-methods-all"),await Vt.invalidateCache("payment_accounts"),console.log("ðŸ—‘ï¸ Cleared payment methods cache for:",B),r&&r.is_payment_method){console.log("âž• Manually adding new account to state as fallback");const F={...r,recentTransactions:[],totalReceived:0,totalSpent:0};t(O=>{if(O.some(K=>K.id===r.id))return console.log("âš ï¸ Account already in state, updating instead"),O.map(K=>K.id===r.id?F:K);console.log("âž• Adding new account to state:",r.name);const M=[...O,F];return console.log(`âœ… State updated: ${O.length} -> ${M.length} accounts`),M})}}p(!1),g(null),Oe({name:"",type:"cash",balance:0,currency:"TZS",is_active:!0,is_payment_method:!0,requires_reference:!1,requires_account_number:!1}),console.log("ðŸ”„ Forcing immediate account refresh..."),await ht(),setTimeout(async()=>{console.log("ðŸ”„ Delayed refresh (200ms)..."),await ht()},200)}catch(r){console.error("Error saving account:",r),S.error(r.message||"Failed to save account")}},os=async r=>{if(confirm("Are you sure you want to delete this account?"))try{const{error:w}=await P.from("finance_accounts").delete().eq("id",r);if(w)throw w;S.success("Account deleted successfully"),await ht()}catch(w){console.error("Error deleting account:",w),S.error(w.message||"Failed to delete account")}},cs=r=>{g(r),Oe(r),p(!0)},Ct=()=>{g(null),Oe({name:"",type:"cash",balance:0,currency:"TZS",is_active:!0,is_payment_method:!0,requires_reference:!1,requires_account_number:!1}),p(!0)},Tt=async r=>{se(!0);try{console.log("ðŸ”„ Loading transactions for account:",r);const{data:w,error:B}=await P.from("finance_accounts").select("id, branch_id, is_shared").eq("id",r).single();if(B)throw console.error("âŒ Error fetching account:",B),B;console.log("ðŸ“‹ Account data:",{accountId:r,branch_id:w==null?void 0:w.branch_id,is_shared:w==null?void 0:w.is_shared});let F=P.from("account_transactions").select("*").eq("account_id",r).order("created_at",{ascending:!1});F=await xt(F,(w==null?void 0:w.branch_id)||null,(w==null?void 0:w.is_shared)||!1);const{data:O,error:W}=await F;if(W)throw console.error("âŒ Error loading transactions:",W),W;if(console.log(`âœ… Loaded ${(O==null?void 0:O.length)||0} transactions for account ${r}`),O&&O.length>0)console.log("ðŸ“‹ Sample transactions:",O.slice(0,3).map(M=>({id:M.id,type:M.transaction_type,amount:M.amount,branch_id:M.branch_id,created_at:M.created_at})));else{console.log("âš ï¸ No transactions found. Checking if transactions exist in database...");const{data:M}=await P.from("account_transactions").select("id, transaction_type, amount, branch_id, created_at").eq("account_id",r).limit(5);console.log(`ðŸ” Total transactions in DB (no branch filter): ${(M==null?void 0:M.length)||0}`),M&&M.length>0&&console.log("ðŸ“‹ Sample transactions from DB:",M)}A(O||[])}catch(w){console.error("âŒ Error loading account transactions:",w),S.error("Failed to load transaction history"),A([])}finally{se(!1)}},ds=async r=>{U(r),C(!0),ee("all"),await Tt(r.id)};return o?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading payment accounts..."})]}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col max-h-[95vh]",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Le,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Payment Accounts"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Track balances and manage your payment methods"})]})]})})}),e.jsx("div",{className:"px-8 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100/50 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:Ct,className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg hover:from-blue-600 hover:to-blue-700 hover:shadow-xl",children:[e.jsx($e,{size:18}),e.jsx("span",{children:"Add Account"})]}),e.jsxs("button",{onClick:()=>V(!0),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg hover:from-purple-600 hover:to-purple-700 hover:shadow-xl",children:[e.jsx(tt,{size:18}),e.jsx("span",{children:"Transfer"})]}),e.jsxs("button",{onClick:async()=>{console.log("ðŸ”„ Manual refresh triggered"),d(!0),await Ae(),d(!1)},disabled:o,className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 border-2 border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-blue-300 disabled:opacity-50 bg-white shadow-sm",children:[o?e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}):e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Refresh"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"p-6 pb-0 flex-shrink-0 border-t border-gray-100 bg-white",children:e.jsx("div",{className:"bg-white rounded-2xl border-2 border-gray-200 p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(rt,{size:18,className:"text-gray-400"}),e.jsxs("select",{value:h,onChange:r=>x(r.target.value),className:"px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all text-gray-900 bg-white font-medium min-w-[200px]",children:[e.jsx("option",{value:"all",children:"All Currencies"}),e.jsx("option",{value:"TZS",children:"Tanzanian Shilling (TZS)"}),e.jsx("option",{value:"USD",children:"US Dollar (USD)"}),e.jsx("option",{value:"EUR",children:"Euro (EUR)"}),e.jsx("option",{value:"GBP",children:"British Pound (GBP)"})]})]}),h!=="all"&&e.jsxs("button",{onClick:()=>x("all"),className:"text-sm text-blue-600 hover:text-blue-700 font-semibold flex items-center gap-2 px-4 py-2",children:[e.jsx(de,{size:14}),"Clear Filter"]})]})})}),e.jsx("div",{className:"p-6 pb-0 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-2xl p-5 hover:bg-blue-100 hover:border-blue-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Total Accounts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ut.totalAccounts})]})]})}),e.jsx("div",{className:"bg-green-50 border-2 border-green-200 rounded-2xl p-5 hover:bg-green-100 hover:border-green-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(pe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Total Balance"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:le(ut.totalBalance,h!=="all"?h:"TZS")})]})]})}),e.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-5 hover:bg-orange-100 hover:border-orange-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Ss,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Net Flow"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:le(ut.netFlow,h!=="all"?h:"TZS")})]})]})})]})}),e.jsx("div",{className:"p-6",children:Ne.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50 rounded-2xl p-16 text-center border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl",children:e.jsx(Le,{className:"w-12 h-12 text-white"})}),e.jsx("p",{className:"text-gray-800 text-xl font-bold mb-2",children:"No Payment Accounts"}),e.jsx("p",{className:"text-gray-500 text-sm mb-6",children:n.length===0?"You haven't created any payment accounts yet. Create your first account to get started.":`No accounts found for currency filter: ${h}. Try changing the filter.`}),e.jsxs("button",{onClick:Ct,className:"px-8 py-3.5 rounded-xl font-semibold bg-gradient-to-r from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl inline-flex items-center gap-2",children:[e.jsx($e,{size:20}),"Create First Account"]}),n.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Debug Info:"}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Total accounts in state: ",n.length]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Filtered accounts: ",Ne.length]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Currency filter: ",h]})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ne.map(r=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-xl hover:border-gray-300 transition-all group",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yt,{type:r.type,size:"md"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500 capitalize flex items-center gap-1 mt-0.5",children:[r.type==="cash"&&e.jsx(pe,{className:"w-3 h-3"}),r.type==="bank"&&e.jsx(Ue,{className:"w-3 h-3"}),r.type==="mobile_money"&&e.jsx(Jt,{className:"w-3 h-3"}),r.type==="credit_card"&&e.jsx(Se,{className:"w-3 h-3"}),r.type.replace("_"," ")]}),r.bank_name&&e.jsx("p",{className:"text-xs text-gray-600 font-medium mt-1",children:r.bank_name})]})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),I(r),Z(!0)},className:"p-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg transition-all shadow-sm",title:"Add transaction",children:e.jsx($e,{size:14})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),cs(r)},className:"p-2 bg-white hover:bg-gray-100 text-gray-600 hover:text-gray-900 rounded-lg transition-all border border-gray-200 shadow-sm",title:"Edit account",children:e.jsx(ts,{size:14})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),os(r.id)},className:"p-2 bg-white hover:bg-red-50 text-gray-600 hover:text-red-600 rounded-lg transition-all border border-gray-200 shadow-sm",title:"Delete account",children:e.jsx(St,{size:14})})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wide mb-1",children:"Current Balance"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:le(r.balance,r.currency)}),r.currency!=="TZS"&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Currency: ",r.currency]}),r.account_number&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded inline-flex",children:[e.jsx("span",{className:"font-medium",children:"Account #:"}),e.jsx("span",{className:"font-mono",children:r.account_number})]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl p-4 border border-emerald-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-700 mb-1",children:[e.jsx(yt,{size:14}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Received"})]}),e.jsx("div",{className:"text-base font-bold text-emerald-900",children:le(r.totalReceived,r.currency)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-red-700 mb-1",children:[e.jsx(ot,{size:14}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Spent"})]}),e.jsx("div",{className:"text-base font-bold text-red-900",children:le(r.totalSpent,r.currency)})]})]}),r.recentTransactions.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-2",children:r.recentTransactions.slice(0,2).map(w=>{const B=w.transaction_type==="payment_received"||w.transaction_type==="transfer_in";return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors border border-gray-100",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-900 font-medium truncate",children:w.description}),e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:new Date(w.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:`text-sm font-bold ml-3 ${B?"text-emerald-600":"text-red-600"}`,children:[B?"+":"-",le(w.amount,r.currency)]})]},w.id)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium ${r.is_active?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:[r.is_active?e.jsx(ce,{size:12}):e.jsx(ss,{size:12}),r.is_active?"Active":"Inactive"]})}),r.is_payment_method&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-700 bg-blue-100 px-3 py-1.5 rounded-lg font-medium",children:[e.jsx(Se,{size:12}),"Payment Method"]})]}),e.jsxs("button",{onClick:w=>{w.stopPropagation(),ds(r)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl transition-all font-semibold text-sm shadow-lg shadow-blue-500/30 hover:shadow-xl",children:[e.jsx(Xe,{size:16}),"View Full History"]})]})]})]},r.id))})})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Le,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:j?"Edit Account":"Add New Account"}),e.jsx("p",{className:"text-sm text-gray-600",children:j?"Update account details":"Create a new payment account"})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(de,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yt,{type:E.type||"cash",size:"sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:E.name||"Account Name"}),e.jsx("div",{className:"text-xs text-blue-600 capitalize",children:(E.type||"cash").replace("_"," ")}),E.account_number&&e.jsxs("div",{className:"text-xs text-blue-700 font-mono mt-0.5",children:["#",E.account_number]})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Account Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(xe,{value:E.name||"",onChange:r=>me("name",r.target.value),placeholder:"e.g., Cash Drawer, CRDB Bank",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Account Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:E.type||"cash",onChange:r=>me("type",r.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 bg-white/80 backdrop-blur-sm text-sm font-medium transition-all",children:[e.jsx("option",{value:"cash",children:"ðŸ’° Cash"}),e.jsx("option",{value:"bank",children:"ðŸ¦ Bank"}),e.jsx("option",{value:"mobile_money",children:"ðŸ“± Mobile Money"}),e.jsx("option",{value:"credit_card",children:"ðŸ’³ Credit Card"}),e.jsx("option",{value:"savings",children:"ðŸ’Ž Savings"}),e.jsx("option",{value:"other",children:"ðŸ“¦ Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Currency ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:E.currency||"TZS",onChange:r=>me("currency",r.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 bg-white/80 backdrop-blur-sm text-sm font-medium transition-all",children:[e.jsx("option",{value:"TZS",children:"ðŸ‡¹ðŸ‡¿ TZS - Tanzanian Shilling"}),e.jsx("option",{value:"USD",children:"ðŸ‡ºðŸ‡¸ USD - US Dollar"}),e.jsx("option",{value:"EUR",children:"ðŸ‡ªðŸ‡º EUR - Euro"}),e.jsx("option",{value:"GBP",children:"ðŸ‡¬ðŸ‡§ GBP - British Pound"}),e.jsx("option",{value:"KES",children:"ðŸ‡°ðŸ‡ª KES - Kenyan Shilling"}),e.jsx("option",{value:"UGX",children:"ðŸ‡ºðŸ‡¬ UGX - Ugandan Shilling"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Balance"}),e.jsx(xe,{type:"number",value:E.balance||0,onChange:r=>me("balance",Number(r.target.value)),placeholder:"0",step:"0.01",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Starting balance for this account (cannot be negative)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number"}),e.jsx(xe,{value:E.account_number||"",onChange:r=>me("account_number",r.target.value),placeholder:"Enter account number"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Account number, reference ID, or identifier for this account"})]}),E.type==="bank"&&e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Bank Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(xe,{value:E.bank_name||"",onChange:r=>me("bank_name",r.target.value),placeholder:"e.g., CRDB Bank, NMB Bank",required:!0})]})}),E.type==="mobile_money"&&e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Mobile Money Provider ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(xe,{value:E.bank_name||"",onChange:r=>me("bank_name",r.target.value),placeholder:"e.g., M-Pesa, Tigo Pesa, Airtel Money",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use the Account Number field above for the phone number"})]})}),E.type==="credit_card"&&e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Issuer"}),e.jsx(xe,{value:E.bank_name||"",onChange:r=>me("bank_name",r.target.value),placeholder:"e.g., Visa, Mastercard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use the Account Number field above for card details"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:E.notes||"",onChange:r=>me("notes",r.target.value),placeholder:"Optional notes or description",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 bg-white/50 backdrop-blur-sm text-sm",rows:3})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Account Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E.is_active||!1,onChange:r=>me("is_active",r.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active Account"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enable this account for transactions"})]})]})}),e.jsx("label",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E.is_payment_method||!1,onChange:r=>me("is_payment_method",r.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Payment Method"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow this account to be used for payments"})]})]})}),e.jsx("label",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E.requires_reference||!1,onChange:r=>me("requires_reference",r.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Require Reference Number"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Require reference/transaction number for payments"})]})]})}),e.jsx("label",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E.requires_account_number||!1,onChange:r=>me("requires_account_number",r.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Require Account Number"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Require account/phone number for payments"})]})]})})]})]})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 px-4 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium",children:"Cancel"}),e.jsxs("button",{onClick:is,className:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg transition-all font-medium flex items-center justify-center gap-2",children:[e.jsx(es,{size:16}),j?"Update Account":"Create Account"]})]})]})}),f&&v&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[999999]",style:{overflow:"hidden",overscrollBehavior:"none",position:"fixed",zIndex:999999},role:"dialog","aria-modal":"true","aria-labelledby":"transaction-history-modal-title",onClick:r=>{r.target===r.currentTarget&&C(!1)},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full max-h-[90vh] flex flex-col overflow-hidden relative z-[999999]",style:{zIndex:999999},onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:()=>C(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50","aria-label":"Close modal",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 pr-20 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Xe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"transaction-history-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Transaction History"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:v.name})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-indigo-600"}),"Account Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Initial Balance"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:le(v.initialBalance||0,v.currency)})]}),e.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[e.jsxs("p",{className:"text-xs font-medium text-emerald-700 mb-1 flex items-center gap-1.5",children:[e.jsx(yt,{size:14}),"Received"]}),e.jsx("p",{className:"text-xl font-bold text-emerald-900",children:le(v.totalReceived,v.currency)})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[e.jsxs("p",{className:"text-xs font-medium text-red-700 mb-1 flex items-center gap-1.5",children:[e.jsx(ot,{size:14}),"Spent"]}),e.jsx("p",{className:"text-xl font-bold text-red-900",children:le(v.totalSpent,v.currency)})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 mb-1",children:"Current Balance"}),e.jsx("p",{className:"text-xl font-bold text-blue-900",children:le(v.balance,v.currency)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0 max-w-lg",children:e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:b,onChange:r=>$(r.target.value),placeholder:"Search transactions by description, reference, amount...",className:"w-full pl-10 pr-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200"}),b&&e.jsx("button",{onClick:()=>$(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4 text-gray-400"})})]})}),e.jsxs("button",{onClick:()=>y(!i),className:`px-4 py-2.5 border-2 rounded-xl transition-all flex items-center gap-2 text-sm font-medium shadow-sm hover:shadow-md ${i?"bg-indigo-50 border-indigo-500 text-indigo-700 hover:border-indigo-400":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-indigo-400"}`,children:[e.jsx(rt,{className:"w-4 h-4"}),i?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Hide Filters"}),e.jsx(Cs,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Filters"}),e.jsx(Ts,{className:"w-4 h-4"})]})]})]}),i&&e.jsxs("div",{className:"pt-4 border-t border-gray-200 space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[e.jsx(rt,{className:"w-4 h-4 text-indigo-600"}),"Advanced Filters"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Transaction Type"}),e.jsxs("select",{value:H,onChange:r=>ee(r.target.value),className:"w-full px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-sm transition-all duration-200",children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"payment_received",children:"Money In"}),e.jsx("option",{value:"expense",children:"Expenses"}),e.jsx("option",{value:"payment_made",children:"Payments Made"}),e.jsx("option",{value:"transfer_in",children:"Transfers In"}),e.jsx("option",{value:"transfer_out",children:"Transfers Out"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Date From"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",value:k.start,onChange:r=>R({...k,start:r.target.value}),className:"w-full pl-10 pr-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-sm transition-all duration-200",placeholder:"Start date"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Date To"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",value:k.end,onChange:r=>R({...k,end:r.target.value}),className:"w-full pl-10 pr-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-sm transition-all duration-200",placeholder:"End date"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 pt-4 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-3",children:(k.start||k.end||b)&&e.jsxs("button",{onClick:()=>{R({start:"",end:""}),$(""),ee("all"),y(!1)},className:"px-5 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-all text-sm font-semibold shadow-sm flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"}),"Clear All"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{if(!v)return;const r=l.filter(w=>{var B,F;if(H!=="all"&&w.transaction_type!==H||k.start&&new Date(w.created_at)<new Date(k.start))return!1;if(k.end){const O=new Date(k.end);if(O.setHours(23,59,59,999),new Date(w.created_at)>O)return!1}if(b){const O=b.toLowerCase(),W=(B=w.description)==null?void 0:B.toLowerCase().includes(O),M=(F=w.reference_number)==null?void 0:F.toLowerCase().includes(O),K=le(w.amount,v.currency).toLowerCase().includes(O);if(!W&&!M&&!K)return!1}return!0});Ys(r,{accountName:v.name,currency:v.currency||"TZS",dateRange:k.start&&k.end?k:void 0}),S.success("CSV exported successfully")},className:"px-5 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-xl transition-all text-sm font-semibold shadow-lg hover:shadow-xl flex items-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4"}),"CSV"]}),e.jsxs("button",{onClick:()=>{if(!v)return;const r=l.filter(w=>{var B,F;if(H!=="all"&&w.transaction_type!==H||k.start&&new Date(w.created_at)<new Date(k.start))return!1;if(k.end){const O=new Date(k.end);if(O.setHours(23,59,59,999),new Date(w.created_at)>O)return!1}if(b){const O=b.toLowerCase(),W=(B=w.description)==null?void 0:B.toLowerCase().includes(O),M=(F=w.reference_number)==null?void 0:F.toLowerCase().includes(O),K=le(w.amount,v.currency).toLowerCase().includes(O);if(!W&&!M&&!K)return!1}return!0});Ws(r,{accountName:v.name,currency:v.currency||"TZS",dateRange:k.start&&k.end?k:void 0}),S.success("PDF opened in new window")},className:"px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-xl transition-all text-sm font-semibold shadow-lg hover:shadow-xl flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"PDF"]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-indigo-600"}),"Transactions",l.length>0&&e.jsx("div",{className:"flex items-center gap-2 px-4 py-2.5 bg-indigo-50 border border-indigo-200 rounded-xl",children:e.jsxs("span",{className:"text-sm font-semibold text-indigo-700",children:[l.length," transaction",l.length!==1?"s":""]})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>Ee("timeline"),className:`px-3 py-1.5 rounded-md transition-all flex items-center gap-2 ${be==="timeline"?"bg-white text-indigo-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:"Timeline View",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Timeline"})]}),e.jsxs("button",{onClick:()=>Ee("table"),className:`px-3 py-1.5 rounded-md transition-all flex items-center gap-2 ${be==="table"?"bg-white text-indigo-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:"Table View",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Table"})]})]})]}),e.jsx("div",{className:"space-y-3",children:G?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-500 border-t-transparent"}),e.jsx("span",{className:"mt-4 text-gray-600 font-medium",children:"Loading transactions..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 rounded-3xl mb-4",children:e.jsx(Xe,{size:36,className:"text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No transactions yet"}),e.jsx("p",{className:"text-gray-500",children:"This account has no transaction history."})]}):be==="timeline"?e.jsx("div",{className:"space-y-3 pr-1",children:l.filter(r=>{var w,B;if(H!=="all"&&r.transaction_type!==H||k.start&&new Date(r.created_at)<new Date(k.start))return!1;if(k.end){const F=new Date(k.end);if(F.setHours(23,59,59,999),new Date(r.created_at)>F)return!1}if(b){const F=b.toLowerCase(),O=(w=r.description)==null?void 0:w.toLowerCase().includes(F),W=(B=r.reference_number)==null?void 0:B.toLowerCase().includes(F),M=le(r.amount,(v==null?void 0:v.currency)||"TZS").toLowerCase().includes(F);if(!O&&!W&&!M)return!1}return!0}).map((r,w)=>{var Pt,Dt,Et,At,Rt,$t,Ft,Mt;const B=r.transaction_type==="income",F=r.transaction_type==="payment_received"||r.transaction_type==="transfer_in",O=r.transaction_type==="expense"||r.transaction_type==="payment_made"||r.transaction_type==="transfer_out",W=(Pt=r.metadata)==null?void 0:Pt.reversed,M=((Dt=r.metadata)==null?void 0:Dt.is_partial)||((Et=r.metadata)==null?void 0:Et.partial)||(((At=r.description)==null?void 0:At.toLowerCase().includes("partial"))??!1),K=T===r.id,ue=new Date(r.created_at),gt=ue.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Be=((Rt=r.description)==null?void 0:Rt.toLowerCase().includes("installment"))||(($t=r.metadata)==null?void 0:$t.is_installment)||((Ft=r.reference_number)==null?void 0:Ft.includes("INS-")),he=w+1,we=F&&!W,kt=O&&!W&&!we;return e.jsxs("div",{className:`group relative p-5 rounded-2xl border-2 transition-all duration-200 ${K?"border-indigo-500 shadow-xl":W?"bg-white border-gray-300 opacity-60 shadow-md hover:shadow-lg":M?"bg-white border-yellow-300 shadow-md hover:shadow-lg":F?"bg-white border-green-300 shadow-md hover:shadow-lg":O?"bg-white border-red-300 shadow-md hover:shadow-lg":"bg-white border-gray-200 shadow-md hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer px-4 py-3",onClick:()=>Q(K?null:r.id),children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:`relative flex-shrink-0 w-14 h-14 rounded-full flex items-center justify-center font-bold text-lg shadow-lg ${W?"bg-gradient-to-br from-gray-400 to-gray-500":M||B?"bg-gradient-to-br from-yellow-500 to-yellow-600":F?"bg-gradient-to-br from-green-500 to-green-600":O?"bg-gradient-to-br from-red-500 to-red-600":"bg-gradient-to-br from-gray-400 to-gray-500"} text-white`,children:[Be&&!B?he:B||F||we||M&&(B||F)?e.jsx(ze,{className:"w-6 h-6"}):O||M&&O?e.jsx(He,{className:"w-6 h-6"}):e.jsx(tt,{className:"w-6 h-6"}),we&&!W&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center border-2 border-white",children:e.jsx(ce,{className:"w-3 h-3 text-white"})}),W&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gray-500 rounded-full flex items-center justify-center border-2 border-white",children:e.jsx(de,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"w-4 h-4 flex-shrink-0 text-gray-600"}),e.jsx("div",{className:"text-base font-bold text-gray-900",children:Be?r.description||`Installment Payment ${w}`:gt})]}),Be&&e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:ue.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[kt&&!W&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-red-100 text-red-800 border border-red-200",children:[e.jsx(Fe,{className:"w-3.5 h-3.5"}),"overdue"]}),e.jsx("span",{className:"text-xs font-semibold text-red-600 bg-red-50 px-2 py-1 rounded border border-red-200",children:"1 days late"})]}),we&&!W&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-green-100 text-green-800 border border-green-200",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),"paid"]}),M&&!W&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-yellow-100 text-yellow-800 border border-yellow-200",children:[e.jsx(pe,{className:"w-3.5 h-3.5"}),"partial"]}),W&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-gray-100 text-gray-800 border border-gray-200",children:[e.jsx(de,{className:"w-3.5 h-3.5"}),"reversed"]}),!kt&&!we&&!M&&!W&&e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase ${F?"bg-green-100 text-green-800 border border-green-200":O?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-200"}`,children:Ve(r.transaction_type)}),((Mt=X[r.id])==null?void 0:Mt.customer)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:ae=>{q.current[r.id]=ae},onClick:ae=>{ae.stopPropagation(),L(ne=>({...ne,[r.id]:!ne[r.id]}))},className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-50 text-blue-700 border border-blue-200 flex-shrink-0 cursor-pointer hover:bg-blue-100 transition-colors",children:[e.jsx(Ke,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base font-semibold truncate max-w-[200px]",children:X[r.id].customer.name||"Unknown Customer"})]}),e.jsx(qs,{customer:{id:X[r.id].customer.id||"",name:X[r.id].customer.name||"Unknown Customer",phone:X[r.id].customer.phone,email:X[r.id].customer.email,city:X[r.id].customer.city,loyaltyLevel:X[r.id].customer.loyalty_level,points:X[r.id].customer.points,totalSpent:X[r.id].customer.total_spent},anchorRef:{current:q.current[r.id]},isOpen:u[r.id]||!1,onClose:()=>L(ae=>({...ae,[r.id]:!1})),formatCurrency:ae=>le(ae,v==null?void 0:v.currency),formatDate:ae=>{if(!ae)return"N/A";try{return new Date(ae).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}}})]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right ml-4",children:[e.jsxs("div",{className:`text-2xl font-bold mb-1 ${W?"text-gray-500":M?"text-yellow-700":F?"text-green-700":O?"text-red-700":"text-gray-900"}`,children:[M&&!W&&"~",F&&!W&&!M&&"+",O&&!W&&!M&&"-",le(r.amount,v.currency)]}),we&&!W&&e.jsxs("div",{className:"flex items-center justify-end gap-1 text-xs text-green-600 font-medium mt-1",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:"Completed"})]}),!Be&&e.jsxs("div",{className:"text-xs text-gray-500 font-medium mt-1",children:["Balance: ",le(r.balance_after,v.currency)]})]})]}),w<l.filter(ae=>{var ne,Ye;if(H!=="all"&&ae.transaction_type!==H||k.start&&new Date(ae.created_at)<new Date(k.start))return!1;if(k.end){const Ce=new Date(k.end);if(Ce.setHours(23,59,59,999),new Date(ae.created_at)>Ce)return!1}if(b){const Ce=b.toLowerCase(),We=(ne=ae.description)==null?void 0:ne.toLowerCase().includes(Ce),Te=(Ye=ae.reference_number)==null?void 0:Ye.toLowerCase().includes(Ce),qe=le(ae.amount,(v==null?void 0:v.currency)||"TZS").toLowerCase().includes(Ce);if(!We&&!Te&&!qe)return!1}return!0}).length-1&&e.jsx("div",{className:`absolute left-7 top-full w-0.5 h-3 ${W?"bg-gray-300":M||B?"bg-yellow-300":F?"bg-green-300":O?"bg-red-300":"bg-gray-300"}`}),K&&e.jsx("div",{className:"mt-0 pt-5 border-t-2 border-gray-200 relative",children:e.jsx("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-center -mt-3",children:e.jsx("span",{className:"bg-white px-5 py-1.5 text-xs text-gray-500 font-semibold uppercase tracking-wider rounded-full border border-gray-200 shadow-sm",children:"Transaction Details"})})}),K&&e.jsx(Ks,{transaction:r,selectedAccount:v,formatMoney:le,saleDetails:X[r.id],loadingSaleDetails:fe[r.id],onViewDetails:ae=>{ve(ae),mt(!0)},onReverse:ae=>{te(ae),_(!0)},currentUserId:(m==null?void 0:m.id)||null,onFetchSaleDetails:async ae=>{if(!X[r.id]){De(ne=>({...ne,[r.id]:!0}));try{const{data:ne,error:Ye}=await P.from("lats_sales").select("*").eq("id",ae).single();if(Ye)throw Ye;let Ce=null;if(ne.customer_id){const{data:Y}=await P.from("customers").select("*").eq("id",ne.customer_id).single();Ce=Y}let We="Unknown";if(ne.sold_by){const{data:Y}=await P.from("users").select("full_name, email").eq("email",ne.sold_by).single();We=(Y==null?void 0:Y.full_name)||(Y==null?void 0:Y.email)||ne.sold_by}else if(ne.created_by){const Y=ne.created_by.split("@")[0].replace(/[._]/g," ");We=Y.charAt(0).toUpperCase()+Y.slice(1)}const{data:Te}=await P.from("lats_sale_items").select("*").eq("sale_id",ae),qe=[...new Set((Te==null?void 0:Te.map(Y=>Y.product_id).filter(Boolean))||[])],Ot=[...new Set((Te==null?void 0:Te.map(Y=>Y.variant_id).filter(Boolean))||[])],[ms,us]=await Promise.all([qe.length>0?P.from("lats_products").select("*").in("id",qe):{data:[]},Ot.length>0?P.from("lats_product_variants").select("*").in("id",Ot):{data:[]}]),It=new Map((ms.data||[]).map(Y=>[Y.id,Y])),xs=new Map((us.data||[]).map(Y=>[Y.id,Y]));if(qe.length>0){const{data:Y}=await P.from("product_images").select("id, product_id, image_url, thumbnail_url, is_primary").in("product_id",qe).order("is_primary",{ascending:!1});Y&&Y.forEach(Ie=>{const Qe=It.get(Ie.product_id);if(Qe){Qe.images||(Qe.images=[]);const Lt={id:Ie.id,url:Ie.thumbnail_url||Ie.image_url,thumbnailUrl:Ie.thumbnail_url,isPrimary:Ie.is_primary||!1};Ie.is_primary?Qe.images.unshift(Lt):Qe.images.push(Lt)}})}const hs=(Te||[]).map(Y=>({...Y,product:It.get(Y.product_id),variant:xs.get(Y.variant_id),profit:Y.total_price-(Y.cost_price||0)*Y.quantity}));ie(Y=>({...Y,[r.id]:{...ne,customer:Ce,cashierName:We,items:hs}}))}catch(ne){console.error("Error fetching sale details:",ne)}finally{De(ne=>({...ne,[r.id]:!1}))}}}})]},r.id)})}):e.jsx(Js,{accountTransactions:l,transactionTypeFilter:H,dateFilter:k,searchQuery:b,selectedAccount:v,formatMoney:le,formatTransactionType:Ve,setExpandedTransaction:Q,expandedTransaction:T})})]})]})}),e.jsx("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:e.jsx("button",{type:"button",onClick:()=>C(!1),className:"w-full px-6 py-3.5 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-all shadow-lg hover:shadow-xl",children:"Close"})})]})}),z&&D&&e.jsx(Gs,{account:D,onClose:()=>{Z(!1),I(null)},onSuccess:()=>{Ae()}}),re&&e.jsx(Bs,{accounts:n,onClose:()=>V(!1),onSuccess:()=>{Ae()}}),s&&J&&v&&e.jsx(Hs,{transaction:J,account:v,onClose:()=>{_(!1),te(null)},onSuccess:()=>{Tt(v.id),Ae()}}),Me&&je&&e.jsx(Vs,{transaction:je,account:v,onClose:()=>{mt(!1),ve(null)}})]})},Ks=({transaction:m,selectedAccount:a,formatMoney:n,saleDetails:t,loadingSaleDetails:o,onFetchSaleDetails:d,onViewDetails:c,onReverse:p,currentUserId:j})=>{var v,U,l,A,G,se,H,ee,k,R,b,$,i;const g=m.transaction_type==="payment_received"||m.transaction_type==="transfer_in"||m.transaction_type==="income",h=m.transaction_type==="expense"||m.transaction_type==="payment_made"||m.transaction_type==="transfer_out",x=((v=m.metadata)==null?void 0:v.reversed)||(t==null?void 0:t.status)==="reversed"||(t==null?void 0:t.payment_status)==="reversed"||(t==null?void 0:t.metadata)&&typeof t.metadata=="object"&&t.metadata.reversed,f=((U=m.metadata)==null?void 0:U.is_partial)||((l=m.metadata)==null?void 0:l.partial)||(((A=m.description)==null?void 0:A.toLowerCase().includes("partial"))??!1),C=((G=m.metadata)==null?void 0:G.sale_id)||((se=m.metadata)==null?void 0:se.saleId)||(m.related_entity_type==="sale"?m.related_entity_id:null)||(((H=m.metadata)==null?void 0:H.related_entity_type)==="sale"?(ee=m.metadata)==null?void 0:ee.related_entity_id:null);return lt.useEffect(()=>{C&&!t&&!o&&d(C)},[C,t,o,d]),e.jsxs("div",{className:"px-5 pb-5 pt-2 space-y-4",children:[e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-purple-500/10 border border-purple-200/50 flex items-center justify-center",children:e.jsx(yt,{size:16,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-900",children:"Balance Impact"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Account balance changes"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"BEFORE"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n(m.balance_before,a==null?void 0:a.currency)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"CHANGE"}),e.jsxs("p",{className:`text-lg font-semibold ${g?"text-green-600":h?"text-red-600":"text-gray-900"}`,children:[g&&!x&&!f&&"+",h&&!x&&!f&&"-",f&&!x&&"~",n(m.amount,a==null?void 0:a.currency)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"AFTER"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n(m.balance_after,a==null?void 0:a.currency)})]})]})]})}),(k=m.description)!=null&&k.toLowerCase().includes("installment")||(R=m.metadata)!=null&&R.is_installment||(b=m.reference_number)!=null&&b.includes("INS-")?e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-500/10 border border-blue-200/50 flex items-center justify-center",children:e.jsx(Se,{size:16,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-900",children:"Installment Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Payment details"})]})]}),e.jsxs("div",{className:"space-y-4",children:[(($=m.metadata)==null?void 0:$.payment_method)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"PAYMENT METHOD"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 capitalize",children:m.metadata.payment_method})]}),m.reference_number&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"REFERENCE NUMBER"}),e.jsx("p",{className:"text-xs font-mono text-gray-600 break-all",children:m.reference_number})]}),((i=m.metadata)==null?void 0:i.notes)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"NOTES"}),e.jsx("p",{className:"text-sm text-gray-700",children:m.metadata.notes})]})]})]})}):null,C&&e.jsx("div",{className:"space-y-4",children:o?e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading sale details..."})]})}):t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-500/10 border border-blue-200/50 flex items-center justify-center",children:e.jsx(Qs,{size:16,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-900",children:"Sale Information"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Transaction details"})]})]}),e.jsxs("div",{className:"space-y-4",children:[t.total_amount!==void 0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"TOTAL AMOUNT"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:n(t.total_amount||0,a==null?void 0:a.currency)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.sale_number&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"SALE NUMBER"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 font-mono",children:t.sale_number})]}),t.status&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"STATUS"}),e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-semibold rounded-full ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status})]}),t.payment_method&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"PAYMENT METHOD"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:typeof t.payment_method=="string"?t.payment_method:t.payment_method.method||t.payment_method.type||"Unknown"})]}),t.cashierName&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"CASHIER"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.cashierName})]})]})]})]})}),t.items&&t.items.length>0&&e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-indigo-500/10 border border-indigo-200/50 flex items-center justify-center",children:e.jsx(dt,{size:16,className:"text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-900",children:"Sale Items"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.items.length," item(s)"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"text-left py-2 px-3 font-semibold text-gray-700",children:"SKU"}),e.jsx("th",{className:"text-center py-2 px-3 font-semibold text-gray-700",children:"Qty"}),e.jsx("th",{className:"text-right py-2 px-3 font-semibold text-gray-700",children:"Unit Price"}),e.jsx("th",{className:"text-right py-2 px-3 font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"text-right py-2 px-3 font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:t.items.map((y,T)=>{var Q,X,ie,fe;return e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsxs("td",{className:"py-3 px-3",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:((Q=y.product)==null?void 0:Q.name)||"Unknown Product"}),y.variant&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Variant: ",y.variant.variant_name||y.variant.name||y.variant.sku||"N/A"]}),((X=y.product)==null?void 0:X.category_id)&&e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:y.product.category_name||"Accessories"})]}),e.jsx("td",{className:"py-3 px-3 text-gray-600 font-mono text-xs",children:((ie=y.variant)==null?void 0:ie.sku)||((fe=y.product)==null?void 0:fe.sku)||y.sku||"N/A"}),e.jsx("td",{className:"py-3 px-3 text-center text-gray-900 font-semibold",children:y.quantity||1}),e.jsx("td",{className:"py-3 px-3 text-right text-gray-900 font-semibold",children:n(y.unit_price||y.total_price/(y.quantity||1),a==null?void 0:a.currency)}),e.jsx("td",{className:"py-3 px-3 text-right text-gray-900 font-semibold",children:n(y.total_price||0,a==null?void 0:a.currency)}),e.jsx("td",{className:"py-3 px-3 text-right text-green-700 font-semibold",children:n(y.profit||0,a==null?void 0:a.currency)})]},T)})})]})})]})})]}):null}),e.jsx("div",{className:"mt-5 pt-5 border-t-2 border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:y=>{y.stopPropagation(),c(m)},className:"px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-all text-sm font-semibold shadow-lg hover:shadow-xl flex items-center justify-center gap-2",children:[e.jsx(Kt,{className:"w-4 h-4"}),"View Details"]}),!x&&C&&e.jsxs("button",{onClick:async y=>{var T;y.stopPropagation();try{const{saleReversalService:Q}=await vt(()=>import("./saleReversalService-e6922c5c.js"),["assets/saleReversalService-e6922c5c.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);if(!confirm("Are you sure you want to reverse this sale? This will restore stock and reverse all payments. This action cannot be undone."))return;const X=prompt("Enter reason for reversal (optional):")||"Sale reversed by user",ie=await Q.reverseSale(C,j||null,X);ie.success?(S.success(`âœ… Sale reversed successfully! Stock restored for ${((T=ie.data)==null?void 0:T.itemsRestored)||0} items.`),window.location.reload()):S.error(`âŒ Failed to reverse sale: ${ie.error||ie.message}`)}catch(Q){console.error("Error reversing sale:",Q),S.error("Failed to reverse sale")}},className:"px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl transition-all text-sm font-semibold shadow-lg hover:shadow-xl flex items-center justify-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Reverse Sale"]}),!x&&!C&&e.jsxs("button",{onClick:y=>{y.stopPropagation(),p(m)},className:"px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl transition-all text-sm font-semibold shadow-lg hover:shadow-xl flex items-center justify-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Reverse"]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),navigator.clipboard.writeText(m.id),S.success("Transaction ID copied to clipboard")},className:"px-4 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-xl transition-all text-sm font-semibold shadow-lg hover:shadow-xl flex items-center justify-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"Copy ID"]}),m.reference_number&&e.jsxs("button",{onClick:y=>{y.stopPropagation(),navigator.clipboard.writeText(m.reference_number),S.success("Reference number copied to clipboard")},className:"px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition-all text-sm font-semibold shadow-lg hover:shadow-xl flex items-center justify-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"Copy Ref"]})]})})]})},Js=({accountTransactions:m,transactionTypeFilter:a,dateFilter:n,searchQuery:t,selectedAccount:o,formatMoney:d,formatTransactionType:c,setExpandedTransaction:p,expandedTransaction:j})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Reference"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Amount"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Balance"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:m.filter(g=>{var h,x;if(a!=="all"&&g.transaction_type!==a||n.start&&new Date(g.created_at)<new Date(n.start))return!1;if(n.end){const f=new Date(n.end);if(f.setHours(23,59,59,999),new Date(g.created_at)>f)return!1}if(t){const f=t.toLowerCase(),C=(h=g.description)==null?void 0:h.toLowerCase().includes(f),v=(x=g.reference_number)==null?void 0:x.toLowerCase().includes(f),U=d(g.amount,(o==null?void 0:o.currency)||"TZS").toLowerCase().includes(f);if(!C&&!v&&!U)return!1}return!0}).map((g,h)=>{var k,R,b,$,i,y,T;const x=g.transaction_type==="income",f=g.transaction_type==="payment_received"||g.transaction_type==="transfer_in",C=g.transaction_type==="expense"||g.transaction_type==="payment_made"||g.transaction_type==="transfer_out",v=(k=g.metadata)==null?void 0:k.reversed,U=((R=g.metadata)==null?void 0:R.is_partial)||((b=g.metadata)==null?void 0:b.partial)||((($=g.description)==null?void 0:$.toLowerCase().includes("partial"))??!1),A=new Date(g.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),G=((i=g.description)==null?void 0:i.toLowerCase().includes("installment"))||((y=g.metadata)==null?void 0:y.is_installment)||((T=g.reference_number)==null?void 0:T.includes("INS-")),se=h+1,H=f&&!v,ee=C&&!v&&!H;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>p(j===g.id?null:g.id),children:[e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:`relative flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-md ${v?"bg-gradient-to-br from-gray-400 to-gray-500":U||x?"bg-gradient-to-br from-yellow-500 to-yellow-600":f?"bg-gradient-to-br from-green-500 to-green-600":C?"bg-gradient-to-br from-red-500 to-red-600":"bg-gradient-to-br from-gray-400 to-gray-500"} text-white`,children:[G&&!x?se:x||f||H||U&&(x||f)?e.jsx(ze,{className:"w-5 h-5"}):C||U&&C?e.jsx(He,{className:"w-5 h-5"}):e.jsx(tt,{className:"w-5 h-5"}),H&&!v&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-white",children:e.jsx(ce,{className:"w-2.5 h-2.5 text-white"})}),v&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-gray-500 rounded-full flex items-center justify-center border-2 border-white",children:e.jsx(de,{className:"w-2.5 h-2.5 text-white"})})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:A})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:g.description||"No description"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("span",{className:"text-sm text-gray-600 font-mono",children:g.reference_number||"-"})}),e.jsx("td",{className:"py-4 px-4 text-right",children:e.jsxs("span",{className:`text-sm font-bold ${x||f?"text-green-700":"text-red-700"}`,children:[x||f?"+":"-",d(Math.abs(g.amount),(o==null?void 0:o.currency)||"TZS")]})}),e.jsx("td",{className:"py-4 px-4 text-right",children:e.jsx("span",{className:"text-sm font-medium text-gray-600",children:d(g.balance_after||0,(o==null?void 0:o.currency)||"TZS")})}),e.jsx("td",{className:"py-4 px-4 text-center",children:H&&!v?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-green-100 text-green-800 border border-green-200",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),"Paid"]}):ee?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-red-100 text-red-800 border border-red-200",children:[e.jsx(Fe,{className:"w-3.5 h-3.5"}),"Overdue"]}):v?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-gray-100 text-gray-800 border border-gray-200",children:[e.jsx(de,{className:"w-3.5 h-3.5"}),"Reversed"]}):e.jsx("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-gray-100 text-gray-700 border border-gray-200",children:"Pending"})})]},g.id)})})]})}),ea=()=>{const{currentUser:m}=wt(),[a,n]=N.useState([]),[t,o]=N.useState([]),[d,c]=N.useState(!0),[p,j]=N.useState(!1),[g,h]=N.useState(null),[x,f]=N.useState({name:"",description:"",account_id:"",category:"",amount:"",frequency:"monthly",start_date:new Date().toISOString().split("T")[0],vendor_name:"",reference_prefix:"",auto_process:!1,notification_days_before:3}),C=i=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),v=i=>({daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"})[i]||i,U=i=>({Rent:Ue,Utilities:ks,Supplies:dt,Transportation:Ps,Salaries:Ke,Maintenance:Ds,Marketing:ge,Insurance:Es,Taxes:bt,Other:ge})[i]||ge,l=N.useCallback(async()=>{try{c(!0);const i=await nt.getPaymentMethods(),y=[...new Set(i.map(X=>X.id))];if(y.length===0){n([]),c(!1);return}const{data:T,error:Q}=await P.from("recurring_expenses").select("*").in("account_id",y).order("next_due_date",{ascending:!0});if(Q)throw Q;n(T||[])}catch(i){console.error("Error fetching recurring expenses:",i),S.error("Failed to load recurring expenses")}finally{c(!1)}},[]),A=N.useCallback(async()=>{try{const i=await nt.getPaymentMethods();o(i)}catch(i){console.error("Error fetching payment accounts:",i)}},[]);N.useEffect(()=>{l(),A()},[l,A]);const G=(i,y)=>{f(T=>({...T,[i]:y}))},se=async()=>{try{if(!x.name||!x.account_id||!x.amount||!x.category){S.error("Please fill in all required fields");return}const i=parseFloat(x.amount);if(isNaN(i)||i<=0){S.error("Please enter a valid amount");return}const y={name:x.name,description:x.description,account_id:x.account_id,category:x.category,amount:i,frequency:x.frequency,start_date:x.start_date,next_due_date:x.start_date,vendor_name:x.vendor_name||null,reference_prefix:x.reference_prefix||x.category.substring(0,4).toUpperCase(),auto_process:x.auto_process,notification_days_before:x.notification_days_before,created_by:m==null?void 0:m.id};if(g){const{error:T}=await P.from("recurring_expenses").update(y).eq("id",g.id);if(T)throw T;S.success("Recurring expense updated!")}else{const{error:T}=await P.from("recurring_expenses").insert(y);if(T)throw T;S.success("Recurring expense created!")}H(),j(!1),h(null),l()}catch(i){console.error("Error saving recurring expense:",i),S.error(i.message||"Failed to save recurring expense")}},H=()=>{f({name:"",description:"",account_id:"",category:"",amount:"",frequency:"monthly",start_date:new Date().toISOString().split("T")[0],vendor_name:"",reference_prefix:"",auto_process:!1,notification_days_before:3})},ee=i=>{h(i),f({name:i.name,description:i.description||"",account_id:i.account_id,category:i.category,amount:i.amount.toString(),frequency:i.frequency,start_date:i.start_date,vendor_name:i.vendor_name||"",reference_prefix:i.reference_prefix||"",auto_process:i.auto_process,notification_days_before:i.notification_days_before||3}),j(!0)},k=async(i,y)=>{try{const{error:T}=await P.from("recurring_expenses").update({is_active:!y}).eq("id",i);if(T)throw T;S.success(y?"Paused":"Resumed"),l()}catch{S.error("Failed to update status")}},R=async(i,y)=>{if(confirm(`Delete recurring expense "${y}"?`))try{const{error:T}=await P.from("recurring_expenses").delete().eq("id",i);if(T)throw T;S.success("Recurring expense deleted"),l()}catch{S.error("Failed to delete recurring expense")}},b=async i=>{try{const{data:y,error:T}=await P.rpc("process_due_recurring_expenses");if(T)throw T;S.success("Processed! Check Expense Management for transaction."),l()}catch(y){console.error("Error processing expense:",y),S.error("Failed to process expense")}},$=i=>{const y=new Date(i),T=new Date,Q=Math.ceil((y.getTime()-T.getTime())/(1e3*60*60*24));return Q<0?{label:"Overdue",color:"red",icon:Fe}:Q===0?{label:"Due Today",color:"orange",icon:Ge}:Q<=7?{label:"Due Soon",color:"yellow",icon:Pe}:{label:"Scheduled",color:"green",icon:ce}};return d?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading recurring expenses..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Recurring Expenses"}),e.jsx("p",{className:"text-gray-600",children:"Automate fixed expenses like salaries, rent, and subscriptions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ye,{onClick:l,variant:"secondary",children:[e.jsx(et,{size:16}),"Refresh"]}),e.jsxs(ye,{onClick:()=>{H(),j(!0)},children:[e.jsx($e,{size:16}),"Add Recurring Expense"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(oe,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Recurring"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:a.length})]}),e.jsx("div",{className:"p-3 bg-blue-500 rounded-lg",children:e.jsx(Ze,{className:"w-6 h-6 text-white"})})]})}),e.jsx(oe,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:a.filter(i=>i.is_active).length})]}),e.jsx("div",{className:"p-3 bg-green-500 rounded-lg",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]})}),e.jsx(oe,{className:"p-6 bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Due Soon"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:a.filter(i=>{const y=new Date(i.next_due_date),T=new Date,Q=Math.ceil((y.getTime()-T.getTime())/(1e3*60*60*24));return Q>=0&&Q<=7}).length})]}),e.jsx("div",{className:"p-3 bg-orange-500 rounded-lg",children:e.jsx(Ge,{className:"w-6 h-6 text-white"})})]})}),e.jsx(oe,{className:"p-6 bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Monthly Total"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:C(a.filter(i=>i.frequency==="monthly"&&i.is_active).reduce((i,y)=>i+y.amount,0))})]}),e.jsx("div",{className:"p-3 bg-purple-500 rounded-lg",children:e.jsx(pe,{className:"w-6 h-6 text-white"})})]})})]}),e.jsxs(oe,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Scheduled Expenses (",a.length,")"]}),a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mb-4 inline-block p-6 bg-gray-100 rounded-full",children:e.jsx(Ze,{className:"w-16 h-16 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Recurring Expenses"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Set up automatic expenses for salaries, rent, utilities, and more"}),e.jsxs(ye,{onClick:()=>{H(),j(!0)},children:[e.jsx($e,{size:16}),"Create First Recurring Expense"]})]}):e.jsx("div",{className:"space-y-3",children:a.map(i=>{var X;const y=U(i.category),T=$(i.next_due_date),Q=T.icon;return e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-white rounded-xl border border-gray-200 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(y,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:i.name}),e.jsx("p",{className:"text-sm text-gray-600",children:i.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.auto_process?e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(zt,{className:"w-3 h-3"}),"Auto"]}):e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Manual"}),i.is_active?e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Active"]}):e.jsxs("span",{className:"px-3 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(Zt,{className:"w-3 h-3"}),"Paused"]})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Amount"}),e.jsx("div",{className:"font-semibold text-gray-900",children:C(i.amount)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Frequency"}),e.jsx("div",{className:"font-medium text-gray-900",children:v(i.frequency)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Next Due"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:`w-3 h-3 text-${T.color}-600`}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(i.next_due_date).toLocaleDateString()})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Account"}),e.jsx("div",{className:"font-medium text-gray-900",children:((X=t.find(ie=>ie.id===i.account_id))==null?void 0:X.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Vendor"}),e.jsx("div",{className:"font-medium text-gray-900",children:i.vendor_name||"N/A"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[i.is_active&&e.jsx("button",{onClick:()=>b(),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Process Now",children:e.jsx(Gt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ee(i),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:e.jsx(ts,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>k(i.id,i.is_active),className:`p-2 ${i.is_active?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50"} rounded-lg transition-colors`,title:i.is_active?"Pause":"Resume",children:i.is_active?e.jsx(Zt,{className:"w-4 h-4"}):e.jsx(Gt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>R(i.id,i.name),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(St,{className:"w-4 h-4"})})]})]})},i.id)})})]}),e.jsx(ns,{isOpen:p,onClose:()=>{j(!1),h(null),H()},title:g?"Edit Recurring Expense":"Add Recurring Expense",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ge,{className:"w-4 h-4"}),"Expense Name *"]}),e.jsx(xe,{type:"text",value:x.name,onChange:i=>G("name",i.target.value),placeholder:"e.g., Monthly Office Rent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Account *"]}),e.jsxs(Je,{value:x.account_id,onChange:i=>G("account_id",i.target.value),children:[e.jsx("option",{value:"",children:"Select Account"}),t.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ge,{className:"w-4 h-4"}),"Category *"]}),e.jsxs(Je,{value:x.category,onChange:i=>G("category",i.target.value),children:[e.jsx("option",{value:"",children:"Select Category"}),e.jsx("option",{value:"Salaries",children:"Salaries"}),e.jsx("option",{value:"Rent",children:"Rent"}),e.jsx("option",{value:"Utilities",children:"Utilities"}),e.jsx("option",{value:"Supplies",children:"Supplies"}),e.jsx("option",{value:"Insurance",children:"Insurance"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"}),e.jsx("option",{value:"Marketing",children:"Marketing"}),e.jsx("option",{value:"Transportation",children:"Transportation"}),e.jsx("option",{value:"Taxes",children:"Taxes"}),e.jsx("option",{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(pe,{className:"w-4 h-4"}),"Amount (TSh) *"]}),e.jsx(xe,{type:"number",value:x.amount,onChange:i=>G("amount",i.target.value),placeholder:"0.00",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Frequency *"]}),e.jsxs(Je,{value:x.frequency,onChange:i=>G("frequency",i.target.value),children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Start Date *"]}),e.jsx(xe,{type:"date",value:x.start_date,onChange:i=>G("start_date",i.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Vendor"]}),e.jsx(xe,{type:"text",value:x.vendor_name,onChange:i=>G("vendor_name",i.target.value),placeholder:"Supplier or vendor"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ge,{className:"w-4 h-4"}),"Description"]}),e.jsx("textarea",{value:x.description,onChange:i=>G("description",i.target.value),placeholder:"Additional details about this recurring expense",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(bt,{className:"w-4 h-4"}),"Reference Prefix"]}),e.jsx(xe,{type:"text",value:x.reference_prefix,onChange:i=>G("reference_prefix",i.target.value),placeholder:"e.g., SAL, RENT, ELEC",maxLength:10}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Will generate references like: ",x.reference_prefix||"REF","-20251013"]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.auto_process,onChange:i=>G("auto_process",i.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-900",children:[e.jsx(zt,{className:"w-4 h-4 text-yellow-600"}),"Auto-Process (Automatic Deduction)"]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 ml-6",children:x.auto_process?"âš¡ Expense will be automatically deducted on due date":"ðŸ“ You will be notified but must process manually"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(ye,{variant:"secondary",onClick:()=>{j(!1),h(null),H()},children:"Cancel"}),e.jsxs(ye,{onClick:se,children:[g?"Update":"Create"," Recurring Expense"]})]})]})})]})};class ta{constructor(){this.cache=new Map,this.CACHE_DURATION=6e4,this.MAX_RETRIES=3,this.RETRY_DELAY=1e3,this.fetchLock=new Map,this.connectionStatus="unknown",this.lastConnectionCheck=0,this.CONNECTION_CHECK_INTERVAL=3e4,this.globalFetchLock=!1,this.GLOBAL_FETCH_TIMEOUT=3e4,this.debounceTimers=new Map,this.DEBOUNCE_DELAY=1e3}clearCache(){this.cache.clear(),this.fetchLock.clear(),this.debounceTimers.forEach(a=>clearTimeout(a)),this.debounceTimers.clear()}async checkConnection(){var n;const a=Date.now();if(a-this.lastConnectionCheck<this.CONNECTION_CHECK_INTERVAL)return this.connectionStatus==="connected";try{return this.lastConnectionCheck=a,(n=(await P.auth.getUser()).data)!=null&&n.user?(this.connectionStatus="connected",!0):(this.connectionStatus="disconnected",console.warn("âš ï¸ PaymentTrackingService: No authenticated user"),!1)}catch(t){return console.debug("âš ï¸ PaymentTrackingService: Connection check error (assuming connected):",t),this.connectionStatus="connected",!0}}getCachedData(a){const n=this.cache.get(a);return n&&Date.now()-n.timestamp<this.CACHE_DURATION?n.data:null}setCachedData(a,n){this.cache.set(a,{data:n,timestamp:Date.now()})}async retryOperation(a,n,t=this.MAX_RETRIES){var o,d;try{return await a()}catch(c){const p=((o=c==null?void 0:c.message)==null?void 0:o.includes("ERR_CONNECTION_CLOSED"))||((d=c==null?void 0:c.message)==null?void 0:d.includes("Failed to fetch"))||(c==null?void 0:c.code)==="PGRST301"||(c==null?void 0:c.code)==="PGRST116";if(console.error(`âŒ ${n} failed (attempt ${this.MAX_RETRIES-t+1}/${this.MAX_RETRIES}):`,c),t>1&&p){const j=this.RETRY_DELAY*(this.MAX_RETRIES-t+1);return console.log(`ðŸ”„ Retrying ${n} in ${j}ms due to connection error...`),await new Promise(g=>setTimeout(g,j)),this.retryOperation(a,n,t-1)}else if(t>1)return console.log(`ðŸ”„ Retrying ${n} in ${this.RETRY_DELAY}ms...`),await new Promise(j=>setTimeout(j,this.RETRY_DELAY)),this.retryOperation(a,n,t-1);if(p)return console.warn(`âš ï¸ ${n} failed after ${this.MAX_RETRIES} attempts due to connection issues. Returning empty data.`),[];throw c}}async fetchSoldItems(a,n){try{if(n==="pos_sale"){const{data:t,error:o}=await P.from("lats_sale_items").select("*").eq("sale_id",a);return o?(console.error("Error fetching POS sale items:",o),[]):(t==null?void 0:t.map(d=>({id:d.id,name:d.product_name||"Unknown Product",sku:d.sku||"N/A",quantity:d.quantity||1,unitPrice:d.unit_price||0,totalPrice:d.total_price||0,category:d.category||"General",brand:d.brand||"Unknown",variant:d.variant_name||"Default",type:"product",description:d.product_name||"Product from sale",notes:d.notes||""})))||[]}else if(n==="device_payment"){const{data:t,error:o}=await P.from("customer_payments").select("amount").eq("id",a).single();return o?(console.error("Error fetching device payment amount:",o),[]):[{id:`service-${a}`,name:"Device Repair Service",quantity:1,unitPrice:(t==null?void 0:t.amount)||0,totalPrice:(t==null?void 0:t.amount)||0,type:"service",description:"Device repair and maintenance service",notes:"Repair service for device"}]}else if(n==="purchase_order"){const{data:t,error:o}=await P.from("lats_purchase_order_items").select(`
            *,
            lats_products(name, sku),
            lats_product_variants(name, sku)
          `).eq("purchase_order_id",a);return o?(console.error("Error fetching purchase order items:",o),[]):(t==null?void 0:t.map(d=>{var c,p,j,g,h,x;return{id:d.id,name:((c=d.lats_products)==null?void 0:c.name)||((p=d.lats_product_variants)==null?void 0:p.name)||"Unknown Product",sku:((j=d.lats_products)==null?void 0:j.sku)||((g=d.lats_product_variants)==null?void 0:g.sku)||"N/A",quantity:d.quantity||1,unitPrice:d.unit_price||0,totalPrice:d.total_price||0,category:"Purchase Order",brand:"Supplier",variant:((h=d.lats_product_variants)==null?void 0:h.name)||"Default",type:"product",description:`Purchase order item - ${((x=d.lats_products)==null?void 0:x.name)||"Product"}`,notes:d.notes||""}}))||[]}return[]}catch(t){return console.error("Error fetching sold items:",t),[]}}async debouncedFetchPaymentTransactions(a,n,t,o){const d=`payments_${a||"all"}_${n||"all"}_${t||"all"}_${o||"all"}`;return this.debounceTimers.has(d)&&clearTimeout(this.debounceTimers.get(d)),new Promise((c,p)=>{const j=setTimeout(async()=>{this.debounceTimers.delete(d);try{const g=await this.fetchPaymentTransactions(a,n,t,o);c(g)}catch(g){p(g)}},this.DEBOUNCE_DELAY);this.debounceTimers.set(d,j)})}async fetchPaymentTransactions(a,n,t,o){var d,c;try{const p=`payments_${a||"all"}_${n||"all"}_${t||"all"}_${o||"all"}`,j=this.getCachedData(p);if(j)return console.log("ðŸ“¦ PaymentTrackingService: Returning cached payment data"),j;if(this.globalFetchLock){console.log("â³ PaymentTrackingService: Global fetch in progress, waiting...");let f=0;const C=1e4;for(;this.globalFetchLock&&f<C;)await new Promise(U=>setTimeout(U,200)),f+=200;const v=this.getCachedData(p);if(v)return v;this.globalFetchLock&&console.warn("âš ï¸ PaymentTrackingService: Global fetch timeout reached, proceeding anyway")}if(!await this.checkConnection())return console.warn("âš ï¸ PaymentTrackingService: No connection available, returning cached data or empty array"),((d=this.cache.get(p))==null?void 0:d.data)||[];if(this.fetchLock.has(p))return console.log("â³ PaymentTrackingService: Already fetching, waiting for existing request..."),this.fetchLock.get(p);this.globalFetchLock=!0;const h=setTimeout(()=>{this.globalFetchLock&&(console.warn("âš ï¸ PaymentTrackingService: Global fetch lock timeout reached, force releasing lock"),this.globalFetchLock=!1)},this.GLOBAL_FETCH_TIMEOUT),x=this.retryOperation(()=>this._fetchPaymentTransactionsInternal(a,n,t,o),"fetchPaymentTransactions");this.fetchLock.set(p,x);try{const f=await x;return this.setCachedData(p,f),f}finally{clearTimeout(h),this.fetchLock.delete(p),this.globalFetchLock=!1}}catch(p){console.error("Error fetching payment transactions:",p);const j=`payments_${a||"all"}_${n||"all"}_${t||"all"}_${o||"all"}`,g=(c=this.cache.get(j))==null?void 0:c.data;return this.globalFetchLock=!1,g||[]}}async _fetchPaymentTransactionsInternal(a,n,t,o){console.log("ðŸ” PaymentTrackingService: Fetching payment transactions...");const d=[];try{const c=P.from("customer_payments").select("*").order("payment_date",{ascending:!1}).limit(1e3),p=await Bt(c,"payments"),{data:j,error:g}=await p;if(g)console.log("âš ï¸ PaymentTrackingService: customer_payments error:",g);else if(j&&j.length>0){console.log(`ðŸ“Š PaymentTrackingService: Found ${j.length} device payments`);const x=j.map(f=>({id:f.id,transactionId:`TXN-${f.id.slice(0,8).toUpperCase()}`,customerName:f.customer_name||"Unknown Customer",customerPhone:f.customer_phone,customerEmail:f.customer_email,customerAddress:f.customer_address,amount:Number(f.amount)||0,currency:f.currency||"TZS",method:this.mapPaymentMethod(f.method||f.payment_method),paymentMethod:this.mapPaymentMethod(f.method||f.payment_method),reference:f.reference||`REF-${f.id.slice(0,8).toUpperCase()}`,status:f.status||"completed",date:f.payment_date||f.created_at,timestamp:f.payment_date||f.created_at,cashier:f.cashier_name||"System",fees:Number(f.fees)||0,netAmount:(Number(f.amount)||0)-(Number(f.fees)||0),orderId:f.device_id,source:"device_payment",customerId:f.customer_id,deviceId:f.device_id,deviceName:f.device_name||void 0,paymentType:f.payment_type||"payment",createdBy:f.created_by,createdAt:f.created_at,failureReason:f.failure_reason,metadata:f.metadata||{}}));d.push(...x)}else console.log("ðŸ“Š PaymentTrackingService: No device payments found (0 records)");try{console.log("ðŸ” PaymentTrackingService: Fetching POS sales...");const x=typeof localStorage<"u"?localStorage.getItem("current_branch_id"):null;let f=P.from("lats_sales").select("*").order("created_at",{ascending:!1}).limit(1e3);x&&(console.log("ðŸ”’ [PaymentTracking] Filtering POS sales by branch:",x),f=f.eq("branch_id",x));const{data:C,error:v}=await f;if(!v&&C&&C.length>0){console.log(`ðŸ“Š PaymentTrackingService: Found ${C.length} POS sales`);const U=C.map(l=>({id:l.id,transactionId:l.sale_number||`SALE-${l.id.slice(0,8).toUpperCase()}`,customerName:l.customer_name||"Walk-in Customer",customerPhone:l.customer_phone,customerEmail:l.customer_email,customerAddress:l.customer_address,amount:Number(l.total_amount)||0,method:this.getPaymentMethodDisplay(l.payment_method),paymentMethod:this.getPaymentMethodDisplay(l.payment_method),reference:l.sale_number||`REF-${l.id.slice(0,8).toUpperCase()}`,status:this.mapSaleStatus(l.status),date:l.created_at,timestamp:l.created_at,cashier:l.cashier_name||"System",fees:Number(l.processing_fees)||0,netAmount:(Number(l.total_amount)||0)-(Number(l.processing_fees)||0),orderId:l.id,source:"pos_sale",customerId:l.customer_id||"",paymentType:"payment",createdBy:l.created_by,createdAt:l.created_at,failureReason:l.failure_reason,metadata:{...l.metadata,paymentMethod:this.parsePaymentMethod(l.payment_method)}}));d.push(...U)}else v?console.error("âŒ PaymentTrackingService: Error fetching POS sales:",v):console.log("ðŸ“Š PaymentTrackingService: No POS sales found (0 records)")}catch(x){console.warn("âš ï¸ PaymentTrackingService: POS sales not accessible:",x)}try{console.log("ðŸ” PaymentTrackingService: Fetching Purchase Order payments...");const x=P.from("purchase_order_payments").select("*").order("payment_date",{ascending:!1}).limit(1e3),f=await Bt(x,"payments"),{data:C,error:v}=await f;if(!v&&C&&C.length>0){console.log(`ðŸ“Š PaymentTrackingService: Found ${C.length} Purchase Order payments`);const U=C.map(l=>({id:l.id,transactionId:`PO-PAY-${l.id.slice(0,8).toUpperCase()}`,customerName:"Supplier Payment",customerPhone:void 0,customerEmail:void 0,amount:Number(l.amount)||0,currency:l.currency||"TZS",method:this.mapPaymentMethod(l.payment_method),paymentMethod:this.mapPaymentMethod(l.payment_method),reference:l.reference_number||l.reference||`PO-REF-${l.id.slice(0,8).toUpperCase()}`,status:this.mapPOPaymentStatus(l.status),date:l.payment_date||l.created_at,timestamp:l.payment_date||l.created_at,cashier:"System",fees:0,netAmount:Number(l.amount)||0,orderId:l.purchase_order_id,source:"purchase_order",customerId:"",paymentType:"payment",createdBy:l.created_by,createdAt:l.created_at,failureReason:l.status==="failed"?"Payment failed":void 0,metadata:{paymentMethod:l.payment_method,paymentAccountId:l.payment_account_id},purchaseOrderId:l.purchase_order_id,purchaseOrderNumber:void 0,supplierId:void 0,supplierName:void 0,supplierPhone:void 0,supplierEmail:void 0,paymentAccountId:l.payment_account_id,paymentAccountName:void 0,notes:l.notes}));d.push(...U)}else v?console.error("âŒ PaymentTrackingService: Error fetching Purchase Order payments:",v):console.log("ðŸ“Š PaymentTrackingService: No Purchase Order payments found (0 records)")}catch(x){console.warn("âš ï¸ PaymentTrackingService: Purchase Order payments not accessible:",x)}let h=d;return a&&n&&(h=h.filter(x=>{const f=new Date(x.date),C=new Date(a),v=new Date(n);return f>=C&&f<=v})),t&&t!=="all"&&t!==void 0&&(h=h.filter(x=>x.status===t)),o&&o!=="all"&&o!==void 0&&(h=h.filter(x=>x.method===o)),h.sort((x,f)=>{const C=new Date(x.date||x.timestamp).getTime();return new Date(f.date||f.timestamp).getTime()-C}),console.log(`âœ… PaymentTrackingService: Returning ${h.length} total payments (${h.filter(x=>x.source==="pos_sale").length} POS sales, ${h.filter(x=>x.source==="device_payment").length} device payments)`),console.log(`ðŸ” PaymentTrackingService: Filters applied - startDate: ${a}, endDate: ${n}, status: ${t}, method: ${o}`),console.log(`ðŸ” PaymentTrackingService: All payments before filtering: ${d.length}, after filtering: ${h.length}`),h}catch(c){return console.error("Error fetching payment transactions:",c),[]}}async calculatePaymentMetrics(a,n){try{const t=await this.fetchPaymentTransactions(a,n),o=t.length,d=t.reduce((h,x)=>h+(Number(x.amount)||0),0),c=t.filter(h=>h.status==="completed").reduce((h,x)=>h+(Number(x.amount)||0),0),p=t.filter(h=>h.status==="pending").reduce((h,x)=>h+(Number(x.amount)||0),0),j=t.filter(h=>h.status==="failed").reduce((h,x)=>h+(Number(x.amount)||0),0),g=t.reduce((h,x)=>h+(Number(x.fees)||0),0);return{totalPayments:o,totalAmount:d,completedAmount:c,pendingAmount:p,failedAmount:j,totalFees:g,successRate:d>0?(()=>(c/d*100).toFixed(1).replace(/\.0$/,""))():"0"}}catch(t){return console.error("Error calculating payment metrics:",t),{totalPayments:0,totalAmount:0,completedAmount:0,pendingAmount:0,failedAmount:0,totalFees:0,successRate:"0"}}}async getPaymentMethodSummary(a,n){try{const t=await this.fetchPaymentTransactions(a,n),o=t.reduce((c,p)=>c+(Number(p.amount)||0),0),d=new Map;return t.forEach(c=>{const p=c.method,j=d.get(p)||{count:0,amount:0},g=Number(c.amount)||0;d.set(p,{count:j.count+1,amount:j.amount+g})}),Array.from(d.entries()).map(([c,p])=>({method:c,count:p.count,amount:p.amount,percentage:o>0?Math.round(p.amount/o*100):0}))}catch(t){return console.error("Error getting payment method summary:",t),[]}}async getPaymentsByMethod(a,n,t){try{console.log("ðŸ” PaymentTrackingService: Fetching payments grouped by method...");const o=await this.fetchPaymentTransactions(a,n,t),d={};return o.forEach(c=>{const p=c.method;d[p]||(d[p]=[]),d[p].push(c)}),Object.keys(d).forEach(c=>{d[c].sort((p,j)=>new Date(j.date).getTime()-new Date(p.date).getTime())}),console.log(`âœ… PaymentTrackingService: Grouped ${o.length} payments into ${Object.keys(d).length} methods`),d}catch(o){return console.error("Error getting payments by method:",o),{}}}async getPaymentMethodStatistics(a,n){try{console.log("ðŸ” PaymentTrackingService: Calculating payment method statistics...");const t=await this.fetchPaymentTransactions(a,n),o={};return t.forEach(d=>{const c=d.method;o[c]||(o[c]={totalAmount:0,totalCount:0,completedAmount:0,completedCount:0,pendingAmount:0,pendingCount:0,failedAmount:0,failedCount:0,averageAmount:0,successRate:0});const p=o[c];p.totalAmount+=d.amount,p.totalCount+=1,d.status==="completed"?(p.completedAmount+=d.amount,p.completedCount+=1):d.status==="pending"?(p.pendingAmount+=d.amount,p.pendingCount+=1):d.status==="failed"&&(p.failedAmount+=d.amount,p.failedCount+=1)}),Object.keys(o).forEach(d=>{const c=o[d];c.averageAmount=c.totalCount>0?c.totalAmount/c.totalCount:0,c.successRate=c.totalCount>0?c.completedCount/c.totalCount*100:0}),console.log(`âœ… PaymentTrackingService: Calculated statistics for ${Object.keys(o).length} payment methods`),o}catch(t){return console.error("Error calculating payment method statistics:",t),{}}}async getDailySummary(a=7){try{const n=new Date,t=new Date;t.setDate(t.getDate()-a);const o=await this.fetchPaymentTransactions(t.toISOString().split("T")[0],n.toISOString().split("T")[0]),d=new Map;return o.forEach(c=>{const p=new Date(c.date).toISOString().split("T")[0],j=d.get(p)||{total:0,completed:0,pending:0,failed:0},g=Number(c.amount)||0;j.total+=g,c.status==="completed"?j.completed+=g:c.status==="pending"?j.pending+=g:c.status==="failed"&&(j.failed+=g),d.set(p,j)}),Array.from(d.entries()).map(([c,p])=>({date:c,...p})).sort((c,p)=>new Date(p.date).getTime()-new Date(c.date).getTime())}catch(n){return console.error("Error getting daily summary:",n),[]}}async getReconciliationRecords(){try{const a=await this.fetchPaymentTransactions(),n=new Map;return a.forEach(t=>{const o=new Date(t.date).toISOString().split("T")[0],d=n.get(o)||0,c=Number(t.amount)||0;n.set(o,d+c)}),Array.from(n.entries()).slice(0,5).map(([t,o])=>({date:t,status:"reconciled",expected:o,actual:o,variance:0}))}catch(a){return console.error("Error getting reconciliation records:",a),[]}}async updatePaymentStatus(a,n,t,o){try{const d=await this.getPaymentStatus(a,t);if(t==="device_payment")try{const c={status:n,updated_at:new Date().toISOString()};o&&o!=="null"&&o!=="undefined"&&o.length>0&&(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(o)?console.log("Valid UUID format detected, but skipping updated_by to avoid FK constraint issues:",o):console.warn("Invalid UUID format for updated_by, skipping:",o));const{error:p}=await P.from("customer_payments").update(c).eq("id",a);if(p){console.warn("Full update failed, trying with status only:",p.message);const{error:j}=await P.from("customer_payments").update({status:n}).eq("id",a);if(j)throw j}}catch(c){throw c}else if(t==="pos_sale"){const{error:c}=await P.from("lats_sales").update({status:this.mapStatusToSaleStatus(n),updated_at:new Date().toISOString(),updated_by:o}).eq("id",a);if(c)throw c}else if(t==="purchase_order"){const{error:c}=await P.from("purchase_order_payments").update({status:n==="failed"?"failed":n,updated_at:new Date().toISOString()}).eq("id",a);if(c)throw c}return await this.logPaymentOperation("status_update",a,{previous_status:d,new_status:n,source:t,timestamp:new Date().toISOString()},o),this.clearCache(),!0}catch(d){return console.error("Error updating payment status:",d),!1}}async getPaymentStatus(a,n){try{if(n==="device_payment"){const{data:t,error:o}=await P.from("customer_payments").select("status").eq("id",a).single();if(o)throw o;return(t==null?void 0:t.status)||"unknown"}else if(n==="pos_sale"){const{data:t,error:o}=await P.from("lats_sales").select("status").eq("id",a).single();if(o)throw o;return(t==null?void 0:t.status)||"unknown"}else if(n==="purchase_order"){const{data:t,error:o}=await P.from("purchase_order_payments").select("status").eq("id",a).single();if(o)throw o;return(t==null?void 0:t.status)||"unknown"}return"unknown"}catch(t){return console.error("Error getting payment status:",t),"unknown"}}clearPaymentCache(){this.clearCache()}async logPaymentOperation(a,n,t,o){try{await P.from("payment_audit_log").insert({operation:a,payment_id:n,details:t,user_id:o,timestamp:new Date().toISOString(),ip_address:null,user_agent:null})}catch(d){console.error("Failed to log payment operation:",d)}}async getPaymentAuditTrail(a){try{const{data:n,error:t}=await P.from("payment_audit_log").select("*").eq("payment_id",a).order("timestamp",{ascending:!1});if(t)throw t;return n||[]}catch(n){return console.error("Error fetching payment audit trail:",n),[]}}mapPaymentMethod(a){if(!a)return"Cash";if(typeof a=="object"){const t=a.method||a.paymentMethod||a.type;if(t&&typeof t=="string")a=t;else return"Cash"}return typeof a!="string"?"Cash":{cash:"Cash",card:"Card",transfer:"Bank Transfer",mpesa:"M-Pesa",mobile_money:"M-Pesa"}[a.toLowerCase()]||a||"Cash"}mapSaleStatus(a){return a==="completed"?"completed":a==="pending"?"pending":a==="approved"?"approved":a==="cancelled"||a==="refunded"?"failed":"pending"}mapStatusToSaleStatus(a){return a==="completed"?"completed":a==="pending"?"pending":a==="approved"?"approved":a==="failed"?"cancelled":"pending"}mapPOPaymentStatus(a){return a==="completed"?"completed":a==="pending"?"pending":a==="approved"?"approved":a==="failed"||a==="cancelled"?"failed":"pending"}parsePaymentMethod(a){if(!a)return null;if(typeof a=="object")return a;if(typeof a=="string")try{const n=JSON.parse(a);return console.log("ðŸ” PaymentTrackingService: Parsed payment method:",n),n}catch(n){return console.warn("Failed to parse payment method JSON:",n,"Raw value:",a),{type:"single",method:a}}return null}getPaymentMethodDisplay(a){var t;const n=this.parsePaymentMethod(a);return n?n.type==="single"||!n.type||n.type!=="multiple"?this.mapPaymentMethod(n):n.type==="multiple"&&((t=n.details)!=null&&t.payments)?"Multiple":this.mapPaymentMethod(n):"Unknown"}}const Wt=new ta,Sa=()=>{var re,V;const{currentUser:m}=wt(),[a,n]=N.useState("providers"),[t,o]=N.useState(0);ys({maxRetries:3,showToast:!0,logToConsole:!0});const d=N.useCallback(()=>{console.log("ðŸ”„ Triggering refresh of all payment data..."),o(s=>s+1)},[]),[c,p]=N.useState([]),[j,g]=N.useState(!1),[h,x]=N.useState({status:"all",provider:"all",dateRange:"30",source:"all"}),[f,C]=N.useState(""),[v,U]=N.useState(!1),[l,A]=N.useState(null),[G,se]=N.useState(!1),[H,ee]=N.useState(!1),[k,R]=N.useState({amount:"",currency:"",status:"",notes:""}),[b,$]=N.useState(!1),[i,y]=N.useState("table"),[T,Q]=N.useState(null);N.useEffect(()=>{a==="history"&&X()},[a,h]);const X=async()=>{g(!0);try{console.log("ðŸ“Š Loading comprehensive payment history from all sources..."),Wt.clearPaymentCache();const s=await Wt.fetchPaymentTransactions();console.log("ðŸ“Š Loaded payment history:",s.length,"transactions from all sources"),console.log("ðŸ“Š Payment sources:",{posSales:s.filter(_=>_.source==="pos_sale").length,devicePayments:s.filter(_=>_.source==="device_payment").length,purchaseOrders:s.filter(_=>_.source==="purchase_order").length}),s&&s.length>0?(p(s),S.success(`Loaded ${s.length} transactions from all payment sources`)):(p([]),console.warn("âš ï¸ No payment transactions found in database"))}catch(s){console.error("âŒ Error loading payment history:",s),S.error("Failed to load payment history"),p([])}finally{g(!1)}},ie=s=>{switch(s.toLowerCase()){case"completed":case"success":return"success";case"failed":case"cancelled":return"error";case"pending":return"warning";default:return"secondary"}},fe=s=>{const _=s.toLowerCase();return _==="success"?"Completed":_==="pending"?"Pending":_==="failed"?"Failed":_==="cancelled"?"Cancelled":s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()},De=s=>{switch(s.toLowerCase()){case"multiple":return"ðŸ”€";case"m-pesa":case"mpesa":return"ðŸ“±";case"tigopesa":return"ðŸ“±";case"airtel money":case"airtelmoney":return"ðŸ“±";case"mobile_money":return"ðŸ“±";case"zenopay":return"ðŸ“±";case"stripe":return"ðŸ’³";case"card":return"ðŸ’³";case"bank transfer":case"transfer":return"ðŸ¦";case"paypal":return"ðŸ”µ";case"flutterwave":return"ðŸŒŠ";case"cash":return"ðŸ’µ";case"credit":return"ðŸŽ«";case"mock":return"ðŸ§ª";default:return"ðŸ’°"}},be=c.filter(s=>{var _;if(f){const J=f.toLowerCase();if(![s.transactionId,s.customerName,s.method,s.reference,s.deviceName,s.purchaseOrderNumber,s.status,s.source,(_=s.amount)==null?void 0:_.toString()].filter(Boolean).join(" ").toLowerCase().includes(J))return!1}if(h.status!=="all"){const J=s.status.toLowerCase(),te=h.status;if(te==="completed"&&J!=="success"&&J!=="completed")return!1;if(te!=="completed"&&J!==te)return!1}return!(h.provider!=="all"&&s.method!==h.provider||h.source!=="all"&&s.source!==h.source)}).sort((s,_)=>{const J=new Date(s.date||s.timestamp).getTime();return new Date(_.date||_.timestamp).getTime()-J}),Ee=s=>{let _=`Transaction: ${s.transactionId}
Customer: ${s.customerName||"N/A"}
Amount: ${_e.money(s.amount)}
Payment Method: ${s.method}
Source: ${s.source}
Status: ${fe(s.status)}
Date: ${new Date(s.date||s.timestamp).toLocaleString()}
Reference: ${s.reference||"N/A"}`;s.source==="device_payment"&&s.deviceName?_+=`
Device: ${s.deviceName}`:s.source==="purchase_order"&&s.purchaseOrderNumber&&(_+=`
Purchase Order: ${s.purchaseOrderNumber}`,_+=`
Supplier: ${s.supplierName||"N/A"}`),s.customerPhone&&(_+=`
Phone: ${s.customerPhone}`),s.customerEmail&&(_+=`
Email: ${s.customerEmail}`),navigator.clipboard.writeText(_).then(()=>{S.success("Transaction details copied to clipboard")}).catch(()=>{S.error("Failed to copy to clipboard")})},u=s=>{const _=window.open("","_blank");if(_){let te=`
        <html>
          <head>
            <title>Transaction Receipt</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h2 { color: #1a202c; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; }
              .detail { margin: 10px 0; }
              .label { font-weight: bold; color: #4b5563; }
              .source-badge { display: inline-block; padding: 4px 12px; background-color: #e0e7ff; color: #4338ca; border-radius: 12px; font-size: 12px; margin: 10px 0; }
            </style>
          </head>
          <body>
            <h2>Transaction Receipt</h2>
            <div class="source-badge">${s.source==="pos_sale"?"POS Sale":s.source==="device_payment"?"Device Payment":"Purchase Order"}</div>
            <div class="detail"><span class="label">Transaction ID:</span> ${s.transactionId}</div>
            <div class="detail"><span class="label">Customer:</span> ${s.customerName||"N/A"}</div>
            <div class="detail"><span class="label">Email:</span> ${s.customerEmail||"N/A"}</div>
            <div class="detail"><span class="label">Phone:</span> ${s.customerPhone||"N/A"}</div>
            <div class="detail"><span class="label">Amount:</span> ${_e.money(s.amount)}</div>
            <div class="detail"><span class="label">Payment Method:</span> ${s.method}</div>
            <div class="detail"><span class="label">Status:</span> ${fe(s.status)}</div>
            <div class="detail"><span class="label">Date:</span> ${new Date(s.date||s.timestamp).toLocaleString()}</div>
            <div class="detail"><span class="label">Reference:</span> ${s.reference||"N/A"}</div>
            <div class="detail"><span class="label">Cashier:</span> ${s.cashier||"N/A"}</div>`;s.source==="device_payment"&&s.deviceName?te+=`<div class="detail"><span class="label">Device:</span> ${s.deviceName}</div>`:s.source==="purchase_order"&&(s.purchaseOrderNumber&&(te+=`<div class="detail"><span class="label">Purchase Order:</span> ${s.purchaseOrderNumber}</div>`),s.supplierName&&(te+=`<div class="detail"><span class="label">Supplier:</span> ${s.supplierName}</div>`)),te+=`
          </body>
        </html>`,_.document.write(te),_.document.close(),_.print()}},L=s=>{navigator.share?navigator.share({title:"Transaction Details",text:`Transaction ${s.transactionId} - ${s.customerName||"N/A"} - ${_e.money(s.amount)}`,url:window.location.href}).catch(()=>{S.error("Failed to share")}):Ee(s)},q=s=>{R({amount:s.amount.toString(),currency:s.currency||"TZS",status:s.status.toLowerCase(),notes:""}),se(!0)},z=()=>{ee(!0)},Z=async s=>{try{$(!0);const{error:_}=await P.from("payment_transactions").update({status:"FAILED",metadata:{...s.metadata,refunded:!0,refunded_at:new Date().toISOString(),refunded_by:m==null?void 0:m.id},updated_at:new Date().toISOString()}).eq("id",s.id);if(_)throw _;S.success("Transaction refunded successfully"),X(),A(null)}catch(_){console.error("Error refunding transaction:",_),S.error("Failed to refund transaction")}finally{$(!1)}},D=async()=>{if(l)try{$(!0);const s=parseFloat(k.amount);if(isNaN(s)||s<0){S.error("Please enter a valid amount");return}const{error:_}=await P.from("payment_transactions").update({amount:s,currency:k.currency,status:k.status.toUpperCase(),metadata:{...l.metadata,edited:!0,edited_at:new Date().toISOString(),edited_by:m==null?void 0:m.id,notes:k.notes},updated_at:new Date().toISOString()}).eq("id",l.id);if(_)throw _;S.success("Transaction updated successfully"),se(!1),X(),A(null)}catch(s){console.error("Error updating transaction:",s),S.error("Failed to update transaction")}finally{$(!1)}},I=async()=>{if(l)try{$(!0);const{error:s}=await P.from("payment_transactions").delete().eq("id",l.id);if(s)throw s;S.success("Transaction deleted successfully"),ee(!1),X(),A(null)}catch(s){console.error("Error deleting transaction:",s),S.error("Failed to delete transaction")}finally{$(!1)}};return e.jsx(bs,{pageName:"Payment Management",showDetails:!0,children:e.jsx("div",{className:"p-6 flex justify-center",children:e.jsxs("div",{className:"w-full max-w-7xl",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 p-8 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(Le,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Payment Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage payments, providers, and purchase orders"})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx(js,{tabs:[{id:"providers",label:"Payment Accounts",icon:e.jsx(Le,{size:20})},{id:"purchase-orders",label:"Purchase Orders",icon:e.jsx(ft,{size:20})},{id:"history",label:"Transactions",icon:e.jsx(Xe,{size:20})},{id:"expenses",label:"Expenses",icon:e.jsx(ot,{size:20})},{id:"recurring",label:"Recurring",icon:e.jsx(Ze,{size:20})}],activeTab:a,onTabChange:s=>n(s),variant:"modern",size:"md"})}),e.jsxs("div",{children:[a==="providers"&&e.jsx(Xs,{}),a==="purchase-orders"&&e.jsx(Zs,{onViewDetails:s=>{console.log("View purchase order payment details:",s)},onMakePayment:s=>{console.log("Make payment for purchase order:",s),d()},onExport:()=>{console.log("Export purchase order data")}}),a==="expenses"&&e.jsx(Us,{}),a==="recurring"&&e.jsx(ea,{}),a==="history"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Transactions"}),e.jsx("p",{className:"text-gray-600",children:"Track all payment transactions and their status"})]}),e.jsx(oe,{className:"p-4 mb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:f,onChange:s=>C(s.target.value),placeholder:"Search by transaction ID, customer, amount, reference...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-sm"}),f&&e.jsx("button",{onClick:()=>C(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(de,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>U(!v),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium text-sm transition-all duration-200 ${v?"bg-blue-500 text-white shadow-md":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(rt,{className:"w-4 h-4"}),"Filters",(h.status!=="all"||h.provider!=="all"||h.source!=="all"||h.dateRange!=="30")&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-white/20 rounded-full text-xs",children:"Active"})]})]})}),v&&e.jsx(oe,{className:"p-5 mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 min-w-[100px]",children:"Source:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"All"},{value:"pos_sale",label:"POS Sales"},{value:"device_payment",label:"Device Repairs"},{value:"purchase_order",label:"Purchase Orders"}].map(s=>e.jsx("button",{onClick:()=>x(_=>({..._,source:s.value})),className:`px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${h.source===s.value?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-blue-300 hover:text-blue-600"}`,children:s.label},s.value))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 min-w-[100px]",children:"Status:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>x(s=>({...s,status:"all"})),className:`px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${h.status==="all"?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-blue-300 hover:text-blue-600"}`,children:"All"}),e.jsx("button",{onClick:()=>x(s=>({...s,status:"pending"})),className:`px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${h.status==="pending"?"bg-yellow-500 text-white shadow-lg shadow-yellow-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-yellow-300 hover:text-yellow-600"}`,children:"Pending"}),e.jsx("button",{onClick:()=>x(s=>({...s,status:"completed"})),className:`px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${h.status==="completed"?"bg-green-500 text-white shadow-lg shadow-green-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-green-300 hover:text-green-600"}`,children:"Completed"}),e.jsx("button",{onClick:()=>x(s=>({...s,status:"failed"})),className:`px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${h.status==="failed"?"bg-red-500 text-white shadow-lg shadow-red-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-red-300 hover:text-red-600"}`,children:"Failed"}),e.jsx("button",{onClick:()=>x(s=>({...s,status:"cancelled"})),className:`px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${h.status==="cancelled"?"bg-gray-500 text-white shadow-lg shadow-gray-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300 hover:text-gray-600"}`,children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 min-w-[100px]",children:"Payment:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"All"},{value:"Cash",label:"Cash"},{value:"M-Pesa",label:"M-Pesa"},{value:"Tigopesa",label:"Tigopesa"},{value:"Airtel Money",label:"Airtel"},{value:"Bank Transfer",label:"Bank"},{value:"Card",label:"Card"},{value:"Credit",label:"Credit"}].map(s=>e.jsx("button",{onClick:()=>x(_=>({..._,provider:s.value})),className:`px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${h.provider===s.value?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-blue-300 hover:text-blue-600"}`,children:s.label},s.value))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 min-w-[100px]",children:"Period:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"7",label:"7 days"},{value:"30",label:"30 days"},{value:"90",label:"90 days"},{value:"365",label:"1 year"}].map(s=>e.jsx("button",{onClick:()=>x(_=>({..._,dateRange:s.value})),className:`px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${h.dateRange===s.value?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-blue-300 hover:text-blue-600"}`,children:s.label},s.value))})]})]})}),e.jsxs(oe,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:["Transactions (",be.length,")"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>y("timeline"),className:`px-3 py-1.5 rounded-md transition-all flex items-center gap-2 ${i==="timeline"?"bg-white text-indigo-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:"Timeline View",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Timeline"})]}),e.jsxs("button",{onClick:()=>y("table"),className:`px-3 py-1.5 rounded-md transition-all flex items-center gap-2 ${i==="table"?"bg-white text-indigo-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:"Table View",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Table"})]})]}),e.jsx(ye,{onClick:X,disabled:j,children:j?"Loading...":"Refresh"})]})]}),j?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading transactions..."})]}):be.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ’³"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Transactions Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c.length===0?"No payment transactions have been recorded yet.":"No transactions match your current filters."}),c.length>0&&e.jsx(ye,{onClick:()=>x({status:"all",provider:"all",dateRange:"30",source:"all"}),className:"mt-4",children:"Clear Filters"})]}):i==="table"?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Source"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Date",e.jsx(ot,{className:"w-4 h-4 text-blue-600",title:"Most recent first"})]})}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Method"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Reference"})]})}),e.jsx("tbody",{children:be.map((s,_)=>{var ve,Me;const J=s.source==="pos_sale"||s.source==="device_payment",te=s.source==="purchase_order",je=((ve=s.method)==null?void 0:ve.toLowerCase().includes("installment"))||((Me=s.reference)==null?void 0:Me.includes("INS-"));return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>A(s),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:`relative flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-md ${J?"bg-gradient-to-br from-green-500 to-green-600":te?"bg-gradient-to-br from-red-500 to-red-600":"bg-gradient-to-br from-gray-400 to-gray-500"} text-white`,children:[je?_+1:J?e.jsx(ze,{className:"w-5 h-5"}):te?e.jsx(He,{className:"w-5 h-5"}):e.jsx(tt,{className:"w-5 h-5"}),s.status==="completed"&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-white",children:e.jsx(ce,{className:"w-2.5 h-2.5 text-white"})})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 text-lg",children:s.customerName||"N/A"}),s.customerEmail&&e.jsx("div",{className:"text-gray-500 text-xs",children:s.customerEmail})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full font-medium ${s.source==="pos_sale"?"bg-purple-100 text-purple-800":s.source==="device_payment"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:s.source==="pos_sale"?"ðŸ›’ POS":s.source==="device_payment"?"ðŸ”§ Repair":"ðŸ“¦ PO"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"font-semibold text-gray-900",children:_e.money(s.amount)})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[new Date(s.date||s.timestamp).toLocaleDateString(),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.date||s.timestamp).toLocaleTimeString()})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:De(s.method)}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.method})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(qt,{variant:ie(s.status),size:"sm",children:fe(s.status)})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm text-gray-600 font-mono",children:s.reference||"N/A"})})]},s.id)})})]})}):e.jsx("div",{className:"space-y-3 pr-1",children:be.map((s,_)=>{var Oe,Ve;const J=s.source==="pos_sale"||s.source==="device_payment",te=s.source==="purchase_order",je=((Oe=s.method)==null?void 0:Oe.toLowerCase().includes("installment"))||((Ve=s.reference)==null?void 0:Ve.includes("INS-")),ve=T===s.id,Me=s.status==="completed",E=new Date(s.date||s.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:`group relative p-5 rounded-2xl border-2 transition-all duration-200 ${ve?"border-indigo-500 shadow-xl":J?"bg-white border-green-300 shadow-md hover:shadow-lg":te?"bg-white border-red-300 shadow-md hover:shadow-lg":"bg-white border-gray-200 shadow-md hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>Q(ve?null:s.id),children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:`relative flex-shrink-0 w-14 h-14 rounded-full flex items-center justify-center font-bold text-lg shadow-lg ${J?"bg-gradient-to-br from-green-500 to-green-600":te?"bg-gradient-to-br from-red-500 to-red-600":"bg-gradient-to-br from-gray-400 to-gray-500"} text-white`,children:[je?_+1:J?e.jsx(ze,{className:"w-6 h-6"}):te?e.jsx(He,{className:"w-6 h-6"}):e.jsx(tt,{className:"w-6 h-6"}),Me&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center border-2 border-white",children:e.jsx(ce,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"w-4 h-4 flex-shrink-0 text-gray-600"}),e.jsx("div",{className:"text-base font-bold text-gray-900",children:E})]}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:s.customerName||"N/A"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase ${s.source==="pos_sale"?"bg-purple-100 text-purple-800 border border-purple-200":s.source==="device_payment"?"bg-green-100 text-green-800 border border-green-200":"bg-orange-100 text-orange-800 border border-orange-200"}`,children:s.source==="pos_sale"?"ðŸ›’ POS":s.source==="device_payment"?"ðŸ”§ Repair":"ðŸ“¦ PO"}),Me&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold uppercase bg-green-100 text-green-800 border border-green-200",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),"Completed"]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right ml-4",children:[e.jsxs("div",{className:`text-2xl font-bold mb-1 ${J?"text-green-700":"text-red-700"}`,children:[J?"+":"-",_e.money(Math.abs(s.amount))]}),e.jsx("div",{className:"text-xs text-gray-500 font-medium mt-1",children:s.method||"N/A"}),s.reference&&e.jsx("div",{className:"text-xs text-gray-500 font-mono mt-1",children:s.reference})]})]}),_<be.length-1&&e.jsx("div",{className:`absolute left-7 top-full w-0.5 h-3 ${J?"bg-green-300":te?"bg-red-300":"bg-gray-300"}`})]},s.id)})})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 pt-16 animate-fadeIn",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[85vh] overflow-hidden animate-slideUp",children:[e.jsxs("div",{className:"relative bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 px-8 py-6 text-white",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsxs("div",{className:"relative flex items-start justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(Se,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Payment Transaction"}),e.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Complete transaction details"})]})]})}),e.jsx("button",{onClick:()=>A(null),className:"w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg transition-all flex items-center justify-center group",children:e.jsx(de,{className:"w-5 h-5 text-white group-hover:rotate-90 transition-transform duration-300"})})]}),e.jsx("div",{className:"relative mt-4",children:e.jsx(qt,{variant:ie(l.status),size:"lg",children:e.jsxs("span",{className:"text-base font-semibold px-3 py-1 flex items-center gap-2",children:[l.status.toLowerCase()==="success"||l.status.toLowerCase()==="completed"?e.jsx(ce,{className:"w-4 h-4"}):l.status.toLowerCase()==="pending"?e.jsx(Ge,{className:"w-4 h-4"}):e.jsx(ss,{className:"w-4 h-4"}),fe(l.status)]})})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(85vh-280px)] px-8 py-6 bg-gray-50",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500 via-teal-600 to-cyan-600 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full -ml-24 -mb-24"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(pe,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium opacity-90",children:"Transaction Amount"})]}),e.jsx("div",{className:"text-5xl font-bold mb-2",children:_e.money(l.amount)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-sm font-medium",children:l.source==="pos_sale"?"ðŸ›’ POS Sale":l.source==="device_payment"?"ðŸ”§ Device Repair":"ðŸ“¦ Purchase Order"}),e.jsxs("span",{className:"text-sm opacity-75",children:["â€¢ ",new Date(l.date||l.timestamp).toLocaleDateString()]})]})]})]}),((V=(re=l.metadata)==null?void 0:re.details)==null?void 0:V.payments)&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-600"}),"Payment Details"]}),e.jsxs("div",{className:"space-y-4",children:[l.metadata.details.payments.map((s,_)=>e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Se,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{className:"font-semibold text-gray-900",children:s.method})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-lg font-bold text-gray-900",children:_e.money(s.amount)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Account ID:"}),e.jsx("span",{className:"font-mono text-gray-900 break-all",children:s.accountId})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Timestamp:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(s.timestamp).toLocaleString()})]})]})]},_)),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-green-600"})}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Paid"})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xl font-bold text-green-700",children:_e.money(l.metadata.details.totalPaid)})})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-600"}),"Transaction Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(pt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Transaction ID"}),e.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 break-all",children:l.transactionId})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ht,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Payment Method"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:De(l.method)}),e.jsx("span",{className:"font-semibold text-gray-900",children:l.method})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Reference"}),e.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 break-all",children:l.reference||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ke,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Served By"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:l.cashier||"N/A"})]})]}),l.source==="device_payment"&&l.deviceName&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ft,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Device"}),e.jsx("div",{className:"font-semibold text-gray-900",children:l.deviceName})]})]}),l.source==="purchase_order"&&e.jsxs(e.Fragment,{children:[l.purchaseOrderNumber&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Purchase Order"}),e.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 break-all",children:l.purchaseOrderNumber})]})]}),l.supplierName&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ht,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Supplier"}),e.jsx("div",{className:"font-semibold text-gray-900",children:l.supplierName})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-blue-600"}),"Customer Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ke,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Customer Name"}),e.jsx("div",{className:"font-semibold text-gray-900",children:l.customerName||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(As,{className:"w-5 h-5 text-teal-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Phone Number"}),e.jsx("div",{className:"font-semibold text-gray-900",children:l.customerPhone||"N/A"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-5 h-5 text-blue-600"}),"Transaction Timeline"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Transaction Date"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:new Date(l.date||l.timestamp).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),l.createdAt&&e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(et,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Record Created"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:new Date(l.createdAt).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),l.status==="completed"&&e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Status"}),e.jsx("div",{className:"text-sm font-semibold text-green-700",children:"Completed"})]})]})]})]}),l.metadata&&Object.keys(l.metadata).length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-600"}),"Additional Information"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(l.metadata).map(([s,_])=>{var J;if(s==="paymentMethod"&&typeof _=="object"&&_!==null){const te=_;return te.type==="multiple"&&((J=te.details)!=null&&J.payments)?e.jsxs("div",{className:"md:col-span-2 p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-blue-600"}),"Multiple Payment Methods Breakdown"]}),e.jsxs("div",{className:"space-y-2",children:[te.details.payments.map((je,ve)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:De(je.method)}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:je.method})]}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:_e.money(je.amount)})]},ve)),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg border-t-2 border-green-200 mt-2",children:[e.jsx("span",{className:"text-sm font-bold text-green-800",children:"Total Paid"}),e.jsx("span",{className:"text-base font-bold text-green-800",children:_e.money(te.details.totalPaid)})]})]})]},s):null}return e.jsxs("div",{className:"flex items-start justify-between gap-4 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 capitalize",children:s.replace(/_/g," ")}),e.jsx("span",{className:"text-sm font-semibold text-gray-900 text-right break-all",children:typeof _=="object"?JSON.stringify(_,null,2):String(_)})]},s)})})]}),l.pos_session_id&&e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl shadow-sm border border-orange-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx($s,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"POS Session"})]}),e.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 bg-white/50 rounded-lg p-3 break-all",children:l.pos_session_id})]})]})}),e.jsxs("div",{className:"bg-white border-t border-gray-200 px-8 py-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 mb-5",children:[e.jsxs("button",{onClick:()=>Ee(l),className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 text-gray-700 rounded-xl hover:from-gray-100 hover:to-gray-200 hover:border-gray-300 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(jt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy"})]}),e.jsxs("button",{onClick:()=>u(l),className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 text-gray-700 rounded-xl hover:from-gray-100 hover:to-gray-200 hover:border-gray-300 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(Fs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Print"})]}),e.jsxs("button",{onClick:()=>L(l),className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 text-gray-700 rounded-xl hover:from-gray-100 hover:to-gray-200 hover:border-gray-300 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(Ms,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Share"})]}),e.jsxs("button",{onClick:()=>q(l),className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(Os,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Edit"})]}),(l.status.toLowerCase()==="success"||l.status.toLowerCase()==="completed")&&e.jsxs("button",{onClick:()=>Z(l),disabled:b,className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl hover:from-orange-700 hover:to-orange-800 transition-all shadow-sm hover:shadow-md font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:b?"Processing...":"Refund"})]}),e.jsxs("button",{onClick:z,className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(St,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:"ID:"}),e.jsx("span",{className:"font-mono font-semibold text-gray-900 bg-gray-100 px-3 py-1 rounded-lg",children:l.id})]}),e.jsx("button",{onClick:()=>A(null),className:"px-6 py-2.5 bg-gradient-to-r from-gray-700 to-gray-800 text-white rounded-xl hover:from-gray-800 hover:to-gray-900 transition-all shadow-sm hover:shadow-md font-medium",children:"Close"})]})]})]})}),e.jsx(ns,{isOpen:G,onClose:()=>se(!1),title:"Edit Transaction",footer:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(ye,{variant:"secondary",onClick:()=>se(!1),children:"Cancel"}),e.jsx(ye,{onClick:D,disabled:b,children:b?"Saving...":"Save Changes"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",value:k.amount,onChange:s=>R({...k,amount:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter amount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsxs("select",{value:k.currency,onChange:s=>R({...k,currency:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"TZS",children:"TZS - Tanzanian Shilling"}),e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:k.status,onChange:s=>R({...k,status:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"success",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:k.notes,onChange:s=>R({...k,notes:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Enter notes or description"})]})]})}),e.jsx(zs,{isOpen:H,onClose:()=>ee(!1),onConfirm:I,title:"Delete Transaction",message:"Are you sure you want to delete this transaction? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",type:"danger",loading:b})]})})})},Nt=document.createElement("style");Nt.textContent=`
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-fadeIn {
    animation: fadeIn 0.2s ease-out;
  }
  
  .animate-slideUp {
    animation: slideUp 0.3s ease-out;
  }
`;typeof document<"u"&&!document.getElementById("payment-modal-animations")&&(Nt.id="payment-modal-animations",document.head.appendChild(Nt));export{Sa as default};
