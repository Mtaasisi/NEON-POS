import{u as we,a0 as Se,a1 as _e,X as ae,s as b,M as X,Z as q,j as e,G as _,e as E}from"./index-61458a34.js";import{r as l,R as Q}from"./vendor-36d2c7c1.js";import{G as R}from"./GlassInput-0475021a.js";import{G as z}from"./GlassSelect-e243562f.js";import{M as Ae}from"./Modal-a5e4c1ba.js";import{n as p,bg as ne,R as Fe,N as re,D as Te,Y as De,y as Le,b_ as Ie,b7 as G,aA as Y,q as ce,v as Pe,A as oe,aE as $e,a3 as A,r as Re,at as Oe,d as ke,f as He,b2 as Me,x as Be,u as Xe,Q as qe,U as ze,H as Ge,a2 as Ve}from"./ui-28e30067.js";import{u as Ue,S as Ze}from"./useSuccessModal-081786c4.js";const st=()=>{const{currentUser:x}=we(),J=Ue(),u=Se(),K=_e(),[j,F]=l.useState([]),[O,T]=l.useState([]),[V,le]=l.useState([]),[ie,D]=l.useState(!0),[de,N]=l.useState("Initializing..."),[me,C]=l.useState(!1),[L,xe]=l.useState(""),[I,ue]=l.useState("all"),[P,pe]=l.useState("all");l.useState("30");const[U,ge]=l.useState(!1),[k,W]=l.useState([]),[Z,he]=l.useState("all"),fe=l.useRef(0),[o,ee]=l.useState({account_id:"",category:"",description:"",amount:"",expense_date:new Date().toISOString().split("T")[0],vendor_name:"",reference_number:"",notes:""}),a=l.useCallback((t,s,n,r,m)=>{const i={id:`log-${fe.current++}`,timestamp:new Date().toISOString(),type:t,category:s,message:n,data:r,duration:m};W(d=>[i,...d].slice(0,100));const c={info:"color: #3B82F6",success:"color: #10B981",error:"color: #EF4444",warning:"color: #F59E0B",api:"color: #8B5CF6"};console.log(`%c[${s}] ${n}`,c[t],r||"")},[]),H=t=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),w=l.useCallback(async()=>{const t=performance.now();a("api","FETCH_EXPENSES","Starting to fetch expenses...");try{D(!0),a("info","FETCH_EXPENSES","Loading state set to true");const s=await ae.getPaymentMethods(),n=[...new Set(s.map(c=>c.id))];if(n.length===0){a("info","FETCH_EXPENSES","No accounts for current branch; returning empty list"),F([]),D(!1);return}const{data:r,error:m}=await b.from("account_transactions").select("*").eq("transaction_type","expense").in("account_id",n).order("created_at",{ascending:!1}).limit(100);if(m)throw a("error","FETCH_EXPENSES","Supabase query failed",m),m;if(a("success","FETCH_EXPENSES",`Fetched ${(r==null?void 0:r.length)||0} expense transactions`,{count:r==null?void 0:r.length,transactions:r==null?void 0:r.slice(0,3)}),r&&r.length>0){const c=[...new Set(r.map(d=>d.account_id).filter(Boolean))];if(a("info","FETCH_EXPENSES",`Found ${c.length} unique account IDs`,c),c.length>0){const{data:d,error:f}=await b.from("finance_accounts").select("id, name, type, currency").in("id",c);if(!f&&d){a("success","FETCH_EXPENSES",`Fetched ${d.length} account details`,d);const v=new Map(d.map(y=>[y.id,y])),B=r.map(y=>({...y,finance_accounts:y.account_id?v.get(y.account_id):null}));F(B),a("success","FETCH_EXPENSES","Successfully mapped accounts to expenses")}else a("warning","FETCH_EXPENSES","Account fetch failed, showing expenses without account details",f),F(r)}else F(r)}else a("info","FETCH_EXPENSES","No expense transactions found"),F([]);const i=performance.now()-t;a("success","FETCH_EXPENSES","Fetch completed successfully",{totalExpenses:(r==null?void 0:r.length)||0},i)}catch(s){const n=performance.now()-t;a("error","FETCH_EXPENSES","Failed to load expenses",s,n),console.error("Error fetching expenses:",s),p.error("Failed to load expenses")}finally{D(!1),a("info","FETCH_EXPENSES","Loading state set to false")}},[a]);l.useEffect(()=>{const t=X();a("info","INIT",`Loading payment accounts for branch: ${t||"none"}`),a("info","INIT",`Preloaded accounts available: ${(u==null?void 0:u.length)||0}`),u&&u.length>0?(a("info","INIT",`Using preloaded accounts: ${u.length} (already filtered by server)`),a("info","INIT",`Accounts: ${u.map(s=>`${s.name}(branch:${s.branch_id})`).join(", ")}`),T(u)):(a("warning","INIT","No preloaded payment accounts, fetching directly..."),$())},[u,a]);const[M,ye]=l.useState(X());l.useEffect(()=>{const s=setInterval(()=>{const n=X();n!==M&&(a("info","BRANCH_CHANGE",`Branch changed from ${M} to ${n}, reloading payment accounts`),ye(n),T([]),K.setPaymentAccounts([]),q(`payment-methods-${n||"all"}`),q(`payment-methods-${M||"all"}`),q("payment-methods-all"),$())},2e3);return()=>clearInterval(s)},[M,a,K]);const $=l.useCallback(async()=>{const t=performance.now(),s=X();a("api","FETCH_ACCOUNTS",`Fetching payment accounts for branch: ${s||"none"}`);try{const n=`payment-methods-${s||"all"}`;if(q(n),a("info","FETCH_ACCOUNTS",`Cleared cache for key: ${n}`),u&&u.length>0){a("info","FETCH_ACCOUNTS",`Using preloaded accounts: ${u.length} (already filtered by server)`),T(u);return}a("info","FETCH_ACCOUNTS","No preloaded accounts, calling financeAccountService.getPaymentMethods()...");const r=await ae.getPaymentMethods();a("success","FETCH_ACCOUNTS",`Service returned ${r.length} accounts (already filtered by server based on isolation settings):`,r),T(r);const m=performance.now()-t;a("success","FETCH_ACCOUNTS",`Fetch completed in ${m.toFixed(2)}ms`)}catch(n){const r=performance.now()-t;a("error","FETCH_ACCOUNTS","Failed to fetch payment accounts",n,r),console.error("Error fetching payment accounts:",n),T([])}},[a,u]),te=l.useCallback(async()=>{const t=performance.now();a("api","FETCH_CATEGORIES","Fetching expense categories...");try{const{data:s,error:n}=await b.from("expense_categories").select("*").eq("is_active",!0).order("name");if(n)throw a("error","FETCH_CATEGORIES","Supabase query failed",n),n;le(s||[]);const r=performance.now()-t;a("success","FETCH_CATEGORIES",`Fetched ${(s==null?void 0:s.length)||0} active categories`,{categories:s==null?void 0:s.map(m=>m.name)},r)}catch(s){const n=performance.now()-t;a("error","FETCH_CATEGORIES","Failed to fetch expense categories",s,n),console.error("Error fetching expense categories:",s)}},[a]);l.useEffect(()=>{a("info","LIFECYCLE","Component mounted, initializing optimized parallel data fetch"),(async()=>{const s=performance.now();try{N("Loading expense data...");const[n,r,m]=await Promise.allSettled([w().then(()=>{N("Expenses loaded...")}).catch(c=>{console.error("❌ Failed to load expenses:",c),a("error","PARALLEL_LOAD","Expenses load failed",c)}),$().then(()=>{N("Payment accounts loaded...")}).catch(c=>{console.error("❌ Failed to load payment accounts:",c),a("error","PARALLEL_LOAD","Payment accounts load failed",c)}),te().then(()=>{N("Categories loaded...")}).catch(c=>{console.error("❌ Failed to load expense categories:",c),a("error","PARALLEL_LOAD","Expense categories load failed",c)})]);N("Finalizing...");const i=performance.now()-s;a("success","PARALLEL_LOAD",`All data loaded in parallel (${i.toFixed(2)}ms)`,{expensesSuccess:n.status==="fulfilled",accountsSuccess:r.status==="fulfilled",categoriesSuccess:m.status==="fulfilled"}),N("Complete!"),setTimeout(()=>D(!1),500)}catch(n){a("error","PARALLEL_LOAD","Parallel data loading failed",n),console.error("❌ [ExpenseManagement] Parallel loading error:",n),D(!1),N("")}})()},[w,te,a]);const h=(t,s)=>{a("info","FORM",`Field "${t}" changed`,{field:t,value:s}),ee(n=>({...n,[t]:s}))},be=async()=>{const t=performance.now();a("api","ADD_EXPENSE","Starting expense creation...",o);try{if(!o.account_id||!o.amount||!o.description){a("warning","ADD_EXPENSE","Validation failed: Missing required fields",{account_id:!!o.account_id,amount:!!o.amount,description:!!o.description}),p.error("Please fill in all required fields");return}const s=parseFloat(o.amount);if(isNaN(s)||s<=0){a("warning","ADD_EXPENSE","Validation failed: Invalid amount",{amount:o.amount}),p.error("Please enter a valid amount");return}a("info","ADD_EXPENSE","Validation passed, inserting into database",{amount:s,account_id:o.account_id,category:o.category});const n=(x==null?void 0:x.role)==="admin",r=n?"approved":"pending",{data:m,error:i}=await b.from("account_transactions").insert({account_id:o.account_id,transaction_type:"expense",amount:s,description:`${o.category?o.category+": ":""}${o.description}`,reference_number:o.reference_number||null,status:r,metadata:{category:o.category||null,vendor_name:o.vendor_name||null,notes:o.notes||null,expense_date:o.expense_date,approval_status:r,requires_approval:!n},created_by:x==null?void 0:x.id}).select().single();if(i)throw a("error","ADD_EXPENSE","Database insert failed",i),i;const c=performance.now()-t;a("success","ADD_EXPENSE","Expense created successfully!",{expenseId:m.id,amount:s,category:o.category,status:r},c),a("info","ADD_EXPENSE","Resetting form and refreshing data"),ee({account_id:"",category:"",description:"",amount:"",expense_date:new Date().toISOString().split("T")[0],vendor_name:"",reference_number:"",notes:""}),C(!1),w(),$();const d=n?`Expense of ${s.toLocaleString("en-TZ",{style:"currency",currency:"TZS"})} has been recorded successfully!`:`Expense of ${s.toLocaleString("en-TZ",{style:"currency",currency:"TZS"})} has been submitted for admin approval!`;J.show(d,{title:n?"Expense Recorded":"Expense Submitted",actionButtons:[{label:"View Expenses",onClick:()=>{},variant:"primary"},{label:"Add Another",onClick:()=>C(!0),variant:"secondary"}]})}catch(s){const n=performance.now()-t;a("error","ADD_EXPENSE","Failed to record expense",s,n),console.error("Error adding expense:",s),p.error(s.message||"Failed to record expense")}},je=async t=>{try{if((x==null?void 0:x.role)!=="admin"){p.error("Only admins can approve expenses");return}const{error:s}=await b.from("account_transactions").update({status:"approved",metadata:b.raw(`metadata || '{"approval_status": "approved", "approved_by": "${x.id}", "approved_at": "${new Date().toISOString()}"}'::jsonb`)}).eq("id",t);if(s)throw s;p.success("Expense approved successfully!"),w(),$()}catch(s){console.error("Error approving expense:",s),p.error("Failed to approve expense")}},Ne=async(t,s)=>{try{if((x==null?void 0:x.role)!=="admin"){p.error("Only admins can reject expenses");return}const{error:n}=await b.from("account_transactions").update({status:"rejected",metadata:b.raw(`metadata || '{"approval_status": "rejected", "rejected_by": "${x.id}", "rejected_at": "${new Date().toISOString()}", "rejection_reason": "${s||"No reason provided"}"}'::jsonb`)}).eq("id",t);if(n)throw n;p.success("Expense rejected"),w()}catch(n){console.error("Error rejecting expense:",n),p.error("Failed to reject expense")}},g=Q.useMemo(()=>{a("info","FILTER","Filtering expenses",{searchQuery:L,categoryFilter:I,accountFilter:P});const t=j.filter(s=>{var c,d,f,v;const n=((c=s.description)==null?void 0:c.toLowerCase().includes(L.toLowerCase()))||((d=s.reference_number)==null?void 0:d.toLowerCase().includes(L.toLowerCase())),r=P==="all"||s.account_id===P,m=((f=s.metadata)==null?void 0:f.category)||(((v=s.description)==null?void 0:v.split(":")[0])||"").trim();return n&&r&&(I==="all"||m===I)});return a("success","FILTER",`Filtered to ${t.length} expenses`,{total:j.length,filtered:t.length}),t},[j,L,I,P,a]),S=Q.useMemo(()=>{const t=g.reduce((i,c)=>i+Number(c.amount),0),s=g.length,n={};g.forEach(i=>{var d;const c=((d=i.metadata)==null?void 0:d.category)||"Other";n[c]=(n[c]||0)+Number(i.amount)});const r={};g.forEach(i=>{var d;const c=((d=i.finance_accounts)==null?void 0:d.name)||"Unknown";r[c]=(r[c]||0)+Number(i.amount)});const m={totalExpenses:t,expenseCount:s,byCategory:n,byAccount:r};return a("info","STATS","Calculated summary statistics",m),m},[g,a]),ve=t=>({Rent:Y,Utilities:Be,Supplies:Xe,Transportation:qe,Salaries:ze,Maintenance:Ge,Marketing:A,Insurance:Ve,Taxes:G,Other:A})[t]||A,Ee=()=>{W([]),a("info","DEBUG","Debug logs cleared")},Ce=()=>{const t=JSON.stringify(k,null,2),s=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(s),r=document.createElement("a");r.href=n,r.download=`expense-debug-logs-${new Date().toISOString()}.json`,r.click(),a("success","DEBUG","Debug logs exported")};if(ie)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-gray-600",children:de})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Please wait while we load your expense data..."})]});const se=Z==="all"?k:k.filter(t=>t.type===Z);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Expense Management"}),e.jsx("p",{className:"text-gray-600",children:"Track and manage business expenses"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{onClick:()=>ge(!U),variant:U?"primary":"secondary",className:"flex items-center gap-2",children:[e.jsx(ne,{size:16}),"Debug"]}),e.jsxs(_,{onClick:w,variant:"secondary",children:[e.jsx(Fe,{size:16}),"Refresh"]}),e.jsxs(_,{onClick:()=>C(!0),children:[e.jsx(re,{size:16}),"Add Expense"]})]})]}),U&&e.jsxs(E,{className:"p-6 bg-gray-900 text-white border-2 border-indigo-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-indigo-400"}),e.jsx("h3",{className:"text-lg font-semibold text-indigo-400",children:"Debug Panel"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",k.length," logs)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Ce,className:"px-3 py-1 text-sm bg-indigo-600 hover:bg-indigo-700 rounded flex items-center gap-1",children:[e.jsx(Te,{size:14}),"Export"]}),e.jsxs("button",{onClick:Ee,className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 rounded flex items-center gap-1",children:[e.jsx(De,{size:14}),"Clear"]})]})]}),e.jsx("div",{className:"flex gap-2 mb-4",children:["all","info","success","error","warning","api"].map(t=>e.jsx("button",{onClick:()=>he(t),className:`px-3 py-1 text-xs rounded capitalize ${Z===t?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:t},t))}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 p-4 bg-gray-800 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Total Expenses"}),e.jsx("div",{className:"text-lg font-bold",children:j.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Filtered"}),e.jsx("div",{className:"text-lg font-bold",children:g.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Categories"}),e.jsx("div",{className:"text-lg font-bold",children:V.length})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:se.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No debug logs yet"}):se.map(t=>{const s={info:"text-blue-400 bg-blue-900/30",success:"text-green-400 bg-green-900/30",error:"text-red-400 bg-red-900/30",warning:"text-yellow-400 bg-yellow-900/30",api:"text-purple-400 bg-purple-900/30"},r={info:Oe,success:ke,error:He,warning:oe,api:Me}[t.type];return e.jsx("div",{className:`p-3 rounded border ${s[t.type]} border-opacity-50`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(r,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 mb-1",children:[e.jsx(Le,{size:12}),e.jsx("span",{children:new Date(t.timestamp).toLocaleTimeString()}),e.jsx("span",{className:"font-mono bg-gray-800 px-2 py-0.5 rounded",children:t.category}),t.duration&&e.jsxs("span",{className:"text-green-400",children:[t.duration.toFixed(2),"ms"]})]}),e.jsx("div",{className:"text-sm font-medium mb-1",children:t.message}),t.data&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-gray-400 hover:text-gray-300",children:"View Data"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-950 rounded overflow-x-auto text-xs",children:JSON.stringify(t.data,null,2)})]})]})]})},t.id)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(E,{className:"p-6 bg-gradient-to-br from-red-50 to-red-100 border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Total Expenses"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:H(S.totalExpenses)})]}),e.jsx("div",{className:"p-3 bg-red-500 rounded-lg",children:e.jsx(Ie,{className:"w-6 h-6 text-white"})})]})}),e.jsx(E,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Expense Count"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:S.expenseCount})]}),e.jsx("div",{className:"p-3 bg-blue-500 rounded-lg",children:e.jsx(G,{className:"w-6 h-6 text-white"})})]})}),e.jsx(E,{className:"p-6 bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Categories"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:Object.keys(S.byCategory).length})]}),e.jsx("div",{className:"p-3 bg-purple-500 rounded-lg",children:e.jsx(Y,{className:"w-6 h-6 text-white"})})]})}),e.jsx(E,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Avg per Expense"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:H(S.expenseCount>0?S.totalExpenses/S.expenseCount:0)})]}),e.jsx("div",{className:"p-3 bg-green-500 rounded-lg",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]})})]}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search expenses...",value:L,onChange:t=>{xe(t.target.value),a("info","SEARCH",`Search query changed: "${t.target.value}"`)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{value:P,onChange:t=>{pe(t.target.value),a("info","FILTER",`Account filter changed: "${t.target.value}"`)},className:"min-w-[160px]",children:[e.jsx("option",{value:"all",children:"All Accounts"}),O.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs(z,{value:I,onChange:t=>{ue(t.target.value),a("info","FILTER",`Category filter changed: "${t.target.value}"`)},className:"min-w-[160px]",children:[e.jsx("option",{value:"all",children:"All Categories"}),V.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]})]})]})}),e.jsxs(E,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Recent Expenses (",g.length,")"]}),g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mb-4 inline-block p-6 bg-gray-100 rounded-full",children:e.jsx(G,{className:"w-16 h-16 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Expenses Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:j.length===0?"No expenses have been recorded yet.":"No expenses match your current filters."}),j.length===0&&O.length===0&&e.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 mb-2",children:[e.jsx(oe,{size:16}),e.jsx("span",{className:"font-medium",children:"No Payment Accounts Found"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"You need payment accounts to record expenses. Go to Payment Account Management to create accounts for your branch."}),e.jsxs("a",{href:"/payments/accounts",className:"inline-flex items-center gap-2 px-3 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 rounded-lg text-sm font-medium transition-colors",children:[e.jsx($e,{size:14}),"Manage Payment Accounts"]})]}),j.length===0&&O.length>0&&e.jsxs(_,{onClick:()=>C(!0),children:[e.jsx(re,{size:16}),"Add Your First Expense"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Category"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Account"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Reference"}),(x==null?void 0:x.role)==="admin"&&e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:g.map(t=>{var c,d,f,v,B;const s=((c=t.metadata)==null?void 0:c.category)||"Other",n=((d=t.finance_accounts)==null?void 0:d.name)||"Unknown",r=t.status||((f=t.metadata)==null?void 0:f.approval_status)||"approved",m={pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Pending"},approved:{bg:"bg-green-100",text:"text-green-800",label:"Approved"},rejected:{bg:"bg-red-100",text:"text-red-800",label:"Rejected"}},i=m[r]||m.approved;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${i.bg} ${i.text}`,children:i.label})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[Q.createElement(ve(s),{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s})]})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.description}),((v=t.metadata)==null?void 0:v.vendor_name)&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Vendor: ",t.metadata.vendor_name]}),((B=t.metadata)==null?void 0:B.rejection_reason)&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Reason: ",t.metadata.rejection_reason]})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-700",children:n})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm font-semibold text-red-600",children:H(t.amount)})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleTimeString()})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-xs text-gray-600 font-mono",children:t.reference_number||"N/A"})}),(x==null?void 0:x.role)==="admin"&&e.jsxs("td",{className:"py-3 px-4",children:[r==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>je(t.id),className:"px-3 py-1 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded transition-colors",children:"Approve"}),e.jsx("button",{onClick:()=>{const y=prompt("Rejection reason (optional):");Ne(t.id,y||void 0)},className:"px-3 py-1 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded transition-colors",children:"Reject"})]}),r==="approved"&&e.jsx("span",{className:"text-xs text-green-600",children:"✓ Approved"}),r==="rejected"&&e.jsx("span",{className:"text-xs text-red-600",children:"✗ Rejected"})]})]},t.id)})})]})})]}),e.jsx(Ae,{isOpen:me,onClose:()=>{C(!1),a("info","MODAL","Add expense modal closed")},title:"Add New Expense",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Account *"}),e.jsx(z,{value:o.account_id,onChange:t=>h("account_id",t),placeholder:"Select Account",options:O.map(t=>({value:t.id,label:`${t.name} - ${H(t.balance||0)}`})),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(A,{className:"w-4 h-4"}),"Category *"]}),e.jsx(z,{value:o.category,onChange:t=>h("category",t),placeholder:"Select Category",options:V.map(t=>({value:t.name,label:t.name})),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(A,{className:"w-4 h-4"}),"Description *"]}),e.jsx(R,{type:"text",value:o.description,onChange:t=>h("description",t.target.value),placeholder:"e.g., October rent payment",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ce,{className:"w-4 h-4"}),"Amount (TSh) *"]}),e.jsx(R,{type:"number",value:o.amount,onChange:t=>h("amount",t.target.value),placeholder:"0.00",min:"0",step:"0.01",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Y,{className:"w-4 h-4"}),"Vendor Name"]}),e.jsx(R,{type:"text",value:o.vendor_name,onChange:t=>h("vendor_name",t.target.value),placeholder:"Vendor or supplier name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(G,{className:"w-4 h-4"}),"Reference Number"]}),e.jsx(R,{type:"text",value:o.reference_number,onChange:t=>h("reference_number",t.target.value),placeholder:"e.g., INV-2025-001"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Re,{className:"w-4 h-4"}),"Expense Date"]}),e.jsx(R,{type:"date",value:o.expense_date,onChange:t=>h("expense_date",t.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(A,{className:"w-4 h-4"}),"Notes"]}),e.jsx("textarea",{value:o.notes,onChange:t=>h("notes",t.target.value),placeholder:"Additional notes...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(_,{variant:"secondary",onClick:()=>{C(!1),a("info","MODAL","Add expense cancelled")},children:"Cancel"}),e.jsx(_,{onClick:be,children:"Add Expense"})]})]})}),e.jsx(Ze,{...J.props})]})};export{st as E};
