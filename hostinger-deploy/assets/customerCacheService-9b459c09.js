const n="1.3";const d=class r{saveCustomers(s){try{const t=s.slice(0,1e3).map(a=>({id:a.id,name:a.name,phone:a.phone,email:a.email,branch_id:a.branch_id,created_at:a.created_at})),i=JSON.stringify(t),o=new Blob([i]).size;let c;o>4194304?(console.log(`üì¶ [CustomerCache] Compressing ${o} bytes to fit within 4194304 limit`),c={data:t.slice(0,Math.floor(1e3*.7)).map(m=>({id:m.id,name:m.name,phone:m.phone})),timestamp:Date.now(),version:n,compressed:!0}):c={data:t,timestamp:Date.now(),version:n,compressed:!1};const C=JSON.stringify(c),l=new Blob([C]).size;if(l>4194304){console.warn(`‚ö†Ô∏è [CustomerCache] Data still too large (${l} bytes), clearing cache`),this.clearCustomers();return}localStorage.setItem(r.CUSTOMERS_KEY,C),console.log(`‚úÖ [CustomerCache] Saved ${c.data.length} customers (${l} bytes, compressed: ${c.compressed})`)}catch(e){if(console.warn("‚ö†Ô∏è [CustomerCache] Failed to save customers:",e),e instanceof Error&&e.name==="QuotaExceededError")try{this.clearCustomers();const t=s.slice(0,100).map(o=>({id:o.id,name:o.name,phone:o.phone})),i={data:t,timestamp:Date.now(),version:n,compressed:!0};localStorage.setItem(r.CUSTOMERS_KEY,JSON.stringify(i)),console.log(`‚úÖ [CustomerCache] Saved minimal ${t.length} customers after quota error`)}catch(t){console.warn("‚ö†Ô∏è [CustomerCache] Failed to save even minimal data:",t)}}}getCustomers(){try{const s=localStorage.getItem(r.CUSTOMERS_KEY);if(!s)return null;const e=JSON.parse(s);if(e.version!==n)return console.log("üîÑ [CustomerCache] Cache version mismatch, clearing old cache"),this.clearCustomers(),null;const t=Date.now()-e.timestamp;return t>9e5?(console.log(`‚úÖ [CustomerCache] Cache expired (${Math.round(t/1e3)}s old)`),this.clearCustomers(),null):(console.log(`‚úÖ [CustomerCache] Using cached customers (${Math.round(t/1e3)}s old, ${e.data.length} customers, compressed: ${e.compressed||!1})`),e.data)}catch(s){return console.warn("‚ö†Ô∏è [CustomerCache] Failed to read customers cache:",s),this.clearCustomers(),null}}clearCustomers(){localStorage.removeItem(r.CUSTOMERS_KEY)}getCacheAge(){try{const s=localStorage.getItem(r.CUSTOMERS_KEY);if(!s)return 1/0;const e=JSON.parse(s);return Date.now()-e.timestamp}catch{return 1/0}}};d.CUSTOMERS_KEY="pos_customers_cache";let h=d;const u=new h;export{u as customerCacheService};
