import{u as M,y as G,s as L,j as e,e as g}from"./index-61458a34.js";import{r as d,R as P}from"./vendor-36d2c7c1.js";import{B as w}from"./BackButton-02a80e74.js";import{u as B,E as Y,m as $}from"./officeConfig-bc48d4a3.js";import{n as i,e as q,at as k,as as z,d as y,y as C,r as D,aq as W,f as X,c2 as K,aX as S,aY as _}from"./ui-28e30067.js";import{e as f}from"./employeeService-efe40e70.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";import"./attendanceSettingsApi-f03692b4.js";const ne=()=>{var b;const{currentUser:s}=M();G();const{settings:T}=B(),[a,R]=d.useState(null),[x,H]=d.useState([]),[F,j]=d.useState(!0),[r,A]=d.useState(null);d.useEffect(()=>{p()},[s]);const p=async()=>{if(s!=null&&s.id){j(!0);try{const{data:t,error:o}=await L.from("employees").select("*").eq("user_id",s.id).single();if(o||!t){o?console.error("Error fetching employee record:",o):console.warn(`No employee record found for user ${s.id}. User account needs to be linked to an employee.`),i.error("Employee record not found. Please contact HR.");return}R(t);const c=await f.getAttendanceByEmployeeId(t.id);H(c);const m=new Date().toISOString().split("T")[0],u=c.find(n=>n.attendanceDate===m);A(u||null)}catch(t){console.error("Failed to load employee data:",t),i.error("Failed to load attendance data")}finally{j(!1)}}},I=async(t,o)=>{try{await f.checkIn(t),await p(),i.success("Checked in successfully! Have a great day! ðŸŽ‰")}catch(c){console.error("Check-in failed:",c),i.error("Check-in failed. Please try again.")}},E=async(t,o)=>{try{await f.checkOut(t),await p(),i.success("Checked out successfully! See you tomorrow! ðŸ‘‹")}catch(c){console.error("Check-out failed:",c),i.error("Check-out failed. Please try again.")}},l=P.useMemo(()=>{const t=x.filter(n=>{const h=new Date(n.attendanceDate),v=new Date;return h.getMonth()===v.getMonth()&&h.getFullYear()===v.getFullYear()}),o=t.filter(n=>n.status==="present").length,c=t.filter(n=>n.status==="late").length,m=t.reduce((n,h)=>n+(h.totalHours||0),0),u=t.length>0?m/t.length:0;return{thisMonthDays:t.length,presentDays:o,lateDays:c,totalHours:m,avgHours:u,attendanceRate:(a==null?void 0:a.attendance)||0,performance:(a==null?void 0:a.performance)||0}},[x,a]),N=(()=>{const t=new Date().getHours();return t<12?{text:"Good Morning",icon:S}:t<18?{text:"Good Afternoon",icon:S}:{text:"Good Evening",icon:_}})(),O=N.icon;return F?e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto space-y-6",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading your attendance..."})]})}):a?e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{to:"/dashboard"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(O,{className:"w-6 h-6 text-yellow-500"}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[N.text,"!"]})]}),e.jsxs("p",{className:"text-gray-600",children:[a.firstName," ",a.lastName," - ",e.jsx("span",{className:"font-medium",children:a.position})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"px-4 py-2 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xs text-green-600 font-medium",children:"Attendance"}),e.jsxs("div",{className:"text-2xl font-bold text-green-700",children:[l.attendanceRate,"%"]})]}),e.jsxs("div",{className:"px-4 py-2 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xs text-purple-600 font-medium",children:"Performance"}),e.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[l.performance.toFixed(1),"/5"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Y,{employeeId:a.id,employeeName:`${a.firstName} ${a.lastName}`,onCheckIn:I,onCheckOut:E,officeLocation:$,officeNetworks:((b=T.offices[0])==null?void 0:b.networks)||[]})}),e.jsx("div",{children:e.jsxs(g,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600"}),"Today's Summary"]}),e.jsx("div",{className:"space-y-4",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(y,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-900",children:"Status"})]}),e.jsx("p",{className:"text-lg font-bold text-green-700 capitalize",children:r.status})]}),r.checkInTime&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 mb-1",children:"Check In"}),e.jsx("p",{className:"text-lg font-mono font-bold text-blue-700",children:new Date(r.checkInTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),r.checkOutTime&&e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-purple-900 mb-1",children:"Check Out"}),e.jsx("p",{className:"text-lg font-mono font-bold text-purple-700",children:new Date(r.checkOutTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),r.totalHours>0&&e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-orange-900 mb-1",children:"Hours Worked"}),e.jsxs("p",{className:"text-lg font-bold text-orange-700",children:[r.totalHours.toFixed(1)," hours"]})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(C,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No attendance record for today"})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.thisMonthDays}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.presentDays," present"]})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Attendance Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[l.attendanceRate,"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"overall"})]})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-5 hover:bg-purple-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-7 h-7 text-purple-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.totalHours.toFixed(0)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.avgHours.toFixed(1),"h avg/day"]})]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-5 hover:bg-orange-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-7 h-7 text-orange-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Performance"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.performance.toFixed(1)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"out of 5.0"})]})]})})]}),e.jsx(g,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-blue-600"}),"Recent Attendance History"]}),x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No attendance records yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Date"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Check In"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Check Out"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Hours"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:x.slice(0,10).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("p",{className:"font-medium text-gray-900",children:new Date(t.attendanceDate).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})}),e.jsx("td",{className:"py-3 px-4",children:t.checkInTime?e.jsx("span",{className:"text-sm font-mono text-gray-700",children:new Date(t.checkInTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-xs text-gray-400",children:"--:--"})}),e.jsx("td",{className:"py-3 px-4",children:t.checkOutTime?e.jsx("span",{className:"text-sm font-mono text-gray-700",children:new Date(t.checkOutTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-xs text-gray-400",children:"--:--"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[t.totalHours.toFixed(1),"h"]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${t.status==="present"?"bg-green-100 text-green-700":t.status==="late"?"bg-yellow-100 text-yellow-700":t.status==="half-day"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:[t.status==="present"&&e.jsx(y,{className:"w-3 h-3 mr-1"}),t.status==="absent"&&e.jsx(X,{className:"w-3 h-3 mr-1"}),t.status.replace("-"," ")]})})]},t.id))})]})})]})}),l.attendanceRate>=95&&l.performance>=4&&e.jsx(g,{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border-yellow-200",children:e.jsxs("div",{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"bg-yellow-500 rounded-full p-3",children:e.jsx(K,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Outstanding Performance! ðŸŽ‰"}),e.jsxs("p",{className:"text-gray-700",children:["You're doing amazing! Keep up the excellent work with ",l.attendanceRate,"% attendance and ",l.performance.toFixed(1),"/5.0 performance rating!"]})]})]})})]}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto space-y-6",children:[e.jsx(w,{to:"/dashboard"}),e.jsxs(g,{className:"p-12 text-center max-w-2xl mx-auto",children:[e.jsx(q,{className:"w-16 h-16 text-orange-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Employee Record Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your user account is not linked to an employee record in the system."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-left",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Why am I seeing this?"]}),e.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"To use attendance tracking, your user account needs to be connected to an employee record. This connection allows the system to track your attendance, performance, and other HR-related data."})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6 text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"How to fix this:"}),e.jsxs("ol",{className:"text-sm text-gray-700 space-y-2 list-decimal list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"For Administrators:"}),' Go to User Management, click the "Link" button (ðŸ”—), and use the auto-link feature or manually link users to employees.']}),e.jsxs("li",{children:[e.jsx("strong",{children:"For Other Users:"})," Contact your HR department or system administrator to link your account (",s==null?void 0:s.email,") to your employee record."]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(s==null?void 0:s.role)==="admin"&&e.jsx("button",{onClick:()=>window.location.href="/users",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Go to User Management"}),e.jsx("button",{onClick:()=>window.location.href="/dashboard",className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Back to Dashboard"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Your account email: ",e.jsx("span",{className:"font-mono font-medium",children:s==null?void 0:s.email})]})})]})]})};export{ne as default};
