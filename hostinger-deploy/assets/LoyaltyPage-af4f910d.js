import{a as ae,j as e}from"./index-61458a34.js";import{r as n}from"./vendor-36d2c7c1.js";import{c as le,M as S}from"./customerPortalService-0d37743c.js";import{z as u,w as f,ap as T,k as x,bw as b,bx as j,a4 as ie,aq as E,bj as y,ae as N,f as L,y as C,af as ne,q as oe,Z as I}from"./ui-28e30067.js";import{c as de}from"./customerLoyaltyService-09627f23.js";import{a as ce}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";const be=()=>{ce();const{startLoading:$,completeLoading:q,failLoading:_}=ae(),[m,D]=n.useState(0),[F,U]=n.useState("interested"),[w,M]=n.useState([]),[z,v]=n.useState(!0),[g,k]=n.useState("rewards"),[R,H]=n.useState([]),[A,B]=n.useState(null),[G,W]=n.useState(null),[Y,J]=n.useState(0),[O,V]=n.useState(0),[P,Z]=n.useState(0);n.useEffect(()=>{X()},[]);const X=async()=>{const s=$("Loading loyalty data...");try{v(!0);const t=localStorage.getItem("customer_id");if(t){const i=await le.getCustomerById(t);if(i){const o=i.points||0;D(o),U(i.loyalty_tier||i.loyalty_level||"interested");try{const d=await de.fetchPointHistory(t);H(d);const p=d.filter(a=>(a.type==="earned"||a.type==="purchase")&&(a.points||a.amount||a.points_change)).reduce((a,c)=>a+Math.abs(c.points||c.amount||c.points_change||0),0),te=d.filter(a=>(a.type==="redeemed"||a.type==="spent")&&(a.points||a.amount||a.points_change)).reduce((a,c)=>a+Math.abs(c.points||c.amount||c.points_change||0),0);J(p),V(te);const re=K(i.loyalty_tier||i.loyalty_level||"interested");Z(Math.max(0,re-o))}catch(d){console.error("Error loading point history:",d)}}}M([{id:"1",title:"10% Off Next Purchase",description:"Get 10% discount on your next purchase of any product",pointsRequired:1e3,category:"discount",imageUrl:""},{id:"2",title:"Free Phone Case",description:"Redeem for a free phone case of your choice",pointsRequired:2e3,category:"product",imageUrl:""},{id:"3",title:"Free Screen Protector",description:"Get a premium screen protector installed for free",pointsRequired:1500,category:"service",imageUrl:""},{id:"4",title:"Tsh 50,000 Voucher",description:"Shopping voucher worth Tsh 50,000",pointsRequired:5e3,category:"voucher",imageUrl:""}]),q(s)}catch(t){console.error("Error loading loyalty data:",t),u.error("Failed to load loyalty data"),_(s,"Failed to load loyalty data")}finally{v(!1)}},K=s=>({interested:500,engaged:1e3,payment_customer:2e3,active:5e3,regular:1e4,premium:25e3,vip:5e4})[s]||0,l=s=>{const t=typeof s=="string"?parseFloat(s):s;return t%1===0?t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},Q=s=>{switch(s){case"vip":return{name:"VIP",color:"from-purple-500 to-pink-500",icon:T,benefits:["20% off all purchases","Free delivery","Priority support","Exclusive deals"]};case"premium":return{name:"Premium",color:"from-yellow-400 to-orange-500",icon:E,benefits:["15% off all purchases","Free delivery on orders over Tsh 50,000","Priority support"]};case"regular":return{name:"Regular",color:"from-blue-400 to-blue-600",icon:x,benefits:["10% off all purchases","Free delivery on orders over Tsh 100,000"]};case"active":return{name:"Active",color:"from-green-400 to-green-600",icon:I,benefits:["7% off all purchases","Regular customer perks"]};case"payment_customer":return{name:"Payment Customer",color:"from-teal-400 to-teal-600",icon:x,benefits:["5% off all purchases","Earn bonus points"]};case"engaged":return{name:"Engaged",color:"from-indigo-400 to-indigo-600",icon:I,benefits:["3% off all purchases","Earn points on every purchase"]};case"interested":default:return{name:"Interested",color:"from-gray-400 to-gray-600",icon:x,benefits:["Earn points on every purchase","Join our loyalty program"]}}},ee=s=>{if(m<s.pointsRequired){u.error("Not enough points to redeem this reward");return}confirm(`Redeem ${s.title} for ${s.pointsRequired} points?`)&&u.success("Reward redeemed! Check your account for details")};if(z)return e.jsx(S,{title:"Loyalty Rewards",children:e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"})})});const h=Q(F),se=h.icon;return e.jsx(S,{title:"Loyalty Rewards",children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 p-6 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${h.color} rounded-full flex items-center justify-center shadow-lg`,children:e.jsx(se,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Loyalty Program"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(f,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-bold text-green-700",children:[l(m)," Points"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(T,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-bold text-blue-700",children:[h.name," Tier"]})]})]})]})]})}),e.jsx("div",{className:"p-6 pb-0 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl p-3.5 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center flex-shrink-0",children:e.jsx(x,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Current Points"}),e.jsx("p",{className:"text-base font-bold text-blue-600 truncate",children:l(m)})]})]}),e.jsx("div",{className:"h-14 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-green-500 flex items-center justify-center flex-shrink-0",children:e.jsx(b,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Total Earned"}),e.jsx("p",{className:"text-base font-bold text-green-600 truncate",children:l(Y)})]})]}),e.jsx("div",{className:"h-14 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-orange-500 flex items-center justify-center flex-shrink-0",children:e.jsx(j,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Total Redeemed"}),e.jsx("p",{className:"text-base font-bold text-orange-600 truncate",children:l(O)})]})]})]}),P>0&&e.jsx("div",{className:"flex items-center gap-3 mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-purple-50 border border-purple-100",children:[e.jsx(ie,{className:"w-3.5 h-3.5 text-purple-600"}),e.jsxs("span",{className:"text-xs font-semibold text-purple-600",children:[l(P)," points to next tier"]})]})})]})}),e.jsx("div",{className:"p-6 pt-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(E,{size:20,className:"text-blue-600"}),"Your Tier Benefits"]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:h.benefits.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-700 p-2 rounded-lg bg-gray-50",children:[e.jsx(y,{size:16,className:"text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:s})]},t))})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>k("rewards"),className:`flex-1 py-3 rounded-xl font-semibold transition-all ${g==="rewards"?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Available Rewards"}),e.jsx("button",{onClick:()=>k("history"),className:`flex-1 py-3 rounded-xl font-semibold transition-all ${g==="history"?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Points History"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:g==="rewards"?e.jsx("div",{className:"space-y-4 py-4",children:w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"No rewards available"})]}):w.map(s=>{const t=m>=s.pointsRequired,r=A===s.id,i=s.pointsRequired-m;return e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${r?"border-blue-500 shadow-xl":t?"border-green-200 hover:border-green-300 hover:shadow-md":"border-orange-300 hover:border-orange-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start justify-between p-6 cursor-pointer",onClick:()=>B(r?null:s.id),children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center transition-colors ${r?"bg-blue-500":"bg-gray-200"}`,children:e.jsx("svg",{className:`w-4 h-4 text-white transition-transform duration-200 ${r?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:s.title}),t?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm",children:[e.jsx(y,{className:"w-3 h-3"}),"Available"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-orange-500 text-white shadow-sm",children:[e.jsx(L,{className:"w-3 h-3"}),"Need ",l(i)," more"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description})]})]})}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"px-4 py-2 rounded-xl text-base font-bold shadow-sm bg-blue-100 text-blue-700 border border-blue-200",children:[l(s.pointsRequired)," pts"]})})]}),r&&e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx("div",{className:"bg-white rounded-xl p-3.5 mb-3 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-purple-500 flex items-center justify-center flex-shrink-0",children:e.jsx(N,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Category"}),e.jsx("p",{className:"text-base font-bold text-purple-600 capitalize",children:s.category})]})]}),e.jsx("div",{className:"h-14 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-orange-500 flex items-center justify-center flex-shrink-0",children:e.jsx(x,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Points Required"}),e.jsx("p",{className:"text-base font-bold text-orange-600",children:l(s.pointsRequired)})]})]}),e.jsx("div",{className:"h-14 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-blue-500 flex items-center justify-center flex-shrink-0",children:e.jsx(f,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Your Points"}),e.jsx("p",{className:`text-base font-bold ${t?"text-green-600":"text-red-600"}`,children:l(m)})]})]})]})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),ee(s)},disabled:!t,className:`w-full px-6 py-3.5 rounded-xl font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg ${t?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-500"}`,children:t?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"Redeem Now"]}):e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Need ",l(i)," More Points"]})})]})]},s.id)})}):e.jsx("div",{className:"space-y-4 py-4",children:R.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(C,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"No transaction history"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Your points transactions will appear here"})]}):R.map((s,t)=>{const r=s.type==="earned"||s.type==="purchase";s.type==="redeemed"||s.type;const i=Math.abs(s.points||s.amount||s.points_change||0),o=G===t.toString(),d=s.timestamp||s.date||s.created_at,p=d?new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown date";return e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${o?"border-blue-500 shadow-xl":r?"border-green-200 hover:border-green-300 hover:shadow-md":"border-orange-200 hover:border-orange-300 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start justify-between p-6 cursor-pointer",onClick:()=>W(o?null:t.toString()),children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center transition-colors ${o?"bg-blue-500":"bg-gray-200"}`,children:e.jsx("svg",{className:`w-4 h-4 text-white transition-transform duration-200 ${o?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:s.reason||`${r?"Points Earned":"Points Redeemed"}`}),r?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm",children:[e.jsx(b,{className:"w-3 h-3"}),"Earned"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-orange-500 text-white shadow-sm",children:[e.jsx(j,{className:"w-3 h-3"}),"Redeemed"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:p})]})]})}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:`px-4 py-2 rounded-xl text-base font-bold shadow-sm border ${r?"bg-green-100 text-green-700 border-green-200":"bg-orange-100 text-orange-700 border-orange-200"}`,children:[r?"+":"-",l(i)]})})]}),o&&e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-3.5 mb-3 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0 ${r?"bg-green-500":"bg-orange-500"}`,children:r?e.jsx(b,{className:"w-4 h-4 text-white"}):e.jsx(j,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Transaction Type"}),e.jsx("p",{className:"text-base font-bold capitalize",children:s.type||"Unknown"})]})]}),e.jsx("div",{className:"h-14 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-blue-500 flex items-center justify-center flex-shrink-0",children:e.jsx(x,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Points"}),e.jsxs("p",{className:`text-base font-bold ${r?"text-green-600":"text-orange-600"}`,children:[r?"+":"-",l(i)]})]})]}),e.jsx("div",{className:"h-14 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-purple-500 flex items-center justify-center flex-shrink-0",children:e.jsx(C,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Date"}),e.jsx("p",{className:"text-base font-bold text-purple-600 text-xs",children:p})]})]})]}),(s.orderId||s.deviceId)&&e.jsxs("div",{className:"flex items-center gap-3 mt-3 pt-3 border-t border-gray-100",children:[s.orderId&&e.jsx("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-blue-50 border border-blue-100",children:e.jsxs("span",{className:"text-xs font-semibold text-blue-600",children:["Order: ",s.orderId]})}),s.deviceId&&e.jsx("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-purple-50 border border-purple-100",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-600",children:["Device: ",s.deviceId]})})]})]})})]},t)})})}),e.jsx("div",{className:"px-6 pb-6 pt-4 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 border border-blue-100",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ne,{size:20,className:"text-blue-600"}),"How to Earn Points"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-700 p-2 rounded-lg bg-white/50",children:[e.jsx(oe,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"Earn 1 point for every Tsh 1,000 spent"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-700 p-2 rounded-lg bg-white/50",children:[e.jsx(f,{className:"w-4 h-4 text-purple-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"Refer a friend and get 500 bonus points"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-700 p-2 rounded-lg bg-white/50",children:[e.jsx(y,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"Complete your profile for 200 points"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-700 p-2 rounded-lg bg-white/50",children:[e.jsx(x,{className:"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"Write a review and earn 100 points"})]})]})]})})]})})};export{be as default};
