import{j as e,s as l}from"./index-61458a34.js";import{r}from"./vendor-36d2c7c1.js";import{h as z,Y as I,G as O,z as o}from"./ui-28e30067.js";import{d as P,a as _}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";const G=()=>{const{clientId:a}=P(),i=_(),[n,f]=r.useState(""),[c,p]=r.useState(""),[d,g]=r.useState(""),[u,h]=r.useState(""),[m,y]=r.useState(""),[x,j]=r.useState(""),[E,k]=r.useState(!0),[v,w]=r.useState(!1),[N,C]=r.useState(!1);r.useEffect(()=>{(async()=>{try{let{data:s,error:b}=await l.from("customers").select("*").eq("id",a).single();if(!s){const S=await l.from("lats_customers").select("*").eq("id",a).single();s=S.data,b=S.error}if(b)throw b;if(!s)throw new Error("Customer not found");f(s.name||""),p(s.phone||s.mobile||s.whatsapp||""),g(s.email||""),h(s.city||""),y(s.address||s.location_description||""),j(s.notes||"")}catch(s){console.error("Error loading customer:",s),o.error("Failed to load customer"),i("/mobile/clients")}finally{k(!1)}})()},[a,i]);const q=async()=>{if(!n.trim()){o.error("Customer name is required");return}if(!c.trim()){o.error("Phone number is required");return}try{w(!0);let{error:t}=await l.from("customers").update({name:n.trim(),phone:c.trim(),email:d.trim()||null,city:u.trim()||null,address:m.trim()||null,notes:x.trim()||null,updated_at:new Date().toISOString()}).eq("id",a);if(t&&t.code==="PGRST116"){const s=await l.from("lats_customers").update({name:n.trim(),phone:c.trim(),email:d.trim()||null,city:u.trim()||null,address:m.trim()||null,notes:x.trim()||null,updated_at:new Date().toISOString()}).eq("id",a);if(s.error)throw s.error}else if(t)throw t;o.success("Customer updated successfully!"),i(`/mobile/clients/${a}`)}catch(t){console.error("Error updating customer:",t),o.error(t.message||"Failed to update customer")}finally{w(!1)}},D=async()=>{if(confirm("Are you sure you want to delete this customer? This action cannot be undone."))try{C(!0);let{error:t}=await l.from("customers").delete().eq("id",a);if(t&&t.code==="PGRST116"){const s=await l.from("lats_customers").delete().eq("id",a);if(s.error)throw s.error}else if(t)throw t;o.success("Customer deleted successfully"),i("/mobile/clients")}catch(t){console.error("Error deleting customer:",t),o.error(t.message||"Failed to delete customer")}finally{C(!1)}};return E?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-[15px]",children:"Loading customer..."})]})}):e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3 safe-area-inset-top",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>i(-1),className:"p-2 -ml-2 active:bg-gray-100 rounded-full transition-all",children:e.jsx(z,{size:24,className:"text-blue-500",strokeWidth:2.5})}),e.jsx("h1",{className:"text-[20px] font-bold text-gray-900",children:"Edit Customer"}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-6 space-y-6 pb-20",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[15px] font-semibold text-gray-900 mb-2 block",children:"Full Name *"}),e.jsx("input",{type:"text",value:n,onChange:t=>f(t.target.value),placeholder:"Enter customer name",className:"w-full px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-[16px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[15px] font-semibold text-gray-900 mb-2 block",children:"Phone Number *"}),e.jsx("input",{type:"tel",value:c,onChange:t=>p(t.target.value),placeholder:"Enter phone number",className:"w-full px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-[16px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[15px] font-semibold text-gray-900 mb-2 block",children:"Email (Optional)"}),e.jsx("input",{type:"email",value:d,onChange:t=>g(t.target.value),placeholder:"Enter email address",className:"w-full px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-[16px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[15px] font-semibold text-gray-900 mb-2 block",children:"City (Optional)"}),e.jsx("input",{type:"text",value:u,onChange:t=>h(t.target.value),placeholder:"Enter city",className:"w-full px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-[16px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[15px] font-semibold text-gray-900 mb-2 block",children:"Address (Optional)"}),e.jsx("input",{type:"text",value:m,onChange:t=>y(t.target.value),placeholder:"Enter address",className:"w-full px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-[16px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[15px] font-semibold text-gray-900 mb-2 block",children:"Notes (Optional)"}),e.jsx("textarea",{value:x,onChange:t=>j(t.target.value),placeholder:"Add any notes about this customer",rows:4,className:"w-full px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-[16px] resize-none"})]}),e.jsxs("button",{onClick:D,disabled:N,className:"w-full py-3.5 bg-red-50 text-red-600 rounded-xl font-semibold text-[16px] active:bg-red-100 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(I,{size:20,strokeWidth:2.5}),N?"Deleting...":"Delete Customer"]})]}),e.jsx("div",{className:"bg-white border-t border-gray-200 px-4 py-4 safe-area-inset-bottom",children:e.jsxs("button",{onClick:q,disabled:v||!n.trim()||!c.trim(),className:"w-full py-4 bg-blue-500 text-white rounded-2xl font-semibold text-[17px] active:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(O,{size:20,strokeWidth:2.5}),v?"Saving...":"Save Changes"]})})]})};export{G as default};
