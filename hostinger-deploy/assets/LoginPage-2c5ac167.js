import{s as b,a as v,j as e}from"./index-61458a34.js";import{r as a}from"./vendor-36d2c7c1.js";import{br as N,P as w,bz as L,aj as P,l as S,z as u}from"./ui-28e30067.js";import{a as C}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";a.createContext(void 0);const _=()=>{const[o,l]=a.useState(null),[m,n]=a.useState(!0);return a.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("customer_id");if(s){const{data:t,error:r}=await b.from("customers").select("*").eq("id",s).single();t&&!r&&l({id:t.id,name:t.name,email:t.email,phone:t.phone,profileImage:t.profile_image,loyaltyPoints:t.points||0,loyaltyTier:t.loyalty_tier,createdAt:t.created_at,lastPurchase:t.last_purchase_date})}}catch(s){console.error("Error checking customer session:",s)}finally{n(!1)}})()},[]),{customer:o,loading:m,login:async(d,s)=>{try{n(!0);const{data:t,error:r}=await b.from("customers").select("*").eq("phone",d).single();if(r)throw new Error("Customer not found. Please register first.");if(t){const x={id:t.id,name:t.name,email:t.email,phone:t.phone,profileImage:t.profile_image,loyaltyPoints:t.points||0,loyaltyTier:t.loyalty_tier,createdAt:t.created_at,lastPurchase:t.last_purchase_date};l(x),localStorage.setItem("customer_id",t.id)}}catch(t){throw console.error("Login error:",t),t}finally{n(!1)}},logout:async()=>{l(null),localStorage.removeItem("customer_id")},isAuthenticated:!!o}},O=()=>{const o=C(),{login:l}=_(),{startLoading:m,completeLoading:n,failLoading:g}=v(),[c,d]=a.useState(""),[s,t]=a.useState(""),[r,x]=a.useState(!1),[h,p]=a.useState(!1),y=async i=>{if(i.preventDefault(),!c){u.error("Please enter your phone number");return}const f=m("Signing in...");try{p(!0),await l(c,s),u.success("Login successful!"),n(f),o("/customer-portal/dashboard")}catch(j){u.error(j.message||"Login failed"),g(f,"Login failed")}finally{p(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-500 to-blue-700 flex flex-col",children:[e.jsxs("div",{className:"pt-12 pb-8 px-6 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx(N,{size:40,className:"text-blue-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Welcome Back!"}),e.jsx("p",{className:"text-blue-100",children:"Login to continue shopping"})]}),e.jsxs("div",{className:"flex-1 bg-white rounded-t-3xl px-6 py-8",children:[e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(w,{size:20,className:"text-gray-400"})}),e.jsx("input",{type:"tel",value:c,onChange:i=>d(i.target.value),placeholder:"0712345678",className:"w-full pl-12 pr-4 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(L,{size:20,className:"text-gray-400"})}),e.jsx("input",{type:r?"text":"password",value:s,onChange:i=>t(i.target.value),placeholder:"Enter your password",className:"w-full pl-12 pr-12 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"}),e.jsx("button",{type:"button",onClick:()=>x(!r),className:"absolute inset-y-0 right-0 pr-4 flex items-center",children:r?e.jsx(P,{size:20,className:"text-gray-400"}):e.jsx(S,{size:20,className:"text-gray-400"})})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"button",onClick:()=>u("Contact support for password reset"),className:"text-sm text-blue-600 font-medium hover:underline",children:"Forgot Password?"})}),e.jsx("button",{type:"submit",disabled:h,className:"w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Logging in..."})]}):"Login"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-4 bg-white text-gray-500",children:"OR"})})]}),e.jsx("button",{type:"button",onClick:()=>o("/customer-portal/products"),className:"w-full border-2 border-gray-300 text-gray-700 py-4 rounded-xl font-bold text-lg hover:bg-gray-50 active:scale-95 transition-all",children:"Continue as Guest"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",e.jsx("button",{onClick:()=>o("/customer-portal/signup"),className:"text-blue-600 font-bold hover:underline",children:"Register"})]})}),e.jsx("div",{className:"mt-8 p-4 bg-blue-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:["Need help? Contact us at"," ",e.jsx("a",{href:"tel:+255712345678",className:"text-blue-600 font-medium",children:"+255 712 345 678"})]})})]})]})};export{O as default};
