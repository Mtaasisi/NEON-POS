import{p as ye,j as e,Y as Me,s as J,u as Le,b as Re,d as Te}from"./index-61458a34.js";import{r as x,b as je}from"./vendor-36d2c7c1.js";import{s as Ae}from"./saleProcessingService-f5a8fb75.js";import{format as R}from"./format-aff4c6a2.js";import{N as U,v as ve,U as Ne,an as qe,bj as Ee,z as L,X as K,u as Z,S as be,a as We,b as Ie,e as Be,h as He,J as Fe,O as Oe,aE as De}from"./ui-28e30067.js";import{customerCacheService as G}from"./customerCacheService-9b459c09.js";import{M as Qe}from"./MobileAddCustomerModal-ee9fad7d.js";import{_ as Ue}from"./supabase-cf010ec4.js";import{S as Xe}from"./ShareReceiptModal-8db20b0e.js";import{u as Ve,S as Ye}from"./useSuccessModal-081786c4.js";import{S as Ge}from"./SuccessModalIcons-fe811e4d.js";import{u as Je}from"./useMobileBranch-d96f1509.js";import{u as Ke,a as Ze}from"./useResponsiveSize-eee1874a.js";import{R as et}from"./ResponsiveMobileWrapper-b44175a0.js";import{a as tt}from"./routing-eb8c310c.js";import"./phoneUtils-a8934478.js";import"./MobileSheetContent-25c73501.js";import"./whatsappService-09f99080.js";import"./useBusinessInfo-62d31733.js";import"./formatPhoneForInvoice-e7084c6d.js";import"./pdf-e6e38bab.js";import"./html2canvas.esm-6bd083a4.js";import"./useBodyScrollLock-341c8b9f.js";const st=({isOpen:M,onClose:v,onCustomerSelect:l,onAddNew:T,selectedCustomer:A})=>{const[C,h]=x.useState(""),[P,z]=x.useState([]),[t,b]=x.useState([]),[f,S]=x.useState(!1);x.useEffect(()=>{M&&y()},[M]),x.useEffect(()=>{if(C.trim()){const s=C.toLowerCase(),a=P.filter(r=>{var c,u;return r.name.toLowerCase().includes(s)||((c=r.phone)==null?void 0:c.toLowerCase().includes(s))||((u=r.email)==null?void 0:u.toLowerCase().includes(s))});b(a)}else b(P.slice(0,50))},[C,P]);const y=async()=>{try{S(!0);const s=G.getCustomers();if(s&&s.length>0){z(s),b(s.slice(0,50)),S(!1),G.getCacheAge()>5*60*1e3&&ye().then(c=>{c&&Array.isArray(c)&&(G.saveCustomers(c),z(c))}).catch(()=>{});return}const a=await ye();a&&Array.isArray(a)&&(z(a),b(a.slice(0,50)),G.saveCustomers(a))}catch(s){console.error("Error loading customers:",s)}finally{S(!1)}},w=s=>{l(s),v()},_=s=>{if(!s)return"??";const a=s.trim().split(" ");return a.length>=2?`${a[0][0]}${a[a.length-1][0]}`.toUpperCase():s.substring(0,2).toUpperCase()},q=s=>!s||isNaN(s)||!isFinite(s)?"$0":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),g=s=>{if(!s)return 0;let a=typeof s=="string"?parseFloat(s.replace(/[^0-9.-]/g,"")):s;return isNaN(a)||!isFinite(a)||a>1e15?0:(a>1e8&&(a=a/100),Math.max(0,a))},N=s=>g(s.totalSpent)>0;return M?je.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:v,children:[e.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[90vh] flex flex-col animate-slide-up",onClick:s=>s.stopPropagation(),style:{animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[e.jsx("button",{onClick:v,className:"text-blue-500 text-[17px] font-normal",children:"Cancel"}),e.jsx("h2",{className:"text-[17px] font-semibold text-gray-900",children:"Select Customer"}),e.jsx("button",{onClick:()=>{v(),T==null||T()},className:"text-blue-500 text-[17px] font-semibold",children:e.jsx(U,{size:22,strokeWidth:2.5})})]}),e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16,strokeWidth:2}),e.jsx("input",{type:"text",placeholder:"Search customers",value:C,onChange:s=>h(s.target.value),autoFocus:!0,className:"w-full pl-9 pr-4 py-2 bg-[#f2f2f7] border-0 rounded-lg focus:outline-none focus:ring-0 text-gray-900 placeholder-gray-400 text-[15px] font-light",style:{WebkitAppearance:"none"}})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:f?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(Ne,{size:40,className:"text-gray-400",strokeWidth:1.5})}),e.jsx("p",{className:"text-gray-900 text-[17px] font-semibold mb-2",children:C?"No customers found":"No customers yet"}),e.jsx("p",{className:"text-[15px] text-gray-500 mb-6 max-w-sm mx-auto text-center",children:C?"Try adjusting your search terms":"Start building your customer base by adding your first customer"}),!C&&T&&e.jsxs("button",{onClick:()=>{v(),T()},className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-500 text-white rounded-xl font-medium hover:bg-blue-600 active:bg-blue-700 transition-colors shadow-sm",children:[e.jsx(U,{size:20,strokeWidth:2.5}),"Add First Customer"]})]}):e.jsx("div",{className:"border-t border-b border-gray-200",children:t.map((s,a)=>{const r=(A==null?void 0:A.id)===s.id,c=a===t.length-1,u=N(s),m=g(s.totalSpent);return e.jsxs("button",{onClick:()=>w(s),className:`w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-50 active:bg-gray-100 transition-colors border-b border-[#e5e5ea] ${r?"bg-blue-50":""}`,style:{borderBottomWidth:c?"0":"0.5px"},children:[e.jsx("div",{className:`flex-shrink-0 w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold text-[15px] shadow-sm ${r?"bg-gradient-to-br from-blue-500 to-blue-700":"bg-gradient-to-br from-blue-400 to-blue-600"}`,children:_(s.name)}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-[16px] font-semibold text-gray-900 truncate",children:s.name}),u&&e.jsx("span",{className:"flex-shrink-0 px-1.5 py-0.5 text-[10px] font-medium bg-green-100 text-green-700 rounded",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"text-[13px] text-gray-500 truncate",children:s.phone||"No phone"}),u&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"â€¢"}),e.jsx("span",{className:"text-[13px] font-medium text-gray-700",children:q(m)})]})]})]}),r?e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{width:"14",height:"10",viewBox:"0 0 14 10",fill:"none",children:e.jsx("path",{d:"M1 5L5 9L13 1",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}):e.jsx(qe,{size:18,className:"text-gray-400 flex-shrink-0",strokeWidth:2})]},s.id)})})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200",children:e.jsx("button",{onClick:()=>{l(null),v()},className:"w-full py-3 bg-gray-100 text-gray-900 rounded-lg text-[16px] font-medium hover:bg-gray-200 active:bg-gray-300 transition-colors",children:"Continue as Walk-in Customer"})})]}),e.jsx("style",{children:`
        @keyframes slideUp {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slideUp 0.3s ease-out;
        }
      `})]}),document.body):null},at=({isOpen:M,onClose:v,amount:l,customerId:T,customerName:A,description:C,onComplete:h})=>{const{paymentMethods:P}=Me(),[z,t]=x.useState(""),[b,f]=x.useState(l.toString()),[S,y]=x.useState(""),[w,_]=x.useState(!1),q=[{id:"cash",name:"Cash",type:"cash",icon:"ðŸ’µ"},{id:"mpesa",name:"M-Pesa",type:"mobile_money",icon:"ðŸ“±"},{id:"card",name:"Card",type:"card",icon:"ðŸ’³"},{id:"bank",name:"Bank Transfer",type:"bank_transfer",icon:"ðŸ¦"}],g=P&&P.length>0?P:q;x.useEffect(()=>{var a;M&&(t(((a=g[0])==null?void 0:a.id)||"cash"),f(l.toString()),y(""),_(!1))},[M,l,g]);const N=async()=>{const a=parseFloat(b);if(!a||a<=0){L.error("Please enter a valid amount");return}if(a<l){L.error("Payment amount cannot be less than total");return}try{_(!0);const r=g.find(u=>u.id===z),c=[{paymentMethod:(r==null?void 0:r.name)||"Cash",amount:a,paymentAccountId:null,reference:S||"",notes:"",timestamp:new Date().toISOString()}];await h(c,a),v()}catch(r){console.error("Payment error:",r),L.error(r.message||"Payment failed")}finally{_(!1)}},s=parseFloat(b)-l;return M?je.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:v,children:[e.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[90vh] flex flex-col animate-slide-up",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[e.jsx("button",{onClick:v,disabled:w,className:"text-blue-500 text-[17px] font-normal disabled:opacity-50",children:"Cancel"}),e.jsx("h2",{className:"text-[17px] font-semibold text-gray-900",children:"Payment"}),e.jsx("button",{onClick:N,disabled:w||!z,className:"text-blue-500 text-[17px] font-semibold disabled:opacity-50",children:w?"Processing...":"Done"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"px-4 py-6 bg-gray-50 border-b border-gray-200 text-center",children:[e.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide mb-2",children:"Total Amount"}),e.jsxs("div",{className:"text-[40px] font-bold text-gray-900",children:["TSh ",l.toLocaleString()]}),A&&e.jsxs("div",{className:"text-[15px] text-gray-600 mt-2",children:["for ",A]})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:g.map(a=>{const r=z===a.id,c=a.icon||(a.type==="cash"?"ðŸ’µ":a.type==="mobile_money"?"ðŸ“±":a.type==="card"?"ðŸ’³":"ðŸ¦");return e.jsxs("button",{onClick:()=>t(a.id),className:`p-4 rounded-xl border-2 transition-all ${r?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-3xl mb-2",children:c}),e.jsx("div",{className:`text-[14px] font-medium ${r?"text-blue-600":"text-gray-900"}`,children:a.name}),r&&e.jsx("div",{className:"mt-2 w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center mx-auto",children:e.jsx(Ee,{size:14,className:"text-white",strokeWidth:3})})]},a.id)})})]}),e.jsxs("div",{className:"px-4 py-4 border-t border-gray-200",children:[e.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Amount Received"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 text-[20px] font-medium",children:"TSh"}),e.jsx("input",{type:"number",value:b,onChange:a=>f(a.target.value),className:"w-full pl-16 pr-4 py-4 text-[24px] font-bold text-gray-900 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",style:{WebkitAppearance:"none"}})]}),s>0&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[15px] text-green-700 font-medium",children:"Change Due:"}),e.jsxs("span",{className:"text-[18px] text-green-700 font-bold",children:["TSh ",s.toLocaleString()]})]})})]}),z!=="cash"&&e.jsxs("div",{className:"px-4 py-4 border-t border-gray-200",children:[e.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Reference / Transaction ID (Optional)"}),e.jsx("input",{type:"text",placeholder:"Enter reference number",value:S,onChange:a=>y(a.target.value),className:"w-full px-4 py-3 text-[16px] text-gray-900 bg-gray-50 border-0 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400",style:{WebkitAppearance:"none"}})]}),e.jsxs("div",{className:"px-4 py-4 border-t border-gray-200",children:[e.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Quick Amount"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[l,5e3,1e4,2e4,5e4,1e5].map(a=>e.jsx("button",{onClick:()=>f(a.toString()),className:"px-3 py-2 bg-gray-100 text-gray-900 rounded-lg text-[13px] font-medium hover:bg-gray-200 active:bg-gray-300 transition-colors",children:a>=1e3?`${a/1e3}K`:a},a))})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-white",children:e.jsx("button",{onClick:N,disabled:w||!z||parseFloat(b)<l,className:"w-full py-4 bg-blue-500 text-white rounded-xl text-[17px] font-semibold hover:bg-blue-600 active:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:w?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Processing..."]}):`Complete Payment â€¢ TSh ${parseFloat(b).toLocaleString()}`})})]}),e.jsx("style",{children:`
        @keyframes slideUp {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slideUp 0.3s ease-out;
        }
      `})]}),document.body):null},it=({isOpen:M,onClose:v,product:l,onSelectVariant:T})=>{const[A,C]=x.useState(new Set),[h,P]=x.useState({}),[z,t]=x.useState(new Set);x.useEffect(()=>{var s;if(!M)C(new Set),P({}),t(new Set);else if(b(),((s=l==null?void 0:l.variants)==null?void 0:s.length)===1){const a=l.variants[0];y(a.id)}},[M,l]);const b=async()=>{if(l!=null&&l.variants)try{console.log("âš¡ Mobile: Loading from global cache...");const{childVariantsCacheService:s}=await Ue(()=>import("./childVariantsCacheService-9368f4c7.js"),["assets/childVariantsCacheService-9368f4c7.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);if(!s.isCacheValid()){await f();return}const a=l.variants.map(c=>c.id),r={};a.forEach(c=>{const u=s.getChildVariants(c);u&&u.length>0&&(r[c]=u)}),P(r),console.log(`âœ… Mobile: Loaded from GLOBAL CACHE - ${Object.values(r).flat().length} children`)}catch(s){console.error("Mobile: Error loading from cache:",s),await f()}},f=async()=>{if(!(l!=null&&l.variants))return;const s=l.variants.map(m=>m.id);if(s.length===0)return;console.log("ðŸ”„ Mobile: Fallback query...");const a=new Map;l.variants.forEach(m=>{if(m.id){const $=m.sellingPrice??m.selling_price??m.price??0;a.set(m.id,$)}});const{data:r,error:c}=await J.from("lats_product_variants").select("*").in("parent_variant_id",s).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0).order("created_at",{ascending:!1});if(c||!r||r.length===0)return;const u={};r.forEach(m=>{const $=m.parent_variant_id;u[$]||(u[$]=[]);const k=m.selling_price||m.sellingPrice||m.price,j=a.get($)||0,E=k&&k>0?k:j;u[$].push({...m,sellingPrice:E,price:E})}),P(u)},S=s=>{const a=s.variant_type||s.variantType,r=s.is_parent||s.isParent;return a==="parent"||r===!0},y=async s=>{try{const{count:a}=await J.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("parent_variant_id",s).eq("is_active",!0);(a||0)>0&&(C(new Set([s])),w(s))}catch(a){console.error("Error checking for children:",a)}},w=async s=>{var a;if(h[s]){console.log(`âš¡ Mobile: Using preloaded children (${h[s].length})`);return}console.warn(`âš ï¸ Mobile: Fallback loading for ${s}`),t(r=>new Set(r).add(s));try{const r=(a=l==null?void 0:l.variants)==null?void 0:a.find(k=>k.id===s),c=(r==null?void 0:r.sellingPrice)??(r==null?void 0:r.selling_price)??(r==null?void 0:r.price)??0,{data:u,error:m}=await J.from("lats_product_variants").select("*").eq("parent_variant_id",s).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0).order("created_at",{ascending:!1});if(m)throw m;const $=(u||[]).map(k=>{const j=k.selling_price||k.sellingPrice||k.price,E=j&&j>0?j:c;return{...k,sellingPrice:E,price:E}});P(k=>({...k,[s]:$}))}catch(r){console.error("Error loading child variants:",r),L.error("Failed to load devices")}finally{t(r=>{const c=new Set(r);return c.delete(s),c})}},_=s=>{const a=new Set(A);a.has(s)?a.delete(s):(a.add(s),h[s]||w(s)),C(a)},q=s=>{if(S(s)){const a=h[s.id];!a||a.length===0?(T(s),v()):(L("Please select a specific device"),A.has(s.id)||_(s.id))}else T(s),v()};if(!M)return null;const g=(l==null?void 0:l.variants)||[];let N=g.filter(s=>{if(s.parent_variant_id)return!1;const a=s.quantity??s.stockQuantity??s.stock_quantity??0,r=s.is_active!==!1&&s.isActive!==!1;return a>0&&r});return N.length===0&&g.length>0&&(console.warn("âš ï¸ Mobile: No variants with stock found, showing all active variants as fallback"),N=g.filter(s=>s.parent_variant_id?!1:s.is_active!==!1&&s.isActive!==!1)),N.length===0&&g.length>0&&(console.warn("âš ï¸ Mobile: No active variants found, showing ALL variants as fallback"),N=g.filter(s=>!s.parent_variant_id)),e.jsx("div",{className:"fixed inset-0 z-50 flex items-end bg-black bg-opacity-50",onClick:v,children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[80vh] overflow-hidden flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:l==null?void 0:l.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a variant"})]}),e.jsx("button",{onClick:v,className:"w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 active:bg-gray-200",children:e.jsx(K,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx(Z,{size:48,className:"mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No variants available"})]}):N.map(s=>{const a=S(s),r=A.has(s.id),c=h[s.id]||[],u=z.has(s.id),m=s.quantity||s.stock_quantity||0,$=m<=0,k=m>0&&m<=5;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>a?_(s.id):q(s),className:`w-full text-left p-4 rounded-2xl border-2 transition-all active:scale-98 ${$?"bg-gray-50 border-gray-200 opacity-60":"bg-white border-gray-200 active:border-blue-400"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a&&e.jsx(be,{size:16,className:"text-blue-500 flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:s.variant_name||s.name||"Unnamed Variant"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(Tag,{size:12}),s.sku]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:R.currency(s.selling_price||s.unit_price||0)}),e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${$?"bg-red-100 text-red-700":k?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:$?"Out of stock":`${m} in stock`})]}),a&&c.length>0&&e.jsxs("p",{className:"text-xs text-blue-600 mt-2 font-medium",children:[c.length," device",c.length!==1?"s":""," available"]})]}),a&&e.jsx("div",{className:"flex-shrink-0",children:u?e.jsx("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}):r?e.jsx(We,{size:24,className:"text-gray-400"}):e.jsx(Ie,{size:24,className:"text-gray-400"})})]})}),a&&r&&c.length>0&&e.jsx("div",{className:"pl-4 space-y-2",children:c.map(j=>{var X,H;const B=(j.quantity||0)<=0,I=((X=j.variant_attributes)==null?void 0:X.imei)||((H=j.attributes)==null?void 0:H.imei);return e.jsxs("button",{onClick:()=>q(j),disabled:B,className:`w-full text-left p-3 rounded-xl border transition-all active:scale-98 ${B?"bg-gray-50 border-gray-200 opacity-50 cursor-not-allowed":"bg-blue-50 border-blue-200 active:border-blue-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(be,{size:14,className:"text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:j.variant_name||j.name||"Device"})]}),I&&e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:["IMEI: ",I]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:R.currency(j.sellingPrice||j.selling_price||j.price||j.unit_price||0)}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${B?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:B?"Sold":"Available"})]})]},j.id)})}),a&&r&&c.length===0&&!u&&e.jsx("div",{className:"pl-4 py-3 text-center text-sm text-gray-400",children:"No devices available"})]},s.id)})}),N.length>0&&e.jsx("div",{className:"p-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(Be,{size:14}),e.jsx("span",{children:"Tap a variant to add it to your cart"})]})})]})})},Pt=()=>{var me;const M=tt(),{currentUser:v}=Le(),{currentBranch:l}=Je(),{customers:T,loading:A,refreshCustomers:C}=Re(),{products:h,loadProducts:P}=Te(),z=Ve(),t=Ke(),b=Ze();x.useEffect(()=>{console.log("ðŸ–¥ï¸ [MobilePOS] Screen Info:",{width:b.width,height:b.height,deviceCategory:b.deviceCategory,scale:t.scale,innerWidth:window.innerWidth,innerHeight:window.innerHeight,pixelRatio:window.devicePixelRatio})},[b.width,b.deviceCategory]);const[f,S]=x.useState("products"),[y,w]=x.useState([]),[_,q]=x.useState(""),[g,N]=x.useState(null),[s,a]=x.useState(null),[r,c]=x.useState({}),[u,m]=x.useState(0),[$,k]=x.useState("percentage"),[j,E]=x.useState(""),[B,I]=x.useState(!1),[X,H]=x.useState(!1),[Se,ee]=x.useState(!1),[we,ae]=x.useState(!1),[ie,ne]=x.useState(!1),[V,re]=x.useState(null),le=18;x.useEffect(()=>{h.length===0?(console.log("ðŸ“¦ [MobilePOS] No products in store, loading..."),P({page:1,limit:500})):console.log(`âœ… [MobilePOS] Using ${h.length} preloaded products`)},[]),x.useEffect(()=>{const i=async()=>{if(!h||h.length===0)return;const n=h.map(o=>o.id);try{const{data:o,error:d}=await J.from("product_images").select("product_id, image_url, is_primary").in("product_id",n).eq("is_primary",!0);if(d)throw d;if(o&&o.length>0){const p=o.reduce((W,D)=>(W[D.product_id]=D.image_url,W),{});c(p),console.log("âœ… [MobilePOS] Loaded",o.length,"product images")}}catch(o){console.error("âŒ [MobilePOS] Error loading product images:",o)}};h.length>0&&i()},[h]);const oe=x.useMemo(()=>h?(h.length>0&&h.length<=10&&console.log("ðŸ“Š [MobilePOS] Products loaded:",h.map(i=>{var n,o,d,p,W;return{name:i.name,hasVariants:!!i.variants&&i.variants.length>0,variantCount:((n=i.variants)==null?void 0:n.length)||0,price:i.price||i.selling_price,variantPrice:(d=(o=i.variants)==null?void 0:o[0])==null?void 0:d.selling_price,stock:((W=(p=i.variants)==null?void 0:p[0])==null?void 0:W.quantity)||i.stockQuantity}})),h.filter(i=>{var o,d,p;if(!_)return!0;const n=_.toLowerCase();return((o=i.name)==null?void 0:o.toLowerCase().includes(n))||((d=i.sku)==null?void 0:d.toLowerCase().includes(n))||((p=i.barcode)==null?void 0:p.toLowerCase().includes(n))})):[],[h,_]),Q=y.reduce((i,n)=>i+n.totalPrice,0),F=$==="percentage"?Q*u/100:Math.min(u,Q),ce=Q-F,te=ce*le/100,O=ce+te,$e=y.reduce((i,n)=>i+n.quantity,0),ke=i=>{if(!i.variants||i.variants.length===0){L.error("Product has no variants available");return}const n=i.variants.length>1,o=i.variants.some(p=>p.variant_type==="parent"||p.is_parent===!0);if(n||o){re(i),ne(!0);return}const d=i.variants[0];de(i,d)},de=(i,n)=>{if(!n){L.error("Invalid variant");return}const o=y.find(d=>d.variantId===n.id);if(o){if(o.quantity>=n.stock_quantity){L.error("Not enough stock available");return}w(y.map(d=>d.variantId===n.id?{...d,quantity:d.quantity+1,totalPrice:(d.quantity+1)*d.unitPrice}:d)),L.success("Quantity updated")}else{if((n.stock_quantity||n.quantity||0)<=0){L.error("Out of stock");return}const d={id:`${i.id}-${n.id}`,productId:i.id,variantId:n.id,productName:i.name,variantName:n.variant_name||n.name||"Default",sku:n.sku||i.sku||"",quantity:1,unitPrice:n.selling_price||n.unit_price||0,totalPrice:n.selling_price||n.unit_price||0,availableQuantity:n.stock_quantity||n.quantity||0,image:r[i.id]||i.image_url};w([...y,d]),L.success("Added to cart")}},Ce=i=>{V&&de(V,i)},xe=(i,n)=>{w(y.map(o=>{if(o.id===i){const d=Math.max(0,Math.min(o.quantity+n,o.availableQuantity));return d===0?null:{...o,quantity:d,totalPrice:d*o.unitPrice}}return o}).filter(Boolean))},Pe=i=>{w(y.filter(n=>n.id!==i))},ze=async(i,n)=>{try{if(console.log("ðŸ”„ [MobilePOS] Processing sale...",{items:y.length,total:O,payments:i.length}),!g){L.error("Please select a customer");return}const o={customerId:g==null?void 0:g.id,customerName:g==null?void 0:g.name,customerEmail:g==null?void 0:g.email,customerPhone:g==null?void 0:g.phone,items:y.map(p=>({productId:p.productId,variantId:p.variantId,productName:p.productName,variantName:p.variantName,sku:p.sku,quantity:p.quantity,unitPrice:p.unitPrice,totalPrice:p.totalPrice,costPrice:0,profit:0})),subtotal:Q,tax:te,discount:F,discountType:$,discountValue:u,total:O,paymentMethod:{type:i.length===1?i[0].paymentMethod:"multiple",details:{payments:i.map(p=>({method:p.paymentMethod,amount:p.amount,accountId:null,reference:p.reference||"",notes:"",timestamp:p.timestamp||new Date().toISOString()})),totalPaid:n},amount:n},paymentStatus:"completed",soldBy:(v==null?void 0:v.email)||"Mobile POS User",soldAt:new Date().toISOString(),notes:j||`Mobile POS Sale - Branch: ${(l==null?void 0:l.name)||"Unknown"}`};console.log("ðŸ“¤ [MobilePOS] Sending sale data:",o);const d=await Ae.processSale(o);if(!d.success)throw new Error(d.error||"Failed to process sale");console.log("âœ… [MobilePOS] Sale processed successfully:",d),a(d.sale),ee(!1),z.show({title:"Sale Completed!",message:`Sale of ${R.currency(O)} completed successfully`,icon:Ge.CheckCircle,color:"green",actions:[{label:"View Receipt",onClick:()=>ae(!0),variant:"primary"},{label:"New Sale",onClick:()=>{w([]),N(null),S("products")},variant:"secondary"}]}),w([]),N(null),S("products")}catch(o){console.error("âŒ [MobilePOS] Sale processing error:",o),L.error(o.message||"Failed to process sale")}},Y=y.length>0,se=y.length>0,ge=()=>{f==="products"&&Y?S("cart"):f==="cart"&&se&&(S("payment"),ee(!0))},_e=()=>{f==="payment"?S("cart"):f==="cart"&&S("products")},pe=[{id:"products",label:"Products",icon:Z},{id:"cart",label:"Cart",icon:Oe},{id:"payment",label:"Payment",icon:De}],ue=pe.findIndex(i=>i.id===f);return e.jsx(et,{children:e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{style:{paddingLeft:`${t.spacing8}px`,paddingRight:`${t.spacing8}px`,paddingTop:`${t.spacing8}px`,paddingBottom:`${t.spacing5}px`},children:[e.jsxs("div",{className:"flex items-center justify-between",style:{marginBottom:`${t.spacing6}px`},children:[e.jsx("button",{onClick:()=>M("/mobile/dashboard"),className:"active:bg-gray-100 rounded-full transition-all flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent",padding:`${t.spacing3}px`,width:`${t.buttonHeight}px`,height:`${t.buttonHeight}px`},children:e.jsx(He,{size:t.iconSizeLg,className:"text-blue-500",strokeWidth:2.5})}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{style:{fontSize:`${t.textSm}px`},className:"text-gray-400 uppercase tracking-wider font-semibold",children:f==="products"?"Step 1 of 3":f==="cart"?"Step 2 of 3":"Step 3 of 3"}),e.jsx("h1",{style:{fontSize:`${t.text3xl}px`,marginTop:`${t.spacing1}px`},className:"font-bold text-gray-900 tracking-tight",children:f==="products"?"Select Items":f==="cart"?"Review Order":"Payment"})]}),e.jsx("div",{style:{width:`${t.buttonHeight}px`}})]}),e.jsx("div",{className:"flex items-center justify-center",style:{gap:`${t.spacing2}px`},children:pe.map((i,n)=>{const o=n===ue,d=n<ue;return e.jsx("div",{style:{height:`${t.spacing1+2}px`,width:o?`${t.spacing8}px`:`${t.spacing1+2}px`,borderRadius:`${t.radiusFull}px`},className:`transition-all duration-300 ${o||d?"bg-blue-500":"bg-gray-300"}`},n)})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",style:{paddingBottom:`${t.spacing10+t.buttonHeight}px`},children:[f==="products"&&e.jsxs("div",{style:{paddingLeft:`${t.spacing8}px`,paddingRight:`${t.spacing8}px`},children:[e.jsx("div",{style:{marginBottom:`${t.spacing6}px`},children:e.jsxs("div",{className:"bg-gray-100/80 flex items-center",style:{borderRadius:`${t.radiusXl}px`,padding:`${t.spacing4}px ${t.spacing5}px`,gap:`${t.spacing3}px`},children:[e.jsx(ve,{className:"text-gray-400",size:t.iconSize,strokeWidth:2}),e.jsx("input",{type:"text",placeholder:"Search products...",value:_,onChange:i=>q(i.target.value),className:"flex-1 bg-transparent border-none outline-none placeholder-gray-400",style:{fontSize:`${t.textLg}px`}}),_&&e.jsx("button",{onClick:()=>q(""),className:"active:scale-90 transition-transform",style:{WebkitTapHighlightColor:"transparent"},children:e.jsx(K,{size:t.iconSize,className:"text-gray-400"})})]})}),e.jsx("div",{className:"grid",style:{gap:`${t.gapLg}px`,gridTemplateColumns:b.width<360?"1fr":b.width<600?"repeat(2, 1fr)":"repeat(3, 1fr)",width:"100%"},children:oe.map(i=>{var W;const n=(W=i.variants)==null?void 0:W[0],o=y.find(D=>D.variantId===(n==null?void 0:n.id)),d=(n==null?void 0:n.selling_price)||(n==null?void 0:n.price)||i.price||i.selling_price||0,p=(n==null?void 0:n.quantity)||(n==null?void 0:n.stock_quantity)||i.stockQuantity||0;return e.jsxs("button",{onClick:()=>ke(i),className:"bg-gray-50 active:scale-[0.97] transition-all duration-150",style:{WebkitTapHighlightColor:"transparent",borderRadius:`${t.radiusXl}px`,padding:`${t.productCardPadding}px`},children:[r[i.id]||i.image_url?e.jsx("div",{className:"w-full aspect-square bg-white mb-3 overflow-hidden shadow-sm",style:{borderRadius:`${t.productImageRadius}px`},children:e.jsx("img",{src:r[i.id]||i.image_url,alt:i.name,className:"w-full h-full object-cover",onError:D=>{const he=D.currentTarget;he.style.display="none";const fe=he.parentElement;fe&&(fe.innerHTML=`<div class="w-full h-full flex items-center justify-center"><svg width="${t.iconSizeXl}" height="${t.iconSizeXl}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></div>`)}})}):e.jsx("div",{className:"w-full aspect-square bg-white mb-3 flex items-center justify-center",style:{borderRadius:`${t.productImageRadius}px`},children:e.jsx(Z,{size:t.iconSizeXl,className:"text-gray-300"})}),e.jsx("h3",{style:{fontSize:`${t.textBase}px`},className:"font-semibold text-gray-900 mb-2 line-clamp-2 text-left leading-tight",children:i.name}),e.jsxs("div",{className:"flex items-end justify-between",style:{marginTop:`${t.spacing2}px`},children:[e.jsxs("div",{className:"flex flex-col items-start",style:{gap:`${t.spacing1}px`},children:[e.jsx("span",{style:{fontSize:`${t.textXl}px`},className:"font-bold text-gray-900",children:R.currency(d)}),e.jsx("span",{style:{fontSize:`${t.textSm}px`},className:`font-medium ${p===0?"text-red-500":p<=5?"text-orange-500":"text-green-600"}`,children:p===0?"Out of stock":`${p} in stock`})]}),o?e.jsx("div",{className:"bg-blue-500 text-white font-bold flex items-center justify-center",style:{fontSize:`${t.textBase}px`,padding:`${t.spacing2}px ${t.spacing3}px`,borderRadius:`${t.radiusFull}px`,minWidth:`${t.spacing8}px`},children:o.quantity}):e.jsx("div",{className:"rounded-full bg-blue-500 flex items-center justify-center shadow-md",style:{width:`${t.spacing8}px`,height:`${t.spacing8}px`},children:e.jsx(U,{size:Math.round(t.iconSize),className:"text-white",strokeWidth:3})})]})]},i.id)})}),oe.length===0&&e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",style:{width:`${t.avatarSize*1.5}px`,height:`${t.avatarSize*1.5}px`},children:e.jsx(Z,{size:Math.round(t.iconSizeLg*2),className:"text-gray-300"})}),e.jsx("p",{style:{fontSize:`${t.textLg}px`},className:"text-gray-400 font-medium",children:"No products found"})]})]}),f==="cart"&&e.jsxs("div",{style:{paddingLeft:`${t.spacing8}px`,paddingRight:`${t.spacing8}px`,display:"flex",flexDirection:"column",gap:`${t.spacing6}px`},children:[g?e.jsxs("div",{className:"bg-gray-50 flex items-center justify-between",style:{borderRadius:`${t.radiusXl}px`,padding:`${t.spacing5}px`},children:[e.jsxs("div",{className:"flex items-center",style:{gap:`${t.spacing4}px`},children:[e.jsx("div",{className:"rounded-full bg-blue-500 text-white flex items-center justify-center font-bold",style:{width:`${t.avatarSize}px`,height:`${t.avatarSize}px`,fontSize:`${t.textXl}px`},children:((me=g.name)==null?void 0:me.charAt(0))||"?"}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:`${t.textLg}px`},className:"font-semibold text-gray-900",children:g.name}),e.jsx("p",{style:{fontSize:`${t.textBase}px`},className:"text-gray-500",children:g.phone})]})]}),e.jsx("button",{onClick:()=>N(null),className:"rounded-full bg-gray-200 active:bg-gray-300 flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent",width:`${t.spacing8}px`,height:`${t.spacing8}px`},children:e.jsx(K,{size:t.iconSize,className:"text-gray-600"})})]}):e.jsxs("button",{onClick:()=>I(!0),className:"w-full bg-gray-50 flex items-center justify-between active:bg-gray-100 transition-colors",style:{WebkitTapHighlightColor:"transparent",borderRadius:`${t.radiusXl}px`,padding:`${t.spacing5}px`},children:[e.jsxs("div",{className:"flex items-center",style:{gap:`${t.spacing4}px`},children:[e.jsx("div",{className:"rounded-full bg-gray-200 flex items-center justify-center",style:{width:`${t.spacing10}px`,height:`${t.spacing10}px`},children:e.jsx(Ne,{size:t.iconSize,className:"text-gray-500"})}),e.jsx("span",{style:{fontSize:`${t.textLg}px`},className:"text-gray-600 font-medium",children:"Add Customer"})]}),e.jsx(U,{size:t.iconSize,className:"text-gray-400"})]}),e.jsxs("div",{className:"bg-gray-50",style:{borderRadius:`${t.radiusXl}px`,padding:`${t.spacing5}px`},children:[e.jsxs("div",{className:"flex items-center justify-between",style:{marginBottom:`${t.spacing4}px`},children:[e.jsx("span",{style:{fontSize:`${t.textLg}px`},className:"font-semibold text-gray-900",children:"Discount"}),e.jsxs("div",{className:"flex items-center",style:{gap:`${t.spacing2}px`},children:[e.jsx("button",{onClick:()=>k("percentage"),className:`font-semibold transition-colors ${$==="percentage"?"bg-blue-500 text-white":"bg-gray-200 text-gray-600"}`,style:{padding:`${t.spacing2}px ${t.spacing4}px`,borderRadius:`${t.radiusMd}px`,fontSize:`${t.textBase}px`},children:"%"}),e.jsx("button",{onClick:()=>k("fixed"),className:`font-semibold transition-colors ${$==="fixed"?"bg-blue-500 text-white":"bg-gray-200 text-gray-600"}`,style:{padding:`${t.spacing2}px ${t.spacing4}px`,borderRadius:`${t.radiusMd}px`,fontSize:`${t.textBase}px`},children:"TSh"})]})]}),e.jsx("input",{type:"number",value:u,onChange:i=>m(Math.max(0,parseFloat(i.target.value)||0)),placeholder:"Enter discount",className:"w-full bg-white border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",style:{padding:`${t.spacing4}px ${t.spacing5}px`,borderRadius:`${t.radiusLg}px`,fontSize:`${t.textLg}px`}}),F>0&&e.jsxs("p",{style:{fontSize:`${t.textBase}px`,marginTop:`${t.spacing3}px`},className:"text-green-600 font-medium",children:["Discount: -",R.currency(F)]})]}),e.jsxs("div",{className:"bg-gray-50",style:{borderRadius:`${t.radiusXl}px`,padding:`${t.spacing5}px`},children:[e.jsx("label",{style:{fontSize:`${t.textLg}px`,marginBottom:`${t.spacing4}px`},className:"font-semibold text-gray-900 block",children:"Order Notes (Optional)"}),e.jsx("textarea",{value:j,onChange:i=>E(i.target.value),placeholder:"Add any special instructions or notes...",rows:3,className:"w-full bg-white border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",style:{padding:`${t.spacing4}px ${t.spacing5}px`,borderRadius:`${t.radiusLg}px`,fontSize:`${t.textLg}px`}})]}),e.jsx("div",{className:"bg-gray-50 overflow-hidden",style:{borderRadius:`${t.radiusXl}px`},children:y.map((i,n)=>e.jsx("div",{className:n!==y.length-1?"border-b border-gray-200/50":"",style:{padding:`${t.spacing5}px`},children:e.jsxs("div",{className:"flex",style:{gap:`${t.spacing5}px`},children:[i.image&&e.jsx("div",{className:"bg-white overflow-hidden shadow-sm flex-shrink-0",style:{width:`${t.avatarSize*1.8}px`,height:`${t.avatarSize*1.8}px`,borderRadius:`${t.radiusLg}px`},children:e.jsx("img",{src:i.image,alt:i.productName,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{style:{fontSize:`${t.textLg}px`,marginBottom:`${t.spacing1}px`},className:"font-semibold text-gray-900",children:i.productName}),e.jsxs("p",{style:{fontSize:`${t.textBase}px`,marginBottom:`${t.spacing4}px`},className:"text-gray-500",children:[R.currency(i.unitPrice)," Ã— ",i.quantity," = ",R.currency(i.totalPrice)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center bg-white shadow-md",style:{borderRadius:`${t.radiusLg}px`},children:[e.jsx("button",{onClick:()=>xe(i.id,-1),className:"flex items-center justify-center active:bg-gray-100",style:{WebkitTapHighlightColor:"transparent",width:`${t.buttonHeight}px`,height:`${t.buttonHeight}px`,borderTopLeftRadius:`${t.radiusLg}px`,borderBottomLeftRadius:`${t.radiusLg}px`},children:e.jsx(Fe,{size:t.iconSize,className:"text-gray-600",strokeWidth:2.5})}),e.jsx("span",{className:"text-center font-bold",style:{fontSize:`${t.textLg}px`,minWidth:`${t.spacing10}px`},children:i.quantity}),e.jsx("button",{onClick:()=>xe(i.id,1),className:"flex items-center justify-center active:bg-gray-100",disabled:i.quantity>=i.availableQuantity,style:{WebkitTapHighlightColor:"transparent",width:`${t.buttonHeight}px`,height:`${t.buttonHeight}px`,borderTopRightRadius:`${t.radiusLg}px`,borderBottomRightRadius:`${t.radiusLg}px`},children:e.jsx(U,{size:t.iconSize,className:"text-gray-600",strokeWidth:2.5})})]}),e.jsx("button",{onClick:()=>Pe(i.id),className:"rounded-full bg-red-100 active:bg-red-200 flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent",width:`${t.spacing10}px`,height:`${t.spacing10}px`},children:e.jsx(K,{size:t.iconSize,className:"text-red-600",strokeWidth:2.5})})]})]})]})},i.id))}),e.jsx("div",{className:"bg-gray-50",style:{borderRadius:`${t.radiusXl}px`,padding:`${t.spacing6}px`},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${t.spacing5}px`},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{style:{fontSize:`${t.textLg}px`},className:"text-gray-600",children:"Subtotal"}),e.jsx("span",{style:{fontSize:`${t.textLg}px`},className:"font-semibold text-gray-900",children:R.currency(Q)})]}),F>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{style:{fontSize:`${t.textLg}px`},className:"text-green-600",children:"Discount"}),e.jsxs("span",{style:{fontSize:`${t.textLg}px`},className:"font-semibold text-green-600",children:["-",R.currency(F)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{style:{fontSize:`${t.textLg}px`},className:"text-gray-600",children:["Tax (",le,"%)"]}),e.jsx("span",{style:{fontSize:`${t.textLg}px`},className:"font-semibold text-gray-900",children:R.currency(te)})]}),e.jsx("div",{style:{height:"2px"},className:"bg-gray-300"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{style:{fontSize:`${t.text2xl}px`},className:"font-bold text-gray-900",children:"Total"}),e.jsx("span",{style:{fontSize:`${t.text3xl}px`},className:"font-bold text-gray-900",children:R.currency(O)})]})]})})]})]}),e.jsxs("div",{className:"bg-white/95 backdrop-blur-xl border-t border-gray-200/50 safe-area-inset-bottom",style:{padding:`${t.spacing4}px ${t.spacing6}px`,paddingBottom:`calc(${t.spacing4}px + var(--safe-area-inset-bottom, 0px))`},children:[f==="products"&&e.jsx("button",{onClick:ge,disabled:!Y,className:`w-full font-semibold transition-all ${Y?"bg-blue-500 text-white active:scale-[0.98]":"bg-gray-200 text-gray-400"}`,style:{WebkitTapHighlightColor:"transparent",padding:`${t.spacing4}px`,borderRadius:`${t.radiusLg}px`,fontSize:`${t.textLg}px`,minHeight:`${t.buttonHeight}px`},children:Y?`Continue (${$e})`:"Add Items to Continue"}),f==="cart"&&e.jsxs("div",{className:"flex",style:{gap:`${t.spacing3}px`},children:[e.jsx("button",{onClick:_e,className:"bg-gray-100 text-gray-900 active:scale-95 transition-all font-semibold",style:{WebkitTapHighlightColor:"transparent",padding:`${t.spacing4}px ${t.spacing8}px`,borderRadius:`${t.radiusLg}px`,fontSize:`${t.textLg}px`,minHeight:`${t.buttonHeight}px`},children:"Back"}),e.jsxs("button",{onClick:ge,disabled:!se,className:`flex-1 font-semibold transition-all ${se?"bg-blue-500 text-white active:scale-[0.98]":"bg-gray-200 text-gray-400"}`,style:{WebkitTapHighlightColor:"transparent",padding:`${t.spacing4}px`,borderRadius:`${t.radiusLg}px`,fontSize:`${t.textLg}px`,minHeight:`${t.buttonHeight}px`},children:["Pay ",R.currency(O)]})]})]}),ie&&V&&e.jsx(it,{isOpen:ie,onClose:()=>{ne(!1),re(null)},product:V,onSelectVariant:Ce}),B&&e.jsx(st,{customers:T,onSelect:i=>{N(i),I(!1)},onClose:()=>I(!1),onAddNew:()=>{I(!1),H(!0)}}),X&&e.jsx(Qe,{onClose:()=>H(!1),onSuccess:i=>{N(i),H(!1),C()}}),Se&&e.jsx(at,{amount:O,onClose:()=>{ee(!1),S("cart")},onComplete:ze}),we&&s&&e.jsx(Xe,{receipt:s,onClose:()=>ae(!1)}),e.jsx(Ye,{...z.props})]})})};export{Pt as default};
