import{_ as R}from"./supabase-cf010ec4.js";import{s as M,j as e}from"./index-61458a34.js";import{r as o}from"./vendor-36d2c7c1.js";import{n as l}from"./ui-28e30067.js";import"./routing-eb8c310c.js";const u=[{id:"mobishastra",name:"Mobishastra",apiUrl:"https://mshastra.com/sendurl.aspx",description:"Popular SMS provider in Tanzania",pricing:"~15 TZS per SMS"},{id:"sms_tanzania",name:"SMS Tanzania",apiUrl:"https://api.smstanzania.com/send",description:"Reliable SMS service for Tanzania",pricing:"~12 TZS per SMS"},{id:"bulksms",name:"BulkSMS",apiUrl:"https://api.bulksms.com/send",description:"International SMS provider",pricing:"~10 TZS per SMS"},{id:"custom",name:"Custom Provider",apiUrl:"",description:"Use your own SMS provider",pricing:"Varies"}],L=()=>{const[_,w]=o.useState([]),[k,h]=o.useState(!0),[S,b]=o.useState(!1),[x,f]=o.useState(!1),[C,y]=o.useState(""),[c,d]=o.useState({apiKey:"",apiUrl:"",price:"15"});o.useEffect(()=>{v()},[]);const v=async()=>{var s,t;try{h(!0),console.log("ðŸ“¡ Fetching SMS settings from database...");const{data:r,error:i}=await M.from("settings").select("*").or("key.eq.sms_provider_api_key,key.eq.sms_api_url,key.eq.sms_provider_password").order("key");if(console.log("ðŸ“¥ SMS settings response:",{data:r,error:i}),i){i.code==="PGRST116"||(s=i.message)!=null&&s.includes("does not exist")?console.warn("âš ï¸ SMS settings table not configured yet"):(console.warn("âŒ SMS settings database error:",i),l.error("Failed to fetch SMS settings"));return}console.log("âœ… Successfully fetched SMS settings:",r),w(r||[]);const g=r==null?void 0:r.find(n=>n.key==="sms_provider_api_key"),a=r==null?void 0:r.find(n=>n.key==="sms_api_url"),U=r==null?void 0:r.find(n=>n.key==="sms_provider_password");if(console.log("ðŸ”§ Found settings:",{apiKeySetting:g,apiUrlSetting:a,passwordSetting:U}),d({apiKey:(g==null?void 0:g.value)||"",apiUrl:(a==null?void 0:a.value)||"",price:"15"}),a!=null&&a.value){const n=u.find(N=>a.value.includes(N.apiUrl)||N.id==="custom"&&!u.some(E=>a.value.includes(E.apiUrl)));n&&(console.log("ðŸŽ¯ Auto-selected provider:",n.name),y(n.id))}}catch(r){if(console.log("ðŸš¨ Exception caught in fetchSMSSettings:",r),r!=null&&r.error&&(r==null?void 0:r.data)!==void 0){const i=r.error;console.log("ðŸ” Extracted error from response object:",i),i.code==="PGRST116"||(t=i.message)!=null&&t.includes("does not exist")?console.warn("âš ï¸ SMS settings table not configured yet"):(console.warn("âŒ SMS settings database error (from thrown response):",i),l.error("Failed to fetch SMS settings"))}else console.warn("â“ Unable to load SMS settings - unexpected error:",r)}finally{h(!1)}},P=s=>{y(s);const t=u.find(r=>r.id===s);t&&t.apiUrl&&d(r=>({...r,apiUrl:t.apiUrl}))},T=async()=>{try{b(!0);const s=[{key:"sms_provider_api_key",value:c.apiKey},{key:"sms_api_url",value:c.apiUrl},{key:"sms_price",value:c.price}],{error:t}=await M.from("settings").upsert(s,{onConflict:"key"});if(t){console.error("Error saving SMS settings:",t),l.error("Failed to save SMS settings");return}l.success("SMS settings saved successfully!"),f(!1),await v()}catch(s){console.error("Error saving SMS settings:",s),l.error("Failed to save SMS settings")}finally{b(!1)}},j=async()=>{try{const{smsService:s}=await R(()=>import("./index-61458a34.js").then(r=>r.ba),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),t=await s.sendSMS("255700000000","Test SMS from LATS CHANCE - Configuration working!",{ai_enhanced:!1});t.success?l.success("SMS test successful! Check SMS logs for details."):l.error(`SMS test failed: ${t.error||"Unknown error"}`)}catch(s){console.error("SMS test error:",s),l.error("SMS test failed. Check console for details.")}},m=s=>{var t;return((t=_.find(r=>r.key===s))==null?void 0:t.value)||"Not configured"},p=s=>{const t=m(s);return t==="Not configured"?"âŒ":s==="sms_provider_api_key"&&t.length>0||s==="sms_api_url"&&t.includes("http")||s==="sms_price"&&!isNaN(Number(t))?"âœ…":"âš ï¸"};return k?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"SMS Settings"}),e.jsx("p",{className:"text-gray-600",children:"Configure your SMS provider credentials and settings"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Current Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"API Key"}),e.jsx("span",{className:"text-2xl",children:p("sms_provider_api_key")})]}),e.jsx("p",{className:"text-sm text-gray-600",children:m("sms_provider_api_key")==="Not configured"?"Not configured":`${m("sms_provider_api_key").substring(0,10)}...`})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"API URL"}),e.jsx("span",{className:"text-2xl",children:p("sms_api_url")})]}),e.jsx("p",{className:"text-sm text-gray-600 break-all",children:m("sms_api_url")})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Price per SMS"}),e.jsx("span",{className:"text-2xl",children:p("sms_price")})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m("sms_price")," TZS"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Configure SMS Provider"}),e.jsx("button",{onClick:()=>f(!x),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:x?"Cancel":"Edit Settings"})]}),x?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SMS Provider"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:u.map(s=>e.jsxs("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-colors ${C===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>P(s.id),children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.pricing})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Key"}),e.jsx("input",{type:"text",value:c.apiKey,onChange:s=>d(t=>({...t,apiKey:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your SMS provider API key"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API URL"}),e.jsx("input",{type:"url",value:c.apiUrl,onChange:s=>d(t=>({...t,apiUrl:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://your-sms-provider.com/api/send"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price per SMS (TZS)"}),e.jsx("input",{type:"number",value:c.price,onChange:s=>d(t=>({...t,price:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"15"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:T,disabled:S,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors",children:S?"Saving...":"Save Settings"}),e.jsx("button",{onClick:j,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Test SMS"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:'Click "Edit Settings" to configure your SMS provider'}),e.jsx("button",{onClick:j,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Test Current Configuration"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Need Help?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Popular SMS Providers"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Mobishastra:"})," https://mshastra.com/"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"SMS Tanzania:"})," https://smstanzania.com/"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"BulkSMS:"})," https://www.bulksms.com/"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Testing"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{children:["â€¢ Use phone number: ",e.jsx("code",{children:"255700000000"})," for testing"]}),e.jsx("li",{children:"â€¢ Test SMS will simulate success"}),e.jsx("li",{children:"â€¢ Check SMS logs for delivery status"})]})]})]})]})]})})};export{L as default};
