import{j as e,x as yt,s as P,M as Z,u as Q,ax as Ze,y as jt,$ as bt,b4 as nt,aO as vt,an as Ne,e as lt}from"./index-61458a34.js";import{r as c}from"./vendor-36d2c7c1.js";import{P as Nt}from"./PageErrorWrapper-b69ee385.js";import{u as wt}from"./useErrorHandler-ecda4689.js";import{b as St,u as kt,c as Ct,d as _t}from"./useSmartGridLayout-0626d484.js";import{r as je,b as it,aw as Me,ax as Ae,al as fe,E as q,y as X,p as ie,N as H,U as ot,u as ne,e as oe,q as Se,aE as De,af as ee,b_ as Pe,av as ke,a4 as Re,V as Ce,d as ue,n as we,at as ye,b2 as We,aV as Ue,a2 as Dt,aP as Tt,S as _e,A as be,cH as Mt,ae as Ve,aq as Le,k as Je,O as Ee,o as ze,a5 as ct,br as qe,b7 as Xe,X as It,z as Y,R as Ye,$ as Ie,aA as Ke,s as dt,Q as mt,D as Ge,j as $t,a9 as At,a$ as Pt,T as Qe,B as et,Z as xt,x as Lt,w as Et,bV as Rt,bW as Ft,f as tt,a3 as Ot,a8 as Be,v as zt,ag as st,_ as Bt,bm as Wt,a6 as Vt}from"./ui-28e30067.js";import{d as ae}from"./dashboardService-a4d4a6f3.js";import{a as K}from"./routing-eb8c310c.js";import{A as qt}from"./AddProductModal-144ca68a.js";import{r as at}from"./reminderApi-be7f32c2.js";import{EnhancedReminderModal as Kt}from"./RemindersPage-5edfe80e.js";import{_ as te}from"./supabase-cf010ec4.js";import{M as J}from"./Modal-a5e4c1ba.js";import{c as Gt}from"./backupApi-b9211f47.js";import{R as ce,A as gt,C as he,X as pe,Y as ge,T as de,e as He,f as ut,g as ht,h as Te,B as Fe,i as ve,L as Qt,j as $e,k as Ht}from"./charts-d592fbd1.js";import{A as Zt}from"./AppointmentModal-91a07df7.js";import{c as Ut}from"./appointments-0b344a33.js";import"./PageErrorBoundary-3d3e48b8.js";import"./ErrorState-8ed6c2f9.js";import"./skuUtils-60e0a165.js";import"./CategoryInput-e47eba98.js";import"./specificationUtils-0c00478d.js";import"./useBodyScrollLock-341c8b9f.js";import"./forms-ebbdb905.js";import"./BackButton-02a80e74.js";import"./useSuccessModal-081786c4.js";import"./SuccessModalIcons-fe811e4d.js";const rt=[{value:"7days",label:"Last 7 Days"},{value:"1month",label:"Last Month"},{value:"3months",label:"Last 3 Months"},{value:"6months",label:"Last 6 Months"},{value:"custom",label:"Custom Range"}],Jt=({value:f,onChange:u,className:a=""})=>{const[b,_]=c.useState(!1),[N,T]=c.useState(!1),[C,v]=c.useState(""),[p,j]=c.useState(""),t=n=>{const d=new Date,l=new Date;switch(n){case"7days":l.setDate(d.getDate()-7);break;case"1month":l.setMonth(d.getMonth()-1);break;case"3months":l.setMonth(d.getMonth()-3);break;case"6months":l.setMonth(d.getMonth()-6);break;case"custom":return f}return{startDate:l,endDate:d,preset:n}},o=n=>{n==="custom"?T(!0):(T(!1),u(t(n)),_(!1))},s=()=>{C&&p&&(u({startDate:new Date(C),endDate:new Date(p),preset:"custom"}),T(!1),_(!1))},r=n=>{var d;return n.preset==="custom"?`${n.startDate.toLocaleDateString()} - ${n.endDate.toLocaleDateString()}`:((d=rt.find(l=>l.value===n.preset))==null?void 0:d.label)||"Select Range"};return e.jsxs("div",{className:`relative ${a}`,children:[e.jsxs("button",{onClick:()=>_(!b),className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(je,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r(f)}),e.jsx(it,{className:`w-4 h-4 text-gray-600 transition-transform ${b?"rotate-180":""}`})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>{_(!1),T(!1)}}),e.jsx("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:N?e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Custom Date Range"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:C,onChange:n=>v(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:p,onChange:n=>j(n.target.value),min:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>T(!1),className:"flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:s,disabled:!C||!p,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Apply"})]})]})]}):e.jsx("div",{className:"p-2",children:rt.map(n=>e.jsx("button",{onClick:()=>o(n.value),className:`w-full text-left px-3 py-2 rounded-md hover:bg-gray-100 transition-colors ${f.preset===n.value?"bg-indigo-50 text-indigo-600 font-medium":"text-gray-700"}`,children:n.label},n.value))})})]})]})},Yt=({onBranchChange:f,defaultToCurrent:u=!0,className:a=""})=>{const{isDark:b}=yt(),[_,N]=c.useState([]),[T,C]=c.useState(null),[v,p]=c.useState(!1),[j,t]=c.useState(!0);c.useEffect(()=>{o()},[]);const o=async()=>{try{t(!0);const{data:n,error:d}=await P.from("store_locations").select("id, name, code, city, is_main").eq("is_active",!0).order("is_main",{ascending:!1}).order("name",{ascending:!0});if(d)throw d;if(N(n||[]),u){const l=Z();C(l),f(l)}else C(null),f(null)}catch(n){console.error("Failed to load branches:",n)}finally{t(!1)}},s=n=>{C(n),f(n),p(!1)},r=()=>{if(!T)return"All Branches";const n=_.find(d=>d.id===T);return n?`${n.name} ${n.code?`(${n.code})`:""}`:"Select Branch"};return j?e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg border ${b?"bg-slate-800 border-slate-700":"bg-white border-slate-200"} ${a}`,children:[e.jsx(Me,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-sm",children:"Loading..."})]}):e.jsxs("div",{className:`relative ${a}`,children:[e.jsxs("button",{onClick:()=>p(!v),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-all ${b?"bg-slate-800 border-slate-700 text-slate-200 hover:bg-slate-700":"bg-white border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:r()}),e.jsx(it,{className:`w-4 h-4 transition-transform ${v?"rotate-180":""}`})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>p(!1)}),e.jsxs("div",{className:`absolute right-0 top-full mt-2 w-64 rounded-lg border shadow-lg z-50 max-h-96 overflow-y-auto ${b?"bg-slate-800 border-slate-700":"bg-white border-slate-200"}`,children:[e.jsxs("button",{onClick:()=>s(null),className:`w-full flex items-center justify-between px-4 py-3 text-left transition-colors ${T===null?b?"bg-indigo-900/30 text-indigo-300":"bg-indigo-50 text-indigo-700":b?"hover:bg-slate-700 text-slate-200":"hover:bg-slate-50 text-slate-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"All Branches"}),e.jsx("div",{className:`text-xs ${T===null?"text-indigo-400":"text-slate-500"}`,children:"View combined data from all locations"})]})]}),T===null&&e.jsx(Ae,{className:"w-5 h-5 text-indigo-500"})]}),e.jsx("div",{className:`border-t ${b?"border-slate-700":"border-slate-200"}`}),_.map(n=>e.jsxs("button",{onClick:()=>s(n.id),className:`w-full flex items-center justify-between px-4 py-3 text-left transition-colors ${T===n.id?b?"bg-indigo-900/30 text-indigo-300":"bg-indigo-50 text-indigo-700":b?"hover:bg-slate-700 text-slate-200":"hover:bg-slate-50 text-slate-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:[n.name,n.is_main&&e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${b?"bg-yellow-900/30 text-yellow-400":"bg-yellow-100 text-yellow-700"}`,children:"Main"})]}),e.jsxs("div",{className:`text-xs ${T===n.id?"text-indigo-400":"text-slate-500"}`,children:[n.code&&`${n.code} â€¢ `,n.city||"Location"]})]})]}),T===n.id&&e.jsx(Ae,{className:"w-5 h-5 text-indigo-500"})]},n.id))]})]})]})},pt=c.createContext(void 0),Xt=({children:f})=>{const[u,a]=c.useState(()=>Z()),b=N=>{console.log("ðŸ“Š Dashboard branch filter changed:",N||"All Branches"),a(N)},_=u===null;return e.jsx(pt.Provider,{value:{dashboardBranchId:u,setDashboardBranchId:b,isViewingAllBranches:_},children:f})},es=()=>{const f=c.useContext(pt);if(f===void 0)throw new Error("useDashboardBranch must be used within a DashboardBranchProvider");return f},ts=({className:f})=>{const{currentUser:u}=Q(),a=K(),[b,_]=c.useState([]),[N,T]=c.useState(0),[C,v]=c.useState(!0);c.useEffect(()=>{u!=null&&u.id&&p()},[u==null?void 0:u.id]);const p=async()=>{if(u!=null&&u.id)try{v(!0);const[t,o]=await Promise.all([ae.getRecentNotifications(u.id,5),ae.getDashboardStats(u.id)]);_(t),T(o.unreadNotifications)}catch(t){console.error("Error loading notifications:",t)}finally{v(!1)}},j=t=>{const o=new Date,s=new Date(t),r=Math.floor((o.getTime()-s.getTime())/(1e3*60*60));return r<1?"Just now":r<24?`${r}h ago`:`${Math.floor(r/24)}d ago`};return C?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Notifications"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:N>0?`${N} unread messages`:"All caught up"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[N>0&&e.jsxs("div",{className:"px-3 py-1.5 rounded-full bg-rose-50 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-rose-500",children:N})]}),e.jsxs("button",{onClick:()=>a("/notifications"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Notifications",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:b.length>0?b.map(t=>e.jsx("div",{className:`p-4 rounded-lg transition-colors ${t.isRead?"bg-gray-50 hover:bg-gray-100":"bg-blue-50 hover:bg-blue-100"}`,children:e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate flex-1",children:t.title}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium capitalize ${t.priority==="urgent"?"bg-rose-100 text-rose-600":t.priority==="high"?"bg-amber-100 text-amber-600":"bg-gray-100 text-gray-600"}`,children:t.priority})]}),e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:t.message}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-400",children:[e.jsx(X,{size:12}),e.jsx("span",{children:j(t.createdAt)})]})]})})},t.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(fe,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No notifications yet"})]})})]})},ss=({className:f})=>{const u=K(),{currentUser:a}=Q(),[b,_]=c.useState([]),[N,T]=c.useState({present:0,total:0,onLeave:0,attendanceRate:0}),[C,v]=c.useState(!0);c.useEffect(()=>{p()},[]);const p=async()=>{try{v(!0);const[j,t]=await Promise.all([ae.getTodayEmployeeStatus(),ae.getDashboardStats((a==null?void 0:a.id)||"")]);_(j),T({present:t.presentToday,total:t.totalEmployees,onLeave:t.onLeaveToday,attendanceRate:t.attendanceRate})}catch(j){console.error("Error loading employee data:",j)}finally{v(!1)}};return C?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Staff Today"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[N.present,"/",N.total," present â€¢ ",N.attendanceRate,"%"]})]})]}),e.jsxs("button",{onClick:()=>u("/employees"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Employees",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Present"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:N.present})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"On Leave"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:N.onLeave})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Rate"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[N.attendanceRate,"%"]})]})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:b.length>0?b.slice(0,5).map(j=>{var t;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-9 h-9 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:((t=j.full_name)==null?void 0:t.split(" ").map(o=>o[0]).join(""))||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:j.full_name||j.email}),e.jsx("p",{className:"text-xs text-gray-400",children:j.checkInTime?`Checked in at ${j.checkInTime}`:"No check-in"})]}),e.jsx("span",{className:`text-xs font-medium capitalize ${j.status==="present"?"text-emerald-600":j.status==="late"?"text-amber-600":j.status==="absent"?"text-rose-600":"text-gray-600"}`,children:j.status})]},j.id)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(ie,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No employee data"})]})}),e.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:e.jsxs("button",{onClick:()=>u("/employees/add"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"Add Employee"})]})})]})},as=({className:f})=>{const u=K(),{currentUser:a}=Q(),[b,_]=c.useState([]),[N,T]=c.useState({today:0,upcoming:0,completionRate:0}),[C,v]=c.useState(!0);c.useEffect(()=>{p()},[]);const p=async()=>{try{v(!0);const[t,o]=await Promise.all([ae.getTodayAppointments(4),ae.getDashboardStats((a==null?void 0:a.id)||"")]);_(t),T({today:o.todayAppointments,upcoming:o.upcomingAppointments,completionRate:o.appointmentCompletionRate})}catch(t){console.error("Error loading appointments:",t)}finally{v(!1)}},j=t=>{try{return new Date(`2000-01-01T${t}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return t}};return C?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Today's Schedule"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[N.today," appointments â€¢ ",N.completionRate,"% done"]})]})]}),e.jsxs("button",{onClick:()=>u("/appointments"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Appointments",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Today"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:N.today})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Upcoming"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:N.upcoming})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Done"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[N.completionRate,"%"]})]})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:b.length>0?b.map(t=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(X,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:j(t.time)}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium capitalize ${t.status==="confirmed"||t.status==="completed"?"bg-emerald-50 text-emerald-600":t.status==="in-progress"?"bg-blue-50 text-blue-600":t.status==="cancelled"?"bg-rose-50 text-rose-600":"bg-gray-100 text-gray-600"}`,children:t.status})]}),e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:t.customerName}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.serviceName}),t.technicianName&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ot,{size:12,className:"text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-400",children:t.technicianName})]})]})})},t.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(je,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No appointments today"})]})}),e.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:e.jsxs("button",{onClick:()=>u("/appointments/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"Add Appointment"})]})})]})},rs=({className:f})=>{const u=K(),{currentUser:a}=Q(),[b,_]=c.useState([]),[N,T]=c.useState({lowStock:0,critical:0,total:0,value:0}),[C,v]=c.useState(!0),[p,j]=c.useState(!1);c.useEffect(()=>{t()},[]);const t=async()=>{try{v(!0);const[s,r]=await Promise.all([ae.getInventoryAlerts(4),ae.getDashboardStats((a==null?void 0:a.id)||"")]);console.log("ðŸ“¦ Inventory Value:",{raw:r.inventoryValue,type:typeof r.inventoryValue,asString:String(r.inventoryValue)}),_(s),T({lowStock:r.lowStockItems,critical:r.criticalStockAlerts,total:r.totalProducts,value:r.inventoryValue})}catch(s){console.error("Error loading inventory data:",s)}finally{v(!1)}},o=s=>{if(!s||isNaN(s)||s<0)return"TSh 0";const r=typeof s=="string"?parseFloat(s):s;return r>=1e9?`TSh ${(r/1e9).toFixed(1)}B`:r>=1e6?`TSh ${(r/1e6).toFixed(1)}M`:r>=1e3?`TSh ${(r/1e3).toFixed(1)}K`:`TSh ${r.toLocaleString()}`};return C?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Inventory Status"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[N.total," products tracked"]})]})]}),e.jsxs("button",{onClick:()=>u("/lats/inventory"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Products",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Critical"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:N.critical})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Low Stock"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:N.lowStock})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Value"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:o(N.value)})]})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:b.length>0?b.map(s=>e.jsx("div",{className:`p-3 rounded-lg ${s.alertLevel==="out-of-stock"?"bg-rose-50":s.alertLevel==="critical"?"bg-amber-50":"bg-gray-50"} hover:opacity-80 transition-opacity`,children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:s.productName}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s.category}),e.jsxs("span",{className:`text-xs font-medium ${s.alertLevel==="out-of-stock"?"text-rose-600":s.alertLevel==="critical"?"text-amber-600":"text-gray-600"}`,children:[s.currentStock,"/",s.minimumStock," units"]})]})]})})},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(ne,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"All stock levels normal"})]})}),e.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:e.jsxs("button",{onClick:()=>j(!0),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"Add Product"})]})}),e.jsx(qt,{isOpen:p,onClose:()=>j(!1),onProductCreated:()=>{j(!1),t()}})]})},ns=({className:f})=>{const u=K(),[a,b]=c.useState(null),[_,N]=c.useState(!0);c.useEffect(()=>{T()},[]);const T=async()=>{try{N(!0),console.log("ðŸ”„ Starting to fetch financial data...");const t=await ae.getFinancialSummary();console.log("ðŸ’° Financial Data Loaded:",t),console.log("ðŸ’³ Payment Methods Detail:",t.paymentMethods.map(o=>({method:o.method,amount:o.amount,formatted:v(o.amount)}))),b(t)}catch(t){console.error("âŒ Error loading financial data:",t)}finally{N(!1)}},C=t=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),v=t=>!t||isNaN(t)||t<0?"TSh 0":t>1e11?(console.warn("âš ï¸ Suspicious payment amount detected:",t),"TSh ??? (Check Data)"):t>=1e9?`TSh ${(t/1e9).toFixed(1)}B`:t>=1e6?`TSh ${(t/1e6).toFixed(1)}M`:t>=1e3?`TSh ${(t/1e3).toFixed(1)}K`:C(t),p=t=>t>0?e.jsx(ee,{size:12}):t<0?e.jsx(Pe,{size:12}):null,j=t=>{const o=[{bg:"bg-blue-50",hover:"hover:bg-blue-100",icon:"text-blue-500",text:"text-blue-900"},{bg:"bg-emerald-50",hover:"hover:bg-emerald-100",icon:"text-emerald-500",text:"text-emerald-900"},{bg:"bg-purple-50",hover:"hover:bg-purple-100",icon:"text-purple-500",text:"text-purple-900"},{bg:"bg-orange-50",hover:"hover:bg-orange-100",icon:"text-orange-500",text:"text-orange-900"},{bg:"bg-pink-50",hover:"hover:bg-pink-100",icon:"text-pink-500",text:"text-pink-900"},{bg:"bg-cyan-50",hover:"hover:bg-cyan-100",icon:"text-cyan-500",text:"text-cyan-900"},{bg:"bg-indigo-50",hover:"hover:bg-indigo-100",icon:"text-indigo-500",text:"text-indigo-900"},{bg:"bg-teal-50",hover:"hover:bg-teal-100",icon:"text-teal-500",text:"text-teal-900"}];return o[t%o.length]};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):a?e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Financial Overview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("p",{className:"text-xs text-gray-400",children:[v(a.monthlyRevenue)," this month"]}),a.revenueGrowth!==0&&e.jsxs("div",{className:`flex items-center gap-0.5 ${a.revenueGrowth>0?"text-emerald-500":"text-rose-500"}`,children:[p(a.revenueGrowth),e.jsxs("span",{className:"text-xs font-medium",children:[Math.abs(a.revenueGrowth),"%"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.outstandingAmount>0&&e.jsx("div",{className:"px-3 py-1.5 rounded-full bg-amber-50",children:e.jsx("span",{className:"text-xs font-medium text-amber-600",children:v(a.outstandingAmount)})}),e.jsxs("button",{onClick:()=>u("/finance/payments"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Payments",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Today"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:v(a.todayRevenue)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"This Week"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:v(a.weeklyRevenue)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Payments"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:a.completedPayments})]})]}),e.jsxs("div",{className:"space-y-2 mb-6 flex-grow max-h-64 overflow-y-auto",children:[e.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Payment Methods"}),a.paymentMethods.length>0?a.paymentMethods.map((t,o)=>{const s=j(o);return e.jsxs("div",{className:`flex items-center justify-between p-3 ${s.bg} rounded-lg ${s.hover} transition-colors`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{size:14,className:s.icon}),e.jsx("span",{className:`text-sm font-medium ${s.text} capitalize`,children:t.method})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-sm font-semibold ${s.text}`,children:v(t.amount)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.count," trans."]})]})]},o)}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No payment data"})})]}),a.outstandingAmount>0&&e.jsx("div",{className:"mb-6 p-3 bg-amber-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{size:16,className:"text-amber-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-amber-900",children:["Outstanding: ",C(a.outstandingAmount)]}),e.jsxs("p",{className:"text-xs text-amber-600",children:[a.pendingPayments," pending payments"]})]})]})})]}):e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(oe,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Unable to load financial data"})]})})},ls=({className:f})=>{const u=K();Q();const{dateRange:a,getDateRangeForQuery:b}=Ze(),[_,N]=c.useState({revenueGrowth:0,customerGrowth:0,avgOrderValue:0,totalOrders:0,topPerformingServices:[]}),[T,C]=c.useState(!0);c.useEffect(()=>{v()},[a]);const v=async()=>{try{C(!0);const{startDate:j,endDate:t}=b(),o=await ae.getAnalyticsData(j,t);N({revenueGrowth:o.revenueGrowth,customerGrowth:o.customerGrowth,avgOrderValue:o.averageOrderValue,totalOrders:o.completedToday,topPerformingServices:[]})}catch(j){console.error("Error loading analytics data:",j)}finally{C(!1)}},p=j=>j==null||isNaN(j)?"TSh 0":j>=1e9?`TSh ${(j/1e9).toFixed(1)}B`:j>=1e6?`TSh ${(j/1e6).toFixed(1)}M`:j>=1e3?`TSh ${(j/1e3).toFixed(1)}K`:`TSh ${j.toLocaleString()}`;return T?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ke,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Business Analytics"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Key performance indicators"})]})]}),e.jsxs("button",{onClick:()=>u("/lats/analytics"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Analytics",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(180px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},className:"mb-8",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[_.revenueGrowth>0?e.jsx(ee,{size:14,className:"text-emerald-500"}):_.revenueGrowth<0?e.jsx(Pe,{size:14,className:"text-rose-500"}):e.jsx(Re,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Revenue Growth"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:`text-2xl font-semibold ${_.revenueGrowth>0?"text-emerald-600":_.revenueGrowth<0?"text-rose-600":"text-gray-900"}`,children:[_.revenueGrowth>0?"+":"",_.revenueGrowth,"%"]})})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[_.customerGrowth>0?e.jsx(ee,{size:14,className:"text-emerald-500"}):_.customerGrowth<0?e.jsx(Pe,{size:14,className:"text-rose-500"}):e.jsx(ie,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Customer Growth"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:`text-2xl font-semibold ${_.customerGrowth>0?"text-emerald-600":_.customerGrowth<0?"text-rose-600":"text-gray-900"}`,children:[_.customerGrowth>0?"+":"",_.customerGrowth,"%"]})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(150px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},className:"mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Avg Order Value"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:p(_.avgOrderValue)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Orders Today"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:_.totalOrders??0})]})]}),_.topPerformingServices.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Popular Services"}),e.jsx("div",{className:"space-y-2",children:_.topPerformingServices.slice(0,3).map((j,t)=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-white",children:t+1})}),e.jsx("span",{className:"text-sm text-gray-900 truncate",children:j})]},t))})]})]})},is=({className:f})=>{const u=K();Q();const[a,b]=c.useState({activeServices:0,completedToday:0,completedThisWeek:0,inProgressServices:0,completionRate:0,avgCompletionTime:0,popularServices:[]}),[_,N]=c.useState(!0);c.useEffect(()=>{T()},[]);const T=async()=>{try{N(!0);const v=Z();let p=P.from("devices").select("id, status, problem_description, created_at, updated_at, estimated_completion_date");v&&(p=p.eq("branch_id",v));const{data:j,error:t}=await p;if(t)throw t;const o=new Date,s=new Date(o.getFullYear(),o.getMonth(),o.getDate()),r=new Date(s);r.setDate(r.getDate()-r.getDay());const n=j||[],d=n.filter(w=>!["done","failed","repair-complete"].includes(w.status)).length,l=n.filter(w=>["done","repair-complete"].includes(w.status)&&new Date(w.updated_at)>=s).length,D=n.filter(w=>["done","repair-complete"].includes(w.status)&&new Date(w.updated_at)>=r).length,m=n.filter(w=>["diagnosis-started","in-repair","reassembled-testing"].includes(w.status)).length,i=new Date(o.getFullYear(),o.getMonth(),1),y=n.filter(w=>new Date(w.created_at)>=i),x=y.filter(w=>["done","repair-complete"].includes(w.status)).length,h=y.length>0?Math.round(x/y.length*100):0,g=n.filter(w=>["done","repair-complete"].includes(w.status)&&w.created_at&&w.updated_at);let k=0;if(g.length>0){const w=g.reduce((I,$)=>{const L=new Date($.created_at).getTime(),W=new Date($.updated_at).getTime();return I+(W-L)},0);k=Math.round(w/g.length/(1e3*60*60))}const S={};n.forEach(w=>{if(w.problem_description){const I=w.problem_description.toLowerCase();I.includes("screen")||I.includes("display")?S["Screen Repair"]=(S["Screen Repair"]||0)+1:I.includes("battery")?S["Battery Replacement"]=(S["Battery Replacement"]||0)+1:I.includes("water")||I.includes("liquid")?S["Water Damage"]=(S["Water Damage"]||0)+1:I.includes("charge")||I.includes("charging")?S["Charging Issue"]=(S["Charging Issue"]||0)+1:I.includes("software")||I.includes("update")?S["Software Issue"]=(S["Software Issue"]||0)+1:S["General Repair"]=(S["General Repair"]||0)+1}});const M=Object.entries(S).map(([w,I])=>({name:w,count:I})).sort((w,I)=>I.count-w.count).slice(0,5);b({activeServices:d,completedToday:l,completedThisWeek:D,inProgressServices:m,completionRate:h,avgCompletionTime:k,popularServices:M})}catch(v){console.error("Error loading service data:",v)}finally{N(!1)}},C=v=>v>=80?"text-emerald-600":v>=60?"text-blue-600":v>=40?"text-orange-600":"text-rose-600";return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Service Tracking"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Repair & maintenance overview"})]})]}),e.jsxs("button",{onClick:()=>u("/devices"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Devices",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{size:14,className:"text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Active Services"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:a.activeServices})})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-emerald-50 hover:bg-emerald-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ue,{size:14,className:"text-emerald-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Completed Today"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:a.completedToday})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"In Progress"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:a.inProgressServices}),e.jsx(oe,{size:14,className:"text-orange-500"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Completion Rate"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-xl font-semibold ${C(a.completionRate)}`,children:[a.completionRate,"%"]}),a.completionRate>=70&&e.jsx(ee,{size:14,className:"text-emerald-500"})]})]})]}),a.avgCompletionTime>0&&e.jsx("div",{className:"mb-6 p-3 rounded-lg bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Avg. Completion Time"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[a.avgCompletionTime,"h"]})]})}),a.popularServices.length>0&&e.jsxs("div",{className:"mb-6 flex-grow max-h-64 overflow-y-auto",children:[e.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Popular Service Types"}),e.jsx("div",{className:"space-y-2",children:a.popularServices.slice(0,4).map((v,p)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-white",children:p+1})}),e.jsx("span",{className:"text-sm text-gray-900 truncate",children:v.name})]}),e.jsx("span",{className:"text-xs font-semibold text-gray-600 ml-2",children:v.count})]},p))})]}),e.jsx("div",{className:"mb-6 p-3 rounded-lg bg-blue-50 border border-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Completed This Week"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:a.completedThisWeek})]})}),e.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:e.jsxs("button",{onClick:()=>u("/devices/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"Add Service"})]})})]})},os=({className:f})=>{const u=K(),{currentUser:a}=Q(),{currentBranch:b}=jt(),[_,N]=c.useState([]),[T,C]=c.useState(!0),[v,p]=c.useState(!1);c.useEffect(()=>{b&&j()},[b]);const j=async()=>{try{C(!0);const D=(await at.getReminders(b==null?void 0:b.id)).filter(m=>m.status==="pending").sort((m,i)=>{const y=new Date(`${m.date}T${m.time}`),x=new Date(`${i.date}T${i.time}`);return y.getTime()-x.getTime()}).slice(0,5);N(D)}catch(l){console.error("Error loading reminders:",l)}finally{C(!1)}},t=async(l,D)=>{D.stopPropagation();try{await at.updateReminder(l,{status:"completed"}),we.success("Reminder completed!"),j()}catch(m){console.error("Error completing reminder:",m),we.error("Failed to complete reminder")}},o=l=>new Date(`${l.date}T${l.time}`)<new Date,s=l=>{const D=new Date,i=new Date(`${l.date}T${l.time}`).getTime()-D.getTime();if(i<0){const h=Math.abs(i),g=Math.floor(h/(1e3*60*60));return g>24?`${Math.floor(g/24)}d overdue`:`${g}h overdue`}const y=Math.floor(i/(1e3*60*60));return y>24?`in ${Math.floor(y/24)}d`:y>0?`in ${y}h`:`in ${Math.floor(i/(1e3*60))}m`},r=l=>{switch(l){case"high":return"bg-red-100 text-red-600";case"medium":return"bg-yellow-100 text-yellow-600";case"low":return"bg-green-100 text-green-600";default:return"bg-gray-100 text-gray-600"}},n=_.filter(o).length,d=_.filter(l=>!o(l)).length;return T?e.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Reminders"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:n>0?`${n} overdue`:"Stay on track"})]})]}),e.jsxs("button",{onClick:()=>u("/reminders"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Reminders",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{size:14,className:"text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Upcoming"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:d})})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-red-50 hover:bg-red-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(oe,{size:14,className:"text-red-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Overdue"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:n})})]})]}),e.jsx("div",{className:"space-y-2 flex-grow mb-6 max-h-64 overflow-y-auto",children:_.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"No upcoming reminders"}),e.jsxs("button",{onClick:()=>p(!0),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 mx-auto",children:[e.jsx(H,{size:16}),"Create reminder"]})]}):_.map(l=>e.jsx("div",{className:`
                p-3 rounded-lg border transition-all group
                ${o(l)?"bg-red-50 border-red-200 hover:border-red-300":"bg-gray-50 border-gray-200 hover:border-gray-300"}
              `,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{onClick:()=>u("/reminders"),className:"flex-1 min-w-0 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o(l)&&e.jsx(oe,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("h4",{className:"font-medium text-sm text-gray-900 truncate",children:l.title})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full font-medium ${r(l.priority)}`,children:l.priority}),e.jsx("span",{className:`${o(l)?"text-red-600 font-medium":"text-gray-500"}`,children:s(l)})]})]}),e.jsx("button",{onClick:D=>t(l.id,D),className:"relative w-8 h-8 rounded-full border-2 border-emerald-500 bg-emerald-500 hover:bg-emerald-600 hover:border-emerald-600 hover:scale-110 text-white transition-all duration-200 flex items-center justify-center flex-shrink-0 shadow-sm hover:shadow-md",title:"Mark as completed",children:e.jsx(Ae,{className:"w-4 h-4 transition-transform duration-200 hover:scale-105",strokeWidth:2.5})})]})},l.id))}),e.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:e.jsxs("button",{onClick:()=>p(!0),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"Add Reminder"})]})}),v&&e.jsx(Kt,{isOpen:v,onClose:()=>p(!1),onSuccess:()=>{p(!1),j(),we.success("Reminder created successfully!")},reminder:null,currentUser:a,branchId:b==null?void 0:b.id})]})},cs=({className:f})=>{const u=K(),[a,b]=c.useState({database:"healthy",backup:"current",security:"secure",imageStorage:"normal",lastBackup:new Date().toISOString(),responseTime:125,imageStorageSize:"0 KB",totalTables:0,totalRecords:0,largestTable:"-",largestTableSize:"0 KB",databaseSize:"0 MB",dataGrowthRate:"0 KB/day"}),[_,N]=c.useState(!0);c.useEffect(()=>{T();const n=setInterval(T,3e4);return()=>clearInterval(n)},[]);const T=async()=>{try{N(!0);const n=await C();b(n)}catch(n){console.error("Error loading system health:",n)}finally{N(!1)}},C=async()=>{try{const n=Date.now(),d=await v(),l=Date.now()-n,{data:{session:D}}=await P.auth.getSession(),m=D?"secure":"warning";let i=new Date().toISOString(),y="current";try{const{data:L}=await P.from("lats_sales").select("created_at").order("created_at",{ascending:!1}).limit(1);L&&L.length>0&&(i=L[0].created_at,(Date.now()-new Date(i).getTime())/(1e3*60*60)>48&&(y="outdated"))}catch(L){console.warn("Could not check backup status:",L)}let x=0,h=0,g="-",k="0 KB",S="0 MB",M="0 KB/day";try{const L=[{name:"lats_sales",displayName:"Sales"},{name:"lats_products",displayName:"Products"},{name:"customers",displayName:"Customers"},{name:"product_images",displayName:"Images"},{name:"lats_sale_items",displayName:"Sale Items"},{name:"lats_stock_movements",displayName:"Stock Mvmt"},{name:"lats_purchase_orders",displayName:"POs"},{name:"employees",displayName:"Employees"}],W=await Promise.all(L.map(async R=>{try{const{count:G,error:U}=await P.from(R.name).select("id",{count:"exact",head:!0});return{name:R.name,displayName:R.displayName,count:U?0:G||0}}catch{return{name:R.name,displayName:R.displayName,count:0}}}));x=W.filter(R=>R.count>0).length,h=W.reduce((R,G)=>R+G.count,0);const V=[...W].sort((R,G)=>G.count-R.count);if(V.length>0&&V[0].count>0){g=V[0].displayName;const R=Math.round(V[0].count*2);k=R>1024?`${(R/1024).toFixed(1)} MB`:`${R} KB`}const E=h*2,O=E/1024;S=O>=1?`${O.toFixed(1)} MB`:`${E.toFixed(0)} KB`;const F=localStorage.getItem("db_size_history");if(F)try{const R=JSON.parse(F),G=Date.now()-24*60*60*1e3,U=R.filter(se=>se.timestamp>G);if(U.length>=2){const se=U[0],me=U[U.length-1],le=(E-se.size)/U.length;le>1024?M=`${(le/1024).toFixed(1)} MB/day`:le>0?M=`${le.toFixed(0)} KB/day`:M="0 KB/day"}}catch{localStorage.removeItem("db_size_history")}const A=F?JSON.parse(F):[];A.push({timestamp:Date.now(),size:E});const z=Date.now()-30*24*60*60*1e3,B=A.filter(R=>R.timestamp>z);localStorage.setItem("db_size_history",JSON.stringify(B))}catch(L){console.warn("Could not fetch database metrics:",L)}let w="normal",I=0,$="0 KB";try{const{data:L,error:W}=await P.from("product_images").select("image_url, thumbnail_url");if(!W&&L){I=L.length;const E=L.reduce((F,A)=>{var R,G;const z=((R=A.image_url)==null?void 0:R.length)||0,B=((G=A.thumbnail_url)==null?void 0:G.length)||0;return F+z+B},0)/1024,O=E/1024;O>=1?$=`${O.toFixed(1)} MB`:$=`${E.toFixed(0)} KB`,O>100?w="critical":O>50&&(w="warning")}}catch(L){console.warn("Could not check image storage:",L)}return{database:d?l<1e3?"healthy":"slow":"critical",backup:y,security:m,imageStorage:w,lastBackup:i,responseTime:l,imageStorageSize:$,totalTables:x,totalRecords:h,largestTable:g,largestTableSize:k,databaseSize:S,dataGrowthRate:M}}catch(n){return console.error("Health check error:",n),{database:"critical",backup:"failed",security:"warning",imageStorage:"warning",lastBackup:new Date().toISOString(),responseTime:0,imageStorageSize:"0 KB",totalTables:0,totalRecords:0,largestTable:"-",largestTableSize:"0 KB",databaseSize:"0 MB",dataGrowthRate:"0 KB/day"}}},v=async()=>{try{const{data:n,error:d}=await P.from("customers").select("id").limit(1);return!d}catch{return!0}},p=()=>{const n=[a.database,a.backup,a.security,a.imageStorage];return n.some(d=>["critical","failed","offline","compromised"].includes(d))?{status:"critical",color:"red"}:n.some(d=>["slow","outdated","unstable","warning"].includes(d))?{status:"warning",color:"orange"}:{status:"healthy",color:"green"}},j=n=>n>=1e6?`${(n/1e6).toFixed(1)}M`:n>=1e3?`${(n/1e3).toFixed(1)}K`:n.toString(),t=n=>{const d=new Date(n),D=Math.floor((new Date().getTime()-d.getTime())/(1e3*60*60));return D<1?"Just now":D<24?`${D}h ago`:`${Math.floor(D/24)}d ago`},o=p();if(_)return e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})});const s=o.color==="green"?"text-emerald-500":o.color==="orange"?"text-amber-500":"text-rose-500",r=o.color==="green"?"bg-emerald-50":o.color==="orange"?"bg-amber-50":"bg-rose-50";return e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"System Health"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Real-time monitoring"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`px-3 py-1.5 rounded-full ${r} flex items-center gap-1.5`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${s.replace("text-","bg-")} animate-pulse`}),e.jsx("span",{className:`text-xs font-medium ${s} capitalize`,children:o.status})]}),e.jsxs("button",{onClick:()=>u("/settings"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View Settings",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(120px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},className:"mb-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Response Time"}),e.jsxs("p",{className:"text-xl font-semibold text-gray-900",children:[a.responseTime,e.jsx("span",{className:"text-sm text-gray-400 ml-1",children:"ms"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Records"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:j(a.totalRecords)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"DB Size"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:a.databaseSize})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-6 flex-grow",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(We,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Database"})]}),e.jsx("p",{className:`text-sm font-medium capitalize ${a.database==="healthy"?"text-emerald-600":a.database==="slow"?"text-amber-600":"text-rose-600"}`,children:a.database})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ue,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Backup"})]}),e.jsx("p",{className:`text-sm font-medium capitalize ${a.backup==="current"?"text-emerald-600":a.backup==="outdated"?"text-amber-600":"text-rose-600"}`,children:a.backup})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Dt,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Security"})]}),e.jsx("p",{className:`text-sm font-medium capitalize ${a.security==="secure"?"text-emerald-600":a.security==="warning"?"text-amber-600":"text-rose-600"}`,children:a.security})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Tt,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Images"})]}),e.jsx("p",{className:`text-sm font-medium ${a.imageStorage==="normal"?"text-emerald-600":a.imageStorage==="warning"?"text-amber-600":"text-rose-600"}`,children:a.imageStorageSize})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(We,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Active Tables"})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.totalTables})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Growth Rate"})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.dataGrowthRate})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 rounded-lg bg-gradient-to-r from-gray-50 to-transparent",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Largest table"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.largestTable," (",a.largestTableSize,")"]})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 rounded-lg bg-gradient-to-r from-gray-50 to-transparent",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Last backup completed"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t(a.lastBackup)})]})]}),e.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:e.jsxs("button",{onClick:T,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(ye,{size:14}),e.jsx("span",{children:"Refresh"})]})})]})},ds=({className:f})=>{const u=K(),[a,b]=c.useState([]),[_,N]=c.useState(!0);c.useEffect(()=>{T();const p=setInterval(T,6e4);return()=>clearInterval(p)},[]);const T=async()=>{try{_&&N(!0);const p=await ae.getRecentActivities(8);b(p)}catch(p){console.error("Error loading activities:",p)}finally{N(!1)}},C=p=>{const j=new Date,t=new Date(p),o=Math.floor((j.getTime()-t.getTime())/(1e3*60));return o<1?"Just now":o<60?`${o}m ago`:o<1440?`${Math.floor(o/60)}h ago`:`${Math.floor(o/1440)}d ago`},v=p=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(p);return _&&a.length===0?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Recent Activity"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Live system activities"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-emerald-50",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-emerald-600 font-medium",children:"Live"})]}),e.jsxs("button",{onClick:()=>u("/reports"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Reports",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]})]}),e.jsx("div",{className:"space-y-3 h-64 overflow-y-auto mb-6 flex-grow",children:a.length>0?a.map(p=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:p.type==="device"?e.jsx(_e,{size:14,className:"text-gray-700"}):p.type==="customer"?e.jsx(ie,{size:14,className:"text-gray-700"}):p.type==="payment"?e.jsx(De,{size:14,className:"text-gray-700"}):p.type==="appointment"?e.jsx(je,{size:14,className:"text-gray-700"}):p.type==="inventory"?e.jsx(ne,{size:14,className:"text-gray-700"}):e.jsx(ye,{size:14,className:"text-gray-700"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:p.title}),p.status==="completed"&&e.jsx(ue,{size:12,className:"text-emerald-600"}),p.status==="pending"&&e.jsx(X,{size:12,className:"text-amber-600"}),p.status==="failed"&&e.jsx(be,{size:12,className:"text-rose-600"})]}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:p.description}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:C(p.time)}),p.amount&&e.jsx("span",{className:"text-xs font-medium text-gray-900",children:v(p.amount)})]})]})]})},p.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(ye,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No recent activities"})]})})]})},ms=({className:f})=>{const u=K(),[a,b]=c.useState({totalCustomers:0,newThisMonth:0,loyaltyMembers:0,averageSatisfaction:0,topCustomers:[],satisfactionTrend:0,retentionRate:0}),[_,N]=c.useState(!0);c.useEffect(()=>{T()},[]);const T=async()=>{try{N(!0);const{supabase:t}=await te(()=>import("./index-61458a34.js").then(w=>w.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{getCurrentBranchId:o}=await te(()=>import("./index-61458a34.js").then(w=>w.bb),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),s=o();let r=t.from("customers").select("id, name, total_spent, joined_date, points, is_active, last_visit");s&&(r=r.eq("branch_id",s));const{data:n,error:d}=await r;if(d)throw console.error("âŒ Customers query Supabase error:",JSON.stringify(d,null,2)),d;const l=n||[],D=new Date,m=new Date(D.getFullYear(),D.getMonth(),1),i=l.length,y=l.filter(w=>new Date(w.joined_date)>=m).length,x=l.filter(w=>(w.points||0)>0).length,h=4.5,g=l.filter(w=>w.total_spent&&w.total_spent>0).sort((w,I)=>(I.total_spent||0)-(w.total_spent||0)).slice(0,3).map(w=>({id:w.id,name:w.name,totalSpent:w.total_spent||0,loyaltyPoints:w.points||0,lastVisit:w.last_visit||w.joined_date})),k=l.filter(w=>(w.total_spent||0)>0&&w.is_active).length,S=i>0?Math.round(k/i*100):0;b({totalCustomers:i,newThisMonth:y,loyaltyMembers:x,averageSatisfaction:h,topCustomers:g,satisfactionTrend:8.5,retentionRate:S})}catch(t){console.error("âŒ Error loading customer insights - Full error:",t),console.error("âŒ Nested error details:",(t==null?void 0:t.error)||t)}finally{N(!1)}},C=t=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),v=t=>{const o=new Date,s=new Date(t),r=Math.floor((o.getTime()-s.getTime())/(1e3*60*60*24));return r===0?"Today":r===1?"Yesterday":`${r}d ago`},p=t=>t>=4.5?"text-green-600":t>=4?"text-yellow-600":"text-red-600",j=t=>e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(o=>e.jsx(Je,{size:12,className:`${o<=t?"text-yellow-400 fill-current":"text-gray-300"}`},o)),e.jsx("span",{className:`text-sm font-medium ml-1 ${p(t)}`,children:t.toFixed(1)})]});return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(Mt,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Customer Insights"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[a.totalCustomers," customers â€¢ ",a.retentionRate,"% retention"]})]})]}),e.jsxs("button",{onClick:()=>u("/customers"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Customers",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"New"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.newThisMonth})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Loyalty"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.loyaltyMembers})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Retention"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[a.retentionRate,"%"]})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Customer Satisfaction"}),j(a.averageSatisfaction)]}),e.jsxs("div",{className:`flex items-center gap-1 ${a.satisfactionTrend>0?"text-emerald-600":"text-rose-600"}`,children:[e.jsx(ee,{size:14}),e.jsxs("span",{className:"text-sm font-medium",children:[a.satisfactionTrend>0?"+":"",a.satisfactionTrend,"%"]})]})]})}),e.jsxs("div",{className:"space-y-3 mb-6 flex-grow",children:[e.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Top Customers"}),a.topCustomers.slice(0,3).map((t,o)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-white",children:o+1})}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-medium text-gray-700",children:t.name.split(" ").map(s=>s[0]).join("")})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[C(t.totalSpent)," spent"]}),e.jsx("span",{className:"text-xs text-gray-400",children:"â€¢"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{size:10,className:"text-gray-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.loyaltyPoints," pts"]})]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:v(t.lastVisit)})]},t.id))]}),e.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:e.jsxs("button",{onClick:()=>u("/customers/loyalty"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(Le,{size:14}),e.jsx("span",{children:"Loyalty Program"})]})})]})},xs=({className:f})=>{const u=K();Q();const[a,b]=c.useState({pending:0,received:0,total:0,recentOrders:[]}),[_,N]=c.useState(!0);c.useEffect(()=>{T()},[]);const T=async()=>{try{N(!0);const t=Z();console.log("ðŸ“Š PurchaseOrderWidget: Loading data...",{currentBranchId:t});let o=P.from("lats_purchase_orders").select("id, po_number, status, total_amount, created_at, supplier_id, currency, exchange_rate, total_amount_base_currency, payment_terms").order("created_at",{ascending:!1});t?(o=o.eq("branch_id",t),console.log("ðŸ¢ Filtering purchase orders by branch:",t)):console.log("ðŸ“‚ Loading all purchase orders (no branch selected)");const{data:s,error:r}=await o.limit(50);if(r)throw console.error("âŒ Error loading purchase orders:",r),r;console.log("âœ… Loaded purchase orders:",(s==null?void 0:s.length)||0);const n=s||[],d=n.map(x=>x.supplier_id).filter(Boolean),{data:l}=d.length>0?await P.from("lats_suppliers").select("id, name").in("id",d):{data:[]},D=new Map((l==null?void 0:l.map(x=>[x.id,x]))||[]),m=n.filter(x=>x.status==="pending"||x.status==="ordered").length,i=n.filter(x=>x.status==="received").length,y=n.slice(0,4).map(x=>{var h;return{id:x.id,orderNumber:x.po_number||"N/A",supplier:x.supplier_id&&((h=D.get(x.supplier_id))==null?void 0:h.name)||"Unknown Supplier",status:x.status,totalAmount:x.total_amount||0,currency:x.currency||"TZS",createdAt:x.created_at}});b({pending:m,received:i,total:n.length,recentOrders:y})}catch(t){console.error("Error loading purchase order data:",t)}finally{N(!1)}},C=t=>{switch(t){case"received":return"bg-emerald-100 text-emerald-700";case"pending":case"ordered":return"bg-amber-100 text-amber-700";case"cancelled":return"bg-rose-100 text-rose-700";default:return"bg-gray-100 text-gray-700"}},v=t=>{switch(t){case"received":return e.jsx(ue,{size:12,className:"text-emerald-600"});case"pending":case"ordered":return e.jsx(X,{size:12,className:"text-amber-600"});default:return e.jsx(oe,{size:12,className:"text-gray-600"})}},p=(t,o="TZS")=>new Intl.NumberFormat("en-US",{style:"currency",currency:o,minimumFractionDigits:0,maximumFractionDigits:0}).format(t),j=t=>{const o=new Date(t),r=Math.abs(new Date().getTime()-o.getTime()),n=Math.ceil(r/(1e3*60*60*24));return n===0?"Today":n===1?"Yesterday":n<7?`${n}d ago`:o.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Purchase Orders"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[a.total," orders tracked"]})]})]}),e.jsxs("button",{onClick:()=>u("/lats/purchase-orders"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Purchase Orders",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-amber-50 hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Pending"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:a.pending})})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-emerald-50 hover:bg-emerald-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ue,{size:14,className:"text-emerald-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Received"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:a.received})})]})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:a.recentOrders.length>0?a.recentOrders.map(t=>e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>u(`/lats/purchase-orders/${t.id}`),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:14,className:"text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.orderNumber})]}),e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${C(t.status)}`,children:[v(t.status),e.jsx("span",{className:"capitalize",children:t.status})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500 truncate",children:t.supplier}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:p(t.totalAmount,t.currency)}),e.jsx("span",{className:"text-xs text-gray-400",children:j(t.createdAt)})]})]})]},t.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(Ee,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No purchase orders yet"})]})}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-6",children:[e.jsxs("button",{onClick:()=>u("/lats/purchase-orders/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"Create Order"})]}),e.jsxs("button",{onClick:()=>u("/lats/purchase-orders"),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-100 text-sm text-gray-700 hover:bg-gray-200 transition-colors",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]})]})},gs=({className:f})=>{const u=K();Q();const[a,b]=c.useState({unreadMessages:0,activeChats:0,totalMessages:0,recentChats:[]}),[_,N]=c.useState(!0);c.useEffect(()=>{T()},[]);const T=async()=>{try{N(!0);const{getCurrentBranchId:p}=await te(()=>import("./index-61458a34.js").then(i=>i.bb),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),j=p();let t=P.from("customer_messages").select(`
          id,
          customer_id,
          message,
          status,
          created_at
        `).order("created_at",{ascending:!1}).limit(50);j&&(t=t.eq("branch_id",j));const{data:o,error:s}=await t;if(s)throw console.error("Error fetching messages:",s),s;const r=[...new Set((o==null?void 0:o.map(i=>i.customer_id))||[])],n=new Map;if(r.length>0){const{data:i}=await P.from("customers").select("id, name").in("id",r);i==null||i.forEach(y=>{n.set(y.id,y.name)})}const d=new Map;o==null||o.forEach(i=>{var h;const y=i.customer_id,x=n.get(y)||"Unknown Customer";if(!d.has(y)){const g=x.split(" "),k=g.length>=2?`${g[0][0]}${g[1][0]}`.toUpperCase():((h=g[0])==null?void 0:h.substring(0,2).toUpperCase())||"U";d.set(y,{id:i.id,customerName:x,lastMessage:i.message,timestamp:i.created_at,unread:i.status!=="read",customerInitials:k})}});const l=Array.from(d.values()).slice(0,4),D=l.filter(i=>i.unread).length,{count:m}=await P.from("customer_messages").select("*",{count:"exact",head:!0});b({unreadMessages:D,activeChats:d.size,totalMessages:m||0,recentChats:l})}catch(p){console.error("Error loading chat data:",p),b({unreadMessages:0,activeChats:0,totalMessages:0,recentChats:[]})}finally{N(!1)}},C=p=>{const j=new Date(p),o=Math.abs(new Date().getTime()-j.getTime()),s=Math.floor(o/(1e3*60)),r=Math.floor(o/(1e3*60*60)),n=Math.floor(o/(1e3*60*60*24));return s<1?"Just now":s<60?`${s}m ago`:r<24?`${r}h ago`:n===1?"Yesterday":n<7?`${n}d ago`:j.toLocaleDateString("en-US",{month:"short",day:"numeric"})},v=p=>{const j=["bg-blue-500","bg-emerald-500","bg-purple-500","bg-orange-500","bg-pink-500","bg-indigo-500"],t=p.charCodeAt(0)%j.length;return j[t]};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center relative",children:[e.jsx(ze,{className:"w-5 h-5 text-purple-600"}),a.unreadMessages>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:a.unreadMessages})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Messages"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[a.activeChats," active conversations"]})]})]}),e.jsxs("button",{onClick:()=>u("/messages"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Messages",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-red-50 hover:bg-red-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ze,{size:14,className:"text-red-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Unread"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:a.unreadMessages})})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-purple-50 hover:bg-purple-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ot,{size:14,className:"text-purple-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Active"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:a.activeChats})})]})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:a.recentChats.length>0?a.recentChats.map(p=>e.jsx("div",{className:`p-3 rounded-lg transition-colors cursor-pointer ${p.unread?"bg-purple-50 hover:bg-purple-100":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>u(`/messages/${p.id}`),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${v(p.customerInitials)} flex items-center justify-center flex-shrink-0`,children:e.jsx("span",{className:"text-sm font-bold text-white",children:p.customerInitials})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`text-sm font-medium ${p.unread?"text-gray-900":"text-gray-700"}`,children:p.customerName}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(X,{size:10}),e.jsx("span",{children:C(p.timestamp)})]})]}),e.jsx("p",{className:`text-xs truncate ${p.unread?"text-gray-700 font-medium":"text-gray-500"}`,children:p.lastMessage})]})]})},p.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(ze,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No messages yet"})]})}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-6",children:[e.jsxs("button",{onClick:()=>u("/messages/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"New Message"})]}),e.jsxs("button",{onClick:()=>u("/messages"),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-100 text-sm text-gray-700 hover:bg-gray-200 transition-colors",children:[e.jsx(ct,{size:14}),e.jsx("span",{children:"All Chats"})]})]})]})},us=({className:f})=>{const u=K();Q();const[a,b]=c.useState({todaySales:0,todayTransactions:0,averageTransaction:0,yesterdaySales:0,growth:0,recentTransactions:[]}),[_,N]=c.useState(!0);c.useEffect(()=>{T()},[]);const T=async()=>{try{N(!0);const v=Z(),p=new Date,j=new Date(p.getFullYear(),p.getMonth(),p.getDate());j.setHours(0,0,0,0);const t=new Date(j);t.setDate(t.getDate()+1);const o=new Date(j);o.setDate(o.getDate()-1);let s=P.from("lats_sales").select("id, total_amount, customer_name, created_at").gte("created_at",j.toISOString()).lt("created_at",t.toISOString()).order("created_at",{ascending:!1});v&&(s=s.eq("branch_id",v));const{data:r,error:n}=await s;if(n)throw n;console.log("ðŸ“Š SalesWidget Debug:",{todayDate:j.toISOString(),todaySalesCount:(r==null?void 0:r.length)||0,sampleSale:r==null?void 0:r[0],currentBranch:v});let d=P.from("lats_sales").select("total_amount, created_at").gte("created_at",o.toISOString()).lt("created_at",j.toISOString());v&&(d=d.eq("branch_id",v));const{data:l,error:D}=await d;if(D)throw D;console.log("ðŸ“Š Yesterday Sales Debug:",{yesterdayDate:o.toISOString(),yesterdaySalesCount:(l==null?void 0:l.length)||0,sampleSale:l==null?void 0:l[0]});const m=r||[],i=m.reduce((S,M)=>{const w=typeof M.total_amount=="string"?parseFloat(M.total_amount):M.total_amount;return S+(isNaN(w)?0:w)},0),y=(l||[]).reduce((S,M)=>{const w=typeof M.total_amount=="string"?parseFloat(M.total_amount):M.total_amount;return S+(isNaN(w)?0:w)},0),x=m.length,h=x>0?i/x:0,g=y>0?(i-y)/y*100:0,k=m.slice(0,5).map(S=>({id:S.id,amount:typeof S.total_amount=="string"?parseFloat(S.total_amount):S.total_amount,customer:S.customer_name||"Walk-in Customer",time:new Date(S.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}));b({todaySales:i,todayTransactions:x,averageTransaction:h,yesterdaySales:y,growth:Math.round(g*10)/10,recentTransactions:k})}catch(v){console.error("Error loading sales data:",v)}finally{N(!1)}},C=v=>v>=1e6?`TSh ${(v/1e6).toFixed(1)}M`:v>=1e3?`TSh ${(v/1e3).toFixed(0)}K`:`TSh ${v.toFixed(0)}`;return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Today's Sales"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[a.todayTransactions," transactions"]})]})]}),e.jsxs("button",{onClick:()=>u("/lats/sales"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Sales",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-900",children:C(a.todaySales)}),a.growth!==0&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${a.growth>=0?"bg-emerald-50 text-emerald-600":"bg-rose-50 text-rose-600"}`,children:[e.jsx(ee,{size:12,className:a.growth<0?"rotate-180":""}),e.jsxs("span",{children:[a.growth>=0?"+":"",a.growth,"%"]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["vs yesterday: ",C(a.yesterdaySales)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(qe,{size:14,className:"text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Transactions"})]}),e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:a.todayTransactions})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-purple-50 hover:bg-purple-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(De,{size:14,className:"text-purple-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Avg Sale"})]}),e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:C(a.averageTransaction)})]})]}),a.recentTransactions.length>0&&e.jsxs("div",{className:"mb-6 flex-grow max-h-48 overflow-y-auto",children:[e.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Recent Transactions"}),e.jsx("div",{className:"space-y-2",children:a.recentTransactions.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:v.customer}),e.jsx("p",{className:"text-xs text-gray-500",children:v.time})]}),e.jsx("span",{className:"text-sm font-semibold text-emerald-600 ml-2",children:C(v.amount)})]},v.id))})]}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-6",children:[e.jsxs("button",{onClick:()=>u("/pos"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"New Sale"})]}),e.jsxs("button",{onClick:()=>u("/lats/sales"),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-100 text-sm text-gray-700 hover:bg-gray-200 transition-colors",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"All Sales"})]})]})]})},hs=({className:f})=>{const u=K();Q();const[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0);c.useEffect(()=>{v()},[]);const v=async()=>{try{N(!0);const j=Z(),t=new Date;t.setDate(t.getDate()-7);let o=P.from("lats_sales").select("id, created_at, branch_id").gte("created_at",t.toISOString());j&&(o=o.eq("branch_id",j));const{data:s,error:r}=await o;if(r)throw r;if(!s||s.length===0){b([]),C(0);return}const n=s.map(k=>k.id),{data:d,error:l}=await P.from("lats_sale_items").select("id, product_id, variant_id, quantity, unit_price, sale_id").in("sale_id",n);if(l)throw l;if(!d||d.length===0){b([]),C(0);return}const D=[...new Set(d.map(k=>k.product_id).filter(Boolean))],{data:m,error:i}=await P.from("lats_products").select("id, name, category").in("id",D);if(i)throw i;const y=new Map((m||[]).map(k=>[k.id,k])),x=new Map;let h=0;(d||[]).forEach(k=>{const S=y.get(k.product_id);if(!S)return;const M=k.product_id,w=typeof k.unit_price=="string"?parseFloat(k.unit_price):k.unit_price,I=k.quantity||0,$=(w||0)*I;if(h+=$,x.has(M)){const L=x.get(M);L.quantitySold+=I,L.revenue+=$}else x.set(M,{id:M,name:S.name||"Unknown Product",quantitySold:I,revenue:$,category:S.category||"Uncategorized"})});const g=Array.from(x.values()).sort((k,S)=>S.revenue-k.revenue).slice(0,5);b(g),C(h)}catch(j){console.error("Error loading top products:",j)}finally{N(!1)}},p=j=>j>=1e6?`TSh ${(j/1e6).toFixed(1)}M`:j>=1e3?`TSh ${(j/1e3).toFixed(0)}K`:`TSh ${j.toFixed(0)}`;return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(ee,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Top Products"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Last 7 days"})]})]}),e.jsxs("button",{onClick:()=>u("/lats/inventory"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View Products",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-gradient-to-br from-orange-50 to-red-50",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Revenue (Top 5)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p(T)})]}),e.jsx("div",{className:"space-y-3 flex-grow max-h-72 overflow-y-auto mb-6",children:a.length>0?a.map((j,t)=>e.jsx("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${t===0?"bg-yellow-500":t===1?"bg-gray-400":t===2?"bg-orange-600":"bg-gray-300"}`,children:e.jsxs("span",{className:"text-sm font-bold text-white",children:["#",t+1]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:j.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:j.category}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{size:12,className:"text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:[j.quantitySold," sold"]})]}),e.jsx("span",{className:"text-sm font-semibold text-orange-600",children:p(j.revenue)})]})]})]})},j.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(ne,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No sales data yet"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Start selling to see top products"})]})}),e.jsx("div",{className:"mt-auto pt-6",children:e.jsxs("button",{onClick:()=>u("/lats/inventory"),className:"w-full flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(ne,{size:14}),e.jsx("span",{children:"View All Products"})]})})]})},ps=({className:f})=>{var t,o;const u=K(),{currentUser:a}=Q(),[b,_]=c.useState({todayExpenses:0,monthExpenses:0,recentExpenses:[],topCategory:"",topCategoryAmount:0,pendingCount:0}),[N,T]=c.useState(!0);c.useEffect(()=>{p()},[]);const C=async s=>{try{const{error:r}=await P.from("account_transactions").update({status:"approved",metadata:P.raw(`metadata || '{"approval_status": "approved", "approved_by": "${a==null?void 0:a.id}", "approved_at": "${new Date().toISOString()}"}'::jsonb`)}).eq("id",s);if(r)throw r;Y.success("Expense approved!"),p()}catch(r){console.error("Error approving expense:",r),Y.error("Failed to approve expense")}},v=async s=>{try{const{error:r}=await P.from("account_transactions").update({status:"rejected",metadata:P.raw(`metadata || '{"approval_status": "rejected", "rejected_by": "${a==null?void 0:a.id}", "rejected_at": "${new Date().toISOString()}"}'::jsonb`)}).eq("id",s);if(r)throw r;Y.success("Expense rejected"),p()}catch(r){console.error("Error rejecting expense:",r),Y.error("Failed to reject expense")}},p=async()=>{var s,r;try{T(!0);const n=Z(),d=new Date,l=new Date(d.getFullYear(),d.getMonth(),d.getDate());l.setHours(0,0,0,0);const D=new Date(l);D.setDate(D.getDate()+1);const m=new Date(d.getFullYear(),d.getMonth(),1);let i=P.from("account_transactions").select("*").eq("transaction_type","expense").order("created_at",{ascending:!1});const y=await bt(i,"payments"),{data:x,error:h}=await y;if(h){console.error("Error fetching expense transactions:",h),_({todayExpenses:0,monthExpenses:0,recentExpenses:[],topCategory:"",topCategoryAmount:0,pendingCount:0});return}const g=((s=a==null?void 0:a.permissions)==null?void 0:s.includes("all"))||((r=a==null?void 0:a.permissions)==null?void 0:r.includes("view_financial_reports"))||(a==null?void 0:a.role)==="admin",k=g?(x||[]).filter(A=>{var B;return(A.status||((B=A.metadata)==null?void 0:B.approval_status)||"approved")==="pending"}).length:0,S=(x||[]).filter(A=>{var B;const z=A.status||((B=A.metadata)==null?void 0:B.approval_status)||"approved";return g||z==="approved"});console.log("ðŸ’¸ ExpensesWidget - Total transactions found:",S.length),console.log("ðŸ’¸ ExpensesWidget - Pending expenses:",k);const M=S.filter(A=>{const z=new Date(A.created_at);return z>=l&&z<D}),w=S.filter(A=>new Date(A.created_at)>=m),I=M.reduce((A,z)=>{const B=parseFloat(z.amount)||0;return A+B},0),$=w.reduce((A,z)=>{const B=parseFloat(z.amount)||0;return A+B},0),L=new Map;w.forEach(A=>{var R;const z=((R=A.metadata)==null?void 0:R.category)||"Other",B=parseFloat(A.amount)||0;L.set(z,(L.get(z)||0)+B)});let W="",V=0;L.forEach((A,z)=>{A>V&&(V=A,W=z)});const E=new Date(d);E.setDate(E.getDate()-30);const F=S.filter(A=>new Date(A.created_at)>=E).sort((A,z)=>{var B,R;if(g){const G=A.status||((B=A.metadata)==null?void 0:B.approval_status)||"approved",U=z.status||((R=z.metadata)==null?void 0:R.approval_status)||"approved";if(G==="pending"&&U!=="pending")return-1;if(G!=="pending"&&U==="pending")return 1}return new Date(z.created_at).getTime()-new Date(A.created_at).getTime()}).slice(0,5).map(A=>{var z,B;return{id:A.id,description:A.description||"No description",amount:parseFloat(A.amount)||0,category:((z=A.metadata)==null?void 0:z.category)||"Other",status:A.status||((B=A.metadata)==null?void 0:B.approval_status)||"approved",time:new Date(A.created_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}});console.log("ðŸ’¸ ExpensesWidget - Calculated metrics:",{todayTotal:I,monthTotal:$,recentExpensesCount:F.length,topCategory:W,topCategoryAmount:V}),_({todayExpenses:I,monthExpenses:$,recentExpenses:F,topCategory:W,topCategoryAmount:V,pendingCount:k})}catch(n){console.error("Error loading expenses data:",n),_({todayExpenses:0,monthExpenses:0,recentExpenses:[],topCategory:"",topCategoryAmount:0})}finally{T(!1)}},j=s=>s>=1e6?`TSh ${(s/1e6).toFixed(1)}M`:s>=1e3?`TSh ${(s/1e3).toFixed(0)}K`:`TSh ${s.toFixed(0)}`;return N?e.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(Xe,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Expenses"}),(((t=a==null?void 0:a.permissions)==null?void 0:t.includes("all"))||((o=a==null?void 0:a.permissions)==null?void 0:o.includes("view_financial_reports"))||(a==null?void 0:a.role)==="admin")&&b.pendingCount>0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[b.pendingCount," pending"]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Track your spending"})]})]}),e.jsxs("button",{onClick:()=>u("/expenses"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Expenses",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-red-50 hover:bg-red-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-red-500",children:[e.jsx("polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7"}),e.jsx("polyline",{points:"16 17 22 17 22 11"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Today"})]}),e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:"TSh 0"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-orange-50 hover:bg-orange-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-orange-500",children:[e.jsx("line",{x1:"12",x2:"12",y1:"2",y2:"22"}),e.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"This Month"})]}),e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:"TSh 180.3M"})]})]}),b.topCategory&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-gradient-to-br from-red-50 to-orange-50",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Top Category"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:b.topCategory}),e.jsx("p",{className:"text-base font-bold text-red-600",children:j(b.topCategoryAmount)})]})]}),e.jsx("div",{className:"space-y-3 flex-grow max-h-48 overflow-y-auto mb-6 pr-2",children:b.recentExpenses.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Recent Expenses (Last 30 Days)"}),b.recentExpenses.map(s=>{var d,l;const r={pending:{bg:"bg-yellow-50",border:"border-yellow-200",badge:"bg-yellow-100 text-yellow-800"},approved:{bg:"bg-gray-50",border:"border-gray-200",badge:"bg-green-100 text-green-800"},rejected:{bg:"bg-red-50",border:"border-red-200",badge:"bg-red-100 text-red-800"}},n=r[s.status]||r.approved;return e.jsx("div",{className:`p-3 ${n.bg} border ${n.border} rounded-lg hover:opacity-90 transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.description}),s.status!=="approved"&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${n.badge}`,children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s.category}),e.jsxs("span",{className:"text-xs text-gray-400",children:["â€¢ ",s.time]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-red-600",children:["-",j(s.amount)]}),(((d=a==null?void 0:a.permissions)==null?void 0:d.includes("all"))||((l=a==null?void 0:a.permissions)==null?void 0:l.includes("view_financial_reports"))||(a==null?void 0:a.role)==="admin")&&s.status==="pending"&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>C(s.id),className:"p-1 rounded bg-green-600 hover:bg-green-700 text-white transition-colors",title:"Approve",children:e.jsx(Ae,{size:14})}),e.jsx("button",{onClick:()=>v(s.id),className:"p-1 rounded bg-red-600 hover:bg-red-700 text-white transition-colors",title:"Reject",children:e.jsx(It,{size:14})})]})]})]})},s.id)})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(Xe,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No recent expenses"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Last 30 days"})]})}),e.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:e.jsxs("button",{onClick:()=>u("/expenses/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"Add Expense"})]})})]})},fs=({className:f})=>{const u=K(),{dateRange:a,getDateRangeForQuery:b}=Ze(),[_,N]=c.useState([]),[T,C]=c.useState(!0),[v,p]=c.useState(0);c.useEffect(()=>{j()},[a]);const j=async()=>{try{C(!0);const s=Z(),{startDate:r,endDate:n}=b();let d=P.from("lats_sales").select("id, total_amount, sold_by, created_at, branch_id").gte("created_at",r).lte("created_at",n);s&&(d=d.eq("branch_id",s));const{data:l,error:D}=await d;if(D)throw D;if(!l||l.length===0){N([]),p(0);return}const m=[...new Set(l.map(h=>h.sold_by).filter(Boolean))];let i=new Map;if(m.length>0){const h=S=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(S),g=m.filter(S=>h(S)),k=m.filter(S=>!h(S));if(g.length>0){const{data:S,error:M}=await P.from("users").select("id, email, full_name").in("id",g);!M&&S&&S.forEach($=>{i.set($.id,$)});const{data:w,error:I}=await P.from("employees").select("id, email, full_name").in("id",g);!I&&w&&w.forEach($=>{i.has($.id)||i.set($.id,$)})}if(k.length>0){const{data:S,error:M}=await P.from("users").select("id, email, full_name").in("email",k);!M&&S&&S.forEach($=>{i.set($.email,$)});const{data:w,error:I}=await P.from("employees").select("id, email, full_name").in("email",k);!I&&w&&w.forEach($=>{i.has($.email)||i.set($.email,$)})}}const y=new Map;(l||[]).forEach(h=>{var w;const g=h.sold_by;if(!g)return;const k=typeof h.total_amount=="string"?parseFloat(h.total_amount):h.total_amount||0,S=i.get(g),M=(S==null?void 0:S.full_name)||(S==null?void 0:S.name)||((w=S==null?void 0:S.email)==null?void 0:w.split("@")[0])||(S==null?void 0:S.email)||`Staff #${g.substring(0,8)}`;if(y.has(g)){const I=y.get(g);I.sales+=k,I.count+=1}else y.set(g,{sales:k,count:1,name:M})});const x=Array.from(y.entries()).map(([h,g])=>({id:h,name:g.name,sales:g.sales,transactions:g.count,avatar:g.name.substring(0,2).toUpperCase()})).sort((h,g)=>g.sales-h.sales).slice(0,5);N(x),p(y.size)}catch(s){console.error("Error loading staff performance:",s)}finally{C(!1)}},t=s=>s>=1e6?`TSh ${(s/1e6).toFixed(1)}M`:s>=1e3?`TSh ${(s/1e3).toFixed(0)}K`:`TSh ${s.toFixed(0)}`,o=s=>{const r=["bg-blue-500","bg-emerald-500","bg-purple-500","bg-orange-500","bg-pink-500"];return r[s%r.length]};return T?e.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Staff Performance"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[v," active members Â· ",a.preset==="7days"?"Last 7 days":a.preset==="1month"?"Last month":a.preset==="3months"?"Last 3 months":a.preset==="6months"?"Last 6 months":"Custom range"]})]})]}),e.jsxs("button",{onClick:()=>u("/employees"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Staff",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsx("div",{className:"space-y-3 flex-grow mb-6",children:_.length>0?_.map((s,r)=>e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors relative overflow-hidden",children:[r<3&&e.jsxs("div",{className:`absolute top-2 right-2 w-6 h-6 rounded-full flex items-center justify-center ${r===0?"bg-yellow-500":r===1?"bg-gray-400":"bg-orange-600"}`,children:[r===0&&e.jsx(Le,{size:14,className:"text-white"}),r>0&&e.jsxs("span",{className:"text-xs font-bold text-white",children:["#",r+1]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${o(r)}`,children:e.jsx("span",{className:"text-sm font-bold text-white",children:s.avatar})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[s.transactions," sales"]}),e.jsx("span",{className:"text-sm font-semibold text-indigo-600",children:t(s.sales)})]})]})]})]},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(ie,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No staff activity yet"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Sales data will appear here"})]})}),_.length>0&&e.jsx("div",{className:"mt-auto pt-6 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Top Performer"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:_[0].name})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-indigo-600",children:t(_[0].sales)}),e.jsxs("p",{className:"text-xs text-gray-600",children:[_[0].transactions," sales"]})]})]})})]})},ys=({className:f})=>{const u=K(),[a,b]=c.useState({totalMembers:0,activeMembers:0,totalPointsIssued:0,totalPointsRedeemed:0,availablePoints:0,redemptions:0,growth:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);Q(),nt(),c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("loyalty_points").select("id, points, points_type, created_at");t&&(o=o.eq("branch_id",t));const{data:s,error:r}=await o;let n=P.from("lats_customers").select("id, loyalty_points");t&&(n=n.eq("branch_id",t));const{data:d,error:l}=await n;if(r&&r.code==="42P01"){b({totalMembers:0,activeMembers:0,totalPointsIssued:0,totalPointsRedeemed:0,availablePoints:0,redemptions:0,growth:0}),N(!1);return}if(l&&l.code==="42P01"){b({totalMembers:0,activeMembers:0,totalPointsIssued:0,totalPointsRedeemed:0,availablePoints:0,redemptions:0,growth:0}),N(!1);return}if(r||l)throw r||l;const D=(d==null?void 0:d.length)||0,m=(d==null?void 0:d.filter(M=>(M.loyalty_points||0)>0).length)||0,i=(s==null?void 0:s.filter(M=>M.points_type==="earned"||M.points_type==="purchase").reduce((M,w)=>M+(w.points||0),0))||0,y=(s==null?void 0:s.filter(M=>M.points_type==="redeemed").reduce((M,w)=>M+Math.abs(w.points||0),0))||0,x=i-y,h=(s==null?void 0:s.filter(M=>M.points_type==="redeemed").length)||0,g=new Date;g.setMonth(g.getMonth()-1);const k=(d==null?void 0:d.filter(M=>!0).length)||0;b({totalMembers:D,activeMembers:m,totalPointsIssued:i,totalPointsRedeemed:y,availablePoints:x,redemptions:h,growth:0})}catch(t){console.error("Error loading loyalty data:",t),b({totalMembers:0,activeMembers:0,totalPointsIssued:0,totalPointsRedeemed:0,availablePoints:0,redemptions:0,growth:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(Je,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Loyalty Program"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Rewards & points"})]})]}),e.jsxs("button",{onClick:()=>u("/lats/loyalty"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Active Members"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.activeMembers})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Members"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalMembers})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Points Issued"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:(a.totalPointsIssued||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Available"}),e.jsx("p",{className:"text-xl font-semibold text-emerald-600",children:(a.availablePoints||0).toLocaleString()})]})]}),e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Redemptions"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.redemptions})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-yellow-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Points Redeemed"})]}),e.jsx("span",{className:"text-sm font-medium text-yellow-700",children:(a.totalPointsRedeemed||0).toLocaleString()})]})]}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400 hover:scale-110 transition-all duration-200 shadow-sm hover:shadow-md",title:"Issue Points",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 transition-all duration-200 shadow-sm hover:shadow-md",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Rewards"})]})]}),e.jsx(js,{isOpen:T,onClose:()=>C(!1),onSuccess:()=>{j()}}),e.jsx(bs,{isOpen:v,onClose:()=>p(!1)})]})},js=({isOpen:f,onClose:u,onSuccess:a})=>{const{customers:b}=nt(),[_,N]=c.useState(""),[T,C]=c.useState(""),[v,p]=c.useState(""),[j,t]=c.useState(!1),o=Z(),s=async r=>{if(r.preventDefault(),!_||!T){Y.error("Please fill in all required fields");return}t(!0);try{const{error:n}=await P.from("loyalty_points").insert({customer_id:_,points:parseInt(T),points_type:"earned",reason:v||"Manual points issuance",branch_id:o,created_at:new Date().toISOString()});if(n)throw n;Y.success("Points issued successfully"),u(),a==null||a()}catch(n){console.error("Error issuing points:",n),Y.error("Failed to issue points")}finally{t(!1)}};return e.jsx(J,{isOpen:f,onClose:u,title:"Issue Loyalty Points",maxWidth:"md",children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer"}),e.jsxs("select",{value:_,onChange:r=>N(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500",required:!0,children:[e.jsx("option",{value:"",children:"Select customer"}),b==null?void 0:b.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.phone,")"]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Points"}),e.jsx("input",{type:"number",value:T,onChange:r=>C(r.target.value),placeholder:"Enter points",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason (Optional)"}),e.jsx("input",{type:"text",value:v,onChange:r=>p(r.target.value),placeholder:"Reason for issuing points",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:j,className:"px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black disabled:opacity-50",children:j?"Issuing...":"Issue Points"})]})]})})},bs=({isOpen:f,onClose:u})=>{const[a,b]=c.useState([]),[_,N]=c.useState(!0),T=Z();c.useEffect(()=>{f&&C()},[f]);const C=async()=>{N(!0);try{let v=P.from("loyalty_rewards").select("*").eq("is_active",!0);T&&(v=v.eq("branch_id",T));const{data:p,error:j}=await v;if(j)throw j;b(p||[])}catch(v){console.error("Error loading rewards:",v),Y.error("Failed to load rewards")}finally{N(!1)}};return e.jsx(J,{isOpen:f,onClose:u,title:"Available Rewards",maxWidth:"lg",children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:_?e.jsx("div",{className:"text-center py-8",children:"Loading..."}):a.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No rewards available"}):a.map(v=>e.jsx("div",{className:"p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:v.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[v.points_required," points required"]})]}),e.jsx("span",{className:"text-sm font-medium text-yellow-600",children:v.description||"Available"})]})},v.id))})})},vs=({className:f})=>{const u=K(),[a,b]=c.useState({totalTradeIns:0,pending:0,completed:0,totalValue:0,averageValue:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("lats_trade_in_transactions").select("id, status, final_trade_in_value, created_at");t&&(o=o.eq("branch_id",t));const{data:s,error:r}=await o;if(r){if(r.code==="42P01"){b({totalTradeIns:0,pending:0,completed:0,totalValue:0,averageValue:0}),N(!1);return}throw r}const n=(s==null?void 0:s.length)||0,d=(s==null?void 0:s.filter(i=>i.status==="pending"||i.status==="processing").length)||0,l=(s==null?void 0:s.filter(i=>i.status==="completed").length)||0,D=(s==null?void 0:s.reduce((i,y)=>i+(y.final_trade_in_value||0),0))||0,m=n>0?D/n:0;b({totalTradeIns:n,pending:d,completed:l,totalValue:D,averageValue:m})}catch(t){console.error("Error loading trade-in data:",t),b({totalTradeIns:0,pending:0,completed:0,totalValue:0,averageValue:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-cyan-100 flex items-center justify-center",children:e.jsx(Ye,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Trade-ins"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Device trade-ins"})]})]}),e.jsxs("button",{onClick:()=>u("/trade-ins"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalTradeIns})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Pending"}),e.jsx("p",{className:"text-2xl font-semibold text-amber-600",children:a.pending})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Completed"}),e.jsx("p",{className:"text-xl font-semibold text-emerald-600",children:a.completed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Avg. Value"}),e.jsxs("p",{className:"text-xl font-semibold text-blue-600",children:[a.averageValue.toLocaleString()," TZS"]})]})]}),e.jsx("div",{className:"mb-6 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Total Value"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.totalValue.toLocaleString()," TZS"]})]})}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:scale-110 shadow-sm hover:shadow-md transition-all duration-200",title:"New Trade-in",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(X,{size:14}),e.jsx("span",{children:"Pending"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>C(!1),title:"New Trade-in",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Trade-in creation form will be implemented here."}),e.jsx("button",{onClick:()=>{Y.success("Feature coming soon"),C(!1)},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Pending Trade-ins",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Pending trade-ins will be listed here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},Ns=({className:f})=>{const u=K(),[a,b]=c.useState({totalInstallments:0,activeInstallments:0,overdueInstallments:0,totalAmount:0,collectedAmount:0,pendingAmount:0,collectionRate:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("customer_installment_plans").select("id, total_amount, total_paid, status, next_payment_date, created_at");t&&(o=o.eq("branch_id",t));const{data:s,error:r}=await o;if(r){if(r.code==="42P01"){b({totalInstallments:0,activeInstallments:0,overdueInstallments:0,totalAmount:0,collectedAmount:0,pendingAmount:0,collectionRate:0}),N(!1);return}throw r}console.log("ðŸ“Š [InstallmentsWidget] Raw installments data:",s);const n=(s==null?void 0:s.length)||0,d=(s==null?void 0:s.filter(x=>x.status==="active"||x.status==="pending").length)||0,l=(s==null?void 0:s.filter(x=>x.status==="completed"||x.status==="cancelled"||!x.next_payment_date?!1:new Date(x.next_payment_date)<new Date).length)||0;console.log("ðŸ“Š [InstallmentsWidget] Calculating amounts from installments..."),s==null||s.forEach((x,h)=>{console.log(`  [${h}] total_amount:`,x.total_amount,typeof x.total_amount),console.log(`  [${h}] total_paid:`,x.total_paid,typeof x.total_paid)});const D=(s==null?void 0:s.reduce((x,h)=>{const g=Number(h.total_amount)||0;return x+g},0))||0,m=(s==null?void 0:s.reduce((x,h)=>{const g=Number(h.total_paid)||0;return x+g},0))||0,i=D-m,y=D>0?m/D*100:0;console.log("ðŸ“Š [InstallmentsWidget] Calculated metrics:",{totalAmount:D,collectedAmount:m,pendingAmount:i,collectionRate:y,types:{totalAmount:typeof D,collectedAmount:typeof m,pendingAmount:typeof i}}),b({totalInstallments:n,activeInstallments:d,overdueInstallments:l,totalAmount:D,collectedAmount:m,pendingAmount:i,collectionRate:y})}catch(t){console.error("Error loading installment data:",t),b({totalInstallments:0,activeInstallments:0,overdueInstallments:0,totalAmount:0,collectedAmount:0,pendingAmount:0,collectionRate:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(De,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Installments"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Payment plans overview"})]})]}),e.jsxs("button",{onClick:()=>u("/installments"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Plans"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalInstallments})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Active"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:a.activeInstallments})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Overdue"}),e.jsx("p",{className:"text-xl font-semibold text-rose-600",children:a.overdueInstallments})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Collection Rate"}),e.jsxs("p",{className:"text-xl font-semibold text-emerald-600",children:[a.collectionRate.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Total Amount"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.totalAmount.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})," TZS"]})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-emerald-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Collected"}),e.jsxs("span",{className:"text-sm font-medium text-emerald-700",children:[a.collectedAmount.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})," TZS"]})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-amber-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Pending"}),e.jsxs("span",{className:"text-sm font-medium text-amber-700",children:[a.pendingAmount.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})," TZS"]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:scale-110 shadow-sm hover:shadow-md transition-all duration-200",title:"New Plan",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(oe,{size:14}),e.jsx("span",{children:"Overdue"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>C(!1),title:"New Installment Plan",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Installment plan creation form will be implemented here."}),e.jsx("button",{onClick:()=>{Y.success("Feature coming soon"),C(!1)},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Overdue Installments",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Overdue installment plans will be listed here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},ws=({className:f})=>{const u=K(),[a,b]=c.useState({totalSent:0,sentToday:0,failed:0,pending:0,successRate:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("sms_logs").select("id, status, created_at");t&&(o=o.eq("branch_id",t));const{data:s,error:r}=await o;if(r){if(r.code==="42P01"){b({totalSent:0,sentToday:0,failed:0,pending:0,successRate:0}),N(!1);return}throw r}const n=new Date;n.setHours(0,0,0,0);const d=(s==null?void 0:s.length)||0,l=(s==null?void 0:s.filter(x=>{const h=new Date(x.created_at);return h.setHours(0,0,0,0),h.getTime()===n.getTime()}).length)||0,D=(s==null?void 0:s.filter(x=>x.status==="failed").length)||0,m=(s==null?void 0:s.filter(x=>x.status==="pending").length)||0,i=(s==null?void 0:s.filter(x=>x.status==="sent"||x.status==="delivered").length)||0,y=d>0?i/d*100:0;b({totalSent:d,sentToday:l,failed:D,pending:m,successRate:y})}catch(t){console.error("Error loading SMS data:",t),b({totalSent:0,sentToday:0,failed:0,pending:0,successRate:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"SMS Center"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Message overview"})]})]}),e.jsxs("button",{onClick:()=>u("/sms"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Sent"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalSent})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Sent Today"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:a.sentToday})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Failed"}),e.jsx("p",{className:"text-xl font-semibold text-rose-600",children:a.failed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Success Rate"}),e.jsxs("p",{className:"text-xl font-semibold text-emerald-600",children:[a.successRate.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mb-6 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Pending"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.pending})]})}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:scale-110 shadow-sm hover:shadow-md transition-all duration-200",title:"Send SMS",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(ie,{size:14}),e.jsx("span",{children:"Bulk SMS"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>C(!1),title:"Send SMS",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"SMS sending form will be implemented here."}),e.jsx("button",{onClick:()=>{Y.success("Feature coming soon"),C(!1)},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Bulk SMS",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Bulk SMS sending form will be implemented here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},Ss=({className:f})=>{const u=K(),[a,b]=c.useState({totalParts:0,lowStock:0,outOfStock:0,totalValue:0,categories:0,recentUsage:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("lats_spare_parts").select("id, quantity, min_quantity, selling_price, cost_price, category_id");const{data:s,error:r}=await o;if(r){if(r.code==="42P01"||r.code==="42703"){b({totalParts:0,lowStock:0,outOfStock:0,totalValue:0,categories:0,recentUsage:0}),N(!1);return}throw r}const n=(s==null?void 0:s.length)||0,d=(s==null?void 0:s.filter(g=>(g.quantity||0)>0&&(g.quantity||0)<=(g.min_quantity||0)).length)||0,l=(s==null?void 0:s.filter(g=>(g.quantity||0)===0).length)||0,D=(s==null?void 0:s.reduce((g,k)=>{const S=k.selling_price||k.cost_price||0;return g+(k.quantity||0)*S},0))||0,m=new Set(s==null?void 0:s.map(g=>g.category_id).filter(Boolean)).size,i=new Date;i.setDate(i.getDate()-7);let y=P.from("lats_stock_movements").select("id").eq("movement_type","out").gte("created_at",i.toISOString());t&&(y=y.eq("branch_id",t));const{data:x}=await y,h=(x==null?void 0:x.length)||0;b({totalParts:n,lowStock:d,outOfStock:l,totalValue:D,categories:m,recentUsage:h})}catch(t){console.error("Error loading spare parts data:",t),b({totalParts:0,lowStock:0,outOfStock:0,totalValue:0,categories:0,recentUsage:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Spare Parts"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Inventory overview"})]})]}),e.jsxs("button",{onClick:()=>u("/spare-parts"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Parts"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalParts})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Categories"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:a.categories})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Low Stock"}),e.jsx("p",{className:"text-xl font-semibold text-amber-600",children:a.lowStock})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Out of Stock"}),e.jsx("p",{className:"text-xl font-semibold text-rose-600",children:a.outOfStock})]})]}),e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Total Value"})]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.totalValue.toLocaleString()," TZS"]})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Recent Usage (7d)"})]}),e.jsx("span",{className:"text-sm font-medium text-blue-700",children:a.recentUsage})]})]}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:scale-110 shadow-sm hover:shadow-md transition-all duration-200",title:"Add Part",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(be,{size:14}),e.jsx("span",{children:"Low Stock"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>C(!1),title:"Add Spare Part",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Spare part creation form will be implemented here."}),e.jsx("button",{onClick:()=>{Y.success("Feature coming soon"),C(!1)},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Low Stock Parts",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Low stock parts will be listed here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},ks=({className:f})=>{const u=K(),[a,b]=c.useState({totalRooms:0,totalItems:0,totalCapacity:0,usedCapacity:0,utilizationRate:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("lats_storage_rooms").select("id, capacity");const{data:s,error:r}=await o;let n=P.from("lats_inventory_items").select("id, storage_room_id, quantity");t&&(n=n.eq("branch_id",t));const{data:d,error:l}=await n;if(r&&r.code==="42P01"){b({totalRooms:0,totalItems:0,totalCapacity:0,usedCapacity:0,utilizationRate:0}),N(!1);return}if(l&&l.code==="42P01"){b({totalRooms:(s==null?void 0:s.length)||0,totalItems:0,totalCapacity:(s==null?void 0:s.reduce((h,g)=>h+(g.capacity||0),0))||0,usedCapacity:0,utilizationRate:0}),N(!1);return}if(r||l)throw r||l;const D=(s==null?void 0:s.length)||0,m=(d==null?void 0:d.length)||0,i=(s==null?void 0:s.reduce((h,g)=>h+(g.capacity||0),0))||0,y=(d==null?void 0:d.reduce((h,g)=>h+(g.quantity||0),0))||0,x=i>0?y/i*100:0;b({totalRooms:D,totalItems:m,totalCapacity:i,usedCapacity:y,utilizationRate:x})}catch(t){console.error("Error loading storage rooms data:",t),b({totalRooms:0,totalItems:0,totalCapacity:0,usedCapacity:0,utilizationRate:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(Ke,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Storage Rooms"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Storage management"})]})]}),e.jsxs("button",{onClick:()=>u("/storage-rooms"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Rooms"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalRooms})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:a.totalItems})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Utilization"}),e.jsxs("p",{className:"text-xl font-semibold text-emerald-600",children:[a.utilizationRate.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Capacity"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:a.totalCapacity.toLocaleString()})]})]}),e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Used Capacity"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.usedCapacity.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-purple-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Available"})]}),e.jsx("span",{className:"text-sm font-medium text-purple-700",children:(a.totalCapacity-a.usedCapacity).toLocaleString()})]})]}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:scale-110 shadow-sm hover:shadow-md transition-all duration-200",title:"New Room",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(dt,{size:14}),e.jsx("span",{children:"View Map"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>C(!1),title:"New Storage Room",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Storage room creation form will be implemented here."}),e.jsx("button",{onClick:()=>{Y.success("Feature coming soon"),C(!1)},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Storage Room Map",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Storage room map view will be implemented here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},Cs=({className:f})=>{const u=K(),[a,b]=c.useState({totalTransfers:0,pendingTransfers:0,inTransit:0,completed:0,averageTime:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("lats_stock_transfers").select("id, status, created_at, completed_at");const{data:s,error:r}=await o;if(r){if(r.code==="42P01"){b({totalTransfers:0,pendingTransfers:0,inTransit:0,completed:0,averageTime:0}),N(!1);return}throw r}const n=(s==null?void 0:s.length)||0,d=(s==null?void 0:s.filter(x=>x.status==="pending").length)||0,l=(s==null?void 0:s.filter(x=>x.status==="in_transit").length)||0,D=(s==null?void 0:s.filter(x=>x.status==="completed").length)||0,m=(s==null?void 0:s.filter(x=>x.status==="completed"&&x.completed_at&&x.created_at))||[],i=m.reduce((x,h)=>{const g=new Date(h.created_at).getTime(),k=new Date(h.completed_at).getTime();return x+(k-g)},0),y=m.length>0?i/m.length/(1e3*60*60):0;b({totalTransfers:n,pendingTransfers:d,inTransit:l,completed:D,averageTime:y})}catch(t){console.error("Error loading stock transfer data:",t),b({totalTransfers:0,pendingTransfers:0,inTransit:0,completed:0,averageTime:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(mt,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Stock Transfers"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Transfer tracking"})]})]}),e.jsxs("button",{onClick:()=>u("/stock-transfers"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalTransfers})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Pending"}),e.jsx("p",{className:"text-2xl font-semibold text-amber-600",children:a.pendingTransfers})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"In Transit"}),e.jsx("p",{className:"text-xl font-semibold text-blue-600",children:a.inTransit})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Completed"}),e.jsx("p",{className:"text-xl font-semibold text-emerald-600",children:a.completed})]})]}),e.jsx("div",{className:"mb-6 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Avg. Time"})]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.averageTime.toFixed(1),"h"]})]})}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:scale-110 shadow-sm hover:shadow-md transition-all duration-200",title:"New Transfer",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(X,{size:14}),e.jsx("span",{children:"Pending"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>C(!1),title:"New Stock Transfer",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Stock transfer creation form will be implemented here."}),e.jsx("button",{onClick:()=>{Y.success("Feature coming soon"),C(!1)},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Pending Transfers",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Pending stock transfers will be listed here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},_s=({className:f})=>{const u=K(),[a,b]=c.useState({totalOrders:0,pendingOrders:0,inProgress:0,completed:0,overdue:0,totalValue:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("special_orders").select("id, status, total_amount, created_at");t&&(o=o.eq("branch_id",t));const{data:s,error:r}=await o;if(r){if(r.code==="42P01"){b({totalOrders:0,pendingOrders:0,inProgress:0,completed:0,overdue:0,totalValue:0}),N(!1);return}throw r}const n=(s==null?void 0:s.length)||0,d=(s==null?void 0:s.filter(y=>y.status==="pending"||y.status==="requested").length)||0,l=(s==null?void 0:s.filter(y=>y.status==="processing"||y.status==="ordered").length)||0,D=(s==null?void 0:s.filter(y=>y.status==="completed"||y.status==="delivered").length)||0,m=0,i=(s==null?void 0:s.reduce((y,x)=>y+(parseFloat(x.total_amount)||0),0))||0;b({totalOrders:n,pendingOrders:d,inProgress:l,completed:D,overdue:m,totalValue:i})}catch(t){console.error("Error loading special order data:",t),b({totalOrders:0,pendingOrders:0,inProgress:0,completed:0,overdue:0,totalValue:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Special Orders"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Custom orders overview"})]})]}),e.jsxs("button",{onClick:()=>u("/special-orders"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalOrders})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Pending"}),e.jsx("p",{className:"text-2xl font-semibold text-amber-600",children:a.pendingOrders})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"In Progress"}),e.jsx("p",{className:"text-xl font-semibold text-blue-600",children:a.inProgress})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Overdue"}),e.jsx("p",{className:"text-xl font-semibold text-rose-600",children:a.overdue})]})]}),e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Total Value"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.totalValue.toLocaleString()," TZS"]})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Completed"})]}),e.jsx("span",{className:"text-sm font-medium text-emerald-700",children:a.completed})]})]}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:scale-110 shadow-sm hover:shadow-md transition-all duration-200",title:"New Order",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(X,{size:14}),e.jsx("span",{children:"Pending"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>C(!1),title:"New Special Order",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Special order creation form will be implemented here."}),e.jsx("button",{onClick:()=>{Y.success("Feature coming soon"),C(!1)},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Pending Special Orders",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Pending special orders will be listed here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},Ds=({className:f})=>{const u=K(),[a,b]=c.useState({lastBackup:"Never",backupStatus:"warning",backupSize:"0 KB",totalBackups:0,nextScheduled:"Daily at 2:00 AM"}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1),[j,t]=c.useState(!1),[o,s]=c.useState(0),[r,n]=c.useState("");c.useEffect(()=>{d()},[]);const d=async()=>{try{N(!0);const{data:m,error:i}=await P.from("backup_logs").select("id, created_at, status").order("created_at",{ascending:!1}).limit(10);if(i){if(i.code==="42P01"){b({lastBackup:"Never",backupStatus:"warning",backupSize:"0 KB",totalBackups:0,nextScheduled:"Daily at 2:00 AM"}),N(!1);return}throw i}const y=(m==null?void 0:m.length)||0,x=m==null?void 0:m[0];let h="Never",g="warning",k="0 KB";if(x){const M=new Date(x.created_at),I=(new Date().getTime()-M.getTime())/(1e3*60*60);I<24?(h=I<1?"Just now":`${Math.floor(I)}h ago`,g=x.status==="success"?"success":"error"):(h=`${Math.floor(I/24)}d ago`,g=I>48?"error":"warning")}b({lastBackup:h,backupStatus:g,backupSize:k,totalBackups:y,nextScheduled:"Daily at 2:00 AM"})}catch(m){console.error("Error loading backup data:",m),b({lastBackup:"Never",backupStatus:"warning",backupSize:"0 KB",totalBackups:0,nextScheduled:"Daily at 2:00 AM"})}finally{N(!1)}},l=()=>{switch(a.backupStatus){case"success":return"text-emerald-600";case"warning":return"text-amber-600";case"error":return"text-rose-600";default:return"text-gray-600"}},D=()=>{switch(a.backupStatus){case"success":return e.jsx(ue,{size:16,className:"text-emerald-600"});case"warning":return e.jsx(oe,{size:16,className:"text-amber-600"});case"error":return e.jsx(oe,{size:16,className:"text-rose-600"});default:return e.jsx(X,{size:16,className:"text-gray-600"})}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(Ue,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Backup Status"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Data protection"})]})]}),e.jsxs("button",{onClick:()=>u("/admin-settings?section=database"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 rounded-lg bg-gray-50 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[D(),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Last Backup"})]}),e.jsx("span",{className:`text-sm font-semibold ${l()}`,children:a.lastBackup})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-gray-50",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Total Backups"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a.totalBackups})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-gray-50",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Size"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a.backupSize})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Next Scheduled"})]}),e.jsx("span",{className:"text-sm font-medium text-blue-700",children:a.nextScheduled})]})}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsxs("button",{onClick:m=>{m.preventDefault(),m.stopPropagation(),C(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(Ge,{size:14}),e.jsx("span",{children:"Backup Now"})]}),e.jsxs("button",{onClick:m=>{m.preventDefault(),m.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(X,{size:14}),e.jsx("span",{children:"History"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>!j&&C(!1),title:"Create Backup",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-gray-600 mb-4",children:["This will create a ",e.jsx("strong",{children:"complete backup"})," of your entire database, including:"]}),e.jsxs("ul",{className:"text-sm text-gray-600 mb-4 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"All tables (including empty ones)"}),e.jsx("li",{children:"All data records"}),e.jsx("li",{children:"Complete schema definitions"}),e.jsx("li",{children:"All columns, types, and constraints"})]}),j&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900",children:r||"Starting backup..."}),e.jsxs("span",{className:"text-sm text-blue-700",children:[Math.round(o),"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${o}%`}})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>C(!1),disabled:j,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Backing up...":"Cancel"}),!j&&e.jsx("button",{onClick:async()=>{t(!0),s(0),n("Starting backup...");try{const m=await Gt((i,y)=>{s(i),n(y)});m.success?(Y.success(m.message||"âœ… Backup completed successfully!",{duration:5e3}),d(),setTimeout(()=>{C(!1),t(!1),s(0),n("")},2e3)):(Y.error(m.error||"Backup failed"),t(!1))}catch(m){Y.error(`Backup failed: ${m.message}`),t(!1)}},className:"px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Start Backup"})]})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Backup History",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Backup history will be listed here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},Ts=({className:f})=>{const u=K(),[a,b]=c.useState({totalRepairs:0,inProgress:0,completed:0,overdue:0,pending:0,averageTime:0}),[_,N]=c.useState(!0),[T,C]=c.useState(!1),[v,p]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{N(!0);const t=Z();let o=P.from("devices").select("id, status, created_at");t&&(o=o.eq("branch_id",t));const{data:s,error:r}=await o;if(r){console.error("Error loading repair data:",r),b({totalRepairs:0,inProgress:0,completed:0,overdue:0,pending:0,averageTime:0}),N(!1);return}const n=[];b({totalRepairs:0,inProgress:0,completed:0,overdue:0,pending:0,averageTime:0})}catch(t){console.error("Error loading repair data:",t),b({totalRepairs:0,inProgress:0,completed:0,overdue:0,pending:0,averageTime:0})}finally{N(!1)}};return _?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col h-full ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Repairs"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Repair management"})]})]}),e.jsxs("button",{onClick:()=>u("/devices"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.totalRepairs})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:a.inProgress})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Completed"}),e.jsx("p",{className:"text-xl font-semibold text-emerald-600",children:a.completed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Overdue"}),e.jsx("p",{className:"text-xl font-semibold text-rose-600",children:a.overdue})]})]}),e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Pending"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.pending})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Avg. Time"})]}),e.jsxs("span",{className:"text-sm font-medium text-blue-700",children:[a.averageTime.toFixed(1),"d"]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 border-t",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),C(!0)},className:"w-10 h-10 flex items-center justify-center rounded-full bg-transparent border border-gray-300 text-gray-700 hover:bg-gray-50 hover:scale-110 shadow-sm hover:shadow-md transition-all duration-200",title:"New Repair",children:e.jsx(H,{size:18})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-black hover:scale-105 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(oe,{size:14}),e.jsx("span",{children:"Overdue"})]})]}),e.jsx(J,{isOpen:T,onClose:()=>C(!1),title:"New Repair",maxWidth:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Repair creation form will be implemented here."}),e.jsx("button",{onClick:()=>{Y.success("Feature coming soon"),C(!1)},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})}),e.jsx(J,{isOpen:v,onClose:()=>p(!1),title:"Overdue Repairs",maxWidth:"lg",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600",children:"Overdue repairs will be listed here."}),e.jsx("button",{onClick:()=>p(!1),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black",children:"Close"})]})})]})},Ms=({className:f})=>{const[u,a]=c.useState([]),[b,_]=c.useState(!0),[N,T]=c.useState(0),[C,v]=c.useState(0);c.useEffect(()=>{p()},[]);const p=async()=>{try{_(!0);const{supabase:o}=await te(()=>import("./index-61458a34.js").then(h=>h.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{getCurrentBranchId:s}=await te(()=>import("./index-61458a34.js").then(h=>h.bb),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),r=s(),n=[],d=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];let l=0;for(let h=6;h>=0;h--){const g=new Date;g.setDate(g.getDate()-h);const k=d[g.getDay()],S=new Date(g);S.setHours(0,0,0,0);const M=new Date(g);M.setHours(23,59,59,999);let w=o.from("lats_sales").select("total_amount").gte("created_at",S.toISOString()).lte("created_at",M.toISOString());r&&(w=w.eq("branch_id",r));const{data:I,error:$}=await w;$&&console.error("Error fetching sales data:",$);const L=(I==null?void 0:I.reduce((W,V)=>{const E=V.total_amount,O=typeof E=="string"?parseFloat(E):E,F=isNaN(O)||O===null||O===void 0?0:O;return W+F},0))||0;l+=L,n.push({day:k,revenue:L,date:g.toLocaleDateString("en-US",{month:"short",day:"numeric"})})}const D=n.map(h=>({...h,revenue:isNaN(h.revenue)||h.revenue===null||h.revenue===void 0?0:h.revenue}));a(D),T(isNaN(l)||l===null||l===void 0?0:l);const m=n.slice(-3).reduce((h,g)=>h+(g.revenue||0),0)/3,i=n.slice(0,4).reduce((h,g)=>h+(g.revenue||0),0)/4,y=i>0?(m-i)/i*100:0,x=isNaN(y)?0:y;v(Math.round(x*10)/10)}catch(o){console.error("Error loading revenue data:",o)}finally{_(!1)}},j=o=>{const s=typeof o=="string"?parseFloat(o):o;return isNaN(s)||s===null||s===void 0?"0":s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(0)}K`:s.toFixed(0)},t=({active:o,payload:s})=>o&&s&&s.length?e.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:s[0].payload.date}),e.jsxs("p",{className:"text-sm font-bold",children:["TSh ",j(s[0].value)]})]}):null;return b?e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Se,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Sales & Revenue This Week"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["TSh ",j(N)]})]}),e.jsxs("div",{className:`flex items-center gap-1 px-2.5 py-1.5 rounded-lg ${C>=0?"bg-emerald-50":"bg-red-50"}`,children:[e.jsx(ee,{className:`w-4 h-4 ${C>=0?"text-emerald-600":"text-red-600"}`}),e.jsxs("span",{className:`text-sm font-semibold ${C>=0?"text-emerald-600":"text-red-600"}`,children:[C>=0?"+":"",C,"%"]})]})]}),e.jsx("div",{className:"flex-grow -mx-2 -mb-2 min-h-48",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(gt,{data:u,margin:{top:0,right:0,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#10b981",stopOpacity:.4}),e.jsx("stop",{offset:"30%",stopColor:"#10b981",stopOpacity:.2}),e.jsx("stop",{offset:"70%",stopColor:"#10b981",stopOpacity:.1}),e.jsx("stop",{offset:"100%",stopColor:"#10b981",stopOpacity:.05})]})}),e.jsx(he,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx(pe,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),e.jsx(ge,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickFormatter:j,tickLine:!1,axisLine:!1,width:50,domain:[0,"auto"]}),e.jsx(de,{content:e.jsx(t,{})}),e.jsx(He,{type:"monotone",dataKey:"revenue",stroke:"#10b981",strokeWidth:3,fill:"url(#colorRevenue)",connectNulls:!1})]})})})]})},Is=({className:f})=>{const{currentUser:u}=Q(),[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0),[v,p]=c.useState(new Date),j={"Active Repairs":"#3b82f6","Awaiting Parts":"#f59e0b",Completed:"#10b981","New/Assigned":"#8b5cf6",Failed:"#ef4444"};c.useEffect(()=>{t();const n=setInterval(()=>{t()},3e4);return()=>clearInterval(n)},[u==null?void 0:u.id]);const t=async()=>{try{if(N(!0),u!=null&&u.id){const{supabase:n}=await te(()=>import("./index-61458a34.js").then(h=>h.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{getCurrentBranchId:d}=await te(()=>import("./index-61458a34.js").then(h=>h.bb),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),l=d();let D=n.from("devices").select("id, status, created_at, updated_at, problem_description, branch_id");l&&(D=D.eq("branch_id",l));const{data:m,error:i}=await D;if(i)throw console.error("âŒ Error fetching repair data:",i),i;console.log("ðŸ”§ Repair Data Fetched:",{totalRepairs:(m==null?void 0:m.length)||0,statuses:m==null?void 0:m.map(h=>h.status).join(", "),branchId:l||"all branches"});const y={"Active Repairs":0,"Awaiting Parts":0,Completed:0,"New/Assigned":0,Failed:0};m==null||m.forEach(h=>{var k;const g=((k=h.status)==null?void 0:k.toLowerCase())||"";["in-repair","diagnosis-started","reassembled-testing"].includes(g)?y["Active Repairs"]++:["awaiting-parts","parts-arrived"].includes(g)?y["Awaiting Parts"]++:["done","repair-complete","completed"].includes(g)?y.Completed++:["assigned","returned-to-customer-care","pending"].includes(g)?y["New/Assigned"]++:g==="failed"&&y.Failed++});const x=Object.entries(y).filter(([h,g])=>g>0).map(([h,g])=>({name:h,value:g,color:j[h]}));console.log("ðŸ“Š Repair Status Breakdown:",y),b(x),C((m==null?void 0:m.length)||0),p(new Date)}}catch(n){console.error("Error loading device data:",n)}finally{N(!1)}},o=({active:n,payload:d})=>n&&d&&d.length?e.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold",children:d[0].name}),e.jsxs("p",{className:"text-xs text-gray-300 mt-1",children:[d[0].value," devices (",(d[0].value/T*100).toFixed(1),"%)"]})]}):null,s=n=>`${(n.value/T*100).toFixed(0)}%`,r=n=>{const d=Math.floor((new Date().getTime()-n.getTime())/1e3);if(d<60)return"Just now";const l=Math.floor(d/60);if(l<60)return`${l}m ago`;const D=Math.floor(l/60);return D<24?`${D}h ago`:"Today"};return _?e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_e,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Repair Status"}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("span",{className:"text-xs text-gray-400",children:r(v)}),e.jsx("button",{onClick:t,disabled:_,className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",title:"Refresh data",children:e.jsx(Ye,{className:`w-4 h-4 text-gray-600 ${_?"animate-spin":""}`})})]})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:T}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total Repairs â€¢ Live Data"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-400 rounded-full animate-ping opacity-75"})]})]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center ml-4",children:e.jsx(ye,{className:"w-5 h-5 text-blue-600"})})]}),a.length===0?e.jsx("div",{className:"flex-grow flex items-center justify-center min-h-48",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No repairs found"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Device repairs will appear here when added"})]})}):e.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(ut,{children:[e.jsx(ht,{data:a,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,paddingAngle:3,dataKey:"value",label:s,labelLine:!1,children:a.map((n,d)=>e.jsx(Te,{fill:n.color},`cell-${d}`))}),e.jsx(de,{content:e.jsx(o,{})})]})})}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-4",children:a.map((n,d)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:n.color}}),e.jsx("span",{className:"text-xs text-gray-600 truncate",children:n.name}),e.jsx("span",{className:"text-xs font-semibold text-gray-900 ml-auto",children:n.value})]},d))})]})},$s=({className:f})=>{const u=K(),{currentUser:a}=Q(),[b,_]=c.useState([]),[N,T]=c.useState(!0),[C,v]=c.useState(0),[p,j]=c.useState(0),[t,o]=c.useState(!1);c.useEffect(()=>{s()},[a==null?void 0:a.id]);const s=async()=>{var n;try{if(T(!0),a!=null&&a.id){const{supabase:d}=await te(()=>import("./index-61458a34.js").then(k=>k.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{getCurrentBranchId:l}=await te(()=>import("./index-61458a34.js").then(k=>k.bb),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),D=l();let m=d.from("appointments").select("id, appointment_date, appointment_time, status");D&&(m=m.eq("branch_id",D));const{data:i,error:y}=await m;if(y){console.error("âŒ Error fetching appointments:",y),_([]),v(0),j(0);return}console.log("ðŸ“… Total appointments in database:",(i==null?void 0:i.length)||0),console.log("ðŸ“… Sample appointments:",i==null?void 0:i.slice(0,3));const x=[],h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];let g=0;for(let k=6;k>=0;k--){const S=new Date;S.setDate(S.getDate()-k);const M=h[S.getDay()],w=S.toISOString().split("T")[0],I=(i==null?void 0:i.filter($=>{if(!$.appointment_date)return!1;const W=$.appointment_date.split("T")[0]===w;return k===0&&W&&console.log("âœ… Today's appointment found:",$),W}).length)||0;g+=I,x.push({day:M,appointments:I,isToday:k===0})}console.log("ðŸ“Š Appointment trend data:",x),console.log(`ðŸ“Š Total this week: ${g}`),_(x),v(((n=x[x.length-1])==null?void 0:n.appointments)||0),j(g)}}catch(d){console.error("âŒ Error loading appointment data:",d)}finally{T(!1)}},r=({active:n,payload:d})=>n&&d&&d.length?e.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:d[0].payload.day}),e.jsxs("p",{className:"text-sm font-bold",children:[d[0].value," appointments"]})]}):null;return N?e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(je,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Appointments"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:C}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Today â€¢ ",p," this week"]})]}),e.jsx("div",{className:"px-2.5 py-1.5 rounded-lg bg-pink-50",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4 text-pink-600"}),e.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:[Math.round(p/7*10)/10," avg"]})]})})]}),e.jsx("div",{className:"flex-grow -mx-2 mb-4 min-h-48",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:b,margin:{top:0,right:0,left:0,bottom:0},children:[e.jsx(he,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx(pe,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),e.jsx(ge,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,width:50,domain:[0,"dataMax"]}),e.jsx(de,{content:e.jsx(r,{}),cursor:{fill:"rgba(236, 72, 153, 0.1)"}}),e.jsx(ve,{dataKey:"appointments",radius:[6,6,0,0],children:b.map((n,d)=>e.jsx(Te,{fill:n.isToday?"#ec4899":"#f9a8d4"},`cell-${d}`))})]})})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{onClick:()=>o(!0),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[e.jsx(H,{size:14}),e.jsx("span",{children:"Add Appointment"})]}),e.jsx("button",{onClick:()=>u("/appointments"),className:"px-3 py-2.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Appointments",children:e.jsx(q,{size:14})})]}),e.jsx(Zt,{isOpen:t,onClose:()=>o(!1),mode:"create",onSave:async n=>{try{await Ut(n),we.success("Appointment created successfully!"),o(!1),s()}catch(d){throw console.error("Error creating appointment:",d),we.error("Failed to create appointment"),d}}})]})},As=({className:f})=>{const{currentUser:u}=Q(),[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0);c.useEffect(()=>{v()},[u==null?void 0:u.id]);const v=async()=>{var r,n;try{if(N(!0),u!=null&&u.id){console.log("ðŸ“¦ Stock Levels: Loading product data...");let d,l=0;const D=2;let m;for(;l<=D;)try{if(l>0){const{requestDeduplicator:g}=await te(()=>import("./index-61458a34.js").then(M=>M.bd),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),S=`products:${localStorage.getItem("current_branch_id")||"default"}`;g.clear(S),console.log(`ðŸ”„ [StockLevelChart] Retry attempt ${l}/${D} - cleared stuck request`),await new Promise(M=>setTimeout(M,1e3*l))}d=await vt({forceRefresh:l>0});break}catch(g){if(m=g,(((r=g==null?void 0:g.message)==null?void 0:r.includes("timeout"))||((n=g==null?void 0:g.message)==null?void 0:n.includes("Request timeout")))&&l<D){l++,console.warn(`â° [StockLevelChart] Request timeout, retrying (${l}/${D})...`);continue}else throw g}if(!d)throw m||new Error("Failed to load products after retries");console.log(`ðŸ“Š Loaded ${d.length} products for stock analysis`),console.log("ðŸ“Š Sample products:",d.slice(0,3).map(g=>{var k;return{name:g.name,variants:((k=g.variants)==null?void 0:k.length)||0}}));const i=[];let y=0,x=0;d.forEach(g=>{if(g.variants&&g.variants.length>0){const k=g.variants.reduce((O,F)=>{const A=Number(F.quantity);return O+(isNaN(A)?0:A)},0),S=g.variants.reduce((O,F)=>{const A=Number(F.minQuantity||F.min_quantity||0);return O+(isNaN(A)||!isFinite(A)?0:A)},0),M=g.variants.length>0?S/g.variants.length:0;let w=0;if(M>0&&!isNaN(M)&&isFinite(M)&&!isNaN(k)&&isFinite(k)){const O=k/M*100;w=isNaN(O)||!isFinite(O)?0:Math.min(100,Math.max(0,Math.round(O)))}else k>0?w=100:w=0;(isNaN(w)||!isFinite(w))&&(w=0);let I="good";k===0?(I="critical",x++):k<=M&&(I="low",y++);const $=g.name||"Unnamed Product",L=$.trim().substring(0,25),W=isNaN(M)||!isFinite(M)?0:Math.round(M),V=isNaN(k)||!isFinite(k)?0:k,E=isNaN(w)||!isFinite(w)?0:w;i.push({name:$.length>25?L+"...":L,stock:E,status:I,actualQuantity:V,minQuantity:W}),console.log(`ðŸ“¦ Product: "${$}" | Qty: ${k} | Min: ${Math.round(M)} | Stock%: ${w} | Status: ${I}`)}});const h=i.filter(g=>{const k=!isNaN(g.stock)&&isFinite(g.stock)&&g.stock>=0,S=!isNaN(g.actualQuantity)&&isFinite(g.actualQuantity),M=!isNaN(g.minQuantity)&&isFinite(g.minQuantity);return k&&S&&M}).sort((g,k)=>{const S={critical:0,low:1,good:2};return S[g.status]!==S[k.status]?S[g.status]-S[k.status]:g.stock-k.stock}).slice(0,10);console.log("ðŸ“Š Final stock data for chart:",h),console.log(`ðŸ“Š Low stock count: ${y}, Critical: ${x}`),h.length>0?b(h):b([]),C(y+x)}}catch(d){const l=(d==null?void 0:d.message)||"Unknown error",D=l.includes("timeout")||l.includes("Request timeout");console.error("âŒ Error loading stock data:",d),console.error("âŒ Error details:",d),D&&(console.error("â° Request timed out. This may be due to:"),console.error("   - Slow network connection"),console.error("   - Database cold start (Neon)"),console.error("   - Large dataset being fetched"),console.error("   - Server overload")),b([]),C(0)}finally{N(!1)}},p=r=>{switch(r){case"good":return"#10b981";case"low":return"#f59e0b";case"critical":return"#ef4444";default:return"#6b7280"}},j=({active:r,payload:n})=>{if(r&&n&&n.length){const d=n[0].payload,l=d.status;return e.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold",children:d.name}),e.jsxs("p",{className:"text-xs text-gray-300 mt-1",children:["Current: ",d.actualQuantity," units"]}),e.jsxs("p",{className:"text-xs text-gray-300",children:["Min Required: ",d.minQuantity," units"]}),e.jsxs("p",{className:"text-xs text-gray-300 mt-1",children:["Stock Level: ",n[0].value,"%"]}),e.jsx("p",{className:`text-xs mt-1 font-medium ${l==="good"?"text-green-400":l==="low"?"text-amber-400":"text-red-400"}`,children:l==="good"?"âœ“ Good Stock":l==="low"?"âš  Low Stock":"âœ— Critical Level"})]})}return null};if(_)return e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})});const s=(Array.isArray(a)?a:[]).filter(r=>{const n=!isNaN(r.stock)&&isFinite(r.stock)&&r.stock>=0&&r.stock<=100,d=!isNaN(r.actualQuantity)&&isFinite(r.actualQuantity)&&r.actualQuantity>=0,l=!isNaN(r.minQuantity)&&isFinite(r.minQuantity)&&r.minQuantity>=0,D=n&&d&&l;return D||console.warn("âš ï¸ Filtering out invalid stock item:",r),D}).map(r=>({...r,stock:Math.max(0,Math.min(100,r.stock)),actualQuantity:Math.max(0,r.actualQuantity),minQuantity:Math.max(0,r.minQuantity)}));return console.log("ðŸ“Š Rendering chart with data:",s),console.log("ðŸ“Š Data length:",s.length),e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Stock Levels"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.length===10?"Top 10 products":`Product${s.length!==1?"s":""} tracked`})]}),T>0&&e.jsx("div",{className:"px-2.5 py-1.5 rounded-lg bg-amber-50",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4 text-amber-600"}),e.jsxs("span",{className:"text-sm font-semibold text-amber-600",children:[T," low"]})]})})]}),s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[e.jsx(ne,{className:"w-12 h-12 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No inventory data available"}),e.jsx("p",{className:"text-xs mt-1",children:"Add products to see stock levels"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:s.length>0&&e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:s,layout:"horizontal",margin:{left:0,right:10},children:[e.jsx(he,{strokeDasharray:"3 3",stroke:"#f0f0f0",horizontal:!1}),e.jsx(pe,{type:"number",domain:[0,100],allowDataOverflow:!1,stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:r=>{const n=Number(r);return isNaN(n)||!isFinite(n)?"0%":`${Math.max(0,Math.min(100,n))}%`}}),e.jsx(ge,{type:"category",dataKey:"name",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,width:120}),e.jsx(de,{content:e.jsx(j,{}),cursor:{fill:"rgba(0,0,0,0.05)"}}),e.jsx(ve,{dataKey:"stock",radius:[0,4,4,0],maxBarSize:20,fill:"#10b981",children:s.map((r,n)=>e.jsx(Te,{fill:p(r.status)},`cell-${n}`))})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Good"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Low"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Critical"})]})]})]})]})},Ps=({className:f})=>{const{currentUser:u}=Q(),[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0),[v,p]=c.useState(0);c.useEffect(()=>{j()},[u==null?void 0:u.id]);const j=async()=>{try{if(N(!0),u!=null&&u.id){const{supabase:o}=await te(()=>import("./index-61458a34.js").then(m=>m.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{getCurrentBranchId:s}=await te(()=>import("./index-61458a34.js").then(m=>m.bb),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),r=s(),n=await ae.getDashboardStats(u.id),d=[],l=new Date;let D=0;for(let m=29;m>=0;m--){const i=new Date(l);i.setDate(i.getDate()-m);const y=new Date(i);y.setHours(0,0,0,0);const x=new Date(i);x.setHours(23,59,59,999);let h=o.from("customers").select("id, created_at").gte("created_at",y.toISOString()).lte("created_at",x.toISOString());r&&(h=h.eq("branch_id",r));const{data:g}=await h,k=(g==null?void 0:g.length)||0;let S=o.from("devices").select("id, created_at, updated_at").or(`created_at.gte.${y.toISOString()},updated_at.gte.${y.toISOString()}`).lte("created_at",x.toISOString());r&&(S=S.eq("branch_id",r));const{data:M}=await S,w=(M==null?void 0:M.length)||0;m<7&&(D+=k),d.push({date:i.toLocaleDateString("en-US",{month:"short",day:"numeric"}),activity:w,newCustomers:k})}b(d),C(n.activeCustomers),p(D)}}catch(o){console.error("Error loading customer activity:",o)}finally{N(!1)}},t=({active:o,payload:s})=>o&&s&&s.length?e.jsxs("div",{className:"bg-gray-900 text-white px-4 py-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium mb-2",children:s[0].payload.date}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("span",{className:"text-xs text-gray-300",children:"Activity:"}),e.jsx("span",{className:"text-sm font-bold text-blue-400",children:s[0].value})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("span",{className:"text-xs text-gray-300",children:"New:"}),e.jsx("span",{className:"text-sm font-bold text-green-400",children:s[1].value})]})]})]}):null;return _?e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col w-full ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Customer Activity"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:T}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total active customers"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx($t,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["+",v]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"New this week"})]})]}),e.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(gt,{data:a,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorActivity",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorNew",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})]}),e.jsx(he,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(pe,{dataKey:"date",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,interval:4}),e.jsx(ge,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1}),e.jsx(de,{content:e.jsx(t,{})}),e.jsx(He,{type:"monotone",dataKey:"activity",stroke:"#3b82f6",strokeWidth:2,fill:"url(#colorActivity)"}),e.jsx(He,{type:"monotone",dataKey:"newCustomers",stroke:"#10b981",strokeWidth:2,fill:"url(#colorNew)"})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Activity"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"New Customers"})]})]})]})},Ls=({className:f})=>{const{currentUser:u}=Q(),[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0);c.useEffect(()=>{v()},[u==null?void 0:u.id]);const v=async()=>{try{N(!0);const{supabase:t}=await te(()=>import("./index-61458a34.js").then(m=>m.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{getCurrentBranchId:o}=await te(()=>import("./index-61458a34.js").then(m=>m.bb),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),s=o(),r=[];for(let m=13;m>=0;m--){const i=new Date;i.setDate(i.getDate()-m);const y=new Date(i);y.setHours(0,0,0,0);const x=new Date(i);x.setHours(23,59,59,999);let h=t.from("lats_sales").select("total_amount").gte("created_at",y.toISOString()).lte("created_at",x.toISOString());s&&(h=h.eq("branch_id",s));const{data:g}=await h,k=(g==null?void 0:g.reduce((A,z)=>{const B=z.total_amount,R=typeof B=="string"?parseFloat(B):B,G=isNaN(R)||R===null||R===void 0?0:R;return A+G},0))||0;let S=t.from("devices").select("status, created_at, updated_at").gte("created_at",y.toISOString()).lte("created_at",x.toISOString());s&&(S=S.eq("branch_id",s));const{data:M}=await S,w=(M==null?void 0:M.filter(A=>["done","repair-complete"].includes(A.status)).length)||0,I=(M==null?void 0:M.length)||0,$=I>0?Math.min(100,Math.round(w/I*100)):85,W=Math.min(100,Math.round(k/1e5*100)),V=I>0?Math.min(100,Math.round(w/I*100)):85,E=isNaN(W)||!isFinite(W)?0:Math.max(0,Math.min(100,W)),O=isNaN(V)||!isFinite(V)?0:Math.max(0,Math.min(100,V)),F=isNaN($)||!isFinite($)?0:Math.max(0,Math.min(100,$));r.push({date:i.toLocaleDateString("en-US",{month:"short",day:"numeric"}),sales:E,service:O,satisfaction:F})}const n=r.slice(-3).reduce((m,i)=>m+(i.sales||0)+(i.service||0)+(i.satisfaction||0),0)/9,d=r.slice(0,3).reduce((m,i)=>m+(i.sales||0)+(i.service||0)+(i.satisfaction||0),0)/9,l=d>0?(n-d)/d*100:0,D=isNaN(l)?0:l;b(r),C(Math.round(D*10)/10)}catch(t){console.error("Error loading performance metrics:",t)}finally{N(!1)}},p=({active:t,payload:o})=>t&&o&&o.length?e.jsxs("div",{className:"bg-gray-900 text-white px-4 py-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium mb-2",children:o[0].payload.date}),e.jsx("div",{className:"space-y-1",children:o.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:s.color}}),e.jsxs("span",{className:"text-xs text-gray-300 capitalize",children:[s.name,":"]})]}),e.jsxs("span",{className:"text-sm font-bold",style:{color:s.color},children:[s.value,"%"]})]},r))})]}):null;if(_)return e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})});const j=a.filter(t=>{const o=!isNaN(t.sales)&&isFinite(t.sales)&&!isNaN(t.service)&&isFinite(t.service)&&!isNaN(t.satisfaction)&&isFinite(t.satisfaction);return o||console.warn("âš ï¸ Filtering out invalid metrics data item:",t),o});return e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col w-full ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ye,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Performance Metrics"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 2 weeks trend analysis"})]}),e.jsxs("div",{className:`flex items-center gap-1 px-2.5 py-1.5 rounded-lg ${T>=0?"bg-emerald-50":"bg-red-50"}`,children:[e.jsx(ee,{className:`w-4 h-4 ${T>=0?"text-emerald-600":"text-red-600"}`}),e.jsxs("span",{className:`text-sm font-semibold ${T>=0?"text-emerald-600":"text-red-600"}`,children:[T>=0?"+":"",T,"%"]})]})]}),e.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(Qt,{data:j,children:[e.jsx(he,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(pe,{dataKey:"date",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,interval:2}),e.jsx(ge,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,domain:[0,100]}),e.jsx(de,{content:e.jsx(p,{})}),e.jsx($e,{type:"monotone",dataKey:"sales",stroke:"#fbbf24",strokeWidth:2.5,dot:{fill:"#fbbf24",r:3},activeDot:{r:5},name:"Sales"}),e.jsx($e,{type:"monotone",dataKey:"service",stroke:"#60a5fa",strokeWidth:2.5,dot:{fill:"#60a5fa",r:3},activeDot:{r:5},name:"Service"}),e.jsx($e,{type:"monotone",dataKey:"satisfaction",stroke:"#34d399",strokeWidth:2.5,dot:{fill:"#34d399",r:3},activeDot:{r:5},name:"Satisfaction"})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-400"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Sales"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Service"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-400"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Satisfaction"})]})]})]})},Es=({className:f})=>{var v,p,j,t;const[u,a]=c.useState([]),[b,_]=c.useState(!0),[N,T]=c.useState(0);c.useEffect(()=>{C()},[]);const C=async()=>{try{_(!0);const{supabase:o}=await te(()=>import("./index-61458a34.js").then(S=>S.b6),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),{getCurrentBranchId:s}=await te(()=>import("./index-61458a34.js").then(S=>S.bb),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),r=s();console.log("ðŸ” Sales Funnel: Loading data for branch:",r);let n=o.from("lats_sales").select("payment_status, total_amount, created_at, customer_id");r&&(n=n.eq("branch_id",r));const{data:d,error:l}=await n;if(l)throw console.error("âŒ Error fetching sales for funnel:",l),l;const D=d||[];console.log("âœ… Loaded",D.length,"sales records for funnel");const i={Leads:new Set(D.map(S=>S.customer_id)).size,Initiated:0,Pending:0,Completed:0,Converted:0};let y=0;D.forEach(S=>{var w;const M=((w=S.payment_status)==null?void 0:w.toLowerCase())||"pending";i.Initiated++,M==="pending"?i.Pending++:M==="completed"&&(i.Completed++,i.Converted++,y+=parseFloat(S.total_amount||0))});const x=[{stage:"Leads",value:i.Leads,color:"#3b82f6"},{stage:"Initiated",value:i.Initiated,color:"#8b5cf6"},{stage:"Pending",value:i.Pending,color:"#f59e0b"},{stage:"Completed",value:i.Completed,color:"#10b981"},{stage:"Revenue",value:Math.round(y),color:"#059669",isRevenue:!0}],h=Math.max(i.Leads,i.Initiated),g=x.map(S=>{const M=h>0?Math.round(S.value/h*100):0;return{...S,percentage:Math.min(M,100)}}),k=h>0?Math.round(i.Completed/h*100):0;console.log("ðŸ“Š Funnel Data:",{leads:i.Leads,initiated:i.Initiated,pending:i.Pending,completed:i.Completed,revenue:y,conversionRate:`${k}%`}),a(g),T(k)}catch(o){console.error("âŒ Error loading sales funnel data:",o),a([]),T(0)}finally{_(!1)}};return b?e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(At,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Sales Funnel"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Conversion pipeline analysis"})]}),e.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-green-50",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:[N,"%"]})]})})]}),e.jsx("div",{className:"space-y-2 mb-6",children:u.map((o,s)=>{const r=o.percentage,n=o.stage==="Revenue";return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700 w-24",children:o.stage}),e.jsx("span",{className:"text-xs text-gray-500",children:n?`TSh ${o.value.toLocaleString()}`:o.value})]}),e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-8 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full flex items-center justify-end px-3 transition-all duration-500",style:{width:`${r}%`,backgroundColor:o.color},children:e.jsxs("span",{className:"text-xs font-semibold text-white",children:[o.percentage,"%"]})})})]},s)})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-4 border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Leads"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:((v=u[0])==null?void 0:v.value)||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Drop-off"}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:Math.max(0,(((p=u[0])==null?void 0:p.value)||0)-(((j=u[3])==null?void 0:j.value)||0))})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Revenue"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["TSh ",(((t=u[4])==null?void 0:t.value)||0).toLocaleString()]})]})]})]})},Rs=({className:f})=>{const{currentUser:u}=Q(),[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0),[v,p]=c.useState(0);c.useEffect(()=>{j()},[u==null?void 0:u.id]);const j=async()=>{try{N(!0);const o=Z(),s=[],r=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];let n=0;for(let m=6;m>=0;m--){const i=new Date;i.setDate(i.getDate()-m);const y=r[i.getDay()],x=new Date(i);x.setHours(0,0,0,0);const h=new Date(i);h.setHours(23,59,59,999);let g=P.from("lats_purchase_orders").select("id, status").gte("created_at",x.toISOString()).lte("created_at",h.toISOString());o&&(g=g.eq("branch_id",o));const{data:k,error:S}=await g;S&&console.error("Error fetching PO data:",S);const M=k||[],w=M.filter(L=>L.status==="pending"||L.status==="ordered").length,I=M.filter(L=>L.status==="received").length,$=M.length;n+=$,s.push({day:y,date:i.toLocaleDateString("en-US",{month:"short",day:"numeric"}),pending:w,received:I,total:$})}b(s),C(n);const d=s.slice(-3).reduce((m,i)=>m+(i.total||0),0)/3,l=s.slice(0,4).reduce((m,i)=>m+(i.total||0),0)/4,D=l>0?(d-l)/l*100:0;p(Math.round(D*10)/10)}catch(o){console.error("Error loading PO data:",o)}finally{N(!1)}},t=({active:o,payload:s,label:r})=>{if(o&&s&&s.length){const n=s[0].payload;return e.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium mb-2",children:n.date}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"text-amber-400",children:"â— Pending:"})," ",n.pending]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"text-emerald-400",children:"â— Received:"})," ",n.received]}),e.jsxs("p",{className:"text-xs font-semibold border-t border-gray-700 pt-1 mt-1",children:["Total: ",n.total]})]})]})}return null};return _?e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ee,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Purchase Orders This Week"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:T}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total orders created"})]}),e.jsxs("div",{className:`flex items-center gap-1 px-2.5 py-1.5 rounded-lg ${v>=0?"bg-emerald-50":"bg-red-50"}`,children:[e.jsx(ee,{className:`w-4 h-4 ${v>=0?"text-emerald-600":"text-red-600"}`}),e.jsxs("span",{className:`text-sm font-semibold ${v>=0?"text-emerald-600":"text-red-600"}`,children:[v>=0?"+":"",v,"%"]})]})]}),a.length===0||T===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[e.jsx(ne,{className:"w-12 h-12 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No purchase orders this week"}),e.jsx("p",{className:"text-xs mt-1",children:"Create your first order to see trends"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:a,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx(he,{strokeDasharray:"3 3",stroke:"#f0f0f0",vertical:!1}),e.jsx(pe,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),e.jsx(ge,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,width:40,allowDecimals:!1}),e.jsx(de,{content:e.jsx(t,{}),cursor:{fill:"rgba(0,0,0,0.05)"}}),e.jsx(ve,{dataKey:"pending",stackId:"a",fill:"#f59e0b",radius:[0,0,0,0],maxBarSize:40}),e.jsx(ve,{dataKey:"received",stackId:"a",fill:"#10b981",radius:[4,4,0,0],maxBarSize:40})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-amber-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Pending Orders"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-emerald-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Received Orders"})]})]})]})]})},Fs=({className:f})=>{const{currentUser:u}=Q(),[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0),[v,p]=c.useState(0);c.useEffect(()=>{j()},[u==null?void 0:u.id]);const j=async()=>{try{N(!0);const s=Z(),r=new Date;r.setDate(r.getDate()-7);let n=P.from("lats_sales").select("payment_method, total_amount").gte("created_at",r.toISOString());s&&(n=n.eq("branch_id",s));const{data:d,error:l}=await n;if(l)throw l;const D=new Map;let m=0,i=0;(d||[]).forEach(h=>{let g="Unknown";h.payment_method&&(typeof h.payment_method=="string"?g=h.payment_method:typeof h.payment_method=="object"&&(g=h.payment_method.method||h.payment_method.name||h.payment_method.type||Object.keys(h.payment_method)[0]||"Unknown"));const k=typeof h.total_amount=="string"?parseFloat(h.total_amount):h.total_amount||0;if(m++,i+=k,D.has(g)){const S=D.get(g);S.total+=k,S.count+=1}else D.set(g,{total:k,count:1})});const y={cash:"#10b981",card:"#3b82f6",credit_card:"#3b82f6",debit_card:"#6366f1",mobile_money:"#f59e0b",mpesa:"#f59e0b",bank_transfer:"#8b5cf6",unknown:"#6b7280"},x=Array.from(D.entries()).map(([h,g])=>{const k=String(h||"Unknown");return{name:k.replace(/_/g," ").replace(/\b\w/g,S=>S.toUpperCase()),value:g.total,count:g.count,color:y[k.toLowerCase()]||"#6b7280"}});b(x),C(m),p(i)}catch(s){console.error("Error loading payment data:",s)}finally{N(!1)}},t=s=>s>=1e6?`TSh ${(s/1e6).toFixed(1)}M`:s>=1e3?`TSh ${(s/1e3).toFixed(0)}K`:`TSh ${s.toFixed(0)}`,o=({active:s,payload:r})=>{if(s&&r&&r.length){const n=r[0].payload,d=v>0?(n.value/v*100).toFixed(1):0;return e.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold mb-1",children:n.name}),e.jsxs("p",{className:"text-xs text-gray-300",children:["Amount: ",t(n.value)]}),e.jsxs("p",{className:"text-xs text-gray-300",children:["Transactions: ",n.count]}),e.jsxs("p",{className:"text-xs text-emerald-400 font-medium mt-1",children:[d,"% of total"]})]})}return null};return _?e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col w-full ${f}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Pt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Payment Methods"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:T}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total: ",t(v)]})]})}),a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[e.jsx(De,{className:"w-12 h-12 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No payment data available"}),e.jsx("p",{className:"text-xs mt-1",children:"Make sales to see payment distribution"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(ut,{children:[e.jsx(ht,{data:a,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:a.map((s,r)=>e.jsx(Te,{fill:s.color},`cell-${r}`))}),e.jsx(de,{content:e.jsx(o,{})})]})})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(150px, 100%), 1fr))",gap:"clamp(0.5rem, 1.5vw, 0.75rem)",gridAutoRows:"1fr"},children:a.map((s,r)=>{const n=v>0?(s.value/v*100).toFixed(0):0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:s.color}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-900 font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[n,"%"]})]})]},r)})})})]})]})},Os=({className:f})=>{const{currentUser:u}=Q(),[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0);c.useEffect(()=>{v()},[u==null?void 0:u.id]);const v=async()=>{try{N(!0);const t=Z(),o=new Date;o.setDate(o.getDate()-7);let s=P.from("lats_sales").select("id, created_at, branch_id").gte("created_at",o.toISOString());t&&(s=s.eq("branch_id",t));const{data:r,error:n}=await s;if(n)throw n;if(!r||r.length===0){b([]),C(0);return}const d=r.map(w=>w.id),{data:l,error:D}=await P.from("lats_sale_items").select("id, quantity, unit_price, sale_id, product_id").in("sale_id",d);if(D)throw D;if(!l||l.length===0){b([]),C(0);return}const m=[...new Set(l.map(w=>w.product_id).filter(Boolean))],{data:i,error:y}=await P.from("lats_products").select("id, category").in("id",m);if(y)throw y;const x=new Map((i||[]).map(w=>[w.id,w])),h=new Map;let g=0;(l||[]).forEach(w=>{const I=x.get(w.product_id),$=(I==null?void 0:I.category)||"Uncategorized",L=typeof w.unit_price=="string"?parseFloat(w.unit_price):w.unit_price,W=isNaN(L)||L===null||L===void 0?0:L,V=isNaN(w.quantity)||w.quantity===null||w.quantity===void 0?0:w.quantity,E=W*V,O=isNaN(E)||!isFinite(E)?0:E;if(g+=O,h.has($)){const F=h.get($);F.total+=O,F.count+=V}else h.set($,{total:O,count:V})});const k=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444","#06b6d4","#ec4899","#84cc16"],S=Array.from(h.entries()).map(([w,I],$)=>({name:w.length>15?w.substring(0,15)+"...":w,sales:I.total,count:I.count,color:k[$%k.length]})).filter(w=>{const I=!isNaN(w.sales)&&isFinite(w.sales)&&!isNaN(w.count)&&isFinite(w.count);return I||console.warn("âš ï¸ Filtering out invalid category data:",w),I}).sort((w,I)=>I.sales-w.sales).slice(0,8),M=isNaN(g)||!isFinite(g)?0:g;b(S),C(M)}catch(t){console.error("Error loading category data:",t)}finally{N(!1)}},p=t=>{const o=Number(t);return isNaN(o)||!isFinite(o)?"0":o>=1e6?`${(o/1e6).toFixed(1)}M`:o>=1e3?`${(o/1e3).toFixed(0)}K`:o.toFixed(0)},j=({active:t,payload:o})=>{if(t&&o&&o.length){const s=o[0].payload,r=T>0?(s.sales/T*100).toFixed(1):0;return e.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold mb-1",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-300",children:["Sales: TSh ",p(s.sales)]}),e.jsxs("p",{className:"text-xs text-gray-300",children:["Items Sold: ",s.count]}),e.jsxs("p",{className:"text-xs text-emerald-400 font-medium mt-1",children:[r,"% of total"]})]})}return null};return _?e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${f}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Qe,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Sales by Category"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["TSh ",p(T)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 7 days"})]})}),a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[e.jsx(Qe,{className:"w-12 h-12 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No category data available"}),e.jsx("p",{className:"text-xs mt-1",children:"Sales will be categorized here"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:a.length>0&&e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:a,margin:{top:10,right:10,left:-20,bottom:20},children:[e.jsx(he,{strokeDasharray:"3 3",stroke:"#f0f0f0",vertical:!1}),e.jsx(pe,{dataKey:"name",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,angle:-45,textAnchor:"end",height:60}),e.jsx(ge,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,tickFormatter:p,width:50}),e.jsx(de,{content:e.jsx(j,{}),cursor:{fill:"rgba(0,0,0,0.05)"}}),e.jsx(ve,{dataKey:"sales",radius:[8,8,0,0],maxBarSize:40,children:a.map((t,o)=>e.jsx(Te,{fill:t.color},`cell-${o}`))})]})})}),a.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Top Category"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:a[0].name})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:["TSh ",p(a[0].sales)]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[a[0].count," items"]})]})]})})]})]})},zs=({className:f})=>{const{currentUser:u}=Q(),[a,b]=c.useState([]),[_,N]=c.useState(!0),[T,C]=c.useState(0),[v,p]=c.useState(0);c.useEffect(()=>{j()},[u==null?void 0:u.id]);const j=async()=>{try{N(!0);const r=Z(),n=[],d=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];let l=0,D=0,m=0;for(let i=6;i>=0;i--){const y=new Date;y.setDate(y.getDate()-i);const x=d[y.getDay()],h=new Date(y);h.setHours(0,0,0,0);const g=new Date(y);g.setHours(23,59,59,999);let k=P.from("lats_sales").select("total_amount").gte("created_at",h.toISOString()).lte("created_at",g.toISOString());r&&(k=k.eq("branch_id",r));const{data:S,error:M}=await k;M&&console.error("Error fetching sales:",M);const w=(S||[]).reduce((B,R)=>{const G=typeof R.total_amount=="string"?parseFloat(R.total_amount):R.total_amount||0;return B+G},0);let I=P.from("lats_sale_items").select("id, quantity, unit_price, variant_id, sale_id, created_at").gte("created_at",h.toISOString()).lte("created_at",g.toISOString());r&&(I=I.eq("branch_id",r));const{data:$,error:L}=await I;L&&console.error("Error fetching items:",L);let W=0;if($&&$.length>0){const B=[...new Set($.map(R=>R.variant_id).filter(Boolean))];if(B.length>0){const{data:R,error:G}=await P.from("lats_product_variants").select("id, cost_price").in("id",B);if(!G&&R){const U=new Map(R.map(se=>[se.id,se]));W=$.reduce((se,me)=>{const le=U.get(me.variant_id),xe=(le==null?void 0:le.cost_price)||0,re=me.quantity||0,ft=typeof xe=="string"?parseFloat(xe):xe;return se+ft*re},0)}else console.error("Error fetching variants:",G)}}const V=isNaN(w)||!isFinite(w)?0:w,E=isNaN(W)||!isFinite(W)?0:W,O=V-E,F=V>0?O/V*100:0,A=isNaN(F)||!isFinite(F)?0:F,z=isNaN(O)||!isFinite(O)?0:O;l+=z,V>0&&(D+=A,m++),n.push({day:x,date:y.toLocaleDateString("en-US",{month:"short",day:"numeric"}),revenue:V,cost:E,profit:z,margin:A})}b(n),C(l),p(m>0?D/m:0)}catch(r){console.error("Error loading profit data:",r)}finally{N(!1)}},t=r=>r>=1e6?`${(r/1e6).toFixed(1)}M`:r>=1e3?`${(r/1e3).toFixed(0)}K`:r.toFixed(0),o=({active:r,payload:n})=>{if(r&&n&&n.length){const d=n[0].payload;return e.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium mb-2",children:d.date}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"text-emerald-400",children:"Revenue:"})," TSh ",t(d.revenue)]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"text-red-400",children:"Cost:"})," TSh ",t(d.cost)]}),e.jsxs("p",{className:"text-xs font-semibold border-t border-gray-700 pt-1 mt-1",children:[e.jsx("span",{className:"text-blue-400",children:"Profit:"})," TSh ",t(d.profit)]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"text-yellow-400",children:"Margin:"})," ",d.margin.toFixed(1),"%"]})]})]})}return null};if(_)return e.jsx("div",{className:`bg-white rounded-2xl p-6 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})});const s=a.filter(r=>{const n=!isNaN(r.profit)&&isFinite(r.profit)&&!isNaN(r.margin)&&isFinite(r.margin)&&!isNaN(r.revenue)&&isFinite(r.revenue)&&!isNaN(r.cost)&&isFinite(r.cost);return n||console.warn("âš ï¸ Filtering out invalid profit data item:",r),n});return e.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ee,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Profit & Margin"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["TSh ",t(T)]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Avg Margin: ",v.toFixed(1),"%"]})]}),e.jsx("div",{className:"px-3 py-2 rounded-lg bg-emerald-50",children:e.jsx("p",{className:"text-sm font-semibold text-emerald-600",children:"Week Profit"})})]}),e.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:s,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx(he,{strokeDasharray:"3 3",stroke:"#f0f0f0",vertical:!1}),e.jsx(pe,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),e.jsx(ge,{yAxisId:"left",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,tickFormatter:t,width:50}),e.jsx(ge,{yAxisId:"right",orientation:"right",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,tickFormatter:r=>`${r.toFixed(0)}%`,width:50}),e.jsx(de,{content:e.jsx(o,{})}),e.jsx(ve,{yAxisId:"left",dataKey:"profit",fill:"#10b981",radius:[4,4,0,0],maxBarSize:30}),e.jsx($e,{yAxisId:"right",type:"monotone",dataKey:"margin",stroke:"#f59e0b",strokeWidth:2,dot:{fill:"#f59e0b",r:4}})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-emerald-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Profit (TSh)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Margin (%)"})]})]})]})},Oe=()=>{const{currentUser:f}=Q(),[u,a]=c.useState({sales:{today:0,yesterday:0,growth:0,transactions:0},customers:{newToday:0,totalActive:0,retention:0},inventory:{lowStock:0,criticalStock:0,totalValue:0},devices:{active:0,completed:0,pending:0,overdue:0},employees:{present:0,total:0,attendance:0}}),[b,_]=c.useState(!1),[N,T]=c.useState(new Date),[C,v]=c.useState([]),p=c.useRef(),j=c.useRef(),t=c.useCallback(async()=>{try{const i=P.channel("sales_updates").on("postgres_changes",{event:"*",schema:"public",table:"lats_sales"},k=>{o(k)}).subscribe(),y=P.channel("customer_updates").on("postgres_changes",{event:"*",schema:"public",table:"customers"},k=>{s(k)}).subscribe(),x=P.channel("device_updates").on("postgres_changes",{event:"*",schema:"public",table:"lats_product_variants"},k=>{r(k)}).subscribe(),h=P.channel("inventory_updates").on("postgres_changes",{event:"*",schema:"public",table:"products"},k=>{n(k)}).subscribe(),g=P.channel("attendance_updates").on("postgres_changes",{event:"*",schema:"public",table:"attendance_records"},k=>{d(k)}).subscribe();j.current={sales:i,customers:y,devices:x,inventory:h,attendance:g},_(!0),await l()}catch(i){console.error("Failed to initialize real-time dashboard:",i),_(!1),p.current=setTimeout(()=>{t()},5e3)}},[]),o=c.useCallback(i=>{const y={type:"sales",action:i.eventType,data:i.new||i.old,timestamp:new Date().toISOString()};v(x=>[y,...x.slice(0,49)]),T(new Date),a(x=>{var h;return{...x,sales:{...x.sales,today:x.sales.today+(((h=i.new)==null?void 0:h.total_amount)||0),transactions:x.sales.transactions+1}}}),Ne.emit("dashboard:sales:update",y)},[]),s=c.useCallback(i=>{const y={type:"customer",action:i.eventType,data:i.new||i.old,timestamp:new Date().toISOString()};v(x=>[y,...x.slice(0,49)]),T(new Date),i.eventType==="INSERT"&&a(x=>({...x,customers:{...x.customers,newToday:x.customers.newToday+1,totalActive:x.customers.totalActive+1}})),Ne.emit("dashboard:customer:update",y)},[]),r=c.useCallback(i=>{const y={type:"device",action:i.eventType,data:i.new||i.old,timestamp:new Date().toISOString()};v(x=>[y,...x.slice(0,49)]),T(new Date),a(x=>{var h,g,k,S,M,w;return{...x,devices:{...x.devices,active:((h=i.new)==null?void 0:h.status)==="active"?x.devices.active+1:((g=i.old)==null?void 0:g.status)==="active"?x.devices.active-1:x.devices.active,completed:((k=i.new)==null?void 0:k.status)==="completed"?x.devices.completed+1:((S=i.old)==null?void 0:S.status)==="completed"?x.devices.completed-1:x.devices.completed,pending:((M=i.new)==null?void 0:M.status)==="pending"?x.devices.pending+1:((w=i.old)==null?void 0:w.status)==="pending"?x.devices.pending-1:x.devices.pending}}}),Ne.emit("dashboard:device:update",y)},[]),n=c.useCallback(i=>{const y={type:"inventory",action:i.eventType,data:i.new||i.old,timestamp:new Date().toISOString()};v(x=>[y,...x.slice(0,49)]),T(new Date),a(x=>{var h,g;return{...x,inventory:{...x.inventory,lowStock:((h=i.new)==null?void 0:h.stock_quantity)<=10?x.inventory.lowStock+1:((g=i.old)==null?void 0:g.stock_quantity)<=10?x.inventory.lowStock-1:x.inventory.lowStock}}}),Ne.emit("dashboard:inventory:update",y)},[]),d=c.useCallback(i=>{const y={type:"employee",action:i.eventType,data:i.new||i.old,timestamp:new Date().toISOString()};v(x=>[y,...x.slice(0,49)]),T(new Date),a(x=>{var h,g;return{...x,employees:{...x.employees,present:((h=i.new)==null?void 0:h.status)==="present"?x.employees.present+1:((g=i.old)==null?void 0:g.status)==="present"?x.employees.present-1:x.employees.present}}}),Ne.emit("dashboard:employee:update",y)},[]),l=c.useCallback(async()=>{try{const i=new Date;i.setHours(0,0,0,0);const y=new Date(i);y.setDate(y.getDate()+1);const{data:x}=await P.from("lats_sales").select("total_amount").gte("created_at",i.toISOString()).lt("created_at",y.toISOString()),h=(x==null?void 0:x.reduce(($,L)=>$+(L.total_amount||0),0))||0,{count:g}=await P.from("customers").select("*",{count:"exact",head:!0}).eq("is_active",!0),{data:k}=await P.from("lats_product_variants").select("status").eq("is_active",!0),S=(k==null?void 0:k.reduce(($,L)=>($[L.status]=($[L.status]||0)+1,$),{}))||{},M=i.toISOString().split("T")[0],{data:w}=await P.from("attendance_records").select("status").eq("attendance_date",M),I=(w==null?void 0:w.filter($=>$.status==="present").length)||0;a({sales:{today:h,yesterday:0,growth:0,transactions:(x==null?void 0:x.length)||0},customers:{newToday:0,totalActive:g||0,retention:0},inventory:{lowStock:0,criticalStock:0,totalValue:0},devices:{active:S.active||0,completed:S.completed||0,pending:S.pending||0,overdue:0},employees:{present:I,total:0,attendance:0}})}catch(i){console.error("Failed to load initial metrics:",i)}},[]),D=c.useCallback(()=>{j.current&&Object.values(j.current).forEach(i=>{i.unsubscribe()}),p.current&&clearTimeout(p.current),_(!1)},[]);c.useEffect(()=>(f&&t(),()=>{D()}),[f,t,D]);const m=c.useCallback(async()=>{await l(),T(new Date)},[l]);return{metrics:u,isConnected:b,lastUpdate:N,updates:C,refresh:m}},Bs=({className:f})=>{const{metrics:u,updates:a}=Oe(),[b,_]=c.useState([]),[N,T]=c.useState(!1),C=c.useMemo(()=>{const t=[];if(u.sales.today>0){const n=u.sales.growth;n>20?t.push({id:"sales-growth-high",type:"positive",title:"Excellent Sales Growth!",description:`Sales are up ${n.toFixed(1)}% compared to yesterday. Keep up the great work!`,impact:"high",category:"sales",actionable:!1,confidence:95}):n<-10&&t.push({id:"sales-decline-warning",type:"warning",title:"Sales Decline Detected",description:`Sales are down ${Math.abs(n).toFixed(1)}% from yesterday. Consider reviewing promotions or marketing efforts.`,impact:"high",category:"sales",actionable:!0,confidence:90});const d=u.sales.today/Math.max(u.sales.transactions,1);d>5e4&&t.push({id:"high-value-transactions",type:"opportunity",title:"High-Value Sales Opportunity",description:`Average transaction value is TZS ${d.toLocaleString()}. Consider upselling strategies.`,impact:"medium",category:"sales",actionable:!0,confidence:85})}u.inventory.lowStock>0&&t.push({id:"low-stock-alert",type:"alert",title:"Low Stock Alert",description:`${u.inventory.lowStock} items are running low on stock. Replenish inventory to avoid stockouts.`,impact:"high",category:"inventory",actionable:!0,confidence:100,data:{lowStockCount:u.inventory.lowStock}}),u.inventory.criticalStock>0&&t.push({id:"critical-stock-emergency",type:"alert",title:"Critical Stock Emergency!",description:`${u.inventory.criticalStock} items are critically low or out of stock. Immediate action required.`,impact:"high",category:"inventory",actionable:!0,confidence:100,data:{criticalStockCount:u.inventory.criticalStock}}),u.customers.newToday>0&&t.push({id:"new-customers-growth",type:"positive",title:"New Customer Acquisition",description:`Gained ${u.customers.newToday} new customers today. Customer base is growing!`,impact:"medium",category:"customers",actionable:!1,confidence:95});const o=u.devices.active+u.devices.completed+u.devices.pending,s=o>0?u.devices.completed/o*100:0;if(s<70&&t.push({id:"device-completion-low",type:"warning",title:"Device Completion Rate Low",description:`Only ${s.toFixed(1)}% of devices are completed. Consider optimizing repair processes.`,impact:"medium",category:"operations",actionable:!0,confidence:85}),u.devices.overdue>0&&t.push({id:"overdue-devices-alert",type:"alert",title:"Overdue Devices",description:`${u.devices.overdue} devices are past their expected completion date.`,impact:"high",category:"operations",actionable:!0,confidence:100}),u.employees.present>0&&u.employees.total>0){const n=u.employees.present/u.employees.total*100;n<80&&t.push({id:"low-attendance-warning",type:"warning",title:"Low Employee Attendance",description:`Only ${n.toFixed(1)}% of employees are present today.`,impact:"medium",category:"operations",actionable:!0,confidence:90})}const r=new Date().getHours();return r>=9&&r<=11&&u.sales.today<1e5&&t.push({id:"morning-sales-slow",type:"opportunity",title:"Morning Sales Below Target",description:"Sales are slower than usual this morning. Consider running promotions to boost activity.",impact:"medium",category:"sales",actionable:!0,confidence:75}),r>=12&&r<=14&&t.push({id:"lunch-rush-preparation",type:"opportunity",title:"Lunch Rush Preparation",description:"Peak lunch hours approaching. Ensure adequate staffing and inventory for busy period.",impact:"medium",category:"operations",actionable:!0,confidence:80}),t.sort((n,d)=>{if(n.impact!==d.impact){const l={high:3,medium:2,low:1};return l[d.impact]-l[n.impact]}return d.confidence-n.confidence})},[u,a]);c.useEffect(()=>{T(!0);const t=setTimeout(()=>{_(C),T(!1)},1e3);return()=>clearTimeout(t)},[C]);const v=t=>{switch(t){case"positive":return e.jsx(ee,{className:"w-5 h-5 text-green-500"});case"warning":return e.jsx(be,{className:"w-5 h-5 text-yellow-500"});case"opportunity":return e.jsx(Lt,{className:"w-5 h-5 text-blue-500"});case"alert":return e.jsx(be,{className:"w-5 h-5 text-red-500"});default:return e.jsx(ke,{className:"w-5 h-5 text-gray-500"})}},p=t=>{switch(t){case"positive":return"border-l-green-500 bg-green-50";case"warning":return"border-l-yellow-500 bg-yellow-50";case"opportunity":return"border-l-blue-500 bg-blue-50";case"alert":return"border-l-red-500 bg-red-50";default:return"border-l-gray-500 bg-gray-50"}},j=t=>{const o={high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-green-100 text-green-800"};return e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${o[t]}`,children:t.toUpperCase()})};return e.jsxs(lt,{className:`p-6 ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(et,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Insights"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Smart analysis & recommendations"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[N&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-purple-500 border-t-transparent"}),e.jsx("span",{children:"Analyzing..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"w-4 h-4 text-purple-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[b.length," insights"]})]})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:b.length===0&&!N?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(et,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No insights available at the moment."}),e.jsx("p",{className:"text-sm text-gray-400",children:"Insights will appear as data becomes available."})]}):b.slice(0,10).map(t=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${p(t.type)} transition-all hover:shadow-md`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[v(t.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.title}),j(t.impact)]}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Re,{className:"w-3 h-3"}),e.jsx("span",{children:t.category})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.confidence,"% confidence"]})]}),t.actionable&&e.jsx("span",{className:"text-blue-600 font-medium",children:"Actionable"})]})]})]})})},t.id))}),b.length>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("button",{className:"text-sm text-purple-600 hover:text-purple-800 font-medium",children:["View all ",b.length," insights"]})})]})},Ws=({className:f})=>{const u=K(),{metrics:a}=Oe(),[b,_]=c.useState([]),[N,T]=c.useState([]),[C,v]=c.useState(!0),p=c.useMemo(()=>{const l=[],D=Number(a.sales.today)||0,m=D*1.05,i=D>0?(m-D)/D*100:5;l.push({metric:"Daily Sales",current:D,predicted:m,change:i,trend:i>0?"up":i<0?"down":"stable",confidence:75});const y=(Number(a.customers.newToday)||0)*30,x=y*1.08,h=y>0?(x-y)/y*100:8;l.push({metric:"Monthly New Customers",current:y,predicted:x,change:h,trend:h>0?"up":h<0?"down":"stable",confidence:70});const g=Number(a.inventory.totalValue)||0,k=D*30,S=k>0?g/k:0,M=6,w=S>0?(M-S)/S*100:100;l.push({metric:"Inventory Turnover",current:S,predicted:M,change:w,trend:S<M?"up":"stable",confidence:80});const I=(Number(a.devices.active)||0)+(Number(a.devices.completed)||0)+(Number(a.devices.pending)||0),$=I>0?(Number(a.devices.completed)||0)/I*100:0,L=85,W=$>0?(L-$)/$*100:100;return l.push({metric:"Device Completion Rate",current:$,predicted:L,change:W,trend:$<L?"up":"stable",confidence:85}),l},[a]),j=c.useMemo(()=>{const l=[],D=Number(a.sales.today)||0,m=Number(a.customers.newToday)||0;for(let i=0;i<7;i++){const y=new Date;y.setDate(y.getDate()+i);const x=y.getDay();let h=1,g=1;(x===0||x===6)&&(h=1.2,g=1.1),(x===3||x===4)&&(h=.9,g=.95),l.push({period:y.toLocaleDateString("en-US",{weekday:"short"}),sales:Math.round(D*h),customers:Math.round(m*g),confidence:Math.max(60,90-i*5)})}return l},[a]);c.useEffect(()=>{v(!0);const l=setTimeout(()=>{_(j),T(p),v(!1)},1500);return()=>clearTimeout(l)},[j,p]);const t=l=>{switch(l){case"up":return e.jsx(ee,{className:"w-4 h-4 text-emerald-600"});case"down":return e.jsx(Pe,{className:"w-4 h-4 text-rose-600"});default:return e.jsx(ke,{className:"w-4 h-4 text-gray-500"})}},o=l=>l>=80?"text-emerald-600 bg-emerald-50":l>=60?"text-amber-600 bg-amber-50":"text-rose-600 bg-rose-50",s=l=>{if(isNaN(l)||!isFinite(l)||l<0)return"TSh 0";const D=Number(l);return D>=1e6?`TSh ${(D/1e6).toFixed(1)}M`:D>=1e3?`TSh ${(D/1e3).toFixed(0)}K`:`TSh ${D.toFixed(0)}`},r=l=>isNaN(l)||!isFinite(l)?"+0.0%":`${l>=0?"+":""}${Number(l).toFixed(1)}%`,d=(()=>N.find(l=>l.metric==="Daily Sales"))();return C&&N.length===0?e.jsx("div",{className:`bg-white rounded-2xl p-7 ${f}`,children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):e.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx(Et,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Predictive Analytics"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"AI-powered forecasts & insights"})]})]}),e.jsxs("button",{onClick:()=>u("/reports"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Reports",children:[e.jsx(q,{size:14}),e.jsx("span",{children:"View All"})]})]}),d&&e.jsx("div",{className:"mb-8 p-6 rounded-xl bg-gradient-to-br from-emerald-50 to-blue-50 border border-emerald-100",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2 font-medium",children:"Next 30 Days Forecast"}),e.jsxs("div",{className:"flex items-baseline gap-3 mb-2",children:[e.jsx("span",{className:"text-4xl font-bold text-gray-900",children:s(d.predicted*30)}),(isNaN(d.change)||!isFinite(d.change)?0:d.change)!==0&&e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1.5 rounded-full text-sm font-semibold ${(isNaN(d.change)||!isFinite(d.change)?0:d.change)>=0?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}`,children:[e.jsx(ee,{size:14,className:(isNaN(d.change)||!isFinite(d.change)?0:d.change)<0?"rotate-180":""}),e.jsx("span",{children:r(d.change)})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Based on current daily average of ",s(d.current)]})]}),e.jsxs("div",{className:"flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2 font-medium",children:"Current Performance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/60 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Today's Sales"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:s(d.current)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/60 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Projected Daily"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:s(d.predicted)})]})]})]}),e.jsxs("div",{className:`px-3 py-2 rounded-lg text-sm font-semibold text-center ${o(d.confidence)}`,children:[d.confidence,"% confidence"]})]})]})}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-8",children:N.filter(l=>l.metric!=="Daily Sales").slice(0,3).map((l,D)=>{const m=l.metric.includes("Customers"),i=l.metric.includes("Inventory"),y=l.metric.includes("Rate"),h=(()=>m?{bg:"bg-gradient-to-br from-blue-50 to-indigo-50",border:"border-blue-200",iconBg:"bg-blue-100",iconColor:"text-blue-600",valueColor:"text-blue-700",hover:"hover:from-blue-100 hover:to-indigo-100"}:i?{bg:"bg-gradient-to-br from-amber-50 to-orange-50",border:"border-amber-200",iconBg:"bg-amber-100",iconColor:"text-amber-600",valueColor:"text-amber-700",hover:"hover:from-amber-100 hover:to-orange-100"}:y?{bg:"bg-gradient-to-br from-purple-50 to-pink-50",border:"border-purple-200",iconBg:"bg-purple-100",iconColor:"text-purple-600",valueColor:"text-purple-700",hover:"hover:from-purple-100 hover:to-pink-100"}:{bg:"bg-gradient-to-br from-gray-50 to-slate-50",border:"border-gray-200",iconBg:"bg-gray-100",iconColor:"text-gray-600",valueColor:"text-gray-700",hover:"hover:from-gray-100 hover:to-slate-100"})(),g=i?`${(isNaN(l.current)||!isFinite(l.current)?0:Number(l.current)).toFixed(1)}x`:y?`${(isNaN(l.current)||!isFinite(l.current)?0:Number(l.current)).toFixed(1)}%`:(isNaN(l.current)||!isFinite(l.current)?0:Number(l.current)).toFixed(0),k=i?`${(isNaN(l.predicted)||!isFinite(l.predicted)?0:Number(l.predicted)).toFixed(1)}x`:y?`${(isNaN(l.predicted)||!isFinite(l.predicted)?0:Number(l.predicted)).toFixed(1)}%`:(isNaN(l.predicted)||!isFinite(l.predicted)?0:Number(l.predicted)).toFixed(0);return e.jsxs("div",{className:`p-5 rounded-xl border ${h.bg} ${h.border} ${h.hover} transition-all duration-200 shadow-sm hover:shadow-md`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${h.iconBg} flex items-center justify-center`,children:t(l.trend)}),e.jsxs("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${o(l.confidence)}`,children:[l.confidence,"%"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1 font-medium",children:l.metric}),e.jsx("p",{className:`text-2xl font-bold ${h.valueColor}`,children:g})]}),e.jsxs("div",{className:"pt-3 border-t border-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Target"}),e.jsx("span",{className:`text-sm font-semibold ${h.valueColor}`,children:k})]}),(isNaN(l.change)||!isFinite(l.change)?0:l.change)!==0&&e.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[e.jsx(ee,{size:12,className:`${(isNaN(l.change)||!isFinite(l.change)?0:l.change)>=0?"text-emerald-600":"text-rose-600"} ${(isNaN(l.change)||!isFinite(l.change)?0:l.change)<0?"rotate-180":""}`}),e.jsx("span",{className:`text-xs font-medium ${(isNaN(l.change)||!isFinite(l.change)?0:l.change)>=0?"text-emerald-600":"text-rose-600"}`,children:r(l.change)})]})]})]},D)})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-sm text-gray-700 font-semibold",children:"7-Day Sales Forecast"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[b.length," days ahead"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:b.map((l,D)=>{const m=Math.max(...b.map(h=>h.sales)),i=m>0?l.sales/m*100:0,y=l.period==="Sat"||l.period==="Sun",x=D===0;return e.jsxs("div",{className:`p-4 rounded-xl border transition-all duration-200 shadow-sm hover:shadow-md ${x?"bg-gradient-to-br from-emerald-50 to-blue-50 border-emerald-200 ring-2 ring-emerald-100":y?"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200 hover:from-blue-100 hover:to-indigo-100":"bg-gradient-to-br from-gray-50 to-slate-50 border-gray-200 hover:from-gray-100 hover:to-slate-100"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${x?"bg-emerald-100":y?"bg-blue-100":"bg-gray-100"}`,children:e.jsx(je,{size:16,className:x?"text-emerald-600":y?"text-blue-600":"text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:`font-semibold text-sm ${x?"text-emerald-900":"text-gray-900"}`,children:[l.period,x&&e.jsx("span",{className:"ml-2 text-xs text-emerald-600",children:"Today"})]}),e.jsx("p",{className:`text-xs mt-0.5 ${x?"text-emerald-700":"text-gray-500"}`,children:s(l.sales)})]})]}),e.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-semibold ${o(l.confidence)}`,children:[l.confidence,"%"]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"h-3 bg-white/60 rounded-full overflow-hidden shadow-inner",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${x?"bg-gradient-to-r from-emerald-500 to-emerald-600":"bg-gradient-to-r from-blue-500 to-purple-500"}`,style:{width:`${i}%`}})})}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{size:12,className:"text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["+",l.customers," customers"]})]}),e.jsxs("span",{className:"text-xs text-gray-500 font-medium",children:[i.toFixed(0),"% of peak"]})]})]},D)})})]}),e.jsx("div",{className:"p-5 rounded-lg bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-100",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx(Re,{size:18,className:"text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:"AI Insight"}),e.jsxs("p",{className:"text-xs text-gray-600 leading-relaxed",children:["Sales projected to grow by ",(()=>{const l=d==null?void 0:d.change;return isNaN(l)||!isFinite(l)?"5.0":Number(l).toFixed(1)})(),"% next period."]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2 font-medium",children:"Recommendations"}),e.jsxs("ul",{className:"space-y-1.5",children:[e.jsxs("li",{className:"text-xs text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Optimize inventory levels for peak demand periods"})]}),e.jsxs("li",{className:"text-xs text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Consider increasing stock for high-performing products"})]}),e.jsxs("li",{className:"text-xs text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Plan marketing campaigns around forecasted high-sales days"})]})]})]})]})})]})},Vs=({className:f})=>{const{metrics:u,updates:a}=Oe(),[b,_]=c.useState([]),[N,T]=c.useState(!0);c.useState(!0);const[C,v]=c.useState("all"),p=c.useMemo(()=>{const m=[];u.inventory.criticalStock>0&&m.push({id:"critical-stock",type:"critical",title:"Critical Stock Alert",message:`${u.inventory.criticalStock} items are critically low or out of stock. Immediate action required.`,timestamp:new Date,acknowledged:!1,category:"inventory",priority:"high",actionable:!0,actionLabel:"Restock Now",onAction:()=>console.log("Navigate to inventory management")}),u.inventory.lowStock>5&&m.push({id:"low-stock-warning",type:"warning",title:"Low Stock Warning",message:`${u.inventory.lowStock} items are running low. Consider restocking soon.`,timestamp:new Date,acknowledged:!1,autoExpire:!0,expireTime:60,category:"inventory",priority:"medium",actionable:!0,actionLabel:"View Inventory"}),u.sales.today<5e4&&new Date().getHours()>=14&&m.push({id:"low-sales-performance",type:"warning",title:"Low Sales Performance",message:`Daily sales target not met. Only TZS ${u.sales.today.toLocaleString()} achieved today.`,timestamp:new Date,acknowledged:!1,category:"sales",priority:"medium",actionable:!0,actionLabel:"View Promotions"}),u.devices.overdue>0&&m.push({id:"overdue-devices",type:"critical",title:"Overdue Devices",message:`${u.devices.overdue} devices are past their expected completion date.`,timestamp:new Date,acknowledged:!1,category:"operations",priority:"high",actionable:!0,actionLabel:"View Overdue"}),u.devices.completed>10&&m.push({id:"high-completion-rate",type:"success",title:"Excellent Performance!",message:`${u.devices.completed} devices completed today. Great job!`,timestamp:new Date,acknowledged:!1,autoExpire:!0,expireTime:30,category:"operations",priority:"low",actionable:!1}),u.customers.newToday>=5&&m.push({id:"customer-milestone",type:"success",title:"Customer Acquisition Milestone",message:`Acquired ${u.customers.newToday} new customers today!`,timestamp:new Date,acknowledged:!1,autoExpire:!0,expireTime:15,category:"customers",priority:"low",actionable:!1}),u.employees.present<u.employees.total*.8&&m.push({id:"low-attendance",type:"warning",title:"Low Employee Attendance",message:`Only ${u.employees.present} out of ${u.employees.total} employees present today.`,timestamp:new Date,acknowledged:!1,category:"operations",priority:"medium",actionable:!0,actionLabel:"View Attendance"});const i=[{id:"backup-due",type:"info",title:"Backup Due",message:"Daily backup is due. Consider running a backup now.",timestamp:new Date,acknowledged:!1,category:"system",priority:"low",actionable:!1,autoExpire:!0,expireTime:120},{id:"software-update",type:"info",title:"Software Update Available",message:"A new version of the POS system is available.",timestamp:new Date,acknowledged:!1,category:"system",priority:"low",actionable:!0,actionLabel:"Update Now"}];return Math.random()>.7&&m.push(...i),m},[u]);c.useEffect(()=>{_(m=>{const i=[...p],y=new Date,h=[...m.filter(g=>{if(g.autoExpire&&g.expireTime){const k=new Date(g.timestamp.getTime()+g.expireTime*6e4);return y<k}return!0})];return i.forEach(g=>{const k=h.findIndex(S=>S.id===g.id);k===-1?h.unshift(g):h[k]={...g,acknowledged:h[k].acknowledged}}),h.slice(0,20)})},[p]),c.useEffect(()=>{b.filter(i=>i.type==="critical"&&!i.acknowledged).length>0&&N&&console.log("ðŸš¨ Critical alert sound would play here")},[b,N]);const j=m=>{_(i=>i.map(y=>y.id===m?{...y,acknowledged:!0}:y))},t=m=>{_(i=>i.filter(y=>y.id!==m))},o=m=>{m.onAction&&m.onAction(),j(m.id)},s=b.filter(m=>C==="all"?!0:m.type===C),r=m=>{switch(m){case"critical":return e.jsx(tt,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(be,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(fe,{className:"w-5 h-5 text-blue-500"});case"success":return e.jsx(ue,{className:"w-5 h-5 text-green-500"});default:return e.jsx(fe,{className:"w-5 h-5 text-gray-500"})}},n=m=>{switch(m){case"critical":return"border-l-red-500 bg-red-50";case"warning":return"border-l-yellow-500 bg-yellow-50";case"info":return"border-l-blue-500 bg-blue-50";case"success":return"border-l-green-500 bg-green-50";default:return"border-l-gray-500 bg-gray-50"}},d=m=>{const i={high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-green-100 text-green-800"};return e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${i[m]}`,children:m.toUpperCase()})},l=m=>{if(!m)return"Unknown";const y=new Date().getTime()-m.getTime(),x=Math.floor(y/6e4),h=Math.floor(x/60);return x<1?"Just now":x<60?`${x}m ago`:h<24?`${h}h ago`:m.toLocaleDateString()},D=b.filter(m=>!m.acknowledged).length;return e.jsxs(lt,{className:`p-6 ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"p-2 bg-red-100 rounded-lg relative",children:[e.jsx(fe,{className:"w-6 h-6 text-red-600"}),D>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:D>9?"9+":D})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Alert System"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time notifications & alerts"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>T(!N),className:`p-2 rounded-lg transition-colors ${N?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"}`,title:N?"Disable sound alerts":"Enable sound alerts",children:N?e.jsx(Rt,{className:"w-4 h-4"}):e.jsx(Ft,{className:"w-4 h-4"})}),e.jsxs("select",{value:C,onChange:m=>v(m.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-blue-400",children:[e.jsx("option",{value:"all",children:"All Alerts"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"warning",children:"Warnings"}),e.jsx("option",{value:"info",children:"Info"})]})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-4 text-green-400"}),e.jsx("p",{className:"text-gray-500",children:"All clear! No active alerts."}),e.jsx("p",{className:"text-sm text-gray-400",children:"Alerts will appear here as issues arise."})]}):s.map(m=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${n(m.type)} ${m.acknowledged?"":"ring-1 ring-opacity-50"} ${m.type==="critical"?"ring-red-200":""} transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[r(m.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:`font-medium ${m.acknowledged?"":"font-bold"}`,children:m.title}),d(m.priority),!m.acknowledged&&e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:m.message}),e.jsxs("div",{className:"flex items-center space-x-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{children:l(m.timestamp)})]}),e.jsx("span",{className:"capitalize",children:m.category}),m.autoExpire&&m.expireTime&&e.jsxs("span",{className:"text-orange-600",children:["Expires in ",m.expireTime,"m"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 ml-4",children:[m.actionable&&m.actionLabel&&e.jsx("button",{onClick:()=>o(m),className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",children:m.actionLabel}),!m.acknowledged&&e.jsx("button",{onClick:()=>j(m.id),className:"p-1 text-gray-400 hover:text-green-600 transition-colors",title:"Acknowledge",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>t(m.id),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Dismiss",children:e.jsx(tt,{className:"w-4 h-4"})})]})]})},m.id))}),b.length>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("button",{className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["View all ",b.length," alerts"]})})]})},qs=()=>{var W,V;const{currentUser:f}=Q(),u=K(),{metrics:a,isConnected:b,lastUpdate:_,updates:N,refresh:T}=Oe(),{isQuickActionEnabled:C,isWidgetEnabled:v,getWidgetSize:p,getWidgetRowSpanClass:j,loading:t}=St(),{autoArrangeWidgets:o}=kt(),{dateRange:s,setDateRange:r,getDateRangeForQuery:n}=Ze(),{dashboardBranchId:d,setDashboardBranchId:l}=es(),{handleError:D,withErrorHandling:m}=wt({maxRetries:3,showToast:!0,logToConsole:!0}),[i,y]=c.useState(!0),[x,h]=c.useState(null),[g,k]=c.useState([]),S=c.useRef([]),M=()=>{try{const E=localStorage.getItem("dashboard_widget_order");if(E){const F=JSON.parse(E).filter(A=>v(A));k(F),S.current=F,console.log("ðŸ“‚ Loaded saved widget order:",F)}else{const F=["revenueTrendChart","deviceStatusChart","appointmentsTrendChart","purchaseOrderChart","paymentMethodsChart","analyticsWidget","salesByCategoryChart","profitMarginChart","stockLevelChart","performanceMetricsChart","customerActivityChart","appointmentWidget","employeeWidget","notificationWidget","financialWidget","salesFunnelChart","customerInsightsWidget","serviceWidget","reminderWidget","systemHealthWidget","inventoryWidget","activityFeedWidget","purchaseOrderWidget","chatWidget","salesWidget","topProductsWidget","expensesWidget","staffPerformanceWidget","tradeInWidget","installmentsWidget","loyaltyWidget","smsWidget","sparePartsWidget","storageRoomsWidget","stockTransfersWidget","specialOrdersWidget","backupWidget","repairWidget","aiInsightsWidget","predictiveAnalyticsWidget","alertSystemWidget"].filter(A=>v(A));k(F),S.current=F,console.log("ðŸ“‚ Using default widget order (no saved order found)")}}catch(E){console.error("Error loading widget order:",E)}};c.useEffect(()=>{M()},[]),c.useEffect(()=>{const E=F=>{F.key==="dashboard_widget_order"&&(console.log("ðŸ”„ Widget order changed in storage, reloading..."),M())},O=()=>{console.log("ðŸ”„ Widget order updated, reloading..."),M()};return window.addEventListener("storage",E),window.addEventListener("widgetOrderUpdated",O),()=>{window.removeEventListener("storage",E),window.removeEventListener("widgetOrderUpdated",O)}},[]),c.useEffect(()=>{console.log("ðŸ”„ Widget order state:",g)},[g]),c.useEffect(()=>{(async()=>{await m(async()=>{if(y(!0),f!=null&&f.id){const O=n(),F=localStorage.getItem("current_branch_id");d!==null?localStorage.setItem("current_branch_id",d):localStorage.removeItem("current_branch_id");const A=await ae.getDashboardStats(f.id,O.startDate,O.endDate);F?localStorage.setItem("current_branch_id",F):localStorage.removeItem("current_branch_id"),h(A)}y(!1)},"Loading dashboard data")})()},[f==null?void 0:f.id,m,s,d]),c.useEffect(()=>{const E=setInterval(()=>{if(f!=null&&f.id&&!i){const O=n(),F=localStorage.getItem("current_branch_id");d!==null?localStorage.setItem("current_branch_id",d):localStorage.removeItem("current_branch_id"),ae.getDashboardStats(f.id,O.startDate,O.endDate).then(A=>{h(A),F?localStorage.setItem("current_branch_id",F):localStorage.removeItem("current_branch_id")})}},3e5);return()=>clearInterval(E)},[f==null?void 0:f.id,i,s,d,n]);const w=E=>{console.log("ðŸ“Š Dashboard branch changed to:",E||"All Branches"),l(E)},I=E=>{try{u(E)}catch(O){D(O,"Navigation")}},L=[{id:"devices",title:"Devices",description:"Manage devices",icon:_e,color:"from-indigo-500 to-indigo-600",path:"/devices"},{id:"addDevice",title:"Add Device",description:"New device",icon:H,color:"from-blue-500 to-blue-600",path:"/devices/new"},{id:"customers",title:"Customers",description:"Customer data",icon:ie,color:"from-green-500 to-green-600",path:"/customers"},{id:"inventory",title:"Inventory",description:"Stock & parts",icon:ne,color:"from-purple-500 to-purple-600",path:"/lats/unified-inventory"},{id:"purchaseOrder",title:"Purchase Order",description:"Create PO (âŒ˜â‡§O)",icon:mt,color:"from-orange-500 to-amber-600",path:"/lats/purchase-order/create"},{id:"appointments",title:"Appointments",description:"Scheduling",icon:je,color:"from-pink-500 to-pink-500",path:"/appointments"},{id:"purchaseOrders",title:"Purchase Orders",description:"Manage orders",icon:ne,color:"from-orange-500 to-orange-600",path:"/lats/purchase-orders"},{id:"createPO",title:"Create PO",description:"New purchase order",icon:H,color:"from-orange-500 to-orange-600",path:"/lats/purchase-order/create"},{id:"payments",title:"Payments",description:"Payment management",icon:Se,color:"from-emerald-500 to-emerald-600",path:"/payments"},{id:"adGenerator",title:"Ad Generator",description:"Create product ads",icon:Ot,color:"from-rose-500 to-rose-600",path:"/ad-generator"},{id:"pos",title:"POS System",description:"Point of sale",icon:Se,color:"from-cyan-500 to-cyan-600",path:"/pos"},{id:"reports",title:"Sales Reports",description:"View sales reports",icon:ke,color:"from-violet-500 to-violet-600",path:"/lats/sales-reports"},{id:"employees",title:"Employees",description:"Manage staff",icon:ie,color:"from-teal-500 to-teal-600",path:"/employees"},{id:"settings",title:"Settings",description:"System settings",icon:Be,color:"from-gray-500 to-gray-600",path:"/admin-settings"},{id:"search",title:"Search",description:"Global search",icon:zt,color:"from-amber-500 to-amber-600",path:"/search"},{id:"loyalty",title:"Loyalty Program",description:"Customer loyalty",icon:Je,color:"from-yellow-500 to-yellow-600",path:"/lats/loyalty"},{id:"backup",title:"Backup",description:"Data backup",icon:Ue,color:"from-slate-500 to-slate-600",path:"/admin-settings?section=database"},{id:"sms",title:"SMS Center",description:"SMS management",icon:Ie,color:"from-blue-500 to-blue-600",path:"/sms"},{id:"bulkSms",title:"Bulk SMS",description:"Mass messaging",icon:Ie,color:"from-indigo-500 to-indigo-600",path:"/sms/bulk"},{id:"smsLogs",title:"SMS Logs",description:"Message history",icon:Ie,color:"from-purple-500 to-purple-600",path:"/sms/logs"},{id:"smsSettings",title:"SMS Settings",description:"SMS configuration",icon:Be,color:"from-gray-500 to-gray-600",path:"/sms/settings"},{id:"excelImport",title:"Excel Import",description:"Data import",icon:st,color:"from-emerald-500 to-emerald-600",path:"/excel-import"},{id:"excelTemplates",title:"Excel Templates",description:"Template downloads",icon:Ge,color:"from-cyan-500 to-cyan-600",path:"/excel-templates"},{id:"productExport",title:"Product Export",description:"Export products",icon:Ge,color:"from-pink-500 to-pink-600",path:"/product-export"},{id:"customerImport",title:"Customer Import",description:"Import customers",icon:st,color:"from-rose-500 to-rose-600",path:"/customers/import"},{id:"userManagement",title:"User Management",description:"User administration",icon:Bt,color:"from-indigo-500 to-indigo-600",path:"/users"},{id:"databaseSetup",title:"Database Setup",description:"Database configuration",icon:We,color:"from-slate-500 to-slate-600",path:"/admin-settings?section=database"},{id:"integrationSettings",title:"Integration Settings",description:"System integrations",icon:Be,color:"from-gray-500 to-gray-600",path:"/integration-settings"},{id:"integrationsTest",title:"Integrations Test",description:"Test integrations",icon:Re,color:"from-orange-500 to-orange-600",path:"/integrations-test"},{id:"aiTraining",title:"AI Training",description:"AI training system",icon:Wt,color:"from-purple-500 to-purple-600",path:"/ai-training"},{id:"bluetoothPrinter",title:"Bluetooth Printer",description:"Printer management",icon:Vt,color:"from-blue-500 to-blue-600",path:"/bluetooth-printer"},{id:"categoryManagement",title:"Category Management",description:"Product categories",icon:Qe,color:"from-green-500 to-green-600",path:"/category-management"},{id:"supplierManagement",title:"Supplier Management",description:"Supplier management",icon:Ke,color:"from-indigo-500 to-indigo-600",path:"/supplier-management"},{id:"storeLocations",title:"Store Locations",description:"Location management",icon:dt,color:"from-red-500 to-red-600",path:"/store-locations"},{id:"reminders",title:"Reminders",description:"Reminder system",icon:X,color:"from-yellow-500 to-yellow-600",path:"/reminders"},{id:"mobile",title:"Mobile",description:"Mobile features",icon:_e,color:"from-cyan-500 to-cyan-600",path:"/mobile"},{id:"myAttendance",title:"My Attendance",description:"Personal attendance",icon:X,color:"from-blue-500 to-blue-600",path:"/my-attendance"}].filter(E=>C(E.id));return e.jsx(Nt,{pageName:"Dashboard",showDetails:!0,children:e.jsx("div",{className:"p-4 sm:p-6 h-full overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:Ct((f==null?void 0:f.role)||"user")}),e.jsx("p",{className:"text-gray-600 mt-1",children:_t((f==null?void 0:f.role)||"user",(f==null?void 0:f.name)||(f==null?void 0:f.email))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(((W=f==null?void 0:f.permissions)==null?void 0:W.includes("all"))||((V=f==null?void 0:f.permissions)==null?void 0:V.includes("manage_users"))||(f==null?void 0:f.role)==="admin")&&e.jsx(Yt,{onBranchChange:w,defaultToCurrent:!0}),e.jsx(Jt,{value:s,onChange:r}),e.jsxs("button",{onClick:()=>I("/devices/new"),className:"flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(H,{size:18}),"Add Device"]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${b?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-xs text-gray-600",children:b?"Live":"Offline"}),_&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:new Date(_).toLocaleTimeString()})]}),e.jsxs("button",{onClick:T,disabled:i,className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors text-sm disabled:opacity-50",children:[e.jsx(Ye,{size:18,className:i?"animate-spin":""}),"Refresh"]})]})]}),!i&&!t&&L.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Quick Actions"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Access frequently used features"})]})]}),e.jsx("div",{className:"quick-actions flex flex-wrap gap-4 md:flex-row md:gap-8 flex-col gap-2 w-full",children:L.map((E,O)=>{const F=E.icon;return e.jsxs("button",{onClick:()=>I(E.path),className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors text-center group w-full md:flex-1 md:min-w-[150px]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-900 flex items-center justify-center mx-auto mb-3",children:e.jsx(F,{className:"w-5 h-5 text-white"})}),e.jsx("h4",{className:"font-medium text-sm text-gray-900 mb-1",children:E.title}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:E.description})]},O)})})]}),i&&e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#3498db]"}),e.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading dashboard..."})]}),!i&&!t&&x&&(()=>{const E={revenueTrendChart:Ms,deviceStatusChart:Is,appointmentsTrendChart:$s,purchaseOrderChart:Rs,paymentMethodsChart:Fs,analyticsWidget:ls,salesByCategoryChart:Os,profitMarginChart:zs,stockLevelChart:As,performanceMetricsChart:Ls,customerActivityChart:Ps},F=(S.current.length>0?S.current:g).filter(z=>v(z)&&E[z]);if(console.log("ðŸ“Š Rendering charts in custom order:",F),F.length===0)return null;const A=o(F);return e.jsx("div",{className:"dashboard-cards grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 auto-rows-auto gap-4 md:gap-6 w-full",style:{alignItems:"stretch",gridAutoRows:"minmax(400px, auto)"},children:A.widgets.map(z=>{const{key:B,expanded:R,gridColumn:G}=z,U="repositioned"in z?z.repositioned:!1,se=E[B];if(!se)return null;p(B);const me=j(B),le=()=>{const xe=parseInt(G.split(" ")[1]);let re="";return xe===3?re="md:col-span-2 lg:col-span-3":xe===2?re="md:col-span-2 lg:col-span-2":re="md:col-span-1",me?`${re} ${me}`:re};return e.jsxs("div",{style:{height:"100%",transition:"all 0.3s ease",...R&&{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",borderRadius:"12px"},...U&&{background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",borderRadius:"12px"}},className:`dashboard-card ${le()} relative ${R||U?"shadow-lg":""}`,children:[e.jsx(se,{className:"h-full"}),R&&e.jsx("div",{className:"absolute top-2 right-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full z-10",children:"Auto-Expanded"}),U&&!R&&e.jsx("div",{className:"absolute top-2 right-2 bg-amber-500 text-white text-xs px-2 py-1 rounded-full z-10",children:"Moved to Fill Gap"})]},B)})})})(),!i&&!t&&x&&(()=>{const E={appointmentWidget:as,employeeWidget:ss,notificationWidget:ts,financialWidget:ns,salesFunnelChart:Es,customerInsightsWidget:ms,serviceWidget:is,reminderWidget:os,salesWidget:us,topProductsWidget:hs,expensesWidget:ps,purchaseOrderWidget:xs,chatWidget:gs,staffPerformanceWidget:fs,systemHealthWidget:cs,inventoryWidget:rs,activityFeedWidget:ds,tradeInWidget:vs,installmentsWidget:Ns,loyaltyWidget:ys,smsWidget:ws,sparePartsWidget:Ss,storageRoomsWidget:ks,stockTransfersWidget:Cs,specialOrdersWidget:_s,backupWidget:Ds,repairWidget:Ts,aiInsightsWidget:Bs,predictiveAnalyticsWidget:Ws,alertSystemWidget:Vs},F=(S.current.length>0?S.current:g).filter(z=>v(z)&&E[z]);if(console.log("ðŸŽ¯ Rendering widgets in custom order:",F),F.length===0)return null;const A=o(F);return e.jsx("div",{className:"dashboard-cards grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 auto-rows-auto gap-4 md:gap-6 w-full",style:{alignItems:"stretch",gridAutoRows:"minmax(400px, auto)"},children:A.widgets.map(z=>{const{key:B,expanded:R,gridColumn:G}=z,U="repositioned"in z?z.repositioned:!1,se=E[B];if(!se)return null;p(B);const me=j(B),le=()=>{const xe=parseInt(G.split(" ")[1]);let re="";return xe===3?re="md:col-span-2 lg:col-span-3":xe===2?re="md:col-span-2 lg:col-span-2":re="md:col-span-1",me?`${re} ${me}`:re};return e.jsxs("div",{style:{height:"100%",transition:"all 0.3s ease",...R&&{background:"linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)",borderRadius:"12px"},...U&&{background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",borderRadius:"12px"}},className:`dashboard-card ${le()} relative ${R||U?"shadow-lg":""}`,children:[e.jsx(se,{className:"h-full"}),R&&e.jsx("div",{className:"absolute top-2 right-2 bg-cyan-500 text-white text-xs px-2 py-1 rounded-full z-10",children:"Auto-Expanded"}),U&&!R&&e.jsx("div",{className:"absolute top-2 right-2 bg-amber-500 text-white text-xs px-2 py-1 rounded-full z-10",children:"Moved to Fill Gap"})]},B)})})})()]})})})},ya=()=>e.jsx(Xt,{children:e.jsx(qs,{})});export{ya as default};
