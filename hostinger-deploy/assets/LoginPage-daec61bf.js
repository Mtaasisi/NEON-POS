import{u as M,a as R,j as e,I as z}from"./index-61458a34.js";import{r as o}from"./vendor-36d2c7c1.js";import{P as A}from"./PageErrorWrapper-b69ee385.js";import{u as D}from"./useErrorHandler-ecda4689.js";import{a as W}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";import"./ui-28e30067.js";import"./PageErrorBoundary-3d3e48b8.js";import"./ErrorState-8ed6c2f9.js";const K=()=>{const[l,b]=o.useState(()=>localStorage.getItem("recent_login_email")||""),[n,f]=o.useState(""),[i,y]=o.useState(!1),[m,N]=o.useState(()=>localStorage.getItem("rememberMe")==="true"),[I,w]=o.useState(!1),[L,v]=o.useState(!1),{login:P,error:S,clearError:E,isAuthenticated:d,loading:u}=M(),g=W(),{startLoading:C,completeLoading:k,failLoading:j}=R(),{handleError:p,withErrorHandling:h}=D({maxRetries:3,showToast:!0,logToConsole:!0}),x=o.useCallback(()=>{const t=localStorage.getItem("postLoginRedirect");if(t)return localStorage.removeItem("postLoginRedirect"),t;const s=localStorage.getItem("navigationHistory");if(s)try{const a=JSON.parse(s),r=a[a.length-1];if(r&&r!=="/login"&&r!=="/")return r;if(a.length>1){const c=a[a.length-2];if(c&&c!=="/login"&&c!=="/")return c}}catch(a){console.error("âŒ LoginPage: Error parsing navigation history:",a)}return"/dashboard"},[]);if(o.useEffect(()=>{(async()=>{await h(async()=>{if(localStorage.getItem("rememberMe")==="true"){const a=localStorage.getItem("last_login_email")||"",r=localStorage.getItem("last_login_password")||"";a&&b(a),r&&f(r)}},"Loading saved credentials")})()},[h]),o.useEffect(()=>{if(!u&&d){const t=x();g(t,{replace:!0})}},[d,u,g,x]),u)return e.jsx(z,{fullscreen:!0,transparent:!0,message:"Checking authentication..."});if(d)return null;const _=async t=>{if(t.preventDefault(),!l.trim()||!n.trim()){p(new Error("Please enter both email and password"),"Form validation");return}const s=C("Signing in...");await h(async()=>{if(y(!0),E(),await P(l,n)){localStorage.setItem("rememberMe",m.toString()),m?(localStorage.setItem("last_login_email",l),localStorage.setItem("last_login_password",n)):(localStorage.removeItem("last_login_email"),localStorage.removeItem("last_login_password")),k(s),localStorage.setItem("recent_login_email",l);const r=x();g(r)}else throw j(s,"Login failed"),new Error("Login failed. Please check your credentials.")},"Login process").catch(a=>{j(s,"Login failed")}).finally(()=>{y(!1)})},F=t=>{try{b(t.target.value)}catch(s){p(s,"Email input")}},H=t=>{try{f(t.target.value)}catch(s){p(s,"Password input")}};return e.jsx(A,{pageName:"Login",showDetails:!1,children:e.jsx("div",{className:"min-h-screen h-screen w-screen flex flex-col items-center justify-center px-6 py-8 bg-white safe-area-inset",style:{fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:e.jsxs("div",{className:"w-full max-w-sm mx-auto",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8 sm:mb-12",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mb-3",children:e.jsx("img",{src:"/logo.svg",alt:"Dukani Pro",className:"w-full h-full object-contain drop-shadow-lg"})}),e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900 tracking-tight",children:"Dukani Pro"})]}),e.jsxs("form",{onSubmit:_,className:"w-full space-y-3.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2 pl-1",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:l,onChange:F,onFocus:()=>w(!0),onBlur:()=>w(!1),className:`w-full px-4 py-3.5 sm:py-4 bg-gray-50 border rounded-2xl text-base text-gray-900 placeholder-gray-400 transition-all duration-200 ${I?"border-blue-500 bg-white shadow-sm":"border-gray-200"}`,style:{WebkitAppearance:"none",fontSize:"16px",lineHeight:"1.5",maxHeight:"52px"},placeholder:"your@email.com",required:!0,disabled:i,autoFocus:!0,autoComplete:"email",autoCapitalize:"none",autoCorrect:"off"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2 pl-1",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:n,onChange:H,onFocus:()=>v(!0),onBlur:()=>v(!1),className:`w-full px-4 py-3.5 sm:py-4 bg-gray-50 border rounded-2xl text-base text-gray-900 placeholder-gray-400 transition-all duration-200 ${L?"border-blue-500 bg-white shadow-sm":"border-gray-200"}`,style:{WebkitAppearance:"none",fontSize:"16px",lineHeight:"1.5",maxHeight:"52px"},placeholder:"Enter your password",required:!0,disabled:i,autoComplete:"current-password"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"rememberMe",type:"checkbox",checked:m,onChange:t=>N(t.target.checked),className:"h-4 w-4 text-blue-500 focus:ring-blue-500 border-gray-300 rounded",disabled:i}),e.jsx("label",{htmlFor:"rememberMe",className:"ml-3 block text-sm text-gray-700 font-medium cursor-pointer select-none",style:{fontSize:"15px"},children:"Remember me"})]})}),S&&e.jsx("div",{className:"px-4 py-3 bg-red-50 rounded-2xl",children:e.jsx("p",{className:"text-sm text-red-600",style:{fontSize:"15px"},children:S})}),e.jsx("button",{type:"submit",disabled:i,className:"w-full bg-blue-500 text-white py-3.5 sm:py-4 px-4 rounded-2xl font-semibold hover:bg-blue-600 active:bg-blue-700 focus:outline-none transition-all duration-150 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm mt-4",style:{fontSize:"16px",letterSpacing:"-0.3px",fontWeight:"600",minHeight:"52px"},children:i?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-3"}),"Signing in..."]}):"Sign In"}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{type:"button",className:"text-blue-500 hover:text-blue-600 active:text-blue-700 font-medium transition-colors",style:{fontSize:"15px"},onClick:()=>alert("Contact your administrator to reset your password"),children:"Forgot password?"})})]}),e.jsx("div",{className:"mt-6 sm:mt-8 pb-safe",children:e.jsx("p",{className:"text-center text-gray-500 text-xs leading-relaxed",children:"Complete business management solution"})})]})})})};export{K as default};
