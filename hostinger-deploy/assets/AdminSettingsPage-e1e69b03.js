import{S as xt,A as ya,j as e,e as $e,B as ja,C as va,G as ge,D as Na,F as qt,H as wa,x as _a,J as ka,s as Z,K as Sa,L as Ca,M as Ks,N as Aa,O as Ta,P as Ea,y as Pa,Q as Da,R as Ia,u as Lt}from"./index-61458a34.js";import{r,R as jt}from"./vendor-36d2c7c1.js";import{c as aa}from"./routing-eb8c310c.js";import{g as Ra,s as Ma}from"./attendanceSettingsApi-f03692b4.js";import{_ as Fa}from"./supabase-cf010ec4.js";import{e as xs,s as is,z as o,R as be,a8 as Ze,Y as Re,aO as Us,aQ as ra,aR as La,aS as Ba,aT as na,N as Ge,aj as _t,l as Js,G as We,d as ke,A as Fe,f as gs,S as nt,o as Qs,M as As,aE as ms,aU as $a,Z as la,aV as Gs,aW as ia,aX as Oa,aY as Wa,aZ as qa,ax as Bt,a_ as za,n as oe,al as ys,P as Ts,T as Hs,u as Ue,m as Ys,a2 as Es,a$ as Ua,q as fs,$ as qs,b0 as hs,av as js,X as Ns,aw as ls,b1 as vt,ag as es,y as ot,b2 as Le,b3 as Vs,p as ze,aB as oa,b4 as ca,b5 as da,b6 as Ga,b7 as ma,a3 as Ye,k as ws,r as lt,aL as Ha,aM as Va,_ as ua,aq as Pt,ae as Nt,b8 as zt,v as ps,C as $t,K as Ut,b9 as Gt,at as vs,c as xa,af as Cs,a as Be,b as De,ap as Ka,w as Ja,a4 as Ot,D as us,ba as Qa,aP as Ya,I as it,bb as Za,Q as Xe,bc as Xa,aA as wt,bd as gt,be as er,bf as ht,bg as Dt,bh as sr,aF as Wt,a0 as It,bi as Rt,aC as Mt,bj as tr,aG as ar,aI as rr,bk as nr,bl as ga,bm as Ht,a6 as lr,bn as ir,bo as Vt,bp as or,V as ft,bq as cr,br as dr,bs as Ws,O as ha,bt as ct,bu as mr,i as pa,bv as Kt,a9 as Jt,bw as ur,bx as xr,by as Qt,bz as Yt,bA as Ft,bB as gr,W as Zt,bC as hr,bD as yt,bE as pr}from"./ui-28e30067.js";import{G as rs}from"./GlassInput-0475021a.js";import{G as ns}from"./GlassSelect-e243562f.js";import{g as br,u as fr,r as yr,e as jr,i as vr}from"./inventorySettingsApi-fd100cf3.js";import{s as cs}from"./shippingApi-e95f9d8a.js";import{u as Nr}from"./useDialog-6eb5c329.js";import{u as wr,g as _r,a as kr,l as Xt,s as Sr}from"./useSmartGridLayout-0626d484.js";import{W as Cr}from"./WidgetOrderSettings-a59a0b3b.js";import{g as Ar,r as Tr,p as Er}from"./backupApi-b9211f47.js";import{fullDatabaseDownloadService as Os}from"./fullDatabaseDownloadService-81aa0524.js";import{offlineSaleSyncService as pt}from"./offlineSaleSyncService-93b9509e.js";import{autoSyncService as Ke}from"./autoSyncService-45729361.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";import"./customerCacheService-9b459c09.js";import"./childVariantsCacheService-9368f4c7.js";import"./saleProcessingService-f5a8fb75.js";function Pr(m){const w=[];return m.name||w.push("name is required"),m.code||w.push("code is required"),m.address||w.push("address is required"),m.city||w.push("city is required"),m.country||w.push("country is required"),m.data_isolation_mode!==void 0&&(xt.data_isolation_mode.check(m.data_isolation_mode)||w.push(`data_isolation_mode must be one of: ${xt.data_isolation_mode.allowedValues.join(", ")}`)),m.pricing_model!==void 0&&(xt.pricing_model.check(m.pricing_model)||w.push(`pricing_model must be one of: ${xt.pricing_model.allowedValues.join(", ")}`)),{valid:w.length===0,errors:w}}function ea(m){return{...ya,...m}}const ba=r.createContext(void 0),Ps=()=>{const m=r.useContext(ba);if(!m)throw new Error("useSettingsSave must be used within SettingsSaveProvider");return m},Dr=({children:m})=>{const[w,N]=r.useState(new Map),[P,t]=r.useState(!1),[p,i]=r.useState(!1),y=r.useCallback((_,$)=>{N(h=>{const B=new Map(h);return B.set(_,$),B})},[]),M=r.useCallback(_=>{N($=>{const h=new Map($);return h.delete(_),h})},[]),I=r.useCallback(async()=>{t(!0);try{const _=Array.from(w.values());await Promise.all(_.map($=>Promise.resolve($()))),i(!1)}catch(_){throw console.error("Error saving settings:",_),_}finally{t(!1)}},[w]);return e.jsx(ba.Provider,{value:{registerSaveHandler:y,unregisterSaveHandler:M,saveAll:I,isSaving:P,hasChanges:p,setHasChanges:i},children:m})};class zs{constructor(){this.isLoaded=!1,this.isLoading=!1,this.loadPromise=null,this.error=null}static getInstance(){return zs.instance||(zs.instance=new zs),zs.instance}async getApiKey(){var w;try{const{getIntegration:N}=await Fa(()=>import("./index-61458a34.js").then(p=>p.b9),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),P=await N("GOOGLE_MAPS");if(P&&P.is_enabled&&((w=P.credentials)!=null&&w.api_key))return console.log("âœ… Google Maps API key loaded from database"),P.credentials.api_key;const t={}.VITE_GOOGLE_MAPS_API_KEY;return t?(console.log("âœ… Google Maps API key loaded from environment"),t):null}catch(N){return console.warn("âš ï¸ Error fetching Google Maps credentials from database, using env variable:",N),{}.VITE_GOOGLE_MAPS_API_KEY||null}}async load(w={}){return this.isLoaded?Promise.resolve():this.isLoading&&this.loadPromise?this.loadPromise:window.google&&window.google.maps?(this.isLoaded=!0,console.log("âœ… Google Maps already loaded"),Promise.resolve()):(this.isLoading=!0,this.error=null,this.loadPromise=new Promise(async(N,P)=>{try{const t=w.apiKey||await this.getApiKey();if(!t||t==="YOUR_API_KEY"){const I="Google Maps API key not configured. Please set VITE_GOOGLE_MAPS_API_KEY environment variable.";console.error("âŒ",I),this.error=I,this.isLoading=!1,P(new Error(I));return}const p=w.libraries||["geometry","marker"],i=w.version||"weekly",y=document.createElement("script");y.src=`https://maps.googleapis.com/maps/api/js?key=${t}&libraries=${p.join(",")}&v=${i}&loading=async`,y.async=!0,y.defer=!0,y.onerror=I=>{clearTimeout(M);const _="Failed to load Google Maps API script";console.error("âŒ",_,I),this.error=_,this.isLoading=!1,P(new Error(_))};const M=setTimeout(()=>{const I="Google Maps API loading timed out";console.error("âŒ",I),this.error=I,this.isLoading=!1,P(new Error(I))},1e4);y.onload=()=>{clearTimeout(M);const I=()=>{var _,$,h,B;($=(_=window.google)==null?void 0:_.maps)!=null&&$.Map&&((B=(h=window.google)==null?void 0:h.maps)!=null&&B.marker)?(console.log("âœ… Google Maps API loaded successfully"),this.isLoaded=!0,this.isLoading=!1,N()):setTimeout(I,50)};I()},document.head.appendChild(y)}catch(t){console.error("âŒ Error setting up Google Maps script:",t),this.error=`Setup error: ${t}`,this.isLoading=!1,P(t)}}),this.loadPromise)}isReady(){var w,N,P,t;return this.isLoaded&&!!((N=(w=window.google)==null?void 0:w.maps)!=null&&N.Map&&((t=(P=window.google)==null?void 0:P.maps)!=null&&t.marker))}getError(){return this.error}async testAPI(){if(!this.isReady())return console.error("âŒ Google Maps API not ready for testing"),!1;try{const w=document.createElement("div");w.style.width="100px",w.style.height="100px",w.style.position="absolute",w.style.top="-9999px",document.body.appendChild(w);const N=new window.google.maps.Map(w,{center:{lat:0,lng:0},zoom:1});return document.body.removeChild(w),console.log("âœ… Google Maps API test successful"),!0}catch(w){return console.error("âŒ Google Maps API test failed:",w),!1}}getGoogleMaps(){if(!this.isReady())throw new Error("Google Maps API not ready");return window.google.maps}reset(){this.isLoaded=!1,this.isLoading=!1,this.loadPromise=null,this.error=null}}const bt=zs.getInstance(),Ir=({offices:m,selectedOffice:w,onOfficeSelect:N,showRadius:P=!0,className:t=""})=>{const[p,i]=r.useState(null),[y,M]=r.useState(null),[I,_]=r.useState([]),[$,h]=r.useState([]),[B,j]=r.useState(!1),[x,T]=r.useState(null);return r.useEffect(()=>{(async()=>{try{await bt.load(),j(!0)}catch(C){console.error("âŒ Failed to load Google Maps API:",C),T(bt.getError()||"Failed to load Google Maps API")}})()},[]),r.useEffect(()=>{var E,C;if(!(!B||!p||m.length===0))try{if(!bt.isReady()||!((C=(E=window.google)==null?void 0:E.maps)!=null&&C.Map)){console.error("âŒ Google Maps API not available or Map constructor not ready");return}const n=m[0]?{lat:m[0].lat,lng:m[0].lng}:{lat:-3.359178,lng:36.661366},u=new window.google.maps.Map(p,{center:n,zoom:13,mapTypeId:"roadmap",mapId:"DEMO_MAP_ID"});M(u),console.log("âœ… Map initialized successfully")}catch(n){console.error("âŒ Error initializing map:",n)}},[B,p,m]),r.useEffect(()=>{var E,C;if(!(!y||!B))try{if(!bt.isReady()||!((C=(E=window.google)==null?void 0:E.maps)!=null&&C.marker)){console.error("âŒ Google Maps API or marker library not available");return}I.forEach(s=>{s.map&&(s.map=null)}),$.forEach(s=>s.setMap(null));const n=[],u=[];if(m.forEach((s,b)=>{try{const R=new window.google.maps.marker.PinElement({background:(w==null?void 0:w.name)===s.name?"#3B82F6":"#EF4444",borderColor:"#FFFFFF",glyphColor:"#FFFFFF",glyph:(b+1).toString(),scale:1.2}),S=new window.google.maps.marker.AdvancedMarkerElement({position:{lat:s.lat,lng:s.lng},map:y,title:s.name,content:R.element}),K=new window.google.maps.InfoWindow({content:`
          <div style="padding: 8px; max-width: 250px;">
            <h3 style="margin: 0 0 8px 0; color: #1F2937; font-weight: bold;">${s.name}</h3>
            <p style="margin: 0 0 4px 0; color: #6B7280; font-size: 12px;">${s.address}</p>
            <p style="margin: 0 0 4px 0; color: #6B7280; font-size: 12px;">
              <strong>Radius:</strong> ${s.radius}m
            </p>
            <p style="margin: 0 0 4px 0; color: #6B7280; font-size: 12px;">
              <strong>WiFi Networks:</strong> ${s.networks.length}
            </p>
            <div style="margin-top: 8px;">
              ${s.networks.map(ee=>`<div style="font-size: 11px; color: #059669;">ðŸ“¶ ${ee.ssid}</div>`).join("")}
            </div>
          </div>
        `});if(S.addListener("click",()=>{K.open({map:y,anchor:S}),N&&N(s)}),n.push(S),P){const ee=new window.google.maps.Circle({strokeColor:(w==null?void 0:w.name)===s.name?"#3B82F6":"#EF4444",strokeOpacity:.8,strokeWeight:2,fillColor:(w==null?void 0:w.name)===s.name?"#3B82F6":"#EF4444",fillOpacity:.1,map:y,center:{lat:s.lat,lng:s.lng},radius:s.radius});u.push(ee)}}catch(R){console.error(`âŒ Error creating marker/circle for office ${s.name}:`,R)}}),_(n),h(u),m.length>1)try{const s=new window.google.maps.LatLngBounds;m.forEach(b=>{s.extend({lat:b.lat,lng:b.lng})}),y.fitBounds(s)}catch(s){console.error("âŒ Error fitting bounds:",s)}}catch(n){console.error("âŒ Error in markers and circles creation:",n)}},[y,m,w,P,B]),r.useEffect(()=>{if(!(!y||!w))try{y.setCenter({lat:w.lat,lng:w.lng}),y.setZoom(15)}catch(E){console.error("âŒ Error updating map center:",E)}},[y,w]),B?e.jsxs($e,{className:`p-4 ${t}`,children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(is,{className:"w-5 h-5 text-blue-600"}),"Office Locations Map"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{children:"Office"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Selected"})]})]})]}),e.jsx("div",{ref:i,className:"w-full h-80 rounded-lg border border-gray-200",style:{minHeight:"320px"}}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsx("p",{children:"ðŸ’¡ Click on any office marker to view details and select it"}),e.jsx("p",{children:"ðŸ“ Circles show the check-in radius for each office"})]})]}):e.jsx($e,{className:`p-6 ${t}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-center",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx(xs,{className:"w-8 h-8 mx-auto"})}),e.jsx("p",{className:"text-red-600 font-medium",children:"Map Loading Failed"}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:x}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading map..."})]})})})})},Rr=()=>{var V,Q;const[m,w]=r.useState([]),[N]=r.useState(ja()),[P,t]=r.useState(!0),[p,i]=r.useState(null),[y,M]=r.useState(!1),[I,_]=r.useState({}),[$,h]=r.useState(!1),[B,j]=r.useState(null),[x,T]=r.useState({});r.useEffect(()=>{E()},[]);const E=async()=>{t(!0);try{const c=await va();w(c)}catch(c){console.error("Error loading integrations:",c),o.error("Failed to load integrations")}finally{t(!1)}},C=c=>{i({integration_name:c.integration_name,integration_type:c.integration_type,provider_name:c.provider_name,is_enabled:!1,is_active:!1,is_test_mode:!0,environment:"test",credentials:{},config:{},description:c.description}),M(!0)},n=c=>{i({...c}),M(!0)},u=async()=>{if(p){h(!0);try{await Na(p),o.success("Integration saved successfully!"),M(!1),i(null),await E()}catch(c){console.error("Error saving integration:",c),o.error("Failed to save integration")}finally{h(!1)}}},s=async c=>{if(confirm("Are you sure you want to delete this integration?"))try{await qt(c),o.success("Integration deleted successfully!"),await E()}catch(F){console.error("Error deleting integration:",F),o.error("Failed to delete integration")}},b=async()=>{const c=m.filter(F=>F.is_test_mode);if(c.length===0){o.error("No test integrations found");return}if(confirm(`Are you sure you want to delete all ${c.length} test integration(s)?`))try{for(const F of c)await qt(F.integration_name);o.success(`Successfully deleted ${c.length} test integration(s)!`),await E()}catch(F){console.error("Error deleting test integrations:",F),o.error("Failed to delete test integrations")}},R=async(c,F)=>{try{await wa(c,F),o.success(`Integration ${F?"enabled":"disabled"} successfully!`),await E()}catch(l){console.error("Error toggling integration:",l),o.error("Failed to toggle integration")}},S=c=>{_(F=>({...F,[c]:!F[c]}))},K=async c=>{j(c.integration_name);try{let F={success:!1,message:""};switch(c.integration_type){case"sms":F=await ee(c);break;case"whatsapp":F=await le(c);break;case"email":F=await D(c);break;case"payment":F=await H(c);break;case"analytics":F=await X(c);break;case"ai":F=await a(c);break;case"social":F=await f(c);break;case"maps":F=await W(c);break;case"storage":F=await v(c);break;default:F=await L(c)}T(l=>({...l,[c.integration_name]:F})),F.success?o.success(`âœ… ${c.provider_name} test passed!`):o.error(`âŒ ${c.provider_name} test failed: ${F.message}`)}catch(F){const l=F.message||"Unknown error";T(U=>({...U,[c.integration_name]:{success:!1,message:l}})),o.error(`Test error: ${l}`)}finally{j(null)}},ee=async c=>c.credentials.api_key?{success:!0,message:`SMS credentials validated. API Key: ${c.credentials.api_key.substring(0,8)}...`}:{success:!1,message:"API key is required"},le=async c=>{if(!c.credentials.instance_id||!c.credentials.api_token)return{success:!1,message:"Instance ID and API token are required"};try{const l=`${c.config.api_url||"https://7105.api.greenapi.com"}/waInstance${c.credentials.instance_id}/getStateInstance/${c.credentials.api_token}`,me=await(await fetch(l)).json();return me.stateInstance==="authorized"?{success:!0,message:`Connected! Status: ${me.stateInstance}`}:{success:!1,message:`Status: ${me.stateInstance}. Please scan QR code to authorize.`}}catch(F){return{success:!1,message:F.message}}},D=async c=>!c.credentials.api_key&&!c.credentials.username?{success:!1,message:"Email credentials are incomplete"}:{success:!0,message:"Email credentials validated successfully"},H=async c=>c.credentials.api_key||c.credentials.secret_key||c.credentials.consumer_key?{success:!0,message:"Payment credentials validated successfully"}:{success:!1,message:"Payment credentials are incomplete"},X=async c=>!c.credentials.tracking_id&&!c.credentials.measurement_id?{success:!1,message:"Analytics tracking ID is required"}:{success:!0,message:"Analytics credentials validated successfully"},a=async c=>c.credentials.api_key?{success:!0,message:"AI credentials validated successfully"}:{success:!1,message:"AI API key is required"},f=async c=>({success:!0,message:"Social media credentials validated successfully"}),W=async c=>c.credentials.api_key?c.credentials.api_key.startsWith("AIza")?{success:!0,message:"Google Maps API key validated. Maps services are ready to use."}:{success:!1,message:'Invalid Google Maps API key format (should start with "AIza")'}:{success:!1,message:"Maps API key is required"},v=async c=>c.integration_name==="HOSTINGER_STORAGE"?!c.credentials.api_token||!c.credentials.domain?{success:!1,message:"Hostinger credentials incomplete (API Token and Domain required)"}:{success:!0,message:"Hostinger credentials validated. File storage is ready to use."}:!c.credentials.api_key&&!c.credentials.api_token?{success:!1,message:"Storage credentials are incomplete"}:{success:!0,message:"Storage credentials validated successfully"},L=async c=>!c.credentials.api_key&&!c.credentials.api_url?{success:!1,message:"API credentials are incomplete"}:{success:!0,message:"Integration credentials validated successfully"},k=c=>({Smartphone:nt,MessageCircle:Qs,Mail:As,CreditCard:ms,BarChart:$a,Zap:la,Globe:Us,MapPin:is,HardDrive:Gs})[c]||Us,Y=c=>c.is_enabled&&c.is_active?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:[e.jsx(ke,{className:"w-3 h-3"}),"Active"]}):c.is_enabled?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-medium",children:[e.jsx(Fe,{className:"w-3 h-3"}),"Enabled"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium",children:[e.jsx(gs,{className:"w-3 h-3"}),"Disabled"]}),A=c=>N.find(F=>F.integration_name===c);return P?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(be,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Ze,{className:"w-7 h-7 text-blue-600"}),"Integrations Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure and manage all your third-party integrations"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.some(c=>c.is_test_mode)&&e.jsxs(ge,{onClick:b,variant:"outline",className:"flex items-center gap-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(Re,{className:"w-4 h-4"}),"Delete Test Integrations"]}),e.jsxs(ge,{onClick:E,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Refresh"]})]})]}),m.length>0&&e.jsxs($e,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Active Integrations (",m.length,")"]}),e.jsx("div",{className:"space-y-3",children:m.map(c=>{const F=A(c.integration_name),l=F?k(F.icon):Us;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg",children:e.jsx(l,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:c.provider_name||c.integration_name}),Y(c)]}),e.jsx("p",{className:"text-sm text-gray-600",children:c.description||`${c.integration_type} integration`}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[c.is_test_mode&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"Test Mode"}),x[c.integration_name]&&e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${x[c.integration_name].success?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:["Last test: ",x[c.integration_name].success?"âœ… Passed":"âŒ Failed"]})]}),x[c.integration_name]&&!x[c.integration_name].success&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:x[c.integration_name].message})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{onClick:()=>K(c),variant:"outline",size:"sm",disabled:B===c.integration_name,className:"flex items-center gap-1 text-blue-600 hover:text-blue-700",title:"Test integration",children:B===c.integration_name?e.jsx(be,{className:"w-4 h-4 animate-spin"}):e.jsx(ra,{className:"w-4 h-4"})}),e.jsx(ge,{onClick:()=>R(c.integration_name,!c.is_enabled),variant:"outline",size:"sm",className:`flex items-center gap-1 ${c.is_enabled?"text-green-600 hover:text-green-700":"text-gray-600 hover:text-gray-700"}`,title:c.is_enabled?"Disable":"Enable",children:c.is_enabled?e.jsx(La,{className:"w-4 h-4"}):e.jsx(Ba,{className:"w-4 h-4"})}),e.jsx(ge,{onClick:()=>n(c),variant:"outline",size:"sm",className:"flex items-center gap-1",title:"Edit integration",children:e.jsx(na,{className:"w-4 h-4"})}),e.jsx(ge,{onClick:()=>s(c.integration_name),variant:"outline",size:"sm",className:"flex items-center gap-1 text-red-600 hover:text-red-700",title:"Delete integration",children:e.jsx(Re,{className:"w-4 h-4"})})]})]},c.id)})})]}),e.jsxs($e,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Integration"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(c=>{const F=k(c.icon),l=m.find(U=>U.integration_name===c.integration_name);return e.jsxs("div",{className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors cursor-pointer",onClick:()=>!l&&C(c),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(F,{className:"w-6 h-6 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:c.provider_name})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:c.description}),l?e.jsx("button",{className:"w-full py-2 px-4 bg-gray-100 text-gray-500 rounded-lg cursor-not-allowed",disabled:!0,children:"Already Added"}):e.jsxs("button",{className:"w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Add Integration"]})]},c.integration_name)})})]}),y&&p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[p.id?"Edit":"Add"," Integration"]}),e.jsx("button",{onClick:()=>{M(!1),i(null)},className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Provider Name"}),e.jsx("input",{type:"text",value:p.provider_name||"",onChange:c=>i({...p,provider_name:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:p.description||"",onChange:c=>i({...p,description:c.target.value}),rows:2,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),e.jsxs("select",{value:p.environment,onChange:c=>i({...p,environment:c.target.value,is_test_mode:c.target.value==="test"}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"test",children:"Test"}),e.jsx("option",{value:"sandbox",children:"Sandbox"}),e.jsx("option",{value:"production",children:"Production"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-8",children:[e.jsx("input",{type:"checkbox",id:"enabled",checked:p.is_enabled,onChange:c=>i({...p,is_enabled:c.target.checked,is_active:c.target.checked}),className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"enabled",className:"font-medium",children:"Enable Integration"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Credentials"}),(V=A(p.integration_name))==null?void 0:V.credentials_fields.map(c=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c.label," ",c.required&&"*"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:c.type==="password"&&!I[c.name]?"password":"text",value:p.credentials[c.name]||"",onChange:F=>i({...p,credentials:{...p.credentials,[c.name]:F.target.value}}),placeholder:c.placeholder,className:"w-full px-4 py-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),c.type==="password"&&e.jsx("button",{type:"button",onClick:()=>S(c.name),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:I[c.name]?e.jsx(_t,{className:"w-5 h-5"}):e.jsx(Js,{className:"w-5 h-5"})})]})]},c.name))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Configuration"}),(Q=A(p.integration_name))==null?void 0:Q.config_fields.map(c=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c.label," ",c.required&&"*"]}),c.type==="checkbox"?e.jsx("input",{type:"checkbox",checked:p.config[c.name]||!1,onChange:F=>i({...p,config:{...p.config,[c.name]:F.target.checked}}),className:"w-5 h-5 text-blue-600 rounded"}):c.type==="select"&&c.options?e.jsx("select",{value:p.config[c.name]||"",onChange:F=>i({...p,config:{...p.config,[c.name]:F.target.value}}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:c.options.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))}):e.jsx("input",{type:c.type,value:p.config[c.name]||"",onChange:F=>i({...p,config:{...p.config,[c.name]:F.target.value}}),placeholder:c.placeholder,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]},c.name))]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex gap-3 justify-end",children:[e.jsx(ge,{onClick:()=>{M(!1),i(null)},variant:"outline",children:"Cancel"}),e.jsx(ge,{onClick:u,disabled:$,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:$?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4"}),"Save Integration"]})})]})]})})]})},Mr=({isActive:m})=>{const{theme:w,setTheme:N}=_a(),{settings:P,updateSettings:t,loading:p}=ka(),{registerSaveHandler:i,unregisterSaveHandler:y,setHasChanges:M}=Ps(),[I,_]=r.useState(w),[$,h]=r.useState(()=>localStorage.getItem("accentColor")||"#3B82F6"),[B,j]=r.useState(()=>localStorage.getItem("fontSize")||"medium");r.useEffect(()=>{P!=null&&P.font_size&&j(P.font_size)},[P]),r.useEffect(()=>{_(w)},[w]);const x=C=>{_(C),N(C),oe.success(`Theme changed to ${C==="dark"?"Dark":C==="dark-cards"?"Dark Cards":"Light"}`)},T=C=>{const n=document.documentElement,u={tiny:"11px","extra-small":"12px",small:"14px",medium:"16px",large:"18px"};n.style.fontSize=u[C],localStorage.setItem("fontSize",C)},E=async C=>{j(C),T(C);try{await t({font_size:C}),oe.success(`Font size changed to ${C.replace("-"," ")}`),window.dispatchEvent(new CustomEvent("settingsUpdated",{detail:{type:"general"}}))}catch(n){console.error("Failed to save font size:",n),oe.error("Failed to save font size setting")}};return r.useEffect(()=>(i("appearance-settings",async()=>{localStorage.setItem("accentColor",$),oe.success("Appearance settings saved successfully")}),()=>y("appearance-settings")),[$,i,y]),r.useEffect(()=>{M(!0)},[$,M]),m?e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-pink-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ia,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Appearance Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customize theme, colors, and font size"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Theme Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"light",label:"Light",icon:Oa,desc:"Bright & Clean",preview:"bg-gradient-to-br from-blue-50 to-indigo-100"},{value:"dark",label:"Dark",icon:Wa,desc:"Easy on Eyes",preview:"bg-gradient-to-br from-slate-800 to-slate-900"},{value:"dark-cards",label:"Dark Pro",icon:qa,desc:"Premium Dark",preview:"bg-gradient-to-br from-slate-900 to-gray-900"}].map(({value:C,label:n,icon:u,desc:s,preview:b})=>e.jsxs("button",{onClick:()=>x(C),className:`relative p-4 rounded-xl border-2 transition-all overflow-hidden group ${I===C?"border-indigo-500 bg-indigo-50 shadow-lg scale-105":"border-gray-300 bg-white hover:bg-gray-50 hover:border-indigo-300"}`,children:[e.jsx("div",{className:`absolute top-2 right-2 w-8 h-8 rounded-md ${b} opacity-40 group-hover:opacity-60 transition-opacity`}),I===C&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(Bt,{className:"w-5 h-5 text-indigo-600"})}),e.jsx(u,{className:`w-8 h-8 mx-auto mb-2 mt-2 ${I===C?"text-indigo-600":"text-gray-600"}`}),e.jsx("div",{className:`text-sm font-semibold mb-1 ${I===C?"text-indigo-700":"text-gray-700"}`,children:n}),e.jsx("div",{className:"text-xs text-gray-500",children:s})]},C))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Accent Color"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"color",value:$,onChange:C=>h(C.target.value),className:"w-16 h-12 rounded-lg border-2 border-white/20 cursor-pointer"}),e.jsx("span",{className:"text-white",children:$})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(za,{className:"w-4 h-4 text-indigo-600"}),"Font Size (Affects Entire App)"]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("select",{value:B,onChange:C=>E(C.target.value),disabled:p,className:"w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[e.jsx("option",{value:"tiny",children:"Tiny (11px) - Ultra Compact âœ¨"}),e.jsx("option",{value:"extra-small",children:"Extra Small (12px) - Very Compact"}),e.jsx("option",{value:"small",children:"Small (14px) - Compact"}),e.jsx("option",{value:"medium",children:"Medium (16px) - Default â­"}),e.jsx("option",{value:"large",children:"Large (18px) - Comfortable"})]})})]})]})})})})]}):null},Fr=({isActive:m})=>{const{registerSaveHandler:w,unregisterSaveHandler:N,setHasChanges:P}=Ps(),[t,p]=r.useState({emailNotifications:!0,smsNotifications:!1,pushNotifications:!0,whatsappNotifications:!0,lowStockAlerts:!0,salesReports:!0,systemUpdates:!1,marketingEmails:!1});return r.useEffect(()=>(w("notification-settings",async()=>{localStorage.setItem("notificationSettings",JSON.stringify(t)),oe.success("Notification settings saved")}),()=>N("notification-settings")),[t,w,N]),r.useEffect(()=>{P(!0)},[t,P]),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-yellow-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ys,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Notification Preferences"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure notification channels and preferences"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"Notification Channels"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.emailNotifications,onChange:i=>p({...t,emailNotifications:i.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx(As,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"text-gray-800",children:"Email Notifications"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.smsNotifications,onChange:i=>p({...t,smsNotifications:i.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx(Ts,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"text-gray-800",children:"SMS Notifications"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.pushNotifications,onChange:i=>p({...t,pushNotifications:i.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx(ys,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"text-gray-800",children:"Push Notifications"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.whatsappNotifications,onChange:i=>p({...t,whatsappNotifications:i.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx(Qs,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"text-gray-800",children:"WhatsApp Notifications"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"Notification Types"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.lowStockAlerts,onChange:i=>p({...t,lowStockAlerts:i.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx("span",{className:"text-gray-800",children:"Low Stock Alerts"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.salesReports,onChange:i=>p({...t,salesReports:i.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx("span",{className:"text-gray-800",children:"Daily Sales Reports"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.systemUpdates,onChange:i=>p({...t,systemUpdates:i.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx("span",{className:"text-gray-800",children:"System Updates"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.marketingEmails,onChange:i=>p({...t,marketingEmails:i.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx("span",{className:"text-gray-800",children:"Marketing Emails"})]})]})]})]})})})})]})},Lr=({isActive:m})=>{const{registerSaveHandler:w,unregisterSaveHandler:N,setHasChanges:P}=Ps(),[t,p]=aa(),i=t.get("tab"),[y,M]=r.useState(i||"categories"),[I,_]=r.useState([]),[$,h]=r.useState(!1),[B,j]=r.useState(null),[x,T]=r.useState(!1),[E,C]=r.useState({name:"",description:"",icon:"Package",color:"blue"}),[n,u]=r.useState({beemEnabled:!0,beemApiKey:"",beemSecretKey:"",beemEnvironment:"sandbox"}),[s,b]=r.useState({cashEnabled:!0,cardEnabled:!0,mobileMoneyEnabled:!0,autoConfirmPayments:!1,requireReceipt:!0,allowPartialPayments:!0,taxRate:18,defaultCurrency:"TSh"}),[R,S]=r.useState({sendReceiptEmail:!0,sendReceiptSMS:!1,sendReceiptWhatsApp:!0,autoSendOnSuccess:!0,notifyOnFailure:!0,notifyAdminOnPayment:!1,receiptTemplate:"modern",includeQRCode:!0,includeLogo:!0}),[K,ee]=r.useState({baseCurrency:"TZS",enabledCurrencies:["TZS","USD","EUR"],exchangeRateSource:"manual",autoUpdateRates:!1,updateFrequency:"daily",usdToTzs:2350,eurToTzs:2580,showCurrencySymbol:!0}),[le,D]=r.useState({enableRefunds:!0,requireApproval:!0,allowPartialRefund:!0,refundTimeLimit:30,autoProcessRefunds:!1,notifyCustomerOnRefund:!0,trackDisputes:!0}),[H,X]=r.useState({defaultPeriod:"month",autoGenerateReports:!1,reportFrequency:"weekly",reportFormat:"pdf",emailReports:!1,reportRecipients:"",includeCharts:!0,includeTransactionDetails:!0});r.useEffect(()=>{W(),f()},[]),r.useEffect(()=>{const l=t.get("tab");l&&["gateway","categories","preferences","notifications","currency","refunds","reports"].includes(l)&&M(l)},[t]);const a=l=>{M(l),p({tab:l})},f=()=>{const l=localStorage.getItem("paymentGatewaySettings"),U=localStorage.getItem("paymentPreferences"),me=localStorage.getItem("paymentNotifications"),re=localStorage.getItem("paymentCurrency"),ie=localStorage.getItem("paymentRefunds"),ue=localStorage.getItem("paymentReports");l&&u(JSON.parse(l)),U&&b(JSON.parse(U)),me&&S(JSON.parse(me)),re&&ee(JSON.parse(re)),ie&&D(JSON.parse(ie)),ue&&X(JSON.parse(ue))},W=async()=>{h(!0);try{const{data:l,error:U}=await Z.from("expense_categories").select("*").order("name");if(U)throw U;_(l||[])}catch(l){console.error("Error fetching expense categories:",l),oe.error("Failed to load expense categories")}finally{h(!1)}},v=async()=>{if(!E.name.trim()){oe.error("Category name is required");return}h(!0);try{if(B){const{error:l}=await Z.from("expense_categories").update({name:E.name,description:E.description,icon:E.icon,color:E.color}).eq("id",B.id);if(l)throw l;oe.success("Category updated successfully")}else{const{error:l}=await Z.from("expense_categories").insert([{name:E.name,description:E.description,icon:E.icon,color:E.color,is_active:!0}]);if(l)throw l;oe.success("Category created successfully")}C({name:"",description:"",icon:"Package",color:"blue"}),j(null),T(!1),W()}catch(l){console.error("Error saving category:",l),oe.error(l.message||"Failed to save category")}finally{h(!1)}},L=async l=>{try{const{error:U}=await Z.from("expense_categories").update({is_active:!l.is_active}).eq("id",l.id);if(U)throw U;oe.success(`Category ${l.is_active?"deactivated":"activated"}`),W()}catch(U){console.error("Error toggling category status:",U),oe.error("Failed to update category status")}},k=async l=>{if(confirm("Are you sure you want to delete this category? This action cannot be undone."))try{const{error:U}=await Z.from("expense_categories").delete().eq("id",l);if(U)throw U;oe.success("Category deleted successfully"),W()}catch(U){console.error("Error deleting category:",U),oe.error("Failed to delete category")}},Y=l=>{j(l),C({name:l.name,description:l.description||"",icon:l.icon||"Package",color:l.color||"blue"}),T(!0)},A=()=>{j(null),T(!1),C({name:"",description:"",icon:"Package",color:"blue"})};r.useEffect(()=>(w("payment-settings",async()=>{localStorage.setItem("paymentGatewaySettings",JSON.stringify(n)),localStorage.setItem("paymentPreferences",JSON.stringify(s)),localStorage.setItem("paymentNotifications",JSON.stringify(R)),localStorage.setItem("paymentCurrency",JSON.stringify(K)),localStorage.setItem("paymentRefunds",JSON.stringify(le)),localStorage.setItem("paymentReports",JSON.stringify(H)),oe.success("All payment settings saved")}),()=>N("payment-settings")),[n,s,R,K,le,H,w,N]),r.useEffect(()=>{P(!0)},[n,s,R,K,le,H,P]);const V=()=>{oe.success("Testing payment connection...")},Q=[{id:"categories",label:"Expense Categories",icon:Hs},{id:"gateway",label:"Payment Gateway",icon:Es},{id:"preferences",label:"Preferences",icon:ms},{id:"notifications",label:"Notifications & Receipts",icon:As},{id:"currency",label:"Currency Management",icon:Us},{id:"refunds",label:"Refunds & Disputes",icon:hs},{id:"reports",label:"Payment Reports",icon:js}],c=[{value:"Package",label:"Package"},{value:"Building",label:"Building"},{value:"Wallet",label:"Wallet"},{value:"DollarSign",label:"Dollar Sign"},{value:"FileText",label:"File Text"},{value:"Tag",label:"Tag"},{value:"CreditCard",label:"Credit Card"},{value:"TrendingUp",label:"Trending Up"}],F=[{value:"blue",label:"Blue"},{value:"green",label:"Green"},{value:"red",label:"Red"},{value:"yellow",label:"Yellow"},{value:"purple",label:"Purple"},{value:"pink",label:"Pink"},{value:"indigo",label:"Indigo"},{value:"gray",label:"Gray"}];return e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ms,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Payment Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage payment gateways, expense categories, and payment preferences"})]})]}),e.jsx("div",{className:"mt-6 border-b-2 border-gray-200",children:e.jsx("nav",{className:"flex space-x-2 overflow-x-auto",children:Q.map(l=>{const U=l.icon;return e.jsxs("button",{onClick:()=>a(l.id),className:`
                    flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-all whitespace-nowrap rounded-t-xl
                    ${y===l.id?"border-green-500 text-green-700 bg-green-50":"border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50"}
                  `,children:[e.jsx(U,{className:"w-5 h-5"}),l.label]},l.id)})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-6",children:[y==="categories"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Hs,{className:"w-5 h-5 text-indigo-600"}),"Expense Categories"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage categories for organizing expenses"})]}),!x&&e.jsxs(ge,{onClick:()=>T(!0),className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Add Category"]})]}),x&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:B?"Edit Category":"New Category"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(rs,{label:"Category Name *",value:E.name,onChange:l=>C({...E,name:l.target.value}),placeholder:"e.g., Office Supplies"})}),e.jsx("div",{children:e.jsx(rs,{label:"Description",value:E.description,onChange:l=>C({...E,description:l.target.value}),placeholder:"Brief description"})}),e.jsx("div",{children:e.jsx(ns,{label:"Icon",value:E.icon,onChange:l=>C({...E,icon:l}),options:c})}),e.jsx("div",{children:e.jsx(ns,{label:"Color",value:E.color,onChange:l=>C({...E,color:l}),options:F})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(ge,{onClick:v,disabled:$,className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),B?"Update":"Create"," Category"]}),e.jsx(ge,{onClick:A,variant:"secondary",children:"Cancel"})]})]}),$?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading categories..."})]}):I.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Hs,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No expense categories yet"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:I.map(l=>e.jsxs("div",{className:`
                    p-4 rounded-lg border-2 transition-all
                    ${l.is_active?"bg-white border-gray-200 hover:border-indigo-300 hover:shadow-md":"bg-gray-50 border-gray-200 opacity-60"}
                  `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`
                        w-10 h-10 rounded-lg flex items-center justify-center
                        bg-${l.color}-100
                      `,children:e.jsx(Ue,{className:`w-5 h-5 text-${l.color}-600`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:l.name}),l.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:l.description})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>L(l),className:"p-1 hover:bg-gray-100 rounded",title:l.is_active?"Deactivate":"Activate",children:l.is_active?e.jsx(ke,{className:"w-5 h-5 text-green-600"}):e.jsx(gs,{className:"w-5 h-5 text-gray-400"})})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>Y(l),className:"flex-1 px-3 py-1.5 text-sm bg-indigo-50 text-indigo-700 rounded hover:bg-indigo-100 flex items-center justify-center gap-1",children:[e.jsx(Ys,{className:"w-3 h-3"}),"Edit"]}),e.jsxs("button",{onClick:()=>k(l.id),className:"flex-1 px-3 py-1.5 text-sm bg-red-50 text-red-700 rounded hover:bg-red-100 flex items-center justify-center gap-1",children:[e.jsx(Re,{className:"w-3 h-3"}),"Delete"]})]})]},l.id))})]}),y==="gateway"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(Es,{className:"w-5 h-5 text-indigo-600"}),"Payment Gateway Configuration"]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-800 flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4"}),"Beem Payment Gateway"]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.beemEnabled,onChange:l=>u({...n,beemEnabled:l.target.checked}),className:"w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-800 text-sm font-medium",children:"Enable"})]})]}),n.beemEnabled&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{children:e.jsx(rs,{label:"API Key",type:"password",value:n.beemApiKey,onChange:l=>u({...n,beemApiKey:l.target.value}),placeholder:"Enter API Key"})}),e.jsx("div",{children:e.jsx(rs,{label:"Secret Key",type:"password",value:n.beemSecretKey,onChange:l=>u({...n,beemSecretKey:l.target.value}),placeholder:"Enter Secret Key"})}),e.jsx("div",{children:e.jsx(ns,{label:"Environment",value:n.beemEnvironment,onChange:l=>u({...n,beemEnvironment:l}),options:[{value:"sandbox",label:"Sandbox (Testing)"},{value:"production",label:"Production (Live)"}]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs(ge,{onClick:V,className:"flex items-center gap-2 w-full",variant:"secondary",children:[e.jsx(ra,{className:"w-4 h-4"}),"Test Connection"]})})]})]})})]}),y==="preferences"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(ms,{className:"w-5 h-5 text-indigo-600"}),"Payment Preferences"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Enabled Payment Methods"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:s.cashEnabled,onChange:l=>b({...s,cashEnabled:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx(Ua,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-800 font-medium",children:"Cash Payments"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:s.cardEnabled,onChange:l=>b({...s,cardEnabled:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx(ms,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-800 font-medium",children:"Card Payments"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:s.mobileMoneyEnabled,onChange:l=>b({...s,mobileMoneyEnabled:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx(fs,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-800 font-medium",children:"Mobile Money"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Transaction Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Auto-confirm successful payments"}),e.jsx("input",{type:"checkbox",checked:s.autoConfirmPayments,onChange:l=>b({...s,autoConfirmPayments:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Require receipt for all transactions"}),e.jsx("input",{type:"checkbox",checked:s.requireReceipt,onChange:l=>b({...s,requireReceipt:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Allow partial payments"}),e.jsx("input",{type:"checkbox",checked:s.allowPartialPayments,onChange:l=>b({...s,allowPartialPayments:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Tax & Currency"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(rs,{label:"Default Tax Rate (%)",type:"number",value:s.taxRate.toString(),onChange:l=>b({...s,taxRate:parseFloat(l.target.value)||0}),placeholder:"18",min:"0",max:"100",step:"0.1"})}),e.jsx("div",{children:e.jsx(rs,{label:"Default Currency",value:s.defaultCurrency,onChange:l=>b({...s,defaultCurrency:l.target.value}),placeholder:"TSh"})})]})]})]})]}),y==="notifications"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(As,{className:"w-5 h-5 text-indigo-600"}),"Payment Notifications & Receipts"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Receipt Delivery Methods"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(As,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Email Receipts"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send receipt via email after payment"})]})]}),e.jsx("input",{type:"checkbox",checked:R.sendReceiptEmail,onChange:l=>S({...R,sendReceiptEmail:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ts,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"SMS Receipts"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send receipt via SMS (charges apply)"})]})]}),e.jsx("input",{type:"checkbox",checked:R.sendReceiptSMS,onChange:l=>S({...R,sendReceiptSMS:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qs,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"WhatsApp Receipts"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send receipt via WhatsApp"})]})]}),e.jsx("input",{type:"checkbox",checked:R.sendReceiptWhatsApp,onChange:l=>S({...R,sendReceiptWhatsApp:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Notification Triggers"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Auto-send on payment success"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Automatically send receipt when payment is successful"})]}),e.jsx("input",{type:"checkbox",checked:R.autoSendOnSuccess,onChange:l=>S({...R,autoSendOnSuccess:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Notify on payment failure"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send notification when payment fails"})]}),e.jsx("input",{type:"checkbox",checked:R.notifyOnFailure,onChange:l=>S({...R,notifyOnFailure:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Notify admin on payments"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send notifications to admin for all payments"})]}),e.jsx("input",{type:"checkbox",checked:R.notifyAdminOnPayment,onChange:l=>S({...R,notifyAdminOnPayment:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Receipt Template & Customization"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{children:e.jsx(ns,{label:"Receipt Template",value:R.receiptTemplate,onChange:l=>S({...R,receiptTemplate:l}),options:[{value:"modern",label:"Modern"},{value:"classic",label:"Classic"},{value:"minimal",label:"Minimal"},{value:"detailed",label:"Detailed"}]})})}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Include QR code in receipt"}),e.jsx("input",{type:"checkbox",checked:R.includeQRCode,onChange:l=>S({...R,includeQRCode:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Include company logo in receipt"}),e.jsx("input",{type:"checkbox",checked:R.includeLogo,onChange:l=>S({...R,includeLogo:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]})]})]}),y==="currency"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(Us,{className:"w-5 h-5 text-indigo-600"}),"Multi-Currency Management"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Base Currency Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(ns,{label:"Base Currency",value:K.baseCurrency,onChange:l=>ee({...K,baseCurrency:l}),options:[{value:"TZS",label:"Tanzanian Shilling (TZS)"},{value:"USD",label:"US Dollar (USD)"},{value:"EUR",label:"Euro (EUR)"},{value:"GBP",label:"British Pound (GBP)"},{value:"KES",label:"Kenyan Shilling (KES)"}]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all w-full",children:[e.jsx("input",{type:"checkbox",checked:K.showCurrencySymbol,onChange:l=>ee({...K,showCurrencySymbol:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"text-gray-800 font-medium",children:"Show currency symbol"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Exchange Rate Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(ns,{label:"Exchange Rate Source",value:K.exchangeRateSource,onChange:l=>ee({...K,exchangeRateSource:l}),options:[{value:"manual",label:"Manual Entry"},{value:"api",label:"Auto-update from API"},{value:"bank",label:"Bank of Tanzania Rates"}]})}),K.exchangeRateSource==="api"&&e.jsx("div",{children:e.jsx(ns,{label:"Update Frequency",value:K.updateFrequency,onChange:l=>ee({...K,updateFrequency:l}),options:[{value:"hourly",label:"Every Hour"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"}]})})]}),K.exchangeRateSource==="api"&&e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:K.autoUpdateRates,onChange:l=>ee({...K,autoUpdateRates:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Auto-update exchange rates"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Automatically fetch latest rates from API"})]})]})]}),K.exchangeRateSource==="manual"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Exchange Rates (Manual)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(rs,{label:"USD to TZS Rate",type:"number",value:K.usdToTzs.toString(),onChange:l=>ee({...K,usdToTzs:parseFloat(l.target.value)||0}),placeholder:"2350",step:"0.01"})}),e.jsx("div",{children:e.jsx(rs,{label:"EUR to TZS Rate",type:"number",value:K.eurToTzs.toString(),onChange:l=>ee({...K,eurToTzs:parseFloat(l.target.value)||0}),placeholder:"2580",step:"0.01"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Enabled Currencies"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:["TZS","USD","EUR","GBP","KES"].map(l=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-3 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:K.enabledCurrencies.includes(l),onChange:U=>{U.target.checked?ee({...K,enabledCurrencies:[...K.enabledCurrencies,l]}):ee({...K,enabledCurrencies:K.enabledCurrencies.filter(me=>me!==l)})},className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"text-gray-800 font-medium",children:l})]},l))})]}),e.jsx("div",{className:"flex justify-end gap-2",children:K.exchangeRateSource==="api"&&e.jsxs(ge,{onClick:()=>oe.success("Fetching latest exchange rates..."),className:"flex items-center gap-2",variant:"secondary",children:[e.jsx(be,{className:"w-4 h-4"}),"Refresh Rates Now"]})})]})]}),y==="refunds"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(hs,{className:"w-5 h-5 text-indigo-600"}),"Refunds & Dispute Management"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Refund Policies"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Enable refunds"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Allow customers to request refunds"})]}),e.jsx("input",{type:"checkbox",checked:le.enableRefunds,onChange:l=>D({...le,enableRefunds:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),le.enableRefunds&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Require approval"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Refunds must be approved by admin"})]}),e.jsx("input",{type:"checkbox",checked:le.requireApproval,onChange:l=>D({...le,requireApproval:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Allow partial refunds"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Enable partial refund amounts"})]}),e.jsx("input",{type:"checkbox",checked:le.allowPartialRefund,onChange:l=>D({...le,allowPartialRefund:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Auto-process refunds"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Automatically process approved refunds"})]}),e.jsx("input",{type:"checkbox",checked:le.autoProcessRefunds,onChange:l=>D({...le,autoProcessRefunds:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]})]}),le.enableRefunds&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Refund Time Limit"}),e.jsxs("div",{children:[e.jsx(rs,{label:"Refund window (days)",type:"number",value:le.refundTimeLimit.toString(),onChange:l=>D({...le,refundTimeLimit:parseInt(l.target.value)||0}),placeholder:"30",min:"1",max:"365"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Customers can request refunds within ",le.refundTimeLimit," days of payment"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Refund Notifications"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Notify customer on refund"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send notification when refund is processed"})]}),e.jsx("input",{type:"checkbox",checked:le.notifyCustomerOnRefund,onChange:l=>D({...le,notifyCustomerOnRefund:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Dispute & Chargeback Management"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Track payment disputes"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Enable dispute tracking and management"})]}),e.jsx("input",{type:"checkbox",checked:le.trackDisputes,onChange:l=>D({...le,trackDisputes:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})}),le.trackDisputes&&e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xs,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Dispute Management Active"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"All disputed transactions will be tracked. You'll receive notifications for new disputes."})]})]})})]})]})]}),y==="reports"&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(js,{className:"w-5 h-5 text-indigo-600"}),"Payment Reports & Analytics"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Default Report Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(ns,{label:"Default Report Period",value:H.defaultPeriod,onChange:l=>X({...H,defaultPeriod:l}),options:[{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"},{value:"quarter",label:"This Quarter"},{value:"year",label:"This Year"},{value:"custom",label:"Custom Range"}]})}),e.jsx("div",{children:e.jsx(ns,{label:"Report Format",value:H.reportFormat,onChange:l=>X({...H,reportFormat:l}),options:[{value:"pdf",label:"PDF"},{value:"excel",label:"Excel (XLSX)"},{value:"csv",label:"CSV"},{value:"json",label:"JSON"}]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Automated Reports"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Enable auto-generated reports"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Automatically generate periodic payment reports"})]}),e.jsx("input",{type:"checkbox",checked:H.autoGenerateReports,onChange:l=>X({...H,autoGenerateReports:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),H.autoGenerateReports&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(ns,{label:"Report Frequency",value:H.reportFrequency,onChange:l=>X({...H,reportFrequency:l}),options:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"}]})}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Email reports automatically"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send generated reports via email"})]}),e.jsx("input",{type:"checkbox",checked:H.emailReports,onChange:l=>X({...H,emailReports:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),H.emailReports&&e.jsx("div",{children:e.jsx(rs,{label:"Report Recipients (comma separated)",value:H.reportRecipients,onChange:l=>X({...H,reportRecipients:l.target.value}),placeholder:"admin@example.com, finance@example.com"})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Report Content"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Include charts and graphs"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Add visual analytics to reports"})]}),e.jsx("input",{type:"checkbox",checked:H.includeCharts,onChange:l=>X({...H,includeCharts:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Include transaction details"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Add individual transaction breakdown"})]}),e.jsx("input",{type:"checkbox",checked:H.includeTransactionDetails,onChange:l=>X({...H,includeTransactionDetails:l.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Key Metrics to Track"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:["Total Revenue","Transaction Count","Average Transaction Value","Success Rate","Payment Method Breakdown","Refund Rate","Peak Transaction Times","Customer Payment Trends"].map(l=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-3 rounded-lg border border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-800",children:l})]},l))})]}),e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-indigo-50 border border-indigo-200 rounded-lg",children:[e.jsx(js,{className:"w-5 h-5 text-indigo-600"}),e.jsx("p",{className:"text-sm text-indigo-800",children:"Reports will be generated based on your configured settings and can be accessed from the Payment Management page."})]})]})]})]})})]})},sa=m=>{if(!m||m.trim()==="")return[];try{const w=JSON.parse(m);if(Array.isArray(w))return w.map(N=>({phone:typeof N=="string"?N:N.phone||"",whatsapp:typeof N=="object"?N.whatsapp===!0:!1})).filter(N=>N.phone.length>0)}catch{return m.split(",").map(N=>N.trim()).filter(N=>N.length>0).map(N=>({phone:N,whatsapp:!1}))}return[]},ta=m=>m.length===0?"":JSON.stringify(m),Br=({value:m,onChange:w,placeholder:N="+255 123 456 789",className:P="",label:t="Business Phone",maxPhones:p=5})=>{const[i,y]=r.useState(()=>sa(m)),[M,I]=r.useState("");r.useEffect(()=>{const T=sa(m),E=ta(i);m!==E&&m!==void 0&&(console.log("ðŸ“¥ MultiPhoneInput: External value changed",{oldValue:E==null?void 0:E.substring(0,100),newValue:m==null?void 0:m.substring(0,100),parsedEntries:T.length}),y(T))},[m]);const _=T=>{const E=ta(T);console.log("ðŸ“¤ MultiPhoneInput: Entries changed",{entryCount:T.length,serialized:E==null?void 0:E.substring(0,100),entries:T.map(C=>`${C.phone} ${C.whatsapp?"ðŸ“±":""}`)}),y(T),w(E)},$=()=>{const T=M.trim();if(!T||i.length>=p||i.some(C=>C.phone===T))return;const E=[...i,{phone:T,whatsapp:!1}];_(E),I("")},h=T=>{const E=i.filter((C,n)=>n!==T);_(E)},B=(T,E)=>{const C=[...i];C[T]={...C[T],phone:E.trim()},_(C)},j=T=>{const E=[...i];E[T]={...E[T],whatsapp:!E[T].whatsapp},_(E)},x=T=>{T.key==="Enter"&&(T.preventDefault(),$())};return e.jsxs("div",{className:P,children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:[t," ",i.length>0&&e.jsxs("span",{className:"text-gray-500",children:["(",i.length,"/",p,")"]})]}),i.length>0&&e.jsx("div",{className:"space-y-2 mb-3",children:i.map((T,E)=>e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ts,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"}),e.jsx("input",{type:"tel",value:T.phone,onChange:C=>B(E,C.target.value),placeholder:N,className:"w-full pl-10 pr-10 py-2.5 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white text-sm"})]}),e.jsx("button",{type:"button",onClick:()=>j(E),className:`p-2 rounded-lg transition-all ${T.whatsapp?"bg-green-100 text-green-600 hover:bg-green-200":"bg-gray-100 text-gray-400 hover:bg-gray-200"}`,title:T.whatsapp?"Has WhatsApp - Click to remove":"Add WhatsApp",children:e.jsx(Qs,{className:`w-4 h-4 ${T.whatsapp?"fill-current":""}`})}),e.jsx("button",{type:"button",onClick:()=>h(E),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"Remove phone number",children:e.jsx(Ns,{className:"w-4 h-4"})})]},E))}),i.length<p&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ts,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"}),e.jsx("input",{type:"tel",value:M,onChange:T=>I(T.target.value),onKeyPress:x,placeholder:N,className:"w-full pl-10 pr-12 py-2.5 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white text-sm"})]}),e.jsxs("button",{type:"button",onClick:$,disabled:!M.trim()||i.length>=p,className:"px-4 py-2.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2 text-sm font-medium",title:"Add phone number",children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsx("span",{children:"Add"})]})]}),i.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:'Click "Add" to add your first phone number'}),i.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-center gap-1",children:[e.jsx(Qs,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{children:"Green icon = WhatsApp available"})]})]})},$r=()=>{const{registerSaveHandler:m,unregisterSaveHandler:w,setHasChanges:N}=Ps(),[P,t]=r.useState(!0),[p,i]=r.useState(!1),[y,M]=r.useState(null),[I,_]=r.useState(null),[$,h]=r.useState(!1),B=r.useRef(null),[j,x]=r.useState({businessName:"",businessPhone:"",businessEmail:"",businessWebsite:"",businessAddress:"",businessLogo:null,businessInstagram:"",businessTiktok:"",businessWhatsapp:""});r.useEffect(()=>{T()},[]);const T=async()=>{try{t(!0);const{data:n,error:u}=await Z.from("lats_pos_general_settings").select("id, business_name, business_phone, business_email, business_website, business_address, business_logo").limit(1).single();if(u)throw u;if(!n)throw new Error("No settings record found");M(n.id);const s={businessName:n.business_name||"",businessPhone:n.business_phone||"",businessEmail:n.business_email||"",businessWebsite:n.business_website||"",businessAddress:n.business_address||"",businessLogo:n.business_logo||null,businessInstagram:"",businessTiktok:"",businessWhatsapp:""};_(n.business_logo||null),x(s)}catch(n){console.error("Error fetching business info:",n),o.error("Failed to load business information")}finally{t(!1)}},E=async n=>{var s;const u=(s=n.target.files)==null?void 0:s[0];if(u){if(!u.type.startsWith("image/")){o.error("Please upload an image file");return}if(u.size>2*1024*1024){o.error("Image size should be less than 2MB");return}h(!0);try{const b=new FileReader;b.onloadend=()=>{const R=b.result;_(R),x(S=>({...S,businessLogo:R})),o.success("Logo uploaded! Remember to save.")},b.onerror=()=>{o.error("Failed to read image file")},b.readAsDataURL(u)}catch{o.error("Failed to upload logo")}finally{h(!1)}}},C=()=>{_(null),x(n=>({...n,businessLogo:null})),B.current&&(B.current.value=""),o.success("Logo removed. Remember to save.")};return r.useEffect(()=>y?(m("unified-branding-settings",async()=>{try{i(!0);const u={business_name:j.businessName||null,business_phone:j.businessPhone||null,business_email:j.businessEmail||null,business_website:j.businessWebsite||null,business_address:j.businessAddress||null,business_logo:j.businessLogo||null,updated_at:new Date().toISOString()};console.log("ðŸ’¾ Saving basic business info...");let{data:s,error:b}=await Z.from("lats_pos_general_settings").update(u).eq("id",y).select();if(b)throw b;console.log("âœ… Successfully saved business info:",{saved:s==null?void 0:s[0]}),Sa.clearCache(),window.dispatchEvent(new CustomEvent("settingsUpdated",{detail:{type:"general"}})),o.success("Business information updated successfully - All components will refresh")}catch(u){console.error("Error updating business info:",u),o.error(`Failed to update business information: ${u.message||"Unknown error"}`)}finally{i(!1)}}),()=>w("unified-branding-settings")):void 0,[j,y,m,w]),r.useEffect(()=>{y&&N(!0)},[j,y,N]),P?e.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading business information..."})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ls,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Business Information"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure your business details and branding"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-xl flex items-center justify-center shadow-sm",children:e.jsx(ls,{className:"w-4 h-4 text-white"})}),"Business Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Business Name"}),e.jsx("input",{type:"text",value:j.businessName,onChange:n=>x({...j,businessName:n.target.value}),placeholder:"My Store",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(Br,{value:j.businessPhone,onChange:n=>x({...j,businessPhone:n}),placeholder:"+255 123 456 789",label:"Business Phone",maxPhones:5})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Business Email"}),e.jsx("input",{type:"email",value:j.businessEmail,onChange:n=>x({...j,businessEmail:n.target.value}),placeholder:"info@mystore.com",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Business Website"}),e.jsx("input",{type:"url",value:j.businessWebsite,onChange:n=>x({...j,businessWebsite:n.target.value}),placeholder:"www.mystore.com",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Address"}),e.jsx("input",{type:"text",value:j.businessAddress,onChange:n=>x({...j,businessAddress:n.target.value}),placeholder:"123 Main Street, City, Country",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-sm",children:e.jsx(vt,{className:"w-4 h-4 text-white"})}),"Social Media"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Instagram Handle"}),e.jsx("input",{type:"text",value:j.businessInstagram,onChange:n=>x({...j,businessInstagram:n.target.value}),placeholder:"@yourhandle",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"TikTok Handle"}),e.jsx("input",{type:"text",value:j.businessTiktok,onChange:n=>x({...j,businessTiktok:n.target.value}),placeholder:"@yourhandle",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"WhatsApp Number"}),e.jsx("input",{type:"tel",value:j.businessWhatsapp,onChange:n=>x({...j,businessWhatsapp:n.target.value}),placeholder:"+255 123 456 789",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 text-gray-900 font-medium bg-white"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-xl flex items-center justify-center shadow-sm",children:e.jsx(es,{className:"w-4 h-4 text-white"})}),"Business Logo"]}),e.jsxs("div",{className:"flex items-start gap-6",children:[I?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-40 h-40 border-2 border-gray-200 rounded-xl overflow-hidden bg-white flex items-center justify-center shadow-sm",children:e.jsx("img",{src:I,alt:"Business Logo",className:"max-w-full max-h-full object-contain"})}),e.jsx("button",{type:"button",onClick:C,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 hover:bg-red-600 transition-colors shadow-lg",title:"Remove logo",children:e.jsx(Ns,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"w-40 h-40 border-2 border-dashed border-gray-300 rounded-xl flex items-center justify-center bg-gray-50",children:e.jsx(es,{className:"w-10 h-10 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:B,type:"file",accept:"image/*",onChange:E,className:"hidden",id:"logo-upload"}),e.jsxs("label",{htmlFor:"logo-upload",className:`inline-flex items-center gap-2 px-6 py-3 border-2 border-gray-300 rounded-xl shadow-sm text-sm font-semibold text-gray-700 bg-white hover:bg-gray-50 cursor-pointer transition-all ${$?"opacity-50 cursor-not-allowed":"hover:border-purple-500 hover:shadow-md"}`,children:[e.jsx(es,{className:"w-5 h-5"}),$?"Uploading...":I?"Change Logo":"Upload Logo"]}),e.jsx("p",{className:"mt-3 text-sm text-gray-600",children:"Upload your business logo. Recommended size: 200x200px. Max size: 2MB. Supported formats: JPG, PNG, GIF, WebP."})]})]})]})]})})]})},Or=()=>{const[m,w]=r.useState([]),[N,P]=r.useState(!0),[t,p]=r.useState(!1),[i,y]=r.useState(null),[M,I]=r.useState(!1),_=r.useMemo(()=>({...ea({name:"",code:"",address:"",city:"",country:"Tanzania",data_isolation_mode:"hybrid",share_products:!1,share_customers:!1,share_inventory:!1,share_suppliers:!1,share_categories:!1,share_employees:!1,share_accounts:!0})}),[]);r.useEffect(()=>{B()},[]);const $=r.useMemo(()=>i?(console.log("ðŸ”„ [StoreManagementSettings] storeForForm created for EDIT store ID:",i.id),i):(M&&console.log("ðŸ”„ [StoreManagementSettings] storeForForm created for NEW store"),_),[i==null?void 0:i.id,M,_]),h=r.useCallback(()=>{console.log("ðŸ”„ [StoreManagementSettings] onCancel called"),I(!1),y(null)},[]),B=async()=>{P(!0);try{const{data:n,error:u}=await Z.from("store_locations").select("*").order("is_main",{ascending:!1}).order("name",{ascending:!0});if(u)throw u;w(n||[])}catch(n){console.error("Error loading stores:",n),o.error("Failed to load stores")}finally{P(!1)}},j=r.useCallback(async n=>{const u=Pr(n);if(!u.valid){o.error(`Validation failed: ${u.errors.join(", ")}`);return}if(!n.name||!n.code){o.error("Store name and code are required");return}p(!0);try{console.log("ðŸ’¾ Attempting to save store:",n);const s=ea(n);if(Array.isArray(s.can_transfer_to_branches)&&s.can_transfer_to_branches.length===0&&delete s.can_transfer_to_branches,n.id){console.log("ðŸ”„ Updating existing store with id:",n.id);const{error:b}=await Z.from("store_locations").update(s).eq("id",n.id);if(b)throw b;o.success("Store updated successfully")}else{console.log("âž• Creating new store");const{data:b,error:R}=await Z.from("store_locations").insert([s]);if(console.log("ðŸ“Š Insert result:",{data:b,error:R}),R)throw R;o.success("Store created successfully")}y(null),I(!1),await B()}catch(s){console.error("Error saving store:",s),console.error("Error details:",JSON.stringify(s,null,2)),console.error("Error message:",s==null?void 0:s.message),console.error("Error code:",s==null?void 0:s.code),o.error(s.message||"Failed to save store")}finally{p(!1)}},[]),x=async n=>{try{const{data:u,error:s}=await Z.rpc("can_delete_store_location",{store_id:n});if(s&&console.error("Error checking store deletion:",s),u&&u.length>0){const R=u[0];if(!R.can_delete){o.error(R.reason,{duration:6e3});const S=[];R.product_count>0&&S.push(`${R.product_count} products`),R.variant_count>0&&S.push(`${R.variant_count} variants`),R.customer_count>0&&S.push(`${R.customer_count} customers`),R.employee_count>0&&S.push(`${R.employee_count} employees`),S.length>0&&alert(`Cannot delete this store.

The store contains:
`+S.map(K=>`â€¢ ${K}`).join(`
`)+`

Please transfer or delete these items first.`);return}}if(!confirm("Are you sure you want to delete this store? This action cannot be undone."))return;const{error:b}=await Z.from("store_locations").delete().eq("id",n);if(b){if(b.code==="23503")o.error("Cannot delete store: It contains products, customers, or other data. Please delete or transfer all data first.",{duration:6e3});else throw b;return}o.success("Store deleted successfully"),B()}catch(u){console.error("Error deleting store:",u),o.error(u.message||"Failed to delete store")}},T=async(n,u)=>{if(confirm(`Are you sure you want to set "${u}" as the main branch?`))try{const{error:s}=await Z.from("store_locations").update({is_main:!1}).eq("is_main",!0);if(s)throw s;const{error:b}=await Z.from("store_locations").update({is_main:!0}).eq("id",n);if(b)throw b;o.success(`${u} is now the main branch`),B()}catch(s){console.error("Error setting main branch:",s),o.error(s.message||"Failed to set main branch")}},E=async n=>{try{const{data:u,error:s}=await Z.from("store_locations").select("*").eq("id",n).single();if(s)throw s;if(u){const b={...u,share_products:u.share_products??!1,share_customers:u.share_customers??!1,share_inventory:u.share_inventory??!1,share_suppliers:u.share_suppliers??!1,share_categories:u.share_categories??!1,share_employees:u.share_employees??!1,share_sales:u.share_sales??!1,share_purchase_orders:u.share_purchase_orders??!1,share_devices:u.share_devices??!1,share_payments:u.share_payments??!1,share_appointments:u.share_appointments??!1,share_reminders:u.share_reminders??!1,share_expenses:u.share_expenses??!1,share_trade_ins:u.share_trade_ins??!1,share_special_orders:u.share_special_orders??!1,share_attendance:u.share_attendance??!1,share_loyalty_points:u.share_loyalty_points??!1,share_accounts:u.share_accounts??!0,share_gift_cards:u.share_gift_cards??!0,share_quality_checks:u.share_quality_checks??!1,share_recurring_expenses:u.share_recurring_expenses??!1,share_communications:u.share_communications??!1,share_reports:u.share_reports??!1,share_finance_transfers:u.share_finance_transfers??!1,allow_stock_transfer:u.allow_stock_transfer??!0,auto_sync_products:u.auto_sync_products??!0,auto_sync_prices:u.auto_sync_prices??!0,require_approval_for_transfers:u.require_approval_for_transfers??!1,data_isolation_mode:u.data_isolation_mode||"hybrid",pricing_model:u.pricing_model||"centralized",can_view_other_branches:u.can_view_other_branches??!1,can_transfer_to_branches:u.can_transfer_to_branches||[]};y(b),I(!1)}}catch(u){console.error("Error loading store for editing:",u),o.error("Failed to load store data. Please try again.")}},C=jt.memo(({store:n,onSave:u,onCancel:s,onStoreCreated:b})=>{console.log("ðŸ”„ [StoreForm] Component re-rendered with store ID:",n.id,"store ref:",n);const R=r.useRef(null),S=r.useRef(n.id),K=r.useRef(!1),ee=r.useRef(n.id),le=r.useRef(null),[D,H]=r.useState(()=>{const z={...n};return R.current=z,z}),[X,a]=r.useState(!1),[f,W]=r.useState(!1),[v,L]=r.useState(null),[k,Y]=r.useState([]),[A,V]=r.useState(!0),[Q,c]=r.useState("idle"),F=r.useRef(null),l=r.useRef(""),U=r.useRef(!0),me=`store-draft-${n.id||"new"}`;r.useEffect(()=>{(async()=>{try{const{data:ae,error:je}=await Z.from("users").select("id, full_name").eq("is_active",!0).order("full_name",{ascending:!0});if(je)throw je;Y(ae||[])}catch(ae){console.error("Error loading users:",ae)}finally{V(!1)}})()},[]),r.useEffect(()=>{const z=n.id,ae=S.current,je=z??null,Se=ae??null;if(console.log("ðŸ”„ [StoreForm] useEffect triggered for store:",je,"previous:",Se),Se!==je){console.log("ðŸ”„ [StoreForm] Store ID changed from",Se,"to",je,"- resetting form");const we={...n};H(we),R.current=we,W(!1),L(null),l.current=JSON.stringify(we),S.current=z,ee.current=z,le.current=z,K.current=!0,U.current=!0}else if(!K.current){console.log("ðŸ”„ [StoreForm] First mount - initializing form for store:",je);const we={...n};H(we),R.current=we,l.current=JSON.stringify(we),S.current=z,K.current=!0,U.current=!0}},[n.id]);const re=r.useCallback(async z=>{if(!z.name||!z.code)return;const ae=JSON.stringify(z);if(ae!==l.current){c("saving");try{const je={...z};if(Array.isArray(je.can_transfer_to_branches)&&je.can_transfer_to_branches.length===0&&delete je.can_transfer_to_branches,z.id){const{error:Se}=await Z.from("store_locations").update(je).eq("id",z.id);if(Se)throw Se;l.current=ae,c("saved"),L(new Date),W(!0),setTimeout(()=>{c("idle")},2e3)}else{const{data:Se,error:we}=await Z.from("store_locations").insert([je]).select().single();if(we)throw we;if(Se!=null&&Se.id){const ve={...z,id:Se.id};H(ve),l.current=JSON.stringify(ve),R.current=ve,S.current=Se.id,b&&b(Se.id)}else l.current=ae;c("saved"),L(new Date),W(!0),o.success("Store created and auto-saved",{duration:2e3}),setTimeout(()=>{c("idle")},2e3)}}catch(je){console.error("Auto-save error:",je),c("error"),setTimeout(()=>{c("idle")},3e3)}}},[]);r.useEffect(()=>{if(U.current){U.current=!1,l.current=JSON.stringify(D);return}return F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{re(D)},1500),()=>{F.current&&clearTimeout(F.current)}},[D,re]);const ie=()=>{localStorage.removeItem(me),W(!1),L(null)},ue=async()=>{a(!0);try{F.current&&clearTimeout(F.current),await re(D),await u(D),ie(),l.current=JSON.stringify(D)}finally{a(!1)}},ye=()=>{F.current&&clearTimeout(F.current),ie(),l.current="",le.current=null,s()};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ls,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:n.id?"Edit Store":"Add New Store"}),e.jsxs("div",{className:"flex items-center gap-4",children:[Q==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(be,{className:"w-4 h-4 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:"Saving..."})]}),Q==="saved"&&v&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-sm font-bold text-green-700",children:"Auto-saved"})]}),Q==="error"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-50 border border-red-200 rounded-lg animate-pulse",children:[e.jsx(Fe,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm font-bold text-red-700",children:"Save failed"})]}),!D.name||!D.code?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-bold text-orange-700",children:"Required fields missing"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-sm font-bold text-green-700",children:"Ready to save"})]})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"space-y-6 py-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(ls,{className:"w-4 h-4 text-white"})}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Store Name *"}),e.jsx("input",{type:"text",value:D.name||"",onChange:z=>H({...D,name:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",placeholder:"Enter store name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Store Code *"}),e.jsx("input",{type:"text",value:D.code||"",onChange:z=>H({...D,code:z.target.value.toUpperCase()}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",placeholder:"e.g., STORE-001",required:!0})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center",children:e.jsx(is,{className:"w-4 h-4 text-white"})}),"Location Details"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),e.jsx("input",{type:"text",value:D.address||"",onChange:z=>H({...D,address:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-gray-900 font-medium transition-colors",placeholder:"Street address",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsx("input",{type:"text",value:D.city||"",onChange:z=>H({...D,city:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-gray-900 font-medium transition-colors",placeholder:"City",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State/Province"}),e.jsx("input",{type:"text",value:D.state||"",onChange:z=>H({...D,state:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-gray-900 font-medium transition-colors",placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ZIP/Postal Code"}),e.jsx("input",{type:"text",value:D.zip_code||"",onChange:z=>H({...D,zip_code:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-gray-900 font-medium transition-colors",placeholder:"ZIP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country *"}),e.jsx("input",{type:"text",value:D.country||"",onChange:z=>H({...D,country:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-gray-900 font-medium transition-colors",placeholder:"Country",required:!0})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center",children:e.jsx(Ts,{className:"w-4 h-4 text-white"})}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",value:D.phone||"",onChange:z=>H({...D,phone:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 text-gray-900 font-medium transition-colors",placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:D.email||"",onChange:z=>H({...D,email:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 text-gray-900 font-medium transition-colors",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Store Manager"}),e.jsxs("select",{value:D.manager_name||"",onChange:z=>H({...D,manager_name:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 bg-white text-gray-900 font-medium transition-colors",disabled:A,children:[e.jsx("option",{value:"",children:"Select a manager"}),k.map(z=>e.jsx("option",{value:z.full_name,children:z.full_name},z.id))]}),A&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Loading users..."})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(ot,{className:"w-4 h-4 text-white"})}),"Operating Hours"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Opening Time"}),e.jsx("input",{type:"time",value:D.opening_time||"",onChange:z=>H({...D,opening_time:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-gray-900 font-medium transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Closing Time"}),e.jsx("input",{type:"time",value:D.closing_time||"",onChange:z=>H({...D,closing_time:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-gray-900 font-medium transition-colors"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-500 rounded-lg flex items-center justify-center",children:e.jsx(Le,{className:"w-4 h-4 text-white"})}),"Data Isolation Configuration"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 ml-10",children:"Configure what data this branch shares with other branches. Toggle each feature individually."}),e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 border-2 border-indigo-200 rounded-xl",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Data Isolation Mode *"}),e.jsxs("select",{value:D.data_isolation_mode||"hybrid",onChange:z=>H({...D,data_isolation_mode:z.target.value}),className:"w-full px-4 py-3 border-2 border-indigo-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors bg-white",children:[e.jsx("option",{value:"shared",children:"Shared - All data is shared across all branches"}),e.jsx("option",{value:"isolated",children:"Isolated - Each branch has completely separate data"}),e.jsx("option",{value:"hybrid",children:"Hybrid - Configure sharing per data type (recommended)"})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:[D.data_isolation_mode==="shared"&&"All data types will be shared regardless of individual toggles below.",D.data_isolation_mode==="isolated"&&"All data types will be isolated regardless of individual toggles below.",D.data_isolation_mode==="hybrid"&&"Use the toggles below to configure which data types are shared."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[{key:"share_products",label:"Products & Catalog",Icon:Vs,description:"Share product catalog",category:"Core"},{key:"share_customers",label:"Customers",Icon:ze,description:"Share customer database",category:"Core"},{key:"share_inventory",label:"Inventory",Icon:oa,description:"Share inventory tracking",category:"Core"},{key:"share_suppliers",label:"Suppliers",Icon:ca,description:"Share supplier contacts",category:"Core"},{key:"share_categories",label:"Categories",Icon:da,description:"Share product categories",category:"Core"},{key:"share_employees",label:"Employees",Icon:Ga,description:"Share employee lists",category:"Core"},{key:"share_sales",label:"Sales Records",Icon:ma,description:"Share sales transactions",category:"Operations"},{key:"share_purchase_orders",label:"Purchase Orders",Icon:Ye,description:"Share purchase orders",category:"Operations"},{key:"share_devices",label:"Devices & Repairs",Icon:nt,description:"Share device repair records",category:"Operations"},{key:"share_payments",label:"Payments",Icon:ms,description:"Share payment records",category:"Operations"},{key:"share_accounts",label:"Accounts",Icon:ws,description:"Share financial accounts",category:"Operations"},{key:"share_appointments",label:"Appointments",Icon:lt,description:"Share customer appointments",category:"Operations"},{key:"share_reminders",label:"Reminders",Icon:ys,description:"Share task reminders",category:"Operations"},{key:"share_expenses",label:"Expenses",Icon:fs,description:"Share expense records",category:"Operations"},{key:"share_trade_ins",label:"Trade-Ins",Icon:Ha,description:"Share device trade-ins",category:"Operations"},{key:"share_special_orders",label:"Special Orders",Icon:Va,description:"Share custom orders",category:"Operations"},{key:"share_attendance",label:"Attendance",Icon:ua,description:"Share employee attendance",category:"Operations"},{key:"share_loyalty_points",label:"Loyalty Program",Icon:Pt,description:"Share loyalty points",category:"Operations"},{key:"share_gift_cards",label:"Gift Cards",Icon:Nt,description:"Share gift card programs",category:"Business"},{key:"share_quality_checks",label:"Quality Checks",Icon:ke,description:"Share quality control processes",category:"Business"},{key:"share_recurring_expenses",label:"Recurring Expenses",Icon:be,description:"Share automated expense schedules",category:"Business"},{key:"share_communications",label:"Communications",Icon:qs,description:"Share SMS/WhatsApp logs",category:"Business"},{key:"share_reports",label:"Reports",Icon:js,description:"Share daily reports and analytics",category:"Business"},{key:"share_finance_transfers",label:"Finance Transfers",Icon:zt,description:"Share financial transfers",category:"Business"}].map(({key:z,label:ae,Icon:je,description:Se,category:we})=>{const ve=D.data_isolation_mode==="isolated",_e=D.data_isolation_mode==="shared",ss=ve||_e;return e.jsxs("div",{className:`flex items-center justify-between p-3 border-2 rounded-xl transition-all ${ss?"opacity-60 cursor-not-allowed bg-gray-50":D[z]?"border-green-300 bg-green-50 hover:border-green-400":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx(je,{className:`w-5 h-5 flex-shrink-0 ${D[z]?"text-green-600":"text-gray-600"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:`text-sm font-semibold truncate ${D[z]?"text-green-900":"text-gray-900"}`,children:ae}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:Se})]})]}),e.jsxs("label",{className:`relative inline-flex items-center ml-3 flex-shrink-0 ${ss?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("input",{type:"checkbox",checked:D[z],onChange:Zs=>H({...D,[z]:Zs.target.checked}),disabled:ss,className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 ${ss?"bg-gray-100 cursor-not-allowed":"bg-gray-200 peer-focus:outline-none"} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600 shadow-sm`})]})]},z)})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-cyan-500 rounded-lg flex items-center justify-center",children:e.jsx(zt,{className:"w-4 h-4 text-white"})}),"Transfer & Synchronization"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 ml-10",children:"Configure stock transfer and synchronization settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:`flex items-center justify-between p-4 border-2 rounded-xl transition-all ${D.allow_stock_transfer?"border-cyan-300 bg-cyan-50 hover:border-cyan-400":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Allow Stock Transfers"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enable transferring stock between branches"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-3",children:[e.jsx("input",{type:"checkbox",checked:D.allow_stock_transfer,onChange:z=>H({...D,allow_stock_transfer:z.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600 shadow-sm"})]})]}),e.jsxs("div",{className:`flex items-center justify-between p-4 border-2 rounded-xl transition-all ${D.require_approval_for_transfers?"border-cyan-300 bg-cyan-50 hover:border-cyan-400":"border-gray-200 hover:border-gray-300"} ${D.allow_stock_transfer?"":"opacity-50"}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Require Approval for Transfers"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Transfers need manager approval"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-3",children:[e.jsx("input",{type:"checkbox",checked:D.require_approval_for_transfers,onChange:z=>H({...D,require_approval_for_transfers:z.target.checked}),disabled:!D.allow_stock_transfer,className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 ${D.allow_stock_transfer?"bg-gray-200 peer-focus:outline-none":"bg-gray-100 cursor-not-allowed"} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600 shadow-sm`})]})]}),e.jsxs("div",{className:`flex items-center justify-between p-4 border-2 rounded-xl transition-all ${D.auto_sync_products?"border-cyan-300 bg-cyan-50 hover:border-cyan-400":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Auto-Sync Products"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically sync product catalog changes"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-3",children:[e.jsx("input",{type:"checkbox",checked:D.auto_sync_products,onChange:z=>H({...D,auto_sync_products:z.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600 shadow-sm"})]})]}),e.jsxs("div",{className:`flex items-center justify-between p-4 border-2 rounded-xl transition-all ${D.auto_sync_prices?"border-cyan-300 bg-cyan-50 hover:border-cyan-400":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Auto-Sync Prices"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Keep prices synchronized across branches"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-3",children:[e.jsx("input",{type:"checkbox",checked:D.auto_sync_prices,onChange:z=>H({...D,auto_sync_prices:z.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600 shadow-sm"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-teal-500 rounded-lg flex items-center justify-center",children:e.jsx(ke,{className:"w-4 h-4 text-white"})}),"Branch Configuration"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 ml-10",children:"Configure branch settings and permissions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:`flex items-center justify-between p-4 border-2 rounded-xl transition-all ${D.is_main?"border-teal-300 bg-teal-50 hover:border-teal-400":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Main Store"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This is the primary/headquarters location"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-3",children:[e.jsx("input",{type:"checkbox",checked:D.is_main,onChange:z=>H({...D,is_main:z.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600 shadow-sm"})]})]}),e.jsxs("div",{className:`flex items-center justify-between p-4 border-2 rounded-xl transition-all ${D.is_active?"border-teal-300 bg-teal-50 hover:border-teal-400":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Active"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Store is currently operational"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-3",children:[e.jsx("input",{type:"checkbox",checked:D.is_active,onChange:z=>H({...D,is_active:z.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600 shadow-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pricing Model"}),e.jsxs("select",{value:D.pricing_model,onChange:z=>H({...D,pricing_model:z.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-teal-500 focus:ring-2 focus:ring-teal-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"centralized",children:"Centralized Pricing (Same prices for all stores)"}),e.jsx("option",{value:"location-specific",children:"Location-Specific Pricing"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Rate Override (%)"}),e.jsx("input",{type:"number",step:"0.01",value:D.tax_rate_override||"",onChange:z=>H({...D,tax_rate_override:parseFloat(z.target.value)}),disabled:D.pricing_model!=="location-specific",className:`w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-teal-500 focus:ring-2 focus:ring-teal-200 text-gray-900 font-medium transition-colors ${D.pricing_model!=="location-specific"?"bg-gray-50 cursor-not-allowed opacity-50":""}`,placeholder:D.pricing_model==="location-specific"?"Leave empty to use default tax rate":"Only available for location-specific pricing"})]})]})]})]})}),e.jsxs("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:[(!D.name||!D.code)&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 border border-orange-200 rounded-lg flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-orange-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"Please fill in all required fields (Store Name and Store Code) before saving."})]}),v&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-blue-700",children:"Changes are automatically saved to the database"})]}),e.jsxs("span",{className:"text-sm text-blue-600 font-medium",children:["Last saved: ",v.toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:ue,disabled:X||!D.name||!D.code,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3.5 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg",children:X?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-5 h-5"}),n.id?"Update Store":"Create Store"]})}),e.jsx("button",{onClick:ye,disabled:X,className:"px-6 py-3.5 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm",children:e.jsx(Ns,{className:"w-5 h-5"})})]})]})]})},(n,u)=>{const s=n.store.id!==u.store.id;return s||console.log("ðŸ”„ [StoreForm] Preventing re-render - store ID unchanged:",n.store.id),!s});return C.displayName="StoreForm",e.jsxs("div",{children:[!M&&!i&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ls,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex items-center justify-between flex-1",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Store & Branch Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your store locations and branches"})]}),e.jsxs("button",{onClick:()=>{y(null),I(!0)},className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl transition-all shadow-lg hover:shadow-xl",children:[e.jsx(Ge,{className:"w-5 h-5"}),"Add Store"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading stores..."})]})}):m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(ls,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"No stores configured yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:'Click "Add Store" to create your first location'})]}):e.jsx("div",{className:"space-y-4 py-4",children:m.map(n=>{const u=n.is_main,s=n.is_active;return e.jsx("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${u?"border-blue-500 shadow-xl":s?"border-green-200 hover:border-green-300 hover:shadow-md":"border-orange-300 hover:border-orange-400 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start justify-between p-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center transition-colors ${u?"bg-blue-500":s?"bg-green-500":"bg-gray-200"}`,children:e.jsx(ls,{className:`w-4 h-4 ${u||s?"text-white":"text-gray-500"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:n.name}),u&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-blue-500 text-white shadow-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Main Store"]}),s?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm",children:[e.jsx(ke,{className:"w-3 h-3"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-orange-500 text-white shadow-sm animate-pulse",children:[e.jsx(Fe,{className:"w-3 h-3"}),"Inactive"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-600 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[n.address,", ",n.city]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:n.phone||"No phone"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[n.opening_time," - ",n.closing_time]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:n.manager_name||"No manager assigned"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsxs("span",{className:"px-3 py-1.5 bg-gray-100 text-gray-700 text-xs rounded-xl font-semibold border border-gray-200",children:["Code: ",n.code]}),e.jsx("span",{className:`px-3 py-1.5 text-xs rounded-xl font-semibold border ${n.data_isolation_mode==="shared"?"bg-blue-100 text-blue-700 border-blue-200":n.data_isolation_mode==="isolated"?"bg-red-100 text-red-700 border-red-200":"bg-purple-100 text-purple-700 border-purple-200"}`,children:n.data_isolation_mode==="shared"?"Shared Data":n.data_isolation_mode==="isolated"?"Isolated Data":"Hybrid Model"}),e.jsx("span",{className:"px-3 py-1.5 bg-gray-100 text-gray-700 text-xs rounded-xl font-semibold border border-gray-200",children:n.pricing_model==="centralized"?"Centralized Pricing":"Location-Specific Pricing"}),n.allow_stock_transfer&&e.jsx("span",{className:"px-3 py-1.5 bg-green-100 text-green-700 text-xs rounded-xl font-semibold border border-green-200",children:"Stock Transfers"}),n.share_inventory&&e.jsx("span",{className:"px-3 py-1.5 bg-indigo-100 text-indigo-700 text-xs rounded-xl font-semibold border border-indigo-200",children:"Shared Inventory"})]})]})]})}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[!n.is_main&&e.jsxs("button",{onClick:()=>T(n.id,n.name),className:"flex items-center gap-1 px-4 py-2 text-yellow-600 hover:bg-yellow-50 rounded-xl transition-colors border-2 border-yellow-200 hover:border-yellow-300 font-semibold shadow-sm",title:"Set as main branch",children:[e.jsx(ws,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Set as Main"})]}),e.jsx("button",{onClick:()=>E(n.id),className:"p-2.5 text-blue-600 hover:bg-blue-50 rounded-xl transition-colors border-2 border-blue-200 hover:border-blue-300 shadow-sm",title:"Edit store",children:e.jsx(Ys,{className:"w-5 h-5"})}),!n.is_main&&e.jsx("button",{onClick:()=>x(n.id),className:"p-2.5 text-red-600 hover:bg-red-50 rounded-xl transition-colors border-2 border-red-200 hover:border-red-300 shadow-sm",title:"Delete store",children:e.jsx(Re,{className:"w-5 h-5"})})]})]})},n.id)})})})]}),(M||i)&&e.jsx(C,{store:$,onSave:j,onCancel:h,onStoreCreated:async n=>{await B()}},i!=null&&i.id?`edit-${i.id}`:"add-new-store")]})},Ie=r.forwardRef(({type:m="text",placeholder:w,value:N,onChange:P,onBlur:t,onFocus:p,className:i="",disabled:y=!1,required:M=!1,error:I,success:_=!1,loading:$=!1,icon:h,iconPosition:B="left",size:j="md",variant:x="default",fullWidth:T=!1,label:E,helperText:C,showPasswordToggle:n=!1,autoComplete:u,name:s,id:b,...R},S)=>{const[K,ee]=jt.useState(!1),[le,D]=jt.useState(!1),H={sm:"px-3 py-1.5 text-sm",md:"px-4 py-3 text-base",lg:"px-5 py-3 text-lg"},X={default:"bg-white border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20",glass:"bg-white/60 backdrop-blur-sm border border-white/20 focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20",outline:"bg-transparent border-2 border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"},a=I?"border-red-500 focus:border-red-500 focus:ring-red-500/20":_?"border-green-500 focus:border-green-500 focus:ring-green-500/20":"",f="rounded-lg transition-all duration-200 placeholder-gray-400 focus:outline-none",W=T?"w-full":"",v=y?"opacity-50 cursor-not-allowed":"",L=A=>{D(!0),p==null||p(A)},k=A=>{D(!1),t==null||t(A)},Y=m==="password"&&K?"text":m;return e.jsxs("div",{className:`${T?"w-full":""} ${i}`,children:[E&&e.jsxs("label",{htmlFor:b,className:"block text-sm font-medium text-gray-700 mb-1",children:[E,M&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[h&&B==="left"&&e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:h}),m==="search"&&!h&&e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(ps,{size:16})}),e.jsx("input",{ref:S,type:Y,id:b,name:s,value:N,onChange:P,onFocus:L,onBlur:k,placeholder:w,disabled:y||$,autoComplete:u,className:`
            ${f}
            ${H[j]}
            ${X[x]}
            ${a}
            ${W}
            ${v}
            ${h&&B==="left"?"pl-10":""}
            ${m==="search"&&!h?"pl-10":""}
            ${h&&B==="right"||n||I||_?"pr-10":""}
          `,...R}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[$&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),!$&&_&&e.jsx(ke,{size:16,className:"text-green-500"}),!$&&I&&e.jsx(xs,{size:16,className:"text-red-500"}),!$&&n&&m==="password"&&e.jsx("button",{type:"button",onClick:()=>ee(!K),className:"text-gray-400 hover:text-gray-600 transition-colors",children:K?e.jsx(_t,{size:16}):e.jsx(Js,{size:16})}),!$&&h&&B==="right"&&e.jsx("span",{className:"text-gray-400",children:h})]})]}),(C||I)&&e.jsx("p",{className:`mt-1 text-sm ${I?"text-red-600":"text-gray-500"}`,children:I||C})]})});Ie.displayName="EnhancedInput";const Wr=()=>{const[m,w]=r.useState([]),[N,P]=r.useState([]),[t,p]=r.useState(!0),[i,y]=r.useState("api-keys"),[M,I]=r.useState(!1),[_,$]=r.useState(!1),[h,B]=r.useState(null),[j,x]=r.useState(null),[T,E]=r.useState(new Set),[C,n]=r.useState({requests_per_minute:60,requests_per_hour:1e3,requests_per_day:1e4,enable_rate_limiting:!0,whitelist_ips:[],blacklist_ips:[]}),u=[{id:"products:read",label:"Read Products",description:"View product information"},{id:"products:write",label:"Write Products",description:"Create/update products"},{id:"orders:read",label:"Read Orders",description:"View order information"},{id:"orders:write",label:"Write Orders",description:"Create/update orders"},{id:"customers:read",label:"Read Customers",description:"View customer information"},{id:"customers:write",label:"Write Customers",description:"Create/update customers"},{id:"inventory:read",label:"Read Inventory",description:"View inventory levels"},{id:"inventory:write",label:"Write Inventory",description:"Update inventory levels"},{id:"reports:read",label:"Read Reports",description:"Access reports and analytics"}],s=[{id:"order.created",label:"Order Created"},{id:"order.updated",label:"Order Updated"},{id:"order.cancelled",label:"Order Cancelled"},{id:"product.created",label:"Product Created"},{id:"product.updated",label:"Product Updated"},{id:"customer.created",label:"Customer Created"},{id:"customer.updated",label:"Customer Updated"},{id:"inventory.low",label:"Low Inventory Alert"},{id:"payment.received",label:"Payment Received"},{id:"payment.failed",label:"Payment Failed"}];r.useEffect(()=>{b()},[]);const b=async()=>{p(!0);try{const{data:v,error:L}=await Z.from("api_keys").select("*").order("created_at",{ascending:!1});L?console.error("Error loading API keys:",L):w(v||[]);const{data:k,error:Y}=await Z.from("webhook_endpoints").select("*").order("created_at",{ascending:!1});Y?console.error("Error loading webhooks:",Y):P(k||[]);const{data:A,error:V}=await Z.from("settings").select("*").eq("key","api_rate_limits").single();if(!V&&A)try{const Q=JSON.parse(A.value);n(Q)}catch(Q){console.error("Error parsing rate limit settings:",Q)}}catch(v){console.error("Error loading settings:",v),o.error("Failed to load API settings")}finally{p(!1)}},R=()=>{const v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let L="sk_";for(let k=0;k<48;k++)L+=v.charAt(Math.floor(Math.random()*v.length));return L},S=()=>{const v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let L="whsec_";for(let k=0;k<32;k++)L+=v.charAt(Math.floor(Math.random()*v.length));return L},K=async v=>{try{if(v.id){const{error:L}=await Z.from("api_keys").update(v).eq("id",v.id);if(L)throw L;o.success("API key updated successfully")}else{const L={...v,key:R()},{error:k}=await Z.from("api_keys").insert([L]);if(k)throw k;o.success("API key created successfully")}I(!1),B(null),b()}catch(L){console.error("Error saving API key:",L),o.error(L.message||"Failed to save API key")}},ee=async v=>{try{if(v.id){const{error:L}=await Z.from("webhook_endpoints").update(v).eq("id",v.id);if(L)throw L;o.success("Webhook updated successfully")}else{const L={...v,secret:S()},{error:k}=await Z.from("webhook_endpoints").insert([L]);if(k)throw k;o.success("Webhook created successfully")}$(!1),x(null),b()}catch(L){console.error("Error saving webhook:",L),o.error(L.message||"Failed to save webhook")}},le=async v=>{if(confirm("Are you sure you want to delete this API key?"))try{const{error:L}=await Z.from("api_keys").delete().eq("id",v);if(L)throw L;o.success("API key deleted successfully"),b()}catch(L){o.error(L.message||"Failed to delete API key")}},D=async v=>{if(confirm("Are you sure you want to delete this webhook?"))try{const{error:L}=await Z.from("webhook_endpoints").delete().eq("id",v);if(L)throw L;o.success("Webhook deleted successfully"),b()}catch(L){o.error(L.message||"Failed to delete webhook")}},H=async v=>{try{o.loading("Testing webhook...");const L=await fetch(v.url,{method:"POST",headers:{"Content-Type":"application/json","X-Webhook-Secret":v.secret},body:JSON.stringify({event:"test.webhook",data:{message:"This is a test webhook event"},timestamp:new Date().toISOString()})});o.dismiss(),L.ok?o.success("Webhook test successful!"):o.error(`Webhook test failed: ${L.statusText}`)}catch(L){o.dismiss(),o.error(`Webhook test failed: ${L.message}`)}},X=(v,L)=>{navigator.clipboard.writeText(v),o.success(`${L} copied to clipboard`)},a=v=>{E(L=>{const k=new Set(L);return k.has(v)?k.delete(v):k.add(v),k})},f=v=>v.length<=12?v:v.substring(0,10)+"â€¢".repeat(v.length-14)+v.substring(v.length-4),W=async()=>{try{const{error:v}=await Z.from("settings").upsert({key:"api_rate_limits",value:JSON.stringify(C)},{onConflict:"key"});if(v)throw v;o.success("Rate limit settings saved successfully")}catch(v){o.error(v.message||"Failed to save rate limit settings")}};return t?e.jsx($e,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Loading API settings..."})]})}):e.jsxs($e,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($t,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"API & Webhooks"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage API keys, webhooks, and rate limits"})]})]})}),e.jsxs("div",{className:"flex gap-2 mb-6 border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>y("api-keys"),className:`px-4 py-2 font-medium transition-colors ${i==="api-keys"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Ut,{className:"w-4 h-4 inline mr-2"}),"API Keys"]}),e.jsxs("button",{onClick:()=>y("webhooks"),className:`px-4 py-2 font-medium transition-colors ${i==="webhooks"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Gt,{className:"w-4 h-4 inline mr-2"}),"Webhooks"]}),e.jsxs("button",{onClick:()=>y("rate-limits"),className:`px-4 py-2 font-medium transition-colors ${i==="rate-limits"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(vs,{className:"w-4 h-4 inline mr-2"}),"Rate Limits"]})]}),i==="api-keys"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"API keys allow external applications to access your system"}),!M&&!h&&e.jsxs(ge,{onClick:()=>I(!0),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Generate API Key"]})]}),(M||h)&&e.jsx(qr,{apiKey:h||{name:"",key:"",scopes:[],is_active:!0},onSave:K,onCancel:()=>{I(!1),B(null)},availableScopes:u}),e.jsx("div",{className:"space-y-3",children:m.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Ut,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No API keys configured"})]}):m.map(v=>e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:v.name}),v.is_active?e.jsx(ke,{className:"w-5 h-5 text-green-500"}):e.jsx(gs,{className:"w-5 h-5 text-red-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("code",{className:"text-sm bg-gray-100 px-3 py-1 rounded font-mono",children:T.has(v.id)?v.key:f(v.key)}),e.jsx("button",{onClick:()=>a(v.id),className:"p-1 hover:bg-gray-100 rounded",children:T.has(v.id)?e.jsx(_t,{className:"w-4 h-4 text-gray-600"}):e.jsx(Js,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>X(v.key,"API key"),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(xa,{className:"w-4 h-4 text-gray-600"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:v.scopes.map(L=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded",children:L},L))}),v.last_used&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Last used: ",new Date(v.last_used).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>B(v),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(Ys,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>le(v.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Re,{className:"w-5 h-5"})})]})]})},v.id))})]}),i==="webhooks"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Webhooks notify your application when events happen"}),!_&&!j&&e.jsxs(ge,{onClick:()=>$(!0),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Add Webhook"]})]}),(_||j)&&e.jsx(zr,{webhook:j||{name:"",url:"",events:[],is_active:!0,secret:"",retry_attempts:3,timeout_seconds:30,success_count:0,failure_count:0},onSave:ee,onCancel:()=>{$(!1),x(null)},availableEvents:s}),e.jsx("div",{className:"space-y-3",children:N.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Gt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No webhooks configured"})]}):N.map(v=>e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:v.name}),v.is_active?e.jsx(ke,{className:"w-5 h-5 text-green-500"}):e.jsx(gs,{className:"w-5 h-5 text-red-500"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:v.url}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:v.events.map(L=>e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded",children:L},L))}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["âœ… ",v.success_count," successful"]}),e.jsxs("span",{children:["âŒ ",v.failure_count," failed"]}),e.jsxs("span",{children:["â±ï¸ ",v.timeout_seconds,"s timeout"]}),e.jsxs("span",{children:["ðŸ”„ ",v.retry_attempts," retries"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>H(v),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg",title:"Test Webhook",children:e.jsx(vs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>x(v),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(Ys,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>D(v.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Re,{className:"w-5 h-5"})})]})]})},v.id))})]}),i==="rate-limits"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(vs,{className:"h-5 w-5 text-blue-600 mr-2"}),"Rate Limiting Configuration"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx(Ie,{label:"Requests per Minute",type:"number",value:C.requests_per_minute,onChange:v=>n({...C,requests_per_minute:parseInt(v.target.value)})}),e.jsx(Ie,{label:"Requests per Hour",type:"number",value:C.requests_per_hour,onChange:v=>n({...C,requests_per_hour:parseInt(v.target.value)})}),e.jsx(Ie,{label:"Requests per Day",type:"number",value:C.requests_per_day,onChange:v=>n({...C,requests_per_day:parseInt(v.target.value)})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Enable Rate Limiting"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C.enable_rate_limiting,onChange:v=>n({...C,enable_rate_limiting:v.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(ge,{onClick:W,className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Save Rate Limits"]})})]})]})},qr=({apiKey:m,onSave:w,onCancel:N,availableScopes:P})=>{const[t,p]=r.useState(m),i=y=>{const M=t.scopes.includes(y)?t.scopes.filter(I=>I!==y):[...t.scopes,y];p({...t,scopes:M})};return e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-blue-200 space-y-4",children:[e.jsx(Ie,{label:"API Key Name *",value:t.name,onChange:y=>p({...t,name:y.target.value}),placeholder:"e.g., Mobile App API Key",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions (Scopes)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:P.map(y=>e.jsxs("label",{className:"flex items-start p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:t.scopes.includes(y.id),onChange:()=>i(y.id),className:"mt-1 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:y.label}),e.jsx("div",{className:"text-xs text-gray-600",children:y.description})]})]},y.id))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.is_active,onChange:y=>p({...t,is_active:y.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ge,{onClick:()=>w(t),disabled:!t.name||t.scopes.length===0,className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),m.id?"Update":"Generate"," API Key"]}),e.jsx(ge,{onClick:N,variant:"outline",children:"Cancel"})]})]})},zr=({webhook:m,onSave:w,onCancel:N,availableEvents:P})=>{const[t,p]=r.useState(m),i=y=>{const M=t.events.includes(y)?t.events.filter(I=>I!==y):[...t.events,y];p({...t,events:M})};return e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-purple-200 space-y-4",children:[e.jsx(Ie,{label:"Webhook Name *",value:t.name,onChange:y=>p({...t,name:y.target.value}),placeholder:"e.g., Order Notification Webhook",required:!0}),e.jsx(Ie,{label:"Webhook URL *",value:t.url,onChange:y=>p({...t,url:y.target.value}),placeholder:"https://your-app.com/webhooks/endpoint",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Events to Listen For"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:P.map(y=>e.jsxs("label",{className:"flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:t.events.includes(y.id),onChange:()=>i(y.id),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:y.label})]},y.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Ie,{label:"Retry Attempts",type:"number",value:t.retry_attempts,onChange:y=>p({...t,retry_attempts:parseInt(y.target.value)}),min:"0",max:"10"}),e.jsx(Ie,{label:"Timeout (seconds)",type:"number",value:t.timeout_seconds,onChange:y=>p({...t,timeout_seconds:parseInt(y.target.value)}),min:"5",max:"120"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.is_active,onChange:y=>p({...t,is_active:y.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ge,{onClick:()=>w(t),disabled:!t.name||!t.url||t.events.length===0,className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),m.id?"Update":"Create"," Webhook"]}),e.jsx(ge,{onClick:N,variant:"outline",children:"Cancel"})]})]})},Ur=()=>{const[m,w]=r.useState(!0),[N,P]=r.useState(!1),[t,p]=r.useState("points-config"),[i,y]=r.useState({enabled:!0,points_per_currency:1,currency_per_point:.01,min_purchase_for_points:1,points_expiry_days:365,enable_birthday_bonus:!0,birthday_bonus_points:500,enable_referral_bonus:!0,referral_bonus_points:1e3,enable_tiers:!0,tiers:[{name:"Bronze",min_points:0,max_points:999,discount_percentage:5,special_benefits:["Early sale access","Birthday bonus"],color:"#CD7F32",icon:"star"},{name:"Silver",min_points:1e3,max_points:4999,discount_percentage:10,special_benefits:["Early sale access","Birthday bonus","Free shipping"],color:"#C0C0C0",icon:"award"},{name:"Gold",min_points:5e3,max_points:9999,discount_percentage:15,special_benefits:["Early sale access","Birthday bonus","Free shipping","Priority support"],color:"#FFD700",icon:"crown"},{name:"Platinum",min_points:1e4,discount_percentage:20,special_benefits:["Early sale access","Birthday bonus","Free shipping","Priority support","Exclusive events"],color:"#E5E4E2",icon:"sparkles"}],welcome_bonus_points:100,min_redemption_points:100,max_redemption_percent:50}),[M,I]=r.useState(null),[_,$]=r.useState(!1),h=n=>{p(t===n?"":n)};r.useEffect(()=>{B()},[]);const B=async()=>{w(!0);try{const{data:n,error:u}=await Z.from("settings").select("*").eq("key","loyalty_program").single();if(u)console.error("Error loading loyalty settings:",u);else if(n)try{const s=JSON.parse(n.value);y(s)}catch(s){console.error("Error parsing loyalty settings:",s)}}catch(n){console.error("Error loading settings:",n),o.error("Failed to load loyalty program settings")}finally{w(!1)}},j=async()=>{P(!0);try{const{error:n}=await Z.from("settings").upsert({key:"loyalty_program",value:JSON.stringify(i)},{onConflict:"key"});if(n)throw n;o.success("Loyalty program settings saved successfully")}catch(n){console.error("Error saving settings:",n),o.error(n.message||"Failed to save settings")}finally{P(!1)}},x=n=>{y({...i,tiers:[...i.tiers,n]}),$(!1)},T=(n,u)=>{const s=[...i.tiers];s[n]=u,y({...i,tiers:s}),I(null)},E=n=>{if(!confirm("Are you sure you want to delete this tier?"))return;const u=i.tiers.filter((s,b)=>b!==n);y({...i,tiers:u}),o.success("Tier deleted successfully")},C=({tier:n,onSave:u,onCancel:s})=>{const[b,R]=r.useState(n);return e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-blue-200 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Ie,{label:"Tier Name *",value:b.name,onChange:S=>R({...b,name:S.target.value}),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tier Color"}),e.jsx("input",{type:"color",value:b.color,onChange:S=>R({...b,color:S.target.value}),className:"w-full h-10 rounded border border-gray-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Ie,{label:"Min Points *",type:"number",value:b.min_points,onChange:S=>R({...b,min_points:parseInt(S.target.value)}),required:!0}),e.jsx(Ie,{label:"Max Points",type:"number",value:b.max_points||"",onChange:S=>R({...b,max_points:S.target.value?parseInt(S.target.value):void 0}),placeholder:"Leave empty for no limit"}),e.jsx(Ie,{label:"Discount % *",type:"number",step:"0.1",value:b.discount_percentage,onChange:S=>R({...b,discount_percentage:parseFloat(S.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Benefits (one per line)"}),e.jsx("textarea",{value:b.special_benefits.join(`
`),onChange:S=>R({...b,special_benefits:S.target.value.split(`
`).filter(K=>K.trim())}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,placeholder:`e.g., Free shipping
Priority support
Exclusive discounts`})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ge,{onClick:()=>u(b),disabled:!b.name,className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Save Tier"]}),e.jsx(ge,{onClick:s,variant:"outline",children:"Cancel"})]})]})};return m?e.jsx($e,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Loading loyalty program settings..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx($e,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Nt,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Loyalty Program"}),e.jsx("p",{className:"text-xs text-gray-600",children:i.enabled?"Customers can earn and redeem points":"Program is currently disabled"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.enabled,onChange:n=>y({...i,enabled:n.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"})]})]})}),e.jsxs($e,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("points-config"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Cs,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Points Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure how customers earn and redeem points"})]})]}),t==="points-config"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),t==="points-config"&&e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Ie,{label:"Points per Dollar Spent",type:"number",step:"0.1",value:i.points_per_currency,onChange:n=>y({...i,points_per_currency:parseFloat(n.target.value)}),help:"How many points customers earn per dollar spent"}),e.jsx(Ie,{label:"Dollar Value per Point",type:"number",step:"0.01",value:i.currency_per_point,onChange:n=>y({...i,currency_per_point:parseFloat(n.target.value)}),help:"How much each point is worth when redeemed"}),e.jsx(Ie,{label:"Minimum Purchase for Points ($)",type:"number",value:i.min_purchase_for_points,onChange:n=>y({...i,min_purchase_for_points:parseFloat(n.target.value)})}),e.jsx(Ie,{label:"Points Expiry (days)",type:"number",value:i.points_expiry_days,onChange:n=>y({...i,points_expiry_days:parseInt(n.target.value)}),help:"0 = never expire"}),e.jsx(Ie,{label:"Welcome Bonus Points",type:"number",value:i.welcome_bonus_points,onChange:n=>y({...i,welcome_bonus_points:parseInt(n.target.value)}),help:"Points given to new customers"}),e.jsx(Ie,{label:"Minimum Redemption Points",type:"number",value:i.min_redemption_points,onChange:n=>y({...i,min_redemption_points:parseInt(n.target.value)}),help:"Minimum points needed to redeem"}),e.jsx(Ie,{label:"Max Redemption Percentage (%)",type:"number",value:i.max_redemption_percent,onChange:n=>y({...i,max_redemption_percent:parseInt(n.target.value)}),help:"Max % of purchase that can be paid with points"})]})})]}),e.jsxs($e,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("bonus-programs"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Nt,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bonus Programs"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure birthday and referral bonuses"})]})]}),t==="bonus-programs"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),t==="bonus-programs"&&e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4 text-pink-600"}),"Birthday Bonus"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Give bonus points on customer's birthday"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.enable_birthday_bonus,onChange:n=>y({...i,enable_birthday_bonus:n.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600"})]})]}),i.enable_birthday_bonus&&e.jsx(Ie,{label:"Birthday Bonus Points",type:"number",value:i.birthday_bonus_points,onChange:n=>y({...i,birthday_bonus_points:parseInt(n.target.value)})}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-green-600"}),"Referral Bonus"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Give bonus points for referring new customers"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.enable_referral_bonus,onChange:n=>y({...i,enable_referral_bonus:n.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),i.enable_referral_bonus&&e.jsx(Ie,{label:"Referral Bonus Points",type:"number",value:i.referral_bonus_points,onChange:n=>y({...i,referral_bonus_points:parseInt(n.target.value)})})]})})]}),e.jsxs($e,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("loyalty-tiers"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(Pt,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Loyalty Tiers"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create and manage customer loyalty tiers"})]})]}),t==="loyalty-tiers"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),t==="loyalty-tiers"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.enable_tiers,onChange:n=>y({...i,enable_tiers:n.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"})]}),i.enable_tiers&&!_&&!M&&e.jsxs(ge,{onClick:()=>$(!0),size:"sm",className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Add Tier"]})]})}),i.enable_tiers&&e.jsxs(e.Fragment,{children:[(_||M)&&e.jsx("div",{className:"mb-4",children:e.jsx(C,{tier:M||{name:"",min_points:0,discount_percentage:5,special_benefits:[],color:"#3B82F6",icon:"star"},onSave:n=>{if(M){const u=i.tiers.findIndex(s=>s.name===M.name);T(u,n)}else x(n)},onCancel:()=>{$(!1),I(null)}})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.tiers.map((n,u)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2",style:{borderColor:n.color},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.icon==="crown"&&e.jsx(Ka,{className:"w-5 h-5",style:{color:n.color}}),n.icon==="sparkles"&&e.jsx(Ja,{className:"w-5 h-5",style:{color:n.color}}),n.icon==="star"&&e.jsx(ws,{className:"w-5 h-5",style:{color:n.color}}),n.icon==="award"&&e.jsx(Pt,{className:"w-5 h-5",style:{color:n.color}}),e.jsx("h5",{className:"font-semibold text-gray-900",children:n.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(n),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Ot,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>E(u),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Re,{className:"w-4 h-4 text-red-600"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Points Range:"}),e.jsxs("span",{className:"font-medium",children:[n.min_points," - ",n.max_points||"âˆž"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Discount:"}),e.jsxs("span",{className:"font-medium",children:[n.discount_percentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Benefits:"}),e.jsx("ul",{className:"mt-1 space-y-1",children:n.special_benefits.map((s,b)=>e.jsxs("li",{className:"text-xs text-gray-700 flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full"}),s]},b))})]})]})]},u))})]})]})]}),e.jsx($e,{className:"p-6",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs(ge,{onClick:B,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Reset"]}),e.jsxs(ge,{onClick:j,disabled:N,className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),N?"Saving...":"Save Loyalty Settings"]})]})})]})},Gr=()=>{const[m,w]=r.useState([]),[N,P]=r.useState(!0),[t,p]=r.useState(!1),[i,y]=r.useState(null),[M,I]=r.useState(null),[_,$]=r.useState("list"),h=[{value:"invoice",label:"Invoice",icon:Ye,description:"Sales invoice template"},{value:"quote",label:"Quote",icon:Qa,description:"Quote/Estimate template"},{value:"purchase_order",label:"Purchase Order",icon:Ue,description:"Purchase order template"},{value:"repair_order",label:"Repair Order",icon:Ye,description:"Repair service order template"},{value:"receipt",label:"Receipt",icon:ma,description:"Payment receipt template"}],B=[{var:"{{business_name}}",description:"Business name"},{var:"{{business_address}}",description:"Business address"},{var:"{{business_phone}}",description:"Business phone"},{var:"{{business_email}}",description:"Business email"},{var:"{{customer_name}}",description:"Customer name"},{var:"{{customer_address}}",description:"Customer address"},{var:"{{customer_phone}}",description:"Customer phone"},{var:"{{customer_email}}",description:"Customer email"},{var:"{{document_number}}",description:"Document number"},{var:"{{document_date}}",description:"Document date"},{var:"{{due_date}}",description:"Due date"},{var:"{{items_table}}",description:"Items table"},{var:"{{subtotal}}",description:"Subtotal amount"},{var:"{{tax}}",description:"Tax amount"},{var:"{{discount}}",description:"Discount amount"},{var:"{{total}}",description:"Total amount"},{var:"{{amount_paid}}",description:"Amount paid"},{var:"{{balance_due}}",description:"Balance due"},{var:"{{payment_method}}",description:"Payment method"},{var:"{{notes}}",description:"Additional notes"},{var:"{{terms}}",description:"Terms and conditions"}],j=s=>`<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .header { text-align: center; margin-bottom: 30px; }
    .logo { max-width: 200px; }
    .business-info { text-align: center; margin-bottom: 20px; }
    .document-title { font-size: 24px; font-weight: bold; margin: 20px 0; }
    .customer-info { margin: 20px 0; padding: 15px; background: #f5f5f5; }
    .items-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    .items-table th { background: #333; color: white; padding: 10px; text-align: left; }
    .items-table td { padding: 10px; border-bottom: 1px solid #ddd; }
    .totals { margin-top: 20px; float: right; width: 300px; }
    .totals-row { display: flex; justify-content: space-between; padding: 5px 0; }
    .total-row { font-weight: bold; font-size: 18px; border-top: 2px solid #333; padding-top: 10px; }
    .footer { margin-top: 50px; text-align: center; color: #666; font-size: 12px; }
  </style>
</head>
<body>
  <div class="header">
    {{#if show_logo}}
    <img src="{{logo_url}}" alt="Logo" class="logo">
    {{/if}}
  </div>
  
  {{#if show_business_info}}
  <div class="business-info">
    <h2>{{business_name}}</h2>
    <p>{{business_address}}</p>
    <p>Phone: {{business_phone}} | Email: {{business_email}}</p>
  </div>
  {{/if}}
  
  <div class="document-title">${s.toUpperCase()}</div>
  
  <div style="display: flex; justify-content: space-between;">
    <div>
      <strong>${s} Number:</strong> {{document_number}}<br>
      <strong>Date:</strong> {{document_date}}<br>
      {{#if due_date}}
      <strong>Due Date:</strong> {{due_date}}
      {{/if}}
    </div>
    
    {{#if show_customer_info}}
    <div class="customer-info">
      <strong>Bill To:</strong><br>
      {{customer_name}}<br>
      {{customer_address}}<br>
      {{customer_phone}}<br>
      {{customer_email}}
    </div>
    {{/if}}
  </div>
  
  {{items_table}}
  
  <div class="totals">
    <div class="totals-row">
      <span>Subtotal:</span>
      <span>{{subtotal}}</span>
    </div>
    <div class="totals-row">
      <span>Tax:</span>
      <span>{{tax}}</span>
    </div>
    <div class="totals-row">
      <span>Discount:</span>
      <span>{{discount}}</span>
    </div>
    <div class="totals-row total-row">
      <span>Total:</span>
      <span>{{total}}</span>
    </div>
    {{#if show_payment_info}}
    <div class="totals-row">
      <span>Amount Paid:</span>
      <span>{{amount_paid}}</span>
    </div>
    <div class="totals-row">
      <span>Balance Due:</span>
      <span>{{balance_due}}</span>
    </div>
    {{/if}}
  </div>
  
  <div style="clear: both;"></div>
  
  {{#if notes}}
  <div style="margin-top: 30px;">
    <strong>Notes:</strong>
    <p>{{notes}}</p>
  </div>
  {{/if}}
  
  {{#if show_terms}}
  <div class="footer">
    <strong>Terms & Conditions:</strong>
    <p>{{terms}}</p>
  </div>
  {{/if}}
  
  {{#if show_signature}}
  <div style="margin-top: 50px;">
    <div style="border-top: 1px solid #000; width: 200px; margin: 0 auto;">
      <p style="text-align: center; margin-top: 5px;">Signature</p>
    </div>
  </div>
  {{/if}}
</body>
</html>`;r.useEffect(()=>{x()},[]);const x=async()=>{P(!0);try{const{data:s,error:b}=await Z.from("document_templates").select("*").order("type",{ascending:!0});if(b)throw b;w(s||[])}catch(s){console.error("Error loading templates:",s),o.error("Failed to load document templates")}finally{P(!1)}},T=async s=>{p(!0);try{if(s.id){const{error:b}=await Z.from("document_templates").update(s).eq("id",s.id);if(b)throw b;o.success("Template updated successfully")}else{const{error:b}=await Z.from("document_templates").insert([s]);if(b)throw b;o.success("Template created successfully")}x(),$("list"),y(null)}catch(b){console.error("Error saving template:",b),o.error(b.message||"Failed to save template")}finally{p(!1)}},E=async()=>{try{const s=h.map(R=>({type:R.value,name:`Default ${R.label}`,content:j(R.value),is_default:!0,variables:B.map(S=>S.var),paper_size:"A4",orientation:"portrait",show_logo:!0,show_business_info:!0,show_customer_info:!0,show_payment_info:!0,show_terms:!0,terms_text:"Payment is due within 30 days. Late payments may incur additional charges.",show_signature:!0})),{error:b}=await Z.from("document_templates").insert(s);if(b)throw b;o.success("Default templates created successfully"),x()}catch(s){console.error("Error creating default templates:",s),o.error(s.message||"Failed to create default templates")}},C=async s=>{const b={...s,id:void 0,name:`${s.name} (Copy)`,is_default:!1};try{const{error:R}=await Z.from("document_templates").insert([b]);if(R)throw R;o.success("Template duplicated successfully"),x()}catch(R){o.error(R.message||"Failed to duplicate template")}},n=s=>{const b=new Blob([s.content],{type:"text/html"}),R=URL.createObjectURL(b),S=document.createElement("a");S.href=R,S.download=`${s.name.replace(/\s+/g,"-")}.html`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(R),o.success("Template downloaded")},u=({template:s})=>{const[b,R]=r.useState(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Template Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Ie,{label:"Template Name *",value:b.name,onChange:S=>R({...b,name:S.target.value}),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Document Type *"}),e.jsx("select",{value:b.type,onChange:S=>R({...b,type:S.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:h.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paper Size"}),e.jsxs("select",{value:b.paper_size,onChange:S=>R({...b,paper_size:S.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"A4",children:"A4"}),e.jsx("option",{value:"Letter",children:"Letter"}),e.jsx("option",{value:"Thermal-80mm",children:"Thermal 80mm"}),e.jsx("option",{value:"Thermal-58mm",children:"Thermal 58mm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Orientation"}),e.jsxs("select",{value:b.orientation,onChange:S=>R({...b,orientation:S.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"portrait",children:"Portrait"}),e.jsx("option",{value:"landscape",children:"Landscape"})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Display Options"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{key:"show_logo",label:"Show Logo"},{key:"show_business_info",label:"Show Business Info"},{key:"show_customer_info",label:"Show Customer Info"},{key:"show_payment_info",label:"Show Payment Info"},{key:"show_terms",label:"Show Terms & Conditions"},{key:"show_signature",label:"Show Signature Line"}].map(({key:S,label:K})=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:K}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b[S],onChange:ee=>R({...b,[S]:ee.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]},S))})]}),b.show_logo&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(Ya,{className:"w-5 h-5 text-purple-600 mr-2"}),"Logo Configuration"]}),e.jsx(Ie,{label:"Logo URL",value:b.logo_url||"",onChange:S=>R({...b,logo_url:S.target.value}),placeholder:"https://example.com/logo.png"})]}),b.show_terms&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Terms & Conditions"}),e.jsx("textarea",{value:b.terms_text||"",onChange:S=>R({...b,terms_text:S.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",rows:4,placeholder:"Enter terms and conditions..."})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-slate-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx($t,{className:"w-5 h-5 text-gray-600 mr-2"}),"HTML Template"]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-blue-800 font-medium mb-2 flex items-center",children:[e.jsx(xs,{className:"w-4 h-4 mr-2"}),"Available Variables:"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:B.map(S=>e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(S.var),o.success(`Copied: ${S.var}`)},className:"text-left p-2 bg-white rounded hover:bg-blue-100 transition-colors",title:S.description,children:e.jsx("code",{className:"text-blue-600",children:S.var})},S.var))})]})}),e.jsx("textarea",{value:b.content,onChange:S=>R({...b,content:S.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-gray-500 font-mono text-sm",rows:20,placeholder:"Enter HTML template..."})]}),e.jsxs("div",{className:"flex justify-between gap-3 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ge,{onClick:()=>I(b),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Js,{className:"w-4 h-4"}),"Preview"]}),e.jsxs(ge,{onClick:()=>n(b),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4"}),"Download"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ge,{onClick:()=>{$("list"),y(null)},variant:"outline",children:"Cancel"}),e.jsxs(ge,{onClick:()=>T(b),disabled:t||!b.name,className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),t?"Saving...":"Save Template"]})]})]})]})};return N?e.jsx($e,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Loading document templates..."})]})}):e.jsxs($e,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ye,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Document Templates"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customize invoice, quote, and order templates"})]})]}),_==="list"&&e.jsxs("div",{className:"flex gap-2",children:[m.length===0&&e.jsxs(ge,{onClick:E,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Create Default Templates"]}),e.jsxs(ge,{onClick:()=>{y({type:"invoice",name:"",content:j("invoice"),is_default:!1,variables:B.map(s=>s.var),paper_size:"A4",orientation:"portrait",show_logo:!0,show_business_info:!0,show_customer_info:!0,show_payment_info:!0,show_terms:!0,show_signature:!0}),$("edit")},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ge,{className:"w-4 h-4"}),"New Template"]})]})]}),_==="list"&&e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(Ye,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No document templates configured"}),e.jsx(ge,{onClick:E,className:"bg-blue-600 hover:bg-blue-700",children:"Create Default Templates"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map(s=>{var S;const b=h.find(K=>K.value===s.type),R=(b==null?void 0:b.icon)||Ye;return e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:b==null?void 0:b.label})]})]}),s.is_default&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded",children:"Default"})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 mb-3",children:[e.jsxs("p",{children:["Paper: ",s.paper_size," â€¢ ",s.orientation]}),e.jsxs("p",{children:[((S=s.variables)==null?void 0:S.length)||0," variables configured"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{y(s),$("edit")},className:"flex-1 p-2 text-blue-600 hover:bg-blue-50 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Ys,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>C(s),className:"flex-1 p-2 text-purple-600 hover:bg-purple-50 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[e.jsx(xa,{className:"w-4 h-4"}),"Duplicate"]}),e.jsxs("button",{onClick:()=>n(s),className:"flex-1 p-2 text-green-600 hover:bg-green-50 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[e.jsx(us,{className:"w-4 h-4"}),"Download"]})]})]},s.id)})})}),_==="edit"&&i&&e.jsx(u,{template:i}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Template Preview"}),e.jsx("button",{onClick:()=>I(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Hr,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("iframe",{srcDoc:M.content,className:"w-full h-[600px] border-2 border-gray-200 rounded-lg",title:"Template Preview"})})]})})]})},Hr=({className:m})=>e.jsx("svg",{className:m,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),se=({label:m,description:w,checked:N,onChange:P,icon:t})=>e.jsxs("div",{className:"flex items-start justify-between p-4 bg-white rounded-xl border-2 border-gray-200 hover:border-indigo-300 transition-all shadow-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t,e.jsx("span",{className:"text-xs font-medium text-gray-900",children:m})]}),w&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 ml-6",children:w})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:p=>P(p.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"})]})]}),Vr=()=>{const{registerSaveHandler:m,unregisterSaveHandler:w,setHasChanges:N,hasChanges:P}=Ps(),[t,p]=r.useState(null),[i,y]=r.useState(!0),[M,I]=r.useState(!1),[_,$]=r.useState(null),[h,B]=r.useState("stock-management");r.useEffect(()=>{j()},[]);const j=async()=>{y(!0);try{const s=await br();p(s),N(!1)}catch(s){console.error("Error loading inventory settings:",s),o.error("Failed to load inventory settings")}finally{y(!1)}},x=(s,b)=>{t&&(p({...t,[s]:b}),N(!0))},T=s=>{B(h===s?"":s)},E=r.useCallback(async()=>{if(t){I(!0);try{await fr(t),N(!1),$(new Date),o.success("Inventory settings saved successfully!")}catch(s){console.error("Error saving inventory settings:",s),o.error("Failed to save inventory settings")}finally{I(!1)}}},[t,N]);r.useEffect(()=>{if(t)return m("inventory-settings",E),()=>w("inventory-settings")},[t,E,m,w]),r.useEffect(()=>{t&&N(!0)},[t,N]);const C=async()=>{if(confirm("Are you sure you want to reset all inventory settings to defaults? This action cannot be undone.")){I(!0);try{await yr(),await j(),o.success("Inventory settings reset to defaults")}catch(s){console.error("Error resetting inventory settings:",s),o.error("Failed to reset inventory settings")}finally{I(!1)}}},n=async()=>{try{const s=await jr(),b=new Blob([s],{type:"application/json"}),R=URL.createObjectURL(b),S=document.createElement("a");S.href=R,S.download=`inventory-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(R),o.success("Settings exported successfully")}catch(s){console.error("Error exporting settings:",s),o.error("Failed to export settings")}},u=async s=>{var R;const b=(R=s.target.files)==null?void 0:R[0];if(b){try{const S=await b.text();await vr(S),await j(),o.success("Settings imported successfully")}catch(S){console.error("Error importing settings:",S),o.error("Failed to import settings")}s.target.value=""}};return i?e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading inventory settings..."})]})}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ue,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex items-center justify-between flex-1",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Inventory Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure how your inventory system operates across all branches"}),_&&e.jsxs("p",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"}),"Last saved: ",_.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:n,className:"flex items-center gap-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-xl transition-all shadow-sm",children:[e.jsx(us,{className:"w-4 h-4"}),"Export"]}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("span",{className:"flex items-center gap-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-xl transition-all shadow-sm",children:[e.jsx(es,{className:"w-4 h-4"}),"Import"]}),e.jsx("input",{type:"file",accept:".json",onChange:u,className:"hidden"})]}),e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-orange-200 hover:bg-orange-300 text-orange-700 font-semibold rounded-xl transition-all shadow-sm disabled:opacity-50",disabled:M,children:[e.jsx(hs,{className:"w-4 h-4"}),"Reset"]})]})]})]}),P&&e.jsx("div",{className:"mt-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border-2 border-indigo-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"w-5 h-5 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-indigo-900",children:"You have unsaved changes"})]}),e.jsxs("button",{onClick:E,disabled:M,className:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 font-semibold rounded-xl transition-all shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(We,{className:"w-4 h-4"}),M?"Saving...":"Save All Changes"]})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("stock-management"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-xl",children:e.jsx(Ue,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Stock Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Control stock levels and reorder points"})]})]}),h==="stock-management"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="stock-management"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Low Stock Threshold"}),e.jsx("input",{type:"number",value:t.low_stock_threshold,onChange:s=>x("low_stock_threshold",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Alert when stock falls below this number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Critical Stock Threshold"}),e.jsx("input",{type:"number",value:t.critical_stock_threshold,onChange:s=>x("critical_stock_threshold",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Critical alert threshold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Reorder Point %"}),e.jsx("input",{type:"number",value:t.reorder_point_percentage,onChange:s=>x("reorder_point_percentage",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Percentage to trigger reorder"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Maximum Stock Level"}),e.jsx("input",{type:"number",value:t.maximum_stock_level,onChange:s=>x("maximum_stock_level",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max stock allowed per item"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Stock Counting Frequency"}),e.jsxs("select",{value:t.stock_counting_frequency,onChange:s=>x("stock_counting_frequency",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]})]}),e.jsx("div",{className:"mt-4 space-y-3",children:e.jsx(se,{label:"Enable Auto Reorder",description:"Automatically create purchase orders when stock is low",checked:t.auto_reorder_enabled,onChange:s=>x("auto_reorder_enabled",s)})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("pricing-valuation"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-xl border-2 border-green-200 shadow-sm",children:e.jsx(fs,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pricing & Valuation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure pricing rules and cost calculations"})]})]}),h==="pricing-valuation"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="pricing-valuation"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Default Markup %"}),e.jsx("input",{type:"number",value:t.default_markup_percentage,onChange:s=>x("default_markup_percentage",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default markup for new products"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Price History (Days)"}),e.jsx("input",{type:"number",value:t.price_history_days,onChange:s=>x("price_history_days",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Days to keep price history"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Price Rounding"}),e.jsxs("select",{value:t.price_rounding_method,onChange:s=>x("price_rounding_method",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"nearest",children:"Round to Nearest"}),e.jsx("option",{value:"up",children:"Round Up"}),e.jsx("option",{value:"down",children:"Round Down"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Cost Calculation Method"}),e.jsxs("select",{value:t.cost_calculation_method,onChange:s=>x("cost_calculation_method",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"fifo",children:"FIFO (First In, First Out)"}),e.jsx("option",{value:"lifo",children:"LIFO (Last In, First Out)"}),e.jsx("option",{value:"average",children:"Average Cost"})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(se,{label:"Enable Dynamic Pricing",description:"Adjust prices based on demand and supply",checked:t.enable_dynamic_pricing,onChange:s=>x("enable_dynamic_pricing",s)}),e.jsx(se,{label:"Auto Price Update",description:"Automatically update prices when cost changes",checked:t.auto_price_update,onChange:s=>x("auto_price_update",s)}),e.jsx(se,{label:"Enable Bulk Discounts",description:"Allow bulk discount rules",checked:t.enable_bulk_discount,onChange:s=>x("enable_bulk_discount",s)}),e.jsx(se,{label:"Enable Seasonal Pricing",description:"Support seasonal price adjustments",checked:t.enable_seasonal_pricing,onChange:s=>x("enable_seasonal_pricing",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("notifications"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-xl border-2 border-purple-200 shadow-sm",children:e.jsx(ys,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications & Alerts"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure alert preferences and channels"})]})]}),h==="notifications"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="notifications"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Expiry Alert (Days Before)"}),e.jsx("input",{type:"number",value:t.expiry_alert_days,onChange:s=>x("expiry_alert_days",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Alert X days before expiry"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Slow Moving Alert (Days)"}),e.jsx("input",{type:"number",value:t.slow_moving_alert_days,onChange:s=>x("slow_moving_alert_days",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Alert if no sales in X days"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Low Stock Alerts",description:"Send alerts when stock is low",checked:t.low_stock_alerts,onChange:s=>x("low_stock_alerts",s)}),e.jsx(se,{label:"Out of Stock Alerts",description:"Send alerts when stock is depleted",checked:t.out_of_stock_alerts,onChange:s=>x("out_of_stock_alerts",s)}),e.jsx(se,{label:"Price Change Alerts",description:"Notify on price changes",checked:t.price_change_alerts,onChange:s=>x("price_change_alerts",s)}),e.jsx(se,{label:"Overstock Alerts",description:"Alert when stock exceeds maximum",checked:t.overstock_alerts,onChange:s=>x("overstock_alerts",s)}),e.jsx(se,{label:"Stock Discrepancy Alerts",description:"Alert on inventory count discrepancies",checked:t.stock_discrepancy_alerts,onChange:s=>x("stock_discrepancy_alerts",s)})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Notification Channels"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Email Notifications",description:"Send notifications via email",checked:t.email_notifications,onChange:s=>x("email_notifications",s)}),e.jsx(se,{label:"SMS Notifications",description:"Send notifications via SMS",checked:t.sms_notifications,onChange:s=>x("sms_notifications",s)}),e.jsx(se,{label:"WhatsApp Notifications",description:"Send notifications via WhatsApp",checked:t.whatsapp_notifications,onChange:s=>x("whatsapp_notifications",s)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("tracking"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-xl border-2 border-yellow-200 shadow-sm",children:e.jsx(Za,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tracking & Identification"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure product tracking methods"})]})]}),h==="tracking"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="tracking"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Barcode Format"}),e.jsx("input",{type:"text",value:t.barcode_format,onChange:s=>x("barcode_format",s.target.value),placeholder:"EAN-13, UPC-A, Code-128, QR",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default barcode format"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Enable Barcode Tracking",description:"Track products using barcodes",checked:t.enable_barcode_tracking,onChange:s=>x("enable_barcode_tracking",s)}),e.jsx(se,{label:"Enable Serial Number Tracking",description:"Track individual items by serial number",checked:t.enable_serial_tracking,onChange:s=>x("enable_serial_tracking",s)}),e.jsx(se,{label:"Enable Batch Tracking",description:"Track products by batch/lot number",checked:t.enable_batch_tracking,onChange:s=>x("enable_batch_tracking",s)}),e.jsx(se,{label:"Enable Expiry Tracking",description:"Track product expiration dates",checked:t.enable_expiry_tracking,onChange:s=>x("enable_expiry_tracking",s)}),e.jsx(se,{label:"Enable Location Tracking",description:"Track items by warehouse location/bin",checked:t.enable_location_tracking,onChange:s=>x("enable_location_tracking",s)}),e.jsx(se,{label:"Auto-Generate SKU",description:"Automatically generate SKU codes",checked:t.enable_sku_auto_generation,onChange:s=>x("enable_sku_auto_generation",s)}),e.jsx(se,{label:"Enable QR Codes",description:"Support QR code scanning",checked:t.enable_qr_code,onChange:s=>x("enable_qr_code",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("multi-branch"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-cyan-100 rounded-xl border-2 border-cyan-200 shadow-sm",children:e.jsx(ls,{className:"w-6 h-6 text-cyan-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Multi-Branch / Multi-Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure inventory across multiple branches"})]})]}),h==="multi-branch"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="multi-branch"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Stock Visibility"}),e.jsxs("select",{value:t.stock_visibility_mode,onChange:s=>x("stock_visibility_mode",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"own_branch",children:"Own Branch Only"}),e.jsx("option",{value:"all_branches",children:"All Branches"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Sync Frequency"}),e.jsxs("select",{value:t.sync_frequency,onChange:s=>x("sync_frequency",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"realtime",children:"Real-time"}),e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Enable Branch Isolation",description:"Keep inventory separate per branch",checked:t.enable_branch_isolation,onChange:s=>x("enable_branch_isolation",s)}),e.jsx(se,{label:"Allow Inter-Branch Transfers",description:"Enable stock transfers between branches",checked:t.allow_inter_branch_transfer,onChange:s=>x("allow_inter_branch_transfer",s)}),e.jsx(se,{label:"Transfer Approval Required",description:"Require approval for branch transfers",checked:t.transfer_approval_required,onChange:s=>x("transfer_approval_required",s)}),e.jsx(se,{label:"Auto Stock Sync",description:"Automatically sync stock between branches",checked:t.auto_stock_sync,onChange:s=>x("auto_stock_sync",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("security"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-xl border-2 border-red-200 shadow-sm",children:e.jsx(Es,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Security & Approvals"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Control access and approval workflows"})]})]}),h==="security"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="security"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Approval Threshold Amount"}),e.jsx("input",{type:"number",value:t.approval_threshold_amount,onChange:s=>x("approval_threshold_amount",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Amount above which approval is needed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Max Adjustment %"}),e.jsx("input",{type:"number",value:t.max_adjustment_percentage,onChange:s=>x("max_adjustment_percentage",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum allowed adjustment percentage"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Require Approval for Stock Adjustments",description:"Manager must approve stock adjustments",checked:t.require_approval_stock_adjustment,onChange:s=>x("require_approval_stock_adjustment",s)}),e.jsx(se,{label:"Require Approval for Price Changes",description:"Manager must approve price changes",checked:t.require_approval_price_change,onChange:s=>x("require_approval_price_change",s)}),e.jsx(se,{label:"Enable Audit Logging",description:"Log all inventory changes",checked:t.enable_audit_logging,onChange:s=>x("enable_audit_logging",s)}),e.jsx(se,{label:"Require Manager PIN",description:"Require PIN for sensitive operations",checked:t.require_manager_pin,onChange:s=>x("require_manager_pin",s)}),e.jsx(se,{label:"Lock Historical Inventory",description:"Prevent backdating inventory changes",checked:t.lock_historical_inventory,onChange:s=>x("lock_historical_inventory",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("performance"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-xl border-2 border-indigo-200 shadow-sm",children:e.jsx(Cs,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance & Analytics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Optimize performance and enable analytics"})]})]}),h==="performance"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="performance"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Auto Refresh Interval (seconds)"}),e.jsx("input",{type:"number",value:t.auto_refresh_interval,onChange:s=>x("auto_refresh_interval",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How often to refresh data"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Pagination Size"}),e.jsx("input",{type:"number",value:t.pagination_size,onChange:s=>x("pagination_size",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Items per page"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Cache Inventory Data",description:"Cache data for faster access",checked:t.cache_inventory_data,onChange:s=>x("cache_inventory_data",s)}),e.jsx(se,{label:"Enable Analytics",description:"Enable inventory analytics and reports",checked:t.enable_analytics,onChange:s=>x("enable_analytics",s)}),e.jsx(se,{label:"Enable Lazy Loading",description:"Load data as needed for large inventories",checked:t.enable_lazy_loading,onChange:s=>x("enable_lazy_loading",s)}),e.jsx(se,{label:"Enable Search Indexing",description:"Faster search performance",checked:t.enable_search_indexing,onChange:s=>x("enable_search_indexing",s)}),e.jsx(se,{label:"Enable Image Optimization",description:"Compress product images",checked:t.enable_image_optimization,onChange:s=>x("enable_image_optimization",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("backup"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-xl border-2 border-orange-200 shadow-sm",children:e.jsx(Le,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Backup & Data Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure backup and archiving settings"})]})]}),h==="backup"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="backup"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Backup Retention (Days)"}),e.jsx("input",{type:"number",value:t.backup_retention_days,onChange:s=>x("backup_retention_days",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Days to keep backups"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Archive After (Months)"}),e.jsx("input",{type:"number",value:t.archive_after_months,onChange:s=>x("archive_after_months",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Archive old data after X months"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Backup Frequency"}),e.jsxs("select",{value:t.backup_frequency,onChange:s=>x("backup_frequency",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Export Format"}),e.jsxs("select",{value:t.export_format,onChange:s=>x("export_format",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"excel",children:"Excel"}),e.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Auto Backup Enabled",description:"Automatically backup inventory data",checked:t.auto_backup_enabled,onChange:s=>x("auto_backup_enabled",s)}),e.jsx(se,{label:"Enable Data Archiving",description:"Archive old inventory data",checked:t.enable_data_archiving,onChange:s=>x("enable_data_archiving",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("product-org"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-pink-100 rounded-xl border-2 border-pink-200 shadow-sm",children:e.jsx(Hs,{className:"w-6 h-6 text-pink-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Product Organization"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure product categorization and organization"})]})]}),h==="product-org"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="product-org"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Max Category Depth"}),e.jsx("input",{type:"number",value:t.max_category_depth,onChange:s=>x("max_category_depth",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum category nesting level"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Default Category ID"}),e.jsx("input",{type:"text",value:t.default_category_id,onChange:s=>x("default_category_id",s.target.value),placeholder:"Leave empty for none",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default category for new products"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Auto-Assign Categories",description:"Automatically categorize products based on name",checked:t.auto_assign_categories,onChange:s=>x("auto_assign_categories",s)}),e.jsx(se,{label:"Enable Subcategories",description:"Allow nested product categories",checked:t.enable_subcategories,onChange:s=>x("enable_subcategories",s)}),e.jsx(se,{label:"Enable Tags",description:"Allow product tags and labels",checked:t.enable_tags,onChange:s=>x("enable_tags",s)}),e.jsx(se,{label:"Enable Product Bundles",description:"Create product bundles and kits",checked:t.enable_product_bundles,onChange:s=>x("enable_product_bundles",s)}),e.jsx(se,{label:"Enable Product Variants",description:"Support size, color, and other variants",checked:t.enable_product_variants,onChange:s=>x("enable_product_variants",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("supplier"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-teal-100 rounded-xl border-2 border-teal-200 shadow-sm",children:e.jsx(Xe,{className:"w-6 h-6 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Supplier Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure supplier tracking and purchase orders"})]})]}),h==="supplier"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="supplier"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Default Lead Time (Days)"}),e.jsx("input",{type:"number",value:t.default_lead_time_days,onChange:s=>x("default_lead_time_days",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default supplier lead time in days"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Enable Supplier Tracking",description:"Track suppliers for each product",checked:t.enable_supplier_tracking,onChange:s=>x("enable_supplier_tracking",s)}),e.jsx(se,{label:"Preferred Supplier Auto-Select",description:"Automatically select preferred supplier",checked:t.preferred_supplier_auto_select,onChange:s=>x("preferred_supplier_auto_select",s)}),e.jsx(se,{label:"Track Supplier Performance",description:"Monitor delivery times and quality",checked:t.track_supplier_performance,onChange:s=>x("track_supplier_performance",s)}),e.jsx(se,{label:"Enable Purchase Orders",description:"Create and manage purchase orders",checked:t.enable_purchase_orders,onChange:s=>x("enable_purchase_orders",s)}),e.jsx(se,{label:"Auto-Create PO at Reorder",description:"Automatically create PO when stock hits reorder point",checked:t.auto_create_po_at_reorder,onChange:s=>x("auto_create_po_at_reorder",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("reporting"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-violet-100 rounded-xl border-2 border-violet-200 shadow-sm",children:e.jsx(js,{className:"w-6 h-6 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Reporting & Analytics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure inventory reporting and analysis"})]})]}),h==="reporting"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="reporting"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Dead Stock Threshold (Days)"}),e.jsx("input",{type:"number",value:t.dead_stock_threshold_days,onChange:s=>x("dead_stock_threshold_days",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Days without movement to flag as dead stock"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Dashboard Refresh Rate (Seconds)"}),e.jsx("input",{type:"number",value:t.dashboard_refresh_rate,onChange:s=>x("dashboard_refresh_rate",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How often to refresh dashboard"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Stock Valuation Report Frequency"}),e.jsxs("select",{value:t.stock_valuation_report_frequency,onChange:s=>x("stock_valuation_report_frequency",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Enable Inventory Turnover",description:"Calculate inventory turnover ratio",checked:t.enable_inventory_turnover,onChange:s=>x("enable_inventory_turnover",s)}),e.jsx(se,{label:"Enable ABC Analysis",description:"Classify items by value (A/B/C)",checked:t.enable_abc_analysis,onChange:s=>x("enable_abc_analysis",s)}),e.jsx(se,{label:"Enable Real-time Reporting",description:"Generate reports in real-time",checked:t.enable_realtime_reporting,onChange:s=>x("enable_realtime_reporting",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("integration"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-xl border-2 border-emerald-200 shadow-sm",children:e.jsx(vt,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Integration Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure external integrations and APIs"})]})]}),h==="integration"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="integration"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Webhook URL for Stock Changes"}),e.jsx("input",{type:"text",value:t.webhook_stock_changes,onChange:s=>x("webhook_stock_changes",s.target.value),placeholder:"https://your-webhook-url.com",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Webhook endpoint for stock change notifications"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Enable POS Integration",description:"Integrate with POS system",checked:t.enable_pos_integration,onChange:s=>x("enable_pos_integration",s)}),e.jsx(se,{label:"Enable E-commerce Sync",description:"Sync with e-commerce platforms",checked:t.enable_ecommerce_sync,onChange:s=>x("enable_ecommerce_sync",s)}),e.jsx(se,{label:"Enable Accounting Integration",description:"Integrate with accounting software",checked:t.enable_accounting_integration,onChange:s=>x("enable_accounting_integration",s)}),e.jsx(se,{label:"Enable API Access",description:"Allow API access for inventory data",checked:t.enable_api_access,onChange:s=>x("enable_api_access",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("returns"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-rose-100 rounded-xl border-2 border-rose-200 shadow-sm",children:e.jsx(hs,{className:"w-6 h-6 text-rose-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Returns & Adjustments"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure return and adjustment policies"})]})]}),h==="returns"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="returns"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Max Return Period (Days)"}),e.jsx("input",{type:"number",value:t.max_return_period_days,onChange:s=>x("max_return_period_days",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum days to accept returns"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Damaged Stock Handling"}),e.jsxs("select",{value:t.damaged_stock_handling,onChange:s=>x("damaged_stock_handling",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"separate_bin",children:"Move to Separate Bin"}),e.jsx("option",{value:"write_off",children:"Write Off Immediately"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Allow Returns to Inventory",description:"Returned items can be added back to inventory",checked:t.allow_returns_to_inventory,onChange:s=>x("allow_returns_to_inventory",s)}),e.jsx(se,{label:"Return Inspection Required",description:"Require inspection before restocking returns",checked:t.return_inspection_required,onChange:s=>x("return_inspection_required",s)}),e.jsx(se,{label:"Adjustment Reason Required",description:"Require reason for all stock adjustments",checked:t.adjustment_reason_required,onChange:s=>x("adjustment_reason_required",s)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("units"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-xl border-2 border-amber-200 shadow-sm",children:e.jsx(Xa,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Units of Measure"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure units and measurement settings"})]})]}),h==="units"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),h==="units"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Default Unit of Measure"}),e.jsx("input",{type:"text",value:t.default_uom,onChange:s=>x("default_uom",s.target.value),placeholder:"piece, kg, liter, etc.",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default UOM for new products"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Quantity Decimal Places"}),e.jsx("input",{type:"number",value:t.quantity_decimal_places,onChange:s=>x("quantity_decimal_places",parseInt(s.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Decimal precision for quantities"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{label:"Enable Multiple UOM",description:"Support multiple units of measure per product",checked:t.enable_multiple_uom,onChange:s=>x("enable_multiple_uom",s)}),e.jsx(se,{label:"Enable UOM Conversion",description:"Allow conversion between different units",checked:t.enable_uom_conversion,onChange:s=>x("enable_uom_conversion",s)})]})]})]}),P&&e.jsx("div",{className:"bg-white rounded-xl p-6 sticky bottom-4 shadow-2xl border-2 border-indigo-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xs,{className:"w-6 h-6 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Unsaved Changes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Don't forget to save your settings"})]})]}),e.jsxs("button",{onClick:E,disabled:M,className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 text-lg font-semibold rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(We,{className:"w-5 h-5"}),M?"Saving...":"Save All Changes"]})]})})]})})]}):e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xs,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load inventory settings"}),e.jsx("button",{onClick:j,className:"mt-4 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl transition-all shadow-sm",children:"Retry"})]})})},Kr=({isActive:m=!0})=>{var X;const{registerSaveHandler:w,unregisterSaveHandler:N,setHasChanges:P}=Ps(),[t,p]=r.useState("agents"),[i,y]=r.useState([]),[M,I]=r.useState([]),[_,$]=r.useState(null),[h,B]=r.useState(!0),[j,x]=r.useState(!1),[T,E]=r.useState(!1),[C,n]=r.useState(null),[u,s]=r.useState({name:"",company_name:"",contact_person:"",phone:"",email:"",whatsapp:"",shipping_methods:[],address:"",city:"",country:"",license_number:"",website:"",notes:"",base_rate_sea:0,base_rate_air:0,currency:"USD",is_active:!0,is_preferred:!1});r.useEffect(()=>{m&&b()},[m]);const b=async()=>{B(!0);try{const[a,f,W]=await Promise.all([cs.agents.getAll(!1),cs.methods.getAll(!1),cs.settings.get()]);y(a),I(f),$(W||{default_shipping_address_city:"Dar es Salaam",default_shipping_address_country:"Tanzania",notify_on_shipment:!0,notify_on_arrival:!0,include_insurance:!0,insurance_percentage:2})}catch(a){console.error("Error loading shipping data:",a),oe.error("Failed to load shipping settings")}finally{B(!1)}},R=async()=>{try{if(!u.name){oe.error("Agent name is required");return}x(!0),C?(await cs.agents.update(C.id,u),oe.success("Agent updated successfully")):(await cs.agents.create(u),oe.success("Agent created successfully")),await b(),D()}catch(a){console.error("Error saving agent:",a),oe.error("Failed to save agent")}finally{x(!1)}},S=a=>{n(a),s(a),E(!0)},K=async a=>{if(confirm("Are you sure you want to delete this shipping agent?"))try{await cs.agents.delete(a),oe.success("Agent deleted successfully"),await b()}catch(f){console.error("Error deleting agent:",f),oe.error("Failed to delete agent")}},ee=async a=>{try{await cs.agents.update(a.id,{is_preferred:!a.is_preferred}),oe.success(a.is_preferred?"Removed from preferred":"Added to preferred"),await b()}catch(f){console.error("Error updating agent:",f),oe.error("Failed to update agent")}},le=async a=>{try{await cs.agents.update(a.id,{is_active:!a.is_active}),oe.success(a.is_active?"Agent deactivated":"Agent activated"),await b()}catch(f){console.error("Error updating agent:",f),oe.error("Failed to update agent")}},D=()=>{E(!1),n(null),s({name:"",company_name:"",contact_person:"",phone:"",email:"",whatsapp:"",shipping_methods:[],address:"",city:"",country:"",license_number:"",website:"",notes:"",base_rate_sea:0,base_rate_air:0,currency:"USD",is_active:!0,is_preferred:!1})};r.useEffect(()=>_?(w("shipping-settings",async()=>{try{x(!0),await cs.settings.save(_),oe.success("Settings saved successfully"),await b()}catch(f){console.error("Error saving settings:",f),oe.error("Failed to save settings")}finally{x(!1)}}),()=>N("shipping-settings")):void 0,[_,w,N]),r.useEffect(()=>{_&&P(!0)},[_,P]);const H=a=>{s(f=>{var W;return{...f,shipping_methods:(W=f.shipping_methods)!=null&&W.includes(a)?f.shipping_methods.filter(v=>v!==a):[...f.shipping_methods||[],a]}})};return h?e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading shipping settings..."})]})})}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Xe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Shipping Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage shipping agents, methods, and default settings for purchase orders"})]})]}),e.jsx("div",{className:"mt-6 border-b-2 border-gray-200",children:e.jsxs("nav",{className:"flex space-x-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>p("agents"),className:`flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-all whitespace-nowrap rounded-t-xl ${t==="agents"?"border-orange-500 text-orange-700 bg-orange-50":"border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(wt,{className:"w-5 h-5"}),"Shipping Agents"]}),e.jsxs("button",{onClick:()=>p("methods"),className:`flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-all whitespace-nowrap rounded-t-xl ${t==="methods"?"border-orange-500 text-orange-700 bg-orange-50":"border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Xe,{className:"w-5 h-5"}),"Shipping Methods"]}),e.jsxs("button",{onClick:()=>p("defaults"),className:`flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-all whitespace-nowrap rounded-t-xl ${t==="defaults"?"border-orange-500 text-orange-700 bg-orange-50":"border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(is,{className:"w-5 h-5"}),"Default Settings"]})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-6",children:[t==="agents"&&e.jsxs($e,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Shipping Agents"}),e.jsxs("button",{onClick:()=>E(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Add Agent"]})]}),i.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(gt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No shipping agents added yet"}),e.jsx("button",{onClick:()=>E(!0),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Add your first agent"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:i.map(a=>e.jsxs("div",{className:`p-4 border-2 rounded-lg ${a.is_active?"border-gray-200 bg-white":"border-gray-100 bg-gray-50 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.name}),a.is_preferred&&e.jsx(ws,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"})]}),a.company_name&&e.jsx("p",{className:"text-sm text-gray-600",children:a.company_name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>ee(a),className:"p-1.5 text-gray-400 hover:text-yellow-500 transition-colors",title:a.is_preferred?"Remove from preferred":"Mark as preferred",children:a.is_preferred?e.jsx(ws,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}):e.jsx(er,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(a),className:"p-1.5 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit agent",children:e.jsx(na,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>K(a.id),className:"p-1.5 text-gray-400 hover:text-red-600 transition-colors",title:"Delete agent",children:e.jsx(Re,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:a.shipping_methods.map(f=>e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700",children:[f==="sea"&&e.jsx(gt,{className:"w-3 h-3 inline mr-1"}),f==="air"&&e.jsx(ht,{className:"w-3 h-3 inline mr-1"}),f==="road"&&e.jsx(Xe,{className:"w-3 h-3 inline mr-1"}),f.charAt(0).toUpperCase()+f.slice(1)]},f))}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[a.contact_person&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-3 h-3"}),e.jsx("span",{children:a.contact_person})]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"w-3 h-3"}),e.jsx("span",{children:a.phone})]}),a.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(As,{className:"w-3 h-3"}),e.jsx("span",{children:a.email})]}),a.city&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.city,", ",a.country]})]})]}),(a.base_rate_sea||a.base_rate_air)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 flex gap-4 text-sm",children:[a.base_rate_sea>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Sea: "}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[a.currency," ",a.base_rate_sea]})]}),a.base_rate_air>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Air: "}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[a.currency," ",a.base_rate_air]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("button",{onClick:()=>le(a),className:`flex items-center gap-2 text-sm font-medium ${a.is_active?"text-green-600":"text-gray-500"}`,children:a.is_active?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-4 h-4"}),"Inactive"]})})})]},a.id))})]}),t==="methods"&&e.jsxs($e,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Shipping Methods"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(a=>e.jsxs("div",{className:"p-4 border-2 border-gray-200 rounded-lg bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[a.code==="sea"&&e.jsx(gt,{className:"w-6 h-6 text-blue-600"}),a.code==="air"&&e.jsx(ht,{className:"w-6 h-6 text-blue-600"}),a.code.includes("air")&&e.jsx(ht,{className:"w-6 h-6 text-blue-600"}),a.code==="road"&&e.jsx(Xe,{className:"w-6 h-6 text-blue-600"}),a.code==="rail"&&e.jsx(Xe,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("span",{className:"text-xs text-gray-500",children:a.code})]})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.description}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Duration:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[a.estimated_days_min,"-",a.estimated_days_max," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Multiplier:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[a.cost_multiplier,"x"]})]})]})]},a.id))})]}),t==="defaults"&&_&&e.jsxs($e,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Default Settings"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Default Shipping Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street"}),e.jsx("input",{type:"text",value:_.default_shipping_address_street||"",onChange:a=>$({..._,default_shipping_address_street:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Street address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),e.jsx("input",{type:"text",value:_.default_shipping_address_city||"",onChange:a=>$({..._,default_shipping_address_city:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Region"}),e.jsx("input",{type:"text",value:_.default_shipping_address_region||"",onChange:a=>$({..._,default_shipping_address_region:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Region/State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country"}),e.jsx("input",{type:"text",value:_.default_shipping_address_country||"",onChange:a=>$({..._,default_shipping_address_country:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Country"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Default Shipping Method"}),e.jsxs("select",{value:_.default_shipping_method_id||"",onChange:a=>$({..._,default_shipping_method_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select default method"}),M.filter(a=>a.is_active).map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Default Shipping Agent"}),e.jsxs("select",{value:_.default_agent_id||"",onChange:a=>$({..._,default_agent_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"No default agent"}),i.filter(a=>a.is_active).map(a=>e.jsxs("option",{value:a.id,children:[a.name," ",a.is_preferred&&"â­"]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Notifications"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:_.notify_on_shipment||!1,onChange:a=>$({..._,notify_on_shipment:a.target.checked}),className:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"Notify when shipment is dispatched"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:_.notify_on_arrival||!1,onChange:a=>$({..._,notify_on_arrival:a.target.checked}),className:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"Notify when shipment arrives"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Insurance Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:_.include_insurance||!1,onChange:a=>$({..._,include_insurance:a.target.checked}),className:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"Include insurance by default"})]}),_.include_insurance&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Insurance Percentage"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"10",step:"0.1",value:_.insurance_percentage||2,onChange:a=>$({..._,insurance_percentage:parseFloat(a.target.value)||0}),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700",children:"% of goods value"})]})]})]})]})]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:C?"Edit Shipping Agent":"Add Shipping Agent"}),e.jsx("button",{onClick:D,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ns,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Agent Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:u.name||"",onChange:a=>s({...u,name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Agent name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:u.company_name||"",onChange:a=>s({...u,company_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Company name"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:u.contact_person||"",onChange:a=>s({...u,contact_person:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Contact person"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"tel",value:u.phone||"",onChange:a=>s({...u,phone:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+1234567890"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:u.email||"",onChange:a=>s({...u,email:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"email@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"WhatsApp"}),e.jsx("input",{type:"tel",value:u.whatsapp||"",onChange:a=>s({...u,whatsapp:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+1234567890"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Shipping Methods ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["sea","air","road","rail"].map(a=>{var f,W;return e.jsxs("label",{className:`flex items-center gap-2 px-4 py-2 border-2 rounded-lg cursor-pointer transition-colors ${(f=u.shipping_methods)!=null&&f.includes(a)?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"}`,children:[e.jsx("input",{type:"checkbox",checked:(W=u.shipping_methods)==null?void 0:W.includes(a),onChange:()=>H(a),className:"sr-only"}),a==="sea"&&e.jsx(gt,{className:"w-4 h-4"}),a==="air"&&e.jsx(ht,{className:"w-4 h-4"}),a==="road"&&e.jsx(Xe,{className:"w-4 h-4"}),a==="rail"&&e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium capitalize",children:a})]},a)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),e.jsx("input",{type:"text",value:u.city||"",onChange:a=>s({...u,city:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country"}),e.jsx("input",{type:"text",value:u.country||"",onChange:a=>s({...u,country:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Country"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Number"}),e.jsx("input",{type:"text",value:u.license_number||"",onChange:a=>s({...u,license_number:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"License #"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sea Base Rate"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:u.base_rate_sea||"",onChange:a=>s({...u,base_rate_sea:parseFloat(a.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Air Base Rate"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:u.base_rate_air||"",onChange:a=>s({...u,base_rate_air:parseFloat(a.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Currency"}),e.jsxs("select",{value:u.currency||"USD",onChange:a=>s({...u,currency:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"TZS",children:"TZS"}),e.jsx("option",{value:"CNY",children:"CNY"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("textarea",{value:u.address||"",onChange:a=>s({...u,address:a.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Full address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:u.notes||"",onChange:a=>s({...u,notes:a.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Additional notes about this agent..."})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:u.is_active||!1,onChange:a=>s({...u,is_active:a.target.checked}),className:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:u.is_preferred||!1,onChange:a=>s({...u,is_preferred:a.target.checked}),className:"w-4 h-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"Preferred Agent"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50",children:[e.jsx("button",{onClick:D,disabled:j,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{onClick:R,disabled:j||!u.name||!((X=u.shipping_methods)!=null&&X.length),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(We,{className:"w-4 h-4"}),j?"Saving...":C?"Update Agent":"Create Agent"]})]})]})})]})},Jr=()=>{var h;const[m,w]=r.useState(null),[N,P]=r.useState(!1),[t,p]=r.useState(Ca()),[i,y]=r.useState(!1);r.useEffect(()=>{let B;return i&&(B=setInterval(()=>{M()},1e4)),()=>{B&&clearInterval(B)}},[i]);const M=async()=>{const B=Ks();if(!B){o.error("Please select a branch first");return}P(!0);try{const j=await Aa(B);w(j),j.summary.failed>0?o.error(`${j.summary.failed} isolation test(s) failed!`):j.summary.warnings>0?o(`Tests passed with ${j.summary.warnings} warning(s)`,{icon:"âš ï¸"}):o.success("All isolation tests passed!")}catch(j){console.error("Error running tests:",j),o.error(j.message||"Failed to run tests")}finally{P(!1)}},I=()=>{t?(Ta(),p(!1),o.success("Debug mode disabled")):(Ea(),p(!0),o.success("Debug mode enabled - Check console for query logs"))},_=B=>B.passed?B.details.includes("âš ï¸")?e.jsx(Fe,{className:"w-5 h-5 text-yellow-500"}):e.jsx(ke,{className:"w-5 h-5 text-green-500"}):e.jsx(gs,{className:"w-5 h-5 text-red-500"}),$=B=>{switch(B){case"Products":return e.jsx(Ue,{className:"w-5 h-5"});case"Customers":return e.jsx(ze,{className:"w-5 h-5"});case"Inventory":return e.jsx(oa,{className:"w-5 h-5"});case"Suppliers":return e.jsx(ca,{className:"w-5 h-5"});case"Categories":return e.jsx(da,{className:"w-5 h-5"});default:return e.jsx(Le,{className:"w-5 h-5"})}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Dt,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Branch Isolation Debugger"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Test and verify data isolation is working correctly"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:I,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${t?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[t?e.jsx(Js,{className:"w-4 h-4"}):e.jsx(_t,{className:"w-4 h-4"}),t?"Debug On":"Debug Off"]}),e.jsxs("button",{onClick:()=>y(!i),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${i?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(be,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"Auto-refresh ",i?"On":"Off"]}),e.jsxs("button",{onClick:M,disabled:N||!Ks(),className:"flex items-center gap-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[N?e.jsx(be,{className:"w-4 h-4 animate-spin"}):e.jsx(sr,{className:"w-4 h-4"}),N?"Testing...":"Run Test"]})]})]}),!m&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"w-6 h-6 text-blue-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"How to Use the Debugger"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"1."}),e.jsx("span",{children:"Select a branch from the branch selector in the navigation"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"2."}),e.jsx("span",{children:'Click "Run Test" to check if isolation is working correctly'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"3."}),e.jsx("span",{children:'Enable "Debug Mode" to see detailed query logs in the browser console'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"4."}),e.jsx("span",{children:'Enable "Auto-refresh" to continuously monitor isolation (updates every 10s)'})]})]})]})]})}),m&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Branch Name"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:m.branchName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Branch ID"}),e.jsx("p",{className:"text-sm font-mono text-gray-700",children:m.branchId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Isolation Mode"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-semibold ${m.isolationMode==="shared"?"bg-blue-100 text-blue-700":m.isolationMode==="isolated"?"bg-red-100 text-red-700":"bg-purple-100 text-purple-700"}`,children:[e.jsx(Es,{className:"w-4 h-4"}),m.isolationMode.toUpperCase()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Last Tested"}),e.jsx("p",{className:"text-sm text-gray-700",children:new Date((h=m.testResults[0])==null?void 0:h.timestamp).toLocaleTimeString()})]})]})})}),m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 mb-1",children:"Tests Passed"}),e.jsx("p",{className:"text-3xl font-bold text-green-700",children:m.summary.passed})]}),e.jsx(ke,{className:"w-10 h-10 text-green-500"})]})}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 mb-1",children:"Tests Failed"}),e.jsx("p",{className:"text-3xl font-bold text-red-700",children:m.summary.failed})]}),e.jsx(gs,{className:"w-10 h-10 text-red-500"})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-600 mb-1",children:"Warnings"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-700",children:m.summary.warnings})]}),e.jsx(Fe,{className:"w-10 h-10 text-yellow-500"})]})})]}),m&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),"Branch Configuration"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.entries(m.settings).map(([B,j])=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border-2 ${j?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:B.replace("share_","").charAt(0).toUpperCase()+B.replace("share_","").slice(1)}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${j?"bg-blue-600 text-white":"bg-gray-300 text-gray-700"}`,children:j?"SHARED":"ISOLATED"})]},B))})]}),m&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),"Isolation Test Results"]}),e.jsx("div",{className:"space-y-4",children:m.testResults.map((B,j)=>e.jsxs("div",{className:`border-2 rounded-lg p-4 transition-all ${B.passed?B.details.includes("âš ï¸")?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[$(B.feature),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:B.feature}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Expected: ",e.jsx("span",{className:"font-semibold",children:B.expected.toUpperCase()})," "," | "," ","Actual: ",e.jsx("span",{className:"font-semibold",children:B.actual.toUpperCase()})]})]})]}),_(B)]}),e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-sm text-gray-700",children:B.details})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Current Branch"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:B.dataCount.currentBranch})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Other Branches"}),e.jsx("p",{className:"text-xl font-bold text-purple-600",children:B.dataCount.otherBranches})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Shared Items"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:B.dataCount.shared})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Visible"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:B.dataCount.total})]})]})]},j))})]}),t&&e.jsx("div",{className:"mt-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Js,{className:"w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-purple-900 mb-1",children:"Debug Mode is Active"}),e.jsx("p",{className:"text-xs text-purple-700",children:"All database queries will be logged to the browser console with detailed isolation information. Open the browser console (F12) to see the logs."})]})]})})]})},Qr=()=>{const{currentBranch:m}=Pa(),[w,N]=r.useState(!1),[P,t]=r.useState([]),[p,i]=r.useState(!1),[y,M]=r.useState("reassign"),I=async()=>{N(!0),t([]);try{const j=await Da();t(j),o.success("Analysis completed!")}catch(j){console.error("Analysis failed:",j),o.error(`Analysis failed: ${j.message}`)}finally{N(!1)}},_=async j=>{N(!0);try{await Ia({action:y,dryRun:j,confirmationRequired:!1}),j?o.success("âœ… Dry run completed! Check console for details."):(o.success("âœ… Cleanup completed successfully!"),setTimeout(()=>I(),1e3)),i(!1)}catch(x){console.error("Cleanup failed:",x),o.error(`Cleanup failed: ${x.message}`)}finally{N(!1)}},$=P.reduce((j,x)=>j+x.otherBranchRecords,0),h=P.reduce((j,x)=>j+x.unassignedRecords,0),B=$>0;return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Re,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Branch Data Cleanup"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Identify and fix branch isolation violations"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:I,disabled:w||!m,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[w?e.jsx(be,{className:"w-4 h-4 animate-spin"}):e.jsx(ps,{className:"w-4 h-4"}),w?"Analyzing...":"Analyze Data"]}),B&&e.jsxs("button",{onClick:()=>i(!0),disabled:w||!m,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Re,{className:"w-4 h-4"}),"Cleanup Data"]})]})]}),!m&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:"Please select a branch to use this tool."})})]})}),P.length>0&&e.jsxs(e.Fragment,{children:[B&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(gs,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"âš ï¸ Branch Isolation Violation Detected!"}),e.jsxs("p",{className:"text-sm text-red-700",children:["Your branch is in ISOLATED mode but has ",$," records from other branches. This violates branch isolation rules. Use the cleanup tool to fix this issue."]})]})]})}),h>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-900 mb-1",children:"ðŸ“‹ Unassigned Records Found"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["Found ",h," records without branch assignment. These will be visible in shared/hybrid modes."]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-b-2 border-gray-300",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Table"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Current Branch"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Other Branches"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Unassigned"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:P.map(j=>{const x=j.otherBranchRecords>0;return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-gray-500"}),j.table.replace("lats_","")]})}),e.jsx("td",{className:"p-3 text-sm text-gray-700 text-right",children:j.totalRecords}),e.jsx("td",{className:"p-3 text-sm text-gray-700 text-right",children:j.currentBranchRecords}),e.jsx("td",{className:"p-3 text-sm text-right",children:e.jsx("span",{className:x?"font-bold text-red-600":"text-gray-700",children:j.otherBranchRecords})}),e.jsx("td",{className:"p-3 text-sm text-gray-700 text-right",children:j.unassignedRecords}),e.jsx("td",{className:"p-3 text-center",children:x?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded",children:[e.jsx(gs,{className:"w-3 h-3"}),"Violation"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded",children:[e.jsx(ke,{className:"w-3 h-3"}),"OK"]})})]},j.table)})})]})}),e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{children:"Note:"})," This tool helps identify and fix branch isolation issues. Records from other branches should not be visible when your branch is in ISOLATED mode."]})})]}),P.length===0&&!w&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx(Le,{className:"w-12 h-12 text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-blue-800",children:'Click "Analyze Data" to check for branch isolation issues.'})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Re,{className:"w-6 h-6 text-orange-600"}),"Cleanup Branch Data"]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"This will modify database records. Please choose carefully!"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Cleanup Action"}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"cleanup-action",value:"reassign",checked:y==="reassign",onChange:j=>M(j.target.value),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Reassign to Current Branch (Recommended)"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Move all data from other branches to the current branch. No data will be lost."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 border-red-200 rounded-lg cursor-pointer hover:bg-red-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"cleanup-action",value:"delete",checked:y==="delete",onChange:j=>M(j.target.value),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"Delete Records (Dangerous!)"}),e.jsx("p",{className:"text-xs text-red-700",children:"Permanently delete all records from other branches. This cannot be undone!"})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"}),' Try "Dry Run" first to preview what will happen without making any actual changes.']})})]}),e.jsxs("div",{className:"p-6 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:()=>_(!0),disabled:w,className:"flex items-center gap-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(ps,{className:"w-4 h-4"}),"Dry Run"]}),e.jsxs("button",{onClick:()=>_(!1),disabled:w,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50",children:[w?e.jsx(be,{className:"w-4 h-4 animate-spin"}):e.jsx(Wt,{className:"w-4 h-4"}),"Apply Changes"]})]})]})})]})},Yr=async()=>{try{const m=Ks();if(!m)throw new Error("No branch selected. Please select a branch first.");const{data:w,error:N}=await Z.from("lats_store_locations").select("id, name").eq("id",m).single();if(N||!w)throw new Error("Failed to fetch branch details");console.log(`ðŸ—‘ï¸ Deleting all products for branch: ${w.name} (${m})`);const{count:P}=await Z.from("lats_products").select("*",{count:"exact",head:!0}).eq("branch_id",m),{count:t}=await Z.from("lats_product_variants").select("*",{count:"exact",head:!0}).eq("branch_id",m);console.log(`ðŸ“¦ Products to delete: ${P||0}`),console.log(`ðŸ”¢ Variants to delete: ${t||0}`);const{error:p}=await Z.from("lats_product_variants").delete().eq("branch_id",m);if(p)throw new Error(`Failed to delete variants: ${p.message}`);console.log(`âœ… Deleted ${t||0} variants`);const{error:i}=await Z.from("lats_products").delete().eq("branch_id",m);if(i)throw new Error(`Failed to delete products: ${i.message}`);return console.log(`âœ… Deleted ${P||0} products`),console.log(`ðŸŽ‰ All products deleted successfully from ${w.name}!`),{success:!0,productsDeleted:P||0,variantsDeleted:t||0,branchId:w.id,branchName:w.name}}catch(m){return console.error("âŒ Error deleting products:",m),{success:!1,productsDeleted:0,variantsDeleted:0,branchId:Ks()||"",branchName:"Unknown",error:m.message||"Unknown error occurred"}}},Zr=async()=>{const m=Ks();if(!m)return 0;const{count:w}=await Z.from("lats_products").select("*",{count:"exact",head:!0}).eq("branch_id",m);return w||0},Xr=()=>{const[m,w]=r.useState(!1),[N,P]=r.useState(0),[t,p]=r.useState(!1),[i,y]=r.useState(""),[M,I]=r.useState(null),_=Ks(),$=async()=>{if(!_)return;const j=await Zr();P(j)};r.useEffect(()=>{$()},[_]);const h=()=>{p(!0),I(null),y("")},B=async()=>{if(i!=="DELETE ALL PRODUCTS"){alert('Please type "DELETE ALL PRODUCTS" to confirm');return}w(!0);try{const j=await Yr();I(j),p(!1),y(""),await $(),j.success&&setTimeout(()=>{window.location.reload()},2e3)}catch(j){console.error("Error deleting products:",j)}finally{w(!1)}};return _?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Ue,{className:"text-blue-600",size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Branch Products"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage products for this branch"})]})]}),e.jsx("button",{onClick:$,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh count",children:e.jsx(be,{size:18})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Products in Current Branch"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:N})]}),N>0&&e.jsxs("button",{onClick:h,disabled:m,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:[e.jsx(Re,{size:18}),"Delete All Products in This Branch"]}),N===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No products to delete"})})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(Fe,{className:"text-red-600",size:24})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Confirm Deletion"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("p",{className:"text-gray-700",children:["You are about to delete ",e.jsxs("span",{className:"font-bold text-red-600",children:[N," products"]})," from this branch."]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium mb-2",children:"âš ï¸ Warning:"}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"This action cannot be undone"}),e.jsx("li",{children:"All product variants will be deleted"}),e.jsx("li",{children:"Sales history will be preserved (items set to NULL)"}),e.jsx("li",{children:"Purchase order history will be preserved"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Type ",e.jsx("span",{className:"font-bold text-red-600",children:"DELETE ALL PRODUCTS"})," to confirm:"]}),e.jsx("input",{type:"text",value:i,onChange:j=>y(j.target.value),placeholder:"DELETE ALL PRODUCTS",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",disabled:m})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{p(!1),y("")},disabled:m,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:m||i!=="DELETE ALL PRODUCTS",className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:m?"Deleting...":"Delete All Products"})]})]})}),M&&e.jsx("div",{className:`rounded-lg border p-4 ${M.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsx("div",{className:"flex items-start gap-3",children:M.success?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl",children:"âœ…"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"Products Deleted Successfully!"}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsxs("p",{children:["â€¢ Branch: ",e.jsx("span",{className:"font-medium",children:M.branchName})]}),e.jsxs("p",{children:["â€¢ Products deleted: ",e.jsx("span",{className:"font-medium",children:M.productsDeleted})]}),e.jsxs("p",{children:["â€¢ Variants deleted: ",e.jsx("span",{className:"font-medium",children:M.variantsDeleted})]})]}),e.jsx("p",{className:"text-sm text-green-700 mt-3",children:"The page will refresh in 2 seconds..."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl",children:"âŒ"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Failed to Delete Products"}),e.jsx("p",{className:"text-sm text-red-800",children:M.error||"An unknown error occurred"})]})]})})})]}):e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{className:"text-yellow-600",size:20}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"Please select a branch first to manage products"})]})})},en=()=>{var X,a;const{confirm:m}=Nr(),[w,N]=r.useState([]),[P,t]=r.useState(""),[p,i]=r.useState(""),[y,M]=r.useState([]),[I,_]=r.useState(new Set),[$,h]=r.useState(""),[B,j]=r.useState(!1),[x,T]=r.useState(!1),[E,C]=r.useState(null),[n,u]=r.useState(!1),[s,b]=r.useState(new Set);r.useEffect(()=>{R()},[]),r.useEffect(()=>{P?S(P):(M([]),_(new Set))},[P]),r.useEffect(()=>{p?K(p):b(new Set)},[p]);const R=async()=>{try{const{data:f,error:W}=await Z.from("store_locations").select("id, name, code, city").eq("is_active",!0).order("name");if(W)throw W;N(f||[])}catch(f){console.error("Error loading branches:",f),oe.error("Failed to load branches")}},S=async f=>{try{j(!0);const{data:W,error:v}=await Z.from("lats_products").select(`
          id,
          name,
          sku,
          description,
          category_id,
          supplier_id,
          cost_price,
          selling_price,
          stock_quantity,
          branch_id,
          image_url
        `).eq("branch_id",f).eq("is_active",!0).order("name");if(v)throw v;const L=await Promise.all((W||[]).map(async k=>{const{count:Y}=await Z.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("product_id",k.id).eq("branch_id",f).or("is_parent.eq.true,parent_variant_id.is.null");return{...k,variantCount:Y||0}}));M(L),_(new Set)}catch(W){console.error("Error loading products:",W),oe.error("Failed to load products")}finally{j(!1)}},K=async f=>{try{const{data:W,error:v}=await Z.from("lats_products").select("sku, name").eq("branch_id",f).eq("is_active",!0);if(v)throw v;const L=new Set((W||[]).map(k=>{const Y=k.sku||"",A=Y.split("-");return A.length>1&&A[A.length-1].length===8?A.slice(0,-1).join("-"):Y}));b(L)}catch(W){console.error("Error loading target branch products:",W)}},ee=f=>{const W=new Set(I);W.has(f)?W.delete(f):W.add(f),_(W)},le=()=>{I.size===H.length?_(new Set):_(new Set(H.map(f=>f.id)))},D=async()=>{var W,v,L,k,Y,A;if(!P||!p){oe.error("Please select both source and target branches");return}if(I.size===0){oe.error("Please select at least one product to share");return}if(P===p){oe.error("Source and target branches must be different");return}if(await m(`Share ${I.size} product(s) from ${(W=w.find(V=>V.id===P))==null?void 0:W.name} to ${(v=w.find(V=>V.id===p))==null?void 0:v.name}?

Stock quantities will be set to 0 in the target branch.`)){T(!0),C(null);try{let V=0,Q=0;const c=((L=w.find(l=>l.id===P))==null?void 0:L.name)||"Unknown",F=((k=w.find(l=>l.id===p))==null?void 0:k.name)||"Unknown";for(const l of I){const U=y.find(ye=>ye.id===l);if(!U)continue;const{data:me}=await Z.from("lats_products").select("id").eq("branch_id",p).eq("sku",U.sku).single();let re;if(me)oe.info(`Product ${U.name} already exists in target branch`),re=me.id;else{const{data:ye,error:z}=await Z.from("lats_products").insert({name:U.name,sku:`${U.sku}-${p.substring(0,8)}`,description:U.description,category_id:U.category_id,supplier_id:U.supplier_id,cost_price:U.cost_price,selling_price:U.selling_price,stock_quantity:0,branch_id:p,image_url:U.image_url,is_active:!0,is_shared:!1,sharing_mode:"isolated"}).select("id").single();if(z){console.error(`Error sharing product ${U.name}:`,z);continue}re=ye.id,V++}const{data:ie,error:ue}=await Z.from("lats_product_variants").select("*").eq("product_id",l).eq("branch_id",P).or("is_parent.eq.true,parent_variant_id.is.null");if(ue){console.error("Error fetching variants:",ue);continue}if(ie&&ie.length>0){const ye=ie.map(ae=>({product_id:re,name:ae.name,sku:ae.sku?`${ae.sku}-${p.substring(0,8)}`:null,barcode:ae.barcode,cost_price:ae.cost_price,selling_price:ae.selling_price,unit_price:ae.unit_price,quantity:0,min_quantity:ae.min_quantity,branch_id:p,is_active:ae.is_active,attributes:ae.attributes,variant_attributes:ae.variant_attributes,variant_name:ae.variant_name,is_shared:!1,sharing_mode:"isolated",is_parent:ae.is_parent||!1})),{error:z}=await Z.from("lats_product_variants").insert(ye);z?console.error("Error inserting variants:",z):Q+=ye.length}}C({success:!0,productsShared:V,variantsShared:Q,sourceBranchName:c,targetBranchName:F}),oe.success(`Successfully shared ${V} product(s) with ${Q} variant(s)`),_(new Set)}catch(V){console.error("Error sharing products:",V),C({success:!1,productsShared:0,variantsShared:0,sourceBranchName:((Y=w.find(Q=>Q.id===P))==null?void 0:Y.name)||"Unknown",targetBranchName:((A=w.find(Q=>Q.id===p))==null?void 0:A.name)||"Unknown",error:V.message||"Unknown error occurred"}),oe.error("Failed to share products")}finally{T(!1)}}},H=y.filter(f=>f.name.toLowerCase().includes($.toLowerCase())||f.sku.toLowerCase().includes($.toLowerCase())?n&&p?!s.has(f.sku):!0:!1);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-indigo-100 rounded-lg",children:e.jsx(vt,{className:"text-indigo-600",size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Share Products Between Branches"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Copy products to other branches with empty stock"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Source Branch (From)"}),e.jsxs("select",{value:P,onChange:f=>t(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",disabled:x,children:[e.jsx("option",{value:"",children:"Select source branch..."}),w.map(f=>e.jsxs("option",{value:f.id,children:[f.name," ",f.code?`(${f.code})`:""]},f.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Branch (To)"}),e.jsxs("select",{value:p,onChange:f=>i(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",disabled:x,children:[e.jsx("option",{value:"",children:"Select target branch..."}),w.filter(f=>f.id!==P).map(f=>e.jsxs("option",{value:f.id,children:[f.name," ",f.code?`(${f.code})`:""]},f.id))]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(xs,{className:"text-blue-600 flex-shrink-0",size:20}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{className:"font-medium",children:"What happens when sharing products:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{children:"Product details (name, price, SKU) are copied"}),e.jsxs("li",{children:["Stock quantities are set to ",e.jsx("strong",{children:"0"})," in target branch"]}),e.jsx("li",{children:"Parent variants are copied (not child variants like IMEI)"}),e.jsx("li",{children:"Target branch can manage stock independently"}),e.jsx("li",{children:"SKU will be modified to avoid conflicts"})]})]})]})}),P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ps,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",value:$,onChange:f=>h(f.target.value),placeholder:"Search products...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",disabled:x})]}),e.jsx("button",{onClick:le,className:"flex items-center gap-2 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:x||H.length===0,children:I.size===H.length?e.jsxs(e.Fragment,{children:[e.jsx(It,{size:18}),"Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(Rt,{size:18}),"Select All"]})})]}),p&&e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-purple-50 border border-purple-200 rounded-lg cursor-pointer hover:bg-purple-100 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:f=>u(f.target.checked),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500",disabled:x}),e.jsx(Ue,{className:"text-purple-600",size:18}),e.jsxs("span",{className:"text-sm font-medium text-purple-900",children:["Show only products NOT in ",(X=w.find(f=>f.id===p))==null?void 0:X.name]}),n&&e.jsxs("span",{className:"ml-auto text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded-full font-medium",children:[H.length," missing"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[H.length," product(s) available â€¢ ",I.size," selected"]})}),B?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):H.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ue,{className:"mx-auto text-gray-400 mb-3",size:48}),e.jsx("p",{className:"text-gray-500",children:$?"No products found matching your search":"No products in this branch"})]}):e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:H.map(f=>{const W=p&&s.has(f.sku);return e.jsxs("div",{onClick:()=>!x&&ee(f.id),className:`flex items-center gap-4 p-4 border-b border-gray-200 last:border-b-0 cursor-pointer transition-colors ${I.has(f.id)?"bg-indigo-50":"hover:bg-gray-50"} ${x?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:"flex-shrink-0",children:I.has(f.id)?e.jsx(It,{className:"text-indigo-600",size:20}):e.jsx(Rt,{className:"text-gray-400",size:20})}),f.image_url&&e.jsx("img",{src:f.image_url,alt:f.name,className:"w-12 h-12 object-cover rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:f.name}),W&&e.jsx("span",{className:"flex-shrink-0 text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full font-medium",children:"Already in target"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",f.sku," â€¢ Stock: ",f.stock_quantity,f.variantCount>0&&` â€¢ ${f.variantCount} variant(s)`]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["$",Number(f.selling_price||0).toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Cost: $",Number(f.cost_price||0).toFixed(2)]})]})]},f.id)})}),H.length>0&&e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:D,disabled:x||I.size===0||!p,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Sharing Products..."]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{size:18}),"Share ",I.size," Product(s)",p&&e.jsxs(e.Fragment,{children:[e.jsx(Wt,{size:18}),(a=w.find(f=>f.id===p))==null?void 0:a.name]})]})})})]}),E&&e.jsx("div",{className:`mt-6 rounded-lg border p-4 ${E.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsx("div",{className:"flex items-start gap-3",children:E.success?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl",children:"âœ…"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"Products Shared Successfully!"}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsxs("p",{children:["â€¢ From: ",e.jsx("span",{className:"font-medium",children:E.sourceBranchName})]}),e.jsxs("p",{children:["â€¢ To: ",e.jsx("span",{className:"font-medium",children:E.targetBranchName})]}),e.jsxs("p",{children:["â€¢ Products shared: ",e.jsx("span",{className:"font-medium",children:E.productsShared})]}),e.jsxs("p",{children:["â€¢ Variants shared: ",e.jsx("span",{className:"font-medium",children:E.variantsShared})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl",children:"âŒ"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Failed to Share Products"}),e.jsx("p",{className:"text-sm text-red-800",children:E.error||"An unknown error occurred"})]})]})})})]})})},sn=()=>{const{currentUser:m}=Lt(),{autoArrangeWidgets:w}=wr(),[N,P]=r.useState(!0),[t,p]=r.useState(!1),[i,y]=r.useState(null),[M,I]=r.useState({quickActions:{devices:!0,addDevice:!0,customers:!0,inventory:!0,appointments:!0,purchaseOrders:!0,payments:!0,adGenerator:!0,pos:!0,reports:!0,employees:!0,whatsapp:!0,settings:!0,search:!0,loyalty:!0,backup:!0,sms:!0,bulkSms:!0,smsLogs:!0,smsSettings:!0,excelImport:!0,excelTemplates:!0,productExport:!0,customerImport:!0,userManagement:!0,databaseSetup:!0,integrationSettings:!0,integrationsTest:!0,aiTraining:!0,bluetoothPrinter:!0,categoryManagement:!0,supplierManagement:!0,storeLocations:!0,reminders:!0,mobile:!0,myAttendance:!0},widgets:{revenueTrendChart:!0,deviceStatusChart:!0,appointmentsTrendChart:!0,stockLevelChart:!0,performanceMetricsChart:!0,customerActivityChart:!0,salesFunnelChart:!0,purchaseOrderChart:!0,appointmentWidget:!0,employeeWidget:!0,notificationWidget:!0,financialWidget:!0,analyticsWidget:!0,serviceWidget:!0,reminderWidget:!0,customerInsightsWidget:!0,systemHealthWidget:!0,inventoryWidget:!0,activityFeedWidget:!0,purchaseOrderWidget:!0,chatWidget:!0,salesWidget:!0,topProductsWidget:!0,expensesWidget:!0,staffPerformanceWidget:!0,paymentMethodsChart:!0,salesByCategoryChart:!0,profitMarginChart:!0}});r.useEffect(()=>{m&&(_(),$())},[m==null?void 0:m.id,m==null?void 0:m.role]);const _=()=>{if(!m)return;const k=_r(m.role),Y=kr(m.role);y({widgets:k,quickActions:Y})},$=async()=>{if(m!=null&&m.id)try{P(!0);const k=await Xt(m.id);k!=null&&k.dashboard&&I(k.dashboard)}catch(k){console.error("Error loading dashboard settings:",k),o.error("Failed to load dashboard settings")}finally{P(!1)}},h=async()=>{if(!(m!=null&&m.id)){o.error("User not authenticated");return}try{p(!0);const Y={...await Xt(m.id),dashboard:M};await Sr(m.id,Y,"Dashboard")?(o.success("Dashboard settings saved! Refresh your dashboard to see changes.",{duration:4e3,icon:"âœ…"}),window.dispatchEvent(new CustomEvent("dashboardSettingsChanged"))):o.error("Failed to save dashboard settings")}catch(k){console.error("Error saving dashboard settings:",k),o.error("Failed to save dashboard settings")}finally{p(!1)}},B=()=>{if(!i)return;const k={quickActions:i.quickActions,widgets:i.widgets};I(k),o.success("Dashboard settings reset to your role defaults")},j=k=>{i!=null&&i.quickActions[k]&&I(Y=>({...Y,quickActions:{...Y.quickActions,[k]:!Y.quickActions[k]}}))},x=k=>{i!=null&&i.widgets[k]&&I(Y=>({...Y,widgets:{...Y.widgets,[k]:!Y.widgets[k]}}))},T=k=>{i&&I(Y=>({...Y,quickActions:Object.keys(Y.quickActions).reduce((A,V)=>{const Q=V;return A[V]=i.quickActions[Q]?k:!1,A},{})}))},E=(k,Y)=>{I(A=>({...A,widgetSizes:{...A.widgetSizes||{},[k]:Y}}))},C=k=>{var Y;return((Y=M.widgetSizes)==null?void 0:Y[k])||"medium"},n=(k,Y)=>{I(A=>({...A,widgetRowSpans:{...A.widgetRowSpans,[k]:Y}}))},u=k=>{var Y;return((Y=M.widgetRowSpans)==null?void 0:Y[k])||"single"},s=[{key:"devices",label:"Devices",icon:nt,description:"Manage devices"},{key:"addDevice",label:"Add Device",icon:Ge,description:"Add new device"},{key:"customers",label:"Customers",icon:ze,description:"View customers"},{key:"inventory",label:"Inventory",icon:Ue,description:"Stock & parts"},{key:"appointments",label:"Appointments",icon:lt,description:"Schedule appointments"},{key:"purchaseOrders",label:"Purchase Orders",icon:Vs,description:"Manage orders"},{key:"payments",label:"Payments",icon:fs,description:"Payment management"},{key:"adGenerator",label:"Ad Generator",icon:Ye,description:"Create product ads"},{key:"pos",label:"POS System",icon:fs,description:"Point of sale"},{key:"reports",label:"Sales Reports",icon:js,description:"View sales reports"},{key:"employees",label:"Employees",icon:ze,description:"Manage staff"},{key:"whatsapp",label:"WhatsApp",icon:Qs,description:"WhatsApp chat"},{key:"settings",label:"Settings",icon:Ze,description:"System settings"},{key:"search",label:"Search",icon:ps,description:"Global search"},{key:"loyalty",label:"Loyalty Program",icon:ws,description:"Customer loyalty"},{key:"backup",label:"Backup",icon:Gs,description:"Data backup"},{key:"sms",label:"SMS Center",icon:qs,description:"SMS management"},{key:"bulkSms",label:"Bulk SMS",icon:qs,description:"Mass messaging"},{key:"smsLogs",label:"SMS Logs",icon:qs,description:"Message history"},{key:"smsSettings",label:"SMS Settings",icon:Ze,description:"SMS configuration"},{key:"excelImport",label:"Excel Import",icon:es,description:"Data import"},{key:"excelTemplates",label:"Excel Templates",icon:us,description:"Template downloads"},{key:"productExport",label:"Product Export",icon:us,description:"Export products"},{key:"customerImport",label:"Customer Import",icon:es,description:"Import customers"},{key:"userManagement",label:"User Management",icon:ua,description:"User administration"},{key:"databaseSetup",label:"Database Setup",icon:Le,description:"Database configuration"},{key:"integrationSettings",label:"Integration Settings",icon:Ze,description:"System integrations"},{key:"integrationsTest",label:"Integrations Test",icon:Ot,description:"Test integrations"},{key:"aiTraining",label:"AI Training",icon:Ht,description:"AI training system"},{key:"bluetoothPrinter",label:"Bluetooth Printer",icon:lr,description:"Printer management"},{key:"categoryManagement",label:"Category Management",icon:Hs,description:"Product categories"},{key:"supplierManagement",label:"Supplier Management",icon:wt,description:"Supplier management"},{key:"storeLocations",label:"Store Locations",icon:is,description:"Location management"},{key:"reminders",label:"Reminders",icon:ot,description:"Reminder system"},{key:"mobile",label:"Mobile",icon:nt,description:"Mobile features"},{key:"myAttendance",label:"My Attendance",icon:ot,description:"Personal attendance"}],b=[{key:"revenueTrendChart",label:"Revenue Trend Chart",icon:Cs,category:"Charts"},{key:"deviceStatusChart",label:"Device Status Chart",icon:nt,category:"Charts"},{key:"appointmentsTrendChart",label:"Appointments Trend Chart",icon:lt,category:"Charts"},{key:"stockLevelChart",label:"Stock Level Chart",icon:Ue,category:"Charts"},{key:"performanceMetricsChart",label:"Performance Metrics Chart",icon:vs,category:"Charts"},{key:"customerActivityChart",label:"Customer Activity Chart",icon:ze,category:"Charts"},{key:"salesFunnelChart",label:"Sales Funnel Chart",icon:ir,category:"Charts"},{key:"purchaseOrderChart",label:"Purchase Order Chart",icon:Vs,category:"Charts"},{key:"paymentMethodsChart",label:"Payment Methods Chart",icon:Vt,category:"Charts"},{key:"salesByCategoryChart",label:"Sales by Category Chart",icon:Hs,category:"Charts"},{key:"profitMarginChart",label:"Profit Margin Chart",icon:Cs,category:"Charts"},{key:"appointmentWidget",label:"Appointment Widget",icon:lt,category:"Widgets"},{key:"employeeWidget",label:"Employee Widget",icon:or,category:"Widgets"},{key:"notificationWidget",label:"Notification Widget",icon:ys,category:"Widgets"},{key:"financialWidget",label:"Financial Widget",icon:fs,category:"Widgets"},{key:"analyticsWidget",label:"Analytics Widget",icon:js,category:"Widgets"},{key:"serviceWidget",label:"Service Widget",icon:ft,category:"Widgets"},{key:"reminderWidget",label:"Reminder Widget",icon:ys,category:"Widgets"},{key:"customerInsightsWidget",label:"Customer Insights Widget",icon:ze,category:"Widgets"},{key:"systemHealthWidget",label:"System Health Widget",icon:vs,category:"Widgets"},{key:"inventoryWidget",label:"Inventory Widget",icon:Ue,category:"Widgets"},{key:"activityFeedWidget",label:"Activity Feed Widget",icon:cr,category:"Widgets"},{key:"purchaseOrderWidget",label:"Purchase Order Widget",icon:Vs,category:"Widgets"},{key:"chatWidget",label:"Chat Widget",icon:Qs,category:"Widgets"},{key:"salesWidget",label:"Sales Widget",icon:fs,category:"Widgets"},{key:"topProductsWidget",label:"Top Products Widget",icon:Cs,category:"Widgets"},{key:"expensesWidget",label:"Expenses Widget",icon:Vt,category:"Widgets"},{key:"staffPerformanceWidget",label:"Staff Performance Widget",icon:ze,category:"Widgets"},{key:"tradeInWidget",label:"Trade-in Widget",icon:be,category:"Widgets"},{key:"installmentsWidget",label:"Installments Widget",icon:ms,category:"Widgets"},{key:"loyaltyWidget",label:"Loyalty Widget",icon:ws,category:"Widgets"},{key:"smsWidget",label:"SMS Widget",icon:qs,category:"Widgets"},{key:"sparePartsWidget",label:"Spare Parts Widget",icon:ft,category:"Widgets"},{key:"storageRoomsWidget",label:"Storage Rooms Widget",icon:wt,category:"Widgets"},{key:"stockTransfersWidget",label:"Stock Transfers Widget",icon:Xe,category:"Widgets"},{key:"specialOrdersWidget",label:"Special Orders Widget",icon:dr,category:"Widgets"},{key:"backupWidget",label:"Backup Widget",icon:Gs,category:"Widgets"},{key:"repairWidget",label:"Repair Widget",icon:ft,category:"Widgets"},{key:"aiInsightsWidget",label:"AI Insights Widget",icon:Ht,category:"Widgets"},{key:"predictiveAnalyticsWidget",label:"Predictive Analytics Widget",icon:Cs,category:"Widgets"},{key:"alertSystemWidget",label:"Alert System Widget",icon:ys,category:"Widgets"}];if(N||!i)return e.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading dashboard settings..."})]})})});const R=s.filter(k=>i.quickActions[k.key]),S=b.filter(k=>i.widgets[k.key]),K=S.filter(k=>k.category==="Charts"),ee=S.filter(k=>k.category==="Widgets"),le=()=>{try{const k=localStorage.getItem("dashboard_widget_order");if(k)return JSON.parse(k)}catch(k){console.error("Error loading widget order:",k)}return["revenueTrendChart","deviceStatusChart","appointmentsTrendChart","purchaseOrderChart","paymentMethodsChart","analyticsWidget","salesByCategoryChart","profitMarginChart","stockLevelChart","performanceMetricsChart","customerActivityChart","appointmentWidget","employeeWidget","notificationWidget","financialWidget","salesFunnelChart","customerInsightsWidget","serviceWidget","reminderWidget","systemHealthWidget","inventoryWidget","activityFeedWidget","purchaseOrderWidget","chatWidget","salesWidget","topProductsWidget","expensesWidget","staffPerformanceWidget"]},D=[...K,...ee],H=le(),X=[...D].sort((k,Y)=>{const A=H.indexOf(k.key),V=H.indexOf(Y.key);return A===-1&&V===-1?0:A===-1?1:V===-1?-1:A-V}),a=R.filter(k=>M.quickActions[k.key]).length,f=K.filter(k=>M.widgets[k.key]).length,W=ee.filter(k=>M.widgets[k.key]).length,v=f+W,L=k=>({admin:"Administrator","customer-care":"Customer Care",technician:"Technician",manager:"Manager",sales:"Sales",user:"User"})[k]||k;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Mt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex items-center justify-between flex-1",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Dashboard Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customize your dashboard"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"px-4 py-2 bg-blue-50 border-2 border-blue-200 rounded-xl",children:e.jsxs("p",{className:"text-sm text-blue-600 font-semibold",children:[a+f+W," items enabled"]})})})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-blue-600"}),e.jsxs("p",{className:"text-sm text-blue-800 font-medium",children:[e.jsxs("span",{className:"font-semibold",children:["Your Role: ",L((m==null?void 0:m.role)||"")]})," - You can customize ",R.length," quick actions and ",S.length," widgets"]})]})}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs("button",{onClick:h,disabled:t,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-all disabled:opacity-50 font-semibold shadow-lg hover:shadow-xl",children:[e.jsx(We,{size:20}),t?"Saving...":"Save Changes"]}),e.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all font-semibold shadow-sm",children:[e.jsx(hs,{size:20}),"Reset to Defaults"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"space-y-6 py-6",children:[R.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(la,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Quick Actions"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"font-semibold text-blue-600",children:[a," of ",R.length]})," enabled"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>T(!0),className:"flex items-center gap-1.5 px-4 py-2 text-sm bg-green-50 text-green-700 rounded-xl hover:bg-green-100 transition-colors font-semibold border-2 border-green-200",children:[e.jsx(tr,{size:16}),"Enable All"]}),e.jsxs("button",{onClick:()=>T(!1),className:"flex items-center gap-1.5 px-4 py-2 text-sm bg-red-50 text-red-700 rounded-xl hover:bg-red-100 transition-colors font-semibold border-2 border-red-200",children:[e.jsx(gs,{size:16}),"Disable All"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:R.map(k=>{const Y=k.icon,A=M.quickActions[k.key];return e.jsxs("button",{onClick:()=>j(k.key),className:`group p-4 rounded-xl border-2 transition-all text-left relative overflow-hidden ${A?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-blue-50 shadow-sm hover:shadow-md":"border-gray-200 bg-white hover:border-indigo-300 hover:bg-indigo-50/30"}`,children:[e.jsx("div",{className:`absolute top-2 right-2 px-2.5 py-1 rounded-full text-xs font-bold ${A?"bg-green-500 text-white shadow-sm":"bg-gray-300 text-gray-600"}`,children:A?"Enabled":"Disabled"}),e.jsx("div",{className:"flex items-start gap-3 mb-2 mt-2",children:e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${A?"bg-indigo-600 shadow-lg shadow-indigo-200":"bg-gray-300 group-hover:bg-indigo-400"}`,children:e.jsx(Y,{className:"w-5 h-5 text-white"})})}),e.jsx("h4",{className:`font-semibold text-sm mb-1 ${A?"text-indigo-900":"text-gray-700"}`,children:k.label}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:k.description})]},k.key)})})]}),X.filter(k=>M.widgets[k.key]).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border-2 border-green-300 shadow-sm p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center shadow-lg",children:e.jsx(Mt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:["Dashboard Preview",e.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-semibold bg-green-600 text-white shadow-sm",children:[v," Active"]})]}),e.jsx("p",{className:"text-sm text-gray-700 font-medium mt-1",children:"This shows EXACTLY how your dashboard looks with real gaps - Resize widgets to fill empty spaces"})]})]})}),(()=>{const Y=(()=>{try{const U=localStorage.getItem("dashboard_widget_order");if(U)return JSON.parse(U)}catch(U){console.error("Error loading widget order:",U)}return null})(),A=Y?Y.filter(U=>M.widgets[U]):X.filter(U=>M.widgets[U.key]).map(U=>U.key),V=w(A),Q=new Map(X.map(U=>[U.key,U])),c=[];let F=[],l=0;if(V.widgets.forEach(U=>{const me=parseInt(U.gridColumn.split(" ")[1]);if(l+me>3){const re=3-l;re>0&&F.push({type:"empty",span:re}),c.push(F),F=[],l=0}F.push({type:"widget",item:Q.get(U.key),gridColumn:U.gridColumn,span:me}),l+=me,l>=3&&(c.push(F),F=[],l=0)}),F.length>0){const U=3-l;U>0&&F.push({type:"empty",span:U}),c.push(F)}return c.map((U,me)=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:U.map((re,ie)=>{if(re.type==="empty"){const _e=()=>re.span===1?"md:col-span-1":re.span===2?"md:col-span-2 lg:col-span-2":"md:col-span-2 lg:col-span-3";return e.jsx("div",{className:`rounded-xl border-2 border-dashed border-red-300 bg-red-50/30 p-4 flex items-center justify-center min-h-[200px] ${_e()}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“"}),e.jsx("p",{className:"text-sm font-semibold text-red-600",children:"Empty Space"}),e.jsx("p",{className:"text-xs text-red-500 mt-1",children:re.span===1?"1 column gap":re.span===2?"2 column gap":"3 column gap"}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Resize widgets above to fill this gap"})]})},`empty-${me}-${ie}`)}const ue=re.item;if(!ue)return null;const ye=ue.icon,z=M.widgets[ue.key],ae=C(ue.key),je=u(ue.key),Se=ue.category==="Charts",we=()=>{const _e=re.span||1;return _e===3?"md:col-span-2 lg:col-span-3":_e===2?"md:col-span-2 lg:col-span-2":"md:col-span-1"},ve=Se?{border:"border-purple-500",bg:"bg-gradient-to-br from-purple-50 to-pink-50",iconBg:"bg-purple-600 shadow-lg shadow-purple-200",iconHover:"group-hover:bg-purple-400",text:"text-purple-900",hoverText:"text-purple-600",sizeBg:"bg-purple-600",sizeButtons:"bg-purple-100 text-purple-600 hover:bg-purple-200",sizeActive:"bg-purple-600 text-white",borderBottom:"border-purple-200",sizeLabel:"text-purple-700"}:{border:"border-blue-500",bg:"bg-gradient-to-br from-blue-50 to-cyan-50",iconBg:"bg-blue-600 shadow-lg shadow-blue-200",iconHover:"group-hover:bg-blue-400",text:"text-blue-900",hoverText:"text-blue-600",sizeBg:"bg-blue-600",sizeButtons:"bg-blue-100 text-blue-600 hover:bg-blue-200",sizeActive:"bg-blue-600 text-white",borderBottom:"border-blue-200",sizeLabel:"text-blue-700"};return e.jsxs("div",{className:`rounded-xl border-2 transition-all relative overflow-hidden ${z?`${ve.border} ${ve.bg} shadow-sm`:"border-gray-200 bg-white"} ${we()}`,children:[e.jsxs("button",{onClick:()=>x(ue.key),className:"w-full p-4 text-left group",children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 flex-wrap justify-end max-w-[70%]",children:[e.jsx("div",{className:`px-2.5 py-1 rounded-full text-xs font-bold shadow-sm ${z?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:z?"Enabled":"Disabled"}),z&&e.jsx("div",{className:`px-2.5 py-1 rounded-full text-xs font-bold ${ve.sizeBg} text-white shadow-sm`,children:ae==="small"?"Small":ae==="large"?"Large":"Medium"}),e.jsx("div",{className:"px-2.5 py-1 rounded-full text-xs font-bold bg-gray-600 text-white shadow-sm border border-gray-700",children:Se?"ðŸ“Š Chart":"ðŸ“¦ Widget"})]}),e.jsx("div",{className:"flex items-start gap-3 mb-2 mt-2",children:e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${z?ve.iconBg:`bg-gray-300 ${ve.iconHover}`}`,children:e.jsx(ye,{className:"w-5 h-5 text-white"})})}),e.jsx("h4",{className:`font-semibold text-sm mb-1 ${z?ve.text:"text-gray-700"}`,children:ue.label})]}),z&&e.jsxs("div",{className:`px-4 pb-4 pt-2 border-t ${ve.borderBottom}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-xs font-medium ${ve.sizeLabel}`,children:"Widget Size:"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:_e=>{_e.stopPropagation(),E(ue.key,"small")},className:`p-1.5 rounded ${ae==="small"?ve.sizeActive:ve.sizeButtons} transition-colors`,title:"Small (1 column)",children:e.jsx(ar,{size:14})}),e.jsx("button",{onClick:_e=>{_e.stopPropagation(),E(ue.key,"medium")},className:`p-1.5 rounded ${ae==="medium"?ve.sizeActive:ve.sizeButtons} transition-colors`,title:"Medium (2 columns)",children:e.jsx(Rt,{size:14})}),e.jsx("button",{onClick:_e=>{_e.stopPropagation(),E(ue.key,"large")},className:`p-1.5 rounded ${ae==="large"?ve.sizeActive:ve.sizeButtons} transition-colors`,title:"Large (3 columns)",children:e.jsx(rr,{size:14})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-200",children:[e.jsx("span",{className:`text-xs font-medium ${ve.sizeLabel}`,children:"Height:"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:_e=>{_e.stopPropagation(),n(ue.key,"single")},className:`p-1.5 rounded ${je==="single"?ve.sizeActive:ve.sizeButtons} transition-colors`,title:"Single Row Height",children:e.jsx(nr,{size:14})}),e.jsx("button",{onClick:_e=>{_e.stopPropagation(),n(ue.key,"double")},className:`p-1.5 rounded ${je==="double"?ve.sizeActive:ve.sizeButtons} transition-colors`,title:"Double Row Height (2x height)",children:e.jsx(ga,{size:14})})]})]})]})]},ue.key)})},`row-${me}`))})()]}),X.filter(k=>!M.widgets[k.key]).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-slate-50 rounded-xl border-2 border-gray-300 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-gray-500 to-slate-500 flex items-center justify-center shadow-lg",children:e.jsx(Ue,{className:"w-6 h-6 text-white"})}),e.jsx("div",{children:e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:["Available Widgets",e.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-semibold bg-gray-600 text-white shadow-sm",children:[X.filter(k=>!M.widgets[k.key]).length," Available"]})]})})]}),e.jsxs("button",{onClick:()=>{D.forEach(k=>{I(Y=>({...Y,widgets:{...Y.widgets,[k.key]:!0}}))})},className:"flex items-center gap-2 px-5 py-2.5 text-sm bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all font-semibold shadow-lg hover:shadow-xl",children:[e.jsx(Ge,{size:18}),"Add All to Dashboard"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:X.filter(k=>!M.widgets[k.key]).map(k=>{const Y=k.icon;M.widgets[k.key];const A=k.category==="Charts",V=A?{border:"border-purple-300",bg:"bg-white",iconBg:"bg-purple-500",text:"text-gray-700",badge:"bg-purple-100 text-purple-700"}:{border:"border-blue-300",bg:"bg-white",iconBg:"bg-blue-500",text:"text-gray-700",badge:"bg-blue-100 text-blue-700"};return e.jsxs("button",{onClick:()=>x(k.key),className:`rounded-xl border-2 transition-all relative overflow-hidden hover:shadow-md hover:scale-105 p-4 text-left group ${V.border} ${V.bg}`,children:[e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:`px-2.5 py-1 rounded-full text-xs font-bold border ${V.badge} border-gray-200`,children:A?"ðŸ“Š Chart":"ðŸ“¦ Widget"})}),e.jsx("div",{className:"flex items-start gap-3 mb-2 mt-2",children:e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${V.iconBg} shadow-md`,children:e.jsx(Y,{className:"w-5 h-5 text-white"})})}),e.jsx("h4",{className:`font-semibold text-sm mb-1 ${V.text}`,children:k.label})]},k.key)})})]}),!1,e.jsx(Cr,{className:"mt-8"})]})})]})},Et=[{name:"Sales & Transactions",description:"Sales records, POS transactions, and related data",tables:["lats_sales","lats_sale_items","lats_receipts","account_transactions","payment_transactions","mobile_money_transactions","customer_payments","installment_payments","gift_card_transactions","points_transactions"]},{name:"Customers",description:"Customer profiles, communications, and activity",tables:["lats_customers","customer_notes","customer_messages","customer_communications","customer_checkins","customer_preferences","customer_revenue","customer_special_orders","customer_installment_plans","customer_installment_plan_payments","customer_points_history","whatsapp_customers","contact_history","contact_methods","contact_preferences","buyer_details"]},{name:"Inventory & Products",description:"Products, stock movements, and inventory tracking",tables:["lats_products","lats_product_variants","lats_inventory_items","inventory_items","lats_stock_movements","lats_inventory_adjustments","product_images","product_interests","imei_validation","serial_number_movements","lats_product_validation"]},{name:"Purchase Orders & Suppliers",description:"Purchase orders, supplier data, and receiving records",tables:["lats_purchase_orders","lats_purchase_order_items","lats_purchase_order_payments","lats_purchase_order_audit_log","purchase_order_audit","purchase_order_messages","purchase_order_payments","purchase_order_quality_checks","purchase_order_quality_check_items","lats_suppliers","suppliers"]},{name:"Devices & Repairs",description:"Device repair tracking, diagnostics, and service records",tables:["devices","device_attachments","device_checklists","device_ratings","device_remarks","device_transitions","diagnostic_requests","diagnostic_devices","diagnostic_checks","diagnostic_checklist_results","diagnostic_problem_templates","diagnostic_templates","repair_parts","quality_checks","quality_check_items","quality_check_results","quality_check_criteria","quality_check_templates"]},{name:"Trade-Ins",description:"Trade-in transactions and assessments",tables:["lats_trade_in_transactions","lats_trade_in_contracts","lats_trade_in_damage_assessments","lats_trade_in_prices","lats_trade_in_settings"]},{name:"Employees & Attendance",description:"Employee records, shifts, and attendance tracking",tables:["employees","lats_employees","employees_backup_migration","employee_shifts","attendance_records","shift_templates","leave_requests","user_daily_goals","user_branch_assignments"]},{name:"Communications",description:"SMS, email, WhatsApp, and notification logs",tables:["sms_logs","sms_triggers","sms_trigger_logs","email_logs","chat_messages","communication_log","communication_templates","notifications","notification_templates","whatsapp_message_templates","whatsapp_templates","whatsapp_instances_comprehensive"]},{name:"Finance & Expenses",description:"Expense tracking, accounts, and financial records",tables:["expenses","finance_expenses","expense_categories","finance_expense_categories","finance_accounts","finance_transfers","recurring_expenses","recurring_expense_history"]},{name:"Shipping & Logistics",description:"Shipping records and cargo tracking",tables:["lats_shipping","lats_shipping_cargo_items"]},{name:"Branches & Transfers",description:"Branch transfers and stock movement between locations",tables:["branch_transfers","branch_activity_log","scheduled_transfers","scheduled_transfer_executions"]},{name:"Spare Parts",description:"Spare parts inventory and usage tracking",tables:["lats_spare_parts","lats_spare_part_variants","lats_spare_part_usage"]},{name:"System & Audit Logs",description:"System logs, audit trails, and API logs",tables:["audit_logs","api_request_logs","webhook_logs","admin_settings_log","auto_reorder_log"]},{name:"Sales & Marketing",description:"Sales pipeline, appointments, and customer engagement",tables:["sales_pipeline","appointments","reminders","special_order_payments"]},{name:"Returns & Gift Cards",description:"Product returns and gift card management",tables:["returns","gift_cards"]},{name:"Backup Tables",description:"System backup and migration tables",tables:["customer_fix_backup"]}],tn=()=>{const[m,w]=r.useState(!1),[N,P]=r.useState(!1),[t,p]=r.useState(!1),[i,y]=r.useState([]),[M,I]=r.useState(""),[_,$]=r.useState("all"),[h,B]=r.useState(""),[j,x]=r.useState(!1),[T,E]=r.useState(!1),[C,n]=r.useState(new Set),[u,s]=r.useState(!1),b=A=>({"Sales & Transactions":{icon:ha,color:"text-orange-600"},Customers:{icon:ze,color:"text-purple-600"},"Inventory & Products":{icon:Ue,color:"text-green-600"},"Purchase Orders & Suppliers":{icon:Ye,color:"text-blue-600"},"Devices & Repairs":{icon:ft,color:"text-red-600"},"Trade-Ins":{icon:Cs,color:"text-teal-600"},"Employees & Attendance":{icon:ze,color:"text-indigo-600"},Communications:{icon:As,color:"text-pink-600"},"Finance & Expenses":{icon:fs,color:"text-emerald-600"},"Shipping & Logistics":{icon:Xe,color:"text-cyan-600"},"Branches & Transfers":{icon:ct,color:"text-violet-600"},"Spare Parts":{icon:Vs,color:"text-amber-600"},"System & Audit Logs":{icon:Ze,color:"text-gray-600"},"Sales & Marketing":{icon:js,color:"text-rose-600"},"Returns & Gift Cards":{icon:Nt,color:"text-yellow-600"},"Backup Tables":{icon:mr,color:"text-slate-600"},Other:{icon:pa,color:"text-gray-500"}})[A]||{icon:Le,color:"text-gray-600"},R=async()=>{P(!0),w(!0);try{oe.loading("Scanning database...",{id:"scan"});const{data:A,error:V}=await Z.from("information_schema.tables").select("table_name").eq("table_schema","public").order("table_name");if(V)throw new Error("Failed to fetch database schema");const Q=(A==null?void 0:A.map(l=>l.table_name))||[];console.log(`ðŸ“Š Found ${Q.length} tables in database`);const c=Q.map(async l=>{try{const{count:U,error:me}=await Z.from(l).select("*",{count:"exact",head:!0});return me?(console.warn(`Could not count rows in ${l}:`,me),{table_name:l,row_count:0,checked:!1,category:S(l)}):{table_name:l,row_count:U||0,checked:!1,category:S(l)}}catch(U){return console.warn(`Error processing ${l}:`,U),{table_name:l,row_count:0,checked:!1,category:S(l)}}}),F=await Promise.all(c);y(F.sort((l,U)=>U.row_count-l.row_count)),oe.success(`Scanned ${F.length} tables`,{id:"scan"})}catch(A){console.error("Error scanning database:",A),oe.error(A.message||"Failed to scan database",{id:"scan"})}finally{P(!1),w(!1)}},S=A=>{for(const V of Et)if(V.tables.includes(A))return V.name;return"Other"},K=A=>{y(V=>V.map(Q=>Q.table_name===A?{...Q,checked:!Q.checked}:Q))},ee=A=>{const V=Et.find(c=>c.name===A);if(!V)return;const Q=i.filter(c=>V.tables.includes(c.table_name)).every(c=>c.checked);y(c=>c.map(F=>V.tables.includes(F.table_name)?{...F,checked:!Q}:F))},le=()=>{const A=!T;E(A),y(V=>V.map(Q=>({...Q,checked:A})))},D=A=>{n(V=>{const Q=new Set(V);return Q.has(A)?Q.delete(A):Q.add(A),Q})},H=()=>{const A=W.map(V=>V.name);n(new Set(A))},X=()=>{n(new Set)},a=async()=>{const A=i.filter(Q=>Q.checked);if(A.length===0){oe.error("No tables selected");return}if(h!=="DELETE"){oe.error("Please type DELETE to confirm");return}p(!0);const V=[];try{oe.loading(`Deleting data from ${A.length} tables...`,{id:"delete"});for(const l of A)try{const{count:U}=await Z.from(l.table_name).select("*",{count:"exact",head:!0}),{error:me}=await Z.from(l.table_name).delete().neq("id","00000000-0000-0000-0000-000000000000");if(me){let re=me.message;me.message.includes("foreign key constraint")&&(re="Cannot delete: Referenced by other tables. Delete dependent tables first or use SQL with CASCADE."),V.push({table:l.table_name,success:!1,error:re})}else V.push({table:l.table_name,success:!0,deletedRows:U||0})}catch(U){let me=U.message||"Unknown error";me.includes("foreign key constraint")&&(me="Cannot delete: Referenced by other tables. Delete dependent tables first."),V.push({table:l.table_name,success:!1,error:me})}const Q=V.filter(l=>l.success).length,c=V.filter(l=>!l.success).length,F=V.filter(l=>l.success).reduce((l,U)=>l+(U.deletedRows||0),0);Q>0&&oe.success(`Successfully deleted ${F.toLocaleString()} rows from ${Q} table(s)`,{id:"delete",duration:5e3}),c>0&&(oe.error(`Failed to delete data from ${c} table(s)`,{id:"delete-error",duration:5e3}),console.error("Failed deletions:",V.filter(l=>!l.success))),await R(),B(""),x(!1),y(l=>l.map(U=>({...U,checked:!1}))),E(!1)}catch(Q){console.error("Error during deletion:",Q),oe.error(Q.message||"Failed to delete data",{id:"delete"})}finally{p(!1)}},f=i.filter(A=>{const V=A.table_name.toLowerCase().includes(M.toLowerCase()),Q=_==="all"||A.category===_;return V&&Q}),W=Et.map(A=>({...A,tables:f.filter(V=>A.tables.includes(V.table_name)),totalRows:f.filter(V=>A.tables.includes(V.table_name)).reduce((V,Q)=>V+Q.row_count,0)})).filter(A=>A.tables.length>0),v=f.filter(A=>A.category==="Other");v.length>0&&W.push({name:"Other",description:"Uncategorized tables",tables:v,totalRows:v.reduce((A,V)=>A+V.row_count,0)});const L=i.filter(A=>A.checked),k=i.reduce((A,V)=>A+V.row_count,0),Y=L.reduce((A,V)=>A+V.row_count,0);return r.useEffect(()=>{R()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs($e,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Database Data Cleanup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select tables to remove data from"})]}),e.jsxs("div",{className:"group relative",children:[e.jsx(Ws,{className:"h-5 w-5 text-gray-400 hover:text-gray-600 cursor-help"}),e.jsxs("div",{className:"invisible group-hover:visible absolute left-0 top-8 z-50 w-80 p-4 bg-gray-900 text-white text-xs rounded-lg shadow-xl",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-400 mb-1",children:"âš ï¸ Warning"}),e.jsx("p",{children:"This permanently deletes data from selected tables. Cannot be undone. Make backups first!"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-400 mb-1",children:"ðŸ”— Foreign Keys"}),e.jsx("p",{children:"Delete child tables first if you get constraint errors. Example: delete purchase_order_payments before finance_accounts."})]})]}),e.jsx("div",{className:"absolute -top-1 left-4 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]})]}),e.jsxs(ge,{onClick:R,disabled:N,variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(be,{className:`w-4 h-4 ${N?"animate-spin":""}`}),N?"Scanning...":"Refresh Scan"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Total Tables"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:i.length})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-purple-600 font-medium mb-1",children:"Total Rows"}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:k.toLocaleString()})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium mb-1",children:"Selected Tables"}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:L.length})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium mb-1",children:"Rows to Delete"}),e.jsx("div",{className:"text-2xl font-bold text-red-900",children:Y.toLocaleString()})]})]}),e.jsxs("div",{className:"border border-indigo-200 rounded-lg bg-white mb-6",children:[e.jsxs("button",{onClick:()=>s(!u),disabled:m||N,className:"w-full flex items-center justify-between p-3 text-left hover:bg-indigo-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Le,{className:"h-4 w-4 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select Tables to Clean"}),!u&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["(",W.length," groups)"]}),L.length>0&&L.length<i.length&&e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full font-medium",children:[L.length,"/",i.length," tables"]}),L.length===i.length&&i.length>0&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-medium",children:"All tables selected"}),L.length===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full font-medium",children:"No tables selected"})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx(De,{className:`h-4 w-4 text-gray-500 transition-transform duration-200 ${u?"transform rotate-180":""}`})})]}),u&&e.jsx("div",{className:"border-t border-indigo-200 animate-in slide-in-from-top-2 duration-200",children:e.jsx("div",{className:"p-3",children:m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mx-auto"}),e.jsx("span",{className:"ml-3 text-sm text-gray-600",children:"Loading tables..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3 mb-3 pb-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-700",children:[L.length," of ",i.length," tables selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:H,className:"text-xs text-indigo-600 hover:text-indigo-700 font-medium px-2 py-1 hover:bg-indigo-50 rounded transition-colors",children:"Expand All"}),e.jsx("button",{onClick:X,className:"text-xs text-gray-600 hover:text-gray-700 font-medium px-2 py-1 hover:bg-gray-100 rounded transition-colors",children:"Collapse All"}),e.jsx("span",{className:"border-l border-gray-300 mx-1"}),e.jsx("button",{onClick:le,className:`px-3 py-1 text-xs rounded-lg font-medium transition-colors ${T?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:T?"Deselect All":"Select All"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ps,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 h-3.5 w-3.5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search tables...",value:M,onChange:A=>I(A.target.value),className:"w-full pl-8 pr-8 py-1.5 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-gray-50 focus:bg-white transition-colors"}),M&&e.jsx("button",{onClick:()=>I(""),className:"absolute right-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",title:"Clear search",children:e.jsx(Ns,{className:"h-3.5 w-3.5"})})]})]}),W.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Le,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No tables found"})]}):e.jsx("div",{className:"max-h-96 overflow-y-auto pr-2 custom-scrollbar space-y-3",children:W.map(A=>{const V=C.has(A.name),Q=A.tables,c=Q.every(re=>re.checked),F=Q.some(re=>re.checked)&&!c,l=b(A.name),U=l.icon,me=Q.filter(re=>re.checked).length;return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-white",children:e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>D(A.name),className:"flex items-center gap-2 flex-1 text-left hover:opacity-80 transition-opacity",children:[e.jsx(De,{className:`h-4 w-4 text-gray-500 transition-transform duration-200 ${V?"transform rotate-180":""}`}),e.jsx(U,{className:`h-4 w-4 ${l.color}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-800",children:A.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",Q.length," table",Q.length!==1?"s":"",")"]}),me>0&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${c?"bg-indigo-100 text-indigo-700":"bg-orange-100 text-orange-700"}`,children:[me,"/",Q.length]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:A.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-2 flex-shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs font-medium text-gray-600",children:[A.totalRows.toLocaleString()," rows"]})}),e.jsx("input",{type:"checkbox",checked:c,ref:re=>{re&&(re.indeterminate=F)},onChange:()=>ee(A.name),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded cursor-pointer",title:c?"Deselect all in category":"Select all in category"})]})]})}),V&&e.jsx("div",{className:"border-t border-gray-200 bg-white animate-in slide-in-from-top-2 duration-200",children:e.jsx("div",{className:"p-2 space-y-1",children:Q.map(re=>e.jsxs("label",{className:`flex items-center justify-between py-2 px-3 rounded-md cursor-pointer transition-colors group ${re.checked?"bg-indigo-50 hover:bg-indigo-100":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("input",{type:"checkbox",checked:re.checked,onChange:()=>K(re.table_name),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded cursor-pointer flex-shrink-0"}),e.jsx("span",{className:"font-mono text-sm text-gray-700 group-hover:text-gray-900 truncate",children:re.table_name})]}),e.jsx("div",{className:"flex items-center gap-2 ml-3 flex-shrink-0",children:e.jsxs("span",{className:`text-xs font-medium px-2 py-1 rounded ${re.row_count>0?"bg-gray-100 text-gray-700":"bg-green-100 text-green-700"}`,children:[re.row_count.toLocaleString()," row",re.row_count!==1?"s":""]})})]},re.table_name))})})]},A.name)})})]})})})]}),L.length>0&&e.jsx("div",{className:"pt-6 border-t border-gray-200",children:e.jsxs(ge,{onClick:()=>x(!0),disabled:t,variant:"danger",className:"w-full flex items-center justify-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),"Delete Data from ",L.length," Selected Table",L.length!==1?"s":"","(",Y.toLocaleString()," rows)"]})})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Fe,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Data Deletion"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-red-900 mb-2",children:"You are about to permanently delete data from:"}),e.jsx("ul",{className:"text-sm text-red-800 space-y-1 max-h-40 overflow-y-auto",children:L.map(A=>e.jsxs("li",{className:"font-mono",children:["â€¢ ",A.table_name," (",A.row_count.toLocaleString()," rows)"]},A.table_name))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-red-200",children:e.jsxs("p",{className:"text-sm font-semibold text-red-900",children:["Total: ",Y.toLocaleString()," rows will be deleted"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Type ",e.jsx("span",{className:"font-bold text-red-600",children:"DELETE"})," to confirm:"]}),e.jsx("input",{type:"text",value:h,onChange:A=>B(A.target.value),placeholder:"DELETE",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{x(!1),B("")},className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",disabled:t,children:"Cancel"}),e.jsx("button",{onClick:a,disabled:h!=="DELETE"||t,className:`flex-1 px-4 py-2 rounded-lg font-medium text-white transition-colors ${h==="DELETE"&&!t?"bg-red-600 hover:bg-red-700":"bg-gray-300 cursor-not-allowed"}`,children:t?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):"Delete Data"})]})]})})]})},an=async m=>{try{const{data:w,error:N}=await Z.from("migration_configurations").select("*").eq("user_id",m).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(N)throw console.error("Error fetching migration configs:",N),N;return w||[]}catch(w){throw console.error("Error fetching migration configs:",w),w}},rn=async(m,w)=>{try{w.is_default&&await Z.from("migration_configurations").update({is_default:!1}).eq("user_id",m).eq("is_default",!0);const{data:N,error:P}=await Z.from("migration_configurations").insert({...w,user_id:m}).select().single();if(P)throw console.error("Error saving migration config:",P),P;return N}catch(N){throw console.error("Error saving migration config:",N),N}},nn=async(m,w,N)=>{try{N.is_default&&await Z.from("migration_configurations").update({is_default:!1}).eq("user_id",w).eq("is_default",!0).neq("id",m);const{data:P,error:t}=await Z.from("migration_configurations").update(N).eq("id",m).eq("user_id",w).select().single();if(t)throw console.error("Error updating migration config:",t),t;return P}catch(P){throw console.error("Error updating migration config:",P),P}},ln=async(m,w)=>{try{const{error:N}=await Z.from("migration_configurations").delete().eq("id",m).eq("user_id",w);if(N)throw console.error("Error deleting migration config:",N),N}catch(N){throw console.error("Error deleting migration config:",N),N}},on=async(m,w)=>{try{await Z.from("migration_configurations").update({is_default:!1}).eq("user_id",w).eq("is_default",!0);const{error:N}=await Z.from("migration_configurations").update({is_default:!0}).eq("id",m).eq("user_id",w);if(N)throw console.error("Error setting default migration config:",N),N}catch(N){throw console.error("Error setting default migration config:",N),N}},ds={}.VITE_NEON_API_URL||"http://localhost:8000",cn=()=>{const[m,w]=r.useState([]),[N,P]=r.useState(""),[t,p]=r.useState(""),[i,y]=r.useState(!1),[M,I]=r.useState(!1),[_,$]=r.useState([]),[h,B]=r.useState(null),[j,x]=r.useState("both"),[T,E]=r.useState(""),[C,n]=r.useState(""),[u,s]=r.useState(null),[b,R]=r.useState("asc"),[S,K]=r.useState("all"),[ee,le]=r.useState(null),[D,H]=r.useState([]),[X,a]=r.useState(null),[f,W]=r.useState(!1),{currentUser:v}=Lt(),[L,k]=r.useState([]),[Y,A]=r.useState(null),[V,Q]=r.useState("Default Configuration"),[c,F]=r.useState(""),[l,U]=r.useState(""),[me,re]=r.useState(!1),[ie,ue]=r.useState(!0),[ye,z]=r.useState(""),[ae,je]=r.useState(""),[Se,we]=r.useState("Development"),[ve,_e]=r.useState("Production");r.useEffect(()=>{if(!(v!=null&&v.id))return;(async()=>{var q;try{const J=await an(v.id);k(J);const ne=J.find(pe=>pe.is_default)||J[0];ne?(ss(ne),A(ne.id),Q(ne.config_name)):J.length===0&&(A(null),Q("Default Configuration"))}catch(J){console.error("Error loading migration configs:",J),(q=J.message)!=null&&q.includes('relation "migration_configurations" does not exist')&&o.error("Migration configurations table not found. Please run: node run-migration-config-table.mjs",{duration:8e3}),Zs()}})()},[v==null?void 0:v.id]);const ss=d=>{ue(d.use_direct_connection),z(d.source_connection_string||""),je(d.target_connection_string||""),we(d.source_branch_name||"Development"),_e(d.target_branch_name||"Production"),F(d.neon_api_key||""),U(d.neon_project_id||"")},Zs=()=>{const d=localStorage.getItem("neon_api_key"),q=localStorage.getItem("neon_project_id"),J=localStorage.getItem("source_connection_string"),ne=localStorage.getItem("target_connection_string"),pe=localStorage.getItem("source_branch_name"),Te=localStorage.getItem("target_branch_name"),qe=localStorage.getItem("use_direct_connection");d&&F(d),q&&U(q),J&&z(J),ne&&je(ne),pe&&we(pe),Te&&_e(Te),qe!==null&&ue(qe==="true")};r.useEffect(()=>{if(!(!h||_.length===0))switch(j){case"schema-missing":if(h.tables_only_in_source.length>0){K("new");const d=h.tables_only_in_source;$(q=>q.map(J=>({...J,selected:d.includes(J.table_name)}))),o.success(`âš¡ Fast mode: Auto-selected ${d.length} missing table(s)`,{duration:3e3})}else $(d=>d.map(q=>({...q,selected:!1}))),o.info("No missing tables found. All tables already exist in target.",{duration:3e3});break;case"selective-data":case"schema-selective":(S==="new"||S==="modified")&&K("all");break;case"schema":Object.keys(h.columns_diff).length>0?(K("modified"),o.success(`Filtered to show ${Object.keys(h.columns_diff).length} modified table(s) with schema differences`,{duration:3e3})):h.tables_only_in_source.length>0&&(K("new"),o.success(`Filtered to show ${h.tables_only_in_source.length} new table(s)`,{duration:3e3}));break;case"data":case"both":(S==="new"||S==="modified")&&K("all");break}},[j]);const kt=async()=>{var d;if(!(v!=null&&v.id)){o.error("Please log in to save configurations");return}try{const q={config_name:V,use_direct_connection:ie,source_connection_string:ie?ye:void 0,target_connection_string:ie?ae:void 0,source_branch_name:ie?Se:void 0,target_branch_name:ie?ve:void 0,neon_api_key:ie?void 0:c,neon_project_id:ie?void 0:l,is_default:!0};if(Y){const J=await nn(Y,v.id,q);k(ne=>ne.map(pe=>pe.id===Y?J:pe)),o.success("Configuration updated successfully")}else{const J=await rn(v.id,q);A(J.id),k(ne=>[...ne.map(Te=>({...Te,is_default:!1})),J]),o.success("Configuration saved successfully")}re(!1),ie||He()}catch(q){console.error("Error saving config:",q),(d=q.message)!=null&&d.includes('relation "migration_configurations" does not exist')?o.error("Database table not found. Please run: node run-migration-config-table.mjs",{duration:1e4}):o.error(q.message||"Failed to save configuration")}},Ds=async d=>{if(v!=null&&v.id)try{const q=L.find(J=>J.id===d);q&&(ss(q),A(d),Q(q.config_name),o.success(`Loaded configuration: ${q.config_name}`))}catch(q){console.error("Error loading config:",q),o.error("Failed to load configuration")}},Is=async d=>{if(v!=null&&v.id&&window.confirm("Are you sure you want to delete this configuration?"))try{if(await ln(d,v.id),k(q=>q.filter(J=>J.id!==d)),Y===d){const q=L.filter(ne=>ne.id!==d),J=q.find(ne=>ne.is_default)||q[0];J?(ss(J),A(J.id),Q(J.config_name)):(A(null),ue(!0),z(""),je(""),we("Development"),_e("Production"),F(""),U(""))}o.success("Configuration deleted")}catch(q){console.error("Error deleting config:",q),o.error("Failed to delete configuration")}},He=async()=>{var d;if(!c||!l){o.error("Please configure Neon API credentials first"),re(!0);return}y(!0);try{const q=await fetch(`${ds}/api/neon/branches?projectId=${l}`,{headers:{Authorization:`Bearer ${c}`}});if(!q.ok)throw new Error("Failed to load branches");const J=await q.json();w(J.branches||[]),o.success(`Loaded ${((d=J.branches)==null?void 0:d.length)||0} branches`)}catch(q){console.error("Error loading branches:",q),o.error("Failed to load branches. Check your API credentials.")}finally{y(!1)}},St=async(d,q)=>{if(window.confirm(`Are you sure you want to delete the branch "${q}"?

âš ï¸ This action cannot be undone and will permanently delete all data in this branch.`)){y(!0);try{const ne=await fetch(`${ds}/api/neon/branches/${d}?projectId=${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(!ne.ok){const Te=await ne.json();throw new Error(Te.message||"Failed to delete branch")}const pe=await ne.json();o.success(pe.message),await He()}catch(ne){console.error("Error deleting branch:",ne),o.error(ne.message||"Failed to delete branch")}finally{y(!1)}}},_s=async()=>{try{return(await fetch(`${ds}/health`,{method:"GET",signal:AbortSignal.timeout(3e3)})).ok}catch(d){return console.log("Server health check failed:",d),!1}},Rs=async()=>{try{o.loading("Starting backend server automatically...",{id:"server-start"});try{if(!(await fetch("http://localhost:3002/health",{method:"GET",signal:AbortSignal.timeout(2e3)})).ok)throw new Error("Server starter service not available")}catch{return o.error("Server starter service not running. Please run: npm run server-starter",{id:"server-start",duration:8e3}),!1}const q=await(await fetch("http://localhost:3002/start-server",{method:"POST",headers:{"Content-Type":"application/json"}})).json();if(q.success){o.loading("Server starting... please wait",{id:"server-start"});let J=0;const ne=15;for(;J<ne;){if(await new Promise(Te=>setTimeout(Te,1e3)),await _s())return o.success("âœ… Server started successfully!",{id:"server-start"}),!0;J++,J%3===0&&o.loading(`Still starting server... (${J}s)`,{id:"server-start"})}return o.error("Server process started but not responding. Please check manually.",{id:"server-start"}),!1}else return o.error(`Failed to start server: ${q.message}`,{id:"server-start"}),!1}catch(d){return console.error("Error starting server:",d),o.error("Failed to start server automatically. Please check server starter service.",{id:"server-start"}),!1}},ks=async()=>{if(ie){if(!ye){o.error("Please enter source connection string");return}}else if(!N){o.error("Please select a source branch");return}if(y(!0),console.log("Checking server status..."),!await _s()&&(console.log("Server not running, attempting to start..."),!await Rs())){o.error("Backend server is required. Please start it manually with: cd server && npm run dev",{duration:8e3}),y(!1);return}try{const q=ie?{connectionString:ye,useDirectConnection:!0}:{branchId:N,apiKey:c,projectId:l,useDirectConnection:!1},J=await fetch(`${ds}/api/neon/tables`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!J.ok)throw new Error("Failed to load tables");const ne=await J.json(),pe=ne.tables.map(Te=>({...Te,selected:!0}));if($(pe),h){const Te=[...h.tables_only_in_source,...Object.keys(h.columns_diff)];Te.length>0?($(pe.map(qe=>({...qe,selected:Te.includes(qe.table_name)}))),h.tables_only_in_source.length>0&&Object.keys(h.columns_diff).length>0?K("all"):h.tables_only_in_source.length>0?K("new"):K("modified"),o.success(`Loaded ${ne.tables.length} tables - Showing ${Te.length} with differences`,{duration:4e3})):o.success(`Loaded ${ne.tables.length} tables`)}else o.success(`Loaded ${ne.tables.length} tables`)}catch(q){console.error("Error loading tables:",q),o.error("Failed to load tables from source branch")}finally{y(!1)}},dt=async()=>{if(ie){if(!ye||!ae){o.error("Please enter both source and target connection strings");return}}else if(!N||!t){o.error("Please select both source and target branches");return}if(y(!0),console.log("Checking server status for schema comparison..."),!await _s()&&(console.log("Server not running, attempting to start..."),!await Rs())){o.error("Backend server is required for schema comparison. Please start it manually with: cd server && npm run dev",{duration:8e3}),y(!1);return}try{const q=ie?{sourceConnectionString:ye,targetConnectionString:ae,useDirectConnection:!0}:{sourceBranchId:N,targetBranchId:t,apiKey:c,projectId:l,useDirectConnection:!1},J=await fetch(`${ds}/api/neon/compare-schemas`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!J.ok)throw new Error("Failed to compare schemas");const ne=await J.json();B(ne.diff);const pe=ne.diff,Te=[...pe.tables_only_in_source,...Object.keys(pe.columns_diff)];Te.length>0?(pe.tables_only_in_source.length>0&&Object.keys(pe.columns_diff).length>0?(K("all"),$(qe=>qe.map(Oe=>({...Oe,selected:Te.includes(Oe.table_name)})))):pe.tables_only_in_source.length>0?(K("new"),$(qe=>qe.map(Oe=>({...Oe,selected:pe.tables_only_in_source.includes(Oe.table_name)})))):Object.keys(pe.columns_diff).length>0&&(K("modified"),$(qe=>qe.map(Oe=>({...Oe,selected:Object.keys(pe.columns_diff).includes(Oe.table_name)})))),o.success(`Schema comparison complete - Showing ${Te.length} table(s) with differences`,{duration:4e3})):o.success("Schema comparison complete - No differences found",{duration:3e3})}catch(q){console.error("Error comparing schemas:",q),o.error("Failed to compare schemas")}finally{y(!1)}},Ms=async()=>{var Oe,Fs,Ls,Bs,mt,tt,$s,ut;if(console.log("ðŸš€ Start Migration button clicked!"),ie){if(!ye||!ae){o.error("Please enter both source and target connection strings");return}}else if(!N||!t){o.error("Please select both source and target branches");return}const d=_.filter(Me=>Me.selected).map(Me=>Me.table_name);if(d.length===0){o.error("Please select at least one table to migrate");return}const q=ie?Se:(Oe=m.find(Me=>Me.id===N))==null?void 0:Oe.name,J=ie?ve:(Fs=m.find(Me=>Me.id===t))==null?void 0:Fs.name;let ne=[];try{const Me=await fetch(`${ds}/api/neon/tables`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie?{connectionString:ae,useDirectConnection:!0}:{branchId:t,apiKey:c,projectId:l,useDirectConnection:!1})});Me.ok&&(ne=((Ls=(await Me.json()).tables)==null?void 0:Ls.map(g=>g.table_name))||[])}catch(Me){console.warn("Could not get target tables before migration:",Me)}const pe=[`Are you sure you want to migrate ${d.length} table(s) from ${q} to ${J}?`,"","This will:",j==="schema"||j==="both"||j==="schema-selective"?"- Update schema structure":"",j==="schema-missing"?"- Add only missing schema elements (columns, tables)":"",j==="data"||j==="both"?"- Copy all data records":"",j==="selective-data"||j==="schema-selective"?"- Copy only data records that don't exist in target":"","","âš ï¸ This action cannot be undone."].filter(Boolean).join(`
`);if(!window.confirm(pe))return;if(I(!0),E("Starting migration..."),a(null),H(["Starting migration..."]),console.log("Checking server status for migration..."),!await _s()&&(console.log("Server not running, attempting to start..."),!await Rs())){o.error("Backend server is required for migration. Please start it manually with: cd server && npm run dev",{duration:8e3}),I(!1),E("");return}try{const Me=ie?{sourceConnectionString:ye,targetConnectionString:ae,tables:d,migrationType:j,useDirectConnection:!0}:{sourceBranchId:N,targetBranchId:t,tables:d,migrationType:j,apiKey:c,projectId:l,useDirectConnection:!1},os=await fetch(`${ds}/api/neon/migrate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Me)});if(!os.ok){const G=await os.json();throw new Error(G.message||"Migration failed")}const g=(Bs=os.body)==null?void 0:Bs.getReader(),O=new TextDecoder;if(g){let G=0;const te=d.length,ce={tablesMigrated:[],totalRowsMigrated:0,totalRowsSkipped:0,totalErrors:0,schemaChanges:[],completedAt:null};let de="";const Ce=d;for(;;){const{done:he,value:Ne}=await g.read();if(he)break;const Ae=O.decode(Ne).split(`
`).filter(Je=>Je.trim());for(const Je of Ae)if(Je.startsWith("data: ")){const fe=JSON.parse(Je.slice(6)),at=fe.message;if(E(at),H(Pe=>[...Pe,at].slice(-20)),fe.message.includes("Processing table:"))de=((mt=fe.message.split("Processing table:")[1])==null?void 0:mt.trim())||"",de&&(le({currentTable:de,totalTables:te,completedTables:G,currentTableProgress:""}),ce.tablesMigrated.push({tableName:de,rowsMigrated:0,rowsSkipped:0,errors:0,status:"success"}));else if(fe.message.includes("Completed migration for")){const Pe=((tt=fe.message.split("Completed migration for")[1])==null?void 0:tt.trim())||de;G++,le(Qe=>Qe?{...Qe,completedTables:G,currentTable:""}:null)}else if(fe.message.includes("Migrated")&&fe.message.includes("/"))le(Pe=>Pe?{...Pe,currentTableProgress:fe.message}:null);else if(fe.message.includes("migration complete for")){const Pe=fe.message.match(/for\s+(\w+)\s+\((\d+)\s+rows\s+migrated(?:,\s*(\d+)\s+skipped)?(?:,\s*(\d+)\s+errors)?\)/);if(Pe){const Qe=Pe[1],xe=parseInt(Pe[2])||0,Ve=parseInt(Pe[3])||0,ts=parseInt(Pe[4])||0,as=ce.tablesMigrated.find(rt=>rt.tableName===Qe);as&&(as.rowsMigrated+=xe,as.rowsSkipped+=Ve,as.errors+=ts,as.status=ts>0?"partial":(xe>0,"success")),ce.totalRowsMigrated+=xe,ce.totalRowsSkipped+=Ve,ce.totalErrors+=ts}}else if(fe.message.includes("Table")&&fe.message.includes("created")){const Pe=($s=fe.message.match(/Table\s+(\w+)\s+created/))==null?void 0:$s[1];Pe&&(ce.schemaChanges.find(xe=>xe.tableName===Pe)||ce.schemaChanges.push({tableName:Pe,changes:["Table created"]}))}else if(fe.message.includes("Added")&&fe.message.includes("column")){const Pe=fe.message.match(/Added\s+(\d+)\s+column\(s\)\s+to\s+(\w+)/);if(Pe){const Qe=Pe[1],xe=Pe[2],Ve=ce.schemaChanges.find(ts=>ts.tableName===xe);Ve?Ve.changes.push(`${Qe} column(s) added`):ce.schemaChanges.push({tableName:xe,changes:[`${Qe} column(s) added`]})}}else if(fe.message.includes("Error migrating")){const Pe=fe.message.match(/Error migrating\s+(\w+):\s*(.+)/);if(Pe){const Qe=Pe[1],xe=ce.tablesMigrated.find(Ve=>Ve.tableName===Qe);xe&&(xe.status="error",xe.errors++),ce.totalErrors++}}fe.error&&o.error(fe.message)}}ce.completedAt=new Date,H(he=>[...he,"ðŸ” Verifying migrated tables in target database..."]),o.loading("Verifying migration...",{id:"verify"});try{const he=await fetch(`${ds}/api/neon/tables`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie?{connectionString:ae,useDirectConnection:!0}:{branchId:t,apiKey:c,projectId:l,useDirectConnection:!1})});if(he.ok){const Ee=((ut=(await he.json()).tables)==null?void 0:ut.map(Ae=>Ae.table_name))||[];for(const Ae of ce.tablesMigrated)if(Ee.includes(Ae.tableName))try{const fe=await fetch(`${ds}/api/neon/verify-table`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:Ae.tableName,...ie?{connectionString:ae,useDirectConnection:!0}:{branchId:t,apiKey:c,projectId:l,useDirectConnection:!1}})});if(fe.ok){const at=await fe.json();Ae.verified={exists:!0,rowCount:at.rowCount||0,verifiedAt:new Date}}else Ae.verified={exists:!0,verifiedAt:new Date}}catch{Ae.verified={exists:!0,verifiedAt:new Date}}else Ae.verified={exists:!1,verifiedAt:new Date};ce.debugInfo={sourceTables:Ce,targetTablesBefore:ne,targetTablesAfter:Ee,migrationType:j},H(Ae=>[...Ae,`âœ“ Verification complete: ${ce.tablesMigrated.filter(Je=>{var fe;return(fe=Je.verified)==null?void 0:fe.exists}).length}/${ce.tablesMigrated.length} tables verified in target`]),o.success("Migration verified successfully!",{id:"verify"})}else H(Ne=>[...Ne,"âš ï¸ Could not verify tables in target database"]),o.error("Could not verify migration",{id:"verify"})}catch(he){console.error("Verification error:",he),H(Ne=>[...Ne,"âš ï¸ Verification failed: "+he.message]),o.error("Verification failed",{id:"verify"})}a(ce)}o.success("Migration completed successfully!"),E("Migration completed!"),le(null),H(G=>[...G,"ðŸŽ‰ Migration completed successfully!"])}catch(Me){console.error("Migration error:",Me),o.error(Me.message||"Migration failed"),E(`Error: ${Me.message}`),H(os=>[...os,`âœ— Error: ${Me.message}`])}finally{I(!1)}},Xs=d=>{const q=_.map(J=>J.table_name===d?{...J,selected:!J.selected}:J);$(q),q.filter(J=>J.selected).length},Ct=()=>{const d=_.every(J=>J.selected),q=_.map(J=>({...J,selected:!d}));$(q),!d&&S==="selected"&&K("all")},At=()=>{if(!h){o.error("Please compare schemas first");return}const d=h.tables_only_in_source;$(_.map(q=>({...q,selected:d.includes(q.table_name)}))),K("new"),o.success(`Selected ${d.length} missing table(s) and filtered to show only new tables`)},bs=r.useMemo(()=>{let d=_;if(C&&(d=d.filter(q=>q.table_name.toLowerCase().includes(C.toLowerCase()))),S==="selected")d=d.filter(q=>q.selected);else if(S==="new"&&h)d=d.filter(q=>h.tables_only_in_source.includes(q.table_name));else if(S==="modified"&&h)d=d.filter(q=>h.columns_diff[q.table_name]&&h.tables_in_both.includes(q.table_name));else if(S==="all"&&h){const q=[...h.tables_only_in_source,...Object.keys(h.columns_diff)];q.length>0&&(d=d.filter(J=>q.includes(J.table_name)))}return u&&(d=[...d].sort((q,J)=>{let ne,pe;if(u==="table_name")ne=q.table_name.toLowerCase(),pe=J.table_name.toLowerCase();else if(u==="row_count")ne=q.row_count,pe=J.row_count;else if(u==="size"){const Te=qe=>{const Oe=qe.match(/^([\d.]+)\s*(kB|MB|GB|TB|bytes?)?/i);if(!Oe)return 0;const Fs=parseFloat(Oe[1]),Ls=(Oe[2]||"bytes").toLowerCase(),Bs={bytes:1,byte:1,kb:1024,mb:1024*1024,gb:1024*1024*1024,tb:1024*1024*1024*1024};return Fs*(Bs[Ls]||1)};ne=Te(q.size),pe=Te(J.size)}else return 0;return ne<pe?b==="asc"?-1:1:ne>pe?b==="asc"?1:-1:0})),d},[_,C,S,u,b,h]),et=d=>{u===d?R(b==="asc"?"desc":"asc"):(s(d),R("asc"))},st=d=>u!==d?e.jsx(ga,{className:"w-3 h-3 text-gray-400"}):b==="asc"?e.jsx(ur,{className:"w-3 h-3 text-indigo-600"}):e.jsx(xr,{className:"w-3 h-3 text-indigo-600"});return e.jsx("div",{className:"space-y-6",children:e.jsxs($e,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ct,{className:"w-5 h-5 text-indigo-600"}),"Database Branch Migration"]}),e.jsxs("button",{onClick:()=>re(!me),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1",children:[e.jsx(Le,{className:"w-4 h-4"}),"Configure Neon API"]})]}),me&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Branch Configuration"}),L.length>0&&e.jsxs("div",{className:"text-xs text-gray-600",children:[L.length," saved configuration",L.length!==1?"s":""]})]}),L.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-white rounded-lg border border-indigo-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Saved Configurations"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:L.map(d=>e.jsxs("div",{className:`flex items-center justify-between p-2 rounded border cursor-pointer transition-colors ${Y===d.id?"bg-indigo-100 border-indigo-400":"bg-gray-50 border-gray-200 hover:bg-gray-100"}`,onClick:()=>Ds(d.id),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[d.is_default&&e.jsx(Kt,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:d.config_name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",d.use_direct_connection?"Direct Connection":"Neon API",")"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[d.is_default&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded",children:"Default"}),e.jsx("button",{onClick:q=>{q.stopPropagation(),Is(d.id)},className:"p-1 text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Delete configuration",children:e.jsx(Re,{className:"w-3 h-3"})})]})]},d.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Configuration Name"}),e.jsx("input",{type:"text",value:V,onChange:d=>Q(d.target.value),placeholder:"e.g., Dev to Prod Migration",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:ie,onChange:()=>ue(!0),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Direct Connection Strings (Recommended)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:!ie,onChange:()=>ue(!1),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Neon API"})]})]}),ie?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Quick Setup:"})," Paste your PostgreSQL connection strings from Neon Console â†’ Branches â†’ Connection Details"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source Branch Name (e.g., Development)"}),e.jsx("input",{type:"text",value:Se,onChange:d=>we(d.target.value),placeholder:"Development",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source Connection String"}),e.jsx("textarea",{value:ye,onChange:d=>z(d.target.value),placeholder:"postgresql://user:password@ep-dev-branch.neon.tech/neondb?sslmode=require",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Get from Neon Console â†’ Your Project â†’ Branches â†’ Dev Branch â†’ Connection String"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Branch Name (e.g., Production)"}),e.jsx("input",{type:"text",value:ve,onChange:d=>_e(d.target.value),placeholder:"Production",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Connection String"}),e.jsx("textarea",{value:ae,onChange:d=>je(d.target.value),placeholder:"postgresql://user:password@ep-main-branch.neon.tech/neondb?sslmode=require",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Get from Neon Console â†’ Your Project â†’ Branches â†’ Main Branch â†’ Connection String"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Neon Project ID"}),e.jsx("input",{type:"text",value:l,onChange:d=>U(d.target.value),placeholder:"e.g., ep-young-firefly-123456",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Find this in your Neon console URL or project settings"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Neon API Key"}),e.jsx("input",{type:"password",value:c,onChange:d=>F(d.target.value),placeholder:"Enter your Neon API key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Generate an API key in your Neon account settings"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:kt,disabled:ie?!ye||!ae:!c||!l||!V.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),Y?"Update Configuration":"Save Configuration"]}),Y&&e.jsxs("button",{onClick:async()=>{if(v!=null&&v.id)try{await on(Y,v.id),k(d=>d.map(q=>({...q,is_default:q.id===Y}))),o.success("Set as default configuration")}catch{o.error("Failed to set default")}},className:"px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 flex items-center gap-2",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Set as Default"]})]})]}),ie?e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source Branch"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-md",children:[e.jsx(Le,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Se||"Not configured"}),ye&&e.jsx(ke,{className:"w-4 h-4 text-green-600 ml-auto"})]}),ye&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1 font-mono truncate",children:[ye.substring(0,50),"..."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Branch"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-md",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ve||"Not configured"}),ae&&e.jsx(ke,{className:"w-4 h-4 text-green-600 ml-auto"})]}),ae&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1 font-mono truncate",children:[ae.substring(0,50),"..."]})]})]})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Source Branch (From)"}),e.jsxs("select",{value:N,onChange:d=>P(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",disabled:i,children:[e.jsx("option",{value:"",children:"Select source branch..."}),m.map(d=>e.jsxs("option",{value:d.id,children:[d.name," (",d.database_name,")"]},d.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Branch (To)"}),e.jsxs("select",{value:t,onChange:d=>p(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",disabled:i,children:[e.jsx("option",{value:"",children:"Select target branch..."}),m.filter(d=>d.id!==N).map(d=>e.jsxs("option",{value:d.id,children:[d.name," (",d.database_name,")"]},d.id))]})]})]}),!ie&&m.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Branch Management"}),e.jsxs("button",{onClick:He,disabled:i,className:"px-3 py-1 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 text-sm",children:[e.jsx(be,{className:`w-3 h-3 ${i?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("div",{className:"space-y-3",children:m.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ct,{className:"w-4 h-4 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:d.name}),e.jsx("p",{className:"text-sm text-gray-500",children:d.database_name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${d.current_state==="ready"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:d.current_state}),e.jsx("button",{onClick:()=>St(d.id,d.name),disabled:i,className:"p-1 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md disabled:opacity-50",title:`Delete branch "${d.name}"`,children:e.jsx(Re,{className:"w-4 h-4"})})]})]},d.id))})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[!ie&&m.length===0&&e.jsxs("button",{onClick:He,disabled:i,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(be,{className:`w-4 h-4 ${i?"animate-spin":""}`}),i?"Loading...":"Load Branches"]}),e.jsxs("button",{onClick:ks,disabled:i||(ie?!ye:!N),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),"Load Tables"]}),e.jsxs("button",{onClick:dt,disabled:i||(ie?!ye||!ae:!N||!t),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Wt,{className:"w-4 h-4"}),"Compare Schemas"]})]}),_.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Migration Type"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-white border-2 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors",style:{borderColor:j==="schema"?"#6366f1":"#e5e7eb"},children:[e.jsx("input",{type:"radio",value:"schema",checked:j==="schema",onChange:d=>x(d.target.value),className:"text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:"Schema Only"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Creates tables and columns only, no data"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-white border-2 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors relative",style:{borderColor:j==="schema-missing"?"#6366f1":"#e5e7eb"},children:[e.jsx("input",{type:"radio",value:"schema-missing",checked:j==="schema-missing",onChange:d=>x(d.target.value),className:"text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm text-gray-900 flex items-center gap-2",children:["Schema Only (Missing)",e.jsxs("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs font-semibold rounded flex items-center gap-1",children:[e.jsx(vs,{className:"w-3 h-3"}),"FAST"]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Auto-selects only missing tables for faster migration"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-white border-2 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors",style:{borderColor:j==="data"?"#6366f1":"#e5e7eb"},children:[e.jsx("input",{type:"radio",value:"data",checked:j==="data",onChange:d=>x(d.target.value),className:"text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:"Data Only"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Copies all data records (schema must exist)"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-white border-2 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors",style:{borderColor:j==="selective-data"?"#6366f1":"#e5e7eb"},children:[e.jsx("input",{type:"radio",value:"selective-data",checked:j==="selective-data",onChange:d=>x(d.target.value),className:"text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:"Selective Data (Only Missing)"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Copies only records that don't exist in target"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-white border-2 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors",style:{borderColor:j==="schema-selective"?"#6366f1":"#e5e7eb"},children:[e.jsx("input",{type:"radio",value:"schema-selective",checked:j==="schema-selective",onChange:d=>x(d.target.value),className:"text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:"Schema + Selective Data"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Creates schema and copies only missing records"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-white border-2 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors",style:{borderColor:j==="both"?"#6366f1":"#e5e7eb"},children:[e.jsx("input",{type:"radio",value:"both",checked:j==="both",onChange:d=>x(d.target.value),className:"text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:"Schema + All Data"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Creates schema and copies all data records"})]})]})]})]}),h&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Schema Differences"}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded",children:"NEW = New table"}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded",children:"+COLS = Has new columns"})]})]}),h.tables_only_in_source.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-sm font-medium text-green-700 flex items-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4"}),"New Tables in Source (",h.tables_only_in_source.length,")"]}),e.jsx("ul",{className:"ml-6 mt-1 text-sm text-gray-600 list-disc",children:h.tables_only_in_source.map(d=>e.jsx("li",{children:d},d))})]}),h.tables_only_in_target.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-sm font-medium text-orange-700 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Tables Only in Target (",h.tables_only_in_target.length,")"]}),e.jsx("ul",{className:"ml-6 mt-1 text-sm text-gray-600 list-disc",children:h.tables_only_in_target.map(d=>e.jsx("li",{children:d},d))})]}),Object.keys(h.columns_diff).length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-blue-700 flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4"}),"Column Differences"]}),Object.entries(h.columns_diff).map(([d,q])=>e.jsxs("div",{className:"ml-6 mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:d}),q.only_in_source.length>0&&e.jsxs("p",{className:"text-xs text-green-600 ml-4",children:["New columns: ",q.only_in_source.join(", ")]}),q.type_changes.length>0&&e.jsxs("p",{className:"text-xs text-orange-600 ml-4",children:["Type changes: ",q.type_changes.map(J=>`${J.column} (${J.source_type} â†’ ${J.target_type})`).join(", ")]})]},d))]})]}),_.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Select Tables to Migrate (",_.filter(d=>d.selected).length,"/",_.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h&&h.tables_only_in_source.length>0&&e.jsxs("button",{onClick:At,className:"text-sm px-3 py-1.5 bg-green-100 text-green-700 rounded-md hover:bg-green-200 font-medium flex items-center gap-1",title:"Select only tables that don't exist in target and show only selected",children:[e.jsx(ke,{className:"w-3 h-3"}),"Select Missing Only (",h.tables_only_in_source.length,")"]}),_.filter(d=>d.selected).length>0&&e.jsxs("button",{onClick:()=>K("selected"),className:"text-sm px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-md hover:bg-indigo-200 font-medium flex items-center gap-1",title:"Show only selected tables",children:[e.jsx(Jt,{className:"w-3 h-3"}),"Show Only Selected (",_.filter(d=>d.selected).length,")"]}),e.jsx("button",{onClick:Ct,className:"text-sm px-3 py-1.5 text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md font-medium",children:_.every(d=>d.selected)?"Deselect All":"Select All"})]})]}),e.jsxs("div",{className:"mb-3 flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search tables...",value:C,onChange:d=>n(d.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:`w-4 h-4 ${S!=="all"?"text-indigo-600":"text-gray-400"}`}),e.jsxs("select",{value:S,onChange:d=>K(d.target.value),className:`px-3 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-sm ${S!=="all"?"border-indigo-300 bg-indigo-50":"border-gray-300"}`,children:[e.jsx("option",{value:"all",children:"All Tables"}),e.jsxs("option",{value:"selected",children:["Selected Only (",_.filter(d=>d.selected).length,")"]}),h&&h.tables_only_in_source.length>0&&e.jsxs("option",{value:"new",children:["New Tables (",h.tables_only_in_source.length,")"]}),h&&Object.keys(h.columns_diff).length>0&&e.jsxs("option",{value:"modified",children:["Modified Tables (",Object.keys(h.columns_diff).length,")"]})]}),S!=="all"&&e.jsx("button",{onClick:()=>K("all"),className:"text-xs text-gray-500 hover:text-gray-700 px-2 py-1 hover:bg-gray-100 rounded",title:"Clear filter",children:"Clear"})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg bg-white",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:e.jsx("input",{type:"checkbox",checked:bs.every(d=>d.selected),onChange:d=>{const q=bs.every(J=>J.selected);$(_.map(J=>bs.some(pe=>pe.table_name===J.table_name)?{...J,selected:!q}:J))},className:"rounded text-indigo-600"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",onClick:()=>et("table_name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Table Name",st("table_name")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",onClick:()=>et("row_count"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Rows",st("row_count")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",onClick:()=>et("size"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Size",st("size")]})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:bs.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-sm text-gray-500",children:"No tables found matching your search criteria"})}):bs.map(d=>{const q=h==null?void 0:h.tables_only_in_source.includes(d.table_name),J=h==null?void 0:h.columns_diff[d.table_name],ne=h==null?void 0:h.tables_in_both.includes(d.table_name);return e.jsxs("tr",{className:`hover:bg-gray-50 transition-colors ${d.selected?"bg-indigo-50 border-l-4 border-indigo-500":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:d.selected,onChange:()=>Xs(d.table_name),className:"rounded text-indigo-600 focus:ring-2 focus:ring-indigo-500"})}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-mono",children:d.table_name}),q&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-green-100 text-green-700 rounded-full border border-green-200",title:"New table - doesn't exist in target",children:"NEW"}),J&&ne&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-700 rounded-full border border-blue-200",title:"Has column differences",children:"+COLS"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"font-mono",children:d.row_count.toLocaleString()})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"font-mono",children:d.size})})]},d.table_name)})})]})}),C&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Showing ",bs.length," of ",_.length," tables"]})]}),M&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-r from-indigo-50 via-blue-50 to-purple-50 rounded-xl border-2 border-indigo-300 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"w-6 h-6 text-indigo-600 animate-spin"}),e.jsx("div",{className:"absolute inset-0 border-2 border-indigo-200 border-t-indigo-600 rounded-full animate-spin",style:{animationDuration:"1.5s"}})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Migration in Progress"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Please wait while tables are being migrated..."})]})]}),ee&&e.jsxs("div",{className:"mb-4 p-4 bg-white rounded-lg border-2 border-indigo-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-800",children:["Table ",ee.completedTables+1," of ",ee.totalTables]}),ee.currentTable&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Processing: ",e.jsx("span",{className:"font-mono font-medium text-indigo-600",children:ee.currentTable})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:[Math.round((ee.completedTables+(ee.currentTable?.5:1))/ee.totalTables*100),"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Complete"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-3 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-blue-500 h-3 rounded-full transition-all duration-500 flex items-center justify-end pr-2",style:{width:`${Math.min((ee.completedTables+(ee.currentTable?.5:1))/ee.totalTables*100,100)}%`},children:e.jsxs("span",{className:"text-xs font-medium text-white",children:[ee.completedTables+(ee.currentTable?1:0),"/",ee.totalTables]})})}),ee.currentTableProgress&&e.jsx("div",{className:"mt-2 p-2 bg-indigo-50 rounded border border-indigo-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-gray-700 font-mono",children:ee.currentTableProgress})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-indigo-100 shadow-sm",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex items-center justify-between",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4 text-indigo-600"}),"Activity Log"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[D.length," entries"]})]}),e.jsx("div",{className:"p-4 max-h-64 overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:D.length>0?D.map((d,q)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm animate-fade-in",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-1.5 flex-shrink-0 ${d.includes("âœ“")||d.includes("complete")?"bg-green-500":d.includes("âœ—")||d.includes("Error")||d.includes("error")?"bg-red-500":d.includes("âš ")?"bg-yellow-500":"bg-indigo-500 animate-pulse"}`}),e.jsx("p",{className:"text-gray-700 font-mono text-xs whitespace-pre-wrap break-words",children:d})]},q)):e.jsx("div",{className:"text-sm text-gray-400 italic",children:"Waiting for migration to start..."})})})]})]}),X&&!M&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border-2 border-green-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"w-6 h-6 text-green-600"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Migration Summary"})]}),e.jsx("button",{onClick:()=>a(null),className:"text-gray-400 hover:text-gray-600",title:"Close summary",children:e.jsx(Ns,{className:"w-5 h-5"})})]}),X.completedAt&&e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Completed at: ",X.completedAt.toLocaleString()]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:X.tablesMigrated.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Tables Migrated"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:X.totalRowsMigrated.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Rows Migrated"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-yellow-200",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:X.totalRowsSkipped.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Rows Skipped"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:X.totalErrors}),e.jsx("div",{className:"text-sm text-gray-600",children:"Errors"})]})]}),X.tablesMigrated.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"font-semibold text-gray-900",children:["Migrated Tables (",X.tablesMigrated.length,")"]}),e.jsxs("button",{onClick:()=>W(!f),className:"text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md flex items-center gap-1",children:[e.jsx(it,{className:"w-3 h-3"}),f?"Hide":"Show"," Debug Info"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg bg-white",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Table"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Rows Migrated"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Skipped"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Errors"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Verified"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:X.tablesMigrated.map((d,q)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm font-mono text-gray-900 font-medium",children:d.tableName}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700",children:d.rowsMigrated.toLocaleString()}),e.jsx("td",{className:"px-4 py-2 text-sm text-yellow-600",children:d.rowsSkipped.toLocaleString()}),e.jsx("td",{className:"px-4 py-2 text-sm text-red-600",children:d.errors}),e.jsx("td",{className:"px-4 py-2",children:d.verified?e.jsxs("div",{className:"flex flex-col gap-1",children:[d.verified.exists?e.jsxs("span",{className:"px-2 py-0.5 text-xs font-medium bg-green-100 text-green-700 rounded-full flex items-center gap-1 w-fit",children:[e.jsx(ke,{className:"w-3 h-3"}),"Verified"]}):e.jsxs("span",{className:"px-2 py-0.5 text-xs font-medium bg-red-100 text-red-700 rounded-full flex items-center gap-1 w-fit",children:[e.jsx(Ns,{className:"w-3 h-3"}),"Not Found"]}),d.verified.rowCount!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500",children:[d.verified.rowCount.toLocaleString()," rows"]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"Not verified"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${d.status==="success"?"bg-green-100 text-green-700":d.status==="error"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:d.status==="success"?"âœ“ Success":d.status==="error"?"âœ— Error":"âš  Partial"})})]},q))})]})})]}),f&&X.debugInfo&&e.jsxs("div",{className:"mb-4 p-4 bg-gray-900 rounded-lg border border-gray-700",children:[e.jsxs("h5",{className:"font-semibold text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4 text-blue-400"}),"Debug Information"]}),e.jsxs("div",{className:"space-y-3 text-xs font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Migration Type:"}),e.jsx("span",{className:"text-green-400 ml-2",children:X.debugInfo.migrationType})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-400",children:["Source Tables (",X.debugInfo.sourceTables.length,"):"]}),e.jsx("div",{className:"text-gray-300 ml-4 mt-1",children:X.debugInfo.sourceTables.join(", ")})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-400",children:["Target Tables Before (",X.debugInfo.targetTablesBefore.length,"):"]}),e.jsx("div",{className:"text-gray-300 ml-4 mt-1 max-h-20 overflow-y-auto",children:X.debugInfo.targetTablesBefore.length>0?X.debugInfo.targetTablesBefore.join(", "):"None"})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-400",children:["Target Tables After (",X.debugInfo.targetTablesAfter.length,"):"]}),e.jsx("div",{className:"text-gray-300 ml-4 mt-1 max-h-20 overflow-y-auto",children:X.debugInfo.targetTablesAfter.length>0?X.debugInfo.targetTablesAfter.join(", "):"None"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"New Tables Created:"}),e.jsx("div",{className:"text-green-400 ml-4 mt-1",children:X.debugInfo.targetTablesAfter.filter(d=>!X.debugInfo.targetTablesBefore.includes(d)).join(", ")||"None"})]})]})]}),X.schemaChanges.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Schema Changes"}),e.jsx("div",{className:"space-y-2",children:X.schemaChanges.map((d,q)=>e.jsxs("div",{className:"bg-white rounded-md p-3 border border-blue-200",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 font-mono mb-1",children:d.tableName}),e.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:d.changes.map((J,ne)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-3 h-3 text-blue-600"}),J]},ne))})]},q))})]})]}),_.length>0&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[_.filter(d=>d.selected).length," table(s) selected for migration"]}),e.jsxs("button",{onClick:Ms,disabled:M||_.filter(d=>d.selected).length===0||(ie?!ae:!t),className:"px-6 py-3 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 flex items-center gap-2 font-medium",children:[e.jsx(es,{className:"w-5 h-5"}),"Start Migration"]})]})]})})},dn=()=>{const{currentUser:m}=Lt(),[w]=aa(),[N,P]=r.useState("branding"),[t,p]=r.useState(!1),[i,y]=r.useState(!1),{saveAll:M,isSaving:I,hasChanges:_,setHasChanges:$}=Ps(),[h,B]=r.useState({branding:{appLogo:"",companyName:"Repair Shop Management",primaryColor:"#3B82F6",secondaryColor:"#1E40AF",logoSize:"medium",logoPosition:"left"},database:{url:"https://jxhzveborezjhsmzsgbc.supabase.co",projectId:"jxhzveborezjhsmzsgbc",region:"us-east-1",status:"online",lastSync:new Date().toISOString(),connectionPool:10,maxConnections:100,activeConnections:5},integrations:{sms:{provider:"Mobishastra",status:"active",balance:1e3,lastUsed:new Date().toISOString()},email:{provider:"Supabase Auth",status:"active",dailyLimit:1e3,usedToday:45},whatsapp:{provider:"Green API",status:"inactive",connected:!1,lastMessage:""},ai:{provider:"Google Gemini",status:"active",model:"gemini-pro",apiKeyConfigured:!0}},performance:{cacheEnabled:!0,cacheSize:512,compressionEnabled:!0,cdnEnabled:!1,loadBalancing:!1},automation:{autoBackup:!0,autoCleanup:!0,autoScaling:!1,autoUpdates:!1},attendance:{enabled:!0,allowEmployeeChoice:!0,availableSecurityModes:["auto-location","manual-location","wifi-only"],defaultSecurityMode:"auto-location",requireLocation:!0,requireWifi:!0,requirePhoto:!0,allowMobileData:!0,gpsAccuracy:50,checkInRadius:100,checkInTime:"08:00",checkOutTime:"17:00",gracePeriod:15,offices:[{name:"Arusha Main Office",lat:-3.359178,lng:36.661366,radius:100,address:"Main Office, Arusha, Tanzania",networks:[{ssid:"Office_WiFi",bssid:"00:11:22:33:44:55",description:"Main office WiFi network"},{ssid:"Office_Guest",description:"Guest WiFi network"},{ssid:"4G_Mobile",description:"Mobile data connection"}]}]},performanceMonitoring:{realTimeMetrics:!0,alertThresholds:{cpuUsage:80,memoryUsage:80,diskUsage:80,responseTime:2e3,errorRate:.5,activeConnections:100},autoScaling:{enabled:!1,minInstances:1,maxInstances:10,scaleUpThreshold:90,scaleDownThreshold:70},resourceLimits:{maxCpu:100,maxMemory:100,maxDisk:100,maxBandwidth:100,maxRequestsPerMinute:1e3},monitoringIntervals:{metricsCollection:60,alertCheck:60,healthCheck:60},performanceAlerts:{emailNotifications:!0,slackNotifications:!0,smsNotifications:!0,alertCooldown:15}}});r.useEffect(()=>{j();const C=w.get("section");C&&P(C)},[w]);const j=async()=>{p(!0);try{const{data:C,error:n}=await Z.from("settings").select("key, value");if(n){console.error("Error loading settings:",n),o.error("Failed to load system settings");return}const u={};C==null||C.forEach(b=>{try{u[b.key]=JSON.parse(b.value)}catch{u[b.key]=b.value}});const s=await Ra();B(b=>({...b,...u,attendance:s})),o.success("System settings loaded successfully")}catch(C){console.error("Error loading system settings:",C),o.error("Failed to load system settings")}finally{p(!1)}},x=async(C,n)=>{y(!0);try{if(C==="attendance")await Ma(n),B(u=>({...u,attendance:n}));else{const{error:u}=await Z.from("settings").upsert(Object.entries(n).map(([s,b])=>({key:`${C}_${s}`,value:JSON.stringify(b)})),{onConflict:"key"});if(u){console.error("Error saving settings:",u),o.error("Failed to save settings");return}}o.success("Settings saved successfully")}catch(u){console.error("Error saving settings:",u),o.error("Failed to save settings")}finally{y(!1)}},T=C=>{switch(C){case"online":case"active":return"text-green-500";case"offline":case"inactive":return"text-gray-500";case"error":return"text-red-500";default:return"text-yellow-500"}},E=C=>{switch(C){case"online":case"active":return e.jsx(ke,{className:"w-4 h-4 text-green-500"});case"offline":case"inactive":return e.jsx(xs,{className:"w-4 h-4 text-gray-500"});case"error":return e.jsx(Fe,{className:"w-4 h-4 text-red-500"});default:return e.jsx(it,{className:"w-4 h-4 text-yellow-500"})}};return!m||m.role!=="admin"?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:"transparent"},children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full border-2 border-red-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx(Fe,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You need admin privileges to access this page."})]})})}):e.jsx("div",{className:"min-h-screen p-4 sm:p-6",style:{backgroundColor:"transparent"},children:e.jsxs("div",{className:"max-w-7xl mx-auto h-[calc(100vh-2rem)] flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-white rounded-2xl shadow-2xl p-8 mb-6 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr,auto] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ze,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Admin Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage system configuration, backend settings, and database connections"})]}),e.jsx("div",{children:e.jsx("button",{onClick:async()=>{try{await M(),o.success("All settings saved successfully")}catch{o.error("Failed to save some settings")}},disabled:I||!_,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:I?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-5 h-5"}),"Save All Settings"]})})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 flex-1 min-h-0",children:[e.jsx("div",{className:"lg:col-span-1 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm p-6 h-full flex flex-col",children:[e.jsx("div",{className:"mb-6 pb-4 border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ze,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Settings Categories"})]})}),e.jsx("nav",{className:"space-y-2 overflow-y-auto flex-1 pr-2 sidebar-scrollbar",children:[{id:"branding",label:"Business Information",icon:ls,color:"indigo"},{id:"dashboard",label:"Dashboard",icon:Mt,color:"blue"},{id:"stores",label:"Store Management",icon:is,color:"orange"},{id:"branch-debug",label:"Branch Isolation Debug",icon:Dt,color:"red"},{id:"inventory",label:"Inventory",icon:Ue,color:"purple"},{id:"shipping",label:"Shipping Management",icon:Xe,color:"cyan"},{id:"payments",label:"Payments",icon:ms,color:"green"},{id:"attendance",label:"Attendance",icon:ze,color:"teal"},{id:"loyalty",label:"Loyalty Program",icon:ws,color:"yellow"},{id:"integrations",label:"Integrations",icon:Us,color:"emerald"},{id:"api-webhooks",label:"API & Webhooks",icon:$t,color:"pink"},{id:"documents",label:"Document Templates",icon:Ye,color:"violet"},{id:"appearance",label:"Appearance",icon:ia,color:"rose"},{id:"notifications",label:"Notifications",icon:ys,color:"amber"},{id:"database",label:"Database",icon:Le,color:"slate"},{id:"automation",label:"Automation",icon:hs,color:"lime"}].map(C=>{const n=N===C.id,u={indigo:n?"bg-indigo-50 border-indigo-300 text-indigo-700":"hover:bg-indigo-50 hover:border-indigo-200",blue:n?"bg-blue-50 border-blue-300 text-blue-700":"hover:bg-blue-50 hover:border-blue-200",orange:n?"bg-orange-50 border-orange-300 text-orange-700":"hover:bg-orange-50 hover:border-orange-200",red:n?"bg-red-50 border-red-300 text-red-700":"hover:bg-red-50 hover:border-red-200",purple:n?"bg-purple-50 border-purple-300 text-purple-700":"hover:bg-purple-50 hover:border-purple-200",cyan:n?"bg-cyan-50 border-cyan-300 text-cyan-700":"hover:bg-cyan-50 hover:border-cyan-200",green:n?"bg-green-50 border-green-300 text-green-700":"hover:bg-green-50 hover:border-green-200",teal:n?"bg-teal-50 border-teal-300 text-teal-700":"hover:bg-teal-50 hover:border-teal-200",yellow:n?"bg-yellow-50 border-yellow-300 text-yellow-700":"hover:bg-yellow-50 hover:border-yellow-200",emerald:n?"bg-emerald-50 border-emerald-300 text-emerald-700":"hover:bg-emerald-50 hover:border-emerald-200",pink:n?"bg-pink-50 border-pink-300 text-pink-700":"hover:bg-pink-50 hover:border-pink-200",violet:n?"bg-violet-50 border-violet-300 text-violet-700":"hover:bg-violet-50 hover:border-violet-200",rose:n?"bg-rose-50 border-rose-300 text-rose-700":"hover:bg-rose-50 hover:border-rose-200",amber:n?"bg-amber-50 border-amber-300 text-amber-700":"hover:bg-amber-50 hover:border-amber-200",slate:n?"bg-slate-50 border-slate-300 text-slate-700":"hover:bg-slate-50 hover:border-slate-200",sky:n?"bg-sky-50 border-sky-300 text-sky-700":"hover:bg-sky-50 hover:border-sky-200",lime:n?"bg-lime-50 border-lime-300 text-lime-700":"hover:bg-lime-50 hover:border-lime-200",indigo:n?"bg-indigo-50 border-indigo-300 text-indigo-700":"hover:bg-indigo-50 hover:border-indigo-200"};return e.jsxs("button",{onClick:()=>P(C.id),className:`w-full flex items-center gap-3 p-3.5 rounded-xl border-2 transition-all font-semibold text-sm shadow-sm hover:shadow-md ${n?u[C.color]:`border-gray-200 text-gray-700 bg-white ${u[C.color]}`}`,children:[e.jsx(C.icon,{className:`w-5 h-5 flex-shrink-0 ${n?"":"text-gray-500"}`}),e.jsx("span",{className:"text-sm",children:C.label})]},C.id)})})]})}),e.jsxs("div",{className:"lg:col-span-3 min-h-0 overflow-y-auto",children:[N==="shipping"&&e.jsx(Kr,{isActive:!0}),N==="appearance"&&e.jsx(Mr,{isActive:!0}),N==="notifications"&&e.jsx(Fr,{isActive:!0}),N==="payments"&&e.jsx(Lr,{isActive:!0}),N==="stores"&&e.jsx(Or,{}),N==="branding"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx($r,{})}),N==="dashboard"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx(sn,{})}),N==="branch-debug"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Dt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Branch Isolation Debug"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Debug and test branch data isolation settings"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsx(Jr,{}),e.jsx(Qr,{}),e.jsx(Xr,{}),e.jsx(en,{})]})})]}),N==="inventory"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx(Vr,{})}),N==="loyalty"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx(Ur,{})}),N==="api-webhooks"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx(Wr,{})}),N==="documents"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx(Gr,{})}),N==="database"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx(un,{})}),N==="integrations"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:e.jsx(Rr,{})}),N==="attendance"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-teal-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ze,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Attendance Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure employee attendance tracking and policies"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsx("div",{className:"py-6",children:e.jsx(mn,{settings:h.attendance,onSave:C=>x("attendance",C),getStatusIcon:E,getStatusColor:T})})})]}),N==="automation"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-lime-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(hs,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Automation Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure automated workflows and processes"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:e.jsx("div",{className:"py-6",children:e.jsx(xn,{settings:h.automation,onSave:C=>x("automation",C),getStatusIcon:E,getStatusColor:T})})})]})]})]})]})})},mn=({settings:m,onSave:w,getStatusIcon:N,getStatusColor:P})=>{var X;const[t,p]=r.useState(m),[i,y]=r.useState(!1),[M,I]=r.useState("general"),[_,$]=r.useState("mode-type");r.useEffect(()=>{p(m)},[m]),r.useEffect(()=>{!t.allowEmployeeChoice&&_==="available-modes"&&$("default-mode")},[t.allowEmployeeChoice,_]);const[h,B]=r.useState(null),[j,x]=r.useState(null),[T,E]=r.useState({name:"",lat:"",lng:"",radius:"100",address:"",networks:[{ssid:"",description:""}]}),[C,n]=r.useState([]),u=a=>{I(M===a?"":a)},s=()=>{const a=[];return t.enabled?(t.checkInRadius<10&&a.push("Check-in radius must be at least 10 meters"),t.gpsAccuracy<10&&a.push("GPS accuracy must be at least 10 meters"),(t.gracePeriod<0||t.gracePeriod>60)&&a.push("Grace period must be between 0 and 60 minutes"),t.offices.length===0&&a.push("At least one office location must be configured"),t.allowEmployeeChoice&&(!t.availableSecurityModes||t.availableSecurityModes.length===0)&&a.push("Please select at least one security mode for employees"),t.offices.forEach((f,W)=>{f.name.trim()||a.push(`Office ${W+1}: Name is required`),f.radius<10&&a.push(`Office ${W+1}: Radius must be at least 10 meters`),f.networks.length===0&&a.push(`Office ${W+1}: At least one WiFi network must be configured`)}),n(a),a.length===0):!0},b=async()=>{if(!s()){o.error("Please fix validation errors before saving");return}y(!0);try{await w(t),o.success("Attendance settings saved successfully"),n([])}catch(a){console.error("Failed to save attendance settings:",a),o.error("Failed to save attendance settings")}finally{y(!1)}},R=()=>{if(!T.name.trim()){o.error("Office name is required");return}if(!T.lat||!T.lng){o.error("Office coordinates (latitude and longitude) are required");return}const a=parseFloat(T.lat),f=parseFloat(T.lng);if(isNaN(a)||isNaN(f)){o.error("Invalid coordinates. Please enter valid numbers.");return}if(a<-90||a>90){o.error("Latitude must be between -90 and 90");return}if(f<-180||f>180){o.error("Longitude must be between -180 and 180");return}const W=parseInt(T.radius);if(isNaN(W)||W<10){o.error("Radius must be at least 10 meters");return}const v=T.networks.filter(L=>L.ssid.trim());if(v.length===0){o.error("At least one WiFi network with SSID is required");return}p({...t,offices:[...t.offices,{name:T.name,lat:a,lng:f,radius:W,address:T.address,networks:v}]}),E({name:"",lat:"",lng:"",radius:"100",address:"",networks:[{ssid:"",description:""}]}),o.success(`Office "${T.name}" added successfully`),n([])},S=a=>{p({...t,offices:t.offices.filter((f,W)=>W!==a)})},K=(a,f,W)=>{const v=[...t.offices];v[a]={...v[a],[f]:W},p({...t,offices:v})},ee=a=>{const f=[...t.offices];f[a].networks.push({ssid:"",description:""}),p({...t,offices:f})},le=(a,f)=>{const W=[...t.offices];W[a].networks.splice(f,1),p({...t,offices:W})},D=(a,f,W,v)=>{const L=[...t.offices];L[a].networks[f]={...L[a].networks[f],[W]:v},p({...t,offices:L})},H=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{E(f=>({...f,lat:a.coords.latitude.toString(),lng:a.coords.longitude.toString()})),o.success("Current location detected!")},a=>{console.error("Error getting location:",a),o.error("Failed to get current location. Please enter coordinates manually.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):o.error("Geolocation is not supported by this browser.")};return e.jsxs("div",{className:"space-y-6",children:[C.length>0&&e.jsx("div",{className:"mb-6 bg-red-50 border-2 border-red-200 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-red-900",children:"Validation Errors"}),e.jsx("button",{onClick:()=>n([]),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Dismiss"})]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-red-800",children:C.map((a,f)=>e.jsx("li",{children:a},f))})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>u("general"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-xl border-2 border-blue-200 shadow-sm",children:e.jsx(Ze,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"General Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure basic attendance options"})]})]}),M==="general"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),M==="general"&&e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-xl border-2 border-gray-200 shadow-sm",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Enable Attendance"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.enabled,onChange:a=>p({...t,enabled:a.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-xl border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Require Photo Verification"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.requirePhoto,onChange:a=>p({...t,requirePhoto:a.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 shadow-sm",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-xl",children:e.jsx(Es,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Security Mode Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Control how employees verify their attendance"})]})]})}),e.jsx("div",{className:"px-6 pt-6 pb-0 border-b border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>$("mode-type"),className:`px-6 py-3 text-sm font-semibold border-b-2 transition-colors ${_==="mode-type"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Mode Type"}),t.allowEmployeeChoice&&e.jsx("button",{type:"button",onClick:()=>$("available-modes"),className:`px-6 py-3 text-sm font-semibold border-b-2 transition-colors ${_==="available-modes"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Available Modes"}),e.jsx("button",{type:"button",onClick:()=>$("default-mode"),className:`px-6 py-3 text-sm font-semibold border-b-2 transition-colors ${_==="default-mode"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Default Mode"})]})}),e.jsxs("div",{className:"p-6",children:[_==="mode-type"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-3",children:"Security Mode Type"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>p({...t,allowEmployeeChoice:!0}),className:`p-4 rounded-xl border-2 transition-all text-left ${t.allowEmployeeChoice?"border-green-500 bg-green-50 shadow-md":"border-gray-200 bg-white hover:border-green-300 hover:shadow-sm"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl ${t.allowEmployeeChoice?"bg-green-500":"bg-gray-200"}`,children:e.jsx(ze,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Employee Choice"}),t.allowEmployeeChoice&&e.jsx(ke,{className:"w-4 h-4 text-green-600"})]}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:"Let employees pick their preferred security method from your approved list"})]})]})}),e.jsx("button",{onClick:()=>p({...t,allowEmployeeChoice:!1}),className:`p-4 rounded-xl border-2 transition-all text-left ${t.allowEmployeeChoice?"border-gray-200 bg-white hover:border-orange-300 hover:shadow-sm":"border-orange-500 bg-orange-50 shadow-md"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl ${t.allowEmployeeChoice?"bg-gray-200":"bg-orange-500"}`,children:e.jsx(Yt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Enforced Mode"}),!t.allowEmployeeChoice&&e.jsx(ke,{className:"w-4 h-4 text-orange-600"})]}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:"Require all employees to use one specific security method"})]})]})})]})]}),_==="available-modes"&&t.allowEmployeeChoice&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(It,{className:"w-5 h-5 text-blue-600"}),e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Select Available Security Modes"}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[((X=t.availableSecurityModes)==null?void 0:X.length)||0," selected"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[{value:"auto-location",icon:Ot,label:"Auto-Location",desc:"GPS auto-detection with fallback",iconColor:"text-blue-600",badge:"Recommended"},{value:"manual-location",icon:is,label:"Manual Location",desc:"Select office + GPS verify",iconColor:"text-indigo-600",badge:null},{value:"wifi-only",icon:Ft,label:"WiFi Only",desc:"Network verification only",iconColor:"text-purple-600",badge:null},{value:"location-and-wifi",icon:Yt,label:"Location + WiFi",desc:"Both GPS and network",iconColor:"text-orange-600",badge:"High Security"},{value:"photo-only",icon:Qt,label:"Photo Only",desc:"Photo verification only",iconColor:"text-pink-600",badge:"Least Secure"},{value:"all-security",icon:Es,label:"Maximum Security",desc:"GPS + WiFi + Photo",iconColor:"text-red-600",badge:"Max Security"}].map(a=>{var W;const f=((W=t.availableSecurityModes)==null?void 0:W.includes(a.value))||!1;return e.jsxs("label",{className:`relative p-4 rounded-xl border-2 cursor-pointer transition-all ${f?"border-blue-500 bg-blue-50 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 hover:shadow-sm"}`,children:[e.jsx("input",{type:"checkbox",checked:f,onChange:v=>{const L=t.availableSecurityModes||[];v.target.checked?p({...t,availableSecurityModes:[...L,a.value]}):p({...t,availableSecurityModes:L.filter(k=>k!==a.value)})},className:"sr-only"}),a.badge&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-bold ${a.badge==="Recommended"?"bg-green-500 text-white":a.badge==="High Security"?"bg-orange-500 text-white":a.badge==="Max Security"?"bg-red-500 text-white":"bg-yellow-500 text-white"}`,children:a.badge})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl border-2 ${f?"bg-white border-blue-500":"bg-gray-100 border-gray-200"}`,children:e.jsx(a.icon,{className:`w-5 h-5 ${f?a.iconColor:"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-900 truncate",children:a.label}),f&&e.jsx(ke,{className:"w-3 h-3 text-green-600 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-gray-600 leading-snug",children:a.desc})]})]})]},a.value)})}),(!t.availableSecurityModes||t.availableSecurityModes.length===0)&&e.jsxs("div",{className:"mt-3 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-xl flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-yellow-600"}),e.jsx("p",{className:"text-xs text-yellow-800",children:"Please select at least one security mode for employees"})]})]}),_==="default-mode"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:t.allowEmployeeChoice?"Default Security Mode":"Required Security Mode"}),e.jsxs("select",{value:t.defaultSecurityMode||"auto-location",onChange:a=>p({...t,defaultSecurityMode:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium transition-colors",children:[e.jsx("option",{value:"auto-location",children:"Auto-Location (GPS Auto-Detect)"}),e.jsx("option",{value:"manual-location",children:"Manual Location Selection"}),e.jsx("option",{value:"wifi-only",children:"WiFi Only"}),e.jsx("option",{value:"location-and-wifi",children:"Location + WiFi (High Security)"}),e.jsx("option",{value:"photo-only",children:"Photo Only"}),e.jsx("option",{value:"all-security",children:"Maximum Security (All Methods)"})]})]})]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>u("location"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-xl border-2 border-green-200 shadow-sm",children:e.jsx(is,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure GPS, radius, and time settings"})]})]}),M==="location"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),M==="location"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"GPS Accuracy (meters)"}),e.jsx("input",{type:"number",value:t.gpsAccuracy||0,onChange:a=>p({...t,gpsAccuracy:parseInt(a.target.value)||0}),min:"10",max:"1000",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Check-in Radius (meters)"}),e.jsx("input",{type:"number",value:t.checkInRadius||0,onChange:a=>p({...t,checkInRadius:parseInt(a.target.value)||0}),min:"10",max:"1000",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Grace Period (minutes)"}),e.jsx("input",{type:"number",value:t.gracePeriod||0,onChange:a=>p({...t,gracePeriod:parseInt(a.target.value)||0}),min:"0",max:"60",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Check-in Time"}),e.jsx("input",{type:"time",value:t.checkInTime||"",onChange:a=>p({...t,checkInTime:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Check-out Time"}),e.jsx("input",{type:"time",value:t.checkOutTime||"",onChange:a=>p({...t,checkOutTime:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>u("offices"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-xl border-2 border-purple-200 shadow-sm",children:e.jsx(ls,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Office Locations"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage office locations and WiFi networks"})]})]}),M==="offices"?e.jsx(Be,{className:"w-6 h-6 text-gray-600"}):e.jsx(De,{className:"w-6 h-6 text-gray-600"})]}),M==="offices"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(Ir,{offices:t.offices,selectedOffice:j,onOfficeSelect:a=>{x(a);const f=t.offices.findIndex(W=>W.name===(a==null?void 0:a.name)&&W.lat===(a==null?void 0:a.lat)&&W.lng===(a==null?void 0:a.lng));f!==-1&&B(f)},showRadius:!0}),j&&e.jsx("div",{className:"mt-3 p-4 bg-blue-50 rounded-xl border-2 border-blue-200 shadow-sm",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Selected:"})," ",j.name," - ",j.address]})})]}),t.offices.map((a,f)=>e.jsxs("div",{className:"bg-white rounded-xl p-6 mb-4 border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:a.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>B(h===f?null:f),className:"p-2.5 text-blue-600 hover:bg-blue-50 rounded-xl transition-colors border-2 border-blue-200 hover:border-blue-300 shadow-sm",children:e.jsx(Ys,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(f),className:"p-2.5 text-red-600 hover:bg-red-50 rounded-xl transition-colors border-2 border-red-200 hover:border-red-300 shadow-sm",children:e.jsx(Re,{className:"w-4 h-4"})})]})]}),h===f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Office Name"}),e.jsx("input",{type:"text",value:a.name,onChange:W=>K(f,"name",W.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("input",{type:"text",value:a.address,onChange:W=>K(f,"address",W.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Latitude"}),e.jsx("input",{type:"number",step:"any",value:a.lat||0,onChange:W=>K(f,"lat",parseFloat(W.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Longitude"}),e.jsx("input",{type:"number",step:"any",value:a.lng||0,onChange:W=>K(f,"lng",parseFloat(W.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Radius (meters)"}),e.jsx("input",{type:"number",value:a.radius||0,onChange:W=>K(f,"radius",parseInt(W.target.value)||0),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h6",{className:"font-medium text-gray-700",children:"WiFi Networks"}),e.jsx("button",{onClick:()=>ee(f),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(Ge,{className:"w-4 h-4"})})]}),a.networks.map((W,v)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"SSID",value:W.ssid,onChange:L=>D(f,v,"ssid",L.target.value),className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("input",{type:"text",placeholder:"Description",value:W.description,onChange:L=>D(f,v,"description",L.target.value),className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"}),e.jsx("button",{onClick:()=>le(f,v),className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(Re,{className:"w-4 h-4"})})]},v))]})]}):e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",a.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Coordinates:"})," ",a.lat,", ",a.lng]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Radius:"})," ",a.radius,"m"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Networks:"})," ",a.networks.length," configured"]})]})]},f)),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-dashed border-gray-300 shadow-sm",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-4",children:"Add New Office"}),e.jsx("div",{className:"mb-4",children:e.jsxs(ge,{onClick:H,className:"bg-green-600 text-white hover:bg-green-700",children:[e.jsx(gr,{className:"w-4 h-4 mr-2"}),"Get Current Location"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Office Name"}),e.jsx("input",{type:"text",value:T.name||"",onChange:a=>E({...T,name:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("input",{type:"text",value:T.address||"",onChange:a=>E({...T,address:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Latitude"}),e.jsx("input",{type:"number",step:"any",value:T.lat||"",onChange:a=>E({...T,lat:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Longitude"}),e.jsx("input",{type:"number",step:"any",value:T.lng||"",onChange:a=>E({...T,lng:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Radius (meters)"}),e.jsx("input",{type:"number",value:T.radius||"",onChange:a=>E({...T,radius:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 font-medium bg-white"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"font-medium text-gray-700 mb-2",children:"WiFi Networks"}),T.networks.map((a,f)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"SSID",value:a.ssid,onChange:W=>{const v=[...T.networks];v[f].ssid=W.target.value,E({...T,networks:v})},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Description",value:a.description,onChange:W=>{const v=[...T.networks];v[f].description=W.target.value,E({...T,networks:v})},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),T.networks.length>1&&e.jsx("button",{onClick:()=>{const W=T.networks.filter((v,L)=>L!==f);E({...T,networks:W})},className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(Re,{className:"w-4 h-4"})})]},f)),e.jsxs("button",{onClick:()=>E({...T,networks:[...T.networks,{ssid:"",description:""}]}),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",children:[e.jsx(Ge,{className:"w-4 h-4 mr-1"}),"Add Network"]})]}),e.jsx("button",{onClick:R,className:"w-full bg-blue-600 text-white py-3 px-6 rounded-xl hover:bg-blue-700 transition-all font-semibold shadow-lg hover:shadow-xl",children:"Add Office"})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex justify-end",children:e.jsx(ge,{onClick:b,disabled:i,className:"bg-blue-600 text-white hover:bg-blue-700",children:i?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Save Settings"]})})})})]})]})},un=()=>{const[m,w]=r.useState(!1),[N,P]=r.useState(0),[t,p]=r.useState(""),[i,y]=r.useState("full"),[M,I]=r.useState(!0),[_,$]=r.useState(null),[h,B]=r.useState([]),[j,x]=r.useState([]),[T,E]=r.useState(!1),[C,n]=r.useState(!1),[u,s]=r.useState([]),[b,R]=r.useState(""),[S,K]=r.useState(!1),[ee,le]=r.useState("daily"),[D,H]=r.useState("02:00"),[X,a]=r.useState("full"),[f,W]=r.useState(null),[v,L]=r.useState(!1),[k,Y]=r.useState(null),[A,V]=r.useState(null),[Q,c]=r.useState(null),[F,l]=r.useState([]),[U,me]=r.useState(!1),[re,ie]=r.useState(!1),[ue,ye]=r.useState("full"),[z,ae]=r.useState(!1),[je,Se]=r.useState(null),[we,ve]=r.useState(null),[_e,ss]=r.useState(0),[Zs,kt]=r.useState([]),[Ds,Is]=r.useState(!1),[He,St]=r.useState(Ke.getStatus()),[_s,Rs]=r.useState(!1),[ks,dt]=r.useState(30);r.useEffect(()=>{At(),Ct(),Ms(),Xs(),pt.startAutoSync();const g=Ke.subscribe(te=>{St(te)}),O=localStorage.getItem("auto_sync_interval");O&&dt(Math.round(parseInt(O,10)/1e3/60));const G=setInterval(()=>{Xs()},5e3);return()=>{clearInterval(G),pt.stopAutoSync(),g()}},[]);const Ms=()=>{const g=Os.getDownloadMetadata();ve(g)},Xs=()=>{const O=pt.getOfflineSales().filter(G=>!G.synced);ss(O.length),kt(O)},Ct=async()=>{try{const g=await Ar();V(g)}catch(g){g instanceof Error&&!g.message.includes("fetch")&&!g.message.includes("Failed to fetch")&&console.error("Failed to load restore formats:",g),V({formats:[{format:"SQL",extension:".sql",description:"PostgreSQL SQL dump format",advantages:["Standard PostgreSQL format","Contains both schema and data","Requires backend server for restore"]},{format:"JSON",extension:".json",description:"JSON backup format (RECOMMENDED for production)",advantages:["Works entirely client-side (no backend needed)","Human-readable","Easy to parse programmatically"]}],recommended:"JSON"})}},At=async()=>{try{I(!0);const{data:g,error:O}=await Z.from("lats_pos_general_settings").select("id, auto_backup_enabled, auto_backup_frequency, auto_backup_time, auto_backup_type, last_auto_backup").limit(1).single();if(O)throw O;g&&($(g.id),K(g.auto_backup_enabled||!1),le(g.auto_backup_frequency||"daily"),H(g.auto_backup_time||"02:00"),a(g.auto_backup_type||"full"),W(g.last_auto_backup||null))}catch(g){console.error("Error fetching auto backup settings:",g),o.error("Failed to load automatic backup settings")}finally{I(!1)}},bs=async()=>{if(!_){o.error("Settings ID not found");return}try{const{error:g}=await Z.from("lats_pos_general_settings").update({auto_backup_enabled:S,auto_backup_frequency:ee,auto_backup_time:D,auto_backup_type:X}).eq("id",_);if(g)throw g;o.success("Automatic backup settings saved!"),S&&setTimeout(()=>{},2e3)}catch(g){console.error("Error saving auto backup settings:",g),o.error("Failed to save automatic backup settings")}},et=async()=>{n(!0);try{const{data:g,error:O}=await Z.from("information_schema.tables").select("table_name").eq("table_schema","public").order("table_name");if(O)throw O;const G=(g==null?void 0:g.map(te=>te.table_name))||[];B(G)}catch(g){console.error("Error fetching tables:",g),o.error("Failed to fetch table list")}finally{n(!1)}},st=g=>{x(O=>O.includes(g)?O.filter(G=>G!==g):[...O,g])},d=()=>{x(h)},q=()=>{x([])},J=()=>{const g={lats_pos:[],user:[],product:[],transaction:[],inventory:[],system:[],other:[]};return(b?h.filter(G=>G.toLowerCase().includes(b.toLowerCase())):h).forEach(G=>{G.startsWith("lats_pos_")?g.lats_pos.push(G):G.startsWith("user")?g.user.push(G):G.startsWith("product")?g.product.push(G):G.includes("transaction")||G.includes("sale")||G.includes("payment")?g.transaction.push(G):G.includes("inventory")||G.includes("stock")||G.includes("warehouse")?g.inventory.push(G):G.includes("information_schema")||G.includes("pg_")||G.startsWith("_")?g.system.push(G):g.other.push(G)}),Object.keys(g).forEach(G=>{g[G].length===0&&delete g[G]}),g},ne=g=>{s(O=>O.includes(g)?O.filter(G=>G!==g):[...O,g])},pe=()=>{const g=Object.keys(J());s(g)},Te=()=>{s([])},qe=g=>{x(O=>{const G=[...O];return g.forEach(te=>{G.includes(te)||G.push(te)}),G})},Oe=g=>{x(O=>O.filter(G=>!g.includes(G)))},Fs=g=>g.every(O=>j.includes(O)),Ls=g=>{const O=g.filter(G=>j.includes(G)).length;return O>0&&O<g.length},Bs=g=>({lats_pos:{name:"POS Tables",icon:pr,color:"text-blue-600 bg-blue-50"},user:{name:"User Tables",icon:ze,color:"text-purple-600 bg-purple-50"},product:{name:"Product Tables",icon:Ue,color:"text-green-600 bg-green-50"},transaction:{name:"Transaction Tables",icon:ha,color:"text-orange-600 bg-orange-50"},inventory:{name:"Inventory Tables",icon:Vs,color:"text-teal-600 bg-teal-50"},system:{name:"System Tables",icon:Ze,color:"text-gray-600 bg-gray-50"},other:{name:"Other Tables",icon:pa,color:"text-indigo-600 bg-indigo-50"}})[g]||{name:g,icon:Ye,color:"text-gray-600 bg-gray-50"};r.useEffect(()=>{if(!S||!_)return;const g=async()=>{const G=new Date,te=f?new Date(f):null,[ce,de]=D.split(":").map(Number),Ce=new Date(G);if(Ce.setHours(ce,de,0,0),(()=>{if(!te)return!0;const Ne=Math.floor((G.getTime()-te.getTime())/(1e3*60*60*24));return ee==="daily"&&Ne>=1||ee==="weekly"&&Ne>=7||ee==="monthly"&&Ne>=30})()&&G>=Ce){console.log("ðŸ”„ Running automatic backup...");try{await Z.from("lats_pos_general_settings").update({last_auto_backup:G.toISOString()}).eq("id",_),W(G.toISOString())}catch(Ne){console.error("Error updating last backup timestamp:",Ne)}y(X),$s(!0)}},O=setInterval(g,60*60*1e3);return g(),()=>clearInterval(O)},[S,ee,D,X,f,_]);const mt=async(g,O=!1)=>{try{const G=new Date,te=G.toISOString().split("T")[0],ce=G.toTimeString().split(" ")[0].replace(/:/g,"-"),de=`backup_${te}_${ce}.json`,Ce=JSON.stringify(g,null,2),he=new Blob([Ce],{type:"application/json"});if(O){const Ne=URL.createObjectURL(he),Ee=document.createElement("a");Ee.href=Ne,Ee.download=`[Dukani Pro Backup] ${de}`,document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),URL.revokeObjectURL(Ne);const Ae=JSON.parse(localStorage.getItem("autoBackupHistory")||"[]");if(Ae.push({fileName:`[Dukani Pro Backup] ${de}`,date:G.toISOString(),size:he.size,type:g.backupType}),Ae.length>30){const fe=Ae.shift();console.log(`ðŸ—‘ï¸ Backup rotation: Removed old backup from history - ${fe.fileName}`),o("Old backup removed from tracking. Delete file from Desktop if needed.",{duration:4e3})}return localStorage.setItem("autoBackupHistory",JSON.stringify(Ae)),localStorage.getItem("backupReadmeCreated")||(tt(),localStorage.setItem("backupReadmeCreated","true")),{success:!0,fileName:`[Dukani Pro Backup] ${de}`,isAutomatic:!0}}else{const Ne=URL.createObjectURL(he),Ee=document.createElement("a");return Ee.href=Ne,Ee.download=de,document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),URL.revokeObjectURL(Ne),{success:!0,fileName:de,isAutomatic:!1}}}catch(G){return console.error("Error saving backup to local:",G),{success:!1,error:G}}},tt=()=>{const g=`# Dukani Pro Automatic Backup System

## ðŸ“ Backup Organization - IMPORTANT
Due to browser security, backups download to your Downloads folder.
Please MOVE them to Desktop and organize into: 

    Desktop/Dukani Pro [Backup]/

## ðŸ“ File Naming Convention
- Format: [Dukani Pro Backup] backup_YYYY-MM-DD_HH-MM-SS.json
- Example: [Dukani Pro Backup] backup_2025-11-11_14-30-00.json

## â™»ï¸ Backup Rotation (30 Backup Limit)
- System tracks last 30 automatic backups
- Old backup entries auto-removed from tracking when 31st is created
- Manually delete old backup files from Desktop to save disk space

## ðŸ”„ Recommended Workflow
1. Backups auto-download to Downloads folder
2. Move files to: Desktop/Dukani Pro [Backup]/
3. System auto-removes oldest entry after 30 backups
4. Manually delete old files from Desktop folder

## ðŸ’¡ Best Practices
1. Keep backups organized in Desktop/Dukani Pro [Backup]
2. Periodically verify backup integrity
3. Copy critical backups to external drive or cloud
4. Test restore process monthly

Generated: ${new Date().toLocaleString()}
`,O=new Blob([g],{type:"text/plain"}),G=URL.createObjectURL(O),te=document.createElement("a");te.href=G,te.download="[Dukani Pro Backup] README.txt",document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(G),o.success("ðŸ“„ Backup guide created! Move backups from Downloads to Desktop folder.",{duration:6e3})},$s=async(g=!1)=>{if(!g&&h.length>0&&j.length===0){o.error("Please select at least one table to backup");return}w(!0),P(0),p("Fetching database schema...");try{p("Loading complete database schema..."),P(5);const{data:O,error:G}=await Z.from("information_schema.tables").select("table_name").eq("table_schema","public").order("table_name");if(G)throw new Error("Failed to fetch database schema");let te=(O==null?void 0:O.map(xe=>xe.table_name))||[];j.length>0&&j.length<te.length?(te=te.filter(xe=>j.includes(xe)),console.log(`ðŸ“Š Found ${te.length} selected tables out of ${(O==null?void 0:O.length)||0} total tables`)):j.length===0?console.log(`ðŸ“Š Found ${te.length} tables in database schema (backing up all)`):console.log(`ðŸ“Š Found ${te.length} tables in database schema`),p(`Found ${te.length} tables. Fetching schema definitions...`),P(10);const{data:ce,error:de}=await Z.from("information_schema.columns").select("table_name, column_name, data_type, is_nullable, column_default").eq("table_schema","public").order("table_name").order("ordinal_position");de&&console.warn("Could not fetch column schema:",de);const Ce={};ce==null||ce.forEach(xe=>{Ce[xe.table_name]||(Ce[xe.table_name]=[]),Ce[xe.table_name].push({name:xe.column_name,type:xe.data_type,nullable:xe.is_nullable==="YES",default:xe.column_default})}),p(`Schema loaded. Backing up ${te.length} tables...`),P(15);const he=i==="schema-only"?"SCHEMA_ONLY":i==="data-only"?"DATA_ONLY":"FULL_SCHEMA_AND_DATA",Ne={timestamp:new Date().toISOString(),backupType:he,databaseInfo:{totalTables:te.length,backupIncludes:i==="schema-only"?"Table schemas only (no data)":i==="data-only"?"Table data only (no schema definitions)":"All tables with full schema and data (including empty tables)"},schema:i==="data-only"?void 0:Ce,tables:{},summary:{totalTables:0,tablesWithData:0,emptyTables:0,totalRecords:0}};let Ee=0,Ae=0,Je=0,fe=0;for(const xe of te)try{fe++;const Ve=15+fe/te.length*80;if(P(Ve),p(`Processing: ${xe} (${fe}/${te.length})`),i==="schema-only"){Ne.tables[xe]={exists:!0,recordCount:0,schema:Ce[xe]||[],data:null,note:"Schema only - data not included"};continue}const ts=[];let as=0;const rt=1e3;for(;;){const{data:Ss,error:Tt}=await Z.from(xe).select("*").range(as,as+rt-1);if(Tt){console.log(`âš ï¸ Could not read table '${xe}':`,Tt.message),Ne.tables[xe]={exists:!0,recordCount:0,schema:i==="data-only"?void 0:Ce[xe]||[],data:[],error:Tt.message},Je++;break}if(!Ss||Ss.length===0){as===0&&(Ne.tables[xe]={exists:!0,recordCount:0,schema:i==="data-only"?void 0:Ce[xe]||[],data:[]},Je++);break}if(ts.push(...Ss),Ss.length<rt)break;as+=rt,await new Promise(fa=>setTimeout(fa,30))}if(ts.length>0){const Ss=ts.length;Ne.tables[xe]={exists:!0,recordCount:Ss,schema:i==="data-only"?void 0:Ce[xe]||[],data:ts},Ee+=Ss,Ae++}}catch(Ve){Ne.tables[xe]={exists:!0,error:(Ve==null?void 0:Ve.message)||"Unknown error",schema:i==="data-only"?void 0:Ce[xe]||[],data:null},console.log(`âŒ Error backing up '${xe}': ${Ve.message}`)}if(Ne.summary.totalTables=te.length,Ne.summary.tablesWithData=Ae,Ne.summary.emptyTables=Je,Ne.summary.totalRecords=Ee,p("Saving backup file..."),P(95),!(await mt(Ne,g)).success)throw new Error("Failed to save backup file");const Pe=i==="schema-only"?`âœ… Schema backup completed! ${te.length} table schemas exported`:i==="data-only"?`âœ… Data backup completed! ${Ee.toLocaleString()} records from ${Ae} tables`:`âœ… Full backup completed! ${Ee.toLocaleString()} records from ${Ae} tables (${Je} empty tables included)`;p(Pe),P(100);const Qe=g?"ðŸ”„ Auto backup saved to Downloads. Move to Desktop/Dukani Pro [Backup]/":i==="schema-only"?`Schema backup: ${te.length} tables`:i==="data-only"?`Data backup: ${Ee.toLocaleString()} records`:`Full backup: ${te.length} tables, ${Ee.toLocaleString()} records`;o.success(Qe,{duration:g?6e3:4e3}),setTimeout(()=>{w(!1),P(0),p("")},g?3e3:5e3)}catch(O){p(`âŒ Backup failed: ${O.message}`),o.error(`Backup failed: ${O.message}`),w(!1)}},ut=async()=>{if(!k){o.error("âŒ Please select a backup file to restore");return}if(F.length===0&&Q&&Q.tables.length>0&&!confirm(`âš ï¸ No tables selected. This will restore ALL tables from the backup.

Are you sure you want to continue?`))return;const g=F.length===0||F.length===(Q==null?void 0:Q.tables.length)?"all tables":`${F.length} selected table(s)`,O=ue==="schema-only"?"schema only (table structures, no data)":"full (schema + data)",G=ue==="schema-only"?`âš ï¸ WARNING: Restoring ${g} ${O} from "${k.name}" will create/update table structures.

Existing data will NOT be affected, but table structures may be modified.

Are you sure you want to continue?`:`âš ï¸ WARNING: Restoring ${g} ${O} from "${k.name}" will overwrite current database data.

Are you sure you want to continue?`;if(confirm(G))try{L(!0);const te=F.length>0?F:void 0,ce=await Tr(k,te,ue);if(ce.success){const de=ce.data,he=`âœ… Restore completed successfully!

Type: ${ue==="schema-only"?"Schema Only":"Full"}
Tables restored: ${(de==null?void 0:de.tablesRestored)||"N/A"}
`+(ue==="full"?`Records restored: ${(de==null?void 0:de.recordsRestored)||"N/A"}
`:"")+`Format: ${(de==null?void 0:de.format)||"N/A"}`;de!=null&&de.warnings&&de.warnings.length>0?o.success(he+`

âš ï¸ Warnings:
${de.warnings.join(`
`)}`,{duration:6e3}):o.success(he,{duration:5e3}),Y(null),c(null),l([]),ie(!1),ye("full")}else{const de=ce.error||ce.message||"Unknown error";o.error(`âŒ Restore failed: ${de}`)}}catch(te){let ce="Unknown error";te instanceof Error&&(ce=te.message),o.error(`âŒ Restore failed: ${ce}`)}finally{L(!1)}},Me=async g=>{var G;const O=(G=g.target.files)==null?void 0:G[0];if(O){const te=O.name.endsWith(".sql"),ce=O.name.endsWith(".json"),de=O.name.endsWith(".gz")||O.name.endsWith(".sql.gz");if(!te&&!ce&&!de){o.error("âŒ Invalid file type. Please select a .sql, .json, or .sql.gz backup file."),g.target.value="";return}if(de)try{if(typeof DecompressionStream<"u"){const Ce=O.stream(),he=new DecompressionStream("gzip"),Ne=Ce.pipeThrough(he),Ee=await new Response(Ne).blob(),Ae=new File([Ee],O.name.replace(/\.gz$/,""),{type:"application/sql"});Y(Ae),c(null),l([]),ie(!1),ye("full"),await os(Ae);return}else{o.error("âš ï¸ Please extract the .gz file manually first. Download from GitHub Actions â†’ Extract ZIP â†’ Extract .gz â†’ Upload .sql file here"),g.target.value="";return}}catch{o.error("âŒ Failed to decompress file. Please extract the .gz file manually first."),g.target.value="";return}if(O.size>1024*1024*1024){o.error("âŒ File too large. Maximum file size is 1GB (1024MB)."),g.target.value="";return}Y(O),c(null),l([]),ie(!1),ye("full"),await os(O)}},os=async g=>{try{me(!0);const O=await Er(g);O.success&&O.data?(c(O.data),l(O.data.tables.map(G=>G.name)),ie(!0),o.success(`âœ… Backup preview loaded: ${O.data.totalTables} tables found`)):o.error(`âŒ Failed to preview backup file: ${O.error}`)}catch(O){o.error(`âŒ Error previewing backup file: ${O instanceof Error?O.message:"Unknown error"}`)}finally{me(!1)}};return M?e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading backup settings..."})]})}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Le,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Database Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Backup, restore, and manage your database"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",children:[e.jsx("div",{className:"py-6 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(us,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Backup & Restore"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create and restore database backups"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 bg-gray-50/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Auto Backup"}),e.jsxs("div",{className:"group relative",children:[e.jsx(Ws,{className:"h-4 w-4 text-gray-400 hover:text-gray-600 cursor-help"}),e.jsxs("div",{className:"invisible group-hover:visible absolute left-0 top-6 z-50 w-80 p-4 bg-gray-900 text-white text-xs rounded-xl shadow-xl border-2 border-gray-700",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Downloads to:"})," Downloads folder (browser limitation)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Move to:"})," Desktop/Dukani Pro [Backup]/"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"File Name:"})," [Dukani Pro Backup] backup_YYYY-MM-DD_HH-MM-SS.json"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Rotation:"})," Tracks 30 backups, auto-removes oldest"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Schedule:"})," Runs at configured time"]})]}),e.jsx("div",{className:"absolute -top-1 left-4 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:g=>K(g.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),S&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Frequency"}),e.jsxs("select",{value:ee,onChange:g=>le(g.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily (Recommended)"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Time"}),e.jsx("input",{type:"time",value:D,onChange:g=>H(g.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Backup Type"}),e.jsxs("select",{value:X,onChange:g=>a(g.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"full",children:"Full (Schema + Data)"}),e.jsx("option",{value:"schema-only",children:"Schema Only"}),e.jsx("option",{value:"data-only",children:"Data Only"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 p-2 bg-gray-50 rounded",children:[f?e.jsxs("span",{children:["Last: ",new Date(f).toLocaleDateString()]}):e.jsx("span",{children:"Last: Never"}),e.jsxs("div",{className:"group relative",children:[e.jsxs("span",{className:"text-blue-600 font-medium cursor-help",children:[JSON.parse(localStorage.getItem("autoBackupHistory")||"[]").length,"/30"]}),e.jsxs("div",{className:"invisible group-hover:visible absolute right-0 top-6 z-50 w-64 p-4 bg-gray-900 text-white text-xs rounded-xl shadow-lg border-2 border-gray-700",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Backup Rotation"}),e.jsx("p",{children:"â€¢ Tracks last 30 automatic backups"}),e.jsx("p",{children:"â€¢ Old entries auto-removed from history"}),e.jsx("p",{children:"â€¢ Delete old files from Desktop manually"}),e.jsx("p",{className:"text-yellow-300 mt-2",children:"ðŸ“ Desktop/Dukani Pro [Backup]/"}),e.jsx("div",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]}),e.jsxs("button",{onClick:tt,className:"w-full text-xs text-blue-600 hover:text-blue-700 hover:bg-blue-50 py-1.5 rounded transition-colors flex items-center justify-center gap-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),"Setup Guide"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(ge,{onClick:bs,className:"flex items-center justify-center gap-1 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(We,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:"Save"})]}),e.jsxs(ge,{onClick:()=>{const g=i;y(X),$s(!0),setTimeout(()=>y(g),100)},disabled:!S||m,className:"flex items-center justify-center gap-1 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[e.jsx(hs,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:"Run Now"})]})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(us,{className:"h-5 w-5 text-orange-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Manual Backup"}),e.jsxs("div",{className:"group relative",children:[e.jsx(Ws,{className:"h-4 w-4 text-gray-400 hover:text-gray-600 cursor-help"}),e.jsxs("div",{className:"invisible group-hover:visible absolute left-0 top-6 z-50 w-72 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Full:"})," Complete schema + all data"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Schema:"})," Table structures only"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Data:"})," Records only"]})]}),e.jsx("div",{className:"absolute -top-1 left-4 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Type"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{onClick:()=>y("full"),disabled:m,className:`px-3 py-2 text-xs font-medium rounded-lg border transition-all ${i==="full"?"bg-orange-600 text-white border-orange-600 shadow-sm":"bg-white text-gray-700 border-gray-300 hover:border-orange-500 hover:bg-orange-50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Full"}),e.jsx("button",{onClick:()=>y("schema-only"),disabled:m,className:`px-3 py-2 text-xs font-medium rounded-lg border transition-all ${i==="schema-only"?"bg-orange-600 text-white border-orange-600 shadow-sm":"bg-white text-gray-700 border-gray-300 hover:border-orange-500 hover:bg-orange-50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Schema"}),e.jsx("button",{onClick:()=>y("data-only"),disabled:m,className:`px-3 py-2 text-xs font-medium rounded-lg border transition-all ${i==="data-only"?"bg-orange-600 text-white border-orange-600 shadow-sm":"bg-white text-gray-700 border-gray-300 hover:border-orange-500 hover:bg-orange-50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Data"})]})]}),e.jsxs("div",{className:"border-2 border-gray-200 rounded-xl bg-white shadow-sm",children:[e.jsxs("button",{onClick:()=>{!T&&h.length===0&&et(),E(!T)},disabled:m,className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 rounded-xl transition-all disabled:opacity-50 border-2 border-transparent hover:border-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Le,{className:"h-3.5 w-3.5 text-gray-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Select Tables"}),!T&&h.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["(",Object.keys(J()).length," groups)"]}),j.length>0&&j.length<h.length&&e.jsxs("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full font-medium",children:[j.length,"/",h.length," tables"]}),j.length===h.length&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-medium",children:"All tables selected"}),j.length===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full font-medium",children:"No tables selected"})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx(De,{className:`h-4 w-4 text-gray-500 transition-transform duration-200 ${T?"transform rotate-180":""}`})})]}),T&&e.jsx("div",{className:"border-t border-orange-200 animate-in slide-in-from-top-2 duration-200",children:e.jsx("div",{className:"p-3",children:C?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-sm text-gray-600",children:"Loading tables..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3 mb-3 pb-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-700",children:[j.length," of ",h.length," tables selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:pe,className:"text-xs text-orange-600 hover:text-orange-700 font-semibold px-3 py-1.5 hover:bg-orange-50 rounded-xl transition-all border-2 border-orange-200 hover:border-orange-300 shadow-sm",children:"Expand All"}),e.jsx("button",{onClick:Te,className:"text-xs text-gray-600 hover:text-gray-700 font-semibold px-3 py-1.5 hover:bg-gray-100 rounded-xl transition-all border-2 border-gray-200 hover:border-gray-300 shadow-sm",children:"Collapse All"}),e.jsx("span",{className:"border-l border-gray-300 mx-1"}),e.jsx("button",{onClick:d,className:"text-xs text-orange-600 hover:text-orange-700 font-semibold px-3 py-1.5 hover:bg-orange-50 rounded-xl transition-all border-2 border-orange-200 hover:border-orange-300 shadow-sm",children:"Select All"}),e.jsx("button",{onClick:q,className:"text-xs text-gray-600 hover:text-gray-700 font-semibold px-3 py-1.5 hover:bg-gray-100 rounded-xl transition-all border-2 border-gray-200 hover:border-gray-300 shadow-sm",children:"Deselect All"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ps,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 h-3.5 w-3.5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search tables...",value:b,onChange:g=>R(g.target.value),className:"w-full pl-8 pr-8 py-2.5 text-xs border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 bg-white transition-colors font-medium"}),b&&e.jsx("button",{onClick:()=>R(""),className:"absolute right-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",title:"Clear search",children:e.jsx(Ns,{className:"h-3.5 w-3.5"})})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto pr-2 custom-scrollbar",children:Object.keys(J()).length===0&&b?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ps,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-sm",children:['No tables found matching "',b,'"']}),e.jsx("button",{onClick:()=>R(""),className:"text-xs text-orange-600 hover:text-orange-700 font-medium mt-2",children:"Clear search"})]}):Object.entries(J()).map(([g,O])=>{const G=Bs(g),te=u.includes(g),ce=Fs(O),de=Ls(O),Ce=O.filter(he=>j.includes(he)).length;return e.jsxs("div",{className:"mb-2 border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-white",children:e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("button",{onClick:()=>ne(g),className:"flex items-center gap-2 flex-1 text-left hover:opacity-80 transition-opacity",children:[e.jsx(De,{className:`h-4 w-4 text-gray-500 transition-transform duration-200 ${te?"transform rotate-180":""}`}),jt.createElement(G.icon,{className:`h-4 w-4 ${G.color.split(" ")[0]}`}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:G.name}),e.jsxs("span",{className:"text-xs text-gray-500 font-normal",children:["(",O.length," table",O.length!==1?"s":"",")"]}),Ce>0&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${ce?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:[Ce,"/",O.length]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:e.jsx("input",{type:"checkbox",checked:ce,ref:he=>{he&&(he.indeterminate=de)},onChange:he=>{he.target.checked?qe(O):Oe(O)},className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded cursor-pointer",title:ce?"Deselect all in group":"Select all in group"})})]})}),te&&e.jsx("div",{className:"border-t border-gray-200 bg-white animate-in slide-in-from-top-2 duration-200",children:e.jsx("div",{className:"p-2 space-y-1",children:O.map(he=>e.jsxs("label",{className:"flex items-center py-2 px-3 hover:bg-orange-50 rounded-md cursor-pointer transition-colors group",children:[e.jsx("input",{type:"checkbox",checked:j.includes(he),onChange:()=>st(he),className:"mr-3 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded cursor-pointer"}),e.jsx("span",{className:"text-sm text-gray-700 font-mono group-hover:text-gray-900",children:he})]},he))})})]},g)})}),h.length===0&&!b&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Le,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No tables found in database"})]})]})})})]}),m&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 truncate",children:t}),e.jsxs("span",{className:"font-medium text-blue-600",children:[Math.round(N),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${N}%`}})})]}),!m&&t&&e.jsx("div",{className:`p-2 rounded text-xs ${t.includes("âœ…")?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:t}),e.jsx(ge,{onClick:$s,disabled:m,className:"w-full flex items-center justify-center gap-2 bg-orange-600 hover:bg-orange-700 text-white",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{className:"text-sm",children:"Backing up..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(us,{className:"w-3 h-3"}),e.jsx("span",{className:"text-sm",children:"Download Backup"})]})})]})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(es,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Restore from Backup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Restore database from backup files"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"group relative",children:[e.jsx(Ws,{className:"h-4 w-4 text-gray-400 hover:text-gray-600 cursor-help"}),e.jsxs("div",{className:"invisible group-hover:visible absolute left-0 top-6 z-50 w-96 p-4 bg-gray-900 text-white text-xs rounded-xl shadow-xl border-2 border-gray-700",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:"ðŸ“¥ How to Download from GitHub Actions:"}),e.jsxs("ol",{className:"space-y-1 ml-4 list-decimal",children:[e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://github.com/Mtaasisi/NEON-POS/actions",target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-300",children:"Actions tab"})]}),e.jsx("li",{children:'Find "Automatic Neon Database Backup" or "Automatic NEON 02 Database Backup"'}),e.jsx("li",{children:'Click on a workflow run â†’ Scroll to "Artifacts" section'}),e.jsx("li",{children:"Download the backup ZIP file"}),e.jsx("li",{children:"Extract the ZIP â†’ Extract the .gz file â†’ Upload the .sql file here"})]}),e.jsx("p",{className:"text-blue-300 mt-2",children:"ðŸ’¡ Tip: You can also upload the .sql.gz file directly - it will be automatically decompressed!"}),e.jsxs("div",{className:"border-t border-gray-700 pt-2 mt-2",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:"ðŸ“‹ Supported Formats:"}),A==null?void 0:A.formats.map((g,O)=>e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-semibold",children:g.format})," (",g.extension,") - ",g.description,g.format===A.recommended&&e.jsx("span",{className:"ml-1 px-1 py-0.5 bg-blue-600 rounded text-xs",children:"RECOMMENDED"})]},O)),e.jsx("p",{className:"text-xs text-gray-300 mt-1",children:(A==null?void 0:A.note)||"SQL format is recommended as it is the easiest to restore."})]})]}),e.jsx("div",{className:"absolute -top-1 left-4 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})}),e.jsx(es,{className:"w-6 h-6 text-orange-600"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Backup File"}),e.jsxs("div",{className:"group relative",children:[e.jsx(Ws,{className:"h-3.5 w-3.5 text-gray-400 hover:text-gray-600 cursor-help"}),e.jsxs("div",{className:"invisible group-hover:visible absolute left-0 top-5 z-50 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl border-2 border-gray-700",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Accepted File Types:"}),e.jsxs("ul",{className:"space-y-1 ml-3 list-disc",children:[e.jsx("li",{children:".sql - SQL dump file (recommended)"}),e.jsx("li",{children:".json - JSON backup file"}),e.jsx("li",{children:".sql.gz or .gz - Compressed SQL file (auto-decompressed)"})]}),e.jsx("p",{className:"mt-2 text-gray-300",children:"Maximum file size: 1GB"}),e.jsx("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]}),e.jsx("input",{type:"file",accept:".sql,.json,.gz,.sql.gz",onChange:Me,className:`block w-full text-sm text-gray-500
              file:mr-4 file:py-2 file:px-4
              file:rounded-md file:border-0
              file:text-sm file:font-semibold
              file:bg-blue-50 file:text-blue-700
              hover:file:bg-blue-100
              cursor-pointer border border-gray-300 rounded-md p-2`,disabled:v})]}),k&&e.jsx("div",{className:"p-3 bg-green-50 rounded-md border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:k.name}),e.jsxs("p",{className:"text-xs text-green-700",children:[(k.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx("button",{onClick:()=>{Y(null),c(null),l([]),ie(!1),ye("full")},className:"text-red-600 hover:text-red-800 transition-colors",disabled:v,title:"Remove file",children:e.jsx(Re,{size:16})})]})}),U&&e.jsx("div",{className:"p-3 bg-blue-50 rounded-md border border-blue-200",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsx("p",{className:"text-sm text-blue-900",children:"Analyzing backup file..."})]})}),Q&&re&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Restore Type:"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ye("full"),className:`px-3 py-1.5 text-xs font-semibold rounded-lg transition-all ${ue==="full"?"bg-blue-600 text-white shadow-sm":"bg-white text-gray-700 border-2 border-gray-300 hover:border-blue-400"}`,children:"Full (Schema + Data)"}),e.jsx("button",{onClick:()=>ye("schema-only"),className:`px-3 py-1.5 text-xs font-semibold rounded-lg transition-all ${ue==="schema-only"?"bg-blue-600 text-white shadow-sm":"bg-white text-gray-700 border-2 border-gray-300 hover:border-blue-400"}`,children:"Schema Only (No Data)"})]})]}),ue==="schema-only"&&e.jsx("p",{className:"mt-2 text-xs text-blue-700",children:"â“˜ Only table structures (CREATE, ALTER statements) will be restored. No data will be inserted."})]}),Q&&re&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Select Tables to Restore"}),e.jsxs("div",{className:"group relative",children:[e.jsx(Ws,{className:"h-3.5 w-3.5 text-gray-400 hover:text-gray-600 cursor-help"}),e.jsxs("div",{className:"invisible group-hover:visible absolute left-0 top-5 z-50 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl border-2 border-gray-700",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Table Selection:"}),e.jsxs("ul",{className:"space-y-1 ml-3 list-disc",children:[e.jsx("li",{children:"Select specific tables to restore only those tables"}),e.jsx("li",{children:"Or select all tables to restore the entire backup"}),e.jsx("li",{children:"Restoring will overwrite existing data in selected tables"})]}),e.jsx("p",{className:"mt-2 text-yellow-300",children:"âš ï¸ Warning: This action cannot be undone!"}),e.jsx("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:[Q.totalTables," tables â€¢ ",Q.totalRecords.toLocaleString()," records"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>l(Q.tables.map(g=>g.name)),className:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"All"}),e.jsx("button",{onClick:()=>l([]),className:"px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"None"})]})]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-gray-200 rounded-md p-2 bg-white",children:Q.tables.map(g=>e.jsxs("label",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:F.includes(g.name),onChange:()=>{l(O=>O.includes(g.name)?O.filter(G=>G!==g.name):[...O,g.name])},disabled:v,className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:g.name}),e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",g.recordCount.toLocaleString()," records)"]})]})]},g.name))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:F.length})," of ",e.jsx("strong",{children:Q.tables.length})," tables selected",F.length>0&&ue==="full"&&e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:["(",Q.tables.filter(g=>F.includes(g.name)).reduce((g,O)=>g+O.recordCount,0).toLocaleString()," records will be restored)"]}),F.length>0&&ue==="schema-only"&&e.jsx("span",{className:"ml-2 text-blue-600 font-semibold",children:"(Only table structures will be restored - no data)"})]})})]}),e.jsx("button",{onClick:ut,disabled:!k||F.length===0||v,className:"w-full px-4 py-2.5 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-sm",children:v?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 animate-spin"}),"Restoring..."]}):F.length===0?e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"w-4 h-4"}),"Select Tables to Restore"]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"w-4 h-4"}),"Restore ",F.length," Table",F.length!==1?"s":""," (",ue==="schema-only"?"Schema Only":"Full",")"]})}),e.jsx("div",{className:"p-3 bg-yellow-50 rounded-md border border-yellow-200",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["âš ï¸ ",e.jsx("strong",{children:"Warning:"})," Restoring will overwrite existing data in the database. Make sure you have a current backup before proceeding."]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(Gs,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Offline Database"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Download database for offline-first operation"})]}),Os.isDownloaded()&&e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"}),"Downloaded"]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[we?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Last Downloaded"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900 flex items-center gap-1",children:[e.jsx(ot,{className:"w-4 h-4"}),new Date(we.timestamp).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Download Time"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[(we.downloadTime/1e3).toFixed(1),"s"]})]})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Downloaded Data"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Products:"}),e.jsx("span",{className:"font-semibold",children:we.data.products||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Customers:"}),e.jsx("span",{className:"font-semibold",children:we.data.customers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Categories:"}),e.jsx("span",{className:"font-semibold",children:we.data.categories||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Suppliers:"}),e.jsx("span",{className:"font-semibold",children:we.data.suppliers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Variants:"}),e.jsx("span",{className:"font-semibold",children:we.data.variants||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Employees:"}),e.jsx("span",{className:"font-semibold",children:we.data.employees||0})]})]})]})]}):e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(Le,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No database downloaded yet"})]}),z&&je&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:["Downloading ",je.currentTask,"..."]}),e.jsxs("span",{className:"text-sm font-semibold text-blue-700",children:[je.percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${je.percentage}%`}})}),e.jsxs("p",{className:"text-xs text-blue-700 mt-2",children:[je.current," of ",je.total," tasks completed"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[e.jsx("button",{onClick:async()=>{if(confirm("This will download all essential data to your local storage. This may take a few minutes. Continue?")){ae(!0),Se(null);try{const g=await Os.downloadFullDatabase(O=>{Se(O)});if(g.success){const O=Object.values(g.data).reduce((G,te)=>G+te,0);o.success(`âœ… Database downloaded successfully! ${O} items downloaded.`),Ms(),navigator.onLine&&!Ke.isEnabled()&&Ke.startAutoSync()}else o.error(`âŒ Download failed: ${g.error}`)}catch{o.error("Failed to download database")}finally{ae(!1),Se(null)}}},disabled:z,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:z?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 animate-spin"}),"Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(us,{className:"w-4 h-4"}),"Download Full Database"]})}),we&&e.jsxs("button",{onClick:()=>{confirm("Are you sure you want to clear all downloaded database? This will remove all locally cached data.")&&(Os.clearDownload(),Ke.stopAutoSync(),o.success("âœ… Local database cleared"),Ms())},className:"px-4 py-2.5 border border-red-300 text-red-700 rounded-lg font-semibold hover:bg-red-50 transition-colors flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Clear"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Automatic Background Sync"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically syncs database when WiFi/network is available"})]})]}),navigator.onLine?e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(Ft,{className:"w-3 h-3"}),"Online"]}):e.jsxs("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(Zt,{className:"w-3 h-3"}),"Offline"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Sync Status"}),e.jsx("p",{className:"font-semibold text-gray-900 flex items-center gap-1",children:He.isSyncing?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3 animate-spin text-blue-600"}),e.jsx("span",{className:"text-blue-600",children:"Syncing..."})]}):Ke.isEnabled()?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"text-green-600",children:"Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Paused"})]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Last Sync"}),e.jsx("p",{className:"font-medium text-gray-900",children:He.lastSyncTime?e.jsxs(e.Fragment,{children:[new Date(He.lastSyncTime).toLocaleTimeString(),He.lastSyncSuccess?e.jsx(ke,{className:"w-3 h-3 text-green-600 inline-block ml-1"}):e.jsx(Fe,{className:"w-3 h-3 text-red-600 inline-block ml-1"})]}):e.jsx("span",{className:"text-gray-400",children:"Never"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Next Sync"}),e.jsx("p",{className:"font-medium text-gray-900",children:He.nextSyncTime?new Date(He.nextSyncTime).toLocaleTimeString():e.jsx("span",{className:"text-gray-400",children:"Not scheduled"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Sync Interval"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[Math.round(He.syncInterval/1e3/60)," minutes"]})]})]}),He.error&&e.jsxs("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-xs text-red-800",children:[e.jsx(Fe,{className:"w-3 h-3 inline-block mr-1"}),He.error]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{if(Ke.isEnabled())Ke.stopAutoSync(),o.success("Auto sync stopped");else{if(!navigator.onLine){o.error("Cannot start auto sync - offline");return}Ke.startAutoSync(),o.success("Auto sync started")}},disabled:!navigator.onLine&&!Ke.isEnabled(),className:`flex-1 px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${Ke.isEnabled()?"bg-orange-600 text-white hover:bg-orange-700":"bg-green-600 text-white hover:bg-green-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:Ke.isEnabled()?"Pause Auto Sync":"Start Auto Sync"}),e.jsx("button",{onClick:async()=>{if(!navigator.onLine){o.error("Cannot sync - offline");return}Is(!0);try{const g=await Ke.syncNow();if(g.success){o.success("âœ… Database synced successfully"),Ms();const O=await Os.verifyAllData();O.allOk?console.log("âœ… [Sync] All data verified successfully after sync"):console.warn("âš ï¸ [Sync] Some data issues detected:",O.summary)}else o.error(`âŒ Sync failed: ${g.error}`)}catch{o.error("Failed to sync")}finally{Is(!1)}},disabled:Ds||!navigator.onLine,className:"px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:Ds?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3 animate-spin"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3"}),"Sync Now"]})}),e.jsx("button",{onClick:()=>Rs(!_s),className:"px-3 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-50 transition-colors flex items-center gap-2",children:e.jsx(Ze,{className:"w-3 h-3"})})]}),_s&&e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-900 mb-2",children:"Sync Interval"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",min:"5",max:"120",value:ks,onChange:g=>dt(parseInt(g.target.value)||30),className:"w-20 px-2 py-1.5 border border-blue-300 rounded-lg text-xs font-semibold"}),e.jsx("span",{className:"text-xs text-blue-800",children:"minutes"}),e.jsx("button",{onClick:()=>{Ke.setSyncInterval(ks*60*1e3),localStorage.setItem("auto_sync_interval",String(ks*60*1e3)),o.success(`Auto sync interval set to ${ks} minutes`),Rs(!1)},className:"ml-auto px-3 py-1.5 bg-blue-600 text-white rounded-lg text-xs font-semibold hover:bg-blue-700",children:"Save"})]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-2",children:["Database will automatically sync every ",ks," minutes when online"]})]}),e.jsxs("div",{className:"p-2 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1 mb-2",children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{className:"font-semibold",children:"Console Logs:"})," Open browser console (F12) to see detailed sync logs"]}),e.jsxs("button",{onClick:async()=>{console.log("ðŸ” [Database] Manual verification triggered by user");const g=await Os.verifyAllData();g.allOk?o.success("âœ… All data verified successfully"):o.error(`âš ï¸ ${g.summary}`)},className:"w-full px-3 py-2 bg-gray-600 text-white rounded-lg text-xs font-semibold hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ke,{className:"w-3 h-3"}),"Verify All Data"]})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"h-5 w-5 text-green-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Offline Sales Sync"})]}),navigator.onLine?e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(Ft,{className:"w-3 h-3"}),"Online"]}):e.jsxs("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(Zt,{className:"w-3 h-3"}),"Offline"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Pending Sales"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Sales waiting to be synced to online database"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:_e}),_e>0&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Needs sync"})]})]})}),_e>0&&e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-3 py-2 border-b border-gray-200",children:e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Pending Sales Details"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-1.5 text-left text-xs font-semibold text-gray-600",children:"Sale ID"}),e.jsx("th",{className:"px-3 py-1.5 text-left text-xs font-semibold text-gray-600",children:"Customer"}),e.jsx("th",{className:"px-3 py-1.5 text-right text-xs font-semibold text-gray-600",children:"Amount"}),e.jsx("th",{className:"px-3 py-1.5 text-left text-xs font-semibold text-gray-600",children:"Items"}),e.jsx("th",{className:"px-3 py-1.5 text-left text-xs font-semibold text-gray-600",children:"Created"}),e.jsx("th",{className:"px-3 py-1.5 text-left text-xs font-semibold text-gray-600",children:"Attempts"}),e.jsx("th",{className:"px-3 py-1.5 text-left text-xs font-semibold text-gray-600",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:Zs.map(g=>{var O,G,te,ce,de,Ce,he;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"font-mono text-xs text-gray-900",children:[g.id.substring(0,16),"..."]})}),e.jsxs("td",{className:"px-3 py-1.5",children:[e.jsx("div",{className:"text-gray-900",children:((O=g.saleData)==null?void 0:O.customerName)||((G=g.saleData)==null?void 0:G.customer_name)||"Walk-in"}),((te=g.saleData)==null?void 0:te.customerPhone)&&e.jsx("div",{className:"text-xs text-gray-500",children:g.saleData.customerPhone})]}),e.jsx("td",{className:"px-3 py-1.5 text-right",children:e.jsx("div",{className:"font-semibold text-gray-900",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(((ce=g.saleData)==null?void 0:ce.total)||((de=g.saleData)==null?void 0:de.total_amount)||0)})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"text-gray-900",children:[((he=(Ce=g.saleData)==null?void 0:Ce.items)==null?void 0:he.length)||0," items"]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:new Date(g.timestamp).toLocaleString("en-TZ",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:`text-xs font-semibold ${g.syncAttempts>=3?"text-red-600":"text-orange-600"}`,children:[g.syncAttempts,"/3"]})})}),e.jsx("td",{className:"px-3 py-1.5",children:g.error?e.jsxs("div",{className:"flex items-center gap-1 group relative",children:[e.jsx(Fe,{className:"w-3 h-3 text-red-500"}),e.jsx("span",{className:"text-xs text-red-600 font-semibold cursor-help",children:"Failed"}),e.jsxs("div",{className:"absolute left-0 top-full mt-1 hidden group-hover:block z-10 bg-red-50 border border-red-200 rounded-lg p-2 shadow-lg max-w-xs",children:[e.jsx("p",{className:"text-xs text-red-800 font-semibold mb-1",children:"Sync Error:"}),e.jsx("p",{className:"text-xs text-red-700",children:g.error})]})]}):e.jsx("span",{className:"text-xs text-orange-600 font-semibold",children:"Pending"})})]},g.id)})})]})})]}),_e===0&&e.jsxs("div",{className:"p-6 text-center border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx(yt,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"No Pending Sales"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All sales have been synced successfully"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:async()=>{if(!navigator.onLine){o.error("You are offline. Please connect to the internet to sync sales.");return}Is(!0);try{const g=await pt.syncAllPendingSales();g.synced>0&&o.success(`âœ… Synced ${g.synced} sales successfully`),g.failed>0&&o.error(`âš ï¸ ${g.failed} sales failed to sync`),g.synced===0&&g.failed===0&&o.success("âœ… No pending sales to sync"),Xs()}catch{o.error("Failed to sync sales")}finally{Is(!1)}},disabled:Ds||!navigator.onLine||_e===0,className:"flex-1 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:Ds?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3 animate-spin"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{className:"w-3 h-3"}),"Sync Pending Sales"]})})}),_e>0&&!navigator.onLine&&e.jsxs("div",{className:"p-2 bg-orange-50 border border-orange-200 rounded-lg flex items-start gap-2",children:[e.jsx(Fe,{className:"w-3 h-3 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-800",children:["You have ",_e," sales waiting to sync. They will automatically sync when you go online."]})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Gs,{className:"h-5 w-5 text-gray-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Storage Information"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-2",children:[e.jsx(Gs,{className:"w-3 h-3"}),"Local Storage Used"]}),e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:(()=>{let g=0;for(let O in localStorage)localStorage.hasOwnProperty(O)&&(g+=localStorage[O].length+O.length);return g<1024?g+" B":g<1024*1024?(g/1024).toFixed(2)+" KB":(g/(1024*1024)).toFixed(2)+" MB"})()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Storage Limit"}),e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:"~5-10 MB"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-sky-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(ct,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Database Tools"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Migration, cleanup, and connection info"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-sky-600"}),"Branch Migration"]}),e.jsx(cn,{})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-red-600"}),"Data Cleanup"]}),e.jsx(tn,{})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Connection Status"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ke,{className:"w-4 h-4 text-green-600"}),e.jsx("p",{className:"text-green-800 font-semibold text-sm",children:"Database Connected"})]}),e.jsx("p",{className:"text-green-700 text-xs",children:"Neon PostgreSQL â€¢ Pooled (Serverless) â€¢ Active"})]})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"How it works:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"Download full database to enable offline-first operation"}),e.jsx("li",{children:"All data is stored locally for instant access"}),e.jsx("li",{children:"Sales are saved locally first, then synced to online database in background"}),e.jsx("li",{children:"Automatic sync runs every 30 seconds when online"}),e.jsx("li",{children:"Download again to refresh your local database"}),e.jsx("li",{children:"Restore backups from GitHub Actions or local backup files"})]})]})]})})]})]})]})},xn=({settings:m,onSave:w,getStatusIcon:N,getStatusColor:P})=>{const[t,p]=r.useState(m),[i,y]=r.useState(!1),M=async(_,$)=>{const h={...t,[_]:$};p(h),y(!0);try{await w(h),o.success(`${_.replace("auto","Auto ")} ${$?"enabled":"disabled"} successfully!`)}catch{o.error("Failed to update automation settings"),p(t)}finally{y(!1)}},I=[{key:"autoBackup",title:"Automatic Backup",description:"Automatically backup data at scheduled intervals",icon:yt,color:"purple",enabled:t.autoBackup},{key:"autoCleanup",title:"Automatic Cleanup",description:"Clean up old logs and temporary files",icon:Re,color:"green",enabled:t.autoCleanup},{key:"autoScaling",title:"Auto Scaling",description:"Automatically scale resources based on demand",icon:vs,color:"blue",enabled:t.autoScaling},{key:"autoUpdates",title:"Automatic Updates",description:"Automatically update system components",icon:be,color:"orange",enabled:t.autoUpdates}];return e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Automation Settings"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:I.map(_=>{const $=_.icon;return e.jsxs("div",{className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx($,{className:"w-6 h-6 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:_.title})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:_.description}),e.jsx("button",{onClick:()=>M(_.key,!_.enabled),disabled:i,className:`w-full py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 ${_.enabled?"bg-gray-100 text-gray-500 hover:bg-gray-200":"bg-blue-600 text-white hover:bg-blue-700"}`,children:_.enabled?e.jsxs(e.Fragment,{children:[e.jsx(Bt,{className:"w-4 h-4"}),"Enabled"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-4 h-4"}),"Enable"]})})]},_.key)})})]})},Fn=()=>e.jsx(Dr,{children:e.jsx(dn,{})});export{Fn as default};
