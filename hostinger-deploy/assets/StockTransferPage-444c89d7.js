import{u as ge,j as e,e as H,G,s as Z}from"./index-61458a34.js";import{r as m,R as ee}from"./vendor-36d2c7c1.js";import{c as be}from"./routing-eb8c310c.js";import{z as l,R as se,N as U,v as ae,u as X,a5 as pe,cR as fe,l as re,ax as ne,X as Q,Q as Y,d as le,y as ie,f as ce,aw as te,e as ve}from"./ui-28e30067.js";import{P as ye}from"./PageHeader-f4a9cf63.js";import{g as oe,a as je,b as de,r as me,m as xe,d as ue,e as he,c as Ne}from"./stockTransferApi-f59c9e8a.js";import"./supabase-cf010ec4.js";const Fe=()=>{const{currentUser:t}=ge(),[z,I]=be(),[A,N]=m.useState([]),[v,x]=m.useState(!0),[c,o]=m.useState(""),[k,T]=m.useState("all"),[u,R]=m.useState("all"),[_,D]=m.useState(!1),[E,h]=m.useState(null),[F,L]=m.useState(null),C=localStorage.getItem("current_branch_id")||"";m.useEffect(()=>{z.get("autoOpen")==="true"&&(D(!0),I({}))},[z,I]);const B=m.useCallback(async()=>{console.log("ðŸª [StockTransferPage] Current Branch ID:",C),console.log("ðŸª [StockTransferPage] Status Filter:",k),console.log("ðŸª [StockTransferPage] Direction Filter:",u),x(!0);const g=Date.now();try{await Promise.allSettled([oe(C,k==="all"?void 0:k).then(w=>(console.log("ðŸª [StockTransferPage] Received transfers:",w.length),N(w),w)).catch(w=>(console.error("âŒ Failed to load transfers:",w),l.error("Failed to load transfers"),[])),C?je(C).then(w=>(console.log("ðŸª [StockTransferPage] Received stats:",w),L(w),w)).catch(w=>(console.error("âŒ Failed to load stats:",w),null)):Promise.resolve(null)]);const M=Date.now()}catch(M){console.error("âŒ [StockTransferPage] Error in optimized loading:",M),l.error("Failed to load stock transfer data")}finally{x(!1)}},[C,k,u]);m.useEffect(()=>{B()},[B]);const O=(A||[]).filter(g=>{var M,w,q,K,W,V,$,y;if(u==="sent"&&g.from_branch_id!==C||u==="received"&&g.to_branch_id!==C)return!1;if(c){const p=c.toLowerCase();return((w=(M=g.from_branch)==null?void 0:M.name)==null?void 0:w.toLowerCase().includes(p))||((K=(q=g.to_branch)==null?void 0:q.name)==null?void 0:K.toLowerCase().includes(p))||((V=(W=g.variant)==null?void 0:W.variant_name)==null?void 0:V.toLowerCase().includes(p))||((y=($=g.variant)==null?void 0:$.sku)==null?void 0:y.toLowerCase().includes(p))}return!0});return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsx(ye,{title:"Stock Transfer Management",subtitle:"Manage inventory transfers between branches",actions:[{label:"Refresh",onClick:()=>window.location.reload(),variant:"secondary",icon:e.jsx(se,{size:18}),disabled:v},{label:"New Transfer",onClick:()=>D(!0),variant:"primary",icon:e.jsx(U,{size:18})}]}),F&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:F.total}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Total"})]})}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:F.pending}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Pending"})]})}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:F.approved}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Approved"})]})}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:F.in_transit}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"In Transit"})]})}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:F.completed}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Completed"})]})}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:F.rejected}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Rejected"})]})}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:F.cancelled}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Cancelled"})]})})]}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by branch, product, or SKU...",value:c,onChange:g=>o(g.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("select",{value:k,onChange:g=>T(g.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"in_transit",children:"In Transit"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs("select",{value:u,onChange:g=>R(g.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Transfers"}),e.jsx("option",{value:"sent",children:"Sent Only"}),e.jsx("option",{value:"received",children:"Received Only"})]})]})}),e.jsx(H,{className:"overflow-hidden",children:v?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading transfers..."})]}):O.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(X,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No transfers found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c||k!=="all"||u!=="all"?"Try adjusting your filters":"Create your first stock transfer to get started"}),!c&&k==="all"&&u==="all"&&e.jsx(G,{onClick:()=>D(!0),icon:e.jsx(U,{size:18}),className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:"Create Transfer"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Direction"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:O.map(g=>e.jsx(we,{transfer:g,currentBranchId:C,currentUserId:(t==null?void 0:t.id)||"",onView:()=>h(g),onUpdate:B},g.id))})]})})}),_&&e.jsx(ke,{currentBranchId:C,currentUserId:(t==null?void 0:t.id)||"",onClose:()=>D(!1),onSuccess:()=>{D(!1)}}),E&&e.jsx(_e,{transfer:E,currentBranchId:C,currentUserId:(t==null?void 0:t.id)||"",onClose:()=>h(null),onUpdate:B})]})},we=({transfer:t,currentBranchId:z,currentUserId:I,onView:A,onUpdate:N})=>{var h,F,L,C,B,O,g,M,w,q,K,W,V;const v=t.from_branch_id===z,[x,c]=m.useState(!1);(F=(h=t.notes)==null?void 0:h.match(/\[BATCH:(.*?)\]/))==null||F[1];const o=(L=t.notes)==null?void 0:L.match(/\[BATCH:.*?\]\s*(\d+)\s*products/),k=o?parseInt(o[1]):0,T=k>1,u=async()=>{var y,p;const $=`Approve transfer of ${t.quantity} units of ${(y=t.variant)==null?void 0:y.variant_name} to ${(p=t.to_branch)==null?void 0:p.name}? Stock will remain reserved until completion.`;if(confirm($)){c(!0);try{await de(t.id,I),l.success(`âœ… Transfer approved! ${t.quantity} units reserved for shipping.`),N()}catch(S){l.error(S.message||"Failed to approve transfer")}finally{c(!1)}}},R=async()=>{var p,S;const $=`Reject transfer of ${t.quantity} units of ${(p=t.variant)==null?void 0:p.variant_name} from ${(S=t.from_branch)==null?void 0:S.name}? Reserved stock will be released and made available again.`;if(!confirm($))return;const y=prompt("Reason for rejection (optional):");if(y!==null){c(!0);try{await me(t.id,I,y),l.success(`âŒ Transfer rejected. ${t.quantity} units released back to available stock.`),N()}catch(n){l.error(n.message||"Failed to reject transfer")}finally{c(!1)}}},_=async()=>{var y,p,S;const $=`Mark ${t.quantity} units of ${(y=t.variant)==null?void 0:y.variant_name} as shipped to ${(p=t.to_branch)==null?void 0:p.name}? The receiving branch will be notified.`;if(confirm($)){c(!0);try{await xe(t.id),l.success(`ðŸšš Shipment dispatched! ${(S=t.to_branch)==null?void 0:S.name} will be notified.`),N()}catch(n){l.error(n.message||"Failed to update transfer")}finally{c(!1)}}},D=async()=>{var y,p,S,n;if(t.status==="completed"){l.error("This transfer has already been completed"),N();return}if(t.status!=="in_transit"&&t.status!=="approved"){l.error(`Cannot complete transfer with status: ${t.status}`),N();return}const $=`Confirm receipt of ${t.quantity} units of ${(y=t.variant)==null?void 0:y.variant_name} from ${(p=t.from_branch)==null?void 0:p.name}? This will move inventory from ${(S=t.from_branch)==null?void 0:S.name} to your branch.`;if(confirm($)){c(!0);try{await ue(t.id),l.success(`âœ… Transfer completed! ${t.quantity} units added to your inventory from ${(n=t.from_branch)==null?void 0:n.name}.`),N()}catch(f){l.error(f.message||"Failed to complete transfer"),N()}finally{c(!1)}}},E=async()=>{var p,S;const $=`Cancel transfer of ${t.quantity} units of ${(p=t.variant)==null?void 0:p.variant_name} to ${(S=t.to_branch)==null?void 0:S.name}? Reserved stock will be released and made available again.`;if(!confirm($))return;const y=prompt("Reason for cancellation (optional):");if(y!==null){c(!0);try{await he(t.id,y),l.success(`âŒ Transfer cancelled. ${t.quantity} units released back to available stock.`),N()}catch(n){l.error(n.message||"Failed to cancel transfer")}finally{c(!1)}}};return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["To: ",(C=t.to_branch)==null?void 0:C.name]}),e.jsx("div",{className:"text-gray-500",children:(B=t.to_branch)==null?void 0:B.city})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4 text-green-500"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["From: ",(O=t.from_branch)==null?void 0:O.name]}),e.jsx("div",{className:"text-gray-500",children:(g=t.from_branch)==null?void 0:g.city})]})]})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[((w=(M=t.variant)==null?void 0:M.product)==null?void 0:w.name)||"N/A",T&&e.jsxs("span",{className:"ml-1 text-xs font-normal text-blue-600",children:["and ",k-1," more"]})]}),e.jsx("div",{className:"text-gray-500",children:T?e.jsxs("span",{className:"text-blue-600 font-medium",children:["Batch Transfer â€¢ ",k," products"]}):e.jsxs(e.Fragment,{children:[((q=t.variant)==null?void 0:q.name)&&t.variant.name!=="Default Variant"&&e.jsxs("span",{children:[t.variant.name," â€¢ "]}),!((K=t.variant)!=null&&K.name)&&((W=t.variant)==null?void 0:W.variant_name)&&t.variant.variant_name!=="Default Variant"&&e.jsxs("span",{children:[t.variant.variant_name," â€¢ "]}),"SKU: ",((V=t.variant)==null?void 0:V.sku)||"N/A"]})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:T?e.jsxs(e.Fragment,{children:[t.quantity,e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-500",children:"(batch)"})]}):`${t.quantity} units`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${t.status==="pending"?"bg-yellow-100 text-yellow-800 border-yellow-200":t.status==="approved"?"bg-green-100 text-green-800 border-green-200":t.status==="in_transit"?"bg-blue-100 text-blue-800 border-blue-200":t.status==="completed"?"bg-green-100 text-green-800 border-green-200":t.status==="rejected"?"bg-red-100 text-red-800 border-red-200":"bg-gray-100 text-gray-800 border-gray-200"}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1).replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:A,className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Details",children:e.jsx(re,{className:"w-4 h-4"})}),!v&&t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:u,disabled:x,className:"px-3 py-1.5 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-1.5",title:"Approve this transfer request - stock will remain reserved",children:x?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),"Approve"]})}),e.jsx("button",{onClick:R,disabled:x,className:"px-3 py-1.5 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-1.5",title:"Reject this transfer - reserved stock will be released",children:x?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4"}),"Reject"]})})]}),v&&t.status==="approved"&&e.jsx("button",{onClick:_,disabled:x,className:"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-1.5",title:"Mark as shipped - notify receiving branch",children:x?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Shipping..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4"}),"Ship"]})}),!v&&t.status==="in_transit"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-100 rounded-lg border border-blue-200 flex items-center gap-1.5",children:[e.jsx(Y,{className:"w-4 h-4"}),"In Transit"]}),e.jsx("button",{onClick:D,disabled:x,className:"px-3 py-1.5 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-1.5",title:"Click when items arrive",children:x?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Receiving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4"}),"Receive"]})})]}),!v&&t.status==="approved"&&e.jsxs("div",{className:"px-3 py-1.5 text-sm font-medium text-amber-700 bg-amber-100 rounded-lg border border-amber-200 flex items-center gap-1.5",children:[e.jsx(ie,{className:"w-4 h-4"}),"Not Shipped Yet"]}),(t.status==="pending"||t.status==="approved")&&v&&e.jsx("button",{onClick:E,disabled:x,className:"px-3 py-1.5 text-sm font-medium text-white bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-1.5",title:"Cancel this transfer and release reserved stock",children:x?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Cancelling..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4"}),"Cancel"]})})]})})]})},ke=({currentBranchId:t,currentUserId:z,onClose:I,onSuccess:A})=>{const[N,v]=m.useState([]),[x,c]=m.useState([]),[o,k]=m.useState([]),[T,u]=m.useState({to_branch_id:"",notes:""}),[R,_]=m.useState(null),[D,E]=m.useState(!1),[h,F]=m.useState(!0),[L,C]=m.useState(""),[B,O]=m.useState([]),g=ee.useRef(null),[M,w]=m.useState({entity_id:"",quantity:1}),[q,K]=m.useState(null);m.useEffect(()=>{W(),V()},[t]),m.useEffect(()=>{if(h||x.length===0)return;const s=localStorage.getItem("stock_transfer_quick_add");if(s){try{const r=JSON.parse(s);if(localStorage.removeItem("stock_transfer_quick_add"),r.variants&&r.variants.length>0){const i=r.variants.filter(d=>(d.quantity||0)>0);if(i.length>0){const d=i.map(P=>({variant:P,quantity:1}));k(d),l.success(`âœ… ${r.productName} ready to transfer!`,{duration:3e3})}else l.error("Product has no stock available for transfer")}}catch(r){console.error("Failed to load quick add product:",r)}return}const a=sessionStorage.getItem("preselectedTransferProduct");if(a){try{const r=JSON.parse(a);if(sessionStorage.removeItem("preselectedTransferProduct"),r.variants&&r.variants.length>0){const i=r.variants.map(d=>({variant:d,quantity:1}));k(i),l.success(`Added ${r.productName} to transfer`,{duration:3e3,icon:"âœ…"})}}catch(r){console.error("Failed to load preselected product:",r)}return}setTimeout(()=>{var r;return(r=g.current)==null?void 0:r.focus()},100)},[h,x]),m.useEffect(()=>{const s=a=>{var r,i;a.key==="Escape"&&(R?_(null):I()),(a.ctrlKey||a.metaKey)&&a.key==="k"&&(a.preventDefault(),(r=g.current)==null||r.focus(),(i=g.current)==null||i.select())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[I,R]);const W=async()=>{try{const{data:s,error:a}=await Z.from("store_locations").select("id, name, code, city, is_main").eq("is_active",!0).neq("id",t);if(a)throw a;v(s||[])}catch(s){console.error("Failed to load branches:",s),l.error("Failed to load branches")}},V=async()=>{try{F(!0),console.log("ðŸª [CreateTransferModal] Loading variants for branch:",t),console.log("ðŸª [CreateTransferModal] Current branch type:",typeof t);const{data:s,error:a}=await Z.from("lats_product_variants").select(`
          id,
          product_id,
          name,
          variant_name,
          sku,
          quantity,
          reserved_quantity,
          branch_id,
          product:lats_products!product_id(name)
        `).eq("branch_id",t);if(a)console.error("âŒ Debug query failed:",a);else if(console.log("ðŸ“Š [CreateTransferModal] All variants for branch:",(s==null?void 0:s.length)||0),s&&s.length>0){console.log("ðŸ“¦ [CreateTransferModal] Sample variants:",s.slice(0,3).map(j=>({id:j.id,name:j.name||j.variant_name,quantity:j.quantity,reserved:j.reserved_quantity||0,available:(j.quantity||0)-(j.reserved_quantity||0),branch_id:j.branch_id})));const d=s.filter(j=>(j.quantity||0)>0);console.log("âœ… [CreateTransferModal] Variants with stock (quantity > 0):",d.length);const P=s.filter(j=>(j.quantity||0)-(j.reserved_quantity||0)>0);console.log("âœ… [CreateTransferModal] Variants with available stock:",P.length)}const{data:r,error:i}=await Z.from("lats_product_variants").select(`
          id,
          product_id,
          name,
          variant_name,
          sku,
          quantity,
          reserved_quantity,
          selling_price,
          branch_id,
          product:lats_products!product_id(name)
        `).eq("branch_id",t).gt("quantity",0).order("name");if(i)throw console.error("âŒ Variants query error:",i),console.error("Error details:",{message:i.message,code:i.code,details:i.details,hint:i.hint}),i;if(console.log("âœ… [CreateTransferModal] Final variants loaded:",(r==null?void 0:r.length)||0),c(r||[]),s){const d=s.length,P=s.filter(J=>(J.quantity||0)>0).length,j=s.filter(J=>(J.quantity||0)-(J.reserved_quantity||0)>0).length;K({totalVariants:d,variantsWithStock:P,variantsWithAvailableStock:j,currentBranchId:t||"undefined"})}r&&r.length>0?l.success(`${r.length} products available for transfer`):(console.warn("âš ï¸ [CreateTransferModal] No products available for transfer"),l.error("No products available for transfer. Check if products exist and have stock.",{duration:5e3}))}catch(s){console.error("âŒ Failed to load variants:",s),console.error("Full error object:",JSON.stringify(s,null,2)),l.error("Failed to load products for transfer")}finally{F(!1)}},$=()=>{o.length!==0&&confirm(`Remove all ${o.length} products from transfer?`)&&(k([]),l.success("All products removed"))},y=s=>{k(o.filter(a=>a.variant.id!==s)),l.success("Product removed")},p=(s,a)=>{const r=o.find(i=>i.variant.id===s);if(r){if(a<1){y(s);return}if(a>r.variant.quantity){l.error(`Only ${r.variant.quantity} units available`);return}k(o.map(i=>i.variant.id===s?{...i,quantity:a}:i))}},S=s=>{var a;if(o.some(r=>r.variant.id===s.id)){l.error("Product already added");return}if(s.quantity<=0){l.error("Product out of stock");return}k([...o,{variant:s,quantity:1}]),O([...B,s.id]),setTimeout(()=>{O(r=>r.filter(i=>i!==s.id))},1e3),l.success(`${((a=s.product)==null?void 0:a.name)||s.variant_name} added!`,{icon:"âœ…",duration:2e3})},n=async s=>{if(s.preventDefault(),!T.to_branch_id){l.error("Please select a destination branch");return}if(o.length===0){l.error("Please add at least one product to transfer");return}E(!0);try{const r=`[BATCH:${`BATCH-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}] ${o.length} products | ${T.notes||""}`.trim(),i=o.map((P,j)=>{const J={from_branch_id:t,to_branch_id:T.to_branch_id,entity_type:"variant",entity_id:P.variant.id,quantity:P.quantity,notes:r};return Ne(J,z)}),d=await Promise.all(i);l.success(`âœ… Transfer created with ${o.length} products!`,{duration:3e3,icon:"ðŸ“¦"}),A()}catch(a){l.error(a.message||"Failed to create transfer")}finally{E(!1)}},b=ee.useMemo(()=>{const s=new Map;return x.forEach(a=>{var d;const r=a.product_id,i=((d=a.product)==null?void 0:d.name)||"Unknown Product";s.has(r)||s.set(r,{product:{id:r,name:i},variants:[]}),s.get(r).variants.push(a)}),Array.from(s.values())},[x]).filter(s=>{var i;if(s.variants.every(d=>o.some(P=>P.variant.id===d.id)))return!1;if(!L)return!0;const r=L.toLowerCase();return((i=s.product.name)==null?void 0:i.toLowerCase().includes(r))||s.variants.some(d=>{var P,j;return((P=d.variant_name)==null?void 0:P.toLowerCase().includes(r))||((j=d.sku)==null?void 0:j.toLowerCase().includes(r))})});return x.find(s=>s.id===M.entity_id),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:I}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4 z-50 pointer-events-none",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto pointer-events-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Create Stock Transfer"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Transfer products to another branch"})]})]}),e.jsx("button",{onClick:I,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Q,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Destination Branch"}),e.jsxs("select",{value:T.to_branch_id,onChange:s=>u({...T,to_branch_id:s.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900",required:!0,children:[e.jsx("option",{value:"",children:"Select destination branch..."}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.code,") - ",s.city]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Products"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{ref:g,type:"text",placeholder:"Type product name or scan barcode...",value:L,onChange:s=>C(s.target.value),className:"w-full pl-10 pr-10 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900"}),L&&e.jsx("button",{type:"button",onClick:()=>C(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Available Products",!h&&b.length>0&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",b.length,")"]})]}),q&&!h&&e.jsx("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"text-xs text-blue-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"ðŸ“Š Stock Transfer Debug Info:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:["Branch ID: ",e.jsx("span",{className:"font-mono",children:q.currentBranchId})]}),e.jsxs("div",{children:["Total Variants: ",q.totalVariants]}),e.jsxs("div",{children:["With Stock: ",q.variantsWithStock]}),e.jsxs("div",{children:["Available: ",q.variantsWithAvailableStock]})]}),q.variantsWithStock===0&&e.jsxs("div",{className:"mt-2 p-2 bg-yellow-100 border border-yellow-300 rounded text-yellow-800",children:["âš ï¸ No products with stock found for this branch. Check:",e.jsxs("ul",{className:"mt-1 ml-4 list-disc text-xs",children:[e.jsx("li",{children:"Products exist in inventory"}),e.jsx("li",{children:"Products have quantity > 0"}),e.jsxs("li",{children:["Branch ID is correct (current: ",q.currentBranchId,")"]}),e.jsx("li",{children:"Database connection"}),e.jsx("li",{children:"Check browser console for detailed logs"})]}),e.jsxs("button",{type:"button",onClick:()=>{console.log("ðŸ” [Stock Transfer Debug] Reloading variants..."),V(),l.success("ðŸ”„ Reloading products... Check console for details",{duration:3e3})},className:"mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",children:[e.jsx(se,{className:"w-3 h-3 inline mr-1"}),"Reload Products"]})]}),q.variantsWithStock>0&&b.length===0&&e.jsx("div",{className:"mt-2 p-2 bg-orange-100 border border-orange-300 rounded text-orange-800",children:"âš ï¸ Products exist but none match search/filter criteria"})]})}),e.jsx("div",{className:"border-2 border-gray-200 rounded-lg h-96 overflow-y-auto bg-gray-50 p-3",children:h?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading..."})]})}):b.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:o.length>0?"All products added":L?"No products found":"No products available"})]})}):e.jsx("div",{className:"space-y-2",children:b.map(s=>{const a=s.variants.filter(P=>!o.some(j=>j.variant.id===P.id));if(a.length===0)return null;const r=a.length>1,i=a.reduce((P,j)=>P+j.quantity,0),d=a.length===1?a[0]:null;return e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg p-3 hover:border-blue-500 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 truncate",children:s.product.name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[r?`${a.length} variants`:a[0].sku," â€¢ ",i," in stock"]})]}),!r&&d?e.jsxs("button",{type:"button",onClick:()=>S(d),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),"Add"]}):e.jsx("button",{type:"button",onClick:()=>_(s),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium rounded-lg transition-colors",children:"Select"})]})},s.product.id)})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Selected Products (",o.length,")"]}),o.length>0&&e.jsx("button",{type:"button",onClick:$,className:"text-xs text-red-600 hover:text-red-700 font-medium",children:"Clear All"})]}),e.jsx("div",{className:"border-2 border-gray-200 rounded-lg h-96 overflow-y-auto bg-gray-50 p-3",children:o.length>0?e.jsx("div",{className:"space-y-2",children:o.map(s=>{var a;return e.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 truncate",children:((a=s.variant.product)==null?void 0:a.name)||s.variant.variant_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.variant.sku})]}),e.jsx("button",{type:"button",onClick:()=>y(s.variant.id),className:"text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>p(s.variant.id,Math.max(1,s.quantity-1)),className:"w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-bold transition-colors",children:"âˆ’"}),e.jsx("input",{type:"number",min:"1",max:s.variant.quantity,value:s.quantity,onChange:r=>p(s.variant.id,parseInt(r.target.value)||1),className:"flex-1 px-2 py-1 text-center border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 font-semibold"}),e.jsx("button",{type:"button",onClick:()=>p(s.variant.id,Math.min(s.variant.quantity,s.quantity+1)),disabled:s.quantity>=s.variant.quantity,className:"w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-700 disabled:bg-gray-200 disabled:text-gray-400 text-white rounded-lg font-bold transition-colors",children:"+"})]}),e.jsxs("p",{className:"text-xs text-gray-500 text-right mt-1",children:["Max: ",s.variant.quantity]})]},s.variant.id)})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No products selected"})]})})})]})]}),R&&R.variants.filter(s=>!o.some(a=>a.variant.id===s.id)).length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border-2 border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[e.jsx("span",{className:"font-bold",children:R.product.name})," - Select Variant"]}),e.jsx("button",{type:"button",onClick:()=>_(null),className:"text-xs text-gray-600 hover:text-gray-900 font-medium",children:"Cancel"})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:R.variants.filter(s=>!o.some(a=>a.variant.id===s.id)).map(s=>e.jsx("button",{type:"button",onClick:()=>{S(s),_(null)},className:"w-full text-left px-4 py-3 bg-white border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 mb-1",children:s.variant_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",s.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[s.quantity," in stock"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["TSh ",Number(s.selling_price||0).toLocaleString()]})]})]})},s.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-3 text-center",children:"Click any variant to add it to your transfer"})]}),o.length>0&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Products"}),e.jsx("p",{className:"text-4xl font-bold text-blue-600",children:o.length})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Units"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:o.reduce((s,a)=>s+a.quantity,0)})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:T.notes,onChange:s=>u({...T,notes:s.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors resize-none text-gray-900",placeholder:"Add any notes about this transfer..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:I,disabled:D,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:D||!T.to_branch_id||o.length===0,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:D?"Creating...":"Create Transfer"})]})]})]})})})]})},_e=({transfer:t,currentBranchId:z,currentUserId:I,onClose:A,onUpdate:N})=>{var g,M,w,q,K,W,V,$,y,p,S;const[v,x]=m.useState(!1),[c,o]=m.useState([]),[k,T]=m.useState(!1),[u,R]=m.useState([]),_=t.from_branch_id===z,D=(M=(g=t.notes)==null?void 0:g.match(/\[BATCH:(.*?)\]/))==null?void 0:M[1];m.useEffect(()=>{(async()=>{if(!D){o([t]);return}try{T(!0);const b=(await oe(z,"all")).filter(s=>{var a;return(a=s.notes)==null?void 0:a.includes(`[BATCH:${D}]`)});o(b.length>0?b:[t]),R(b.map(s=>s.id))}catch(f){console.error("Failed to load batch transfers:",f),o([t])}finally{T(!1)}})()},[D,t,z]);const E=n=>{R(f=>f.includes(n)?f.filter(b=>b!==n):[...f,n])},h=c.length>1,F=async()=>{var b,s;const n=h?u.length:1,f=h?`Approve ${n} of ${c.length} transfer requests? Stock will remain reserved until completion.`:`Approve transfer of ${t.quantity} units of ${(b=t.variant)==null?void 0:b.variant_name} to ${(s=t.to_branch)==null?void 0:s.name}? Stock will remain reserved until completion.`;if(confirm(f)){x(!0);try{const a=h?c.filter(r=>u.includes(r.id)):[t];await Promise.all(a.map(r=>de(r.id,I))),l.success(`âœ… ${n} ${n===1?"product":"products"} approved`),N(),A()}catch(a){l.error(a.message||"Failed to approve transfer")}finally{x(!1)}}},L=async()=>{var b,s;const n=`Reject transfer of ${t.quantity} units of ${(b=t.variant)==null?void 0:b.variant_name} from ${(s=t.from_branch)==null?void 0:s.name}? Reserved stock will be released and made available again.`;if(!confirm(n))return;const f=prompt("Reason for rejection (optional):");if(f!==null){x(!0);try{await me(t.id,I,f),l.success(`âŒ Transfer rejected. ${t.quantity} units released back to available stock.`),N(),A()}catch(a){l.error(a.message||"Failed to reject transfer")}finally{x(!1)}}},C=async()=>{var f,b,s;const n=`Mark ${t.quantity} units of ${(f=t.variant)==null?void 0:f.variant_name} as shipped to ${(b=t.to_branch)==null?void 0:b.name}? The receiving branch will be notified.`;if(confirm(n)){x(!0);try{await xe(t.id),l.success(`ðŸšš Shipment dispatched! ${(s=t.to_branch)==null?void 0:s.name} will be notified.`),N(),A()}catch(a){l.error(a.message||"Failed to update transfer")}finally{x(!1)}}},B=async()=>{var b,s,a;if(t.status==="completed"){l.error("This transfer has already been completed"),N(),A();return}if(t.status!=="in_transit"&&t.status!=="approved"){l.error(`Cannot complete transfer with status: ${t.status}`),N(),A();return}const n=h?u.length:1,f=h?`Receive ${n} of ${c.length} products from ${(b=t.from_branch)==null?void 0:b.name}? This will move inventory to your branch.`:`Confirm receipt of ${t.quantity} units of ${(s=t.variant)==null?void 0:s.variant_name} from ${(a=t.from_branch)==null?void 0:a.name}? This will move inventory to your branch.`;if(confirm(f)){x(!0);try{const i=(h?c.filter(d=>u.includes(d.id)&&d.status!=="completed"):[t]).filter(d=>d.status==="in_transit"||d.status==="approved");if(i.length===0){l.error("All selected transfers are already completed"),N(),A();return}await Promise.all(i.map(d=>ue(d.id))),l.success(`âœ… ${i.length} ${i.length===1?"product":"products"} received!`,{icon:"ðŸ“¦",duration:3e3}),N(),A()}catch(r){l.error(r.message||"Failed to complete transfer"),N()}finally{x(!1)}}},O=async()=>{var b,s;const n=`Cancel transfer of ${t.quantity} units of ${(b=t.variant)==null?void 0:b.variant_name} to ${(s=t.to_branch)==null?void 0:s.name}? Reserved stock will be released and made available again.`;if(!confirm(n))return;const f=prompt("Reason for cancellation (optional):");if(f!==null){x(!0);try{await he(t.id,f),l.success(`âŒ Transfer cancelled. ${t.quantity} units released back to available stock.`),N(),A()}catch(a){l.error(a.message||"Failed to cancel transfer")}finally{x(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs(H,{className:"max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Transfer Details"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5 font-mono",children:[t.id.slice(0,24),"..."]})]})]}),e.jsx("button",{type:"button",onClick:A,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[h&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"Batch Transfer"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[c.length," products in this transfer"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Total Units"}),e.jsx("div",{className:"text-lg font-bold text-blue-900",children:c.reduce((n,f)=>n+f.quantity,0)})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Branch"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:(w=t.from_branch)==null?void 0:w.name}),e.jsx("div",{className:"text-sm text-gray-600",children:(q=t.from_branch)==null?void 0:q.city})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Branch"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:(K=t.to_branch)==null?void 0:K.name}),e.jsx("div",{className:"text-sm text-gray-600",children:(W=t.to_branch)==null?void 0:W.city})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[h?"Products in Transfer":"Product",h&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-semibold rounded-full",children:c.length})]}),h&&!_&&(t.status==="pending"||t.status==="in_transit")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>R(c.map(n=>n.id)),className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"Select All"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("button",{type:"button",onClick:()=>R([]),className:"text-xs text-gray-600 hover:text-gray-700 font-medium",children:"Deselect All"})]})]}),k?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading items..."})]}):h?e.jsxs(e.Fragment,{children:[!_&&(t.status==="pending"||t.status==="in_transit")&&e.jsx("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-blue-900",children:[e.jsx("span",{className:"font-medium",children:t.status==="pending"?"Select products to approve:":"Select products to receive:"})," ","Check items below to process them individually, or select all for batch processing."]})]})}),e.jsx("div",{className:"border border-gray-200 rounded-lg bg-white max-h-80 overflow-y-auto",children:c.map((n,f)=>{var b,s,a,r,i,d;return e.jsxs("div",{className:`group flex items-center gap-3 p-3 border-b border-gray-100 last:border-0 hover:bg-gray-50 transition-colors ${!_&&(t.status==="pending"||t.status==="in_transit")?"cursor-pointer":""}`,onClick:()=>{!_&&(t.status==="pending"||t.status==="in_transit")&&E(n.id)},children:[!_&&(t.status==="pending"||t.status==="in_transit")&&e.jsx("input",{type:"checkbox",checked:u.includes(n.id),onChange:()=>E(n.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-400",children:[f+1,"."]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",children:((s=(b=n.variant)==null?void 0:b.product)==null?void 0:s.name)||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[((a=n.variant)==null?void 0:a.name)&&n.variant.name!=="Default Variant"&&e.jsxs("span",{children:[n.variant.name," â€¢ "]}),!((r=n.variant)!=null&&r.name)&&((i=n.variant)==null?void 0:i.variant_name)&&n.variant.variant_name!=="Default Variant"&&e.jsxs("span",{children:[n.variant.variant_name," â€¢ "]}),"SKU: ",((d=n.variant)==null?void 0:d.sku)||"N/A"]})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-blue-900",children:[n.quantity," units"]}),e.jsx("div",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${n.status==="completed"?"bg-green-100 text-green-700":n.status==="in_transit"?"bg-blue-100 text-blue-700":n.status==="approved"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:n.status==="completed"?"âœ“ Received":n.status==="in_transit"?"In Transit":n.status==="approved"?"Approved":"Pending"})]})]},n.id)})})]}):e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:(($=(V=t.variant)==null?void 0:V.product)==null?void 0:$.name)||((y=t.variant)==null?void 0:y.variant_name)||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[((p=t.variant)==null?void 0:p.variant_name)&&t.variant.variant_name!=="Default Variant"&&e.jsxs("span",{children:[t.variant.variant_name," â€¢ "]}),"SKU: ",((S=t.variant)==null?void 0:S.sku)||"N/A"]}),e.jsxs("div",{className:"text-lg font-bold text-blue-600 mt-2",children:["Quantity: ",t.quantity," units"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Requested"}),e.jsx("div",{className:"text-sm text-gray-900",children:t.requested_at?new Date(t.requested_at).toLocaleString():"N/A"})]}),t.approved_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t.status==="rejected"?"Rejected":"Approved"}),e.jsx("div",{className:"text-sm text-gray-900",children:new Date(t.approved_at).toLocaleString()})]}),t.completed_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Completed"}),e.jsx("div",{className:"text-sm text-gray-900",children:new Date(t.completed_at).toLocaleString()})]})]}),t.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-900",children:t.notes})]})]}),e.jsx("div",{className:"border-t border-gray-100 p-6 bg-gray-50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(G,{onClick:A,variant:"secondary",className:"flex-1",disabled:v,children:"Close"}),!_&&t.status==="pending"&&e.jsxs(e.Fragment,{children:[h&&u.length<c.length&&e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("div",{className:"text-xs text-gray-600 mb-1",children:[u.length," of ",c.length," selected"]})}),e.jsx(G,{onClick:F,disabled:v||h&&u.length===0,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white",icon:e.jsx(ne,{size:18}),children:v?"Processing...":h?`Approve ${u.length===c.length?"All":u.length} Product${u.length!==1?"s":""}`:"Approve"}),e.jsx(G,{onClick:L,disabled:v,className:"bg-gradient-to-r from-red-500 to-red-600 text-white",icon:e.jsx(Q,{size:18}),children:v?"Processing...":"Reject"})]}),_&&t.status==="approved"&&e.jsx(G,{onClick:C,disabled:v,className:"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white",icon:e.jsx(Y,{size:18}),children:v?"Processing...":"Mark In Transit"}),!_&&t.status==="in_transit"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 px-4 py-3 text-sm font-medium text-blue-700 bg-blue-50 rounded-lg border border-blue-200 flex items-center justify-center gap-2",children:[e.jsx(Y,{size:18}),"In Transit"]}),h&&u.length<c.length&&e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("div",{className:"text-xs text-gray-600 mb-1",children:[u.length," of ",c.length," selected"]})}),e.jsx(G,{onClick:B,disabled:v||h&&u.length===0,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white",icon:e.jsx(le,{size:18}),children:v?"Processing...":h?`Receive ${u.length===c.length?"All":u.length}`:"Receive"})]}),!_&&t.status==="approved"&&e.jsxs("div",{className:"flex-1 px-4 py-3 text-sm font-medium text-amber-700 bg-amber-50 rounded-lg border border-amber-200 flex items-center justify-center gap-2",children:[e.jsx(ie,{size:18}),"Not Shipped Yet"]}),(t.status==="pending"||t.status==="approved")&&_&&e.jsx(G,{onClick:O,disabled:v,className:"flex-1 bg-gradient-to-r from-gray-500 to-gray-600 text-white",icon:e.jsx(ce,{size:18}),children:v?"Processing...":"Cancel Transfer"})]})})]})})};export{Fe as default};
