import{r as l,b as Dr}from"./vendor-36d2c7c1.js";import{s as te,aF as Or,j as e,u as Jt,d as Fr,aG as ve,an as Ms}from"./index-61458a34.js";import{_ as Ds}from"./supabase-cf010ec4.js";import{n,X as Ae,c4 as Me,Z as qr,cM as Ur,b0 as Kt,e as vt,J as Lr,N as Wt,s as zs,O as es,af as Os,aa as Zr,cN as zr,b as Yt,a0 as Te,av as Qr,a3 as Ce,R as Ft,a5 as Fs,D as Vr,Y as Qs,aE as $e,r as Ot,v as Br,ac as Hr,a9 as qs,f as Us,q as Ue,u as de,p as Kr,Q as Wr,ax as Yr,y as at,aA as Vs,d as Gt,a as Gr,$ as Xt,M as Xr,I as Bs,bN as Ht,U as Hs,A as Jr,a6 as We,b1 as ea,bd as ta,m as sa,l as ra,c as tt,bu as aa,h as na,cO as la}from"./ui-28e30067.js";import{P as st,C as ia,S as oa,Q as ca}from"./QualityCheckModal-849e9065.js";import{L as Ks}from"./LoadingSpinner-251d9268.js";import{u as da}from"./useBodyScrollLock-341c8b9f.js";import{P as ma}from"./PaymentsPopupModal-6fe61f19.js";import{S as ua}from"./SetPricingModal-84ffdd49.js";import{a as xa}from"./routing-eb8c310c.js";const ga=1e12,ha=r=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(r),pa=r=>!(!isFinite(r)||isNaN(r)||Math.abs(r)>ga),Ls=r=>{if(r==null)return null;const u=Number(r);return pa(u)?u>0?u:null:(console.warn(`‚ö†Ô∏è Corrupt costPrice detected in purchase order: ${r}. Skipping from statistics.`),null)},Ma=r=>{const[u,o]=l.useState([]),[f,a]=l.useState(null),[C,S]=l.useState(!1),[g,M]=l.useState(null);return l.useEffect(()=>{if(!r){o([]),a(null);return}if(!ha(r)){console.log("‚è≠Ô∏è Skipping purchase order history for non-UUID product:",r),o([]),a(null);return}(async()=>{var X,L,O;try{S(!0),M(null),console.log("üì¶ Fetching purchase order history for product:",r);const{data:w,error:_}=await te.from("lats_purchase_order_items").select(`
            id,
            purchase_order_id,
            product_id,
            variant_id,
            quantity_ordered,
            unit_cost,
            quantity_received,
            created_at
          `).eq("product_id",r).order("created_at",{ascending:!1}).limit(20);if(_)throw console.error("‚ùå Error fetching purchase order history:",_),_;if(console.log("‚úÖ Purchase order items fetched:",w),!w||w.length===0){o([]),a(null);return}const V=[...new Set(w.map(k=>k.purchase_order_id).filter(Boolean))];let W=[];if(V.length>0)try{const k=V.map(async z=>{const{data:B,error:m}=await te.from("lats_purchase_orders").select("id, po_number, created_at, status, supplier_id, total_amount, currency, exchange_rate, total_amount_base_currency, payment_terms").eq("id",z).single();return m?(console.warn(`‚ö†Ô∏è Error fetching purchase order ${z}:`,m),null):B});W=(await Promise.all(k)).filter(Boolean)}catch(k){throw console.error("‚ùå Error fetching purchase orders:",k),k}const Y=new Map;(W||[]).forEach(k=>{Y.set(k.id,k)});const G=[...new Set((W||[]).map(k=>k.supplier_id).filter(Boolean))];let h=new Map;if(G.length>0)try{const k=G.map(async B=>{const{data:m,error:y}=await te.from("lats_suppliers").select("id, name").eq("id",B).single();return y?(console.warn(`‚ö†Ô∏è Error fetching supplier ${B}:`,y),null):m}),z=(await Promise.all(k)).filter(Boolean);h=new Map(z.map(B=>[B.id,B.name]))}catch(k){console.warn("‚ö†Ô∏è Error fetching suppliers:",k)}const N=w.map(k=>{const E=Y.get(k.purchase_order_id);return{id:k.id,orderNumber:(E==null?void 0:E.po_number)||"N/A",orderDate:(E==null?void 0:E.created_at)||k.created_at,quantity:k.quantity_ordered||0,costPrice:k.unit_cost||0,receivedQuantity:k.quantity_received||0,status:(E==null?void 0:E.status)||"unknown",supplierName:h.get(E==null?void 0:E.supplier_id)||"Unknown",currency:(E==null?void 0:E.currency)||"TZS",poStatus:(E==null?void 0:E.status)||"draft"}});if(o(N),N.length>0){const k=N.length,E=N.reduce(($,Q)=>$+Q.quantity,0),z=N.reduce(($,Q)=>$+Q.receivedQuantity,0),B=N.map($=>Ls($.costPrice)).filter($=>$!==null),m=B.length>0?B.reduce(($,Q)=>$+Q,0)/B.length:0,y=((X=N[0])==null?void 0:X.orderDate)||null,v=Ls((L=N[0])==null?void 0:L.costPrice),F=B.length>0?Math.min(...B):null,I=B.length>0?Math.max(...B):null,A=[...new Set(N.map($=>$.currency||"TZS"))],D=((O=N[0])==null?void 0:O.currency)||"TZS",Z=A.length>1;Z&&console.warn(`‚ö†Ô∏è Multiple currencies detected in purchase history: ${A.join(", ")}. Using ${D} for statistics.`),a({totalOrders:k,totalQuantityOrdered:E,totalQuantityReceived:z,averageCostPrice:m,lastOrderDate:y,lastCostPrice:v,lowestCostPrice:F,highestCostPrice:I,currency:D,hasMultipleCurrencies:Z})}else a(null)}catch(w){console.error("‚ùå Error in usePurchaseOrderHistory:",w),M(w.message||"Failed to fetch purchase order history")}finally{S(!1)}})()},[r]),{history:u,stats:f,isLoading:C,error:g}};class rt{constructor(){this.cache=new Map,this.CACHE_DURATION=60*60*1e3,this.DEFAULT_RATES={USD_TZS:2500,EUR_TZS:2700,GBP_TZS:3200,KES_TZS:18,CNY_TZS:350,TZS_USD:4e-4,TZS_EUR:37e-5,TZS_GBP:31e-5,TZS_KES:.056,TZS_CNY:.0029}}static getInstance(){return rt.instance||(rt.instance=new rt),rt.instance}async getExchangeRate(u,o="TZS"){if(u===o)return{from_currency:u,to_currency:o,rate:1,source:"default",last_updated:new Date().toISOString()};const f=`${u}_${o}`,a=this.getCachedRate(f);if(a)return{from_currency:u,to_currency:o,rate:a.rate,source:a.source,last_updated:new Date(a.timestamp).toISOString()};const C=await this.fetchFromDatabase(u,o);if(C)return this.cacheRate(f,C.rate,"database"),C;const S=await this.fetchFromPurchaseOrders(u,o);if(S)return this.cacheRate(f,S.rate,"manual"),S;const g=this.getDefaultRate(u,o);return this.cacheRate(f,g,"default"),console.warn(`‚ö†Ô∏è Using default exchange rate for ${u} to ${o}: ${g}`),{from_currency:u,to_currency:o,rate:g,source:"default",last_updated:new Date().toISOString()}}async fetchFromDatabase(u,o){try{const{data:f,error:a}=await te.from("integration_settings").select("config").eq("integration_type","exchange_rates").single();if(!a&&(f!=null&&f.config)){const C=`${u}_${o}`,S=f.config[C];if(S&&typeof S=="number")return console.log(`‚úÖ Found exchange rate in database: ${u} to ${o} = ${S}`),{from_currency:u,to_currency:o,rate:S,source:"database",last_updated:new Date().toISOString()}}}catch(f){console.error("Error fetching exchange rate from database:",f)}return null}async fetchFromPurchaseOrders(u,o){try{const{data:f,error:a}=await te.from("lats_purchase_orders").select("currency, exchange_rate, exchange_rate_date, base_currency").eq("currency",u).eq("base_currency",o).not("exchange_rate","is",null).order("exchange_rate_date",{ascending:!1}).limit(1).single();if(!a&&f&&f.exchange_rate)return console.log(`‚úÖ Loaded latest exchange rate from PO: ${u} to ${o} = ${f.exchange_rate}`),{from_currency:u,to_currency:o,rate:parseFloat(f.exchange_rate),source:"manual",last_updated:f.exchange_rate_date||new Date().toISOString()}}catch(f){console.error("Error fetching exchange rate from purchase orders:",f)}return null}getDefaultRate(u,o){const f=`${u}_${o}`,a=`${o}_${u}`;if(this.DEFAULT_RATES[f])return this.DEFAULT_RATES[f];if(this.DEFAULT_RATES[a])return 1/this.DEFAULT_RATES[a];if(u!=="TZS"&&o!=="TZS"){const C=this.DEFAULT_RATES[`${u}_TZS`],S=this.DEFAULT_RATES[`TZS_${o}`];if(C&&S)return C*S}return console.warn(`‚ö†Ô∏è No exchange rate found for ${u} to ${o}, using 1`),1}async convertAmount(u,o,f="TZS"){if(o===f)return u;const a=await this.getExchangeRate(o,f);return u*a.rate}async saveExchangeRate(u,o,f){try{const{data:a}=await te.from("integration_settings").select("config").eq("integration_type","exchange_rates").single(),C=(a==null?void 0:a.config)||{},S=`${u}_${o}`;C[S]=f;const g=`${o}_${u}`;C[g]=1/f;const{error:M}=await te.from("integration_settings").upsert({integration_type:"exchange_rates",is_enabled:!0,provider:"manual",config:C,status:"active",updated_at:new Date().toISOString()},{onConflict:"integration_type"});if(M)throw M;return this.cacheRate(S,f,"database"),this.cacheRate(g,1/f,"database"),console.log(`‚úÖ Saved exchange rate: ${u} to ${o} = ${f}`),!0}catch(a){return console.error("Error saving exchange rate:",a),!1}}getCachedRate(u){const o=this.cache.get(u);return o&&Date.now()-o.timestamp<this.CACHE_DURATION?o:null}cacheRate(u,o,f){this.cache.set(u,{rate:o,timestamp:Date.now(),source:f})}clearCache(){this.cache.clear(),console.log("‚úÖ Exchange rate cache cleared")}async getAllRates(){const u=["USD","EUR","GBP","KES","CNY","TZS"],o=[];for(const f of u)for(const a of u)if(f!==a){const C=await this.getExchangeRate(f,a);o.push(C)}return o}}const Da=rt.getInstance();function fa(r,u=0){const o=Number(r);return!isFinite(o)||isNaN(o)?u:o}function Zs(r,u="TZS",o="en-TZ"){const f=fa(r,0);return new Intl.NumberFormat(o,{style:"currency",currency:u,minimumFractionDigits:0,maximumFractionDigits:0}).format(f)}const ba=({isOpen:r,onClose:u,purchaseOrder:o,onConfirm:f,isLoading:a=!1,mode:C="partial"})=>{const[S,g]=l.useState(new Map),[M,K]=l.useState(null),{open:X}=Or();l.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),l.useEffect(()=>{if(r){const m=new Map;console.log("üõí [EnhancedPartialReceiveModal] Purchase Order Items:",o.items.length);const y=[];o.items.forEach(A=>{var ee,ie,ne;const D=A.receivedQuantity||0,Z=A.quantity-D,$=((ee=A.variant)==null?void 0:ee.variant_name)||((ie=A.variant)==null?void 0:ie.name)||"N/A",Q=A.name||((ne=A.product)==null?void 0:ne.name)||"Unknown Product";if(console.log(`üì¶ Item ${A.id}:`,{product:Q,variant:$,ordered:A.quantity,received:D,pending:Z,willShow:Z>0}),Z>0){const ue=C==="full"?Z:Math.min(1,Z),ke=ue>0;m.set(A.id,{itemId:A.id,quantity:ue,includeIMEI:ke,imeiEntries:ke?Array(ue).fill(null).map(()=>L()):[]})}else{let ue="Unknown";Z<=0&&(ue=D>=A.quantity?"Fully received":"Invalid data (received > ordered)"),y.push({id:A.id,name:Q+($!=="N/A"?` - ${$}`:""),ordered:A.quantity,received:D,reason:ue})}});const v=o.items.length,F=m.size,I=v-F;console.log("üéØ [EnhancedPartialReceiveModal] Summary:",{totalItems:v,visibleItems:F,hiddenItems:I,mode:C}),K({totalItems:v,visibleItems:F,hiddenItems:I,hiddenItemsList:y}),I>0&&(console.warn(`‚ö†Ô∏è [EnhancedPartialReceiveModal] ${I} items are hidden (fully received or invalid data)`),n(`${I} item(s) are already fully received and won't appear in the receive list`,{icon:"‚ö†Ô∏è",duration:5e3})),g(m)}},[r,o.items,C]);const L=()=>({value:"",imei:"",location:"",roomId:void 0,shelfId:void 0}),O=(m,y,v)=>{g(F=>{const I=new Map(F),A=I.get(m);if(A){const D=[...A.imeiEntries];D[y]={...D[y],roomId:v.roomId,shelfId:v.shelfId,location:v.label},I.set(m,{...A,imeiEntries:D})}return I})},w=(m,y)=>{g(v=>{const F=new Map(v),I=F.get(m);if(I){const A=y>0,D=A?Array(y).fill(null).map((Z,$)=>{var ee;const Q=(ee=I.imeiEntries)==null?void 0:ee[$];return Q?{...Q}:L()}):[];F.set(m,{...I,quantity:y,includeIMEI:A,imeiEntries:D})}return F})},_=async(m,y)=>{try{const v=await X();v&&O(m,y,{roomId:v.roomId,shelfId:v.shelfId,label:v.label})}catch(v){console.error("Error selecting storage location:",v)}},V=(m,y,v)=>{g(F=>{const I=new Map(F),A=I.get(m);if(A){const D=[...A.imeiEntries],Z=D[y],$=v.replace(/[\s\-_.]/g,"");/^\d{15}$/.test($)?D[y]={...Z,value:v,imei:$}:D[y]={...Z,value:v,imei:""},I.set(m,{...A,imeiEntries:D})}return I})},W=l.useMemo(()=>Array.from(S.values()),[S]),Y=l.useMemo(()=>W.filter(m=>m.quantity>0).length,[W]),G=l.useMemo(()=>o.items.every(m=>{const y=m.quantity-(m.receivedQuantity||0);if(y<=0)return!0;const v=S.get(m.id);return(v==null?void 0:v.quantity)===y}),[o.items,S]),h=l.useMemo(()=>o.items.every(m=>{if(m.quantity-(m.receivedQuantity||0)<=0)return!0;const v=S.get(m.id);return(v==null?void 0:v.quantity)===1}),[o.items,S]),N=m=>{switch(g(y=>{const v=new Map(y);return o.items.forEach(F=>{const I=v.get(F.id);if(!I)return;const A=F.quantity-(F.receivedQuantity||0);if(A<=0)return;let D=I.quantity,Z=I.includeIMEI;switch(m){case"fill_all":D=A;break;case"fill_one_each":D=A>0?1:0;break;case"clear_all":D=0;break}D===0?Z=!1:Z=D>0;const $=Z?Array(D).fill(null).map((Q,ee)=>{var ne;const ie=(ne=I.imeiEntries)==null?void 0:ne[ee];return ie?{...ie}:L()}):[];v.set(F.id,{...I,quantity:D,includeIMEI:Z,imeiEntries:$})}),v}),m){case"fill_all":n.success("All pending quantities selected");break;case"fill_one_each":n.success("Set quantity to 1 for each pending item");break;case"clear_all":n.success("Selections cleared");break}},k=async()=>{try{const m=Array.from(S.values()).filter(v=>v.quantity>0);if(m.length===0){n.error("Please select at least one item to receive");return}if(m.some(v=>v.includeIMEI&&v.imeiEntries.some(F=>!F.value.trim()))){n.error("Please fill in Serial Number or IMEI for all items.");return}await f(m)}catch(m){console.error("Error confirming partial receive:",m),n.error("Failed to process partial receive")}},E=()=>Array.from(S.values()).reduce((m,y)=>m+y.quantity,0),z=l.useMemo(()=>{const m=new Map;return o.items.forEach(y=>{const v=y.cost_price??y.costPrice??y.unitCost??0,F=typeof v=="string"?parseFloat(v)||0:Number(v)||0;m.set(y.id,F)}),m},[o.items]),B=l.useMemo(()=>Array.from(S.values()).reduce((m,y)=>{const v=z.get(y.itemId)||0;return m+v*y.quantity},0),[S,z]);return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50",onClick:u,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50},onClick:u,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col relative",style:{pointerEvents:"auto"},onClick:m=>m.stopPropagation(),children:[e.jsx("button",{onClick:u,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Me,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:C==="full"?"Full Receive with Serial Numbers":"Partial Receive with Serial Numbers"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"text-gray-900 font-bold ml-1",children:[E()," ",E()===1?"item":"items"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Products:"}),e.jsxs("span",{className:"text-gray-900 font-bold ml-1",children:[Y," ",Y===1?"product":"products"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("span",{className:"text-orange-700 font-medium",children:"Cost:"}),e.jsx("span",{className:"text-orange-900 font-bold",children:Zs(B,o.currency||"TZS")})]})]})]})]}),C==="partial"&&e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Quick Actions"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),N("fill_all")},disabled:G,className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-colors shadow-sm ${G?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-orange-600 text-white hover:bg-orange-700"}`,children:[e.jsx(qr,{className:"w-4 h-4"}),"Receive All Pending"]}),e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),N("fill_one_each")},disabled:h,className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-colors shadow-sm ${h?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-orange-500 text-white hover:bg-orange-600"}`,children:[e.jsx(Ur,{className:"w-4 h-4"}),"Receive 1 Each"]}),e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),N("clear_all")},disabled:Y===0,className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-colors shadow-sm ${Y===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-900 text-white hover:bg-gray-800"}`,children:[e.jsx(Kt,{className:"w-4 h-4"}),"Clear Selections"]})]})]})]}),M&&M.hiddenItems>0&&e.jsx("div",{className:"px-8 pb-6 border-b border-gray-100",children:e.jsxs("details",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-yellow-800 flex items-center gap-2",children:[e.jsx(vt,{className:"w-4 h-4"}),M.hiddenItems," item(s) not shown (already fully received)"]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("p",{className:"text-sm text-yellow-700",children:"The following items are hidden because they have already been fully received or have invalid data:"}),e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-1",children:M.hiddenItemsList.map(m=>e.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded border text-xs",children:[e.jsx("span",{className:"font-medium text-gray-900 truncate flex-1",children:m.name}),e.jsxs("span",{className:"text-gray-600 ml-2",children:[m.received,"/",m.ordered," received"]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs font-medium ${m.reason==="Fully received"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:m.reason})]},m.id))}),e.jsx("p",{className:"text-xs text-yellow-600 mt-2",children:"üí° If you believe some items should appear here, check the purchase order's received quantities in the database."})]})]})}),M&&M.visibleItems===0&&e.jsx("div",{className:"flex-1 flex items-center justify-center px-6 py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"All items received"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"All products in this purchase order have been fully received."}),M.hiddenItems>0&&e.jsxs("p",{className:"text-sm text-gray-500",children:[M.hiddenItems," item(s) are fully received and hidden from view."]})]})}),M&&M.visibleItems>0&&e.jsx("div",{className:"flex-1 overflow-y-auto px-6 border-t border-gray-100",onClick:m=>m.stopPropagation(),children:e.jsx("div",{className:"space-y-4 py-4",children:o.items.map(m=>{var A,D,Z;const y=m.quantity-(m.receivedQuantity||0);if(y<=0)return null;const v=((A=m.variant)==null?void 0:A.variant_name)||((D=m.variant)==null?void 0:D.name)||"",F=m.name||(((Z=m.product)==null?void 0:Z.name)||"")+(v?` - ${v}`:""),I=S.get(m.id);return I?e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${I.quantity>0?"border-green-200 hover:border-green-300 hover:shadow-md":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between p-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:F}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500 text-white shadow-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})}),"Active"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:v?`Variant: ${v}`:""}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Cost: ",e.jsx("span",{className:"font-semibold text-gray-900",children:Zs(Number(m.cost_price??m.costPrice??m.unitCost??0),o.currency||"TZS")})," ‚Ä¢ Available: ",y," units"]})]}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"ml-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1 text-right",children:"Receiving:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:$=>{$.stopPropagation(),w(m.id,Math.max(0,I.quantity-1))},className:"w-12 h-12 flex items-center justify-center rounded-xl border-2 border-gray-200 text-gray-700 hover:bg-gray-100 transition disabled:opacity-40 disabled:cursor-not-allowed text-lg",children:e.jsx(Lr,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",min:"0",max:y,value:I.quantity,onChange:$=>w(m.id,Math.min(y,Math.max(0,parseInt($.target.value)||0))),className:"w-28 px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-200/50 text-center font-bold text-xl [appearance:textfield] [-moz-appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),e.jsx("button",{onClick:$=>{$.stopPropagation(),w(m.id,Math.min(y,I.quantity+1))},className:"w-12 h-12 flex items-center justify-center rounded-xl border-2 border-gray-200 text-gray-700 hover:bg-gray-100 transition disabled:opacity-40 disabled:cursor-not-allowed text-lg",children:e.jsx(Wt,{className:"w-5 h-5"})})]})]})})]}),I.quantity>0&&e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 w-12",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 min-w-[200px]",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 min-w-[250px]",children:"Serial Number / IMEI *"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 min-w-[180px]",children:"Location"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:I.imeiEntries.map(($,Q)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-center font-medium text-gray-600",children:Q+1}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:F}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("input",{type:"text",placeholder:"Enter Serial Number or IMEI (auto-detects)",value:$.value,onChange:ee=>V(m.id,Q,ee.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${$.value.trim()?"border-gray-300 bg-white":"border-red-300 bg-red-50"}`,title:"Enter either Serial Number or IMEI - system auto-detects IMEI (15 digits)"}),$.imei&&e.jsx("div",{className:"text-xs mt-1",children:e.jsx("span",{className:"text-green-600 font-medium",children:"‚úì IMEI detected"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("button",{type:"button",onClick:ee=>{ee.stopPropagation(),_(m.id,Q)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg hover:border-blue-400 bg-white text-left flex items-center gap-2 transition-colors cursor-pointer",children:[e.jsx(zs,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:$.location?"text-gray-900 font-medium":"text-gray-400",children:$.location||"Select shelf"})]})})]},Q))})]})}),e.jsx("p",{className:"text-xs text-purple-700 mt-3 italic",children:"* Enter Serial Number or IMEI for each unit. System auto-detects IMEI (15 digits)."})]})]},m.id):null})})}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{type:"button",onClick:async()=>{const m=Array.from(S.values()).filter(y=>y.quantity>0);try{await f(m)}catch(y){console.error("Error skipping serial numbers:",y),n.error("Failed to skip serial numbers")}},disabled:a||E()===0,className:"flex-1 px-6 py-3.5 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors disabled:opacity-50 text-lg",children:["Skip Serial Numbers ","‚Üí"]}),e.jsxs("button",{type:"button",onClick:k,disabled:a||E()===0,className:"flex-1 px-6 py-3.5 rounded-xl font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg text-lg flex items-center justify-center gap-2 bg-orange-500 text-white hover:bg-orange-600 hover:shadow-xl",children:[e.jsx(Me,{className:"w-5 h-5"}),a?"Processing...":`Continue to Pricing (${E()} ${E()===1?"item":"items"})`]})]})})]})})]}):null},Oa=({isOpen:r,onClose:u})=>{var ws,Ns,Ss,Cs,ks,Ps,_s,As,$s,Es,Rs;const{currentUser:o}=Jt(),f=xa(),{purchaseOrders:a,isLoading:C,error:S,loadPurchaseOrders:g,deletePurchaseOrder:M,updatePurchaseOrder:K,getPurchaseOrder:X,createPurchaseOrder:L}=Fr(),[O,w]=l.useState(""),[_,V]=l.useState("all"),[W,Y]=l.useState("all"),[G,h]=l.useState("createdAt"),[N,k]=l.useState("desc"),[E,z]=l.useState(null),[B,m]=l.useState(null),[y,v]=l.useState(""),[F,I]=l.useState(""),[A,D]=l.useState("all"),[Z,$]=l.useState("all"),[Q,ee]=l.useState(!1),[ie,ne]=l.useState(!1);da(r);const ue=l.useRef(null),ke=l.useRef(null);l.useEffect(()=>{if(r&&ue.current){const t=ue.current.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t&&t.focus()}},[r]),l.useEffect(()=>{const t=s=>{ke.current&&!ke.current.contains(s.target)&&ne(!1)};return ie&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[ie]);const[U,oe]=l.useState(new Set),[ts,je]=l.useState(!1),[we,xe]=l.useState(!1);l.useEffect(()=>{const t=s=>{var b,R;const i=s.target,d=(b=Be.current)==null?void 0:b.contains(i),x=(R=ke.current)==null?void 0:R.contains(i),j=i.tagName==="INPUT"&&i.type==="checkbox";we&&!d&&!x&&!j&&(xe(!1),oe(new Set),je(!1))};return we&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[we]);const[Ee,jt]=l.useState(!1),[nt,wt]=l.useState(!1),[lt,it]=l.useState("overview"),[qt,Nt]=l.useState(!1),[Ye,ot]=l.useState(!1),[St,ct]=l.useState(!1),[Ut,Ge]=l.useState(!1),[Le,Ze]=l.useState(!1),ce=l.useCallback(t=>typeof window<"u"&&typeof window.confirm=="function"?Promise.resolve(window.confirm(t)):(console.warn("[OrderManagementModal] Confirmation prompt unavailable; defaulting to rejection.",{message:t}),Promise.resolve(!1)),[]),[c,p]=l.useState(null),[ge,P]=l.useState(!1),[he,le]=l.useState(!1),[Re,pe]=l.useState(!1),[Ct,Xe]=l.useState(!1),[kt,ze]=l.useState(!1),[Pt,De]=l.useState(!1),[Qe,dt]=l.useState("partial"),[se,Oe]=l.useState([]),[mt,Ve]=l.useState(new Map),[ut,ss]=l.useState(!1),[_t,rs]=l.useState(!1),[Ws,as]=l.useState(!1);l.useState(!1),l.useState(!1),l.useState(!1);const[ns,ls]=l.useState(!1),[Ys,is]=l.useState(!1),[os,cs]=l.useState(!1),[Gs,xt]=l.useState(!1),[Ie,gt]=l.useState(null),[ds,Je]=l.useState(""),[Lt,ht]=l.useState(""),[At,ms]=l.useState(null),Zt=t=>{if(t==null||t==="")return 0;const s=typeof t=="string"?parseFloat(t):Number(t);return Number.isFinite(s)?s:0},[Xs,Fe]=l.useState(!1),[$t,pt]=l.useState(null),[fe,Ne]=l.useState("confirming"),[ft,Et]=l.useState(6),Be=l.useRef(null),zt=l.useRef({});l.useEffect(()=>{r&&(console.log("üîç OrderManagementModal: Loading purchase orders..."),g())},[r,g]),l.useEffect(()=>{r||(xe(!1),oe(new Set),je(!1))},[r]),l.useEffect(()=>{os&&r&&(console.log("üîÑ Automatic refresh triggered after action"),g(),cs(!1))},[os,r,g]);const Js=l.useCallback(()=>{console.log("‚ö° Triggering automatic refresh after action"),cs(!0)},[]),q=l.useMemo(()=>{let t=a||[];return O&&(t=t.filter(s=>{var i,d,x,j,b;return s.orderNumber.toLowerCase().includes(O.toLowerCase())||((i=s.notes)==null?void 0:i.toLowerCase().includes(O.toLowerCase()))||((x=(d=s.supplier)==null?void 0:d.name)==null?void 0:x.toLowerCase().includes(O.toLowerCase()))||((j=s.trackingNumber)==null?void 0:j.toLowerCase().includes(O.toLowerCase()))||((b=s.currency)==null?void 0:b.toLowerCase().includes(O.toLowerCase()))})),_!=="all"&&(t=t.filter(s=>s.status===_)),W!=="all"&&(t=t.filter(s=>(s.currency||"TZS")===W)),y&&(t=t.filter(s=>new Date(s.createdAt)>=new Date(y))),F&&(t=t.filter(s=>new Date(s.createdAt)<=new Date(F+"T23:59:59"))),A!=="all"&&(t=t.filter(s=>{var i;return((i=s.supplier)==null?void 0:i.id)===A})),Z!=="all"&&(t=t.filter(s=>(s.paymentStatus||"unpaid")===Z)),t.sort((s,i)=>{let d,x;switch(G){case"orderNumber":d=s.orderNumber,x=i.orderNumber;break;case"totalAmount":d=s.totalAmount,x=i.totalAmount;break;case"expectedDelivery":d=s.expectedDeliveryDate||"",x=i.expectedDeliveryDate||"";break;default:d=new Date(s.createdAt).getTime(),x=new Date(i.createdAt).getTime()}return N==="asc"?d>x?1:-1:d<x?1:-1}),t},[a,O,_,W,G,N,y,F,A,Z]),us=l.useMemo(()=>q.slice(0,ft),[q,ft]);l.useEffect(()=>{Et(6),Be.current&&(Be.current.scrollTop=0)},[q]);const er=l.useCallback(t=>{const{scrollTop:s,clientHeight:i,scrollHeight:d}=t.currentTarget;s+i>=d-120&&Et(x=>Math.min(x+4,q.length))},[q.length]);l.useEffect(()=>{const t=Be.current;if(!t)return;(()=>{ft<q.length&&t.scrollHeight<=t.clientHeight+16&&Et(i=>Math.min(i+4,q.length))})()},[ft,q.length]),l.useEffect(()=>{const t=Be.current;if(!t)return;const s=()=>{const i=typeof window<"u"?window.innerHeight:0,d=i?Math.max(Math.min(i-220,720),420):500;t.style.maxHeight=`${d}px`};return s(),t.style.overflowY="auto",typeof window<"u"&&window.addEventListener("resize",s),()=>{typeof window<"u"&&window.removeEventListener("resize",s)}},[]),l.useEffect(()=>{const t=Be.current;if(t&&E){const s=zt.current[E];if(s){const i=t.getBoundingClientRect(),d=s.getBoundingClientRect(),x=d.height,j=i.height;let b;if(x>=j){const R=s.offsetTop;b=Math.max(R-16,0)}else{const R=d.top-i.top;b=t.scrollTop+R-(j-x)/2}t.scrollTo({top:Math.max(b,0),behavior:"smooth"})}}},[E]);const tr=l.useCallback(t=>s=>{s?zt.current[t]=s:delete zt.current[t]},[]),re=(t,s="TZS")=>{if(isNaN(t)||t===null||t===void 0)return`${s} 0`;try{return new Intl.NumberFormat("en-TZ",{style:"currency",currency:s||"TZS",minimumFractionDigits:0,maximumFractionDigits:2}).format(t).replace(".00","")}catch{return`${s} ${t.toLocaleString("en-TZ",{minimumFractionDigits:0,maximumFractionDigits:2})}`}},Rt=t=>new Date(t).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}),xs=()=>{U.size===q.length?oe(new Set):oe(new Set(q.map(t=>t.id)))},sr=t=>{const s=new Set(U);s.has(t)?s.delete(t):s.add(t),oe(s)},Qt=()=>{const t=U.size>0?q.filter(R=>U.has(R.id)):q;if(t.length===0){n.error("No orders to export");return}const s=["Order Number","Date","Supplier","Status","Payment Status","Currency","Total Amount","Items Count"],i=t.map(R=>{var J;return[R.orderNumber,Rt(R.createdAt),((J=R.supplier)==null?void 0:J.name)||"N/A",R.status,R.paymentStatus||"unpaid",R.currency||"TZS",R.totalAmount,R.items.length]}),d=[s.join(","),...i.map(R=>R.map(J=>`"${J}"`).join(","))].join(`
`),x=new Blob([d],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a"),b=URL.createObjectURL(x);j.setAttribute("href",b),j.setAttribute("download",`purchase-orders-${new Date().toISOString().split("T")[0]}.csv`),j.style.visibility="hidden",document.body.appendChild(j),j.click(),document.body.removeChild(j),n.success(`Exported ${t.length} order(s) to CSV`)},rr=async()=>{try{n("Generating PDF...",{icon:"üìÑ"}),window.print(),n.success("Use browser Print dialog to save as PDF")}catch(t){console.error("Error generating PDF:",t),n.error("Failed to generate PDF")}},gs=()=>{w(""),V("all"),Y("all"),v(""),I(""),D("all"),$("all"),n.success("All filters cleared")};l.useEffect(()=>{if(!r)return;const t=s=>{(s.metaKey||s.ctrlKey)&&s.key==="r"&&(s.preventDefault(),g()),(s.metaKey||s.ctrlKey)&&s.key==="a"&&!s.shiftKey&&(s.preventDefault(),xs(),n.success(`${U.size===q.length?"Deselected":"Selected"} all orders`)),(s.metaKey||s.ctrlKey)&&s.key==="e"&&(s.preventDefault(),Qt()),(s.metaKey||s.ctrlKey)&&s.key==="f"&&s.shiftKey&&(s.preventDefault(),jt(!Ee),n.success(`Analytics ${Ee?"hidden":"shown"}`)),s.key==="Escape"&&(U.size>0?(oe(new Set),xe(!1),je(!1),n.success("Selection cleared")):Q?ee(!1):u()),(s.metaKey||s.ctrlKey)&&s.key==="k"&&(s.preventDefault(),gs()),s.key==="?"&&!s.metaKey&&!s.ctrlKey&&(s.preventDefault(),Ze(!Le))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[r,U,q,Ee,Q,Le,g,u]);const hs=(t,s)=>{const i=t.status,d=t.paymentStatus||"unpaid";return s==="completed"&&i!=="received"?{valid:!1,message:"Order must be received before completing"}:s==="completed"&&d!=="paid"?{valid:!1,message:"Order must be fully paid before completing"}:s==="received"&&d==="unpaid"?{valid:!1,message:"Order must be paid before full receiving items"}:s==="shipped"&&!["sent","confirmed"].includes(i)?{valid:!1,message:"Order must be sent or confirmed before shipping"}:s==="confirmed"&&i!=="sent"?{valid:!1,message:"Only sent orders can be confirmed"}:{valid:!0}},ps=async(t,s)=>{const i=a==null?void 0:a.find(x=>x.id===t);if(!i){n.error("Order not found");return}const d=hs(i,s);if(!d.valid){n.error(d.message||"Invalid status transition");return}try{const x=await K(t,{status:s});x.ok?(n.success(`Order status updated to ${s}`),await g()):n.error(x.message||"Failed to update order status")}catch{n.error("Failed to update order status")}},fs=async(t,s)=>{try{const i=await K(t,s);i.ok?(n.success("Shipping information updated"),await g(),m(null)):n.error(i.message||"Failed to update shipping information")}catch{n.error("Failed to update shipping information")}},T=l.useCallback(()=>(a==null?void 0:a.find(t=>t.id===c))||null,[a,c]),ar=l.useCallback(async t=>{const s=a==null?void 0:a.find(i=>i.id===t);if(s){if(s.status!=="draft"){n.error("Only draft orders can be approved");return}if(!s.items||s.items.length===0){n.error("Cannot approve order without items");return}try{ss(!0);const i=await ve.approvePurchaseOrder(s.id,(o==null?void 0:o.id)||"","Approved and sent to supplier");i.success?await ve.updateOrderStatus(s.id,"sent",(o==null?void 0:o.id)||"")?(await g(),n.success("Order approved and sent to supplier")):(await g(),n.success("Order approved")):n.error(i.message)}catch(i){console.error("Error approving order:",i),n.error("Failed to approve order")}finally{ss(!1)}}},[a,o,g]),nr=l.useCallback(t=>{const s=a==null?void 0:a.find(j=>j.id===t);if(!s)return;if(s.paymentStatus==="paid"){n.error("This purchase order has already been fully paid");return}const i=s.totalAmount||0,d=s.totalPaid||0;let x=i-d;if(s.currency&&s.currency!=="TZS"&&s.exchangeRate&&s.exchangeRate>1){const j=d/s.exchangeRate;x=i-j}if(i===0){n.error("Cannot make payment: Purchase order has no total amount. Please add items to the order first.");return}if(x<=0){n.error(`This purchase order has been fully paid. Total: ${i.toLocaleString()}, Paid: ${d.toLocaleString()}`);return}console.log("üí≥ Opening payment modal:",{totalAmount:i,totalPaid:d,remainingAmount:x,currency:s.currency,exchangeRate:s.exchangeRate}),p(t),P(!0)},[a]),lr=l.useCallback(async(t,s)=>{const i=T();if(i)try{const{purchaseOrderPaymentService:d}=await Ds(()=>import("./purchaseOrderPaymentService-dcbd50c0.js"),["assets/purchaseOrderPaymentService-dcbd50c0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),j=(await Promise.all(t.map(async b=>await d.processPayment({purchaseOrderId:i.id,paymentAccountId:b.paymentAccountId,amount:b.amount,currency:b.currency||"TZS",paymentMethod:b.paymentMethod,paymentMethodId:b.paymentMethodId,reference:b.reference,notes:b.notes,createdBy:(o==null?void 0:o.id)||null})))).filter(b=>!b.success);if(j.length>0){const b=j.map(R=>R.message).join("; ");n.error(`Some payments failed: ${b}`)}else{n.success("All payments processed successfully");try{i.id&&(await ve.updatePaymentStatus(i.id),console.log("‚úÖ Purchase order payment status updated"))}catch(b){console.warn("‚ö†Ô∏è Failed to update payment status:",b)}}P(!1),p(null),await g()}catch(d){console.error("Error processing payment:",d),n.error("Failed to process payment. Please try again.")}},[T,o,g]),ir=l.useCallback(async t=>{var x,j;console.log("üîÑ handleUndoLatestPayment called with orderId:",t);const s=a==null?void 0:a.find(b=>b.id===t);if(!s){console.error("‚ùå Purchase order not found for ID:",t),n.error("Purchase order not found");return}if(console.log("üìã Found order:",{id:s.id,orderNumber:s.orderNumber,totalPaid:s.totalPaid}),At&&At!==t){n.error("Please wait for the current payment reversal to finish");return}const i=Zt(s.totalPaid);if(console.log("üí∞ totalPaidTZS calculated as:",i),i<=0){console.warn("‚ö†Ô∏è No payments to undo for order:",s.orderNumber),n.error("There are no payments to undo for this order");return}if(await ce(`Undo the most recent payment recorded for ${s.orderNumber}?`))try{ms(t),console.log("üîß Calling purchaseOrderPaymentService.reverseLatestPayment...");const{purchaseOrderPaymentService:b}=await Ds(()=>import("./purchaseOrderPaymentService-dcbd50c0.js"),["assets/purchaseOrderPaymentService-dcbd50c0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),R=await b.reverseLatestPayment(t,(o==null?void 0:o.id)||null);if(console.log("üìä Reverse payment result:",R),!R.success){console.error("‚ùå Reverse payment failed:",R.message),n.error(R.message||"Failed to reverse payment");return}console.log("‚úÖ Reverse payment successful");const J=Zt(((x=R.data)==null?void 0:x.amount_reversed)??((j=R.data)==null?void 0:j.reversed_amount)??0),qe=J>0?re(J,"TZS"):"Payment";n.success(`Payment reversal complete. ${qe} restored.`),console.log("üîÑ Refreshing purchase orders data..."),await g(),console.log("‚úÖ Purchase orders data refreshed")}catch(b){console.error("Error reversing payment:",b),n.error((b==null?void 0:b.message)||"Failed to reverse payment")}finally{ms(null)}},[a,confirm,o,g,At,re,Zt]),or=l.useCallback(t=>{const s=a==null?void 0:a.find(j=>j.id===t);if(!s)return;const i=["shipped","partial_received","confirmed","sent"];if(!i.includes(s.status)){n.error(`Cannot receive order in status: ${s.status}. Order must be in: ${i.join(", ")}`);return}if(s.paymentStatus!=="paid"&&(console.warn("‚ö†Ô∏è Receiving order that is not fully paid:",s.paymentStatus),n.success("Note: Receiving order before full payment",{duration:3e3})),!s.items||s.items.length===0){n.error("Cannot receive order without items");return}const d=s.items.reduce((j,b)=>j+(b.quantity||0),0),x=s.items.reduce((j,b)=>j+(b.receivedQuantity||0),0);if(d>0&&x>=d){n.error(`Order already fully received: ${x}/${d} items`);return}if(d===0){console.warn("‚ö†Ô∏è Purchase order has 0 total quantity ordered. This may indicate a data issue."),n.error("Cannot receive order: No items to receive (total quantity is 0). Please check the order data.");return}console.log("üì¶ Starting receive process - Opening consolidated receive modal:",{orderId:s.id,orderNumber:s.orderNumber,status:s.status,paymentStatus:s.paymentStatus,totalOrdered:d,totalReceived:x,remaining:d-x}),p(t),le(!0)},[a]),cr=l.useCallback(async t=>{const s=T();if(!s||!o)return;const i=t.map(d=>({id:d.itemId,receivedQuantity:d.quantity,serialNumbers:d.includeIMEI?d.imeiEntries.map(x=>{var j;return{serial_number:x.value,imei:x.imei||x.value,cost_price:((j=s.items.find(b=>b.id===d.itemId))==null?void 0:j.costPrice)||0,selling_price:0,location:x.location||"",notes:""}}):void 0}));Oe(i),pe(!1),n.success("Serial numbers and quantities saved! Now set pricing..."),setTimeout(()=>{ze(!0)},300)},[T,o]),dr=l.useCallback(async t=>{!T()||!o||(Oe(t),Xe(!1),n.success("Serial numbers saved! Now set pricing..."),setTimeout(()=>{ze(!0)},300))},[T,o]),mr=l.useCallback(async t=>{if(!T()||!o)return;if(console.log("üí∞ Pricing data confirmed:",t),console.log("üì¶ Serial numbers to include:",se),Ve(t),ze(!1),sessionStorage.getItem("includeQualityCheck")==="true"){console.log("üîç Quality check required - opening quality check modal"),sessionStorage.removeItem("includeQualityCheck"),De(!0);return}await ur(t)},[T,o,se]),ur=l.useCallback(async t=>{const s=T();if(!s||!o)return;const i=se.reduce((x,j)=>x+(j.receivedQuantity||0),0),d=se.filter(x=>x.receivedQuantity>0).length;Ne("confirming"),Fe(!0),pt({title:"Ready to Add to Inventory",message:`You're about to add ${i} items (${d} products) to inventory${se.some(x=>{var j;return((j=x.serialNumbers)==null?void 0:j.length)>0})?" with serial numbers":""}.`,onConfirm:async()=>{var x,j,b,R,J;try{rs(!0),Ne("processing");let qe=0;for(const[H,Pe]of Array.from(t.entries())){const Se=s.items.find(be=>be.id===H);if(Se&&Se.variantId)try{console.log(`üí∞ Updating variant ${Se.variantId} with selling price: ${Pe.selling_price}`);const{error:be}=await te.from("lats_product_variants").update({selling_price:Pe.selling_price,cost_price:Pe.cost_price,updated_at:new Date().toISOString()}).eq("id",Se.variantId);be?(console.error("Error updating variant price:",be),n.error(`Failed to update price for ${((x=Se.product)==null?void 0:x.name)||"item"}`)):(console.log(`‚úÖ Variant ${Se.variantId} price updated successfully`),qe++)}catch(be){console.error("Error updating variant:",be),n.error("Error updating variant prices")}}if(console.log(`üí∞ Updated ${qe} variant prices`),se.length>0){console.log("üì¶ Saving serial numbers and processing IMEI variants...");const H=await ve.updateReceivedQuantities(s.id,se,o.id);H.success?(n.success("Serial numbers saved and IMEI variants processed!"),console.log("‚úÖ IMEI variants and children variants created successfully")):(console.error("‚ùå Failed to process serial numbers:",H.message),n.error(`Failed to save serial numbers: ${H.message}`))}await new Promise(H=>setTimeout(H,500));const Is=new Map;se.forEach(H=>{Is.set(H.id,H.receivedQuantity)});let Tt=!0,bt=0,et=0,Mt=0;for(const H of s.items){const Pe=H.quantity,Se=H.receivedQuantity||0,be=Is.get(H.id)||0,ye=Se+be;bt+=Pe,et+=be,Mt+=Se,ye<Pe&&(Tt=!1)}const Dt=Qe==="partial"&&!Tt;console.log("üìä Receiving stats:",{mode:Qe,totalOrdered:bt,totalAlreadyReceived:Mt,totalReceiving:et,totalAfterReceiving:Mt+et,allItemsFullyReceived:Tt,isPartialReceive:Dt}),console.log(Dt?"üì¶ Processing partial receive...":"üì¶ Processing full/final receive..."),console.log("üì¶ Calling receive with params:",{orderId:s.id,orderNumber:s.orderNumber,userId:o.id,currentStatus:s.status,isPartialReceive:Dt,totalReceiving:et,totalOrdered:bt});const ae=await ve.completeReceive(s.id,o.id,Dt?`Partial receive: ${et} of ${bt} items`:"Complete receive of purchase order with pricing and serial numbers");if(console.log("üì¶ Receive result:",ae),console.log("üì¶ Result success:",ae.success),console.log("üì¶ Result message:",ae.message),console.log("üì¶ Result data:",ae.data),ae.success){console.log("‚úÖ completeReceive returned success! Now updating inventory items with selling prices...");const{data:H,error:Pe}=await te.from("inventory_items").select("id, variant_id, cost_price, selling_price, status").eq("purchase_order_id",s.id);console.log("üì¶ Inventory items check:",{error:Pe,itemsFound:(H==null?void 0:H.length)||0,items:H}),Pe?(console.error("‚ùå Error checking inventory items:",Pe),n.error("Warning: Could not verify inventory items were created")):!H||H.length===0?(console.error("‚ùå NO INVENTORY ITEMS FOUND! completeReceive succeeded but no items in database!"),n.error("Error: Receive succeeded but no inventory items were created. Please check database.")):console.log(`‚úÖ Found ${H.length} inventory items in database`);try{const{data:ye,error:He}=await te.from("inventory_items").select("id, variant_id").eq("purchase_order_id",s.id);if(!He&&ye){console.log(`üì¶ Updating ${ye.length} inventory items with pricing data...`);let Ts=0;for(const Ke of ye){const yt=s.items.find(me=>me.variantId===Ke.variant_id);if(yt){const me=t.get(yt.id);if(me){const{error:_e}=await te.from("inventory_items").update({selling_price:me.selling_price,cost_price:me.cost_price,status:"available",updated_at:new Date().toISOString()}).eq("id",Ke.id);_e?console.error(`‚ùå Error updating inventory item ${Ke.id}:`,_e):(console.log(`‚úÖ Updated inventory item ${Ke.id} with selling price: ${me.selling_price} and status: available`),Ts++)}}}console.log(`‚úÖ Successfully updated ${Ts} of ${ye.length} inventory items`);for(const[Ke,yt]of Array.from(t.entries())){const me=s.items.find(_e=>_e.id===Ke);if(me&&me.variantId)try{const{data:_e}=await te.from("lats_product_variants").select("id").eq("parent_variant_id",me.variantId).eq("variant_type","imei_child");_e&&_e.length>0&&(console.log(`üì± Found ${_e.length} IMEI child variants for parent ${me.variantId}`),await te.from("lats_product_variants").update({selling_price:yt.selling_price,cost_price:yt.cost_price,updated_at:new Date().toISOString()}).eq("id",me.variantId),console.log(`‚úÖ Updated parent variant ${me.variantId} prices for IMEI children`))}catch(_e){console.warn(`‚ö†Ô∏è Could not update child variant prices for item ${Ke}:`,_e)}}}}catch(ye){console.error("Error updating inventory item prices:",ye),n.error("Warning: Could not update inventory item prices")}const Se=(j=ae.data)==null?void 0:j.new_status,be=(b=ae.data)==null?void 0:b.is_complete;if(console.log("üìä Database result:",{status:Se,isComplete:be,totalReceived:(R=ae.data)==null?void 0:R.total_received,totalOrdered:(J=ae.data)==null?void 0:J.total_ordered}),be||Tt){n.success("üéâ All items received! Purchase order complete!",{duration:6e3});try{console.log("üîÑ Immediately updating order status to received..."),await te.from("lats_purchase_orders").update({status:"received",updated_at:new Date().toISOString()}).eq("id",s.id),console.log("‚úÖ Order status updated to received"),Ms.emit("lats:purchase-order.received",{purchaseOrderId:s.id,userId:o.id,notes:"Complete receive"}),console.log("üîÑ Force refreshing purchase orders immediately..."),await g(),console.log("‚úÖ UI refreshed with new order status")}catch(ye){console.error("‚ùå Failed to update order status:",ye)}Oe([]),Ve(new Map),Ne("success"),setTimeout(()=>{Fe(!1),pt(null),Ne("confirming"),p(null)},500)}else{const ye=bt-(Mt+et);n.success(`‚úÖ Items added to inventory! ${ye} items remaining to receive.`,{duration:5e3});try{console.log("üîÑ Updating order status to partial_received..."),await te.from("lats_purchase_orders").update({status:"partial_received",updated_at:new Date().toISOString()}).eq("id",s.id),console.log("‚úÖ Order status updated to partial_received"),Ms.emit("lats:purchase-order.received",{purchaseOrderId:s.id,userId:o.id,notes:"Partial receive"}),console.log("üîÑ Force refreshing purchase orders immediately..."),await g(),console.log("‚úÖ UI refreshed with new order status")}catch(He){console.error("‚ùå Failed to update order status:",He)}if(ae.summary){console.log("Receive summary:",ae.summary);const He=ae.summary;n.success(`Received: ${He.total_received||0}/${He.total_ordered||0} items (${He.percent_received||0}% complete)`,{duration:5e3})}Oe([]),Ve(new Map),Ne("success"),setTimeout(()=>{Fe(!1),pt(null),Ne("confirming"),p(null)},500)}}else console.error("‚ùå Receive failed:",ae),n.error(`Receive failed: ${ae.message||"Unknown error"}`),ae.message&&ae.message.includes("status")&&n.error(`Current status: ${s.status}. Try changing status to 'shipped' first.`,{duration:6e3}),Ne("confirming"),Fe(!1)}catch(qe){console.error("Receive error:",qe),n.error(`Failed to receive purchase order: ${qe instanceof Error?qe.message:"Unknown error"}`),Ne("confirming"),Fe(!1)}finally{rs(!1)}}}),Ne("confirming"),Fe(!0)},[T,o,se,Qe,g]),xr=l.useCallback(async t=>{const s=a==null?void 0:a.find(i=>i.id===t);if(s){if(s.status!=="received"){n.error("Order must be received before completing");return}if(s.paymentStatus!=="paid"){n.error("Order must be fully paid before completing");return}p(t),Ge(!0)}},[a]),gr=l.useCallback(async()=>{const t=T();if(t)try{ls(!0),Ge(!1);const s=await ve.completePurchaseOrder(t.id,(o==null?void 0:o.id)||"","Purchase order completed");s.success?(n.success("Purchase order completed successfully!"),p(null),await g()):n.error(s.message||"Failed to complete order")}catch(s){console.error("Error completing order:",s),n.error("Failed to complete order")}finally{ls(!1)}},[T,o,g]),hr=l.useCallback(async t=>{console.debug("[OrderManagementModal] handleCancelOrderEnhanced invoked",{orderId:t});const s=a==null?void 0:a.find(d=>d.id===t);if(!s)return;if(s.status==="completed"){console.debug("[OrderManagementModal] Cannot cancel completed order",{orderId:t}),n.error("Cannot cancel a completed order");return}if(s.status==="cancelled"){console.debug("[OrderManagementModal] Order already cancelled",{orderId:t}),n.error("Order is already cancelled");return}if(!(s.paymentStatus==="paid"&&!await ce("This order has been fully paid. Cancelling will require a refund. Are you sure you want to continue?")||(console.debug("[OrderManagementModal] Showing cancel confirmation",{orderId:t}),!await ce("Are you sure you want to cancel this order? This action cannot be undone."))))try{as(!0),console.debug("[OrderManagementModal] Calling PurchaseOrderActionsService.cancelOrder",{orderId:t});const d=await st.cancelOrder(s.id);d.success?(console.debug("[OrderManagementModal] Order cancelled successfully",{orderId:t}),n.success(d.message||"Order cancelled successfully"),await g(),await st.logAction(s.id,"order_cancelled",{reason:"user_cancelled"})):(console.error("[OrderManagementModal] Cancel order failed",{orderId:t,message:d.message}),n.error(d.message||"Failed to cancel order"))}catch(d){console.error("Error cancelling order:",d),n.error("Failed to cancel purchase order")}finally{console.debug("[OrderManagementModal] Resetting cancelling state",{orderId:t}),as(!1)}},[a,g,ce]),pr=async t=>{const s=a==null?void 0:a.find(i=>i.id===t);if(s){if(s.status!=="draft"){n.error("Only draft orders can be deleted");return}if(await ce("Are you sure you want to delete this purchase order? This action cannot be undone."))try{is(!0);const i=await st.deleteOrder(s.id);if(i.success){n.success("Purchase order deleted successfully");const d=new Set(U);d.delete(t),oe(d),d.size===0&&(xe(!1),je(!1)),Js()}else n.error(i.message)}catch(i){console.error("Error deleting order:",i),n.error("Failed to delete order")}finally{is(!1)}}},fr=t=>{It(t),n.success("Opening order details...")},br=t=>{u(),n.success("Opening purchase order for editing..."),setTimeout(()=>{f(`/lats/purchase-order/create?edit=${t}`)},100)},yr=async t=>{var d;const s=a==null?void 0:a.find(x=>x.id===t);if(!s){n.error("Order not found");return}if(await ce(`Duplicate order ${s.orderNumber}? This will create a new draft order with the same details.`))try{const x=`PO-${Date.now()}`,j=await X(t);if(!j.ok||!j.data){n.error("Failed to load order details for duplication");return}const b={supplierId:s.supplierId,expectedDelivery:s.expectedDeliveryDate||"",notes:`Duplicated from ${s.orderNumber} - ${s.notes||""}`,status:"draft",currency:s.currency,paymentTerms:s.paymentTerms,exchangeRate:s.exchangeRate,baseCurrency:s.baseCurrency,exchangeRateSource:s.exchangeRateSource,exchangeRateDate:s.exchangeRateDate,items:((d=j.data.items)==null?void 0:d.map(J=>({productId:J.productId,variantId:J.variantId,quantity:J.quantity,costPrice:J.costPrice,sellingPrice:J.sellingPrice||0,minimumOrderQty:J.minimumOrderQty,notes:J.notes||""})))||[]},R=await L(b);R.ok?(n.success(`Order duplicated as ${x}!`),await g()):n.error(R.message||"Failed to duplicate order")}catch(x){console.error("Error duplicating order:",x),n.error("Failed to duplicate order")}},vr=t=>{if(!(a==null?void 0:a.find(i=>i.id===t))){n.error("Order not found");return}z(t),n.success("Preparing print view..."),setTimeout(()=>{window.print()},500)},jr=t=>{const s=a==null?void 0:a.find(i=>i.id===t);if(!s){n.error("Order not found");return}gt(t),Je((s.totalAmount-(s.totalPaid||0)).toString()),xt(!0)},wr=async()=>{if(!Ie)return;const t=a==null?void 0:a.find(d=>d.id===Ie);if(!t){n.error("Order not found");return}const s=parseFloat(ds)||0;if(s<=0){n.error("Please enter a valid payment amount");return}const i=t.totalAmount-(t.totalPaid||0);if(s>i){n.error(`Payment amount cannot exceed remaining balance of ${re(i)}`);return}try{const d=(t.totalPaid||0)+s,x=d>=t.totalAmount?"paid":"partial",j=await K(Ie,{totalPaid:d,paymentStatus:x,notes:(t.notes||"")+`
[Payment: ${re(s)} on ${new Date().toLocaleDateString()}${Lt?" - "+Lt:""}]`});j.ok?(n.success(`Payment of ${re(s)} recorded successfully!`),xt(!1),gt(null),Je(""),ht(""),await g()):n.error(j.message||"Failed to record payment")}catch(d){console.error("Error recording payment:",d),n.error("Failed to record payment")}},Nr=t=>{n("Receipt view - Opening in expanded section..."),It(t),z(t)},Sr=t=>{n("Invoice view - Opening in expanded section..."),It(t),z(t)},Cr=async t=>{const s=a==null?void 0:a.find(d=>d.id===t);if(!s){n.error("Order not found");return}await ce(`Initiate return process for order ${s.orderNumber}?`)&&await fs(t,{shippingStatus:"returned"})},kr=t=>{n("Review functionality - Add notes or ratings in the expanded section"),z(t)},Pr=async t=>{await ce("Restore this order to draft status?")&&await ps(t,"draft")},_r=l.useCallback(t=>{var d;if(!((d=t.supplier)!=null&&d.phone)){n.error("Supplier phone number not available");return}const s=`Hello, regarding Purchase Order #${t.orderNumber}. Please provide status update.`,i=`https://wa.me/${t.supplier.phone.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(s)}`;window.open(i,"_blank"),n.success("Opening WhatsApp...")},[]);l.useCallback(async t=>{var s;if(!((s=t.supplier)!=null&&s.phone)){n.error("Supplier phone number not available");return}try{const i=`Purchase Order #${t.orderNumber} - Please provide status update.`,d=await st.sendSMS(t.supplier.phone,i,t.id);d.success?n.success("SMS sent successfully"):n.error(d.message)}catch(i){console.error("Error sending SMS:",i),n.error("Failed to send SMS")}},[]);const Ar=l.useCallback(t=>{var x;if(!((x=t.supplier)!=null&&x.email)){n.error("Supplier email not available");return}const s=`Purchase Order #${t.orderNumber}`,i=`Hello,

Regarding Purchase Order #${t.orderNumber}...

Best regards`,d=`mailto:${t.supplier.email}?subject=${encodeURIComponent(s)}&body=${encodeURIComponent(i)}`;window.location.href=d,n.success("Opening email client...")},[]);l.useCallback(t=>{var i;if(!((i=t.supplier)!=null&&i.phone)){n.error("Supplier phone number not available");return}const s=`tel:${t.supplier.phone.replace(/[^0-9+]/g,"")}`;window.location.href=s,n.success("Opening phone dialer...")},[]);const It=l.useCallback(t=>{p(t),it("overview"),wt(!0)},[]),$r=l.useCallback(t=>{p(t),ot(!0)},[]),Er=l.useCallback(t=>{p(t),Nt(!0)},[]),Rr=l.useCallback(t=>{p(t),ct(!0)},[]),Ir=async t=>{var i;if(await ce("Archive this order? It will be marked as cancelled with an archive tag."))try{const d=await K(t,{status:"cancelled",notes:(((i=a==null?void 0:a.find(x=>x.id===t))==null?void 0:i.notes)||"")+`
[Archived on `+new Date().toLocaleString()+"]"});d.ok?(n.success("Order archived successfully"),await g()):n.error(d.message||"Failed to archive order")}catch(d){console.error("Error archiving order:",d),n.error("Failed to archive order")}},bs=async t=>{if(U.size===0){n.error("No orders selected");return}const s=[];for(const j of Array.from(U)){const b=a==null?void 0:a.find(R=>R.id===j);if(b){const R=hs(b,t);R.valid||s.push(`Order ${b.orderNumber}: ${R.message}`)}}if(s.length>0){n.error(`Cannot update orders: ${s.slice(0,2).join("; ")}${s.length>2?"...":""}`);return}if(!await ce(`Update ${U.size} order(s) to "${t}"?`))return;let d=0,x=0;for(const j of U)try{(await K(j,{status:t})).ok?d++:x++}catch{x++}d>0&&(n.success(`Updated ${d} order(s) successfully`),await g()),x>0&&n.error(`Failed to update ${x} order(s)`),oe(new Set),xe(!1),je(!1)},Tr=async()=>{if(U.size===0){n.error("No orders selected");return}if(!await ce(`Delete ${U.size} order(s)? This action cannot be undone.`))return;let s=0,i=0;for(const d of Array.from(U))try{(await M(d)).ok?s++:i++}catch{i++}s>0&&n.success(`Deleted ${s} order(s) successfully`),i>0&&n.error(`Failed to delete ${i} order(s)`),oe(new Set),xe(!1),je(!1)},Vt=t=>{switch(t){case"draft":return"text-gray-600 bg-gray-100";case"sent":return"text-orange-600 bg-orange-100";case"confirmed":return"text-indigo-600 bg-indigo-100";case"shipped":return"text-purple-600 bg-purple-100";case"partial_received":return"text-orange-600 bg-orange-100";case"received":return"text-green-600 bg-green-100";case"completed":return"text-emerald-600 bg-emerald-100";case"cancelled":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},Bt=t=>{switch(t){case"draft":return e.jsx(Ce,{className:"w-4 h-4"});case"sent":return e.jsx(Fs,{className:"w-4 h-4"});case"confirmed":return e.jsx(Te,{className:"w-4 h-4"});case"shipped":return e.jsx(ta,{className:"w-4 h-4"});case"partial_received":return e.jsx(de,{className:"w-4 h-4"});case"received":return e.jsx(Me,{className:"w-4 h-4"});case"completed":return e.jsx(Te,{className:"w-4 h-4"});case"cancelled":return e.jsx(Us,{className:"w-4 h-4"});default:return e.jsx(at,{className:"w-4 h-4"})}},ys=t=>{switch(t){case"draft":return"Draft";case"sent":return"Sent";case"confirmed":return"Confirmed";case"shipped":return"Shipped";case"partial_received":return"Partial Received";case"received":return"Received";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return String(t).replace("_"," ").split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ")}},vs=t=>{switch(t){case"paid":return"text-green-600 bg-green-100";case"partial":return"text-yellow-600 bg-yellow-100";case"unpaid":return"text-red-600 bg-red-100";case"refunded":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}},Mr=t=>{switch(t){case"pending":return"text-yellow-600 bg-yellow-100";case"packed":return"text-blue-600 bg-blue-100";case"shipped":return"text-indigo-600 bg-indigo-100";case"in_transit":return"text-orange-600 bg-orange-100";case"delivered":return"text-green-600 bg-green-100";case"returned":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},js=we||U.size>0;return r?Dr.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[99999]",style:{top:0,left:0,right:0,bottom:0,overflow:"hidden",overscrollBehavior:"none"},role:"dialog","aria-modal":"true","aria-labelledby":"order-management-modal-title",onClick:u,children:e.jsxs("div",{ref:ue,className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:u,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full border-2 border-transparent hover:border-orange-400 transition-all shadow-lg z-50","aria-label":"Close modal",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 pr-20 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(es,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{id:"order-management-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Order Management"}),e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold text-gray-900",children:us.length})," of ",e.jsx("span",{className:"font-semibold text-gray-900",children:q.length})," filtered orders",U.size>0&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-orange-100 text-orange-700",children:[U.size," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-500 font-medium uppercase tracking-wide whitespace-nowrap",children:"Currency Breakdown:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{const t=q.reduce((s,i)=>{const d=i.currency||"TZS",x=i.totalAmountBaseCurrency||i.totalAmount;return s[d]||(s[d]={original:0,tzs:0}),s[d].original+=i.totalAmount,s[d].tzs+=x,s},{});return Object.entries(t).map(([s,i])=>e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-50 text-gray-700 border border-gray-200 text-sm font-medium whitespace-nowrap",children:[e.jsx("span",{className:"font-semibold",children:re(i.tzs,"TZS")}),s!=="TZS"&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",re(i.original,s),")"]})]},s))})()})]}),e.jsxs("button",{onClick:()=>Ze(!Le),className:"text-xs text-gray-500 hover:text-gray-700 font-medium flex items-center gap-1.5 px-2.5 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all duration-200 flex-shrink-0",title:"View keyboard shortcuts",children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-white border border-gray-300 rounded text-xs font-mono",children:"?"}),"Shortcuts"]})]})]})]})]})}),ft<q.length&&e.jsx("div",{className:"p-6 pb-0 flex-shrink-0",children:e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>Et(t=>Math.min(t+4,q.length)),className:"px-4 py-2 text-sm font-medium text-orange-600 border-2 border-orange-300 rounded-xl hover:bg-orange-50 hover:border-orange-400 transition-all duration-200",children:"Show more orders"})})}),e.jsxs("div",{className:"p-6 pb-0 flex-shrink-0",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl cursor-pointer transition-all duration-200 hover:scale-105 ${_==="all"?"text-orange-600 bg-orange-100 shadow-lg scale-105 ring-2 ring-offset-2 ring-orange-400":"bg-white hover:bg-orange-50 border-2 border-gray-200 hover:border-orange-300 shadow-sm hover:shadow-md"}`,onClick:()=>V("all"),title:"Click to show all orders",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(Zr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium capitalize",children:"All"})]}),e.jsx("div",{className:"flex items-baseline gap-1",children:e.jsx("span",{className:"text-2xl font-bold",children:(a||[]).length})})]})}),["sent","confirmed","shipped","partial_received","received"].map(t=>{const s=q.filter(d=>d.status===t).length,i=(a||[]).filter(d=>d.status===t).length;return e.jsx("div",{className:`p-3 rounded-xl cursor-pointer transition-all duration-200 hover:scale-105 ${_===t?Vt(t)+" shadow-lg scale-105 ring-2 ring-offset-2 ring-orange-400":"bg-white hover:bg-orange-50 border-2 border-gray-200 hover:border-orange-300 shadow-sm hover:shadow-md"}`,onClick:()=>V(_===t?"all":t),title:`Click to filter by ${t}`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[Bt(t),e.jsx("span",{className:"text-xs font-medium capitalize",children:t.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold",children:s}),s!==i&&e.jsxs("span",{className:"text-xs text-gray-500",children:["/ ",i]})]})]})},t)})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs("div",{className:"relative",ref:ke,children:[e.jsxs("button",{onClick:()=>ne(!ie),className:"flex items-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-all duration-200 font-semibold text-sm shadow-md",title:"Actions",children:[e.jsx(zr,{className:"w-4 h-4"}),"Actions",e.jsx(Yt,{className:`w-4 h-4 transition-transform duration-200 ${ie?"rotate-180":""}`})]}),ie&&e.jsxs("div",{className:"absolute left-0 mt-1 w-56 bg-white rounded-xl shadow-lg border-2 border-gray-200 z-50",children:[e.jsxs("button",{onClick:()=>{we?(xe(!1),oe(new Set),je(!1)):xe(!0),ne(!1)},className:`w-full px-4 py-2 text-left hover:bg-gray-50 hover:border-l-4 hover:border-orange-400 flex items-center gap-2 rounded-t-xl ${we?"bg-orange-50 text-orange-700":""}`,children:[e.jsx(Te,{className:"w-4 h-4"}),we?"Done Selecting":"Select Orders"]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs("button",{onClick:()=>{jt(!Ee),ne(!1)},className:`w-full px-4 py-2 text-left hover:bg-gray-50 hover:border-l-4 hover:border-orange-400 flex items-center gap-2 ${Ee?"bg-purple-50 text-purple-700":""}`,children:[e.jsx(Qr,{className:"w-4 h-4"}),Ee?"Hide Analytics":"Show Analytics"]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs("button",{onClick:()=>{Qt(),ne(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-50 hover:border-l-4 hover:border-orange-400 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Export to CSV"]}),e.jsxs("button",{onClick:()=>{rr(),ne(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-50 hover:border-l-4 hover:border-orange-400 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Export to PDF"]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs("button",{onClick:()=>{console.log("üîÑ Manual refresh triggered"),g(),ne(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-50 hover:border-l-4 hover:border-orange-400 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:C,children:[C?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):e.jsx(Ft,{className:"w-4 h-4"}),"Refresh"]})]})]}),we&&U.size>0?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>bs("confirmed"),className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg border-2 border-transparent hover:border-orange-400 transition-all flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),"Approve Selected (",U.size,")"]}),e.jsxs("button",{onClick:()=>bs("sent"),className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg border-2 border-transparent hover:border-orange-400 transition-all flex items-center gap-2",children:[e.jsx(Fs,{className:"w-4 h-4"}),"Send Selected (",U.size,")"]}),e.jsxs("button",{onClick:()=>Qt(),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg border-2 border-transparent hover:border-orange-400 transition-all flex items-center gap-2",children:[e.jsx(Vr,{className:"w-4 h-4"}),"Export Selected (",U.size,")"]}),e.jsxs("button",{onClick:()=>Tr(),className:"px-4 py-2 bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg border-2 border-transparent hover:border-orange-400 transition-all flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Delete Selected (",U.size,")"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{V("draft"),$("all"),n.success("Showing drafts needing approval")},className:"px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg border-2 border-transparent hover:border-orange-400 transition-all flex items-center gap-2",children:[e.jsx(vt,{className:"w-4 h-4"}),"Needs Action (",(a||[]).filter(t=>t.status==="draft").length,")"]}),e.jsxs("button",{onClick:()=>{V("sent"),$("unpaid"),n.success("Showing orders awaiting payment")},className:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg border-2 border-transparent hover:border-orange-400 transition-all flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"Awaiting Payment (",(a||[]).filter(t=>t.status==="sent"&&(t.paymentStatus==="unpaid"||!t.paymentStatus)).length,")"]}),e.jsxs("button",{onClick:()=>{V("sent"),$("paid"),n.success("Showing paid orders ready to receive")},className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg border-2 border-transparent hover:border-orange-400 transition-all flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Ready to Receive (",(a||[]).filter(t=>(t.status==="sent"||t.status==="shipped"||t.status==="confirmed"||t.status==="partial_received")&&t.paymentStatus==="paid").length,")"]}),e.jsxs("button",{onClick:()=>{const t=new Date,s=new Date(t.setDate(t.getDate()-t.getDay()));v(s.toISOString().split("T")[0]),I(new Date().toISOString().split("T")[0]),n.success("Showing this week's orders")},className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg border-2 border-transparent hover:border-orange-400 transition-all flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),"This Week"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0 max-w-lg",children:e.jsxs("div",{className:"relative",children:[e.jsx(Br,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search orders, suppliers, tracking...",value:O,onChange:t=>w(t.target.value),className:"w-full pl-10 pr-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all duration-200"})]})}),e.jsxs("select",{value:_,onChange:t=>V(t.target.value),className:"px-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-sm font-medium shadow-sm hover:shadow-md hover:border-orange-400 transition-all duration-200",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"partial_received",children:"Partial Received"}),e.jsx("option",{value:"received",children:"Received"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs("select",{value:W,onChange:t=>Y(t.target.value),className:"px-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-sm font-medium shadow-sm hover:shadow-md hover:border-orange-400 transition-all duration-200",children:[e.jsx("option",{value:"all",children:"All Currencies"}),(()=>Array.from(new Set((a||[]).map(s=>s.currency||"TZS"))).map(s=>e.jsx("option",{value:s,children:s},s)))()]}),e.jsxs("select",{value:G,onChange:t=>h(t.target.value),className:"px-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-sm font-medium shadow-sm hover:shadow-md hover:border-orange-400 transition-all duration-200",children:[e.jsx("option",{value:"createdAt",children:"Date Created"}),e.jsx("option",{value:"orderNumber",children:"Order Number"}),e.jsx("option",{value:"totalAmount",children:"Total Amount"}),e.jsx("option",{value:"expectedDelivery",children:"Expected Delivery"})]}),e.jsx("button",{onClick:()=>k(N==="asc"?"desc":"asc"),className:"p-2.5 border-2 border-gray-300 rounded-xl hover:bg-gray-50 hover:border-orange-400 text-sm transition-all duration-200 shadow-sm hover:shadow-md",title:`Sort ${N==="asc"?"descending":"ascending"}`,children:e.jsx(Hr,{className:`w-4 h-4 transition-transform duration-200 ${N==="desc"?"rotate-180":""}`})}),e.jsxs("button",{onClick:()=>ee(!Q),className:`px-4 py-2.5 border-2 rounded-xl hover:bg-gray-50 text-sm font-medium transition-all duration-200 shadow-sm hover:shadow-md ${Q?"bg-orange-50 border-orange-300 text-orange-700 hover:border-orange-400":"border-gray-300 hover:border-orange-400"}`,title:"Advanced filters",children:[e.jsx(qs,{className:"w-4 h-4 inline mr-2"}),"Advanced"]}),(O||_!=="all"||W!=="all"||y||F||A!=="all"||Z!=="all")&&e.jsxs("button",{onClick:gs,className:"px-4 py-2.5 border-2 border-red-300 bg-red-50 text-red-600 rounded-xl hover:bg-red-100 hover:border-red-400 text-sm font-medium flex items-center gap-2 transition-all duration-200 shadow-sm hover:shadow-md",title:"Clear all filters",children:[e.jsx(Us,{className:"w-4 h-4"}),"Clear"]})]}),Q&&e.jsxs("div",{className:"mb-4 p-4 bg-white rounded-xl border-2 border-gray-200 shadow-md",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[e.jsx(qs,{className:"w-4 h-4 text-orange-600"}),"Advanced Filters"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:y,onChange:t=>v(t.target.value),className:"w-full px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-sm transition-all duration-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:F,onChange:t=>I(t.target.value),className:"w-full px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-sm transition-all duration-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Supplier"}),e.jsxs("select",{value:A,onChange:t=>D(t.target.value),className:"w-full px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-sm transition-all duration-200",children:[e.jsx("option",{value:"all",children:"All Suppliers"}),(()=>Array.from(new Set((a||[]).map(s=>s.supplier).filter(Boolean))).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id)))()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Payment Status"}),e.jsxs("select",{value:Z,onChange:t=>$(t.target.value),className:"w-full px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-sm transition-all duration-200",children:[e.jsx("option",{value:"all",children:"All Payment Status"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"partial",children:"Partially Paid"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]})]})]}),Ee&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl border-2 border-purple-200 shadow-md",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5 text-purple-600"}),"Order Analytics"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Total Value (TZS)"}),e.jsx(Ue,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:re(q.reduce((t,s)=>t+(parseFloat(s.totalAmountBaseCurrency)||parseFloat(s.totalAmount)||0),0),"TZS")}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Avg: ",re(q.length>0?q.reduce((t,s)=>t+(parseFloat(s.totalAmountBaseCurrency)||parseFloat(s.totalAmount)||0),0)/q.length:0,"TZS")]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Active Orders"}),e.jsx(de,{className:"w-5 h-5 text-blue-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:q.filter(t=>!["received","cancelled","returned"].includes(t.status)).length}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Math.round(q.filter(t=>!["received","cancelled","returned"].includes(t.status)).length/Math.max(q.length,1)*100),"% of total"]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Suppliers"}),e.jsx(Kr,{className:"w-5 h-5 text-purple-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:new Set(q.map(t=>{var s;return(s=t.supplier)==null?void 0:s.id}).filter(Boolean)).size}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Unique suppliers"})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"In Transit"}),e.jsx(Wr,{className:"w-5 h-5 text-orange-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:q.filter(t=>["shipping","shipped","in_transit"].includes(t.status)).length}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Being shipped"})]})]})]})]}),S&&e.jsx("div",{className:"mx-6 mt-4 p-4 border border-red-200 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(vt,{className:"w-5 h-5"}),e.jsx("span",{children:S})]})}),e.jsx("div",{ref:Be,onScroll:er,className:"flex-1 overflow-y-auto p-6 max-h-[calc(100vh-32rem)] order-list-scroll",children:C?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(Ks,{size:"sm",color:"purple"})}):q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No orders found"}),e.jsx("p",{className:"text-gray-600",children:O||_!=="all"?"Try adjusting your search or filters":"No purchase orders available"})]}):e.jsxs(e.Fragment,{children:[js&&e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-gray-200",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:q.length>0&&U.size===q.length,onChange:xs,className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer",disabled:q.length===0,title:"Select all orders"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 select-none",children:U.size>0?`${U.size} order(s) selected`:`Select all ${q.length} order(s)`})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[U.size>0&&e.jsx("button",{onClick:()=>{oe(new Set),je(!1)},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Clear selection"}),e.jsx("button",{onClick:()=>{xe(!1),oe(new Set),je(!1)},className:"text-xs font-medium text-gray-500 hover:text-gray-700",children:"Hide checkboxes"})]})]}),e.jsx("div",{className:"space-y-3",children:us.map(t=>e.jsx(ya,{order:t,isSelectionMode:js,isSelected:U.has(t.id),onToggleSelect:()=>sr(t.id),onStatusUpdate:ps,onShippingUpdate:fs,onDelete:pr,isExpanded:E===t.id,onToggleExpanded:()=>z(E===t.id?null:t.id),isEditingShipping:B===t.id,onEditShipping:s=>m(B===s?null:s),formatCurrency:re,formatDate:Rt,getStatusColor:Vt,getStatusIcon:Bt,getStatusLabel:ys,getPaymentStatusColor:vs,getShippingStatusColor:Mr,handleViewOrder:fr,handleEditOrder:br,handleDuplicateOrder:yr,handlePrintOrder:vr,handlePayOrder:jr,handleViewReceipt:Nr,handleViewInvoice:Sr,handleReturnOrder:Cr,handleReviewOrder:kr,handleRestoreOrder:Pr,handleArchiveOrder:Ir,handleWhatsAppSupplier:_r,handleEmailSupplier:Ar,handleViewOrderDetails:It,handleViewPaymentHistory:$r,handleViewNotes:Er,handleViewCommunicationHistory:Rr,setActiveOrderId:p,setShowQualityCheckModal:De,handleApproveAndSend:ar,handleMakePaymentEnhanced:nr,handleReceiveOrder:or,handleCancelOrderEnhanced:hr,handleCompleteOrderEnhanced:xr,isApproving:ut,isDeleting:Ys,isReceiving:_t,isCancelling:Ws,isCompleting:ns,handleUndoLatestPayment:ir,reversingOrderId:At,registerCardRef:tr(t.id)},t.id))})]})})]})}),Le&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>Ze(!1)}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:"‚å®Ô∏è Keyboard Shortcuts"}),e.jsx("button",{onClick:()=>Ze(!1),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Refresh orders"}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono",children:"‚åò/Ctrl + R"})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Select all orders"}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono",children:"‚åò/Ctrl + A"})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Export to CSV"}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono",children:"‚åò/Ctrl + E"})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Toggle analytics"}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono",children:"‚åò/Ctrl + Shift + F"})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Clear all filters"}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono",children:"‚åò/Ctrl + K"})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Close modal/Clear selection"}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono",children:"Esc"})]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Show this help"}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono",children:"?"})]})]})]})]}),Gs&&Ie&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>{xt(!1),gt(null),Je(""),ht("")}}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-6",children:[e.jsx("button",{onClick:()=>{xt(!1),gt(null),Je(""),ht("")},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-10",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx($e,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Record Payment"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Order: ",(ws=a==null?void 0:a.find(t=>t.id===Ie))==null?void 0:ws.orderNumber]})]}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Amount"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:re(((Ns=a==null?void 0:a.find(t=>t.id===Ie))==null?void 0:Ns.totalAmount)||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Already Paid"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:re(((Ss=a==null?void 0:a.find(t=>t.id===Ie))==null?void 0:Ss.totalPaid)||0)})]}),e.jsxs("div",{className:"col-span-2 pt-3 border-t border-blue-300",children:[e.jsx("p",{className:"text-gray-600",children:"Remaining Balance"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:re((((Cs=a==null?void 0:a.find(t=>t.id===Ie))==null?void 0:Cs.totalAmount)||0)-(((ks=a==null?void 0:a.find(t=>t.id===Ie))==null?void 0:ks.totalPaid)||0))})]})]})}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Amount *"}),e.jsx("input",{type:"number",value:ds,onChange:t=>Je(t.target.value),placeholder:"Enter amount",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 text-lg font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Note (Optional)"}),e.jsx("textarea",{value:Lt,onChange:t=>ht(t.target.value),placeholder:"Add a note about this payment...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{xt(!1),gt(null),Je(""),ht("")},className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all",children:"Cancel"}),e.jsx("button",{onClick:wr,className:"flex-1 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all shadow-lg hover:shadow-xl",children:"Record Payment"})]})]})]}),c&&T()&&e.jsx(ma,{isOpen:ge,onClose:()=>{P(!1),p(null)},amount:(()=>{const t=T();return t?Math.max(0,(t.totalAmount||0)-(t.totalPaid||0)):0})(),customerId:(Ps=T())==null?void 0:Ps.supplierId,customerName:(As=(_s=T())==null?void 0:_s.supplier)==null?void 0:As.name,description:`Payment for PO ${($s=T())==null?void 0:$s.orderNumber}`,onPaymentComplete:lr,paymentType:"cash_out",title:"Purchase Order Payment",currency:(Es=T())==null?void 0:Es.currency,exchangeRate:(Rs=T())==null?void 0:Rs.exchangeRate}),c&&T()&&e.jsx(ia,{isOpen:he,onClose:()=>{le(!1),p(null)},purchaseOrder:T(),onReceiveFull:async()=>{dt("full"),le(!1),setTimeout(()=>Xe(!0),150)},onReceivePartial:async()=>{dt("partial"),le(!1),setTimeout(()=>pe(!0),150)}}),c&&T()&&e.jsx(ba,{isOpen:Re,onClose:()=>pe(!1),purchaseOrder:T(),onConfirm:cr,isLoading:_t,mode:"partial"}),c&&T()&&e.jsx(oa,{isOpen:Ct,onClose:()=>Xe(!1),purchaseOrder:T(),onConfirm:dr,isLoading:_t,mode:Qe,initialReceivedItems:se.length>0?se:void 0}),c&&T()&&e.jsx(ua,{isOpen:kt,onClose:()=>ze(!1),purchaseOrder:T(),onConfirm:mr,isLoading:_t,initialPricingData:mt.size>0?mt:void 0,selectedQuantities:se.length>0?new Map(se.map(t=>[t.id,t.receivedQuantity||0])):void 0}),c&&T()&&e.jsx(ca,{purchaseOrderId:c,isOpen:Pt,onClose:()=>{De(!1),p(null)},onComplete:async()=>{console.log("‚úÖ Quality check completed - proceeding to inventory addition"),De(!1);const t=T();if(!t||!o){console.error("‚ùå No active order or user found after quality check"),p(null);return}try{const{data:s,error:i}=await te.from("purchase_order_quality_checks").select("id").eq("purchase_order_id",t.id).order("created_at",{ascending:!1}).limit(1);if(i||!s||s.length===0){console.error("‚ùå No quality check found after completion:",i),n.error("Quality check completed but could not find record. Please try manual inventory addition."),p(null);return}const d=s[0].id;console.log("üìã Found latest quality check:",d);const{data:x,error:j}=await te.rpc("add_quality_items_to_inventory_v2",{p_quality_check_id:d,p_purchase_order_id:t.id,p_user_id:o.id,p_profit_margin_percentage:30,p_default_location:null});if(j){console.error("‚ùå RPC Error adding to inventory:",j),n.error("Failed to add items to inventory via quality check"),p(null);return}const b=x;b&&b.success?(console.log("‚úÖ Items added to inventory via quality check:",b),n.success(b.message||`Successfully added ${b.items_added} items to inventory`),Oe([]),Ve(new Map),p(null),await g()):(console.error("‚ùå Failed to add to inventory via quality check:",b==null?void 0:b.message),n.error((b==null?void 0:b.message)||"Failed to add items to inventory"),p(null))}catch(s){console.error("‚ùå Error in quality check inventory addition:",s),n.error("Error adding items to inventory after quality check"),p(null)}}}),nt&&c&&T()&&e.jsx(va,{order:T(),activeTab:lt,onTabChange:it,onClose:()=>{wt(!1),p(null)},formatCurrency:re,formatDate:Rt,getStatusColor:Vt,getStatusIcon:Bt,getStatusLabel:ys,getPaymentStatusColor:vs}),Ye&&c&&T()&&e.jsx(ja,{order:T(),onClose:()=>{ot(!1),p(null)},formatCurrency:re}),qt&&c&&T()&&e.jsx(wa,{order:T(),onClose:()=>{Nt(!1),p(null)},onNoteAdded:g}),St&&c&&T()&&e.jsx(Na,{order:T(),onClose:()=>{ct(!1),p(null)}}),Ut&&c&&T()&&e.jsx(Sa,{order:T(),onClose:()=>{Ge(!1),p(null)},onConfirm:gr,isCompleting:ns,formatCurrency:re,formatDate:Rt}),Xs&&$t&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[80] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl overflow-hidden relative",children:[fe==="confirming"&&e.jsx("button",{onClick:()=>{Fe(!1),pt(null),Ne("confirming")},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:`p-8 text-center transition-all duration-500 ${fe==="success"?"bg-gradient-to-br from-green-100 to-emerald-100":"bg-gradient-to-br from-green-50 to-emerald-50"}`,children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg transition-all duration-500 ${fe==="success"?"bg-green-500 scale-110":fe==="processing"?"bg-blue-500":"bg-green-600"}`,children:fe==="success"?e.jsx(Yr,{className:"w-10 h-10 text-white"}):fe==="processing"?e.jsx("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(de,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:fe==="success"?"Successfully Added!":fe==="processing"?"Adding to Inventory...":$t.title})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-center text-gray-600 leading-relaxed",children:fe==="success"?"Items have been successfully added to inventory.":fe==="processing"?"Please wait while we add items to inventory...":$t.message})}),fe==="confirming"&&e.jsx("div",{className:"p-6 pt-0",children:e.jsx("button",{onClick:()=>{$t.onConfirm()},className:"w-full px-6 py-3.5 bg-green-600 hover:bg-green-700 text-white rounded-xl transition-all font-semibold shadow-lg hover:shadow-xl text-lg",children:"Confirm & Add"})}),fe==="success"&&e.jsx("div",{className:"p-6 pt-0",children:e.jsx("button",{onClick:()=>{Fe(!1),pt(null),Ne("confirming")},className:"w-full px-6 py-3 text-gray-600 hover:text-gray-900 font-medium transition-colors",children:"Close"})})]})})]}),document.body):null},ya=({order:r,isSelected:u,isSelectionMode:o,onToggleSelect:f,onStatusUpdate:a,onShippingUpdate:C,onDelete:S,isExpanded:g,onToggleExpanded:M,isEditingShipping:K,onEditShipping:X,formatCurrency:L,formatDate:O,getStatusColor:w,getStatusIcon:_,getStatusLabel:V,getPaymentStatusColor:W,getShippingStatusColor:Y,handleViewOrder:G,handleEditOrder:h,handleDuplicateOrder:N,handlePrintOrder:k,handlePayOrder:E,handleViewReceipt:z,handleViewInvoice:B,handleReturnOrder:m,handleReviewOrder:y,handleRestoreOrder:v,handleArchiveOrder:F,handleWhatsAppSupplier:I,handleEmailSupplier:A,handleViewOrderDetails:D,handleViewPaymentHistory:Z,handleViewNotes:$,handleViewCommunicationHistory:Q,setActiveOrderId:ee,setShowQualityCheckModal:ie,handleApproveAndSend:ne,handleMakePaymentEnhanced:ue,handleReceiveOrder:ke,handleCancelOrderEnhanced:U,handleCompleteOrderEnhanced:oe,isApproving:ts,isDeleting:je,isReceiving:we,isCancelling:xe,isCompleting:Ee,handleUndoLatestPayment:jt,reversingOrderId:nt,registerCardRef:wt})=>{var Ge,Le,Ze,ce;l.useState({trackingNumber:r.trackingNumber||"",estimatedDelivery:r.estimatedDelivery||"",shippingNotes:r.shippingNotes||"",shippingStatus:r.shippingStatus||"pending"});const[lt,it]=l.useState(!0);l.useEffect(()=>{g&&it(!0)},[g,r.id]);const qt=c=>{switch(c){case"draft":return["sent","cancelled"];case"sent":return["confirmed","shipped","cancelled"];case"confirmed":return["shipped","cancelled"];case"shipped":return[];case"partial_received":return[];case"received":return["completed"];case"completed":return[];case"cancelled":return["draft"];default:return["sent"]}},Nt=c=>{const p=[],ge=c.status,P=c.paymentStatus||"unpaid",he=Number(c.totalPaid)||0,le=Number(c.paymentsCount||0);switch(console.log(`üîç Processing order ${c.orderNumber}: status=${ge}, paymentStatus=${P}, totalPaid=${he}, paymentsCount=${le}`),["draft","sent","confirmed","shipped"].includes(ge)&&p.push({type:"edit",label:"Edit Order",icon:e.jsx(sa,{className:"w-4 h-4"}),color:"bg-purple-600 hover:bg-purple-700",onClick:()=>h(c.id)}),p.push({type:"view",label:"View Details",icon:e.jsx(ra,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>D(c.id)}),ge){case"draft":p.push({type:"approve",label:"Approve & Send",icon:e.jsx(Te,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",disabled:ts,onClick:()=>ne(c.id)}),p.push({type:"duplicate",label:"Duplicate",icon:e.jsx(tt,{className:"w-4 h-4"}),color:"bg-indigo-600 hover:bg-indigo-700",onClick:()=>N(c.id)}),p.push({type:"print",label:"Print",icon:e.jsx(We,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>k(c.id)}),p.push({type:"delete",label:"Delete",icon:e.jsx(Qs,{className:"w-4 h-4"}),color:"bg-red-600 hover:bg-red-700",disabled:je,onClick:()=>S(c.id)});break;case"sent":case"shipped":case"confirmed":P!=="paid"?(p.push({type:"pay",label:"Make Payment",icon:e.jsx($e,{className:"w-4 h-4"}),color:"bg-orange-600 hover:bg-orange-700",onClick:()=>ue(c.id)}),p.push({type:"print",label:"Print",icon:e.jsx(We,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>k(c.id)})):(p.push({type:"receive",label:"Receive Items",icon:e.jsx(de,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",disabled:we,onClick:()=>ke(c.id)}),p.push({type:"print",label:"Print",icon:e.jsx(We,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>k(c.id)})),p.push({type:"duplicate",label:"Duplicate",icon:e.jsx(tt,{className:"w-4 h-4"}),color:"bg-indigo-600 hover:bg-indigo-700",onClick:()=>N(c.id)}),p.push({type:"return",label:"Return",icon:e.jsx(na,{className:"w-4 h-4"}),color:"bg-red-600 hover:bg-red-700",onClick:()=>m(c.id)}),console.debug("[OrderCard] Adding Cancel button to actions",{orderNumber:c.orderNumber,orderId:c.id,status:c.status,isCancelling:xe,hasHandler:typeof U=="function"}),p.push({type:"cancel",label:"Cancel",icon:e.jsx(la,{className:"w-4 h-4"}),color:"bg-red-600 hover:bg-red-700",disabled:xe,onClick:()=>{console.debug("[OrderCard] Cancel button onClick wrapper called",{orderNumber:c.orderNumber,orderId:c.id}),U(c.id)}});break;case"partial_received":p.push({type:"continue_receive",label:"Continue Receiving",icon:e.jsx(de,{className:"w-4 h-4"}),color:"bg-yellow-500 hover:bg-yellow-600",disabled:we,onClick:()=>ke(c.id)}),p.push({type:"quality",label:"Quality Check",icon:e.jsx(Me,{className:"w-4 h-4"}),color:"bg-purple-600 hover:bg-purple-700",onClick:()=>{ee(c.id),ie(!0)}}),p.push({type:"duplicate",label:"Duplicate",icon:e.jsx(tt,{className:"w-4 h-4"}),color:"bg-indigo-600 hover:bg-indigo-700",onClick:()=>N(c.id)}),p.push({type:"print",label:"Print",icon:e.jsx(We,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>k(c.id)});break;case"received":p.push({type:"complete",label:"Complete Order",icon:e.jsx(Te,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",disabled:Ee||P!=="paid",onClick:()=>oe(c.id)}),p.push({type:"quality",label:"Quality Check",icon:e.jsx(Me,{className:"w-4 h-4"}),color:"bg-purple-600 hover:bg-purple-700",onClick:()=>{ee(c.id),ie(!0)}}),p.push({type:"duplicate",label:"Duplicate",icon:e.jsx(tt,{className:"w-4 h-4"}),color:"bg-indigo-600 hover:bg-indigo-700",onClick:()=>N(c.id)}),p.push({type:"print",label:"Print",icon:e.jsx(We,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>k(c.id)});break;case"completed":p.push({type:"print",label:"Print",icon:e.jsx(We,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>k(c.id)}),p.push({type:"duplicate",label:"Duplicate",icon:e.jsx(tt,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>N(c.id)});break;case"cancelled":p.push({type:"restore",label:"Restore",icon:e.jsx(Kt,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:()=>v(c.id)}),p.push({type:"duplicate",label:"Duplicate",icon:e.jsx(tt,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>N(c.id)}),p.push({type:"archive",label:"Archive",icon:e.jsx(aa,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>F(c.id)});break}return console.log(`üîç Order ${c.orderNumber}: totalPaid = ${he}, paymentsCount = ${le}, type = ${typeof he}`),he>0||le>0?(console.log(`‚úÖ Adding Undo Payment button for ${c.orderNumber} (totalPaid: ${he}, paymentsCount: ${le})`),p.push({type:"undo_payment",label:nt===c.id?"Undoing...":"Undo Payment",icon:e.jsx(Kt,{className:`w-4 h-4 ${nt===c.id?"animate-spin":""}`}),color:"bg-red-600 hover:bg-red-700",disabled:nt===c.id,onClick:()=>jt(c.id)})):console.log(`‚ùå Skipping Undo Payment button for ${c.orderNumber} (totalPaid: ${he}, paymentsCount: ${le})`),console.log(`üìã Final actions for ${c.orderNumber}:`,p.map(Re=>Re.type)),p};qt(r.status);const Ye=Nt(r),ot=r.status==="completed",St=r.status==="draft",ct=((Ge=r.items)==null?void 0:Ge.length)||0,Ut=(r.items||[]).reduce((c,p)=>c+(p.quantity||0),0);return e.jsxs("div",{ref:wt,className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 ${g?"border-blue-500 shadow-xl":ot?"border-green-200 hover:border-green-300 hover:shadow-md":St?"border-orange-300 hover:border-orange-400 hover:shadow-md":"border-gray-200 hover:border-orange-400 hover:shadow-md"} ${u?"ring-2 ring-offset-2 ring-blue-400":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between p-6 cursor-pointer",onClick:M,children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[o&&e.jsx("input",{type:"checkbox",checked:u,onChange:c=>{c.stopPropagation(),f()},onClick:c=>c.stopPropagation(),className:"mt-1 w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer flex-shrink-0",title:"Select this order"}),e.jsx("div",{className:`w-7 h-7 rounded-lg flex items-center justify-center transition-all flex-shrink-0 ${g?"bg-orange-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-600"}`,children:e.jsx(Yt,{className:`w-5 h-5 transition-transform duration-200 ${g?"rotate-180":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 truncate",children:r.orderNumber}),ot?e.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-base font-bold bg-green-500 text-white shadow-sm flex-shrink-0",children:[e.jsx(Te,{className:"w-5 h-5"}),"Complete"]}):St?e.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-base font-bold bg-orange-500 text-white shadow-sm animate-pulse flex-shrink-0",children:[e.jsx(at,{className:"w-5 h-5"}),"Action Needed"]}):e.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-base font-bold ${w(r.status)} flex items-center gap-2 flex-shrink-0`,children:[_(r.status),e.jsx("span",{children:V(r.status)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-50 text-blue-700 border border-blue-200 flex-shrink-0",children:[e.jsx(Vs,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base font-semibold truncate max-w-[140px]",children:((Le=r.supplier)==null?void 0:Le.name)||"Unknown Supplier"})]}),e.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 rounded-lg bg-gray-50 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-teal-600"}),e.jsx("span",{className:"text-base font-semibold text-teal-700",children:ct}),e.jsx("span",{className:"text-sm text-teal-600 font-medium",children:ct!==1?"items":"item"})]}),e.jsx("div",{className:"w-px h-5 bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-5 h-5 text-pink-600"}),e.jsx("span",{className:"text-base font-semibold text-pink-700",children:Ut}),e.jsx("span",{className:"text-sm text-pink-600 font-medium",children:"qty"})]}),e.jsx("div",{className:"w-px h-5 bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-base font-medium text-gray-600",children:O(r.createdAt)})]})]})]})]})]}),(r.totalAmount||0)>0&&e.jsx("div",{className:"ml-4 flex-shrink-0",children:g?e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ue,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500 font-medium uppercase tracking-wide",children:"Total Amount"})]}),e.jsx("div",{className:"flex flex-col",children:r.currency&&r.currency!=="TZS"&&r.totalAmountBaseCurrency?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-4xl font-bold text-gray-900 leading-tight",children:L(r.totalAmountBaseCurrency,"TZS")}),e.jsxs("span",{className:"text-sm text-gray-500 mt-0.5 font-medium",children:["(",L(r.totalAmount||0,r.currency),")"]})]}):e.jsx("span",{className:"text-4xl font-bold text-gray-900 leading-tight",children:L(r.totalAmount||0,r.currency||"TZS")})})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-5 py-3 rounded-xl text-base font-bold shadow-sm ${(r.totalPaid||0)>=r.totalAmount?"bg-green-500 text-white":(r.totalPaid||0)>0?"bg-yellow-500 text-white":"bg-red-500 text-white"}`,children:[(r.totalPaid||0)>=r.totalAmount?e.jsx(Gt,{className:"w-5 h-5"}):(r.totalPaid||0)>0?e.jsx(at,{className:"w-5 h-5"}):e.jsx(vt,{className:"w-5 h-5"}),(r.totalPaid||0)>=r.totalAmount?"Paid":(r.totalPaid||0)>0?"Partial":"Unpaid"]})})]}):e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ue,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500 font-medium uppercase tracking-wide",children:"Total Amount"})]}),e.jsx("div",{className:"flex flex-col",children:r.currency&&r.currency!=="TZS"&&r.totalAmountBaseCurrency?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-4xl font-bold text-gray-900 leading-tight",children:L(r.totalAmountBaseCurrency,"TZS")}),e.jsxs("span",{className:"text-sm text-gray-500 mt-0.5 font-medium",children:["(",L(r.totalAmount||0,r.currency),")"]})]}):e.jsx("span",{className:"text-4xl font-bold text-gray-900 leading-tight",children:L(r.totalAmount||0,r.currency||"TZS")})})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-5 py-3 rounded-xl text-base font-bold shadow-sm ${(r.totalPaid||0)>=r.totalAmount?"bg-green-500 text-white":(r.totalPaid||0)>0?"bg-yellow-500 text-white":"bg-red-500 text-white"}`,children:[(r.totalPaid||0)>=r.totalAmount?e.jsx(Gt,{className:"w-5 h-5"}):(r.totalPaid||0)>0?e.jsx(at,{className:"w-5 h-5"}):e.jsx(vt,{className:"w-5 h-5"}),(r.totalPaid||0)>=r.totalAmount?"Paid":(r.totalPaid||0)>0?"Partial":"Unpaid"]})})]})})]}),g&&e.jsx("div",{className:"mt-5 pt-5 border-t-2 border-gray-200 relative",children:e.jsx("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-center -mt-3",children:e.jsx("span",{className:"bg-white px-5 py-1.5 text-xs text-gray-500 font-semibold uppercase tracking-wider rounded-full border border-gray-200 shadow-sm",children:"Order Details"})})}),g&&e.jsxs("div",{className:"px-6 pb-6 pt-2 order-expanded-scroll",children:[e.jsx("div",{className:"mb-4",children:(()=>{const p=r.items.length>2,ge=lt&&p?r.items.slice(0,2):r.items;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-blue-600"}),"Order Items (",r.items.length,")"]}),p&&e.jsx("button",{type:"button",onClick:P=>{P.stopPropagation(),it(he=>!he)},className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-blue-600 hover:text-blue-700 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:lt?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"w-4 h-4"}),"View More"]}):e.jsxs(e.Fragment,{children:[e.jsx(Gr,{className:"w-4 h-4"}),"View Less"]})})]}),ge.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:ge.map((P,he)=>{var Ct,Xe,kt,ze,Pt;const le=P.receivedQuantity||0,Re=P.quantity||0,pe=Re>0?le/Re*100:0;return e.jsxs("div",{className:"p-3 sm:p-4 md:p-6 cursor-pointer flex flex-col h-full bg-white rounded-xl border border-gray-200 hover:border-blue-400 hover:shadow-md transition-all duration-200 shadow-sm relative",children:[e.jsx("div",{className:`absolute -top-2 -right-2 sm:-top-3 sm:-right-3 p-1.5 sm:p-2 rounded-full border-2 border-white shadow-lg flex items-center justify-center z-20 min-w-[2rem] min-h-[2rem] sm:min-w-[2.5rem] sm:min-h-[2.5rem] transition-all duration-300 ${pe>=100?"bg-gradient-to-r from-green-500 to-green-600":pe>0?"bg-gradient-to-r from-orange-500 to-orange-600":"bg-gradient-to-r from-red-500 to-red-600"}`,children:e.jsx("span",{className:"text-xs sm:text-sm font-bold text-white whitespace-nowrap px-1",children:le>0?`${le}/${Re}`:Re})}),e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"relative w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 rounded-xl flex items-center justify-center flex-shrink-0",children:(()=>{var dt,se,Oe,mt,Ve;const De=((se=(dt=P.product)==null?void 0:dt.images)==null?void 0:se.find(ut=>ut.isPrimary))||((mt=(Oe=P.product)==null?void 0:Oe.images)==null?void 0:mt[0]),Qe=De==null?void 0:De.url;return Qe?e.jsx("img",{src:Qe,alt:((Ve=P.product)==null?void 0:Ve.name)||"Product",className:"w-full h-full object-cover rounded-xl",onError:ut=>{ut.target.style.display="none"}}):e.jsx("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg flex items-center justify-center w-full h-full rounded-xl",children:e.jsx(de,{className:"w-10 h-10 sm:w-12 sm:h-12 text-gray-400"})})})()}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-16 sm:h-20 md:h-24 justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800 truncate text-sm sm:text-base md:text-lg lg:text-xl leading-tight",title:((Ct=P.product)==null?void 0:Ct.name)||`Product ${P.productId}`,children:((Xe=P.product)==null?void 0:Xe.name)||`Product ${P.productId}`}),((kt=P.variant)==null?void 0:kt.name)&&P.variant.name!=="Default Variant"&&e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5 sm:mt-1 font-medium",children:["Variant: ",P.variant.name]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg sm:text-xl md:text-2xl text-gray-700 mt-0.5 sm:mt-1 font-bold",children:r.currency&&r.currency!=="TZS"&&r.exchangeRate?e.jsxs(e.Fragment,{children:[L((P.totalPrice||(P.quantity||0)*(P.costPrice||0))*(r.exchangeRate||1),"TZS"),r.currency&&r.currency!=="TZS"&&e.jsxs("span",{className:"text-sm sm:text-base text-gray-500 ml-2",children:["(",L(P.totalPrice||(P.quantity||0)*(P.costPrice||0),r.currency),")"]})]}):L(P.totalPrice||(P.quantity||0)*(P.costPrice||0),"TZS")}),e.jsxs("div",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:["Unit: ",L(P.costPrice||0,"TZS")]})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-4",children:(r.status==="partial_received"||r.status==="received"||r.status==="completed")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-700",children:["Received: ",e.jsxs("span",{className:"text-gray-900",children:[le,"/",Re]})]}),e.jsxs("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full ${pe>=100?"bg-green-100 text-green-900":pe>0?"bg-orange-100 text-orange-900":"bg-gray-100 text-gray-900"}`,children:[pe.toFixed(0),"%"]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:((ze=P.product)==null?void 0:ze.category)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium",children:["üì¶ ",String(typeof P.product.category=="string"?P.product.category:((Pt=P.product.category)==null?void 0:Pt.name)||"Category")]})})]}),(r.status==="partial_received"||r.status==="received"||r.status==="completed")&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2 overflow-hidden shadow-inner",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${pe>=100?"bg-gradient-to-r from-green-500 to-emerald-500":pe>0?"bg-gradient-to-r from-orange-400 to-orange-500":"bg-gray-300"}`,style:{width:`${Math.min(pe,100)}%`}})})})]},he)})}):e.jsx("div",{className:"rounded-xl border border-dashed border-gray-200 bg-gray-50 py-10 text-center text-sm text-gray-500",children:"No items found for this order."}),lt&&p&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Showing first ",2," items of ",r.items.length,". Tap View More to see all."]})]})})()}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-2",children:[((Ze=r.supplier)==null?void 0:Ze.phone)&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),I(r)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 rounded-lg transition-all text-sm font-medium",title:"Message on WhatsApp",children:[e.jsx(Xt,{className:"w-4 h-4"}),"WhatsApp"]}),((ce=r.supplier)==null?void 0:ce.email)&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),A(r)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-all text-sm font-medium",title:"Send email",children:[e.jsx(Xr,{className:"w-4 h-4"}),"Email"]}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),$(r.id)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-yellow-50 hover:bg-yellow-100 text-yellow-700 border border-yellow-200 rounded-lg transition-all text-sm font-medium",title:"View notes",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Notes"]}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),Z(r.id)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 border border-purple-200 rounded-lg transition-all text-sm font-medium",title:"Payment history",children:[e.jsx($e,{className:"w-4 h-4"}),"Payments"]})]}),e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-gray-200",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:Ye.slice(0,4).map((c,p)=>(console.debug("[OrderCard] Rendering primary action button",{orderNumber:r.orderNumber,actionType:c.type,label:c.label,disabled:c.disabled}),e.jsxs("button",{onClick:ge=>{if(ge.stopPropagation(),console.debug("[OrderCard] Primary action button clicked",{orderNumber:r.orderNumber,actionType:c.type,label:c.label,disabled:c.disabled,hasOnClick:typeof c.onClick=="function"}),c.disabled){console.warn("[OrderCard] Action button is disabled",{orderNumber:r.orderNumber,actionType:c.type});return}try{console.debug("[OrderCard] Calling action.onClick()",{orderNumber:r.orderNumber,actionType:c.type}),c.onClick()}catch(P){console.error("[OrderCard] Error executing action",{orderNumber:r.orderNumber,actionType:c.type,error:P}),n.error(`Failed to execute ${c.label}: ${P instanceof Error?P.message:"Unknown error"}`)}},disabled:c.disabled,className:`flex items-center justify-center gap-2 px-4 py-3 text-white rounded-xl transition-all hover:scale-105 hover:shadow-lg font-semibold text-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 ${c.color}`,children:[c.icon,c.label]},`${c.type}-${p}`)))}),Ye.length>4?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Ye.slice(4).map((c,p)=>(console.debug("[OrderCard] Rendering secondary action button",{orderNumber:r.orderNumber,actionType:c.type,label:c.label,disabled:c.disabled,index:p+4,totalActions:Ye.length}),e.jsxs("button",{onClick:ge=>{if(ge.stopPropagation(),console.debug("[OrderCard] Secondary action button clicked",{orderNumber:r.orderNumber,actionType:c.type,label:c.label,disabled:c.disabled,hasOnClick:typeof c.onClick=="function",index:p+4}),c.disabled){console.warn("[OrderCard] Secondary action button is disabled",{orderNumber:r.orderNumber,actionType:c.type});return}try{console.debug("[OrderCard] Calling secondary action.onClick()",{orderNumber:r.orderNumber,actionType:c.type}),c.onClick()}catch(P){console.error("[OrderCard] Error executing secondary action",{orderNumber:r.orderNumber,actionType:c.type,error:P}),n.error(`Failed to execute ${c.label}: ${P instanceof Error?P.message:"Unknown error"}`)}},disabled:c.disabled,className:`flex items-center justify-center gap-2 px-4 py-2.5 text-white rounded-xl transition-all hover:scale-105 hover:shadow-lg font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 ${c.color}`,children:[c.icon,c.label]},`${c.type}-${p+4}`)))}):null]})]})]})},va=({order:r,activeTab:u,onTabChange:o,onClose:f,formatCurrency:a,formatDate:C,getStatusColor:S,getStatusIcon:g,getStatusLabel:M,getPaymentStatusColor:K})=>{var G;const[X,L]=l.useState([]),[O,w]=l.useState([]),[_,V]=l.useState([]),[W,Y]=l.useState(!1);return l.useEffect(()=>{u!=="overview"&&(async()=>{Y(!0);try{if(u==="payments"){const N=await ve.getPayments(r.id);L(N||[])}else if(u==="history"){const N=await ve.getAuditHistory(r.id);w(N||[])}else if(u==="items"){const N=await ve.getReceivedItems(r.id);N.success&&V(N.data||[])}}catch(N){console.error("Error loading tab data:",N)}finally{Y(!1)}})()},[u,r.id]),e.jsx("div",{className:"fixed inset-0 z-[100000] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:f,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ce,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:r.orderNumber}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-semibold bg-orange-50 text-orange-700 border border-orange-200",children:((G=r.supplier)==null?void 0:G.name)||"Unknown Supplier"}),e.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(Ot,{className:"w-4 h-4"}),C(r.createdAt)]}),e.jsxs("span",{className:`px-3 py-1.5 rounded-lg text-sm font-bold ${S(r.status)} flex items-center gap-1.5`,children:[g(r.status),e.jsx("span",{children:M(r.status)})]})]})]})]})}),e.jsx("div",{className:"flex border-b bg-gray-50",children:[{key:"overview",label:"Overview",icon:e.jsx(Bs,{className:"w-4 h-4"})},{key:"items",label:"Items",icon:e.jsx(de,{className:"w-4 h-4"})},{key:"payments",label:"Payments",icon:e.jsx($e,{className:"w-4 h-4"})},{key:"history",label:"History",icon:e.jsx(Ht,{className:"w-4 h-4"})}].map(h=>e.jsxs("button",{onClick:()=>o(h.key),className:`flex-1 flex items-center justify-center gap-2 px-6 py-4 font-medium transition-all ${u===h.key?"text-orange-600 border-b-2 border-orange-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[h.icon,h.label]},h.key))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:W?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[u==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-orange-600"}),"Order Information"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Order Number:"}),e.jsx("span",{className:"font-semibold font-mono",children:r.orderNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsxs("span",{className:`px-4 py-2 rounded-full text-base font-bold ${S(r.status)} flex items-center gap-1.5`,children:[g(r.status),e.jsx("span",{children:M(r.status)})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Created:"}),e.jsx("span",{className:"font-medium",children:C(r.createdAt)})]}),r.receivedDate&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Received:"}),e.jsx("span",{className:"font-medium text-orange-600",children:C(r.receivedDate)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expected Delivery:"}),e.jsx("span",{className:"font-medium",children:r.expectedDeliveryDate?C(r.expectedDeliveryDate):"Not set"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Currency:"}),e.jsx("span",{className:"font-semibold",children:r.currency||"TZS"})]}),r.paymentTerms&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Terms:"}),e.jsx("span",{className:"font-medium",children:r.paymentTerms})]})]}),r.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"Notes:"}),e.jsx("div",{className:"text-sm text-gray-700 bg-gray-50 rounded-lg p-3 border border-gray-200",children:r.notes})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Vs,{className:"w-5 h-5 text-green-600"}),"Supplier Details"]}),r.supplier?e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Company:"}),e.jsx("span",{className:"font-semibold",children:r.supplier.name})]}),r.supplier.contactPerson&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Contact:"}),e.jsx("span",{className:"font-medium",children:r.supplier.contactPerson})]}),r.supplier.phone&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsx("span",{className:"font-medium text-green-600",children:r.supplier.phone})]}),r.supplier.email&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Email:"}),e.jsx("span",{className:"font-medium text-green-600 break-all",children:r.supplier.email})]})]}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No supplier information"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-green-600"}),"Financial Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Total Amount:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:a(r.totalAmount,r.currency||"TZS")}),r.currency&&r.currency!=="TZS"&&r.totalAmountBaseCurrency&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["‚âà ",a(r.totalAmountBaseCurrency)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Paid:"}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:a(r.totalPaid||0,r.currency||"TZS")})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm pt-3 border-t border-green-200",children:[e.jsx("span",{className:"text-gray-700",children:"Balance:"}),e.jsx("span",{className:`text-xl font-bold ${r.totalAmount-(r.totalPaid||0)>0?"text-red-600":"text-green-600"}`,children:a(r.totalAmount-(r.totalPaid||0),r.currency||"TZS")})]}),r.currency&&r.currency!=="TZS"&&r.exchangeRate&&e.jsxs("div",{className:"pt-3 border-t border-green-200",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Exchange Rate:"}),e.jsxs("span",{className:"font-semibold",children:["1 ",r.currency," = ",r.exchangeRate.toLocaleString()," ",r.baseCurrency||"TZS"]})]}),r.exchangeRateSource&&e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:["Source: ",r.exchangeRateSource]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Payment Status:"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${(r.paymentStatus||"unpaid")==="paid"?"text-green-600 bg-green-100":(r.paymentStatus||"unpaid")==="partial"?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100"}`,children:(r.paymentStatus||"unpaid").toUpperCase()})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-green-600"}),"Items Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:r.items.length}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Total Items"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:r.items.reduce((h,N)=>h+(N.quantity||0),0)}),e.jsx("div",{className:"text-xs text-orange-700 mt-1",children:"Total Quantity"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg col-span-2",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:r.items.reduce((h,N)=>h+(N.receivedQuantity||0),0)}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Received Quantity"})]})]})]})]})]}),u==="items"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(de,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Ordered Items"}),e.jsxs("span",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-bold border border-orange-200",children:[r.items.length," items"]})]}),e.jsx("div",{className:"space-y-4",children:r.items.map((h,N)=>{var B,m,y;const k=h.receivedQuantity||0,E=h.quantity||0,z=E>0?k/E*100:0;return e.jsxs("div",{className:"border-2 border-gray-200 rounded-xl p-5 hover:border-orange-300 hover:shadow-md transition-all bg-white",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-100 to-amber-100 rounded-lg flex items-center justify-center border-2 border-orange-200",children:e.jsx(de,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-lg text-gray-900",children:((B=h.product)==null?void 0:B.name)||`Product ${h.productId}`}),((m=h.variant)==null?void 0:m.name)&&h.variant.name!=="Default Variant"&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Variant: ",h.variant.name]}),((y=h.product)==null?void 0:y.sku)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["SKU: ",h.product.sku]})]})]})}),e.jsxs("div",{className:`px-4 py-2 rounded-lg font-bold text-sm shadow-sm ${z>=100?"bg-orange-100 text-orange-700 border-2 border-orange-300":z>0?"bg-amber-100 text-amber-700 border-2 border-amber-300":"bg-gray-100 text-gray-600 border-2 border-gray-300"}`,children:[z.toFixed(0),"% Complete"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-600 mb-1.5 flex items-center gap-1",children:[e.jsx(es,{className:"w-3.5 h-3.5"}),"Ordered"]}),e.jsx("div",{className:"text-xl font-extrabold text-gray-900",children:E})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-600 mb-1.5 flex items-center gap-1",children:[e.jsx(Gt,{className:"w-3.5 h-3.5"}),"Received"]}),e.jsx("div",{className:`text-xl font-extrabold ${z>=100?"text-orange-600":z>0?"text-amber-600":"text-gray-400"}`,children:k})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-600 mb-1.5 flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3.5 h-3.5"}),"Unit Price"]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:a(h.costPrice)})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3 border-2 border-orange-200",children:[e.jsxs("div",{className:"text-xs font-medium text-orange-700 mb-1.5 flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3.5 h-3.5"}),"Total"]}),e.jsx("div",{className:"text-lg font-extrabold text-orange-600",children:a(h.totalPrice||E*h.costPrice)})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Progress"}),e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:[z.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden shadow-inner",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${z>=100?"bg-gradient-to-r from-orange-500 to-amber-500":z>0?"bg-gradient-to-r from-amber-400 to-amber-500":"bg-gray-300"}`,style:{width:`${Math.min(z,100)}%`}})})]})]},N)})})]}),_.length>0&&e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(Me,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Received Inventory Items"}),e.jsx("span",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-bold border border-orange-200",children:_.length})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:_.map((h,N)=>{var k;return e.jsxs("div",{className:"border-2 border-gray-200 rounded-xl p-4 bg-gradient-to-br from-orange-50 to-white hover:border-orange-300 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-100 to-amber-100 rounded-lg flex items-center justify-center border-2 border-orange-200 flex-shrink-0",children:e.jsx(Me,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:(k=h.product)==null?void 0:k.name}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[h.serial_number&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-medium",children:"Serial:"}),e.jsx("span",{className:"font-mono",children:h.serial_number})]}),h.imei&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-medium",children:"IMEI:"}),e.jsx("span",{className:"font-mono",children:h.imei})]}),h.location&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(zs,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:h.location})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-600 mb-1 flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3.5 h-3.5"}),"Selling Price"]}),e.jsx("div",{className:"text-lg font-extrabold text-orange-600",children:h.selling_price?a(h.selling_price):"Not set"})]}),e.jsx("span",{className:`px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm ${h.status==="available"?"bg-orange-100 text-orange-700 border-2 border-orange-300":h.status==="sold"?"bg-blue-100 text-blue-700 border-2 border-blue-300":"bg-gray-100 text-gray-700 border-2 border-gray-300"}`,children:h.status})]})]},N)})})]})]}),u==="payments"&&e.jsx("div",{className:"space-y-4",children:X.length>0?X.map((h,N)=>{var k;return e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 via-amber-50 to-orange-50 border-2 border-orange-200 rounded-xl p-6 shadow-lg hover:shadow-xl transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-orange-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx($e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-xl text-gray-900 mb-1",children:((k=h.method)==null?void 0:k.replace("_"," ").toUpperCase())||"Payment"}),h.reference&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Ref:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-1 rounded border border-gray-200",children:h.reference})]}),h.timestamp&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(h.timestamp).toLocaleString()})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-extrabold text-orange-600 mb-2",children:a(h.amount)}),e.jsx("span",{className:"px-4 py-2 rounded-lg text-xs font-bold bg-orange-600 text-white shadow-sm",children:h.status||"completed"})]})]}),h.notes&&e.jsx("div",{className:"mt-4 pt-4 border-t border-orange-200 bg-white rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:h.notes})]})})]},N)}):e.jsxs("div",{className:"text-center py-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx($e,{className:"w-10 h-10 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 font-medium text-lg",children:"No payments recorded yet"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Payments will appear here once recorded"})]})}),u==="history"&&e.jsx("div",{className:"space-y-4",children:O.length>0?O.map((h,N)=>e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md hover:border-orange-300 transition-all",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:e.jsx(Ht,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-bold text-lg text-gray-900",children:h.action}),e.jsxs("span",{className:"text-xs text-gray-500 font-medium bg-gray-100 px-3 py-1.5 rounded-lg flex items-center gap-1.5 flex-shrink-0",children:[e.jsx(at,{className:"w-3.5 h-3.5"}),new Date(h.timestamp).toLocaleString()]})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed mb-3",children:h.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("div",{className:"w-7 h-7 bg-orange-100 rounded-full flex items-center justify-center border-2 border-orange-200",children:e.jsx(Hs,{className:"w-4 h-4 text-orange-600"})}),e.jsxs("span",{className:"font-semibold",children:["By: ",h.user]})]})]})]})},N)):e.jsxs("div",{className:"text-center py-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(Ht,{className:"w-10 h-10 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 font-medium text-lg",children:"No history available"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Order history will appear here"})]})})]})}),e.jsx("div",{className:"p-4 border-t bg-gray-50 flex justify-end flex-shrink-0",children:e.jsx("button",{onClick:f,className:"px-6 py-2.5 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors shadow-lg",children:"Close"})})]})})},ja=({order:r,onClose:u,formatCurrency:o})=>{const[f,a]=l.useState([]),[C,S]=l.useState(!0);return l.useEffect(()=>{(async()=>{try{const M=await ve.getPayments(r.id);a(M||[])}catch(M){console.error("Error loading payments:",M),n.error("Failed to load payment history")}finally{S(!1)}})()},[r.id]),e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-green-50 to-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx($e,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Payment History"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Order: ",r.orderNumber]})]})]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-red-50 hover:text-red-600 hover:border-2 hover:border-orange-400 rounded-full border-2 border-transparent transition-all",children:e.jsx(Ae,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:C?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(Ft,{className:"w-8 h-8 animate-spin text-green-500"})}):f.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-xl",children:[e.jsx("div",{className:"text-xs text-blue-700 mb-1",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:o(r.totalAmount)})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-xl",children:[e.jsx("div",{className:"text-xs text-green-700 mb-1",children:"Total Paid"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o(r.totalPaid||0)})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-xl",children:[e.jsx("div",{className:"text-xs text-red-700 mb-1",children:"Balance"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o(r.totalAmount-(r.totalPaid||0))})]})]}),f.map((g,M)=>{var K;return e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-5",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:((K=g.method)==null?void 0:K.replace("_"," ").toUpperCase())||"Payment"}),g.reference&&e.jsxs("div",{className:"text-xs text-gray-600",children:["Ref: ",g.reference]})]})]}),g.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:g.notes}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:g.timestamp?new Date(g.timestamp).toLocaleString():"No date"})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o(g.amount)}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700 mt-2 inline-block",children:g.status||"completed"})]})]})},M)})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx($e,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Payments Yet"}),e.jsx("p",{className:"text-gray-600",children:"No payments have been recorded for this order"})]})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsx("button",{onClick:u,className:"w-full px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-semibold transition-colors",children:"Close"})})]})})},wa=({order:r,onClose:u,onNoteAdded:o})=>{const{currentUser:f}=Jt(),[a,C]=l.useState([]),[S,g]=l.useState(""),[M,K]=l.useState(!0),[X,L]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const _=await st.getNotes(r.id);_.success&&C(_.data||[])}catch(_){console.error("Error loading notes:",_)}finally{K(!1)}})()},[r.id]);const O=async()=>{if(S.trim())try{L(!0);const w=await st.addNote(r.id,S.trim(),(f==null?void 0:f.name)||"Unknown");w.success?(C(_=>[w.data,..._]),g(""),n.success("Note added successfully"),o()):n.error(w.message)}catch(w){console.error("Error adding note:",w),n.error("Failed to add note")}finally{L(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:u,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ce,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Order Notes"}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-semibold bg-orange-50 text-orange-700 border border-orange-200",children:r.orderNumber}),e.jsx("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:e.jsxs("span",{className:"font-medium",children:[a.length," note",a.length!==1?"s":""]})})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-6 bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(Wt,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Add New Note"})]}),e.jsx("textarea",{value:S,onChange:w=>g(w.target.value),placeholder:"Enter your note here...",rows:4,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring-2 focus:ring-orange-200 resize-none bg-white"}),e.jsx("button",{onClick:O,disabled:!S.trim()||X,className:"mt-4 w-full px-6 py-3 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white rounded-xl font-semibold transition-colors shadow-lg hover:shadow-xl disabled:cursor-not-allowed flex items-center justify-center gap-2",children:X?e.jsxs(e.Fragment,{children:[e.jsx(Ft,{className:"w-4 h-4 animate-spin"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Wt,{className:"w-4 h-4"}),"Add Note"]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(Ce,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Previous Notes"}),e.jsx("span",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-bold border border-orange-200",children:a.length})]}),M?e.jsxs("div",{className:"flex items-center justify-center h-32",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading notes..."})]}):a.length>0?e.jsx("div",{className:"space-y-4",children:a.map((w,_)=>e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md hover:border-orange-300 transition-all",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-100 to-amber-100 rounded-lg flex items-center justify-center border-2 border-orange-200 flex-shrink-0",children:e.jsx(Hs,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-bold text-gray-900",children:w.author}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(at,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:new Date(w.timestamp).toLocaleString()})]})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed bg-gray-50 rounded-lg p-3 border border-gray-200",children:w.content})]})]})},w.id||_))}):e.jsxs("div",{className:"text-center py-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(Ce,{className:"w-10 h-10 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 font-medium text-lg",children:"No notes yet"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first note above"})]})]})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 flex justify-end flex-shrink-0",children:e.jsx("button",{onClick:u,className:"px-6 py-2.5 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors shadow-lg",children:"Close"})})]})})},Na=({order:r,onClose:u})=>{var O;const{currentUser:o}=Jt(),[f,a]=l.useState([]),[C,S]=l.useState(""),[g,M]=l.useState(!0),[K,X]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const _=await ve.getMessages(r.id);a(_||[])}catch(_){console.error("Error loading messages:",_)}finally{M(!1)}})()},[r.id]);const L=async()=>{if(C.trim())try{if(X(!0),await ve.sendMessage({purchaseOrderId:r.id,sender:(o==null?void 0:o.name)||"You",content:C,type:"user"})){const _={id:Date.now().toString(),sender:(o==null?void 0:o.name)||"You",content:C,timestamp:new Date().toISOString(),type:"user"};a(V=>[_,...V]),S(""),n.success("Message sent")}else n.error("Failed to send message")}catch(w){console.error("Error sending message:",w),n.error("Failed to send message")}finally{X(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[85vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Xt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Communication"}),e.jsx("p",{className:"text-sm text-gray-600",children:(O=r.supplier)==null?void 0:O.name})]})]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-red-50 hover:text-red-600 hover:border-2 hover:border-orange-400 rounded-full border-2 border-transparent transition-all",children:e.jsx(Ae,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:g?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(Ft,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsx("div",{className:"space-y-4",children:f.length>0?f.map((w,_)=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:w.sender}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(w.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-gray-700",children:w.content})]},_)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Xt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No communication history"})]})})}),e.jsxs("div",{className:"p-6 border-t bg-gray-50",children:[e.jsx("textarea",{value:C,onChange:w=>S(w.target.value),placeholder:"Type your message...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 resize-none mb-3"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:u,className:"flex-1 px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-semibold transition-colors",children:"Close"}),e.jsx("button",{onClick:L,disabled:!C.trim()||K,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-xl font-semibold transition-colors disabled:cursor-not-allowed",children:K?"Sending...":"Send Message"})]})]})]})})},Sa=({order:r,onClose:u,onConfirm:o,isCompleting:f,formatCurrency:a,formatDate:C})=>{var M,K,X,L;const S=()=>{var _,V,W,Y;const O=`
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           PURCHASE ORDER RECEIPT
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      
      Order Number: ${r.orderNumber}
      Supplier: ${((_=r.supplier)==null?void 0:_.name)||"N/A"}
      Order Date: ${C(r.orderDate||r.createdAt)}
      Status: ${r.status.toUpperCase()}
      
      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      ITEMS SUMMARY
      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      Total Items: ${((V=r.items)==null?void 0:V.length)||0}
      Total Ordered: ${((W=r.items)==null?void 0:W.reduce((G,h)=>G+(h.quantity||0),0))||0}
      Total Received: ${((Y=r.items)==null?void 0:Y.reduce((G,h)=>G+(h.receivedQuantity||0),0))||0}
      
      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      FINANCIAL SUMMARY
      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      Total Amount: ${a(r.totalAmount||0)}
      Payment Status: ${(r.paymentStatus||"unpaid").toUpperCase()}
      
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      Thank you for your business!
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    `,w=window.open("","_blank");w&&(w.document.write(`
        <html>
          <head>
            <title>Purchase Order Receipt - ${r.orderNumber}</title>
            <style>
              body {
                font-family: 'Courier New', monospace;
                padding: 20px;
                max-width: 800px;
                margin: 0 auto;
              }
              pre {
                white-space: pre-wrap;
                font-size: 14px;
                line-height: 1.6;
              }
              @media print {
                body { padding: 0; }
              }
            </style>
          </head>
          <body>
            <pre>${O}</pre>
            <script>
              window.onload = () => {
                window.print();
                // Uncomment to auto-close after printing
                // setTimeout(() => window.close(), 100);
              };
            <\/script>
          </body>
        </html>
      `),w.document.close())},g=()=>{var V,W,Y,G;const O=`
*PURCHASE ORDER COMPLETED* ‚úÖ

*Order Number:* ${r.orderNumber}
*Supplier:* ${((V=r.supplier)==null?void 0:V.name)||"N/A"}
*Order Date:* ${C(r.orderDate||r.createdAt)}
*Status:* ${r.status.toUpperCase()}

*Items Summary:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Total Items: ${((W=r.items)==null?void 0:W.length)||0}
‚Ä¢ Total Ordered: ${((Y=r.items)==null?void 0:Y.reduce((h,N)=>h+(N.quantity||0),0))||0}
‚Ä¢ Total Received: ${((G=r.items)==null?void 0:G.reduce((h,N)=>h+(N.receivedQuantity||0),0))||0}

*Financial Summary:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Total Amount: ${a(r.totalAmount||0)}
‚Ä¢ Payment Status: ${(r.paymentStatus||"unpaid").toUpperCase()}

Thank you for your business! üôè
    `.trim(),_=`https://wa.me/?text=${encodeURIComponent(O)}`;window.open(_,"_blank")};return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-100 to-emerald-100 p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-600 flex items-center justify-center shadow-lg",children:e.jsx(Te,{className:"w-10 h-10 text-white"})}),e.jsx("button",{onClick:u,className:"w-9 h-9 flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full transition-colors",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Complete Purchase Order"}),e.jsx("p",{className:"text-gray-700",children:"Review the order summary before completing"})]}),e.jsx("div",{className:"p-8 max-h-[60vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-blue-600"}),"Order Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Order Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:r.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Supplier"}),e.jsx("p",{className:"font-semibold text-gray-900",children:((M=r.supplier)==null?void 0:M.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Order Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:C(r.orderDate||r.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("span",{className:"inline-flex px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:r.status.toUpperCase()})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-purple-600"}),"Items Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:((K=r.items)==null?void 0:K.length)||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Ordered"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:((X=r.items)==null?void 0:X.reduce((O,w)=>O+(w.quantity||0),0))||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Received"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((L=r.items)==null?void 0:L.reduce((O,w)=>O+(w.receivedQuantity||0),0))||0})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border-2 border-green-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-green-600"}),"Financial Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Total Amount"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:a(r.totalAmount||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Payment Status"}),e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-semibold rounded-full ${r.paymentStatus==="paid"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(r.paymentStatus||"unpaid").toUpperCase()})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Jr,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-900 mb-1",children:"Important"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Completing this order will finalize all transactions and mark it as complete. This action cannot be undone."})]})]})})]})}),e.jsxs("div",{className:"bg-gray-50 px-8 py-6",children:[e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx("button",{onClick:u,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 rounded-xl transition-colors font-semibold",children:"Cancel"}),e.jsx("button",{onClick:S,className:"px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors shadow-lg",title:"Print Receipt",children:e.jsx(We,{className:"w-5 h-5"})}),e.jsx("button",{onClick:g,className:"px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors shadow-lg",title:"Share on WhatsApp",children:e.jsx(ea,{className:"w-5 h-5"})}),e.jsx("button",{onClick:o,disabled:f,className:"flex-1 px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-xl transition-colors font-semibold shadow-lg flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx(Ks,{size:"sm",color:"white"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-5 h-5"}),"Confirm & Complete"]})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-500",children:[e.jsx(Bs,{className:"w-3 h-3"}),e.jsx("span",{children:"Print receipt or share via WhatsApp before completing"})]})]})]})})};export{Oa as O,Da as e,Ma as u};
