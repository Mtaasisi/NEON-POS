import{u as Re,j as e,e as Z,G as ge,n as jt,s as wt}from"./index-61458a34.js";import{r as d}from"./vendor-36d2c7c1.js";import{a2 as vt,X as Nt,ag as ee,j as St,D as Ct,I as xe,d as A,e as _,ak as ze,n as y,h as kt,l as fe,p as Dt}from"./ui-28e30067.js";import{f as Et,a as Mt}from"./phoneUtils-a8934478.js";import{a as It}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";const Lt=({isOpen:G,onClose:m,onImportComplete:te})=>{const{currentUser:F}=Re(),[se,q]=d.useState(null),[E,v]=d.useState([]),[K,J]=d.useState([]),[be,re]=d.useState(!1),[W,ae]=d.useState(!1),[le,T]=d.useState("upload"),[ye,ne]=d.useState(0),[M,oe]=d.useState([]),[w,$]=d.useState([]),[ie,je]=d.useState(!1),[ce,we]=d.useState(!1),[Ae,ve]=d.useState(!1),[U,Y]=d.useState([]),[Ft,Te]=d.useState(!1),[Pt,$e]=d.useState(new Set),[B,Ne]=d.useState(new Map),[Rt,Be]=d.useState(!0),[Se,de]=d.useState([]),[zt,Ce]=d.useState([]),[l,me]=d.useState(null),[p,N]=d.useState(""),[he,Oe]=d.useState(!0),[O,ue]=d.useState({}),[Ve,ke]=d.useState([]),[De]=d.useState({name:["name","full name","customer name","first name","client name","customer","client","fullname","firstname","lastname","first name","last name","fullname","customer full name","client full name","person name","contact name"],phone:["phone","phone number","mobile","mobile phone","primary phone","phone 1 - value","contact","contact number","telephone","tel","cell","cell phone","mobile number","phone number","contact phone","primary contact","phone contact","mobile contact","telephone number"],whatsapp:["whatsapp","whatsapp number","whats app","whatsapp phone","wa","whatsapp contact","whatsapp number","whatsapp contact","whats app number","whatsapp mobile","wa number","wa contact"],gender:["gender","sex","male/female","m/f","gender identity","male or female","m or f","gender type","sex type"],city:["city","location","home city","business city","town","address","residence","home town","business town","home location","business location","home address","business address","city location","town location"],notes:["notes","comments","remarks","description","details","additional info","extra info","customer notes","client notes","additional notes","extra notes","remarks notes","description notes"],loyaltyLevel:["loyalty","loyalty level","level","customer level","tier","membership level","loyalty tier","customer tier","membership tier","loyalty status","customer status","level status"],colorTag:["color tag","tag","customer tag","status tag","priority","category","type","customer type","client type","priority tag","category tag","status type"],birthMonth:["birth month","month","birthday month","month of birth","dob month","birth month","month of birth","birthday month","birth month number","month number"],birthDay:["birth day","day","birthday day","day of birth","dob day","birth date","birth day","day of birth","birthday day","birth day number","day number"],referralSource:["referral source","referral","referred by","referral resource","how did you hear","source","referrer source","how did you hear about us","how did you find us","referral method","referral type","referral source type"],referralSourceCustom:["referral source custom","custom referral","other referral","custom source","other referral source","custom referral source","other source"],locationDescription:["location description","address","home address","business address","street address","full address","detailed address","home location","business location","street location","full location","detailed location"],nationalId:["national id","id number","national id number","identity number","id card","passport number","national id number","identity card","id card number","passport id","national identity","identity card number"],referredBy:["referred by","referrer","who referred","referred by name","referrer name","who referred you","referred by person","referrer person","who referred customer"],totalSpent:["total spent","spent","total amount","amount spent","total purchase","total value","total amount spent","total purchase amount","total value spent","customer spent","client spent"],points:["points","loyalty points","reward points","customer points","bonus points","loyalty reward points","customer reward points","bonus reward points","points earned","points accumulated"],isActive:["is active","active","status","customer status","active status","customer active","client active","active customer","active client","customer is active","client is active"],profileImage:["profile image","image","photo","picture","avatar","profile picture","customer image","client image","profile photo","customer photo","client photo","profile avatar"],birthday:["birthday","birth day","birth","birth date","date of birth","dob","birth date","birthday date","date of birth","birthday day","birth day date"]}),Q=d.useRef(null),V=Et,Ee=Mt,He=t=>{const s={},a=t.map(r=>r.trim().toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," "));return Object.entries(De).forEach(([r,i])=>{let o=-1,h=0;a.forEach((c,n)=>{i.forEach(b=>{if(c===b)h<100&&(h=100,o=n);else if(c.includes(b)||b.includes(c)){const f=Math.min(c.length,b.length)/Math.max(c.length,b.length)*80;f>h&&(h=f,o=n)}else{const f=b.split(" "),L=c.split(" ");let g=0;if(f.forEach(C=>{C.length>2&&L.some(H=>H.includes(C)||C.includes(H))&&g++}),g>0){const C=g/f.length*60;C>h&&(h=C,o=n)}}h<40&&({name:["nm","n","full nm","customer nm"],phone:["ph","p","tel","mobile","mob","cell"],whatsapp:["wa","whats","whats app"],gender:["sex","g","m/f","male/female"],city:["location","loc","town","address"],notes:["comment","cmt","remark","desc"],loyalty:["loyal","level","tier","status"],birth:["dob","birthday","birth day"],referral:["ref","referred","source"],total:["amount","sum","spent","value"],points:["pts","reward","bonus"],active:["status","is active","customer status"],image:["photo","pic","picture","avatar"]}[r]||[]).forEach(g=>{(c.includes(g)||g.includes(c))&&50>h&&(h=50,o=n)})})}),o!==-1&&(s[r]=o)}),s},x=(t,s,a)=>{const r=a[s];return r!==void 0&&r>=0&&r<t.length&&t[r]||""},Ge=t=>{if(!t)return"";const s=t.trim();return s===s.toUpperCase()&&s.length>1?s.toLowerCase().replace(/\b\w/g,a=>a.toUpperCase()):s===s.toUpperCase()?s.toLowerCase().replace(/\b\w/g,a=>a.toUpperCase()):s},qe=t=>{if(!t)return"other";const s=t.trim().toLowerCase();return s==="male"||s==="m"?"male":s==="female"||s==="f"?"female":"other"},Ke=t=>{if(!t)return"";const s=t.trim(),a={mtandaoni:"Social Media",physically:"Walk-in",recommendation:"Friend","social media":"Social Media",facebook:"Facebook",google:"Google",friend:"Friend",family:"Family",colleague:"Colleague",advertisement:"Advertisement",website:"Website","walk-in":"Walk-in",referral:"Referral",other:"Other"},r=s.toLowerCase();return a[r]?a[r]:s===s.toUpperCase()&&s.length>1?s.toLowerCase().replace(/\b\w/g,i=>i.toUpperCase()):s},Je=t=>{if(!t)return"";const s=t.trim(),a={dsm:"Dar es Salaam",dar:"Dar es Salaam","dar es":"Dar es Salaam","dar es salaam":"Dar es Salaam",mara:"Mara",moro:"Morogoro",arusha:"Arusha",mwanza:"Mwanza",dodoma:"Dodoma",tanga:"Tanga",mbeya:"Mbeya",morogoro:"Morogoro",tabora:"Tabora",singida:"Singida",kigoma:"Kigoma",shinyanga:"Shinyanga",kagera:"Kagera",manyara:"Manyara",njombe:"Njombe",katavi:"Katavi",geita:"Geita",simiyu:"Simiyu",songwe:"Songwe"},r=s.toLowerCase();return a[r]?a[r]:s},Me=t=>{if(!t)return{month:"",day:""};const s=t.trim().toLowerCase(),a=/^(\d{1,2})-([a-z]{3,})$/,r=s.match(a);if(r){const h=r[1],c=r[2],b={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"}[c];if(b)return{month:b,day:h}}const i=/^([a-z]{3,})-(\d{1,2})$/,o=s.match(i);if(o){const h=o[1],c=o[2],b={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"}[h];if(b)return{month:b,day:c}}return{month:"",day:""}},We=t=>{if(!t)return"new";const s=t.trim().toLowerCase();return{new:"new",vip:"vip",complainer:"complainer",purchased:"purchased","not new":"new",normal:"new",regular:"new",standard:"new",basic:"new",premium:"vip",important:"vip",priority:"vip",problem:"complainer",issue:"complainer",buyer:"purchased",customer:"purchased",buying:"purchased"}[s]||"new"},Ue=async t=>{const s=new Map;try{const a=t.map(r=>V(r.phone)).filter(r=>r);if(a.length>0){const{data:r,error:i}=await wt.from("customers").select("id, name, phone").in("phone",a);!i&&r&&r.forEach(o=>{s.set(o.phone,o)})}}catch(a){console.error("Error checking existing customers:",a)}return s},X=(t,s)=>{var r,i;const a=[];if((r=t.name)!=null&&r.trim()||a.push(`Row ${s}: Name is required`),(i=t.phone)!=null&&i.trim()?/^[+]?[0-9\s\-()]{8,}$/.test(t.phone)||a.push(`Row ${s}: Invalid phone number format`):a.push(`Row ${s}: Phone number is required`),t.gender&&!["male","female","other"].includes(t.gender)&&a.push(`Row ${s}: Gender must be male, female, or other`),t.loyaltyLevel&&!["bronze","silver","gold","platinum"].includes(t.loyaltyLevel)&&a.push(`Row ${s}: Invalid loyalty level`),t.birthMonth&&!t.birthDay&&a.push(`Row ${s}: Birth day is required if birth month is provided`),t.birthDay&&!t.birthMonth&&a.push(`Row ${s}: Birth month is required if birth day is provided`),t.birthDay){const o=parseInt(t.birthDay);(isNaN(o)||o<1||o>31)&&a.push(`Row ${s}: Birth day must be a number between 1-31`)}return a},Ye=t=>{const s=new Map,a=[];return t.forEach((r,i)=>{const o=V(r.phone);o&&(s.has(o)||s.set(o,[]),s.get(o).push(i+2))}),s.forEach((r,i)=>{r.length>1&&a.push(`Duplicate phone number "${i}" found in rows: ${r.join(", ")}`)}),a},pe=(t,s)=>X(t,s+2),I=(t,s,a)=>pe(t,s).some(i=>i.toLowerCase().includes(a.toLowerCase())||a==="name"&&i.includes("Name is required")||a==="phone"&&(i.includes("Phone number is required")||i.includes("Invalid phone number format"))),Ie=(t,s,a)=>pe(t,s).find(i=>i.toLowerCase().includes(a.toLowerCase())||a==="name"&&i.includes("Name is required")||a==="phone"&&(i.includes("Phone number is required")||i.includes("Invalid phone number format")))||"",Qe=t=>{var a;const s=(a=t.target.files)==null?void 0:a[0];if(s){if(s.size>5*1024*1024){y.error("File size must be less than 5MB");return}v([]),$([]),ue({}),q(s),Xe(s)}},Xe=async t=>{var s;if(G)try{re(!0),$([]);const r=(await t.text()).split(`
`).filter(j=>j.trim());if(r.length<2){y.error("File must contain at least a header row and one data row");return}const i=((s=r[0])==null?void 0:s.split(",").map(j=>j.trim()))||[],o=He(i);ue(o),ke(i);const c=Object.keys(o).length,n=Object.keys(De).length,b=Object.entries(o).map(([j,z])=>{const u=i[z]||"Unknown";return`${j}: "${u}" (column ${z+1})`}).join(", ");c>0?y.success(`‚úÖ Detected ${c}/${n} columns: ${b}`):y("‚ö†Ô∏è Could not detect columns automatically. Please use the template format.");const f=[],L=[];for(let j=1;j<r.length;j++){const z=r[j].trim();if(!z)continue;const u=z.split(",").map(D=>D.trim().replace(/^"|"$/g,"")),et=x(u,"name",o),tt=x(u,"phone",o),st=x(u,"whatsapp",o),rt=x(u,"gender",o),at=x(u,"city",o),lt=x(u,"notes",o),nt=x(u,"loyaltyLevel",o),ot=x(u,"colorTag",o),it=x(u,"birthMonth",o),ct=x(u,"birthDay",o),dt=x(u,"referralSource",o),mt=x(u,"referralSourceCustom",o),ht=x(u,"locationDescription",o),ut=x(u,"nationalId",o),pt=x(u,"referredBy",o),xt=x(u,"totalSpent",o),ft=x(u,"points",o),gt=x(u,"isActive",o),bt=x(u,"profileImage",o),Pe=x(u,"birthday",o),k={name:Ge(et),email:"",phone:V(tt),gender:qe(rt||"other"),city:Je(at),whatsapp:Ee(st),notes:lt,loyaltyLevel:nt||"bronze",colorTag:We(ot||"new"),birthMonth:it,birthDay:ct,referralSource:Ke(dt),referralSourceCustom:mt,locationDescription:ht,nationalId:ut,referredBy:pt,totalSpent:parseFloat(xt||"0")||0,points:parseInt(ft||"0")||0,isActive:gt!=="false",profileImage:bt};if(Pe){const D=Me(Pe);D.month&&D.day&&(k.birthMonth=D.month,k.birthDay=D.day)}if(k.birthMonth&&k.birthMonth.includes("-")){const D=Me(k.birthMonth);D.month&&D.day&&(k.birthMonth=D.month,k.birthDay=D.day)}const yt=X(k,j+1);L.push(...yt),k.name&&k.phone&&f.push(k)}const g=Ye(f),C=[...L,...g],H=await Ue(f);if(Ne(H),$(L),Ce(g),v(f),Y([...f]),J(f),de(f),T("preview"),C.length>0){const j=L.length,z=g.length;y.error(`Found ${j} validation errors and ${z} duplicate entries. Please review before importing.`)}else{const j=H.size,z=f.length-j;y.success(`Processed ${f.length} customers. ${z} new, ${j} existing will be skipped.`)}}catch(a){console.error("Error processing file:",a),y.error("Error processing file. Please ensure it's a valid CSV/Excel file.")}finally{re(!1)}},Ze=async()=>{if((F==null?void 0:F.role)!=="admin"){y.error("Only administrators can import customers. You can view the preview and results.");return}const t=Ae?U:E;if(t.length===0){y.error("No data to import. Please add at least one customer.");return}w.length>0&&y.error(`Found ${w.length} validation errors. Invalid rows will be skipped.`);try{ae(!0),ne(0),oe([]);const a=[],r=[];for(let c=0;c<t.length;c++){const n=t[c],b=V(n.phone),f=X(n,c+2);if(f.length>0){r.push({success:!1,skipped:!0,reason:`Validation errors: ${f.join(", ")}`,rowNumber:c+2});continue}const L=B.get(b);if(L){const g=L,C="Phone number already exists";r.push({success:!1,skipped:!0,reason:C,rowNumber:c+2})}else try{const g=await jt({id:crypto.randomUUID(),name:n.name,email:n.email,phone:b,gender:n.gender,city:n.city,whatsapp:Ee(n.whatsapp||""),initialNotes:n.notes,loyaltyLevel:n.loyaltyLevel||"bronze",colorTag:n.colorTag||"new",birthMonth:n.birthMonth,birthDay:n.birthDay,referralSource:n.referralSource,joinedDate:new Date().toISOString(),totalSpent:n.totalSpent||0,points:n.points||0,lastVisit:new Date().toISOString(),isActive:n.isActive!==!1,notes:[],referrals:[]});g?(a.push(g),r.push({success:!0,customer:g,rowNumber:c+2})):r.push({success:!1,error:"Failed to create customer",rowNumber:c+2})}catch(g){console.error(`Error creating customer ${n.name}:`,g),r.push({success:!1,error:g instanceof Error?g.message:"Unknown error",rowNumber:c+2})}ne((c+1)/t.length*100),oe(r)}const i=r.filter(c=>c.success).length,o=r.filter(c=>c.skipped).length,h=r.filter(c=>!c.success&&!c.skipped).length;i>0&&(y.success(`Successfully imported ${i} customers!`),te(a)),o>0&&y.success(`Skipped ${o} rows (validation errors or existing customers).`),h>0&&y.error(`${h} customers failed to import. Check the results below.`),T("import")}catch(a){console.error("Import error:",a),y.error("Error importing customers. Please try again.")}finally{ae(!1)}},_e=()=>{const t=U.map(a=>{var i,o;const r={...a};if((i=r.name)!=null&&i.trim()||(r.name="Unknown Customer"),!((o=r.phone)!=null&&o.trim()))r.phone="0000000000";else if(!/^[+]?[0-9\s\-()]{8,}$/.test(r.phone)){const h=r.phone.replace(/[^\d+]/g,"");r.phone=h.length>=8?h:"0000000000"}if(r.gender&&!["male","female","other"].includes(r.gender)&&(r.gender="other"),r.loyaltyLevel&&!["bronze","silver","gold","platinum"].includes(r.loyaltyLevel)&&(r.loyaltyLevel="bronze"),r.birthDay){const h=parseInt(r.birthDay);(isNaN(h)||h<1||h>31)&&(r.birthDay="")}return r});Y(t);const s=[];t.forEach((a,r)=>{const i=X(a,r+2);s.push(...i)}),$(s),U.length-s.length,y.success(`Auto-fixed ${U.length-s.length} rows. ${s.length} errors remain.`)},Le=()=>{q(null),v([]),Y([]),J([]),de([]),T("upload"),re(!1),ae(!1),ve(!1),Te(!1),$e(new Set),ne(0),oe([]),$([]),Ce([]),Ne(new Map),Be(!1),ue({}),ke([]),je(!1),we(!1),Q.current&&(Q.current.value=""),m()},Fe=()=>{const a="\uFEFF"+`Name,Phone Number,WhatsApp Number,Gender,City,Notes,Loyalty Level,Color Tag,Birth Month,Birth Day,Referral Source,Location Description,National ID,Referred By,Total Spent,Points,Is Active,Email,Profile Image
John Doe,+255712345678,+255712345678,male,Dar es Salaam,Regular customer prefers phone calls,bronze,new,3,15,social media,123 Main Street Dar es Salaam,1234567890123456,Jane Smith,50000,100,true,john.doe@email.com,https://example.com/profile.jpg
Jane Smith,+255723456789,+255723456789,female,Arusha,VIP customer very satisfied,silver,vip,6,22,recommendation,456 Business Ave Arusha,2345678901234567,Mike Johnson,75000,150,true,jane.smith@email.com,
Mike Johnson,+255734567890,+255734567890,male,Mwanza,Regular customer,gold,new,12,5,physically,789 Home Road Mwanza,3456789012345678,Alice Brown,100000,200,true,mike.johnson@email.com,
Alice Brown,+255745678901,+255745678901,female,Dodoma,Social media customer,platinum,purchased,9,10,facebook,321 Social Street Dodoma,4567890123456789,John Doe,150000,300,true,alice.brown@email.com,`,r=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=window.URL.createObjectURL(r),o=document.createElement("a");o.href=i,o.download="customer_import_template.csv",o.click(),window.URL.revokeObjectURL(i),y.success("Template downloaded! Use this format for best results. Gender: male/female/other, Loyalty: bronze/silver/gold/platinum, Color Tag: new/vip/complainer/purchased")};d.useEffect(()=>{const t=()=>{const s=document.body,a=s.classList.contains("sidebar-open")||s.classList.contains("sidebar-visible")||document.querySelector(".sidebar:not(.hidden)")!==null;Oe(a)};return t(),window.addEventListener("resize",t),document.addEventListener("DOMContentLoaded",t),()=>{window.removeEventListener("resize",t),document.removeEventListener("DOMContentLoaded",t)}},[]);const P=(t,s,a)=>{(l==null?void 0:l.row)===t&&(l==null?void 0:l.field)===s||(l&&(l.row!==t||l.field!==s)&&S(p),me({row:t,field:s}),N(a),setTimeout(()=>{const r=document.querySelector(`input[data-row="${t}"][data-field="${s}"], select[data-row="${t}"][data-field="${s}"], textarea[data-row="${t}"][data-field="${s}"]`);r&&(r.focus(),(r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement)&&r.setSelectionRange(r.value.length,r.value.length))},0))},S=t=>{if(l){const s=[...Se],{row:a,field:r}=l;if(r==="birthday"){const i=t.trim().split(" ");i.length===2&&(s[a].birthMonth=i[0],s[a].birthDay=i[1])}else r==="gender"?["male","female","other"].includes(t.toLowerCase())&&(s[a].gender=t.toLowerCase()):r==="loyaltyLevel"?["bronze","silver","gold","platinum"].includes(t.toLowerCase())&&(s[a].loyaltyLevel=t.toLowerCase()):r==="colorTag"?["new","vip","complainer","purchased"].includes(t.toLowerCase())&&(s[a].colorTag=t.toLowerCase()):s[a][r]=t;de(s),v(s)}me(null),N("")},R=t=>{t.key==="Enter"?S(p):t.key==="Escape"&&(me(null),N(""))};return!G||!["admin","customer-care"].includes((F==null?void 0:F.role)||"")?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4 transition-all duration-300 ml-0",style:{marginLeft:he?"280px":"0px",left:"0",right:"0"},children:e.jsxs(Z,{className:"w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5 text-green-500"}),"Import Customers from Excel (Skip Existing)"]}),e.jsx("button",{onClick:Le,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Nt,{className:"w-5 h-5"})})]}),le==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto text-blue-500 mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Upload Customer Data"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Import customers from Excel/CSV file with intelligent column detection. The system automatically detects column positions regardless of their order!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{var t;return(t=Q.current)==null?void 0:t.click()},disabled:be,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors",children:[e.jsx(ee,{className:"w-4 h-4 mr-2 inline"}),be?"Processing...":"Choose File"]}),e.jsxs("button",{onClick:()=>{T("preview"),ve(!0),Y([{name:"",email:"",phone:"",gender:"other",city:"",whatsapp:"",birthMonth:"",birthDay:"",referralSource:"",notes:"",loyaltyLevel:"bronze",colorTag:"new"}])},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[e.jsx(St,{className:"w-4 h-4 mr-2 inline"}),"Manual Entry"]}),e.jsxs("button",{onClick:Fe,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[e.jsx(Ct,{className:"w-4 h-4 mr-2 inline"}),"Download Template"]}),e.jsx("div",{className:"flex items-center justify-center text-sm text-gray-500",children:"or"})]}),e.jsx("input",{ref:Q,type:"file",accept:".csv,.xlsx,.xls",onChange:Qe,className:"hidden"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Import Features:"]}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Intelligent Column Detection"})," - Automatically detects column positions regardless of order"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Auto-skip existing customers"})," - Based on phone number or email"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Duplicate detection"})," - Checks for duplicate phones/emails within Excel file"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Required fields:"})," name, phone"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Optional fields:"})," email, gender, city, whatsapp, birth month/day, referral source, notes, loyalty level, color tag, location description, national id, referred by, total spent, points, is active, profile image"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Tanzania phone formatting:"})," Automatically adds +255 country code to all numbers"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Validation:"})," Checks for valid email format and required fields"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Scroll to view all customers"}),' - Click "Show All Customers" to see complete list']})]})]})]}),le==="preview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"üìà"})}),"Import Summary"]}),e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Ready to Import"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"üë•"})}),e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:"TOTAL"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:E.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Customers Found"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-yellow-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"‚è≠Ô∏è"})}),e.jsx("div",{className:"text-xs text-yellow-600 font-medium",children:"SKIP"})]}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-1",children:B.size}),e.jsx("div",{className:"text-xs text-gray-500",children:"Already Exist"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-green-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("div",{className:"text-xs text-green-600 font-medium",children:"IMPORT"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:E.length-B.size}),e.jsx("div",{className:"text-xs text-gray-500",children:"New Customers"})]})]})]}),Object.keys(O).length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsxs("h4",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"Intelligent Column Detection"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 text-sm",children:Object.entries(O).map(([t,s])=>e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg p-2 border border-blue-100",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-blue-700 font-medium capitalize",children:t.replace(/([A-Z])/g," $1").trim()}),e.jsxs("span",{className:"text-blue-500 text-xs",children:["Col ",s+1]})]},t))}),e.jsxs("div",{className:"mt-3 p-2 bg-blue-100 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"Smart Detection:"})," The system automatically detected ",Object.keys(O).length," columns from your Excel file. You can change column positions in your file and the system will still work correctly!"]})]}),w.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Validation Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:w.length}),e.jsx("div",{className:"text-red-700",children:"Total Errors"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:w.filter(t=>t.includes("Name is required")).length}),e.jsx("div",{className:"text-yellow-700",children:"Missing Names"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:w.filter(t=>t.includes("Phone")).length}),e.jsx("div",{className:"text-orange-700",children:"Phone Issues"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:E.length-w.filter(t=>t.includes("Row")).length}),e.jsx("div",{className:"text-green-700",children:"Valid Rows"})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-100 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"Quick Fix Options:"}),e.jsxs("ul",{className:"mt-2 space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsxs("button",{onClick:()=>je(!ie),className:"text-blue-600 hover:underline",children:[ie?"Hide":"Show"," detailed error list"]})]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("button",{onClick:_e,className:"text-blue-600 hover:underline",children:"Auto-fix common issues"})]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("button",{onClick:Fe,className:"text-blue-600 hover:underline",children:"Download template for correct format"})]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsxs("button",{onClick:()=>we(!ce),className:"text-blue-600 hover:underline",children:[ce?"Hide":"Show"," format guide"]})]}),e.jsx("li",{children:"‚Ä¢ Rows with validation errors will be automatically skipped during import"}),e.jsx("li",{children:"‚Ä¢ You can edit individual rows in the table below to fix errors"})]})]})]}),ie&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-yellow-800 mb-2 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Detailed Validation Errors (",w.length," rows will be skipped):"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:w.map((t,s)=>e.jsxs("div",{className:"py-1 px-2 bg-yellow-100 rounded text-sm text-yellow-800 border border-yellow-200",children:["‚Ä¢ ",t]},s))})}),e.jsxs("div",{className:"mt-3 p-2 bg-yellow-100 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," Rows with validation errors will be automatically skipped during import. Valid customers will still be imported successfully."]})]})]}),ce&&e.jsxs("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 mb-3 flex items-center gap-2",children:[e.jsx(Award,{className:"w-4 h-4"}),"Excel Import Format Guide"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-green-700 mb-2",children:"Required Fields:"}),e.jsxs("ul",{className:"space-y-1 text-green-600",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Name:"})," Customer's full name (required)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Phone Number:"})," Primary contact number (required)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Gender:"})," male, female, or other"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"City:"})," Customer's city/location"]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-green-700 mb-2",children:"Optional Fields:"}),e.jsxs("ul",{className:"space-y-1 text-green-600",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"WhatsApp:"})," WhatsApp number"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Notes:"})," Customer notes/comments"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Loyalty Level:"})," bronze, silver, gold, platinum"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Color Tag:"})," new, vip, complainer, purchased"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Birth Month/Day:"})," Numbers (1-12 for month, 1-31 for day)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Referral Source:"})," How customer found you"]})]})]})]}),e.jsxs("div",{className:"mt-3 p-2 bg-green-100 rounded text-sm text-green-800",children:[e.jsx("strong",{children:"Tips:"})," Use the template for best results. Phone numbers should include country code (+255 for Tanzania). Gender and loyalty level are case-sensitive."]})]}),Object.keys(O).length>0&&e.jsxs("div",{className:"mb-4 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"Column Mapping Detected:"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.entries(O).map(([t,s])=>{const a=Ve[s]||"Unknown";return e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-100 rounded",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsxs("span",{className:"text-blue-700 font-medium",children:[t,":"]}),e.jsxs("span",{className:"text-blue-600",children:['"',a,'"']})]},t)})}),e.jsxs("div",{className:"mt-3 p-2 bg-blue-100 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"Note:"})," The system automatically mapped your Excel columns to the correct fields. If any mapping looks incorrect, please use the template format."]})]}),w.length>0&&e.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-yellow-800 mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Field Validation Summary:"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsxs("span",{className:"text-yellow-700",children:["Name: ",w.filter(t=>t.includes("Name is required")).length," missing"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsxs("span",{className:"text-yellow-700",children:["Phone: ",w.filter(t=>t.includes("Phone")).length," issues"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-green-700",children:["Valid rows: ",E.length-w.filter(t=>t.includes("Row")).length," ready"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsxs("span",{className:"text-blue-700",children:["Total rows: ",E.length]})]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Dropdown Values for Excel:"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," male, female, other"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Loyalty Level:"})," bronze, silver, gold, platinum"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Color Tag:"})," new, vip, complainer, purchased"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Referral Source:"})," MTANDAONI, RECOMMENDATION, PHYSICALLY, INSTAGRAM, FACEBOOK, GOOGLE, FRIEND, FAMILY, OTHER"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-yellow-800 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"How to Add Dropdowns in Excel:"]}),e.jsxs("ol",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"1. Select the column you want to add dropdown to (e.g., Gender column)"}),e.jsxs("li",{children:["2. Go to ",e.jsx("strong",{children:"Data"})," tab ‚Üí ",e.jsx("strong",{children:"Data Validation"})]}),e.jsxs("li",{children:["3. Choose ",e.jsx("strong",{children:"List"}),' from "Allow" dropdown']}),e.jsx("li",{children:'4. In "Source" field, enter values separated by commas (e.g., male,female,other)'}),e.jsxs("li",{children:["5. Click ",e.jsx("strong",{children:"OK"})," to apply"]})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm min-w-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Phone"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"City"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Gender"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"WhatsApp"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Birthday"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Notes"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Loyalty"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Tag"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:Se.map((t,s)=>{var c;const a=V(t.phone),r=(c=t.email)==null?void 0:c.toLowerCase(),i=B.get(a),o=r?B.get(r):null,h=i||o;return e.jsxs("tr",{className:`hover:bg-gray-50 transition-colors ${pe(t,s).length>0?"bg-yellow-50":""}`,children:[e.jsxs("td",{className:`p-3 font-medium cursor-pointer hover:bg-blue-50 relative ${I(t,s,"name")?"bg-yellow-100 border-l-4 border-yellow-500":"text-gray-900"}`,onClick:n=>{n.stopPropagation(),P(s,"name",t.name)},title:I(t,s,"name")?Ie(t,s,"name"):"",children:[I(t,s,"name")&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"‚ö†Ô∏è"})}),(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="name"?e.jsx("input",{type:"text",value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),className:"w-full h-full bg-transparent border-none outline-none text-sm font-medium text-gray-900 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"name",autoFocus:!0}):e.jsx("span",{className:I(t,s,"name")?"text-yellow-800":"",children:t.name||(I(t,s,"name")?"‚ö†Ô∏è Required":"")})]}),e.jsxs("td",{className:`p-3 cursor-pointer hover:bg-blue-50 relative ${I(t,s,"phone")?"bg-yellow-100 border-l-4 border-yellow-500":"text-gray-700"}`,onClick:n=>{n.stopPropagation(),P(s,"phone",t.phone)},title:I(t,s,"phone")?Ie(t,s,"phone"):"",children:[I(t,s,"phone")&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"‚ö†Ô∏è"})}),(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="phone"?e.jsx("input",{type:"text",value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"phone",autoFocus:!0}):e.jsx("span",{className:I(t,s,"phone")?"text-yellow-800":"",children:t.phone||(I(t,s,"phone")?"‚ö†Ô∏è Required":"")})]}),e.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:n=>{n.stopPropagation(),P(s,"city",t.city||"")},children:(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="city"?e.jsx("input",{type:"text",value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"city",autoFocus:!0}):t.city||"-"}),e.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:n=>{n.stopPropagation(),P(s,"gender",t.gender||"")},children:(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="gender"?e.jsxs("select",{value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"gender",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]}):t.gender||"-"}),e.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:n=>{n.stopPropagation(),P(s,"whatsapp",t.whatsapp||"")},children:(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="whatsapp"?e.jsx("input",{type:"text",value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"whatsapp",autoFocus:!0}):t.whatsapp||"-"}),e.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:n=>{n.stopPropagation(),P(s,"birthday",t.birthMonth&&t.birthDay?`${t.birthMonth} ${t.birthDay}`:"")},children:(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="birthday"?e.jsx("input",{type:"text",value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),placeholder:"e.g., January 15",className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"birthday",autoFocus:!0}):t.birthMonth&&t.birthDay?`${t.birthMonth} ${t.birthDay}`:"-"}),e.jsx("td",{className:"p-3 text-gray-700 max-w-xs truncate cursor-pointer hover:bg-blue-50",title:t.notes||"",onClick:n=>{n.stopPropagation(),P(s,"notes",t.notes||"")},children:(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="notes"?e.jsx("textarea",{value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0 resize-none",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"notes",rows:1,autoFocus:!0}):t.notes||"-"}),e.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:n=>{n.stopPropagation(),P(s,"loyaltyLevel",t.loyaltyLevel||"")},children:(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="loyaltyLevel"?e.jsxs("select",{value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"loyaltyLevel",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Select Level"}),e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]}):t.loyaltyLevel||"bronze"}),e.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:n=>{n.stopPropagation(),P(s,"colorTag",t.colorTag||"")},children:(l==null?void 0:l.row)===s&&(l==null?void 0:l.field)==="colorTag"?e.jsxs("select",{value:p,onChange:n=>N(n.target.value),onKeyDown:R,onBlur:()=>S(p),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"colorTag",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Select Tag"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"vip",children:"VIP"}),e.jsx("option",{value:"complainer",children:"Complainer"}),e.jsx("option",{value:"purchased",children:"Purchased"})]}):t.colorTag||"new"}),e.jsx("td",{className:"p-3",children:h?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:[e.jsx(ze,{className:"w-3 h-3"}),"Skip"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:[e.jsx(A,{className:"w-3 h-3"}),"Import"]})})]},s)})})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>T("upload"),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:()=>{T("import"),setTimeout(()=>{Ze()},100)},className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm font-medium transition-colors",children:w.length>0?"Continue (Skip Invalid Rows)":"Continue to Import"})]})]}),le==="import"&&e.jsxs("div",{className:"space-y-6",children:[W?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Importing Customers"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Progress: ",Math.round(ye),"% (",M.length,"/",E.length,")"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${ye}%`}})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(A,{className:"w-12 h-12 mx-auto text-green-500 mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Import Complete"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Import results for ",E.length," customers"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Imported"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:M.filter(t=>t.success).length})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-1",children:"Skipped"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:M.filter(t=>t.skipped).length})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:M.filter(t=>!t.success&&!t.skipped).length})]})]}),M.filter(t=>t.skipped).length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Skipped Customers:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto",children:e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[M.filter(t=>t.skipped).slice(0,10).map((t,s)=>e.jsxs("li",{children:["Row ",t.rowNumber,": ",t.reason]},s)),M.filter(t=>t.skipped).length>10&&e.jsxs("li",{className:"text-yellow-600",children:["... and ",M.filter(t=>t.skipped).length-10," more skipped"]})]})})]}),M.filter(t=>!t.success&&!t.skipped).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Failed Imports:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto",children:e.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:M.filter(t=>!t.success&&!t.skipped).map((t,s)=>e.jsxs("li",{children:["Row ",t.rowNumber,": ",t.error]},s))})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ge,{onClick:()=>T("preview"),variant:"secondary",className:"flex-1",disabled:W,children:"Back"}),e.jsx(ge,{onClick:Le,disabled:W,className:"flex-1",children:W?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Close"]})})]})]})]})})},Ht=()=>{const G=It(),{currentUser:m}=Re(),[te,F]=d.useState(!1),[se,q]=d.useState([]),E=v=>{const K={imported:v,skipped:0,failed:0,timestamp:new Date().toLocaleString()};q(J=>[K,...J.slice(0,4)])};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>G("/customers"),className:"mr-4 p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(kt,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Import Customers from Excel"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(Z,{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[(m==null?void 0:m.role)==="admin"?e.jsx(ee,{className:"w-16 h-16 mx-auto text-blue-500 mb-4"}):e.jsx(fe,{className:"w-16 h-16 mx-auto text-green-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:(m==null?void 0:m.role)==="admin"?"Bulk Import Customers":"View Import Results"}),e.jsx("p",{className:"text-gray-600 mb-4",children:(m==null?void 0:m.role)==="admin"?"Import customers from Excel/CSV files. Existing customers will be automatically skipped.":"View import results and customer data. Only administrators can perform imports."})]}),e.jsx("div",{className:"space-y-4 mb-6",children:(m==null?void 0:m.role)==="admin"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx(A,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Auto-skip existing customers"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Based on phone number or email"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx(Dt,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-900",children:"Bulk processing"}),e.jsx("p",{className:"text-sm text-green-700",children:"Import hundreds of customers at once"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg",children:[e.jsx(ze,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-900",children:"Smart validation"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Automatic phone formatting and validation"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx(fe,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-900",children:"View import results"}),e.jsx("p",{className:"text-sm text-green-700",children:"See what passed and failed"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx(A,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Track progress"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Monitor import status and results"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg",children:[e.jsx(_,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-900",children:"Read-only access"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"View data without import permissions"})]})]})]})}),e.jsx(ge,{onClick:()=>F(!0),className:"w-full",children:(m==null?void 0:m.role)==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Start Import"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"View Import"]})})]}),e.jsxs(Z,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:(m==null?void 0:m.role)==="admin"?"How to Import":"How to View Results"}),e.jsx("div",{className:"space-y-4",children:(m==null?void 0:m.role)==="admin"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Prepare your file"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use CSV format with headers: name, phone, email, gender, city, etc."})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Upload and preview"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review the data and see which customers will be imported vs skipped"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Import and confirm"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Start the import process and review results"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"View import status"}),e.jsx("p",{className:"text-sm text-gray-600",children:"See which customers were imported, skipped, or failed"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Review results"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Check detailed information about import outcomes"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Monitor progress"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Track import progress and final results"})]})]})]})}),(m==null?void 0:m.role)==="admin"&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Required Fields:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"name"})," - Customer's full name"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"phone"})," - Phone number (auto-formats with 255 prefix)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"email"})," - Email address (optional)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"gender"})," - male, female, or other"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"city"})," - City/location"]})]})]})]})]}),se.length>0&&e.jsxs(Z,{className:"mt-6 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Recent Imports"}),e.jsx("div",{className:"space-y-3",children:se.map((v,K)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Import completed"}),e.jsx("p",{className:"text-sm text-gray-600",children:v.timestamp})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-600",children:[v.imported.length," imported"]}),v.skipped>0&&e.jsxs("span",{className:"text-yellow-600",children:[v.skipped," skipped"]}),v.failed>0&&e.jsxs("span",{className:"text-red-600",children:[v.failed," failed"]})]})]},K))})]})]}),e.jsx(Lt,{isOpen:te,onClose:()=>F(!1),onImportComplete:E})]})};export{Ht as default};
