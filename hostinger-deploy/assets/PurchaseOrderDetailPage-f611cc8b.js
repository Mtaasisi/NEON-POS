import{_ as Ns}from"./supabase-cf010ec4.js";import{j as e,u as lr,d as Je,aG as C,s as je,aH as js,G as nr}from"./index-61458a34.js";import{r as i}from"./vendor-36d2c7c1.js";import{a as ir,d as cr,c as or}from"./routing-eb8c310c.js";import{u as M,d as W,f as ge,e as he,c4 as $e,a3 as G,n,D as Ps,X as ue,a4 as Et,r as dr,U as mr,$ as ve,by as xr,J as ur,m as Ft,I as Xe,aA as vs,av as Mt,bN as Lt,q as ws,Z as gr,G as hr,a0 as Te,Y as pr,A as qt,aE as ce,b0 as Ss,a6 as Qt,ah as fr,c as yr,i as Ut,af as Zt,l as br,a7 as Nr,b7 as jr,a5 as zt,bE as vr,s as Bt,b1 as wr,y as Sr,cO as Pr}from"./ui-28e30067.js";import{u as Cr}from"./useDialog-6eb5c329.js";import{a as we,Q as kr,S as Dr,C as Ir,P as Z}from"./QualityCheckModal-849e9065.js";import{P as Rr}from"./PaymentsPopupModal-6fe61f19.js";import{S as _r}from"./SetPricingModal-84ffdd49.js";import"./currencyUtils-59109a41.js";import"./useBodyScrollLock-341c8b9f.js";const Tr=({purchaseOrderId:A,onViewDetails:x,onItemsReceived:J})=>{const[u,S]=i.useState(null),[E,oe]=i.useState(!0),[pe,t]=i.useState(!1);i.useEffect(()=>{Q()},[A]);const Q=async()=>{oe(!0);const I=await we.getQualityCheckSummary(A);I.success&&I.data&&S(I.data),oe(!1)},U=async()=>{if(u){t(!0);try{const I=await we.receiveQualityCheckedItems(u.qualityCheckId,A);I.success?(n.success(I.message||"Items received to inventory successfully"),J==null||J()):n.error(I.message||"Failed to receive items to inventory")}catch(I){console.error("Error receiving items:",I),n.error("Failed to receive items to inventory")}finally{t(!1)}}};if(E)return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-full"})]});if(!u)return e.jsx("div",{className:"p-6 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No quality check performed yet"})]})});const ae=I=>{switch(I){case"passed":return"bg-green-100 text-green-800 border-green-200";case"failed":return"bg-red-100 text-red-800 border-red-200";case"partial":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},Se=I=>{switch(I){case"passed":return e.jsx(W,{className:"w-5 h-5 text-green-600"});case"failed":return e.jsx(ge,{className:"w-5 h-5 text-red-600"});case"partial":return e.jsx(he,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(M,{className:"w-5 h-5 text-gray-600"})}},X=u.totalItems>0?Math.round(u.passedItems/u.totalItems*100):0;return e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Quality Check Summary"}),u.checkedAt&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Checked on ",new Date(u.checkedAt).toLocaleDateString()]})]})]}),e.jsx("div",{className:`px-4 py-2 rounded-full border ${ae(u.status)}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[Se(u.status),e.jsx("span",{className:"font-medium capitalize",children:u.status})]})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(M,{className:"w-4 h-4 text-gray-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Items"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.totalItems})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"w-4 h-4 text-green-600"}),e.jsx("p",{className:"text-sm text-green-700",children:"Passed"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:u.passedItems})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ge,{className:"w-4 h-4 text-red-600"}),e.jsx("p",{className:"text-sm text-red-700",children:"Failed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:u.failedItems})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(he,{className:"w-4 h-4 text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Pending"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:u.pendingItems})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pass Rate"}),e.jsxs("span",{className:"text-sm font-bold",children:[X,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all ${X>=90?"bg-green-500":X>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${X}%`}})})]}),u.overallResult&&e.jsx("div",{className:`p-4 rounded-lg border ${u.overallResult==="pass"?"bg-green-50 border-green-200":u.overallResult==="fail"?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[u.overallResult==="pass"&&e.jsx(W,{className:"w-5 h-5 text-green-600"}),u.overallResult==="fail"&&e.jsx(ge,{className:"w-5 h-5 text-red-600"}),u.overallResult==="conditional"&&e.jsx(he,{className:"w-5 h-5 text-yellow-600"}),e.jsx("div",{children:e.jsxs("p",{className:"font-medium",children:[u.overallResult==="pass"&&"All items passed quality check",u.overallResult==="fail"&&"Some items failed quality check",u.overallResult==="conditional"&&"Conditional approval required"]})})]})}),e.jsxs("div",{className:"mt-4 space-y-2",children:[u.passedItems>0&&e.jsxs("button",{onClick:U,disabled:pe,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx($e,{className:"w-4 h-4"}),pe?"Receiving...":"Receive to Inventory"]}),x&&e.jsxs("button",{onClick:()=>x(u.qualityCheckId),className:"w-full px-4 py-2 border border-blue-500 text-blue-600 rounded-lg hover:bg-blue-50 transition flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"View Detailed Report"]})]})]})]})},$r=({qualityCheckId:A,isOpen:x,onClose:J})=>{const[u,S]=i.useState(null),[E,oe]=i.useState([]),[pe,t]=i.useState(!1),[Q,U]=i.useState("overview");i.useEffect(()=>{x&&A&&A!==""?ae():x&&(!A||A==="")&&(S(null),oe([]),t(!1))},[x,A]);const ae=async()=>{if(!A||A===""||A==="undefined"){console.error("Invalid quality check ID:",A),t(!1);return}t(!0);try{const d=await we.getQualityCheck(A);d.success&&d.data&&S(d.data);const V=await we.getQualityCheckItems(A);V.success&&V.data&&oe(V.data)}catch(d){console.error("Error loading quality check details:",d)}finally{t(!1)}},Se=d=>{switch(d){case"passed":return"bg-green-100 text-green-800 border-green-200";case"failed":return"bg-red-100 text-red-800 border-red-200";case"partial":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},X=d=>{switch(d){case"pass":return e.jsx(W,{className:"w-4 h-4 text-green-600"});case"fail":return e.jsx(ge,{className:"w-4 h-4 text-red-600"});case"na":return e.jsx(ur,{className:"w-4 h-4 text-gray-400"});default:return e.jsx(he,{className:"w-4 h-4 text-gray-400"})}},I=d=>{switch(d){case"accept":return"bg-green-100 text-green-800";case"reject":return"bg-red-100 text-red-800";case"return":return"bg-orange-100 text-orange-800";case"replace":return"bg-blue-100 text-blue-800";case"repair":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},re=()=>{console.log("Export to PDF functionality coming soon")};return x?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Quality Check Details"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Quality Check ID: ",A?A.slice(0,8)+"...":"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:re,className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Ps,{className:"w-4 h-4"}),"Export PDF"]}),e.jsx("button",{onClick:J,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg",children:e.jsx(ue,{className:"w-5 h-5"})})]})]}),u&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full border ${Se(u.status)}`,children:[u.status==="passed"&&e.jsx(W,{className:"w-5 h-5"}),u.status==="failed"&&e.jsx(ge,{className:"w-5 h-5"}),u.status==="partial"&&e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium capitalize",children:u.status})]})})]}),e.jsx("div",{className:"border-b",children:e.jsx("div",{className:"flex space-x-8 px-6",children:[{id:"overview",label:"Overview",icon:G},{id:"items",label:"Items",icon:M},{id:"summary",label:"Summary",icon:Et}].map(d=>e.jsxs("button",{onClick:()=>U(d.id),className:`py-4 px-2 border-b-2 font-medium text-sm flex items-center gap-2 ${Q===d.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(d.icon,{className:"w-4 h-4"}),d.label]},d.id))})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:pe?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[Q==="overview"&&u&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Quality Check Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(dr,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Checked Date"}),e.jsx("p",{className:"font-medium",children:u.checkedAt?new Date(u.checkedAt).toLocaleDateString():"Not completed"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mr,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Checked By"}),e.jsx("p",{className:"font-medium",children:u.checkedBy||"Not specified"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Et,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Overall Result"}),e.jsx("p",{className:"font-medium capitalize",children:u.overallResult||"Pending"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Template Information"}),u.template?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Template Name"}),e.jsx("p",{className:"font-medium",children:u.template.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Category"}),e.jsx("p",{className:"font-medium capitalize",children:u.template.category})]}),u.template.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Description"}),e.jsx("p",{className:"font-medium",children:u.template.description})]})]}):e.jsx("p",{className:"text-gray-500",children:"No template information available"})]})]}),u.notes&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notes"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-4 h-4 text-gray-400 mt-1"}),e.jsx("p",{className:"text-gray-700",children:u.notes})]})})]})]}),Q==="items"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Quality Check Items"}),E.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No quality check items found"})]}):e.jsx("div",{className:"space-y-4",children:E.map((d,V)=>{var K;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-600 rounded-full text-sm font-medium",children:V+1}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:d.criteriaName}),((K=d.purchaseOrderItem)==null?void 0:K.product)&&e.jsxs("p",{className:"text-sm text-gray-600",children:[d.purchaseOrderItem.product.name,d.purchaseOrderItem.variant&&` - ${d.purchaseOrderItem.variant.name}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[X(d.result),e.jsx("span",{className:"font-medium capitalize",children:d.result})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Checked"}),e.jsx("p",{className:"font-bold",children:d.quantityChecked})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Passed"}),e.jsx("p",{className:"font-bold text-green-600",children:d.quantityPassed})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Failed"}),e.jsx("p",{className:"font-bold text-red-600",children:d.quantityFailed})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pass Rate"}),e.jsxs("p",{className:"font-bold",children:[d.quantityChecked>0?Math.round(d.quantityPassed/d.quantityChecked*100):0,"%"]})]})]}),(d.defectType||d.defectDescription)&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-red-800 mb-2",children:"Defect Information"}),d.defectType&&e.jsxs("p",{className:"text-sm text-red-700",children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",d.defectType]}),d.defectDescription&&e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Description:"})," ",d.defectDescription]})]}),d.actionTaken&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Action Taken: "}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${I(d.actionTaken)}`,children:d.actionTaken})]}),d.notes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:d.notes})]}),d.images&&d.images.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Images (",d.images.length,")"]}),e.jsx("div",{className:"flex gap-2",children:d.images.map((es,Ae)=>e.jsx("button",{className:"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center hover:bg-gray-300",children:e.jsx(xr,{className:"w-6 h-6 text-gray-400"})},Ae))})]})]},d.id)})})]}),Q==="summary"&&u&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Quality Check Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold",children:E.length})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-green-600",children:"Passed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:E.filter(d=>d.result==="pass").length})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-red-600",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:E.filter(d=>d.result==="fail").length})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-yellow-600",children:"N/A"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:E.filter(d=>d.result==="na").length})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Overall Results"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{children:"Overall Status"}),e.jsx("span",{className:"font-medium capitalize",children:u.status})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{children:"Overall Result"}),e.jsx("span",{className:"font-medium capitalize",children:u.overallResult||"Pending"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{children:"Completion Rate"}),e.jsxs("span",{className:"font-medium",children:[E.length>0?Math.round(E.filter(d=>d.result!=="na").length/E.length*100):0,"%"]})]})]})]}),E.some(d=>d.actionTaken)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Actions Taken Summary"}),e.jsx("div",{className:"space-y-2",children:["accept","reject","return","replace","repair"].map(d=>{const V=E.filter(K=>K.actionTaken===d).length;return V===0?null:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"capitalize",children:d}),e.jsxs("span",{className:"font-medium",children:[V," items"]})]},d)})})]})]})]})})]})}):null},Vr=({editMode:A=!1})=>{var yt,bt,Nt,jt,vt,wt,St,Pt,Ct,kt,Dt,It,Rt,_t,Tt,$t,At;const{currentUser:x}=lr(),{confirm:J}=Cr(),u=ir(),{id:S}=cr(),[E,oe]=or(),{updatePurchaseOrder:pe}=Je(),[t,Q]=i.useState(null),[U,ae]=i.useState(A),[Se,X]=i.useState(!0),[I,re]=i.useState(!1),[d,V]=i.useState(!1);i.useState(!1),i.useState(!1),i.useState(!1);const[K,es]=i.useState(!1),[Ae,Cs]=i.useState(!1),[ks,Ds]=i.useState(!1),[Ht,Is]=i.useState(!1),[Ar,Oe]=i.useState(!1),[Rs,_s]=i.useState(!1),[Ee,Ts]=i.useState(!1),[Vt,$s]=i.useState(!1),[As,Yt]=i.useState(null),[ss,Wt]=i.useState(null),[,Kt]=i.useState(0),[Os]=i.useState(!1),[Es]=i.useState(30);i.useState(!1);const[q,Fs]=i.useState("overview"),[Ms,Pe]=i.useState(!1),[Ls,Fe]=i.useState(!1),[Gt,ts]=i.useState(!1),[Me,de]=i.useState(!1),[Jt,qs]=i.useState(!1),[Qs,Le]=i.useState(!1),[as,rs]=i.useState("partial"),[Or,Us]=i.useState(!1),[ee,qe]=i.useState([]),[Zs,Qe]=i.useState(new Map),[zs,Bs]=i.useState(!1),se=s=>`po_receive_${S}_${s}`,Ue=s=>{if(S&&(s.receiveMode&&localStorage.setItem(se("mode"),s.receiveMode),s.serialNumberData&&localStorage.setItem(se("serials"),JSON.stringify(s.serialNumberData)),s.pricingData)){const a=Array.from(s.pricingData.entries());localStorage.setItem(se("pricing"),JSON.stringify(a))}},Xt=()=>{if(!S)return null;const s=localStorage.getItem(se("mode")),a=localStorage.getItem(se("serials")),l=localStorage.getItem(se("pricing"));return{receiveMode:s,serialNumberData:a?JSON.parse(a):null,pricingData:l?new Map(JSON.parse(l)):null}},Hs=()=>{S&&(localStorage.removeItem(se("mode")),localStorage.removeItem(se("serials")),localStorage.removeItem(se("pricing")))},[ea,ls]=i.useState(!1),[sa,Vs]=i.useState(!1),[ta,Ys]=i.useState("");i.useState(!1);const[aa,Ws]=i.useState(!1),[ra,Ks]=i.useState(!1),[la,Gs]=i.useState(!1),[na,ns]=i.useState(!1),[Ce,ia]=i.useState(30),[Ze,ca]=i.useState(""),[oa,le]=i.useState(!1),[is,ke]=i.useState(null),[Js,da]=i.useState(null),[H,Y]=i.useState("confirming"),[Xs,ma]=i.useState([]),[ze,et]=i.useState([]),[De,cs]=i.useState([]),[os,ds]=i.useState([]),[xa,Be]=i.useState(0),[ua,ms]=i.useState(0),st=3e4,[xs,tt]=i.useState([]),[,at]=i.useState(!1),[F,Ie]=i.useState([]),[rt,fe]=i.useState(!1),[lt,nt]=i.useState([]),[He,it]=i.useState(""),[ga,us]=i.useState(!1),[ne,Ve]=i.useState([]),[ha,gs]=i.useState(!1),[Re,hs]=i.useState([]),[pa,ct]=i.useState(!1),[me,fa]=i.useState(new Set(["overview"])),[ya,Ye]=i.useState(!1),[ye,ot]=i.useState([]),[ba,ps]=i.useState(!1),[Na,fs]=i.useState(!1),[te,ja]=i.useState(null),[,va]=i.useState([]),[ys,dt]=i.useState([]),[O,_e]=i.useState({search:"",status:"",location:"",dateFrom:"",dateTo:""}),be=s=>{if(!x)return!1;const a=x.permissions||[];if(a.includes("all"))return!0;const r={approve:"approve_purchase_orders",delete:"delete_purchase_orders",cancel:"delete_purchase_orders",edit:"edit_purchase_orders",create:"create_purchase_orders"}[s];return a.includes(r)||x.role==="admin"||x.role==="manager"?!0:x.role==="staff"?s==="edit"||s==="create":!1},L=i.useCallback(async()=>{var l,r,o,c,g,p,N,h,T,k,f,R,D,v,P;console.log(`üîÑ [PurchaseOrderDetailPage] Starting OPTIMIZED loadPurchaseOrder for ID: ${S}`);const s=Date.now();if(!S){console.error("‚ùå [PurchaseOrderDetailPage] No purchase order ID provided"),n.error("Purchase order ID is required"),u("/lats/purchase-orders");return}const a=S.trim();console.log(`üîç Validated purchase order ID: "${a}"`),X(!0);try{const[j,w,y]=await Promise.allSettled([(async()=>{const{getPurchaseOrder:b}=Je.getState();return await b(a)})(),C.fixOrderStatusIfNeeded(a,(x==null?void 0:x.id)||"").catch(b=>(console.warn("‚ö†Ô∏è Status auto-fix failed (non-critical):",b),{success:!1})),(async()=>{try{return null}catch(b){return console.warn("‚ö†Ô∏è Pricing check prep failed (non-critical):",b),!1}})()]),m=j.status==="fulfilled"?j.value:null,ie=w.status==="fulfilled"?w.value:null;if(m.ok){if(console.log("üîç [PurchaseOrderDetailPage] DEBUG - Purchase order data received:",{id:(l=m.data)==null?void 0:l.id,orderNumber:(r=m.data)==null?void 0:r.orderNumber,status:(o=m.data)==null?void 0:o.status,paymentStatus:(c=m.data)==null?void 0:c.paymentStatus,itemsCount:((p=(g=m.data)==null?void 0:g.items)==null?void 0:p.length)||0,hasSupplier:!!((N=m.data)!=null&&N.supplier),supplierName:((T=(h=m.data)==null?void 0:h.supplier)==null?void 0:T.name)||"No supplier",supplierId:(k=m.data)==null?void 0:k.supplierId,items:(R=(f=m.data)==null?void 0:f.items)==null?void 0:R.map(b=>({id:b.id,productId:b.productId,variantId:b.variantId,product:b.product,variant:b.variant,quantity:b.quantity,receivedQuantity:b.receivedQuantity||0,hasProductData:!!b.product,hasVariantData:!!b.variant}))}),m.data){if((!m.data.totalAmount||m.data.totalAmount===0)&&m.data.items&&m.data.items.length>0){const $=m.data.items.reduce((tr,Ge)=>{const ar=Ge.quantity||Ge.quantityOrdered||0,rr=Ge.costPrice||Ge.unitCost||0;return tr+ar*rr},0);m.data.totalAmount=$,console.log("‚úÖ Calculated missing totalAmount from items:",$)}m.data.items&&(m.data.items=m.data.items.map($=>({...$,quantity:$.quantity||$.quantityOrdered||0,costPrice:$.costPrice||$.unitCost||0})));const b=Number(m.data.totalAmount)||0,xe=Number(m.data.totalPaid)||0;let B=m.data.paymentStatus;b>0&&(xe>=b?B="paid":xe>0?B="partial":B="unpaid",B!==m.data.paymentStatus&&(m.data.paymentStatus=B,je.from("lats_purchase_orders").update({payment_status:B,updated_at:new Date().toISOString()}).eq("id",m.data.id).then(({error:$})=>{$&&console.error("‚ùå Failed to update payment status:",$)}))),Q(m.data);const Ke=Date.now();console.log(`‚úÖ [PurchaseOrderDetailPage] Purchase order loaded successfully in ${Ke-s}ms`),console.log("üìä [PurchaseOrderDetailPage] Order summary:",{orderNumber:m.data.orderNumber,status:m.data.status,totalAmount:m.data.totalAmount,currency:m.data.currency,itemsCount:((D=m.data.items)==null?void 0:D.length)||0,supplierName:(v=m.data.supplier)==null?void 0:v.name}),console.log("üí∞ [PurchaseOrderDetailPage] Loading payment and expense data for PO:",m.data.id);const Ot=Date.now();await Promise.allSettled([C.getPayments(m.data.id).then($=>{console.log("üí∞ [PurchaseOrderDetailPage] Setting payment history:",$),cs($),Be(Ot),console.log(`‚úÖ [PurchaseOrderDetailPage] Payment history state updated with ${$.length} payments`)}).catch($=>{console.warn("‚ùå [PurchaseOrderDetailPage] Failed to load payments:",$)}),C.getExpenses(m.data.id).then($=>{console.log("üí∞ [PurchaseOrderDetailPage] Setting expense history:",$),ds($),ms(Ot),console.log(`‚úÖ [PurchaseOrderDetailPage] Expense history state updated with ${$.length} expenses`)}).catch($=>{console.warn("‚ùå [PurchaseOrderDetailPage] Failed to load expenses:",$)})])}if(x!=null&&x.id&&((P=m.data)!=null&&P.id)){try{const b=await C.fixOrderStatusIfNeeded(m.data.id,x.id);if(b.success&&b.statusChanged){console.log("‚úÖ Order status automatically corrected:",b.message);const{getPurchaseOrder:xe}=Je.getState(),B=await xe(S);B.ok&&B.data&&Q(B.data)}else b.success||console.warn("‚ö†Ô∏è Could not auto-fix order status:",b.message)}catch(b){console.error("‚ö†Ô∏è Error during auto-fix order status (non-critical):",b)}try{if(m.data.status!=="completed"){const b=await C.hasPendingPricingItems(m.data.id);Us(b),b&&console.log("‚ö†Ô∏è Purchase order has items pending pricing")}else Us(!1)}catch(b){console.error("‚ö†Ô∏è Error checking pending pricing items (non-critical):",b)}}}else{const b=m.message||"Failed to load purchase order from server";console.error("‚ùå Failed to load purchase order:",{error:b,response:m,purchaseOrderId:a}),js("load_purchase_order",new Error(b),{purchaseOrderId:a,operation:"load_purchase_order"}),n.error(b),u("/lats/purchase-orders")}}catch(j){console.error("‚ùå Exception loading purchase order:",{error:j,purchaseOrderId:S,errorMessage:j instanceof Error?j.message:"Unknown error",errorStack:j instanceof Error?j.stack:void 0,timestamp:new Date().toISOString()}),js("load_purchase_order_exception",j,{purchaseOrderId:S,operation:"load_purchase_order"});let w="Failed to load purchase order";j instanceof Error&&(j.message.includes("network")||j.message.includes("fetch")?w="Network error: Please check your internet connection and try again":j.message.includes("timeout")?w="Request timeout: The server is taking too long to respond":j.message.includes("permission")||j.message.includes("unauthorized")?w="Permission denied: You do not have access to this purchase order":j.message.includes("not found")?w=`Purchase order with ID "${S}" not found`:w=`Error: ${j.message}`),n.error(w),u("/lats/purchase-orders")}finally{console.log("‚úÖ loadPurchaseOrder completed"),X(!1)}},[S,u,x==null?void 0:x.id]);i.useEffect(()=>{S&&L()},[S,L]),i.useEffect(()=>{if(S&&t&&!zs){const s=Xt();s&&(s.receiveMode||s.serialNumberData||s.pricingData)?(s.receiveMode&&rs(s.receiveMode),s.serialNumberData&&qe(s.serialNumberData),s.pricingData&&Qe(s.pricingData),Bs(!0),s.pricingData&&s.pricingData.size>0?(n.success("Resuming from pricing step..."),setTimeout(()=>Fe(!0),500)):s.serialNumberData&&s.serialNumberData.length>0?(n.success("Resuming from serial numbers step..."),setTimeout(()=>Pe(!0),500)):s.receiveMode&&(n.success("Resuming receive process..."),setTimeout(()=>de(!0),500))):Bs(!0)}},[S,t,zs]),i.useEffect(()=>{E.get("action")==="receive"&&t&&!Me&&(de(!0),E.delete("action"),oe(E,{replace:!0}))},[E,t,Me]),i.useEffect(()=>{ae(A)},[A]),i.useEffect(()=>{if(!F.length){dt([]);return}const s=F.filter(a=>{var p,N,h,T,k,f,R,D,v,P,j;const l=!O.search||((N=(p=a.product)==null?void 0:p.name)==null?void 0:N.toLowerCase().includes(O.search.toLowerCase()))||((T=(h=a.variant)==null?void 0:h.name)==null?void 0:T.toLowerCase().includes(O.search.toLowerCase()))||((k=a.serial_number)==null?void 0:k.toLowerCase().includes(O.search.toLowerCase()))||((f=a.imei)==null?void 0:f.toLowerCase().includes(O.search.toLowerCase()))||((D=(R=a.product)==null?void 0:R.sku)==null?void 0:D.toLowerCase().includes(O.search.toLowerCase())),r=!O.status||a.status===O.status,o=!O.location||((v=a.location)==null?void 0:v.toLowerCase().includes(O.location.toLowerCase()))||((P=a.shelf)==null?void 0:P.toLowerCase().includes(O.location.toLowerCase()))||((j=a.bin)==null?void 0:j.toLowerCase().includes(O.location.toLowerCase())),c=!O.dateFrom||new Date(a.created_at)>=new Date(O.dateFrom),g=!O.dateTo||new Date(a.created_at)<=new Date(O.dateTo);return l&&r&&o&&c&&g});dt(s)},[F,O]);const mt=i.useCallback(async(s=!1)=>{if(!(!S||!t))try{s&&$s(!0),console.log(`üîÑ [Autoload] ${s?"Background":"Manual"} refresh started for PO: ${S}`);const{getPurchaseOrder:a}=Je.getState(),l=await a(S);l.ok&&l.data&&(Q(l.data),Yt(new Date),Kt(r=>r+1),s&&console.log(`‚úÖ [Autoload] Background refresh completed for PO: ${S}`)),s&&await Promise.allSettled([C.getMessages(t.id).catch(r=>{console.warn("Failed to refresh messages:",r)}),C.getPayments(t.id).then(r=>{cs(r),Be(Date.now())}).catch(r=>{console.warn("Failed to refresh payments:",r)}),C.getExpenses(t.id).then(r=>{ds(r),ms(Date.now())}).catch(r=>{console.warn("Failed to refresh expenses:",r)}),C.getReceivedItems(t.id).then(r=>{r.success&&r.data&&Ie(r.data)}).catch(r=>{console.warn("Failed to refresh received items:",r)})])}catch(a){console.error("‚ùå [Autoload] Failed to refresh data:",a),s||n.error("Failed to refresh purchase order data")}finally{s&&$s(!1)}},[S,t]);i.useEffect(()=>{if(!S||!t||!Os)return;const s=setInterval(()=>{mt(!0)},Es*1e3);return Wt(s),()=>{s&&clearInterval(s)}},[S,t,mt,Os,Es]),i.useEffect(()=>()=>{ss&&clearInterval(ss)},[ss]),i.useEffect(()=>{F.length>0&&(async()=>{if(S)try{const a=await C.getPurchaseOrderInventoryStats(S);a.success&&va(a.data||[])}catch(a){console.error("Failed to load inventory stats:",a)}})()},[F.length,S]);const Ne=i.useCallback(async(s,a=!1)=>{var l,r,o,c;if(console.log("üîÑ [PurchaseOrderDetailPage] Tab changed to:",s,a?"(force refresh)":""),console.log("üìä [PurchaseOrderDetailPage] Current state:",{activeTab:q,loadedTabs:Array.from(me),purchaseOrderId:t==null?void 0:t.id,orderNumber:t==null?void 0:t.orderNumber}),Fs(s),!me.has(s)||a)switch(console.log("üì• [PurchaseOrderDetailPage] Loading data for tab:",s),a||fa(g=>new Set(Array.from(g).concat(s))),s){case"analytics":break;case"history":if(t)try{const g=await C.getAuditHistory(t.id);ma(g)}catch(g){console.error("Failed to load audit history:",g)}break;case"items":if(t){ct(!0),fe(!0);try{console.log("üîç [PurchaseOrderDetailPage] Loading purchase order items and received items for PO:",t.id);const g=await C.getPurchaseOrderItemsWithProducts(t.id);console.log("üîç [PurchaseOrderDetailPage] Purchase order items response:",g),g.success?(hs(g.data||[]),console.log("‚úÖ [PurchaseOrderDetailPage] Purchase order items loaded:",((l=g.data)==null?void 0:l.length)||0,"items")):(console.error("‚ùå Failed to load purchase order items:",g.message),n.error("Failed to load purchase order items"));const p=await C.getReceivedItems(t.id);console.log("üîç [PurchaseOrderDetailPage] Received items response:",p),p.success?(Ie(p.data||[]),console.log("‚úÖ [PurchaseOrderDetailPage] Received items loaded:",((r=p.data)==null?void 0:r.length)||0,"items")):(console.error("‚ùå Failed to load received items:",p.message),n.error("Failed to load received items"))}catch(g){console.error("‚ùå Failed to load items data:",g),n.error("Failed to load items data")}finally{ct(!1),fe(!1)}}break;case"received":if(t){fe(!0),at(!0);try{console.log("üîç [PurchaseOrderDetailPage] Loading received items for PO:",t.id);const g=await C.getReceivedItems(t.id);console.log("üîç [PurchaseOrderDetailPage] Received items response:",g),g.success?(Ie(g.data||[]),console.log("‚úÖ [PurchaseOrderDetailPage] Received items loaded:",((o=g.data)==null?void 0:o.length)||0,"items")):(console.error("‚ùå Failed to load received items:",g.message),n.error("Failed to load received items")),console.log("üîç [PurchaseOrderDetailPage] Loading quality check summary for PO:",t.id);const p=await we.getQualityCheckSummary(t.id);if(p.success&&p.data)if(console.log("‚úÖ [PurchaseOrderDetailPage] Quality check summary loaded:",p.data),p.data.qualityCheckId){const N=await we.getQualityCheckItems(p.data.qualityCheckId);N.success&&(tt(N.data||[]),console.log("‚úÖ [PurchaseOrderDetailPage] Quality check items loaded:",((c=N.data)==null?void 0:c.length)||0,"items"))}else console.log("‚ÑπÔ∏è [PurchaseOrderDetailPage] No quality check ID available for this purchase order"),tt([])}catch(g){console.error("‚ùå Failed to load received/quality check items:",g),n.error("Failed to load items")}finally{fe(!1),at(!1)}}break}},[me,x,t]);i.useCallback(()=>{L()},[L]);const We=i.useCallback(async()=>{var s;if(t){fe(!0);try{console.log("üîÑ [PurchaseOrderDetailPage] Refreshing received items for PO:",t.id);const a=await C.getReceivedItems(t.id);console.log("üîÑ [PurchaseOrderDetailPage] Received items refresh response:",a),a.success?(Ie(a.data||[]),console.log("‚úÖ [PurchaseOrderDetailPage] Received items refreshed:",((s=a.data)==null?void 0:s.length)||0,"items"),n.success("Received items refreshed")):(console.error("‚ùå Failed to refresh received items:",a.message),n.error("Failed to refresh received items"))}catch(a){console.error("‚ùå Failed to refresh received items:",a),n.error("Failed to refresh received items")}finally{fe(!1)}}},[t]),wa=async()=>{var a,l;if(!t)return;console.log("üíæ [PurchaseOrderDetailPage] Saving purchase order..."),console.log("üìù [PurchaseOrderDetailPage] Update data:",{orderId:t.id,orderNumber:t.orderNumber,supplierId:t.supplierId,itemsCount:((a=t.items)==null?void 0:a.length)||0}),re(!0);const s=await pe(t.id,{supplierId:t.supplierId,expectedDeliveryDate:t.expectedDeliveryDate,notes:t.notes,items:(l=t.items)==null?void 0:l.map(r=>({id:r.id,productId:r.productId,variantId:r.variantId,quantity:r.quantity,costPrice:r.costPrice}))});s.ok?(console.log("‚úÖ [PurchaseOrderDetailPage] Purchase order updated successfully"),n.success("Purchase order updated successfully"),ae(!1),await L()):(console.error("‚ùå [PurchaseOrderDetailPage] Failed to update purchase order:",s.message),n.error(s.message||"Failed to update purchase order")),re(!1)},Sa=async()=>{if(t){if(!be("delete")){n.error("You do not have permission to delete purchase orders");return}if(t.status!=="draft"){n.error("Only draft orders can be deleted");return}if(await J("Are you sure you want to delete this purchase order? This action cannot be undone."))try{Ds(!0);const s=await Z.deleteOrder(t.id);s.success?(n.success(s.message),u("/lats/purchase-orders")):n.error(s.message)}catch(s){console.error("Error deleting purchase order:",s),n.error("Failed to delete purchase order")}finally{Ds(!1)}}},Pa=async()=>{if(t){if(!be("approve")){n.error("You do not have permission to approve orders");return}if(t.status!=="draft"){n.error("Only draft orders can be approved");return}if(!t.items||t.items.length===0){n.error("Cannot approve order without items");return}try{V(!0);const s=await C.approvePurchaseOrder(t.id,(x==null?void 0:x.id)||"","Approved and sent to supplier");s.success?await C.updateOrderStatus(t.id,"sent",(x==null?void 0:x.id)||"")?(await L(),n.success("Order approved and sent to supplier")):(await L(),n.success("Order approved (mark as sent manually)")):n.error(s.message)}catch(s){console.error("Error approving and sending order:",s),n.error("Failed to approve and send order")}finally{V(!1)}}},Ca=async()=>{if(!t){n.error("No purchase order to print");return}try{Is(!0);const s=window.open("","_blank");if(s){const a=await Ga(t);s.document.write(a),s.document.close(),s.print(),n.success("Purchase order sent to printer")}else n.error("Could not open print window. Please check popup settings.")}catch(s){console.error("Error printing:",s),n.error("Failed to print purchase order")}finally{Is(!1)}},ka=()=>{if(!t){n.error("No purchase order to export");return}try{Oe(!0);const s=Ja(t),a=new Blob([s],{type:"application/pdf"}),l=window.URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download=`Purchase_Order_${t.orderNumber}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(l),n.success("PDF exported successfully")}catch(s){console.error("Error exporting PDF:",s),n.error("Failed to export PDF")}finally{Oe(!1)}},Da=async()=>{if(!t){n.error("No purchase order to export");return}try{Oe(!0);const s=await Ns(()=>import("./utils-ebb5cecb.js"),[]),a=Xa(t,s),l=s.write(a,{bookType:"xlsx",type:"array"}),r=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(r),c=document.createElement("a");c.href=o,c.download=`Purchase_Order_${t.orderNumber||"Unknown"}_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(o),n.success("Excel file exported successfully")}catch(s){console.error("Error exporting Excel:",s),n.error("Failed to export Excel file")}finally{Oe(!1)}},xt=async()=>{if(Ws(!0),t)try{const s=await C.getMessages(t.id);et(s)}catch(s){console.error("Failed to load communication history:",s)}},Ia=()=>{ls(!0)},Ra=async()=>{if(t)try{await L(),t.status==="received"?(n.success("Quality check completed successfully"),console.log("‚úÖ Quality check completed for received order")):(console.warn("‚ö†Ô∏è Quality check called on non-received status:",t.status),n.success("Quality check recorded"))}catch(s){console.error("Error during quality check:",s),n.error("Failed to complete quality check")}},_a=async()=>{var a;if(!t||!x)return;if(xs.length===0){n.error("No quality check found");return}const s=xs[0].qualityCheckId;re(!0);try{console.log("üîÑ Adding items to inventory...",{qualityCheckId:s,purchaseOrderId:t.id,profitMargin:Ce,location:Ze});const{data:l,error:r}=await je.rpc("add_quality_items_to_inventory_v2",{p_quality_check_id:s,p_purchase_order_id:t.id,p_user_id:x.id,p_profit_margin_percentage:Ce,p_default_location:Ze||null});if(r)throw console.error("‚ùå RPC Error:",r),r;const o=l;if(console.log("üì¶ Add to inventory result:",o),o&&o.success){console.log("‚úÖ Items added to inventory successfully:",o),n.success(o.message||`Successfully added ${o.items_added} items to inventory`),ns(!1),await L();const c=await C.getReceivedItems(t.id);c.success&&(Ie(c.data||[]),console.log("‚úÖ Received items refreshed:",((a=c.data)==null?void 0:a.length)||0)),Fs("received"),n.success('Items are now in inventory! Check the "Received" tab.')}else console.error("‚ùå Failed to add to inventory:",o==null?void 0:o.message),n.error((o==null?void 0:o.message)||"Failed to add items to inventory")}catch(l){console.error("‚ùå Error adding to inventory:",l),n.error(`Error adding items to inventory: ${l instanceof Error?l.message:"Unknown error"}`)}finally{re(!1)}},ut=async()=>{if(Gs(!0),t){const s=Date.now(),a=s-xa<st;if(De.length>0&&a){console.log("‚úÖ Using cached payment data");return}try{console.log("üîÑ Fetching fresh payment data...");const l=await C.getPayments(t.id);cs(l),Be(s),console.log(`‚úÖ Loaded ${l.length} payments`)}catch(l){console.error("Failed to load payment history:",l)}}},Ta=async()=>{if(t){const s=Date.now(),a=s-ua<st;if(os.length>0&&a){console.log("‚úÖ Using cached expense data");return}try{console.log("üîÑ Fetching fresh expense data...");const l=await C.getExpenses(t.id);ds(l),ms(s),console.log(`‚úÖ Loaded ${l.length} expenses`)}catch(l){console.error("Failed to load expense history:",l)}}},$a=()=>{var l;if(!((l=t==null?void 0:t.supplier)!=null&&l.phone)){n.error("Supplier phone number not available");return}const s=`Hello, I'm contacting you about Purchase Order #${t.orderNumber}. Please let me know the status.`,a=`https://wa.me/${t.supplier.phone.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(s)}`;window.open(a,"_blank")},Aa=async()=>{var s;if(!((s=t==null?void 0:t.supplier)!=null&&s.phone)){n.error("Supplier phone number not available");return}try{const a=`Purchase Order #${t.orderNumber} - Please provide status update.`,l=await Z.sendSMS(t.supplier.phone,a,t.id);l.success?(n.success(l.message),await Z.logAction(t.id,"sms_sent",{phone:t.supplier.phone})):n.error(l.message)}catch(a){console.error("Error sending SMS:",a),n.error("Failed to send SMS")}},Oa=async()=>{var s;if(t){if(!t.items||t.items.length===0){n.error("Cannot duplicate order without items");return}try{_s(!0);const a=await Z.duplicateOrder(t.id);a.success?(n.success(a.message),await Z.logAction(t.id,"order_duplicated",{new_order_id:(s=a.data)==null?void 0:s.id}),u(`/lats/purchase-orders/${a.data.id}`)):n.error(a.message)}catch(a){console.error("Error duplicating order:",a),n.error("Failed to duplicate order")}finally{_s(!1)}}},Ea=async()=>{if(Ks(!0),t)try{const s=await Z.getNotes(t.id);s.success&&nt(s.data||[])}catch(s){console.error("Failed to load notes:",s)}},Fa=async()=>{if(!(!He.trim()||!t))try{const s=await Z.addNote(t.id,He.trim(),(x==null?void 0:x.name)||"Unknown");s.success?(nt(a=>[s.data,...a]),it(""),n.success(s.message)):n.error(s.message)}catch(s){console.error("Error adding note:",s),n.error("Failed to add note")}},Ma=s=>{Ve(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s])},bs=async s=>{if(ne.length===0){n.error("Please select items first");return}try{let a;switch(s){case"update_status":a=await Z.bulkUpdateStatus(ne,"shipped");break;case"assign_location":const l=prompt("Enter location for selected items:");if(l)a=await Z.bulkAssignLocation(ne,l);else return;break;case"export_selected":n.success("Selected items exported successfully");return;default:n.error("Invalid bulk action");return}a!=null&&a.success&&(n.success(a.message),Ve([]),us(!1),await L(),t&&await Z.logAction(t.id,"bulk_action",{action:s,item_count:ne.length}))}catch(a){console.error("Error performing bulk action:",a),n.error("Failed to perform bulk action")}},La=async s=>{var a;if(t)try{const l=await Z.createReturnOrder(t.id,s);l.success?(n.success(l.message),gs(!1),await L(),await Z.logAction(t.id,"return_order_created",{return_id:(a=l.data)==null?void 0:a.id})):n.error(l.message)}catch(l){console.error("Error creating return order:",l),n.error("Failed to create return order")}},qa=()=>{if((t==null?void 0:t.paymentStatus)==="paid"){n.error("This purchase order has already been fully paid");return}const s=(t==null?void 0:t.totalAmount)||0,a=(t==null?void 0:t.totalPaid)||0;let l=s-a;if(t!=null&&t.currency&&t.currency!=="TZS"&&t.exchangeRate&&t.exchangeRate>1){const r=a/t.exchangeRate;l=s-r}if(s===0){n.error("Cannot make payment: Purchase order has no total amount. Please add items to the order first.");return}if(l<=0){n.error(`This purchase order has been fully paid. Total: ${s.toLocaleString()}, Paid: ${a.toLocaleString()}`);return}console.log("üí≥ Opening payment modal:",{totalAmount:s,totalPaid:a,remainingAmount:l,currency:t==null?void 0:t.currency,exchangeRate:t==null?void 0:t.exchangeRate}),ts(!0)},Qa=async(s,a)=>{try{const{purchaseOrderPaymentService:l}=await Ns(()=>import("./purchaseOrderPaymentService-dcbd50c0.js"),["assets/purchaseOrderPaymentService-dcbd50c0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),o=(await Promise.all(s.map(async c=>await l.processPayment({purchaseOrderId:(t==null?void 0:t.id)||"",paymentAccountId:c.paymentAccountId,amount:c.amount,currency:c.currency||"TZS",paymentMethod:c.paymentMethod,paymentMethodId:c.paymentMethodId,reference:c.reference,notes:c.notes,createdBy:(x==null?void 0:x.id)||null})))).filter(c=>!c.success);if(o.length>0){const c=o.map(g=>g.message).join("; ");n.error(`Some payments failed: ${c}`)}else{n.success("All payments processed successfully");try{t!=null&&t.id&&(await C.updatePaymentStatus(t.id),console.log("‚úÖ Purchase order payment status updated"))}catch(c){console.warn("‚ö†Ô∏è Failed to update payment status:",c)}}ts(!1),Be(0),await L(),setTimeout(()=>{window.location.reload()},500)}catch(l){console.error("Error processing payment:",l),n.error("Failed to process payment. Please try again.")}},Ua=async()=>{if(t){if(!be("cancel")){n.error("You do not have permission to cancel purchase orders");return}if(t.status==="completed"){n.error("Cannot cancel a completed order");return}if(t.status==="cancelled"){n.error("Order is already cancelled");return}if(!(t.paymentStatus==="paid"&&!J("This order has been fully paid. Cancelling will require a refund. Are you sure you want to continue?"))&&J("Are you sure you want to cancel this order? This action cannot be undone."))try{Cs(!0);const s=await Z.cancelOrder(t.id);s.success?(n.success(s.message),Q({...t,status:"cancelled"}),await L(),await Z.logAction(t.id,"order_cancelled",{reason:"user_cancelled"})):n.error(s.message)}catch(s){console.error("Error cancelling purchase order:",s),n.error("Failed to cancel purchase order")}finally{Cs(!1)}}},Za=async s=>{if(!t||!x)return;console.log("üí∞ Pricing data confirmed:",s),console.log("üì¶ Serial numbers to include:",ee),Qe(s),Ue({pricingData:s}),Fe(!1);const a=ee.reduce((r,o)=>r+(o.receivedQuantity||0),0),l=ee.filter(r=>r.receivedQuantity>0).length;Y("confirming"),le(!0),ke({title:"Ready to Add to Inventory",message:`You're about to add ${a} items (${l} products) to inventory${ee.some(r=>{var o;return((o=r.serialNumbers)==null?void 0:o.length)>0})?" with serial numbers":""}.`,onConfirm:async()=>{var r,o,c,g,p;try{es(!0),Y("processing");let N=0;for(const[P,j]of s.entries()){const w=t.items.find(y=>y.id===P);if(w&&w.variantId)try{console.log(`üí∞ Updating variant ${w.variantId} with selling price: ${j.selling_price}`);const{error:y}=await je.from("lats_product_variants").update({selling_price:j.selling_price,cost_price:j.cost_price,updated_at:new Date().toISOString()}).eq("id",w.variantId);y?(console.error("Error updating variant price:",y),n.error(`Failed to update price for ${((r=w.product)==null?void 0:r.name)||"item"}`)):(console.log(`‚úÖ Variant ${w.variantId} price updated successfully`),N++)}catch(y){console.error("Error updating variant:",y),n.error("Error updating variant prices")}}console.log(`üí∞ Updated ${N} variant prices`),ee.length>0&&(console.log("üì¶ Saving serial numbers..."),(await C.updateReceivedQuantities(t.id,ee,x.id)).success&&n.success("Serial numbers saved!")),await new Promise(P=>setTimeout(P,500));const h=new Map;ee.forEach(P=>{h.set(P.id,P.receivedQuantity)});let T=!0,k=0,f=0,R=0;for(const P of t.items){const j=P.quantity,w=P.receivedQuantity||0,y=h.get(P.id)||0,m=w+y;k+=j,f+=y,R+=w,m<j&&(T=!1)}const D=as==="partial"&&!T;console.log("üìä Receiving stats:",{mode:as,totalOrdered:k,totalAlreadyReceived:R,totalReceiving:f,totalAfterReceiving:R+f,allItemsFullyReceived:T,isPartialReceive:D}),console.log(D?"üì¶ Processing partial receive...":"üì¶ Processing full/final receive...");const v=await C.completeReceive(t.id,x.id,D?`Partial receive: ${f} of ${k} items`:"Complete receive of purchase order with pricing and serial numbers");if(console.log("üì¶ Receive result:",v),v.success){try{const{data:w,error:y}=await je.from("inventory_items").select("id, variant_id").eq("purchase_order_id",t.id);if(!y&&w)for(const m of w){const ie=t.items.find(b=>b.variantId===m.variant_id);if(ie){const b=s.get(ie.id);b&&(await je.from("inventory_items").update({selling_price:b.selling_price,cost_price:b.cost_price,status:"available",updated_at:new Date().toISOString()}).eq("id",m.id),console.log(`‚úÖ Updated inventory item ${m.id} with selling price: ${b.selling_price} and status: available`))}}}catch(w){console.error("Error updating inventory item prices:",w)}const P=(o=v.data)==null?void 0:o.new_status,j=(c=v.data)==null?void 0:c.is_complete;if(console.log("üìä Database result:",{status:P,isComplete:j,totalReceived:(g=v.data)==null?void 0:g.total_received,totalOrdered:(p=v.data)==null?void 0:p.total_ordered}),j||T)n.success("üéâ All items received! Purchase order complete!",{duration:6e3}),qe([]),Qe(new Map),Hs(),Y("success"),setTimeout(()=>{le(!1),ke(null),Y("confirming"),n.success("Returning to purchase orders list...",{duration:2e3}),setTimeout(()=>{u("/lats/purchase-orders")},500)},2e3);else{const w=k-(R+f);if(n.success(`‚úÖ Items added to inventory! ${w} items remaining to receive.`,{duration:5e3}),v.summary){console.log("Receive summary:",v.summary);const y=v.summary;n.success(`Received: ${y.total_received||0}/${y.total_ordered||0} items (${y.percent_received||0}% complete)`,{duration:5e3})}qe([]),Qe(new Map),Hs(),await L(),q==="received"&&(console.log("üîÑ Refreshing received items tab after receive operation"),await We()),await Ne("received",!0),console.log("üìã Switched to received tab to show received items"),Y("success"),setTimeout(()=>{le(!1),ke(null),Y("confirming")},2e3)}}else console.error("‚ùå Receive failed:",v),n.error(`Receive failed: ${v.message||"Unknown error"}`),v.message&&v.message.includes("status")&&n.error(`Current status: ${t.status}. Try changing status to 'shipped' first.`,{duration:6e3}),Y("confirming"),le(!1)}catch(N){console.error("Receive error:",N),n.error(`Failed to receive purchase order: ${N instanceof Error?N.message:"Unknown error"}`),Y("confirming"),le(!1)}finally{es(!1)}}}),Y("confirming"),le(!0)},za=async()=>{if(t){if(t.status!=="received"){n.error("Order must be received before completing");return}if(t.paymentStatus!=="paid"){n.error("Order must be fully paid before completing");return}Ye(!0)}},Ba=()=>{var l,r,o,c,g;if(!t)return;const s=`
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           PURCHASE ORDER RECEIPT
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      
      Order Number: ${t.orderNumber}
      Supplier: ${((l=t.supplier)==null?void 0:l.name)||"N/A"}
      Order Date: ${new Date(t.orderDate||t.createdAt).toLocaleDateString()}
      Status: ${t.status.toUpperCase()}
      
      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      ITEMS SUMMARY
      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      Total Items: ${((r=t.items)==null?void 0:r.length)||0}
      Total Ordered: ${((o=t.items)==null?void 0:o.reduce((p,N)=>p+(N.quantity||0),0))||0}
      Total Received: ${((c=t.items)==null?void 0:c.reduce((p,N)=>p+(N.receivedQuantity||0),0))||0}
      
      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      FINANCIAL SUMMARY
      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      Total Amount: ${t.currency||"TZS"} ${Number(t.totalAmount||0).toLocaleString()}
      Payment Status: ${((g=t.paymentStatus)==null?void 0:g.toUpperCase())||"UNPAID"}
      
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      Thank you for your business!
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    `,a=window.open("","_blank");a&&(a.document.write(`
        <html>
          <head>
            <title>Purchase Order Receipt - ${t.orderNumber}</title>
            <style>
              body {
                font-family: 'Courier New', monospace;
                padding: 20px;
                max-width: 800px;
                margin: 0 auto;
              }
              pre {
                white-space: pre-wrap;
                font-size: 14px;
                line-height: 1.6;
              }
              @media print {
                body { padding: 0; }
              }
            </style>
          </head>
          <body>
            <pre>${s}</pre>
            <script>
              window.onload = () => {
                window.print();
                // Uncomment to auto-close after printing
                // setTimeout(() => window.close(), 100);
              };
            <\/script>
          </body>
        </html>
      `),a.document.close())},Ha=()=>{var r,o,c,g,p;if(!t)return;const s=`
*PURCHASE ORDER COMPLETED* ‚úÖ

*Order Number:* ${t.orderNumber}
*Supplier:* ${((r=t.supplier)==null?void 0:r.name)||"N/A"}
*Order Date:* ${new Date(t.orderDate||t.createdAt).toLocaleDateString()}
*Status:* ${t.status.toUpperCase()}

*Items Summary:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Total Items: ${((o=t.items)==null?void 0:o.length)||0}
‚Ä¢ Total Ordered: ${((c=t.items)==null?void 0:c.reduce((N,h)=>N+(h.quantity||0),0))||0}
‚Ä¢ Total Received: ${((g=t.items)==null?void 0:g.reduce((N,h)=>N+(h.receivedQuantity||0),0))||0}

*Financial Summary:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Total Amount: ${t.currency||"TZS"} ${Number(t.totalAmount||0).toLocaleString()}
‚Ä¢ Payment Status: ${((p=t.paymentStatus)==null?void 0:p.toUpperCase())||"UNPAID"}

Thank you for your business! üôè
    `.trim(),l=`https://wa.me/?text=${encodeURIComponent(s)}`;window.open(l,"_blank")},Va=async()=>{if(t)try{Ts(!0),Ye(!1);const s=await C.checkCompletionStatus(t.id);if(s.success&&s.data&&(console.log("üìä Current completion status:",s.data),!s.data.can_complete&&s.data.total_items>0)){console.log("üîß Attempting to fix received quantities..."),n.success("Fixing received quantities...");const l=await C.fixReceivedQuantities(t.id,(x==null?void 0:x.id)||"");l.success?(n.success("Received quantities fixed successfully!"),console.log("‚úÖ Fix result:",l.data)):console.warn("‚ö†Ô∏è Fix attempt failed:",l.message)}const a=await C.completePurchaseOrder(t.id,(x==null?void 0:x.id)||"","Purchase order completed after receiving all items");if(a.success)n.success("Purchase order completed successfully!"),console.log("‚úÖ Order completion details:",a.data),await L(),a.data&&console.log("üìä Completion Summary:",{orderNumber:a.data.po_number,totalItems:a.data.total_items,completedItems:a.data.completed_items,completionDate:a.data.completion_date});else{let l=a.message||"Completion failed";a.error_code==="P0001"?l="Cannot complete: Not all items have been fully received. Please check the received quantities.":a.error_code==="P0002"?l="Cannot complete: Purchase order is not in received status.":a.error_code==="P0003"&&(l="Cannot complete: No items found in this purchase order."),n.error(l),console.error("‚ùå Completion failed:",{error_code:a.error_code,message:a.message,data:a.data})}}catch(s){console.error("Completion error:",s),n.error("Failed to complete purchase order")}finally{Ts(!1)}},Ya=async s=>{var l;if(console.log(`üîÑ Starting handlePartialReceive for ${s.length} items`),!t){console.error("‚ùå No purchase order available for partial receive"),n.error("No purchase order available");return}if(!s||s.length===0){console.error("‚ùå No items provided for partial receive"),n.error("No items provided for receiving");return}const a=s.filter(r=>r.id?typeof r.receivedQuantity!="number"||r.receivedQuantity<0?(console.warn("‚ö†Ô∏è Invalid received quantity:",r),!1):!0:(console.warn("‚ö†Ô∏è Item missing ID:",r),!1));if(a.length===0){console.error("‚ùå No valid items found for partial receive"),n.error("No valid items found for receiving");return}console.log(`‚úÖ Validated ${a.length} items for partial receive`);try{re(!0),console.log("üîÑ Processing partial receive with new stock update function...");const{data:r,error:o}=await je.rpc("partial_purchase_order_receive",{purchase_order_id_param:t.id,received_items:a.map(c=>({item_id:c.id,quantity:c.receivedQuantity})),user_id_param:(x==null?void 0:x.id)||"",receive_notes:"Partial receive from UI"});if(console.log("üîç Partial receive result:",{data:r,error:o}),o){console.error("‚ùå Partial receive error:",o),n.error(`Partial receive failed: ${o.message}`);return}if(r&&r.success){console.log("‚úÖ Partial receive completed successfully");const c=(l=r.data)!=null&&l.is_complete?"All items fully received - Order marked as received":"Partial receive completed";n.success(`${c}: ${r.message}`),console.log("üîÑ Reloading purchase order to get updated data..."),await L(),q==="received"&&(console.log("üîÑ Refreshing received items tab after partial receive operation"),await We()),latsEventBus.emit("lats:purchase-order.received",{purchaseOrderId:t.id,userId:x==null?void 0:x.id,notes:"Partial receive"}),qs(!1)}else console.error("‚ùå Function returned failure:",r),n.error(`Partial receive failed: ${(r==null?void 0:r.message)||"Unknown error"}`)}catch(r){console.error("‚ùå Exception in partial receive:",{error:r,purchaseOrderId:t.id,receivedItemsCount:s.length,errorMessage:r instanceof Error?r.message:"Unknown error",errorStack:r instanceof Error?r.stack:void 0,timestamp:new Date().toISOString()}),js("partial_receive_exception",r,{purchaseOrderId:t.id,operation:"partial_receive"});let o="Failed to process partial receive";r instanceof Error&&(r.message.includes("network")||r.message.includes("fetch")?o="Network error: Please check your internet connection and try again":r.message.includes("timeout")?o="Request timeout: The server is taking too long to respond":r.message.includes("validation")?o=`Validation error: ${r.message}`:o=`Error: ${r.message}`),n.error(o)}finally{console.log("‚úÖ handlePartialReceive completed"),re(!1)}},Wa=async s=>{!t||!x||(console.log("üì¶ Serial numbers captured:",s),qe(s),Ue({serialNumberData:s}),Pe(!1),n.success("Serial numbers saved! Now set pricing..."),setTimeout(()=>{Fe(!0)},300))},Ka=async s=>{if(!(!s.trim()||!t))try{if(await C.sendMessage({purchaseOrderId:t.id,sender:(x==null?void 0:x.name)||"You",content:s,type:"user"})){const l={id:Date.now().toString(),sender:(x==null?void 0:x.name)||"You",content:s,timestamp:new Date().toISOString(),type:"user"};et(r=>[l,...r]),n.success("Message sent successfully")}else n.error("Failed to send message")}catch{n.error("Failed to send message")}},Ga=async s=>{var c,g,p,N,h,T,k;const{businessInfoService:a}=await Ns(()=>import("./index-61458a34.js").then(f=>f.b7),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),l=await a.getBusinessInfo(),r={name:l.name,address:l.address,phone:l.phone,email:l.email||"",website:l.website||"",logo:l.logo||""},o=(f,R)=>{if(!R)return"N/A";const D=new Date(f),v=R.toLowerCase();if(v.includes("net 30"))D.setDate(D.getDate()+30);else if(v.includes("net 15"))D.setDate(D.getDate()+15);else if(v.includes("net 7"))D.setDate(D.getDate()+7);else if(v.includes("cod"))return"COD (Cash on Delivery)";return z(D.toISOString())};return`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Purchase Order ${s.orderNumber}</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              margin: 0; 
              padding: 20px; 
              font-size: 12px;
              line-height: 1.4;
            }
            .header { 
              text-align: center; 
              margin-bottom: 30px; 
              border-bottom: 2px solid #333;
              padding-bottom: 20px;
            }
            .business-info {
              text-align: center;
              margin-bottom: 20px;
              font-size: 14px;
            }
            .business-info h1 {
              margin: 0;
              font-size: 24px;
              color: #333;
            }
            .business-info p {
              margin: 2px 0;
              color: #666;
            }
            .business-details {
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 20px;
              margin-top: 15px;
              text-align: left;
            }
            .business-column {
              background-color: #f8f9fa;
              padding: 10px;
              border-radius: 5px;
            }
            .order-details {
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 20px;
              margin-bottom: 30px;
            }
            .order-info, .supplier-info {
              border: 1px solid #ddd;
              padding: 15px;
              background-color: #f9f9f9;
            }
            .order-info h3, .supplier-info h3 {
              margin: 0 0 10px 0;
              font-size: 14px;
              color: #333;
              border-bottom: 1px solid #ccc;
              padding-bottom: 5px;
            }
            .order-info p, .supplier-info p {
              margin: 5px 0;
              font-size: 11px;
            }
            .items-table { 
              width: 100%; 
              border-collapse: collapse; 
              margin-bottom: 20px; 
              font-size: 11px;
            }
            .items-table th, .items-table td { 
              border: 1px solid #ddd; 
              padding: 8px; 
              text-align: left; 
            }
            .items-table th { 
              background-color: #f2f2f2; 
              font-weight: bold;
            }
            .items-table td {
              vertical-align: top;
            }
            .totals-section {
              margin-top: 20px;
              text-align: right;
            }
            .totals-table {
              width: 300px;
              margin-left: auto;
              border-collapse: collapse;
            }
            .totals-table td {
              padding: 5px 10px;
              border: 1px solid #ddd;
            }
            .totals-table .label {
              background-color: #f2f2f2;
              font-weight: bold;
              text-align: left;
            }
            .totals-table .amount {
              text-align: right;
            }
            .totals-table .total-row {
              background-color: #e9e9e9;
              font-weight: bold;
              font-size: 14px;
            }
            .payment-info {
              margin-top: 20px;
              padding: 15px;
              border: 1px solid #ddd;
              background-color: #f9f9f9;
            }
            .payment-info h3 {
              margin: 0 0 15px 0;
              font-size: 14px;
              color: #333;
              border-bottom: 1px solid #ccc;
              padding-bottom: 5px;
            }
            .payment-details {
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 20px;
            }
            .payment-column {
              display: flex;
              flex-direction: column;
              gap: 8px;
            }
            .notes-section {
              margin-top: 20px;
              padding: 15px;
              border: 1px solid #ddd;
              background-color: #f9f9f9;
            }
            .notes-section h3 {
              margin: 0 0 10px 0;
              font-size: 14px;
              color: #333;
            }
            .footer {
              margin-top: 40px;
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 40px;
              border-top: 1px solid #ddd;
              padding-top: 20px;
            }
            .signature-box {
              text-align: center;
              border: 1px solid #ddd;
              padding: 20px;
              background-color: #f9f9f9;
            }
            .signature-box .line {
              border-bottom: 1px solid #333;
              height: 40px;
              margin-bottom: 5px;
            }
            .terms {
              margin-top: 20px;
              font-size: 10px;
              color: #666;
              border-top: 1px solid #ddd;
              padding-top: 10px;
            }
          </style>
        </head>
        <body>
          <!-- Business Header -->
          <div class="business-info">
            ${r.logo?`<img src="${r.logo}" alt="${r.name} Logo" style="height: 60px; width: auto; margin: 0 auto 10px auto; display: block; object-fit: contain;" />`:""}
            <h1>${r.name}</h1>
            <div class="business-details">
              <div class="business-column">
                <p><strong>Address:</strong> ${r.address}</p>
                <p><strong>Phone:</strong> ${r.phone}</p>
              </div>
              <div class="business-column">
                <p><strong>Email:</strong> ${r.email}</p>
                <p><strong>Website:</strong> ${r.website}</p>
              </div>
            </div>
          </div>

          <!-- Purchase Order Header -->
          <div class="header">
            <h1>PURCHASE ORDER</h1>
            <h2>Order #${s.orderNumber}</h2>
          </div>
          
          <!-- Order and Supplier Details -->
          <div class="order-details">
            <div class="order-info">
              <h3>Order Information</h3>
              <p><strong>Order Date:</strong> ${z(s.orderDate||s.createdAt)}</p>
              <p><strong>Expected Delivery:</strong> ${s.expectedDeliveryDate?z(s.expectedDeliveryDate):"TBD"}</p>
              <p><strong>Status:</strong> ${s.status.toUpperCase()}</p>
              <p><strong>Currency:</strong> ${s.currency==="TZS"?"Tanzania Shillings (TZS)":s.currency||"Tanzania Shillings (TZS)"}</p>
              ${s.receivedDate?`<p><strong>Received Date:</strong> ${z(s.receivedDate)}</p>`:""}
            </div>
            
            <div class="supplier-info">
              <h3>Supplier Information</h3>
              <p><strong>Company:</strong> ${((c=s.supplier)==null?void 0:c.name)||"N/A"}</p>
              ${(g=s.supplier)!=null&&g.contactPerson?`<p><strong>Contact Person:</strong> ${s.supplier.contactPerson}</p>`:""}
              ${(p=s.supplier)!=null&&p.phone?`<p><strong>Phone:</strong> ${s.supplier.phone}</p>`:""}
              ${(N=s.supplier)!=null&&N.email?`<p><strong>Email:</strong> ${s.supplier.email}</p>`:""}
              ${(h=s.supplier)!=null&&h.address?`<p><strong>Address:</strong> ${s.supplier.address}</p>`:""}
              ${(T=s.supplier)!=null&&T.city?`<p><strong>City:</strong> ${s.supplier.city}</p>`:""}
              ${(k=s.supplier)!=null&&k.country?`<p><strong>Country:</strong> ${s.supplier.country}</p>`:""}
            </div>
          </div>
          
          <!-- Items Table -->
          <table class="items-table">
            <thead>
              <tr>
                <th style="width: 28%;">Product Description</th>
                <th style="width: 18%;">Variant</th>
                <th style="width: 10%;">Ordered</th>
                <th style="width: 10%;">Received</th>
                <th style="width: 14%;">Unit Price</th>
                <th style="width: 14%;">Price (TZS)</th>
                <th style="width: 14%;">Total (TZS)</th>
                <th style="width: 8%;">Status</th>
              </tr>
            </thead>
            <tbody>
              ${s.items.map(f=>{var P,j,w,y;const R=f.receivedQuantity||0,D=s.exchangeRate&&s.exchangeRate!==1?f.costPrice*s.exchangeRate:f.costPrice,v=D*f.quantity;return`
                <tr>
                  <td>
                    <strong>${((P=f.product)==null?void 0:P.name)||`Product ${f.productId}`}</strong>
                    ${(j=f.product)!=null&&j.description?`<br><small>${f.product.description}</small>`:""}
                    ${(w=f.product)!=null&&w.sku?`<br><small>SKU: ${f.product.sku}</small>`:""}
                  </td>
                  <td>${((y=f.variant)==null?void 0:y.name)||`Variant ${f.variantId}`}</td>
                  <td style="text-align: center; font-weight: bold;">${f.quantity}</td>
                  <td style="text-align: center; color: ${R>0?"#28a745":"#6c757d"};">${R}</td>
                  <td style="text-align: right;">${_(f.costPrice,s.currency)}</td>
                  <td style="text-align: right; color: #2c5aa0; font-weight: bold;">TZS ${D.toLocaleString()}</td>
                  <td style="text-align: right; color: #2c5aa0; font-weight: bold;">TZS ${v.toLocaleString()}</td>
                  <td style="text-align: center;">
                    <span style="font-size: 10px; padding: 2px 6px; border-radius: 3px; background-color: ${f.status==="received"?"#d4edda":f.status==="shipped"?"#cfe2ff":f.status==="cancelled"?"#f8d7da":"#e2e3e5"}; color: ${f.status==="received"?"#155724":f.status==="shipped"?"#084298":f.status==="cancelled"?"#721c24":"#383d41"};">
                      ${(f.status||"pending").toUpperCase()}
                    </span>
                  </td>
                </tr>
              `}).join("")}
            </tbody>
          </table>
          
          <!-- Totals Section -->
          <div class="totals-section">
            <table class="totals-table">
              <tr>
                <td class="label">Subtotal:</td>
                <td class="amount">${_(s.totalAmount,s.currency)}</td>
              </tr>
              ${s.exchangeRate&&s.exchangeRate!==1&&s.totalAmountBaseCurrency?`
                <tr>
                  <td class="label">Exchange Rate:</td>
                  <td class="amount">${s.exchangeRate} (${s.exchangeRateSource||"Manual"})</td>
                </tr>
                <tr>
                  <td class="label">TZS Equivalent:</td>
                  <td class="amount">TZS ${s.totalAmountBaseCurrency.toLocaleString()}</td>
                </tr>
              `:""}
              <tr class="total-row">
                <td class="label">TOTAL AMOUNT:</td>
                <td class="amount">${_(s.totalAmount,s.currency)}</td>
              </tr>
            </table>
          </div>

          <!-- Payment Information -->
          <div class="payment-info">
            <h3>Payment Information</h3>
            <div class="payment-details">
              <div class="payment-column">
                <p><strong>Payment Terms:</strong> Net 30</p>
                <p><strong>Payment Due Date:</strong> ${o(s.orderDate||s.createdAt,"Net 30")}</p>
                <p><strong>Payment Status:</strong> 
                  <span style="padding: 2px 8px; border-radius: 3px; background-color: ${s.paymentStatus==="paid"?"#d4edda":s.paymentStatus==="partial"?"#fff3cd":"#f8d7da"}; color: ${s.paymentStatus==="paid"?"#155724":s.paymentStatus==="partial"?"#856404":"#721c24"};">
                    ${(s.paymentStatus||"unpaid").toUpperCase()}
                  </span>
                </p>
              </div>
              <div class="payment-column">
                <p><strong>Total Paid:</strong> ${_(s.totalPaid||0,s.currency)}</p>
                <p><strong>Balance Due:</strong> ${_((s.totalAmount||0)-(s.totalPaid||0),s.currency)}</p>
                <p><strong>Payment Method:</strong> TBD</p>
              </div>
            </div>
          </div>
          
          <!-- Notes Section -->
          ${s.notes?`
            <div class="notes-section">
              <h3>Order Notes</h3>
              <p>${s.notes}</p>
            </div>
          `:""}

          <!-- Footer with Signatures -->
          <div class="footer">
            <div class="signature-box">
              <div class="line"></div>
              <p><strong>Authorized Signature</strong></p>
              <p>Date: _______________</p>
            </div>
            <div class="signature-box">
              <div class="line"></div>
              <p><strong>Supplier Signature</strong></p>
              <p>Date: _______________</p>
            </div>
          </div>

          <!-- Terms and Conditions -->
          <div class="terms">
            <p><strong>Terms and Conditions:</strong></p>
            <p>1. All prices are subject to change without notice.</p>
            <p>2. Payment terms as specified above.</p>
            <p>3. Delivery terms: FOB destination unless otherwise specified.</p>
            <p>4. Any discrepancies must be reported within 48 hours of delivery.</p>
            <p>5. This purchase order is subject to our standard terms and conditions.</p>
          </div>
        </body>
      </html>
    `},Ja=s=>{var l,r,o,c,g,p,N;const a={name:"LATS CHANCE STORE",address:"Dar es Salaam, Tanzania",phone:"+255 XXX XXX XXX",email:"info@latschance.com"};return`
LATS CHANCE STORE
${a.address}
Phone: ${a.phone} | Email: ${a.email}

PURCHASE ORDER #${s.orderNumber}

ORDER INFORMATION:
Date: ${z(s.orderDate||s.createdAt)}
Expected Delivery: ${s.expectedDeliveryDate?z(s.expectedDeliveryDate):"TBD"}
Status: ${s.status.toUpperCase()}
Currency: ${s.currency==="TZS"?"Tanzania Shillings (TZS)":s.currency||"Tanzania Shillings (TZS)"}
${s.receivedDate?`Received Date: ${z(s.receivedDate)}`:""}

SUPPLIER INFORMATION:
Company: ${((l=s.supplier)==null?void 0:l.name)||"N/A"}
${(r=s.supplier)!=null&&r.contactPerson?`Contact Person: ${s.supplier.contactPerson}`:""}
${(o=s.supplier)!=null&&o.phone?`Phone: ${s.supplier.phone}`:""}
${(c=s.supplier)!=null&&c.email?`Email: ${s.supplier.email}`:""}
${(g=s.supplier)!=null&&g.address?`Address: ${s.supplier.address}`:""}
${(p=s.supplier)!=null&&p.city?`City: ${s.supplier.city}`:""}
${(N=s.supplier)!=null&&N.country?`Country: ${s.supplier.country}`:""}

ITEMS:
${s.items.map((h,T)=>{var D,v,P;const k=h.receivedQuantity||0,f=s.exchangeRate&&s.exchangeRate!==1?h.costPrice*s.exchangeRate:h.costPrice,R=f*h.quantity;return`
${T+1}. ${((D=h.product)==null?void 0:D.name)||`Product ${h.productId}`}
   Variant: ${((v=h.variant)==null?void 0:v.name)||`Variant ${h.variantId}`}
   ${(P=h.product)!=null&&P.sku?`SKU: ${h.product.sku}`:""}
   Ordered: ${h.quantity} | Received: ${k}
   Unit Price: ${_(h.costPrice,s.currency)} (TZS ${f.toLocaleString()})
   Total: TZS ${R.toLocaleString()}
   Status: ${(h.status||"pending").toUpperCase()}
`}).join("")}

PAYMENT INFORMATION:
Payment Terms: ${s.paymentTerms||"Net 30"}
Payment Status: ${(s.paymentStatus||"unpaid").toUpperCase()}
Total Paid: ${_(s.totalPaid||0,s.currency)}
Balance Due: ${_((s.totalAmount||0)-(s.totalPaid||0),s.currency)}

TOTALS:
Subtotal: ${_(s.totalAmount,s.currency)}
${s.exchangeRate&&s.exchangeRate!==1&&s.totalAmountBaseCurrency?`
Exchange Rate: ${s.exchangeRate} (${s.exchangeRateSource||"Manual"})
TZS Equivalent: TZS ${s.totalAmountBaseCurrency.toLocaleString()}
`:""}
TOTAL AMOUNT: ${_(s.totalAmount,s.currency)}

${s.notes?`NOTES:
${s.notes}
`:""}

SIGNATURES:
Authorized Signature: _________________ Date: _______________
Supplier Signature: _________________ Date: _______________

TERMS AND CONDITIONS:
1. All prices are subject to change without notice.
2. Payment terms as specified above.
3. Delivery terms: FOB destination unless otherwise specified.
4. Any discrepancies must be reported within 48 hours of delivery.
5. This purchase order is subject to our standard terms and conditions.
    `},Xa=(s,a)=>{var f,R,D,v,P,j,w;const l=a.utils.book_new(),r=[["LATS CHANCE STORE","","",""],["Purchase Order Summary","","",""],["","","",""],["ORDER INFORMATION","","",""],["Order Number:",s.orderNumber,"",""],["Order Date:",z(s.orderDate||s.createdAt),"",""],["Expected Delivery:",s.expectedDeliveryDate?z(s.expectedDeliveryDate):"TBD","",""],["Status:",s.status.toUpperCase(),"",""],["Currency:",s.currency==="TZS"?"Tanzania Shillings (TZS)":s.currency||"Tanzania Shillings (TZS)","",""],["","","",""],["SUPPLIER INFORMATION","","",""],["Company:",((f=s.supplier)==null?void 0:f.name)||"N/A","",""],["Contact Person:",((R=s.supplier)==null?void 0:R.contactPerson)||"","",""],["Phone:",((D=s.supplier)==null?void 0:D.phone)||"","",""],["Email:",((v=s.supplier)==null?void 0:v.email)||"","",""],["Address:",((P=s.supplier)==null?void 0:P.address)||"","",""],["City:",((j=s.supplier)==null?void 0:j.city)||"","",""],["Country:",((w=s.supplier)==null?void 0:w.country)||"","",""],["","","",""],["PAYMENT INFORMATION","","",""],["Payment Terms:","Net 30","",""],["Payment Status:",(s.paymentStatus||"unpaid").toUpperCase(),"",""],["Total Paid:",_(s.totalPaid||0,s.currency),"",""],["Balance Due:",_((Number(s.totalAmount)||0)-(Number(s.totalPaid)||0),s.currency),"",""],["","","",""],["TOTALS","","",""],["Subtotal:",_(Number(s.totalAmount)||0,s.currency),"",""],...s.exchangeRate&&s.exchangeRate!==1&&s.totalAmountBaseCurrency?[["Exchange Rate:",`${s.exchangeRate} (${s.exchangeRateSource||"Manual"})`,"",""],["TZS Equivalent:",`TZS ${s.totalAmountBaseCurrency.toLocaleString()}`,"",""]]:[],["TOTAL AMOUNT:",_(Number(s.totalAmount)||0,s.currency),"",""]],o=a.utils.aoa_to_sheet(r);o["!cols"]=[{wch:20},{wch:30},{wch:15},{wch:15}],a.utils.book_append_sheet(l,o,"Summary");const c=[["Product Description","Variant","Ordered Qty","Received Qty","Unit Price","Price (TZS)","Total (TZS)","Status","SKU"]];s.items.forEach(y=>{var xe,B,Ke;const m=y.receivedQuantity||0,ie=s.exchangeRate&&s.exchangeRate!==1?y.costPrice*s.exchangeRate:y.costPrice,b=ie*y.quantity;c.push([((xe=y.product)==null?void 0:xe.name)||`Product ${y.productId}`,((B=y.variant)==null?void 0:B.name)||`Variant ${y.variantId}`,y.quantity.toString(),m.toString(),_(y.costPrice,s.currency),`TZS ${ie.toLocaleString()}`,`TZS ${b.toLocaleString()}`,(y.status||"pending").toUpperCase(),((Ke=y.product)==null?void 0:Ke.sku)||""])});const g=s.items.reduce((y,m)=>y+m.quantity,0),p=s.items.reduce((y,m)=>y+(m.receivedQuantity||0),0),N=s.items.reduce((y,m)=>{const ie=s.exchangeRate&&s.exchangeRate!==1?m.costPrice*s.exchangeRate:m.costPrice;return y+ie*m.quantity},0);c.push(["TOTALS","",g.toString(),p.toString(),"","",`TZS ${N.toLocaleString()}`,"",""]);const h=a.utils.aoa_to_sheet(c);h["!cols"]=[{wch:30},{wch:20},{wch:12},{wch:12},{wch:15},{wch:15},{wch:15},{wch:12},{wch:15}];const T=a.utils.decode_range(h["!ref"]||"A1");for(let y=T.s.c;y<=T.e.c;y++){const m=a.utils.encode_cell({r:0,c:y});h[m]&&(h[m].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"4472C4"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}})}const k=c.length-1;for(let y=0;y<c[0].length;y++){const m=a.utils.encode_cell({r:k,c:y});h[m]&&(h[m].s={font:{bold:!0},fill:{fgColor:{rgb:"F2F2F2"}},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}})}return a.utils.book_append_sheet(l,h,"Items"),l},gt=s=>{switch(s){case"draft":return"text-yellow-600 bg-yellow-100";case"sent":return"text-blue-600 bg-blue-100";case"confirmed":return"text-purple-600 bg-purple-100";case"received":return"text-green-600 bg-green-100";case"cancelled":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},ht=s=>{switch(s){case"draft":return e.jsx(G,{className:"w-4 h-4"});case"sent":return e.jsx(zt,{className:"w-4 h-4"});case"confirmed":return e.jsx(Te,{className:"w-4 h-4"});case"received":return e.jsx(Te,{className:"w-4 h-4"});case"cancelled":return e.jsx(Pr,{className:"w-4 h-4"});default:return e.jsx(Sr,{className:"w-4 h-4"})}},_=(s,a="TZS")=>{const l=isNaN(s)?0:s,r=new Intl.NumberFormat("en-TZ",{minimumFractionDigits:0,maximumFractionDigits:2}).format(l);switch(a==null?void 0:a.toUpperCase()){case"TZS":return`TZS ${r}`;case"USD":return`$${r}`;case"EUR":return`‚Ç¨${r}`;case"GBP":return`¬£${r}`;case"AED":return`AED ${r}`;case"CNY":return r;default:return`${a} ${r}`}},pt=(s,a)=>{if(!a||a.length===0)return 0;const l=a.reduce((r,o)=>r+(o.quantity||0),0);return l===0?0:s/l},er=s=>{const a=[];return s.currency||a.push("Currency not set - defaulting to TZS"),s.currency&&s.currency!=="TZS"&&((!s.exchangeRate||s.exchangeRate===1)&&a.push("Exchange rate missing for non-TZS currency"),s.totalAmountBaseCurrency||a.push("Base currency amount not calculated")),a},ft=(s,a,l)=>a==="TZS"||!l||l===1?s:Math.round(s*l),sr=s=>s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),z=s=>{if(!s)return"Not set";const a=new Date(s);return isNaN(a.getTime())?"Not set":a.toLocaleDateString("en-KE",{year:"numeric",month:"long",day:"numeric"})};return Se?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),e.jsx("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading purchase order..."})]})})})]}):t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:()=>u("/lats/purchase-orders")}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:`flex items-center justify-between p-6 border-b flex-shrink-0 ${U?"border-blue-200 bg-blue-50":"border-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${U?"bg-gradient-to-br from-blue-500 to-blue-600":"bg-gradient-to-br from-blue-500 to-indigo-600"}`,children:e.jsx(G,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t.orderNumber}),U&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Editing Mode"]}),Vt&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin"}),"Auto-refreshing..."]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${gt(t.status)}`,children:[ht(t.status),e.jsx("span",{className:"capitalize",children:t.status})]}),e.jsxs("span",{className:"ml-2",children:["Created ",z(t.createdAt)]}),As&&e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["‚Ä¢ Last updated: ",As.toLocaleTimeString()]})]})]})]}),e.jsx("button",{onClick:()=>u("/lats/purchase-orders"),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex space-x-8 px-6",children:[e.jsx("button",{onClick:()=>Ne("overview"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${q==="overview"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Overview"]})}),e.jsx("button",{onClick:()=>Ne("supplier"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${q==="supplier"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4"}),"Supplier"]})}),e.jsx("button",{onClick:()=>Ne("items"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${q==="items"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Items & Inventory",F.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full",children:F.length})]})}),e.jsx("button",{onClick:()=>Ne("analytics"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${q==="analytics"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"w-4 h-4"}),"Analytics"]})}),e.jsx("button",{onClick:()=>Ne("history"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${q==="history"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-4 h-4"}),"History"]})})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[q==="overview"&&e.jsx(e.Fragment,{children:t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Xe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Order Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Order Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:t.orderNumber})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${gt(t.status)}`,children:[ht(t.status),e.jsx("span",{className:"capitalize",children:t.status})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created Date"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:z(t.createdAt)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:z(t.updatedAt)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Expected Delivery"}),U?e.jsx("input",{type:"date",value:t.expectedDeliveryDate?new Date(t.expectedDeliveryDate).toISOString().split("T")[0]:"",onChange:s=>Q(a=>a?{...a,expectedDeliveryDate:s.target.value?new Date(s.target.value).toISOString():void 0}:null),className:"w-full p-2 border border-gray-300 rounded-lg text-sm"}):e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.expectedDeliveryDate?z(t.expectedDeliveryDate):"Not set"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Currency"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.currency||"TZS"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(ws,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Financial Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Amount"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:_(t.totalAmount,t.currency)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Items Count"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:((yt=t.items)==null?void 0:yt.length)||0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Quantity"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:((bt=t.items)==null?void 0:bt.reduce((s,a)=>s+(a.quantity||0),0))||0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Received"}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:((Nt=t.items)==null?void 0:Nt.reduce((s,a)=>s+(a.receivedQuantity||0),0))||0})]}),t.exchangeRate&&t.exchangeRate!==1&&t.totalAmountBaseCurrency&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"TZS Equivalent"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["TZS ",t.totalAmountBaseCurrency.toLocaleString()]})]}),t.exchangeRate&&t.exchangeRate!==1&&e.jsxs("div",{className:"col-span-2 space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Exchange Rate"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["1 ",t.currency," = ",Math.round(parseFloat(t.exchangeRate.toString()))," TZS",t.exchangeRateSource&&t.exchangeRateSource!=="default"&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",t.exchangeRateSource,")"]})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(G,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Notes"})]}),U?e.jsx("textarea",{value:t.notes||"",onChange:s=>Q(a=>a?{...a,notes:s.target.value}:null),className:"w-full p-3 border border-gray-300 rounded-lg resize-none text-sm",rows:4,placeholder:"Add notes for this purchase order..."}):t.notes?e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed bg-gray-50 rounded-lg p-3",children:t.notes}):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No notes added"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(gr,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Actions"})]}),e.jsx("div",{className:"space-y-2",children:U?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:wa,disabled:I,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(hr,{className:"w-4 h-4"}),I?"Saving...":"Save Changes"]}),e.jsxs("button",{onClick:()=>ae(!1),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(ue,{className:"w-4 h-4"}),"Cancel Edit"]})]}):e.jsxs(e.Fragment,{children:[t.status==="draft"&&e.jsxs(e.Fragment,{children:[be("approve")&&e.jsxs("button",{onClick:Pa,disabled:d||I,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium shadow-lg shadow-green-600/20","aria-label":"Approve and send purchase order",children:[e.jsx(Te,{className:"w-4 h-4"}),d?"Processing...":"Approve & Send to Supplier"]}),be("delete")&&e.jsxs("button",{onClick:Sa,disabled:ks||I,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm","aria-label":"Delete purchase order",children:[e.jsx(pr,{className:"w-4 h-4"}),ks?"Deleting...":"Delete Order"]})]}),(t.status==="sent"||t.status==="shipped")&&e.jsx(e.Fragment,{children:t.paymentStatus!=="paid"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-orange-50 border-2 border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(qt,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-orange-900 mb-1",children:"Payment Required"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Complete payment before receiving this order"})]})]})}),e.jsxs("button",{onClick:qa,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium shadow-lg shadow-orange-600/20","aria-label":"Make payment for purchase order",children:[e.jsx(ce,{className:"w-4 h-4"}),"Make Payment"]}),be("cancel")&&e.jsxs("button",{onClick:Ua,disabled:Ae,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(ge,{className:"w-4 h-4"}),Ae?"Cancelling...":"Cancel Order"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-green-50 border-2 border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold text-green-900",children:"Payment Complete - Ready to Receive"})]})}),e.jsxs("button",{onClick:()=>de(!0),disabled:K,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium shadow-lg shadow-green-600/20","aria-label":"Receive purchase order",children:[e.jsx(M,{className:"w-4 h-4"}),K?"Receiving...":"Receive Order"]})]})}),(()=>{var a;const s=((a=t.items)==null?void 0:a.some(l=>{const r=l.receivedQuantity||0,o=l.quantity||0;return r<o}))||!1;return t.status==="partial_received"&&t.paymentStatus==="paid"&&s&&e.jsxs("button",{onClick:()=>de(!0),disabled:K,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium shadow-lg shadow-blue-600/20","aria-label":"Continue receiving items",children:[e.jsx(M,{className:"w-4 h-4"}),K?"Receiving...":"Continue Receiving"]})})(),t.status==="received"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:za,disabled:Ee,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium shadow-lg shadow-green-600/20","aria-label":"Complete purchase order",children:[e.jsx(W,{className:"w-4 h-4"}),Ee?"Completing...":"Complete Order"]}),e.jsxs("button",{onClick:Ia,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx($e,{className:"w-4 h-4"}),"Quality Check (Optional)"]})]}),t.status==="completed"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(W,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Order Completed"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"This purchase order has been successfully completed and all items are in inventory"})]}),t.status==="cancelled"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ge,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Order Cancelled"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"This purchase order has been cancelled and cannot be processed further"})]}),(t.status==="received"||t.status==="partial_received")&&e.jsxs("button",{onClick:()=>gs(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(Ss,{className:"w-4 h-4"}),"Return Order"]})]})}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3",children:"Documents & More"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:Ca,disabled:Ht,className:"flex items-center justify-center gap-2 px-3 py-2 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm","aria-label":"Print purchase order",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Print"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Le(!Qs),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(Ps,{className:"w-4 h-4"}),"Export"]}),Qs&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>Le(!1)}),e.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white border border-gray-200 rounded-lg shadow-xl z-20 min-w-[160px]",children:[e.jsxs("button",{onClick:()=>{ka(),Le(!1)},className:"w-full text-left px-4 py-2.5 hover:bg-gray-50 text-sm flex items-center gap-2 text-gray-700",children:[e.jsx(G,{className:"w-4 h-4"}),"Export as PDF"]}),e.jsxs("button",{onClick:()=>{Da(),Le(!1)},className:"w-full text-left px-4 py-2.5 hover:bg-gray-50 text-sm border-t flex items-center gap-2 text-gray-700",children:[e.jsx(fr,{className:"w-4 h-4"}),"Export as Excel"]})]})]})]}),e.jsxs("button",{onClick:Ea,className:"flex items-center justify-center gap-2 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-colors font-medium text-sm","aria-label":"View and add notes",children:[e.jsx(G,{className:"w-4 h-4"}),"Notes"]}),(t.status==="completed"||t.status==="cancelled")&&e.jsxs("button",{onClick:Oa,disabled:Rs,className:"flex items-center justify-center gap-2 px-3 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors font-medium text-sm","aria-label":"Duplicate this order",children:[e.jsx(yr,{className:"w-4 h-4"}),Rs?"Duplicating...":"Duplicate"]}),e.jsxs("button",{onClick:()=>us(!0),className:"flex items-center justify-center gap-2 px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium text-sm","aria-label":"Bulk actions on items",children:[e.jsx(Ut,{className:"w-4 h-4"}),"Bulk Actions"]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-100",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(Mt,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Order Summary"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((jt=t.items)==null?void 0:jt.length)||0}),e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-wide",children:"Items"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:((vt=t.items)==null?void 0:vt.reduce((s,a)=>s+(a.quantity||0),0))||0}),e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-wide",children:"Quantity"})]})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((wt=t.items)==null?void 0:wt.reduce((s,a)=>s+(a.receivedQuantity||0),0))||0}),e.jsx("div",{className:"text-xs text-green-700 uppercase tracking-wide",children:"Received"})]}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900 mb-1",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:_(t.totalAmount,t.currency)}),t.exchangeRate&&t.exchangeRate!==1&&t.totalAmountBaseCurrency&&e.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:["TZS ",t.totalAmountBaseCurrency.toLocaleString()]})]})})]})]})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Xe,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading Order Details"}),e.jsx("p",{className:"text-gray-500",children:"Please wait while we load the purchase order information..."})]})})}),q==="supplier"&&e.jsxs("div",{className:"space-y-6",children:[(()=>(console.log("üîç [Supplier Tab] Debug supplier data:",{hasSupplier:!!t.supplier,supplier:t.supplier,supplierId:t.supplierId}),null))(),t.supplier?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(vs,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Supplier Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.name})]}),t.supplier.contactPerson&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Contact Person"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.contactPerson})]}),t.supplier.phone&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Phone"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.phone})]}),t.supplier.email&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.email})]}),t.supplier.country&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Country"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.country})]}),t.supplier.currency&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Preferred Currency"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.currency})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Zt,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Supplier Performance"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Rating"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.rating?`${t.supplier.rating}/5`:"Not Rated"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Lead Time"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.leadTime?`${t.supplier.leadTime} days`:"Not Set"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Orders"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.totalOrders||0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"On-Time Delivery"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.supplier.onTimeDeliveryRate?`${t.supplier.onTimeDeliveryRate}%`:"Not Tracked"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Communication History"})]}),e.jsx("button",{onClick:xt,className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),e.jsx("div",{className:"space-y-2",children:ze.length>0?ze.slice(0,3).map((s,a)=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.type}),e.jsx("p",{className:"text-xs text-gray-600",children:s.message})]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.date?typeof s.date=="string"?s.date:new Date(s.date).toLocaleString():s.timestamp?new Date(s.timestamp).toLocaleString():"N/A"})]})},a)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No communication history"})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(vs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No supplier information available"})]})]}),q==="items"&&e.jsxs("div",{className:"space-y-6",children:[t&&e.jsx(Tr,{purchaseOrderId:t.id,onViewDetails:s=>{console.log("View quality check details:",s),Ys(s),Vs(!0)},onItemsReceived:async()=>{await L(),await We()}}),pa?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading purchase order items..."})]})}):Re.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No items in this order"})]}):e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(M,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-800",children:["Order Items (",Re.length," items)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden sm:table-cell",children:"Variant"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Quantity"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden md:table-cell",children:"Cost Price"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden md:table-cell",children:"Set Price"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Total"}),t.exchangeRate&&t.exchangeRate!==1&&e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden lg:table-cell",children:"TZS Total"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Received"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:Re.map((s,a)=>{var r,o,c,g;const l=s.quantity>0?s.receivedQuantity/s.quantity*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:((r=s.product)==null?void 0:r.name)||`Product ${s.productId}`}),e.jsx("p",{className:"text-xs text-gray-500 sm:hidden",children:((o=s.variant)==null?void 0:o.name)||"Default"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",((c=s.product)==null?void 0:c.sku)||s.productId]})]})}),e.jsx("td",{className:"p-3 text-sm hidden sm:table-cell",children:((g=s.variant)==null?void 0:g.name)||"Default"}),e.jsx("td",{className:"p-3",children:U?e.jsx("input",{type:"number",min:"1",value:s.quantity,onChange:p=>{const N=parseInt(p.target.value)||1,h=[...Re];h[a]={...s,quantity:N},hs(h)},className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"}):e.jsx("span",{className:"font-medium text-sm text-gray-900",children:s.quantity})}),e.jsx("td",{className:"p-3 text-sm hidden md:table-cell",children:U?e.jsx("input",{type:"number",min:"0",step:"0.01",value:s.costPrice,onChange:p=>{const N=parseFloat(p.target.value)||0,h=[...Re];h[a]={...s,costPrice:N},hs(h)},className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm"}):_(s.costPrice,t.currency)}),e.jsx("td",{className:"p-3 text-sm hidden md:table-cell",children:(()=>{const p=F.filter(k=>k.product_id===s.productId&&k.variant_id===s.variantId);if(p.length===0)return e.jsx("span",{className:"text-gray-400",children:"Not set"});const N=p.map(k=>Number(k.selling_price)||0).filter(k=>k>0);if(N.length===0)return e.jsx("span",{className:"text-gray-400",children:"Not set"});const h=Math.min(...N),T=Math.max(...N);return h===T?e.jsxs("span",{className:"font-medium text-green-600",children:["TZS ",h.toLocaleString()]}):e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"text-green-600 font-medium",children:["TZS ",h.toLocaleString()," - ",T.toLocaleString()]}),e.jsx("div",{className:"text-gray-500",children:"(Range)"})]})})()}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium text-sm text-gray-900",children:_((s.quantity||0)*(s.costPrice||0),t.currency)})}),t.exchangeRate&&t.exchangeRate!==1&&e.jsx("td",{className:"p-3 text-sm hidden lg:table-cell",children:e.jsxs("span",{className:"text-gray-600",children:["TZS ",((s.quantity||0)*(s.costPrice||0)*(t.exchangeRate||1)).toLocaleString()]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium text-sm text-gray-900",children:s.receivedQuantity})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l>=100?"bg-green-100 text-green-700":l>0?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-700"}`,children:l>=100?"Complete":l>0?"Partial":"Pending"})})]},a)})})]})})]}),F.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(br,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Search & Filter Inventory"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search products, SKU, serial...",value:O.search,onChange:s=>_e(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:O.status,onChange:s=>_e(a=>({...a,status:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"sold",children:"Sold"}),e.jsx("option",{value:"reserved",children:"Reserved"}),e.jsx("option",{value:"damaged",children:"Damaged"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Location"}),e.jsx("input",{type:"text",placeholder:"Filter by location...",value:O.location,onChange:s=>_e(a=>({...a,location:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>_e({search:"",status:"",location:"",dateFrom:"",dateTo:""}),className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Clear"})})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-green-600"}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-800",children:["Inventory Items (",ys.length," of ",F.length," items)"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:We,className:"text-xs text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1",disabled:rt,children:[e.jsx(Ss,{className:`w-3 h-3 ${rt?"animate-spin":""}`}),"Refresh"]})})]}),ys.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($e,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No items match your filters"}),e.jsx("button",{onClick:()=>_e({search:"",status:"",location:"",dateFrom:"",dateTo:""}),className:"mt-2 text-sm text-blue-600 hover:text-blue-700",children:"Clear all filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden sm:table-cell",children:"Variant"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Serial Number / IMEI"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden lg:table-cell",children:"Location"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Cost"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Selling Price"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Received Date"})]})}),e.jsx("tbody",{children:ys.map((s,a)=>{var l,r,o,c;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:((l=s.product)==null?void 0:l.name)||`Product ${s.product_id}`}),e.jsx("p",{className:"text-xs text-gray-500 sm:hidden",children:((r=s.variant)==null?void 0:r.name)||`Variant ${s.variant_id}`}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",((o=s.product)==null?void 0:o.sku)||s.product_id]})]})}),e.jsx("td",{className:"p-3 text-sm hidden sm:table-cell",children:((c=s.variant)==null?void 0:c.name)||`Variant ${s.variant_id}`}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[s.serial_number&&e.jsx("div",{className:"font-mono text-sm text-gray-900",children:s.serial_number}),s.imei&&e.jsxs("div",{className:"font-mono text-xs text-gray-600",children:["IMEI: ",s.imei]}),!s.serial_number&&!s.imei&&e.jsx("span",{className:"text-gray-400",children:"-"}),s.barcode&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Barcode: ",s.barcode]})]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="available"?"bg-green-100 text-green-700":s.status==="sold"?"bg-blue-100 text-blue-700":s.status==="damaged"?"bg-red-100 text-red-700":s.status==="reserved"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:s.status})}),e.jsx("td",{className:"p-3 text-sm hidden lg:table-cell",children:s.location?e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-900",children:s.location}),s.shelf&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Shelf: ",s.shelf]}),s.bin&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Bin: ",s.bin]})]}):e.jsx("span",{className:"text-gray-400",children:"Not assigned"})}),e.jsx("td",{className:"p-3 text-sm",children:e.jsxs("span",{className:"font-medium text-gray-900",children:["TZS ",(s.cost_price||0).toLocaleString()]})}),e.jsx("td",{className:"p-3 text-sm",children:e.jsxs("span",{className:"font-medium text-gray-900",children:["TZS ",(s.selling_price||0).toLocaleString()]})}),e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"text-sm text-gray-900",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleTimeString()})]})]},a)})})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:F.filter(s=>s.status==="available").length}),e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Available"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["TZS ",F.filter(s=>s.status==="available").reduce((s,a)=>s+(Number(a.cost_price)||0),0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:F.filter(s=>s.status==="sold").length}),e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Sold"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["TZS ",F.filter(s=>s.status==="sold").reduce((s,a)=>s+(Number(a.selling_price)||Number(a.cost_price)||0),0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-600",children:F.filter(s=>s.status==="reserved").length}),e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Reserved"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["TZS ",F.filter(s=>s.status==="reserved").reduce((s,a)=>s+(Number(a.cost_price)||0),0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:F.filter(s=>s.status==="damaged").length}),e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Damaged"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["TZS ",F.filter(s=>s.status==="damaged").reduce((s,a)=>s+(Number(a.cost_price)||0),0).toLocaleString()]})]})]})]})]})]}),!1,!1,q==="analytics"&&!me.has("analytics")&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})}),q==="analytics"&&me.has("analytics")&&e.jsxs("div",{className:"space-y-6",children:[(()=>{const s=er(t);return s.length>0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),e.jsx("h4",{className:"text-sm font-semibold text-yellow-800",children:"Currency Issues Detected"})]}),e.jsx("ul",{className:"text-xs text-yellow-700 space-y-1",children:s.map((a,l)=>e.jsxs("li",{children:["‚Ä¢ ",a]},l))})]}):null})(),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Nr,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Cost Analysis"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("div",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded",children:t.currency||"TZS"}),t.exchangeRate&&t.exchangeRate!==1&&e.jsxs("div",{className:"px-2 py-1 bg-orange-100 text-orange-700 text-xs font-medium rounded",children:["1 ",t.currency," = ",sr(t.exchangeRate)," TZS"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-green-700 uppercase tracking-wide mb-1",children:"Total Cost"}),e.jsx("div",{className:"text-lg font-bold text-green-900",children:_(t.totalAmount,t.currency)}),t.exchangeRate&&t.exchangeRate!==1&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["‚âà TZS ",t.totalAmountBaseCurrency?t.totalAmountBaseCurrency.toLocaleString():ft(t.totalAmount,t.currency||"USD",t.exchangeRate).toLocaleString()]})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Avg Cost/Item"}),e.jsx("div",{className:"text-lg font-bold text-blue-900",children:_(pt(t.totalAmount,t.items),t.currency)}),t.exchangeRate&&t.exchangeRate!==1&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["‚âà TZS ",ft(pt(t.totalAmount,t.items),t.currency||"USD",t.exchangeRate).toLocaleString()]})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-purple-700 uppercase tracking-wide mb-1",children:"Total Quantity"}),e.jsx("div",{className:"text-lg font-bold text-purple-900",children:((St=t.items)==null?void 0:St.reduce((s,a)=>s+(a.quantity||0),0))||0})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 uppercase tracking-wide mb-1",children:"Items Count"}),e.jsx("div",{className:"text-lg font-bold text-orange-900",children:((Pt=t.items)==null?void 0:Pt.length)||0})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(M,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Inventory Impact"})]}),e.jsx("div",{className:"space-y-3",children:(Ct=t.items)==null?void 0:Ct.map((s,a)=>{var c,g,p,N,h,T,k,f;const l=((p=(g=(c=s.product)==null?void 0:c.variants)==null?void 0:g.find(R=>R.id===s.variantId))==null?void 0:p.quantity)||0,r=l+s.quantity,o=r<=(((T=(h=(N=s.product)==null?void 0:N.variants)==null?void 0:h.find(R=>R.id===s.variantId))==null?void 0:T.minQuantity)||0);return e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((k=s.product)==null?void 0:k.name)||`Product ${s.productId}`}),e.jsx("p",{className:"text-xs text-gray-500",children:((f=s.variant)==null?void 0:f.name)||`Variant ${s.variantId}`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Current: ",l]}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["+",s.quantity," ‚Üí ",r]}),o&&e.jsx("p",{className:"text-xs text-orange-600",children:"Low Stock Warning"})]})]},a)})})]})]}),q==="history"&&!me.has("history")&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading history..."})]})}),q==="history"&&me.has("history")&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Lt,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Audit Trail"})]}),e.jsx("div",{className:"space-y-2",children:Xs.length>0?Xs.map((s,a)=>e.jsxs("div",{className:"flex justify-between items-start p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.action}),e.jsx("p",{className:"text-xs text-gray-600",children:s.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:["By: ",s.user]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.timestamp?new Date(s.timestamp).toLocaleString():"N/A"})]},a)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No audit history available"})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Payment History"})]}),e.jsx("button",{onClick:ut,className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),e.jsx("div",{className:"space-y-2",children:De.length>0?De.slice(0,3).map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.method||"Payment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s.amount||0)}),s.currency&&e.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full font-medium",children:s.currency})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.timestamp?new Date(s.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-700":s.status==="pending"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:s.status})]})]},a)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No payment history"})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(jr,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Expense History"})]}),e.jsx("button",{onClick:Ta,className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),e.jsx("div",{className:"space-y-2",children:os.length>0?os.slice(0,3).map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.category||"Expense"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s.amount||0)}),s.currency&&e.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full font-medium",children:s.currency})]}),s.accountName&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Account: ",s.accountName]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.timestamp?new Date(s.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A"}),s.reference&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Ref: ",s.reference]})]})]},a)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No expense history"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 bg-gray-50 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:xt,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(ve,{className:"w-4 h-4"}),"Communication"]}),e.jsxs("button",{onClick:$a,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium text-sm",title:"Send WhatsApp message to supplier",children:[e.jsx(ve,{className:"w-4 h-4"}),"WhatsApp"]}),e.jsxs("button",{onClick:Aa,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium text-sm",title:"Send SMS to supplier",children:[e.jsx(zt,{className:"w-4 h-4"}),"SMS"]}),e.jsxs("button",{onClick:ut,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(ce,{className:"w-4 h-4"}),"Payments"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/lats/purchase-orders"),className:"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors text-sm font-medium",children:"Close"}),t.status==="draft"&&e.jsxs("button",{onClick:()=>ae(!U),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(Ft,{className:"w-4 h-4"}),U?"Cancel Edit":"Edit"]})]})]}),!1,t&&e.jsx(Rr,{isOpen:Gt,onClose:()=>ts(!1),amount:(()=>{const s=t.totalAmount||0,a=t.totalPaid||0;t.totalAmountBaseCurrency;const l=t.exchangeRate||1;if(t.currency&&t.currency!=="TZS"&&l>1){const r=a/l,o=s-r;return Math.max(0,o)}return Math.max(0,s-a)})(),customerId:t.supplierId,customerName:(kt=t.supplier)==null?void 0:kt.name,description:`Payment for Purchase Order ${t.orderNumber}`,onPaymentComplete:Qa,paymentType:"cash_out",title:"Purchase Order Payment",currency:t.currency,exchangeRate:t.exchangeRate}),Jt&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Partial Receive"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Select the items and quantities you have received:"}),e.jsx("div",{className:"space-y-3",children:t==null?void 0:t.items.map((s,a)=>{var l;return e.jsxs("div",{className:"flex items-center gap-4 p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:((l=s.product)==null?void 0:l.name)||`Product ${s.productId}`}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Ordered: ",s.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Received:"}),e.jsx("input",{type:"number",min:"0",max:s.quantity,value:s.receivedQuantity||0,className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm",onChange:r=>{const o=parseInt(r.target.value)||0,c=[...(t==null?void 0:t.items)||[]];c[a]={...s,receivedQuantity:o},Q(g=>g?{...g,items:c}:null)}})]})]},s.id||a)})}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>qs(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{const s=(t==null?void 0:t.items.filter(a=>(a.receivedQuantity||0)>0))||[];Ya(s)},disabled:I,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50",children:I?"Processing...":"Confirm Receive"})]})]})]})}),aa&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Communication History"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"space-y-4 mb-6",children:ze.length>0?ze.map((s,a)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.sender}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-gray-700",children:s.content})]},a)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No communication history available"})]})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("textarea",{id:"messageInput",placeholder:"Add a new message...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none",rows:3}),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsx("button",{onClick:()=>Ws(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Close"}),e.jsx("button",{onClick:()=>{const s=document.getElementById("messageInput");s&&s.value.trim()&&(Ka(s.value),s.value="")},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"Send Message"})]})]})]})]})}),t&&e.jsx(kr,{purchaseOrderId:t.id,isOpen:ea,onClose:()=>ls(!1),onComplete:async()=>{ls(!1),await Ra()}}),e.jsx($r,{qualityCheckId:ta,isOpen:sa,onClose:()=>{Vs(!1),Ys("")}}),ra&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-yellow-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Order Notes"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Add New Note"}),e.jsx("textarea",{value:He,onChange:s=>it(s.target.value),placeholder:"Enter your note here...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500",rows:3}),e.jsx("button",{onClick:Fa,disabled:!He.trim(),className:"w-full px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:"Add Note"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Previous Notes"}),lt.length>0?e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:lt.map((s,a)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.author}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-gray-700",children:s.content})]},s.id||a))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No notes available"})]})]}),e.jsx("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:e.jsx("button",{onClick:()=>Ks(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Close"})})]})]})}),ga&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(Ut,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bulk Actions"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Select items and choose an action to perform on multiple items at once."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Select Items"}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:(Dt=t.items)==null?void 0:Dt.map((s,a)=>{var l,r;return e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-gray-100 last:border-b-0",children:[e.jsx("input",{type:"checkbox",checked:ne.includes(s.id),onChange:()=>Ma(s.id),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((l=s.product)==null?void 0:l.name)||`Product ${s.productId}`}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",((r=s.product)==null?void 0:r.sku)||`SKU-${s.productId}`," | Qty: ",s.quantity]})]})]},s.id||a)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Available Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>bs("update_status"),disabled:ne.length===0,className:"flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(Te,{className:"w-4 h-4"}),"Update Status"]}),e.jsxs("button",{onClick:()=>bs("assign_location"),disabled:ne.length===0,className:"flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(vr,{className:"w-4 h-4"}),"Assign Location"]}),e.jsxs("button",{onClick:()=>bs("export_selected"),disabled:ne.length===0,className:"flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(Ps,{className:"w-4 h-4"}),"Export Selected"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>{us(!1),Ve([])},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{var s;return Ve(((s=t.items)==null?void 0:s.map(a=>a.id))||[])},className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium",children:"Select All"})]})]})]})}),ha&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Ss,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Return Order"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Create a return order for items that need to be returned to the supplier."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Return Type"}),e.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"defective",children:"Defective Items"}),e.jsx("option",{value:"wrong_item",children:"Wrong Items"}),e.jsx("option",{value:"excess",children:"Excess Quantity"}),e.jsx("option",{value:"damaged",children:"Damaged in Transit"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Items to Return"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-gray-200 rounded-lg",children:(It=t.items)==null?void 0:It.map((s,a)=>{var l,r;return e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-gray-100 last:border-b-0",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((l=s.product)==null?void 0:l.name)||`Product ${s.productId}`}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",((r=s.product)==null?void 0:r.sku)||`SKU-${s.productId}`," | Received: ",s.receivedQuantity||0]})]}),e.jsx("div",{className:"w-20",children:e.jsx("input",{type:"number",placeholder:"Qty",min:"1",max:s.receivedQuantity||s.quantity,className:"w-full p-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-red-500 focus:border-red-500"})})]},s.id||a)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Return Reason"}),e.jsx("textarea",{placeholder:"Describe the reason for return...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{placeholder:"Any additional information...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:2})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>gs(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>La({}),className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-medium",children:"Create Return Order"})]})]})]})}),la&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment History"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"space-y-4 mb-6",children:De.length>0?De.map((s,a)=>{var l,r,o;return e.jsx("div",{children:((r=(l=s.metadata)==null?void 0:l.paymentMethod)==null?void 0:r.type)==="multiple"&&((o=s.metadata.paymentMethod.details)!=null&&o.payments)?e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border border-blue-200 p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Payment #",a+1," - Multiple Methods"]}),e.jsxs("div",{className:"space-y-4",children:[s.metadata.paymentMethod.details.payments.map((c,g)=>e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-blue-600"})}),e.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:c.method?c.method.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase()):"Unknown Method"})]}),e.jsxs("div",{className:"space-y-1",children:[c.reference&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Reference:"})," ",c.reference]}),c.transactionId&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Transaction ID:"})," ",c.transactionId]}),c.timestamp&&e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Time:"})," ",new Date(c.timestamp).toLocaleString("en-TZ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xl font-bold text-green-600 mb-2",children:_(c.amount,c.currency||s.currency)}),c.status&&e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-semibold rounded-full ${c.status==="completed"||c.status==="success"?"bg-green-100 text-green-800":c.status==="pending"?"bg-yellow-100 text-yellow-800":c.status==="failed"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:c.status.toUpperCase()})]})]}),c.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:e.jsxs("p",{className:"text-sm text-gray-600 italic",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",c.notes]})})]},g)),e.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4 text-green-600"}),"Payment Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Payments"}),e.jsx("div",{className:"text-lg font-semibold text-blue-900",children:s.metadata.paymentMethod.details.payments.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Payment Methods"}),e.jsx("div",{className:"text-lg font-semibold text-blue-900",children:new Set(s.metadata.paymentMethod.details.payments.map(c=>c.method)).size})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:_(s.metadata.paymentMethod.details.payments.reduce((c,g)=>c+g.amount,0),s.currency)})]})]})]})]})]}):e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-blue-600"})}),e.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:s.method?s.method.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()):"Unknown Method"})]}),e.jsxs("div",{className:"space-y-1",children:[s.reference&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Reference:"})," ",s.reference]}),s.timestamp&&e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Time:"})," ",new Date(s.timestamp).toLocaleString("en-TZ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xl font-bold text-green-600 mb-2",children:_(s.amount,s.currency)}),e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-semibold rounded-full ${s.status==="completed"||s.status==="success"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="failed"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:s.status.toUpperCase()})]})]}),s.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:e.jsxs("p",{className:"text-sm text-gray-600 italic",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",s.notes]})})]})},s.id||a)}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ce,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Payment History"}),e.jsx("p",{className:"text-sm",children:"No payments have been made for this purchase order yet."})]})}),e.jsx("div",{className:"flex gap-3 mt-6 border-t border-gray-200 pt-4",children:e.jsx("button",{onClick:()=>Gs(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Close"})})]})]})}),Ms&&t&&e.jsx(Dr,{isOpen:Ms,onClose:()=>Pe(!1),purchaseOrder:t,onConfirm:Wa,isLoading:I,mode:as,initialReceivedItems:ee.length>0?ee:void 0}),Ls&&t&&e.jsx(_r,{isOpen:Ls,onClose:()=>Fe(!1),purchaseOrder:t,onConfirm:Za,isLoading:K,initialPricingData:Zs.size>0?Zs:void 0}),ba&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Te,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Status"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Status"}),e.jsxs("select",{value:(te==null?void 0:te.status)||"",onChange:s=>ja(a=>a?{...a,status:s.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"sold",children:"Sold"}),e.jsx("option",{value:"reserved",children:"Reserved"}),e.jsx("option",{value:"damaged",children:"Damaged"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason (Optional)"}),e.jsx("textarea",{placeholder:"Enter reason for status change...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>ps(!1),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{te&&ye.length>0?(console.log("Bulk status update:",ye,te.status),n.success(`Updated ${ye.length} items to ${te.status}`),ot([]),ps(!1)):te&&(console.log("Single status update:",te),n.success(`Updated item status to ${te.status}`),ps(!1))},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Update Status"})]})]})}),Na&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Bt,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Assign Location"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location *"}),e.jsx("input",{type:"text",placeholder:"e.g., Warehouse A, Store Front",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Shelf"}),e.jsx("input",{type:"text",placeholder:"e.g., A1, B2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bin"}),e.jsx("input",{type:"text",placeholder:"e.g., 01, 15",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{placeholder:"Additional location notes...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>fs(!1),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{ye.length>0?(console.log("Bulk location assignment:",ye),n.success(`Assigned location to ${ye.length} items`),ot([]),fs(!1)):(console.log("Single location assignment"),n.success("Location assigned successfully"),fs(!1))},className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:"Assign Location"})]})]})}),oa&&is&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl overflow-hidden relative",children:[H==="confirming"&&e.jsx("button",{onClick:()=>{le(!1),ke(null),Y("confirming")},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsxs("div",{className:`p-8 text-center transition-all duration-500 ${H==="success"?"bg-gradient-to-br from-green-100 to-emerald-100":"bg-gradient-to-br from-green-50 to-emerald-50"}`,children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg transition-all duration-500 ${H==="success"?"bg-green-500 scale-110":H==="processing"?"bg-blue-500":"bg-green-600"}`,children:H==="success"?e.jsx(W,{className:"w-10 h-10 text-white"}):H==="processing"?e.jsx("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(M,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:H==="success"?"Successfully Added!":H==="processing"?"Adding to Inventory...":"Add to Inventory?"})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-center text-gray-600 leading-relaxed",children:H==="success"?"Items have been successfully added to inventory.":H==="processing"?"Please wait while we add items to inventory...":is.message})}),H==="confirming"&&e.jsx("div",{className:"p-6 pt-0",children:e.jsx("button",{onClick:()=>{is.onConfirm()},className:"w-full px-6 py-3.5 bg-green-600 hover:bg-green-700 text-white rounded-xl transition-all font-semibold shadow-lg hover:shadow-xl text-lg",children:"Confirm & Add"})}),H==="success"&&e.jsx("div",{className:"p-6 pt-0",children:e.jsx("button",{onClick:()=>{le(!1),ke(null),Y("confirming")},className:"w-full px-6 py-3 text-gray-600 hover:text-gray-900 font-medium transition-colors",children:"Close"})})]})}),Js&&e.jsx("div",{className:"fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:Js}),e.jsx("button",{onClick:()=>da(null),className:"ml-2 text-red-700 hover:text-red-900",children:e.jsx(ue,{className:"w-4 h-4"})})]})}),ya&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-100 to-emerald-100 p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-600 flex items-center justify-center shadow-lg",children:e.jsx(W,{className:"w-10 h-10 text-white"})}),e.jsx("button",{onClick:()=>Ye(!1),className:"w-9 h-9 flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Complete Purchase Order"}),e.jsx("p",{className:"text-gray-700",children:"Review the order summary before completing"})]}),e.jsx("div",{className:"p-8 max-h-[60vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-blue-600"}),"Order Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Order Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:t.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Supplier"}),e.jsx("p",{className:"font-semibold text-gray-900",children:((Rt=t.supplier)==null?void 0:Rt.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Order Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:new Date(t.orderDate||t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("span",{className:"inline-flex px-3 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:t.status.toUpperCase()})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-purple-600"}),"Items Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:((_t=t.items)==null?void 0:_t.length)||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Ordered"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:((Tt=t.items)==null?void 0:Tt.reduce((s,a)=>s+(a.quantity||0),0))||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Received"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:(($t=t.items)==null?void 0:$t.reduce((s,a)=>s+(a.receivedQuantity||0),0))||0})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border-2 border-green-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ws,{className:"w-5 h-5 text-green-600"}),"Financial Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Total Amount"}),e.jsxs("span",{className:"text-xl font-bold text-gray-900",children:[t.currency||"TZS"," ",Number(t.totalAmount||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Payment Status"}),e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-semibold rounded-full ${t.paymentStatus==="paid"?"bg-green-100 text-green-800":t.paymentStatus==="partial"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:((At=t.paymentStatus)==null?void 0:At.toUpperCase())||"UNPAID"})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(qt,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-900 mb-1",children:"Important"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Completing this order will finalize all transactions and mark it as complete. This action cannot be undone."})]})]})})]})}),e.jsxs("div",{className:"bg-gray-50 px-8 py-6",children:[e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx("button",{onClick:()=>Ye(!1),className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 rounded-xl transition-colors font-semibold",children:"Cancel"}),e.jsx("button",{onClick:Ba,className:"px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors shadow-lg",title:"Print Receipt",children:e.jsx(Qt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:Ha,className:"px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors shadow-lg",title:"Share on WhatsApp",children:e.jsx(wr,{className:"w-5 h-5"})}),e.jsx("button",{onClick:Va,disabled:Ee,className:"flex-1 px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-xl transition-colors font-semibold shadow-lg flex items-center justify-center gap-2",children:Ee?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-5 h-5"}),"Confirm & Complete"]})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-500",children:[e.jsx(Xe,{className:"w-3 h-3"}),e.jsx("span",{children:"Print receipt or share via WhatsApp before completing"})]})]})]})}),na&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Add to Inventory"})]}),e.jsx("button",{onClick:()=>ns(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Quality Check Passed!"}),e.jsx("p",{className:"text-sm text-blue-600",children:"Set selling prices and add items to inventory"})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Zt,{className:"w-4 h-4"}),"Profit Margin (%)"]}),e.jsx("input",{type:"number",value:Ce,onChange:s=>ia(parseFloat(s.target.value)),className:"w-full px-3 py-2 border rounded-lg",placeholder:"30",min:"0",max:"100",step:"5"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Selling price will be calculated as: Cost Price √ó (1 + ",Ce,"%)"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Default Location (Optional)"]}),e.jsx("input",{type:"text",value:Ze,onChange:s=>ca(s.target.value),className:"w-full px-3 py-2 border rounded-lg",placeholder:"e.g., Warehouse A, Shelf 3"})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Preview"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Items to add:"}),e.jsx("span",{className:"font-medium",children:xs.filter(s=>s.result==="pass").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Profit margin:"}),e.jsxs("span",{className:"font-medium",children:[Ce,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Location:"}),e.jsx("span",{className:"font-medium",children:Ze||"Not specified"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>ns(!1),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:_a,disabled:I,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),I?"Adding...":"Add to Inventory"]})]})]})}),Me&&t&&e.jsx(Ir,{isOpen:Me,onClose:()=>de(!1),purchaseOrder:t,onReceiveFull:async()=>{rs("full"),Ue({receiveMode:"full"}),console.log("üì¶ Full receive selected - opening SerialNumberReceiveModal"),de(!1),setTimeout(()=>Pe(!0),150)},onReceivePartial:async()=>{rs("partial"),Ue({receiveMode:"partial"}),console.log("üì¶ Partial receive selected - opening SerialNumberReceiveModal"),de(!1),n("Select quantities to receive for each item",{icon:"‚ÑπÔ∏è"}),setTimeout(()=>Pe(!0),150)}})]})]}):e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),e.jsx("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(he,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Purchase Order Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The purchase order you're looking for doesn't exist."}),e.jsx(nr,{onClick:()=>u("/lats/purchase-orders"),children:"Back to Purchase Orders"})]})})]})};export{Vr as default};
