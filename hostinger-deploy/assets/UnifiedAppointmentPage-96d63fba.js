import{j as e,e as N,G as D,u as K}from"./index-61458a34.js";import{r as p}from"./vendor-36d2c7c1.js";import{G as Q}from"./GlassTabs-05c8a392.js";import{S as H}from"./SearchBar-c613e419.js";import{G as ee}from"./GlassSelect-e243562f.js";import{B as te}from"./BackButton-02a80e74.js";import{P as se}from"./PageErrorBoundary-3d3e48b8.js";import{n as v,r as O,y as V,A as ae,d as J,f as R,m as q,Y as ne,am as re,an as le,R as X,bX as B,av as ie,af as ce,bY as oe,N as de,as as me}from"./ui-28e30067.js";import{A as U}from"./AppointmentModal-91a07df7.js";import{f as W,g as Z,c as xe,u as G,d as pe}from"./appointments-0b344a33.js";import{u as ue}from"./useDialog-6eb5c329.js";import{a as he}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";import"./useSuccessModal-081786c4.js";import"./useBodyScrollLock-341c8b9f.js";import"./SuccessModalIcons-fe811e4d.js";const Y=({isActive:j,searchQuery:l,statusFilter:S,showCreateModal:A,setShowCreateModal:C})=>{const{confirm:_}=ue(),[$,x]=p.useState([]),[T,f]=p.useState(!0),[u,a]=p.useState(null),[i,d]=p.useState({total:0,today:0,pending:0,completed:0,cancelled:0});p.useEffect(()=>{j&&(b(),w())},[j,S]);const b=async()=>{f(!0);try{console.log("ðŸ“… Loading appointments from database...");const c=(await W()).map(o=>({id:o.id,customer_id:o.customer_id,customer_name:o.customer_name||"Unknown Customer",customer_phone:o.customer_phone||"No Phone",customer_email:o.customer_email,service_type:o.service_type,appointment_date:o.appointment_date,appointment_time:o.appointment_time,duration_minutes:o.duration_minutes||60,status:o.status,notes:o.notes,priority:o.priority||"medium",technician_name:o.technician_name||"Unassigned",technician_id:o.technician_id,location:o.location}));x(c),console.log(`âœ… Loaded ${c.length} appointments`)}catch(s){console.error("Error loading appointments:",s),v.error("Failed to load appointments"),x([])}finally{f(!1)}},w=async()=>{try{console.log("ðŸ“Š Loading appointment stats from database...");const s=await Z();d({total:s.total||0,today:s.today||0,pending:s.pending||0,completed:s.completed||0,cancelled:s.cancelled||0}),console.log("âœ… Loaded appointment stats:",s)}catch(s){console.error("Failed to load stats:",s),d({total:0,today:0,pending:0,completed:0,cancelled:0})}},k=$.filter(s=>{const c=!l||s.customer_name.toLowerCase().includes(l.toLowerCase())||s.service_type.toLowerCase().includes(l.toLowerCase()),o=S==="all"||s.status===S;return c&&o}),M=s=>{switch(s){case"pending":case"scheduled":return"text-blue-600 bg-blue-100";case"confirmed":return"text-green-600 bg-green-100";case"in-progress":return"text-yellow-600 bg-yellow-100";case"completed":return"text-purple-600 bg-purple-100";case"cancelled":case"no-show":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},h=s=>{switch(s){case"urgent":return"text-red-600 bg-red-100";case"high":return"text-orange-600 bg-orange-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},E=async(s,c)=>{try{console.log(`ðŸ“… Updating appointment ${s} status to ${c}`),await G(s,{status:c}),x(o=>o.map(L=>L.id===s?{...L,status:c}:L)),await w(),v.success("Appointment status updated successfully")}catch(o){console.error("Error updating appointment status:",o),v.error("Failed to update appointment status")}},P=async s=>{if(await _("Are you sure you want to delete this appointment?"))try{console.log(`ðŸ—‘ï¸ Deleting appointment ${s}`),await pe(s),x(c=>c.filter(o=>o.id!==s)),await w(),v.success("Appointment deleted successfully")}catch(c){console.error("Error deleting appointment:",c),v.error("Failed to delete appointment")}};return j?T?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading appointments..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.total})]}),e.jsx(O,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Today"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.today})]}),e.jsx(V,{className:"h-8 w-8 text-green-600"})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.pending})]}),e.jsx(ae,{className:"h-8 w-8 text-yellow-600"})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.completed})]}),e.jsx(J,{className:"h-8 w-8 text-purple-600"})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Cancelled"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.cancelled})]}),e.jsx(R,{className:"h-8 w-8 text-red-600"})]})})]}),e.jsxs(N,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Appointments"}),e.jsx("div",{className:"space-y-4",children:k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No appointments found"})]}):k.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.customer_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${M(s.status)}`,children:s.status}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${h(s.priority)}`,children:s.priority})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Service:"}),e.jsx("p",{className:"font-medium",children:s.service_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Date & Time:"}),e.jsxs("p",{className:"font-medium",children:[new Date(s.appointment_date).toLocaleDateString()," at ",s.appointment_time]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Duration:"}),e.jsxs("p",{className:"font-medium",children:[s.duration_minutes," minutes"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Technician:"}),e.jsx("p",{className:"font-medium",children:s.technician_name||"Unassigned"})]})]}),s.notes&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Notes:"}),e.jsx("p",{className:"text-sm",children:s.notes})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsx(D,{size:"sm",variant:"secondary",icon:e.jsx(q,{size:14}),onClick:()=>a(s),children:"Edit"}),e.jsxs("select",{value:s.status,onChange:c=>E(s.id,c.target.value),className:"text-xs px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"no-show",children:"No Show"})]}),e.jsx(D,{size:"sm",variant:"secondary",icon:e.jsx(ne,{size:14}),onClick:()=>P(s.id),children:"Delete"})]})]})},s.id))})]}),e.jsx(U,{isOpen:A,onClose:()=>C(!1),mode:"create",onSave:async s=>{try{await xe(s),v.success("Appointment created successfully"),C(!1),await b(),await w()}catch(c){throw console.error("Error creating appointment:",c),v.error("Failed to create appointment"),c}}}),u&&e.jsx(U,{isOpen:!0,onClose:()=>a(null),mode:"edit",appointment:{id:u.id,customer_id:u.customer_id||"",service_type:u.service_type,appointment_date:u.appointment_date,appointment_time:u.appointment_time,status:u.status,notes:u.notes,duration_minutes:u.duration_minutes,priority:u.priority,technician_id:u.technician_id,created_at:"",updated_at:""},onSave:async s=>{try{await G(u.id,s),v.success("Appointment updated successfully"),a(null),await b(),await w()}catch(c){throw console.error("Error updating appointment:",c),v.error("Failed to update appointment"),c}}})]}):null},ge=({isActive:j})=>{const[l,S]=p.useState(new Date),[A,C]=p.useState([]),[_,$]=p.useState(!0),[x,T]=p.useState(null),[f,u]=p.useState(null),[a,i]=p.useState(!1),[d,b]=p.useState(null);p.useEffect(()=>{j&&(console.log("ðŸ“… CalendarViewTab activated, loading events..."),w())},[j,l]);const w=async()=>{$(!0);try{console.log("ðŸ”„ Loading calendar events from database...");const r=(await W()).map(n=>{let m,y;try{const F=n.appointment_date||new Date().toISOString().split("T")[0],z=n.appointment_time||"09:00:00";m=new Date(`${F}T${z}`),isNaN(m.getTime())&&(console.warn("Invalid appointment date:",n.appointment_date,"using current date"),m=new Date),y=new Date(m.getTime()+(n.duration_minutes||60)*6e4),isNaN(y.getTime())&&(y=new Date(m.getTime()+60*6e4))}catch(F){console.warn("Error parsing appointment date/time:",F,"using current date"),m=new Date,y=new Date(m.getTime()+60*6e4)}let g="blue";switch(n.status){case"scheduled":g="blue";break;case"confirmed":g="green";break;case"in-progress":g="yellow";break;case"completed":g="purple";break;case"cancelled":g="red";break;default:g="gray"}return{id:n.id,title:`${n.customer_name} - ${n.service_type}`,type:"appointment",start:m.toISOString(),end:y.toISOString(),allDay:!1,customerName:n.customer_name,customerPhone:n.customer_phone,customerEmail:n.customer_email,serviceType:n.service_type,technicianName:n.technician_name,location:n.location,status:n.status,priority:n.priority||"medium",notes:n.notes,color:g}});C(r),console.log("âœ… Calendar events loaded successfully:",r.length,"events")}catch(t){console.error("âŒ Error loading calendar events:",t),v.error("Failed to load calendar events"),C([])}finally{$(!1)}},k=t=>{const r=t.getFullYear(),n=t.getMonth(),m=new Date(r,n,1),y=new Date(r,n+1,0),g=new Date(m);g.setDate(g.getDate()-m.getDay());const F=[],z=new Date(g);for(;z<=y||z.getDay()!==0;)F.push(new Date(z)),z.setDate(z.getDate()+1);return F},M=t=>{const r=t.toISOString().split("T")[0];return A.filter(n=>{try{const m=new Date(n.start);return isNaN(m.getTime())?(console.warn("Invalid event start date:",n.start),!1):m.toISOString().split("T")[0]===r}catch(m){return console.warn("Error parsing event date:",m,n.start),!1}})},h=t=>{switch(t){case"scheduled":return"bg-blue-100 text-blue-800";case"confirmed":return"bg-green-100 text-green-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-purple-100 text-purple-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},E=t=>{switch(t){case"urgent":return"border-red-500";case"high":return"border-orange-500";case"medium":return"border-yellow-500";case"low":return"border-green-500";default:return"border-gray-500"}},P=t=>{S(r=>{const n=new Date(r);return t==="prev"?n.setMonth(n.getMonth()-1):n.setMonth(n.getMonth()+1),n})},s=()=>{S(new Date)},c=t=>{try{const r=new Date(t);return isNaN(r.getTime())?(console.warn("Invalid date string for formatting:",t),"Invalid Time"):r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(r){return console.warn("Error formatting time:",r,t),"Invalid Time"}},o=t=>{b(t),i(!0)};if(!j)return null;if(_)return e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading calendar..."})]});const L=k(l),I=["January","February","March","April","May","June","July","August","September","October","November","December"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{onClick:()=>P("prev"),icon:e.jsx(re,{size:18}),variant:"secondary"}),e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[I[l.getMonth()]," ",l.getFullYear()]}),e.jsx(D,{onClick:()=>P("next"),icon:e.jsx(le,{size:18}),variant:"secondary"}),e.jsx(D,{onClick:s,variant:"secondary",size:"sm",children:"Today"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(D,{onClick:w,icon:e.jsx(X,{size:16}),variant:"secondary",size:"sm",disabled:_,children:_?"Loading...":"Refresh"})})]}),e.jsxs(N,{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"p-3 text-center font-semibold text-gray-700 bg-gray-50 rounded-lg",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:L.map((t,r)=>{const n=t.getMonth()===l.getMonth(),m=t.toDateString()===new Date().toDateString(),y=M(t);return e.jsxs("div",{className:`min-h-[120px] p-2 border border-gray-200 rounded-lg transition-colors hover:bg-gray-50 cursor-pointer ${n?"bg-white":"bg-gray-50"} ${m?"ring-2 ring-blue-500 bg-blue-50":""}`,onClick:g=>{g.target.closest(".event-item")||o(t)},children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${n?"text-gray-900":"text-gray-400"} ${m?"text-blue-600 font-bold":""}`,children:t.getDate()}),e.jsxs("div",{className:"space-y-1",children:[y.slice(0,3).map(g=>e.jsxs("div",{className:`event-item p-1 rounded text-xs cursor-pointer border-l-4 transition-all hover:shadow-sm ${E(g.priority)} ${h(g.status)}`,onClick:F=>{F.stopPropagation(),T(g)},title:`${g.title} - ${c(g.start)}`,children:[e.jsx("div",{className:"font-medium truncate",children:g.title}),e.jsx("div",{className:"text-xs opacity-75",children:c(g.start)})]},g.id)),y.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center font-medium",children:["+",y.length-3," more"]})]})]},r)})})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsx("button",{onClick:()=>T(null),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(R,{size:20})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Title:"}),e.jsx("p",{className:"text-gray-900",children:x.title})]}),x.customerName&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Customer:"}),e.jsx("p",{className:"text-gray-900",children:x.customerName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Time:"}),e.jsxs("p",{className:"text-gray-900",children:[c(x.start)," - ",c(x.end)]})]}),x.location&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Location:"}),e.jsx("p",{className:"text-gray-900",children:x.location})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${h(x.status)}`,children:x.status}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${E(x.priority)}`,children:x.priority})]}),x.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Notes:"}),e.jsx("p",{className:"text-gray-900 text-sm",children:x.notes})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(D,{onClick:()=>{u(x),T(null)},icon:e.jsx(q,{size:14}),size:"sm",children:"Edit"}),e.jsx(D,{onClick:()=>T(null),variant:"secondary",size:"sm",children:"Close"})]})]})}),f&&e.jsx(U,{isOpen:!0,onClose:()=>u(null),mode:"edit",appointment:{id:f.id,customer_id:f.customerName||"",service_type:f.serviceType||"",appointment_date:f.start.split("T")[0],appointment_time:new Date(f.start).toTimeString().split(" ")[0],status:f.status,notes:f.notes,duration_minutes:60,priority:f.priority,technician_id:"",created_at:"",updated_at:""},onSave:async t=>{try{await G(f.id,t),v.success("Appointment updated successfully"),u(null),await w()}catch(r){throw console.error("Error updating appointment:",r),v.error("Failed to update appointment"),r}}}),a&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs(N,{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Appointment"}),e.jsx("button",{onClick:()=>{i(!1),b(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(R,{size:20})})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Creating appointment for ",d.toLocaleDateString()]}),e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:'Note: This is a quick create. For full appointment details with customer selection, please use the "New Appointment" button in the management tab.'}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"secondary",onClick:()=>{i(!1),b(null)},children:"Cancel"}),e.jsx(D,{onClick:()=>{v('Please use "New Appointment" button in Management tab to create appointments with customer details',{icon:"â„¹ï¸"}),i(!1),b(null)},children:"Go to Management"})]})]})})]})},je=({isActive:j})=>{const[l,S]=p.useState(null),[A,C]=p.useState(!0),[_,$]=p.useState("30d");p.useEffect(()=>{j&&x()},[j,_]);const x=async()=>{C(!0);try{console.log("ðŸ“Š Loading appointment statistics from database...");const[a,i]=await Promise.all([Z(),W()]),d=new Date,b=new Date(d.getFullYear(),d.getMonth(),d.getDate()),w=new Date(b.getTime()-7*24*60*60*1e3),k=new Date(d.getFullYear(),d.getMonth(),1),M=i.filter(t=>new Date(t.appointment_date)>=b).length,h=i.filter(t=>new Date(t.appointment_date)>=w).length,E=i.filter(t=>new Date(t.appointment_date)>=k).length,P=E>0?M/E*100-100:0,s=i.length,c=i.reduce((t,r)=>{const n=t.find(m=>m.status===r.status);return n?n.count++:t.push({status:r.status,count:1,percentage:0,trend:0}),t},[]);c.forEach(t=>{t.percentage=s>0?Math.round(t.count/s*100):0,t.trend=Math.floor(Math.random()*20)-5});const o=i.reduce((t,r)=>{const n=t.find(m=>m.service===r.service_type);return n?n.count++:t.push({service:r.service_type,count:1,revenue:0,percentage:0}),t},[]);o.forEach(t=>{t.percentage=s>0?Math.round(t.count/s*100):0,t.revenue=t.count*5e4});const L=[];for(let t=6;t>=0;t--){const r=new Date;r.setDate(r.getDate()-t);const n=r.toISOString().split("T")[0],m=i.filter(y=>y.appointment_date===n);L.push({date:r.toLocaleDateString("en-US",{weekday:"short"}),appointments:m.length,completed:m.filter(y=>y.status==="completed").length,cancelled:m.filter(y=>y.status==="cancelled"||y.status==="no-show").length})}const I={overview:{total:a.total||0,today:M,thisWeek:h,thisMonth:E,growth:Math.round(P)},byStatus:c,byService:o,byTechnician:[],trends:L};S(I),console.log("âœ… Appointment statistics loaded successfully")}catch(a){console.error("Error loading appointment stats:",a),v.error("Failed to load appointment statistics"),S({overview:{total:0,today:0,thisWeek:0,thisMonth:0,growth:0},byStatus:[],byService:[],byTechnician:[],trends:[]})}finally{C(!1)}},T=a=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),f=a=>a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toString(),u=a=>{switch(a.toLowerCase()){case"scheduled":return"text-blue-600 bg-blue-100";case"confirmed":return"text-green-600 bg-green-100";case"in progress":return"text-yellow-600 bg-yellow-100";case"completed":return"text-purple-600 bg-purple-100";case"cancelled":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return j?A?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading appointment statistics..."})]}):l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Appointments"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f(l.overview.total)}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(B,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-sm text-green-600 ml-1",children:["+",l.overview.growth,"%"]})]})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(O,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Today's Appointments"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.overview.today}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsx("span",{className:"text-sm text-gray-600",children:"vs yesterday"})})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(V,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"This Week"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.overview.thisWeek}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsx("span",{className:"text-sm text-gray-600",children:"Last 7 days"})})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(ie,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.overview.thisMonth}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsx("span",{className:"text-sm text-gray-600",children:"Last 30 days"})})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(ce,{className:"w-6 h-6 text-orange-600"})})]})})]}),e.jsxs(N,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Appointments by Status"}),e.jsx("div",{className:"space-y-3",children:l.byStatus.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${u(a.status)}`,children:a.status}),e.jsxs("span",{className:"ml-3 text-sm text-gray-600",children:[a.count," appointments"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:[a.percentage,"%"]}),e.jsxs("div",{className:"flex items-center",children:[a.trend>0?e.jsx(B,{className:"w-3 h-3 text-green-500"}):e.jsx(oe,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:`text-xs ml-1 ${a.trend>0?"text-green-600":"text-red-600"}`,children:[a.trend>0?"+":"",a.trend,"%"]})]})]})]},i))})]}),e.jsxs(N,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Appointments by Service"}),e.jsx("div",{className:"space-y-3",children:l.byService.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.service}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.count," appointments"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:T(a.revenue)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.percentage,"%"]})]})]},i))})]}),l.byTechnician&&l.byTechnician.length>0&&e.jsxs(N,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Technician Performance"}),e.jsx("div",{className:"space-y-3",children:l.byTechnician.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.technician}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.completed,"/",a.appointments," completed"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-yellow-500",children:"â˜…"}),e.jsx("span",{className:"font-semibold text-gray-900 ml-1",children:a.rating})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[Math.round(a.completed/a.appointments*100),"% success"]})]})]},i))})]}),l.trends&&l.trends.length>0&&e.jsxs(N,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Weekly Trends (Last 7 Days)"}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:l.trends.map((a,i)=>e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.date}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:a.appointments}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.jsxs("p",{className:"text-green-600",children:["âœ“ ",a.completed]}),e.jsxs("p",{className:"text-red-600",children:["âœ— ",a.cancelled]})]})]})},i))})]})]}):null:null},ze=()=>{const{currentUser:j}=K();he();const[l,S]=p.useState("management"),[A,C]=p.useState(!1),[_,$]=p.useState(""),[x,T]=p.useState("all"),[f,u]=p.useState(!1);p.useEffect(()=>{console.log("ðŸ“… UnifiedAppointmentPage loaded"),console.log("ðŸ‘¤ Current user:",j),console.log("ðŸ”‘ User role:",j==null?void 0:j.role)},[j]);const a=[{id:"management",label:"Appointment Management",icon:e.jsx(O,{size:20}),description:"Manage customer appointments and scheduling",color:"blue"},{id:"calendar",label:"Calendar View",icon:e.jsx(me,{size:20}),description:"Visual calendar interface for appointments and events",color:"green"},{id:"stats",label:"Appointment Statistics",icon:e.jsx(J,{size:20}),description:"Analytics and insights for appointment performance",color:"purple"}],i=a.filter(h=>!h.adminOnly||(j==null?void 0:j.role)==="admin"),d=a.find(h=>h.id===l),b=h=>{S(h)},w=()=>{u(!0)},k=()=>{C(!0),setTimeout(()=>{C(!1),v.success("Appointment data refreshed")},1e3)},M=()=>{switch(l){case"management":return e.jsx(Y,{isActive:!0,searchQuery:_,statusFilter:x,showCreateModal:f,setShowCreateModal:u});case"calendar":return e.jsx(ge,{isActive:!0});case"stats":return e.jsx(je,{isActive:!0});default:return e.jsx(Y,{isActive:!0,searchQuery:_,statusFilter:x,showCreateModal:f,setShowCreateModal:u})}};return e.jsx(se,{pageName:"Unified Appointments",showDetails:!0,children:e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(te,{to:"/dashboard"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Appointments & Calendar"}),e.jsx("p",{className:"text-gray-600 mt-1",children:(d==null?void 0:d.description)||"Comprehensive appointment management system"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ee,{options:[{value:"all",label:"All Status"},{value:"pending",label:"Pending"},{value:"confirmed",label:"Confirmed"},{value:"in-progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"},{value:"no-show",label:"No Show"}],value:x,onChange:h=>T(h),placeholder:"Filter by Status",className:"min-w-[150px]"}),e.jsx(H,{onSearch:$,placeholder:"Search appointments...",className:"min-w-[200px]"}),e.jsx(D,{onClick:k,icon:e.jsx(X,{size:18}),variant:"secondary",loading:A,disabled:A,children:"Refresh"}),e.jsx(D,{onClick:w,icon:e.jsx(de,{size:18}),className:"bg-gradient-to-r from-green-500 to-green-600 text-white",children:"New Appointment"})]})]}),e.jsx(Q,{tabs:i.map(h=>({id:h.id,label:h.label,icon:h.icon,description:h.description,badge:h.adminOnly?"Admin":void 0})),activeTab:l,onTabChange:h=>b(h),variant:"modern",size:"md"}),e.jsx("div",{className:"w-full",children:e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`text-${d==null?void 0:d.color}-500`,children:d==null?void 0:d.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:d==null?void 0:d.label}),e.jsx("p",{className:"text-sm text-gray-600",children:d==null?void 0:d.description})]})]}),A?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading appointments..."})]}):e.jsx("div",{className:"space-y-6",children:M()})]})})]})})};export{ze as default};
