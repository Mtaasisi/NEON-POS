import{j as e,G as Ds,b as kt,c as Ct,u as Pt,d as At,e as Mt,s as Is,g as Ls,f as Et,h as Tt}from"./index-61458a34.js";import{r as i}from"./vendor-36d2c7c1.js";import{t as m}from"./toastUtils-7054c9ca.js";import{M as oe}from"./Modal-a5e4c1ba.js";import{s as zt}from"./search-cbe15294.js";import{A as Dt}from"./AddCustomerModal-175a5a1a.js";import{f as je}from"./productCalculations-9f6c3068.js";import{i as Bs,S as Fs,A as O,U as Gs,R as qe,j as It,P as Lt,M as Bt,k as Rs,l as Gt,m as Rt,o as _t,p as Ot,q as Ne,r as V,s as $t,T as Ht,t as Ft,b as Ut,K as Vt,u as we,v as _s,X as qt,B as Wt,w as Kt,x as Xt,Z as Zt,y as Os,W as Qt}from"./ui-28e30067.js";import{Q as Jt}from"./qr-3af4041b.js";import{u as Yt}from"./CustomerForm-3440546b.js";import{a as ea}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";import"./useBodyScrollLock-341c8b9f.js";import"./phoneUtils-a8934478.js";import"./useSuccessModal-081786c4.js";import"./SuccessModalIcons-fe811e4d.js";const sa=["iPhone 6 (A1549, A1586)","iPhone 6 Plus (A1522, A1524)","iPhone 6s (A1633, A1688)","iPhone 6s Plus (A1634, A1687)","iPhone SE (1st generation) (A1662, A1723)","iPhone 7 (A1660, A1778)","iPhone 7 Plus (A1661, A1784)","iPhone 8 (A1863, A1905)","iPhone 8 Plus (A1864, A1897)","iPhone X (A1865, A1901)","iPhone XR (A1984, A2105)","iPhone XS (A1920, A2097)","iPhone XS Max (A1921, A2101)","iPhone 11 (A2111, A2223)","iPhone 11 Pro (A2160, A2215)","iPhone 11 Pro Max (A2161, A2220)","iPhone SE (2nd generation) (A2275, A2296)","iPhone SE (3rd generation) (A2595, A2783)","iPhone 12 (A2172, A2402)","iPhone 12 mini (A2176, A2399)","iPhone 12 Pro (A2341, A2406)","iPhone 12 Pro Max (A2342, A2410)","iPhone 13 (A2482, A2631)","iPhone 13 mini (A2481, A2626)","iPhone 13 Pro (A2483, A2636)","iPhone 13 Pro Max (A2484, A2641)","iPhone 14 (A2649, A2881)","iPhone 14 Plus (A2632, A2885)","iPhone 14 Pro (A2650, A2890)","iPhone 14 Pro Max (A2651, A2894)","iPhone 15 (A3090, A2846)","iPhone 15 Plus (A3094, A2840)","iPhone 15 Pro (A3102, A2848)","iPhone 15 Pro Max (A3106, A2836)","iPhone 16 (TBD)","iPhone 16 Plus (TBD)","iPhone 16 Pro (TBD)","iPhone 16 Pro Max (TBD)","Samsung Galaxy S20","Samsung Galaxy S20+","Samsung Galaxy S20 Ultra","Samsung Galaxy S21","Samsung Galaxy S21+","Samsung Galaxy S21 Ultra","Samsung Galaxy S22","Samsung Galaxy S22+","Samsung Galaxy S22 Ultra","Samsung Galaxy S23","Samsung Galaxy S23+","Samsung Galaxy S23 Ultra","Samsung Galaxy S24","Samsung Galaxy S24+","Samsung Galaxy S24 Ultra","Samsung Galaxy S25 (TBD)","Samsung Galaxy S25+ (TBD)","Samsung Galaxy S25 Ultra (TBD)","Samsung Galaxy Note 20","Samsung Galaxy Note 20 Ultra","Samsung Galaxy Note 10","Samsung Galaxy Note 10+","Samsung Galaxy Note 10+ 5G","Samsung Galaxy Note 9","Samsung Galaxy Note 8","Samsung Galaxy Note 7 (Discontinued)","Samsung Galaxy Note 5","Samsung Galaxy Z Flip","Samsung Galaxy Z Flip 3","Samsung Galaxy Z Flip 4","Samsung Galaxy Z Flip 5","Samsung Galaxy Z Flip 6 (TBD)","Samsung Galaxy Z Fold","Samsung Galaxy Z Fold 2","Samsung Galaxy Z Fold 3","Samsung Galaxy Z Fold 4","Samsung Galaxy Z Fold 5","Samsung Galaxy Z Fold 6 (TBD)","Google Pixel (2016)","Google Pixel XL (2016)","Google Pixel 2","Google Pixel 2 XL","Google Pixel 3","Google Pixel 3 XL","Google Pixel 3a","Google Pixel 3a XL","Google Pixel 4","Google Pixel 4 XL","Google Pixel 4a","Google Pixel 4a (5G)","Google Pixel 5","Google Pixel 5a (5G)","Google Pixel 6","Google Pixel 6 Pro","Google Pixel 6a","Google Pixel 7","Google Pixel 7 Pro","Google Pixel 7a","Google Pixel 8","Google Pixel 8 Pro","Google Pixel 8a","Google Pixel 9 (TBD)","Google Pixel 9 Pro (TBD)","Google Pixel Fold","Google Pixel Fold 2 (TBD)","Surface Pro (1st Gen) (1514)","Surface Pro 2 (1601)","Surface Pro 3 (1631)","Surface Pro 4 (1724)","Surface Pro (2017, 5th Gen) (1796)","Surface Pro 6 (1807)","Surface Pro 7 (1866)","Surface Pro 7+ (1960)","Surface Pro 8 (1983)","Surface Pro 9 (Intel, 2022) (2038)","Surface Pro 9 (5G, ARM, 2022) (2027)","Surface Pro 10 (Intel, 2024) (TBD)","Surface Pro 10 (5G, ARM, 2024) (TBD)","Surface Laptop (1st Gen, 2017) (1769)","Surface Laptop 2 (2018) (1769)","Surface Laptop 3 (13.5-inch, 2019) (1867)","Surface Laptop 3 (15-inch, 2019) (1873)","Surface Laptop 4 (13.5-inch, 2021) (1950)","Surface Laptop 4 (15-inch, 2021) (1953)","Surface Laptop 5 (13.5-inch, 2022) (1962)","Surface Laptop 5 (15-inch, 2022) (1963)","Surface Laptop 6 (Intel, 2024) (TBD)","Surface Laptop Go (2020) (1943)","Surface Laptop Go 2 (2022) (2013)","Surface Laptop Go 3 (2023) (TBD)","Surface Laptop Studio (2021) (1964)","Surface Laptop Studio 2 (2023) (TBD)","Surface Book (1st Gen, 2015) (1703)","Surface Book with Performance Base (2016) (1705)","Surface Book 2 (13.5-inch, 2017) (1832)","Surface Book 2 (15-inch, 2017) (1793)","Surface Book 3 (13.5-inch, 2020) (1900)","Surface Book 3 (15-inch, 2020) (1901)","Surface Go (2018) (1824)","Surface Go 2 (2020) (1901)","Surface Go 3 (2021) (1926)","Surface Go 4 (2023) (TBD)","Surface Duo (2020) (1930)","Surface Duo 2 (2021) (1995)","HP Pavilion 14 (14-dv2074nr)","HP Pavilion 15 (15-eg2025nr)","HP Pavilion x360 14 (14-ek0013dx)","HP Pavilion x360 15 (15-er0105wm)","HP Pavilion Gaming 15 (15-ec2075wm)","HP Pavilion Aero 13 (13-be0047nr)","HP ENVY 13 (13-ba1010nr)","HP ENVY x360 13 (13-bf0013dx)","HP ENVY x360 15 (15-ed2005wm)","HP ENVY x360 16 (16-h1000ca)","HP Spectre x360 13.5 (14-ef2013dx)","HP Spectre x360 14 (14-ea0023dx)","HP Spectre x360 15 (15-eb1003ca)","HP Spectre Fold (16-aa0002na)","HP EliteBook 830 G8 (4B2M4UT#ABA)","HP EliteBook 840 G8 (3C9Q1UT#ABA)","HP EliteBook x360 1040 G7 (2Z3Y3UT#ABA)","HP EliteBook 865 G9 (5Y3M9UT#ABA)","HP ProBook 430 G8 (33L09EA)","HP ProBook 440 G9 (6A1L4EA)","HP ProBook 450 G9 (6A1P4EA)","HP ProBook 455 G9 (6A3G4EA)","HP ZBook Firefly 14 G9 (6B1K1EA)","HP ZBook Firefly 16 G9 (6B1K7EA)","HP ZBook Studio G9 (6B2M6EA)","HP ZBook Fury 15 G8 (4R8L6EA)","HP ZBook Power G9 (6B2L1EA)","HP OMEN 15 (15-en0013dx)","HP OMEN 16 (16-b0005dx)","HP OMEN 17 (17-ck1020nr)","HP OMEN Transcend 16 (16-u0004nr)","HP Victus 15 (15-fa0031dx)","HP Victus 16 (16-e1000ne)","MacBook Air (11-inch, Mid 2012)","MacBook Air (13-inch, Mid 2012)","MacBook Pro (13-inch, Mid 2012)","MacBook Pro (15-inch, Mid 2012)","MacBook Pro with Retina display (15-inch, Mid 2012)","MacBook Pro with Retina display (13-inch, Late 2012)","MacBook Air (11-inch, Mid 2013)","MacBook Air (13-inch, Mid 2013)","MacBook Pro (13-inch, Late 2013)","MacBook Pro (15-inch, Late 2013)","MacBook Air (11-inch, Early 2014)","MacBook Air (13-inch, Early 2014)","MacBook Pro (13-inch, Mid 2014)","MacBook Pro (15-inch, Mid 2014)","MacBook Air (11-inch, Early 2015)","MacBook Air (13-inch, Early 2015)","MacBook Pro (13-inch, Early 2015)","MacBook Pro (15-inch, Mid 2015)","MacBook (Retina, 12-inch, Early 2015)","MacBook (Retina, 12-inch, Early 2016)","MacBook (Retina, 12-inch, 2017)","MacBook Air (13-inch, 2017)","MacBook Pro (13-inch, 2016)","MacBook Pro (15-inch, 2016)","MacBook Pro (13-inch, 2017)","MacBook Pro (15-inch, 2017)","MacBook Pro (13-inch, 2018)","MacBook Pro (15-inch, 2018)","MacBook Pro (13-inch, 2019)","MacBook Pro (15-inch, 2019)","MacBook Pro (16-inch, 2019)","MacBook Air (Retina, 13-inch, 2018)","MacBook Air (Retina, 13-inch, 2019)","MacBook Air (Retina, 13-inch, 2020)","MacBook Pro (13-inch, 2020)","MacBook Pro (M1, 13-inch, 2020) (A2338)","MacBook Air (M1, 2020) (A2337)","MacBook Pro (14-inch, 2021) (A2442)","MacBook Pro (16-inch, 2021) (A2485)","MacBook Air (M2, 2022) (A2681)","MacBook Pro (M2, 13-inch, 2022) (A2338)","MacBook Pro (M2 Pro, 14-inch, 2023) (A2779)","MacBook Pro (M2 Max, 16-inch, 2023) (A2780)","MacBook Air (M2, 15-inch, 2023) (A2941)","MacBook Air (M3, 13-inch, 2024) (A3113)","MacBook Air (M3, 15-inch, 2024) (A3114)","MacBook Pro (M3 Pro, 14-inch, 2024) (A2992)","MacBook Pro (M3 Max, 16-inch, 2024) (A2991)","MacBook Pro (13-inch, Late 2012, Retina)","iPad (4th generation, 2012)","iPad (5th generation, 2017)","iPad (6th generation, 2018)","iPad (7th generation, 2019)","iPad (8th generation, 2020)","iPad (9th generation, 2021)","iPad (10th generation, 2022)","iPad Air (1st generation, 2013)","iPad Air 2 (2014)","iPad Air (3rd generation, 2019)","iPad Air (4th generation, 2020)","iPad Air (5th generation, 2022)","iPad Air (11-inch, M2, 2024)","iPad Air (13-inch, M2, 2024)","iPad mini 2 (2013)","iPad mini 3 (2014)","iPad mini 4 (2015)","iPad mini (5th generation, 2019)","iPad mini (6th generation, 2021)","iPad Pro (12.9-inch, 1st generation, 2015)","iPad Pro (9.7-inch, 2016)","iPad Pro (10.5-inch, 2017)","iPad Pro (12.9-inch, 2nd generation, 2017)","iPad Pro (11-inch, 1st generation, 2018)","iPad Pro (12.9-inch, 3rd generation, 2018)","iPad Pro (11-inch, 2nd generation, 2020)","iPad Pro (12.9-inch, 4th generation, 2020)","iPad Pro (11-inch, 3rd generation, 2021)","iPad Pro (12.9-inch, 5th generation, 2021)","iPad Pro (11-inch, 4th generation, 2022)","iPad Pro (12.9-inch, 6th generation, 2022)","iPad Pro (11-inch, M4, 2024)","iPad Pro (13-inch, M4, 2024)"],$s=(r,u)=>u.every(d=>r.split(/[^a-z0-9]+/).some(y=>y.startsWith(d))),ta=({value:r,onChange:u,placeholder:d="Enter model or model number",required:y=!1,className:N="",modelLogos:w,brand:g})=>{const[l,k]=i.useState(!1),C=i.useRef(null),A=i.useRef(null);i.useEffect(()=>{function p(f){C.current&&!C.current.contains(f.target)&&A.current&&!A.current.contains(f.target)&&k(!1)}return l&&document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[l]);let $=sa;if(g){const p=g.toLowerCase();$=$.filter(f=>p==="apple"?f.toLowerCase().startsWith("iphone")||f.toLowerCase().startsWith("ipad")||f.toLowerCase().startsWith("macbook"):p==="samsung"?f.toLowerCase().startsWith("samsung"):p==="google"?f.toLowerCase().startsWith("google"):p==="microsoft"?f.toLowerCase().startsWith("surface"):p==="hp"?f.toLowerCase().startsWith("hp"):f.toLowerCase().includes(p))}return $=$.filter(p=>{if(!r)return!0;const f=r.toLowerCase().split(/\s+/).filter(Boolean),E=p.toLowerCase();return f.every(W=>E.includes(W))}).sort((p,f)=>{if(!r)return 0;const E=r.toLowerCase().split(/\s+/).filter(Boolean),W=p.toLowerCase(),K=f.toLowerCase(),X=$s(W,E),Se=$s(K,E);return X&&!Se?-1:!X&&Se?1:0}),e.jsxs("div",{className:`relative ${N}`,children:[e.jsx("input",{type:"text",value:r,onChange:p=>{u(p.target.value),k(!0)},onFocus:()=>k(!0),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg pl-12 bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:d,required:y,autoComplete:"off",autoCorrect:"off",spellCheck:!1,ref:C}),e.jsx(Bs,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20}),l&&e.jsx("div",{ref:A,className:"absolute z-[9999] w-full mt-1 bg-white/95 backdrop-blur-md border border-gray-300 rounded-md shadow-xl max-h-60 overflow-y-auto",children:$.map((p,f)=>e.jsxs("button",{type:"button",className:"w-full px-4 py-2 text-left hover:bg-gray-100 focus:bg-gray-100 focus:outline-none flex items-center gap-2",onClick:()=>{u(p),k(!1)},children:[w&&w[p]?e.jsx("img",{src:w[p],alt:p,className:"w-6 h-6 object-contain"}):e.jsx(Bs,{size:18,className:"text-blue-500 flex-shrink-0"}),e.jsx("span",{children:p})]},`${p}-${f}`))})]})},aa=({isOpen:r,onClose:u,device:d})=>{const y=i.useRef(null),N=()=>{var g;if(y.current){const l=window.open("","_blank");l&&(l.document.write(`
          <!DOCTYPE html>
          <html>
            <head>
              <title>Device QR Code - ${d.brand} ${d.model}</title>
              <style>
                body {
                  font-family: Arial, sans-serif;
                  margin: 0;
                  padding: 20px;
                  background: white;
                }
                .print-container {
                  max-width: 400px;
                  margin: 0 auto;
                  border: 2px solid #333;
                  border-radius: 8px;
                  padding: 20px;
                  background: white;
                }
                .header {
                  text-align: center;
                  border-bottom: 2px solid #333;
                  padding-bottom: 15px;
                  margin-bottom: 20px;
                }
                .company-name {
                  font-size: 24px;
                  font-weight: bold;
                  color: #2563eb;
                  margin-bottom: 5px;
                }
                .tagline {
                  font-size: 14px;
                  color: #666;
                }
                .qr-section {
                  text-align: center;
                  margin: 20px 0;
                }
                .qr-code {
                  border: 1px solid #ddd;
                  padding: 10px;
                  display: inline-block;
                  background: white;
                }
                .device-info {
                  margin: 20px 0;
                }
                .info-row {
                  display: flex;
                  justify-content: space-between;
                  margin: 8px 0;
                  font-size: 14px;
                }
                .label {
                  font-weight: bold;
                  color: #333;
                }
                .value {
                  color: #666;
                }
                .conditions-section {
                  margin: 20px 0;
                  border-top: 1px solid #ddd;
                  padding-top: 15px;
                }
                .conditions-title {
                  font-weight: bold;
                  margin-bottom: 10px;
                  color: #333;
                }
                .condition-item {
                  background: #f3f4f6;
                  padding: 4px 8px;
                  margin: 2px;
                  border-radius: 4px;
                  font-size: 12px;
                  display: inline-block;
                }
                .footer {
                  text-align: center;
                  margin-top: 20px;
                  padding-top: 15px;
                  border-top: 1px solid #ddd;
                  font-size: 12px;
                  color: #666;
                }
                .status-badge {
                  display: inline-block;
                  padding: 4px 12px;
                  border-radius: 20px;
                  font-size: 12px;
                  font-weight: bold;
                  text-transform: uppercase;
                }
                .status-assigned {
                  background: #dbeafe;
                  color: #1d4ed8;
                }
                .status-diagnosis {
                  background: #fef3c7;
                  color: #d97706;
                }
                .status-repair {
                  background: #fce7f3;
                  color: #be185d;
                }
                .status-complete {
                  background: #d1fae5;
                  color: #059669;
                }
                @media print {
                  body { margin: 0; }
                  .print-container { border: none; }
                }
              </style>
            </head>
            <body>
              <div class="print-container">
                <div class="header">
                  <div class="company-name">CLEAN REPAIRS</div>
                  <div class="tagline">Professional Device Repair Services</div>
                </div>
                
                <div class="qr-section">
                  <div class="qr-code">
                    ${((g=document.querySelector(".qr-code svg"))==null?void 0:g.outerHTML)||""}
                  </div>
                  <div style="margin-top: 10px; font-size: 12px; color: #666;">
                    Scan to track device status
                  </div>
                </div>
                
                <div class="device-info">
                  <div class="info-row">
                    <span class="label">Device ID:</span>
                    <span class="value">${d.id}</span>
                  </div>
                                      <div class="info-row">
                      <span class="label">Model:</span>
                      <span class="value">${d.model}</span>
                    </div>
                  <div class="info-row">
                    <span class="label">Serial/IMEI:</span>
                    <span class="value">${d.serialNumber}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Customer:</span>
                    <span class="value">${d.customerName}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Phone:</span>
                    <span class="value">${d.phoneNumber}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Expected Return:</span>
                    <span class="value">${new Date(d.expectedReturnDate).toLocaleDateString()}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Status:</span>
                    <span class="value">
                      <span class="status-badge status-${d.status}">${d.status}</span>
                    </span>
                  </div>
                </div>
                
                ${d.conditions.length>0?`
                <div class="conditions-section">
                  <div class="conditions-title">Reported Issues:</div>
                  ${d.conditions.map(k=>`
                    <span class="condition-item">${k}</span>
                  `).join("")}
                  ${d.otherText?`<span class="condition-item">${d.otherText}</span>`:""}
                </div>
                `:""}
                
                <div class="footer">
                  <div>Thank you for choosing Clean Repairs</div>
                  <div>Contact: +255 XXX XXX XXX</div>
                  <div>Email: info@cleanrepairs.com</div>
                </div>
              </div>
            </body>
          </html>
        `),l.document.close(),l.focus(),l.print(),l.close())}},w=g=>{switch(g){case"assigned":return"text-blue-600 bg-blue-100";case"diagnosis-started":return"text-yellow-600 bg-yellow-100";case"in-repair":return"text-purple-600 bg-purple-100";case"repair-complete":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}};return e.jsx(oe,{isOpen:r,onClose:u,title:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Fs,{size:24,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Print Device QR Code"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Print QR code with device information"})]})]}),maxWidth:"500px",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block p-4 bg-white border border-gray-200 rounded-lg",children:e.jsx(Jt,{value:`${window.location.origin}/devices/${d.id}`,size:200,level:"M",className:"qr-code"})}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Scan to track device status"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Device ID:"}),e.jsx("span",{className:"text-gray-900 font-mono",children:d.id})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Model:"}),e.jsx("span",{className:"text-gray-900",children:d.model})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Customer:"}),e.jsx("span",{className:"text-gray-900",children:d.customerName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${w(d.status)}`,children:d.status})]})]}),d.conditions.length>0&&e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(O,{size:16,className:"text-yellow-600"}),"Reported Issues"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.conditions.map((g,l)=>e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:g},l)),d.otherText&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:d.otherText})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(Ds,{variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(Ds,{variant:"primary",onClick:N,children:"Print QR Code"})]})]})})};class ia{constructor(){this.isOnline=navigator.onLine,this.knowledgeBase=this.initializeKnowledgeBase(),this.setupOnlineStatusListener()}setupOnlineStatusListener(){window.addEventListener("online",()=>{this.isOnline=!0,console.log("ðŸŸ¢ Back online - switching to cloud AI")}),window.addEventListener("offline",()=>{this.isOnline=!1,console.log("ðŸ”´ Offline - using local AI analysis")})}initializeKnowledgeBase(){return{patterns:[{keywords:["screen","display","lcd","touch","cracked","broken","black","white"],problem:"Screen display issue detected",solutions:["Replace LCD screen","Check display cable connections","Test touch sensor functionality","Verify motherboard display circuit"],estimatedCost:"Tsh 80,000 - 200,000",difficulty:"Medium",timeEstimate:"2-4 hours",partsNeeded:["LCD Screen","Display Cable","Touch Sensor","Adhesive"]},{keywords:["battery","charge","power","drain","dead","swollen","overheat"],problem:"Battery or power issue detected",solutions:["Replace battery","Check charging port","Test charging circuit","Verify power management"],estimatedCost:"Tsh 30,000 - 80,000",difficulty:"Easy",timeEstimate:"1-2 hours",partsNeeded:["Battery","Charging Port","Charging Cable"]},{keywords:["water","liquid","moisture","wet","drowned","rain","spill"],problem:"Water damage detected",solutions:["Clean and dry components","Replace damaged parts","Test all functions","Apply corrosion protection"],estimatedCost:"Tsh 50,000 - 150,000",difficulty:"Hard",timeEstimate:"4-8 hours",partsNeeded:["Cleaning Solution","Replacement Parts","Corrosion Protection"]},{keywords:["slow","lag","freeze","crash","restart","overheat","performance"],problem:"Performance or software issue detected",solutions:["Clean and optimize system","Update software","Check hardware components","Replace thermal paste"],estimatedCost:"Tsh 20,000 - 60,000",difficulty:"Easy",timeEstimate:"1-3 hours",partsNeeded:["Thermal Paste","Cleaning Tools","Software Tools"]},{keywords:["speaker","microphone","audio","sound","mute","noise","crackling"],problem:"Audio system issue detected",solutions:["Replace speakers","Check audio circuit","Test microphone","Verify audio drivers"],estimatedCost:"Tsh 25,000 - 70,000",difficulty:"Medium",timeEstimate:"2-3 hours",partsNeeded:["Speakers","Microphone","Audio Cable"]},{keywords:["camera","photo","video","blur","dark","flash","lens"],problem:"Camera system issue detected",solutions:["Replace camera module","Clean camera lens","Check camera circuit","Test camera software"],estimatedCost:"Tsh 40,000 - 100,000",difficulty:"Medium",timeEstimate:"2-4 hours",partsNeeded:["Camera Module","Lens","Flash LED"]}]}}async analyzeDevice(u,d,y,N="english"){const w=y.toLowerCase();let g=null,l=0;for(const C of this.knowledgeBase.patterns){const A=this.calculateMatchScore(w,C.keywords);A>l&&(l=A,g=C)}return!g||l<.3?{problem:N==="swahili"?"Tatizo halijulikani":"Unknown issue",solutions:[N==="swahili"?"Chambua kifaa kwa undani zaidi":"Perform detailed device inspection"],estimatedCost:N==="swahili"?"Bei itaamuliwa baada ya uchambuzi":"Cost to be determined after inspection",difficulty:N==="swahili"?"Haijulikani":"Unknown",timeEstimate:N==="swahili"?"Muda utaamuliwa":"Time to be determined",partsNeeded:[],confidence:.1}:{...this.translateResponse(g,N),confidence:Math.min(l,.8)}}calculateMatchScore(u,d){let y=0;const N=u.split(/\s+/);for(const w of d){u.includes(w)&&(y+=1);for(const g of N)(g.includes(w)||w.includes(g))&&(y+=.5)}return y/d.length}translateResponse(u,d){return d==="swahili"?{problem:this.translateToSwahili(u.problem),solutions:u.solutions.map(y=>this.translateToSwahili(y)),estimatedCost:u.estimatedCost,difficulty:this.translateDifficultyToSwahili(u.difficulty),timeEstimate:u.timeEstimate,partsNeeded:u.partsNeeded}:u}translateToSwahili(u){return{"Screen display issue detected":"Tatizo la skrini limegunduliwa","Replace LCD screen":"Badilisha skrini ya LCD","Check display cable connections":"Angalia muunganisho wa cable ya skrini","Test touch sensor functionality":"Jaribu utendaji wa sensor ya touch","Verify motherboard display circuit":"Thibitisha mzunguko wa skrini kwenye motherboard","Battery or power issue detected":"Tatizo la betri au umeme limegunduliwa","Replace battery":"Badilisha betri","Check charging port":"Angalia port ya kuchaji","Test charging circuit":"Jaribu mzunguko wa kuchaji","Verify power management":"Thibitisha usimamizi wa umeme","Water damage detected":"Uharibifu wa maji umegunduliwa","Clean and dry components":"Safisha na kukausha vipengele","Replace damaged parts":"Badilisha sehemu zilizoharibiwa","Test all functions":"Jaribu kazi zote","Apply corrosion protection":"Weka ulinzi wa kutu","Performance or software issue detected":"Tatizo la utendaji au programu limegunduliwa","Clean and optimize system":"Safisha na boraisha mfumo","Update software":"Sasisha programu","Check hardware components":"Angalia vipengele vya hardware","Replace thermal paste":"Badilisha thermal paste","Audio system issue detected":"Tatizo la mfumo wa sauti limegunduliwa","Replace speakers":"Badilisha spika","Check audio circuit":"Angalia mzunguko wa sauti","Test microphone":"Jaribu kipaza sauti","Verify audio drivers":"Thibitisha drivers za sauti","Camera system issue detected":"Tatizo la mfumo wa kamera limegunduliwa","Replace camera module":"Badilisha moduli ya kamera","Clean camera lens":"Safisha lenzi ya kamera","Check camera circuit":"Angalia mzunguko wa kamera","Test camera software":"Jaribu programu ya kamera"}[u]||u}translateDifficultyToSwahili(u){return{Easy:"Rahisi",Medium:"Wastani",Hard:"Ngumu"}[u]||u}isOfflineAnalysisAvailable(){return this.knowledgeBase.patterns.length>0}getOfflineConfidence(){return .7}async syncKnowledgeBase(){if(!this.isOnline){console.log("ðŸ”´ Cannot sync - offline");return}try{console.log("ðŸ”„ Syncing knowledge base..."),console.log("âœ… Knowledge base synced")}catch(u){console.error("âŒ Failed to sync knowledge base:",u)}}}const Hs=new ia,q={brand:"",model:"",serialNumber:"",issueDescription:"",repairCost:"",expectedReturnDate:new Date().toISOString().split("T")[0],unlockCode:"",deviceNotes:"",assignedTo:""},Da=()=>{var zs;const[r,u]=i.useState(q),[d,y]=i.useState(!1);i.useState([]);const[N,w]=i.useState(!1),g=ea(),[l,k]=i.useState(null);i.useState(!1),kt();const[C,A]=i.useState(""),[$,p]=i.useState(!1),[f,E]=i.useState([]),[W,K]=i.useState(!1),X=i.useRef(null);i.useState([]),i.useState(!1),i.useState(!1);const[Se,Us]=i.useState(!0),[D,Vs]=i.useState("");i.useState(!1),i.useState(!1),i.useState(!1),i.useState(!1),i.useState(null);const[We,ke]=i.useState(!1),[Ke,Ce]=i.useState(!1),[qs,Xe]=i.useState(""),[x,I]=i.useState({isAnalyzing:!1,problem:"",solutions:[],estimatedCost:"",difficulty:"",timeEstimate:"",partsNeeded:[]}),[Ze,L]=i.useState(!1),[le,Ws]=i.useState(!0),[P,Qe]=i.useState("swahili"),[B,ce]=i.useState(!1),[Ks,Je]=i.useState(navigator.onLine),[ra,F]=i.useState(0);i.useState(null);const[na,G]=i.useState([]),[oa,Xs]=i.useState([]),[U,Z]=i.useState(!1),[b,T]=i.useState({name:"",phone:"",email:"",city:"",gender:"",loyaltyLevel:"bronze",colorTag:"new"}),[de,Ye]=i.useState(!1);i.useState(!1),i.useState(null);const[v,R]=i.useState({}),[H,Q]=i.useState({}),[es,J]=i.useState(null),[ue,ss]=i.useState(0),[ts,as]=i.useState(!1),[is,me]=i.useState(null),[rs,Pe]=i.useState({}),[ns,Ae]=i.useState(null),[os,Me]=i.useState(null),[ls,Ee]=i.useState(null),[la,Zs]=i.useState([]);let cs=null;try{const s=Ct();cs=(s==null?void 0:s.addDevice)||null}catch{}const{currentUser:Te}=Pt(),{spareParts:_,loadSpareParts:ds,categories:ze,loadCategories:us,isLoading:ms}=At(),[ps,pe]=i.useState([]),[he,Y]=i.useState(!1),[De,ee]=i.useState([]),[se,te]=i.useState(""),hs=i.useRef(null),xs=i.useRef(null),[Qs,gs]=i.useState(!1),Ie=i.useRef(null),[Le,Js]=i.useState(!1),[Ys,et]=i.useState("cash");i.useState("");const[st,tt]=i.useState(""),[at,it]=i.useState("");i.useState(!1);const[Be,rt]=i.useState(!1),[z,ae]=i.useState([]),[xe,nt]=i.useState(""),[Ge,ot]=i.useState("all");i.useEffect(()=>{Te&&Te.role==="technician"&&g("/dashboard")},[Te,g]);const[ge,lt]=i.useState("same_day"),Re=[{label:"Same Day",value:"same_day",days:0},{label:"2 Days",value:"2_days",days:2},{label:"3 Days",value:"3_days",days:3},{label:"1 Week",value:"1_week",days:7},{label:"Custom",value:"custom",days:null}],[fs,fe]=i.useState(!1),bs={same_day:e.jsx(Os,{size:20,className:"text-blue-500"}),"2_days":e.jsx(V,{size:20,className:"text-green-500"}),"3_days":e.jsx(V,{size:20,className:"text-yellow-500"}),"1_week":e.jsx(V,{size:20,className:"text-purple-500"}),custom:e.jsx(V,{size:20,className:"text-gray-400"})},ct=s=>{if(lt(s),fe(!1),s!=="custom"){const t=Re.find(a=>a.value===s);if(t&&t.days!==null){const a=new Date,n=t.value==="same_day"?new Date(a.getFullYear(),a.getMonth(),a.getDate()+1):new Date(a.getFullYear(),a.getMonth(),a.getDate()+(t.days||0));u(o=>({...o,expectedReturnDate:n.toISOString().split("T")[0]}))}}};i.useEffect(()=>{(async()=>{try{const{data:t,error:a}=await Is.from("users").select("*").eq("role","technician").eq("is_active",!0);if(a){console.error("Error fetching technicians:",a),pe([]);return}if(t&&t.length>0){const n=t.map(o=>({id:o.id,full_name:o.full_name||o.name||"Unknown",email:o.email||""}));pe(n)}else pe([])}catch(t){console.error("Exception fetching technicians:",t),pe([])}})()},[]),i.useEffect(()=>{console.log("ðŸ”§ Loading spare parts and categories..."),ds(),us()},[ds,us]),i.useEffect(()=>{console.log("ðŸ“¦ Spare parts loaded:",_.length,"parts"),console.log("ðŸ“‚ Categories loaded:",ze.length,"categories"),_.length>0&&console.log("ðŸ“¦ Sample spare part:",_[0])},[_,ze]),i.useEffect(()=>{if(!C.trim()){E([]),K(!1);return}const s=setTimeout(async()=>{try{K(!0);const t=await zt(C,1,50);t&&t.customers?E(t.customers):E([])}catch{m.error("Failed to search customers"),E([])}finally{K(!1)}},300);return()=>clearTimeout(s)},[C]),i.useEffect(()=>{const s=t=>{X.current&&!X.current.contains(t.target)&&p(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),i.useEffect(()=>{function s(t){hs.current&&!hs.current.contains(t.target)&&xs.current&&!xs.current.contains(t.target)&&w(!1)}return N&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[N]);const ie=s=>{const{name:t,value:a,type:n}=s.target;let o=n==="checkbox"&&"checked"in s.target?s.target.checked:a;if(t==="repairCost"){const c=a.replace(/,/g,"");if(c===""||/^\d+(\.\d{0,2})?$/.test(c))o=c;else return}u(c=>({...c,[t]:o}))},ys=s=>s.trim().split(/\s+/).filter(Boolean).length,vs=5,js=ys(r.issueDescription)>=vs,[ca,Ns]=i.useState(!1),re=async()=>{if(!r.model||!r.issueDescription.trim()){const t="Please fill in model and issue description for AI analysis";ye("issueDescription",t),m.error(t);return}I(t=>({...t,isAnalyzing:!0,error:void 0})),be(),G([{id:"1",title:"Analyzing Device",description:"Examining device specifications and issue",status:"active"},{id:"2",title:"Identifying Problem",description:"Determining root cause of issue",status:"pending"},{id:"3",title:"Generating Solutions",description:"Creating repair recommendations",status:"pending"},{id:"4",title:"Estimating Costs",description:"Calculating repair costs and time",status:"pending"}]),F(0);try{if(!Ks){m("Working offline - using local AI analysis");const t=await Hs.analyzeDevice(r.model,r.issueDescription,P);G(a=>a.map((n,o)=>({...n,status:o<=3?"completed":"pending"}))),I({isAnalyzing:!1,problem:t.problem,solutions:t.solutions,estimatedCost:t.estimatedCost,difficulty:t.difficulty,timeEstimate:t.timeEstimate,partsNeeded:t.partsNeeded}),_e(t),L(!0),m.success(`Offline analysis completed! (${Math.round(t.confidence*100)}% confidence)`);return}try{if(!(await Ls.testConnection()).success)throw new Error("Online AI not available");G(o=>o.map((c,j)=>({...c,status:j===0?"completed":j===1?"active":"pending"}))),F(1);let a;P==="swahili"?a=`Analyze this device repair problem and provide detailed solutions in SIMPLE SWAHILI with TECHNICAL TERMS IN ENGLISH:

Device: ${r.model}
Issue Description: ${r.issueDescription}
Device Conditions: ${De.join(", ")} ${se?`, ${se}`:""}

Please provide a structured analysis in JSON format with the following fields, using SIMPLE SWAHILI but TECHNICAL TERMS IN ENGLISH:

{
  "problem": "Maelezo rahisi ya tatizo la kifaa",
  "solutions": ["Njia ya 1 ya kurekebisha", "Njia ya 2 ya kurekebisha", "Njia ya 3 ya kurekebisha"],
  "estimatedCost": "Bei ya kurekebisha (Tsh)",
  "difficulty": "Rahisi/Wastani/Ngumu",
  "timeEstimate": "Muda wa kurekebisha",
  "partsNeeded": ["Part 1", "Part 2", "Part 3"],
  "commonCauses": ["Sababu ya 1", "Sababu ya 2"],
  "preventionTips": ["Ushauri wa 1", "Ushauri wa 2"]
}

IMPORTANT INSTRUCTIONS:
- Use SIMPLE SWAHILI for general explanations
- Use ENGLISH for technical terms and part names
- Keep language simple and practical for Dar es Salaam technicians
- Use Tanzanian Shillings (Tsh) for costs
- Focus on practical, actionable solutions for a local repair shop

TECHNICAL TERMS TO USE IN ENGLISH:
- Cable (not "kebo")
- Screen/LCD (not "skrini")
- Battery (not "betri")
- Charger (not "chaaji")
- Motherboard (not "bodi kuu")
- RAM (not "kumbukumbu")
- Storage (not "uhifadhi")
- Processor/CPU (not "kichakata")
- Speaker (not "spika")
- Microphone/Mic (not "kipaza sauti")
- Camera (not "kamera")
- Sensor (not "hisia")
- Adhesive (not "gundi")
- Connector (not "unganisho")
- Port (not "mlango")
- Button (not "kitufe")
- Switch (not "swichi")
- Circuit (not "mzunguko")
- Voltage (not "volti")
- Current (not "umeme")`:a=`Analyze this device repair problem and provide detailed solutions in ENGLISH:

Device: ${r.model}
Issue Description: ${r.issueDescription}
Device Conditions: ${De.join(", ")} ${se?`, ${se}`:""}

Please provide a structured analysis in JSON format with the following fields:

{
  "problem": "Clear description of the main problem",
  "solutions": ["Solution 1", "Solution 2", "Solution 3"],
  "estimatedCost": "Estimated repair cost range in USD",
  "difficulty": "Easy/Medium/Hard",
  "timeEstimate": "Estimated repair time",
  "partsNeeded": ["Part 1", "Part 2", "Part 3"],
  "commonCauses": ["Cause 1", "Cause 2"],
  "preventionTips": ["Tip 1", "Tip 2"]
}

IMPORTANT INSTRUCTIONS:
- Use clear, professional English
- Focus on practical, actionable solutions for a device repair shop
- Include specific parts that might need replacement
- Use realistic cost estimates
- Provide detailed technical analysis`,G(o=>o.map((c,j)=>({...c,status:j<=1?"completed":j===2?"active":"pending"}))),F(2);const n=await Ls.chat([{role:"user",content:a}]);if(n.success&&n.data){G(o=>o.map((c,j)=>({...c,status:j<=2?"completed":j===3?"active":"pending"}))),F(3);try{const o=n.data.match(/\{[\s\S]*\}/);if(o){const c=JSON.parse(o[0]);I({isAnalyzing:!1,problem:c.problem||"Analysis completed",solutions:c.solutions||[],estimatedCost:c.estimatedCost||"Cost to be determined",difficulty:c.difficulty||"Medium",timeEstimate:c.timeEstimate||"1-2 hours",partsNeeded:c.partsNeeded||[]})}else I({isAnalyzing:!1,problem:"AI analysis completed",solutions:[n.data],estimatedCost:"Cost to be determined",difficulty:"Medium",timeEstimate:"1-2 hours",partsNeeded:[]});_e({problem:parsed.problem||"Analysis completed",solutions:parsed.solutions||[],partsNeeded:parsed.partsNeeded||[]}),G(c=>c.map(j=>({...j,status:"completed"}))),F(4),L(!0),m.success("ðŸŸ¢ Online AI analysis completed!")}catch{I({isAnalyzing:!1,problem:"AI analysis completed",solutions:[n.data],estimatedCost:"Cost to be determined",difficulty:"Medium",timeEstimate:"1-2 hours",partsNeeded:[]}),L(!0),m.success("AI analysis completed!")}}else throw new Error(n.error||"AI analysis failed")}catch(t){Ss(t,"AI analysis");try{const a=await Hs.analyzeDevice(r.brand,r.model,r.issueDescription,P);I({isAnalyzing:!1,problem:a.problem,solutions:a.solutions,estimatedCost:a.estimatedCost,difficulty:a.difficulty,timeEstimate:a.timeEstimate,partsNeeded:a.partsNeeded}),_e(a),G(n=>n.map(o=>({...o,status:"completed"}))),F(4),L(!0),m.success(`ðŸ”„ Fallback analysis completed! (${Math.round(a.confidence*100)}% confidence)`),S("Offline AI analysis completed successfully","offline")}catch(a){He(a),I(n=>({...n,isAnalyzing:!1,error:"Both online and offline AI analysis failed"}))}}}catch(t){ks(),I(a=>({...a,isAnalyzing:!1,error:t instanceof Error?t.message:"Unknown error"})),G(a=>a.map(n=>({...n,status:"error"}))),m.error("AI analysis failed. Please try again.")}},_e=s=>{const t=[],a=s.problem.toLowerCase();(a.includes("screen")||a.includes("display")||a.includes("lcd"))&&t.push({id:"screen",name:"Screen",description:"Display or touch issues",x:50,y:30,severity:"high"}),(a.includes("battery")||a.includes("power")||a.includes("charge"))&&t.push({id:"battery",name:"Battery",description:"Power or charging issues",x:20,y:70,severity:"medium"}),(a.includes("camera")||a.includes("photo")||a.includes("video"))&&t.push({id:"camera",name:"Camera",description:"Camera or photo issues",x:80,y:25,severity:"medium"}),(a.includes("speaker")||a.includes("audio")||a.includes("sound"))&&t.push({id:"audio",name:"Audio",description:"Speaker or microphone issues",x:15,y:50,severity:"low"}),Xs(t)};i.useEffect(()=>{const s=()=>Je(!0),t=()=>Je(!1);return window.addEventListener("online",s),window.addEventListener("offline",t),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",t)}},[]),i.useEffect(()=>{if(le&&r.brand&&r.model&&js&&r.issueDescription.length>20&&!x.isAnalyzing&&!x.problem){const s=setTimeout(()=>{re()},2e3);return()=>clearTimeout(s)}},[r.brand,r.model,r.issueDescription,le,P]);const h=(()=>P==="swahili"?{modalTitle:"Uchambuzi wa Kifaa na AI",problemAnalysis:"Uchambuzi wa Tatizo",solutions:"Njia za Kurekebisha",estimatedCost:"Bei ya Kurekebisha",difficulty:"Kiwango cha Ugumu",timeEstimate:"Muda wa Kurekebisha",partsNeeded:"Sehemu Zinazohitajika",noParts:"Hakuna sehemu maalum zilizotambuliwa",analyzing:"Inachambua...",retryAnalysis:"Jaribu Tena",reAnalyze:"Chambua Tena",applySuggestions:"Tumia Mapendekezo",close:"Funga",aiAnalyzing:"AI inachambua tatizo...",analysisAvailable:"Uchambuzi wa AI unapatikana",viewAnalysis:"Tazama Uchambuzi",analysisFailed:"Uchambuzi wa AI umeshindwa",retry:"Jaribu Tena",willAnalyze:"AI itachambua wakati maelezo yatakapokamilika",suggestionsApplied:"Mapendekezo ya AI yamewekwa kwenye fomu",aiAnalysis:"Uchambuzi wa AI",serviceError:"Hitilafu ya Huduma ya AI",setupInstructions:"Jinsi ya kuweka AI Analysis:",goToSettings:"1. Nenda kwenye Mipangilio â†’ Muunganisho",findGemini:'2. Tafuta "Gemini AI" muunganisho',addApiKey:"3. Ongeza API key yako ya Google Gemini",enableIntegration:"4. Wezesha muunganisho",testConnection:"5. Jaribu muunganisho",getApiKey:"Pata API key ya bure kutoka:"}:{modalTitle:"AI Device Analysis",problemAnalysis:"Problem Analysis",solutions:"Recommended Solutions",estimatedCost:"Estimated Cost",difficulty:"Difficulty Level",timeEstimate:"Time Estimate",partsNeeded:"Parts Needed",noParts:"No specific parts identified",analyzing:"Analyzing...",retryAnalysis:"Retry Analysis",reAnalyze:"Re-analyze",applySuggestions:"Apply Suggestions",close:"Close",aiAnalyzing:"AI is analyzing the problem...",analysisAvailable:"AI analysis available",viewAnalysis:"View Analysis",analysisFailed:"AI analysis failed",retry:"Retry",willAnalyze:"AI will analyze when description is complete",suggestionsApplied:"AI suggestions applied to form",aiAnalysis:"AI Analysis",serviceError:"AI Service Error",setupInstructions:"How to set up AI Analysis:",goToSettings:"1. Go to Settings â†’ Integrations",findGemini:'2. Find "Gemini AI" integration',addApiKey:"3. Add your Google Gemini API key",enableIntegration:"4. Enable the integration",testConnection:"5. Test the connection",getApiKey:"Get a free API key from:"})(),ws=async()=>{if(!b.name.trim()||!b.phone.trim()){const s="Name and phone number are required";ye("customer",s),m.error(s);return}Ye(!0),be();try{const s=localStorage.getItem("current_branch_id"),{data:t,error:a}=await Is.from("customers").insert([{name:b.name.trim(),phone:b.phone.trim(),email:b.email.trim()||null,city:b.city.trim()||null,gender:b.gender||null,loyaltyLevel:b.loyaltyLevel,colorTag:b.colorTag,points:0,totalSpent:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),branch_id:s,created_by_branch_id:s}]).select().single();if(a)throw a;t&&(m.success("Customer created successfully!"),k(t),Z(!1),T({name:"",phone:"",email:"",city:"",gender:"",loyaltyLevel:"bronze",colorTag:"new"}),u(q),ee([]),te(""))}catch(s){Ss(s,"create customer"),(s==null?void 0:s.code)==="23505"?ye("phone","Phone number already exists. Please use a different number."):(s==null?void 0:s.code)==="23503"&&ye("customer","Invalid data provided for customer creation.")}finally{Ye(!1)}},dt=s=>{if(z.find(a=>a.spare_part_id===s.id))ae(a=>a.map(n=>n.spare_part_id===s.id?{...n,quantity:Math.min(n.quantity+1,s.quantity),total_cost:Math.min(n.quantity+1,s.quantity)*n.cost_per_unit}:n));else{const a={spare_part_id:s.id,name:s.name,part_number:s.part_number,quantity:1,cost_per_unit:s.selling_price,total_cost:s.selling_price,notes:""};ae(n=>[...n,a])}m.success("Spare part added to device")},ut=(s,t)=>{const a=_.find(o=>o.id===s);if(!a)return;const n=Math.max(1,Math.min(t,a.quantity));ae(o=>o.map(c=>c.spare_part_id===s?{...c,quantity:n,total_cost:n*c.cost_per_unit}:c))},mt=s=>{ae(t=>t.filter(a=>a.spare_part_id!==s)),m.success("Spare part removed")},pt=(s,t)=>{ae(a=>a.map(n=>n.spare_part_id===s?{...n,notes:t}:n))},Oe=_.filter(s=>{var c;const t=s.name.toLowerCase().includes(xe.toLowerCase())||s.part_number.toLowerCase().includes(xe.toLowerCase())||((c=s.brand)==null?void 0:c.toLowerCase().includes(xe.toLowerCase())),a=Ge==="all"||s.category_id===Ge,n=s.quantity>0,o=s.is_active;return t&&a&&n&&o}),ht=z.reduce((s,t)=>s+t.total_cost,0),$e=s=>{const t=s.replace(/\D/g,"");if(!s.trim())return{isValid:!1,error:"IMEI or Serial Number is required"};const a=s.replace(/\s/g,"").length,n=t.length,o=a-n;if(o>n&&a>=8)return{isValid:!0};if(a>=8&&n>=2&&o>=2)return{isValid:!0};if(n<12&&o===0)return{isValid:!1,error:"IMEI or Serial Number must be at least 12 digits"};if(n>20)return{isValid:!1,error:"IMEI or Serial Number is too long"};const c=s.toLowerCase(),j=["iphone","galaxy","pixel","oneplus","huawei","xiaomi","samsung","apple","note","plus","pro","max","ultra","mini","lite","neo","fe","a series","s series","m series","c series","g series","x series"];for(const Ve of j)if(c.includes(Ve))return{isValid:!1,error:"Please enter the actual IMEI or Serial Number, not the model name"};const ne=[/\b(iphone|galaxy|pixel|oneplus|huawei|xiaomi)\s+\d+/i,/\b(s|a|m|c|g|x)\s*\d+/i,/\b(pro|max|ultra|mini|lite|neo|fe)\b/i];for(const Ve of ne)if(Ve.test(s))return{isValid:!1,error:"Please enter the actual IMEI or Serial Number, not the model name"};return s.split(" ").length>2?{isValid:!1,error:"Please enter the actual IMEI or Serial Number, not a description"}:n>=12&&n/a>=.8?{isValid:!0}:a<8?{isValid:!1,error:"IMEI or Serial Number is too short"}:a>=8&&n>0&&o>0?{isValid:!0}:["n/a","na","unknown","not available","none","n/a","tbd","pending"].includes(c)?{isValid:!1,error:"Please enter the actual IMEI or Serial Number from the device"}:/(\d)\1{5,}/.test(t)?{isValid:!1,error:"IMEI or Serial Number appears to be invalid (repeated digits)"}:{isValid:!0}},xt=()=>{const s={},t={};let a=!0;J(null),Q({}),r.brand||r.model&&r.model.trim().length>0||(s.brand=!0,t.brand="Brand is required (included in model name)",a=!1),r.model.trim()?r.model.trim().length<2&&(s.model=!0,t.model="Model must be at least 2 characters",a=!1):(s.model=!0,t.model="Model is required",a=!1);const o=$e(D);if(o.isValid||(s.imeiOrSerial=!0,t.imeiOrSerial=o.error||"Please enter a valid IMEI or Serial Number",a=!1),r.issueDescription.trim()?js||(s.issueDescription=!0,t.issueDescription=`Issue description must be at least ${vs} words (currently ${ys(r.issueDescription)} words)`,a=!1):(s.issueDescription=!0,t.issueDescription="Issue description is required",a=!1),r.assignedTo||(s.assignedTo=!0,t.assignedTo="Please assign the device to a technician",a=!1),l||(s.customer=!0,t.customer="Please select or create a customer",a=!1),!r.expectedReturnDate)s.expectedReturnDate=!0,t.expectedReturnDate="Expected return date is required",a=!1;else{const c=new Date(r.expectedReturnDate),j=new Date;j.setHours(0,0,0,0),c<j&&(s.expectedReturnDate=!0,t.expectedReturnDate="Expected return date cannot be in the past",a=!1)}if(r.repairCost&&r.repairCost.trim()){const c=parseFloat(r.repairCost);(isNaN(c)||c<0)&&(s.repairCost=!0,t.repairCost="Repair cost must be a valid positive number",a=!1)}return R(s),Q(t),a},S=(s,t)=>{const a={timestamp:new Date,error:s,type:t};Zs(n=>[a,...n.slice(0,9)])},be=()=>{me(null),Pe({}),Ae(null),Me(null),Ee(null),J(null),R({}),Q({})},gt=s=>{const t="Network connection lost. Please check your internet connection and try again.";me(t),S(t,"network"),m.error(t)},Ss=(s,t="API call")=>{let a=`Failed to ${t.toLowerCase()}. Please try again.`;s!=null&&s.message&&(s.message.includes("permission")||s.message.includes("unauthorized")?a="Permission denied. Please contact your administrator.":s.message.includes("network")||s.message.includes("timeout")?a="Network timeout. Please check your connection and try again.":s.message.includes("validation")&&(a="Invalid data provided. Please check your input and try again.")),Ae(a),S(a,"api"),m.error(a)},ye=(s,t)=>{Pe(a=>({...a,[s]:t})),R(a=>({...a,[s]:!0})),Q(a=>({...a,[s]:t})),S(`Validation error in ${s}: ${t}`,"validation")},He=s=>{const t="Failed to save data offline. Please try again or contact support.";Me(t),S(t,"offline"),m.error(t)},ks=s=>{const t="A critical error occurred. Please refresh the page and try again.";Ee(t),S(t,"critical"),m.error(t)},Cs=s=>{var n,o,c,j;let t="An unexpected error occurred while creating the device.",a="api";if((s==null?void 0:s.code)==="23505")t="A device with this serial number already exists. Please check the IMEI/Serial Number.",a="validation",R(ne=>({...ne,imeiOrSerial:!0})),Q(ne=>({...ne,imeiOrSerial:t}));else if((s==null?void 0:s.code)==="23503")t="Invalid customer or technician selected. Please refresh and try again.",a="validation";else if((s==null?void 0:s.code)==="23514")t="Invalid data provided. Please check all fields and try again.",a="validation";else if((n=s==null?void 0:s.message)!=null&&n.includes("network")||(o=s==null?void 0:s.message)!=null&&o.includes("fetch"))t="Network error. Please check your connection and try again.",a="network",gt();else if((c=s==null?void 0:s.message)!=null&&c.includes("timeout"))t="Request timed out. Please try again.",a="network";else if((j=s==null?void 0:s.message)!=null&&j.includes("offline")){a="offline",He();return}else s!=null&&s.message&&(t=s.message);J(t),S(t,a),m.error(t),Y(!1),y(!1)},ft=async()=>{if(ue>=3){ks();return}as(!0),ss(s=>s+1),be();try{await new Promise(s=>setTimeout(s,1e3*Math.pow(2,ue-1))),await Ps(),ss(0),S("Device creation retry successful","success")}catch(s){Cs(s)}finally{as(!1)}},bt=s=>{if(!s)return"";const t=s.toLowerCase();return t.includes("iphone")||t.includes("ipad")||t.includes("macbook")?"Apple":t.includes("samsung")||t.includes("galaxy")?"Samsung":t.includes("google")||t.includes("pixel")?"Google":t.includes("huawei")?"Huawei":t.includes("xiaomi")||t.includes("redmi")||t.includes("poco")?"Xiaomi":t.includes("oneplus")?"OnePlus":t.includes("sony")||t.includes("xperia")?"Sony":t.includes("lg")?"LG":t.includes("motorola")?"Motorola":t.includes("nokia")?"Nokia":t.includes("microsoft")||t.includes("surface")?"Microsoft":t.includes("hp")?"HP":t.includes("dell")?"Dell":t.includes("lenovo")?"Lenovo":s.split(" ")[0]||""},Ps=async()=>{if(be(),M<70){const s="Please complete more fields before submitting.";S(s,"validation"),m.error(s);return}if(M<100){const s=`Form is ${M}% complete. Some fields are optional but recommended.`;m(s),S(s,"warning")}if(!xt()){const s="Please fix the required field errors before submitting.";S(s,"validation"),m.error(s);return}navigator.onLine||(me("No internet connection. Data will be saved offline."),S("Offline mode detected","network")),Y(!0),y(!0),J(null);try{const t={brand:r.brand||bt(r.model),model:r.model,serialNumber:r.serialNumber||D,unlockCode:r.unlockCode,customerId:l==null?void 0:l.id,expectedReturnDate:r.expectedReturnDate,status:"assigned",issueDescription:r.issueDescription,assignedTo:r.assignedTo,deviceNotes:"",deviceCondition:null,repairCost:r.repairCost?parseFloat(r.repairCost):null};if(!navigator.onLine)try{await Et({type:"addDevice",payload:t}),gs(!0),u(q),Y(!1),y(!1),setTimeout(()=>gs(!1),3e3),m.success("Device saved offline. Will sync when connection is restored."),S("Device saved offline successfully","offline");return}catch(n){He(n),Y(!1),y(!1);return}const a=await cs(t);if(a){if(z.length>0)try{console.log("ðŸ”§ Creating repair parts for device:",a.id),console.log("ðŸ“¦ Selected spare parts:",z);const n=z.map(c=>({device_id:a.id,spare_part_id:c.spare_part_id,quantity_needed:c.quantity,cost_per_unit:c.cost_per_unit,total_cost:c.total_cost,status:"needed",notes:c.notes||""}));console.log("ðŸ“¦ Repair parts data to send:",n);const o=await Tt(n);console.log("ðŸ“¦ Repair parts creation result:",o),o.ok?m.success(`${z.length} spare parts added to device and stock deducted`):(console.error("âŒ Failed to create repair parts:",o.message),m.error(`Failed to add spare parts: ${o.message}`),o.message.includes("Insufficient stock")?m.error("Some parts have insufficient stock. Please check inventory and try again."):o.message.includes("Operation failed")&&m.error("Some operations failed and were rolled back. Please check the parts and try again."))}catch(n){console.error("âŒ Error creating repair parts:",n);const o=n instanceof Error?n.message:"Unknown error";o.includes("Insufficient stock")?m.error("Cannot add spare parts: Insufficient stock available. Please check inventory."):o.includes("Operation failed")?m.error("Failed to add spare parts due to system error. All changes have been rolled back."):m.error(`Failed to add spare parts: ${o}`)}m.success("Device intake created successfully!"),Y(!1),y(!1),g(`/device/${a.id}`)}else throw new Error("Failed to create device intake. Please try again.")}catch(s){Cs(s)}},[Fe,Ue]=i.useState(!1),[As,ua]=i.useState(null);i.useState("form");const yt="custom_model_logos";function Ms(){const s=localStorage.getItem(yt);return s?JSON.parse(s):{}}const[vt,jt]=i.useState(Ms());i.useEffect(()=>{const s=()=>jt(Ms());return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const Nt=l?`device_intake_form_draft_${l.id}`:"device_intake_form_draft_no_customer",{clearDraft:Es}=Yt({key:Nt,formData:r,setFormData:u,clearOnSubmit:!0,submitted:he&&!d});i.useEffect(()=>{l?(ee([]),te("")):(u(q),ee([]),te(""),Es())},[l==null?void 0:l.id]);const[ma,Ts]=i.useState(!1),[pa,wt]=i.useState(null);i.useEffect(()=>{if(Object.values(r).some(s=>s!=="")){Ts(!0);const s=setTimeout(()=>{Ts(!1),wt(new Date)},2e3);return()=>clearTimeout(s)}},[r]);const M=(()=>{const s=r.brand||r.model&&r.model.trim().length>0,t=[l?1:0,s?1:0,r.model?1:0,D?1:0,r.assignedTo?1:0,r.issueDescription?1:0,De.length>0||se.trim()?1:0];return Math.round(t.reduce((a,n)=>a+n,0)/t.length*100)})(),[ve,St]=i.useState(!1);return e.jsxs("div",{className:"p-4 sm:p-6 h-full overflow-y-auto pt-8",children:[e.jsx("div",{className:"max-w-4xl mx-auto space-y-4 sm:space-y-6",children:e.jsx(Mt,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Gs,{size:20,className:"text-blue-600"}),"Customer Information"]}),l?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white font-semibold",children:l.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:l.name}),e.jsx("p",{className:"text-sm text-gray-600",children:l.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>St(!ve),className:"text-gray-500 hover:text-gray-700 p-1",title:ve?"Expand":"Minimize",children:ve?e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{k(null),u(q),ee([]),te(""),Es()},className:"text-gray-500 hover:text-gray-700 text-sm",children:"Change"})]})]}),!ve&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-3 border-t border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{size:14,className:"text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Loyalty"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:l.loyaltyLevel||"Bronze"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Points"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.points||0})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{size:14,className:"text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total Spent"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.totalSpent?`Tsh ${l.totalSpent.toLocaleString()}`:"Tsh 0"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{size:14,className:"text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Last Visit"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.lastVisit?new Date(l.lastVisit).toLocaleDateString():"Never"})]})]}),l.city&&e.jsxs("div",{className:"flex items-center gap-2 md:col-span-2",children:[e.jsx($t,{size:14,className:"text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Location"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.city})]})]}),l.colorTag&&l.colorTag!=="regular"&&e.jsxs("div",{className:"flex items-center gap-2 md:col-span-2",children:[e.jsx(Ht,{size:14,className:"text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Tag"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:l.colorTag})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:`block text-gray-700 mb-3 font-semibold ${v.customer?"text-red-600":""}`,children:["Search Customer *",v.customer&&e.jsx("span",{className:"text-xs text-red-500 ml-2",children:"(Required)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:C,onChange:s=>{A(s.target.value),p(!0)},onFocus:()=>p(!0),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Type name or phone...",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),$&&e.jsx("div",{className:"w-full bg-white/95 backdrop-blur-md border border-gray-300 rounded-lg shadow-xl mb-4",children:W?e.jsx("div",{className:"p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[e.jsx(qe,{className:"animate-spin",size:16}),e.jsx("span",{children:"Searching customers..."})]})}):f.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[f.length," customer(s) found"]}),e.jsxs("button",{type:"button",onClick:()=>Z(!U),className:"text-blue-600 hover:text-blue-700 font-medium text-sm flex items-center gap-1",children:[e.jsx(It,{size:14}),U?"Cancel":"Create New Customer"]})]}),U&&e.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Create New Customer"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:s=>T(t=>({...t,name:s.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter customer name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone *"}),e.jsx("input",{type:"tel",value:b.phone,onChange:s=>T(t=>({...t,phone:s.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:b.email,onChange:s=>T(t=>({...t,email:s.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter email (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:b.city,onChange:s=>T(t=>({...t,city:s.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter city (optional)"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:ws,disabled:de||!b.name.trim()||!b.phone.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:de?"Creating...":"Create Customer"}),e.jsx("button",{type:"button",onClick:()=>Z(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300",children:"Cancel"})]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200/50",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:" "}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Contact"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",children:"Points"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Loyalty"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Tag"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:f.map(s=>e.jsxs("tr",{className:"border-b border-gray-200/30 hover:bg-white/30 transition-colors cursor-pointer",onClick:()=>{k(s),Us(!0),A(""),p(!1)},children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold",children:s.name.charAt(0)})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.city})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Lt,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-900",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Bt,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:s.email})]})]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"text-gray-900 font-semibold",children:s.points})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm border ${s.loyaltyLevel==="platinum"?"bg-purple-500/20 text-purple-700 border-purple-300/30":s.loyaltyLevel==="gold"?"bg-amber-500/20 text-amber-700 border-amber-300/30":s.loyaltyLevel==="silver"?"bg-gray-400/20 text-gray-700 border-gray-300/30":"bg-orange-500/20 text-orange-700 border-orange-300/30"}`,children:[e.jsx(Rs,{size:14}),e.jsx("span",{className:"capitalize",children:s.loyaltyLevel})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm border ${s.colorTag==="vip"?"bg-emerald-500/20 text-emerald-700 border-emerald-300/30":s.colorTag==="complainer"?"bg-rose-500/20 text-rose-700 border-rose-300/30":s.colorTag==="purchased"?"bg-blue-500/20 text-blue-700 border-blue-300/30":s.colorTag==="new"?"bg-purple-500/20 text-purple-700 border-purple-300/30":"bg-gray-500/20 text-gray-700 border-gray-300/30"}`,children:s.colorTag})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation()},className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"View Details",children:e.jsx(Gt,{size:16})}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation()},className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"Edit Customer",children:e.jsx(Rt,{size:16})}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation()},className:"p-1 text-gray-500 hover:text-purple-600 transition-colors",title:"Send Message",children:e.jsx(_t,{size:16})})]})})]},s.id))})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx(Ot,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No customers found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search or create a new customer"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Create New Customer"}),e.jsx("button",{type:"button",onClick:()=>Z(!U),className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:U?"Cancel":"Add Customer"})]}),U&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:s=>T(t=>({...t,name:s.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter customer name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone *"}),e.jsx("input",{type:"tel",value:b.phone,onChange:s=>T(t=>({...t,phone:s.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:b.email,onChange:s=>T(t=>({...t,email:s.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter email (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:b.city,onChange:s=>T(t=>({...t,city:s.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter city (optional)"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:ws,disabled:de||!b.name.trim()||!b.phone.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:de?"Creating...":"Create Customer"}),e.jsx("button",{type:"button",onClick:()=>Z(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300",children:"Cancel"})]})]})]})]})})]}),e.jsx("button",{type:"button",onClick:()=>{ke(!0)},className:"w-12 h-12 flex items-center justify-center rounded-xl bg-white/30 backdrop-blur border border-gray-200 shadow-md hover:bg-white/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Add new customer",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"text-blue-500",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m6-6H6"})})})]}),v.customer&&e.jsx("div",{className:"text-red-500 text-xs mt-2",children:H.customer||"Please select or create a customer"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Fs,{size:20,className:"text-blue-600"}),"Device Information"]}),e.jsxs("form",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${v.model?"text-red-600":"text-gray-700"}`,children:["Model *",!r.model&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsx(ta,{value:r.model,onChange:s=>u(t=>({...t,model:s})),placeholder:"Enter model or model number",required:!0,className:`w-full ${v.model?"ring-2 ring-red-200":r.model?"":"ring-2 ring-yellow-200"}`,modelLogos:vt}),v.model&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:H.model||"Model is required"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${v.imeiOrSerial?"text-red-600":"text-gray-700"}`,children:["IMEI or Serial Number *",!D&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${v.imeiOrSerial?"border-red-500 focus:border-red-600":D?"border-gray-300 focus:border-blue-500":"border-yellow-300 focus:border-yellow-500"}`,placeholder:"Enter IMEI or Serial Number (min 12 digits)",value:D||"",onChange:s=>{const t=s.target.value.toUpperCase();Vs(t),u(a=>({...a,serialNumber:t})),t.length>0&&($e(t).isValid?R(n=>({...n,imeiOrSerial:!1})):R(n=>({...n,imeiOrSerial:!0})))},onBlur:()=>{$e(D).isValid?R(t=>({...t,imeiOrSerial:!1})):R(t=>({...t,imeiOrSerial:!0}))},autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ft,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),v.imeiOrSerial&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:H.imeiOrSerial||"Please enter a valid IMEI or Serial Number"}),v.imeiOrSerial&&D&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["ðŸ’¡ Tip: Enter the actual IMEI or Serial Number from the device, not the model name",e.jsx("br",{}),"ðŸ“± Examples: 123456789012345 (IMEI) or G9566RL4YC (Serial)"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Estimated Completion"}),e.jsx("div",{className:"relative",children:e.jsxs("button",{type:"button",className:"w-full py-3 pl-4 pr-10 bg-white border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none flex items-center hover:bg-gray-50 transition-colors",onClick:()=>fe(!0),tabIndex:0,children:[e.jsxs("span",{className:"flex items-center gap-2 w-full justify-start",children:[bs[ge],e.jsx("span",{className:"text-gray-800 whitespace-nowrap",children:(zs=Re.find(s=>s.value===ge))==null?void 0:zs.label})]}),e.jsx(Ut,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]})}),ge==="custom"&&e.jsxs("div",{className:"relative mt-2",children:[e.jsx(V,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx("input",{type:"date",name:"expectedReturnDate",value:r.expectedReturnDate,onChange:ie,className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${v.expectedReturnDate?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"}`,required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1})]}),v.expectedReturnDate&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:H.expectedReturnDate||"Please select a valid return date"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Unlock Code / Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"unlockCode",value:r.unlockCode,onChange:ie,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter unlock code or password (optional)",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Vt,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Estimated Repair Cost (TSH)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",name:"repairCost",value:r.repairCost,onChange:ie,className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${v.repairCost?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"}`,placeholder:"Estimated cost to repair the device",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ne,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Cost for parts and labor to fix the device"}),v.repairCost&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:H.repairCost||"Repair cost must be a valid positive number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block mb-2 font-medium ${v.assignedTo?"text-red-600":"text-gray-700"}`,children:"Assign Technician *"}),ps.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:ps.map(s=>{const t=(s.full_name||s.email||"").split(" ").map(n=>n[0]).join("").slice(0,2).toUpperCase(),a=r.assignedTo===s.id;return e.jsxs("button",{type:"button",onClick:()=>u(n=>({...n,assignedTo:s.id})),className:`relative flex flex-col items-center justify-center p-5 border rounded-xl shadow-md transition-all duration-200 focus:outline-none
                              ${a?"bg-gradient-to-br from-blue-100 to-blue-200 border-blue-500 ring-2 ring-blue-400 scale-105":"bg-white border-gray-200 hover:shadow-lg hover:scale-105"}
                            `,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold mb-2 transition-all duration-200
                              ${a?"bg-blue-500 text-white shadow":"bg-gray-200 text-gray-700"}`,children:t}),e.jsx("span",{className:"font-semibold text-base mb-1 text-gray-900 text-center",children:s.full_name||s.email}),a&&e.jsx("span",{className:"absolute top-2 right-2 bg-blue-500 text-white rounded-full p-1 shadow",children:e.jsx("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},s.id)})}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[e.jsx(O,{size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"No technicians available"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Please add technicians to the system first, or contact your administrator."})]})]})}),v.assignedTo&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:H.assignedTo||"Please select a technician"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Spare Parts Selection"]}),e.jsxs("button",{type:"button",onClick:()=>rt(!Be),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:[Be?"Hide":"Show"," Parts"]})]}),Be&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search Parts"}),e.jsxs("div",{className:"relative",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",value:xe,onChange:s=>nt(s.target.value),placeholder:"Search by name, part number, or brand...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{value:Ge,onChange:s=>ot(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Categories"}),ze.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-md",children:[e.jsx("div",{className:"p-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("h4",{className:"font-medium text-gray-900",children:["Available Parts (",Oe.length,")",ms&&e.jsx("span",{className:"ml-2 text-sm text-blue-600",children:"Loading..."})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:ms?e.jsx("div",{className:"p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsx("span",{children:"Loading spare parts..."})]})}):Oe.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(we,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No spare parts found matching your criteria."}),e.jsx("p",{className:"text-sm mt-1",children:_.length===0?"No spare parts available in inventory.":"Try adjusting your search or category filter."})]}):Oe.map(s=>e.jsx("div",{className:"p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:s.part_number})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.brand," â€¢ Stock: ",s.quantity," â€¢ Price: ",je(s.selling_price)]})]}),e.jsx("button",{type:"button",onClick:()=>dt(s),className:"ml-4 px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors",children:"Add"})]})},s.id))})]}),z.length>0&&e.jsxs("div",{className:"border border-gray-200 rounded-md",children:[e.jsx("div",{className:"p-3 bg-green-50 border-b border-gray-200",children:e.jsxs("h4",{className:"font-medium text-green-900",children:["Selected Parts (",z.length,") - Total: ",je(ht)]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:z.map(s=>{var t;return e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:s.part_number})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Qty:"}),e.jsx("input",{type:"number",min:"1",max:((t=_.find(a=>a.id===s.spare_part_id))==null?void 0:t.quantity)||1,value:s.quantity,onChange:a=>ut(s.spare_part_id,parseInt(a.target.value)||1),className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[je(s.cost_per_unit)," Ã— ",s.quantity," = ",je(s.total_cost)]})]}),e.jsx("input",{type:"text",placeholder:"Notes (optional)",value:s.notes||"",onChange:a=>pt(s.spare_part_id,a.target.value),className:"w-full mt-2 px-2 py-1 border border-gray-300 rounded text-sm"})]}),e.jsx("button",{type:"button",onClick:()=>mt(s.spare_part_id),className:"ml-4 p-1 text-red-600 hover:text-red-800",children:e.jsx(qt,{className:"w-4 h-4"})})]})},s.spare_part_id)})})]})]})]})}),r.repairCost&&l&&e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-green-900 flex items-center gap-2",children:[e.jsx(Ne,{size:20}),"Process Payment"]}),e.jsx("button",{type:"button",onClick:()=>Js(!Le),className:"text-green-600 hover:text-green-700 font-medium text-sm",children:Le?"Hide Payment":"Show Payment Options"})]}),e.jsxs("div",{className:"mb-3 p-3 bg-white rounded border",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Repair Cost:"}),e.jsxs("span",{className:"font-bold text-lg text-green-700",children:[parseFloat(r.repairCost).toLocaleString()," TSH"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-gray-700",children:"Customer:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.name})]})]}),Le&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{value:Ys,onChange:s=>et(s.target.value),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-green-500 focus:outline-none",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"transfer",children:"Bank Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference"}),e.jsx("input",{type:"text",value:st,onChange:s=>tt(s.target.value),placeholder:"Payment reference (optional)",className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-green-500 focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Notes"}),e.jsx("textarea",{value:at,onChange:s=>it(s.target.value),placeholder:"Additional payment notes (optional)",rows:2,className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-green-500 focus:outline-none resize-none"})]})]})]})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Device Notes (Optional)"}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{name:"deviceNotes",value:r.deviceNotes,onChange:ie,className:"w-full py-3 pl-4 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none resize-none",placeholder:"Add any additional notes about the device...",rows:2,autoComplete:"off",autoCorrect:"off",spellCheck:!1})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:`block font-medium ${v.issueDescription?"text-red-600":"text-gray-700"}`,children:"Issue Description *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:le,onChange:s=>Ws(s.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx(Wt,{size:16,className:"text-purple-500"}),"AI Analysis"]})})]}),e.jsx("textarea",{name:"issueDescription",value:r.issueDescription,onChange:s=>{ie(s),Ns(!0)},onBlur:()=>Ns(!0),className:`w-full py-3 pl-4 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none resize-none ${v.issueDescription?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"}`,placeholder:"Describe the issue in detail (at least 5 words)",rows:3,required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),v.issueDescription&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:H.issueDescription||"Please enter at least 5 words in the Issue Description."}),le&&r.issueDescription.length>0&&e.jsx("div",{className:"mt-3",children:x.isAnalyzing?e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 text-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:h.aiAnalyzing})]}):x.problem?e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[e.jsx(Kt,{size:16}),e.jsx("span",{children:h.analysisAvailable}),e.jsx("button",{type:"button",onClick:()=>L(!0),className:"text-blue-600 hover:text-blue-700 underline text-sm",children:h.viewAnalysis})]}):x.error?e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(O,{size:16}),e.jsx("span",{children:h.analysisFailed}),e.jsx("button",{type:"button",onClick:re,className:"text-blue-600 hover:text-blue-700 underline text-sm",children:h.retry})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 text-sm",children:[e.jsx(_s,{size:16}),e.jsx("span",{children:h.willAnalyze})]})})]}),es&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"text-red-500 mt-0.5 flex-shrink-0",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-red-800 font-medium mb-1",children:"Submission Error"}),e.jsx("p",{className:"text-red-700 text-sm mb-3",children:es}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ft,disabled:ts||ue>=3,className:"px-3 py-1.5 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:ts?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}),"Retrying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{size:14}),"Retry (",ue,"/3)"]})}),e.jsx("button",{onClick:()=>J(null),className:"px-3 py-1.5 bg-gray-200 text-gray-700 text-sm rounded-md hover:bg-gray-300",children:"Dismiss"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>g(-1),disabled:d||he,children:"Cancel"}),e.jsx("button",{type:"button",className:`px-6 py-3 rounded-lg font-semibold transition-all duration-200 ${M===100?"bg-green-600 text-white hover:bg-green-700 shadow-lg":M>=70?"bg-blue-600 text-white hover:bg-blue-700 shadow-md":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,onClick:Ps,disabled:d||he||M<70,children:d||he?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):M===100?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submit Device Intake"]}):M>=70?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Almost Ready (",M,"%)"]}),e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"})]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Complete Form (",M,"%)"]})})})]})]})]})]})})}),Fe&&As&&e.jsxs(oe,{isOpen:Fe,onClose:()=>Ue(!1),title:"Print QR Code",children:[e.jsx("div",{ref:Ie,className:"print-area",children:e.jsx(aa,{isOpen:Fe,onClose:()=>Ue(!1),device:As})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4 no-print",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",onClick:()=>{if(Ie.current){const s=Ie.current.innerHTML,t=window.open("","","height=600,width=400");t&&(t.document.write("<html><head><title>Print QR Code</title>"),t.document.write("<style>@media print { body { margin: 0; } }</style>"),t.document.write("</head><body >"),t.document.write(s),t.document.write("</body></html>"),t.document.close(),t.focus(),setTimeout(()=>{t.print(),t.close()},300))}},children:"Print"}),e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>Ue(!1),children:"Close"})]})]}),We&&e.jsx(Dt,{isOpen:We,onClose:()=>ke(!1),onCustomerCreated:s=>{k(s),ke(!1),A(""),p(!1),u(q),ee([]),te("")}}),Ze&&e.jsx(oe,{isOpen:Ze,onClose:()=>L(!1),title:h.modalTitle,size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 text-blue-600",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),e.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Analysis Language:"})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:async()=>{P!=="swahili"&&!B&&(ce(!0),Qe("swahili"),x.problem&&(m.success("Switching to Swahili and re-analyzing..."),await re()),ce(!1))},disabled:B,className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${P==="swahili"?"bg-blue-500 text-white shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"} ${B?"opacity-50 cursor-not-allowed":""}`,children:B&&P==="swahili"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Switching..."]}):"ðŸ‡¹ðŸ‡¿ Swahili"}),e.jsx("button",{type:"button",onClick:async()=>{P!=="english"&&!B&&(ce(!0),Qe("english"),x.problem&&(m.success("Switching to English and re-analyzing..."),await re()),ce(!1))},disabled:B,className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${P==="english"?"bg-blue-500 text-white shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"} ${B?"opacity-50 cursor-not-allowed":""}`,children:B&&P==="english"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Switching..."]}):"ðŸ‡¬ðŸ‡§ English"})]})]}),x.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-2 flex items-center gap-2",children:[e.jsx(O,{size:20}),h.serviceError]}),e.jsx("p",{className:"text-red-800 mb-3",children:x.error}),x.error.includes("not configured")&&e.jsxs("div",{className:"bg-white border border-red-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-red-900 mb-2",children:h.setupInstructions}),e.jsxs("ol",{className:"text-sm text-red-700 space-y-1",children:[e.jsx("li",{children:h.goToSettings}),e.jsx("li",{children:h.findGemini}),e.jsx("li",{children:h.addApiKey}),e.jsx("li",{children:h.enableIntegration}),e.jsx("li",{children:h.testConnection})]}),e.jsxs("div",{className:"mt-3 text-xs text-red-600",children:[h.getApiKey," ",e.jsx("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"Google AI Studio"})]})]})]}),!x.error&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(O,{size:20}),h.problemAnalysis]}),e.jsx("p",{className:"text-blue-800",children:x.problem})]}),!x.error&&x.solutions.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Xt,{size:20,className:"text-yellow-500"}),h.solutions]}),e.jsx("div",{className:"space-y-3",children:x.solutions.map((s,t)=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5",children:t+1}),e.jsx("p",{className:"text-gray-800",children:s})]})},t))})]}),!x.error&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-green-900 mb-2 flex items-center gap-2",children:[e.jsx(Ne,{size:16}),h.estimatedCost]}),e.jsx("p",{className:"text-green-800 font-medium",children:x.estimatedCost})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-orange-900 mb-2 flex items-center gap-2",children:[e.jsx(Zt,{size:16}),h.difficulty]}),e.jsx("p",{className:"text-orange-800 font-medium capitalize",children:x.difficulty})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-purple-900 mb-2 flex items-center gap-2",children:[e.jsx(Os,{size:16}),h.timeEstimate]}),e.jsx("p",{className:"text-purple-800 font-medium",children:x.timeEstimate})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(we,{size:16}),h.partsNeeded]}),x.partsNeeded.length>0?e.jsx("ul",{className:"space-y-1",children:x.partsNeeded.map((s,t)=>e.jsxs("li",{className:"text-gray-700 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),s]},t))}):e.jsx("p",{className:"text-gray-600 text-sm",children:h.noParts})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:re,disabled:x.isAnalyzing,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:x.isAnalyzing?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),h.analyzing]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{size:16}),x.error?h.retryAnalysis:h.reAnalyze]})}),e.jsxs("div",{className:"flex gap-2",children:[!x.error&&e.jsx("button",{type:"button",onClick:()=>{if(x.estimatedCost&&!r.repairCost){const s=x.estimatedCost.match(/Tsh\s*(\d+(?:,\d+)*(?:\.\d{2})?)/);s&&u(t=>({...t,repairCost:s[1].replace(/,/g,"")}))}L(!1),m.success(h.suggestionsApplied)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:h.applySuggestions}),e.jsx("button",{type:"button",onClick:()=>L(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:h.close})]})]})]})}),Ke&&e.jsxs(oe,{isOpen:Ke,onClose:()=>Ce(!1),title:"Add Note",children:[e.jsx("textarea",{className:"w-full py-3 pl-4 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none resize-none",placeholder:"Add a note (optional)",value:qs,onChange:s=>Xe(s.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>Ce(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",onClick:()=>{Ce(!1),Xe("")},children:"Save Note"})]})]}),fs&&e.jsxs(oe,{isOpen:fs,onClose:()=>fe(!1),title:"Select Completion Time",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:Re.map(s=>e.jsxs("button",{type:"button",className:`flex items-center gap-3 px-4 py-4 rounded-lg transition hover:bg-blue-50 w-full text-left text-base border-2 ${ge===s.value?"bg-blue-100 border-blue-500":"bg-white border-gray-200 hover:border-blue-300"}`,onClick:()=>ct(s.value),children:[bs[s.value],e.jsx("span",{className:"font-medium",children:s.label})]},s.value))}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>fe(!1),children:"Cancel"})})]}),ls&&e.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg text-center text-base font-semibold animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:20}),e.jsx("span",{children:ls})]}),e.jsx("button",{onClick:()=>Ee(null),className:"mt-2 text-sm underline hover:no-underline",children:"Dismiss"})]}),is&&e.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-orange-600 text-white px-6 py-3 rounded-lg shadow-lg text-center text-base font-semibold animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qt,{size:20}),e.jsx("span",{children:is})]}),e.jsx("button",{onClick:()=>me(null),className:"mt-2 text-sm underline hover:no-underline",children:"Dismiss"})]}),ns&&e.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg text-center text-base font-semibold animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:20}),e.jsx("span",{children:ns})]}),e.jsx("button",{onClick:()=>Ae(null),className:"mt-2 text-sm underline hover:no-underline",children:"Dismiss"})]}),os&&e.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-yellow-600 text-white px-6 py-3 rounded-lg shadow-lg text-center text-base font-semibold animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{size:20}),e.jsx("span",{children:os})]}),e.jsx("button",{onClick:()=>Me(null),className:"mt-2 text-sm underline hover:no-underline",children:"Dismiss"})]}),Object.keys(rs).length>0&&e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg animate-fade-in",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Validation Errors:"}),e.jsx("div",{className:"space-y-1",children:Object.entries(rs).map(([s,t])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("strong",{children:[s,":"]})," ",t]},s))}),e.jsx("button",{onClick:()=>Pe({}),className:"mt-2 text-xs underline hover:no-underline",children:"Dismiss"})]}),Qs&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg text-center text-base font-semibold animate-fade-in",children:"Device saved offline! Will sync when you are back online."})]})};export{Da as NewDevicePage,Da as default};
