import{j as e,s as j,u as G,M as K}from"./index-61458a34.js";import{r as a}from"./vendor-36d2c7c1.js";import{R as D,N as B,U as z,d as N,n as y,v as Q,a9 as X,r as A,a3 as P,y as O,l as $}from"./ui-28e30067.js";import{D as Z}from"./DailyReportModal-f39ca22c.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";const ee=()=>{const[r,h]=a.useState([]),[g,S]=a.useState(!0),[p,v]=a.useState(!1),b=async()=>{try{const{data:t,error:n}=await j.from("users").select("id, full_name, email, role").neq("role","admin").order("full_name");if(n)throw n;h(t||[])}catch(t){console.error("Error loading users:",t),y.error("Failed to load users")}finally{S(!1)}};a.useEffect(()=>{b()},[]);const m=async()=>{v(!0);const t=[{email:"technician@test.com",full_name:"John Technician",role:"technician"},{email:"customer.care@test.com",full_name:"Sarah Customer Care",role:"customer-care"},{email:"sales@test.com",full_name:"Mike Sales",role:"sales"},{email:"manager@test.com",full_name:"Lisa Manager",role:"manager"},{email:"user@test.com",full_name:"Alex User",role:"user"}];let n=0,i=0;for(const x of t)try{const{data:l}=await j.from("users").select("id").eq("email",x.email).single();if(l){console.log(`User ${x.email} already exists`),i++;continue}const{error:f}=await j.from("users").insert({full_name:x.full_name,email:x.email,role:x.role,is_active:!0});f?console.error(`Failed to create ${x.email}:`,f):(console.log(`Created ${x.email}`),n++)}catch(l){console.error(`Error creating ${x.email}:`,l)}n>0&&(y.success(`Created ${n} test users`),b()),i>0&&y(`Skipped ${i} existing users`,{icon:"ℹ️"}),v(!1)},R=t=>{switch(t){case"technician":return"bg-blue-100 text-blue-800";case"customer-care":return"bg-green-100 text-green-800";case"sales":return"bg-yellow-100 text-yellow-800";case"manager":return"bg-purple-100 text-purple-800";case"user":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return g?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{className:"p-6 max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Test User Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Create and manage test users for impersonation testing"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:b,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs("button",{onClick:m,disabled:p,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50",children:[p?e.jsx(D,{className:"w-4 h-4 animate-spin"}):e.jsx(B,{className:"w-4 h-4"}),"Create Test Users"]})]})]})}),e.jsx("div",{className:"p-6",children:r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Test Users Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create test users to test the impersonation feature"}),e.jsxs("button",{onClick:m,disabled:p,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50",children:[p?e.jsx(D,{className:"w-4 h-5 animate-spin"}):e.jsx(B,{className:"w-5 h-5"}),"Create Test Users"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Available Test Users (",r.length,")"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Use the user selector in TopBar to test impersonation"})]}),e.jsx("div",{className:"grid gap-4",children:r.map(t=>{var n,i;return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:((i=(n=t.full_name)==null?void 0:n.charAt(0))==null?void 0:i.toUpperCase())||"U"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.full_name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${R(t.role)}`,children:t.role.replace("-"," ")}),e.jsx(N,{className:"w-5 h-5 text-green-500"})]})]},t.id)})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"How to Test Impersonation:"}),e.jsxs("ol",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"1. Click the purple user icon in the TopBar (next to branch selector)"}),e.jsx("li",{children:"2. Select any user from the dropdown"}),e.jsx("li",{children:"3. You'll see the app from their perspective"}),e.jsx("li",{children:"4. Try creating a Daily Report to see role-specific templates"}),e.jsx("li",{children:'5. Click "Stop Testing" to return to admin account'})]})]})]})})]})})},ie=()=>{var q;const{currentUser:r}=G(),[h,g]=a.useState("reports"),[S,p]=a.useState([]),[v,b]=a.useState(!0),[m,R]=a.useState(""),[t,n]=a.useState("all"),[i,x]=a.useState("all"),[l,f]=a.useState(null),[W,E]=a.useState(!1),[H,T]=a.useState(!1),[F,k]=a.useState(""),U=a.useCallback(async()=>{var s;b(!0);try{const o=K();let c=j.from("daily_reports").select("*, user_id").order("created_at",{ascending:!1});!((s=r==null?void 0:r.permissions)!=null&&s.includes("all"))&&(r==null?void 0:r.role)!=="admin"&&(c=c.eq("branch_id",o));const{data:d,error:u}=await c;if(u)throw u;const _=await Promise.all((d||[]).map(async C=>{try{const{data:M,error:Y}=await j.from("users").select("full_name, role").eq("id",C.user_id).single();return{...C,user:Y?null:M}}catch(M){return console.warn("Failed to fetch user data for report:",C.id,M),{...C,user:null}}}));p(_)}catch(o){console.error("Error fetching reports:",o),y.error("Failed to load reports")}finally{b(!1)}},[r]);a.useEffect(()=>{U()},[U]);const w=S.filter(s=>{var u,_;const o=s.title.toLowerCase().includes(m.toLowerCase())||((_=(u=s.user)==null?void 0:u.full_name)==null?void 0:_.toLowerCase().includes(m.toLowerCase()))||s.customer_interactions.toLowerCase().includes(m.toLowerCase()),c=t==="all"||s.status===t,d=i==="all"||s.report_type===i;return o&&c&&d}),L=async(s,o,c)=>{try{const d={status:o,reviewed_at:new Date().toISOString(),reviewed_by:r==null?void 0:r.id,updated_at:new Date().toISOString()};c&&(d.review_notes=c);const{error:u}=await j.from("daily_reports").update(d).eq("id",s);if(u)throw u;y.success(`Report ${o} successfully`),U(),T(!1),k("")}catch(d){console.error("Error updating report status:",d),y.error("Failed to update report status")}},J=s=>{switch(s){case"draft":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700 border border-orange-200",children:[e.jsx(O,{className:"w-3 h-3"}),"Draft"]});case"submitted":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-700 border border-blue-200",children:[e.jsx(P,{className:"w-3 h-3"}),"Submitted"]});case"reviewed":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-purple-100 text-purple-700 border border-purple-200",children:[e.jsx($,{className:"w-3 h-3"}),"Reviewed"]});case"approved":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200",children:[e.jsx(N,{className:"w-3 h-3"}),"Approved"]});default:return null}},V=s=>e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium ${s==="daily"?"bg-blue-50 text-blue-700 border border-blue-200":"bg-teal-50 text-teal-700 border border-teal-200"}`,children:[e.jsx(A,{className:"w-3 h-3"}),s==="daily"?"Daily":"Monthly"]}),I=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return v?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading reports..."})]})}):h==="test-users"?e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Tools"}),e.jsx("p",{className:"text-gray-600",children:"Manage employee reports and testing tools"})]})}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>g("reports"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${h==="reports"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Employee Reports"}),e.jsx("button",{onClick:()=>g("test-users"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${h==="test-users"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Test User Management"})]})]}),e.jsx(ee,{})]}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Tools"}),e.jsx("p",{className:"text-gray-600",children:"Manage employee reports and testing tools"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:w.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Reports"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:w.filter(s=>s.status==="submitted").length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pending Review"})]})]})]}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>g("reports"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${h==="reports"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Employee Reports"}),e.jsx("button",{onClick:()=>g("test-users"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${h==="test-users"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Test User Management"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search reports...",value:m,onChange:s=>R(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-gray-500"}),e.jsxs("select",{value:t,onChange:s=>n(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"reviewed",children:"Reviewed"}),e.jsx("option",{value:"approved",children:"Approved"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-gray-500"}),e.jsxs("select",{value:i,onChange:s=>x(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:w.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(P,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No reports found"}),e.jsx("p",{className:"text-gray-600",children:m||t!=="all"||i!=="all"?"Try adjusting your filters":"No employee reports have been submitted yet"})]}):w.map(s=>{var o,c,d;return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),V(s.report_type),J(s.status)]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:((o=s.user)==null?void 0:o.full_name)||"Unknown User"}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{className:"capitalize",children:((d=(c=s.user)==null?void 0:c.role)==null?void 0:d.replace("-"," "))||"Unknown Role"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:s.report_type==="daily"?I(s.report_date):`Month: ${new Date(s.report_month||s.report_date).toLocaleDateString("en-US",{year:"numeric",month:"long"})}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:["Submitted: ",I(s.submitted_at||s.created_at)]})]})]}),(s.customers_served>0||s.sales_made>0||s.issues_resolved>0)&&e.jsxs("div",{className:"flex items-center gap-4 mb-4 p-3 bg-gray-50 rounded-lg",children:[s.customers_served>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:s.customers_served}),e.jsx("div",{className:"text-xs text-gray-600",children:"Customers Served"})]}),s.sales_made>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:s.sales_made}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sales Made"})]}),s.issues_resolved>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:s.issues_resolved}),e.jsx("div",{className:"text-xs text-gray-600",children:"Issues Resolved"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Customer Interactions:"}),e.jsx("p",{className:"text-gray-600 mt-1 line-clamp-2",children:s.customer_interactions})]}),s.pending_work&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Pending Work:"}),e.jsx("p",{className:"text-gray-600 mt-1 line-clamp-2",children:s.pending_work})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsxs("button",{onClick:()=>{f(s),E(!0)},className:"px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"View"]}),s.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>L(s.id,"reviewed"),className:"px-4 py-2 bg-purple-600 text-white hover:bg-purple-700 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Mark Reviewed"]}),e.jsxs("button",{onClick:()=>{f(s),T(!0)},className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Approve"]})]})]})]})},s.id)})}),H&&l&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[99999]",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(N,{className:"w-8 h-8 text-green-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Approve Report"})]}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Approve the report by ",e.jsx("strong",{children:(q=l.user)==null?void 0:q.full_name})," for"," ",l.report_type==="daily"?"daily":"monthly"," activities?"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Review Notes (Optional)"}),e.jsx("textarea",{value:F,onChange:s=>k(s.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"Add any review comments..."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>{T(!1),k("")},className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:()=>L(l.id,"approved",F||void 0),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Approve Report"]})]})]})}),e.jsx(Z,{isOpen:W,onClose:()=>{E(!1),f(null)},editReport:l||void 0,reportType:l==null?void 0:l.report_type})]})};export{ie as default};
