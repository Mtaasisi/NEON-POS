import{s as v,j as e}from"./index-61458a34.js";import{r as g}from"./vendor-36d2c7c1.js";import{z as w}from"./ui-28e30067.js";import{r as h,t as m,f as x}from"./index-5a6a7dda.js";import"./supabase-cf010ec4.js";import"./routing-eb8c310c.js";import"./pdf-e6e38bab.js";function _(l){h(1,arguments);var a=m(l),o=a.getDay();return o===0||o===6}function E(l){h(1,arguments);var a=m(l);return a.setHours(0,0,0,0),a}function T(l,a){h(2,arguments);var o=E(l),u=E(a);return o.getTime()===u.getTime()}function k(l){h(1,arguments);var a=m(l),o=a.getMonth();return a.setFullYear(a.getFullYear(),o+1,0),a.setHours(23,59,59,999),a}function F(l,a){var o;h(1,arguments);var u=l||{},d=m(u.start),j=m(u.end),b=j.getTime();if(!(d.getTime()<=b))throw new RangeError("Invalid interval");var y=[],i=d;i.setHours(0,0,0,0);var p=Number((o=a==null?void 0:a.step)!==null&&o!==void 0?o:1);if(p<1||isNaN(p))throw new RangeError("`options.step` must be a number greater than 1");for(;i.getTime()<=b;)y.push(m(i)),i.setDate(i.getDate()+p),i.setHours(0,0,0,0);return y}function M(l){h(1,arguments);var a=m(l);return a.setDate(1),a.setHours(0,0,0,0),a}const W=()=>{const[l,a]=g.useState([]),[o,u]=g.useState([]),[d,j]=g.useState(new Date),[b,y]=g.useState(!0),[i,p]=g.useState("all");g.useEffect(()=>{A(),N()},[d]);const A=async()=>{try{const{data:t,error:n}=await v.from("employees").select("*").eq("is_active",!0).order("full_name");if(n)throw n;a(t||[])}catch(t){console.error("Error fetching employees:",t),w.error("Failed to load employees")}},N=async()=>{try{y(!0);const t=x(M(d),"yyyy-MM-dd"),n=x(k(d),"yyyy-MM-dd"),{data:s,error:r}=await v.from("attendance_records").select("*").gte("attendance_date",t).lte("attendance_date",n).order("attendance_date");if(r)throw r;u(s||[])}catch(t){console.error("Error fetching attendance records:",t),w.error("Failed to load attendance records")}finally{y(!1)}},O=async(t,n,s)=>{try{const r=x(n,"yyyy-MM-dd"),{data:f}=await v.from("attendance_records").select("id").eq("employee_id",t).eq("attendance_date",r).maybeSingle();if(f){const{error:c}=await v.from("attendance_records").update({status:s,check_in_time:s==="present"?new Date().toISOString():null,updated_at:new Date().toISOString()}).eq("id",f.id);if(c)throw c}else{const{error:c}=await v.from("attendance_records").insert({employee_id:t,attendance_date:r,status:s,check_in_time:s==="present"?new Date().toISOString():null});if(c)throw c}w.success("Attendance marked successfully"),N()}catch(r){console.error("Error marking attendance:",r),w.error("Failed to mark attendance")}},I=()=>{const t=M(d),n=k(d);return F({start:t,end:n})},L=(t,n)=>o.find(s=>s.employee_id===t&&T(new Date(s.attendance_date),n)),R=t=>{const n=o.filter(s=>s.employee_id===t);return{present:n.filter(s=>s.status==="present").length,absent:n.filter(s=>s.status==="absent").length,late:n.filter(s=>s.status==="late").length,leave:n.filter(s=>s.status==="leave").length}},S=i==="all"?l:l.filter(t=>t.id===i),D=I();return b?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading attendance..."})]})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Attendance Management"}),e.jsx("p",{className:"text-gray-600",children:"Track and manage employee attendance records"})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Month"}),e.jsx("input",{type:"month",value:x(d,"yyyy-MM"),onChange:t=>j(new Date(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee"}),e.jsxs("select",{value:i,onChange:t=>p(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Employees"}),l.map(t=>e.jsxs("option",{value:t.id,children:[t.full_name," - ",t.position]},t.id))]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 bg-gray-50 px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),D.map(t=>e.jsxs("th",{className:`px-3 py-3 text-center text-xs font-medium uppercase tracking-wider ${_(t)?"bg-gray-100 text-gray-400":"text-gray-500"}`,children:[e.jsx("div",{children:x(t,"EEE")}),e.jsx("div",{children:x(t,"d")})]},t.toISOString())),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stats"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(t=>{const n=R(t.id);return e.jsxs("tr",{children:[e.jsxs("td",{className:"sticky left-0 bg-white px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.full_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.position})]}),D.map(s=>{const r=L(t.id,s),f=_(s);return e.jsx("td",{className:`px-1 py-2 text-center ${f?"bg-gray-50":""}`,children:!f&&e.jsx("button",{onClick:()=>{const c=(r==null?void 0:r.status)==="present"?"absent":"present";O(t.id,s,c)},className:`w-8 h-8 rounded-lg text-xs font-medium transition-colors ${(r==null?void 0:r.status)==="present"?"bg-green-500 text-white hover:bg-green-600":(r==null?void 0:r.status)==="absent"?"bg-red-500 text-white hover:bg-red-600":(r==null?void 0:r.status)==="late"?"bg-yellow-500 text-white hover:bg-yellow-600":(r==null?void 0:r.status)==="leave"?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,title:(r==null?void 0:r.status)||"No record",children:(r==null?void 0:r.status)==="present"?"P":(r==null?void 0:r.status)==="absent"?"A":(r==null?void 0:r.status)==="late"?"L":(r==null?void 0:r.status)==="leave"?"LV":"-"})},s.toISOString())}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"text-green-600",children:["P: ",n.present]}),e.jsxs("div",{className:"text-red-600",children:["A: ",n.absent]}),e.jsxs("div",{className:"text-yellow-600",children:["L: ",n.late]}),e.jsxs("div",{className:"text-blue-600",children:["LV: ",n.leave]})]})})]},t.id)})})]})}),S.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No employees found. Add employees to start tracking attendance."})]})};export{W as default};
