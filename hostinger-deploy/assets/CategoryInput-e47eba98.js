import{j as t}from"./index-61458a34.js";import{r as n}from"./vendor-36d2c7c1.js";import{T as M,b as y,an as z,bQ as B,bJ as Q}from"./ui-28e30067.js";const J=({value:a,onChange:E,placeholder:D="Enter category name",required:S=!1,className:$="",categories:l,showSuggestions:u=!0,disabled:m=!1,error:f})=>{const[j,c]=n.useState(!1),[N,b]=n.useState([]),[w,x]=n.useState(""),[I,F]=n.useState(new Set),h=n.useRef(null),g=n.useRef(null),C=n.useMemo(()=>{const e=new Map,s=[];try{l.forEach(r=>{e.set(r.id,{...r,children:[]})}),l.forEach(r=>{const d=e.get(r.id);if(r.parentId&&e.has(r.parentId)){const o=e.get(r.parentId);o.children=o.children||[],o.children.push(d)}else s.push(d)}),console.log("ðŸŒ³ CategoryInput: Built tree with",s.length,"root categories")}catch(r){console.error("âŒ CategoryInput: Error building category tree:",r),console.error("âŒ CategoryInput: Categories data:",l)}return s},[l]),k=e=>{if(x(e),!u||!e.trim()){b([]),c(!1);return}const s=l.filter(r=>r.name.toLowerCase().includes(e.toLowerCase()));b(s),c(s.length>0)},p=e=>{var s;console.log("ðŸŽ¯ CategoryInput: Selecting category:",e.name,e.id),E(e.id),x(e.name),c(!1),(s=h.current)==null||s.blur()},R=e=>{F(s=>{const r=new Set(s);return r.has(e)?r.delete(e):r.add(e),r})},L=()=>{!u||m||l.length>0&&(b([]),c(!0))};n.useEffect(()=>{const e=s=>{g.current&&!g.current.contains(s.target)&&h.current&&!h.current.contains(s.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),n.useEffect(()=>{if(a){const e=l.find(s=>s.id===a);e&&x(e.name)}else x("")},[a,l]);const v=(e,s=0)=>{const r=e.children&&e.children.length>0,d=I.has(e.id),o=a===e.id;return t.jsxs("div",{children:[t.jsx("button",{type:"button",onClick:i=>{i.preventDefault(),i.stopPropagation(),r?R(e.id):p(e)},onMouseDown:i=>{i.preventDefault(),r||p(e)},className:`w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0 focus:outline-none focus:bg-blue-50 ${o?"bg-blue-50 border-blue-200":""}`,style:{paddingLeft:`${16+s*20}px`},children:t.jsxs("div",{className:"flex items-center gap-3",children:[r?t.jsxs("div",{className:"flex items-center gap-2",children:[d?t.jsx(y,{className:"w-4 h-4 text-gray-500"}):t.jsx(z,{className:"w-4 h-4 text-gray-500"}),d?t.jsx(B,{className:"w-4 h-4 text-blue-500"}):t.jsx(Q,{className:"w-4 h-4 text-gray-500"})]}):t.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-300",style:{backgroundColor:e.color||"#3B82F6"}}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:`font-medium ${o?"text-blue-600":"text-gray-900"} flex items-center gap-2`,children:[e.icon&&t.jsx("span",{className:"text-lg",role:"img","aria-label":e.name,children:e.icon}),e.name]}),e.description&&t.jsx("div",{className:"text-sm text-gray-500 truncate",children:e.description})]}),o&&t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]})}),r&&d&&e.children&&t.jsx("div",{className:"border-l border-gray-200 ml-4",children:e.children.map(i=>v(i,s+1))})]},e.id)};return t.jsxs("div",{className:`relative ${$}`,children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{ref:h,type:"text",value:w,onChange:e=>k(e.target.value),onFocus:L,className:`w-full py-3 pl-12 pr-12 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors ${f?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"} ${m?"opacity-50 cursor-not-allowed":""}`,placeholder:D,required:S,disabled:m,autoComplete:"off"}),t.jsx(M,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),u&&t.jsx(y,{className:`absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 transition-transform ${j?"rotate-180":""}`,size:18})]}),f&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:f}),j&&u&&!m&&t.jsx("div",{ref:g,className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-y-auto",children:w.trim()?N.length>0?N.map(e=>t.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),p(e)},onMouseDown:s=>{s.preventDefault(),p(e)},className:`w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0 focus:outline-none focus:bg-blue-50 ${a===e.id?"bg-blue-50 border-blue-200":""}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-300",style:{backgroundColor:e.color||"#3B82F6"}}),t.jsxs("div",{children:[t.jsxs("div",{className:`font-medium ${a===e.id?"text-blue-600":"text-gray-900"} flex items-center gap-2`,children:[e.icon&&t.jsx("span",{className:"text-lg",role:"img","aria-label":e.name,children:e.icon}),e.name]}),e.description&&t.jsx("div",{className:"text-sm text-gray-500 truncate",children:e.description})]}),a===e.id&&t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]})},e.id)):t.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:"No categories found"}):C.length>0?C.map(e=>v(e)):t.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:"No categories available"})})]})};export{J as C};
