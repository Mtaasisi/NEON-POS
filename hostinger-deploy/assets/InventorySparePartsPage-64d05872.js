import{j as e,s as De,u as Lr,d as rr,aF as gs,aI as Ur,aJ as Er,e as Re,G as Pe,aK as hs,aL as Ot,aM as xs,aN as bs}from"./index-61458a34.js";import{r as G,R as xr}from"./vendor-36d2c7c1.js";import{ag as ps,k as Gt,X as $e,i as Et,cb as fs,Y as Lt,u as Ce,bM as ys,aP as Fr,ax as dt,q as yt,N as st,aZ as we,ce as Vt,aW as Je,b0 as et,cz as ot,cf as mt,bc as Fe,Z as Ct,aV as _t,bA as br,cy as pr,cm as At,x as vs,cp as Qt,cq as Ht,cx as fr,cA as tt,ck as lt,cu as Dt,ct as gt,cr as yr,cs as vr,a2 as ht,cw as jr,by as Xe,cv as Nr,cP as wr,cj as Sr,cl as It,l as Ft,aX as js,aR as Wt,a8 as xt,cn as Ns,cQ as ws,T as Ss,v as Mt,n as se,t as Mr,a3 as Pr,f as Xt,s as pt,G as ks,aA as Rr,b$ as Cs,S as kr,cg as _s,ch as As,ci as Ds,cE as Is,am as Ls,an as Us,J as at,e as ft,V as Zt,I as Cr,av as _r,d as Yt,af as Es,a4 as Fs,R as Jt,m as er,ab as Ms,aa as Ps}from"./ui-28e30067.js";import{_ as Rs}from"./supabase-cf010ec4.js";import{C as $r}from"./CategoryInput-e47eba98.js";import{P as Pt}from"./PriceInput-aa1a05e9.js";import{s as Tr}from"./storeLocationApi-1725ef86.js";import{format as He}from"./format-aff4c6a2.js";import{S as Ar,f as Me}from"./purchaseOrderUtils-7c108ebb.js";import{S as Dr}from"./SafeImage-a3ef104e.js";import{u as $s}from"./useDialog-6eb5c329.js";import"./routing-eb8c310c.js";function Ts(y,w){return w.forEach(function(c){c&&typeof c!="string"&&!Array.isArray(c)&&Object.keys(c).forEach(function(i){if(i!=="default"&&!(i in y)){var t=Object.getOwnPropertyDescriptor(c,i);Object.defineProperty(y,i,t.get?t:{enumerable:!0,get:function(){return c[i]}})}})}),Object.freeze(y)}function qr(y,w){return new Promise(function(c,i){let t;return qs(y).then(function(r){try{return t=r,c(new Blob([w.slice(0,2),t,w.slice(2)],{type:"image/jpeg"}))}catch(h){return i(h)}},i)})}const qs=y=>new Promise((w,c)=>{const i=new FileReader;i.addEventListener("load",({target:{result:t}})=>{const r=new DataView(t);let h=0;if(r.getUint16(h)!==65496)return c("not a valid JPEG");for(h+=2;;){const d=r.getUint16(h);if(d===65498)break;const C=r.getUint16(h+2);if(d===65505&&r.getUint32(h+4)===1165519206){const _=h+10;let n;switch(r.getUint16(_)){case 18761:n=!0;break;case 19789:n=!1;break;default:return c("TIFF header contains invalid endian")}if(r.getUint16(_+2,n)!==42)return c("TIFF header contains invalid version");const a=r.getUint32(_+4,n),s=_+a+2+12*r.getUint16(_+a,n);for(let m=_+a+2;m<s;m+=12)if(r.getUint16(m,n)==274){if(r.getUint16(m+2,n)!==3)return c("Orientation data type is invalid");if(r.getUint32(m+4,n)!==1)return c("Orientation data count is invalid");r.setUint16(m+8,1,n);break}return w(t.slice(h,h+2+C))}h+=2+C}return w(new Blob)}),i.readAsArrayBuffer(y)});var Rt={},Bs={get exports(){return Rt},set exports(y){Rt=y}};(function(y){var w,c,i={};Bs.exports=i,i.parse=function(t,r){for(var h=i.bin.readUshort,d=i.bin.readUint,C=0,_={},n=new Uint8Array(t),a=n.length-4;d(n,a)!=101010256;)a--;C=a,C+=4;var s=h(n,C+=4);h(n,C+=2);var m=d(n,C+=2),j=d(n,C+=4);C+=4,C=j;for(var E=0;E<s;E++){d(n,C),C+=4,C+=4,C+=4,d(n,C+=4),m=d(n,C+=4);var N=d(n,C+=4),S=h(n,C+=4),R=h(n,C+2),$=h(n,C+4);C+=6;var A=d(n,C+=8);C+=4,C+=S+R+$,i._readLocal(n,A,_,m,N,r)}return _},i._readLocal=function(t,r,h,d,C,_){var n=i.bin.readUshort,a=i.bin.readUint;a(t,r),n(t,r+=4),n(t,r+=2);var s=n(t,r+=2);a(t,r+=2),a(t,r+=4),r+=4;var m=n(t,r+=8),j=n(t,r+=2);r+=2;var E=i.bin.readUTF8(t,r,m);if(r+=m,r+=j,_)h[E]={size:C,csize:d};else{var N=new Uint8Array(t.buffer,r);if(s==0)h[E]=new Uint8Array(N.buffer.slice(r,r+d));else{if(s!=8)throw"unknown compression method: "+s;var S=new Uint8Array(C);i.inflateRaw(N,S),h[E]=S}}},i.inflateRaw=function(t,r){return i.F.inflate(t,r)},i.inflate=function(t,r){return t[0],t[1],i.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),r)},i.deflate=function(t,r){r==null&&(r={level:6});var h=0,d=new Uint8Array(50+Math.floor(1.1*t.length));d[h]=120,d[h+1]=156,h+=2,h=i.F.deflateRaw(t,d,h,r.level);var C=i.adler(t,0,t.length);return d[h+0]=C>>>24&255,d[h+1]=C>>>16&255,d[h+2]=C>>>8&255,d[h+3]=C>>>0&255,new Uint8Array(d.buffer,0,h+4)},i.deflateRaw=function(t,r){r==null&&(r={level:6});var h=new Uint8Array(50+Math.floor(1.1*t.length)),d=i.F.deflateRaw(t,h,d,r.level);return new Uint8Array(h.buffer,0,d)},i.encode=function(t,r){r==null&&(r=!1);var h=0,d=i.bin.writeUint,C=i.bin.writeUshort,_={};for(var n in t){var a=!i._noNeed(n)&&!r,s=t[n],m=i.crc.crc(s,0,s.length);_[n]={cpr:a,usize:s.length,crc:m,file:a?i.deflateRaw(s):s}}for(var n in _)h+=_[n].file.length+30+46+2*i.bin.sizeUTF8(n);h+=22;var j=new Uint8Array(h),E=0,N=[];for(var n in _){var S=_[n];N.push(E),E=i._writeHeader(j,E,n,S,0)}var R=0,$=E;for(var n in _)S=_[n],N.push(E),E=i._writeHeader(j,E,n,S,1,N[R++]);var A=E-$;return d(j,E,101010256),E+=4,C(j,E+=4,R),C(j,E+=2,R),d(j,E+=2,A),d(j,E+=4,$),E+=4,E+=2,j.buffer},i._noNeed=function(t){var r=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(r)!=-1},i._writeHeader=function(t,r,h,d,C,_){var n=i.bin.writeUint,a=i.bin.writeUshort,s=d.file;return n(t,r,C==0?67324752:33639248),r+=4,C==1&&(r+=2),a(t,r,20),a(t,r+=2,0),a(t,r+=2,d.cpr?8:0),n(t,r+=2,0),n(t,r+=4,d.crc),n(t,r+=4,s.length),n(t,r+=4,d.usize),a(t,r+=4,i.bin.sizeUTF8(h)),a(t,r+=2,0),r+=2,C==1&&(r+=2,r+=2,n(t,r+=6,_),r+=4),r+=i.bin.writeUTF8(t,r,h),C==0&&(t.set(s,r),r+=s.length),r},i.crc={table:function(){for(var t=new Uint32Array(256),r=0;r<256;r++){for(var h=r,d=0;d<8;d++)1&h?h=3988292384^h>>>1:h>>>=1;t[r]=h}return t}(),update:function(t,r,h,d){for(var C=0;C<d;C++)t=i.crc.table[255&(t^r[h+C])]^t>>>8;return t},crc:function(t,r,h){return 4294967295^i.crc.update(4294967295,t,r,h)}},i.adler=function(t,r,h){for(var d=1,C=0,_=r,n=r+h;_<n;){for(var a=Math.min(_+5552,n);_<a;)C+=d+=t[_++];d%=65521,C%=65521}return C<<16|d},i.bin={readUshort:function(t,r){return t[r]|t[r+1]<<8},writeUshort:function(t,r,h){t[r]=255&h,t[r+1]=h>>8&255},readUint:function(t,r){return 16777216*t[r+3]+(t[r+2]<<16|t[r+1]<<8|t[r])},writeUint:function(t,r,h){t[r]=255&h,t[r+1]=h>>8&255,t[r+2]=h>>16&255,t[r+3]=h>>24&255},readASCII:function(t,r,h){for(var d="",C=0;C<h;C++)d+=String.fromCharCode(t[r+C]);return d},writeASCII:function(t,r,h){for(var d=0;d<h.length;d++)t[r+d]=h.charCodeAt(d)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,r,h){for(var d,C="",_=0;_<h;_++)C+="%"+i.bin.pad(t[r+_].toString(16));try{d=decodeURIComponent(C)}catch{return i.bin.readASCII(t,r,h)}return d},writeUTF8:function(t,r,h){for(var d=h.length,C=0,_=0;_<d;_++){var n=h.charCodeAt(_);if(!(4294967168&n))t[r+C]=n,C++;else if(!(4294965248&n))t[r+C]=192|n>>6,t[r+C+1]=128|n>>0&63,C+=2;else if(!(4294901760&n))t[r+C]=224|n>>12,t[r+C+1]=128|n>>6&63,t[r+C+2]=128|n>>0&63,C+=3;else{if(4292870144&n)throw"e";t[r+C]=240|n>>18,t[r+C+1]=128|n>>12&63,t[r+C+2]=128|n>>6&63,t[r+C+3]=128|n>>0&63,C+=4}}return C},sizeUTF8:function(t){for(var r=t.length,h=0,d=0;d<r;d++){var C=t.charCodeAt(d);if(!(4294967168&C))h++;else if(!(4294965248&C))h+=2;else if(!(4294901760&C))h+=3;else{if(4292870144&C)throw"e";h+=4}}return h}},i.F={},i.F.deflateRaw=function(t,r,h,d){var C=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][d],_=i.F.U,n=i.F._goodIndex;i.F._hash;var a=i.F._putsE,s=0,m=h<<3,j=0,E=t.length;if(d==0){for(;s<E;)a(r,m,s+(L=Math.min(65535,E-s))==E?1:0),m=i.F._copyExact(t,s,L,r,m+8),s+=L;return m>>>3}var N=_.lits,S=_.strt,R=_.prev,$=0,A=0,T=0,b=0,F=0,o=0;for(E>2&&(S[o=i.F._hash(t,0)]=0),s=0;s<E;s++){if(F=o,s+1<E-2){o=i.F._hash(t,s+1);var u=s+1&32767;R[u]=S[o],S[o]=u}if(j<=s){($>14e3||A>26697)&&E-s>100&&(j<s&&(N[$]=s-j,$+=2,j=s),m=i.F._writeBlock(s==E-1||j==E?1:0,N,$,b,t,T,s-T,r,m),$=A=b=0,T=s);var k=0;s<E-2&&(k=i.F._bestMatch(t,s,R,F,Math.min(C[2],E-s),C[3]));var L=k>>>16,I=65535&k;if(k!=0){I=65535&k;var p=n(L=k>>>16,_.of0);_.lhst[257+p]++;var x=n(I,_.df0);_.dhst[x]++,b+=_.exb[p]+_.dxb[x],N[$]=L<<23|s-j,N[$+1]=I<<16|p<<8|x,$+=2,j=s+L}else _.lhst[t[s]]++;A++}}for(T==s&&t.length!=0||(j<s&&(N[$]=s-j,$+=2,j=s),m=i.F._writeBlock(1,N,$,b,t,T,s-T,r,m),$=0,A=0,$=A=b=0,T=s);7&m;)m++;return m>>>3},i.F._bestMatch=function(t,r,h,d,C,_){var n=32767&r,a=h[n],s=n-a+32768&32767;if(a==n||d!=i.F._hash(t,r-s))return 0;for(var m=0,j=0,E=Math.min(32767,r);s<=E&&--_!=0&&a!=n;){if(m==0||t[r+m]==t[r+m-s]){var N=i.F._howLong(t,r,s);if(N>m){if(j=s,(m=N)>=C)break;s+2<N&&(N=s+2);for(var S=0,R=0;R<N-2;R++){var $=r-s+R+32768&32767,A=$-h[$]+32768&32767;A>S&&(S=A,a=$)}}}s+=(n=a)-(a=h[n])+32768&32767}return m<<16|j},i.F._howLong=function(t,r,h){if(t[r]!=t[r-h]||t[r+1]!=t[r+1-h]||t[r+2]!=t[r+2-h])return 0;var d=r,C=Math.min(t.length,r+258);for(r+=3;r<C&&t[r]==t[r-h];)r++;return r-d},i.F._hash=function(t,r){return(t[r]<<8|t[r+1])+(t[r+2]<<4)&65535},i.saved=0,i.F._writeBlock=function(t,r,h,d,C,_,n,a,s){var m,j,E,N,S,R,$,A,T,b=i.F.U,F=i.F._putsF,o=i.F._putsE;b.lhst[256]++,j=(m=i.F.getTrees())[0],E=m[1],N=m[2],S=m[3],R=m[4],$=m[5],A=m[6],T=m[7];var u=32+(s+3&7?8-(s+3&7):0)+(n<<3),k=d+i.F.contSize(b.fltree,b.lhst)+i.F.contSize(b.fdtree,b.dhst),L=d+i.F.contSize(b.ltree,b.lhst)+i.F.contSize(b.dtree,b.dhst);L+=14+3*$+i.F.contSize(b.itree,b.ihst)+(2*b.ihst[16]+3*b.ihst[17]+7*b.ihst[18]);for(var I=0;I<286;I++)b.lhst[I]=0;for(I=0;I<30;I++)b.dhst[I]=0;for(I=0;I<19;I++)b.ihst[I]=0;var p=u<k&&u<L?0:k<L?1:2;if(F(a,s,t),F(a,s+1,p),s+=3,p==0){for(;7&s;)s++;s=i.F._copyExact(C,_,n,a,s)}else{var x,v;if(p==1&&(x=b.fltree,v=b.fdtree),p==2){i.F.makeCodes(b.ltree,j),i.F.revCodes(b.ltree,j),i.F.makeCodes(b.dtree,E),i.F.revCodes(b.dtree,E),i.F.makeCodes(b.itree,N),i.F.revCodes(b.itree,N),x=b.ltree,v=b.dtree,o(a,s,S-257),o(a,s+=5,R-1),o(a,s+=5,$-4),s+=4;for(var l=0;l<$;l++)o(a,s+3*l,b.itree[1+(b.ordr[l]<<1)]);s+=3*$,s=i.F._codeTiny(A,b.itree,a,s),s=i.F._codeTiny(T,b.itree,a,s)}for(var g=_,B=0;B<h;B+=2){for(var M=r[B],P=M>>>23,X=g+(8388607&M);g<X;)s=i.F._writeLit(C[g++],x,a,s);if(P!=0){var W=r[B+1],O=W>>16,V=W>>8&255,q=255&W;o(a,s=i.F._writeLit(257+V,x,a,s),P-b.of0[V]),s+=b.exb[V],F(a,s=i.F._writeLit(q,v,a,s),O-b.df0[q]),s+=b.dxb[q],g+=P}}s=i.F._writeLit(256,x,a,s)}return s},i.F._copyExact=function(t,r,h,d,C){var _=C>>>3;return d[_]=h,d[_+1]=h>>>8,d[_+2]=255-d[_],d[_+3]=255-d[_+1],_+=4,d.set(new Uint8Array(t.buffer,r,h),_),C+(h+4<<3)},i.F.getTrees=function(){for(var t=i.F.U,r=i.F._hufTree(t.lhst,t.ltree,15),h=i.F._hufTree(t.dhst,t.dtree,15),d=[],C=i.F._lenCodes(t.ltree,d),_=[],n=i.F._lenCodes(t.dtree,_),a=0;a<d.length;a+=2)t.ihst[d[a]]++;for(a=0;a<_.length;a+=2)t.ihst[_[a]]++;for(var s=i.F._hufTree(t.ihst,t.itree,7),m=19;m>4&&t.itree[1+(t.ordr[m-1]<<1)]==0;)m--;return[r,h,s,C,n,m,d,_]},i.F.getSecond=function(t){for(var r=[],h=0;h<t.length;h+=2)r.push(t[h+1]);return r},i.F.nonZero=function(t){for(var r="",h=0;h<t.length;h+=2)t[h+1]!=0&&(r+=(h>>1)+",");return r},i.F.contSize=function(t,r){for(var h=0,d=0;d<r.length;d++)h+=r[d]*t[1+(d<<1)];return h},i.F._codeTiny=function(t,r,h,d){for(var C=0;C<t.length;C+=2){var _=t[C],n=t[C+1];d=i.F._writeLit(_,r,h,d);var a=_==16?2:_==17?3:7;_>15&&(i.F._putsE(h,d,n,a),d+=a)}return d},i.F._lenCodes=function(t,r){for(var h=t.length;h!=2&&t[h-1]==0;)h-=2;for(var d=0;d<h;d+=2){var C=t[d+1],_=d+3<h?t[d+3]:-1,n=d+5<h?t[d+5]:-1,a=d==0?-1:t[d-1];if(C==0&&_==C&&n==C){for(var s=d+5;s+2<h&&t[s+2]==C;)s+=2;(m=Math.min(s+1-d>>>1,138))<11?r.push(17,m-3):r.push(18,m-11),d+=2*m-2}else if(C==a&&_==C&&n==C){for(s=d+5;s+2<h&&t[s+2]==C;)s+=2;var m=Math.min(s+1-d>>>1,6);r.push(16,m-3),d+=2*m-2}else r.push(C,0)}return h>>>1},i.F._hufTree=function(t,r,h){var d=[],C=t.length,_=r.length,n=0;for(n=0;n<_;n+=2)r[n]=0,r[n+1]=0;for(n=0;n<C;n++)t[n]!=0&&d.push({lit:n,f:t[n]});var a=d.length,s=d.slice(0);if(a==0)return 0;if(a==1){var m=d[0].lit;return s=m==0?1:0,r[1+(m<<1)]=1,r[1+(s<<1)]=1,1}d.sort(function(A,T){return A.f-T.f});var j=d[0],E=d[1],N=0,S=1,R=2;for(d[0]={lit:-1,f:j.f+E.f,l:j,r:E,d:0};S!=a-1;)j=N!=S&&(R==a||d[N].f<d[R].f)?d[N++]:d[R++],E=N!=S&&(R==a||d[N].f<d[R].f)?d[N++]:d[R++],d[S++]={lit:-1,f:j.f+E.f,l:j,r:E};var $=i.F.setDepth(d[S-1],0);for($>h&&(i.F.restrictDepth(s,h,$),$=h),n=0;n<a;n++)r[1+(s[n].lit<<1)]=s[n].d;return $},i.F.setDepth=function(t,r){return t.lit!=-1?(t.d=r,r):Math.max(i.F.setDepth(t.l,r+1),i.F.setDepth(t.r,r+1))},i.F.restrictDepth=function(t,r,h){var d=0,C=1<<h-r,_=0;for(t.sort(function(a,s){return s.d==a.d?a.f-s.f:s.d-a.d}),d=0;d<t.length&&t[d].d>r;d++){var n=t[d].d;t[d].d=r,_+=C-(1<<h-n)}for(_>>>=h-r;_>0;)(n=t[d].d)<r?(t[d].d++,_-=1<<r-n-1):d++;for(;d>=0;d--)t[d].d==r&&_<0&&(t[d].d--,_++);_!=0&&console.log("debt left")},i.F._goodIndex=function(t,r){var h=0;return r[16|h]<=t&&(h|=16),r[8|h]<=t&&(h|=8),r[4|h]<=t&&(h|=4),r[2|h]<=t&&(h|=2),r[1|h]<=t&&(h|=1),h},i.F._writeLit=function(t,r,h,d){return i.F._putsF(h,d,r[t<<1]),d+r[1+(t<<1)]},i.F.inflate=function(t,r){var h=Uint8Array;if(t[0]==3&&t[1]==0)return r||new h(0);var d=i.F,C=d._bitsF,_=d._bitsE,n=d._decodeTiny,a=d.makeCodes,s=d.codes2map,m=d._get17,j=d.U,E=r==null;E&&(r=new h(t.length>>>2<<3));for(var N,S,R=0,$=0,A=0,T=0,b=0,F=0,o=0,u=0,k=0;R==0;)if(R=C(t,k,1),$=C(t,k+1,2),k+=3,$!=0){if(E&&(r=i.F._check(r,u+(1<<17))),$==1&&(N=j.flmap,S=j.fdmap,F=511,o=31),$==2){A=_(t,k,5)+257,T=_(t,k+5,5)+1,b=_(t,k+10,4)+4,k+=14;for(var L=0;L<38;L+=2)j.itree[L]=0,j.itree[L+1]=0;var I=1;for(L=0;L<b;L++){var p=_(t,k+3*L,3);j.itree[1+(j.ordr[L]<<1)]=p,p>I&&(I=p)}k+=3*b,a(j.itree,I),s(j.itree,I,j.imap),N=j.lmap,S=j.dmap,k=n(j.imap,(1<<I)-1,A+T,t,k,j.ttree);var x=d._copyOut(j.ttree,0,A,j.ltree);F=(1<<x)-1;var v=d._copyOut(j.ttree,A,T,j.dtree);o=(1<<v)-1,a(j.ltree,x),s(j.ltree,x,N),a(j.dtree,v),s(j.dtree,v,S)}for(;;){var l=N[m(t,k)&F];k+=15&l;var g=l>>>4;if(!(g>>>8))r[u++]=g;else{if(g==256)break;var B=u+g-254;if(g>264){var M=j.ldef[g-257];B=u+(M>>>3)+_(t,k,7&M),k+=7&M}var P=S[m(t,k)&o];k+=15&P;var X=P>>>4,W=j.ddef[X],O=(W>>>4)+C(t,k,15&W);for(k+=15&W,E&&(r=i.F._check(r,u+(1<<17)));u<B;)r[u]=r[u++-O],r[u]=r[u++-O],r[u]=r[u++-O],r[u]=r[u++-O];u=B}}}else{7&k&&(k+=8-(7&k));var V=4+(k>>>3),q=t[V-4]|t[V-3]<<8;E&&(r=i.F._check(r,u+q)),r.set(new h(t.buffer,t.byteOffset+V,q),u),k=V+q<<3,u+=q}return r.length==u?r:r.slice(0,u)},i.F._check=function(t,r){var h=t.length;if(r<=h)return t;var d=new Uint8Array(Math.max(h<<1,r));return d.set(t,0),d},i.F._decodeTiny=function(t,r,h,d,C,_){for(var n=i.F._bitsE,a=i.F._get17,s=0;s<h;){var m=t[a(d,C)&r];C+=15&m;var j=m>>>4;if(j<=15)_[s]=j,s++;else{var E=0,N=0;j==16?(N=3+n(d,C,2),C+=2,E=_[s-1]):j==17?(N=3+n(d,C,3),C+=3):j==18&&(N=11+n(d,C,7),C+=7);for(var S=s+N;s<S;)_[s]=E,s++}}return C},i.F._copyOut=function(t,r,h,d){for(var C=0,_=0,n=d.length>>>1;_<h;){var a=t[_+r];d[_<<1]=0,d[1+(_<<1)]=a,a>C&&(C=a),_++}for(;_<n;)d[_<<1]=0,d[1+(_<<1)]=0,_++;return C},i.F.makeCodes=function(t,r){for(var h,d,C,_,n=i.F.U,a=t.length,s=n.bl_count,m=0;m<=r;m++)s[m]=0;for(m=1;m<a;m+=2)s[t[m]]++;var j=n.next_code;for(h=0,s[0]=0,d=1;d<=r;d++)h=h+s[d-1]<<1,j[d]=h;for(C=0;C<a;C+=2)(_=t[C+1])!=0&&(t[C]=j[_],j[_]++)},i.F.codes2map=function(t,r,h){for(var d=t.length,C=i.F.U.rev15,_=0;_<d;_+=2)if(t[_+1]!=0)for(var n=_>>1,a=t[_+1],s=n<<4|a,m=r-a,j=t[_]<<m,E=j+(1<<m);j!=E;)h[C[j]>>>15-r]=s,j++},i.F.revCodes=function(t,r){for(var h=i.F.U.rev15,d=15-r,C=0;C<t.length;C+=2){var _=t[C]<<r-t[C+1];t[C]=h[_]>>>d}},i.F._putsE=function(t,r,h){h<<=7&r;var d=r>>>3;t[d]|=h,t[d+1]|=h>>>8},i.F._putsF=function(t,r,h){h<<=7&r;var d=r>>>3;t[d]|=h,t[d+1]|=h>>>8,t[d+2]|=h>>>16},i.F._bitsE=function(t,r,h){return(t[r>>>3]|t[1+(r>>>3)]<<8)>>>(7&r)&(1<<h)-1},i.F._bitsF=function(t,r,h){return(t[r>>>3]|t[1+(r>>>3)]<<8|t[2+(r>>>3)]<<16)>>>(7&r)&(1<<h)-1},i.F._get17=function(t,r){return(t[r>>>3]|t[1+(r>>>3)]<<8|t[2+(r>>>3)]<<16)>>>(7&r)},i.F._get25=function(t,r){return(t[r>>>3]|t[1+(r>>>3)]<<8|t[2+(r>>>3)]<<16|t[3+(r>>>3)]<<24)>>>(7&r)},i.F.U=(w=Uint16Array,c=Uint32Array,{next_code:new w(16),bl_count:new w(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new w(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new c(32),flmap:new w(512),fltree:[],fdmap:new w(32),fdtree:[],lmap:new w(32768),ltree:[],ttree:[],dmap:new w(32768),dtree:[],imap:new w(512),itree:[],rev15:new w(32768),lhst:new c(286),dhst:new c(30),ihst:new c(19),lits:new c(15e3),strt:new w(65536),prev:new w(32768)}),function(){for(var t=i.F.U,r=0;r<32768;r++){var h=r;h=(4278255360&(h=(4042322160&(h=(3435973836&(h=(2863311530&h)>>>1|(1431655765&h)<<1))>>>2|(858993459&h)<<2))>>>4|(252645135&h)<<4))>>>8|(16711935&h)<<8,t.rev15[r]=(h>>>16|h<<16)>>>17}function d(C,_,n){for(;_--!=0;)C.push(0,n)}for(r=0;r<32;r++)t.ldef[r]=t.of0[r]<<3|t.exb[r],t.ddef[r]=t.df0[r]<<4|t.dxb[r];d(t.fltree,144,8),d(t.fltree,112,9),d(t.fltree,24,7),d(t.fltree,8,8),i.F.makeCodes(t.fltree,9),i.F.codes2map(t.fltree,9,t.flmap),i.F.revCodes(t.fltree,9),d(t.fdtree,32,5),i.F.makeCodes(t.fdtree,5),i.F.codes2map(t.fdtree,5,t.fdmap),i.F.revCodes(t.fdtree,5),d(t.itree,19,0),d(t.ltree,286,0),d(t.dtree,30,0),d(t.ttree,320,0)}()})();var zs=Ts({__proto__:null,default:Rt},[Rt]);const Be=function(){var y={nextZero(n,a){for(;n[a]!=0;)a++;return a},readUshort:(n,a)=>n[a]<<8|n[a+1],writeUshort(n,a,s){n[a]=s>>8&255,n[a+1]=255&s},readUint:(n,a)=>16777216*n[a]+(n[a+1]<<16|n[a+2]<<8|n[a+3]),writeUint(n,a,s){n[a]=s>>24&255,n[a+1]=s>>16&255,n[a+2]=s>>8&255,n[a+3]=255&s},readASCII(n,a,s){let m="";for(let j=0;j<s;j++)m+=String.fromCharCode(n[a+j]);return m},writeASCII(n,a,s){for(let m=0;m<s.length;m++)n[a+m]=s.charCodeAt(m)},readBytes(n,a,s){const m=[];for(let j=0;j<s;j++)m.push(n[a+j]);return m},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,a,s){let m,j="";for(let E=0;E<s;E++)j+=`%${y.pad(n[a+E].toString(16))}`;try{m=decodeURIComponent(j)}catch{return y.readASCII(n,a,s)}return m}};function w(n,a,s,m){const j=a*s,E=r(m),N=Math.ceil(a*E/8),S=new Uint8Array(4*j),R=new Uint32Array(S.buffer),{ctype:$}=m,{depth:A}=m,T=y.readUshort;if($==6){const M=j<<2;if(A==8)for(var b=0;b<M;b+=4)S[b]=n[b],S[b+1]=n[b+1],S[b+2]=n[b+2],S[b+3]=n[b+3];if(A==16)for(b=0;b<M;b++)S[b]=n[b<<1]}else if($==2){const M=m.tabs.tRNS;if(M==null){if(A==8)for(b=0;b<j;b++){var F=3*b;R[b]=255<<24|n[F+2]<<16|n[F+1]<<8|n[F]}if(A==16)for(b=0;b<j;b++)F=6*b,R[b]=255<<24|n[F+4]<<16|n[F+2]<<8|n[F]}else{var o=M[0];const P=M[1],X=M[2];if(A==8)for(b=0;b<j;b++){var u=b<<2;F=3*b,R[b]=255<<24|n[F+2]<<16|n[F+1]<<8|n[F],n[F]==o&&n[F+1]==P&&n[F+2]==X&&(S[u+3]=0)}if(A==16)for(b=0;b<j;b++)u=b<<2,F=6*b,R[b]=255<<24|n[F+4]<<16|n[F+2]<<8|n[F],T(n,F)==o&&T(n,F+2)==P&&T(n,F+4)==X&&(S[u+3]=0)}}else if($==3){const M=m.tabs.PLTE,P=m.tabs.tRNS,X=P?P.length:0;if(A==1)for(var k=0;k<s;k++){var L=k*N,I=k*a;for(b=0;b<a;b++){u=I+b<<2;var p=3*(x=n[L+(b>>3)]>>7-((7&b)<<0)&1);S[u]=M[p],S[u+1]=M[p+1],S[u+2]=M[p+2],S[u+3]=x<X?P[x]:255}}if(A==2)for(k=0;k<s;k++)for(L=k*N,I=k*a,b=0;b<a;b++)u=I+b<<2,p=3*(x=n[L+(b>>2)]>>6-((3&b)<<1)&3),S[u]=M[p],S[u+1]=M[p+1],S[u+2]=M[p+2],S[u+3]=x<X?P[x]:255;if(A==4)for(k=0;k<s;k++)for(L=k*N,I=k*a,b=0;b<a;b++)u=I+b<<2,p=3*(x=n[L+(b>>1)]>>4-((1&b)<<2)&15),S[u]=M[p],S[u+1]=M[p+1],S[u+2]=M[p+2],S[u+3]=x<X?P[x]:255;if(A==8)for(b=0;b<j;b++){var x;u=b<<2,p=3*(x=n[b]),S[u]=M[p],S[u+1]=M[p+1],S[u+2]=M[p+2],S[u+3]=x<X?P[x]:255}}else if($==4){if(A==8)for(b=0;b<j;b++){u=b<<2;var v=n[l=b<<1];S[u]=v,S[u+1]=v,S[u+2]=v,S[u+3]=n[l+1]}if(A==16)for(b=0;b<j;b++){var l;u=b<<2,v=n[l=b<<2],S[u]=v,S[u+1]=v,S[u+2]=v,S[u+3]=n[l+2]}}else if($==0)for(o=m.tabs.tRNS?m.tabs.tRNS:-1,k=0;k<s;k++){const M=k*N,P=k*a;if(A==1)for(var g=0;g<a;g++){var B=(v=255*(n[M+(g>>>3)]>>>7-(7&g)&1))==255*o?0:255;R[P+g]=B<<24|v<<16|v<<8|v}else if(A==2)for(g=0;g<a;g++)B=(v=85*(n[M+(g>>>2)]>>>6-((3&g)<<1)&3))==85*o?0:255,R[P+g]=B<<24|v<<16|v<<8|v;else if(A==4)for(g=0;g<a;g++)B=(v=17*(n[M+(g>>>1)]>>>4-((1&g)<<2)&15))==17*o?0:255,R[P+g]=B<<24|v<<16|v<<8|v;else if(A==8)for(g=0;g<a;g++)B=(v=n[M+g])==o?0:255,R[P+g]=B<<24|v<<16|v<<8|v;else if(A==16)for(g=0;g<a;g++)v=n[M+(g<<1)],B=T(n,M+(g<<1))==o?0:255,R[P+g]=B<<24|v<<16|v<<8|v}return S}function c(n,a,s,m){const j=r(n),E=Math.ceil(s*j/8),N=new Uint8Array((E+1+n.interlace)*m);return a=n.tabs.CgBI?t(a,N):i(a,N),n.interlace==0?a=h(a,n,0,s,m):n.interlace==1&&(a=function(R,$){const A=$.width,T=$.height,b=r($),F=b>>3,o=Math.ceil(A*b/8),u=new Uint8Array(T*o);let k=0;const L=[0,0,4,0,2,0,1],I=[0,4,0,2,0,1,0],p=[8,8,8,4,4,2,2],x=[8,8,4,4,2,2,1];let v=0;for(;v<7;){const g=p[v],B=x[v];let M=0,P=0,X=L[v];for(;X<T;)X+=g,P++;let W=I[v];for(;W<A;)W+=B,M++;const O=Math.ceil(M*b/8);h(R,$,k,M,P);let V=0,q=L[v];for(;q<T;){let te=I[v],pe=k+V*O<<3;for(;te<A;){var l;if(b==1&&(l=(l=R[pe>>3])>>7-(7&pe)&1,u[q*o+(te>>3)]|=l<<7-((7&te)<<0)),b==2&&(l=(l=R[pe>>3])>>6-(7&pe)&3,u[q*o+(te>>2)]|=l<<6-((3&te)<<1)),b==4&&(l=(l=R[pe>>3])>>4-(7&pe)&15,u[q*o+(te>>1)]|=l<<4-((1&te)<<2)),b>=8){const me=q*o+te*F;for(let de=0;de<F;de++)u[me+de]=R[(pe>>3)+de]}pe+=b,te+=B}V++,q+=g}M*P!=0&&(k+=P*(1+O)),v+=1}return u}(a,n)),a}function i(n,a){return t(new Uint8Array(n.buffer,2,n.length-6),a)}var t=function(){const n={H:{}};return n.H.N=function(a,s){const m=Uint8Array;let j,E,N=0,S=0,R=0,$=0,A=0,T=0,b=0,F=0,o=0;if(a[0]==3&&a[1]==0)return s||new m(0);const u=n.H,k=u.b,L=u.e,I=u.R,p=u.n,x=u.A,v=u.Z,l=u.m,g=s==null;for(g&&(s=new m(a.length>>>2<<5));N==0;)if(N=k(a,o,1),S=k(a,o+1,2),o+=3,S!=0){if(g&&(s=n.H.W(s,F+(1<<17))),S==1&&(j=l.J,E=l.h,T=511,b=31),S==2){R=L(a,o,5)+257,$=L(a,o+5,5)+1,A=L(a,o+10,4)+4,o+=14;let M=1;for(var B=0;B<38;B+=2)l.Q[B]=0,l.Q[B+1]=0;for(B=0;B<A;B++){const W=L(a,o+3*B,3);l.Q[1+(l.X[B]<<1)]=W,W>M&&(M=W)}o+=3*A,p(l.Q,M),x(l.Q,M,l.u),j=l.w,E=l.d,o=I(l.u,(1<<M)-1,R+$,a,o,l.v);const P=u.V(l.v,0,R,l.C);T=(1<<P)-1;const X=u.V(l.v,R,$,l.D);b=(1<<X)-1,p(l.C,P),x(l.C,P,j),p(l.D,X),x(l.D,X,E)}for(;;){const M=j[v(a,o)&T];o+=15&M;const P=M>>>4;if(!(P>>>8))s[F++]=P;else{if(P==256)break;{let X=F+P-254;if(P>264){const te=l.q[P-257];X=F+(te>>>3)+L(a,o,7&te),o+=7&te}const W=E[v(a,o)&b];o+=15&W;const O=W>>>4,V=l.c[O],q=(V>>>4)+k(a,o,15&V);for(o+=15&V;F<X;)s[F]=s[F++-q],s[F]=s[F++-q],s[F]=s[F++-q],s[F]=s[F++-q];F=X}}}}else{7&o&&(o+=8-(7&o));const M=4+(o>>>3),P=a[M-4]|a[M-3]<<8;g&&(s=n.H.W(s,F+P)),s.set(new m(a.buffer,a.byteOffset+M,P),F),o=M+P<<3,F+=P}return s.length==F?s:s.slice(0,F)},n.H.W=function(a,s){const m=a.length;if(s<=m)return a;const j=new Uint8Array(m<<1);return j.set(a,0),j},n.H.R=function(a,s,m,j,E,N){const S=n.H.e,R=n.H.Z;let $=0;for(;$<m;){const A=a[R(j,E)&s];E+=15&A;const T=A>>>4;if(T<=15)N[$]=T,$++;else{let b=0,F=0;T==16?(F=3+S(j,E,2),E+=2,b=N[$-1]):T==17?(F=3+S(j,E,3),E+=3):T==18&&(F=11+S(j,E,7),E+=7);const o=$+F;for(;$<o;)N[$]=b,$++}}return E},n.H.V=function(a,s,m,j){let E=0,N=0;const S=j.length>>>1;for(;N<m;){const R=a[N+s];j[N<<1]=0,j[1+(N<<1)]=R,R>E&&(E=R),N++}for(;N<S;)j[N<<1]=0,j[1+(N<<1)]=0,N++;return E},n.H.n=function(a,s){const m=n.H.m,j=a.length;let E,N,S,R;const $=m.j;for(var A=0;A<=s;A++)$[A]=0;for(A=1;A<j;A+=2)$[a[A]]++;const T=m.K;for(E=0,$[0]=0,N=1;N<=s;N++)E=E+$[N-1]<<1,T[N]=E;for(S=0;S<j;S+=2)R=a[S+1],R!=0&&(a[S]=T[R],T[R]++)},n.H.A=function(a,s,m){const j=a.length,E=n.H.m.r;for(let N=0;N<j;N+=2)if(a[N+1]!=0){const S=N>>1,R=a[N+1],$=S<<4|R,A=s-R;let T=a[N]<<A;const b=T+(1<<A);for(;T!=b;)m[E[T]>>>15-s]=$,T++}},n.H.l=function(a,s){const m=n.H.m.r,j=15-s;for(let E=0;E<a.length;E+=2){const N=a[E]<<s-a[E+1];a[E]=m[N]>>>j}},n.H.M=function(a,s,m){m<<=7&s;const j=s>>>3;a[j]|=m,a[j+1]|=m>>>8},n.H.I=function(a,s,m){m<<=7&s;const j=s>>>3;a[j]|=m,a[j+1]|=m>>>8,a[j+2]|=m>>>16},n.H.e=function(a,s,m){return(a[s>>>3]|a[1+(s>>>3)]<<8)>>>(7&s)&(1<<m)-1},n.H.b=function(a,s,m){return(a[s>>>3]|a[1+(s>>>3)]<<8|a[2+(s>>>3)]<<16)>>>(7&s)&(1<<m)-1},n.H.Z=function(a,s){return(a[s>>>3]|a[1+(s>>>3)]<<8|a[2+(s>>>3)]<<16)>>>(7&s)},n.H.i=function(a,s){return(a[s>>>3]|a[1+(s>>>3)]<<8|a[2+(s>>>3)]<<16|a[3+(s>>>3)]<<24)>>>(7&s)},n.H.m=function(){const a=Uint16Array,s=Uint32Array;return{K:new a(16),j:new a(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new a(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new a(512),_:[],h:new a(32),$:[],w:new a(32768),C:[],v:[],d:new a(32768),D:[],u:new a(512),Q:[],r:new a(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new a(65536),g:new a(32768)}}(),function(){const a=n.H.m;for(var s=0;s<32768;s++){let j=s;j=(2863311530&j)>>>1|(1431655765&j)<<1,j=(3435973836&j)>>>2|(858993459&j)<<2,j=(4042322160&j)>>>4|(252645135&j)<<4,j=(4278255360&j)>>>8|(16711935&j)<<8,a.r[s]=(j>>>16|j<<16)>>>17}function m(j,E,N){for(;E--!=0;)j.push(0,N)}for(s=0;s<32;s++)a.q[s]=a.S[s]<<3|a.T[s],a.c[s]=a.p[s]<<4|a.z[s];m(a._,144,8),m(a._,112,9),m(a._,24,7),m(a._,8,8),n.H.n(a._,9),n.H.A(a._,9,a.J),n.H.l(a._,9),m(a.$,32,5),n.H.n(a.$,5),n.H.A(a.$,5,a.h),n.H.l(a.$,5),m(a.Q,19,0),m(a.C,286,0),m(a.D,30,0),m(a.v,320,0)}(),n.H.N}();function r(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function h(n,a,s,m,j){let E=r(a);const N=Math.ceil(m*E/8);let S,R;E=Math.ceil(E/8);let $=n[s],A=0;if($>1&&(n[s]=[0,0,1][$-2]),$==3)for(A=E;A<N;A++)n[A+1]=n[A+1]+(n[A+1-E]>>>1)&255;for(let T=0;T<j;T++)if(S=s+T*N,R=S+T+1,$=n[R-1],A=0,$==0)for(;A<N;A++)n[S+A]=n[R+A];else if($==1){for(;A<E;A++)n[S+A]=n[R+A];for(;A<N;A++)n[S+A]=n[R+A]+n[S+A-E]}else if($==2)for(;A<N;A++)n[S+A]=n[R+A]+n[S+A-N];else if($==3){for(;A<E;A++)n[S+A]=n[R+A]+(n[S+A-N]>>>1);for(;A<N;A++)n[S+A]=n[R+A]+(n[S+A-N]+n[S+A-E]>>>1)}else{for(;A<E;A++)n[S+A]=n[R+A]+d(0,n[S+A-N],0);for(;A<N;A++)n[S+A]=n[R+A]+d(n[S+A-E],n[S+A-N],n[S+A-E-N])}return n}function d(n,a,s){const m=n+a-s,j=m-n,E=m-a,N=m-s;return j*j<=E*E&&j*j<=N*N?n:E*E<=N*N?a:s}function C(n,a,s){s.width=y.readUint(n,a),a+=4,s.height=y.readUint(n,a),a+=4,s.depth=n[a],a++,s.ctype=n[a],a++,s.compress=n[a],a++,s.filter=n[a],a++,s.interlace=n[a],a++}function _(n,a,s,m,j,E,N,S,R){const $=Math.min(a,j),A=Math.min(s,E);let T=0,b=0;for(let v=0;v<A;v++)for(let l=0;l<$;l++)if(N>=0&&S>=0?(T=v*a+l<<2,b=(S+v)*j+N+l<<2):(T=(-S+v)*a-N+l<<2,b=v*j+l<<2),R==0)m[b]=n[T],m[b+1]=n[T+1],m[b+2]=n[T+2],m[b+3]=n[T+3];else if(R==1){var F=n[T+3]*.00392156862745098,o=n[T]*F,u=n[T+1]*F,k=n[T+2]*F,L=m[b+3]*(1/255),I=m[b]*L,p=m[b+1]*L,x=m[b+2]*L;const g=1-F,B=F+L*g,M=B==0?0:1/B;m[b+3]=255*B,m[b+0]=(o+I*g)*M,m[b+1]=(u+p*g)*M,m[b+2]=(k+x*g)*M}else if(R==2)F=n[T+3],o=n[T],u=n[T+1],k=n[T+2],L=m[b+3],I=m[b],p=m[b+1],x=m[b+2],F==L&&o==I&&u==p&&k==x?(m[b]=0,m[b+1]=0,m[b+2]=0,m[b+3]=0):(m[b]=o,m[b+1]=u,m[b+2]=k,m[b+3]=F);else if(R==3){if(F=n[T+3],o=n[T],u=n[T+1],k=n[T+2],L=m[b+3],I=m[b],p=m[b+1],x=m[b+2],F==L&&o==I&&u==p&&k==x)continue;if(F<220&&L>20)return!1}return!0}return{decode:function(a){const s=new Uint8Array(a);let m=8;const j=y,E=j.readUshort,N=j.readUint,S={tabs:{},frames:[]},R=new Uint8Array(s.length);let $,A=0,T=0;const b=[137,80,78,71,13,10,26,10];for(var F=0;F<8;F++)if(s[F]!=b[F])throw"The input is not a PNG file!";for(;m<s.length;){const v=j.readUint(s,m);m+=4;const l=j.readASCII(s,m,4);if(m+=4,l=="IHDR")C(s,m,S);else if(l=="iCCP"){for(var o=m;s[o]!=0;)o++;j.readASCII(s,m,o-m),s[o+1];const g=s.slice(o+2,m+v);let B=null;try{B=i(g)}catch{B=t(g)}S.tabs[l]=B}else if(l=="CgBI")S.tabs[l]=s.slice(m,m+4);else if(l=="IDAT"){for(F=0;F<v;F++)R[A+F]=s[m+F];A+=v}else if(l=="acTL")S.tabs[l]={num_frames:N(s,m),num_plays:N(s,m+4)},$=new Uint8Array(s.length);else if(l=="fcTL"){T!=0&&((x=S.frames[S.frames.length-1]).data=c(S,$.slice(0,T),x.rect.width,x.rect.height),T=0);const g={x:N(s,m+12),y:N(s,m+16),width:N(s,m+4),height:N(s,m+8)};let B=E(s,m+22);B=E(s,m+20)/(B==0?100:B);const M={rect:g,delay:Math.round(1e3*B),dispose:s[m+24],blend:s[m+25]};S.frames.push(M)}else if(l=="fdAT"){for(F=0;F<v-4;F++)$[T+F]=s[m+F+4];T+=v-4}else if(l=="pHYs")S.tabs[l]=[j.readUint(s,m),j.readUint(s,m+4),s[m+8]];else if(l=="cHRM")for(S.tabs[l]=[],F=0;F<8;F++)S.tabs[l].push(j.readUint(s,m+4*F));else if(l=="tEXt"||l=="zTXt"){S.tabs[l]==null&&(S.tabs[l]={});var u=j.nextZero(s,m),k=j.readASCII(s,m,u-m),L=m+v-u-1;if(l=="tEXt")p=j.readASCII(s,u+1,L);else{var I=i(s.slice(u+2,u+2+L));p=j.readUTF8(I,0,I.length)}S.tabs[l][k]=p}else if(l=="iTXt"){S.tabs[l]==null&&(S.tabs[l]={}),u=0,o=m,u=j.nextZero(s,o),k=j.readASCII(s,o,u-o);const g=s[o=u+1];var p;s[o+1],o+=2,u=j.nextZero(s,o),j.readASCII(s,o,u-o),o=u+1,u=j.nextZero(s,o),j.readUTF8(s,o,u-o),L=v-((o=u+1)-m),g==0?p=j.readUTF8(s,o,L):(I=i(s.slice(o,o+L)),p=j.readUTF8(I,0,I.length)),S.tabs[l][k]=p}else if(l=="PLTE")S.tabs[l]=j.readBytes(s,m,v);else if(l=="hIST"){const g=S.tabs.PLTE.length/3;for(S.tabs[l]=[],F=0;F<g;F++)S.tabs[l].push(E(s,m+2*F))}else if(l=="tRNS")S.ctype==3?S.tabs[l]=j.readBytes(s,m,v):S.ctype==0?S.tabs[l]=E(s,m):S.ctype==2&&(S.tabs[l]=[E(s,m),E(s,m+2),E(s,m+4)]);else if(l=="gAMA")S.tabs[l]=j.readUint(s,m)/1e5;else if(l=="sRGB")S.tabs[l]=s[m];else if(l=="bKGD")S.ctype==0||S.ctype==4?S.tabs[l]=[E(s,m)]:S.ctype==2||S.ctype==6?S.tabs[l]=[E(s,m),E(s,m+2),E(s,m+4)]:S.ctype==3&&(S.tabs[l]=s[m]);else if(l=="IEND")break;m+=v,j.readUint(s,m),m+=4}var x;return T!=0&&((x=S.frames[S.frames.length-1]).data=c(S,$.slice(0,T),x.rect.width,x.rect.height)),S.data=c(S,R,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(a){const s=a.width,m=a.height;if(a.tabs.acTL==null)return[w(a.data,s,m,a).buffer];const j=[];a.frames[0].data==null&&(a.frames[0].data=a.data);const E=s*m*4,N=new Uint8Array(E),S=new Uint8Array(E),R=new Uint8Array(E);for(let A=0;A<a.frames.length;A++){const T=a.frames[A],b=T.rect.x,F=T.rect.y,o=T.rect.width,u=T.rect.height,k=w(T.data,o,u,a);if(A!=0)for(var $=0;$<E;$++)R[$]=N[$];if(T.blend==0?_(k,o,u,N,s,m,b,F,0):T.blend==1&&_(k,o,u,N,s,m,b,F,1),j.push(N.buffer.slice(0)),T.dispose!=0){if(T.dispose==1)_(S,o,u,N,s,m,b,F,0);else if(T.dispose==2)for($=0;$<E;$++)N[$]=R[$]}}return j},_paeth:d,_copyTile:_,_bin:y}}();(function(){const{_copyTile:y}=Be,{_bin:w}=Be,c=Be._paeth;var i={table:function(){const o=new Uint32Array(256);for(let u=0;u<256;u++){let k=u;for(let L=0;L<8;L++)1&k?k=3988292384^k>>>1:k>>>=1;o[u]=k}return o}(),update(o,u,k,L){for(let I=0;I<L;I++)o=i.table[255&(o^u[k+I])]^o>>>8;return o},crc:(o,u,k)=>4294967295^i.update(4294967295,o,u,k)};function t(o,u,k,L){u[k]+=o[0]*L>>4,u[k+1]+=o[1]*L>>4,u[k+2]+=o[2]*L>>4,u[k+3]+=o[3]*L>>4}function r(o){return Math.max(0,Math.min(255,o))}function h(o,u){const k=o[0]-u[0],L=o[1]-u[1],I=o[2]-u[2],p=o[3]-u[3];return k*k+L*L+I*I+p*p}function d(o,u,k,L,I,p,x){x==null&&(x=1);const v=L.length,l=[];for(var g=0;g<v;g++){const q=L[g];l.push([q>>>0&255,q>>>8&255,q>>>16&255,q>>>24&255])}for(g=0;g<v;g++){let q=4294967295;for(var B=0,M=0;M<v;M++){var P=h(l[g],l[M]);M!=g&&P<q&&(q=P,B=M)}}const X=new Uint32Array(I.buffer),W=new Int16Array(u*k*4),O=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(g=0;g<O.length;g++)O[g]=255*((O[g]+.5)/16-.5);for(let q=0;q<k;q++)for(let te=0;te<u;te++){var V;g=4*(q*u+te),x!=2?V=[r(o[g]+W[g]),r(o[g+1]+W[g+1]),r(o[g+2]+W[g+2]),r(o[g+3]+W[g+3])]:(P=O[4*(3&q)+(3&te)],V=[r(o[g]+P),r(o[g+1]+P),r(o[g+2]+P),r(o[g+3]+P)]),B=0;let pe=16777215;for(M=0;M<v;M++){const xe=h(V,l[M]);xe<pe&&(pe=xe,B=M)}const me=l[B],de=[V[0]-me[0],V[1]-me[1],V[2]-me[2],V[3]-me[3]];x==1&&(te!=u-1&&t(de,W,g+4,7),q!=k-1&&(te!=0&&t(de,W,g+4*u-4,3),t(de,W,g+4*u,5),te!=u-1&&t(de,W,g+4*u+4,1))),p[g>>2]=B,X[g>>2]=L[B]}}function C(o,u,k,L,I){I==null&&(I={});const{crc:p}=i,x=w.writeUint,v=w.writeUshort,l=w.writeASCII;let g=8;const B=o.frames.length>1;let M,P=!1,X=33+(B?20:0);if(I.sRGB!=null&&(X+=13),I.pHYs!=null&&(X+=21),I.iCCP!=null&&(M=pako.deflate(I.iCCP),X+=21+M.length+4),o.ctype==3){for(var W=o.plte.length,O=0;O<W;O++)o.plte[O]>>>24!=255&&(P=!0);X+=8+3*W+4+(P?8+1*W+4:0)}for(var V=0;V<o.frames.length;V++)B&&(X+=38),X+=(me=o.frames[V]).cimg.length+12,V!=0&&(X+=4);X+=12;const q=new Uint8Array(X),te=[137,80,78,71,13,10,26,10];for(O=0;O<8;O++)q[O]=te[O];if(x(q,g,13),g+=4,l(q,g,"IHDR"),g+=4,x(q,g,u),g+=4,x(q,g,k),g+=4,q[g]=o.depth,g++,q[g]=o.ctype,g++,q[g]=0,g++,q[g]=0,g++,q[g]=0,g++,x(q,g,p(q,g-17,17)),g+=4,I.sRGB!=null&&(x(q,g,1),g+=4,l(q,g,"sRGB"),g+=4,q[g]=I.sRGB,g++,x(q,g,p(q,g-5,5)),g+=4),I.iCCP!=null){const de=13+M.length;x(q,g,de),g+=4,l(q,g,"iCCP"),g+=4,l(q,g,"ICC profile"),g+=11,g+=2,q.set(M,g),g+=M.length,x(q,g,p(q,g-(de+4),de+4)),g+=4}if(I.pHYs!=null&&(x(q,g,9),g+=4,l(q,g,"pHYs"),g+=4,x(q,g,I.pHYs[0]),g+=4,x(q,g,I.pHYs[1]),g+=4,q[g]=I.pHYs[2],g++,x(q,g,p(q,g-13,13)),g+=4),B&&(x(q,g,8),g+=4,l(q,g,"acTL"),g+=4,x(q,g,o.frames.length),g+=4,x(q,g,I.loop!=null?I.loop:0),g+=4,x(q,g,p(q,g-12,12)),g+=4),o.ctype==3){for(x(q,g,3*(W=o.plte.length)),g+=4,l(q,g,"PLTE"),g+=4,O=0;O<W;O++){const de=3*O,xe=o.plte[O],be=255&xe,z=xe>>>8&255,ae=xe>>>16&255;q[g+de+0]=be,q[g+de+1]=z,q[g+de+2]=ae}if(g+=3*W,x(q,g,p(q,g-3*W-4,3*W+4)),g+=4,P){for(x(q,g,W),g+=4,l(q,g,"tRNS"),g+=4,O=0;O<W;O++)q[g+O]=o.plte[O]>>>24&255;g+=W,x(q,g,p(q,g-W-4,W+4)),g+=4}}let pe=0;for(V=0;V<o.frames.length;V++){var me=o.frames[V];B&&(x(q,g,26),g+=4,l(q,g,"fcTL"),g+=4,x(q,g,pe++),g+=4,x(q,g,me.rect.width),g+=4,x(q,g,me.rect.height),g+=4,x(q,g,me.rect.x),g+=4,x(q,g,me.rect.y),g+=4,v(q,g,L[V]),g+=2,v(q,g,1e3),g+=2,q[g]=me.dispose,g++,q[g]=me.blend,g++,x(q,g,p(q,g-30,30)),g+=4);const de=me.cimg;x(q,g,(W=de.length)+(V==0?0:4)),g+=4;const xe=g;l(q,g,V==0?"IDAT":"fdAT"),g+=4,V!=0&&(x(q,g,pe++),g+=4),q.set(de,g),g+=W,x(q,g,p(q,xe,g-xe)),g+=4}return x(q,g,0),g+=4,l(q,g,"IEND"),g+=4,x(q,g,p(q,g-4,4)),g+=4,q.buffer}function _(o,u,k){for(let L=0;L<o.frames.length;L++){const I=o.frames[L];I.rect.width;const p=I.rect.height,x=new Uint8Array(p*I.bpl+p);I.cimg=m(I.img,p,I.bpp,I.bpl,x,u,k)}}function n(o,u,k,L,I){const p=I[0],x=I[1],v=I[2],l=I[3],g=I[4],B=I[5];let M=6,P=8,X=255;for(var W=0;W<o.length;W++){const ie=new Uint8Array(o[W]);for(var O=ie.length,V=0;V<O;V+=4)X&=ie[V+3]}const q=X!=255,te=function(le,ce,ge,ue,fe,ve){const he=[];for(var ye=0;ye<le.length;ye++){const ee=new Uint8Array(le[ye]),Y=new Uint32Array(ee.buffer);var Se;let ne=0,oe=0,Ne=ce,ze=ge,vt=ue?1:0;if(ye!=0){const jt=ve||ue||ye==1||he[ye-2].dispose!=0?1:2;let ut=0,Ze=1e9;for(let We=0;We<jt;We++){var Ie=new Uint8Array(le[ye-1-We]);const Nt=new Uint32Array(le[ye-1-We]);let Ue=ce,Oe=ge,Ke=-1,Ye=-1;for(let Ve=0;Ve<ge;Ve++)for(let Qe=0;Qe<ce;Qe++)Y[D=Ve*ce+Qe]!=Nt[D]&&(Qe<Ue&&(Ue=Qe),Qe>Ke&&(Ke=Qe),Ve<Oe&&(Oe=Ve),Ve>Ye&&(Ye=Ve));Ke==-1&&(Ue=Oe=Ke=Ye=0),fe&&((1&Ue)==1&&Ue--,(1&Oe)==1&&Oe--);const nt=(Ke-Ue+1)*(Ye-Oe+1);nt<Ze&&(Ze=nt,ut=We,ne=Ue,oe=Oe,Ne=Ke-Ue+1,ze=Ye-Oe+1)}Ie=new Uint8Array(le[ye-1-ut]),ut==1&&(he[ye-1].dispose=2),Se=new Uint8Array(Ne*ze*4),y(Ie,ce,ge,Se,Ne,ze,-ne,-oe,0),vt=y(ee,ce,ge,Se,Ne,ze,-ne,-oe,3)?1:0,vt==1?s(ee,ce,ge,Se,{x:ne,y:oe,width:Ne,height:ze}):y(ee,ce,ge,Se,Ne,ze,-ne,-oe,0)}else Se=ee.slice(0);he.push({rect:{x:ne,y:oe,width:Ne,height:ze},img:Se,blend:vt,dispose:0})}if(ue)for(ye=0;ye<he.length;ye++){if((H=he[ye]).blend==1)continue;const ee=H.rect,Y=he[ye-1].rect,ne=Math.min(ee.x,Y.x),oe=Math.min(ee.y,Y.y),Ne={x:ne,y:oe,width:Math.max(ee.x+ee.width,Y.x+Y.width)-ne,height:Math.max(ee.y+ee.height,Y.y+Y.height)-oe};he[ye-1].dispose=1,ye-1!=0&&a(le,ce,ge,he,ye-1,Ne,fe),a(le,ce,ge,he,ye,Ne,fe)}let Te=0;if(le.length!=1)for(var D=0;D<he.length;D++){var H;Te+=(H=he[D]).rect.width*H.rect.height}return he}(o,u,k,p,x,v),pe={},me=[],de=[];if(L!=0){const ie=[];for(V=0;V<te.length;V++)ie.push(te[V].img.buffer);const le=function(fe){let ve=0;for(var he=0;he<fe.length;he++)ve+=fe[he].byteLength;const ye=new Uint8Array(ve);let Se=0;for(he=0;he<fe.length;he++){const Ie=new Uint8Array(fe[he]),Te=Ie.length;for(let D=0;D<Te;D+=4){let H=Ie[D],ee=Ie[D+1],Y=Ie[D+2];const ne=Ie[D+3];ne==0&&(H=ee=Y=0),ye[Se+D]=H,ye[Se+D+1]=ee,ye[Se+D+2]=Y,ye[Se+D+3]=ne}Se+=Te}return ye.buffer}(ie),ce=E(le,L);for(V=0;V<ce.plte.length;V++)me.push(ce.plte[V].est.rgba);let ge=0;for(V=0;V<te.length;V++){const ue=(be=te[V]).img.length;var xe=new Uint8Array(ce.inds.buffer,ge>>2,ue>>2);de.push(xe);const fe=new Uint8Array(ce.abuf,ge,ue);B&&d(be.img,be.rect.width,be.rect.height,me,fe,xe),be.img.set(fe),ge+=ue}}else for(W=0;W<te.length;W++){var be=te[W];const ie=new Uint32Array(be.img.buffer);var z=be.rect.width;for(O=ie.length,xe=new Uint8Array(O),de.push(xe),V=0;V<O;V++){const le=ie[V];if(V!=0&&le==ie[V-1])xe[V]=xe[V-1];else if(V>z&&le==ie[V-z])xe[V]=xe[V-z];else{let ce=pe[le];if(ce==null&&(pe[le]=ce=me.length,me.push(le),me.length>=300))break;xe[V]=ce}}}const ae=me.length;for(ae<=256&&g==0&&(P=ae<=2?1:ae<=4?2:ae<=16?4:8,P=Math.max(P,l)),W=0;W<te.length;W++){(be=te[W]).rect.x,be.rect.y,z=be.rect.width;const ie=be.rect.height;let le=be.img;new Uint32Array(le.buffer);let ce=4*z,ge=4;if(ae<=256&&g==0){ce=Math.ceil(P*z/8);var K=new Uint8Array(ce*ie);const ue=de[W];for(let fe=0;fe<ie;fe++){V=fe*ce;const ve=fe*z;if(P==8)for(var J=0;J<z;J++)K[V+J]=ue[ve+J];else if(P==4)for(J=0;J<z;J++)K[V+(J>>1)]|=ue[ve+J]<<4-4*(1&J);else if(P==2)for(J=0;J<z;J++)K[V+(J>>2)]|=ue[ve+J]<<6-2*(3&J);else if(P==1)for(J=0;J<z;J++)K[V+(J>>3)]|=ue[ve+J]<<7-1*(7&J)}le=K,M=3,ge=1}else if(q==0&&te.length==1){K=new Uint8Array(z*ie*3);const ue=z*ie;for(V=0;V<ue;V++){const fe=3*V,ve=4*V;K[fe]=le[ve],K[fe+1]=le[ve+1],K[fe+2]=le[ve+2]}le=K,M=2,ge=3,ce=3*z}be.img=le,be.bpl=ce,be.bpp=ge}return{ctype:M,depth:P,plte:me,frames:te}}function a(o,u,k,L,I,p,x){const v=Uint8Array,l=Uint32Array,g=new v(o[I-1]),B=new l(o[I-1]),M=I+1<o.length?new v(o[I+1]):null,P=new v(o[I]),X=new l(P.buffer);let W=u,O=k,V=-1,q=-1;for(let pe=0;pe<p.height;pe++)for(let me=0;me<p.width;me++){const de=p.x+me,xe=p.y+pe,be=xe*u+de,z=X[be];z==0||L[I-1].dispose==0&&B[be]==z&&(M==null||M[4*be+3]!=0)||(de<W&&(W=de),de>V&&(V=de),xe<O&&(O=xe),xe>q&&(q=xe))}V==-1&&(W=O=V=q=0),x&&((1&W)==1&&W--,(1&O)==1&&O--),p={x:W,y:O,width:V-W+1,height:q-O+1};const te=L[I];te.rect=p,te.blend=1,te.img=new Uint8Array(p.width*p.height*4),L[I-1].dispose==0?(y(g,u,k,te.img,p.width,p.height,-p.x,-p.y,0),s(P,u,k,te.img,p)):y(P,u,k,te.img,p.width,p.height,-p.x,-p.y,0)}function s(o,u,k,L,I){y(o,u,k,L,I.width,I.height,-I.x,-I.y,2)}function m(o,u,k,L,I,p,x){const v=[];let l,g=[0,1,2,3,4];p!=-1?g=[p]:(u*L>5e5||k==1)&&(g=[0]),x&&(l={level:0});const B=zs;for(var M=0;M<g.length;M++){for(let W=0;W<u;W++)j(I,o,W,L,k,g[M]);v.push(B.deflate(I,l))}let P,X=1e9;for(M=0;M<v.length;M++)v[M].length<X&&(P=M,X=v[M].length);return v[P]}function j(o,u,k,L,I,p){const x=k*L;let v=x+k;if(o[v]=p,v++,p==0)if(L<500)for(var l=0;l<L;l++)o[v+l]=u[x+l];else o.set(new Uint8Array(u.buffer,x,L),v);else if(p==1){for(l=0;l<I;l++)o[v+l]=u[x+l];for(l=I;l<L;l++)o[v+l]=u[x+l]-u[x+l-I]+256&255}else if(k==0){for(l=0;l<I;l++)o[v+l]=u[x+l];if(p==2)for(l=I;l<L;l++)o[v+l]=u[x+l];if(p==3)for(l=I;l<L;l++)o[v+l]=u[x+l]-(u[x+l-I]>>1)+256&255;if(p==4)for(l=I;l<L;l++)o[v+l]=u[x+l]-c(u[x+l-I],0,0)+256&255}else{if(p==2)for(l=0;l<L;l++)o[v+l]=u[x+l]+256-u[x+l-L]&255;if(p==3){for(l=0;l<I;l++)o[v+l]=u[x+l]+256-(u[x+l-L]>>1)&255;for(l=I;l<L;l++)o[v+l]=u[x+l]+256-(u[x+l-L]+u[x+l-I]>>1)&255}if(p==4){for(l=0;l<I;l++)o[v+l]=u[x+l]+256-c(0,u[x+l-L],0)&255;for(l=I;l<L;l++)o[v+l]=u[x+l]+256-c(u[x+l-I],u[x+l-L],u[x+l-I-L])&255}}}function E(o,u){const k=new Uint8Array(o),L=k.slice(0),I=new Uint32Array(L.buffer),p=N(L,u),x=p[0],v=p[1],l=k.length,g=new Uint8Array(l>>2);let B;if(k.length<2e7)for(var M=0;M<l;M+=4)B=S(x,P=k[M]*(1/255),X=k[M+1]*(1/255),W=k[M+2]*(1/255),O=k[M+3]*(1/255)),g[M>>2]=B.ind,I[M>>2]=B.est.rgba;else for(M=0;M<l;M+=4){var P=k[M]*.00392156862745098,X=k[M+1]*(1/255),W=k[M+2]*(1/255),O=k[M+3]*(1/255);for(B=x;B.left;)B=R(B.est,P,X,W,O)<=0?B.left:B.right;g[M>>2]=B.ind,I[M>>2]=B.est.rgba}return{abuf:L.buffer,inds:g,plte:v}}function N(o,u,k){k==null&&(k=1e-4);const L=new Uint32Array(o.buffer),I={i0:0,i1:o.length,bst:null,est:null,tdst:0,left:null,right:null};I.bst=T(o,I.i0,I.i1),I.est=b(I.bst);const p=[I];for(;p.length<u;){let v=0,l=0;for(var x=0;x<p.length;x++)p[x].est.L>v&&(v=p[x].est.L,l=x);if(v<k)break;const g=p[l],B=$(o,L,g.i0,g.i1,g.est.e,g.est.eMq255);if(g.i0>=B||g.i1<=B){g.est.L=0;continue}const M={i0:g.i0,i1:B,bst:null,est:null,tdst:0,left:null,right:null};M.bst=T(o,M.i0,M.i1),M.est=b(M.bst);const P={i0:B,i1:g.i1,bst:null,est:null,tdst:0,left:null,right:null};for(P.bst={R:[],m:[],N:g.bst.N-M.bst.N},x=0;x<16;x++)P.bst.R[x]=g.bst.R[x]-M.bst.R[x];for(x=0;x<4;x++)P.bst.m[x]=g.bst.m[x]-M.bst.m[x];P.est=b(P.bst),g.left=M,g.right=P,p[l]=M,p.push(P)}for(p.sort((v,l)=>l.bst.N-v.bst.N),x=0;x<p.length;x++)p[x].ind=x;return[I,p]}function S(o,u,k,L,I){if(o.left==null)return o.tdst=function(M,P,X,W,O){const V=P-M[0],q=X-M[1],te=W-M[2],pe=O-M[3];return V*V+q*q+te*te+pe*pe}(o.est.q,u,k,L,I),o;const p=R(o.est,u,k,L,I);let x=o.left,v=o.right;p>0&&(x=o.right,v=o.left);const l=S(x,u,k,L,I);if(l.tdst<=p*p)return l;const g=S(v,u,k,L,I);return g.tdst<l.tdst?g:l}function R(o,u,k,L,I){const{e:p}=o;return p[0]*u+p[1]*k+p[2]*L+p[3]*I-o.eMq}function $(o,u,k,L,I,p){for(L-=4;k<L;){for(;A(o,k,I)<=p;)k+=4;for(;A(o,L,I)>p;)L-=4;if(k>=L)break;const x=u[k>>2];u[k>>2]=u[L>>2],u[L>>2]=x,k+=4,L-=4}for(;A(o,k,I)>p;)k-=4;return k+4}function A(o,u,k){return o[u]*k[0]+o[u+1]*k[1]+o[u+2]*k[2]+o[u+3]*k[3]}function T(o,u,k){const L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],I=[0,0,0,0],p=k-u>>2;for(let x=u;x<k;x+=4){const v=o[x]*.00392156862745098,l=o[x+1]*(1/255),g=o[x+2]*(1/255),B=o[x+3]*(1/255);I[0]+=v,I[1]+=l,I[2]+=g,I[3]+=B,L[0]+=v*v,L[1]+=v*l,L[2]+=v*g,L[3]+=v*B,L[5]+=l*l,L[6]+=l*g,L[7]+=l*B,L[10]+=g*g,L[11]+=g*B,L[15]+=B*B}return L[4]=L[1],L[8]=L[2],L[9]=L[6],L[12]=L[3],L[13]=L[7],L[14]=L[11],{R:L,m:I,N:p}}function b(o){const{R:u}=o,{m:k}=o,{N:L}=o,I=k[0],p=k[1],x=k[2],v=k[3],l=L==0?0:1/L,g=[u[0]-I*I*l,u[1]-I*p*l,u[2]-I*x*l,u[3]-I*v*l,u[4]-p*I*l,u[5]-p*p*l,u[6]-p*x*l,u[7]-p*v*l,u[8]-x*I*l,u[9]-x*p*l,u[10]-x*x*l,u[11]-x*v*l,u[12]-v*I*l,u[13]-v*p*l,u[14]-v*x*l,u[15]-v*v*l],B=g,M=F;let P=[Math.random(),Math.random(),Math.random(),Math.random()],X=0,W=0;if(L!=0)for(let V=0;V<16&&(P=M.multVec(B,P),W=Math.sqrt(M.dot(P,P)),P=M.sml(1/W,P),!(V!=0&&Math.abs(W-X)<1e-9));V++)X=W;const O=[I*l,p*l,x*l,v*l];return{Cov:g,q:O,e:P,L:X,eMq255:M.dot(M.sml(255,O),P),eMq:M.dot(P,O),rgba:(Math.round(255*O[3])<<24|Math.round(255*O[2])<<16|Math.round(255*O[1])<<8|Math.round(255*O[0])<<0)>>>0}}var F={multVec:(o,u)=>[o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]*u[3],o[4]*u[0]+o[5]*u[1]+o[6]*u[2]+o[7]*u[3],o[8]*u[0]+o[9]*u[1]+o[10]*u[2]+o[11]*u[3],o[12]*u[0]+o[13]*u[1]+o[14]*u[2]+o[15]*u[3]],dot:(o,u)=>o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]*u[3],sml:(o,u)=>[o*u[0],o*u[1],o*u[2],o*u[3]]};Be.encode=function(u,k,L,I,p,x,v){I==null&&(I=0),v==null&&(v=!1);const l=n(u,k,L,I,[!1,!1,!1,0,v,!1]);return _(l,-1),C(l,k,L,p,x)},Be.encodeLL=function(u,k,L,I,p,x,v,l){const g={ctype:0+(I==1?0:2)+(p==0?0:4),depth:x,frames:[]},B=(I+p)*x,M=B*k;for(let P=0;P<u.length;P++)g.frames.push({rect:{x:0,y:0,width:k,height:L},img:new Uint8Array(u[P]),blend:0,dispose:1,bpp:Math.ceil(B/8),bpl:Math.ceil(M/8)});return _(g,0,!0),C(g,k,L,v,l)},Be.encode.compress=n,Be.encode.dither=d,Be.quantize=E,Be.quantize.getKDtree=N,Be.quantize.getNearest=S})();const Br={toArrayBuffer(y,w){const c=y.width,i=y.height,t=c<<2,r=y.getContext("2d").getImageData(0,0,c,i),h=new Uint32Array(r.data.buffer),d=(32*c+31)/32<<2,C=d*i,_=122+C,n=new ArrayBuffer(_),a=new DataView(n),s=1<<20;let m,j,E,N,S=s,R=0,$=0,A=0;function T(o){a.setUint16($,o,!0),$+=2}function b(o){a.setUint32($,o,!0),$+=4}function F(o){$+=o}T(19778),b(_),F(4),b(122),b(108),b(c),b(-i>>>0),T(1),T(32),b(3),b(C),b(2835),b(2835),F(8),b(16711680),b(65280),b(255),b(4278190080),b(1466527264),function o(){for(;R<i&&S>0;){for(N=122+R*d,m=0;m<t;)S--,j=h[A++],E=j>>>24,a.setUint32(N+m,j<<8|E),m+=4;R++}A<h.length?(S=s,setTimeout(o,Br._dly)):w(n)}()},toBlob(y,w){this.toArrayBuffer(y,c=>{w(new Blob([c],{type:"image/bmp"}))})},_dly:9};var Ee={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Os={[Ee.CHROME]:16384,[Ee.FIREFOX]:11180,[Ee.DESKTOP_SAFARI]:16384,[Ee.IE]:8192,[Ee.IOS]:4096,[Ee.ETC]:8192};const sr=typeof window<"u",zr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,$t=sr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Gs=(sr||zr)&&($t&&$t.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Or=(sr||zr)&&($t&&$t.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function ar(y,w,c=Date.now()){return new Promise(i=>{const t=y.split(","),r=t[0].match(/:(.*?);/)[1],h=globalThis.atob(t[1]);let d=h.length;const C=new Uint8Array(d);for(;d--;)C[d]=h.charCodeAt(d);const _=new Blob([C],{type:r});_.name=w,_.lastModified=c,i(_)})}function Gr(y){return new Promise((w,c)=>{const i=new Or;i.onload=()=>w(i.result),i.onerror=t=>c(t),i.readAsDataURL(y)})}function Vr(y){return new Promise((w,c)=>{const i=new Image;i.onload=()=>w(i),i.onerror=t=>c(t),i.src=y})}function rt(){if(rt.cachedResult!==void 0)return rt.cachedResult;let y=Ee.ETC;const{userAgent:w}=navigator;return/Chrom(e|ium)/i.test(w)?y=Ee.CHROME:/iP(ad|od|hone)/i.test(w)&&/WebKit/i.test(w)?y=Ee.IOS:/Safari/i.test(w)?y=Ee.DESKTOP_SAFARI:/Firefox/i.test(w)?y=Ee.FIREFOX:(/MSIE/i.test(w)||document.documentMode)&&(y=Ee.IE),rt.cachedResult=y,rt.cachedResult}function Qr(y,w){const c=rt(),i=Os[c];let t=y,r=w,h=t*r;const d=t>r?r/t:t/r;for(;h>i*i;){const C=(i+t)/2,_=(i+r)/2;C<_?(r=_,t=_*d):(r=C*d,t=C),h=t*r}return{width:t,height:r}}function Bt(y,w){let c,i;try{if(c=new OffscreenCanvas(y,w),i=c.getContext("2d"),i===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{c=document.createElement("canvas"),i=c.getContext("2d")}return c.width=y,c.height=w,[c,i]}function Hr(y,w){const{width:c,height:i}=Qr(y.width,y.height),[t,r]=Bt(c,i);return w&&/jpe?g/.test(w)&&(r.fillStyle="white",r.fillRect(0,0,t.width,t.height)),r.drawImage(y,0,0,t.width,t.height),t}function Ut(){return Ut.cachedResult!==void 0||(Ut.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Ut.cachedResult}function Tt(y,w={}){return new Promise(function(c,i){let t,r;var h=function(){try{return r=Hr(t,w.fileType||y.type),c([t,r])}catch(C){return i(C)}},d=function(C){try{var _=function(n){try{throw n}catch(a){return i(a)}};try{let n;return Gr(y).then(function(a){try{return n=a,Vr(n).then(function(s){try{return t=s,function(){try{return h()}catch(m){return i(m)}}()}catch(m){return _(m)}},_)}catch(s){return _(s)}},_)}catch(n){_(n)}}catch(n){return i(n)}};try{if(Ut()||[Ee.DESKTOP_SAFARI,Ee.MOBILE_SAFARI].includes(rt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(y).then(function(C){try{return t=C,h()}catch{return d()}},d)}catch{d()}})}function qt(y,w,c,i,t=1){return new Promise(function(r,h){let d;if(w==="image/png"){let _,n,a;return _=y.getContext("2d"),{data:n}=_.getImageData(0,0,y.width,y.height),a=Be.encode([n.buffer],y.width,y.height,4096*t),d=new Blob([a],{type:w}),d.name=c,d.lastModified=i,C.call(this)}{let _=function(){return C.call(this)};if(w==="image/bmp")return new Promise(n=>Br.toBlob(y,n)).then((function(n){try{return d=n,d.name=c,d.lastModified=i,_.call(this)}catch(a){return h(a)}}).bind(this),h);{let n=function(){return _.call(this)};if(typeof OffscreenCanvas=="function"&&y instanceof OffscreenCanvas)return y.convertToBlob({type:w,quality:t}).then((function(a){try{return d=a,d.name=c,d.lastModified=i,n.call(this)}catch(s){return h(s)}}).bind(this),h);{let a;return a=y.toDataURL(w,t),ar(a,c,i).then((function(s){try{return d=s,n.call(this)}catch(m){return h(m)}}).bind(this),h)}}}function C(){return r(d)}})}function Ge(y){y.width=0,y.height=0}function ct(){return new Promise(function(y,w){let c,i,t,r;return ct.cachedResult!==void 0?y(ct.cachedResult):ar("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(h){try{return c=h,Tt(c).then(function(d){try{return i=d[1],qt(i,c.type,c.name,c.lastModified).then(function(C){try{return t=C,Ge(i),Tt(t).then(function(_){try{return r=_[0],ct.cachedResult=r.width===1&&r.height===2,y(ct.cachedResult)}catch(n){return w(n)}},w)}catch(_){return w(_)}},w)}catch(C){return w(C)}},w)}catch(d){return w(d)}},w)})}function Wr(y){return new Promise((w,c)=>{const i=new Or;i.onload=t=>{const r=new DataView(t.target.result);if(r.getUint16(0,!1)!=65496)return w(-2);const h=r.byteLength;let d=2;for(;d<h;){if(r.getUint16(d+2,!1)<=8)return w(-1);const C=r.getUint16(d,!1);if(d+=2,C==65505){if(r.getUint32(d+=2,!1)!=1165519206)return w(-1);const _=r.getUint16(d+=6,!1)==18761;d+=r.getUint32(d+4,_);const n=r.getUint16(d,_);d+=2;for(let a=0;a<n;a++)if(r.getUint16(d+12*a,_)==274)return w(r.getUint16(d+12*a+8,_))}else{if((65280&C)!=65280)break;d+=r.getUint16(d,!1)}}return w(-1)},i.onerror=t=>c(t),i.readAsArrayBuffer(y)})}function Kr(y,w){const{width:c}=y,{height:i}=y,{maxWidthOrHeight:t}=w;let r,h=y;return isFinite(t)&&(c>t||i>t)&&([h,r]=Bt(c,i),c>i?(h.width=t,h.height=i/c*t):(h.width=c/i*t,h.height=t),r.drawImage(y,0,0,h.width,h.height),Ge(y)),h}function Xr(y,w){const{width:c}=y,{height:i}=y,[t,r]=Bt(c,i);switch(w>4&&w<9?(t.width=i,t.height=c):(t.width=c,t.height=i),w){case 2:r.transform(-1,0,0,1,c,0);break;case 3:r.transform(-1,0,0,-1,c,i);break;case 4:r.transform(1,0,0,-1,0,i);break;case 5:r.transform(0,1,1,0,0,0);break;case 6:r.transform(0,1,-1,0,i,0);break;case 7:r.transform(0,-1,-1,0,i,c);break;case 8:r.transform(0,-1,1,0,0,c)}return r.drawImage(y,0,0,c,i),Ge(y),t}function Ir(y,w,c=0){return new Promise(function(i,t){let r,h,d,C,_,n,a,s,m,j,E,N,S,R,$,A,T,b,F,o;function u(L=5){if(w.signal&&w.signal.aborted)throw w.signal.reason;r+=L,w.onProgress(Math.min(r,100))}function k(L){if(w.signal&&w.signal.aborted)throw w.signal.reason;r=Math.min(Math.max(L,r),100),w.onProgress(r)}return r=c,h=w.maxIteration||10,d=1024*w.maxSizeMB*1024,u(),Tt(y,w).then((function(L){try{return[,C]=L,u(),_=Kr(C,w),u(),new Promise(function(I,p){var x;if(!(x=w.exifOrientation))return Wr(y).then((function(l){try{return x=l,v.call(this)}catch(g){return p(g)}}).bind(this),p);function v(){return I(x)}return v.call(this)}).then((function(I){try{return n=I,u(),ct().then((function(p){try{return a=p?_:Xr(_,n),u(),s=w.initialQuality||1,m=w.fileType||y.type,qt(a,m,y.name,y.lastModified,s).then((function(x){try{{let l=function(){if(h--&&($>d||$>S)){let B,M;return B=o?.95*F.width:F.width,M=o?.95*F.height:F.height,[T,b]=Bt(B,M),b.drawImage(F,0,0,B,M),s*=m==="image/png"?.85:.95,qt(T,m,y.name,y.lastModified,s).then(function(P){try{return A=P,Ge(F),F=T,$=A.size,k(Math.min(99,Math.floor((R-$)/(R-d)*100))),l}catch(X){return t(X)}},t)}return[1]},g=function(){return Ge(F),Ge(T),Ge(_),Ge(a),Ge(C),k(100),i(A)};if(j=x,u(),E=j.size>d,N=j.size>y.size,!E&&!N)return k(100),i(j);var v;return S=y.size,R=j.size,$=R,F=a,o=!w.alwaysKeepResolution&&E,(v=(function(B){for(;B;){if(B.then)return void B.then(v,t);try{if(B.pop){if(B.length)return B.pop()?g.call(this):B;B=l}else B=B.call(this)}catch(M){return t(M)}}}).bind(this))(l)}}catch(l){return t(l)}}).bind(this),t)}catch(x){return t(x)}}).bind(this),t)}catch(p){return t(p)}}).bind(this),t)}catch(I){return t(I)}}).bind(this),t)})}const Vs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Kt;function Qs(y,w){return new Promise((c,i)=>{Kt||(Kt=function(h){const d=[];return typeof h=="function"?d.push(`(${h})()`):d.push(h),URL.createObjectURL(new Blob(d))}(Vs));const t=new Worker(Kt);t.addEventListener("message",function(h){if(w.signal&&w.signal.aborted)t.terminate();else if(h.data.progress===void 0){if(h.data.error)return i(new Error(h.data.error)),void t.terminate();c(h.data.file),t.terminate()}else w.onProgress(h.data.progress)}),t.addEventListener("error",i),w.signal&&w.signal.addEventListener("abort",()=>{i(w.signal.reason),t.terminate()}),t.postMessage({file:y,imageCompressionLibUrl:w.libURL,options:{...w,onProgress:void 0,signal:void 0}})})}function Ae(y,w){return new Promise(function(c,i){let t,r,h,d,C,_;if(t={...w},h=0,{onProgress:d}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,C=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=m=>{h=m,typeof d=="function"&&d(h)},!(y instanceof Blob||y instanceof Gs))return i(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(y.type))return i(new Error("The file given is not an image"));if(_=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!C||typeof Worker!="function"||_)return Ir(y,t).then((function(m){try{return r=m,s.call(this)}catch(j){return i(j)}}).bind(this),i);var n=(function(){try{return s.call(this)}catch(m){return i(m)}}).bind(this),a=function(m){try{return Ir(y,t).then(function(j){try{return r=j,n()}catch(E){return i(E)}},i)}catch(j){return i(j)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Qs(y,t).then(function(m){try{return r=m,n()}catch{return a()}},a)}catch{a()}function s(){try{r.name=y.name,r.lastModified=y.lastModified}catch{}try{t.preserveExif&&y.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===y.type)&&(r=qr(y,r))}catch{}return c(r)}})}Ae.getDataUrlFromFile=Gr,Ae.getFilefromDataUrl=ar,Ae.loadImage=Vr,Ae.drawImageInCanvas=Hr,Ae.drawFileInCanvas=Tt,Ae.canvasToFile=qt,Ae.getExifOrientation=Wr,Ae.handleMaxWidthOrHeight=Kr,Ae.followExifOrientation=Xr,Ae.cleanupCanvasMemory=Ge,Ae.isAutoOrientationInBrowser=ct,Ae.approximateBelowMaximumCanvasSizeOfBrowser=Qr,Ae.copyExifWithoutOrientation=qr,Ae.getBrowserName=rt,Ae.version="2.0.2";const nr=({productId:y,userId:w,existingImages:c=[],onImagesChange:i,maxImages:t=5,bucket:r="product-images",className:h=""})=>{const[d,C]=G.useState([]),[_,n]=G.useState(!1),[a,s]=G.useState({}),[m,j]=G.useState(!1),E=G.useRef(null);G.useEffect(()=>{if(c&&c.length>0){const o=c.map((u,k)=>({id:u.id||`existing-${k}`,url:u.image_url||u.url||"",thumbnailUrl:u.thumbnail_url||u.thumbnailUrl||u.image_url||u.url||"",fileName:u.file_name||u.fileName||`image-${k}.jpg`,fileSize:u.file_size||u.fileSize||0,isPrimary:u.is_primary||u.isPrimary||k===0,uploadedAt:u.created_at||u.uploadedAt||new Date().toISOString()}));C(o)}},[]);const N=async o=>{try{return await Ae(o,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,fileType:"image/webp"})}catch(u){return console.error("Error compressing image:",u),o}},S=async o=>{try{const u=o.name.split(".").pop(),k=`${y}/${Date.now()}-${Math.random().toString(36).substring(7)}.${u}`;s(v=>({...v,[o.name]:10}));const L=await N(o);s(v=>({...v,[o.name]:30}));const{data:I,error:p}=await De.storage.from(r).upload(k,L,{cacheControl:"3600",upsert:!1});if(p)throw p;s(v=>({...v,[o.name]:70}));const{data:{publicUrl:x}}=De.storage.from(r).getPublicUrl(k);return s(v=>({...v,[o.name]:100})),{id:`${Date.now()}-${Math.random().toString(36).substring(7)}`,url:x,thumbnailUrl:x,fileName:o.name,fileSize:L.size,isPrimary:d.length===0,uploadedAt:new Date().toISOString()}}catch(u){return console.error("Error uploading image:",u),null}finally{setTimeout(()=>{s(u=>{const k={...u};return delete k[o.name],k})},1e3)}},R=G.useCallback(async o=>{if(!o||_)return;const u=Array.from(o),k=t-d.length,L=u.slice(0,k);if(L.length===0){alert(`Maximum ${t} images allowed`);return}n(!0);try{const I=L.map(v=>S(v)),x=(await Promise.all(I)).filter(v=>v!==null);if(x.length>0){const v=[...d,...x];C(v),i(v)}}catch(I){console.error("Error uploading images:",I)}finally{n(!1)}},[d,t,_,i]),$=async o=>{const u=d[o];if(u.url)try{const L=u.url.split("/"),I=L.indexOf(r);if(I!==-1){const p=L.slice(I+1).join("/");await De.storage.from(r).remove([p])}}catch(L){console.error("Error deleting image from storage:",L)}const k=d.filter((L,I)=>I!==o);u.isPrimary&&k.length>0&&(k[0].isPrimary=!0),C(k),i(k)},A=o=>{if(o===d.findIndex(k=>k.isPrimary))return;const u=d.map((k,L)=>({...k,isPrimary:L===o}));C(u),i(u)},T=o=>{o.preventDefault(),j(!0)},b=o=>{o.preventDefault(),j(!1)},F=o=>{o.preventDefault(),j(!1),R(o.dataTransfer.files)};return e.jsxs("div",{className:`space-y-4 ${h}`,children:[d.length<t&&e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${m?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${_?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onDragOver:T,onDragLeave:b,onDrop:F,onClick:()=>{var o;return!_&&((o=E.current)==null?void 0:o.click())},children:[e.jsx(ps,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:_?"Uploading...":"Drag and drop images here, or click to select"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Supports: JPG, PNG, GIF (Max ",t," images)"]}),e.jsx("input",{ref:E,type:"file",multiple:!0,accept:"image/*",onChange:o=>R(o.target.files),className:"hidden",disabled:_})]}),d.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:d.map((o,u)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100 border border-gray-200",children:e.jsx("img",{src:o.thumbnailUrl||o.url,alt:o.fileName,className:"w-full h-full object-cover",onError:k=>{const L=k.target;L.src=o.url}})}),a[o.fileName]!==void 0&&a[o.fileName]<100&&e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-70 rounded-lg flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-white text-xs mb-2",children:"Uploading..."}),e.jsx("div",{className:"w-3/4 bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-400 h-1.5 rounded-full transition-all duration-300",style:{width:`${a[o.fileName]}%`}})})]}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 rounded-lg",children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[!o.isPrimary&&e.jsx("button",{onClick:()=>A(u),className:"p-1.5 bg-white rounded-full shadow-sm hover:bg-yellow-50 transition-colors",title:"Set as primary",disabled:_,children:e.jsx(Gt,{size:14,className:"text-yellow-500"})}),e.jsx("button",{onClick:()=>$(u),className:"p-1.5 bg-white rounded-full shadow-sm hover:bg-red-50 transition-colors",title:"Remove image",disabled:_,children:e.jsx($e,{size:14,className:"text-red-500"})})]}),o.isPrimary&&e.jsx("div",{className:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("div",{className:"px-2 py-1 bg-yellow-500 text-white text-xs rounded-full flex items-center gap-1 shadow-lg",children:[e.jsx(Gt,{size:12,fill:"white"}),"Primary"]})})]}),o.isPrimary&&e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx("div",{className:"px-2 py-0.5 bg-yellow-500 text-white text-xs rounded-full flex items-center gap-1",children:e.jsx(Gt,{size:10,fill:"white"})})})]},o.id))}),d.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:[d.length," of ",t," images uploaded"]})]})},Hs=({variants:y,setVariants:w,useVariants:c,setUseVariants:i,showVariants:t,setShowVariants:r,isReorderingVariants:h,setIsReorderingVariants:d,draggedVariantIndex:C,setDraggedVariantIndex:_,onVariantSpecificationsClick:n,basePartNumber:a,mainProductImages:s})=>{const[m,j]=G.useState({}),E=()=>{const p=y.length>0?y[y.length-1]:null,x={name:`Variant ${y.length+1}`,sku:$(y.length+1),cost_price:(p==null?void 0:p.cost_price)||0,selling_price:(p==null?void 0:p.selling_price)||0,quantity:(p==null?void 0:p.quantity)||0,min_quantity:(p==null?void 0:p.min_quantity)||2,attributes:p!=null&&p.attributes?{...p.attributes}:{}};w(v=>[...v,x])},N=p=>{w(x=>x.filter((v,l)=>l!==p))},S=(p,x,v)=>{w(l=>l.map((g,B)=>B===p?{...g,[x]:v}:g))},R=(p,x)=>{if(x){const v=URL.createObjectURL(x);S(p,"image_file",x),S(p,"image_url",v)}else S(p,"image_file",null),S(p,"image_url","")},$=p=>`${a}-V${p.toString().padStart(2,"0")}`,A=p=>{if(!p&&p!==0)return"";const x=typeof p=="string"?parseFloat(p.replace(/,/g,"")):p;return isNaN(x)?"":x.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})},T=p=>{const x=p.replace(/,/g,""),v=parseFloat(x);return isNaN(v)?0:v},b=(p,x,v)=>{const l=T(v);S(p,x,l)},F=(p,x)=>{j(v=>({...v,[`${p}-${x}`]:!0}))},o=(p,x)=>{j(v=>({...v,[`${p}-${x}`]:!1}))},u=(p,x)=>{_(x),p.dataTransfer.effectAllowed="move"},k=p=>{p.preventDefault(),p.dataTransfer.dropEffect="move"},L=(p,x)=>{p.preventDefault(),!(C===null||C===x)&&(w(v=>{const l=[...v],g=l[C];return l.splice(C,1),l.splice(x,0,g),l}),_(null))},I=(p,x)=>{const v=p.toLowerCase(),l=x.toLowerCase();if(v.includes("storage")||v.includes("capacity")||v.includes("disk")){if(l.includes("gb")||l.includes("gigabyte")||l.includes("tb")||l.includes("terabyte")||l.includes("mb")||l.includes("megabyte"))return x;if(/^\d+$/.test(x))return`${x} GB`}if(v.includes("ram")||v.includes("memory")||v.includes("ddr")){if(l.includes("gb")||l.includes("gigabyte")||l.includes("mb")||l.includes("megabyte"))return x;if(/^\d+$/.test(x))return`${x} GB`}if(v.includes("screen")||v.includes("display")||v.includes("monitor")||v.includes("size")){if(l.includes("inch")||l.includes('"')||l.includes("in"))return x;if(/^\d+(\.\d+)?$/.test(x))return`${x}"`}if(v.includes("weight")||v.includes("mass")){if(l.includes("kg")||l.includes("kilogram")||l.includes("g")||l.includes("gram")||l.includes("lb")||l.includes("pound"))return x;if(/^\d+(\.\d+)?$/.test(x))return`${x} kg`}if(v.includes("battery")||v.includes("mah")){if(l.includes("mah")||l.includes("milliampere")||l.includes("wh")||l.includes("watt"))return x;if(/^\d+$/.test(x))return`${x} mAh`}if(v.includes("processor")||v.includes("cpu")||v.includes("ghz")){if(l.includes("ghz")||l.includes("gigahertz")||l.includes("mhz")||l.includes("megahertz"))return x;if(/^\d+(\.\d+)?$/.test(x))return`${x} GHz`}if((v.includes("resolution")||v.includes("pixel")||v.includes("hd"))&&(l.includes("p")||l.includes("pixel")||l.includes("x")&&/^\d+x\d+$/.test(x)))return x;if(v.includes("dimension")||v.includes("length")||v.includes("width")||v.includes("height")){if(l.includes("cm")||l.includes("centimeter")||l.includes("mm")||l.includes("millimeter")||l.includes("inch")||l.includes('"')||l.includes("in"))return x;if(/^\d+(\.\d+)?$/.test(x))return`${x} cm`}return x};return e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Et,{size:20,className:"text-green-600"}),"Spare Part Variants"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c&&y.length>0&&e.jsx(e.Fragment,{children:e.jsxs("button",{type:"button",onClick:()=>d(!h),className:`text-xs px-3 py-1 rounded ${h?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,title:"Toggle reorder mode",children:[e.jsx(fs,{size:14,className:"inline mr-1"}),h?"Done":"Reorder"]})}),e.jsx("button",{type:"button",role:"switch","aria-checked":c,onClick:()=>{i(!c)},className:`relative inline-flex h-6 w-11 items-center rounded-full ${c?"bg-blue-600":"bg-gray-300"}`,"aria-label":"Toggle variants",children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white transition ${c?"translate-x-5":"translate-x-1"}`})})]})]}),c&&t&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:y.map((p,x)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",draggable:h,onDragStart:v=>u(v,x),onDragOver:k,onDrop:v=>L(v,x),onDragEnd:()=>_(null),style:{cursor:h?"grabbing":"grab"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h&&e.jsx("div",{className:"w-6 h-6 flex items-center justify-center text-gray-400",children:e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 6h8v2H8V6zm0 5h8v2H8v-2zm0 5h8v2H8v-2z"})})}),e.jsx("h4",{className:"font-medium text-gray-900",children:p.name||`Variant ${x+1}`})]}),e.jsx("div",{className:"flex items-center gap-2",children:!h&&e.jsx("button",{type:"button",onClick:()=>N(x),disabled:y.length===1,className:`p-1 rounded transition-colors ${y.length===1?"text-gray-300 cursor-not-allowed":"text-red-500 hover:text-red-700 hover:bg-red-50"}`,"aria-label":"Remove variant",title:y.length===1?"Cannot delete the last variant. At least one variant is required.":"Remove variant",children:e.jsx(Lt,{size:16})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p.name,onChange:v=>S(x,"name",v.target.value),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors border-gray-300 focus:border-blue-500",placeholder:"Variant name",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ce,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SKU (Auto Generated)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p.sku,readOnly:!0,className:"w-full py-3 pl-12 pr-4 bg-gray-100 border-2 rounded-lg border-gray-300 text-gray-600 cursor-not-allowed",placeholder:"Auto-generated"}),e.jsx(ys,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"SKU is automatically generated for this variant"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Variant Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden",children:p.image_url?e.jsx("img",{src:p.image_url,alt:p.name,className:"w-full h-full object-cover rounded-lg"}):s&&s.length>0?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:s[0],alt:`${p.name} (using main product image)`,className:"w-full h-full object-cover rounded-lg opacity-60"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-600 bg-white/80 px-1 rounded",children:"Main"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(Fr,{size:24,className:"text-gray-400 mx-auto mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"No image"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(nr,{onImageChange:v=>R(x,v),currentImage:p.image_file,className:"w-full",accept:"image/*",maxSize:5*1024*1024}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Upload a specific image for this variant. If no image is uploaded, the main product image will be used."})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsx("button",{type:"button",onClick:()=>n(x),className:"group w-full bg-gradient-to-r from-white/50 to-white/30 backdrop-blur-md border-2 border-gray-300 rounded-xl hover:border-purple-500 hover:shadow-lg hover:scale-[1.02] transition-all duration-300 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center group-hover:from-purple-600 group-hover:to-purple-700 transition-all duration-300 shadow-md group-hover:shadow-lg",children:e.jsx(Et,{className:"w-5 h-5 text-white"})}),p.attributes&&Object.keys(p.attributes).length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center shadow-md",children:e.jsx(dt,{className:"w-2.5 h-2.5 text-white"})})]}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 group-hover:text-purple-900 transition-colors duration-300",children:"Specifications"}),p.attributes&&Object.keys(p.attributes).length>0?e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"grid grid-cols-2 gap-1 max-h-12 overflow-y-auto",children:Object.entries(p.attributes).slice(0,4).map(([v,l])=>e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-md px-1.5 py-0.5",children:[e.jsx("div",{className:"text-xs font-medium text-purple-800 truncate",children:v}),e.jsx("div",{className:"text-xs text-purple-600 truncate",children:I(v,String(l))})]},v))}),Object.keys(p.attributes).length>4&&e.jsxs("div",{className:"text-xs text-purple-600 mt-0.5",children:["+",Object.keys(p.attributes).length-4," more"]})]}):e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Add variant specifications"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p.attributes&&Object.keys(p.attributes).length>0&&e.jsx("div",{className:"px-2.5 py-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white text-xs font-bold rounded-full shadow-md",children:Object.keys(p.attributes).length}),e.jsx("div",{className:"w-6 h-6 bg-gray-100 group-hover:bg-purple-100 rounded-lg flex items-center justify-center transition-all duration-300",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500 group-hover:text-purple-600 transition-colors duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Price *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors border-gray-300 focus:border-blue-500",placeholder:"0",autoComplete:"off",autoCorrect:"off",spellCheck:!1,value:!p.cost_price||p.cost_price===0?"":A(p.cost_price),onChange:v=>{const l=v.target.value;(l===""||/^[\d,]*\.?\d*$/.test(l))&&b(x,"cost_price",l)},onFocus:()=>F(x,"cost_price"),onBlur:()=>o(x,"cost_price")}),e.jsx(yt,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selling Price *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors border-gray-300 focus:border-blue-500",placeholder:"0",autoComplete:"off",autoCorrect:"off",spellCheck:!1,value:!p.selling_price||p.selling_price===0?"":A(p.selling_price),onChange:v=>{const l=v.target.value;(l===""||/^[\d,]*\.?\d*$/.test(l))&&b(x,"selling_price",l)},onFocus:()=>F(x,"selling_price"),onBlur:()=>o(x,"selling_price")}),e.jsx(yt,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock Quantity *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:p.quantity===0?"":p.quantity||"",onChange:v=>S(x,"quantity",Math.max(0,parseInt(v.target.value)||0)),onFocus:v=>{p.quantity===0&&(v.target.value="")},className:"w-full py-3 px-20 bg-white/30 backdrop-blur-md border-2 rounded-lg text-center text-lg font-semibold text-gray-900 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"0",min:"0",step:"1"}),e.jsx("button",{type:"button",onClick:()=>S(x,"quantity",Math.max(0,(p.quantity||0)-1)),className:"absolute left-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Decrease stock quantity",children:""}),e.jsx("button",{type:"button",onClick:()=>S(x,"quantity",(p.quantity||0)+1),className:"absolute right-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Increase stock quantity",children:"+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Stock Level *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:p.min_quantity===0?"":p.min_quantity||"",onChange:v=>S(x,"min_quantity",Math.max(0,parseInt(v.target.value)||0)),onFocus:v=>{p.min_quantity===0&&(v.target.value="")},className:"w-full py-3 px-20 bg-white/30 backdrop-blur-md border-2 rounded-lg text-center text-lg font-semibold text-gray-900 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"2",min:"0",step:"1"}),e.jsx("button",{type:"button",onClick:()=>S(x,"min_quantity",Math.max(0,(p.min_quantity||0)-1)),className:"absolute left-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Decrease minimum stock level",children:""}),e.jsx("button",{type:"button",onClick:()=>S(x,"min_quantity",(p.min_quantity||0)+1),className:"absolute right-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Increase minimum stock level",children:"+"})]})]})]})]},x))}),e.jsxs("button",{type:"button",onClick:E,className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all flex items-center justify-center gap-2 text-gray-600 hover:text-blue-600",children:[e.jsx(st,{size:20}),"Add New Variant"]})]})]})},tr=[{id:"laptop",name:"Laptop",icon:we,color:"blue",specifications:[{key:"processor",name:"Processor",icon:Vt,type:"text",placeholder:"Intel i5, AMD Ryzen 5",category:"text"},{key:"graphics",name:"Graphics",icon:we,type:"text",placeholder:"Intel UHD, NVIDIA GTX",category:"text"},{key:"color",name:"Color",icon:Je,type:"text",placeholder:"Silver, Black, Gold",category:"text"},{key:"high_refresh_rate",name:"High Refresh Rate",icon:et,type:"number",unit:"Hz",placeholder:"60",category:"number"},{key:"usb_c_ports",name:"USB-C Ports",icon:ot,type:"number",unit:"ports",placeholder:"2",category:"number"},{key:"usb_a_ports",name:"USB-A Ports",icon:ot,type:"number",unit:"ports",placeholder:"2",category:"number"},{key:"battery_life",name:"Battery Life",icon:mt,type:"number",unit:"hours",placeholder:"8",category:"number"},{key:"weight",name:"Weight",icon:Fe,type:"number",unit:"kg",placeholder:"1.5",category:"number"},{key:"thickness",name:"Thickness",icon:Fe,type:"number",unit:"mm",placeholder:"15",category:"number"},{key:"screen_size",name:"Screen Size",icon:we,type:"select",options:['11"','12"','13"','14"','15"','16"','17"','18"'],unit:"inch",category:"select"},{key:"resolution",name:"Resolution",icon:we,type:"select",options:["HD (1366x768)","FHD (1920x1080)","QHD (2560x1440)","4K (3840x2160)"],category:"select"},{key:"ram",name:"RAM",icon:Ct,type:"select",options:["4GB","8GB","16GB","32GB","64GB"],category:"select"},{key:"storage",name:"Storage",icon:_t,type:"select",options:["128GB","256GB","512GB","1TB","2TB"],category:"select"},{key:"storage_type",name:"Storage Type",icon:_t,type:"select",options:["HDD","SSD","NVMe SSD"],category:"select"},{key:"wifi",name:"Wi-Fi",icon:br,type:"select",options:["Wi-Fi 5","Wi-Fi 6","Wi-Fi 6E"],category:"select"},{key:"bluetooth",name:"Bluetooth",icon:pr,type:"select",options:["4.0","5.0","5.1","5.2"],category:"select"},{key:"touch_screen",name:"Touch Screen",icon:At,type:"boolean",category:"boolean"},{key:"oled_display",name:"OLED Display",icon:we,type:"boolean",category:"boolean"},{key:"backlit_keyboard",name:"Backlit Keyboard",icon:vs,type:"boolean",category:"boolean"},{key:"fingerprint_scanner",name:"Fingerprint Scanner",icon:Qt,type:"boolean",category:"boolean"},{key:"face_id",name:"Face Recognition",icon:Ht,type:"boolean",category:"boolean"},{key:"convertible",name:"Convertible (2-in-1)",icon:et,type:"boolean",category:"boolean"},{key:"stylus_support",name:"Stylus Support",icon:fr,type:"boolean",category:"boolean"},{key:"hdmi_port",name:"HDMI Port",icon:tt,type:"boolean",category:"boolean"},{key:"thunderbolt",name:"Thunderbolt",icon:tt,type:"boolean",category:"boolean"},{key:"headphone_jack",name:"Headphone Jack",icon:lt,type:"boolean",category:"boolean"},{key:"fast_charging",name:"Fast Charging",icon:Dt,type:"boolean",category:"boolean"},{key:"wireless_charging",name:"Wireless Charging",icon:gt,type:"boolean",category:"boolean"},{key:"waterproof",name:"Waterproof",icon:yr,type:"boolean",category:"boolean"},{key:"dust_resistant",name:"Dust Resistant",icon:vr,type:"boolean",category:"boolean"},{key:"military_grade",name:"Military Grade",icon:ht,type:"boolean",category:"boolean"}]},{id:"mobile",name:"Mobile",icon:jr,color:"green",specifications:[{key:"processor",name:"Processor",icon:Vt,type:"text",placeholder:"Snapdragon 888, A15 Bionic",category:"text"},{key:"rear_camera",name:"Rear Camera",icon:Xe,type:"text",placeholder:"48MP + 12MP + 5MP",category:"text"},{key:"front_camera",name:"Front Camera",icon:Xe,type:"text",placeholder:"12MP",category:"text"},{key:"fast_charging",name:"Fast Charging",icon:Dt,type:"text",placeholder:"25W, 45W, 65W",category:"text"},{key:"color",name:"Color",icon:Je,type:"text",placeholder:"Black, White, Blue",category:"text"},{key:"screen_size",name:"Screen Size",icon:we,type:"number",unit:"inch",placeholder:"6.1",category:"number"},{key:"optical_zoom",name:"Optical Zoom",icon:Xe,type:"number",unit:"x",placeholder:"3",category:"number"},{key:"weight",name:"Weight",icon:Fe,type:"number",unit:"g",placeholder:"180",category:"number"},{key:"thickness",name:"Thickness",icon:Fe,type:"number",unit:"mm",placeholder:"8.1",category:"number"},{key:"battery_capacity",name:"Battery Capacity",icon:mt,type:"number",unit:"mAh",placeholder:"4000",category:"number"},{key:"battery_life",name:"Battery Life",icon:mt,type:"number",unit:"hours",placeholder:"24",category:"number"},{key:"resolution",name:"Resolution",icon:we,type:"select",options:["HD+","FHD+","QHD+","4K"],category:"select"},{key:"display_type",name:"Display Type",icon:we,type:"select",options:["LCD","OLED","AMOLED","Super AMOLED"],category:"select"},{key:"refresh_rate",name:"Refresh Rate",icon:et,type:"select",options:["60Hz","90Hz","120Hz","144Hz"],category:"select"},{key:"ram",name:"RAM",icon:Ct,type:"select",options:["4GB","6GB","8GB","12GB","16GB"],category:"select"},{key:"storage",name:"Storage",icon:_t,type:"select",options:["64GB","128GB","256GB","512GB","1TB"],category:"select"},{key:"video_recording",name:"Video Recording",icon:Xe,type:"select",options:["4K@30fps","4K@60fps","8K@30fps"],category:"select"},{key:"waterproof",name:"Waterproof",icon:yr,type:"select",options:["IP67","IP68"],category:"select"},{key:"touch_screen",name:"Touch Screen",icon:At,type:"boolean",category:"boolean"},{key:"expandable_storage",name:"Expandable Storage",icon:Nr,type:"boolean",category:"boolean"},{key:"fingerprint_scanner",name:"Fingerprint Scanner",icon:Qt,type:"boolean",category:"boolean"},{key:"face_id",name:"Face Recognition",icon:Ht,type:"boolean",category:"boolean"},{key:"wireless_charging",name:"Wireless Charging",icon:gt,type:"boolean",category:"boolean"},{key:"reverse_charging",name:"Reverse Charging",icon:gt,type:"boolean",category:"boolean"},{key:"nfc",name:"NFC",icon:wr,type:"boolean",category:"boolean"},{key:"5g_support",name:"5G Support",icon:wr,type:"boolean",category:"boolean"},{key:"stereo_speakers",name:"Stereo Speakers",icon:Sr,type:"boolean",category:"boolean"},{key:"headphone_jack",name:"Headphone Jack",icon:lt,type:"boolean",category:"boolean"},{key:"noise_cancellation",name:"Noise Cancellation",icon:It,type:"boolean",category:"boolean"},{key:"dust_resistant",name:"Dust Resistant",icon:vr,type:"boolean",category:"boolean"},{key:"drop_resistant",name:"Drop Resistant",icon:ht,type:"boolean",category:"boolean"}]},{id:"monitor",name:"Monitor",icon:we,color:"purple",specifications:[{key:"color_accuracy",name:"Color Accuracy",icon:Je,type:"text",placeholder:"E < 2",category:"text"},{key:"contrast_ratio",name:"Contrast Ratio",icon:Ft,type:"text",placeholder:"1000:1",category:"text"},{key:"color",name:"Color",icon:Je,type:"text",placeholder:"Black, White, Silver",category:"text"},{key:"response_time",name:"Response Time",icon:Ct,type:"number",unit:"ms",placeholder:"1",category:"number"},{key:"brightness",name:"Brightness",icon:js,type:"number",unit:"nits",placeholder:"300",category:"number"},{key:"hdmi_ports",name:"HDMI Ports",icon:tt,type:"number",unit:"ports",placeholder:"2",category:"number"},{key:"displayport_ports",name:"DisplayPort Ports",icon:tt,type:"number",unit:"ports",placeholder:"1",category:"number"},{key:"usb_hub",name:"USB Hub",icon:ot,type:"number",unit:"ports",placeholder:"4",category:"number"},{key:"weight",name:"Weight",icon:Fe,type:"number",unit:"kg",placeholder:"5.5",category:"number"},{key:"thickness",name:"Thickness",icon:Fe,type:"number",unit:"mm",placeholder:"50",category:"number"},{key:"stand_height",name:"Stand Height",icon:Fe,type:"number",unit:"mm",placeholder:"100-150",category:"number"},{key:"power_consumption",name:"Power Consumption",icon:Wt,type:"number",unit:"W",placeholder:"25",category:"number"},{key:"screen_size",name:"Screen Size",icon:we,type:"select",options:['21"','24"','27"','32"','34"','43"','49"'],unit:"inch",category:"select"},{key:"resolution",name:"Resolution",icon:we,type:"select",options:["FHD (1920x1080)","QHD (2560x1440)","4K (3840x2160)","5K (5120x2880)","8K (7680x4320)"],category:"select"},{key:"aspect_ratio",name:"Aspect Ratio",icon:we,type:"select",options:["16:9","16:10","21:9","32:9","4:3"],category:"select"},{key:"refresh_rate",name:"Refresh Rate",icon:et,type:"select",options:["60Hz","75Hz","120Hz","144Hz","165Hz","240Hz"],unit:"Hz",category:"select"},{key:"panel_type",name:"Panel Type",icon:we,type:"select",options:["IPS","VA","TN","OLED","Mini LED"],category:"select"},{key:"color_gamut",name:"Color Gamut",icon:Je,type:"select",options:["sRGB","Adobe RGB","DCI-P3","Rec. 2020"],category:"select"},{key:"hdr_support",name:"HDR Support",icon:we,type:"select",options:["HDR10","HDR10+","Dolby Vision","None"],category:"select"},{key:"energy_rating",name:"Energy Rating",icon:Wt,type:"select",options:["A+++","A++","A+","A","B","C"],category:"select"},{key:"g_sync",name:"G-Sync",icon:xt,type:"boolean",category:"boolean"},{key:"freesync",name:"FreeSync",icon:xt,type:"boolean",category:"boolean"},{key:"curved",name:"Curved Display",icon:we,type:"boolean",category:"boolean"},{key:"touch_screen",name:"Touch Screen",icon:At,type:"boolean",category:"boolean"},{key:"built_in_speakers",name:"Built-in Speakers",icon:Sr,type:"boolean",category:"boolean"},{key:"webcam",name:"Built-in Webcam",icon:Xe,type:"boolean",category:"boolean"},{key:"microphone",name:"Built-in Microphone",icon:It,type:"boolean",category:"boolean"},{key:"usb_c_port",name:"USB-C Port",icon:ot,type:"boolean",category:"boolean"},{key:"audio_out",name:"Audio Out",icon:lt,type:"boolean",category:"boolean"},{key:"ethernet",name:"Ethernet Port",icon:tt,type:"boolean",category:"boolean"},{key:"tilt",name:"Tilt Adjustment",icon:et,type:"boolean",category:"boolean"},{key:"swivel",name:"Swivel Adjustment",icon:et,type:"boolean",category:"boolean"},{key:"height_adjustable",name:"Height Adjustable",icon:Fe,type:"boolean",category:"boolean"},{key:"pivot",name:"Pivot (Portrait)",icon:et,type:"boolean",category:"boolean"},{key:"wall_mountable",name:"Wall Mountable",icon:ht,type:"boolean",category:"boolean"}]},{id:"tablet",name:"Tablet",icon:we,color:"orange",specifications:[{key:"processor",name:"Processor",icon:Vt,type:"text",placeholder:"Apple A14, Snapdragon 870",category:"text"},{key:"rear_camera",name:"Rear Camera",icon:Xe,type:"text",placeholder:"12MP",category:"text"},{key:"front_camera",name:"Front Camera",icon:Xe,type:"text",placeholder:"7MP",category:"text"},{key:"color",name:"Color",icon:Je,type:"text",placeholder:"Space Gray, Silver",category:"text"},{key:"screen_size",name:"Screen Size",icon:we,type:"number",unit:"inch",placeholder:"10.9",category:"number"},{key:"weight",name:"Weight",icon:Fe,type:"number",unit:"g",placeholder:"500",category:"number"},{key:"thickness",name:"Thickness",icon:Fe,type:"number",unit:"mm",placeholder:"6.1",category:"number"},{key:"battery_life",name:"Battery Life",icon:mt,type:"number",unit:"hours",placeholder:"10",category:"number"},{key:"resolution",name:"Resolution",icon:we,type:"select",options:["HD","FHD","QHD","4K"],category:"select"},{key:"display_type",name:"Display Type",icon:we,type:"select",options:["LCD","OLED","AMOLED"],category:"select"},{key:"ram",name:"RAM",icon:Ct,type:"select",options:["4GB","6GB","8GB","12GB"],category:"select"},{key:"storage",name:"Storage",icon:_t,type:"select",options:["64GB","128GB","256GB","512GB","1TB"],category:"select"},{key:"wifi",name:"Wi-Fi",icon:br,type:"select",options:["Wi-Fi 5","Wi-Fi 6","Wi-Fi 6E"],category:"select"},{key:"bluetooth",name:"Bluetooth",icon:pr,type:"select",options:["4.0","5.0","5.1","5.2"],category:"select"},{key:"touch_screen",name:"Touch Screen",icon:At,type:"boolean",category:"boolean"},{key:"stylus_support",name:"Stylus Support",icon:fr,type:"boolean",category:"boolean"},{key:"expandable_storage",name:"Expandable Storage",icon:Nr,type:"boolean",category:"boolean"},{key:"fingerprint_scanner",name:"Fingerprint Scanner",icon:Qt,type:"boolean",category:"boolean"},{key:"face_id",name:"Face Recognition",icon:Ht,type:"boolean",category:"boolean"},{key:"keyboard_support",name:"Keyboard Support",icon:Ns,type:"boolean",category:"boolean"},{key:"cellular",name:"Cellular Support",icon:jr,type:"boolean",category:"boolean"},{key:"gps",name:"GPS",icon:ws,type:"boolean",category:"boolean"},{key:"usb_c_port",name:"USB-C Port",icon:ot,type:"boolean",category:"boolean"},{key:"headphone_jack",name:"Headphone Jack",icon:lt,type:"boolean",category:"boolean"},{key:"fast_charging",name:"Fast Charging",icon:Dt,type:"boolean",category:"boolean"},{key:"wireless_charging",name:"Wireless Charging",icon:gt,type:"boolean",category:"boolean"}]},{id:"accessories",name:"Accessories",icon:tt,color:"gray",specifications:[{key:"type",name:"Type",icon:tt,type:"text",placeholder:"Charger, Cable, Case",category:"text"},{key:"compatibility",name:"Compatibility",icon:xt,type:"text",placeholder:"iPhone, Samsung, Universal",category:"text"},{key:"color",name:"Color",icon:Je,type:"text",placeholder:"Black, White, Blue",category:"text"},{key:"material",name:"Material",icon:ht,type:"text",placeholder:"Plastic, Metal, Leather",category:"text"},{key:"power_output",name:"Power Output",icon:Wt,type:"text",placeholder:"20W, 65W",category:"text"},{key:"dimensions",name:"Dimensions",icon:Fe,type:"text",placeholder:"L x W x H",category:"text"},{key:"cable_length",name:"Cable Length",icon:Fe,type:"number",unit:"m",placeholder:"1",category:"number"},{key:"battery_life",name:"Battery Life",icon:mt,type:"number",unit:"hours",placeholder:"20",category:"number"},{key:"weight",name:"Weight",icon:Fe,type:"number",unit:"g",placeholder:"50",category:"number"},{key:"connector_type",name:"Connector Type",icon:ot,type:"select",options:["USB-A","USB-C","Lightning","Micro USB"],category:"select"},{key:"protection_level",name:"Protection Level",icon:ht,type:"select",options:["Basic","Drop Protection","Waterproof","Military Grade"],category:"select"},{key:"audio_type",name:"Audio Type",icon:lt,type:"select",options:["Wired","Wireless","Bluetooth","USB-C"],category:"select"},{key:"fast_charging",name:"Fast Charging",icon:Dt,type:"boolean",category:"boolean"},{key:"wireless_charging",name:"Wireless Charging",icon:gt,type:"boolean",category:"boolean"},{key:"transparency",name:"Transparent",icon:Ft,type:"boolean",category:"boolean"},{key:"magnetic",name:"Magnetic",icon:xt,type:"boolean",category:"boolean"},{key:"kickstand",name:"Kickstand",icon:xt,type:"boolean",category:"boolean"},{key:"noise_cancellation",name:"Noise Cancellation",icon:It,type:"boolean",category:"boolean"},{key:"microphone",name:"Microphone",icon:It,type:"boolean",category:"boolean"}]}],Ws=y=>{const w=tr.find(c=>c.id===y);return w?w.specifications:[]},Ks=y=>{const w=Ws(y),c={text:[],number:[],select:[],boolean:[]};return w.forEach(i=>{c[i.type]&&c[i.type].push(i)}),c},Xs=y=>({text:"Text Fields",number:"Number Fields",select:"Dropdown Selections",boolean:"Yes/No Features"})[y]||y,Zs=async y=>{try{console.log(" [DEBUG] Searching brands:",y);const{data:w,error:c}=await De.from("lats_spare_parts").select("brand, updated_at").not("brand","is",null).neq("brand","").ilike("brand",`%${y}%`).eq("is_active",!0);if(c)throw console.error(" [DEBUG] Error searching brands:",c),c;const i=new Map;(w||[]).forEach(r=>{var d;const h=(d=r.brand)==null?void 0:d.trim();if(h){const C=i.get(h);C?(C.count+=1,r.updated_at>C.lastUsed&&(C.lastUsed=r.updated_at)):i.set(h,{count:1,lastUsed:r.updated_at})}});const t=Array.from(i.entries()).map(([r,h])=>({name:r,count:h.count,lastUsed:h.lastUsed})).sort((r,h)=>{const d=r.name.toLowerCase()===y.toLowerCase(),C=h.name.toLowerCase()===y.toLowerCase();return d&&!C?-1:!d&&C?1:h.count-r.count});return console.log(" [DEBUG] Found brands:",t.length),{data:t,message:"Brands found successfully",ok:!0}}catch(w){return console.error(" [DEBUG] Error searching brands:",w),{data:[],message:w instanceof Error?w.message:"Failed to search brands",ok:!1}}},Ys=async(y,w=5)=>{try{if(!y||y.length<2)return[];console.log(" [DEBUG] Getting brand suggestions for:",y);const c=await Zs(y);if(!c.ok)return[];const i=c.data.slice(0,w).map(t=>t.name);return console.log(" [DEBUG] Brand suggestions:",i),i}catch(c){return console.error(" [DEBUG] Error getting brand suggestions:",c),[]}},Js=({value:y,onChange:w,placeholder:c="e.g., Apple, Samsung",className:i="",error:t,required:r=!1})=>{const[h,d]=G.useState([]),[C,_]=G.useState(!1),[n,a]=G.useState(!1),[s,m]=G.useState(y),j=G.useRef(null),E=G.useRef(null);G.useEffect(()=>{m(y)},[y]),G.useEffect(()=>{const A=setTimeout(async()=>{if(s.length>=2){a(!0);try{const T=await Ys(s);d(T),_(T.length>0)}catch(T){console.error("Error fetching brand suggestions:",T),d([]),_(!1)}finally{a(!1)}}else d([]),_(!1)},300);return()=>clearTimeout(A)},[s]),G.useEffect(()=>{const A=T=>{E.current&&!E.current.contains(T.target)&&j.current&&!j.current.contains(T.target)&&_(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const N=A=>{const T=A.target.value;m(T),w(T)},S=A=>{var T;m(A),w(A),_(!1),(T=j.current)==null||T.focus()},R=A=>{var T;if(A.key==="Escape")_(!1);else if(A.key==="ArrowDown"){A.preventDefault();const b=(T=E.current)==null?void 0:T.querySelector("button");b&&b.focus()}},$=()=>{var A;m(""),w(""),_(!1),(A=j.current)==null||A.focus()};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:j,type:"text",value:s,onChange:N,onKeyDown:R,onFocus:()=>{h.length>0&&_(!0)},className:`w-full py-3 pl-12 pr-10 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors text-sm ${t?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"} ${i}`,placeholder:c,required:r,autoComplete:"off",spellCheck:!1}),e.jsx(Ss,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:16}),s&&e.jsx("button",{type:"button",onClick:$,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Clear input",children:e.jsx($e,{size:14,className:"text-gray-500"})}),n&&e.jsx("div",{className:"absolute right-8 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]}),C&&h.length>0&&e.jsx("div",{ref:E,className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:h.map((A,T)=>e.jsx("button",{type:"button",onClick:()=>S(A),className:"w-full px-4 py-3 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0 transition-colors",onKeyDown:b=>{var F;if(b.key==="ArrowDown"){b.preventDefault();const o=b.currentTarget.nextElementSibling;o&&o.focus()}else if(b.key==="ArrowUp"){b.preventDefault();const o=b.currentTarget.previousElementSibling;o?o.focus():(F=j.current)==null||F.focus()}else b.key==="Enter"&&(b.preventDefault(),S(A))},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Mt,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:A})]})},A))}),t&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:t})]})};class ea{async getUserDevicePreferences(){try{const{data:w,error:c}=await De.from("user_device_preferences").select("*").order("last_used",{ascending:!1});if(c)throw console.error("Error fetching user device preferences:",c),c;return w||[]}catch(w){return console.error("Failed to fetch user device preferences:",w),[]}}async saveDevicePreference(w){try{const{data:c,error:i}=await De.from("user_device_preferences").upsert({device_name:w.device_name,device_category:w.device_category,device_brand:w.device_brand,usage_count:1,last_used:new Date().toISOString()},{onConflict:"user_id,device_name",ignoreDuplicates:!1}).select().single();if(i)throw console.error("Error saving device preference:",i),i;return c}catch(c){return console.error("Failed to save device preference:",c),null}}async incrementDeviceUsage(w){try{const{error:c}=await De.rpc("increment_device_usage",{device_name_param:w});if(c)throw console.error("Error incrementing device usage:",c),c}catch(c){console.error("Failed to increment device usage:",c)}}async removeDevicePreference(w){try{const{error:c}=await De.from("user_device_preferences").delete().eq("device_name",w);if(c)throw console.error("Error removing device preference:",c),c;return!0}catch(c){return console.error("Failed to remove device preference:",c),!1}}async getMostUsedDevices(w=10){try{const{data:c,error:i}=await De.from("user_device_preferences").select("*").order("usage_count",{ascending:!1}).limit(w);if(i)throw console.error("Error fetching most used devices:",i),i;return c||[]}catch(c){return console.error("Failed to fetch most used devices:",c),[]}}async getRecentDevices(w=10){try{const{data:c,error:i}=await De.from("user_device_preferences").select("*").order("last_used",{ascending:!1}).limit(w);if(i)throw console.error("Error fetching recent devices:",i),i;return c||[]}catch(c){return console.error("Failed to fetch recent devices:",c),[]}}async searchDevices(w,c=8){try{const{data:i,error:t}=await De.from("user_device_preferences").select("*").ilike("device_name",`%${w}%`).order("usage_count",{ascending:!1}).limit(c);if(t)throw console.error("Error searching devices:",t),t;return i||[]}catch(i){return console.error("Failed to search devices:",i),[]}}}const bt=new ea;class ta{constructor(){this.STORAGE_KEY="lats_saved_devices",this.cache=new Map,this.cacheLoaded=!1,this.isProduction=!0,this.isProduction=!1,this.loadCache()}async loadDevices(){return this.isProduction?await this.loadFromDatabase():await this.loadFromLocalStorage()}async saveDevice(w,c,i){const t={device_name:w,device_category:c,device_brand:i,usage_count:1,last_used:new Date().toISOString()};return this.isProduction?await this.saveToDatabase(t):await this.saveToLocalStorage(t)}async incrementUsage(w){this.isProduction?await this.incrementUsageInDatabase(w):await this.incrementUsageInLocalStorage(w)}async removeDevice(w){return this.isProduction?await this.removeFromDatabase(w):await this.removeFromLocalStorage(w)}async searchDevices(w){try{if(this.isProduction)try{const{error:i}=await De.from("user_device_preferences").select("id").limit(1);if(!i||i.code!=="42P01")return await bt.searchDevices(w)}catch{console.log("Database search failed, falling back to local search")}return(await this.loadDevices()).filter(i=>{var t,r;return i.device_name.toLowerCase().includes(w.toLowerCase())||((t=i.device_brand)==null?void 0:t.toLowerCase().includes(w.toLowerCase()))||((r=i.device_category)==null?void 0:r.toLowerCase().includes(w.toLowerCase()))}).sort((i,t)=>t.usage_count-i.usage_count).slice(0,8)}catch(c){return console.error("Error searching devices:",c),[]}}async loadFromDatabase(){try{const{data:w,error:c}=await De.from("user_device_preferences").select("id").limit(1);if(c&&c.code==="42P01")return console.log("User device preferences table not found, using localStorage"),await this.loadFromLocalStorage();const t=(await bt.getUserDevicePreferences()).map(r=>({device_name:r.device_name,device_category:r.device_category,device_brand:r.device_brand,usage_count:r.usage_count,last_used:r.last_used}));return this.updateCache(t),t}catch(w){return console.error("Failed to load from database, falling back to localStorage:",w),await this.loadFromLocalStorage()}}async saveToDatabase(w){try{const{error:c}=await De.from("user_device_preferences").select("id").limit(1);return c&&c.code==="42P01"?(console.log("User device preferences table not found, saving to localStorage"),await this.saveToLocalStorage(w)):await bt.saveDevicePreference(w)?(this.updateCacheItem(w),!0):!1}catch(c){return console.error("Failed to save to database, falling back to localStorage:",c),await this.saveToLocalStorage(w)}}async incrementUsageInDatabase(w){try{const{error:c}=await De.from("user_device_preferences").select("id").limit(1);if(c&&c.code==="42P01"){console.log("User device preferences table not found, using localStorage"),await this.incrementUsageInLocalStorage(w);return}await bt.incrementDeviceUsage(w),this.incrementCacheUsage(w)}catch(c){console.error("Failed to increment usage in database:",c),await this.incrementUsageInLocalStorage(w)}}async removeFromDatabase(w){try{const{error:c}=await De.from("user_device_preferences").select("id").limit(1);return c&&c.code==="42P01"?(console.log("User device preferences table not found, using localStorage"),await this.removeFromLocalStorage(w)):await bt.removeDevicePreference(w)?(this.removeFromCache(w),!0):!1}catch(c){return console.error("Failed to remove from database, falling back to localStorage:",c),await this.removeFromLocalStorage(w)}}async loadFromLocalStorage(){try{const w=localStorage.getItem(this.STORAGE_KEY);if(w){const c=JSON.parse(w);return this.updateCache(c),c}return[]}catch(w){return console.error("Error loading from localStorage:",w),[]}}async saveToLocalStorage(w){try{const c=await this.loadFromLocalStorage(),i=c.findIndex(t=>t.device_name===w.device_name);return i>=0?c[i]=w:c.push(w),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(c)),this.updateCache(c),se.success(`"${w.device_name}" added to your device suggestions!`,{duration:3e3,icon:""}),!0}catch(c){return console.error("Error saving to localStorage:",c),se.error("Failed to save device to suggestions"),!1}}async incrementUsageInLocalStorage(w){try{const c=await this.loadFromLocalStorage(),i=c.find(t=>t.device_name===w);i&&(i.usage_count+=1,i.last_used=new Date().toISOString(),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(c)),this.updateCache(c))}catch(c){console.error("Error incrementing usage in localStorage:",c)}}async removeFromLocalStorage(w){try{const i=(await this.loadFromLocalStorage()).filter(t=>t.device_name!==w);return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(i)),this.updateCache(i),se.success(`"${w}" removed from suggestions`),!0}catch(c){return console.error("Error removing from localStorage:",c),!1}}loadCache(){try{const w=localStorage.getItem(this.STORAGE_KEY);if(w){const c=JSON.parse(w);this.updateCache(c)}}catch(w){console.error("Error loading cache:",w)}}updateCache(w){this.cache.clear(),w.forEach(c=>{this.cache.set(c.device_name,c)}),this.cacheLoaded=!0}updateCacheItem(w){this.cache.set(w.device_name,w)}incrementCacheUsage(w){const c=this.cache.get(w);c&&(c.usage_count+=1,c.last_used=new Date().toISOString(),this.cache.set(w,c))}removeFromCache(w){this.cache.delete(w)}getCachedDevices(){return Array.from(this.cache.values())}isCacheLoaded(){return this.cacheLoaded}getStorageMode(){return this.isProduction?"database":"localStorage"}}const it=new ta,ra=({sparePart:y,onSave:w,onCancel:c})=>{var dr,ur,mr,gr;const{currentUser:i}=Lr(),{categories:t,suppliers:r,loadSparePartCategories:h,loadSuppliers:d}=rr(),[C,_]=G.useState([]),[n,a]=G.useState([]),[s,m]=G.useState(!1),[j,E]=G.useState(!1),[N,S]=G.useState({name:"",categoryId:"",partNumber:"",brand:"",supplierId:"",condition:"new",description:"",costPrice:0,sellingPrice:0,quantity:0,minQuantity:0,storeLocationId:"",shelfId:"",location:"",compatibleDevices:"",images:[]}),[R,$]=G.useState({}),[A,T]=G.useState(!1),[b,F]=G.useState(!1),[o,u]=G.useState([]),[k,L]=G.useState({}),[I,p]=G.useState(!1),[x,v]=G.useState(""),[l,g]=G.useState(""),[B,M]=G.useState(""),[P,X]=G.useState([]),[W,O]=G.useState(!1),[V,q]=G.useState(!1),[te,pe]=G.useState(!1),[me,de]=G.useState(null),[xe,be]=G.useState(!1),[z,ae]=G.useState(null),[K,J]=G.useState(null),[ie,le]=G.useState(""),[ce,ge]=G.useState("laptop"),[ue,fe]=G.useState("temp-sparepart-"+Date.now()),[ve,he]=G.useState(!1),[ye,Se]=G.useState(""),[Ie,Te]=G.useState([]),[D,H]=G.useState(!1),[ee,Y]=G.useState(""),[ne,oe]=G.useState([]),[Ne,ze]=G.useState([]),[vt,jt]=G.useState(!1),{open:ut}=gs(),Ze=[{name:"iPhone 15 Pro Max",category:"smartphone",brand:"Apple"},{name:"iPhone 15 Pro",category:"smartphone",brand:"Apple"},{name:"iPhone 15 Plus",category:"smartphone",brand:"Apple"},{name:"iPhone 15",category:"smartphone",brand:"Apple"},{name:"iPhone 14 Pro Max",category:"smartphone",brand:"Apple"},{name:"iPhone 14 Pro",category:"smartphone",brand:"Apple"},{name:"iPhone 14 Plus",category:"smartphone",brand:"Apple"},{name:"iPhone 14",category:"smartphone",brand:"Apple"},{name:"iPhone 13 Pro Max",category:"smartphone",brand:"Apple"},{name:"iPhone 13 Pro",category:"smartphone",brand:"Apple"},{name:"iPhone 13",category:"smartphone",brand:"Apple"},{name:"iPhone 12 Pro Max",category:"smartphone",brand:"Apple"},{name:"iPhone 12 Pro",category:"smartphone",brand:"Apple"},{name:"iPhone 12",category:"smartphone",brand:"Apple"},{name:"iPhone SE (3rd gen)",category:"smartphone",brand:"Apple"},{name:'iPad Pro 12.9" (6th gen)',category:"tablet",brand:"Apple"},{name:'iPad Pro 11" (4th gen)',category:"tablet",brand:"Apple"},{name:"iPad Air (5th gen)",category:"tablet",brand:"Apple"},{name:"iPad (10th gen)",category:"tablet",brand:"Apple"},{name:"iPad mini (6th gen)",category:"tablet",brand:"Apple"},{name:'MacBook Pro 16" M3 Max',category:"laptop",brand:"Apple"},{name:'MacBook Pro 14" M3 Pro',category:"laptop",brand:"Apple"},{name:'MacBook Air 15" M2',category:"laptop",brand:"Apple"},{name:'MacBook Air 13" M2',category:"laptop",brand:"Apple"},{name:'iMac 24" M1',category:"desktop",brand:"Apple"},{name:"Mac Studio M2 Ultra",category:"desktop",brand:"Apple"},{name:"Apple Watch Series 9",category:"watch",brand:"Apple"},{name:"Apple Watch Ultra 2",category:"watch",brand:"Apple"},{name:"Galaxy S24 Ultra",category:"smartphone",brand:"Samsung"},{name:"Galaxy S24+",category:"smartphone",brand:"Samsung"},{name:"Galaxy S24",category:"smartphone",brand:"Samsung"},{name:"Galaxy S23 Ultra",category:"smartphone",brand:"Samsung"},{name:"Galaxy S23+",category:"smartphone",brand:"Samsung"},{name:"Galaxy S23",category:"smartphone",brand:"Samsung"},{name:"Galaxy Z Fold 5",category:"smartphone",brand:"Samsung"},{name:"Galaxy Z Flip 5",category:"smartphone",brand:"Samsung"},{name:"Galaxy Tab S9 Ultra",category:"tablet",brand:"Samsung"},{name:"Galaxy Tab S9+",category:"tablet",brand:"Samsung"},{name:"Galaxy Tab S9",category:"tablet",brand:"Samsung"},{name:"Galaxy Book4 Ultra",category:"laptop",brand:"Samsung"},{name:"Galaxy Book4 Pro 360",category:"laptop",brand:"Samsung"},{name:"Pixel 8 Pro",category:"smartphone",brand:"Google"},{name:"Pixel 8",category:"smartphone",brand:"Google"},{name:"Pixel 7a",category:"smartphone",brand:"Google"},{name:"Pixel Tablet",category:"tablet",brand:"Google"},{name:"Pixelbook Go",category:"laptop",brand:"Google"},{name:"OnePlus 12",category:"smartphone",brand:"OnePlus"},{name:"OnePlus 11",category:"smartphone",brand:"OnePlus"},{name:"OnePlus Open",category:"smartphone",brand:"OnePlus"},{name:"OnePlus Pad",category:"tablet",brand:"OnePlus"},{name:"Xiaomi 14 Pro",category:"smartphone",brand:"Xiaomi"},{name:"Xiaomi 14",category:"smartphone",brand:"Xiaomi"},{name:"Redmi Note 13 Pro",category:"smartphone",brand:"Xiaomi"},{name:"Xiaomi Pad 6",category:"tablet",brand:"Xiaomi"},{name:"Steam Deck OLED",category:"gaming",brand:"Valve"},{name:"Nintendo Switch OLED",category:"gaming",brand:"Nintendo"},{name:"PlayStation 5",category:"gaming",brand:"Sony"},{name:"Xbox Series X",category:"gaming",brand:"Microsoft"},{name:"AirPods Pro (2nd gen)",category:"audio",brand:"Apple"},{name:"AirPods Max",category:"audio",brand:"Apple"},{name:"Sony WH-1000XM5",category:"audio",brand:"Sony"},{name:"Bose QuietComfort 45",category:"audio",brand:"Bose"},{name:"Magic Keyboard",category:"accessory",brand:"Apple"},{name:"Apple Pencil (2nd gen)",category:"accessory",brand:"Apple"},{name:"Samsung S Pen",category:"accessory",brand:"Samsung"},{name:"USB-C Hub",category:"accessory",brand:"Generic"},{name:"Lightning Cable",category:"accessory",brand:"Apple"},{name:"USB-C Cable",category:"accessory",brand:"Generic"},{name:"Wireless Charger",category:"accessory",brand:"Generic"}],We=f=>{const U=f.toLowerCase();return U.includes("iphone")||U.includes("galaxy s")||U.includes("pixel")?e.jsx(kr,{className:"w-4 h-4"}):U.includes("ipad")||U.includes("galaxy tab")||U.includes("tablet")?e.jsx(_s,{className:"w-4 h-4"}):U.includes("macbook")||U.includes("galaxy book")||U.includes("laptop")?e.jsx(As,{className:"w-4 h-4"}):U.includes("imac")||U.includes("mac studio")||U.includes("desktop")?e.jsx(we,{className:"w-4 h-4"}):U.includes("watch")?e.jsx(Ds,{className:"w-4 h-4"}):U.includes("airpods")||U.includes("headphones")||U.includes("audio")?e.jsx(lt,{className:"w-4 h-4"}):U.includes("camera")?e.jsx(Xe,{className:"w-4 h-4"}):U.includes("steam deck")||U.includes("switch")||U.includes("playstation")||U.includes("xbox")?e.jsx(Is,{className:"w-4 h-4"}):e.jsx(kr,{className:"w-4 h-4"})},Nt=async f=>{if(f.length<2)return[];const U=f.toLowerCase(),Q=Ze.filter(ke=>ke.name.toLowerCase().includes(U)||ke.brand.toLowerCase().includes(U)||ke.category.toLowerCase().includes(U)).map(ke=>({name:ke.name,type:"built-in"})),re=(await it.searchDevices(f)).map(ke=>({name:ke.device_name,type:"saved"}));return[...Q,...re].filter((ke,qe,hr)=>qe===hr.findIndex(ms=>ms.name===ke.name)).slice(0,8).map(ke=>ke.name)},Ue=async f=>{if(f.trim()&&!ne.includes(f.trim())){const U=f.trim(),Q=[...ne,U];if(oe(Q),S(re=>({...re,compatibleDevices:Q.join(", ")})),Y(""),H(!1),!Ze.some(re=>re.name===U)){const re=Oe(U),je=Ke(U);await it.saveDevice(U,re,je),await nt()}else await it.incrementUsage(U)}},Oe=f=>{const U=f.toLowerCase();return U.includes("iphone")||U.includes("galaxy s")||U.includes("pixel")?"smartphone":U.includes("ipad")||U.includes("galaxy tab")||U.includes("tablet")?"tablet":U.includes("macbook")||U.includes("galaxy book")||U.includes("laptop")?"laptop":U.includes("imac")||U.includes("mac studio")||U.includes("desktop")?"desktop":U.includes("watch")?"watch":U.includes("airpods")||U.includes("headphones")||U.includes("audio")?"audio":U.includes("camera")?"camera":U.includes("steam deck")||U.includes("switch")||U.includes("playstation")||U.includes("xbox")?"gaming":"accessory"},Ke=f=>{const U=f.toLowerCase();return U.includes("iphone")||U.includes("ipad")||U.includes("macbook")||U.includes("imac")||U.includes("watch")||U.includes("airpods")?"Apple":U.includes("galaxy")||U.includes("samsung")?"Samsung":U.includes("pixel")?"Google":U.includes("oneplus")?"OnePlus":U.includes("xiaomi")||U.includes("redmi")?"Xiaomi":U.includes("steam deck")?"Valve":U.includes("switch")?"Nintendo":U.includes("playstation")?"Sony":U.includes("xbox")?"Microsoft":"Generic"},Ye=f=>{const U=ne.filter(Q=>Q!==f);oe(U),S(Q=>({...Q,compatibleDevices:U.join(", ")}))},nt=async()=>{try{jt(!0);const f=await it.loadDevices();ze(f)}catch(f){console.error("Error loading saved devices:",f),ze([])}finally{jt(!1)}},Ve=async f=>{try{await it.removeDevice(f)&&await nt()}catch(U){console.error("Error removing saved device:",U)}};G.useEffect(()=>{nt()},[]),G.useEffect(()=>{if(N.compatibleDevices){const f=N.compatibleDevices.split(",").map(U=>U.trim()).filter(Boolean);oe(f)}},[N.compatibleDevices]),G.useEffect(()=>{h(),d()},[h,d]),G.useEffect(()=>{is()},[V]),G.useEffect(()=>{(async()=>{try{m(!0),console.log(" [DEBUG] Loading store locations...");const U=await Tr.getAll();console.log(" [DEBUG] Store locations loaded:",U.length),_(U)}catch(U){console.error(" [DEBUG] Error loading store locations:",U),se.error("Failed to load store locations. Please check your connection and try again."),_([])}finally{m(!1)}})()},[]),G.useEffect(()=>{(async()=>{if(!N.storeLocationId){a([]);return}try{E(!0),a([])}catch(U){console.error("Error loading shelves:",U),se.error("Failed to load shelves"),a([])}finally{E(!1)}})()},[N.storeLocationId]),G.useEffect(()=>{or()},[]),G.useEffect(()=>{o.length>0&&ir()},[o]),G.useEffect(()=>{var f;I&&v(N.storageRoomId||((f=o[0])==null?void 0:f.id)||"")},[I,N.storageRoomId,o]),G.useEffect(()=>{var f,U;if(y){console.log(" [DEBUG] Initializing form with existing spare part:",y);const Q={name:y.name,categoryId:y.category_id,partNumber:y.part_number,brand:y.brand||"",supplierId:y.supplier_id||null,condition:y.condition||"new",description:y.description||"",costPrice:y.cost_price,sellingPrice:y.selling_price,quantity:y.quantity,minQuantity:y.min_quantity,storageRoomId:y.storage_room_id||"",shelfId:y.shelf_id||"",storeLocationId:y.storage_room_id||"",location:y.location||"",compatibleDevices:y.compatible_devices||"",images:[]};S(Q);const Z=y.variants&&y.variants.length>0,re=((f=y.metadata)==null?void 0:f.useVariants)||Z;if(console.log(" [DEBUG] Spare part variant info:",{hasVariants:Z,usesVariants:re,variantsCount:((U=y.variants)==null?void 0:U.length)||0,metadata:y.metadata}),re&&Z)q(!0),X(y.variants),O(!0),console.log(" [DEBUG] Loaded existing variants:",y.variants);else if(re&&!Z){q(!0),console.log(" [DEBUG] Creating default variant for existing spare part...");const je=St("Default",0);X([je]),O(!0),console.log(" [DEBUG] Created default variant for existing spare part:",je)}y.location&&Zr(y.location),Qe()}},[y]);const Qe=async()=>{if(y!=null&&y.id)try{const{getSparePartImages:f}=await Rs(()=>import("./index-61458a34.js").then(Q=>Q.bj),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]),U=await f(y.id);if(U&&U.length>0){const Q=U.map((Z,re)=>({id:Z.id,url:Z.image_url,thumbnailUrl:Z.thumbnail_url||Z.image_url,fileName:Z.file_name||`image-${re+1}`,fileSize:Z.file_size||0,isPrimary:Z.is_primary||!1,uploadedAt:Z.created_at||new Date().toISOString(),mimeType:Z.mime_type||"image/jpeg",image_url:Z.image_url,file_name:Z.file_name,file_size:Z.file_size,mime_type:Z.mime_type,is_primary:Z.is_primary}));S(Z=>({...Z,images:Q}))}else{const Q=y.images||[];if(Q.length>0){const Z=Q.map((re,je)=>({id:`fallback-${je}`,url:re,thumbnailUrl:re,fileName:`image-${je+1}.jpg`,fileSize:0,isPrimary:je===0,uploadedAt:new Date().toISOString(),mimeType:"image/jpeg",image_url:re,file_name:`image-${je+1}.jpg`,file_size:0,mime_type:"image/jpeg",is_primary:je===0}));S(re=>({...re,images:Z}))}else S(Z=>({...Z,images:[]}))}}catch(f){console.error("Failed to load images:",f),se.error("Failed to load images for editing"),S(U=>({...U,images:[]}))}},Zr=async f=>{},Yr=()=>{const f={};return N.name.trim()?N.name.trim().length<2&&(f.name="Name must be at least 2 characters long"):f.name="Spare part name is required",N.categoryId||(f.categoryId="Category is required"),N.partNumber.trim()?N.partNumber.trim().length<2&&(f.partNumber="Part number must be at least 2 characters long"):f.partNumber="Part number is required",V||(N.costPrice<0?f.costPrice="Cost price cannot be negative":N.costPrice===0&&(f.costPrice="Cost price must be greater than 0"),N.sellingPrice<0?f.sellingPrice="Selling price cannot be negative":N.sellingPrice===0&&(f.sellingPrice="Selling price must be greater than 0"),N.quantity<0&&(f.quantity="Stock quantity cannot be negative"),N.minQuantity<0&&(f.minQuantity="Minimum stock level cannot be negative"),N.minQuantity>N.quantity&&(f.minQuantity="Minimum stock level cannot be greater than current quantity")),V&&(P.length===0?f.variants="At least one variant is required when using variants":P.forEach((U,Q)=>{(!U.name||U.name.trim()==="")&&(f[`variant_${Q}_name`]="Variant name is required"),U.cost_price<0&&(f[`variant_${Q}_costPrice`]="Variant cost price must be 0 or greater"),U.selling_price<0&&(f[`variant_${Q}_sellingPrice`]="Variant selling price must be 0 or greater"),U.quantity<0&&(f[`variant_${Q}_quantity`]="Variant stock quantity must be 0 or greater"),U.min_quantity<0&&(f[`variant_${Q}_minQuantity`]="Variant min stock level must be 0 or greater")})),$(f),Object.keys(f).length===0},_e=(f,U)=>{S(Q=>({...Q,[f]:U})),R[f]&&$(Q=>({...Q,[f]:""}))},or=async()=>{try{console.log(" [DEBUG] Loading storage rooms...");const f=await Ur.getAll();console.log(" [DEBUG] Storage rooms loaded:",(f==null?void 0:f.length)||0),u(f||[])}catch(f){console.error(" [DEBUG] Error loading storage rooms:",f),se.error("Failed to load storage rooms. Please check your connection and try again."),u([])}},ir=async()=>{try{console.log(" [DEBUG] Loading shelves for all storage rooms...");const f={};for(const U of o){console.log(` [DEBUG] Loading shelves for room: ${U.name} (${U.id})`);const Q=await Er.getShelvesByStorageRoom(U.id);f[U.id]=Q||[],console.log(` [DEBUG] Loaded ${(Q==null?void 0:Q.length)||0} shelves for room: ${U.name}`)}console.log(" [DEBUG] All shelves loaded successfully"),L(f)}catch(f){console.error(" [DEBUG] Error loading shelves:",f),se.error("Failed to load shelves. Please check your connection and try again."),L({})}},Jr=(f,U)=>{S(Q=>({...Q,storageRoomId:f,shelfId:U})),p(!1)},es=()=>{var Q;if(!N.storageRoomId||!N.shelfId)return"Select storage location";const f=o.find(Z=>Z.id===N.storageRoomId),U=(Q=k[N.storageRoomId])==null?void 0:Q.find(Z=>Z.id===N.shelfId);return f&&U?`${f.code} - ${U.code}`:"Select storage location"},lr=()=>(k[x]||[]).sort((U,Q)=>{const Z=U.name.toLowerCase().localeCompare(Q.name.toLowerCase());return Z!==0?Z:U.id.localeCompare(Q.id)}),ts=f=>{const U=f.charAt(0).toUpperCase(),Q={A:{bg:"bg-green-500",hover:"hover:bg-green-600",border:"border-green-500",text:"text-green-600",bgLight:"bg-green-50"},B:{bg:"bg-blue-500",hover:"hover:bg-blue-600",border:"border-blue-500",text:"text-blue-600",bgLight:"bg-blue-50"},C:{bg:"bg-purple-500",hover:"hover:bg-purple-600",border:"border-purple-500",text:"text-purple-600",bgLight:"bg-purple-50"},D:{bg:"bg-orange-500",hover:"hover:bg-orange-600",border:"border-orange-500",text:"text-orange-600",bgLight:"bg-orange-50"},E:{bg:"bg-red-500",hover:"hover:bg-red-600",border:"border-red-500",text:"text-red-600",bgLight:"bg-red-50"},F:{bg:"bg-indigo-500",hover:"hover:bg-indigo-600",border:"border-indigo-500",text:"text-indigo-600",bgLight:"bg-indigo-50"},G:{bg:"bg-pink-500",hover:"hover:bg-pink-600",border:"border-pink-500",text:"text-pink-600",bgLight:"bg-pink-50"},H:{bg:"bg-yellow-500",hover:"hover:bg-yellow-600",border:"border-yellow-500",text:"text-yellow-600",bgLight:"bg-yellow-50"}};return Q[U]||Q.A},rs=f=>{const U={A:{bg:"bg-blue-500",hover:"hover:bg-blue-600",border:"border-blue-500",text:"text-blue-600",bgLight:"bg-blue-50"},B:{bg:"bg-green-500",hover:"hover:bg-green-600",border:"border-green-500",text:"text-green-600",bgLight:"bg-green-50"},C:{bg:"bg-purple-500",hover:"hover:bg-purple-600",border:"border-purple-500",text:"text-purple-600",bgLight:"bg-purple-50"},D:{bg:"bg-orange-500",hover:"hover:bg-orange-600",border:"border-orange-500",text:"text-orange-600",bgLight:"bg-orange-50"},E:{bg:"bg-red-500",hover:"hover:bg-red-600",border:"border-red-500",text:"text-red-600",bgLight:"bg-red-50"},F:{bg:"bg-teal-500",hover:"hover:bg-teal-600",border:"border-teal-500",text:"text-teal-600",bgLight:"bg-teal-50"},G:{bg:"bg-pink-500",hover:"hover:bg-pink-600",border:"border-pink-500",text:"text-pink-600",bgLight:"bg-pink-50"},H:{bg:"bg-indigo-500",hover:"hover:bg-indigo-600",border:"border-indigo-500",text:"text-indigo-600",bgLight:"bg-indigo-50"},I:{bg:"bg-emerald-500",hover:"hover:bg-emerald-600",border:"border-emerald-500",text:"text-emerald-600",bgLight:"bg-emerald-50"},J:{bg:"bg-cyan-500",hover:"hover:bg-cyan-600",border:"border-cyan-500",text:"text-cyan-600",bgLight:"bg-cyan-50"},K:{bg:"bg-lime-500",hover:"hover:bg-lime-600",border:"border-lime-500",text:"text-lime-600",bgLight:"bg-lime-50"},L:{bg:"bg-amber-500",hover:"hover:bg-amber-600",border:"border-amber-500",text:"text-amber-600",bgLight:"bg-amber-50"},M:{bg:"bg-rose-500",hover:"hover:bg-rose-600",border:"border-rose-500",text:"text-rose-600",bgLight:"bg-rose-50"},N:{bg:"bg-violet-500",hover:"hover:bg-violet-600",border:"border-violet-500",text:"text-violet-600",bgLight:"bg-violet-50"},O:{bg:"bg-sky-500",hover:"hover:bg-sky-600",border:"border-sky-500",text:"text-sky-600",bgLight:"bg-sky-50"},P:{bg:"bg-fuchsia-500",hover:"hover:bg-fuchsia-600",border:"border-fuchsia-500",text:"text-fuchsia-600",bgLight:"bg-fuchsia-50"},Q:{bg:"bg-slate-500",hover:"hover:bg-slate-600",border:"border-slate-500",text:"text-slate-600",bgLight:"bg-slate-50"},R:{bg:"bg-zinc-500",hover:"hover:bg-zinc-600",border:"border-zinc-500",text:"text-zinc-600",bgLight:"bg-zinc-50"},S:{bg:"bg-stone-500",hover:"hover:bg-stone-600",border:"border-stone-500",text:"text-stone-600",bgLight:"bg-stone-50"},T:{bg:"bg-neutral-500",hover:"hover:bg-neutral-600",border:"border-neutral-500",text:"text-neutral-600",bgLight:"bg-neutral-50"},U:{bg:"bg-blue-400",hover:"hover:bg-blue-500",border:"border-blue-400",text:"text-blue-500",bgLight:"bg-blue-25"},V:{bg:"bg-green-400",hover:"hover:bg-green-500",border:"border-green-400",text:"text-green-500",bgLight:"bg-green-25"},W:{bg:"bg-purple-400",hover:"hover:bg-purple-500",border:"border-purple-400",text:"text-purple-500",bgLight:"bg-purple-25"},X:{bg:"bg-orange-400",hover:"hover:bg-orange-500",border:"border-orange-400",text:"text-orange-500",bgLight:"bg-orange-25"},Y:{bg:"bg-red-400",hover:"hover:bg-red-500",border:"border-red-400",text:"text-red-500",bgLight:"bg-red-25"},Z:{bg:"bg-teal-400",hover:"hover:bg-teal-500",border:"border-teal-400",text:"text-teal-500",bgLight:"bg-teal-25"},0:{bg:"bg-gray-600",hover:"hover:bg-gray-700",border:"border-gray-600",text:"text-gray-600",bgLight:"bg-gray-100"},1:{bg:"bg-blue-600",hover:"hover:bg-blue-700",border:"border-blue-600",text:"text-blue-600",bgLight:"bg-blue-100"},2:{bg:"bg-green-600",hover:"hover:bg-green-700",border:"border-green-600",text:"text-green-600",bgLight:"bg-green-100"},3:{bg:"bg-purple-600",hover:"hover:bg-purple-700",border:"border-purple-600",text:"text-purple-600",bgLight:"bg-purple-100"},4:{bg:"bg-orange-600",hover:"hover:bg-orange-700",border:"border-orange-600",text:"text-orange-600",bgLight:"bg-orange-100"},5:{bg:"bg-red-600",hover:"hover:bg-red-700",border:"border-red-600",text:"text-red-600",bgLight:"bg-red-100"},6:{bg:"bg-teal-600",hover:"hover:bg-teal-700",border:"border-teal-600",text:"text-teal-600",bgLight:"bg-teal-100"},7:{bg:"bg-pink-600",hover:"hover:bg-pink-700",border:"border-pink-600",text:"text-pink-600",bgLight:"bg-pink-100"},8:{bg:"bg-indigo-600",hover:"hover:bg-indigo-700",border:"border-indigo-600",text:"text-indigo-600",bgLight:"bg-indigo-100"},9:{bg:"bg-emerald-600",hover:"hover:bg-emerald-700",border:"border-emerald-600",text:"text-emerald-600",bgLight:"bg-emerald-100"}};return f?U[f.toUpperCase()]||{bg:"bg-gray-500",hover:"hover:bg-gray-600",border:"border-gray-500",text:"text-gray-600",bgLight:"bg-gray-50"}:{bg:"bg-gray-500",hover:"hover:bg-gray-600",border:"border-gray-500",text:"text-gray-600",bgLight:"bg-gray-50"}},wt=()=>{let f=lr();return l&&(f=f.filter(U=>U.code.toLowerCase().includes(l.toLowerCase())||U.name&&U.name.toLowerCase().includes(l.toLowerCase()))),B&&(f=f.filter(U=>U.code.toUpperCase().includes(B))),f},ss=()=>{const f=lr(),U=new Set;return f.forEach(Q=>{const Z=Q.code.toUpperCase();for(let re=0;re<Z.length;re++){const je=Z[re];if(je>="A"&&je<="Z"){U.add(je);break}}}),Array.from(U).sort()},as=async f=>{if(f.preventDefault(),!Yr()){se.error("Please fix the errors before submitting");return}T(!0);try{const U={...N,id:y==null?void 0:y.id,createdBy:i==null?void 0:i.id,updatedBy:i==null?void 0:i.id,useVariants:V,variants:V?P:[]};await w(U)}catch(U){console.error("Error saving spare part:",U),se.error(U.message||"Failed to save spare part")}finally{T(!1)}},ns=()=>{const f=JSON.stringify({type:"spare-part",id:(y==null?void 0:y.id)||ue,name:N.name,partNumber:N.partNumber});Se(`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(f)}`),he(!0)},St=(f,U=0)=>{const Q=f||(U===0?"Default":`Variant ${U+1}`),Z=U===0?"DEFAULT":`V${String(U+1).padStart(2,"0")}`;return{name:Q,sku:`${N.partNumber}-${Z}`,cost_price:N.costPrice||0,selling_price:N.sellingPrice||0,quantity:N.quantity||0,min_quantity:N.minQuantity||0,attributes:{},image_url:N.images&&N.images.length>0?N.images[0].image_url||N.images[0].url:void 0}},os=f=>{if(console.log(" [DEBUG] Toggling variants:",{enabled:f,currentVariantsCount:P.length}),q(f),f)if(P.length===0){console.log(" [DEBUG] Creating default variant from form data...");const U=St("Default",0);console.log(" [DEBUG] Created default variant:",U),X([U]),O(!0),se.success("Default variant created from main product data")}else O(!0),console.log(" [DEBUG] Variants already exist, showing variants section");else console.log(" [DEBUG] Disabling variants, clearing variant data"),X([]),O(!1),se("Variants disabled - using main product data")};G.useEffect(()=>{var f;if(V&&P.length>0){console.log(" [DEBUG] Updating first variant with form data changes...");const U=St(((f=P[0])==null?void 0:f.name)||"Default",0);X(Q=>Q.map((Z,re)=>{if(re===0){const je={...Z,...U,name:Z.name||U.name,attributes:Z.attributes||{}};return console.log(" [DEBUG] Updated first variant:",je),je}return Z}))}},[N.costPrice,N.sellingPrice,N.quantity,N.minQuantity,N.partNumber,V]);const is=()=>{if(V&&P.length===0){console.log(" [DEBUG] Ensuring default variant exists...");const f=St("Default",0);X([f]),O(!0),console.log(" [DEBUG] Default variant ensured:",f)}},ls=(f,U,Q="")=>{const re={...P[f].attributes,[U]:Q};zt(f,"attributes",re)},kt=(f,U,Q)=>{const re={...P[f].attributes,[U]:Q};zt(f,"attributes",re)},cr=f=>{if(ie.trim()){const U=ie.trim().toLowerCase().replace(/\s+/g,"_");ls(f,U),J(null),le("")}},cs=()=>{J(null),le("")},zt=(f,U,Q)=>{X(Z=>Z.map((re,je)=>je===f?{...re,[U]:Q}:re))},ds=(f,U)=>{const Z={...P[f].attributes};delete Z[U],zt(f,"attributes",Z)},us=f=>{ae(f),be(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"w-full max-w-3xl max-h-[85vh] overflow-y-auto",children:e.jsxs(Re,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:y?"Edit Part":"Add Part"})]}),e.jsx("button",{onClick:c,className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:e.jsx($e,{className:"w-4 h-4"})})]}),e.jsxs("form",{onSubmit:as,className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ce,{size:16,className:"text-blue-600"}),"Basic Info"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"spare-part-name",className:`block mb-1 font-medium text-sm ${R.name?"text-red-600":"text-gray-700"}`,children:"Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"spare-part-name",type:"text",className:`w-full py-2 pl-10 pr-3 bg-white/30 backdrop-blur-md border-2 rounded focus:outline-none transition-colors text-sm ${R.name?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"}`,placeholder:"e.g., iPhone 14 Screen",value:N.name,onChange:f=>_e("name",f.target.value),required:!0}),e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:14})]}),R.name&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:R.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"part-number",className:`block mb-1 font-medium text-sm ${R.partNumber?"text-red-600":"text-gray-700"}`,children:"Part Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"part-number",type:"text",className:`w-full py-2 pl-10 pr-3 bg-white/30 backdrop-blur-md border-2 rounded focus:outline-none transition-colors text-sm ${R.partNumber?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"}`,placeholder:"e.g., IP14-SCR-001",value:N.partNumber,onChange:f=>_e("partNumber",f.target.value),required:!0}),e.jsx(Mr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:14})]}),R.partNumber&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:R.partNumber})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:`block mb-1 font-medium text-sm ${R.categoryId?"text-red-600":"text-gray-700"}`,children:"Category *"}),e.jsx($r,{value:N.categoryId,onChange:f=>_e("categoryId",f),placeholder:"Select category",categories:t,required:!0,error:R.categoryId,className:"w-full"}),R.categoryId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:R.categoryId})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"supplier",className:"block mb-2 font-medium text-gray-700",children:"Supplier"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:"supplier",className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-colors",value:N.supplierId,onChange:f=>_e("supplierId",f.target.value),children:[e.jsx("option",{value:"",children:"Select Supplier"}),r.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]}),e.jsx("svg",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",width:"18",height:"18",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"condition",className:"block mb-2 font-medium text-gray-700",children:"Condition"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"new",label:"New",color:"bg-green-500 hover:bg-green-600 border-green-500"},{value:"used",label:"Used",color:"bg-blue-500 hover:bg-blue-600 border-blue-500"},{value:"refurbished",label:"Refurbished",color:"bg-purple-500 hover:bg-purple-600 border-purple-500"}].map(f=>e.jsx("button",{type:"button",onClick:()=>_e("condition",f.value),className:`py-3 px-4 rounded-lg border-2 transition-all duration-200 font-medium ${N.condition===f.value?`${f.color} text-white`:"bg-gray-100 hover:bg-gray-200 border-gray-300 text-gray-700"}`,children:f.label},f.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"brand",className:"block mb-2 font-medium text-gray-700",children:"Brand"}),e.jsx(Js,{value:N.brand,onChange:f=>_e("brand",f),placeholder:"e.g., Apple, Samsung",className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block mb-2 text-sm font-medium text-gray-700",children:"Description (optional)"}),e.jsxs("div",{className:"relative",children:[b?e.jsx("textarea",{id:"description",value:N.description,onChange:f=>_e("description",f.target.value),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-all duration-200 resize-none",placeholder:"Describe the spare part, its specifications, and any important details...",maxLength:500,rows:4,onBlur:()=>F(!1),autoFocus:!0}):e.jsx("input",{id:"description",type:"text",value:N.description,onChange:f=>_e("description",f.target.value),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-all duration-200",placeholder:"Brief description...",maxLength:200,onFocus:()=>F(!0)}),e.jsx(Pr,{className:`absolute left-3 text-gray-500 transition-all duration-200 ${b?"top-4":"top-1/2 -translate-y-1/2"}`,size:16})]}),b&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[N.description.length,"/500 characters"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"compatible-devices",className:"block mb-2 font-medium text-gray-700",children:["Compatible Devices",e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",ne.length," selected)"]})]}),ne.length>0&&e.jsx("div",{className:"mb-3 flex flex-wrap gap-2",children:ne.map((f,U)=>e.jsxs("div",{className:"inline-flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-800 rounded-full text-sm font-medium border border-blue-200",children:[We(f),e.jsx("span",{className:"max-w-[200px] truncate",children:f}),e.jsx("button",{type:"button",onClick:()=>Ye(f),className:"ml-1 p-0.5 hover:bg-blue-200 rounded-full transition-colors",children:e.jsx(Xt,{className:"w-3 h-3"})})]},U))}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"compatible-devices",className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Type device name (e.g., iPhone 15, Galaxy S24, MacBook Pro)...",value:ee,onChange:async f=>{const U=f.target.value;if(Y(U),U.length>=2){const Q=await Nt(U);Te(Q),H(Q.length>0)}else H(!1),Te([])},onKeyDown:f=>{f.key==="Enter"&&(f.preventDefault(),ee.trim()&&Ue(ee.trim())),f.key==="Escape"&&H(!1)},onFocus:async()=>{if(ee.length>=2){const f=await Nt(ee);Te(f),H(f.length>0)}},onBlur:()=>{setTimeout(()=>H(!1),200)}}),e.jsx(Mt,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 w-4 h-4"}),D&&Ie.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",children:Ie.map((f,U)=>{const Q=Ze.some(Le=>Le.name===f),Z=Ne.find(Le=>Le.device_name===f),re=!!Z,je=Ze.find(Le=>Le.name===f);return e.jsxs("button",{type:"button",className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3 border-b border-gray-100 last:border-b-0 transition-colors",onClick:()=>Ue(f),children:[e.jsx("div",{className:"text-gray-500",children:We(f)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[f,re&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full",children:["Saved (",(Z==null?void 0:Z.usage_count)||0,"x)"]}),Q&&!re&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full",children:"Built-in"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:je?`${je.brand}  ${je.category}`:Z?`${Z.device_brand||"Generic"}  ${Z.device_category||"Device"}`:"Custom device"})]}),re&&e.jsx("button",{type:"button",onClick:Le=>{Le.stopPropagation(),Ve(f)},className:"p-1 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-colors",title:"Remove from saved devices",children:e.jsx(Xt,{className:"w-4 h-4"})})]},U)})})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsx("span",{children:" Start typing to see device suggestions"}),e.jsx("span",{children:" Press Enter to add custom device"}),e.jsx("span",{children:" Click suggestions to add quickly"}),e.jsx("span",{children:" Custom devices are saved automatically"})]})}),Ne.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-xs font-medium text-green-700 flex items-center gap-1",children:[e.jsx("span",{children:""}),"Your saved devices (",Ne.length,")",e.jsxs("span",{className:"text-xs text-green-600 ml-2",children:["(",it.getStorageMode(),")"]})]}),e.jsx("button",{type:"button",onClick:async()=>{const f=Ne.slice(-3);for(const U of f)await Ue(U.device_name)},className:"text-xs text-green-600 hover:text-green-800 font-medium",children:"Add recent"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[Ne.sort((f,U)=>new Date(U.last_used).getTime()-new Date(f.last_used).getTime()).slice(0,5).map(f=>e.jsxs("button",{type:"button",onClick:()=>Ue(f.device_name),disabled:ne.includes(f.device_name),className:"px-2 py-1 text-xs bg-green-100 hover:bg-green-200 disabled:bg-gray-50 disabled:text-gray-400 text-green-700 rounded-full border border-green-200 transition-colors",children:["+ ",f.device_name,f.usage_count>1&&e.jsxs("span",{className:"ml-1 text-green-600",children:["(",f.usage_count,"x)"]})]},f.device_name)),Ne.length>5&&e.jsxs("span",{className:"text-xs text-green-600 px-2 py-1",children:["+",Ne.length-5," more..."]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"Popular devices:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:["iPhone 15 Pro","iPhone 14","Galaxy S24","MacBook Pro","iPad Air"].map(f=>e.jsxs("button",{type:"button",onClick:()=>Ue(f),disabled:ne.includes(f),className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-full border border-gray-200 transition-colors",children:["+ ",f]},f))})]})]})]}),!V&&e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(yt,{size:18,className:"text-green-600"}),"Pricing & Stock"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:"Cost Price *"}),e.jsx(Pt,{value:N.costPrice,onChange:f=>_e("costPrice",f),placeholder:"0.00",className:`w-full ${R.costPrice?"border-red-500":""}`,required:!0,error:R.costPrice})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:"Selling Price *"}),e.jsx(Pt,{value:N.sellingPrice,onChange:f=>_e("sellingPrice",f),placeholder:"0.00",className:`w-full ${R.sellingPrice?"border-red-500":""}`,required:!0,error:R.sellingPrice})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stock-quantity",className:`block mb-2 text-sm font-medium ${R.quantity?"text-red-600":"text-gray-700"}`,children:"Stock Quantity *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:N.quantity===0?"":N.quantity||"",onChange:f=>_e("quantity",Math.max(0,parseInt(f.target.value)||0)),onFocus:f=>{N.quantity===0&&(f.target.value="")},className:"w-full py-3 px-20 bg-white/30 backdrop-blur-md border-2 rounded-lg text-center text-lg font-semibold text-gray-900 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"0",min:"0",step:"1"}),e.jsx("button",{type:"button",onClick:()=>_e("quantity",Math.max(0,(N.quantity||0)-1)),className:"absolute left-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Decrease stock quantity",children:""}),e.jsx("div",{className:"absolute right-1 top-1/2 -translate-y-1/2",children:e.jsx("button",{type:"button",onClick:()=>_e("quantity",(N.quantity||0)+1),className:"w-10 h-10 sm:w-12 sm:h-12 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Increase stock quantity",children:"+"})})]}),R.quantity&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:R.quantity})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"min-stock-level",className:`block mb-2 text-sm font-medium ${R.minQuantity?"text-red-600":"text-gray-700"}`,children:"Min Stock Level *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:N.minQuantity===0?"":N.minQuantity||"",onChange:f=>_e("minQuantity",Math.max(0,parseInt(f.target.value)||0)),onFocus:f=>{N.minQuantity===0&&(f.target.value="")},className:"w-full py-3 px-20 bg-white/30 backdrop-blur-md border-2 rounded-lg text-center text-lg font-semibold text-gray-900 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"2",min:"0",step:"1"}),e.jsx("button",{type:"button",onClick:()=>_e("minQuantity",Math.max(0,(N.minQuantity||0)-1)),className:"absolute left-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Decrease minimum stock level",children:""}),e.jsx("div",{className:"absolute right-1 top-1/2 -translate-y-1/2",children:e.jsx("button",{type:"button",onClick:()=>_e("minQuantity",(N.minQuantity||0)+1),className:"w-10 h-10 sm:w-12 sm:h-12 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Increase minimum stock level",children:"+"})})]}),R.minQuantity&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:R.minQuantity})]})]}),N.sellingPrice>0&&N.costPrice>0&&e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Profit Margin:"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["TZS ",He.number(N.sellingPrice-N.costPrice),"(",((N.sellingPrice-N.costPrice)/N.sellingPrice*100).toFixed(1),"%)"]})]})})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(pt,{size:18,className:"text-blue-600"}),"Storage Location"]}),o.length===0&&!s&&e.jsx("div",{className:"mb-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3 text-amber-800",children:[e.jsx(Ce,{size:24,className:"text-amber-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"No Storage Data Available"}),e.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:["You need to create storage rooms and shelves before adding spare parts. Go to ",e.jsx("strong",{children:"Settings  Storage Management"})," to set up your storage infrastructure."]})]}),e.jsx("button",{type:"button",onClick:()=>{or(),ir()},className:"px-3 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors text-sm font-medium",children:"Retry"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Storage Location (optional)"}),e.jsxs("button",{type:"button",onClick:async()=>{try{const f=await ut();f&&S(U=>{var Q;return{...U,storeLocationId:((Q=f.room)==null?void 0:Q.store_location_id)||U.storeLocationId,shelfId:f.shelfId,location:f.label}})}catch(f){console.error("Error opening storage location picker:",f)}},disabled:s||o.length===0,className:`w-full py-4 pl-12 pr-4 bg-gradient-to-r from-white/50 to-white/30 backdrop-blur-md border-2 rounded-xl focus:outline-none transition-all duration-300 text-left shadow-sm hover:shadow-md ${R.storeLocationId||R.shelfId?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500 hover:border-blue-400"} ${s||o.length===0?"opacity-50 cursor-not-allowed":"hover:scale-[1.02]"}`,children:[e.jsx(pt,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20}),e.jsx("span",{className:`text-base ${N.storageRoomId&&N.shelfId?"text-gray-900 font-semibold":"text-gray-500"}`,children:es()}),N.storageRoomId&&N.shelfId&&e.jsx(dt,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-green-500",size:20})]}),(R.storeLocationId||R.shelfId)&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-red-500 rounded-full"}),R.storeLocationId||R.shelfId]})]})]}),e.jsx(Hs,{variants:P,setVariants:X,useVariants:V,setUseVariants:os,showVariants:W,setShowVariants:O,isReorderingVariants:te,setIsReorderingVariants:pe,draggedVariantIndex:me,setDraggedVariantIndex:de,onVariantSpecificationsClick:us,basePartNumber:N.partNumber,mainProductImages:N.images}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"w-6 h-6 bg-pink-100 rounded-lg flex items-center justify-center",children:e.jsx(Fr,{className:"w-3 h-3 text-pink-600","aria-hidden":"true"})}),e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Spare Part Images"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(nr,{productId:ue,userId:(i==null?void 0:i.id)||"",existingImages:N.images,onImagesChange:f=>{console.log(" [SparePartForm] SimpleImageUpload onImagesChange called with:",f);const U=f.map(Q=>({id:Q.id,image_url:Q.url,thumbnail_url:Q.thumbnailUrl||Q.url,file_name:Q.fileName,file_size:Q.fileSize,is_primary:Q.isPrimary,uploaded_by:Q.uploadedAt,created_at:Q.uploadedAt}));console.log(" [SparePartForm] Setting form data with images:",U),S(Q=>({...Q,images:U})),f.length>0&&se.success(`${f.length} image${f.length>1?"s":""} uploaded successfully!`)},maxFiles:5})})]}),ve&&ye&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(QrCode,{className:"w-5 h-5 text-blue-600"}),"QR Code Preview"]}),e.jsx(Pe,{type:"button",onClick:()=>he(!1),variant:"outline",size:"sm",children:e.jsx($e,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:ye,alt:"QR Code",className:"border border-gray-300 rounded-lg shadow-sm"}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Part Number: ",N.partNumber]}),e.jsxs(Pe,{type:"button",onClick:ns,className:"mt-3 flex items-center gap-2",children:[e.jsx(Download,{className:"w-4 h-4"}),"Download QR Code"]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:c,disabled:A,children:"Cancel"}),e.jsx("button",{type:"submit",className:`px-6 py-3 rounded-lg font-semibold transition-all duration-200 ${A?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 shadow-lg"}`,disabled:A,children:A?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4"}),y?"Update":"Create"]})})]})]})]})})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[95vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(pt,{size:28,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Select Storage Location"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Choose a storage room and shelf for your spare part"})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"p-3 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx($e,{size:24,className:"text-gray-500"})})]}),e.jsx("div",{className:"border-b border-gray-100 bg-white",children:e.jsx("div",{className:"flex overflow-x-auto px-6 py-4 gap-2",children:o.map(f=>{const U=ts(f.code);return e.jsx("button",{onClick:()=>v(f.id),className:`flex-shrink-0 px-6 py-3 rounded-xl font-medium transition-all duration-300 ${x===f.id?`${U.text} ${U.bgLight} border-2 ${U.border} shadow-md`:"text-gray-600 hover:text-gray-900 hover:bg-gray-50 border-2 border-transparent"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${x===f.id?U.bg:"bg-gray-100"}`,children:e.jsx(Rr,{size:16,className:x===f.id?"text-white":"text-gray-500"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:f.name}),e.jsx("div",{className:"text-xs opacity-75",children:f.code})]})]})},f.id)})})}),e.jsx("div",{className:"p-6 border-b border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search shelves...",value:l,onChange:f=>g(f.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto",children:[e.jsx("button",{onClick:()=>M(""),className:`px-4 py-2 rounded-lg font-medium transition-colors ${B===""?"bg-blue-500 text-white":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),ss().map(f=>e.jsx("button",{onClick:()=>M(B===f?"":f),className:`px-4 py-2 rounded-lg font-medium transition-colors ${B===f?"bg-blue-500 text-white":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:f},f))]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:wt().length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:wt().map((f,U)=>{var ke;const Q=N.storageRoomId===x&&N.shelfId===f.id,Z=rs(f.code.charAt(0).toUpperCase()),re=(ke=f.code.toUpperCase().match(/[A-Z]/))==null?void 0:ke[0],Le=re?(qe=>({A:"bg-gradient-to-br from-blue-400 to-blue-500",B:"bg-gradient-to-br from-green-400 to-green-500",C:"bg-gradient-to-br from-purple-400 to-purple-500",D:"bg-gradient-to-br from-orange-400 to-orange-500",E:"bg-gradient-to-br from-red-400 to-red-500",F:"bg-gradient-to-br from-teal-400 to-teal-500",G:"bg-gradient-to-br from-pink-400 to-pink-500",H:"bg-gradient-to-br from-indigo-400 to-indigo-500",I:"bg-gradient-to-br from-emerald-400 to-emerald-500",J:"bg-gradient-to-br from-cyan-400 to-cyan-500",K:"bg-gradient-to-br from-lime-400 to-lime-500",L:"bg-gradient-to-br from-amber-400 to-amber-500",M:"bg-gradient-to-br from-rose-400 to-rose-500",N:"bg-gradient-to-br from-violet-400 to-violet-500",O:"bg-gradient-to-br from-sky-400 to-sky-500",P:"bg-gradient-to-br from-fuchsia-400 to-fuchsia-500",Q:"bg-gradient-to-br from-slate-400 to-slate-500",R:"bg-gradient-to-br from-zinc-400 to-zinc-500",S:"bg-gradient-to-br from-stone-400 to-stone-500",T:"bg-gradient-to-br from-neutral-400 to-neutral-500",U:"bg-gradient-to-br from-yellow-400 to-yellow-500",V:"bg-gradient-to-br from-orange-500 to-orange-600",W:"bg-gradient-to-br from-red-500 to-red-600",X:"bg-gradient-to-br from-pink-500 to-pink-600",Y:"bg-gradient-to-br from-purple-500 to-purple-600",Z:"bg-gradient-to-br from-indigo-500 to-indigo-600",0:"bg-gradient-to-br from-gray-300 to-gray-400",1:"bg-gradient-to-br from-blue-600 to-blue-700",2:"bg-gradient-to-br from-green-600 to-green-700",3:"bg-gradient-to-br from-teal-600 to-teal-700",4:"bg-gradient-to-br from-cyan-600 to-cyan-700",5:"bg-gradient-to-br from-lime-600 to-lime-700",6:"bg-gradient-to-br from-amber-600 to-amber-700",7:"bg-gradient-to-br from-emerald-600 to-emerald-700",8:"bg-gradient-to-br from-rose-600 to-rose-700",9:"bg-gradient-to-br from-violet-600 to-violet-700"})[qe]||"bg-gradient-to-br from-gray-200 to-gray-300")(re):"bg-gradient-to-br from-gray-50 to-gray-100/50";return e.jsx("button",{onClick:()=>Jr(x,f.id),className:`group relative overflow-hidden transition-all duration-500 text-left ${Q?"transform scale-105 shadow-2xl":"hover:transform hover:scale-102 hover:shadow-xl"}`,children:e.jsxs("div",{className:`relative h-32 rounded-3xl border-2 transition-all duration-500 ${Q?`${Z.border} ${Z.bgLight}`:`border-gray-200 ${Le} hover:border-gray-300`}`,children:[e.jsxs("div",{className:`absolute inset-0 opacity-10 transition-opacity duration-500 ${Q?"opacity-20":"group-hover:opacity-15"}`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${Z.bg} rounded-3xl`}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(255,255,255,0.3),transparent_50%)]"})]}),e.jsxs("div",{className:"relative h-full flex items-center justify-between p-6",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-5xl font-black tracking-tight transition-all duration-500 text-white",children:f.code}),e.jsx("div",{className:`text-base font-medium transition-all duration-500 ${Q?"text-white opacity-90":"text-white opacity-80"}`,children:"Storage Shelf"})]})}),re&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center text-2xl font-black transition-all duration-500 border-2 ${Q?`${Le} text-white shadow-xl border-white/90`:`${Le} text-white shadow-md border-white/80`}`,children:re}),Q&&e.jsx("div",{className:`absolute inset-0 rounded-2xl ${Z.bg} opacity-30 blur-md`})]})]}),Q&&e.jsx("div",{className:`absolute -top-2 -right-2 w-8 h-8 rounded-full ${Z.bg} flex items-center justify-center shadow-lg animate-pulse`,children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("div",{className:`absolute inset-0 rounded-3xl border-2 border-transparent transition-all duration-500 ${Q?`${Z.border} opacity-100`:"group-hover:border-gray-300 opacity-0 group-hover:opacity-100"}`})]})},f.id)})}):e.jsxs("div",{className:"text-center py-16",children:[e.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-2 bg-white rounded-full flex items-center justify-center",children:e.jsx(Cs,{size:36,className:"text-gray-400"})})]}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"No Shelves Found"}),e.jsx("p",{className:"text-gray-600 max-w-lg mx-auto leading-relaxed",children:l||B?"Try adjusting your search or filter criteria to discover available shelves.":"No shelves are currently available in this storage room."})]})}),e.jsxs("div",{className:"flex justify-between items-center p-6 border-t border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[wt().length," shelf",wt().length!==1?"es":""," found"]}),e.jsx("button",{onClick:()=>p(!1),className:"px-6 py-2 text-gray-600 hover:text-gray-800 transition-colors font-medium",children:"Cancel"})]})]})}),xe&&z!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50 p-2",role:"dialog","aria-modal":"true","aria-labelledby":"variant-specifications-modal-title",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-4xl w-full max-h-[85vh] overflow-hidden mx-auto",children:[e.jsx("div",{className:"bg-blue-600 p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("h2",{id:"variant-specifications-modal-title",className:"text-lg font-semibold",children:"Variant Specs"}),e.jsx("p",{className:"text-blue-100 text-xs",children:((dr=P[z])==null?void 0:dr.name)||`Variant ${z+1}`})]})]}),e.jsx("button",{onClick:()=>be(!1),className:"p-1 hover:bg-white/20 rounded transition-colors","aria-label":"Close modal",children:e.jsx($e,{size:18})})]})}),e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-4 py-2",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto",children:tr.map(f=>{const U=f.icon,Q=ce===f.id;return e.jsxs("button",{onClick:()=>ge(f.id),className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${Q?`bg-${f.color}-500 text-white`:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-100"}`,children:[e.jsx(U,{size:14}),f.name]},f.id)})})}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(85vh-140px)]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(st,{size:16,className:"text-blue-600"}),(ur=tr.find(f=>f.id===ce))==null?void 0:ur.name]}),Object.entries(Ks(ce)).map(([f,U])=>U.length===0?null:e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-xs font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:Xs(f)}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",U.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:U.map(Q=>{var Le,ke;const Z=Q.icon,re=((ke=(Le=P[z])==null?void 0:Le.attributes)==null?void 0:ke[Q.key])||"",je=Q.type==="boolean";return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(Z,{size:12,className:"text-gray-500"}),Q.name,Q.unit&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",Q.unit,")"]})]}),je?e.jsx("button",{type:"button",onClick:()=>kt(z,Q.key,!re),className:`w-full p-2 border rounded-lg transition-colors ${re?"bg-green-50 border-green-300 text-green-800":"bg-white border-gray-300 text-gray-600 hover:border-blue-500 hover:bg-blue-50"}`,children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(dt,{size:14,className:re?"text-green-600":"text-gray-400"})})}):Q.type==="select"&&Q.options?e.jsxs("select",{value:re,onChange:qe=>kt(z,Q.key,qe.target.value),className:"w-full py-1.5 px-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",children:[e.jsx("option",{value:"",children:"Select"}),Q.options.map(qe=>e.jsx("option",{value:qe,children:qe},qe))]}):e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:Q.type==="number"?"number":"text",value:re,onChange:qe=>kt(z,Q.key,qe.target.value),placeholder:Q.placeholder||`Enter ${Q.name.toLowerCase()}`,className:"w-full py-1.5 px-2 pr-6 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),re&&e.jsx("button",{type:"button",onClick:()=>kt(z,Q.key,""),className:"absolute right-1 top-1.5 text-red-500 hover:text-red-700",title:"Clear value",children:e.jsx($e,{size:12})})]})]},Q.key)})})]},f))]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(st,{size:16,className:"text-gray-600"}),"Custom"]}),K===z?e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:ie,onChange:f=>le(f.target.value),placeholder:"Enter custom spec name...",className:"flex-1 py-1.5 px-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",onKeyPress:f=>{f.key==="Enter"&&ie.trim()&&cr(z)},autoFocus:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx("button",{type:"button",onClick:()=>cr(z),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium",children:"Add"}),e.jsx("button",{type:"button",onClick:cs,className:"px-3 py-1.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-xs font-medium",children:"Cancel"})]})}):e.jsxs("button",{type:"button",onClick:()=>{J(z),le("")},className:"flex items-center gap-2 p-2 bg-white border border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors w-full",children:[e.jsx(st,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Add Custom"})]})]}),((mr=P[z])==null?void 0:mr.attributes)&&Object.keys(P[z].attributes).length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(dt,{size:16,className:"text-green-600"}),"Current",e.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs font-medium",children:Object.keys(P[z].attributes).length})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:Object.entries(P[z].attributes).map(([f,U])=>e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-green-800 capitalize truncate",children:f.replace(/_/g," ")}),e.jsx("div",{className:"text-xs text-green-600 truncate",children:String(U)||"Not set"})]}),e.jsx("button",{type:"button",onClick:()=>ds(z,f),className:"ml-1 text-red-500 hover:text-red-700 flex-shrink-0",title:"Remove specification",children:e.jsx($e,{size:12})})]})},f))})]})]})}),e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-gray-600",children:(gr=P[z])!=null&&gr.attributes&&Object.keys(P[z].attributes).length>0?`${Object.keys(P[z].attributes).length} spec${Object.keys(P[z].attributes).length!==1?"s":""} added`:"No specs added yet"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>be(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors text-xs font-medium",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>{be(!1),se.success("Variant specifications saved successfully!")},className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium",children:"Save"})]})]})})]})})]})},sa=({sparePart:y,onSave:w,onCancel:c})=>{const{categories:i,suppliers:t,loadSparePartCategories:r,loadSuppliers:h}=rr(),[d,C]=G.useState(1),[_,n]=G.useState(!1),[a,s]=G.useState({name:(y==null?void 0:y.name)||"",partNumber:(y==null?void 0:y.part_number)||"",categoryId:(y==null?void 0:y.category_id)||null,brand:(y==null?void 0:y.brand)||"",description:(y==null?void 0:y.description)||"",costPrice:(y==null?void 0:y.cost_price)||0,sellingPrice:(y==null?void 0:y.selling_price)||0,quantity:(y==null?void 0:y.quantity)||0,minQuantity:(y==null?void 0:y.min_quantity)||0,location:(y==null?void 0:y.location)||"",supplierId:(y==null?void 0:y.supplier_id)||null,images:(y==null?void 0:y.images)||[],condition:(y==null?void 0:y.condition)||"new"}),[m,j]=G.useState({}),E=[{id:1,title:"Basic Info",icon:Ce,description:"Name, category, and description"},{id:2,title:"Pricing & Stock",icon:yt,description:"Cost, price, and inventory"},{id:3,title:"Location & Images",icon:pt,description:"Storage location and photos"}],N=b=>{const F={};switch(b){case 1:a.name.trim()||(F.name="Name is required"),a.categoryId||(F.categoryId="Category is required");break;case 2:a.costPrice<0&&(F.costPrice="Cost price cannot be negative"),a.sellingPrice<0&&(F.sellingPrice="Selling price cannot be negative"),a.quantity<0&&(F.quantity="Quantity cannot be negative"),a.minQuantity<0&&(F.minQuantity="Minimum quantity cannot be negative");break}return j(F),Object.keys(F).length===0},S=()=>{N(d)&&C(b=>Math.min(b+1,E.length))},R=()=>{C(b=>Math.max(b-1,1))},$=async()=>{if(N(d)){n(!0);try{await w(a)}catch(b){console.error("Error saving spare part:",b),se.error("Failed to save spare part")}finally{n(!1)}}},A=(b,F)=>{s(o=>({...o,[b]:F})),m[b]&&j(o=>({...o,[b]:""}))},T=()=>{switch(d){case 1:return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Part Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:b=>A("name",b.target.value),className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent ${m.name?"border-red-500":"border-gray-300"}`,placeholder:"Enter part name"}),m.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Part Number"}),e.jsx("input",{type:"text",value:a.partNumber,onChange:b=>A("partNumber",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter part number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),e.jsx($r,{value:a.categoryId,onChange:b=>A("categoryId",b),categories:i,error:m.categoryId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand"}),e.jsx("input",{type:"text",value:a.brand,onChange:b=>A("brand",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter brand name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:b=>A("description",b.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter part description"})]})]});case 2:return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Price"}),e.jsx(Pt,{value:a.costPrice,onChange:b=>A("costPrice",b),placeholder:"0.00",error:m.costPrice})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selling Price"}),e.jsx(Pt,{value:a.sellingPrice,onChange:b=>A("sellingPrice",b),placeholder:"0.00",error:m.sellingPrice})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Quantity"}),e.jsx("input",{type:"number",min:"0",value:a.quantity,onChange:b=>A("quantity",parseInt(b.target.value)||0),className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent ${m.quantity?"border-red-500":"border-gray-300"}`}),m.quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.quantity})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Quantity"}),e.jsx("input",{type:"number",min:"0",value:a.minQuantity,onChange:b=>A("minQuantity",parseInt(b.target.value)||0),className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent ${m.minQuantity?"border-red-500":"border-gray-300"}`}),m.minQuantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.minQuantity})]})]})]});case 3:return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Storage Location"}),e.jsx("input",{type:"text",value:a.location,onChange:b=>A("location",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Shelf A1, Room 2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier"}),e.jsxs("select",{value:a.supplierId||"",onChange:b=>A("supplierId",b.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select supplier"}),t.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Condition"}),e.jsxs("select",{value:a.condition,onChange:b=>A("condition",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"used",children:"Used"}),e.jsx("option",{value:"refurbished",children:"Refurbished"}),e.jsx("option",{value:"damaged",children:"Damaged"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Images"}),e.jsx(nr,{images:a.images,onImagesChange:b=>A("images",b),maxImages:5,className:"w-full"})]})]});default:return null}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(Re,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:y?"Edit Spare Part":"Add New Spare Part"}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-600",children:e.jsx($e,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:E.map((b,F)=>{const o=b.icon,u=d===b.id,k=d>b.id;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${u?"border-blue-500 bg-blue-500 text-white":k?"border-green-500 bg-green-500 text-white":"border-gray-300 bg-white text-gray-400"}`,children:k?e.jsx(dt,{className:"w-5 h-5"}):e.jsx(o,{className:"w-5 h-5"})}),F<E.length-1&&e.jsx("div",{className:`w-16 h-0.5 mx-2 ${k?"bg-green-500":"bg-gray-300"}`})]},b.id)})}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Step ",d," of ",E.length,": ",E[d-1].title]}),e.jsx("p",{className:"text-xs text-gray-500",children:E[d-1].description})]})]}),e.jsx("div",{className:"mb-6",children:T()}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(Pe,{onClick:R,disabled:d===1,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"w-4 h-4"}),"Previous"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Pe,{onClick:c,variant:"outline",children:"Cancel"}),d<E.length?e.jsxs(Pe,{onClick:S,className:"flex items-center gap-2",children:["Next",e.jsx(Us,{className:"w-4 h-4"})]}):e.jsx(Pe,{onClick:$,disabled:_,className:"flex items-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-4 h-4"}),y?"Update Part":"Create Part"]})})]})]})]})})})},aa=({sparePart:y,onUse:w,onCancel:c})=>{Lr();const[i,t]=G.useState(1),[r,h]=G.useState(""),[d,C]=G.useState(""),[_,n]=G.useState({}),[a,s]=G.useState(!1),m=["Device Repair","Maintenance","Customer Service","Testing","Training","Warranty Claim","Quality Control","Other"],j=()=>{const A={};return i<=0&&(A.quantity="Quantity must be greater than 0"),i>y.quantity&&(A.quantity=`Cannot use more than available quantity (${y.quantity})`),r.trim()||(A.reason="Reason is required"),n(A),Object.keys(A).length===0},E=async A=>{if(A.preventDefault(),!!j()){s(!0);try{await w(i,r,d)}catch(T){console.error("Error recording usage:",T)}finally{s(!1)}}},N=(A,T)=>{switch(A){case"quantity":t(T);break;case"reason":h(T);break;case"notes":C(T);break}_[A]&&n(b=>({...b,[A]:""}))},S=y.quantity-i,R=S<=y.min_quantity,$=S===0;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 z-50",children:e.jsx(Re,{className:"w-full max-w-sm",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5 text-red-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Use Part"})]}),e.jsx("button",{onClick:c,className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:e.jsx($e,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm",children:y.name}),e.jsx("p",{className:"text-xs text-gray-500",children:y.part_number})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Available:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:y.quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Min:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:y.min_quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Cost:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:He.currency(y.cost_price)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Price:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:He.currency(y.selling_price)})]})]})]}),e.jsxs("form",{onSubmit:E,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity to Use *"}),e.jsx("input",{type:"number",min:"1",max:y.quantity,value:i,onChange:A=>N("quantity",parseInt(A.target.value)||0),className:`w-full px-2 py-1.5 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm ${_.quantity?"border-red-300":"border-gray-300"}`,placeholder:"1"}),_.quantity&&e.jsxs("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3"}),_.quantity]}),i>0&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Remaining: ",e.jsx("span",{className:`font-medium ${$?"text-red-600":R?"text-yellow-600":"text-green-600"}`,children:S}),$&&" (Out of stock)",R&&!$&&" (Low stock)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Reason for Use *"}),e.jsxs("select",{value:r,onChange:A=>N("reason",A.target.value),className:`w-full px-2 py-1.5 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm ${_.reason?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select a reason"}),m.map(A=>e.jsx("option",{value:A,children:A},A))]}),_.reason&&e.jsxs("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3"}),_.reason]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Additional Notes"}),e.jsx("textarea",{value:d,onChange:A=>N("notes",A.target.value),rows:2,className:"w-full px-2 py-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Optional notes about this usage..."})]}),i>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2 text-sm",children:"Usage Summary"}),e.jsxs("div",{className:"space-y-1 text-xs text-blue-800",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Quantity:"}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cost Value:"}),e.jsx("span",{className:"font-medium",children:He.currency(i*y.cost_price)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Selling Value:"}),e.jsx("span",{className:"font-medium",children:He.currency(i*y.selling_price)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Remaining:"}),e.jsx("span",{className:`font-medium ${$?"text-red-600":R?"text-yellow-600":"text-green-600"}`,children:S})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3 border-t border-gray-200",children:[e.jsx(Pe,{type:"button",variant:"outline",onClick:c,disabled:a,className:"text-sm px-3 py-1.5",children:"Cancel"}),e.jsxs(Pe,{type:"submit",disabled:a||i<=0||i>y.quantity,className:"flex items-center gap-1 text-sm px-3 py-1.5",children:[e.jsx(at,{className:"w-3 h-3"}),a?"Recording...":"Record Usage"]})]})]})]})})})},na=({isOpen:y,onClose:w,sparePart:c,currency:i,onEdit:t,onDelete:r,onUse:h,onSparePartUpdated:d})=>{var te,pe,me,de,xe,be;G.useEffect(()=>{if(y&&(c!=null&&c.id)){o(0),_(),n(),c.location&&l({storeLocation:null,storageRoom:null,storeShelf:null,fallbackLocation:c.location}),C();const z=setTimeout(()=>{B(!1),console.log(" [SparePartsDetailModal] Location loading timeout reached")},1e4);return()=>clearTimeout(z)}},[y,c==null?void 0:c.id]);const C=async()=>{var z,ae;if(c!=null&&c.id)try{B(!0),console.log(" [SparePartsDetailModal] Fetching location data for spare part:",c.id);const K={storeLocation:null,storageRoom:null,storeShelf:null},J=[],ie={};if(c.storage_room_id&&(console.log(" [SparePartsDetailModal] Adding storage room promise:",c.storage_room_id),ie.storageRoom=Ur.getById(c.storage_room_id),J.push(ie.storageRoom)),c.shelf_id&&(console.log(" [SparePartsDetailModal] Adding store shelf promise:",c.shelf_id),ie.storeShelf=Er.getById(c.shelf_id),J.push(ie.storeShelf)),J.length>0)try{const le=await Promise.allSettled(J.map(ue=>Promise.race([ue,new Promise((fe,ve)=>setTimeout(()=>ve(new Error("API call timeout")),5e3))])));if(ie.storageRoom){const ue=le[0];ue.status==="fulfilled"&&ue.value&&(K.storageRoom=ue.value,console.log(" [SparePartsDetailModal] Storage room fetched:",K.storageRoom.name))}const ce=ie.storageRoom?1:0;if(ie.storeShelf){const ue=le[ce];ue.status==="fulfilled"&&ue.value&&(K.storeShelf=ue.value,console.log(" [SparePartsDetailModal] Store shelf fetched:",K.storeShelf.name))}let ge=null;if((z=K.storageRoom)!=null&&z.store_location_id?ge=K.storageRoom.store_location_id:(ae=K.storeShelf)!=null&&ae.store_location_id&&(ge=K.storeShelf.store_location_id),ge){console.log(" [SparePartsDetailModal] Fetching store location:",ge);try{const ue=await Promise.race([Tr.getById(ge),new Promise((fe,ve)=>setTimeout(()=>ve(new Error("Store location API timeout")),3e3))]);K.storeLocation=ue,console.log(" [SparePartsDetailModal] Store location fetched:",K.storeLocation.name)}catch(ue){console.error(" [SparePartsDetailModal] Error fetching store location:",ue)}}}catch(le){console.error(" [SparePartsDetailModal] Error in parallel API calls:",le)}l(K),console.log(" [SparePartsDetailModal] Location data fetched successfully:",{hasStoreLocation:!!K.storeLocation,hasStorageRoom:!!K.storageRoom,hasStoreShelf:!!K.storeShelf,locationInfo:K})}catch(K){console.error(" [SparePartsDetailModal] Error fetching location data:",K),l(null)}finally{B(!1)}},_=async()=>{if(c!=null&&c.id)try{b(!0),console.log(" [SparePartsDetailModal] Fetching spare part images from database...");const z=await hs(c.id);if(z&&z.length>0){const ae=z.map(K=>{const J=Ot.sanitizeImageUrl(K.image_url,K.file_name);return J.isSanitized&&console.warn(" [SparePartsDetailModal] Image URL sanitized to prevent 431 error:",{method:J.method,originalLength:J.originalLength,sanitizedLength:J.sanitizedLength}),{id:K.id,url:J.url,thumbnailUrl:K.thumbnail_url?Ot.sanitizeImageUrl(K.thumbnail_url,`thumb-${K.file_name}`).url:J.url,fileName:K.file_name,fileSize:K.file_size||0,isPrimary:K.is_primary||!1,uploadedAt:K.created_at||new Date().toISOString()}});A(ae),console.log(" [SparePartsDetailModal] Images fetched from database successfully:",{count:ae.length,images:ae.map(K=>({id:K.id,fileName:K.fileName,isPrimary:K.isPrimary,hasThumbnail:K.thumbnailUrl!==K.url}))})}else if(console.log(" [SparePartsDetailModal] No images in database, checking images column..."),c.images&&Array.isArray(c.images)&&c.images.length>0){const ae=c.images.map((K,J)=>{const ie=Ot.sanitizeImageUrl(K,`spare-part-image-${J+1}`);return{id:`spare-part-image-${J}`,url:ie.url,thumbnailUrl:ie.url,fileName:`spare-part-image-${J+1}`,fileSize:0,isPrimary:J===0,uploadedAt:c.created_at||new Date().toISOString()}});A(ae),console.log(" [SparePartsDetailModal] Images fetched from images column:",ae.length)}else A([]),console.log(" [SparePartsDetailModal] No images found for spare part")}catch(z){console.error(" [SparePartsDetailModal] Error fetching images:",z),A([])}finally{b(!1)}},n=async()=>{var z;if(c!=null&&c.id)try{I(!0),console.log(" [SparePartsDetailModal] Fetching variants for spare part:",c.id);const ae=await xs(c.id);console.log(" [SparePartsDetailModal] Variants data received:",ae),k(ae);const K=await bs(c.id);console.log(" [SparePartsDetailModal] Variant stats received:",K),x(K);const J=ae.length>0,ie=c.use_variants||((z=c.metadata)==null?void 0:z.useVariants)||!1;console.log(" [SparePartsDetailModal] Variants fetched successfully:",{variantsCount:ae.length,usesVariants:ie,stats:{totalVariants:K.totalVariants,totalValue:K.totalValue,inStockVariants:K.inStockVariants}})}catch(ae){console.error(" [SparePartsDetailModal] Error fetching variants:",ae),k([]),x(null)}finally{I(!1)}},[a,s]=G.useState(1),[m,j]=G.useState(""),[E,N]=G.useState(""),[S,R]=G.useState(!1);G.useState(!1),G.useState(!1),G.useState((c==null?void 0:c.quantity)||0),G.useState(null);const[$,A]=G.useState([]),[T,b]=G.useState(!1),[F,o]=G.useState(0),[u,k]=G.useState([]),[L,I]=G.useState(!1),[p,x]=G.useState(null),[v,l]=G.useState(null),[g,B]=G.useState(!1),M=Ar.find(z=>z.code==="TZS")||Ar[0],P=i||M,[X,W]=G.useState("overview"),O=G.useMemo(()=>{var ae;if((c.use_variants||((ae=c.metadata)==null?void 0:ae.useVariants)||!1)&&u.length>0){const K=u.reduce((ve,he)=>ve+(he.quantity||0),0),J=u.reduce((ve,he)=>ve+he.selling_price*he.quantity,0),ie=u.reduce((ve,he)=>ve+he.cost_price*he.quantity,0),le=J-ie,ce=K>0?J/K:0,ge=K>0?ie/K:0,ue=ce-ge,fe=ge>0?ue/ge*100:0;return{totalQuantity:K,totalValue:J,totalCost:ie,totalProfit:le,avgSellingPrice:ce,avgCostPrice:ge,avgProfit:ue,margin:fe,usesVariants:!0}}else{const K=c.quantity||0,J=c.selling_price*K,ie=c.cost_price*K,le=J-ie,ce=c.cost_price>0?(c.selling_price-c.cost_price)/c.cost_price*100:0;return{totalQuantity:K,totalValue:J,totalCost:ie,totalProfit:le,avgSellingPrice:c.selling_price,avgCostPrice:c.cost_price,avgProfit:c.selling_price-c.cost_price,margin:ce,usesVariants:!1}}},[c,u]);if(!y||!c||!P)return null;const V=c.created_at?Math.floor((Date.now()-new Date(c.created_at).getTime())/(1e3*60*60*24)):0,q=Math.round((c.name?20:0)+(c.description?15:0)+(c.brand?10:0)+(c.location?10:0)+(c.compatible_devices?15:0)+(c.cost_price>0?15:0)+(c.selling_price>0?15:0));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/40 backdrop-blur-sm",onClick:w,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-2 sm:p-4 overflow-y-auto",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsxs("div",{className:"relative bg-white rounded-lg sm:rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] sm:max-h-[85vh] overflow-hidden flex flex-col my-2 sm:my-4",onClick:z=>z.stopPropagation(),style:{pointerEvents:"auto"},children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 flex-shrink-0",children:e.jsx(Zt,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 truncate",children:c.name}),c.part_number&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded-full",children:c.part_number})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["Part Number: ",c.part_number||"N/A"]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${O.totalQuantity>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:O.totalQuantity>0?"In Stock":"Out of Stock"})})]})]})]}),e.jsx("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation(),w()},className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors flex-shrink-0",children:e.jsx($e,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex w-full",children:[e.jsx("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation(),W("overview")},className:`flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors ${X==="overview"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Cr,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]})}),e.jsx("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation(),W("analytics")},className:`flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors ${X==="analytics"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(_r,{className:"w-4 h-4"}),e.jsx("span",{children:"Analytics"})]})}),e.jsx("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation(),W("variants")},className:`flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors ${X==="variants"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:"Variants"}),u.length>0&&e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-1.5 py-0.5 rounded-full",children:u.length})]})}),e.jsx("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation(),W("details")},className:`flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors ${X==="details"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Pr,{className:"w-4 h-4"}),e.jsx("span",{children:"Details"})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:e.jsxs("div",{className:"p-3 sm:p-4",children:[X==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border border-emerald-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-emerald-700 uppercase tracking-wide mb-1",children:"Total Value"}),e.jsx("div",{className:"text-sm font-bold text-emerald-900",children:Me(O.totalValue,P).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Profit"}),e.jsx("div",{className:"text-sm font-bold text-blue-900",children:Me(O.totalProfit,P).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 uppercase tracking-wide mb-1",children:"Margin"}),e.jsxs("div",{className:"text-sm font-bold text-orange-900",children:[O.margin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-purple-700 uppercase tracking-wide mb-1",children:"Investment"}),e.jsx("div",{className:"text-sm font-bold text-purple-900",children:Me(O.totalCost,P).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3 sm:gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Images"}),T?e.jsx("div",{className:"aspect-square relative rounded-lg overflow-hidden bg-gray-50 border border-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading images..."})]})}):$.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"aspect-square relative rounded-lg overflow-hidden bg-gray-50 border border-gray-200",children:e.jsx("img",{src:((te=$[F])==null?void 0:te.thumbnailUrl)||((pe=$[F])==null?void 0:pe.url)||((me=$[0])==null?void 0:me.thumbnailUrl)||((de=$[0])==null?void 0:de.url),alt:c.name,className:"w-full h-full object-cover"})}),$.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:$.map((z,ae)=>e.jsx("button",{onClick:()=>o(ae),className:`flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden border-2 transition-all ${ae===F?"border-blue-500":"border-gray-200 hover:border-gray-300"}`,children:e.jsx("img",{src:z.thumbnailUrl||z.url,alt:`${c.name} ${ae+1}`,className:"w-full h-full object-cover"})},z.id))})]}):e.jsx("div",{className:"aspect-square relative rounded-xl overflow-hidden bg-gradient-to-br from-blue-100 to-indigo-100 border-2 border-dashed border-blue-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Zt,{className:"w-16 h-16 text-blue-400 mx-auto mb-2"}),e.jsx("p",{className:"text-blue-600 font-medium text-sm",children:"No images available"}),e.jsx("p",{className:"text-blue-500 text-xs mt-1",children:"Upload images to display here"})]})})]}),c.description&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Description"}),e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed bg-gray-50 rounded-lg p-3",children:c.description})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Cr,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Basic Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((xe=c.category)==null?void 0:xe.name)||"Uncategorized"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),e.jsx("p",{className:`text-sm font-medium ${c.is_active?"text-green-600":"text-red-600"}`,children:c.is_active?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Part ID"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:c.id})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Part Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:c.part_number})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:O.usesVariants?"Total Stock":"Current Stock"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[O.totalQuantity," units"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Min Stock"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[c.min_quantity," units"]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(yt,{className:"w-5 h-5 text-green-600"}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-800",children:["Pricing Summary",O.usesVariants&&e.jsx("span",{className:"text-xs text-blue-600 ml-2",children:"(Variants)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:O.usesVariants?"Avg Selling Price":"Selling Price"}),e.jsx("p",{className:"text-sm font-bold text-green-600",children:Me(O.avgSellingPrice,P).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:O.usesVariants?"Avg Cost Price":"Cost Price"}),e.jsx("p",{className:"text-sm font-bold text-red-600",children:Me(O.avgCostPrice,P).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:O.usesVariants?"Avg Profit/Unit":"Profit/Unit"}),e.jsx("p",{className:"text-sm font-bold text-blue-600",children:Me(O.avgProfit,P).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Markup"}),e.jsxs("p",{className:"text-sm font-bold text-purple-600",children:[O.margin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"col-span-2 space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Value"}),e.jsx("p",{className:"text-xl font-bold text-orange-600",children:Me(O.totalValue,P).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})]}),c.supplier&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Rr,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Supplier Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.supplier.name})]}),c.supplier.email&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.supplier.email})]}),c.supplier.phone&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Phone"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.supplier.phone})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Yt,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Status & Details"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Condition"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:c.condition||"New"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Brand"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.brand||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Stock Status"}),e.jsx("p",{className:`text-sm font-medium ${O.totalQuantity===0?"text-red-600":O.totalQuantity<=c.min_quantity?"text-orange-600":"text-green-600"}`,children:O.totalQuantity===0?"Out of Stock":O.totalQuantity<=c.min_quantity?"Low Stock":"In Stock"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Location"}),g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."})]}):v?e.jsxs("div",{className:"text-sm",children:[v.storeLocation&&e.jsx("p",{className:"font-medium text-gray-900",children:v.storeLocation.name}),v.storageRoom&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Room: ",v.storageRoom.code]}),v.storeShelf&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Shelf: ",v.storeShelf.code]}),!v.storeLocation&&!v.storageRoom&&!v.storeShelf&&e.jsx("p",{className:"text-sm text-gray-500",children:v.fallbackLocation||c.location||"Not Set"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:c.location||"Not Set"})]})]})]})]})]})]}),X==="analytics"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Es,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Performance Metrics"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-green-700 uppercase tracking-wide mb-1",children:"Stock Turnover"}),e.jsx("div",{className:"text-sm font-bold text-green-900",children:V>0?(O.totalQuantity/V).toFixed(2):"N/A"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Inventory Value"}),e.jsx("div",{className:"text-sm font-bold text-blue-900",children:Me(O.totalCost,P).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-purple-700 uppercase tracking-wide mb-1",children:"Retail Value"}),e.jsx("div",{className:"text-sm font-bold text-purple-900",children:Me(O.totalValue,P).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 uppercase tracking-wide mb-1",children:"Profit Potential"}),e.jsx("div",{className:"text-sm font-bold text-orange-900",children:Me(O.totalProfit,P).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(_r,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Data Quality & Analytics"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Data Completeness"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${q}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[q,"%"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Days in Inventory"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[V," days"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.created_at?new Date(c.created_at).toLocaleDateString():"Unknown"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.updated_at?new Date(c.updated_at).toLocaleDateString():"Never"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Fs,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Recommendations"})]}),e.jsx("div",{className:"space-y-2",children:(()=>{const z=[];return O.totalQuantity<=c.min_quantity&&z.push({type:"warning",message:"Stock is low and needs reordering"}),O.avgCostPrice>0&&O.avgSellingPrice<=O.avgCostPrice&&z.push({type:"error",message:"Average selling price is at or below average cost price - review pricing strategy"}),q<60&&z.push({type:"info",message:"Spare part data is incomplete - consider adding missing information"}),z.length===0&&z.push({type:"success",message:"Spare part is in good condition with no immediate actions needed"}),z.map((ae,K)=>e.jsx("div",{className:`p-3 rounded-lg ${ae.type==="error"?"bg-red-50 border border-red-200":ae.type==="warning"?"bg-orange-50 border border-orange-200":ae.type==="info"?"bg-blue-50 border border-blue-200":"bg-green-50 border border-green-200"}`,children:e.jsx("p",{className:`text-sm font-medium ${ae.type==="error"?"text-red-800":ae.type==="warning"?"text-orange-800":ae.type==="info"?"text-blue-800":"text-green-800"}`,children:ae.message})},K))})()})]})]}),X==="variants"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variants Overview"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>n(),className:"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:[e.jsx(Jt,{className:"w-3 h-3"}),"Refresh"]})})]}),L?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading variants..."})]})}):e.jsxs("div",{className:"space-y-4",children:[p&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Total Variants"}),e.jsx("div",{className:"text-sm font-bold text-blue-900",children:p.totalVariants})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-green-700 uppercase tracking-wide mb-1",children:"In Stock"}),e.jsx("div",{className:"text-sm font-bold text-green-900",children:p.inStockVariants})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 uppercase tracking-wide mb-1",children:"Low Stock"}),e.jsx("div",{className:"text-sm font-bold text-orange-900",children:p.lowStockVariants})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-purple-700 uppercase tracking-wide mb-1",children:"Total Value"}),e.jsx("div",{className:"text-sm font-bold text-purple-900",children:Me(p.totalValue,P).replace(/\.00$/,"").replace(/\.0$/,"")})]})]}),u.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Variant Details"}),u.map((z,ae)=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:z.name}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-mono",children:z.sku}),z.is_active?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"Active"}):e.jsx("span",{className:"text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded-full",children:"Inactive"})]}),z.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:z.description}),z.variant_attributes&&Object.keys(z.variant_attributes).length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-1",children:"Specifications:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(z.variant_attributes).map(([K,J])=>e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded",children:[K,": ",String(J)]},K))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Stock:"}),e.jsx("span",{className:"font-medium ml-1",children:z.quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Min Stock:"}),e.jsx("span",{className:"font-medium ml-1",children:z.min_quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Cost Price:"}),e.jsx("span",{className:"font-medium text-red-600 ml-1",children:Me(z.cost_price,P).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Selling Price:"}),e.jsx("span",{className:"font-medium text-green-600 ml-1",children:Me(z.selling_price,P).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 ml-4",children:[z.quantity===0?e.jsx("span",{className:"w-4 h-4 bg-red-500 rounded-full",title:"Out of Stock"}):z.quantity<=z.min_quantity?e.jsx("span",{className:"w-4 h-4 bg-orange-500 rounded-full",title:"Low Stock"}):e.jsx("span",{className:"w-4 h-4 bg-green-500 rounded-full",title:"In Stock"}),e.jsx("span",{className:"text-xs text-gray-500",children:z.quantity===0?"Out of Stock":z.quantity<=z.min_quantity?"Low Stock":"In Stock"})]})]})},z.id||ae))]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"No variants found"}),e.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Variants allow you to manage different specifications, prices, and stock levels for this spare part."}),e.jsxs("div",{className:"text-xs text-gray-400",children:[e.jsx("p",{children:" Create variants for different qualities (Original, Compatible, Refurbished)"}),e.jsx("p",{children:" Set different prices and stock levels for each variant"}),e.jsx("p",{children:" Track variant-specific attributes and specifications"})]})]})]})]})}),X==="details"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Mr,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Spare Part Identification"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Part Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:c.part_number})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Spare Part ID"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:c.id})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(pt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Storage & Location"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Location"}),g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."})]}):v?e.jsxs("div",{className:"text-sm",children:[v.storeLocation&&e.jsx("p",{className:"font-medium text-gray-900",children:v.storeLocation.name}),v.storageRoom&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Room: ",v.storageRoom.code]}),v.storeShelf&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Shelf: ",v.storeShelf.code]}),!v.storeLocation&&!v.storageRoom&&!v.storeShelf&&e.jsx("p",{className:"text-sm text-gray-500",children:v.fallbackLocation||c.location||"Not Set"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:c.location||"Not Set"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((be=c.category)==null?void 0:be.name)||"Uncategorized"})]})]})]}),c.compatible_devices&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Et,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Compatible Devices"})]}),e.jsx("div",{className:"text-sm text-gray-600 bg-gray-50 rounded-lg p-3",children:c.compatible_devices})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-100",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>R(!0),disabled:O.totalQuantity===0,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium",children:[e.jsx(at,{className:"w-4 h-4"}),"Use Spare Part"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:w,className:"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Close"}),t&&e.jsxs("button",{onClick:()=>t(c),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(er,{className:"w-4 h-4"}),"Edit"]})]})]})]})})]})}),S&&e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"w-full max-w-md mx-4",children:e.jsxs(Re,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Use Spare Part"}),e.jsx("button",{onClick:()=>R(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity to Use"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>s(Math.max(1,a-1)),disabled:a<=1,className:"w-10 h-10 flex items-center justify-center border-2 border-blue-300 rounded-lg hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(at,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{className:"w-16 text-center font-bold text-xl text-gray-900",children:a}),e.jsx("button",{onClick:()=>s(Math.min(O.totalQuantity,a+1)),disabled:a>=O.totalQuantity,className:"w-10 h-10 flex items-center justify-center border-2 border-blue-300 rounded-lg hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(st,{className:"w-4 h-4 text-blue-600"})})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Available: ",O.totalQuantity," units"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Usage *"}),e.jsx("input",{type:"text",value:m,onChange:z=>j(z.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Device repair, Maintenance",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:E,onChange:z=>N(z.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Additional notes..."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-6 pt-4 border-t border-gray-200",children:[e.jsx(Pe,{type:"button",variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsx(Pe,{type:"button",onClick:()=>{if(a>O.totalQuantity){se.error("Cannot use more than available quantity");return}if(!m.trim()){se.error("Please provide a reason for usage");return}h&&(h(a,m,E),R(!1),s(1),j(""),N(""),se.success(`Used ${a} units of ${c.name}`))},disabled:!m.trim()||a>O.totalQuantity,className:"bg-blue-600 text-white hover:bg-blue-700",icon:e.jsx(at,{size:18}),children:"Use Spare Part"})]})]})})})]})},fa=()=>{const{confirm:y}=$s(),{spareParts:w,categories:c,isLoading:i,error:t,loadSpareParts:r,loadCategories:h,createOrUpdateSparePart:d,updateSparePart:C,deleteSparePart:_,useSparePart:n}=rr(),[a,s]=G.useState(""),[m,j]=G.useState("all"),[E,N]=G.useState("all"),[S,R]=G.useState("grid"),[$,A]=G.useState("name"),[T,b]=G.useState("asc"),[F,o]=G.useState([]),[u,k]=G.useState(!1),[L,I]=G.useState(!1),[p,x]=G.useState(!1),[v,l]=G.useState(!1),[g,B]=G.useState(!1),[M,P]=G.useState(null),[X,W]=G.useState(null),[O,V]=G.useState(null),[q,te]=G.useState({spareParts:null,categories:null,lastLoad:0}),[pe,me]=G.useState(!0),de=5*60*1e3;G.useEffect(()=>{(async()=>{const H=Date.now();if(q.spareParts&&q.categories&&H-q.lastLoad<de){console.log(" Using cached spare parts data"),me(!1);return}console.log(" Loading fresh spare parts data...");const ee=performance.now();try{const[Y,ne]=await Promise.allSettled([r(),h()]),oe=performance.now();console.log(` Spare parts data loaded in ${(oe-ee).toFixed(2)}ms`),te({spareParts:Y.status==="fulfilled"?Y.value:null,categories:ne.status==="fulfilled"?ne.value:null,lastLoad:H}),Y.status==="rejected"&&(console.error(" Failed to load spare parts:",Y.reason),se.error("Failed to load spare parts data")),ne.status==="rejected"&&(console.error(" Failed to load categories:",ne.reason),se.error("Failed to load categories data"))}catch(Y){console.error(" Critical error loading spare parts data:",Y),se.error("Critical error loading data. Please refresh the page.")}finally{me(!1)}})()},[r,h]),G.useEffect(()=>{const D=()=>{k(window.innerWidth<768)};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),G.useEffect(()=>{const D=H=>{console.log(" Refreshing spare parts data due to update:",H.detail),r()};return window.addEventListener("lats:spare-parts-updated",D),()=>{window.removeEventListener("lats:spare-parts-updated",D)}},[r]);const xe=()=>{F.length===J.length?o([]):o(J.map(D=>D.id))},be=D=>{o(H=>H.includes(D)?H.filter(ee=>ee!==D):[...H,D])},z=async()=>{if(!(F.length===0||!await y(`Are you sure you want to delete ${F.length} spare parts?`)))try{const H=F.map(ee=>_(ee));await Promise.all(H),se.success(`Successfully deleted ${F.length} spare parts`),o([])}catch(H){console.error("Error deleting spare parts:",H),se.error("Failed to delete some spare parts")}},ae=()=>{const D=J.filter(oe=>F.includes(oe.id)).map(oe=>({name:oe.name,partNumber:oe.part_number||"",category:Ie(oe.category_id),quantity:oe.quantity,minQuantity:oe.min_quantity,costPrice:oe.cost_price,sellingPrice:oe.selling_price,location:oe.location||"",description:oe.description||""})),H=[Object.keys(D[0]).join(","),...D.map(oe=>Object.values(oe).map(Ne=>`"${Ne}"`).join(","))].join(`
`),ee=new Blob([H],{type:"text/csv"}),Y=window.URL.createObjectURL(ee),ne=document.createElement("a");ne.href=Y,ne.download=`spare-parts-export-${new Date().toISOString().split("T")[0]}.csv`,ne.click(),window.URL.revokeObjectURL(Y),se.success(`Exported ${D.length} spare parts to CSV`)},K=xr.useMemo(()=>{const D=w.filter(Y=>Y.quantity<=Y.min_quantity&&Y.quantity>0),H=w.filter(Y=>Y.quantity===0),ee=w.filter(Y=>Y.quantity<=Y.min_quantity).map(Y=>({...Y,suggestedReorder:Math.max(Y.min_quantity*2,10),urgency:Y.quantity===0?"critical":Y.quantity<=Y.min_quantity*.5?"high":"medium"}));return{lowStock:D,outOfStock:H,reorderSuggestions:ee,total:D.length+H.length}},[w]),J=xr.useMemo(()=>{const D=w.filter(H=>{var oe,Ne;const ee=H.name.toLowerCase().includes(a.toLowerCase())||((oe=H.part_number)==null?void 0:oe.toLowerCase().includes(a.toLowerCase()))||((Ne=H.description)==null?void 0:Ne.toLowerCase().includes(a.toLowerCase())),Y=m==="all"||H.category_id===m;let ne=!0;switch(E){case"in-stock":ne=H.quantity>H.min_quantity;break;case"low-stock":ne=H.quantity<=H.min_quantity&&H.quantity>0;break;case"out-of-stock":ne=H.quantity===0;break}return ee&&Y&&ne});return D.sort((H,ee)=>{let Y,ne;switch($){case"name":Y=H.name,ne=ee.name;break;case"quantity":Y=H.quantity,ne=ee.quantity;break;case"cost":Y=H.cost_price,ne=ee.cost_price;break;case"selling":Y=H.selling_price,ne=ee.selling_price;break;default:Y=H.name,ne=ee.name}return T==="asc"?Y>ne?1:-1:Y<ne?1:-1}),D},[w,a,m,E,$,T]),ie=D=>{const H={name:D.name,partNumber:D.partNumber,categoryId:D.categoryId,brand:D.brand,supplierId:D.supplierId,condition:D.condition,description:D.description,costPrice:D.costPrice,sellingPrice:D.sellingPrice,quantity:D.quantity,minQuantity:D.minQuantity,location:D.location,compatibleDevices:D.compatibleDevices};return D.storageRoomId&&(H.storageRoomId=D.storageRoomId),D.shelfId&&(H.shelfId=D.shelfId),Array.isArray(D.images)&&D.images.length>0&&(H.images=D.images),D.partType&&(H.partType=D.partType),D.primaryDeviceType&&(H.primaryDeviceType=D.primaryDeviceType),D.searchTags&&(H.searchTags=D.searchTags),D.useVariants!==void 0&&(H.useVariants=D.useVariants),Array.isArray(D.variants)&&D.variants.length>0&&(H.variants=D.variants),H},le=D=>{const H=[];return(!D.name||typeof D.name!="string"||!D.name.trim())&&H.push("Part name is required"),D.name&&typeof D.name=="string"&&(D.name=D.name.trim().substring(0,255)),D.description&&typeof D.description=="string"&&(D.description=D.description.trim().substring(0,1e3)),D.quantity!==void 0&&(typeof D.quantity!="number"||D.quantity<0)&&H.push("Quantity must be a non-negative number"),D.minQuantity!==void 0&&(typeof D.minQuantity!="number"||D.minQuantity<0)&&H.push("Minimum quantity must be a non-negative number"),D.costPrice!==void 0&&(typeof D.costPrice!="number"||D.costPrice<0)&&H.push("Cost price must be a non-negative number"),D.sellingPrice!==void 0&&(typeof D.sellingPrice!="number"||D.sellingPrice<0)&&H.push("Selling price must be a non-negative number"),D.quantity!==void 0&&D.minQuantity!==void 0&&typeof D.quantity=="number"&&typeof D.minQuantity=="number"&&D.quantity<D.minQuantity&&H.push("Current quantity cannot be less than minimum quantity"),{isValid:H.length===0,errors:H}},ce=async D=>{try{const H=le(D);if(!H.isValid){se.error(`Validation failed: ${H.errors.join(", ")}`);return}const ee=ie(D);if(M){const Y=await C(M.id,ee);Y.ok?(se.success("Spare part updated successfully"),I(!1),x(!1),P(null),await r()):se.error(Y.message||"Failed to update spare part")}else{const Y=await d(ee);if(Y.ok){switch(Y.operationType){case"CREATE_NEW":se.success(" New spare part created successfully!");break;case"UPDATE_EXISTING":se.success(" Spare part updated instead of created. A part with this part number already existed and was updated.");break;default:se.success("Spare part saved successfully")}I(!1),await r()}else{const ne=Y.errorType,oe=Y.message||"Failed to create spare part";switch(ne){case"DUPLICATE_PART_NUMBER":se.error(` Part number already exists! ${oe.split(":")[1]||oe}`);break;case"DUPLICATE_CONSTRAINT":se.error(` Duplicate data! ${oe.split(":")[1]||oe}`);break;case"FOREIGN_KEY_VIOLATION":se.error(` Invalid selection! ${oe.split(":")[1]||oe}`);break;case"CHECK_CONSTRAINT_VIOLATION":se.error(` Invalid data! ${oe.split(":")[1]||oe}`);break;case"DATABASE_ERROR":se.error(` Database error! ${oe.split(":")[1]||oe}`);break;default:se.error(oe)}}}}catch(H){console.error("Error saving spare part:",H),se.error("An unexpected error occurred while saving the spare part")}},ge=async D=>{if(await y("Are you sure you want to delete this spare part?"))try{const H=await _(D);H.ok?(se.success("Spare part deleted successfully"),await r()):se.error(H.message||"Failed to delete spare part")}catch{se.error("An error occurred")}},ue=async(D,H,ee)=>{if(X)try{const Y=await n(X.id,D,H,ee);Y.ok?(se.success("Spare part usage recorded successfully"),l(!1),W(null),await r()):se.error(Y.message||"Failed to record spare part usage")}catch(Y){console.error("Error recording spare part usage:",Y),se.error("An unexpected error occurred while recording usage")}},fe=D=>{V(D),B(!0)},ve=()=>{B(!1),V(null)},he=D=>{P(D),B(!1),I(!0)},ye=async D=>{await ge(D),B(!1),V(null)},Se=async(D,H,ee)=>{if(O)try{const Y=await n(O.id,D,H,ee);Y.ok?(se.success("Spare part usage recorded successfully"),await r()):se.error(Y.message||"Failed to record spare part usage")}catch(Y){console.error("Error recording spare part usage:",Y),se.error("An unexpected error occurred while recording usage")}},Ie=D=>{const H=c.find(ee=>ee.id===D);return(H==null?void 0:H.name)||"Unknown"},Te=D=>D.quantity===0?{status:"out-of-stock",color:"text-red-500",bg:"bg-red-100"}:D.quantity<=D.min_quantity?{status:"low-stock",color:"text-yellow-500",bg:"bg-yellow-100"}:{status:"in-stock",color:"text-green-500",bg:"bg-green-100"};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Zt,{className:"text-orange-600 w-8 h-8"}),"Spare Parts Inventory"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage inventory, track usage, and monitor stock levels"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>{P(null),x(!0)},className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-orange-600 text-white hover:bg-orange-700 transition-colors text-sm",children:[e.jsx(st,{size:18}),"Add Part"]}),e.jsxs("button",{onClick:()=>{P(null),I(!0)},className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors text-sm bg-white",children:[e.jsx(Ce,{size:18}),"Advanced"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Parts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:J.length})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yt,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"In Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.filter(D=>D.quantity>D.min_quantity).length})]})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg p-5 hover:bg-yellow-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ft,{className:"w-7 h-7 text-yellow-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Low Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:K.lowStock.length})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-5 hover:bg-red-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Xt,{className:"w-7 h-7 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Out of Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:K.outOfStock.length})]})]})})]}),K.total>0&&e.jsxs(Re,{className:"mb-4 p-4 border-l-4 border-l-yellow-500",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ft,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-1",children:"Stock Alerts & Reorder Suggestions"}),e.jsxs("div",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsxs("p",{children:[" ",K.outOfStock.length," parts out of stock (Critical)"]}),e.jsxs("p",{children:[" ",K.lowStock.length," parts with low stock"]}),e.jsxs("p",{children:[" ",K.reorderSuggestions.length," parts need reordering"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[K.outOfStock.length>0&&e.jsxs(Pe,{size:"sm",onClick:()=>N("out-of-stock"),className:"bg-red-600 text-white hover:bg-red-700",children:["View Critical (",K.outOfStock.length,")"]}),K.lowStock.length>0&&e.jsxs(Pe,{size:"sm",onClick:()=>N("low-stock"),className:"bg-yellow-600 text-white hover:bg-yellow-700",children:["View Low Stock (",K.lowStock.length,")"]}),K.reorderSuggestions.length>0&&e.jsx(Pe,{size:"sm",onClick:ae,className:"bg-blue-600 text-white hover:bg-blue-700",children:"Export Reorder List"})]})]}),K.reorderSuggestions.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-yellow-200",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Quick Reorder Suggestions:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:K.reorderSuggestions.slice(0,6).map(D=>e.jsxs("div",{className:`p-2 rounded text-xs ${D.urgency==="critical"?"bg-red-100 text-red-800":D.urgency==="high"?"bg-orange-100 text-orange-800":"bg-yellow-100 text-yellow-800"}`,children:[e.jsx("div",{className:"font-medium truncate",children:D.name}),e.jsxs("div",{children:["Current: ",D.quantity," | Suggested: ",D.suggestedReorder]})]},D.id))}),K.reorderSuggestions.length>6&&e.jsxs("p",{className:"text-xs text-yellow-600 mt-2",children:["+",K.reorderSuggestions.length-6," more parts need attention"]})]})]}),F.length>0&&e.jsx(Re,{className:"bg-orange-50 border-orange-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yt,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-orange-900",children:[F.length," part",F.length!==1?"s":""," selected"]}),e.jsx("button",{onClick:()=>o([]),className:"text-xs text-orange-600 hover:text-orange-800 underline",children:"Clear selection"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-green-600 text-white hover:bg-green-700 transition-colors text-sm",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Export CSV"]}),e.jsxs("button",{onClick:z,className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-red-600 text-white hover:bg-red-700 transition-colors text-sm",children:[e.jsx(Lt,{className:"w-4 h-4"}),"Delete"]})]})]})}),e.jsx(Re,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search parts, numbers, or descriptions...",value:a,onChange:D=>s(D.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-gray-900"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("select",{value:m,onChange:D=>j(D.target.value),className:"px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-gray-900 bg-white",children:[e.jsx("option",{value:"all",children:"All Categories"}),c.map(D=>e.jsx("option",{value:D.id,children:D.name},D.id))]}),e.jsxs("select",{value:E,onChange:D=>N(D.target.value),className:"px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-gray-900 bg-white",children:[e.jsx("option",{value:"all",children:"All Stock"}),e.jsx("option",{value:"in-stock",children:"In Stock"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"out-of-stock",children:"Out of Stock"})]}),e.jsxs("select",{value:$,onChange:D=>A(D.target.value),className:"px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-gray-900 bg-white",children:[e.jsx("option",{value:"name",children:"Sort: Name"}),e.jsx("option",{value:"quantity",children:"Sort: Quantity"}),e.jsx("option",{value:"cost",children:"Sort: Cost"}),e.jsx("option",{value:"selling",children:"Sort: Price"})]}),e.jsxs("button",{onClick:async()=>{await r(),se.success("Data refreshed successfully")},disabled:i,className:"flex items-center gap-2 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 bg-white",children:[e.jsx(Jt,{className:`w-4 h-4 ${i?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs("div",{className:"flex gap-1 border border-gray-300 rounded-lg p-1 bg-white",children:[e.jsx("button",{onClick:()=>R("grid"),className:`p-2 rounded transition-colors ${S==="grid"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,title:"Grid View",children:e.jsx(Ms,{className:"w-4 h-4"})}),!u&&e.jsx("button",{onClick:()=>R("list"),className:`p-2 rounded transition-colors ${S==="list"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,title:"Table View",children:e.jsx(Ps,{className:"w-4 h-4"})})]})]})]})}),t&&e.jsx(Re,{className:"bg-red-50 border-red-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(ft,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:t})]})]})}),i||pe?e.jsx(Re,{className:"p-12",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Jt,{className:"w-8 h-8 animate-spin text-orange-500"}),e.jsx("span",{className:"ml-4 text-gray-700 font-medium",children:"Loading spare parts..."})]})}):J.length===0?e.jsxs(Re,{className:"p-12 text-center",children:[e.jsx(Ce,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No spare parts found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:a||m!=="all"||E!=="all"?"Try adjusting your search or filters":"Get started by adding your first spare part"}),!a&&m==="all"&&E==="all"&&e.jsxs("button",{onClick:()=>{P(null),I(!0)},className:"inline-flex items-center gap-2 px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Spare Part"})]})]}):S==="grid"?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(280px, 100%), 1fr))",gap:"clamp(1rem, 2vw, 1.5rem)",gridAutoRows:"1fr"},children:J.map(D=>{const H=Te(D),ee=F.includes(D.id);return e.jsxs(Re,{className:`overflow-hidden hover:shadow-lg transition-all ${ee?"ring-2 ring-orange-500 bg-orange-50":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full h-40 bg-gray-100 flex items-center justify-center cursor-pointer",onClick:()=>fe(D),children:D.images&&D.images.length>0?e.jsx(Dr,{src:D.images[0],alt:D.name,className:"w-full h-full object-cover"}):e.jsx(Ce,{className:"w-16 h-16 text-gray-400"})}),e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-semibold ${H.bg} ${H.color} shadow-sm`,children:H.status.replace("-"," ")}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("input",{type:"checkbox",checked:ee,onChange:()=>be(D.id),className:"h-5 w-5 text-orange-600 focus:ring-orange-500 border-gray-300 rounded shadow-sm"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-bold text-gray-900 truncate text-base",children:D.name}),e.jsx("p",{className:"text-sm text-gray-500",children:D.part_number})]}),D.description&&e.jsx("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:D.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:Ie(D.category_id)})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Quantity"}),e.jsxs("p",{className:`text-sm font-bold ${D.quantity<=D.min_quantity?"text-red-600":"text-green-600"}`,children:[D.quantity,"/",D.min_quantity]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Cost"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:He.currency(D.cost_price)})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Price"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:He.currency(D.selling_price)})]})]}),D.location&&e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Location: ",e.jsx("span",{className:"font-medium text-gray-900",children:D.location})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>fe(D),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm font-medium",children:[e.jsx(Ft,{className:"w-4 h-4"}),"View"]}),e.jsx("button",{onClick:()=>{W(D),l(!0)},disabled:D.quantity===0,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Use Part",children:e.jsx(at,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>{P(D),I(!0)},className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Edit Part",children:e.jsx(er,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>ge(D.id),className:"p-2 border border-red-300 rounded-lg hover:bg-red-50 transition-colors",title:"Delete Part",children:e.jsx(Lt,{className:"w-4 h-4 text-red-600"})})]})]})]},D.id)})}):e.jsxs(Re,{className:"overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-3",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center text-xs font-semibold text-gray-700 uppercase",children:[e.jsxs("div",{className:"col-span-1 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F.length===J.length&&J.length>0,onChange:xe,className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),e.jsx("span",{children:"Image"})]}),e.jsx("div",{className:"col-span-2",children:"Part Details"}),e.jsx("div",{className:"col-span-2",children:"Category"}),e.jsx("div",{className:"col-span-1 text-center",children:"Quantity"}),e.jsx("div",{className:"col-span-1",children:"Pricing"}),e.jsx("div",{className:"col-span-2",children:"Location"}),e.jsx("div",{className:"col-span-1 text-center",children:"Status"}),e.jsx("div",{className:"col-span-2 text-center",children:"Actions"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:J.map(D=>{const H=Te(D),ee=F.includes(D.id);return e.jsx("div",{className:`hover:bg-gray-50 transition-colors ${ee?"bg-orange-50":""}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center px-6 py-4",children:[e.jsxs("div",{className:"col-span-1 flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:ee,onChange:()=>be(D.id),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center cursor-pointer",onClick:()=>fe(D),children:D.images&&D.images.length>0?e.jsx(Dr,{src:D.images[0],alt:D.name,className:"w-full h-full object-cover"}):e.jsx(Ce,{className:"w-6 h-6 text-gray-400"})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"font-bold text-gray-900",children:D.name}),e.jsx("div",{className:"text-sm text-gray-500",children:D.part_number}),D.description&&e.jsx("div",{className:"text-xs text-gray-500 truncate mt-1",children:D.description})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-4 h-4 text-purple-600"})}),e.jsx("span",{className:"font-medium text-gray-900",children:Ie(D.category_id)})]})}),e.jsxs("div",{className:"col-span-1 text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${D.quantity<=D.min_quantity?"text-red-600":"text-green-600"}`,children:D.quantity}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Min: ",D.min_quantity]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:He.currency(D.cost_price)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Sell: ",He.currency(D.selling_price)]})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"text-sm text-gray-900",children:D.location||"Not set"})}),e.jsx("div",{className:"col-span-1 flex justify-center",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold ${H.bg} ${H.color}`,children:H.status.replace("-"," ")})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>fe(D),className:"p-2 text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors",title:"View Details",children:e.jsx(Ft,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{W(D),l(!0)},disabled:D.quantity===0,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Use Part",children:e.jsx(at,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>{P(D),I(!0)},className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Edit Part",children:e.jsx(er,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>ge(D.id),className:"p-2 border border-red-300 rounded-lg hover:bg-red-50 transition-colors",title:"Delete Part",children:e.jsx(Lt,{className:"w-4 h-4 text-red-600"})})]})})]})},D.id)})})]}),L&&e.jsx(ra,{sparePart:M,onSave:ce,onCancel:()=>{I(!1),P(null)}}),p&&e.jsx(sa,{sparePart:M,onSave:ce,onCancel:()=>{x(!1),P(null)}}),v&&X&&e.jsx(aa,{sparePart:X,onUse:ue,onCancel:()=>{l(!1),W(null)}}),g&&O&&e.jsx(na,{isOpen:g,onClose:ve,sparePart:O,currency:{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:""},onEdit:he,onDelete:ye,onUse:Se})]})};export{fa as default};
