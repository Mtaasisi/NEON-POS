import{_ as He}from"./supabase-cf010ec4.js";import{j as e,s as G}from"./index-61458a34.js";import{r as z,b as Le}from"./vendor-36d2c7c1.js";import{n as P,X as Ue,b1 as Ne,g as Be,o as _e,a5 as Ge,M as Oe,a6 as qe,D as Ve,aP as Ye}from"./ui-28e30067.js";import Ze from"./whatsappService-09f99080.js";import{u as Qe,S as Je}from"./useSuccessModal-081786c4.js";import{S as je}from"./SuccessModalIcons-fe811e4d.js";import{u as Xe}from"./useBusinessInfo-62d31733.js";import{f as Ke}from"./formatPhoneForInvoice-e7084c6d.js";import{E as De}from"./pdf-e6e38bab.js";import ge from"./html2canvas.esm-6bd083a4.js";const Z=async f=>{try{if(f.startsWith("data:")||f.startsWith("blob:"))return f;try{const k=await fetch(f,{mode:"cors",cache:"no-cache"});if(k.ok){const a=await k.blob();return new Promise(j=>{const x=new FileReader;x.onloadend=()=>{j(x.result)},x.onerror=()=>{j(null)},x.readAsDataURL(a)})}}catch(k){k instanceof TypeError&&k.message.includes("Failed to fetch")}const A=[`https://corsproxy.io/?${encodeURIComponent(f)}`,`https://api.allorigins.win/raw?url=${encodeURIComponent(f)}`,`https://cors-anywhere.herokuapp.com/${f}`];for(const k of A)try{const a=new AbortController,j=setTimeout(()=>a.abort(),8e3),x=await fetch(k,{cache:"no-cache",signal:a.signal,mode:"cors"});if(clearTimeout(j),x.ok){const O=await x.blob();if(O.type.startsWith("image/"))return new Promise(C=>{const n=new FileReader;n.onloadend=()=>{C(n.result)},n.onerror=()=>{C(null)},n.readAsDataURL(O)})}}catch{continue}return new Promise(k=>{const a=new Image;a.crossOrigin="anonymous";const j=setTimeout(()=>{k(null)},1e4);a.onload=()=>{clearTimeout(j);try{const x=document.createElement("canvas");x.width=a.width,x.height=a.height;const O=x.getContext("2d");O?(O.drawImage(a,0,0),k(x.toDataURL("image/png"))):k(null)}catch(x){console.warn(`Canvas conversion failed for: ${f.substring(0,60)}...`,x),k(null)}},a.onerror=()=>{clearTimeout(j),console.warn(`Image load failed for base64 conversion: ${f.substring(0,60)}...`),k(null)},a.src=f})}catch(A){return console.warn(`Error converting image to base64: ${f.substring(0,60)}...`,A),null}},gt=({isOpen:f,onClose:A,onPrintReceipt:k,receiptData:a})=>{const[j,x]=z.useState(!1),[O,C]=z.useState(""),[n,$e]=z.useState("a4"),[c,Pe]=z.useState("portrait"),[pe,Se]=z.useState(new Map),[he,ue]=z.useState(!1),[ke,xe]=z.useState(new Set),ne=Qe(),{businessInfo:d}=Xe(),Q=z.useRef(null);if(z.useEffect(()=>{f&&(xe(new Set),(async()=>{const o=new Map,r=[];a!=null&&a.items&&a.items.filter(t=>t.image&&!t.image.startsWith("data:")&&!t.image.startsWith("blob:")).forEach(t=>{t.image&&r.push((async()=>{try{const i=new URL(t.image),m=window.location.origin;if(i.origin!==m){console.log(`üîÑ Pre-converting cross-origin image: ${t.image.substring(0,60)}...`);const h=await Z(t.image);h&&(o.set(t.image,h),console.log("‚úÖ Image pre-converted to base64"))}}catch(i){console.warn(`Error parsing image URL, attempting conversion: ${t.image.substring(0,60)}...`,i);const m=await Z(t.image);m&&o.set(t.image,m)}})())}),d.logo&&!d.logo.startsWith("data:")&&!d.logo.startsWith("blob:")&&r.push((async()=>{try{const t=new URL(d.logo),i=window.location.origin;if(t.origin!==i){console.log(`üîÑ Pre-converting cross-origin logo: ${d.logo.substring(0,60)}...`);const m=await Z(d.logo);m&&(o.set(d.logo,m),console.log("‚úÖ Logo pre-converted to base64"))}}catch(t){console.warn(`Error parsing logo URL, attempting conversion: ${d.logo.substring(0,60)}...`,t);const i=await Z(d.logo);i&&o.set(d.logo,i)}})()),await Promise.all(r),Se(o)})())},[f,a,d.logo]),z.useEffect(()=>{f&&a&&console.log("üìã Receipt Data:",{id:a.id,receiptNumber:a.receiptNumber,hasId:!!a.id,idType:typeof a.id,idValue:a.id})},[f,a]),!f)return null;const Ce=(s,o="portrait")=>{const r=o==="landscape";return{a4:{pageSize:"a4",orientation:o,margin:r?10:8,fontSize:{header:r?12:10,title:r?9:8,body:r?7:6,small:r?5:4},spacing:{section:r?4:3,item:r?3:2.5,line:r?3.5:3},logoSize:r?35:30,imageSize:r?24:20},letter:{pageSize:"letter",orientation:"portrait",margin:8,fontSize:{header:10,title:8,body:6,small:4},spacing:{section:3,item:2.5,line:3},logoSize:15,imageSize:20},a5:{pageSize:"a5",orientation:"portrait",margin:6,fontSize:{header:8,title:7,body:5,small:3.5},spacing:{section:2,item:2,line:2.5},logoSize:12,imageSize:16},legal:{pageSize:"legal",orientation:"portrait",margin:10,fontSize:{header:12,title:9,body:7,small:5},spacing:{section:4,item:3,line:3.5},logoSize:18,imageSize:24}}[s]},J=s=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),Fe=()=>{const s=document.createElement("style");s.id="receipt-print-styles",s.textContent=`
      @media print {
        body * {
          visibility: hidden;
        }
        [data-receipt-preview],
        [data-receipt-preview] * {
          visibility: visible;
        }
        [data-receipt-preview] {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          background: white;
          padding: 0;
          margin: 0;
          border: none;
          box-shadow: none;
        }
        @page {
          size: ${n} ${c};
          margin: 0;
        }
      }
    `,document.head.appendChild(s),window.print(),setTimeout(()=>{const o=document.getElementById("receipt-print-styles");o&&o.remove()},1e3)},ie=async s=>{const o=s.querySelectorAll("img");console.log(`üîÑ Found ${o.length} images to convert for PDF...`);const r=Array.from(o).map(async(t,i)=>{let m=t.src;if((m.startsWith("data:")||m.startsWith("blob:"))&&t.complete&&t.naturalWidth>0){console.log(`‚úÖ Image ${i+1} already base64/blob and loaded (${t.naturalWidth}x${t.naturalHeight}), skipping conversion`);return}const h=t.getAttribute("data-original-src")||t.getAttribute("src")||m;if(m.startsWith("data:")||m.startsWith("blob:"))return new Promise(g=>{if(t.complete&&t.naturalWidth>0){g();return}const w=setTimeout(()=>g(),5e3);t.onload=()=>{clearTimeout(w),console.log(`‚úÖ Image ${i+1} base64 image loaded`),g()},t.onerror=()=>{clearTimeout(w),console.warn(`‚ö†Ô∏è Image ${i+1} base64 image failed to load`),g()}});try{console.log(`üîÑ Converting image ${i+1} to base64: ${h.substring(0,60)}...`);const g=await Z(h);if(g)return new Promise(w=>{const b=setTimeout(()=>{t.complete&&t.naturalWidth>0?console.log(`‚úÖ Image ${i+1} loaded after timeout`):console.warn(`‚è±Ô∏è Image ${i+1} conversion timeout`),w()},1e4);t.onload=()=>{clearTimeout(b),t.naturalWidth>0&&t.naturalHeight>0?console.log(`‚úÖ Image ${i+1} converted and loaded successfully (${t.naturalWidth}x${t.naturalHeight})`):console.warn(`‚ö†Ô∏è Image ${i+1} loaded but has zero dimensions`),w()},t.onerror=()=>{clearTimeout(b),console.warn(`‚ö†Ô∏è Image ${i+1} failed to load after conversion`),w()},t.src=g,t.setAttribute("data-original-src",h),t.complete&&(clearTimeout(b),w())});console.warn(`‚ö†Ô∏è Failed to convert image ${i+1}, will try with html2canvas: ${h.substring(0,60)}...`)}catch(g){console.warn(`Error parsing image URL ${i+1}, attempting conversion: ${h.substring(0,60)}...`,g);const w=await Z(h);if(w)return new Promise(b=>{const y=setTimeout(()=>b(),1e4);t.onload=()=>{clearTimeout(y),b()},t.onerror=()=>{clearTimeout(y),b()},t.src=w,t.complete&&(clearTimeout(y),b())})}});await Promise.all(r),console.log("‚úÖ All images converted and loaded")},fe=async(s=!1)=>{try{const o=document.querySelector("[data-receipt-preview]"),r=o==null?void 0:o.parentElement;if(!o)return P.error("Receipt preview not found"),null;console.log("üîÑ Converting all images to base64 for PDF..."),await ie(o),console.log("‚úÖ Image conversion complete");const t=o.querySelectorAll("img");console.log(`üì∏ Verifying ${t.length} images are loaded for PDF...`);const i=Array.from(t).map((p,$)=>p.complete&&p.naturalWidth>0&&p.naturalHeight>0?(console.log(`‚úÖ Image ${$+1} already loaded (${p.naturalWidth}x${p.naturalHeight}):`,p.src.substring(0,50)),Promise.resolve()):new Promise(B=>{const _=setTimeout(()=>{p.complete&&p.naturalWidth>0?console.log(`‚úÖ Image ${$+1} loaded after timeout:`,p.src.substring(0,50)):console.warn(`‚è±Ô∏è Image ${$+1} load timeout:`,p.src.substring(0,50)),B()},1e4);p.onload=()=>{clearTimeout(_),p.naturalWidth>0&&p.naturalHeight>0?console.log(`‚úÖ Image ${$+1} loaded successfully (${p.naturalWidth}x${p.naturalHeight}):`,p.src.substring(0,50)):console.warn(`‚ö†Ô∏è Image ${$+1} loaded but has zero dimensions`),B()},p.onerror=()=>{clearTimeout(_),console.warn(`‚ùå Image ${$+1} failed to load:`,p.src.substring(0,50)),B()},p.complete&&(clearTimeout(_),B())}));await Promise.all(i),console.log("‚úÖ All images verified, capturing preview..."),await new Promise(p=>setTimeout(p,500));const m=Ce(n,c),h=window.getComputedStyle(o),g=r?window.getComputedStyle(r):null,w=o.getBoundingClientRect(),b=r==null?void 0:r.getBoundingClientRect();console.log("üìê Preview dimensions:",{previewWidth:o.scrollWidth,previewHeight:o.scrollHeight,previewOffsetWidth:o.offsetWidth,previewOffsetHeight:o.offsetHeight,previewRect:{width:w.width,height:w.height,top:w.top,left:w.left},containerRect:b?{width:b.width,height:b.height}:null}),console.log("üì∑ Capturing preview with html2canvas (100% match)...");const y=await ge(o,{scale:3,useCORS:!1,allowTaint:!0,logging:!1,backgroundColor:"#f9fafb",width:o.scrollWidth,height:o.scrollHeight,windowWidth:o.scrollWidth,windowHeight:o.scrollHeight,imageTimeout:2e4,removeContainer:!1,x:0,y:0,foreignObjectRendering:!1,onclone:p=>{const $=p.querySelector("[data-receipt-preview]");$&&(["transform","willChange","boxSizing","padding","margin","border","borderRadius","backgroundColor","boxShadow","width","height","display","flexDirection","alignItems","justifyContent","gap","fontSize","fontFamily","color","lineHeight","letterSpacing","textAlign","overflow"].forEach(_=>{const Y=h.getPropertyValue(_);Y&&$.style.setProperty(_,Y,"important")}),$.style.width=`${o.scrollWidth}px`,$.style.height=`${o.scrollHeight}px`,$.style.minWidth=`${o.scrollWidth}px`,$.style.minHeight=`${o.scrollHeight}px`)}}),F=y.toDataURL("image/png",1);console.log("‚úÖ Canvas captured, generating PDF (100% match)...");const v=new De(m.orientation,"mm",m.pageSize),H=v.internal.pageSize.getWidth(),N=v.internal.pageSize.getHeight();v.setFillColor(249,250,251),v.rect(0,0,H,N,"F");const X=parseFloat(h.paddingTop)||0,te=parseFloat(h.paddingBottom)||0,Me=parseFloat(h.paddingLeft)||0,K=parseFloat(h.paddingRight)||0,I=6.35,M=3,D=25.4/96,S=y.width/M*D,q=y.height/M*D,l=H-I*2,u=N-I*2;console.log("üìê Exact dimension calculations:",{pageWidth:H.toFixed(2),pageHeight:N.toFixed(2),containerPaddingMm:I.toFixed(2),availableWidth:l.toFixed(2),availableHeight:u.toFixed(2),previewWidthMm:S.toFixed(2),previewHeightMm:q.toFixed(2),canvasWidth:y.width,canvasHeight:y.height,scaleFactor:M});const R=l/S,U=u/q,L=Math.min(R,U,1);let T=S*L,W=q*L;const le=I+(l-T)/2,ce=I+(u-W)/2;if(console.log("‚úÖ PDF will match preview 100%:",{scale:L===1?"1:1 (100% match)":`${(L*100).toFixed(1)}%`,previewSize:`${S.toFixed(2)}mm √ó ${q.toFixed(2)}mm`,finalSize:`${T.toFixed(2)}mm √ó ${W.toFixed(2)}mm`,margins:`${I.toFixed(2)}mm on all sides`,background:"#f9fafb (exact match)"}),console.log("üìè Final PDF dimensions (100% match):",{finalWidth:T.toFixed(2),finalHeight:W.toFixed(2),scale:L.toFixed(3),xOffset:le.toFixed(2),yOffset:ce.toFixed(2),containerPaddingMm:I.toFixed(2),availableWidth:l.toFixed(2),availableHeight:u.toFixed(2),pages:Math.ceil(W/u)}),W<=u)v.addImage(F,"PNG",le,ce,T,W,void 0,"FAST");else{let p=0,$=0,B=0;for(;p<W;){const _=W-p,Y=Math.min(u,_),oe=Y/W*y.height,re=document.createElement("canvas");re.width=y.width,re.height=oe;const ve=re.getContext("2d");if(ve){ve.drawImage(y,0,$,y.width,oe,0,0,y.width,oe);const ze=re.toDataURL("image/png",1),Ae=B===0?ce:I;v.addImage(ze,"PNG",le,Ae,T,Y,void 0,"FAST")}$+=oe,p+=Y,B++,p<W&&(v.addPage(),v.setFillColor(249,250,251),v.rect(0,0,H,N,"F"))}}const se=v.output("blob"),de=se.size,We=(de/1024).toFixed(2),Ee=(de/(1024*1024)).toFixed(2);if(console.log("üìÑ PDF Generated:",{size:`${Ee} MB (${We} KB)`,bytes:de,pages:v.internal.pages.length,quality:"High (scale: 3x)"}),!s)return{blob:se};const me=new File([se],`receipt-${a.receiptNumber}.pdf`,{type:"application/pdf"}),ae=`receipts/${Date.now()}-${a.receiptNumber}.pdf`;console.log("üì§ Uploading PDF to storage...");let we=null,V="whatsapp-media",{data:be,error:E}=await G.storage.from(V).upload(ae,me,{cacheControl:"3600",upsert:!1});if(E){console.warn("‚ö†Ô∏è whatsapp-media bucket failed, trying receipts bucket...",E.message),we=E,V="receipts";const p=await G.storage.from(V).upload(ae,me,{cacheControl:"3600",upsert:!1});be=p.data,E=p.error}if(E){console.warn("‚ö†Ô∏è receipts bucket failed, trying public-files bucket...",E.message),we=E,V="public-files";const p=await G.storage.from(V).upload(ae,me,{cacheControl:"3600",upsert:!1});be=p.data,E=p.error}if(E)throw new Error(`Failed to upload PDF to any bucket. Last error: ${E.message}. Please ensure at least one of these buckets exists: whatsapp-media, receipts, or public-files`);const{data:ye}=G.storage.from(V).getPublicUrl(ae);return console.log(`‚úÖ PDF uploaded successfully to ${V}:`,ye.publicUrl),{blob:se,url:ye.publicUrl}}catch(o){throw console.error("Error generating/uploading PDF:",o),o}},Re=async()=>{const s=await fe(!0);return(s==null?void 0:s.url)||null},Te=async(s=!1)=>{ue(!0);let o=null;try{const r=()=>{if(Q.current&&Q.current.isConnected)return Q.current;const l=document.querySelector("[data-receipt-preview]");return l&&l.isConnected?(Q.current=l,l):null};let t=r();if(!t&&(await new Promise(l=>setTimeout(l,100)),t=r(),!t&&(await new Promise(l=>setTimeout(l,200)),t=r(),!t)))throw new Error("Receipt preview element is no longer in the DOM");if(!f||!t.isConnected)throw new Error("Receipt preview element is no longer in the DOM");const i=t.getBoundingClientRect(),m=Math.max(t.scrollWidth,t.offsetWidth,i.width,800),h=Math.max(t.scrollHeight,t.offsetHeight,i.height,600);if(m===0||h===0)throw new Error("Receipt preview has invalid dimensions");const g=t.cloneNode(!0);g.setAttribute("data-receipt-preview-clone","true"),g.style.position="absolute",g.style.left="-9999px",g.style.top="0",g.style.width=`${m}px`,g.style.height=`${h}px`,g.style.visibility="hidden",g.style.pointerEvents="none",document.body.appendChild(g),console.log("üîÑ Converting images to base64 for PNG..."),await ie(t),await ie(g),console.log("‚úÖ Image conversion complete");const w=t.querySelectorAll("img");console.log(`üì∏ Found ${w.length} images to load for PNG...`);const b=Array.from(w).map((l,u)=>l.complete&&l.naturalWidth>0&&l.naturalHeight>0?(console.log(`‚úÖ Image ${u+1} already loaded:`,l.src.substring(0,50)),Promise.resolve()):new Promise(R=>{const U=setTimeout(()=>{l.complete&&l.naturalWidth>0?console.log(`‚úÖ Image ${u+1} loaded after timeout`):console.warn(`‚è±Ô∏è Image ${u+1} load timeout`),R()},1e4);l.onload=()=>{clearTimeout(U),l.naturalWidth>0&&l.naturalHeight>0&&console.log(`‚úÖ Image ${u+1} loaded successfully (${l.naturalWidth}x${l.naturalHeight})`),R()},l.onerror=()=>{clearTimeout(U),console.warn(`‚ùå Image ${u+1} failed to load`),R()},l.complete&&(clearTimeout(U),R())}));if(await Promise.all(b),console.log("‚úÖ All images verified, capturing PNG..."),await new Promise(l=>setTimeout(l,500)),console.log("üì∑ Capturing preview as PNG..."),t=r(),!t)throw new Error("Receipt preview element is no longer in the DOM");if(!f)throw new Error("Receipt modal was closed during PNG generation");t.scrollIntoView({behavior:"instant",block:"start"}),await new Promise(l=>setTimeout(l,100));const y=window.getComputedStyle(t),F=Math.max(t.scrollWidth,t.offsetWidth,800),v=Math.max(t.scrollHeight,t.offsetHeight,600);if(F===0||v===0)throw new Error(`Receipt preview has invalid dimensions: ${F}x${v}. Please ensure the receipt is visible.`);console.log(`üìê Preview dimensions: ${F}x${v}`);const H=t.getBoundingClientRect();if(H.width===0||H.height===0)throw new Error("Receipt preview element has zero size. Please ensure it is visible on screen.");if(t=r(),!t)throw new Error("Receipt preview element disappeared before capture");if(!f)throw new Error("Receipt modal was closed before capture");let N;try{const l={scale:2,useCORS:!0,allowTaint:!1,logging:!1,backgroundColor:"#ffffff",width:F,height:v,imageTimeout:3e4,removeContainer:!1};l.onclone=(U,L)=>{try{if(L&&L instanceof HTMLElement){const T=L;T.style.width=`${F}px`,T.style.height=`${v}px`,T.style.minWidth=`${F}px`,T.style.minHeight=`${v}px`}}catch(T){console.warn("Error in onclone callback (non-critical):",T)}},console.log("üì∏ Starting html2canvas with options:",{scale:l.scale,width:F,height:v});let u=0;const R=3;for(;u<R&&(t=r(),!(t&&t.isConnected&&f));)u<R-1&&await new Promise(U=>setTimeout(U,100)),u++;if(!t||!t.isConnected||!f)throw new Error("Receipt preview element is no longer in the DOM");if(!f)throw new Error("Receipt modal was closed before html2canvas could capture");if(N=await ge(t,l),!N||N.width===0||N.height===0)throw new Error("Canvas generation failed: invalid dimensions");console.log("‚úÖ Canvas generated successfully:",{width:N.width,height:N.height})}catch(l){console.error("html2canvas error details:",{message:l==null?void 0:l.message,stack:l==null?void 0:l.stack,name:l==null?void 0:l.name});try{console.log("üîÑ Retrying with minimal configuration...");let u=t;if(t=r(),!t||!t.isConnected||!f?(console.warn("‚ö†Ô∏è Using cloned element for fallback capture"),u=g):u=t,N=await ge(u,{scale:1,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",logging:!0}),!N||N.width===0||N.height===0)throw new Error("Fallback canvas generation also failed");console.log("‚úÖ Fallback canvas generation succeeded")}catch(u){const R=(l==null?void 0:l.message)||(u==null?void 0:u.message)||"Unknown error";throw console.error("Both html2canvas attempts failed:",{first:l==null?void 0:l.message,fallback:u==null?void 0:u.message}),R.includes("no longer in the DOM")||R.includes("not found")?new Error("Receipt preview is not available. Please close and reopen the receipt modal."):new Error(`Failed to capture receipt preview: ${R}. The receipt preview may not be fully rendered. Please wait a moment and try again.`)}}const X=await new Promise(l=>{N.toBlob(u=>{u?(console.log("‚úÖ PNG generated successfully:",{size:`${(u.size/(1024*1024)).toFixed(2)} MB`,dimensions:`${N.width}x${N.height}`}),l(u)):(console.error("Failed to generate PNG blob"),l(null))},"image/png",1)});if(!X)return null;if(!s)return{blob:X};const te=new File([X],`receipt-${a.receiptNumber}.png`,{type:"image/png"}),K=`receipts/${Date.now()}-${a.receiptNumber}.png`;console.log("üì§ Uploading PNG to storage...");let I=null,M="whatsapp-media",{data:D,error:S}=await G.storage.from(M).upload(K,te,{cacheControl:"3600",upsert:!1});if(S){console.warn("‚ö†Ô∏è whatsapp-media bucket failed, trying receipts bucket...",S.message),I=S,M="receipts";const l=await G.storage.from(M).upload(K,te,{cacheControl:"3600",upsert:!1});D=l.data,S=l.error}if(S){console.warn("‚ö†Ô∏è receipts bucket failed, trying public-files bucket...",S.message),I=S,M="public-files";const l=await G.storage.from(M).upload(K,te,{cacheControl:"3600",upsert:!1});D=l.data,S=l.error}if(S)throw new Error(`Failed to upload PNG to any bucket. Last error: ${S.message}`);const{data:q}=G.storage.from(M).getPublicUrl(K);return console.log(`‚úÖ PNG uploaded successfully to ${M}:`,q.publicUrl),{blob:X,url:q.publicUrl}}catch(r){const t=(r==null?void 0:r.message)||"Unknown error occurred";throw console.error("Error generating/uploading PNG:",{message:t,error:r,stack:r==null?void 0:r.stack}),t.includes("not found")||t.includes("no longer in the DOM")?new Error("Receipt preview is not available. Please close and reopen the receipt modal."):t.includes("invalid dimensions")||t.includes("zero size")?new Error("Receipt preview is not visible. Please ensure the receipt is fully displayed on screen."):t.includes("Failed to capture")?r:new Error(`Failed to generate PNG: ${t}. Please try again or use PDF download instead.`)}finally{ue(!1);try{o&&o.parentNode,document.querySelectorAll("[data-receipt-preview-clone]").forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)})}catch(r){console.warn("Error cleaning up cloned element:",r)}}},ee=()=>{const s=[`üßæ *Receipt #${a.receiptNumber}*`,""];if(a.customerName?s.push(`Hello ${a.customerName}! üëã`):s.push("Hello! üëã"),s.push(""),s.push(`*${d.name}*`),s.push(""),a.items&&a.items.length>0){const o=a.items.reduce((t,i)=>t+i.quantity,0);s.push(`üì¶ *${o} item${o>1?"s":""}* purchased`),a.items.slice(0,3).forEach(t=>{const i=t.variantName&&t.variantName!=="Default"?`${t.productName} - ${t.variantName}`:t.productName;s.push(`   ‚Ä¢ ${i}${t.quantity>1?` (x${t.quantity})`:""}`)}),a.items.length>3&&s.push(`   ... and ${a.items.length-3} more item${a.items.length-3>1?"s":""}`)}return s.push(""),s.push(`üí∞ *Total: ${a.amount.toLocaleString()} TZS*`),s.push(""),s.push("üìÑ *View the attached PDF receipt for:*"),s.push("   ‚Ä¢ Complete item details"),s.push("   ‚Ä¢ Serial numbers & specifications"),s.push("   ‚Ä¢ Payment information"),s.push("   ‚Ä¢ Business contact details"),s.push(""),s.push("‚ú® Thank you for your purchase!"),s.join(`
`)},Ie=[{name:"WhatsApp",icon:_e,color:"#25D366",onClick:async()=>{const s=a.customerPhone||"";if(!s){P.error("No customer phone number available");return}const o=s.replace(/[^0-9+]/g,"");x(!0),C("WhatsApp");try{console.log("üì± Generating PDF receipt...");const r=await Re();if(!r){P.error("Failed to generate PDF receipt"),x(!1),C("");return}console.log("üì§ Sending receipt PDF via WhatsApp API to:",o);const t=ee(),i=`üßæ Receipt #${a.receiptNumber}

${t}`,m=await Ze.sendMessage(o,i,{message_type:"document",media_url:r,caption:i});m.success?(ne.show(`Receipt PDF sent successfully to ${s} via WhatsApp!`,{title:"WhatsApp Sent! ‚úÖ",icon:je.messageSent,autoCloseDelay:3e3}),setTimeout(()=>{A()},500)):P.error(m.error||"Failed to send WhatsApp message")}catch(r){console.error("Error sending WhatsApp:",r),P.error("Failed to send WhatsApp. Please try again.")}finally{x(!1),C("")}}},{name:"SMS",icon:Ge,color:"#0088cc",onClick:async()=>{const s=ee(),o=a.customerPhone;if(!o){P.error("No customer phone number available");return}const r=o.replace(/[^0-9+]/g,"");x(!0),C("SMS");try{console.log("üì± Sending receipt via SMS to:",r);const{smartNotificationService:t}=await He(()=>import("./smartNotificationService-2a2d3be1.js"),["assets/smartNotificationService-2a2d3be1.js","assets/supabase-cf010ec4.js","assets/whatsappService-09f99080.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css","assets/notificationSettingsService-1df2b297.js","assets/format-aff4c6a2.js","assets/formatPhoneForInvoice-e7084c6d.js"]),i=await t.sendNotification(r,s);if(i.success){const m=i.method==="whatsapp"?"WhatsApp":"SMS";ne.show(`Receipt sent successfully to ${o} via ${m}!`,{title:`${m} Sent! ‚úÖ`,icon:je.messageSent,autoCloseDelay:3e3}),setTimeout(()=>{A()},500)}else P.error(i.error||"Failed to send message")}catch(t){console.error("Error sending SMS:",t),P.error("Failed to send SMS. Please try again.")}finally{x(!1),C("")}}},{name:"Email",icon:Oe,color:"#EA4335",onClick:()=>{const s=`Receipt #${a.receiptNumber}`,o=ee(),t=`mailto:${a.customerEmail||""}?subject=${encodeURIComponent(s)}&body=${encodeURIComponent(o)}`;window.location.href=t}},{name:"Print",icon:qe,color:"#F59E0B",onClick:()=>{Fe()}},{name:"Download",icon:Ve,color:"#8B5CF6",onClick:async()=>{try{x(!0),C("Download");const s=await fe(!1);if(s&&s.blob){const o=URL.createObjectURL(s.blob),r=document.createElement("a");r.href=o,r.download=`receipt-${a.receiptNumber}.pdf`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),P.success("Receipt downloaded as PDF")}else P.error("Failed to generate PDF");x(!1),C("")}catch(s){console.error("Error generating PDF:",s),P.error("Failed to generate PDF. Please try again."),x(!1),C("")}}},{name:"Download PNG",icon:Ye,color:"#06B6D4",onClick:async()=>{try{x(!0),C("Download PNG"),console.log("üì∏ Generating PNG image...");const s=await Te(!1);if(s&&s.blob){const o=URL.createObjectURL(s.blob),r=document.createElement("a");r.href=o,r.download=`receipt-${a.receiptNumber}.png`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),P.success("Receipt downloaded as PNG")}else P.error("Failed to generate PNG");x(!1),C("")}catch(s){console.error("Error generating PNG:",s);const o=(s==null?void 0:s.message)||"Unknown error";P.error(o.length>100?"Failed to generate PNG. Please try again.":o),x(!1),C("")}}},{name:"Share",icon:Ne,color:"#10B981",onClick:async()=>{const s=ee();if(navigator.share)try{await navigator.share({title:`Receipt #${a.receiptNumber}`,text:s})}catch(o){console.log("Share cancelled or failed:",o)}else alert("Share feature not supported in this browser. Please use WhatsApp, SMS, or Email buttons instead.")}}];return Le.createPortal(e.jsxs("div",{children:[e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.2s ease-out;
        }
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
      `}),e.jsx("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center bg-black/40 animate-fadeIn",onClick:()=>{!he&&!j?A():P.info("Please wait for the operation to complete before closing")},children:e.jsxs("div",{className:`bg-white rounded-2xl w-full shadow-2xl overflow-hidden relative animate-slideUp max-h-[90vh] flex flex-col ${n==="a4"&&c==="landscape"?"max-w-6xl":"max-w-2xl"}`,onClick:s=>s.stopPropagation(),style:{margin:"auto"},children:[e.jsx("button",{onClick:()=>{!he&&!j?A():P.info("Please wait for the operation to complete before closing")},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-10",children:e.jsx(Ue,{className:"w-5 h-5",strokeWidth:2})}),e.jsxs("div",{className:"p-6 text-center bg-gradient-to-br from-green-50 to-emerald-50 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Receipt Preview"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Receipt #",a.receiptNumber]}),n==="a4"&&e.jsx("div",{className:"mb-4",children:e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold",children:[c==="portrait"?"üìÑ Portrait Mode":"üìÑ Landscape Mode",e.jsx("span",{className:"text-green-600",children:"‚Ä¢"}),e.jsx("span",{children:"A4 Format"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Page Size:"}),e.jsxs("select",{value:n,onChange:s=>$e(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm font-medium text-gray-700 hover:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",children:[e.jsx("option",{value:"a4",children:"A4 (210 √ó 297 mm)"}),e.jsx("option",{value:"letter",children:"Letter (8.5 √ó 11 in)"}),e.jsx("option",{value:"a5",children:"A5 (148 √ó 210 mm)"}),e.jsx("option",{value:"legal",children:"Legal (8.5 √ó 14 in)"})]})]}),n==="a4"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Orientation:"}),e.jsxs("select",{value:c,onChange:s=>{const o=s.target.value;Pe(o),console.log("Orientation changed to:",o)},className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm font-medium text-gray-700 hover:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",children:[e.jsx("option",{value:"portrait",children:"Portrait (Vertical)"}),e.jsx("option",{value:"landscape",children:"Landscape (Horizontal)"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:c==="portrait"?"üìÑ Vertical":"üìÑ Horizontal"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gradient-to-br from-gray-100 via-gray-50 to-gray-100 flex items-center justify-center",style:{minHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{ref:Q,"data-receipt-preview":!0,className:`bg-white rounded-3xl border-4 border-gray-300 shadow-2xl mx-auto my-auto p-8 transition-all duration-300 ${n==="a5"?"max-w-md":n==="legal"?"max-w-3xl":n==="a4"&&c==="landscape"?"w-full max-w-full":"max-w-2xl"}`,style:{boxShadow:"0 20px 60px -15px rgba(0, 0, 0, 0.3), 0 10px 30px -10px rgba(0, 0, 0, 0.2)",margin:"auto",alignSelf:"center"},style:{...n==="a4"&&c==="landscape"?{aspectRatio:"297/210",minHeight:"auto"}:n==="a4"&&c==="portrait"?{aspectRatio:"210/297"}:{},backgroundColor:"#ffffff"},children:[e.jsx("div",{className:`mb-4 pb-3 border-b-2 border-gray-300 ${n==="a4"&&c==="landscape"?"mb-3 pb-2":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-gray-500 font-medium ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:"Receipt Number:"}),e.jsxs("h1",{className:`font-extrabold text-gray-900 ${n==="a4"&&c==="landscape"?"text-xl":"text-2xl"}`,children:["#",a.receiptNumber]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`text-gray-500 font-medium ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:new Date().toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}),e.jsx("div",{className:`text-gray-600 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})]})}),e.jsxs("div",{className:`flex items-start gap-4 ${n==="a4"&&c==="landscape"?"mb-4":"mb-6"}`,children:[d.logo?e.jsx("img",{src:pe.get(d.logo)||d.logo,"data-original-src":d.logo,crossOrigin:"anonymous",referrerPolicy:"no-referrer-when-downgrade",alt:d.name,className:`object-contain flex-shrink-0 ${n==="a4"&&c==="landscape"?"h-32":"h-36"}`,loading:"eager",onLoad:()=>{},onError:s=>{var o;console.error("‚ùå Logo failed to load:",(o=d.logo)==null?void 0:o.substring(0,50)),s.currentTarget.style.display="none"}}):e.jsx("div",{className:`font-bold text-gray-900 uppercase tracking-wide flex-shrink-0 ${n==="a4"&&c==="landscape"?"text-5xl":"text-6xl"}`,children:d.name}),e.jsx("div",{className:"flex-1",children:(()=>{const s=a.id&&a.id.trim()!==""?a.id:a.receiptNumber,o=s&&s.trim()!=="";a.customerName||a.customerPhone||a.customerEmail||a.customerCity||a.customerTag||a.id;let r="grid-cols-1";return o&&(r="grid-cols-2"),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`grid gap-4 ${r}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:`font-bold text-gray-900 uppercase mb-0 ${n==="a4"&&c==="landscape"?"text-2xl":"text-3xl"}`,children:d.name}),e.jsxs("div",{className:"space-y-2 mt-2",children:[d.address&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:`text-gray-500 mt-0.5 flex-shrink-0 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:"üìç"}),e.jsx("span",{className:`text-gray-700 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:d.address})]}),d.phone&&(()=>{const t=typeof d.phone=="string"?d.phone:JSON.stringify(d.phone),i=Ke(t);return i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-gray-500 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:"üìû"}),e.jsx("span",{className:`text-gray-700 font-medium ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:i})]}):null})(),d.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-gray-500 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:"‚úâÔ∏è"}),e.jsx("span",{className:`text-gray-700 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:d.email})]}),d.website&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-gray-500 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:"üåê"}),e.jsx("span",{className:`text-gray-700 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:d.website})]})]}),(d.instagram||d.tiktok||d.whatsapp)&&e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsx("div",{className:`font-semibold text-gray-600 mb-1 ${n==="a4"&&c==="landscape"?"text-xs":"text-sm"}`,children:"Follow Us"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.instagram&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg text-xs font-medium",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})}),e.jsxs("span",{children:["@",d.instagram.replace("@","").replace("https://instagram.com/","").replace("https://www.instagram.com/","")]})]}),d.tiktok&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-gray-900 text-white rounded-lg text-xs font-medium",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"})}),e.jsxs("span",{children:["@",d.tiktok.replace("@","").replace("https://tiktok.com/@","").replace("https://www.tiktok.com/@","")]})]}),d.whatsapp&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg text-xs font-medium",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})}),e.jsx("span",{children:d.whatsapp.replace(/[^0-9+]/g,"")})]})]})]})]}),o&&e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(s)}`,alt:"Sale Tracking QR Code",className:`border-2 border-gray-300 rounded-lg bg-white p-2 ${n==="a4"&&c==="landscape"?"w-24 h-24":"w-28 h-28"}`,onError:t=>{console.error("‚ùå QR code failed to load for:",s),t.currentTarget.style.display="none"},onLoad:()=>{}})})]}),(a.customerName||a.customerPhone||a.customerEmail||a.customerCity||a.customerTag||a.id)&&e.jsxs("div",{className:`border-t-2 border-dashed border-gray-300 ${n==="a4"&&c==="landscape"?"mt-4 pt-4":"mt-3 pt-3"}`,children:[e.jsx("div",{className:`mb-2 ${n==="a4"&&c==="landscape"?"mb-3":""}`,children:e.jsx("span",{className:`font-bold text-gray-600 uppercase ${n==="a4"&&c==="landscape"?"text-sm":"text-xs"}`,children:"Bill To:"})}),a.customerName&&e.jsx("h3",{className:`font-semibold text-gray-700 uppercase mb-0 ${n==="a4"&&c==="landscape"?"text-2xl mb-2":"text-base mb-1"}`,children:a.customerName}),e.jsxs("div",{className:`grid ${n==="a4"&&c==="landscape"?"grid-cols-2 gap-2 mt-2":"grid-cols-2 gap-x-3 gap-y-1 mt-1"}`,children:[a.customerPhone&&e.jsxs("div",{className:`flex items-center ${n==="a4"&&c==="landscape"?"gap-2 justify-start":"gap-1.5 justify-start"}`,children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"üìû"}),e.jsx("span",{className:"text-gray-700 font-medium text-xs",children:a.customerPhone})]}),a.customerEmail&&e.jsxs("div",{className:`flex items-center ${n==="a4"&&c==="landscape"?"gap-2 justify-start":"gap-1.5 justify-start"}`,children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"‚úâÔ∏è"}),e.jsx("span",{className:"text-gray-700 text-xs",children:a.customerEmail})]}),a.customerCity&&e.jsxs("div",{className:`flex items-center ${n==="a4"&&c==="landscape"?"gap-2 justify-start":"gap-1.5 justify-start"}`,children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"üìç"}),e.jsx("span",{className:"text-gray-700 text-xs",children:a.customerCity})]}),a.customerTag&&e.jsx("div",{className:`flex items-center ${n==="a4"&&c==="landscape"?"gap-2 justify-end":"gap-1.5 justify-start"}`,children:e.jsx("span",{className:`inline-flex items-center rounded text-xs font-medium ${a.customerTag.toLowerCase()==="vip"?"bg-purple-100 text-purple-700":a.customerTag.toLowerCase()==="new"?"bg-blue-100 text-blue-700":a.customerTag.toLowerCase()==="complainer"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"} text-[10px] px-1.5 py-0.5`,children:a.customerTag.toUpperCase()})})]})]})]})})()})]}),e.jsx("div",{className:`border-t border-dashed border-gray-300 ${n==="a4"&&c==="landscape"?"my-3":"my-6"}`}),e.jsx("div",{className:`${n==="a4"&&c==="landscape"?"mb-2":"mb-4"} ${n==="a4"&&c==="landscape"?a.items&&a.items.length===1?"space-y-2":"grid grid-cols-2 gap-2":"space-y-3"}`,children:a.items&&a.items.length>0?a.items.map((s,o)=>{const r=s.variantName&&s.variantName!=="Default"?`${s.productName} - ${s.variantName}`:s.productName,t=a.items&&a.items.length===1,i=n==="a4"&&c==="landscape";return e.jsx("div",{className:"border-2 border-gray-200 rounded-2xl bg-white shadow-sm hover:border-gray-300 hover:shadow-md transition-all duration-300",children:e.jsxs("div",{className:`${i&&!t?"p-2":"p-3"}`,children:[e.jsxs("div",{className:`flex items-start ${i&&!t?"flex-col gap-1 mb-1":"gap-2 mb-2"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:s.image&&!ke.has(s.image)?e.jsx("img",{src:pe.get(s.image)||s.image,alt:r,"data-original-src":s.image,className:`object-cover rounded-lg ${i&&!t?"w-full h-20":i&&t?"w-28 h-28":"w-32 h-32"}`,loading:"eager",crossOrigin:"anonymous",referrerPolicy:"no-referrer-when-downgrade",onLoad:()=>{},onError:m=>{s.image&&xe(h=>new Set(h).add(s.image)),m.currentTarget.style.display="none"}}):e.jsxs("div",{className:`bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ${i&&!t?"w-full h-20":i&&t?"w-28 h-28":"w-32 h-32"}`,children:[e.jsx("span",{className:"text-lg text-gray-400 mb-1",children:"üì¶"}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"No Image"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`flex items-center ${i&&!t?"flex-col items-start gap-0.5 mb-0.5":"gap-2 mb-1"}`,children:[e.jsx("h4",{className:`font-bold text-gray-900 ${i&&!t?"text-xs":"text-lg"}`,children:r}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full font-bold bg-green-500 text-white shadow-sm ${i&&!t?"px-1.5 py-0.5 text-[10px]":"px-2.5 py-1 text-xs"}`,children:["Qty: ",s.quantity]})]}),e.jsxs("div",{className:i&&!t?"mb-0.5":"mb-1",children:[e.jsx("span",{className:`text-gray-600 ${i&&!t?"text-xs":"text-sm"}`,children:"Unit: "}),e.jsx("span",{className:`font-semibold text-gray-900 ${i&&!t?"text-xs":"text-sm"}`,children:J(s.unitPrice)})]}),s.attributes&&Object.keys(s.attributes).length>0&&(()=>{const m=[];return Object.entries(s.attributes).forEach(([h,g])=>{const w=["id","created_at","updated_at","added_at","variant_id","product_id","imei","serial_number","is_legacy","is_imei_child","notes","parent_variant_name","data_source","created_without_po"];if(!w.includes(h)&&!(!g||g===""||g===null||g===void 0))if(h==="specification")try{const b=typeof g=="string"?JSON.parse(g):g;typeof b=="object"&&b!==null&&!Array.isArray(b)&&Object.entries(b).forEach(([y,F])=>{if(w.includes(y)||!F||F===""||F===null)return;const v=y.replace(/_/g," ").replace(/\b\w/g,H=>H.toUpperCase());m.push({key:`${h}-${y}`,label:v,value:String(F)})})}catch{}else{if(typeof g=="object"&&g!==null)return;const b=h.replace(/_/g," ").replace(/\b\w/g,y=>y.toUpperCase());m.push({key:h,label:b,value:String(g)})}}),m.length===0?null:e.jsx("div",{className:`flex flex-wrap ${i&&!t?"gap-0.5 mt-0.5":"gap-1 mt-1"}`,children:m.map(h=>e.jsxs("div",{className:`inline-flex items-center bg-gray-50 rounded border border-gray-200 ${i&&!t?"gap-0.5 px-1 py-0.5":"gap-1.5 px-2 py-1"}`,children:[e.jsxs("span",{className:`font-semibold text-gray-600 ${i&&!t?"text-[9px]":"text-[10px]"}`,children:[h.label,":"]}),e.jsx("span",{className:`text-gray-900 font-medium ${i&&!t?"text-[9px]":"text-[10px]"}`,children:h.value})]},h.key))})})()]})]}),s.selectedSerialNumbers&&s.selectedSerialNumbers.length>0&&e.jsx("div",{className:`bg-gray-50 rounded-lg border border-gray-200 ${i&&!t?"p-1 mt-1":"p-2 mt-2"}`,children:s.selectedSerialNumbers.map((m,h)=>{const g=[];return m.serial_number&&g.push(`S/N: ${m.serial_number}`),m.imei&&g.push(`IMEI: ${m.imei}`),m.mac_address&&g.push(`MAC: ${m.mac_address}`),g.length>0?e.jsxs("div",{className:`text-gray-600 ${i&&!t?"text-xs mb-0.5":"text-sm mb-1"}`,children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Serial: "}),e.jsx("span",{className:"font-mono",children:g.join(" | ")})]},h):null})})]})},o)}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"No items"})}),e.jsx("div",{className:`border-t border-dashed border-gray-300 ${n==="a4"&&c==="landscape"?"my-3":"my-6"}`}),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:`font-bold text-gray-900 mb-3 ${n==="a4"&&c==="landscape"?"text-sm":"text-base"}`,children:"SUMMARY"}),e.jsxs("div",{className:`space-y-2 ${n==="a4"&&c==="landscape"?"text-sm":"text-base"}`,children:[a.sellerName&&e.jsx("div",{className:"space-y-1",children:e.jsx("div",{className:"text-gray-600 text-xs",children:e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Seller:"})," ",a.sellerName]})})}),e.jsx("div",{className:"border-t border-gray-300 my-2"}),a.items&&a.items.length>0&&e.jsxs("div",{className:"flex justify-between items-center text-gray-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-semibold",children:J(a.subtotal||a.items.reduce((s,o)=>s+o.totalPrice,0))})]}),a.tax!==void 0&&a.tax>0&&e.jsxs("div",{className:"flex justify-between items-center text-gray-700",children:[e.jsx("span",{children:"Tax (VAT)"}),e.jsx("span",{className:"font-semibold",children:J(a.tax)})]}),a.discount!==void 0&&a.discount>0&&e.jsxs("div",{className:"flex justify-between items-center text-green-700",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{className:"font-semibold",children:["-",J(a.discount)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-gray-700",children:[e.jsx("span",{children:"Delivery"}),e.jsx("span",{className:"font-semibold",children:"TSh 0"})]}),a.paymentMethod&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-gray-300 my-2"}),e.jsxs("div",{className:"flex justify-between items-center text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Payment Method:"}),e.jsx("span",{className:"font-semibold",children:typeof a.paymentMethod=="string"?a.paymentMethod:a.paymentMethod.name||"N/A"})]})]}),e.jsx("div",{className:"border-t-2 border-gray-400 my-3"}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 -mx-2 px-2 py-2 rounded-lg",children:[e.jsx("span",{className:`font-extrabold text-gray-900 ${n==="a4"&&c==="landscape"?"text-xl":"text-2xl"}`,children:"Total Amount"}),e.jsx("span",{className:`font-extrabold text-gray-900 ${n==="a4"&&c==="landscape"?"text-xl":"text-2xl"}`,children:J(a.amount)})]})]})]})}),(d.instagram||d.tiktok||d.whatsapp)&&e.jsxs("div",{className:`bg-gray-50 rounded-xl border-2 border-gray-200 ${n==="a4"&&c==="landscape"?"p-3 mb-2":"p-6 mb-6"}`,children:[e.jsxs("h4",{className:`font-bold text-gray-900 flex items-center gap-2 ${n==="a4"&&c==="landscape"?"text-xs mb-2":"text-sm mb-4"}`,children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center shadow-sm",children:e.jsx(Ne,{className:"w-3.5 h-3.5 text-white"})}),"Follow Us"]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[d.instagram&&e.jsxs("a",{href:`https://instagram.com/${d.instagram.replace("@","").replace("https://instagram.com/","").replace("https://www.instagram.com/","")}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl text-sm font-semibold hover:from-purple-600 hover:to-pink-600 transition-all shadow-sm hover:shadow-md",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})}),"@",d.instagram.replace("@","").replace("https://instagram.com/","").replace("https://www.instagram.com/","")]}),d.tiktok&&e.jsxs("a",{href:`https://tiktok.com/@${d.tiktok.replace("@","").replace("https://tiktok.com/@","").replace("https://www.tiktok.com/@","")}`,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center gap-2 bg-gray-900 text-white rounded-lg font-semibold hover:bg-gray-800 transition-all shadow-sm hover:shadow-md ${n==="a4"&&c==="landscape"?"px-2 py-1 text-xs":"px-4 py-2.5 text-sm"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"})}),"@",d.tiktok.replace("@","").replace("https://tiktok.com/@","").replace("https://www.tiktok.com/@","")]}),d.whatsapp&&e.jsxs("a",{href:`https://wa.me/${d.whatsapp.replace(/[^0-9]/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center gap-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all shadow-sm hover:shadow-md ${n==="a4"&&c==="landscape"?"px-2 py-1 text-xs":"px-4 py-2.5 text-sm"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})}),d.whatsapp.replace(/[^0-9+]/g,"")]})]})]})]})}),j&&e.jsxs("div",{className:"absolute inset-0 bg-white/95 rounded-2xl flex flex-col items-center justify-center z-10",children:[e.jsx(Be,{size:48,color:"#0088cc",className:"animate-spin"}),e.jsxs("p",{className:"mt-4 text-base font-semibold text-gray-700",children:["Sending ",O,"..."]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Please wait"}),e.jsx("style",{children:`
              @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
              }
              .animate-spin {
                animation: spin 1s linear infinite;
              }
            `})]}),e.jsxs("div",{className:"p-6 bg-white border-t border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 text-center",children:"Share Options"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{opacity:j?.5:1,pointerEvents:j?"none":"auto"},children:Ie.map((s,o)=>{const r=s.icon,t=s.name==="SMS",i=s.name==="WhatsApp";return e.jsxs("button",{onClick:()=>{t||i?s.onClick():(s.onClick(),setTimeout(()=>A(),500))},disabled:j,className:"flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl bg-white cursor-pointer transition-all hover:-translate-y-1 hover:shadow-lg disabled:cursor-not-allowed disabled:opacity-60",style:{opacity:j?.6:1},onMouseEnter:m=>{j||(m.currentTarget.style.borderColor=s.color,m.currentTarget.style.background=`${s.color}08`,m.currentTarget.style.boxShadow=`0 8px 16px ${s.color}20`)},onMouseLeave:m=>{j||(m.currentTarget.style.borderColor="#e5e7eb",m.currentTarget.style.background="#fff")},children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mb-2",style:{background:`${s.color}15`},children:e.jsx(r,{size:24,color:s.color,strokeWidth:2})}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:s.name})]},o)})})]})]})}),e.jsx(Je,{...ne.props})]}),document.body)};export{gt as S};
