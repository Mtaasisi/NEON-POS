import{a as U,j as e}from"./index-61458a34.js";import{r as i}from"./vendor-36d2c7c1.js";import{c as H,M as N}from"./customerPortalService-0d37743c.js";import{z as c,O as L,b1 as R,cH as W,k as G,d as F,J as K,N as X,Q as Y,a2 as Z}from"./ui-28e30067.js";import{d as V,a as ee}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";const ce=()=>{var I,C;const{id:n}=V(),O=ee(),{startLoading:B,completeLoading:D,failLoading:v}=U(),[t,J]=i.useState(null),[Q,g]=i.useState(!0),[o,y]=i.useState(null),[m,w]=i.useState(1),[b,T]=i.useState(0),[u,S]=i.useState(!1),[j,A]=i.useState(!1);i.useEffect(()=>{n&&(M(),_())},[n]);const M=async()=>{const s=B("Loading product...");try{g(!0);const a=await H.getProductById(n);if(!a){c.error("Product not found"),g(!1),v(s,"Product not found");return}if(J(a),a.variants&&a.variants.length>0){const r=a.variants.find(x=>x.inStock);r&&y(r.id)}D(s)}catch(a){console.error("Error loading product:",a),c.error("Failed to load product details"),v(s,"Failed to load product")}finally{g(!1)}},_=()=>{const s=localStorage.getItem("customer_favorites");if(s){const a=JSON.parse(s);S(a.includes(n))}},$=()=>{const s=localStorage.getItem("customer_favorites"),a=s?JSON.parse(s):[],r=u?a.filter(x=>x!==n):[...a,n];localStorage.setItem("customer_favorites",JSON.stringify(r)),S(!u),c.success(u?"Removed from favorites":"Added to favorites")},E=async()=>{if(navigator.share&&t)try{await navigator.share({title:t.name,text:`Check out ${t.name} at our store!`,url:window.location.href})}catch{console.log("Share cancelled")}else navigator.clipboard.writeText(window.location.href),c.success("Link copied to clipboard")},q=()=>{var z;if(!t)return;if(!o&&t.variants&&t.variants.length>0){c.error("Please select a variant");return}const s=(z=t.variants)==null?void 0:z.find(f=>f.id===o);if(s&&!s.inStock){c.error("This variant is out of stock");return}const a=localStorage.getItem("customer_cart"),r=a?JSON.parse(a):[],x={productId:t.id,productName:t.name,variantId:o,variantName:s==null?void 0:s.name,quantity:m,price:(s==null?void 0:s.price)||t.price,imageUrl:t.imageUrl},P=r.findIndex(f=>f.productId===t.id&&f.variantId===o);P>=0?r[P].quantity+=m:r.push(x),localStorage.setItem("customer_cart",JSON.stringify(r)),c.success("Added to cart")};if(Q)return e.jsx(N,{title:"Loading...",showBackButton:!0,children:e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})});if(!t)return e.jsx(N,{title:"Product Not Found",showBackButton:!0,children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Product not found"}),e.jsx("button",{onClick:()=>O("/customer-portal/products"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Back to Products"})]})});const d=(I=t.variants)==null?void 0:I.find(s=>s.id===o),p=(d==null?void 0:d.price)||t.price,l=d==null?void 0:d.compareAtPrice,k=l&&l>p,h=((C=t.images)==null?void 0:C.length)>0?t.images:[t.imageUrl].filter(Boolean);return e.jsxs(N,{title:t.name,showBackButton:!0,showBottomNav:!1,children:[e.jsxs("div",{className:"bg-white",children:[e.jsxs("div",{className:"relative aspect-square bg-gray-100",children:[h[b]?e.jsx("img",{src:h[b],alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(L,{size:64,className:"text-gray-300"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx("button",{onClick:E,className:"bg-white rounded-full p-3 shadow-lg active:scale-90 transition-transform",children:e.jsx(R,{size:20,className:"text-gray-700"})}),e.jsx("button",{onClick:$,className:"bg-white rounded-full p-3 shadow-lg active:scale-90 transition-transform",children:e.jsx(W,{size:20,className:u?"fill-red-500 text-red-500":"text-gray-700"})})]})]}),h.length>1&&e.jsx("div",{className:"flex gap-2 p-4 overflow-x-auto",children:h.map((s,a)=>e.jsx("button",{onClick:()=>T(a),className:`flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 ${b===a?"border-blue-600":"border-gray-200"}`,children:e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover"})},a))})]}),e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.brand&&e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:t.brand}),t.category&&e.jsxs("span",{className:"text-sm text-gray-500",children:["â€¢ ",t.category]})]}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:t.name}),t.rating!==void 0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{size:16,className:"fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.rating.toFixed(1)})]}),t.reviewCount&&e.jsxs("span",{className:"text-sm text-gray-500",children:["(",t.reviewCount," reviews)"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["Tsh ",p.toLocaleString()]}),k&&e.jsxs("span",{className:"text-lg text-gray-500 line-through",children:["Tsh ",l==null?void 0:l.toLocaleString()]})]}),k&&e.jsxs("span",{className:"inline-block mt-1 px-2 py-1 bg-red-100 text-red-600 text-xs font-bold rounded",children:["Save ",Math.round((l-p)/l*100),"%"]})]}),e.jsx("div",{className:"mb-4",children:t.inStock?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(F,{size:18}),e.jsx("span",{className:"font-medium",children:"In Stock"}),t.stockQuantity&&t.stockQuantity<10&&e.jsxs("span",{className:"text-orange-600 ml-2",children:["(Only ",t.stockQuantity," left!)"]})]}):e.jsx("div",{className:"text-red-600 font-medium",children:"Out of Stock"})}),t.variants&&t.variants.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Select Variant"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:t.variants.map(s=>e.jsxs("button",{onClick:()=>y(s.id),disabled:!s.inStock,className:`p-3 rounded-lg border-2 text-left transition-all ${o===s.id?"border-blue-600 bg-blue-50":s.inStock?"border-gray-200 hover:border-gray-300":"border-gray-200 bg-gray-50 opacity-50 cursor-not-allowed"}`,children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm font-bold text-gray-900 mt-1",children:["Tsh ",s.price.toLocaleString()]}),!s.inStock&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Out of stock"})]},s.id))})]}),t.inStock&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>w(Math.max(1,m-1)),className:"w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center active:scale-90 transition-transform",children:e.jsx(K,{size:18})}),e.jsx("span",{className:"text-xl font-semibold w-12 text-center",children:m}),e.jsx("button",{onClick:()=>w(m+1),className:"w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center active:scale-90 transition-transform",children:e.jsx(X,{size:18})})]})]})]}),t.description&&e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:`text-gray-700 ${j?"":"line-clamp-3"}`,children:t.description}),t.description.length>150&&e.jsx("button",{onClick:()=>A(!j),className:"text-blue-600 font-medium mt-2 text-sm",children:j?"Show Less":"Show More"})]}),t.specifications&&Object.keys(t.specifications).length>0&&e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"Specifications"}),e.jsx("div",{className:"space-y-2",children:Object.entries(t.specifications).map(([s,a])=>e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:s}),e.jsx("span",{className:"text-gray-900",children:a})]},s))})]}),e.jsx("div",{className:"bg-white mt-2 p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-2",children:e.jsx(Y,{size:24,className:"text-blue-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:"Free Delivery"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-2",children:e.jsx(Z,{size:24,className:"text-blue-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:"Warranty"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-2",children:e.jsx(F,{size:24,className:"text-blue-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:"Quality"})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50",children:e.jsxs("button",{onClick:q,disabled:!t.inStock,className:`w-full py-4 rounded-lg font-bold text-white flex items-center justify-center gap-2 transition-all ${t.inStock?"bg-blue-600 hover:bg-blue-700 active:scale-95":"bg-gray-400 cursor-not-allowed"}`,children:[e.jsx(L,{size:20}),t.inStock?"Add to Cart":"Out of Stock"]})}),e.jsx("div",{className:"h-24"})]})};export{ce as default};
