import{a as Q,j as e,ah as V,s as S}from"./index-61458a34.js";import{r as a}from"./vendor-36d2c7c1.js";import{h as U,J as $,N as K,z as i}from"./ui-28e30067.js";import{a as T}from"./routing-eb8c310c.js";import"./supabase-cf010ec4.js";const H=()=>{const m=T(),{startLoading:C,completeLoading:A,failLoading:P}=Q(),[n,F]=a.useState(""),[d,u]=a.useState(""),[g,_]=a.useState(""),[x,b]=a.useState(""),[l,W]=a.useState(""),[r,I]=a.useState(""),[c,h]=a.useState("1"),[y,L]=a.useState("5"),[j,E]=a.useState(""),[M,z]=a.useState([]),[f,N]=a.useState(!1),[p,q]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const s=await V();z(s),s.length>0&&u(s[0].id)}catch(s){console.error("Error loading categories:",s),i.error("Failed to load categories")}})()},[]),a.useEffect(()=>{if(n&&!x){const t=n.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,8)+"-"+Date.now().toString().substring(-4);b(t)}},[n]);const D=()=>n.trim()?d?!r||parseFloat(r)<=0?(i.error("Selling price must be greater than 0"),!1):!0:(i.error("Category is required"),!1):(i.error("Product name is required"),!1),O=async()=>{if(!D())return;const t=C("Adding product...");try{N(!0);const{data:s,error:o}=await S.from("lats_products").insert({name:n.trim(),category_id:d,description:j.trim()||null,is_active:!0,metadata:{skip_default_variant:!0,useVariants:!0,variantCount:1,createdFrom:"mobile_app"}}).select().single();if(o)throw o;const{error:k}=await S.from("lats_product_variants").insert({product_id:s.id,variant_name:g.trim()||n.trim(),sku:x.trim()||`SKU-${Date.now()}`,cost_price:l?parseFloat(l):0,selling_price:parseFloat(r),quantity:parseInt(c)||0,min_quantity:parseInt(y)||5,is_active:!0});if(k)throw k;A(t),i.success(`${n} added successfully!`),m(`/mobile/inventory/${s.id}`)}catch(s){console.error("Error adding product:",s),P(t,"Failed to add product"),i.error(s.message||"Failed to add product")}finally{N(!1)}},v=t=>{const s=parseInt(c)||0,o=Math.max(0,s+t);h(String(o))},w=l&&r?((parseFloat(r)-parseFloat(l))/parseFloat(r)*100).toFixed(1):"0";return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("button",{onClick:()=>m("/mobile/inventory"),className:"flex items-center gap-1 text-blue-500",children:[e.jsx(U,{size:20,strokeWidth:2}),e.jsx("span",{className:"text-[17px]",children:"Cancel"})]}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2",children:"Add Product"}),e.jsx("button",{onClick:O,disabled:f||!n.trim()||!r,className:"text-blue-500 text-[17px] font-semibold disabled:text-gray-400 disabled:cursor-not-allowed",children:f?"Adding...":"Add"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto pb-20",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-200",children:[e.jsx("label",{className:"block text-[13px] text-gray-500 mb-2 uppercase tracking-wide",children:"Product Information"}),e.jsx("input",{type:"text",placeholder:"Product name",value:n,onChange:t=>F(t.target.value),autoFocus:!0,className:"w-full bg-transparent border-0 outline-none text-[17px] text-gray-900 placeholder-gray-400 p-0",style:{WebkitAppearance:"none"}})]}),e.jsx("div",{className:"px-4 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 text-[17px]",children:"Category"}),e.jsx("select",{value:d,onChange:t=>u(t.target.value),className:"bg-transparent border-0 outline-none text-[17px] text-gray-900 text-right",style:{WebkitAppearance:"none"},children:M.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"px-4 pb-2",children:e.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide",children:"Pricing"})}),e.jsxs("div",{className:"border-t border-b border-gray-200",children:[e.jsx("div",{className:"px-4 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 text-[17px]",children:"Selling Price"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 text-[17px]",children:"TSh"}),e.jsx("input",{type:"number",placeholder:"0",value:r,onChange:t=>I(t.target.value),className:"w-32 bg-transparent border-0 outline-none text-[17px] text-gray-900 text-right placeholder-gray-400",style:{WebkitAppearance:"none"}})]})]})}),e.jsx("div",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 text-[17px]",children:"Cost Price"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 text-[17px]",children:"TSh"}),e.jsx("input",{type:"number",placeholder:"0",value:l,onChange:t=>W(t.target.value),className:"w-32 bg-transparent border-0 outline-none text-[17px] text-gray-900 text-right placeholder-gray-400",style:{WebkitAppearance:"none"}})]})]})})]}),l&&r&&parseFloat(r)>0&&e.jsx("div",{className:"px-4 py-3 bg-green-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-green-700 text-[15px] font-medium",children:"Profit Margin"}),e.jsxs("span",{className:"text-green-700 text-[15px] font-semibold",children:[w,"%"]})]})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"px-4 pb-2",children:e.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide",children:"Stock"})}),e.jsxs("div",{className:"border-t border-b border-gray-200",children:[e.jsx("div",{className:"px-4 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 text-[17px]",children:"Initial Quantity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>v(-1),className:"w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center active:scale-95 transition-all",children:e.jsx($,{size:16,strokeWidth:3})}),e.jsx("input",{type:"number",value:c,onChange:t=>h(t.target.value),className:"w-16 bg-transparent border-0 outline-none text-[17px] text-gray-900 text-center font-semibold",style:{WebkitAppearance:"none"}}),e.jsx("button",{onClick:()=>v(1),className:"w-8 h-8 rounded-full bg-blue-500 text-white hover:bg-blue-600 flex items-center justify-center active:scale-95 transition-all",children:e.jsx(K,{size:16,strokeWidth:3})})]})]})}),e.jsx("div",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 text-[17px]",children:"Low Stock Alert"}),e.jsx("input",{type:"number",placeholder:"5",value:y,onChange:t=>L(t.target.value),className:"w-20 bg-transparent border-0 outline-none text-[17px] text-gray-900 text-right",style:{WebkitAppearance:"none"}})]})})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{onClick:()=>q(!p),className:"w-full px-4 py-3 border-t border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 active:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-blue-500 text-[17px] font-medium",children:"Advanced Options"}),e.jsx("div",{className:"text-gray-500 text-[13px] mt-0.5",children:"SKU, variant name, description"})]}),e.jsx("span",{className:`text-gray-400 text-[17px] transition-transform ${p?"rotate-180":""}`,children:"â–¼"})]}),p&&e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-200",children:[e.jsx("label",{className:"block text-[13px] text-gray-500 mb-2",children:"Variant Name (Optional)"}),e.jsx("input",{type:"text",placeholder:"e.g., Default, Standard",value:g,onChange:t=>_(t.target.value),className:"w-full bg-transparent border-0 outline-none text-[17px] text-gray-900 placeholder-gray-400 p-0",style:{WebkitAppearance:"none"}})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-200",children:[e.jsx("label",{className:"block text-[13px] text-gray-500 mb-2",children:"SKU"}),e.jsx("input",{type:"text",placeholder:"Auto-generated",value:x,onChange:t=>b(t.target.value),className:"w-full bg-transparent border-0 outline-none text-[17px] text-gray-900 font-mono placeholder-gray-400 p-0",style:{WebkitAppearance:"none"}})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsx("label",{className:"block text-[13px] text-gray-500 mb-2",children:"Description (Optional)"}),e.jsx("textarea",{placeholder:"Product description",value:j,onChange:t=>E(t.target.value),rows:4,className:"w-full bg-transparent border-0 outline-none text-[17px] text-gray-900 placeholder-gray-400 resize-none p-0",style:{WebkitAppearance:"none"}})]})]})]}),n&&r&&e.jsxs("div",{className:"mx-4 my-6 p-4 bg-blue-50 rounded-xl",children:[e.jsx("div",{className:"text-[15px] text-gray-900 font-semibold mb-3",children:"Summary"}),e.jsxs("div",{className:"space-y-2 text-[15px]",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Product:"}),e.jsx("span",{className:"text-gray-900 font-medium",children:n})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Price:"}),e.jsxs("span",{className:"text-green-600 font-semibold",children:["TSh ",parseFloat(r).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Stock:"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[c," units"]})]}),l&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Profit Margin:"}),e.jsxs("span",{className:"text-purple-600 font-semibold",children:[w,"%"]})]})]})]})]})]})};export{H as default};
