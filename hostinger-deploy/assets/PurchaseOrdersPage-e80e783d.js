import{_ as gs}from"./supabase-cf010ec4.js";import{j as e,e as ve,u as js,d as vs,ak as Fs,a as Ms,s as Es}from"./index-61458a34.js";import{r as n,R as We,b as ws}from"./vendor-36d2c7c1.js";import{l as we,c as re,a3 as J,aE as he,c4 as Be,av as ee,u as M,q as ge,d as W,x as Bs,A as Ls,p as He,j as Vs,a5 as Le,y as ce,e as Ne,o as qs,bP as _s,U as zs,X as oe,D as Zs,ah as Qs,Q as Ns,af as ps,b_ as Ws,b7 as Hs,r as Ge,aA as Ce,O as Cs,bN as bs,I as Gs,Y as Je,m as Ke,n as c,v as Ps,P as Js,M as ks,N as Xe,a7 as Ks,R as fs,a0 as Ee,b as ys,a as Xs,$ as Ys,f as Us,a6 as ye}from"./ui-28e30067.js";import{u as Ye}from"./useDialog-6eb5c329.js";import{B as et}from"./BackButton-02a80e74.js";import{C as st}from"./CBMCalculatorModal-27ed156d.js";import{L as je}from"./LoadingSpinner-251d9268.js";import{C as tt}from"./ComprehensivePaymentModal-83b44bf0.js";import{a as Ss}from"./routing-eb8c310c.js";import{g as at}from"./countryFlags-325b0823.js";import{E as rt}from"./EnhancedAddSupplierModal-988446e5.js";import{S as lt}from"./SupplierDetailModal-41a61e96.js";import{S as nt}from"./SupplierForm-59afd126.js";import{u as it}from"./useBodyScrollLock-341c8b9f.js";import"./GlassInput-0475021a.js";import"./utils-95f4031a.js";import"./charts-d592fbd1.js";import"./currencyUtils-59109a41.js";import"./GlassTabs-05c8a392.js";import"./forms-ebbdb905.js";import"./zod-78f78e6c.js";const ot=[{id:"view",label:"View Details",description:"See complete order information",icon:e.jsx(we,{className:"w-5 h-5"}),color:"bg-blue-500",hoverColor:"hover:bg-blue-50",onClick:()=>console.log("View details")},{id:"duplicate",label:"Duplicate Order",description:"Create a copy of this order",icon:e.jsx(re,{className:"w-5 h-5"}),color:"bg-purple-500",hoverColor:"hover:bg-purple-50",onClick:()=>console.log("Duplicate")},{id:"pdf",label:"Generate PDF",description:"Download order as PDF document",icon:e.jsx(J,{className:"w-5 h-5"}),color:"bg-orange-500",hoverColor:"hover:bg-orange-50",onClick:()=>console.log("Generate PDF")},{id:"payment",label:"Manage Payment",description:"Record or update payment status",icon:e.jsx(he,{className:"w-5 h-5"}),color:"bg-indigo-500",hoverColor:"hover:bg-indigo-50",onClick:()=>console.log("Manage payment")},{id:"quality",label:"Quality Check",description:"Mark items as quality verified",icon:e.jsx(Be,{className:"w-5 h-5"}),color:"bg-teal-500",hoverColor:"hover:bg-teal-50",onClick:()=>console.log("Quality check")}],ct=({isOpen:P,onClose:p,position:a="right",items:m=ot,triggerRef:k})=>{const R=n.useRef(null),[g,y]=n.useState({top:0,left:0,right:"auto"}),w=n.useRef(!1);n.useEffect(()=>{if(P&&(k!=null&&k.current)){const i=k.current.getBoundingClientRect(),j=12;let A="auto",r="auto";a==="right"?r=`${window.innerWidth-i.right}px`:A=`${i.left}px`,y({top:i.bottom+j,left:A,right:r}),w.current=!1}},[P,k,a]);const C=n.useCallback(()=>{w.current||(w.current=!0,p(),setTimeout(()=>{w.current=!1},100))},[p]);if(!P)return null;const S=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[998] bg-transparent",onClick:i=>{i.preventDefault(),i.stopPropagation(),C()}}),e.jsx("div",{ref:R,className:"fixed w-80 bg-white rounded-2xl shadow-2xl border border-gray-100 z-[999] overflow-visible animate-in fade-in slide-in-from-top-2 duration-200",style:{top:`${g.top}px`,left:g.left!=="auto"?g.left:void 0,right:g.right!=="auto"?g.right:void 0,maxHeight:`calc(100vh - ${g.top}px - 20px)`,overflowY:"auto"},onClick:i=>{i.preventDefault(),i.stopPropagation()},children:e.jsx("div",{className:"py-3",children:m.map(i=>e.jsxs(We.Fragment,{children:[i.divider&&e.jsx("div",{className:"my-2 mx-4 border-t border-gray-200"}),e.jsxs("button",{onClick:()=>{i.onClick(),C()},className:`w-full flex items-start gap-4 px-5 py-3.5 transition-all duration-200 ${i.hoverColor} group`,children:[e.jsx("div",{className:`${i.color} rounded-full p-2.5 flex-shrink-0 group-hover:scale-110 transition-transform duration-200 shadow-md`,children:e.jsx("div",{className:"text-white",children:i.icon})}),e.jsxs("div",{className:"flex-1 text-left pt-0.5",children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm mb-0.5 group-hover:text-gray-900",children:i.label}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:i.description})]})]})]},i.id))})})]});return ws.createPortal(S,document.body)},dt=({className:P,currentOrder:p,cartItems:a=[]})=>{const[m,k]=n.useState({totalPOs:0,activePOs:0,completedPOs:0,pendingPOs:0,totalValue:0,averageOrderValue:0,topSuppliers:[],lowStockAlerts:[],overdueDeliveries:0,onTimeDeliveryRate:0}),[R,g]=n.useState([]),y=n.useMemo(()=>{const i=[];if(p&&a.length>0){a.reduce((O,E)=>O+E.quantity*E.costPrice,0);const j=a.filter(O=>O.quantity*O.costPrice>1e5);j.length>0&&i.push({type:"warning",title:"High-Value Order Items",description:`${j.length} items exceed TZS 100,000. Consider split payments or extended terms.`,impact:"high"});const A=a.filter(O=>O.currentStock<=O.reorderPoint);if(A.length>0&&i.push({type:"opportunity",title:"Critical Stock Items",description:`${A.length} items are at or below reorder point. Urgent replenishment needed.`,impact:"high"}),p.supplier){const O=m.topSuppliers.find(E=>E.name===p.supplier.name);O&&O.orderCount>10&&i.push({type:"success",title:"Reliable Supplier",description:`${p.supplier.name} has ${O.orderCount} successful orders. Good choice!`,impact:"medium"})}new Date().getHours()>=16&&i.push({type:"warning",title:"Late Order Creation",description:"Orders created after 4 PM may not be processed until next business day.",impact:"medium"}),a.length>20&&i.push({type:"opportunity",title:"Bulk Order Opportunity",description:`Large order with ${a.length} items. Consider negotiating bulk discounts.`,impact:"medium"})}return m.onTimeDeliveryRate<80&&i.push({type:"warning",title:"Delivery Performance Issue",description:`On-time delivery rate is ${m.onTimeDeliveryRate.toFixed(1)}%. Consider supplier alternatives.`,impact:"high"}),m.overdueDeliveries>5&&i.push({type:"warning",title:"Overdue Deliveries Alert",description:`${m.overdueDeliveries} deliveries are overdue. Immediate follow-up required.`,impact:"high"}),i},[p,a,m]);n.useEffect(()=>{g(y)},[y]);const w=i=>{switch(i){case"warning":return e.jsx(Ls,{className:"w-4 h-4 text-yellow-500"});case"opportunity":return e.jsx(Bs,{className:"w-4 h-4 text-blue-500"});case"success":return e.jsx(W,{className:"w-4 h-4 text-green-500"});default:return e.jsx(ee,{className:"w-4 h-4 text-gray-500"})}},C=i=>{switch(i){case"warning":return"border-l-yellow-500 bg-yellow-50";case"opportunity":return"border-l-blue-500 bg-blue-50";case"success":return"border-l-green-500 bg-green-50";default:return"border-l-gray-500 bg-gray-50"}},S=i=>`TZS ${i.toLocaleString()}`;return e.jsxs(ve,{className:`p-4 ${P}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ee,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"PO Analytics"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Smart insights & recommendations"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(M,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-900",children:"Active POs"})]}),e.jsx("div",{className:"text-lg font-bold text-blue-700",children:m.activePOs})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(ge,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-900",children:"Total Value"})]}),e.jsx("div",{className:"text-lg font-bold text-green-700",children:S(m.totalValue)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Smart Insights"}),R.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ee,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500",children:"No insights available"})]}):R.slice(0,3).map((i,j)=>e.jsx("div",{className:`p-3 rounded-lg border-l-4 text-xs ${C(i.type)}`,children:e.jsxs("div",{className:"flex items-start space-x-2",children:[w(i.type),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:i.title}),e.jsx("div",{className:"text-gray-700 mt-1",children:i.description})]})]})},j))]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"flex-1 text-xs bg-blue-100 text-blue-700 py-2 px-3 rounded hover:bg-blue-200 transition-colors",children:"View Reports"}),e.jsx("button",{className:"flex-1 text-xs bg-green-100 text-green-700 py-2 px-3 rounded hover:bg-green-200 transition-colors",children:"Supplier Stats"})]})})]})},mt=({className:P,poId:p,currentUser:a,collaborators:m=[],activities:k=[],onInviteUser:R,onSendMessage:g,onRequestApproval:y})=>{const[w,C]=n.useState(""),[S,i]=n.useState(!1),[j,A]=n.useState(""),[r,v]=n.useState("viewer"),O=[{id:"1",name:"John Manager",role:"Manager",status:"online",permissions:["view","edit","approve"]},{id:"2",name:"Sarah Procurement",role:"Procurement Officer",status:"online",permissions:["view","edit"]},{id:"3",name:"Mike Finance",role:"Finance",status:"away",lastSeen:new Date(Date.now()-3e5),permissions:["view","approve"]}],E=[{id:"1",userId:"1",userName:"John Manager",action:"edit",timestamp:new Date(Date.now()-12e4),details:"Updated supplier contact information",target:"Supplier Details"},{id:"2",userId:"2",userName:"Sarah Procurement",action:"comment",timestamp:new Date(Date.now()-3e5),details:"Added note about bulk discount eligibility",target:"Order Items"},{id:"3",userId:"1",userName:"John Manager",action:"view",timestamp:new Date(Date.now()-6e5),details:"Reviewed order details"}],H=O.filter(h=>h.status==="online"),V=E.slice(0,5),z=()=>{w.trim()&&g&&(g(w.trim()),C(""))},Z=()=>{j.trim()&&R&&(R(j.trim(),r),A(""),v("viewer"),i(!1))},K=h=>{switch(h){case"online":return"bg-green-500";case"away":return"bg-yellow-500";case"offline":return"bg-gray-500";default:return"bg-gray-500"}},q=h=>{switch(h){case"view":return e.jsx(we,{className:"w-3 h-3"});case"edit":return e.jsx(_s,{className:"w-3 h-3"});case"comment":return e.jsx(qs,{className:"w-3 h-3"});case"approve":return e.jsx(W,{className:"w-3 h-3"});case"reject":return e.jsx(Ne,{className:"w-3 h-3"});default:return e.jsx(ce,{className:"w-3 h-3"})}},x=h=>{const l=new Date().getTime()-h.getTime(),I=Math.floor(l/6e4),_=Math.floor(I/60);return I<1?"Just now":I<60?`${I}m ago`:_<24?`${_}h ago`:h.toLocaleDateString()};return e.jsxs(ve,{className:`p-4 ${P}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(He,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Team Collaboration"}),e.jsxs("p",{className:"text-xs text-gray-600",children:[H.length," online • ",O.length," total"]})]})]}),e.jsx("button",{onClick:()=>i(!S),className:"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"Invite Team Member",children:e.jsx(Vs,{className:"w-4 h-4"})})]}),S&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"email",placeholder:"Enter email address",value:j,onChange:h=>A(h.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-blue-400"}),e.jsxs("select",{value:r,onChange:h=>v(h.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-blue-400",children:[e.jsx("option",{value:"viewer",children:"Viewer"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"approver",children:"Approver"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:Z,className:"flex-1 bg-blue-600 text-white py-2 px-3 rounded text-sm hover:bg-blue-700 transition-colors",children:"Invite"}),e.jsx("button",{onClick:()=>i(!1),className:"px-3 py-2 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Online Now"}),e.jsx("div",{className:"space-y-2",children:H.map(h=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-gray-700",children:h.name.split(" ").map(G=>G[0]).join("")})}),e.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-white ${K(h.status)}`})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900",children:h.name}),e.jsx("div",{className:"text-xs text-gray-600",children:h.role})]})]},h.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Recent Activity"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:V.map(h=>e.jsxs("div",{className:"flex items-start space-x-2 text-xs",children:[e.jsx("div",{className:"mt-0.5",children:q(h.action)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-gray-900",children:[e.jsx("span",{className:"font-medium",children:h.userName})," ",h.action==="view"&&"viewed",h.action==="edit"&&"edited",h.action==="comment"&&"commented on",h.action==="approve"&&"approved",h.action==="reject"&&"rejected"," ",h.target&&e.jsx("span",{className:"text-blue-600",children:h.target})]}),e.jsx("div",{className:"text-gray-600",children:x(h.timestamp)}),h.details&&e.jsxs("div",{className:"text-gray-700 mt-1 italic",children:['"',h.details,'"']})]})]},h.id))})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",placeholder:"Quick message...",value:w,onChange:h=>C(h.target.value),onKeyPress:h=>h.key==="Enter"&&z(),className:"flex-1 px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-blue-400"}),e.jsx("button",{onClick:z,disabled:!w.trim(),className:"p-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 transition-colors",children:e.jsx(Le,{className:"w-4 h-4"})})]})}),y&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:y,className:"w-full bg-green-600 text-white py-2 px-3 rounded text-sm hover:bg-green-700 transition-colors",children:"Request Approval"})})]})},xt=({className:P,workflow:p,currentUser:a,onApprove:m,onReject:k,onRequestChanges:R,onSubmitForApproval:g})=>{const[y,w]=n.useState(null),[C,S]=n.useState(""),[i,j]=n.useState(null),A={id:"wf-001",poId:"po-001",status:"in_review",currentStep:1,createdAt:new Date(Date.now()-864e5),updatedAt:new Date,steps:[{id:"step-1",name:"Procurement Review",role:"Procurement Officer",status:"approved",userId:"user-1",userName:"Sarah Procurement",timestamp:new Date(Date.now()-72e5),comments:"Items verified. Bulk discount negotiated.",required:!0},{id:"step-2",name:"Manager Approval",role:"Manager",status:"approved",userId:"user-2",userName:"John Manager",timestamp:new Date(Date.now()-36e5),comments:"Approved. Ensure timely delivery.",required:!0},{id:"step-3",name:"Finance Review",role:"Finance",status:"pending",required:!0},{id:"step-4",name:"Final Approval",role:"Director",status:"pending",required:!1}]},r=p||A,v=a&&r.status==="in_review",O=x=>{m&&(m(x,C||void 0),S(""),w(null),j(null))},E=x=>{k&&(k(x,C||void 0),S(""),w(null),j(null))},H=x=>{R&&C.trim()&&(R(x,C),S(""),w(null),j(null))},V=x=>{switch(x){case"approved":return e.jsx(W,{className:"w-5 h-5 text-green-500"});case"rejected":return e.jsx(oe,{className:"w-5 h-5 text-red-500"});case"pending":return e.jsx(ce,{className:"w-5 h-5 text-gray-400"});case"skipped":return e.jsx(Ne,{className:"w-5 h-5 text-gray-400"});default:return e.jsx(ce,{className:"w-5 h-5 text-gray-400"})}},z=x=>{switch(x){case"approved":return"border-green-500 bg-green-50";case"rejected":return"border-red-500 bg-red-50";case"pending":return"border-gray-300 bg-white";case"skipped":return"border-gray-300 bg-gray-50";default:return"border-gray-300 bg-white"}},Z=x=>{const h={approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800",skipped:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${h[x]||h.pending}`,children:x.toUpperCase()})},K=x=>x.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});r.steps.filter(x=>x.status==="pending");const q=r.steps.filter(x=>x.status!=="pending");return e.jsxs(ve,{className:`p-6 ${P}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(J,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Approval Workflow"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[q.length," of ",r.steps.length," steps completed"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Z(r.status),g&&r.status==="draft"&&e.jsx("button",{onClick:g,className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Submit for Approval"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(q.length/r.steps.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${q.length/r.steps.length*100}%`}})})]}),e.jsx("div",{className:"space-y-4",children:r.steps.map((x,h)=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${z(x.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:"mt-1",children:V(x.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:x.name}),Z(x.status),x.required&&e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded",children:"Required"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:x.role}),x.userName&&x.timestamp&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 mb-2",children:[e.jsx(zs,{className:"w-3 h-3"}),e.jsx("span",{children:x.userName}),e.jsx("span",{children:"•"}),e.jsx("span",{children:K(x.timestamp)})]}),x.comments&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm text-gray-700 mb-3",children:['"',x.comments,'"']})]})]}),v&&x.status==="pending"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{j(x.id),w("approve")},className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors",children:"Approve"}),e.jsx("button",{onClick:()=>{j(x.id),w("reject")},className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors",children:"Reject"}),e.jsx("button",{onClick:()=>{j(x.id),w("changes")},className:"px-3 py-1 bg-yellow-600 text-white text-sm rounded hover:bg-yellow-700 transition-colors",children:"Request Changes"})]})]})},x.id))}),y&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[y==="approve"&&"Approve Step",y==="reject"&&"Reject Step",y==="changes"&&"Request Changes"]}),e.jsx("textarea",{placeholder:"Add comments (optional)...",value:C,onChange:x=>S(x.target.value),className:"w-full h-24 p-3 border border-gray-200 rounded resize-none focus:outline-none focus:border-blue-400"}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>{w(null),S(""),j(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:()=>{y==="approve"&&O(i),y==="reject"&&E(i),y==="changes"&&H(i)},className:`px-4 py-2 text-white rounded transition-colors ${y==="approve"?"bg-green-600 hover:bg-green-700":y==="reject"?"bg-red-600 hover:bg-red-700":"bg-yellow-600 hover:bg-yellow-700"}`,children:[y==="approve"&&"Approve",y==="reject"&&"Reject",y==="changes"&&"Request Changes"]})]})]})})]})},ut=({className:P,dateRange:p,onExport:a})=>{const[m,k]=n.useState({totalPOs:0,totalValue:0,averageOrderValue:0,onTimeDeliveryRate:0,supplierPerformance:[],categoryBreakdown:[],monthlyTrends:[],statusBreakdown:{draft:0,sent:0,received:0,cancelled:0}}),[R,g]=n.useState("overview"),[y,w]=n.useState(!0),C={totalPOs:247,totalValue:125e5,averageOrderValue:50607,onTimeDeliveryRate:87.5,supplierPerformance:[{supplierName:"TechCorp Ltd",totalOrders:45,totalValue:32e5,onTimeDeliveries:42,averageDeliveryTime:3.2,qualityScore:9.2},{supplierName:"Global Supplies Inc",totalOrders:38,totalValue:28e5,onTimeDeliveries:35,averageDeliveryTime:4.1,qualityScore:8.7},{supplierName:"Local Distributors",totalOrders:67,totalValue:195e4,onTimeDeliveries:58,averageDeliveryTime:2.8,qualityScore:9.5}],categoryBreakdown:[{category:"Electronics",orderCount:89,totalValue:45e5,percentage:36},{category:"Office Supplies",orderCount:67,totalValue:32e5,percentage:25.6},{category:"Furniture",orderCount:45,totalValue:28e5,percentage:22.4},{category:"IT Equipment",orderCount:34,totalValue:15e5,percentage:12},{category:"Other",orderCount:12,totalValue:5e5,percentage:4}],monthlyTrends:[{month:"Jan",orderCount:18,totalValue:85e4,growth:0},{month:"Feb",orderCount:22,totalValue:92e4,growth:8.2},{month:"Mar",orderCount:25,totalValue:11e5,growth:19.6},{month:"Apr",orderCount:28,totalValue:125e4,growth:13.6},{month:"May",orderCount:32,totalValue:135e4,growth:8},{month:"Jun",orderCount:35,totalValue:148e4,growth:9.6}],statusBreakdown:{draft:12,sent:45,received:185,cancelled:5}};n.useEffect(()=>{(async()=>{w(!0),await new Promise(v=>setTimeout(v,1e3)),k(C),w(!1)})()},[p]);const S=r=>`TZS ${r.toLocaleString()}`,i=r=>`${r.toFixed(1)}%`,j=r=>r>0?e.jsx(ps,{className:"w-4 h-4 text-green-500"}):r<0?e.jsx(Ws,{className:"w-4 h-4 text-red-500"}):e.jsx(ee,{className:"w-4 h-4 text-gray-500"}),A=r=>{a?a(r):console.log(`Exporting report as ${r.toUpperCase()}`)};return y?e.jsx(ve,{className:`p-6 ${P}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"})})}):e.jsxs(ve,{className:`p-6 ${P}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ee,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"PO Analytics & Reporting"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Comprehensive purchase order insights"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>A("csv"),className:"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors",title:"Export as CSV",children:e.jsx(Zs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A("excel"),className:"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"Export as Excel",children:e.jsx(Qs,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("div",{className:"flex space-x-6",children:[{id:"overview",label:"Overview",icon:ee},{id:"suppliers",label:"Suppliers",icon:Ns},{id:"categories",label:"Categories",icon:M},{id:"trends",label:"Trends",icon:ps}].map(({id:r,label:v,icon:O})=>e.jsxs("button",{onClick:()=>g(r),className:`flex items-center space-x-2 py-3 px-1 border-b-2 transition-colors ${R===r?"border-blue-500 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:v})]},r))})}),R==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Total POs"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:m.totalPOs})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ge,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-900",children:"Total Value"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:S(m.totalValue)})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ee,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-900",children:"Avg Order Value"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-700",children:S(m.averageOrderValue)})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ce,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-900",children:"On-Time Delivery"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-700",children:i(m.onTimeDeliveryRate)})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold mb-3",children:"Order Status Breakdown"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(m.statusBreakdown).map(([r,v])=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-700",children:v}),e.jsx("div",{className:"text-sm text-gray-600 capitalize",children:r})]},r))})]})]}),R==="suppliers"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md font-semibold",children:"Supplier Performance"}),e.jsx("div",{className:"space-y-3",children:m.supplierPerformance.map((r,v)=>e.jsxs("div",{className:"bg-white border border-gray-200 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:r.supplierName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.totalOrders," orders • ",S(r.totalValue)]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-medium text-green-600",children:[r.qualityScore,"/10 Quality"]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"On-Time:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[r.onTimeDeliveries,"/",r.totalOrders]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Avg Delivery:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[r.averageDeliveryTime," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Success Rate:"}),e.jsx("span",{className:"ml-2 font-medium text-green-600",children:i(r.onTimeDeliveries/r.totalOrders*100)})]})]})]},v))})]}),R==="categories"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md font-semibold",children:"Category Breakdown"}),e.jsx("div",{className:"space-y-3",children:m.categoryBreakdown.map((r,v)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.category}),e.jsxs("div",{className:"text-sm text-gray-600",children:[r.orderCount," orders • ",S(r.totalValue)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:i(r.percentage)}),e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${r.percentage}%`}})})]})]},v))})]}),R==="trends"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md font-semibold",children:"Monthly Trends"}),e.jsx("div",{className:"space-y-3",children:m.monthlyTrends.map((r,v)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"font-medium text-gray-900 w-12",children:r.month}),e.jsxs("div",{className:"text-sm text-gray-600",children:[r.orderCount," orders • ",S(r.totalValue)]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[j(r.growth),e.jsxs("span",{className:`text-sm font-medium ${r.growth>0?"text-green-600":r.growth<0?"text-red-600":"text-gray-600"}`,children:[r.growth>0?"+":"",i(r.growth)]})]})]},v))})]})]})},ht=({isOpen:P,onClose:p,order:a,onOrderUpdate:m})=>{var ne,te,Pe,pe,ke;const k=Ss(),{confirm:R}=Ye();js();const{approvePurchaseOrder:g,updatePurchaseOrder:y,deletePurchaseOrder:w,loadPurchaseOrders:C}=vs(),[S,i]=n.useState("overview"),[j,A]=n.useState(!1),[r,v]=n.useState(!1);n.useState(!1),n.useState(!1);const[O,E]=n.useState(!1),[H,V]=n.useState(!1);if(n.useEffect(()=>{P||i("overview")},[P]),!P||!a)return null;const z=o=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:a.currency||"TZS"}).format(o),Z=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),K=o=>{const N={sent:"bg-blue-100 text-blue-800 border-blue-200",confirmed:"bg-yellow-100 text-yellow-800 border-yellow-200",shipped:"bg-purple-100 text-purple-800 border-purple-200",received:"bg-green-100 text-green-800 border-green-200",completed:"bg-emerald-100 text-emerald-800 border-emerald-200",cancelled:"bg-red-100 text-red-800 border-red-200",draft:"bg-gray-100 text-gray-800 border-gray-200"};return N[o]||N.draft},q=o=>{const N={paid:"bg-emerald-100 text-emerald-800 border-emerald-200",partial:"bg-amber-100 text-amber-800 border-amber-200",unpaid:"bg-red-100 text-red-800 border-red-200"};return N[o]||N.unpaid},x=[{key:"overview",label:"Overview",icon:Gs},{key:"items",label:"Items",icon:M},{key:"payments",label:"Payments",icon:he},{key:"history",label:"History",icon:bs}],h=async()=>{if(a){if(a.status!=="draft"){c.error("Only draft orders can be approved");return}if(!a.items||a.items.length===0){c.error("Cannot approve order without items");return}try{v(!0);const o=await g(a.id);o.ok?(await y(a.id,{status:"sent"})).ok?(c.success("Order approved and sent to supplier"),await C(),m==null||m()):(c.success("Order approved (send manually from details)"),await C(),m==null||m()):c.error(o.message||"Failed to approve order")}catch(o){console.error("Error approving and sending order:",o),c.error("Failed to process order")}finally{v(!1)}}},G=()=>{a&&(k(`/lats/purchase-orders/${a.id}?action=receive`),p())},l=async()=>{if(!a)return;if(a.status!=="received"){c.error("Order must be received before completing");return}if(await R("Are you sure you want to complete this purchase order?"))try{E(!0);const N=await y(a.id,{status:"completed"});N.ok?(c.success("Purchase order completed successfully"),await C(),m==null||m()):c.error(N.message||"Failed to complete purchase order")}catch(N){console.error("Error completing purchase order:",N),c.error("Failed to complete purchase order")}finally{E(!1)}},I=async()=>{if(!a)return;if(a.status!=="draft"){c.error("Only draft orders can be deleted");return}if(await R("Are you sure you want to delete this purchase order? This action cannot be undone."))try{V(!0);const N=await w(a.id);N.ok?(c.success("Purchase order deleted successfully"),await C(),m==null||m(),p()):c.error(N.message||"Failed to delete purchase order")}catch(N){console.error("Error deleting purchase order:",N),c.error("Failed to delete purchase order")}finally{V(!1)}},_=()=>{a&&(k(`/lats/purchase-order/create?edit=${a.id}`),p())},se=()=>{a&&(k(`/lats/purchase-order/create?duplicate=${a.id}`),p())},le=()=>{a&&(k(`/lats/purchase-orders/${a.id}`),p())},X=()=>{var Q,de;const o=[],Y=["draft","sent","confirmed","partial_received","received","completed","cancelled"].includes(a.status)?a.status:"draft";switch(Y){case"draft":o.push({type:"send",label:"Send to Supplier",icon:e.jsx(Le,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:h,loading:r}),o.push({type:"delete",label:"Delete",icon:e.jsx(Je,{className:"w-4 h-4"}),color:"bg-red-600 hover:bg-red-700",onClick:I,loading:H});break;case"sent":case"confirmed":o.push({type:"receive",label:"Receive Items",icon:e.jsx(M,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:G});break;case"partial_received":const Se=((Q=a.items)==null?void 0:Q.reduce((me,xe)=>me+(xe.quantity||0),0))||0,Ae=((de=a.items)==null?void 0:de.reduce((me,xe)=>me+(xe.receivedQuantity||0),0))||0,De=Se-Ae;o.push({type:"receive",label:`Continue (${De} left)`,icon:e.jsx(M,{className:"w-4 h-4"}),color:"bg-orange-600 hover:bg-orange-700",onClick:G});break;case"received":o.push({type:"complete",label:"Complete",icon:e.jsx(W,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:l,loading:O});break;case"completed":o.push({type:"duplicate",label:"Duplicate",icon:e.jsx(re,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:se});break}return["draft","sent","confirmed","shipped"].includes(Y)&&o.push({type:"edit",label:"Edit",icon:e.jsx(Ke,{className:"w-4 h-4"}),color:"bg-purple-600 hover:bg-purple-700",onClick:_}),o.push({type:"view",label:"View Details",icon:e.jsx(we,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:le}),o.push({type:"duplicate",label:"Duplicate",icon:e.jsx(re,{className:"w-4 h-4"}),color:"bg-indigo-600 hover:bg-indigo-700",onClick:se}),o};return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white rounded-[36px] shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 rounded-t-[36px]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-500 via-indigo-600 to-purple-600 rounded-3xl flex items-center justify-center shadow-xl shadow-blue-500/20",children:e.jsx(Hs,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:a.orderNumber}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:((ne=a.supplier)==null?void 0:ne.name)||"Unknown Supplier"})]})]}),e.jsx("button",{onClick:p,className:"p-2.5 hover:bg-red-50 hover:text-red-600 rounded-2xl transition-all duration-200 hover:scale-105 group",children:e.jsx(oe,{className:"w-6 h-6 group-hover:rotate-90 transition-transform duration-200"})})]}),e.jsx("div",{className:"flex border-b bg-gradient-to-r from-gray-50 to-gray-100/50",children:x.map(o=>{const N=o.icon,Y=S===o.key;return e.jsxs("button",{onClick:()=>i(o.key),className:`flex-1 flex items-center justify-center gap-3 px-6 py-4 font-semibold transition-all duration-200 group ${Y?"text-blue-600 border-b-3 border-blue-600 bg-white shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-white/60"}`,children:[e.jsx(N,{className:`w-5 h-5 transition-all duration-200 ${Y?"scale-110":"group-hover:scale-105"}`}),e.jsx("span",{className:"hidden sm:inline",children:o.label}),e.jsx("span",{className:"sm:hidden text-xs",children:o.label.slice(0,4)})]},o.key)})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:j?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(je,{size:"lg",color:"blue"}),e.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[S==="overview"&&e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200/60 rounded-3xl p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-2xl flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5 text-blue-600"})}),"Order Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Order Number:"}),e.jsx("span",{className:"font-bold font-mono text-gray-900 bg-gray-50 px-3 py-1 rounded-lg",children:a.orderNumber})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Status:"}),e.jsx("span",{className:`px-4 py-2 rounded-2xl text-xs font-bold border ${K(a.status)}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.status==="sent"&&e.jsx(Ne,{className:"w-4 h-4"}),a.status==="received"&&e.jsx(W,{className:"w-4 h-4"}),a.status==="completed"&&e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:a.status.replace("_"," ")})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Created:"}),e.jsxs("span",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-gray-400"}),Z(a.createdAt)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Expected Delivery:"}),e.jsxs("span",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-gray-400"}),a.expectedDeliveryDate?Z(a.expectedDeliveryDate):"Not set"]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Currency:"}),e.jsx("span",{className:"font-bold text-gray-900 bg-indigo-50 px-3 py-1 rounded-2xl",children:a.currency||"TZS"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200/60 rounded-3xl p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-2xl flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-orange-600"})}),"Supplier Details"]}),a.supplier?e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Company:"}),e.jsx("span",{className:"font-bold text-gray-900",children:a.supplier.name})]}),a.supplier.contactPerson&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Contact:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:a.supplier.contactPerson})]}),a.supplier.phone&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Phone:"}),e.jsx("span",{className:"font-semibold text-blue-600 hover:text-blue-700 cursor-pointer",children:a.supplier.phone})]}),a.supplier.email&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Email:"}),e.jsx("span",{className:"font-semibold text-blue-600 hover:text-blue-700 cursor-pointer",children:a.supplier.email})]})]}):e.jsx("p",{className:"text-gray-500 italic",children:"No supplier information available"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50 border border-emerald-200/60 rounded-3xl p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-2xl flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-emerald-600"})}),"Financial Summary"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex justify-between items-center py-3 bg-white/60 rounded-2xl px-4",children:[e.jsx("span",{className:"text-gray-700 font-semibold",children:"Total Amount:"}),e.jsx("span",{className:"text-3xl font-bold text-gray-900",children:z(a.totalAmount)})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 bg-white/60 rounded-2xl px-4",children:[e.jsx("span",{className:"text-gray-700 font-semibold",children:"Paid:"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-600",children:z(a.totalPaid||0)})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 bg-white/80 rounded-2xl px-4 border-2 border-emerald-200",children:[e.jsx("span",{className:"text-gray-700 font-semibold",children:"Balance:"}),e.jsx("span",{className:`text-2xl font-bold ${a.totalAmount-(a.totalPaid||0)>0?"text-red-600":"text-emerald-600"}`,children:z(a.totalAmount-(a.totalPaid||0))})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("span",{className:`px-6 py-3 rounded-2xl text-sm font-bold border-2 ${q(a.paymentStatus||"unpaid")}`,children:((te=a.paymentStatus)==null?void 0:te.toUpperCase())||"UNPAID"})})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200/60 rounded-3xl p-6 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-2xl flex items-center justify-center",children:e.jsx(Cs,{className:"w-5 h-5 text-purple-600"})}),"Items Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-3xl hover:bg-blue-100 transition-colors duration-200",children:[e.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:((Pe=a.items)==null?void 0:Pe.length)||0}),e.jsx("div",{className:"text-sm text-blue-700 font-semibold",children:"Total Items"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-3xl hover:bg-orange-100 transition-colors duration-200",children:[e.jsx("div",{className:"text-4xl font-bold text-orange-600 mb-2",children:((pe=a.items)==null?void 0:pe.reduce((o,N)=>o+(N.quantity||0),0))||0}),e.jsx("div",{className:"text-sm text-orange-700 font-semibold",children:"Ordered Qty"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-3xl hover:bg-green-100 transition-colors duration-200 md:col-span-2",children:[e.jsx("div",{className:"text-4xl font-bold text-green-600 mb-2",children:((ke=a.items)==null?void 0:ke.reduce((o,N)=>o+(N.receivedQuantity||0),0))||0}),e.jsx("div",{className:"text-sm text-green-700 font-semibold",children:"Received Quantity"})]})]})]}),a.notes&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-3xl p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-2xl flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5 text-amber-600"})}),"Order Notes"]}),e.jsx("p",{className:"text-gray-700 leading-relaxed text-sm",children:a.notes})]})]}),S==="items"&&e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Items Tab"}),e.jsx("p",{className:"text-gray-500",children:"Detailed items view coming soon..."})]})}),S==="payments"&&e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Payments Tab"}),e.jsx("p",{className:"text-gray-500",children:"Payment history view coming soon..."})]})}),S==="history"&&e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(bs,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"History Tab"}),e.jsx("p",{className:"text-gray-500",children:"Order history view coming soon..."})]})})]})}),e.jsxs("div",{className:"p-6 border-t bg-gradient-to-r from-gray-50 to-gray-100/50 rounded-b-[36px]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:X().slice(0,4).map((o,N)=>e.jsxs("button",{onClick:o.onClick,disabled:o.loading,className:`flex items-center justify-center gap-2 px-4 py-3 text-white rounded-xl transition-all hover:scale-105 hover:shadow-lg font-semibold text-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 ${o.color}`,children:[o.loading?e.jsx(je,{size:"sm",color:"white"}):o.icon,o.label]},`${o.type}-${N}`))}),X().length>4&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-3",children:X().slice(4).map((o,N)=>e.jsxs("button",{onClick:o.onClick,disabled:o.loading,className:`flex items-center justify-center gap-2 px-4 py-2.5 text-white rounded-xl transition-all hover:scale-105 hover:shadow-lg font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 ${o.color}`,children:[o.loading?e.jsx(je,{size:"sm",color:"white"}):o.icon,o.label]},`${o.type}-${N+4}`))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:p,className:"px-8 py-3 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white rounded-2xl font-semibold transition-all duration-200 hover:scale-105 hover:shadow-lg shadow-gray-600/20",children:"Close"})})]})]})})},gt=({isOpen:P,onClose:p,suppliers:a,onSupplierUpdate:m})=>{const[k,R]=n.useState(""),[g,y]=n.useState(""),[w,C]=n.useState("name"),[S,i]=n.useState(!1),[j,A]=n.useState(null),[r,v]=n.useState(!1),[O,E]=n.useState(null),[H,V]=n.useState(!1),[z,Z]=n.useState(!1);Ye(),it(P),n.useEffect(()=>{if(P){const l=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=l}}},[P]);const K=n.useMemo(()=>{const l=new Set(a.map(I=>I.country).filter(Boolean));return Array.from(l).sort()},[a]),q=n.useMemo(()=>{let l=a.filter(I=>{var le,X,ne,te;const _=!k||I.name.toLowerCase().includes(k.toLowerCase())||((le=I.contactPerson)==null?void 0:le.toLowerCase().includes(k.toLowerCase()))||((X=I.contact_person)==null?void 0:X.toLowerCase().includes(k.toLowerCase()))||((ne=I.phone)==null?void 0:ne.toLowerCase().includes(k.toLowerCase()))||((te=I.email)==null?void 0:te.toLowerCase().includes(k.toLowerCase())),se=!g||I.country===g;return _&&se});return l.sort((I,_)=>{switch(w){case"orders":return(_.ordersCount||0)-(I.ordersCount||0);case"recent":const se=I.lastOrderDate?new Date(I.lastOrderDate).getTime():0;return(_.lastOrderDate?new Date(_.lastOrderDate).getTime():0)-se;case"rating":return(_.rating||0)-(I.rating||0);case"name":default:return I.name.localeCompare(_.name)}}),l},[a,k,g,w]);if(!P)return null;const x=l=>{E(l),V(!0)},h=async l=>{if(O)try{Z(!0),await Fs(O.id,l),c.success("Supplier updated successfully"),V(!1),E(null),m==null||m()}catch(I){console.error("Error updating supplier:",I),c.error("Failed to update supplier")}finally{Z(!1)}},G=l=>{A(l),v(!0)};return ws.createPortal(e.jsxs("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[70]",style:{top:0,left:0,right:0,bottom:0,overflow:"hidden",overscrollBehavior:"none"},role:"dialog","aria-modal":"true","aria-labelledby":"supplier-modal-title",onClick:l=>{l.target===l.currentTarget&&p()},children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",onClick:l=>l.stopPropagation(),children:[e.jsx("button",{onClick:p,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ce,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{id:"supplier-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Manage Suppliers"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View, edit, and manage your suppliers"})]})]})}),e.jsxs("div",{className:"p-6 pb-0 flex-shrink-0",children:[e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ps,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:k,onChange:l=>R(l.target.value),placeholder:"Search suppliers by name, contact, phone, email...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm"})]}),e.jsxs("select",{value:g,onChange:l=>y(l.target.value),className:"px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm bg-white min-w-[150px]",children:[e.jsx("option",{value:"",children:"All Countries"}),K.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[q.length," of ",a.length," suppliers"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(l=>e.jsxs("div",{onClick:()=>G(l),className:"bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-orange-400 hover:shadow-lg transition-all duration-200 flex flex-col cursor-pointer",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-orange-600 font-bold text-lg",children:l.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-bold text-gray-900 text-sm truncate",children:l.name}),(l.isActive||l.is_active)&&e.jsx(W,{className:"w-4 h-4 text-green-500 flex-shrink-0"})]}),(l.company_name||l.contactPerson||l.contact_person)&&e.jsx("p",{className:"text-xs text-gray-600 truncate",children:l.company_name||l.contactPerson||l.contact_person})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-3 pb-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsxs("span",{children:["Orders: ",e.jsx("strong",{children:l.ordersCount||0})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:l.country&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:at(l.country)}),e.jsx("span",{className:"font-semibold",children:l.preferred_currency||l.currency||"TZS"})]})})]}),(l.phone||l.email)&&e.jsxs("div",{className:"space-y-1 text-xs",children:[l.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Js,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:l.phone})]}),l.email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ks,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:l.email})]})]})]},l.id))}),q.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No suppliers found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filters"})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:e.jsxs("button",{onClick:()=>i(!0),className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl transition-colors font-semibold shadow-md hover:shadow-lg",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Add New Supplier"]})})]}),e.jsx(rt,{isOpen:S,onClose:()=>i(!1),onSuccess:()=>{i(!1),m==null||m()}}),j&&r&&e.jsx("div",{onClick:l=>l.stopPropagation(),children:e.jsx(lt,{supplier:{...j,contact_person:j.contactPerson,is_active:j.isActive,created_at:j.lastOrderDate||new Date().toISOString(),updated_at:new Date().toISOString()},onClose:()=>{v(!1),A(null)},onUpdate:()=>{m==null||m()},onEdit:x})}),H&&O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[80]",onClick:l=>l.stopPropagation(),children:e.jsx("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:e.jsx(nt,{supplier:O,onSubmit:h,onCancel:()=>{V(!1),E(null)},loading:z})})})]}),document.body)},Bt=()=>{const{currentUser:P}=js(),p=Ss(),{confirm:a}=Ye(),{startLoading:m,completeLoading:k,failLoading:R}=Ms(),{purchaseOrders:g,isLoading:y,error:w,loadPurchaseOrders:C,deletePurchaseOrder:S,approvePurchaseOrder:i,updatePurchaseOrder:j}=vs(),[A,r]=n.useState(""),[v,O]=n.useState("all"),[E,H]=n.useState("createdAt"),[V]=n.useState("desc"),[z,Z]=n.useState(null),[K,q]=n.useState(!1),[x,h]=n.useState(null),G=We.useRef({}),[l,I]=n.useState(null),[_,se]=n.useState({}),[le,X]=n.useState(!1),[ne,te]=n.useState(!1),[Pe,pe]=n.useState(!1),[ke,o]=n.useState(!1),[N,Y]=n.useState(!1),[Q,de]=n.useState(null),[Se,Ae]=n.useState(!1),[De,me]=n.useState(null),[xe,Ue]=n.useState(!1),[As,Ds]=n.useState([]);We.useEffect(()=>{const s=t=>{t.key==="Escape"&&x&&h(null)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[x]);const es=async()=>{try{const{data:s,error:t}=await Es.from("lats_suppliers").select("*").order("name");if(t){console.error("Error loading suppliers:",t);return}Ds(s||[])}catch(s){console.error("Error loading suppliers:",s)}},Ve=async()=>{console.log("🔄 [PurchaseOrdersPage] Loading purchase orders...");const s=m("Loading purchase orders..."),t=Date.now();try{await C(),await es();const f=Date.now();Z(new Date),k(s),console.log(`✅ [PurchaseOrdersPage] Purchase orders loaded in ${f-t}ms`),console.log("📊 [PurchaseOrdersPage] Total orders:",(g==null?void 0:g.length)||0)}catch(f){console.error("❌ [PurchaseOrdersPage] Error loading purchase orders:",f),R(s,"Failed to load purchase orders")}};n.useEffect(()=>{Ve()},[]),n.useEffect(()=>{g&&g.length>0&&!y&&console.log("🔍 [PurchaseOrdersPage] Purchase orders data:",g.map(s=>{var t,f;return{id:s.id,orderNumber:s.orderNumber,totalAmount:s.totalAmount,currency:s.currency,exchangeRate:s.exchangeRate,totalAmountBaseCurrency:s.totalAmountBaseCurrency,itemsCount:((t=s.items)==null?void 0:t.length)||0,items:(f=s.items)==null?void 0:f.map(d=>{var $,D;return{id:d.id,quantity:d.quantity,costPrice:d.costPrice,totalPrice:d.totalPrice,productName:($=d.product)==null?void 0:$.name,variantName:(D=d.variant)==null?void 0:D.name}}),supplier:s.supplier?{id:s.supplier.id,name:s.supplier.name,country:s.supplier.country}:null}}))},[g,y]);const ue=n.useMemo(()=>{console.log("🔍 [PurchaseOrdersPage] Filtering orders:",{totalOrders:(g==null?void 0:g.length)||0,searchQuery:A,statusFilter:v,sortBy:E,sortOrder:V});let s=g||[];return A&&(s=s.filter(t=>{var f,d,$;return t.orderNumber.toLowerCase().includes(A.toLowerCase())||((d=(f=t.supplier)==null?void 0:f.name)==null?void 0:d.toLowerCase().includes(A.toLowerCase()))||(($=t.notes)==null?void 0:$.toLowerCase().includes(A.toLowerCase()))}),console.log(`🔎 [PurchaseOrdersPage] Search filtered: ${s.length} orders match "${A}"`)),v!=="all"&&(s=s.filter(t=>t.status===v),console.log(`📋 [PurchaseOrdersPage] Status filtered: ${s.length} orders with status "${v}"`)),s.sort((t,f)=>{let d,$;switch(E){case"orderNumber":d=t.orderNumber,$=f.orderNumber;break;case"totalAmount":d=t.totalAmount,$=f.totalAmount;break;default:d=new Date(t.createdAt).getTime(),$=new Date(f.createdAt).getTime()}return V==="asc"?d>$?1:-1:d<$?1:-1}),console.log(`✅ [PurchaseOrdersPage] Final filtered result: ${s.length} orders`),s},[g,A,v,E,V]),ss=async s=>{const t=g==null?void 0:g.find(d=>d.id===s);if(!t){c.error("Order not found");return}if(t.status!=="draft"){c.error("Only draft orders can be deleted");return}if(console.log("🗑️ [PurchaseOrdersPage] Delete order requested:",s),!!await a("Are you sure you want to delete this purchase order? This action cannot be undone."))try{console.log("✅ [PurchaseOrdersPage] Delete confirmed, proceeding...");const d=await S(s);d.ok?(console.log("✅ [PurchaseOrdersPage] Order deleted successfully"),c.success("Purchase order deleted successfully"),await C()):(console.error("❌ [PurchaseOrdersPage] Failed to delete order:",d.message),c.error(d.message||"Failed to delete purchase order"))}catch(d){console.error("Error deleting purchase order:",d),c.error("Failed to delete purchase order")}},ts=s=>{switch(s){case"draft":return"bg-gray-500 text-white shadow-sm";case"sent":return"bg-blue-600 text-white shadow-sm";case"confirmed":return"bg-indigo-600 text-white shadow-sm";case"partial_received":return"bg-orange-500 text-white shadow-sm";case"received":return"bg-sky-500 text-white shadow-sm";case"completed":return"bg-green-600 text-white shadow-sm";case"cancelled":return"bg-red-600 text-white shadow-sm";default:return"bg-gray-400 text-white shadow-sm"}},as=s=>{switch(s){case"draft":return e.jsx(J,{className:"w-3 h-3"});case"sent":return e.jsx(Le,{className:"w-3 h-3"});case"confirmed":return e.jsx(W,{className:"w-3 h-3"});case"partial_received":return e.jsx(Be,{className:"w-3 h-3"});case"received":return e.jsx(Ee,{className:"w-3 h-3"});case"completed":return e.jsx(W,{className:"w-3 h-3"});case"cancelled":return e.jsx(Us,{className:"w-3 h-3"});default:return e.jsx(M,{className:"w-3 h-3"})}},B=(s,t="TSh")=>{console.log("🔍 [formatCurrency] Input:",{amount:s,currencyCode:t,type:typeof s});const f=typeof s=="string"?parseFloat(s)||0:s||0;if(!f||f===0)return"TSh 0";if(t==="TSh"||t==="TZS"||!t){const d=`TSh ${f.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}`;return console.log("🔍 [formatCurrency] TSh result:",d),d}try{const d=new Intl.NumberFormat("en-TZ",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(f);return console.log("🔍 [formatCurrency] Intl result:",d),d}catch{const $=`${t} ${f.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}`;return console.log("🔍 [formatCurrency] Fallback result:",$),$}},qe=s=>{if(!s)return"Not set";const t=new Date(s);return isNaN(t.getTime())?"Not set":t.toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"})},Ts=s=>{var $,D;const t=[],d=["draft","sent","confirmed","partial_received","received","completed","cancelled"].includes(s.status)?s.status:"draft";switch(d!==s.status&&console.warn(`⚠️ Invalid PO status detected: "${s.status}" for order ${s.id} - using "draft" as fallback`),d){case"draft":t.push({type:"send",label:"Send to Supplier",icon:e.jsx(Le,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:()=>$s(s.id)}),t.push({type:"delete",label:"Delete",icon:e.jsx(Je,{className:"w-4 h-4"}),color:"bg-red-600 hover:bg-red-700",onClick:()=>ss(s.id)});break;case"sent":const L=s.totalAmountBaseCurrency||s.totalAmount||0;(s.totalPaidBaseCurrency||s.totalPaid||0)>=L?t.push({type:"receive",label:"Receive Items",icon:e.jsx(M,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:()=>_e(s)}):t.push({type:"receive",label:"Receive Items",icon:e.jsx(M,{className:"w-4 h-4"}),color:"bg-gray-400 hover:bg-gray-500",disabled:!0,onClick:()=>{c.error("Payment required before receiving items. Please make payment first.")}}),t.push({type:"print",label:"Print",icon:e.jsx(ye,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>{window.print(),c.success("Preparing print view...")}});break;case"confirmed":const $e=s.totalAmountBaseCurrency||s.totalAmount||0;(s.totalPaidBaseCurrency||s.totalPaid||0)>=$e?t.push({type:"receive",label:"Receive Items",icon:e.jsx(M,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:()=>_e(s)}):t.push({type:"receive",label:"Receive Items",icon:e.jsx(M,{className:"w-4 h-4"}),color:"bg-gray-400 hover:bg-gray-500",disabled:!0,onClick:()=>{c.error("Payment required before receiving items. Please make payment first.")}}),t.push({type:"print",label:"Print",icon:e.jsx(ye,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>{window.print(),c.success("Preparing print view...")}});break;case"partial_received":const F=s.totalAmountBaseCurrency||s.totalAmount||0,U=(s.totalPaidBaseCurrency||s.totalPaid||0)>=F,Ie=(($=s.items)==null?void 0:$.reduce((ie,b)=>ie+(b.quantity||0),0))||0,Re=((D=s.items)==null?void 0:D.reduce((ie,b)=>ie+(b.receivedQuantity||0),0))||0,be=Ie-Re;U?t.push({type:"receive",label:`Continue (${be} left)`,icon:e.jsx(M,{className:"w-4 h-4"}),color:"bg-orange-600 hover:bg-orange-700",onClick:()=>_e(s)}):t.push({type:"receive",label:`Continue (${be} left)`,icon:e.jsx(M,{className:"w-4 h-4"}),color:"bg-gray-400 hover:bg-gray-500",disabled:!0,onClick:()=>{c.error("Payment required before receiving remaining items. Please make payment first.")}}),t.push({type:"print",label:"Print",icon:e.jsx(ye,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>{window.print(),c.success("Preparing print view...")}});break;case"received":t.push({type:"complete",label:"Complete Order",icon:e.jsx(Ee,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:()=>Is(s.id)}),t.push({type:"quality",label:"Quality Check",icon:e.jsx(Be,{className:"w-4 h-4"}),color:"bg-purple-600 hover:bg-purple-700",onClick:()=>{window.open(`/lats/purchase-orders/${s.id}?tab=quality`,"_blank"),c.success("Opening quality check in new tab...")}}),t.push({type:"duplicate",label:"Duplicate",icon:e.jsx(re,{className:"w-4 h-4"}),color:"bg-indigo-600 hover:bg-indigo-700",onClick:()=>p(`/lats/purchase-order/create?duplicate=${s.id}`)}),t.push({type:"print",label:"Print",icon:e.jsx(ye,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>{window.print(),c.success("Preparing print view...")}});break;case"completed":t.push({type:"duplicate",label:"Duplicate",icon:e.jsx(re,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>p(`/lats/purchase-order/create?duplicate=${s.id}`)}),t.push({type:"print",label:"Print",icon:e.jsx(ye,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>{window.print(),c.success("Preparing print view...")}});break;case"cancelled":t.push({type:"restore",label:"Restore",icon:e.jsx(fs,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:async()=>{if(await a("Are you sure you want to restore this order to draft?"))try{const b=await j(s.id,{status:"draft"});b.ok?(c.success("Order restored to draft"),await C()):c.error(b.message||"Failed to restore order")}catch(b){console.error("Error restoring order:",b),c.error("Failed to restore order")}}}),t.push({type:"duplicate",label:"Duplicate",icon:e.jsx(re,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>p(`/lats/purchase-order/create?duplicate=${s.id}`)});break;default:console.warn(`⚠️ Unexpected PO status after validation: ${d}`);break}if(d!=="completed"&&d!=="cancelled"){const L=s.totalAmountBaseCurrency||s.totalAmount||0;!((s.totalPaidBaseCurrency||s.totalPaid||0)>=L)&&L>0&&t.push({type:"payment",label:"Make Payment",icon:e.jsx(he,{className:"w-4 h-4"}),color:"bg-orange-600 hover:bg-orange-700",onClick:()=>Rs(s)})}return["draft","sent","confirmed","shipped"].includes(d)&&(t.find(L=>L.type==="edit")||t.push({type:"edit",label:"Edit Order",icon:e.jsx(Ke,{className:"w-4 h-4"}),color:"bg-purple-600 hover:bg-purple-700",onClick:()=>p(`/lats/purchase-order/create?edit=${s.id}`)})),!t.find(L=>L.type==="duplicate")&&d!=="cancelled"&&t.push({type:"duplicate",label:"Duplicate",icon:e.jsx(re,{className:"w-4 h-4"}),color:"bg-indigo-600 hover:bg-indigo-700",onClick:()=>p(`/lats/purchase-order/create?duplicate=${s.id}`)}),t},Os=s=>{const t=[];return t.push({id:"view",label:"View Details",description:"See complete order information",icon:e.jsx(we,{className:"w-5 h-5"}),color:"bg-blue-500",hoverColor:"hover:bg-blue-50",onClick:()=>p(`/lats/purchase-orders/${s.id}`)}),["draft","sent","confirmed","shipped"].includes(s.status)&&t.push({id:"edit",label:"Edit Order",description:"Modify order details and items",icon:e.jsx(Ke,{className:"w-5 h-5"}),color:"bg-green-500",hoverColor:"hover:bg-green-50",onClick:()=>p(`/lats/purchase-order/create?edit=${s.id}`)}),t.push({id:"duplicate",label:"Duplicate Order",description:"Create a copy of this order",icon:e.jsx(re,{className:"w-5 h-5"}),color:"bg-purple-500",hoverColor:"hover:bg-purple-50",onClick:()=>p(`/lats/purchase-order/create?duplicate=${s.id}`)}),t.push({id:"pdf",label:"Generate PDF",description:"Download order as PDF document",icon:e.jsx(J,{className:"w-5 h-5"}),color:"bg-orange-500",hoverColor:"hover:bg-orange-50",onClick:()=>{c.success("Generating PDF..."),p(`/lats/purchase-orders/${s.id}?action=print`)}}),s.status!=="completed"&&s.status!=="cancelled"&&t.push({id:"payment",label:"Manage Payment",description:"Record or update payment status",icon:e.jsx(he,{className:"w-5 h-5"}),color:"bg-indigo-500",hoverColor:"hover:bg-indigo-50",onClick:()=>p(`/lats/purchase-orders/${s.id}?tab=payment`)}),(s.status==="received"||s.status==="partial_received")&&t.push({id:"quality",label:"Quality Check",description:"Mark items as quality verified",icon:e.jsx(Be,{className:"w-5 h-5"}),color:"bg-teal-500",hoverColor:"hover:bg-teal-50",onClick:()=>p(`/lats/purchase-orders/${s.id}?tab=quality`)}),t.push({id:"delete",label:"Delete Order",description:"Permanently remove this order from database",icon:e.jsx(Je,{className:"w-5 h-5"}),color:"bg-red-500",hoverColor:"hover:bg-red-50",onClick:()=>ss(s.id),divider:!0}),t},$s=async s=>{try{const t=await i(s);t.ok?(await j(s,{status:"sent"})).ok?(c.success("Order approved and sent to supplier"),await C()):(c.success("Order approved (send manually from details)"),await C()):c.error(t.message||"Failed to approve order")}catch(t){console.error("Error approving and sending order:",t),c.error("Failed to process order")}},Is=async s=>{const t=g==null?void 0:g.find(d=>d.id===s);if(!t){c.error("Order not found");return}if(t.status!=="received"){c.error("Order must be received before completing");return}if(await a("Are you sure you want to complete this purchase order?"))try{const d=await j(s,{status:"completed"});d.ok?(c.success("Purchase order completed successfully"),await C()):c.error(d.message||"Failed to complete purchase order")}catch(d){console.error("Error completing purchase order:",d),c.error("Failed to complete purchase order")}},Rs=s=>{const t=s.totalAmountBaseCurrency||s.totalAmount||0;if((s.totalPaidBaseCurrency||s.totalPaid||0)>=t){c.error("This purchase order has already been fully paid");return}if(t===0){c.error("Cannot make payment: Purchase order has no total amount. Please add items to the order first.");return}de(s),Y(!0)},_e=s=>{const t=s.totalAmountBaseCurrency||s.totalAmount||0;if(!((s.totalPaidBaseCurrency||s.totalPaid||0)>=t)){c.error("Payment required before receiving items. Please make payment first.");return}p(`/lats/purchase-orders/${s.id}?action=receive`)};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col max-h-[95vh]",children:[e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(M,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Purchase Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your purchase orders and inventory"})]})]}),e.jsx(et,{to:"/lats",label:"",className:"!w-12 !h-12 !p-0 !rounded-full !bg-blue-600 hover:!bg-blue-700 !shadow-lg flex items-center justify-center",iconClassName:"text-white"})]})}),e.jsx("div",{className:"px-8 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100/50 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>p("/lats/purchase-order/create"),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-orange-500 to-amber-600 text-white shadow-lg hover:from-orange-600 hover:to-amber-700",children:[e.jsx(Xe,{size:18}),e.jsx("span",{children:"Create PO"})]}),e.jsxs("button",{onClick:()=>q(!0),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg hover:from-green-600 hover:to-emerald-700",title:"CBM Calculator",children:[e.jsx(Ks,{size:18}),e.jsx("span",{children:"CBM Calculator"})]}),e.jsxs("button",{onClick:()=>Ue(!0),className:"flex items-center gap-2 px-6 py-3 font-semibold text-sm rounded-xl transition-all duration-200 bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg hover:from-blue-600 hover:to-blue-700",children:[e.jsx(Ce,{size:18}),e.jsx("span",{children:"Manage Suppliers"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"p-6 pb-0 flex-shrink-0",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(200px, 100%), 1fr))",gap:"1rem"},children:[e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-2xl p-5 hover:bg-blue-100 hover:border-blue-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(M,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ue.length})]})]})}),e.jsx("div",{className:"bg-green-50 border-2 border-green-200 rounded-2xl p-5 hover:bg-green-100 hover:border-green-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(ge,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B(ue.reduce((s,t)=>{if(t.totalAmountBaseCurrency&&t.totalAmountBaseCurrency>0)return s+t.totalAmountBaseCurrency;if(t.totalAmount&&t.totalAmount>0)return t.currency&&t.currency!=="TZS"&&t.exchangeRate&&t.exchangeRate>0?s+t.totalAmount*t.exchangeRate:s+t.totalAmount;if(t.items&&t.items.length>0){const f=t.items.reduce((d,$)=>d+($.totalPrice||$.quantity*$.costPrice),0);return t.currency&&t.currency!=="TZS"&&t.exchangeRate&&t.exchangeRate>0?s+f*t.exchangeRate:s+f}return s},0),"TSh")})]})]})}),e.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-5 hover:bg-orange-100 hover:border-orange-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ue.filter(s=>s.status==="draft"||s.status==="sent"||s.status==="partial_received").length})]})]})}),e.jsx("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-2xl p-5 hover:bg-purple-100 hover:border-purple-300 transition-all shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(W,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ue.filter(s=>s.status==="received").length})]})]})})]})}),e.jsx("div",{className:"p-6 pb-0 flex-shrink-0 border-t border-gray-100 bg-white",children:e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search orders, suppliers, or notes...",value:A,onChange:s=>r(s.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all text-gray-900 bg-white font-medium"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("select",{value:v,onChange:s=>O(s.target.value),className:"px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all text-gray-900 bg-white font-medium min-w-[140px]",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"received",children:"Received"})]}),e.jsxs("select",{value:E,onChange:s=>H(s.target.value),className:"px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all text-gray-900 bg-white font-medium min-w-[160px]",children:[e.jsx("option",{value:"createdAt",children:"Date Created"}),e.jsx("option",{value:"orderNumber",children:"Order Number"}),e.jsx("option",{value:"totalAmount",children:"Total Amount"})]}),e.jsxs("button",{onClick:Ve,disabled:y,className:"flex items-center gap-2 px-4 py-3 border-2 border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 hover:border-orange-300 transition-all disabled:opacity-50 bg-white font-medium",children:[y?e.jsx(je,{size:"sm",color:"blue"}):e.jsx(fs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>X(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition-all shadow-sm hover:shadow-md font-medium text-sm",title:"PO Analytics",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Analytics"})]}),e.jsxs("button",{onClick:()=>te(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-green-50 text-green-600 rounded-xl hover:bg-green-100 transition-all shadow-sm hover:shadow-md font-medium text-sm",title:"Team Collaboration",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Collaboration"})]}),e.jsxs("button",{onClick:()=>pe(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-purple-50 text-purple-600 rounded-xl hover:bg-purple-100 transition-all shadow-sm hover:shadow-md font-medium text-sm",title:"Approval Workflow",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Approval"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-orange-50 text-orange-600 rounded-xl hover:bg-orange-100 transition-all shadow-sm hover:shadow-md font-medium text-sm",title:"Advanced Reporting",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Reporting"})]})]}),z&&e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-100 px-3 py-2 rounded-xl font-medium",children:["Last: ",z.toLocaleTimeString()]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 border-t border-gray-100",children:[w&&e.jsx("div",{className:"mb-4 bg-red-50 border-2 border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(Ne,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:w})]})]})}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(je,{size:"sm",color:"purple"})}):ue.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(M,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No purchase orders found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:A||v!=="all"?"Try adjusting your search or filters":"Get started by creating your first purchase order"}),!A&&v==="all"&&e.jsxs("button",{onClick:()=>p("/lats/purchase-order/create"),className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 text-white rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Purchase Order"})]})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"space-y-3 mb-4",children:ue.map(s=>{var d,$,D,L,Te,Oe,$e,ze;const t=Ts(s),f=(($=(d=s.supplier)==null?void 0:d.name)==null?void 0:$.toLowerCase())==="lin";return e.jsxs("div",{className:`border-2 rounded-2xl bg-white shadow-sm transition-all duration-300 hover:shadow-lg cursor-pointer relative ${l===s.id?"border-blue-500 shadow-xl":f?"border-orange-400 shadow-lg":"border-gray-200 hover:border-orange-400"}`,children:[e.jsx("div",{className:"md:hidden p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(M,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:s.orderNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:qe(s.createdAt)})]})]}),e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-xs font-semibold shadow-sm ${ts(s.status)}`,children:[as(s.status),e.jsx("span",{className:"capitalize",children:s.status.replace("_"," ")})]})]}),s.supplier&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-orange-500 to-amber-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white text-xs font-bold",children:s.supplier.name.charAt(0).toUpperCase()})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.supplier.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:(()=>{if(s.totalAmount&&s.totalAmount>0)return B(s.totalAmount,s.currency);if(s.items&&s.items.length>0){const u=s.items.reduce((F,T)=>F+(T.totalPrice||T.quantity*T.costPrice),0);if(u>0)return B(u,s.currency)}return B(0,s.currency||"TSh")})()}),e.jsxs("span",{className:"text-xs text-gray-600",children:[((D=s.items)==null?void 0:D.reduce((u,F)=>u+(F.quantity||0),0))||0," items"]})]}),e.jsx("div",{className:"flex items-center gap-2 pt-2",children:t.map((u,F)=>e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("button",{ref:u.type==="more"?T=>{G.current[s.id]=T}:void 0,onClick:T=>{T.preventDefault(),T.stopPropagation(),u.onClick(T)},className:`w-full flex items-center justify-center gap-1.5 px-2 py-2.5 text-white rounded-xl transition-all shadow-md hover:shadow-lg text-xs font-semibold ${u.color}`,title:u.label,children:[u.icon,e.jsx("span",{children:u.label})]}),u.type==="more"&&e.jsx(ct,{isOpen:x===s.id,onClose:()=>h(null),position:"right",items:Os(s),triggerRef:{current:G.current[s.id]}})]},`${u.type}-${F}`))})]})}),e.jsxs("div",{className:"hidden md:block w-full",children:[e.jsxs("div",{className:"flex items-start justify-between p-6 cursor-pointer",onClick:()=>I(l===s.id?null:s.id),children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-7 h-7 rounded-lg flex items-center justify-center transition-all flex-shrink-0 ${l===s.id?"bg-orange-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-600"}`,children:e.jsx(ys,{className:`w-5 h-5 transition-transform duration-200 ${l===s.id?"rotate-180":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 truncate",children:s.orderNumber}),e.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-base font-bold ${ts(s.status)} flex items-center gap-2 flex-shrink-0`,children:[as(s.status),e.jsx("span",{children:s.status.replace("_"," ").split(" ").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" ")})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[s.supplier&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-50 text-blue-700 border border-blue-200 flex-shrink-0",children:[e.jsx(Ce,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base font-semibold truncate max-w-[140px]",children:s.supplier.name})]}),e.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 rounded-lg bg-gray-50 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-teal-600"}),e.jsx("span",{className:"text-base font-semibold text-teal-700",children:((L=s.items)==null?void 0:L.length)||0}),e.jsx("span",{className:"text-sm text-teal-600 font-medium",children:(((Te=s.items)==null?void 0:Te.length)||0)!==1?"items":"item"})]}),e.jsx("div",{className:"w-px h-5 bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"w-5 h-5 text-pink-600"}),e.jsx("span",{className:"text-base font-semibold text-pink-700",children:((Oe=s.items)==null?void 0:Oe.reduce((u,F)=>u+(F.quantity||0),0))||0}),e.jsx("span",{className:"text-sm text-pink-600 font-medium",children:"qty"})]}),e.jsx("div",{className:"w-px h-5 bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-base font-medium text-gray-600",children:qe(s.createdAt)})]})]}),s.expectedDeliveryDate&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-50 text-amber-700 border border-amber-200",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"ETA:"}),e.jsx("span",{className:"text-base font-semibold",children:qe(s.expectedDeliveryDate)})]}),s.currency&&s.currency!=="TZS"&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-50 text-purple-700 border border-purple-200",children:[e.jsx("span",{className:"text-base font-bold",children:s.currency}),s.exchangeRate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:"•"}),e.jsxs("span",{className:"text-sm font-medium",children:["1 = ",s.exchangeRate," TZS"]})]})]})]})]})]}),(s.totalAmount||0)>0&&e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ge,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500 font-medium uppercase tracking-wide",children:"Total Amount"})]}),e.jsx("div",{className:"flex flex-col",children:s.currency&&s.currency!=="TZS"&&s.totalAmountBaseCurrency?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-4xl font-bold text-gray-900 leading-tight",children:B(s.totalAmountBaseCurrency,"TZS")}),e.jsxs("span",{className:"text-sm text-gray-500 mt-0.5 font-medium",children:["(",B(s.totalAmount||0,s.currency),")"]})]}):e.jsx("span",{className:"text-4xl font-bold text-gray-900 leading-tight",children:B(s.totalAmount||0,s.currency||"TZS")})})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-5 py-3 rounded-xl text-base font-bold shadow-sm ${(s.totalPaid||0)>=s.totalAmount?"bg-green-500 text-white":(s.totalPaid||0)>0?"bg-yellow-500 text-white":"bg-red-500 text-white"}`,children:[(s.totalPaid||0)>=s.totalAmount?e.jsx(W,{className:"w-5 h-5"}):(s.totalPaid||0)>0?e.jsx(ce,{className:"w-5 h-5"}):e.jsx(Ne,{className:"w-5 h-5"}),(s.totalPaid||0)>=s.totalAmount?"Paid":(s.totalPaid||0)>0?"Partial":"Unpaid"]})})]})})]}),l===s.id&&e.jsx("div",{className:"mt-5 pt-5 border-t-2 border-gray-200 relative",children:e.jsx("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-center -mt-3",children:e.jsx("span",{className:"bg-white px-5 py-1.5 text-xs text-gray-500 font-semibold uppercase tracking-wider rounded-full border border-gray-200 shadow-sm",children:"Order Details"})})}),l===s.id&&e.jsxs("div",{className:"px-6 pb-6 pt-2",children:[e.jsx("div",{className:"mb-4",children:(()=>{var Ie,Re,be,ie;const F=(((Ie=s.items)==null?void 0:Ie.length)||0)>2,T=_[s.id]!==!1,U=T&&F?((Re=s.items)==null?void 0:Re.slice(0,2))||[]:s.items||[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-600"}),"Order Items (",((be=s.items)==null?void 0:be.length)||0,")"]}),F&&e.jsx("button",{type:"button",onClick:b=>{b.stopPropagation(),se(Fe=>({...Fe,[s.id]:!Fe[s.id]}))},className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-blue-600 hover:text-blue-700 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:T?e.jsxs(e.Fragment,{children:[e.jsx(ys,{className:"w-4 h-4"}),"View More"]}):e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"w-4 h-4"}),"View Less"]})})]}),U.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:U.map((b,Fe)=>{var rs,ls,ns,is,os;const Me=b.receivedQuantity||0,fe=b.quantity||0,ae=fe>0?Me/fe*100:0;return e.jsxs("div",{className:"p-3 sm:p-4 md:p-6 cursor-pointer flex flex-col h-full bg-white rounded-xl border border-gray-200 hover:border-blue-400 hover:shadow-md transition-all duration-200 shadow-sm relative",children:[e.jsx("div",{className:`absolute -top-2 -right-2 sm:-top-3 sm:-right-3 p-1.5 sm:p-2 rounded-full border-2 border-white shadow-lg flex items-center justify-center z-20 min-w-[2rem] min-h-[2rem] sm:min-w-[2.5rem] sm:min-h-[2.5rem] transition-all duration-300 ${ae>=100?"bg-gradient-to-r from-green-500 to-green-600":ae>0?"bg-gradient-to-r from-orange-500 to-orange-600":"bg-gradient-to-r from-red-500 to-red-600"}`,children:e.jsx("span",{className:"text-xs sm:text-sm font-bold text-white whitespace-nowrap px-1",children:Me>0?`${Me}/${fe}`:fe})}),e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"relative w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 rounded-xl flex items-center justify-center flex-shrink-0",children:(()=>{var ds,ms,xs,us,hs;const Ze=((ms=(ds=b.product)==null?void 0:ds.images)==null?void 0:ms.find(Qe=>Qe.isPrimary))||((us=(xs=b.product)==null?void 0:xs.images)==null?void 0:us[0]),cs=Ze==null?void 0:Ze.url;return cs?e.jsx("img",{src:cs,alt:((hs=b.product)==null?void 0:hs.name)||"Product",className:"w-full h-full object-cover rounded-xl",onError:Qe=>{Qe.target.style.display="none"}}):e.jsx("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg flex items-center justify-center w-full h-full rounded-xl",children:e.jsx(M,{className:"w-10 h-10 sm:w-12 sm:h-12 text-gray-400"})})})()}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-16 sm:h-20 md:h-24 justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800 truncate text-sm sm:text-base md:text-lg lg:text-xl leading-tight",title:((rs=b.product)==null?void 0:rs.name)||`Product ${b.productId}`,children:((ls=b.product)==null?void 0:ls.name)||`Product ${b.productId}`}),((ns=b.variant)==null?void 0:ns.name)&&b.variant.name!=="Default Variant"&&e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5 sm:mt-1 font-medium",children:["Variant: ",b.variant.name]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg sm:text-xl md:text-2xl text-gray-700 mt-0.5 sm:mt-1 font-bold",children:s.currency&&s.currency!=="TZS"&&s.exchangeRate?e.jsxs(e.Fragment,{children:[B((b.totalPrice||(b.quantity||0)*(b.costPrice||0))*(s.exchangeRate||1),"TZS"),s.currency&&s.currency!=="TZS"&&e.jsxs("span",{className:"text-sm sm:text-base text-gray-500 ml-2",children:["(",B(b.totalPrice||(b.quantity||0)*(b.costPrice||0),s.currency),")"]})]}):B(b.totalPrice||(b.quantity||0)*(b.costPrice||0),"TZS")}),e.jsxs("div",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:["Unit: ",B(b.costPrice||0,"TZS")]})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-4",children:(s.status==="partial_received"||s.status==="received"||s.status==="completed")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-700",children:["Received: ",e.jsxs("span",{className:"text-gray-900",children:[Me,"/",fe]})]}),e.jsxs("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full ${ae>=100?"bg-green-100 text-green-900":ae>0?"bg-orange-100 text-orange-900":"bg-gray-100 text-gray-900"}`,children:[ae.toFixed(0),"%"]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:((is=b.product)==null?void 0:is.category)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium",children:["📦 ",String(typeof b.product.category=="string"?b.product.category:((os=b.product.category)==null?void 0:os.name)||"Category")]})})]}),(s.status==="partial_received"||s.status==="received"||s.status==="completed")&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2 overflow-hidden shadow-inner",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${ae>=100?"bg-gradient-to-r from-green-500 to-emerald-500":ae>0?"bg-gradient-to-r from-orange-400 to-orange-500":"bg-gray-300"}`,style:{width:`${Math.min(ae,100)}%`}})})})]},Fe)})}):e.jsx("div",{className:"rounded-xl border border-dashed border-gray-200 bg-gray-50 py-10 text-center text-sm text-gray-500",children:"No items found for this order."}),T&&F&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Showing first ",2," items of ",((ie=s.items)==null?void 0:ie.length)||0,". Tap View More to see all."]})]})})()}),(s.totalAmount||0)>0&&e.jsxs("div",{className:"mt-4 mb-4 bg-green-50 rounded-xl p-4 border border-green-200",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-green-600"}),"Financial Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-green-200",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Total Paid:"}),e.jsx("span",{className:"text-xl font-bold text-emerald-600",children:(()=>{const u=s.totalPaid||0;return s.currency&&s.currency!=="TZS"&&s.exchangeRate&&s.totalPaidBaseCurrency?B(s.totalPaidBaseCurrency,"TZS"):B(u,"TZS")})()})]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Remaining:"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:(()=>{const u=s.totalAmountBaseCurrency||s.totalAmount||0,F=s.totalPaidBaseCurrency||s.totalPaid||0,T=u-F;if(s.currency&&s.currency!=="TZS"&&s.exchangeRate){const U=T/(s.exchangeRate||1);return e.jsxs(e.Fragment,{children:[B(T,"TZS"),U>0&&e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",B(U,s.currency),")"]})]})}return B(T,"TZS")})()})]})]})]}),(s.trackingNumber||s.shippingStatus||s.shippingNotes)&&e.jsxs("div",{className:"mt-4 mb-4 bg-purple-50 rounded-xl p-4 border border-purple-200",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ns,{className:"w-5 h-5 text-purple-600"}),"Shipping Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.trackingNumber&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-purple-200",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Tracking Number:"}),e.jsx("span",{className:"font-bold font-mono text-gray-900",children:s.trackingNumber})]}),s.shippingStatus&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-purple-200",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Shipping Status:"}),e.jsx("span",{className:"font-semibold text-purple-700 capitalize",children:s.shippingStatus.replace("_"," ")})]}),s.shippingNotes&&e.jsxs("div",{className:"md:col-span-2 py-2",children:[e.jsx("span",{className:"text-gray-600 font-medium block mb-1",children:"Shipping Notes:"}),e.jsx("p",{className:"text-gray-700 text-sm",children:s.shippingNotes})]})]})]}),s.notes&&e.jsxs("div",{className:"mt-4 mb-4 bg-yellow-50 rounded-xl p-4 border border-yellow-200",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-yellow-600"}),"Order Notes"]}),e.jsx("p",{className:"text-gray-700 leading-relaxed text-sm",children:s.notes})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-2",children:[(($e=s.supplier)==null?void 0:$e.phone)&&e.jsxs("button",{onClick:u=>{u.stopPropagation();const F=`Hello, regarding Purchase Order #${s.orderNumber}. Please provide status update.`,T=`https://wa.me/${s.supplier.phone.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(F)}`;window.open(T,"_blank"),c.success("Opening WhatsApp...")},className:"flex items-center justify-center gap-2 px-3 py-2 bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 rounded-lg transition-all text-sm font-medium",title:"Message on WhatsApp",children:[e.jsx(Ys,{className:"w-4 h-4"}),"WhatsApp"]}),((ze=s.supplier)==null?void 0:ze.email)&&e.jsxs("button",{onClick:u=>{u.stopPropagation();const F=`Purchase Order #${s.orderNumber}`,T=`Hello,

Regarding Purchase Order #${s.orderNumber}...

Best regards`,U=`mailto:${s.supplier.email}?subject=${encodeURIComponent(F)}&body=${encodeURIComponent(T)}`;window.location.href=U,c.success("Opening email client...")},className:"flex items-center justify-center gap-2 px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-all text-sm font-medium",title:"Send email",children:[e.jsx(ks,{className:"w-4 h-4"}),"Email"]}),e.jsxs("button",{onClick:u=>{u.stopPropagation(),window.open(`/lats/purchase-orders/${s.id}?tab=notes`,"_blank"),c.success("Opening notes in new tab...")},className:"flex items-center justify-center gap-2 px-3 py-2 bg-yellow-50 hover:bg-yellow-100 text-yellow-700 border border-yellow-200 rounded-lg transition-all text-sm font-medium",title:"View notes",children:[e.jsx(J,{className:"w-4 h-4"}),"Notes"]}),e.jsxs("button",{onClick:u=>{u.stopPropagation(),window.open(`/lats/purchase-orders/${s.id}?tab=payment`,"_blank"),c.success("Opening payments in new tab...")},className:"flex items-center justify-center gap-2 px-3 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 border border-purple-200 rounded-lg transition-all text-sm font-medium",title:"Payment history",children:[e.jsx(he,{className:"w-4 h-4"}),"Payments"]})]}),e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-gray-200",children:[t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:t.slice(0,4).map((u,F)=>e.jsxs("button",{onClick:T=>{T.stopPropagation(),typeof u.onClick=="function"&&u.onClick(T)},className:`flex items-center justify-center gap-2 px-4 py-3 text-white rounded-xl transition-all hover:scale-105 hover:shadow-lg font-semibold text-sm ${u.color}`,children:[u.icon,u.label]},`${u.type}-${F}`))}),t.length>4&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:t.slice(4).map((u,F)=>e.jsxs("button",{onClick:T=>{T.stopPropagation(),typeof u.onClick=="function"&&u.onClick(T)},className:`flex items-center justify-center gap-2 px-4 py-2.5 text-white rounded-xl transition-all hover:scale-105 hover:shadow-lg font-medium text-sm ${u.color}`,children:[u.icon,u.label]},`${u.type}-${F+4}`))})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:e.jsxs("button",{onClick:u=>{u.stopPropagation(),me(s),Ae(!0)},className:"flex items-center justify-center gap-2 px-4 py-2.5 text-white bg-indigo-600 hover:bg-indigo-700 rounded-xl transition-all hover:scale-105 hover:shadow-lg font-medium text-sm",title:"View Order Details",children:[e.jsx(we,{className:"w-4 h-4"}),"View Details"]})})]})]})]})]},s.id)})})})]})]})]}),e.jsx(st,{isOpen:K,onClose:()=>q(!1)}),le&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[99999] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:()=>X(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ee,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"PO Analytics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View purchase order analytics and insights"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx(dt,{})})]})}),ne&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[99999] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:()=>te(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(He,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Team Collaboration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Collaborate with your team on purchase orders"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx(mt,{onInviteUser:(s,t)=>console.log("Invite user:",s,t),onSendMessage:s=>console.log("Send message:",s),onRequestApproval:()=>console.log("Request approval")})})]})}),Pe&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[99999] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:()=>pe(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ee,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Approval Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage purchase order approval processes"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx(xt,{onApprove:(s,t)=>console.log("Approve step:",s,t),onReject:(s,t)=>console.log("Reject step:",s,t),onRequestChanges:(s,t)=>console.log("Request changes:",s,t),onSubmitForApproval:()=>console.log("Submit for approval")})})]})}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[99999] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col overflow-hidden relative",children:[e.jsx("button",{onClick:()=>o(!1),className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(J,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Advanced PO Reporting"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate comprehensive purchase order reports"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx(ut,{onExport:s=>console.log("Export report as:",s)})})]})}),N&&Q&&e.jsx(tt,{isOpen:N,onClose:()=>{Y(!1),de(null)},totalAmount:(()=>{const s=Q.totalAmountBaseCurrency||Q.totalAmount||0,t=Q.totalPaidBaseCurrency||Q.totalPaid||0;return s-t})(),discountAmount:0,onProcessPayment:async s=>{try{const{purchaseOrderPaymentService:t}=await gs(()=>import("./purchaseOrderPaymentService-dcbd50c0.js"),["assets/purchaseOrderPaymentService-dcbd50c0.js","assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);let f=[];s.method==="split"?f=s.splitPayments.map(D=>({purchaseOrderId:Q.id,paymentAccountId:D.paymentAccountId||D.accountId,amount:D.amount,currency:"TZS",paymentMethod:D.method||D.paymentMethod,paymentMethodId:D.methodId||D.paymentMethodId,reference:D.reference||null,notes:D.notes||null,createdBy:(P==null?void 0:P.id)||null})):f=[{purchaseOrderId:Q.id,paymentAccountId:s.paymentAccountId||s.accountId,amount:s.amount,currency:"TZS",paymentMethod:s.method||s.paymentMethod,paymentMethodId:s.methodId||s.paymentMethodId,reference:s.reference||null,notes:s.notes||null,createdBy:(P==null?void 0:P.id)||null}];const $=(await Promise.all(f.map(async D=>await t.processPayment(D)))).filter(D=>!D.success);if($.length>0){const D=$.map(L=>L.message).join("; ");c.error(`Some payments failed: ${D}`)}else{c.success("Payment processed successfully");try{const{PurchaseOrderService:D}=await gs(()=>import("./index-61458a34.js").then(L=>L.bh),["assets/index-61458a34.js","assets/vendor-36d2c7c1.js","assets/supabase-cf010ec4.js","assets/routing-eb8c310c.js","assets/ui-28e30067.js","assets/index-e1f77ed5.css"]);await D.updatePaymentStatus(Q.id),console.log("✅ Purchase order payment status updated")}catch(D){console.warn("⚠️ Failed to update payment status:",D)}await C()}Y(!1),de(null)}catch(t){console.error("Error processing payment:",t),c.error("Failed to process payment. Please try again.")}}}),Se&&De&&e.jsx(ht,{isOpen:Se,onClose:()=>{Ae(!1),me(null)},order:De,onOrderUpdate:async()=>{await Ve()}}),xe&&e.jsx(gt,{isOpen:xe,onClose:()=>Ue(!1),suppliers:As||[],onSupplierUpdate:async()=>{await es()}})]})};export{Bt as default};
