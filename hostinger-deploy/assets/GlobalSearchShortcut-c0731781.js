import{u as G,j as e,X as U,s as L,x as ee,c as te,b as re,z as ae}from"./index-61458a34.js";import{r as u,b as J}from"./vendor-36d2c7c1.js";import{X as R,Z as Q,af as se,d as V,a$ as W,a3 as I,b as le,aA as q,q as X,e as oe,c0 as ne,aE as B,S as O,n as z,a9 as Y,y as ie,s as ce,T as de,r as ue,U as H,i as xe,u as ge,O as be,v as me}from"./ui-28e30067.js";import{u as Z}from"./useBodyScrollLock-341c8b9f.js";import{S as pe,a as he}from"./SearchResults-c1876f8f.js";const Se=({isOpen:x,onClose:v,onSuccess:p})=>{const{currentUser:c}=G(),[r,n]=u.useState(!1),[h,y]=u.useState([]),[j,A]=u.useState([]),[N,$]=u.useState(0),[_,k]=u.useState(!1),[i,f]=u.useState({account_id:"",category:"",customCategory:"",description:"",amount:"",vendor_name:"",reference_number:""}),g=(c==null?void 0:c.role)==="customer-care";c==null||c.role;const F=async()=>{if(g){k(!0);try{const l=new Date().toISOString().split("T")[0],{data:t,error:s}=await L.from("lats_sales").select("total_amount").gte("created_at",`${l}T00:00:00`).lte("created_at",`${l}T23:59:59`).eq("status","completed");if(s)throw s;const a=(t==null?void 0:t.reduce((b,S)=>b+(parseFloat(S.total_amount)||0),0))||0;$(a)}catch(l){console.error("Error fetching daily sales:",l),$(0)}finally{k(!1)}}};u.useEffect(()=>{x&&(async()=>await Promise.allSettled([T().catch(t=>{console.error("❌ Failed to load accounts/categories:",t)}),...g?[F().catch(t=>{console.error("❌ Failed to load daily sales:",t)})]:[]]))()},[x,g]);const T=async()=>{try{const l=await U.getPaymentMethods();let t=l;if(g){const a=l.find(b=>b.type==="cash");t=a?[a]:[]}y(t),t.length>0&&!i.account_id&&f(a=>({...a,account_id:t[0].id}));const{data:s}=await L.from("expense_categories").select("*").eq("is_active",!0).order("name");A(s||[])}catch(l){console.error("Error fetching data:",l)}},D=(l,t)=>{f(s=>({...s,[l]:t}))},P=l=>{const s=l.replace(/[^\d.]/g,"").split("."),a=s[0],b=s[1],S=a.replace(/\B(?=(\d{3})+(?!\d))/g,",");return b!==void 0?`${S}.${b}`:S},E=l=>{const s=l.target.value.replace(/,/g,"");(s===""||/^\d*\.?\d{0,2}$/.test(s))&&f(a=>({...a,amount:s}))},M=l=>{f(t=>({...t,account_id:l}))},o=l=>{switch(l.toLowerCase()){case"cash":return W;case"bank":return q;case"mobile_money":return O;case"credit_card":return B;default:return ne}},d=l=>{switch(l.toLowerCase()){case"cash":return"green";case"bank":return"blue";case"mobile_money":return"purple";case"credit_card":return"indigo";default:return"gray"}},m=async()=>{try{if(!i.account_id||!i.amount||!i.description){z.error("Please fill in amount and description");return}const l=parseFloat(i.amount);if(isNaN(l)||l<=0){z.error("Please enter a valid amount");return}if(g&&l>N){z.error(`Amount exceeds daily sales (TSh ${N.toLocaleString()})`);return}n(!0);const t=i.reference_number||`EXP-${Date.now()}`,s=(c==null?void 0:c.role)==="admin",a=s?"approved":"pending",b=i.category==="custom"?i.customCategory.trim():i.category,{error:S}=await L.from("account_transactions").insert({account_id:i.account_id,transaction_type:"expense",amount:l,description:b?`${b}: ${i.description}`:i.description,reference_number:t,status:a,metadata:{category:b||"Other",vendor_name:i.vendor_name||null,expense_date:new Date().toISOString().split("T")[0],created_via:"quick_expense",user_role:c==null?void 0:c.role,daily_sales_at_time:g?N:null,approval_status:a,requires_approval:!s},created_by:c==null?void 0:c.id});if(S)throw S;const C=h.find(K=>K.id===i.account_id);s?z.success(`Expense recorded! ${(C==null?void 0:C.name)||"Account"} balance updated.`,{duration:3e3}):z.success("Expense submitted for admin approval! Pending review.",{duration:3e3}),f({account_id:h.length>0?h[0].id:"",category:"",customCategory:"",description:"",amount:"",vendor_name:"",reference_number:""}),p&&p(),v()}catch(l){console.error("Error adding expense:",l),z.error(l.message||"Failed to record expense")}finally{n(!1)}};Z(x),u.useEffect(()=>{if(x){const l=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=l}}},[x]);const w=l=>{l.key==="Enter"&&l.ctrlKey&&m()};return x?J.createPortal(e.jsx("div",{className:"fixed bg-black/60 flex items-center justify-center p-4 z-[99999]",style:{top:0,left:0,right:0,bottom:0,overflow:"hidden",overscrollBehavior:"none"},role:"dialog","aria-modal":"true","aria-labelledby":"expense-form-title",onClick:v,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",style:{pointerEvents:"auto"},onClick:l=>l.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:v,disabled:r,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-8 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-[auto,1fr] gap-6 items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Q,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",id:"expense-form-title",children:"Quick Expense"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Fast expense entry (Ctrl+Enter to save)"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",onKeyDown:w,children:e.jsxs("div",{className:"space-y-4",children:[g&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-500 rounded-lg",children:e.jsx(se,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"Daily Sales Available"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:_?e.jsx("span",{className:"text-sm",children:"Loading..."}):`TSh ${N.toLocaleString()}`}),e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"You can record expenses up to today's sales amount"})]})]})}),!g&&h.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Pay from Account"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:h.map(l=>{const t=o(l.type),s=d(l.type),a=i.account_id===l.id,b=l.balance||0,C=(()=>({green:{bg:a?"bg-green-50":"bg-white hover:bg-green-50",border:a?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-green-300",iconBg:a?"bg-green-600":"bg-green-100",iconText:a?"text-white":"text-green-600",text:a?"text-green-900":"text-gray-900",amount:a?"text-green-700":"text-green-600"},blue:{bg:a?"bg-blue-50":"bg-white hover:bg-blue-50",border:a?"border-blue-500 ring-2 ring-blue-200":"border-gray-200 hover:border-blue-300",iconBg:a?"bg-blue-600":"bg-blue-100",iconText:a?"text-white":"text-blue-600",text:a?"text-blue-900":"text-gray-900",amount:a?"text-blue-700":"text-blue-600"},purple:{bg:a?"bg-purple-50":"bg-white hover:bg-purple-50",border:a?"border-purple-500 ring-2 ring-purple-200":"border-gray-200 hover:border-purple-300",iconBg:a?"bg-purple-600":"bg-purple-100",iconText:a?"text-white":"text-purple-600",text:a?"text-purple-900":"text-gray-900",amount:a?"text-purple-700":"text-purple-600"},indigo:{bg:a?"bg-indigo-50":"bg-white hover:bg-indigo-50",border:a?"border-indigo-500 ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300",iconBg:a?"bg-indigo-600":"bg-indigo-100",iconText:a?"text-white":"text-indigo-600",text:a?"text-indigo-900":"text-gray-900",amount:a?"text-indigo-700":"text-indigo-600"}})[s]||{bg:a?"bg-gray-50":"bg-white hover:bg-gray-50",border:a?"border-gray-500 ring-2 ring-gray-200":"border-gray-200 hover:border-gray-300",iconBg:a?"bg-gray-600":"bg-gray-100",iconText:a?"text-white":"text-gray-600",text:"text-gray-900",amount:a?"text-gray-700":"text-gray-600"})();return e.jsx("button",{onClick:()=>M(l.id),type:"button",className:`
                      p-4 rounded-xl border-2 transition-all
                      ${C.bg} ${C.border}
                      ${a?"shadow-lg":"shadow hover:shadow-md"}
                    `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${C.iconBg} flex items-center justify-center`,children:e.jsx(t,{className:`w-5 h-5 ${C.iconText}`})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`font-semibold text-sm truncate ${C.text}`,children:l.name}),e.jsxs("div",{className:`text-xs font-semibold tabular-nums ${C.amount}`,children:["TSh ",b.toLocaleString()]})]}),a&&e.jsx(V,{className:"w-5 h-5 text-green-600 shrink-0"})]})},l.id)})})]}),g&&h.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Pay from Cash Account"}),e.jsx("div",{className:"p-4 rounded-xl border-2 border-green-500 bg-green-50 shadow-lg ring-2 ring-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-600 flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"font-semibold text-sm truncate text-green-900",children:h[0].name}),e.jsxs("div",{className:"text-xs font-semibold tabular-nums text-green-700",children:["TSh ",(h[0].balance||0).toLocaleString()]})]}),e.jsx(V,{className:"w-5 h-5 text-green-600 shrink-0"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Category"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:i.category,onChange:l=>D("category",l.target.value),className:"w-full py-3 pl-12 pr-4 border-2 rounded-xl focus:outline-none transition-colors text-gray-900 border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200 appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"Select category..."}),j.map(l=>e.jsx("option",{value:l.name,children:l.name},l.id)),e.jsx("option",{value:"custom",children:"Custom..."})]}),e.jsx(I,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(le,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none",size:18})]}),i.category==="custom"&&e.jsxs("div",{className:"mt-2 relative",children:[e.jsx("input",{type:"text",value:i.customCategory,onChange:l=>D("customCategory",l.target.value),placeholder:"Enter custom category name",className:"w-full py-3 pl-12 pr-4 border-2 rounded-xl focus:outline-none transition-colors text-gray-900 border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200"}),e.jsx(I,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 mb-2 font-medium",children:["Vendor ",e.jsx("span",{className:"text-gray-500 text-sm font-normal",children:"(optional)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i.vendor_name,onChange:l=>D("vendor_name",l.target.value),placeholder:"Supplier or vendor name",className:"w-full py-3 pl-12 pr-4 border-2 rounded-xl focus:outline-none transition-colors text-gray-900 border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200"}),e.jsx(q,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 mb-2 font-medium",children:["Amount (TSh) ",e.jsx("span",{className:"text-red-500",children:"*"}),g&&e.jsxs("span",{className:"text-xs text-blue-600 ml-2 font-normal",children:["(Max: TSh ",N.toLocaleString(),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500",size:18}),e.jsx("input",{type:"text",value:i.amount?P(i.amount):"",onChange:E,placeholder:"0",autoFocus:!0,className:"w-full pl-12 pr-4 py-3 text-2xl font-bold border-2 rounded-xl focus:outline-none transition-colors text-gray-900 border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200"})]}),g&&i.amount&&e.jsx("div",{className:"mt-1 text-xs",children:parseFloat(i.amount)>N?e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsx("span",{children:"Amount exceeds daily sales limit"})]}):e.jsx("div",{className:"flex items-center gap-1 text-green-600",children:e.jsx("span",{children:"✓ Within daily sales limit"})})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 mb-2 font-medium",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i.description,onChange:l=>D("description",l.target.value),placeholder:"What was this expense for?",className:"w-full py-3 pl-12 pr-4 border-2 rounded-xl focus:outline-none transition-colors text-gray-900 border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200"}),e.jsx(I,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 flex-shrink-0 bg-white px-6 pb-6",children:[e.jsx("button",{type:"button",onClick:v,disabled:r,className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"button",onClick:m,disabled:r||g&&parseFloat(i.amount)>N,className:"flex-1 px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-semibold hover:from-red-600 hover:to-red-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5"}),"Record Expense"]})})]})]})}),document.body):null},ye=({isOpen:x,onClose:v,onApply:p,currentFilters:c})=>{var d,m,w,l;const[r,n]=u.useState(c),h=[{value:"all",label:"All Types",icon:e.jsx(xe,{size:14})},{value:"device",label:"Devices",icon:e.jsx(O,{size:14})},{value:"customer",label:"Customers",icon:e.jsx(H,{size:14})},{value:"product",label:"Products",icon:e.jsx(ge,{size:14})},{value:"sale",label:"Sales",icon:e.jsx(be,{size:14})},{value:"payment",label:"Payments",icon:e.jsx(B,{size:14})}],y=[{value:"active",label:"Active",color:"green"},{value:"done",label:"Done",color:"blue"},{value:"pending",label:"Pending",color:"yellow"},{value:"overdue",label:"Overdue",color:"red"}],j=[{value:"in-stock",label:"In Stock",color:"green"},{value:"low-stock",label:"Low Stock",color:"yellow"},{value:"out-of-stock",label:"Out of Stock",color:"red"}],A=[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"mobile",label:"Mobile Money"},{value:"bank",label:"Bank Transfer"}],N=[{label:"Today",days:0},{label:"This Week",days:7},{label:"This Month",days:30},{label:"Last 3 Months",days:90}],$=[{label:"Under 100K",min:0,max:1e5},{label:"100K - 500K",min:1e5,max:5e5},{label:"500K - 1M",min:5e5,max:1e6},{label:"1M - 5M",min:1e6,max:5e6},{label:"Over 5M",min:5e6,max:void 0}],_=t=>{const s=new Date,a=new Date(s);a.setDate(s.getDate()-t);const b=S=>S.toISOString().split("T")[0];return`${b(a)}-${b(s)}`},k=u.useMemo(()=>{const t=[];if(r.type){const s=h.find(a=>a.value===r.type);s&&t.push({key:"type",label:s.label,value:r.type})}if(r.status){const s=y.find(a=>a.value===r.status);s&&t.push({key:"status",label:s.label,value:r.status})}if(r.stock){const s=j.find(a=>a.value===r.stock);s&&t.push({key:"stock",label:s.label,value:r.stock})}if(r.payment){const s=A.find(a=>a.value===r.payment);s&&t.push({key:"payment",label:s.label,value:r.payment})}return r.location&&t.push({key:"location",label:"Location",value:r.location}),r.category&&t.push({key:"category",label:"Category",value:r.category}),r.price&&t.push({key:"price",label:"Price Range",value:r.price}),r.date&&t.push({key:"date",label:"Date Range",value:r.date}),r.customer&&t.push({key:"customer",label:"Customer",value:r.customer}),r.model&&t.push({key:"model",label:"Model",value:r.model}),t},[r]),i=t=>{r.type===t?n({...r,type:void 0}):n({...r,type:t})},f=t=>{r.status===t?n({...r,status:void 0}):n({...r,status:t})},g=t=>{r.stock===t?n({...r,stock:void 0}):n({...r,stock:t})},F=t=>{r.payment===t?n({...r,payment:void 0}):n({...r,payment:t})},T=(t,s)=>{const a=s?`${t}-${s}`:`${t}-`;r.price===a?n({...r,price:void 0}):n({...r,price:a})},D=t=>{const s=_(t);r.date===s?n({...r,date:void 0}):n({...r,date:s})},P=t=>{n({...r,[t]:void 0})},E=()=>{p(r),v()},M=()=>{n({}),p({}),v()},o=Object.keys(r).filter(t=>r[t]).length;return x?e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200/50 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-500/10 border border-blue-200/50 flex items-center justify-center",children:e.jsx(Y,{className:"text-blue-600",size:16})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Advanced Filters"}),o>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:[o," active"]})]})]}),e.jsx("button",{onClick:v,className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(R,{size:16,className:"text-gray-500"})})]}),k.length>0&&e.jsx("div",{className:"mb-4 pb-4 border-b border-gray-200/50",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:"Active:"}),k.map(t=>e.jsxs("button",{onClick:()=>P(t.key),className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-blue-50 text-blue-700 text-xs font-medium hover:bg-blue-100 transition-colors border border-blue-200",children:[e.jsxs("span",{children:[t.label,": ",t.value]}),e.jsx(R,{size:12})]},`${t.key}-${t.value}`))]})}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2",children:"Result Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(t=>{const s=(r.type||"all")===t.value;return e.jsxs("button",{onClick:()=>i(t.value==="all"?void 0:t.value),className:`
                    inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                    ${s?"bg-blue-100 text-blue-700 border-2 border-blue-300":"bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100"}
                  `,children:[t.icon,t.label]},t.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map(t=>{const s=r.status===t.value;return e.jsx("button",{onClick:()=>f(t.value),className:`
                    px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                    ${s?t.value==="active"?"bg-green-100 text-green-700 border-2 border-green-300":t.value==="done"?"bg-blue-100 text-blue-700 border-2 border-blue-300":t.value==="pending"?"bg-yellow-100 text-yellow-700 border-2 border-yellow-300":"bg-red-100 text-red-700 border-2 border-red-300":"bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100"}
                  `,children:t.label},t.value)})})]}),(r.type==="product"||!r.type)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2",children:"Stock Level"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(t=>{const s=r.stock===t.value;return e.jsx("button",{onClick:()=>g(t.value),className:`
                      px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                      ${s?t.value==="in-stock"?"bg-green-100 text-green-700 border-2 border-green-300":t.value==="low-stock"?"bg-yellow-100 text-yellow-700 border-2 border-yellow-300":"bg-red-100 text-red-700 border-2 border-red-300":"bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100"}
                    `,children:t.label},t.value)})})]}),(r.type==="sale"||r.type==="payment"||!r.type)&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(B,{size:12}),"Payment Method"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.map(t=>{const s=r.payment===t.value;return e.jsx("button",{onClick:()=>F(t.value),className:`
                      px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                      ${s?"bg-purple-100 text-purple-700 border-2 border-purple-300":"bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100"}
                    `,children:t.label},t.value)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(ie,{size:12}),"Quick Date Range"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(t=>{const s=_(t.days),a=r.date===s;return e.jsx("button",{onClick:()=>D(t.days),className:`
                    px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                    ${a?"bg-blue-100 text-blue-700 border-2 border-blue-300":"bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100"}
                  `,children:t.label},t.label)})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(ce,{size:12}),"Location"]}),e.jsx("input",{type:"text",value:r.location||"",onChange:t=>n({...r,location:t.target.value||void 0}),placeholder:"e.g., Dar es Salaam",className:"w-full px-3 py-2 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(de,{size:12}),"Category"]}),e.jsx("input",{type:"text",value:r.category||"",onChange:t=>n({...r,category:t.target.value||void 0}),placeholder:"e.g., smartphones",className:"w-full px-3 py-2 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(X,{size:12}),"Price Range (TZS)"]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:$.map(t=>{const s=t.max?`${t.min}-${t.max}`:`${t.min}-`,a=r.price===s;return e.jsx("button",{onClick:()=>T(t.min,t.max),className:`
                    px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                    ${a?"bg-blue-100 text-blue-700 border-2 border-blue-300":"bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100"}
                  `,children:t.label},t.label)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{children:e.jsx("input",{type:"number",value:((d=r.price)==null?void 0:d.split("-")[0])||"",onChange:t=>{var a;const s=((a=r.price)==null?void 0:a.split("-")[1])||"";n({...r,price:t.target.value?`${t.target.value}${s?`-${s}`:""}`:void 0})},placeholder:"Min price",className:"w-full px-3 py-2 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm"})}),e.jsx("div",{children:e.jsx("input",{type:"number",value:((m=r.price)==null?void 0:m.split("-")[1])||"",onChange:t=>{var a;const s=((a=r.price)==null?void 0:a.split("-")[0])||"0";n({...r,price:t.target.value?`${s}-${t.target.value}`:s||void 0})},placeholder:"Max price",className:"w-full px-3 py-2 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(ue,{size:12}),"Custom Date Range"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{children:e.jsx("input",{type:"date",value:((w=r.date)==null?void 0:w.split("-")[0])||"",onChange:t=>{var a;const s=((a=r.date)==null?void 0:a.split("-")[1])||"";n({...r,date:t.target.value?`${t.target.value}${s?`-${s}`:""}`:void 0})},className:"w-full px-3 py-2 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm"})}),e.jsx("div",{children:e.jsx("input",{type:"date",value:((l=r.date)==null?void 0:l.split("-")[1])||"",onChange:t=>{var a;const s=((a=r.date)==null?void 0:a.split("-")[0])||"";n({...r,date:t.target.value?`${s}-${t.target.value}`:s||void 0})},className:"w-full px-3 py-2 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm"})})]})]}),(!r.type||r.type==="customer"||r.type==="device")&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(!r.type||r.type==="customer")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(H,{size:12}),"Customer Name"]}),e.jsx("input",{type:"text",value:r.customer||"",onChange:t=>n({...r,customer:t.target.value||void 0}),placeholder:"Search by customer name",className:"w-full px-3 py-2 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm"})]}),(!r.type||r.type==="device")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(O,{size:12}),"Device Model"]}),e.jsx("input",{type:"text",value:r.model||"",onChange:t=>n({...r,model:t.target.value||void 0}),placeholder:"e.g., iPhone 13",className:"w-full px-3 py-2 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6 pt-4 border-t border-gray-200/50",children:[e.jsx("button",{onClick:M,className:"flex-1 px-4 py-2.5 rounded-lg border border-gray-300 text-gray-700 text-sm font-medium hover:bg-gray-50 transition-colors",children:"Reset All"}),e.jsx("button",{onClick:E,className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-500 text-white text-sm font-medium hover:bg-blue-600 shadow-sm hover:shadow-md transition-all",children:"Apply Filters"})]})]}):null},fe=({isOpen:x,onClose:v,initialQuery:p=""})=>{const{currentUser:c}=G(),{isDark:r}=ee();let n=[];try{const o=te();n=(o==null?void 0:o.devices)||[]}catch{}const{customers:h}=re(),[y,j]=u.useState(p),[A,N]=u.useState("all"),[$,_]=u.useState([]),[k,i]=u.useState(!1),[f,g]=u.useState({});Z(x),u.useEffect(()=>{const o=localStorage.getItem("recentSearches");if(o)try{_(JSON.parse(o))}catch(d){console.error("Error loading recent searches:",d)}},[]),u.useEffect(()=>{x&&p&&j(p)},[x,p]),u.useEffect(()=>{if(!x)return;const o=d=>{d.key==="Escape"&&E()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[x]);const F=o=>{if(!o.trim())return;const d=[o,...$.filter(m=>m!==o)].slice(0,10);_(d),localStorage.setItem("recentSearches",JSON.stringify(d))},T=o=>{o.preventDefault(),y.trim()&&F(y)},D=()=>{j("")},P=o=>{const d=$.filter(m=>m!==o);_(d),localStorage.setItem("recentSearches",JSON.stringify(d))},E=()=>{j(""),N("all"),v()},M=o=>{o.target===o.currentTarget&&E()};return x?J.createPortal(e.jsx("div",{className:"fixed animate-fadeIn flex items-start justify-center pt-16",onClick:M,style:{top:0,left:0,right:0,bottom:0,zIndex:99999,backgroundColor:r?"rgba(0, 0, 0, 0.4)":"rgba(0, 0, 0, 0.25)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:e.jsxs("div",{className:`
            relative w-full max-w-4xl mx-auto mb-8
            ${r?"bg-slate-900/95":"bg-white/95"}
            backdrop-blur-2xl rounded-2xl
            overflow-hidden
            transition-all duration-300
          `,style:{maxHeight:"calc(90vh - 200px)",animation:"slideDown 0.25s cubic-bezier(0.16, 1, 0.3, 1)",pointerEvents:"auto",margin:"0 1rem",boxShadow:r?"0 25px 80px rgba(0, 0, 0, 0.5), 0 0 0 0.5px rgba(255, 255, 255, 0.1)":"0 20px 70px rgba(0, 0, 0, 0.3), 0 0 0 0.5px rgba(0, 0, 0, 0.1)"},onClick:o=>o.stopPropagation(),children:[e.jsx("div",{className:`
          sticky top-0 z-20
          ${r?"bg-slate-800/90":"bg-gradient-to-b from-gray-50/50 to-transparent"}
          backdrop-blur-xl border-b
          ${r?"border-slate-700/50":"border-gray-200/50"}
        `,children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("form",{onSubmit:T,className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:e.jsx(me,{className:`
                    transition-colors duration-200 flex-shrink-0
                    ${y?r?"text-blue-400":"text-blue-500":r?"text-gray-500":"text-gray-400"}
                  `,size:20})}),e.jsx("input",{type:"text",placeholder:"Search...",value:y,onChange:o=>j(o.target.value),className:`
                  w-full pl-12 pr-32 py-3.5 rounded-xl
                  ${r?"bg-transparent text-white placeholder-gray-400 border border-slate-600/50 focus:border-blue-500":"bg-transparent text-gray-900 placeholder-gray-400 border border-gray-300 focus:border-blue-500"}
                  focus:outline-none
                  transition-all duration-200
                  text-base
                `,style:{fontWeight:400},autoFocus:!0}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>i(!k),className:`
                    p-1.5 rounded-lg flex items-center gap-1 transition-all duration-150
                    ${k?"bg-blue-500 text-white shadow-md":r?"bg-slate-700/50 hover:bg-slate-600 text-gray-300 border border-slate-600/50":"bg-gray-100/80 hover:bg-gray-200/80 text-gray-600 border border-gray-200/50"}
                  `,title:"Advanced Filters",children:[e.jsx(Y,{size:14}),Object.keys(f).filter(o=>f[o]).length>0&&e.jsx("span",{className:"text-xs font-bold",children:Object.keys(f).filter(o=>f[o]).length})]}),y&&e.jsx("button",{type:"button",onClick:D,className:`
                      p-1.5 rounded-lg transition-all duration-150
                      ${r?"bg-slate-700/50 hover:bg-slate-600 text-gray-300 border border-slate-600/50":"bg-gray-100/80 hover:bg-gray-200/80 text-gray-600 border border-gray-200/50"}
                    `,children:e.jsx(R,{size:14})}),e.jsx("div",{className:`
                  flex items-center gap-1 px-2 py-1 rounded-md
                    ${r?"bg-slate-700/50 border border-slate-600/50":"bg-gray-100/80 border border-gray-200/50"}
                `,children:e.jsx("span",{className:`text-xs font-medium ${r?"text-gray-300":"text-gray-600"}`,children:"ESC"})})]})]}),e.jsxs("div",{className:`
              flex items-center gap-3 mt-3 text-xs
              text-gray-500
            `,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("kbd",{className:`px-2 py-1 rounded font-medium shadow-sm ${r?"bg-slate-700 text-gray-300 border border-slate-600/50":"bg-white/80 border border-gray-200/50 text-gray-600"}`,children:"↑"}),e.jsx("kbd",{className:`px-2 py-1 rounded font-medium shadow-sm ${r?"bg-slate-700 text-gray-300 border border-slate-600/50":"bg-white/80 border border-gray-200/50 text-gray-600"}`,children:"↓"}),e.jsx("span",{children:"Navigate"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("kbd",{className:`px-2 py-1 rounded font-medium shadow-sm ${r?"bg-slate-700 text-gray-300 border border-slate-600/50":"bg-white/80 border border-gray-200/50 text-gray-600"}`,children:"↵"}),e.jsx("span",{children:"Select"})]})]})]})}),e.jsxs("div",{className:`
            overflow-y-auto px-6 py-6 custom-scrollbar
            ${r?"bg-slate-900/50":"bg-gray-50/30"}
          `,style:{maxHeight:"calc(100vh - 300px)",minHeight:"400px"},children:[k&&e.jsx("div",{className:"mb-6",children:e.jsx(ye,{isOpen:k,onClose:()=>i(!1),onApply:o=>{g(o);const d=Object.entries(o).filter(([m,w])=>w).map(([m,w])=>{const l=String(w);return`${m}:${l}`}).join(" ");y.trim()?j(m=>{const w=m.replace(/\w+:[^\s]+/g,"").trim();return d?`${w} ${d}`.trim():w}):d&&j(d)},currentFilters:f})}),y?e.jsx(he,{query:y,filter:A,onFilterChange:N,userRole:c.role,devices:n,customers:h}):e.jsx(pe,{recentSearches:$,onSearch:j,onRemoveSearch:P,userRole:c.role})]}),e.jsx("style",{children:`
          @keyframes fadeIn {
            from {
              opacity: 0;
            }
            to {
              opacity: 1;
            }
          }

          @keyframes slideDown {
            from {
              opacity: 0;
              transform: translateY(-20px) scale(0.96);
            }
            to {
              opacity: 1;
              transform: translateY(0) scale(1);
            }
          }

          /* Custom scrollbar for macOS look */
          .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
          }

          .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
          }

          .custom-scrollbar::-webkit-scrollbar-thumb {
            background: ${r?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"};
            border-radius: 4px;
          }

          .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: ${r?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)"};
          }
        `})]})}),document.body):null},Ce=()=>{const{isOpen:x,initialQuery:v,openSearch:p,closeSearch:c}=ae();return u.useEffect(()=>{const r=n=>{(n.ctrlKey||n.metaKey)&&n.key==="k"&&(n.preventDefault(),n.stopPropagation(),p())};return document.addEventListener("keydown",r,!0),()=>{document.removeEventListener("keydown",r,!0)}},[p]),e.jsx(fe,{isOpen:x,onClose:c,initialQuery:v})};export{Ce as G,Se as Q};
