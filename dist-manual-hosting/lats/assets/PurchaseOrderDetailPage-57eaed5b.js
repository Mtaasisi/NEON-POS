import{_ as e}from"./supabase-7e851d02.js";import{s as t,j as s,u as a,c as r,ak as l,al as n,am as i,G as c}from"./index-222cfb29.js";import{r as d}from"./vendor-a2ff445a.js";import{a as o,d as m,c as u}from"./routing-a2f0f6d2.js";import{X as x,x as h,v as p,aC as g,cs as y,n as b,bE as f,d as v,ah as j,h as N,e as w,a5 as _,aj as S,a6 as k,u as C,U as I,a1 as P,bl as D,O,r as T,I as A,ax as $,by as q,D as R,Z as E,N as F,a2 as L,$ as M,A as Q,aA as U,aZ as z,a8 as Z,as as B,c as V,l as H,q as Y,a9 as K,a7 as W,ct as X,f as G,co as J}from"./ui-551a39a6.js";import{P as ee}from"./PaymentsPopupModal-70ab4c91.js";import{s as te,a as se}from"./storeShelfApi-d8b142f6.js";import{S as ae}from"./SetPricingModal-f25ea152.js";import"./useBodyScrollLock-0216d39f.js";class re{static async createQualityCheckFallback(e){try{const{data:s,error:a}=await t.from("purchase_order_quality_checks").insert({purchase_order_id:e.purchaseOrderId,template_id:e.templateId,checked_by:e.checkedBy,status:"in_progress"}).select("id").single();if(a)throw a;if(!(null==s?void 0:s.id))throw new Error("Failed to create quality check record");const{data:r,error:l}=await t.from("quality_check_criteria").select("*").eq("template_id",e.templateId).order("sort_order");if(l)throw l;if(!r||0===r.length)throw new Error("No criteria found for template");const{data:n,error:i}=await t.from("lats_purchase_order_items").select("*").eq("purchase_order_id",e.purchaseOrderId);if(i)throw i;if(!n||0===n.length)throw new Error("No purchase order items found");const c=[];for(const e of r)for(const t of n)c.push({quality_check_id:s.id,purchase_order_item_id:t.id,criteria_id:e.id,criteria_name:e.name});if(c.length>0){const{error:e}=await t.from("purchase_order_quality_check_items").insert(c);if(e)throw e}return{success:!0,data:s.id,message:"Quality check created successfully (fallback method)"}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to create quality check using fallback method"}}}static async getTemplates(){try{const{data:e,error:s}=await t.from("quality_check_templates").select("*").eq("is_active",!0).order("name");if(s)throw s;return{success:!0,data:null==e?void 0:e.map(e=>({id:e.id,name:e.name,description:e.description,category:e.category,isActive:e.is_active,createdAt:e.created_at,updatedAt:e.updated_at}))}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Failed to fetch templates"}}}static async getTemplateCriteria(e){try{const{data:s,error:a}=await t.from("quality_check_criteria").select("*").eq("template_id",e).order("sort_order");if(a)throw a;return{success:!0,data:(null==s?void 0:s.map(e=>({id:e.id,templateId:e.template_id,name:e.name,description:e.description,isRequired:e.is_required,sortOrder:e.sort_order,createdAt:e.created_at})))||[]}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to fetch criteria"}}}static async createQualityCheck(e){try{const{data:s,error:a}=await t.rpc("create_quality_check_from_template",{p_purchase_order_id:e.purchaseOrderId,p_template_id:e.templateId,p_checked_by:e.checkedBy});if(a)throw a;let r;if(Array.isArray(s)){const e=s[0];r="string"==typeof e?e:"object"==typeof e&&null!==e&&(e.create_quality_check_from_template||e.id)||String(e)}else if("object"==typeof s&&null!==s){const e=s;r=e.create_quality_check_from_template||e.id||String(s)}else r=String(s);return{success:!0,data:r,message:"Quality check created successfully"}}catch(s){let t="Failed to create quality check";return s instanceof Error&&(t=s.message.includes("function")&&s.message.includes("does not exist")?"Quality check system not properly configured. Please contact administrator.":s.message.includes("foreign key")?"Invalid purchase order or template ID provided.":s.message.includes("permission")?"You do not have permission to create quality checks.":`Error: ${s.message}`),t.includes("not properly configured")?await this.createQualityCheckFallback(e):{success:!1,message:t}}}static async getQualityCheck(e){try{if(!e||""===e||"undefined"===e)return{success:!1,message:"Invalid quality check ID"};const{data:s,error:a}=await t.from("purchase_order_quality_checks").select("*").eq("id",e).single();if(a)throw a;let r=null;if(s.template_id){const{data:e}=await t.from("quality_check_templates").select("*").eq("id",s.template_id).single();r=e}return{success:!0,data:{id:s.id,purchaseOrderId:s.purchase_order_id,templateId:s.template_id,status:s.status,overallResult:s.overall_result,checkedBy:s.checked_by,checkedAt:s.checked_at,notes:s.notes,signature:s.signature,createdAt:s.created_at,updatedAt:s.updated_at,template:r?{id:r.id,name:r.name,description:r.description,category:r.category,isActive:r.is_active,createdAt:r.created_at,updatedAt:r.updated_at}:void 0}}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to fetch quality check"}}}static async getQualityChecksByPO(e){try{const{data:s,error:a}=await t.from("purchase_order_quality_checks").select("*").eq("purchase_order_id",e).order("created_at",{ascending:!1});if(a)throw a;if(s&&s.length>0){const e=s.map(e=>e.template_id).filter(Boolean);if(e.length>0){const{data:a}=await t.from("quality_check_templates").select("*").in("id",e),r=new Map((null==a?void 0:a.map(e=>[e.id,e]))||[]);s.forEach(e=>{e.template_id&&(e.template=r.get(e.template_id))})}}return{success:!0,data:null==s?void 0:s.map(e=>({id:e.id,purchaseOrderId:e.purchase_order_id,templateId:e.template_id,status:e.status,overallResult:e.overall_result,checkedBy:e.checked_by,checkedAt:e.checked_at,notes:e.notes,signature:e.signature,createdAt:e.created_at,updatedAt:e.updated_at,template:e.template?{id:e.template.id,name:e.template.name,description:e.template.description,category:e.template.category,isActive:e.template.is_active,createdAt:e.template.created_at,updatedAt:e.template.updated_at}:void 0}))}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to fetch quality checks"}}}static async getQualityCheckItems(e){try{if(!e||""===e||"undefined"===e)return{success:!1,message:"Invalid quality check ID"};const a="string"==typeof e?e.trim():String(e),{data:r,error:l}=await t.from("purchase_order_quality_check_items").select("*").eq("quality_check_id",a).order("created_at");if(l)throw l;if(!r||0===r.length)return{success:!0,data:[]};const n=e=>{if(!e)return null;if("string"==typeof e)return e;if("object"==typeof e&&e.id)return String(e.id);try{return String(e)}catch{return null}},i=e=>{if(!e)return!1;return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)},c=[...new Set(r.map(e=>n(e.criteria_id)).filter(e=>e&&"undefined"!==e&&"null"!==e&&i(e)))],d=[...new Set(r.map(e=>n(e.purchase_order_item_id)).filter(e=>e&&"undefined"!==e&&"null"!==e&&i(e)))],o=new Map;if(c.length>0)try{const{data:e,error:s}=await t.from("quality_check_criteria").select("*").in("id",c);if(s)throw s;null==e||e.forEach(e=>o.set(e.id,e))}catch(s){throw s}const m=new Map;if(d.length>0)try{const{data:e,error:s}=await t.from("lats_purchase_order_items").select("id, product_id, variant_id, quantity, received_quantity").in("id",d);if(s)throw s;null==e||e.forEach(e=>m.set(e.id,e))}catch(s){throw s}const u=[...new Set(Array.from(m.values()).map(e=>n(e.product_id)).filter(e=>e&&"undefined"!==e&&"null"!==e))],x=[...new Set(Array.from(m.values()).map(e=>n(e.variant_id)).filter(e=>e&&"undefined"!==e&&"null"!==e))],h=new Map;if(u.length>0)try{const{data:e,error:s}=await t.from("lats_products").select("id, name, sku").in("id",u);s||null==e||e.forEach(e=>h.set(e.id,e))}catch(s){}const p=new Map;if(x.length>0)try{const{data:e,error:s}=await t.from("lats_product_variants").select("id, name, sku").in("id",x);s||null==e||e.forEach(e=>p.set(e.id,e))}catch(s){}return{success:!0,data:r.map(e=>{const t=n(e.criteria_id),s=n(e.purchase_order_item_id),a=t?o.get(t):void 0,r=s?m.get(s):void 0,l=r?n(r.product_id):null,i=r?n(r.variant_id):null,c=l?h.get(l):void 0,d=i?p.get(i):void 0;return{id:e.id,qualityCheckId:e.quality_check_id,purchaseOrderItemId:e.purchase_order_item_id,criteriaId:e.criteria_id,criteriaName:e.criteria_name,result:e.result,quantityChecked:e.quantity_checked,quantityPassed:e.quantity_passed,quantityFailed:e.quantity_failed,defectType:e.defect_type,defectDescription:e.defect_description,actionTaken:e.action_taken,notes:e.notes,images:e.images||[],createdAt:e.created_at,updatedAt:e.updated_at,criteria:a?{id:a.id,templateId:a.template_id,name:a.name,description:a.description,isRequired:a.is_required,sortOrder:a.sort_order,createdAt:a.created_at}:void 0,purchaseOrderItem:r?{id:r.id,productId:r.product_id,variantId:r.variant_id,quantityOrdered:r.quantity,quantityReceived:r.received_quantity,product:c?{name:c.name,sku:c.sku}:void 0,variant:d?{name:d.name,sku:d.sku}:void 0}:void 0}})}}catch(a){return{success:!1,message:a instanceof Error?a.message:"Failed to fetch quality check items"}}}static async updateQualityCheckItem(e){try{const{error:s}=await t.from("purchase_order_quality_check_items").update({result:e.result,quantity_checked:e.quantityChecked,quantity_passed:e.quantityPassed,quantity_failed:e.quantityFailed,defect_type:e.defectType,defect_description:e.defectDescription,action_taken:e.actionTaken,notes:e.notes,images:e.images,updated_at:(new Date).toISOString()}).eq("id",e.id);if(s)throw s;return{success:!0,message:"Quality check item updated successfully"}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to update quality check item"}}}static async completeQualityCheck(e){try{const{data:s,error:a}=await t.rpc("complete_quality_check",{p_quality_check_id:e.qualityCheckId,p_notes:e.notes,p_signature:e.signature});if(a)throw a;return{success:!0,message:"Quality check completed successfully"}}catch(s){let e="Failed to complete quality check";return s instanceof Error&&(e=s.message.includes("function")&&s.message.includes("does not exist")?"Quality check completion system not properly configured. Please contact administrator.":s.message.includes("not found")?"Quality check not found. It may have been deleted or the ID is invalid.":s.message.includes("permission")?"You do not have permission to complete this quality check.":s.message.includes("400")?"Invalid data provided for quality check completion.":`Error: ${s.message}`),{success:!1,message:e}}}static async getQualityCheckSummary(e){try{const{data:s,error:a}=await t.rpc("get_quality_check_summary",{p_purchase_order_id:e});if(a)throw a;if(!s||0===s.length)return{success:!0,data:void 0,message:"No quality check found"};const r=s[0];return{success:!0,data:{qualityCheckId:r.quality_check_id,status:r.status,overallResult:r.overall_result,checkedBy:r.checked_by,checkedAt:r.checked_at,totalItems:r.total_items,passedItems:r.passed_items,failedItems:r.failed_items,pendingItems:r.pending_items}}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to fetch quality check summary"}}}static async receiveQualityCheckedItems(e,s){try{const{data:a,error:r}=await t.rpc("receive_quality_checked_items",{p_quality_check_id:e,p_purchase_order_id:s});if(r)throw r;return{success:!0,message:(null==a?void 0:a.message)||"Quality-checked items received to inventory successfully"}}catch(a){return{success:!1,message:a instanceof Error?a.message:"Failed to receive items to inventory"}}}}const le=({isOpen:e,onClose:t,purchaseOrder:a,onConfirm:r,isLoading:l=!1,mode:n="partial",initialReceivedItems:i})=>{const[c,o]=d.useState(new Map),[m,u]=d.useState([]),[f,v]=d.useState({}),[j,N]=d.useState(!1),[w,_]=d.useState(null),[S,k]=d.useState(""),[C,I]=d.useState("");d.useEffect(()=>{P()},[]),d.useEffect(()=>{m.length>0&&D()},[m]),d.useEffect(()=>{if(e){if(i&&i.length>0){const e=new Map;return i.forEach(t=>{e.set(t.id,{quantity:t.receivedQuantity,serialNumbers:t.serialNumbers||[]})}),void o(e)}const e=new Map;a.items.forEach(t=>{const s=t.quantity-(t.receivedQuantity||0),a="full"===n?s:0,r=[];for(let e=0;e<a;e++){const e=(new Date).toISOString().split("T")[0],s=new Date;s.setMonth(s.getMonth()+12);const a=s.toISOString().split("T")[0];r.push({serial_number:"",imei:"",mac_address:"",barcode:"",location:"",warranty_start:e,warranty_end:a,warranty_months:12,cost_price:t.costPrice||t.cost_price||t.unitCost||0,selling_price:void 0,notes:""})}e.set(t.id,{quantity:a,serialNumbers:r})}),o(e)}},[e,a.items,n,i]);const P=async()=>{try{const e=await te.getAll();u(e||[])}catch(e){u([])}},D=async()=>{try{const e={};for(const t of m){const s=await se.getShelvesByStorageRoom(t.id);e[t.id]=s||[]}v(e)}catch(e){v({})}},O=()=>{const e=f[S]||[];return C?e.filter(e=>e.code.toLowerCase().includes(C.toLowerCase())||e.name&&e.name.toLowerCase().includes(C.toLowerCase())):e},T=(e,t,s,a)=>{o(r=>{const l=new Map(r),n=l.get(e)||{quantity:0,serialNumbers:[]},i=[...n.serialNumbers],c=i[t];if("warranty_months"===s&&"number"==typeof a&&c.warranty_start){const e=new Date(c.warranty_start),s=new Date(e);s.setMonth(s.getMonth()+a),i[t]={...c,warranty_months:a,warranty_end:s.toISOString().split("T")[0]}}else if("warranty_start"===s&&"string"==typeof a){const e=c.warranty_months||12,s=new Date(a),r=new Date(s);r.setMonth(r.getMonth()+e),i[t]={...c,warranty_start:a,warranty_end:r.toISOString().split("T")[0]}}else if("serial_number"===s&&"string"==typeof a){const e=a.replace(/[\s\-_.]/g,""),s=/^\d{15}$/.test(e);i[t]=s?{...c,serial_number:a,imei:e}:{...c,serial_number:a,imei:""}}else i[t]={...c,[s]:a};return l.set(e,{...n,serialNumbers:i}),l})},A=()=>{let e=0;return c.forEach(t=>{e+=t.quantity}),e},$=e=>{const t=a.currency||"USD",s=Math.round(e);if("TSh"===t||"TZS"===t)return`TSh ${s.toLocaleString("en-US")}`;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}catch(r){return`${t} ${s.toLocaleString("en-US")}`}};return e?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed bg-black/50",onClick:t,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),s.jsxs("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:[s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col relative",onClick:e=>e.stopPropagation(),style:{pointerEvents:"auto"},children:[s.jsx("button",{onClick:t,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:s.jsx(x,{className:"w-5 h-5"})}),s.jsxs("div",{className:"p-8 bg-gradient-to-br from-green-50 to-emerald-50 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:s.jsx(h,{className:"w-8 h-8 text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"full"===n?"Add Serial Numbers":"Select Items & Add Serial Numbers"}),s.jsxs("div",{className:"flex items-center justify-center gap-3 text-sm mt-4",children:[s.jsxs("div",{className:"px-4 py-2 bg-white rounded-lg shadow-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Total:"}),s.jsxs("span",{className:"text-gray-900 font-bold ml-1",children:[A()," items"]})]}),s.jsx("div",{className:"px-4 py-2 bg-white rounded-lg shadow-sm",children:s.jsxs("span",{className:"text-gray-900 font-medium",children:[a.items.length," ",1===a.items.length?"product":"products"]})}),s.jsxs("div",{className:"px-4 py-2 bg-green-100 rounded-lg shadow-sm border border-green-300",children:[s.jsx("span",{className:"text-green-700 font-medium",children:"Cost: "}),s.jsx("span",{className:"text-green-900 font-bold",children:$((()=>{let e=0;return c.forEach((t,s)=>{const r=a.items.find(e=>e.id===s);if(r){const s=Number(r.costPrice||r.cost_price||r.unitCost||0);e+=s*t.quantity}}),e})())})]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:s.jsx("div",{className:"space-y-8",children:a.items.map(e=>{var t,r,l;const i=c.get(e.id)||{quantity:0,serialNumbers:[]},d=e.quantity-(e.receivedQuantity||0);if("full"===n&&0===i.quantity)return null;const u=(null==(t=e.variant)?void 0:t.variant_name)||(null==(r=e.variant)?void 0:r.name)||null,x=e.name||((null==(l=e.product)?void 0:l.name)||"")+(u?` - ${u}`:"");return s.jsxs("div",{className:"rounded-xl p-5 border "+(i.quantity>0?"bg-white border-gray-300 shadow-sm":"bg-gray-50 border-gray-200"),children:[s.jsx("div",{className:"mb-4 pb-4 border-b border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-lg font-bold text-gray-900",children:x}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Cost: ",s.jsx("span",{className:"font-semibold text-gray-900",children:$(Number(e.costPrice||e.cost_price||e.unitCost||0))})]})]}),"partial"===n&&s.jsxs("div",{className:"ml-4",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Receiving:"}),s.jsx("input",{type:"number",min:"0",max:d,value:i.quantity,onChange:t=>((e,t)=>{const s=a.items.find(t=>t.id===e);if(!s)return;const r=s.quantity-(s.receivedQuantity||0),l=Math.min(Math.max(0,t),r);o(t=>{const a=new Map(t),r=a.get(e)||{quantity:0,serialNumbers:[]},n=[];for(let e=0;e<l;e++){const t=(new Date).toISOString().split("T")[0],a=new Date;a.setMonth(a.getMonth()+12);const l=a.toISOString().split("T")[0],i=r.serialNumbers[e];n.push(i||{serial_number:"",imei:"",mac_address:"",barcode:"",location:"",warranty_start:t,warranty_end:l,warranty_months:12,cost_price:s.cost_price,selling_price:void 0,notes:""})}return a.set(e,{quantity:l,serialNumbers:n}),a})})(e.id,parseInt(t.target.value)||0),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 text-center font-bold text-lg"})]}),"full"===n&&s.jsxs("div",{className:"ml-4 px-4 py-2 bg-blue-50 rounded-lg",children:[s.jsx("p",{className:"text-xs text-gray-600",children:"Receiving:"}),s.jsxs("p",{className:"text-lg font-bold text-blue-700",children:[i.quantity," pcs"]})]})]})}),i.quantity>0?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 w-12",children:"#"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 min-w-[200px]",children:"Product Name"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 min-w-[250px]",children:"Serial Number / IMEI *"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 min-w-[180px]",children:"Location"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:i.serialNumbers.map((t,a)=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-3 text-center font-medium text-gray-600",children:a+1}),s.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:x}),s.jsxs("td",{className:"px-4 py-3",children:[s.jsx("input",{type:"text",placeholder:"Enter Serial Number or IMEI (auto-detects)",value:t.serial_number,onChange:t=>T(e.id,a,"serial_number",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 "+(t.serial_number.trim()?"border-gray-300 bg-white":"border-red-300 bg-red-50"),title:"Enter either Serial Number or IMEI - system auto-detects IMEI (15 digits)"}),t.serial_number&&s.jsx("div",{className:"text-xs mt-1",children:t.imei?s.jsx("span",{className:"text-green-600 font-medium",children:"✓ IMEI detected"}):s.jsx("span",{className:"text-blue-600",children:"Serial Number"})})]}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("button",{type:"button",onClick:t=>{t.stopPropagation(),((e,t)=>{var s;_({itemId:e,index:t}),k((null==(s=m[0])?void 0:s.id)||""),N(!0)})(e.id,a)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg hover:border-blue-400 bg-white text-left flex items-center gap-2 transition-colors cursor-pointer",children:[s.jsx(p,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),s.jsx("span",{className:t.location?"text-gray-900":"text-gray-400",children:t.location||"Select shelf"})]})})]},a))})]})}):"partial"===n?s.jsxs("div",{className:"p-6 bg-gray-50 rounded-lg border border-dashed border-gray-300 text-center",children:[s.jsx(h,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),s.jsx("p",{className:"text-gray-600 font-medium",children:"Set quantity above to add serial numbers"})]}):null,i.quantity>0&&s.jsx("div",{className:"mt-3 text-xs text-gray-500",children:"* Serial Number / IMEI is required"})]},e.id)})})}),s.jsx("div",{className:"p-6 border-t border-gray-200 bg-white",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:()=>{const e=Array.from(a.items).map(e=>{const t=c.get(e.id)||{quantity:0,serialNumbers:[]};return{id:e.id,receivedQuantity:t.quantity,serialNumbers:[]}});r(e)},disabled:l,className:"flex-1 px-6 py-3.5 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors disabled:opacity-50 text-lg",children:"Skip Serial Numbers →"}),s.jsx("button",{type:"button",onClick:async()=>{try{let e=!1;if(c.forEach((t,s)=>{t.serialNumbers.forEach((t,s)=>{t.serial_number.trim()||(e=!0)})}),e)return void b.error("Please fill in Serial Number or IMEI for all items");const s=[];c.forEach((e,t)=>{e.quantity>0&&s.push({id:t,receivedQuantity:e.quantity,serialNumbers:e.serialNumbers.length>0?e.serialNumbers:void 0})}),await r(s),t()}catch(e){b.error("Failed to process receive")}},disabled:l||0===A(),className:"flex-1 px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg",children:l?"Processing...":`Continue (${A()} items)`})]})})]}),j&&s.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[100000] p-4",onClick:()=>{N(!1),_(null)},style:{pointerEvents:"auto"},children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[85vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-green-50 to-blue-50",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(p,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Select Storage Location"})]}),s.jsx("button",{onClick:()=>{N(!1),_(null)},className:"p-2 hover:bg-white/50 rounded transition-colors",children:s.jsx(x,{className:"w-5 h-5 text-gray-500"})})]}),s.jsx("div",{className:"border-b border-gray-200 bg-gray-50",children:s.jsx("div",{className:"flex overflow-x-auto px-4 py-2 gap-2",children:m.map(e=>s.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),k(e.id)},className:"flex-shrink-0 px-4 py-2 rounded font-medium text-sm transition-colors cursor-pointer "+(S===e.id?"bg-green-600 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(g,{className:"w-4 h-4"}),s.jsx("span",{children:e.name}),s.jsxs("span",{className:"text-xs opacity-75",children:["(",e.code,")"]})]})},e.id))})}),s.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:s.jsxs("div",{className:"relative",children:[s.jsx(p,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),s.jsx("input",{type:"text",placeholder:"Search shelves by code...",value:C,onChange:e=>I(e.target.value),className:"w-full pl-10 pr-3 py-2 bg-white border-2 border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]})}),s.jsx("div",{className:"p-4 overflow-y-auto max-h-[50vh]",children:O().length>0?s.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3",style:{pointerEvents:"auto"},children:O().map(e=>{var t;if(!e||!e.code)return null;const a=m.find(e=>e.id===S),r=(null==a?void 0:a.code)||"",l=e.code.startsWith(r)?e.code:`${r}${e.code}`,n=null==(t=e.code.toUpperCase().match(/[A-Z]/))?void 0:t[0],i=n?{A:"bg-blue-500",B:"bg-green-500",C:"bg-purple-500",D:"bg-orange-500",E:"bg-red-500",F:"bg-teal-500",G:"bg-pink-500",H:"bg-indigo-500"}[n]||"bg-gray-500":"bg-gray-500";return s.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),((e,t)=>{var s;if(!w)return;const a=m.find(t=>t.id===e),r=null==(s=f[e])?void 0:s.find(e=>e.id===t);if(a&&r){const e=`${a.code} - ${r.code}`;T(w.itemId,w.index,"location",e)}N(!1),_(null)})(S,e.id)},onMouseDown:e=>{e.stopPropagation()},className:`py-3 px-2 rounded-lg border-2 font-bold text-center text-white text-sm ${i} border-transparent hover:border-white hover:shadow-lg transition-all cursor-pointer`,style:{pointerEvents:"auto",zIndex:1},children:l},e.id)})}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(y,{size:48,className:"text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Shelves Found"}),s.jsx("p",{className:"text-sm text-gray-600",children:C?"Try adjusting your search.":"No shelves available in this room."})]})}),s.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-gray-200 bg-gray-50",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:[O().length," shelf",1!==O().length?"ves":""," available"]}),s.jsx("button",{onClick:()=>{N(!1),_(null)},className:"px-4 py-2 text-gray-700 bg-white hover:bg-gray-100 border border-gray-300 rounded-lg transition-colors",children:"Cancel"})]})]})})]})]}):null};class ne{static async deleteOrder(e){try{const{data:s,error:a}=await t.from("lats_purchase_orders").select("status").eq("id",e).single();if(a)return{success:!1,message:"Order not found"};if(!["draft","pending_approval","sent","cancelled"].includes(s.status))return{success:!1,message:`Cannot delete order with status '${s.status}'. Only draft, pending approval, sent, or cancelled orders can be deleted.`};const{error:r}=await t.from("lats_purchase_orders").delete().eq("id",e);if(r)throw r;return{success:!0,message:"Order deleted successfully"}}catch(s){return{success:!1,message:"Failed to delete order"}}}static async cancelOrder(e){try{const{error:s}=await t.from("lats_purchase_orders").update({status:"sent",updated_at:(new Date).toISOString()}).eq("id",e).eq("status","sent");if(s)throw s;return{success:!0,message:"Order marked as not received"}}catch(s){return{success:!1,message:"Failed to cancel order"}}}static async duplicateOrder(e){try{const{data:s,error:a}=await t.from("lats_purchase_orders").select("*").eq("id",e).single();if(a)throw a;const r=Date.now(),l=`${s.order_number}-COPY-${r}`,n={...s,order_number:l,status:"sent",payment_status:"unpaid",total_paid:0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};delete n.id;const{data:i,error:c}=await t.from("lats_purchase_orders").insert(n).select().single();if(c)throw c;const{data:d,error:o}=await t.from("lats_purchase_order_items").select("*").eq("purchase_order_id",e);if(o)throw o;if(d&&d.length>0){const e=d.map(e=>({...e,purchase_order_id:i.id,quantity_received:0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()})),{error:s}=await t.from("lats_purchase_order_items").insert(e.map(({id:e,...t})=>t));if(s)throw s}return{success:!0,message:"Order duplicated successfully",data:i}}catch(s){return{success:!1,message:`Failed to duplicate order: ${s instanceof Error?s.message:"Unknown error"}`}}}static async updateItemQualityCheck(e,s,a){try{const{data:r,error:l}=await t.from("lats_purchase_order_items").select("purchase_order_id").eq("id",e).single();if(l||!r)throw new Error("Item not found");const{error:n}=await t.from("purchase_order_quality_checks").insert({purchase_order_id:r.purchase_order_id,item_id:e,passed:"passed"===s,notes:a||null,checked_by:"system",timestamp:(new Date).toISOString()});if(n)throw n;return{success:!0,message:"Quality check updated"}}catch(r){return{success:!1,message:"Failed to update quality check"}}}static async completeQualityCheck(e){try{const{error:s}=await t.from("lats_purchase_orders").update({status:"received",updated_at:(new Date).toISOString()}).eq("id",e);if(s)throw s;return{success:!0,message:"Quality check completed"}}catch(s){return{success:!1,message:"Failed to complete quality check"}}}static async sendSMS(e,s,a){try{const{error:r}=await t.from("purchase_order_messages").insert({purchase_order_id:a,sender:"system",content:`SMS sent to ${e}: ${s}`,type:"system",timestamp:(new Date).toISOString()});if(r)throw r;return{success:!0,message:"SMS sent successfully"}}catch(r){return{success:!1,message:"Failed to send SMS"}}}static async addNote(e,s,a){try{const{data:r,error:l}=await t.from("purchase_order_messages").insert({purchase_order_id:e,sender:a,content:s,type:"user",timestamp:(new Date).toISOString()}).select().single();if(l)throw l;return{success:!0,message:"Note added successfully",data:r}}catch(r){return{success:!1,message:"Failed to add note"}}}static async getNotes(e){try{const{data:s,error:a}=await t.from("purchase_order_messages").select("*").eq("purchase_order_id",e).eq("type","user").order("timestamp",{ascending:!1});if(a)throw a;return{success:!0,message:"Notes retrieved",data:s||[]}}catch(s){return{success:!1,message:"Failed to get notes"}}}static async bulkUpdateStatus(e,s){try{const{error:a}=await t.from("lats_purchase_order_items").update({status:s,updated_at:(new Date).toISOString()}).in("id",e);if(a)throw a;return{success:!0,message:`Updated ${e.length} items`}}catch(a){return{success:!1,message:"Failed to update items"}}}static async bulkAssignLocation(e,s){try{const{error:a}=await t.from("lats_purchase_order_items").update({location:s,updated_at:(new Date).toISOString()}).in("id",e);if(a)throw a;return{success:!0,message:`Assigned ${e.length} items to ${s}`}}catch(a){return{success:!1,message:"Failed to assign location"}}}static async createReturnOrder(e,s){try{const{data:a,error:r}=await t.from("purchase_order_returns").insert({purchase_order_id:e,reason:s.reason,return_type:s.returnType,notes:s.notes||null,status:"pending",created_at:(new Date).toISOString()}).select().single();if(r)throw r;const l=s.items.map(e=>({return_order_id:a.id,item_id:e.itemId,quantity:e.quantity,created_at:(new Date).toISOString()})),{error:n}=await t.from("purchase_order_return_items").insert(l);if(n)throw n;return{success:!0,message:"Return order created successfully",data:a}}catch(a){return{success:!1,message:"Failed to create return order"}}}static async logAction(e,s,a){try{const{data:{user:r},error:l}=await t.auth.getUser();if(l||!r)return;const n="string"==typeof a?a:JSON.stringify(a),{data:i,error:c}=await t.rpc("log_purchase_order_audit",{p_purchase_order_id:e,p_action:s,p_details:n,p_user_id:r.id});if(c){const{error:a}=await t.from("purchase_order_audit").insert({purchase_order_id:e,action:s,details:n,user_id:r.id,created_by:r.id,timestamp:(new Date).toISOString()})}}catch(r){}}}const ie=({isOpen:e,onClose:t,purchaseOrder:a,onReceiveFull:r,onReceivePartial:l})=>{var n,i,c;const[o,m]=d.useState("full"),[u,p]=d.useState(!1);if(!e)return null;const g=(null==(n=null==a?void 0:a.items)?void 0:n.reduce((e,t)=>e+(t.quantity||0),0))||0,y=(null==(i=null==a?void 0:a.items)?void 0:i.reduce((e,t)=>e+(t.receivedQuantity||0),0))||0,v=g-y;return s.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden relative",children:[s.jsx("button",{onClick:t,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:s.jsx(x,{className:"w-5 h-5"})}),s.jsxs("div",{className:"p-8 bg-gradient-to-br from-green-50 to-emerald-50 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:s.jsx(h,{className:"w-8 h-8 text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Receive Purchase Order"})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[s.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm",children:[s.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Order Number"}),s.jsx("p",{className:"font-bold text-gray-900 text-base",children:null==a?void 0:a.orderNumber})]}),s.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm",children:[s.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Supplier"}),s.jsx("p",{className:"font-bold text-gray-900 text-base",children:(null==(c=null==a?void 0:a.supplier)?void 0:c.name)||"N/A"})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-xl border-2 border-blue-200 shadow-sm text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g}),s.jsx("div",{className:"text-xs text-blue-700 font-medium mt-1",children:"Total Quantity"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border-2 border-green-200 shadow-sm text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:y}),s.jsx("div",{className:"text-xs text-green-700 font-medium mt-1",children:"Received"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 p-4 rounded-xl border-2 border-orange-200 shadow-sm text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:v}),s.jsx("div",{className:"text-xs text-orange-700 font-medium mt-1",children:"Pending"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[s.jsx("button",{type:"button",onClick:()=>m("full"),className:"p-5 rounded-2xl transition-all duration-200 border-2 shadow-sm "+("full"===o?"bg-white shadow-xl border-green-500 ring-4 ring-green-200":"bg-white border-gray-200 hover:border-green-300 hover:shadow-md"),children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center mb-3 "+("full"===o?"bg-green-500":"bg-green-50"),children:s.jsx(h,{className:"w-7 h-7 "+("full"===o?"text-white":"text-green-600")})}),s.jsx("div",{className:"font-bold text-base mb-1 "+("full"===o?"text-green-600":"text-gray-900"),children:"Full Receive"}),s.jsxs("div",{className:"text-xs text-gray-500",children:["All ",v," units"]})]})}),s.jsx("button",{type:"button",onClick:()=>m("partial"),className:"p-5 rounded-2xl transition-all duration-200 border-2 shadow-sm "+("partial"===o?"bg-white shadow-xl border-orange-500 ring-4 ring-orange-200":"bg-white border-gray-200 hover:border-orange-300 hover:shadow-md"),children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center mb-3 "+("partial"===o?"bg-orange-500":"bg-orange-50"),children:s.jsx(f,{className:"w-7 h-7 "+("partial"===o?"text-white":"text-orange-600")})}),s.jsx("div",{className:"font-bold text-base mb-1 "+("partial"===o?"text-orange-600":"text-gray-900"),children:"Partial Receive"}),s.jsx("div",{className:"text-xs text-gray-500",children:"Select quantities"})]})})]}),s.jsx("button",{type:"button",onClick:()=>p(!u),className:"w-full p-5 rounded-2xl transition-all duration-200 border-2 shadow-sm "+(u?"bg-white shadow-xl border-purple-500 ring-4 ring-purple-200":"bg-white border-gray-200 hover:border-purple-300 hover:shadow-md"),children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-6 h-6 rounded-md border-2 flex items-center justify-center "+(u?"bg-purple-500 border-purple-500":"bg-purple-50 border-purple-300"),children:u&&s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),s.jsx("div",{className:"flex-1 text-left font-semibold "+(u?"text-purple-600":"text-gray-900"),children:"Include Quality Check"})]})})]}),s.jsx("div",{className:"p-6 pt-0",children:s.jsx("button",{onClick:()=>{switch(u?sessionStorage.setItem("includeQualityCheck","true"):sessionStorage.removeItem("includeQualityCheck"),o){case"full":r();break;case"partial":l();break;default:b.error("Please select a receive type")}},className:"w-full px-6 py-3.5 bg-green-600 hover:bg-green-700 text-white rounded-xl transition-all font-semibold shadow-lg hover:shadow-xl text-lg",children:"Proceed to Receive"})})]})})},ce=({purchaseOrderId:e,isOpen:r,onClose:l,onComplete:n})=>{const{currentUser:i}=a(),[c,o]=d.useState("template"),[m,u]=d.useState([]),[g,y]=d.useState(""),[b,f]=d.useState(""),[N,w]=d.useState([]),[_,S]=d.useState(0),[k,C]=d.useState(""),[I,P]=d.useState(!1),[D,O]=d.useState(30),[T,A]=d.useState("");d.useEffect(()=>{r&&$()},[r]);const $=async()=>{try{const e=await re.getTemplates();if(e.success&&e.data)u(e.data),e.data.length>0&&y(e.data[0].id);else{const e={id:"fallback-general",name:"General Quality Check",description:"Basic quality check for all items",category:"general",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};u([e]),y(e.id)}}catch(e){const t={id:"fallback-general",name:"General Quality Check",description:"Basic quality check for all items",category:"general",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};u([t]),y(t.id)}},q=N[_];return r?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(h,{className:"w-6 h-6 text-blue-600"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Quality Check"}),s.jsxs("p",{className:"text-sm text-gray-500",children:["template"===c&&"Select Template","inspect"===c&&`Item ${_+1} of ${N.length}`,"complete"===c&&"Complete Check","inventory"===c&&"Add to Inventory"]})]})]}),s.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg",children:s.jsx(x,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-180px)]",children:["template"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Choose Quality Check Template"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map(e=>s.jsxs("button",{onClick:()=>y(e.id),className:"p-4 border rounded-lg text-left transition "+(g===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[s.jsx("h4",{className:"font-medium",children:e.name}),e.description&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),s.jsx("span",{className:"inline-block mt-2 px-2 py-1 text-xs rounded-full bg-gray-100",children:e.category})]},e.id))})]}),"inspect"===c&&q&&s.jsx(de,{item:q,onSubmit:async(e,t,s,a,r,l,n,i,c)=>{(await re.updateQualityCheckItem({id:e,result:t,quantityChecked:s,quantityPassed:a,quantityFailed:r,defectType:l,defectDescription:n,actionTaken:i,notes:c})).success&&(w(d=>d.map(d=>d.id===e?{...d,result:t,quantityChecked:s,quantityPassed:a,quantityFailed:r,defectType:l,defectDescription:n,actionTaken:i,notes:c}:d)),_<N.length-1?S(e=>e+1):o("complete"))},onSkip:()=>S(e=>e+1)}),"complete"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(v,{className:"w-5 h-5 text-green-600"}),s.jsx("p",{className:"font-medium text-green-800",children:"All items checked!"})]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"font-medium",children:"Summary"}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total Items"}),s.jsx("p",{className:"text-2xl font-semibold",children:N.length})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Passed"}),s.jsx("p",{className:"text-2xl font-semibold text-green-600",children:N.filter(e=>"pass"===e.result).length})]}),s.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Failed"}),s.jsx("p",{className:"text-2xl font-semibold text-red-600",children:N.filter(e=>"fail"===e.result).length})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Final Notes"}),s.jsx("textarea",{value:k,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border rounded-lg",rows:4,placeholder:"Add any final notes..."})]})]}),"inventory"===c&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"w-5 h-5 text-blue-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-blue-800",children:"Quality Check Passed!"}),s.jsx("p",{className:"text-sm text-blue-600",children:"Set selling prices and add items to inventory"})]})]})}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[s.jsx(j,{className:"w-4 h-4"}),"Profit Margin (%)"]}),s.jsx("input",{type:"number",value:D||"",onChange:e=>{const t=parseFloat(e.target.value);O(isNaN(t)?0:t)},className:"w-full px-3 py-2 border rounded-lg",placeholder:"30",min:"0",max:"100",step:"5"}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Selling price will be calculated as: Cost Price × (1 + ",D,"%)"]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[s.jsx(p,{className:"w-4 h-4"}),"Default Location (Optional)"]}),s.jsx("input",{type:"text",value:T,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border rounded-lg",placeholder:"e.g., Warehouse A, Shelf 3"})]}),s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium mb-3",children:"Preview"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Items to add:"}),s.jsx("span",{className:"font-medium",children:N.filter(e=>"pass"===e.result).length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Profit margin:"}),s.jsxs("span",{className:"font-medium",children:[D,"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Location:"}),s.jsx("span",{className:"font-medium",children:T||"Not specified"})]})]})]})]})]}),s.jsxs("div",{className:"flex items-center justify-between p-6 border-t bg-gray-50",children:[s.jsx("button",{onClick:l,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg",children:"Cancel"}),s.jsxs("div",{className:"flex items-center gap-3",children:["template"===c&&s.jsx("button",{onClick:async()=>{if(g&&i){P(!0);try{const t=await re.createQualityCheck({purchaseOrderId:e,templateId:g,checkedBy:i.id});if(t.success&&t.data){f(t.data);const e=await re.getQualityCheckItems(t.data);e.success&&e.data?(w(e.data),o("inspect")):o("inspect")}else alert(`Failed to start quality check: ${t.message}`)}catch(t){alert(`Error starting quality check: ${t instanceof Error?t.message:"Unknown error"}`)}finally{P(!1)}}},disabled:!g||I,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:I?"Starting...":"Start Check"}),"complete"===c&&s.jsx("button",{onClick:async()=>{if(!b)return;P(!0);if((await re.completeQualityCheck({qualityCheckId:b,notes:k})).success){const e=N.filter(e=>"fail"===e.result).length;let t="pass";e===N.length?t="fail":e>0&&(t="conditional"),"pass"===t?o("inventory"):(n(),l())}P(!1)},disabled:I,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:I?"Completing...":"Complete Check"}),"inventory"===c&&s.jsxs("button",{onClick:async()=>{if(b&&i){P(!0);try{const{data:s,error:a}=await t.rpc("add_quality_items_to_inventory_v2",{p_quality_check_id:b,p_purchase_order_id:e,p_user_id:i.id,p_profit_margin_percentage:D,p_default_location:T||null});if(a)throw a;const r=s;r&&r.success?(n(),l()):alert((null==r?void 0:r.message)||"Failed to add items to inventory")}catch(s){alert("Error adding items to inventory")}finally{P(!1)}}},disabled:I,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[s.jsx(h,{className:"w-4 h-4"}),I?"Adding to Inventory...":"Add to Inventory"]})]})]})]})}):null},de=({item:e,onSubmit:t,onSkip:a})=>{var r,l,n,i,c,o,m,u,x,h;const[p,g]=d.useState("pass"),[y,b]=d.useState((null==(r=e.purchaseOrderItem)?void 0:r.quantity)||0),[f,j]=d.useState((null==(l=e.purchaseOrderItem)?void 0:l.quantity)||0),[_,S]=d.useState(0),[k,C]=d.useState(""),[I,P]=d.useState(""),[D,O]=d.useState("accept"),[T,A]=d.useState("");return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsxs("h3",{className:"font-medium mb-2",children:[null==(i=null==(n=e.purchaseOrderItem)?void 0:n.product)?void 0:i.name," - ",null==(o=null==(c=e.purchaseOrderItem)?void 0:c.variant)?void 0:o.name]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.jsxs("span",{children:["SKU: ",null==(u=null==(m=e.purchaseOrderItem)?void 0:m.variant)?void 0:u.sku]}),s.jsxs("span",{children:["Qty: ",null==(x=e.purchaseOrderItem)?void 0:x.quantity]})]})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-blue-900",children:e.criteriaName}),(null==(h=e.criteria)?void 0:h.description)&&s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:e.criteria.description})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-3",children:"Check Result"}),s.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[s.jsxs("button",{onClick:()=>{g("pass"),j(y),S(0)},className:"p-4 border rounded-lg flex flex-col items-center gap-2 "+("pass"===p?"border-green-500 bg-green-50":"border-gray-200"),children:[s.jsx(v,{className:"w-6 h-6 "+("pass"===p?"text-green-600":"text-gray-400")}),s.jsx("span",{className:"pass"===p?"text-green-700":"text-gray-600",children:"Pass"})]}),s.jsxs("button",{onClick:()=>g("fail"),className:"p-4 border rounded-lg flex flex-col items-center gap-2 "+("fail"===p?"border-red-500 bg-red-50":"border-gray-200"),children:[s.jsx(N,{className:"w-6 h-6 "+("fail"===p?"text-red-600":"text-gray-400")}),s.jsx("span",{className:"fail"===p?"text-red-700":"text-gray-600",children:"Fail"})]}),s.jsxs("button",{onClick:()=>g("na"),className:"p-4 border rounded-lg flex flex-col items-center gap-2 "+("na"===p?"border-gray-500 bg-gray-50":"border-gray-200"),children:[s.jsx(w,{className:"w-6 h-6 "+("na"===p?"text-gray-600":"text-gray-400")}),s.jsx("span",{className:"na"===p?"text-gray-700":"text-gray-600",children:"N/A"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Checked"}),s.jsx("input",{type:"number",value:y||"",onChange:e=>{const t=Number(e.target.value);b(isNaN(t)?0:t)},className:"w-full px-3 py-2 border rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Passed"}),s.jsx("input",{type:"number",value:f||"",onChange:e=>{const t=Number(e.target.value);j(isNaN(t)?0:t)},className:"w-full px-3 py-2 border rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Failed"}),s.jsx("input",{type:"number",value:_||"",onChange:e=>{const t=Number(e.target.value);S(isNaN(t)?0:t)},className:"w-full px-3 py-2 border rounded-lg"})]})]}),"fail"===p&&s.jsxs("div",{className:"space-y-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Defect Type"}),s.jsxs("select",{value:k,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[s.jsx("option",{value:"",children:"Select defect type"}),s.jsx("option",{value:"physical_damage",children:"Physical Damage"}),s.jsx("option",{value:"functional_issue",children:"Functional Issue"}),s.jsx("option",{value:"missing_parts",children:"Missing Parts"}),s.jsx("option",{value:"cosmetic_defect",children:"Cosmetic Defect"}),s.jsx("option",{value:"other",children:"Other"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Defect Description"}),s.jsx("textarea",{value:I,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border rounded-lg",rows:3,placeholder:"Describe the defect..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Action Taken"}),s.jsxs("select",{value:D,onChange:e=>O(e.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[s.jsx("option",{value:"accept",children:"Accept"}),s.jsx("option",{value:"reject",children:"Reject"}),s.jsx("option",{value:"return",children:"Return to Supplier"}),s.jsx("option",{value:"replace",children:"Request Replacement"}),s.jsx("option",{value:"repair",children:"Send for Repair"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),s.jsx("textarea",{value:T,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border rounded-lg",rows:3,placeholder:"Add any notes..."})]}),s.jsxs("div",{className:"flex items-center justify-between pt-4",children:[s.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg",children:"Skip"}),s.jsx("button",{onClick:()=>{t(e.id,p,y,f,_,k||void 0,I||void 0,D,T||void 0)},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Next"})]})]})},oe=({purchaseOrderId:e,onViewDetails:t,onItemsReceived:a})=>{const[r,l]=d.useState(null),[n,i]=d.useState(!0),[c,o]=d.useState(!1);d.useEffect(()=>{m()},[e]);const m=async()=>{i(!0);const t=await re.getQualityCheckSummary(e);t.success&&t.data&&l(t.data),i(!1)};if(n)return s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow animate-pulse",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),s.jsx("div",{className:"h-8 bg-gray-200 rounded w-full"})]});if(!r)return s.jsx("div",{className:"p-6 bg-gray-50 rounded-lg border border-gray-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(h,{className:"w-5 h-5 text-gray-400"}),s.jsx("p",{className:"text-gray-600",children:"No quality check performed yet"})]})});const u=r.totalItems>0?Math.round(r.passedItems/r.totalItems*100):0;return s.jsxs("div",{className:"bg-white rounded-lg shadow",children:[s.jsx("div",{className:"p-6 border-b",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(h,{className:"w-6 h-6 text-blue-600"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold",children:"Quality Check Summary"}),r.checkedAt&&s.jsxs("p",{className:"text-sm text-gray-500",children:["Checked on ",new Date(r.checkedAt).toLocaleDateString()]})]})]}),s.jsx("div",{className:`px-4 py-2 rounded-full border ${(e=>{switch(e){case"passed":return"bg-green-100 text-green-800 border-green-200";case"failed":return"bg-red-100 text-red-800 border-red-200";case"partial":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(r.status)}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"passed":return s.jsx(v,{className:"w-5 h-5 text-green-600"});case"failed":return s.jsx(N,{className:"w-5 h-5 text-red-600"});case"partial":return s.jsx(w,{className:"w-5 h-5 text-yellow-600"});default:return s.jsx(h,{className:"w-5 h-5 text-gray-600"})}})(r.status),s.jsx("span",{className:"font-medium capitalize",children:r.status})]})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(h,{className:"w-4 h-4 text-gray-600"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Total Items"})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.totalItems})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(v,{className:"w-4 h-4 text-green-600"}),s.jsx("p",{className:"text-sm text-green-700",children:"Passed"})]}),s.jsx("p",{className:"text-2xl font-bold text-green-700",children:r.passedItems})]}),s.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{className:"w-4 h-4 text-red-600"}),s.jsx("p",{className:"text-sm text-red-700",children:"Failed"})]}),s.jsx("p",{className:"text-2xl font-bold text-red-700",children:r.failedItems})]}),s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(w,{className:"w-4 h-4 text-yellow-600"}),s.jsx("p",{className:"text-sm text-yellow-700",children:"Pending"})]}),s.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:r.pendingItems})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium",children:"Pass Rate"}),s.jsxs("span",{className:"text-sm font-bold",children:[u,"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:s.jsx("div",{className:"h-3 rounded-full transition-all "+(u>=90?"bg-green-500":u>=70?"bg-yellow-500":"bg-red-500"),style:{width:`${u}%`}})})]}),r.overallResult&&s.jsx("div",{className:"p-4 rounded-lg border "+("pass"===r.overallResult?"bg-green-50 border-green-200":"fail"===r.overallResult?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"),children:s.jsxs("div",{className:"flex items-center gap-3",children:["pass"===r.overallResult&&s.jsx(v,{className:"w-5 h-5 text-green-600"}),"fail"===r.overallResult&&s.jsx(N,{className:"w-5 h-5 text-red-600"}),"conditional"===r.overallResult&&s.jsx(w,{className:"w-5 h-5 text-yellow-600"}),s.jsx("div",{children:s.jsxs("p",{className:"font-medium",children:["pass"===r.overallResult&&"All items passed quality check","fail"===r.overallResult&&"Some items failed quality check","conditional"===r.overallResult&&"Conditional approval required"]})})]})}),s.jsxs("div",{className:"mt-4 space-y-2",children:[r.passedItems>0&&s.jsxs("button",{onClick:async()=>{if(r){o(!0);try{const t=await re.receiveQualityCheckedItems(r.qualityCheckId,e);t.success?(b.success(t.message||"Items received to inventory successfully"),null==a||a()):b.error(t.message||"Failed to receive items to inventory")}catch(t){b.error("Failed to receive items to inventory")}finally{o(!1)}}},disabled:c,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(f,{className:"w-4 h-4"}),c?"Receiving...":"Receive to Inventory"]}),t&&s.jsxs("button",{onClick:()=>t(r.qualityCheckId),className:"w-full px-4 py-2 border border-blue-500 text-blue-600 rounded-lg hover:bg-blue-50 transition flex items-center justify-center gap-2",children:[s.jsx(_,{className:"w-4 h-4"}),"View Detailed Report"]})]})]})]})},me=({qualityCheckId:e,isOpen:t,onClose:a})=>{const[r,l]=d.useState(null),[n,i]=d.useState([]),[c,o]=d.useState(!1),[m,u]=d.useState("overview");d.useEffect(()=>{t&&e&&""!==e?p():!t||e&&""!==e||(l(null),i([]),o(!1))},[t,e]);const p=async()=>{if(e&&""!==e&&"undefined"!==e){o(!0);try{const t=await re.getQualityCheck(e);t.success&&t.data&&l(t.data);const s=await re.getQualityCheckItems(e);s.success&&s.data&&i(s.data)}catch(t){}finally{o(!1)}}else o(!1)},g=e=>{switch(e){case"pass":return s.jsx(v,{className:"w-4 h-4 text-green-600"});case"fail":return s.jsx(N,{className:"w-4 h-4 text-red-600"});case"na":return s.jsx(O,{className:"w-4 h-4 text-gray-400"});default:return s.jsx(w,{className:"w-4 h-4 text-gray-400"})}},y=e=>{switch(e){case"accept":return"bg-green-100 text-green-800";case"reject":return"bg-red-100 text-red-800";case"return":return"bg-orange-100 text-orange-800";case"replace":return"bg-blue-100 text-blue-800";case"repair":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[s.jsxs("div",{className:"p-6 border-b bg-gray-50",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(h,{className:"w-6 h-6 text-blue-600"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold",children:"Quality Check Details"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Quality Check ID: ",e?e.slice(0,8)+"...":"N/A"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>{},className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[s.jsx(S,{className:"w-4 h-4"}),"Export PDF"]}),s.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg",children:s.jsx(x,{className:"w-5 h-5"})})]})]}),r&&s.jsx("div",{className:"mt-4",children:s.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full border ${(e=>{switch(e){case"passed":return"bg-green-100 text-green-800 border-green-200";case"failed":return"bg-red-100 text-red-800 border-red-200";case"partial":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(r.status)}`,children:["passed"===r.status&&s.jsx(v,{className:"w-5 h-5"}),"failed"===r.status&&s.jsx(N,{className:"w-5 h-5"}),"partial"===r.status&&s.jsx(w,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium capitalize",children:r.status})]})})]}),s.jsx("div",{className:"border-b",children:s.jsx("div",{className:"flex space-x-8 px-6",children:[{id:"overview",label:"Overview",icon:_},{id:"items",label:"Items",icon:h},{id:"summary",label:"Summary",icon:k}].map(e=>s.jsxs("button",{onClick:()=>u(e.id),className:"py-4 px-2 border-b-2 font-medium text-sm flex items-center gap-2 "+(m===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(e.icon,{className:"w-4 h-4"}),e.label]},e.id))})}),s.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:c?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsxs(s.Fragment,{children:["overview"===m&&r&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Quality Check Information"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(C,{className:"w-4 h-4 text-gray-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Checked Date"}),s.jsx("p",{className:"font-medium",children:r.checkedAt?new Date(r.checkedAt).toLocaleDateString():"Not completed"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(I,{className:"w-4 h-4 text-gray-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Checked By"}),s.jsx("p",{className:"font-medium",children:r.checkedBy||"Not specified"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(k,{className:"w-4 h-4 text-gray-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Overall Result"}),s.jsx("p",{className:"font-medium capitalize",children:r.overallResult||"Pending"})]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Template Information"}),r.template?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Template Name"}),s.jsx("p",{className:"font-medium",children:r.template.name})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Category"}),s.jsx("p",{className:"font-medium capitalize",children:r.template.category})]}),r.template.description&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Description"}),s.jsx("p",{className:"font-medium",children:r.template.description})]})]}):s.jsx("p",{className:"text-gray-500",children:"No template information available"})]})]}),r.notes&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Notes"}),s.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(P,{className:"w-4 h-4 text-gray-400 mt-1"}),s.jsx("p",{className:"text-gray-700",children:r.notes})]})})]})]}),"items"===m&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Quality Check Items"}),0===n.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(h,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),s.jsx("p",{children:"No quality check items found"})]}):s.jsx("div",{className:"space-y-4",children:n.map((e,t)=>{var a;return s.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-600 rounded-full text-sm font-medium",children:t+1}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:e.criteriaName}),(null==(a=e.purchaseOrderItem)?void 0:a.product)&&s.jsxs("p",{className:"text-sm text-gray-600",children:[e.purchaseOrderItem.product.name,e.purchaseOrderItem.variant&&` - ${e.purchaseOrderItem.variant.name}`]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[g(e.result),s.jsx("span",{className:"font-medium capitalize",children:e.result})]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Checked"}),s.jsx("p",{className:"font-bold",children:e.quantityChecked})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Passed"}),s.jsx("p",{className:"font-bold text-green-600",children:e.quantityPassed})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Failed"}),s.jsx("p",{className:"font-bold text-red-600",children:e.quantityFailed})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Pass Rate"}),s.jsxs("p",{className:"font-bold",children:[e.quantityChecked>0?Math.round(e.quantityPassed/e.quantityChecked*100):0,"%"]})]})]}),(e.defectType||e.defectDescription)&&s.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:[s.jsx("h5",{className:"font-medium text-red-800 mb-2",children:"Defect Information"}),e.defectType&&s.jsxs("p",{className:"text-sm text-red-700",children:[s.jsx("span",{className:"font-medium",children:"Type:"})," ",e.defectType]}),e.defectDescription&&s.jsxs("p",{className:"text-sm text-red-700 mt-1",children:[s.jsx("span",{className:"font-medium",children:"Description:"})," ",e.defectDescription]})]}),e.actionTaken&&s.jsxs("div",{className:"mb-3",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Action Taken: "}),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${y(e.actionTaken)}`,children:e.actionTaken})]}),e.notes&&s.jsxs("div",{className:"mb-3",children:[s.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Notes:"}),s.jsx("p",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:e.notes})]}),e.images&&e.images.length>0&&s.jsxs("div",{children:[s.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Images (",e.images.length,")"]}),s.jsx("div",{className:"flex gap-2",children:e.images.map((e,t)=>s.jsx("button",{className:"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center hover:bg-gray-300",children:s.jsx(D,{className:"w-6 h-6 text-gray-400"})},t))})]})]},e.id)})})]}),"summary"===m&&r&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Quality Check Summary"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg text-center",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total Items"}),s.jsx("p",{className:"text-2xl font-bold",children:n.length})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg text-center",children:[s.jsx("p",{className:"text-sm text-green-600",children:"Passed"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.filter(e=>"pass"===e.result).length})]}),s.jsxs("div",{className:"p-4 bg-red-50 rounded-lg text-center",children:[s.jsx("p",{className:"text-sm text-red-600",children:"Failed"}),s.jsx("p",{className:"text-2xl font-bold text-red-600",children:n.filter(e=>"fail"===e.result).length})]}),s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg text-center",children:[s.jsx("p",{className:"text-sm text-yellow-600",children:"N/A"}),s.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:n.filter(e=>"na"===e.result).length})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium",children:"Overall Results"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{children:"Overall Status"}),s.jsx("span",{className:"font-medium capitalize",children:r.status})]}),s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{children:"Overall Result"}),s.jsx("span",{className:"font-medium capitalize",children:r.overallResult||"Pending"})]}),s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{children:"Completion Rate"}),s.jsxs("span",{className:"font-medium",children:[n.length>0?Math.round(n.filter(e=>"na"!==e.result).length/n.length*100):0,"%"]})]})]})]}),n.some(e=>e.actionTaken)&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium",children:"Actions Taken Summary"}),s.jsx("div",{className:"space-y-2",children:["accept","reject","return","replace","repair"].map(e=>{const t=n.filter(t=>t.actionTaken===e).length;return 0===t?null:s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{className:"capitalize",children:e}),s.jsxs("span",{className:"font-medium",children:[t," items"]})]},e)})})]})]})]})})]})}):null},ue=({editMode:y=!1})=>{var k,C,I,D,O,te,se,de,ue,xe,he,pe;const{currentUser:ge}=a(),ye=o(),{id:be}=m(),[fe,ve]=u(),{updatePurchaseOrder:je}=r(),[Ne,we]=d.useState(null),[_e,Se]=d.useState(y),[ke,Ce]=d.useState(!0),[Ie,Pe]=d.useState(!1),[De,Oe]=d.useState(!1);d.useState(!1),d.useState(!1),d.useState(!1);const[Te,Ae]=d.useState(!1),[$e,qe]=d.useState(!1),[Re,Ee]=d.useState(!1),[Fe,Le]=d.useState(!1),[Me,Qe]=d.useState(!1),[Ue,ze]=d.useState(!1),[Ze,Be]=d.useState(!1),[Ve,He]=d.useState(!1),[Ye,Ke]=d.useState(null),[We,Xe]=d.useState(null),[,Ge]=d.useState(0),[Je]=d.useState(!1),[et]=d.useState(30);d.useState(!1);const[tt,st]=d.useState("overview"),[at,rt]=d.useState(!1),[lt,nt]=d.useState(!1),[it,ct]=d.useState(!1),[dt,ot]=d.useState(!1),[mt,ut]=d.useState(!1),[xt,ht]=d.useState(!1),[pt,gt]=d.useState("partial"),[yt,bt]=d.useState(!1),[ft,vt]=d.useState([]),[jt,Nt]=d.useState(new Map),[wt,_t]=d.useState(!1),St=e=>`po_receive_${be}_${e}`,kt=e=>{if(be&&(e.receiveMode&&localStorage.setItem(St("mode"),e.receiveMode),e.serialNumberData&&localStorage.setItem(St("serials"),JSON.stringify(e.serialNumberData)),e.pricingData)){const t=Array.from(e.pricingData.entries());localStorage.setItem(St("pricing"),JSON.stringify(t))}},[Ct,It]=d.useState(!1),[Pt,Dt]=d.useState(!1),[Ot,Tt]=d.useState("");d.useState(!1);const[At,$t]=d.useState(!1),[qt,Rt]=d.useState(!1),[Et,Ft]=d.useState(!1),[Lt,Mt]=d.useState(!1),[Qt,Ut]=d.useState(30),[zt,Zt]=d.useState(""),[Bt,Vt]=d.useState(!1),[Ht,Yt]=d.useState(null),[Kt,Wt]=d.useState(null),[Xt,Gt]=d.useState("confirming"),[Jt,es]=d.useState([]),[ts,ss]=d.useState([]),[as,rs]=d.useState([]),[ls,ns]=d.useState(0),[is,cs]=d.useState([]),[,ds]=d.useState(!1),[os,ms]=d.useState([]),[us,xs]=d.useState(!1),[hs,ps]=d.useState([]),[gs,ys]=d.useState(""),[bs,fs]=d.useState(!1),[vs,js]=d.useState([]),[Ns,ws]=d.useState(!1),[_s,Ss]=d.useState([]),[ks,Cs]=d.useState(!1),[Is,Ps]=d.useState(new Set(["overview"])),[Ds,Os]=d.useState([]),[Ts,As]=d.useState(!1),[$s,qs]=d.useState(!1),[Rs,Es]=d.useState(null),[,Fs]=d.useState([]),[Ls,Ms]=d.useState([]),[Qs,Us]=d.useState({search:"",status:"",location:"",dateFrom:"",dateTo:""}),zs=e=>{if(!ge)return!1;const t=ge.permissions||[];if(t.includes("all"))return!0;const s={approve:"approve_purchase_orders",delete:"delete_purchase_orders",cancel:"delete_purchase_orders",edit:"edit_purchase_orders",create:"create_purchase_orders"}[e];return!!t.includes(s)||("admin"===ge.role||"manager"===ge.role||"staff"===ge.role&&("edit"===e||"create"===e))},Zs=d.useCallback(async()=>{var e;Date.now();if(!be)return b.error("Purchase order ID is required"),void ye("/lats/purchase-orders");const s=l(be,"Purchase Order ID");if(!s.isValid)return b.error(s.error||"Invalid purchase order ID"),void ye("/lats/purchase-orders");const a=be.trim();Ce(!0);try{const{getPurchaseOrder:s}=r.getState(),l=await s(a);if(l.ok){if(l.data){if((!l.data.totalAmount||0===l.data.totalAmount)&&l.data.items&&l.data.items.length>0){const e=l.data.items.reduce((e,t)=>e+(t.quantity||t.quantityOrdered||0)*(t.costPrice||t.unitCost||0),0);l.data.totalAmount=e}l.data.items&&(l.data.items=l.data.items.map(e=>({...e,quantity:e.quantity||e.quantityOrdered||0,costPrice:e.costPrice||e.unitCost||0})));const e=Number(l.data.totalAmount)||0,s=Number(l.data.totalPaid)||0;let a=l.data.paymentStatus;e>0&&(a=s>=e?"paid":s>0?"partial":"unpaid",a!==l.data.paymentStatus&&(l.data.paymentStatus=a,t.from("lats_purchase_orders").update({payment_status:a,updated_at:(new Date).toISOString()}).eq("id",l.data.id).then(({error:e})=>{}))),we(l.data);Date.now()}if((null==ge?void 0:ge.id)&&(null==(e=l.data)?void 0:e.id)){try{const e=await n.fixOrderStatusIfNeeded(l.data.id,ge.id);if(e.success&&e.statusChanged){const{getPurchaseOrder:e}=r.getState(),t=await e(be);t.ok&&t.data&&we(t.data)}else e.success}catch(c){}try{if("completed"!==l.data.status){const e=await n.hasPendingPricingItems(l.data.id);bt(e)}else bt(!1)}catch(c){}}}else{const e=l.message||"Failed to load purchase order from server";i("load_purchase_order",new Error(e),{purchaseOrderId:a,operation:"load_purchase_order"}),b.error(e),ye("/lats/purchase-orders")}}catch(c){i("load_purchase_order_exception",c,{purchaseOrderId:be,operation:"load_purchase_order"});let e="Failed to load purchase order";c instanceof Error&&(e=c.message.includes("network")||c.message.includes("fetch")?"Network error: Please check your internet connection and try again":c.message.includes("timeout")?"Request timeout: The server is taking too long to respond":c.message.includes("permission")||c.message.includes("unauthorized")?"Permission denied: You do not have access to this purchase order":c.message.includes("not found")?`Purchase order with ID "${be}" not found`:`Error: ${c.message}`),b.error(e),ye("/lats/purchase-orders")}finally{Ce(!1)}},[be,ye,null==ge?void 0:ge.id]);d.useEffect(()=>{be&&Zs()},[be,Zs]),d.useEffect(()=>{if(be&&Ne&&!wt){const e=(()=>{if(!be)return null;const e=localStorage.getItem(St("mode")),t=localStorage.getItem(St("serials")),s=localStorage.getItem(St("pricing"));return{receiveMode:e,serialNumberData:t?JSON.parse(t):null,pricingData:s?new Map(JSON.parse(s)):null}})();e&&(e.receiveMode||e.serialNumberData||e.pricingData)?(e.receiveMode&&gt(e.receiveMode),e.serialNumberData&&vt(e.serialNumberData),e.pricingData&&Nt(e.pricingData),_t(!0),e.pricingData&&e.pricingData.size>0?(b.success("Resuming from pricing step..."),setTimeout(()=>nt(!0),500)):e.serialNumberData&&e.serialNumberData.length>0?(b.success("Resuming from serial numbers step..."),setTimeout(()=>rt(!0),500)):e.receiveMode&&(b.success("Resuming receive process..."),setTimeout(()=>ot(!0),500))):_t(!0)}},[be,Ne,wt]),d.useEffect(()=>{"receive"===fe.get("action")&&Ne&&!dt&&(ot(!0),fe.delete("action"),ve(fe,{replace:!0}))},[fe,Ne,dt]),d.useEffect(()=>{Se(y)},[y]),d.useEffect(()=>{if(!os.length)return void Ms([]);const e=os.filter(e=>{var t,s,a,r,l,n,i,c,d,o,m;const u=!Qs.search||(null==(s=null==(t=e.product)?void 0:t.name)?void 0:s.toLowerCase().includes(Qs.search.toLowerCase()))||(null==(r=null==(a=e.variant)?void 0:a.name)?void 0:r.toLowerCase().includes(Qs.search.toLowerCase()))||(null==(l=e.serial_number)?void 0:l.toLowerCase().includes(Qs.search.toLowerCase()))||(null==(n=e.imei)?void 0:n.toLowerCase().includes(Qs.search.toLowerCase()))||(null==(c=null==(i=e.product)?void 0:i.sku)?void 0:c.toLowerCase().includes(Qs.search.toLowerCase())),x=!Qs.status||e.status===Qs.status,h=!Qs.location||(null==(d=e.location)?void 0:d.toLowerCase().includes(Qs.location.toLowerCase()))||(null==(o=e.shelf)?void 0:o.toLowerCase().includes(Qs.location.toLowerCase()))||(null==(m=e.bin)?void 0:m.toLowerCase().includes(Qs.location.toLowerCase())),p=!Qs.dateFrom||new Date(e.created_at)>=new Date(Qs.dateFrom),g=!Qs.dateTo||new Date(e.created_at)<=new Date(Qs.dateTo);return u&&x&&h&&p&&g});Ms(e)},[os,Qs]);const Bs=d.useCallback(async(e=!1)=>{if(be&&Ne)try{e&&He(!0);const{getPurchaseOrder:t}=r.getState(),s=await t(be);s.ok&&s.data&&(we(s.data),Ke(new Date),Ge(e=>e+1)),e&&await Promise.allSettled([n.getMessages(Ne.id).catch(e=>{}),n.getPayments(Ne.id).then(e=>{rs(e),ns(Date.now())}).catch(e=>{}),n.getReceivedItems(Ne.id).then(e=>{e.success&&e.data&&ms(e.data)}).catch(e=>{})])}catch(t){e||b.error("Failed to refresh purchase order data")}finally{e&&He(!1)}},[be,Ne]);d.useEffect(()=>{if(!be||!Ne||!Je)return;const e=setInterval(()=>{Bs(!0)},1e3*et);return Xe(e),()=>{e&&clearInterval(e)}},[be,Ne,Bs,Je,et]),d.useEffect(()=>()=>{We&&clearInterval(We)},[We]),d.useEffect(()=>{if(os.length>0){(async()=>{if(be)try{const e=await n.getPurchaseOrderInventoryStats(be);e.success&&Fs(e.data||[])}catch(e){}})()}},[os.length,be]);const Vs=d.useCallback(async(e,t=!1)=>{if(st(e),!Is.has(e)||t)switch(t||Ps(t=>new Set(Array.from(t).concat(e))),e){case"analytics":break;case"history":if(Ne)try{const e=await n.getAuditHistory(Ne.id);es(e)}catch(s){}break;case"items":if(Ne){Cs(!0),xs(!0);try{const e=await n.getPurchaseOrderItemsWithProducts(Ne.id);e.success?Ss(e.data||[]):b.error("Failed to load purchase order items");const t=await n.getReceivedItems(Ne.id);t.success?ms(t.data||[]):b.error("Failed to load received items")}catch(s){b.error("Failed to load items data")}finally{Cs(!1),xs(!1)}}break;case"received":if(Ne){xs(!0),ds(!0);try{const e=await n.getReceivedItems(Ne.id);e.success?ms(e.data||[]):b.error("Failed to load received items");const t=await re.getQualityCheckSummary(Ne.id);if(t.success&&t.data)if(t.data.qualityCheckId){const e=await re.getQualityCheckItems(t.data.qualityCheckId);e.success&&cs(e.data||[])}else cs([])}catch(s){b.error("Failed to load items")}finally{xs(!1),ds(!1)}}}},[Is,ge,Ne]);d.useCallback(()=>{Zs()},[Zs]);const Hs=d.useCallback(async()=>{if(Ne){xs(!0);try{const e=await n.getReceivedItems(Ne.id);e.success?(ms(e.data||[]),b.success("Received items refreshed")):b.error("Failed to refresh received items")}catch(e){b.error("Failed to refresh received items")}finally{xs(!1)}}},[Ne]),Ys=async()=>{if($t(!0),Ne)try{const e=await n.getMessages(Ne.id);ss(e)}catch(e){}},Ks=async()=>{if(Ft(!0),Ne){const t=Date.now(),s=t-ls<3e4;if(as.length>0&&s)return;try{const e=await n.getPayments(Ne.id);rs(e),ns(t)}catch(e){}}},Ws=async e=>{if(0!==vs.length)try{let t;switch(e){case"update_status":t=await ne.bulkUpdateStatus(vs,"shipped");break;case"assign_location":const e=prompt("Enter location for selected items:");if(!e)return;t=await ne.bulkAssignLocation(vs,e);break;case"export_selected":return void b.success("Selected items exported successfully");default:return void b.error("Invalid bulk action")}(null==t?void 0:t.success)&&(b.success(t.message),js([]),fs(!1),await Zs(),Ne&&await ne.logAction(Ne.id,"bulk_action",{action:e,item_count:vs.length}))}catch(t){b.error("Failed to perform bulk action")}else b.error("Please select items first")},Xs=async t=>{var s,a,r,l,n,i,c;const{businessInfoService:d}=await e(()=>import("./index-222cfb29.js").then(e=>e.aP),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),o=await d.getBusinessInfo(),m=o.name,u=o.address,x=o.phone,h=o.email||"",p=o.website||"",g=o.logo||"";return`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Purchase Order ${t.orderNumber}</title>\n          <style>\n            body { \n              font-family: Arial, sans-serif; \n              margin: 0; \n              padding: 20px; \n              font-size: 12px;\n              line-height: 1.4;\n            }\n            .header { \n              text-align: center; \n              margin-bottom: 30px; \n              border-bottom: 2px solid #333;\n              padding-bottom: 20px;\n            }\n            .business-info {\n              text-align: center;\n              margin-bottom: 20px;\n              font-size: 14px;\n            }\n            .business-info h1 {\n              margin: 0;\n              font-size: 24px;\n              color: #333;\n            }\n            .business-info p {\n              margin: 2px 0;\n              color: #666;\n            }\n            .business-details {\n              display: grid;\n              grid-template-columns: 1fr 1fr;\n              gap: 20px;\n              margin-top: 15px;\n              text-align: left;\n            }\n            .business-column {\n              background-color: #f8f9fa;\n              padding: 10px;\n              border-radius: 5px;\n            }\n            .order-details {\n              display: grid;\n              grid-template-columns: 1fr 1fr;\n              gap: 20px;\n              margin-bottom: 30px;\n            }\n            .order-info, .supplier-info {\n              border: 1px solid #ddd;\n              padding: 15px;\n              background-color: #f9f9f9;\n            }\n            .order-info h3, .supplier-info h3 {\n              margin: 0 0 10px 0;\n              font-size: 14px;\n              color: #333;\n              border-bottom: 1px solid #ccc;\n              padding-bottom: 5px;\n            }\n            .order-info p, .supplier-info p {\n              margin: 5px 0;\n              font-size: 11px;\n            }\n            .items-table { \n              width: 100%; \n              border-collapse: collapse; \n              margin-bottom: 20px; \n              font-size: 11px;\n            }\n            .items-table th, .items-table td { \n              border: 1px solid #ddd; \n              padding: 8px; \n              text-align: left; \n            }\n            .items-table th { \n              background-color: #f2f2f2; \n              font-weight: bold;\n            }\n            .items-table td {\n              vertical-align: top;\n            }\n            .totals-section {\n              margin-top: 20px;\n              text-align: right;\n            }\n            .totals-table {\n              width: 300px;\n              margin-left: auto;\n              border-collapse: collapse;\n            }\n            .totals-table td {\n              padding: 5px 10px;\n              border: 1px solid #ddd;\n            }\n            .totals-table .label {\n              background-color: #f2f2f2;\n              font-weight: bold;\n              text-align: left;\n            }\n            .totals-table .amount {\n              text-align: right;\n            }\n            .totals-table .total-row {\n              background-color: #e9e9e9;\n              font-weight: bold;\n              font-size: 14px;\n            }\n            .payment-info {\n              margin-top: 20px;\n              padding: 15px;\n              border: 1px solid #ddd;\n              background-color: #f9f9f9;\n            }\n            .payment-info h3 {\n              margin: 0 0 15px 0;\n              font-size: 14px;\n              color: #333;\n              border-bottom: 1px solid #ccc;\n              padding-bottom: 5px;\n            }\n            .payment-details {\n              display: grid;\n              grid-template-columns: 1fr 1fr;\n              gap: 20px;\n            }\n            .payment-column {\n              display: flex;\n              flex-direction: column;\n              gap: 8px;\n            }\n            .notes-section {\n              margin-top: 20px;\n              padding: 15px;\n              border: 1px solid #ddd;\n              background-color: #f9f9f9;\n            }\n            .notes-section h3 {\n              margin: 0 0 10px 0;\n              font-size: 14px;\n              color: #333;\n            }\n            .footer {\n              margin-top: 40px;\n              display: grid;\n              grid-template-columns: 1fr 1fr;\n              gap: 40px;\n              border-top: 1px solid #ddd;\n              padding-top: 20px;\n            }\n            .signature-box {\n              text-align: center;\n              border: 1px solid #ddd;\n              padding: 20px;\n              background-color: #f9f9f9;\n            }\n            .signature-box .line {\n              border-bottom: 1px solid #333;\n              height: 40px;\n              margin-bottom: 5px;\n            }\n            .terms {\n              margin-top: 20px;\n              font-size: 10px;\n              color: #666;\n              border-top: 1px solid #ddd;\n              padding-top: 10px;\n            }\n          </style>\n        </head>\n        <body>\n          \x3c!-- Business Header --\x3e\n          <div class="business-info">\n            ${g?`<img src="${g}" alt="${m} Logo" style="height: 60px; width: auto; margin: 0 auto 10px auto; display: block; object-fit: contain;" />`:""}\n            <h1>${m}</h1>\n            <div class="business-details">\n              <div class="business-column">\n                <p><strong>Address:</strong> ${u}</p>\n                <p><strong>Phone:</strong> ${x}</p>\n              </div>\n              <div class="business-column">\n                <p><strong>Email:</strong> ${h}</p>\n                <p><strong>Website:</strong> ${p}</p>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Purchase Order Header --\x3e\n          <div class="header">\n            <h1>PURCHASE ORDER</h1>\n            <h2>Order #${t.orderNumber}</h2>\n          </div>\n          \n          \x3c!-- Order and Supplier Details --\x3e\n          <div class="order-details">\n            <div class="order-info">\n              <h3>Order Information</h3>\n              <p><strong>Order Date:</strong> ${la(t.orderDate||t.createdAt)}</p>\n              <p><strong>Expected Delivery:</strong> ${t.expectedDeliveryDate?la(t.expectedDeliveryDate):"TBD"}</p>\n              <p><strong>Status:</strong> ${t.status.toUpperCase()}</p>\n              <p><strong>Currency:</strong> ${"TZS"===t.currency?"Tanzania Shillings (TZS)":t.currency||"Tanzania Shillings (TZS)"}</p>\n              ${t.receivedDate?`<p><strong>Received Date:</strong> ${la(t.receivedDate)}</p>`:""}\n            </div>\n            \n            <div class="supplier-info">\n              <h3>Supplier Information</h3>\n              <p><strong>Company:</strong> ${(null==(s=t.supplier)?void 0:s.name)||"N/A"}</p>\n              ${(null==(a=t.supplier)?void 0:a.contactPerson)?`<p><strong>Contact Person:</strong> ${t.supplier.contactPerson}</p>`:""}\n              ${(null==(r=t.supplier)?void 0:r.phone)?`<p><strong>Phone:</strong> ${t.supplier.phone}</p>`:""}\n              ${(null==(l=t.supplier)?void 0:l.email)?`<p><strong>Email:</strong> ${t.supplier.email}</p>`:""}\n              ${(null==(n=t.supplier)?void 0:n.address)?`<p><strong>Address:</strong> ${t.supplier.address}</p>`:""}\n              ${(null==(i=t.supplier)?void 0:i.city)?`<p><strong>City:</strong> ${t.supplier.city}</p>`:""}\n              ${(null==(c=t.supplier)?void 0:c.country)?`<p><strong>Country:</strong> ${t.supplier.country}</p>`:""}\n            </div>\n          </div>\n          \n          \x3c!-- Items Table --\x3e\n          <table class="items-table">\n            <thead>\n              <tr>\n                <th style="width: 28%;">Product Description</th>\n                <th style="width: 18%;">Variant</th>\n                <th style="width: 10%;">Ordered</th>\n                <th style="width: 10%;">Received</th>\n                <th style="width: 14%;">Unit Price</th>\n                <th style="width: 14%;">Price (TZS)</th>\n                <th style="width: 14%;">Total (TZS)</th>\n                <th style="width: 8%;">Status</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${t.items.map(e=>{var s,a,r,l;const n=e.receivedQuantity||0,i=t.exchangeRate&&1!==t.exchangeRate?e.costPrice*t.exchangeRate:e.costPrice,c=i*e.quantity;return`\n                <tr>\n                  <td>\n                    <strong>${(null==(s=e.product)?void 0:s.name)||`Product ${e.productId}`}</strong>\n                    ${(null==(a=e.product)?void 0:a.description)?`<br><small>${e.product.description}</small>`:""}\n                    ${(null==(r=e.product)?void 0:r.sku)?`<br><small>SKU: ${e.product.sku}</small>`:""}\n                  </td>\n                  <td>${(null==(l=e.variant)?void 0:l.name)||`Variant ${e.variantId}`}</td>\n                  <td style="text-align: center; font-weight: bold;">${e.quantity}</td>\n                  <td style="text-align: center; color: ${n>0?"#28a745":"#6c757d"};">${n}</td>\n                  <td style="text-align: right;">${sa(e.costPrice,t.currency)}</td>\n                  <td style="text-align: right; color: #2c5aa0; font-weight: bold;">TZS ${i.toLocaleString()}</td>\n                  <td style="text-align: right; color: #2c5aa0; font-weight: bold;">TZS ${c.toLocaleString()}</td>\n                  <td style="text-align: center;">\n                    <span style="font-size: 10px; padding: 2px 6px; border-radius: 3px; background-color: ${"received"===e.status?"#d4edda":"shipped"===e.status?"#cfe2ff":"cancelled"===e.status?"#f8d7da":"#e2e3e5"}; color: ${"received"===e.status?"#155724":"shipped"===e.status?"#084298":"cancelled"===e.status?"#721c24":"#383d41"};">\n                      ${(e.status||"pending").toUpperCase()}\n                    </span>\n                  </td>\n                </tr>\n              `}).join("")}\n            </tbody>\n          </table>\n          \n          \x3c!-- Totals Section --\x3e\n          <div class="totals-section">\n            <table class="totals-table">\n              <tr>\n                <td class="label">Subtotal:</td>\n                <td class="amount">${sa(t.totalAmount,t.currency)}</td>\n              </tr>\n              ${t.exchangeRate&&1!==t.exchangeRate&&t.totalAmountBaseCurrency?`\n                <tr>\n                  <td class="label">Exchange Rate:</td>\n                  <td class="amount">${t.exchangeRate} (${t.exchangeRateSource||"Manual"})</td>\n                </tr>\n                <tr>\n                  <td class="label">TZS Equivalent:</td>\n                  <td class="amount">TZS ${t.totalAmountBaseCurrency.toLocaleString()}</td>\n                </tr>\n              `:""}\n              <tr class="total-row">\n                <td class="label">TOTAL AMOUNT:</td>\n                <td class="amount">${sa(t.totalAmount,t.currency)}</td>\n              </tr>\n            </table>\n          </div>\n\n          \x3c!-- Payment Information --\x3e\n          <div class="payment-info">\n            <h3>Payment Information</h3>\n            <div class="payment-details">\n              <div class="payment-column">\n                <p><strong>Payment Terms:</strong> Net 30</p>\n                <p><strong>Payment Due Date:</strong> ${((e,t)=>{if(!t)return"N/A";const s=new Date(e),a=t.toLowerCase();if(a.includes("net 30"))s.setDate(s.getDate()+30);else if(a.includes("net 15"))s.setDate(s.getDate()+15);else if(a.includes("net 7"))s.setDate(s.getDate()+7);else if(a.includes("cod"))return"COD (Cash on Delivery)";return la(s.toISOString())})(t.orderDate||t.createdAt,"Net 30")}</p>\n                <p><strong>Payment Status:</strong> \n                  <span style="padding: 2px 8px; border-radius: 3px; background-color: ${"paid"===t.paymentStatus?"#d4edda":"partial"===t.paymentStatus?"#fff3cd":"#f8d7da"}; color: ${"paid"===t.paymentStatus?"#155724":"partial"===t.paymentStatus?"#856404":"#721c24"};">\n                    ${(t.paymentStatus||"unpaid").toUpperCase()}\n                  </span>\n                </p>\n              </div>\n              <div class="payment-column">\n                <p><strong>Total Paid:</strong> ${sa(t.totalPaid||0,t.currency)}</p>\n                <p><strong>Balance Due:</strong> ${sa((t.totalAmount||0)-(t.totalPaid||0),t.currency)}</p>\n                <p><strong>Payment Method:</strong> TBD</p>\n              </div>\n            </div>\n          </div>\n          \n          \x3c!-- Notes Section --\x3e\n          ${t.notes?`\n            <div class="notes-section">\n              <h3>Order Notes</h3>\n              <p>${t.notes}</p>\n            </div>\n          `:""}\n\n          \x3c!-- Footer with Signatures --\x3e\n          <div class="footer">\n            <div class="signature-box">\n              <div class="line"></div>\n              <p><strong>Authorized Signature</strong></p>\n              <p>Date: _______________</p>\n            </div>\n            <div class="signature-box">\n              <div class="line"></div>\n              <p><strong>Supplier Signature</strong></p>\n              <p>Date: _______________</p>\n            </div>\n          </div>\n\n          \x3c!-- Terms and Conditions --\x3e\n          <div class="terms">\n            <p><strong>Terms and Conditions:</strong></p>\n            <p>1. All prices are subject to change without notice.</p>\n            <p>2. Payment terms as specified above.</p>\n            <p>3. Delivery terms: FOB destination unless otherwise specified.</p>\n            <p>4. Any discrepancies must be reported within 48 hours of delivery.</p>\n            <p>5. This purchase order is subject to our standard terms and conditions.</p>\n          </div>\n        </body>\n      </html>\n    `},Gs=e=>{var t,s,a,r,l,n,i;return`\nLATS CHANCE STORE\n${"Dar es Salaam, Tanzania"}\nPhone: ${"+255 XXX XXX XXX"} | Email: ${"info@latschance.com"}\n\nPURCHASE ORDER #${e.orderNumber}\n\nORDER INFORMATION:\nDate: ${la(e.orderDate||e.createdAt)}\nExpected Delivery: ${e.expectedDeliveryDate?la(e.expectedDeliveryDate):"TBD"}\nStatus: ${e.status.toUpperCase()}\nCurrency: ${"TZS"===e.currency?"Tanzania Shillings (TZS)":e.currency||"Tanzania Shillings (TZS)"}\n${e.receivedDate?`Received Date: ${la(e.receivedDate)}`:""}\n\nSUPPLIER INFORMATION:\nCompany: ${(null==(t=e.supplier)?void 0:t.name)||"N/A"}\n${(null==(s=e.supplier)?void 0:s.contactPerson)?`Contact Person: ${e.supplier.contactPerson}`:""}\n${(null==(a=e.supplier)?void 0:a.phone)?`Phone: ${e.supplier.phone}`:""}\n${(null==(r=e.supplier)?void 0:r.email)?`Email: ${e.supplier.email}`:""}\n${(null==(l=e.supplier)?void 0:l.address)?`Address: ${e.supplier.address}`:""}\n${(null==(n=e.supplier)?void 0:n.city)?`City: ${e.supplier.city}`:""}\n${(null==(i=e.supplier)?void 0:i.country)?`Country: ${e.supplier.country}`:""}\n\nITEMS:\n${e.items.map((t,s)=>{var a,r,l;const n=t.receivedQuantity||0,i=e.exchangeRate&&1!==e.exchangeRate?t.costPrice*e.exchangeRate:t.costPrice,c=i*t.quantity;return`\n${s+1}. ${(null==(a=t.product)?void 0:a.name)||`Product ${t.productId}`}\n   Variant: ${(null==(r=t.variant)?void 0:r.name)||`Variant ${t.variantId}`}\n   ${(null==(l=t.product)?void 0:l.sku)?`SKU: ${t.product.sku}`:""}\n   Ordered: ${t.quantity} | Received: ${n}\n   Unit Price: ${sa(t.costPrice,e.currency)} (TZS ${i.toLocaleString()})\n   Total: TZS ${c.toLocaleString()}\n   Status: ${(t.status||"pending").toUpperCase()}\n`}).join("")}\n\nPAYMENT INFORMATION:\nPayment Terms: ${e.paymentTerms||"Net 30"}\nPayment Status: ${(e.paymentStatus||"unpaid").toUpperCase()}\nTotal Paid: ${sa(e.totalPaid||0,e.currency)}\nBalance Due: ${sa((e.totalAmount||0)-(e.totalPaid||0),e.currency)}\n\nTOTALS:\nSubtotal: ${sa(e.totalAmount,e.currency)}\n${e.exchangeRate&&1!==e.exchangeRate&&e.totalAmountBaseCurrency?`\nExchange Rate: ${e.exchangeRate} (${e.exchangeRateSource||"Manual"})\nTZS Equivalent: TZS ${e.totalAmountBaseCurrency.toLocaleString()}\n`:""}\nTOTAL AMOUNT: ${sa(e.totalAmount,e.currency)}\n\n${e.notes?`NOTES:\n${e.notes}\n`:""}\n\nSIGNATURES:\nAuthorized Signature: _________________ Date: _______________\nSupplier Signature: _________________ Date: _______________\n\nTERMS AND CONDITIONS:\n1. All prices are subject to change without notice.\n2. Payment terms as specified above.\n3. Delivery terms: FOB destination unless otherwise specified.\n4. Any discrepancies must be reported within 48 hours of delivery.\n5. This purchase order is subject to our standard terms and conditions.\n    `},Js=(e,t)=>{var s,a,r,l,n,i,c;const d=t.utils.book_new(),o=[["LATS CHANCE STORE","","",""],["Purchase Order Summary","","",""],["","","",""],["ORDER INFORMATION","","",""],["Order Number:",e.orderNumber,"",""],["Order Date:",la(e.orderDate||e.createdAt),"",""],["Expected Delivery:",e.expectedDeliveryDate?la(e.expectedDeliveryDate):"TBD","",""],["Status:",e.status.toUpperCase(),"",""],["Currency:","TZS"===e.currency?"Tanzania Shillings (TZS)":e.currency||"Tanzania Shillings (TZS)","",""],["","","",""],["SUPPLIER INFORMATION","","",""],["Company:",(null==(s=e.supplier)?void 0:s.name)||"N/A","",""],["Contact Person:",(null==(a=e.supplier)?void 0:a.contactPerson)||"","",""],["Phone:",(null==(r=e.supplier)?void 0:r.phone)||"","",""],["Email:",(null==(l=e.supplier)?void 0:l.email)||"","",""],["Address:",(null==(n=e.supplier)?void 0:n.address)||"","",""],["City:",(null==(i=e.supplier)?void 0:i.city)||"","",""],["Country:",(null==(c=e.supplier)?void 0:c.country)||"","",""],["","","",""],["PAYMENT INFORMATION","","",""],["Payment Terms:","Net 30","",""],["Payment Status:",(e.paymentStatus||"unpaid").toUpperCase(),"",""],["Total Paid:",sa(e.totalPaid||0,e.currency),"",""],["Balance Due:",sa((Number(e.totalAmount)||0)-(Number(e.totalPaid)||0),e.currency),"",""],["","","",""],["TOTALS","","",""],["Subtotal:",sa(Number(e.totalAmount)||0,e.currency),"",""],...e.exchangeRate&&1!==e.exchangeRate&&e.totalAmountBaseCurrency?[["Exchange Rate:",`${e.exchangeRate} (${e.exchangeRateSource||"Manual"})`,"",""],["TZS Equivalent:",`TZS ${e.totalAmountBaseCurrency.toLocaleString()}`,"",""]]:[],["TOTAL AMOUNT:",sa(Number(e.totalAmount)||0,e.currency),"",""]],m=t.utils.aoa_to_sheet(o);m["!cols"]=[{wch:20},{wch:30},{wch:15},{wch:15}],t.utils.book_append_sheet(d,m,"Summary");const u=[["Product Description","Variant","Ordered Qty","Received Qty","Unit Price","Price (TZS)","Total (TZS)","Status","SKU"]];e.items.forEach(t=>{var s,a,r;const l=t.receivedQuantity||0,n=e.exchangeRate&&1!==e.exchangeRate?t.costPrice*e.exchangeRate:t.costPrice,i=n*t.quantity;u.push([(null==(s=t.product)?void 0:s.name)||`Product ${t.productId}`,(null==(a=t.variant)?void 0:a.name)||`Variant ${t.variantId}`,t.quantity.toString(),l.toString(),sa(t.costPrice,e.currency),`TZS ${n.toLocaleString()}`,`TZS ${i.toLocaleString()}`,(t.status||"pending").toUpperCase(),(null==(r=t.product)?void 0:r.sku)||""])});const x=e.items.reduce((e,t)=>e+t.quantity,0),h=e.items.reduce((e,t)=>e+(t.receivedQuantity||0),0),p=e.items.reduce((t,s)=>t+(e.exchangeRate&&1!==e.exchangeRate?s.costPrice*e.exchangeRate:s.costPrice)*s.quantity,0);u.push(["TOTALS","",x.toString(),h.toString(),"","",`TZS ${p.toLocaleString()}`,"",""]);const g=t.utils.aoa_to_sheet(u);g["!cols"]=[{wch:30},{wch:20},{wch:12},{wch:12},{wch:15},{wch:15},{wch:15},{wch:12},{wch:15}];const y=t.utils.decode_range(g["!ref"]||"A1");for(let f=y.s.c;f<=y.e.c;f++){const e=t.utils.encode_cell({r:0,c:f});g[e]&&(g[e].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"4472C4"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}})}const b=u.length-1;for(let f=0;f<u[0].length;f++){const e=t.utils.encode_cell({r:b,c:f});g[e]&&(g[e].s={font:{bold:!0},fill:{fgColor:{rgb:"F2F2F2"}},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}})}return t.utils.book_append_sheet(d,g,"Items"),d},ea=e=>{switch(e){case"draft":return"text-yellow-600 bg-yellow-100";case"sent":return"text-blue-600 bg-blue-100";case"confirmed":return"text-purple-600 bg-purple-100";case"received":return"text-green-600 bg-green-100";case"cancelled":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},ta=e=>{switch(e){case"draft":return s.jsx(_,{className:"w-4 h-4"});case"sent":return s.jsx(W,{className:"w-4 h-4"});case"confirmed":case"received":return s.jsx(L,{className:"w-4 h-4"});case"cancelled":return s.jsx(J,{className:"w-4 h-4"});default:return s.jsx(G,{className:"w-4 h-4"})}},sa=(e,t="TZS")=>{const s=isNaN(e)?0:e,a=new Intl.NumberFormat("en-TZ",{minimumFractionDigits:0,maximumFractionDigits:2}).format(s);switch(null==t?void 0:t.toUpperCase()){case"TZS":return`TZS ${a}`;case"USD":return`$${a}`;case"EUR":return`€${a}`;case"GBP":return`£${a}`;case"AED":return`AED ${a}`;case"CNY":return a;default:return`${t} ${a}`}},aa=(e,t)=>{if(!t||0===t.length)return 0;const s=t.reduce((e,t)=>e+(t.quantity||0),0);return 0===s?0:e/s},ra=(e,t,s)=>"TZS"!==t&&s&&1!==s?Math.round(e*s):e,la=e=>{if(!e)return"Not set";const t=new Date(e);return isNaN(t.getTime())?"Not set":t.toLocaleDateString("en-KE",{year:"numeric",month:"long",day:"numeric"})};return ke?s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[s.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),s.jsx("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:s.jsx("div",{className:"flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading purchase order..."})]})})})]}):Ne?s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[s.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:()=>ye("/lats/purchase-orders")}),s.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b flex-shrink-0 "+(_e?"border-blue-200 bg-blue-50":"border-gray-100"),children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center "+(_e?"bg-gradient-to-br from-blue-500 to-blue-600":"bg-gradient-to-br from-blue-500 to-indigo-600"),children:s.jsx(_,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:Ne.orderNumber}),_e&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium",children:[s.jsx(T,{className:"w-4 h-4"}),"Editing Mode"]}),Ve&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin"}),"Auto-refreshing..."]})]}),s.jsxs("p",{className:"text-sm text-gray-500",children:[s.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${ea(Ne.status)}`,children:[ta(Ne.status),s.jsx("span",{className:"capitalize",children:Ne.status})]}),s.jsxs("span",{className:"ml-2",children:["Created ",la(Ne.createdAt)]}),Ye&&s.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["• Last updated: ",Ye.toLocaleTimeString()]})]})]})]}),s.jsx("button",{onClick:()=>ye("/lats/purchase-orders"),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:s.jsx(x,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"border-b border-gray-200 bg-white flex-shrink-0",children:s.jsxs("div",{className:"flex space-x-8 px-6",children:[s.jsx("button",{onClick:()=>Vs("overview"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors "+("overview"===tt?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(A,{className:"w-4 h-4"}),"Overview"]})}),s.jsx("button",{onClick:()=>Vs("supplier"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors "+("supplier"===tt?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(g,{className:"w-4 h-4"}),"Supplier"]})}),s.jsx("button",{onClick:()=>Vs("items"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors "+("items"===tt?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"w-4 h-4"}),"Items & Inventory",os.length>0&&s.jsx("span",{className:"ml-1 px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full",children:os.length})]})}),s.jsx("button",{onClick:()=>Vs("analytics"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors "+("analytics"===tt?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($,{className:"w-4 h-4"}),"Analytics"]})}),s.jsx("button",{onClick:()=>Vs("history"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors "+("history"===tt?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(q,{className:"w-4 h-4"}),"History"]})})]})}),s.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:["overview"===tt&&s.jsx(s.Fragment,{children:Ne?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(A,{className:"w-5 h-5 text-blue-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Order Information"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Order Number"}),s.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:Ne.orderNumber})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),s.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${ea(Ne.status)}`,children:[ta(Ne.status),s.jsx("span",{className:"capitalize",children:Ne.status})]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created Date"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:la(Ne.createdAt)})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Last Updated"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:la(Ne.updatedAt)})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Expected Delivery"}),_e?s.jsx("input",{type:"date",value:Ne.expectedDeliveryDate?new Date(Ne.expectedDeliveryDate).toISOString().split("T")[0]:"",onChange:e=>we(t=>t?{...t,expectedDeliveryDate:e.target.value?new Date(e.target.value).toISOString():void 0}:null),className:"w-full p-2 border border-gray-300 rounded-lg text-sm"}):s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.expectedDeliveryDate?la(Ne.expectedDeliveryDate):"Not set"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Currency"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.currency||"TZS"})]})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(R,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Financial Summary"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Amount"}),s.jsx("p",{className:"text-lg font-bold text-green-600",children:sa(Ne.totalAmount,Ne.currency)})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Items Count"}),s.jsx("p",{className:"text-lg font-bold text-blue-600",children:(null==(k=Ne.items)?void 0:k.length)||0})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Quantity"}),s.jsx("p",{className:"text-lg font-bold text-orange-600",children:(null==(C=Ne.items)?void 0:C.reduce((e,t)=>e+(t.quantity||0),0))||0})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Received"}),s.jsx("p",{className:"text-lg font-bold text-purple-600",children:(null==(I=Ne.items)?void 0:I.reduce((e,t)=>e+(t.receivedQuantity||0),0))||0})]}),Ne.exchangeRate&&1!==Ne.exchangeRate&&Ne.totalAmountBaseCurrency&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"TZS Equivalent"}),s.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["TZS ",Ne.totalAmountBaseCurrency.toLocaleString()]})]}),Ne.exchangeRate&&1!==Ne.exchangeRate&&s.jsxs("div",{className:"col-span-2 space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Exchange Rate"}),s.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["1 ",Ne.currency," = ",Math.round(parseFloat(Ne.exchangeRate.toString()))," TZS",Ne.exchangeRateSource&&"default"!==Ne.exchangeRateSource&&s.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",Ne.exchangeRateSource,")"]})]})]})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(_,{className:"w-5 h-5 text-gray-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Notes"})]}),_e?s.jsx("textarea",{value:Ne.notes||"",onChange:e=>we(t=>t?{...t,notes:e.target.value}:null),className:"w-full p-3 border border-gray-300 rounded-lg resize-none text-sm",rows:4,placeholder:"Add notes for this purchase order..."}):Ne.notes?s.jsx("p",{className:"text-sm text-gray-600 leading-relaxed bg-gray-50 rounded-lg p-3",children:Ne.notes}):s.jsx("p",{className:"text-sm text-gray-400 italic",children:"No notes added"})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(E,{className:"w-5 h-5 text-purple-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Actions"})]}),s.jsx("div",{className:"space-y-2",children:_e?s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:async()=>{var e;if(!Ne)return;Pe(!0);const t=await je(Ne.id,{supplierId:Ne.supplierId,expectedDeliveryDate:Ne.expectedDeliveryDate,notes:Ne.notes,items:null==(e=Ne.items)?void 0:e.map(e=>({id:e.id,productId:e.productId,variantId:e.variantId,quantity:e.quantity,costPrice:e.costPrice}))});t.ok?(b.success("Purchase order updated successfully"),Se(!1),await Zs()):b.error(t.message||"Failed to update purchase order"),Pe(!1)},disabled:Ie,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(F,{className:"w-4 h-4"}),Ie?"Saving...":"Save Changes"]}),s.jsxs("button",{onClick:()=>Se(!1),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(x,{className:"w-4 h-4"}),"Cancel Edit"]})]}):s.jsxs(s.Fragment,{children:["draft"===Ne.status&&s.jsxs(s.Fragment,{children:[zs("approve")&&s.jsxs("button",{onClick:async()=>{if(Ne)if(zs("approve"))if("draft"===Ne.status)if(Ne.items&&0!==Ne.items.length)try{Oe(!0);const e=await n.approvePurchaseOrder(Ne.id,(null==ge?void 0:ge.id)||"","Approved and sent to supplier");if(e.success){await n.updateOrderStatus(Ne.id,"sent",(null==ge?void 0:ge.id)||"")?(await Zs(),b.success("Order approved and sent to supplier")):(await Zs(),b.success("Order approved (mark as sent manually)"))}else b.error(e.message)}catch(e){b.error("Failed to approve and send order")}finally{Oe(!1)}else b.error("Cannot approve order without items");else b.error("Only draft orders can be approved");else b.error("You do not have permission to approve orders")},disabled:De||Ie,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium shadow-lg shadow-green-600/20","aria-label":"Approve and send purchase order",children:[s.jsx(L,{className:"w-4 h-4"}),De?"Processing...":"Approve & Send to Supplier"]}),zs("delete")&&s.jsxs("button",{onClick:async()=>{if(Ne)if(zs("delete"))if("draft"===Ne.status){if(window.confirm("Are you sure you want to delete this purchase order? This action cannot be undone."))try{Ee(!0);const e=await ne.deleteOrder(Ne.id);e.success?(b.success(e.message),ye("/lats/purchase-orders")):b.error(e.message)}catch(e){b.error("Failed to delete purchase order")}finally{Ee(!1)}}else b.error("Only draft orders can be deleted");else b.error("You do not have permission to delete purchase orders")},disabled:Re||Ie,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm","aria-label":"Delete purchase order",children:[s.jsx(M,{className:"w-4 h-4"}),Re?"Deleting...":"Delete Order"]})]}),("sent"===Ne.status||"shipped"===Ne.status)&&s.jsx(s.Fragment,{children:"paid"!==Ne.paymentStatus?s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"p-4 bg-orange-50 border-2 border-orange-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Q,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-semibold text-orange-900 mb-1",children:"Payment Required"}),s.jsx("p",{className:"text-sm text-orange-700",children:"Complete payment before receiving this order"})]})]})}),s.jsxs("button",{onClick:()=>{if("paid"===(null==Ne?void 0:Ne.paymentStatus))return void b.error("This purchase order has already been fully paid");const e=(null==Ne?void 0:Ne.totalAmount)||0,t=(null==Ne?void 0:Ne.totalPaid)||0;let s=e-t;if((null==Ne?void 0:Ne.currency)&&"TZS"!==Ne.currency&&Ne.exchangeRate&&Ne.exchangeRate>1){s=e-t/Ne.exchangeRate}0!==e?s<=0?b.error(`This purchase order has been fully paid. Total: ${e.toLocaleString()}, Paid: ${t.toLocaleString()}`):ct(!0):b.error("Cannot make payment: Purchase order has no total amount. Please add items to the order first.")},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium shadow-lg shadow-orange-600/20","aria-label":"Make payment for purchase order",children:[s.jsx(U,{className:"w-4 h-4"}),"Make Payment"]}),zs("cancel")&&s.jsxs("button",{onClick:async()=>{if(Ne)if(zs("cancel"))if("completed"!==Ne.status)if("cancelled"!==Ne.status){if(("paid"!==Ne.paymentStatus||confirm("This order has been fully paid. Cancelling will require a refund. Are you sure you want to continue?"))&&confirm("Are you sure you want to cancel this order? This action cannot be undone."))try{qe(!0);const e=await ne.cancelOrder(Ne.id);e.success?(b.success(e.message),we({...Ne,status:"cancelled"}),await Zs(),await ne.logAction(Ne.id,"order_cancelled",{reason:"user_cancelled"})):b.error(e.message)}catch(e){b.error("Failed to cancel purchase order")}finally{qe(!1)}}else b.error("Order is already cancelled");else b.error("Cannot cancel a completed order");else b.error("You do not have permission to cancel purchase orders")},disabled:$e,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(N,{className:"w-4 h-4"}),$e?"Cancelling...":"Cancel Order"]})]}):s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"p-3 bg-green-50 border-2 border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(v,{className:"w-5 h-5 text-green-600"}),s.jsx("span",{className:"text-sm font-semibold text-green-900",children:"Payment Complete - Ready to Receive"})]})}),s.jsxs("button",{onClick:()=>ot(!0),disabled:Te,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium shadow-lg shadow-green-600/20","aria-label":"Receive purchase order",children:[s.jsx(h,{className:"w-4 h-4"}),Te?"Receiving...":"Receive Order"]})]})}),(()=>{var e;const t=(null==(e=Ne.items)?void 0:e.some(e=>(e.receivedQuantity||0)<(e.quantity||0)))||!1;return"partial_received"===Ne.status&&"paid"===Ne.paymentStatus&&t&&s.jsxs("button",{onClick:()=>ot(!0),disabled:Te,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium shadow-lg shadow-blue-600/20","aria-label":"Continue receiving items",children:[s.jsx(h,{className:"w-4 h-4"}),Te?"Receiving...":"Continue Receiving"]})})(),"received"===Ne.status&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:async()=>{if(Ne)if("received"===Ne.status)if("paid"===Ne.paymentStatus)try{Be(!0);const e=await n.checkCompletionStatus(Ne.id);if(e.success&&e.data&&!e.data.can_complete&&e.data.total_items>0){b.success("Fixing received quantities...");(await n.fixReceivedQuantities(Ne.id,(null==ge?void 0:ge.id)||"")).success&&b.success("Received quantities fixed successfully!")}const t=await n.completePurchaseOrder(Ne.id,(null==ge?void 0:ge.id)||"","Purchase order completed after receiving all items");if(t.success)b.success("Purchase order completed successfully!"),await Zs(),t.data;else{let e=t.message||"Completion failed";"P0001"===t.error_code?e="Cannot complete: Not all items have been fully received. Please check the received quantities.":"P0002"===t.error_code?e="Cannot complete: Purchase order is not in received status.":"P0003"===t.error_code&&(e="Cannot complete: No items found in this purchase order."),b.error(e)}}catch(e){b.error("Failed to complete purchase order")}finally{Be(!1)}else b.error("Order must be fully paid before completing");else b.error("Order must be received before completing")},disabled:Ze,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium shadow-lg shadow-green-600/20","aria-label":"Complete purchase order",children:[s.jsx(v,{className:"w-4 h-4"}),Ze?"Completing...":"Complete Order"]}),s.jsxs("button",{onClick:()=>{It(!0)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(f,{className:"w-4 h-4"}),"Quality Check (Optional)"]})]}),"completed"===Ne.status&&s.jsxs("div",{className:"text-center py-6",children:[s.jsx(v,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Order Completed"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"This purchase order has been successfully completed and all items are in inventory"})]}),"cancelled"===Ne.status&&s.jsxs("div",{className:"text-center py-6",children:[s.jsx(N,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Order Cancelled"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"This purchase order has been cancelled and cannot be processed further"})]}),("received"===Ne.status||"partial_received"===Ne.status)&&s.jsxs("button",{onClick:()=>ws(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(z,{className:"w-4 h-4"}),"Return Order"]})]})}),s.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[s.jsx("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3",children:"Documents & More"}),s.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.jsxs("button",{onClick:async()=>{if(Ne)try{Le(!0);const e=window.open("","_blank");if(e){const t=await Xs(Ne);e.document.write(t),e.document.close(),e.print(),b.success("Purchase order sent to printer")}else b.error("Could not open print window. Please check popup settings.")}catch(e){b.error("Failed to print purchase order")}finally{Le(!1)}else b.error("No purchase order to print")},disabled:Fe,className:"flex items-center justify-center gap-2 px-3 py-2 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm","aria-label":"Print purchase order",children:[s.jsx(Z,{className:"w-4 h-4"}),"Print"]}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>ht(!xt),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(S,{className:"w-4 h-4"}),"Export"]}),xt&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>ht(!1)}),s.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white border border-gray-200 rounded-lg shadow-xl z-20 min-w-[160px]",children:[s.jsxs("button",{onClick:()=>{(()=>{if(Ne)try{Qe(!0);const e=Gs(Ne),t=new Blob([e],{type:"application/pdf"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`Purchase_Order_${Ne.orderNumber}_${(new Date).toISOString().split("T")[0]}.pdf`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s),b.success("PDF exported successfully")}catch(e){b.error("Failed to export PDF")}finally{Qe(!1)}else b.error("No purchase order to export")})(),ht(!1)},className:"w-full text-left px-4 py-2.5 hover:bg-gray-50 text-sm flex items-center gap-2 text-gray-700",children:[s.jsx(_,{className:"w-4 h-4"}),"Export as PDF"]}),s.jsxs("button",{onClick:()=>{(async()=>{if(Ne)try{Qe(!0);const t=await e(()=>import("./utils-99ffde2f.js"),[]),s=Js(Ne,t),a=t.write(s,{bookType:"xlsx",type:"array"}),r=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=window.URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download=`Purchase_Order_${Ne.orderNumber||"Unknown"}_${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(l),b.success("Excel file exported successfully")}catch(t){b.error("Failed to export Excel file")}finally{Qe(!1)}else b.error("No purchase order to export")})(),ht(!1)},className:"w-full text-left px-4 py-2.5 hover:bg-gray-50 text-sm border-t flex items-center gap-2 text-gray-700",children:[s.jsx(B,{className:"w-4 h-4"}),"Export as Excel"]})]})]})]}),s.jsxs("button",{onClick:async()=>{if(Rt(!0),Ne)try{const e=await ne.getNotes(Ne.id);e.success&&ps(e.data||[])}catch(e){}},className:"flex items-center justify-center gap-2 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-colors font-medium text-sm","aria-label":"View and add notes",children:[s.jsx(_,{className:"w-4 h-4"}),"Notes"]}),("completed"===Ne.status||"cancelled"===Ne.status)&&s.jsxs("button",{onClick:async()=>{var e;if(Ne)if(Ne.items&&0!==Ne.items.length)try{ze(!0);const t=await ne.duplicateOrder(Ne.id);t.success?(b.success(t.message),await ne.logAction(Ne.id,"order_duplicated",{new_order_id:null==(e=t.data)?void 0:e.id}),ye(`/lats/purchase-orders/${t.data.id}`)):b.error(t.message)}catch(t){b.error("Failed to duplicate order")}finally{ze(!1)}else b.error("Cannot duplicate order without items")},disabled:Ue,className:"flex items-center justify-center gap-2 px-3 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors font-medium text-sm","aria-label":"Duplicate this order",children:[s.jsx(V,{className:"w-4 h-4"}),Ue?"Duplicating...":"Duplicate"]}),s.jsxs("button",{onClick:()=>fs(!0),className:"flex items-center justify-center gap-2 px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium text-sm","aria-label":"Bulk actions on items",children:[s.jsx(H,{className:"w-4 h-4"}),"Bulk Actions"]})]})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-100",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:s.jsx($,{className:"w-4 h-4 text-white"})}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Order Summary"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(null==(D=Ne.items)?void 0:D.length)||0}),s.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-wide",children:"Items"})]}),s.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(null==(O=Ne.items)?void 0:O.reduce((e,t)=>e+(t.quantity||0),0))||0}),s.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-wide",children:"Quantity"})]})]}),s.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:(null==(te=Ne.items)?void 0:te.reduce((e,t)=>e+(t.receivedQuantity||0),0))||0}),s.jsx("div",{className:"text-xs text-green-700 uppercase tracking-wide",children:"Received"})]}),s.jsx("div",{className:"pt-3 border-t border-gray-100",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-gray-900 mb-1",children:"Total Amount"}),s.jsx("div",{className:"text-2xl font-bold text-green-600",children:sa(Ne.totalAmount,Ne.currency)}),Ne.exchangeRate&&1!==Ne.exchangeRate&&Ne.totalAmountBaseCurrency&&s.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:["TZS ",Ne.totalAmountBaseCurrency.toLocaleString()]})]})})]})]})]})]})}):s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(A,{className:"w-8 h-8 text-gray-400"})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading Order Details"}),s.jsx("p",{className:"text-gray-500",children:"Please wait while we load the purchase order information..."})]})})}),"supplier"===tt&&s.jsxs("div",{className:"space-y-6",children:[null,Ne.supplier?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(g,{className:"w-5 h-5 text-orange-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Supplier Information"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.name})]}),Ne.supplier.contactPerson&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Contact Person"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.contactPerson})]}),Ne.supplier.phone&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Phone"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.phone})]}),Ne.supplier.email&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Email"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.email})]}),Ne.supplier.country&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Country"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.country})]}),Ne.supplier.currency&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Preferred Currency"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.currency})]})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(j,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Supplier Performance"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Rating"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.rating?`${Ne.supplier.rating}/5`:"Not Rated"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Lead Time"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.leadTime?`${Ne.supplier.leadTime} days`:"Not Set"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Orders"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.totalOrders||0})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"On-Time Delivery"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ne.supplier.onTimeDeliveryRate?`${Ne.supplier.onTimeDeliveryRate}%`:"Not Tracked"})]})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(P,{className:"w-5 h-5 text-blue-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Communication History"})]}),s.jsx("button",{onClick:Ys,className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),s.jsx("div",{className:"space-y-2",children:ts.length>0?ts.slice(0,3).map((e,t)=>s.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.type}),s.jsx("p",{className:"text-xs text-gray-600",children:e.message})]}),s.jsx("span",{className:"text-xs text-gray-500",children:e.date?"string"==typeof e.date?e.date:new Date(e.date).toLocaleString():e.timestamp?new Date(e.timestamp).toLocaleString():"N/A"})]})},t)):s.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No communication history"})})]})]}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(g,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"No supplier information available"})]})]}),"items"===tt&&s.jsxs("div",{className:"space-y-6",children:[Ne&&s.jsx(oe,{purchaseOrderId:Ne.id,onViewDetails:e=>{Tt(e),Dt(!0)},onItemsReceived:async()=>{await Zs(),await Hs()}}),ks?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading purchase order items..."})]})}):0===_s.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(h,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"No items in this order"})]}):s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(h,{className:"w-5 h-5 text-indigo-600"}),s.jsxs("h3",{className:"text-sm font-semibold text-gray-800",children:["Order Items (",_s.length," items)"]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Product"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden sm:table-cell",children:"Variant"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Quantity"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden md:table-cell",children:"Cost Price"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Total"}),Ne.exchangeRate&&1!==Ne.exchangeRate&&s.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden lg:table-cell",children:"TZS Total"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Received"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"})]})}),s.jsx("tbody",{children:_s.map((e,t)=>{var a,r,l,n;const i=e.quantity>0?e.receivedQuantity/e.quantity*100:0;return s.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"p-3",children:s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-sm text-gray-900",children:(null==(a=e.product)?void 0:a.name)||`Product ${e.productId}`}),s.jsx("p",{className:"text-xs text-gray-500 sm:hidden",children:(null==(r=e.variant)?void 0:r.name)||"Default"}),s.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",(null==(l=e.product)?void 0:l.sku)||e.productId]})]})}),s.jsx("td",{className:"p-3 text-sm hidden sm:table-cell",children:(null==(n=e.variant)?void 0:n.name)||"Default"}),s.jsx("td",{className:"p-3",children:_e?s.jsx("input",{type:"number",min:"1",value:e.quantity,onChange:s=>{const a=parseInt(s.target.value)||1,r=[..._s];r[t]={...e,quantity:a},Ss(r)},className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"}):s.jsx("span",{className:"font-medium text-sm text-gray-900",children:e.quantity})}),s.jsx("td",{className:"p-3 text-sm hidden md:table-cell",children:_e?s.jsx("input",{type:"number",min:"0",step:"0.01",value:e.costPrice,onChange:s=>{const a=parseFloat(s.target.value)||0,r=[..._s];r[t]={...e,costPrice:a},Ss(r)},className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm"}):sa(e.costPrice,Ne.currency)}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:"font-medium text-sm text-gray-900",children:sa((e.quantity||0)*(e.costPrice||0),Ne.currency)})}),Ne.exchangeRate&&1!==Ne.exchangeRate&&s.jsx("td",{className:"p-3 text-sm hidden lg:table-cell",children:s.jsxs("span",{className:"text-gray-600",children:["TZS ",((e.quantity||0)*(e.costPrice||0)*(Ne.exchangeRate||1)).toLocaleString()]})}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:"font-medium text-sm text-gray-900",children:e.receivedQuantity})}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(i>=100?"bg-green-100 text-green-700":i>0?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-700"),children:i>=100?"Complete":i>0?"Partial":"Pending"})})]},t)})})]})})]}),os.length>0&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(Y,{className:"w-5 h-5 text-blue-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Search & Filter Inventory"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Search"}),s.jsx("input",{type:"text",placeholder:"Search products, SKU, serial...",value:Qs.search,onChange:e=>Us(t=>({...t,search:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),s.jsxs("select",{value:Qs.status,onChange:e=>Us(t=>({...t,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"All Status"}),s.jsx("option",{value:"available",children:"Available"}),s.jsx("option",{value:"sold",children:"Sold"}),s.jsx("option",{value:"reserved",children:"Reserved"}),s.jsx("option",{value:"damaged",children:"Damaged"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Location"}),s.jsx("input",{type:"text",placeholder:"Filter by location...",value:Qs.location,onChange:e=>Us(t=>({...t,location:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsx("div",{className:"flex items-end",children:s.jsx("button",{onClick:()=>Us({search:"",status:"",location:"",dateFrom:"",dateTo:""}),className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Clear"})})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-5 h-5 text-green-600"}),s.jsxs("h3",{className:"text-sm font-semibold text-gray-800",children:["Inventory Items (",Ls.length," of ",os.length," items)"]})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{onClick:Hs,className:"text-xs text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1",disabled:us,children:[s.jsx(z,{className:"w-3 h-3 "+(us?"animate-spin":"")}),"Refresh"]})})]}),0===Ls.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(f,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"No items match your filters"}),s.jsx("button",{onClick:()=>Us({search:"",status:"",location:"",dateFrom:"",dateTo:""}),className:"mt-2 text-sm text-blue-600 hover:text-blue-700",children:"Clear all filters"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Product"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden sm:table-cell",children:"Variant"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Serial Number / IMEI"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden lg:table-cell",children:"Location"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Cost"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Selling Price"}),s.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Received Date"})]})}),s.jsx("tbody",{children:Ls.map((e,t)=>{var a,r,l,n;return s.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"p-3",children:s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-sm text-gray-900",children:(null==(a=e.product)?void 0:a.name)||`Product ${e.product_id}`}),s.jsx("p",{className:"text-xs text-gray-500 sm:hidden",children:(null==(r=e.variant)?void 0:r.name)||`Variant ${e.variant_id}`}),s.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",(null==(l=e.product)?void 0:l.sku)||e.product_id]})]})}),s.jsx("td",{className:"p-3 text-sm hidden sm:table-cell",children:(null==(n=e.variant)?void 0:n.name)||`Variant ${e.variant_id}`}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{children:[e.serial_number&&s.jsx("div",{className:"font-mono text-sm text-gray-900",children:e.serial_number}),e.imei&&s.jsxs("div",{className:"font-mono text-xs text-gray-600",children:["IMEI: ",e.imei]}),!e.serial_number&&!e.imei&&s.jsx("span",{className:"text-gray-400",children:"-"}),e.barcode&&s.jsxs("div",{className:"text-xs text-gray-500",children:["Barcode: ",e.barcode]})]})}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("available"===e.status?"bg-green-100 text-green-700":"sold"===e.status?"bg-blue-100 text-blue-700":"damaged"===e.status?"bg-red-100 text-red-700":"reserved"===e.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:e.status})}),s.jsx("td",{className:"p-3 text-sm hidden lg:table-cell",children:e.location?s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-900",children:e.location}),e.shelf&&s.jsxs("div",{className:"text-xs text-gray-500",children:["Shelf: ",e.shelf]}),e.bin&&s.jsxs("div",{className:"text-xs text-gray-500",children:["Bin: ",e.bin]})]}):s.jsx("span",{className:"text-gray-400",children:"Not assigned"})}),s.jsx("td",{className:"p-3 text-sm",children:s.jsxs("span",{className:"font-medium text-gray-900",children:["TZS ",(e.cost_price||0).toLocaleString()]})}),s.jsx("td",{className:"p-3 text-sm",children:s.jsxs("span",{className:"font-medium text-gray-900",children:["TZS ",(e.selling_price||0).toLocaleString()]})}),s.jsxs("td",{className:"p-3",children:[s.jsx("div",{className:"text-sm text-gray-900",children:new Date(e.created_at).toLocaleDateString()}),s.jsx("div",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleTimeString()})]})]},t)})})]})}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 pt-4 border-t border-gray-100",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-green-600",children:os.filter(e=>"available"===e.status).length}),s.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Available"}),s.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["TZS ",os.filter(e=>"available"===e.status).reduce((e,t)=>e+(Number(t.cost_price)||0),0).toLocaleString()]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-blue-600",children:os.filter(e=>"sold"===e.status).length}),s.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Sold"}),s.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["TZS ",os.filter(e=>"sold"===e.status).reduce((e,t)=>e+(Number(t.selling_price)||Number(t.cost_price)||0),0).toLocaleString()]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-yellow-600",children:os.filter(e=>"reserved"===e.status).length}),s.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Reserved"}),s.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["TZS ",os.filter(e=>"reserved"===e.status).reduce((e,t)=>e+(Number(t.cost_price)||0),0).toLocaleString()]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-red-600",children:os.filter(e=>"damaged"===e.status).length}),s.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Damaged"}),s.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["TZS ",os.filter(e=>"damaged"===e.status).reduce((e,t)=>e+(Number(t.cost_price)||0),0).toLocaleString()]})]})]})]})]})]}),!1,!1,"analytics"===tt&&!Is.has("analytics")&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})}),"analytics"===tt&&Is.has("analytics")&&s.jsxs("div",{className:"space-y-6",children:[(()=>{const e=(e=>{const t=[];return e.currency||t.push("Currency not set - defaulting to TZS"),e.currency&&"TZS"!==e.currency&&(e.exchangeRate&&1!==e.exchangeRate||t.push("Exchange rate missing for non-TZS currency"),e.totalAmountBaseCurrency||t.push("Base currency amount not calculated")),t})(Ne);return e.length>0?s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),s.jsx("h4",{className:"text-sm font-semibold text-yellow-800",children:"Currency Issues Detected"})]}),s.jsx("ul",{className:"text-xs text-yellow-700 space-y-1",children:e.map((e,t)=>s.jsxs("li",{children:["• ",e]},t))})]}):null})(),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(K,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Cost Analysis"}),s.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[s.jsx("div",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded",children:Ne.currency||"TZS"}),Ne.exchangeRate&&1!==Ne.exchangeRate&&s.jsxs("div",{className:"px-2 py-1 bg-orange-100 text-orange-700 text-xs font-medium rounded",children:["1 ",Ne.currency," = ",(na=Ne.exchangeRate,na.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}))," TZS"]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[s.jsx("div",{className:"text-xs font-medium text-green-700 uppercase tracking-wide mb-1",children:"Total Cost"}),s.jsx("div",{className:"text-lg font-bold text-green-900",children:sa(Ne.totalAmount,Ne.currency)}),Ne.exchangeRate&&1!==Ne.exchangeRate&&s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["≈ TZS ",Ne.totalAmountBaseCurrency?Ne.totalAmountBaseCurrency.toLocaleString():ra(Ne.totalAmount,Ne.currency||"USD",Ne.exchangeRate).toLocaleString()]})]}),s.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[s.jsx("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Avg Cost/Item"}),s.jsx("div",{className:"text-lg font-bold text-blue-900",children:sa(aa(Ne.totalAmount,Ne.items),Ne.currency)}),Ne.exchangeRate&&1!==Ne.exchangeRate&&s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["≈ TZS ",ra(aa(Ne.totalAmount,Ne.items),Ne.currency||"USD",Ne.exchangeRate).toLocaleString()]})]}),s.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[s.jsx("div",{className:"text-xs font-medium text-purple-700 uppercase tracking-wide mb-1",children:"Total Quantity"}),s.jsx("div",{className:"text-lg font-bold text-purple-900",children:(null==(se=Ne.items)?void 0:se.reduce((e,t)=>e+(t.quantity||0),0))||0})]}),s.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[s.jsx("div",{className:"text-xs font-medium text-orange-700 uppercase tracking-wide mb-1",children:"Items Count"}),s.jsx("div",{className:"text-lg font-bold text-orange-900",children:(null==(de=Ne.items)?void 0:de.length)||0})]})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(h,{className:"w-5 h-5 text-indigo-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Inventory Impact"})]}),s.jsx("div",{className:"space-y-3",children:null==(ue=Ne.items)?void 0:ue.map((e,t)=>{var a,r,l,n,i,c,d,o;const m=(null==(l=null==(r=null==(a=e.product)?void 0:a.variants)?void 0:r.find(t=>t.id===e.variantId))?void 0:l.quantity)||0,u=m+e.quantity,x=u<=((null==(c=null==(i=null==(n=e.product)?void 0:n.variants)?void 0:i.find(t=>t.id===e.variantId))?void 0:c.minQuantity)||0);return s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(d=e.product)?void 0:d.name)||`Product ${e.productId}`}),s.jsx("p",{className:"text-xs text-gray-500",children:(null==(o=e.variant)?void 0:o.name)||`Variant ${e.variantId}`})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-sm text-gray-600",children:["Current: ",m]}),s.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["+",e.quantity," → ",u]}),x&&s.jsx("p",{className:"text-xs text-orange-600",children:"Low Stock Warning"})]})]},t)})})]})]}),"history"===tt&&!Is.has("history")&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading history..."})]})}),"history"===tt&&Is.has("history")&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[s.jsx(q,{className:"w-5 h-5 text-purple-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Audit Trail"})]}),s.jsx("div",{className:"space-y-2",children:Jt.length>0?Jt.map((e,t)=>s.jsxs("div",{className:"flex justify-between items-start p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.action}),s.jsx("p",{className:"text-xs text-gray-600",children:e.description}),s.jsxs("p",{className:"text-xs text-gray-500",children:["By: ",e.user]})]}),s.jsx("span",{className:"text-xs text-gray-500",children:e.timestamp?new Date(e.timestamp).toLocaleString():"N/A"})]},t)):s.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No audit history available"})})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Payment History"})]}),s.jsx("button",{onClick:Ks,className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),s.jsx("div",{className:"space-y-2",children:as.length>0?as.slice(0,3).map((e,t)=>s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.method||"Payment"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.amount||0)}),e.currency&&s.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full font-medium",children:e.currency})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xs text-gray-500",children:e.timestamp?new Date(e.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A"}),s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("completed"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"),children:e.status})]})]},t)):s.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No payment history"})})]})]})]}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 bg-gray-50 px-6 py-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{onClick:Ys,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(P,{className:"w-4 h-4"}),"Communication"]}),s.jsxs("button",{onClick:()=>{var e;if(!(null==(e=null==Ne?void 0:Ne.supplier)?void 0:e.phone))return void b.error("Supplier phone number not available");const t=`Hello, I'm contacting you about Purchase Order #${Ne.orderNumber}. Please let me know the status.`,s=`https://wa.me/${Ne.supplier.phone.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(t)}`;window.open(s,"_blank")},className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium text-sm",title:"Send WhatsApp message to supplier",children:[s.jsx(P,{className:"w-4 h-4"}),"WhatsApp"]}),s.jsxs("button",{onClick:async()=>{var e;if(null==(e=null==Ne?void 0:Ne.supplier)?void 0:e.phone)try{const e=`Purchase Order #${Ne.orderNumber} - Please provide status update.`,t=await ne.sendSMS(Ne.supplier.phone,e,Ne.id);t.success?(b.success(t.message),await ne.logAction(Ne.id,"sms_sent",{phone:Ne.supplier.phone})):b.error(t.message)}catch(t){b.error("Failed to send SMS")}else b.error("Supplier phone number not available")},className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium text-sm",title:"Send SMS to supplier",children:[s.jsx(W,{className:"w-4 h-4"}),"SMS"]}),s.jsxs("button",{onClick:Ks,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(U,{className:"w-4 h-4"}),"Payments"]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>ye("/lats/purchase-orders"),className:"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors text-sm font-medium",children:"Close"}),"draft"===Ne.status&&s.jsxs("button",{onClick:()=>Se(!_e),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(T,{className:"w-4 h-4"}),_e?"Cancel Edit":"Edit"]})]})]}),!1,Ne&&s.jsx(ee,{isOpen:it,onClose:()=>ct(!1),amount:(()=>{const e=Ne.totalAmount||0,t=Ne.totalPaid||0;Ne.totalAmountBaseCurrency;const s=Ne.exchangeRate||1;if(Ne.currency&&"TZS"!==Ne.currency&&s>1){const a=e-t/s;return Math.max(0,a)}return Math.max(0,e-t)})(),customerId:Ne.supplierId,customerName:null==(xe=Ne.supplier)?void 0:xe.name,description:`Payment for Purchase Order ${Ne.orderNumber}`,onPaymentComplete:async(t,s)=>{try{const{purchaseOrderPaymentService:s}=await e(()=>import("./purchaseOrderPaymentService-6c3df30a.js"),["assets/purchaseOrderPaymentService-6c3df30a.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),a=(await Promise.all(t.map(async e=>await s.processPayment({purchaseOrderId:(null==Ne?void 0:Ne.id)||"",paymentAccountId:e.paymentAccountId,amount:e.amount,currency:e.currency||"TZS",paymentMethod:e.paymentMethod,paymentMethodId:e.paymentMethodId,reference:e.reference,notes:e.notes,createdBy:(null==ge?void 0:ge.id)||null})))).filter(e=>!e.success);if(a.length>0){const e=a.map(e=>e.message).join("; ");b.error(`Some payments failed: ${e}`)}else b.success("All payments processed successfully");ct(!1),ns(0),await Zs(),setTimeout(()=>{window.location.reload()},500)}catch(a){b.error("Failed to process payment. Please try again.")}},paymentType:"cash_out",title:"Purchase Order Payment",currency:Ne.currency,exchangeRate:Ne.exchangeRate}),mt&&s.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[s.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:s.jsx(f,{className:"w-5 h-5 text-orange-600"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Partial Receive"})]}),s.jsxs("div",{className:"p-6",children:[s.jsx("p",{className:"text-gray-600 mb-4",children:"Select the items and quantities you have received:"}),s.jsx("div",{className:"space-y-3",children:null==Ne?void 0:Ne.items.map((e,t)=>{var a;return s.jsxs("div",{className:"flex items-center gap-4 p-3 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:(null==(a=e.product)?void 0:a.name)||`Product ${e.productId}`}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Ordered: ",e.quantity]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Received:"}),s.jsx("input",{type:"number",min:"0",max:e.quantity,value:e.receivedQuantity||0,className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm",onChange:s=>{const a=parseInt(s.target.value)||0,r=[...(null==Ne?void 0:Ne.items)||[]];r[t]={...e,receivedQuantity:a},we(e=>e?{...e,items:r}:null)}})]})]},e.id||t)})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>ut(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>{(async e=>{var s;if(!Ne)return void b.error("No purchase order available");if(!e||0===e.length)return void b.error("No items provided for receiving");const a=e.filter(e=>!!e.id&&!("number"!=typeof e.receivedQuantity||e.receivedQuantity<0));if(0!==a.length)try{Pe(!0);const{data:e,error:r}=await t.rpc("partial_purchase_order_receive",{purchase_order_id_param:Ne.id,received_items:a.map(e=>({item_id:e.id,quantity:e.receivedQuantity})),user_id_param:(null==ge?void 0:ge.id)||"",receive_notes:"Partial receive from UI"});if(r)return void b.error(`Partial receive failed: ${r.message}`);if(e&&e.success){const t=(null==(s=e.data)?void 0:s.is_complete)?"All items fully received - Order marked as received":"Partial receive completed";b.success(`${t}: ${e.message}`),await Zs(),"received"===tt&&await Hs(),latsEventBus.emit("lats:purchase-order.received",{purchaseOrderId:Ne.id,userId:null==ge?void 0:ge.id,notes:"Partial receive"}),ut(!1)}else b.error(`Partial receive failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}catch(r){i("partial_receive_exception",r,{purchaseOrderId:Ne.id,operation:"partial_receive"});let e="Failed to process partial receive";r instanceof Error&&(e=r.message.includes("network")||r.message.includes("fetch")?"Network error: Please check your internet connection and try again":r.message.includes("timeout")?"Request timeout: The server is taking too long to respond":r.message.includes("validation")?`Validation error: ${r.message}`:`Error: ${r.message}`),b.error(e)}finally{Pe(!1)}else b.error("No valid items found for receiving")})((null==Ne?void 0:Ne.items.filter(e=>(e.receivedQuantity||0)>0))||[])},disabled:Ie,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50",children:Ie?"Processing...":"Confirm Receive"})]})]})]})}),At&&s.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(P,{className:"w-5 h-5 text-blue-600"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Communication History"})]}),s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"space-y-4 mb-6",children:ts.length>0?ts.map((e,t)=>s.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-gray-900",children:e.sender}),s.jsx("span",{className:"text-sm text-gray-500",children:new Date(e.timestamp).toLocaleString()})]}),s.jsx("p",{className:"text-gray-700",children:e.content})]},t)):s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(P,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),s.jsx("p",{children:"No communication history available"})]})}),s.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[s.jsx("textarea",{id:"messageInput",placeholder:"Add a new message...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none",rows:3}),s.jsxs("div",{className:"flex gap-3 mt-3",children:[s.jsx("button",{onClick:()=>$t(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Close"}),s.jsx("button",{onClick:()=>{const e=document.getElementById("messageInput");e&&e.value.trim()&&((async e=>{if(e.trim()&&Ne)try{if(await n.sendMessage({purchaseOrderId:Ne.id,sender:(null==ge?void 0:ge.name)||"You",content:e,type:"user"})){const t={id:Date.now().toString(),sender:(null==ge?void 0:ge.name)||"You",content:e,timestamp:(new Date).toISOString(),type:"user"};ss(e=>[t,...e]),b.success("Message sent successfully")}else b.error("Failed to send message")}catch(t){b.error("Failed to send message")}})(e.value),e.value="")},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"Send Message"})]})]})]})]})}),Ne&&s.jsx(ce,{purchaseOrderId:Ne.id,isOpen:Ct,onClose:()=>It(!1),onComplete:async()=>{It(!1),await(async()=>{if(Ne)try{await Zs(),"received"===Ne.status?b.success("Quality check completed successfully"):b.success("Quality check recorded")}catch(e){b.error("Failed to complete quality check")}})()}}),s.jsx(me,{qualityCheckId:Ot,isOpen:Pt,onClose:()=>{Dt(!1),Tt("")}}),qt&&s.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[s.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center",children:s.jsx(_,{className:"w-5 h-5 text-yellow-600"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Order Notes"})]}),s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Add New Note"}),s.jsx("textarea",{value:gs,onChange:e=>ys(e.target.value),placeholder:"Enter your note here...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500",rows:3}),s.jsx("button",{onClick:async()=>{if(gs.trim()&&Ne)try{const e=await ne.addNote(Ne.id,gs.trim(),(null==ge?void 0:ge.name)||"Unknown");e.success?(ps(t=>[e.data,...t]),ys(""),b.success(e.message)):b.error(e.message)}catch(e){b.error("Failed to add note")}},disabled:!gs.trim(),className:"w-full px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:"Add Note"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Previous Notes"}),hs.length>0?s.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:hs.map((e,t)=>s.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.author}),s.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleString()})]}),s.jsx("p",{className:"text-sm text-gray-700",children:e.content})]},e.id||t))}):s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(_,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),s.jsx("p",{children:"No notes available"})]})]}),s.jsx("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:s.jsx("button",{onClick:()=>Rt(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Close"})})]})]})}),bs&&s.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[s.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:s.jsx(H,{className:"w-5 h-5 text-indigo-600"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bulk Actions"})]}),s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Select items and choose an action to perform on multiple items at once."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Select Items"}),s.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:null==(he=Ne.items)?void 0:he.map((e,t)=>{var a,r;return s.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-gray-100 last:border-b-0",children:[s.jsx("input",{type:"checkbox",checked:vs.includes(e.id),onChange:()=>{return t=e.id,void js(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(a=e.product)?void 0:a.name)||`Product ${e.productId}`}),s.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",(null==(r=e.product)?void 0:r.sku)||`SKU-${e.productId}`," | Qty: ",e.quantity]})]})]},e.id||t)})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Available Actions"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{onClick:()=>Ws("update_status"),disabled:0===vs.length,className:"flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(L,{className:"w-4 h-4"}),"Update Status"]}),s.jsxs("button",{onClick:()=>Ws("assign_location"),disabled:0===vs.length,className:"flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(X,{className:"w-4 h-4"}),"Assign Location"]}),s.jsxs("button",{onClick:()=>Ws("export_selected"),disabled:0===vs.length,className:"flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium text-sm",children:[s.jsx(S,{className:"w-4 h-4"}),"Export Selected"]})]})]}),s.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:[s.jsx("button",{onClick:()=>{fs(!1),js([])},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>{var e;return js((null==(e=Ne.items)?void 0:e.map(e=>e.id))||[])},className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium",children:"Select All"})]})]})]})}),Ns&&s.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[s.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(z,{className:"w-5 h-5 text-red-600"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Return Order"})]}),s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Create a return order for items that need to be returned to the supplier."}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Return Type"}),s.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[s.jsx("option",{value:"defective",children:"Defective Items"}),s.jsx("option",{value:"wrong_item",children:"Wrong Items"}),s.jsx("option",{value:"excess",children:"Excess Quantity"}),s.jsx("option",{value:"damaged",children:"Damaged in Transit"}),s.jsx("option",{value:"other",children:"Other"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Items to Return"}),s.jsx("div",{className:"max-h-40 overflow-y-auto border border-gray-200 rounded-lg",children:null==(pe=Ne.items)?void 0:pe.map((e,t)=>{var a,r;return s.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-gray-100 last:border-b-0",children:[s.jsx("input",{type:"checkbox",className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(a=e.product)?void 0:a.name)||`Product ${e.productId}`}),s.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",(null==(r=e.product)?void 0:r.sku)||`SKU-${e.productId}`," | Received: ",e.receivedQuantity||0]})]}),s.jsx("div",{className:"w-20",children:s.jsx("input",{type:"number",placeholder:"Qty",min:"1",max:e.receivedQuantity||e.quantity,className:"w-full p-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-red-500 focus:border-red-500"})})]},e.id||t)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Return Reason"}),s.jsx("textarea",{placeholder:"Describe the reason for return...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:3})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),s.jsx("textarea",{placeholder:"Any additional information...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:2})]})]}),s.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:[s.jsx("button",{onClick:()=>ws(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>(async e=>{var t;if(Ne)try{const s=await ne.createReturnOrder(Ne.id,e);s.success?(b.success(s.message),ws(!1),await Zs(),await ne.logAction(Ne.id,"return_order_created",{return_id:null==(t=s.data)?void 0:t.id})):b.error(s.message)}catch(s){b.error("Failed to create return order")}})({}),className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-medium",children:"Create Return Order"})]})]})]})}),Et&&s.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4 p-6 border-b border-gray-100",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:s.jsx(U,{className:"w-5 h-5 text-green-600"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment History"})]}),s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"space-y-4 mb-6",children:as.length>0?as.map((e,t)=>{var a,r,l;return s.jsx("div",{children:"multiple"===(null==(r=null==(a=e.metadata)?void 0:a.paymentMethod)?void 0:r.type)&&(null==(l=e.metadata.paymentMethod.details)?void 0:l.payments)?s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border border-blue-200 p-6",children:[s.jsxs("h4",{className:"text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2",children:[s.jsx(U,{className:"w-5 h-5"}),"Payment #",t+1," - Multiple Methods"]}),s.jsxs("div",{className:"space-y-4",children:[e.metadata.paymentMethod.details.payments.map((t,a)=>s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200 shadow-sm",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(U,{className:"w-4 h-4 text-blue-600"})}),s.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:t.method?t.method.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown Method"})]}),s.jsxs("div",{className:"space-y-1",children:[t.reference&&s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Reference:"})," ",t.reference]}),t.transactionId&&s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Transaction ID:"})," ",t.transactionId]}),t.timestamp&&s.jsxs("p",{className:"text-sm text-gray-500",children:[s.jsx("span",{className:"font-medium",children:"Time:"})," ",new Date(t.timestamp).toLocaleString("en-TZ")]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xl font-bold text-green-600 mb-2",children:sa(t.amount,t.currency||e.currency)}),t.status&&s.jsx("span",{className:"inline-flex px-3 py-1 text-xs font-semibold rounded-full "+("completed"===t.status||"success"===t.status?"bg-green-100 text-green-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"failed"===t.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:t.status.toUpperCase()})]})]}),t.notes&&s.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:s.jsxs("p",{className:"text-sm text-gray-600 italic",children:[s.jsx("span",{className:"font-medium",children:"Note:"})," ",t.notes]})})]},a)),s.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[s.jsxs("h5",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[s.jsx(R,{className:"w-4 h-4 text-green-600"}),"Payment Summary"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Total Payments"}),s.jsx("div",{className:"text-lg font-semibold text-blue-900",children:e.metadata.paymentMethod.details.payments.length})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Payment Methods"}),s.jsx("div",{className:"text-lg font-semibold text-blue-900",children:new Set(e.metadata.paymentMethod.details.payments.map(e=>e.method)).size})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Total Amount"}),s.jsx("div",{className:"text-xl font-bold text-green-600",children:sa(e.metadata.paymentMethod.details.payments.reduce((e,t)=>e+t.amount,0),e.currency)})]})]})]})]})]}):s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200 shadow-sm",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(U,{className:"w-4 h-4 text-blue-600"})}),s.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:e.method?e.method.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown Method"})]}),s.jsxs("div",{className:"space-y-1",children:[e.reference&&s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Reference:"})," ",e.reference]}),e.timestamp&&s.jsxs("p",{className:"text-sm text-gray-500",children:[s.jsx("span",{className:"font-medium",children:"Time:"})," ",new Date(e.timestamp).toLocaleString("en-TZ")]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xl font-bold text-green-600 mb-2",children:sa(e.amount,e.currency)}),s.jsx("span",{className:"inline-flex px-3 py-1 text-xs font-semibold rounded-full "+("completed"===e.status||"success"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"failed"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.status.toUpperCase()})]})]}),e.notes&&s.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:s.jsxs("p",{className:"text-sm text-gray-600 italic",children:[s.jsx("span",{className:"font-medium",children:"Note:"})," ",e.notes]})})]})},e.id||t)}):s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(U,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Payment History"}),s.jsx("p",{className:"text-sm",children:"No payments have been made for this purchase order yet."})]})}),s.jsx("div",{className:"flex gap-3 mt-6 border-t border-gray-200 pt-4",children:s.jsx("button",{onClick:()=>Ft(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Close"})})]})]})}),at&&Ne&&s.jsx(le,{isOpen:at,onClose:()=>rt(!1),purchaseOrder:Ne,onConfirm:async e=>{Ne&&ge&&(vt(e),kt({serialNumberData:e}),rt(!1),b.success("Serial numbers saved! Now set pricing..."),setTimeout(()=>{nt(!0)},300))},isLoading:Ie,mode:pt,initialReceivedItems:ft.length>0?ft:void 0}),lt&&Ne&&s.jsx(ae,{isOpen:lt,onClose:()=>nt(!1),purchaseOrder:Ne,onConfirm:async e=>{if(!Ne||!ge)return;Nt(e),kt({pricingData:e}),nt(!1);const s=ft.reduce((e,t)=>e+(t.receivedQuantity||0),0),a=ft.filter(e=>e.receivedQuantity>0).length;Gt("confirming"),Vt(!0),Yt({title:"Ready to Add to Inventory",message:`You're about to add ${s} items (${a} products) to inventory${ft.some(e=>{var t;return(null==(t=e.serialNumbers)?void 0:t.length)>0})?" with serial numbers":""}.`,onConfirm:async()=>{var s,a,r;try{Ae(!0),Gt("processing");let i=0;for(const[a,r]of e.entries()){const e=Ne.items.find(e=>e.id===a);if(e&&e.variantId)try{const{error:a}=await t.from("lats_product_variants").update({selling_price:r.selling_price,cost_price:r.cost_price,updated_at:(new Date).toISOString()}).eq("id",e.variantId);a?b.error(`Failed to update price for ${(null==(s=e.product)?void 0:s.name)||"item"}`):i++}catch(l){b.error("Error updating variant prices")}}if(ft.length>0){(await n.updateReceivedQuantities(Ne.id,ft,ge.id)).success&&b.success("Serial numbers saved!")}await new Promise(e=>setTimeout(e,500));const c=new Map;ft.forEach(e=>{c.set(e.id,e.receivedQuantity)});let d=!0,o=0,m=0,u=0;for(const e of Ne.items){const t=e.quantity,s=e.receivedQuantity||0,a=c.get(e.id)||0;o+=t,m+=a,u+=s,s+a<t&&(d=!1)}const x="partial"===pt&&!d,h=await n.completeReceive(Ne.id,ge.id,x?`Partial receive: ${m} of ${o} items`:"Complete receive of purchase order with pricing and serial numbers");if(h.success){try{const{data:s,error:a}=await t.from("inventory_items").select("id, variant_id").eq("purchase_order_id",Ne.id);if(!a&&s)for(const r of s){const s=Ne.items.find(e=>e.variantId===r.variant_id);if(s){const a=e.get(s.id);a&&await t.from("inventory_items").update({selling_price:a.selling_price,cost_price:a.cost_price,status:"available",updated_at:(new Date).toISOString()}).eq("id",r.id)}}}catch(l){}null==(a=h.data)||a.new_status;if((null==(r=h.data)?void 0:r.is_complete)||d)b.success("🎉 All items received! Purchase order complete!",{duration:6e3});else{const e=o-(u+m);b.success(`✅ Items added to inventory! ${e} items remaining to receive.`,{duration:5e3})}if(h.summary){const e=h.summary;b.success(`Received: ${e.total_received||0}/${e.total_ordered||0} items (${e.percent_received||0}% complete)`,{duration:5e3})}vt([]),Nt(new Map),be&&(localStorage.removeItem(St("mode")),localStorage.removeItem(St("serials")),localStorage.removeItem(St("pricing"))),await Zs(),"received"===tt&&await Hs(),await Vs("received",!0),Gt("success"),setTimeout(()=>{Vt(!1),Yt(null),Gt("confirming")},2e3)}else b.error(`Receive failed: ${h.message||"Unknown error"}`),h.message&&h.message.includes("status")&&b.error(`Current status: ${Ne.status}. Try changing status to 'shipped' first.`,{duration:6e3}),Gt("confirming"),Vt(!1)}catch(l){b.error(`Failed to receive purchase order: ${l instanceof Error?l.message:"Unknown error"}`),Gt("confirming"),Vt(!1)}finally{Ae(!1)}}}),Gt("confirming"),Vt(!0)},isLoading:Te,initialPricingData:jt.size>0?jt:void 0}),Ts&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(L,{className:"w-5 h-5 text-blue-600"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Status"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Status"}),s.jsxs("select",{value:(null==Rs?void 0:Rs.status)||"",onChange:e=>Es(t=>t?{...t,status:e.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"available",children:"Available"}),s.jsx("option",{value:"sold",children:"Sold"}),s.jsx("option",{value:"reserved",children:"Reserved"}),s.jsx("option",{value:"damaged",children:"Damaged"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason (Optional)"}),s.jsx("textarea",{placeholder:"Enter reason for status change...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>As(!1),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>{Rs&&Ds.length>0?(b.success(`Updated ${Ds.length} items to ${Rs.status}`),Os([]),As(!1)):Rs&&(b.success(`Updated item status to ${Rs.status}`),As(!1))},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Update Status"})]})]})}),$s&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(p,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Assign Location"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location *"}),s.jsx("input",{type:"text",placeholder:"e.g., Warehouse A, Store Front",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Shelf"}),s.jsx("input",{type:"text",placeholder:"e.g., A1, B2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bin"}),s.jsx("input",{type:"text",placeholder:"e.g., 01, 15",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),s.jsx("textarea",{placeholder:"Additional location notes...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>qs(!1),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>{Ds.length>0?(b.success(`Assigned location to ${Ds.length} items`),Os([]),qs(!1)):(b.success("Location assigned successfully"),qs(!1))},className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:"Assign Location"})]})]})}),Bt&&Ht&&s.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl overflow-hidden relative",children:["confirming"===Xt&&s.jsx("button",{onClick:()=>{Vt(!1),Yt(null),Gt("confirming")},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:s.jsx(x,{className:"w-5 h-5"})}),s.jsxs("div",{className:"p-8 text-center transition-all duration-500 "+("success"===Xt?"bg-gradient-to-br from-green-100 to-emerald-100":"bg-gradient-to-br from-green-50 to-emerald-50"),children:[s.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg transition-all duration-500 "+("success"===Xt?"bg-green-500 scale-110":"processing"===Xt?"bg-blue-500":"bg-green-600"),children:"success"===Xt?s.jsx(v,{className:"w-10 h-10 text-white"}):"processing"===Xt?s.jsx("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"}):s.jsx(h,{className:"w-8 h-8 text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"success"===Xt?"Successfully Added!":"processing"===Xt?"Adding to Inventory...":"Add to Inventory?"})]}),s.jsx("div",{className:"p-6",children:s.jsx("p",{className:"text-center text-gray-600 leading-relaxed",children:"success"===Xt?"Items have been successfully added to inventory.":"processing"===Xt?"Please wait while we add items to inventory...":Ht.message})}),"confirming"===Xt&&s.jsx("div",{className:"p-6 pt-0",children:s.jsx("button",{onClick:()=>{Ht.onConfirm()},className:"w-full px-6 py-3.5 bg-green-600 hover:bg-green-700 text-white rounded-xl transition-all font-semibold shadow-lg hover:shadow-xl text-lg",children:"Confirm & Add"})}),"success"===Xt&&s.jsx("div",{className:"p-6 pt-0",children:s.jsx("button",{onClick:()=>{Vt(!1),Yt(null),Gt("confirming")},className:"w-full px-6 py-3 text-gray-600 hover:text-gray-900 font-medium transition-colors",children:"Close"})})]})}),Kt&&s.jsx("div",{className:"fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(w,{className:"w-4 h-4"}),s.jsx("span",{children:Kt}),s.jsx("button",{onClick:()=>Wt(null),className:"ml-2 text-red-700 hover:text-red-900",children:s.jsx(x,{className:"w-4 h-4"})})]})}),Lt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:s.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(h,{className:"w-6 h-6 text-blue-600"}),s.jsx("h2",{className:"text-xl font-semibold",children:"Add to Inventory"})]}),s.jsx("button",{onClick:()=>Mt(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:s.jsx(x,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"w-5 h-5 text-blue-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-blue-800",children:"Quality Check Passed!"}),s.jsx("p",{className:"text-sm text-blue-600",children:"Set selling prices and add items to inventory"})]})]})}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[s.jsx(j,{className:"w-4 h-4"}),"Profit Margin (%)"]}),s.jsx("input",{type:"number",value:Qt,onChange:e=>Ut(parseFloat(e.target.value)),className:"w-full px-3 py-2 border rounded-lg",placeholder:"30",min:"0",max:"100",step:"5"}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Selling price will be calculated as: Cost Price × (1 + ",Qt,"%)"]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[s.jsx(p,{className:"w-4 h-4"}),"Default Location (Optional)"]}),s.jsx("input",{type:"text",value:zt,onChange:e=>Zt(e.target.value),className:"w-full px-3 py-2 border rounded-lg",placeholder:"e.g., Warehouse A, Shelf 3"})]}),s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium mb-3",children:"Preview"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Items to add:"}),s.jsx("span",{className:"font-medium",children:is.filter(e=>"pass"===e.result).length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Profit margin:"}),s.jsxs("span",{className:"font-medium",children:[Qt,"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Location:"}),s.jsx("span",{className:"font-medium",children:zt||"Not specified"})]})]})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>Mt(!1),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),s.jsxs("button",{onClick:async()=>{if(!Ne||!ge)return;if(0===is.length)return void b.error("No quality check found");const e=is[0].qualityCheckId;Pe(!0);try{const{data:s,error:a}=await t.rpc("add_quality_items_to_inventory_v2",{p_quality_check_id:e,p_purchase_order_id:Ne.id,p_user_id:ge.id,p_profit_margin_percentage:Qt,p_default_location:zt||null});if(a)throw a;const r=s;if(r&&r.success){b.success(r.message||`Successfully added ${r.items_added} items to inventory`),Mt(!1),await Zs();const e=await n.getReceivedItems(Ne.id);e.success&&ms(e.data||[]),st("received"),b.success('Items are now in inventory! Check the "Received" tab.')}else b.error((null==r?void 0:r.message)||"Failed to add items to inventory")}catch(s){b.error(`Error adding items to inventory: ${s instanceof Error?s.message:"Unknown error"}`)}finally{Pe(!1)}},disabled:Ie,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[s.jsx(h,{className:"w-4 h-4"}),Ie?"Adding...":"Add to Inventory"]})]})]})}),dt&&Ne&&s.jsx(ie,{isOpen:dt,onClose:()=>ot(!1),purchaseOrder:Ne,onReceiveFull:async()=>{gt("full"),kt({receiveMode:"full"}),ot(!1),setTimeout(()=>rt(!0),150)},onReceivePartial:async()=>{gt("partial"),kt({receiveMode:"partial"}),ot(!1),b("Select quantities to receive for each item",{icon:"ℹ️"}),setTimeout(()=>rt(!0),150)}})]})]}):s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[s.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),s.jsx("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx(w,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Purchase Order Not Found"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"The purchase order you're looking for doesn't exist."}),s.jsx(c,{onClick:()=>ye("/lats/purchase-orders"),children:"Back to Purchase Orders"})]})})]});var na};export{ue as default};
