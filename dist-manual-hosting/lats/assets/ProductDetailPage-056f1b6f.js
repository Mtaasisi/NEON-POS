import{j as e}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import{c as t,M as a}from"./customerPortalService-ebbdd244.js";import{z as r,V as i,b8 as l,bO as c,p as n,d as o,O as d,Q as m,Y as x,a4 as u}from"./ui-551a39a6.js";import{d as h,a as f}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";const g=()=>{var g,b;const{id:j}=h(),v=f(),[p,N]=s.useState(null),[y,w]=s.useState(!0),[S,k]=s.useState(null),[z,C]=s.useState(1),[O,I]=s.useState(0),[B,P]=s.useState(!1),[L,Q]=s.useState(!1);s.useEffect(()=>{j&&(J(),T())},[j]);const J=async()=>{try{w(!0);const e=await t.getProductById(j);if(!e)return r.error("Product not found"),void w(!1);if(N(e),e.variants&&e.variants.length>0){const s=e.variants.find(e=>e.inStock);s&&k(s.id)}}catch(e){r.error("Failed to load product details")}finally{w(!1)}},T=()=>{const e=localStorage.getItem("customer_favorites");if(e){const s=JSON.parse(e);P(s.includes(j))}};if(y)return e.jsx(a,{title:"Loading...",showBackButton:!0,children:e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})});if(!p)return e.jsx(a,{title:"Product Not Found",showBackButton:!0,children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Product not found"}),e.jsx("button",{onClick:()=>v("/customer-portal/products"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Back to Products"})]})});const _=null==(g=p.variants)?void 0:g.find(e=>e.id===S),A=(null==_?void 0:_.price)||p.price,F=null==_?void 0:_.compareAtPrice,M=F&&F>A,q=(null==(b=p.images)?void 0:b.length)>0?p.images:[p.imageUrl].filter(Boolean);return e.jsxs(a,{title:p.name,showBackButton:!0,showBottomNav:!1,children:[e.jsxs("div",{className:"bg-white",children:[e.jsxs("div",{className:"relative aspect-square bg-gray-100",children:[q[O]?e.jsx("img",{src:q[O],alt:p.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(i,{size:64,className:"text-gray-300"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx("button",{onClick:async()=>{if(navigator.share&&p)try{await navigator.share({title:p.name,text:`Check out ${p.name} at our store!`,url:window.location.href})}catch(e){}else navigator.clipboard.writeText(window.location.href),r.success("Link copied to clipboard")},className:"bg-white rounded-full p-3 shadow-lg active:scale-90 transition-transform",children:e.jsx(l,{size:20,className:"text-gray-700"})}),e.jsx("button",{onClick:()=>{const e=localStorage.getItem("customer_favorites"),s=e?JSON.parse(e):[],t=B?s.filter(e=>e!==j):[...s,j];localStorage.setItem("customer_favorites",JSON.stringify(t)),P(!B),r.success(B?"Removed from favorites":"Added to favorites")},className:"bg-white rounded-full p-3 shadow-lg active:scale-90 transition-transform",children:e.jsx(c,{size:20,className:B?"fill-red-500 text-red-500":"text-gray-700"})})]})]}),q.length>1&&e.jsx("div",{className:"flex gap-2 p-4 overflow-x-auto",children:q.map((s,t)=>e.jsx("button",{onClick:()=>I(t),className:"flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 "+(O===t?"border-blue-600":"border-gray-200"),children:e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover"})},t))})]}),e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.brand&&e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:p.brand}),p.category&&e.jsxs("span",{className:"text-sm text-gray-500",children:["â€¢ ",p.category]})]}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:p.name}),void 0!==p.rating&&e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(n,{size:16,className:"fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:p.rating.toFixed(1)})]}),p.reviewCount&&e.jsxs("span",{className:"text-sm text-gray-500",children:["(",p.reviewCount," reviews)"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["Tsh ",A.toLocaleString()]}),M&&e.jsxs("span",{className:"text-lg text-gray-500 line-through",children:["Tsh ",null==F?void 0:F.toLocaleString()]})]}),M&&e.jsxs("span",{className:"inline-block mt-1 px-2 py-1 bg-red-100 text-red-600 text-xs font-bold rounded",children:["Save ",Math.round((F-A)/F*100),"%"]})]}),e.jsx("div",{className:"mb-4",children:p.inStock?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(o,{size:18}),e.jsx("span",{className:"font-medium",children:"In Stock"}),p.stockQuantity&&p.stockQuantity<10&&e.jsxs("span",{className:"text-orange-600 ml-2",children:["(Only ",p.stockQuantity," left!)"]})]}):e.jsx("div",{className:"text-red-600 font-medium",children:"Out of Stock"})}),p.variants&&p.variants.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Select Variant"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.variants.map(s=>e.jsxs("button",{onClick:()=>k(s.id),disabled:!s.inStock,className:"p-3 rounded-lg border-2 text-left transition-all "+(S===s.id?"border-blue-600 bg-blue-50":s.inStock?"border-gray-200 hover:border-gray-300":"border-gray-200 bg-gray-50 opacity-50 cursor-not-allowed"),children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm font-bold text-gray-900 mt-1",children:["Tsh ",s.price.toLocaleString()]}),!s.inStock&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Out of stock"})]},s.id))})]}),p.inStock&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>C(Math.max(1,z-1)),className:"w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center active:scale-90 transition-transform",children:e.jsx(d,{size:18})}),e.jsx("span",{className:"text-xl font-semibold w-12 text-center",children:z}),e.jsx("button",{onClick:()=>C(z+1),className:"w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center active:scale-90 transition-transform",children:e.jsx(m,{size:18})})]})]})]}),p.description&&e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-700 "+(L?"":"line-clamp-3"),children:p.description}),p.description.length>150&&e.jsx("button",{onClick:()=>Q(!L),className:"text-blue-600 font-medium mt-2 text-sm",children:L?"Show Less":"Show More"})]}),p.specifications&&Object.keys(p.specifications).length>0&&e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"Specifications"}),e.jsx("div",{className:"space-y-2",children:Object.entries(p.specifications).map(([s,t])=>e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:s}),e.jsx("span",{className:"text-gray-900",children:t})]},s))})]}),e.jsx("div",{className:"bg-white mt-2 p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-2",children:e.jsx(x,{size:24,className:"text-blue-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:"Free Delivery"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-2",children:e.jsx(u,{size:24,className:"text-blue-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:"Warranty"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-2",children:e.jsx(o,{size:24,className:"text-blue-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:"Quality"})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50",children:e.jsxs("button",{onClick:()=>{var e;if(!p)return;if(!S&&p.variants&&p.variants.length>0)return void r.error("Please select a variant");const s=null==(e=p.variants)?void 0:e.find(e=>e.id===S);if(s&&!s.inStock)return void r.error("This variant is out of stock");const t=localStorage.getItem("customer_cart"),a=t?JSON.parse(t):[],i={productId:p.id,productName:p.name,variantId:S,variantName:null==s?void 0:s.name,quantity:z,price:(null==s?void 0:s.price)||p.price,imageUrl:p.imageUrl},l=a.findIndex(e=>e.productId===p.id&&e.variantId===S);l>=0?a[l].quantity+=z:a.push(i),localStorage.setItem("customer_cart",JSON.stringify(a)),r.success("Added to cart")},disabled:!p.inStock,className:"w-full py-4 rounded-lg font-bold text-white flex items-center justify-center gap-2 transition-all "+(p.inStock?"bg-blue-600 hover:bg-blue-700 active:scale-95":"bg-gray-400 cursor-not-allowed"),children:[e.jsx(i,{size:20}),p.inStock?"Add to Cart":"Out of Stock"]})}),e.jsx("div",{className:"h-24"})]})};export{g as default};
