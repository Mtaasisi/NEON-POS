import{j as e,s as t}from"./index-222cfb29.js";import{f as s,X as r,bc as a,m as i,t as n,x as c,ah as l,aA as o,aq as d,aG as u,ax as m,a1 as h,u as x,D as p,g,a5 as y,e as b,y as f,Z as j,bC as N}from"./ui-551a39a6.js";import{r as v}from"./vendor-a2ff445a.js";import{m as A}from"./phoneUtils-1ba19aca.js";import{a as w}from"./routing-a2f0f6d2.js";const _=({recentSearches:t,onSearch:g,onRemoveSearch:y,userRole:b})=>{const f=(()=>{const t=[];return t.push({label:"Active Devices",icon:e.jsx(i,{size:20}),query:"status:active",color:"blue"},{label:"New Customers",icon:e.jsx(n,{size:20}),query:"isRead:false",color:"green"},{label:"Overdue Devices",icon:e.jsx(s,{size:20}),query:"overdue:true",color:"red"}),"admin"!==b&&"customer-care"!==b||t.push({label:"All Products",icon:e.jsx(c,{size:20}),query:"type:product",color:"purple"},{label:"Recent Sales",icon:e.jsx(l,{size:20}),query:"type:sale",color:"amber"}),"admin"===b&&t.push({label:"Payment Reports",icon:e.jsx(o,{size:20}),query:"type:payment",color:"emerald"},{label:"Loyalty Members",icon:e.jsx(d,{size:20}),query:"type:loyalty",color:"yellow"},{label:"Inventory Alerts",icon:e.jsx(u,{size:20}),query:"low:stock",color:"orange"},{label:"Sales Reports",icon:e.jsx(m,{size:20}),query:"type:report",color:"indigo"}),"customer-care"===b&&t.push({label:"Customer Issues",icon:e.jsx(h,{size:20}),query:"status:issue",color:"pink"},{label:"Appointments",icon:e.jsx(x,{size:20}),query:"type:appointment",color:"cyan"}),t})(),j=(()=>{const t=[{title:"Devices",icon:e.jsx(i,{size:24}),color:"blue",items:[{label:"By Status",query:"status:"},{label:"By Model",query:"model:"},{label:"By Customer",query:"customer:"}]},{title:"Customers",icon:e.jsx(n,{size:24}),color:"green",items:[{label:"By Name",query:"name:"},{label:"By Phone",query:"phone:"},{label:"By Email",query:"email:"},{label:"By Location",query:"location:"}]}];return"admin"!==b&&"customer-care"!==b||t.push({title:"Products",icon:e.jsx(c,{size:24}),color:"purple",items:[{label:"By Name",query:"product:"},{label:"By Category",query:"category:"},{label:"By Price",query:"price:"}]}),"admin"===b&&t.push({title:"Sales & Finance",icon:e.jsx(p,{size:24}),color:"emerald",items:[{label:"By Date",query:"date:"},{label:"By Amount",query:"amount:"},{label:"By Payment Method",query:"payment:"},{label:"By Customer",query:"customer:"}]}),t})();return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-gray-900 via-blue-900 to-purple-900 bg-clip-text text-transparent mb-3",children:"Global Search"}),e.jsx("p",{className:"text-gray-600/90 max-w-2xl mx-auto text-lg",children:"Search devices, customers, products, and more"})]}),t.length>0&&e.jsxs("div",{className:"bg-white/50 backdrop-blur-xl rounded-2xl p-6 border border-white/30 shadow-[0_8px_32px_0_rgba(31,38,135,0.07)]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(s,{size:20,className:"text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Recent Searches"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2.5 bg-white/60 backdrop-blur-lg rounded-full border border-white/40 hover:bg-white/80 hover:shadow-[0_4px_16px_0_rgba(59,130,246,0.1)] transition-all duration-300 cursor-pointer group",onClick:()=>g(t),children:[e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:t}),e.jsx("button",{onClick:e=>{e.stopPropagation(),y(t)},className:"p-1 rounded-full bg-gray-100/60 hover:bg-gray-200/80 backdrop-blur-sm transition-all duration-200 opacity-0 group-hover:opacity-100",children:e.jsx(r,{size:12,className:"text-gray-500"})})]},s))})]}),e.jsxs("div",{className:"bg-white/50 backdrop-blur-xl rounded-2xl p-6 border border-white/30 shadow-[0_8px_32px_0_rgba(31,38,135,0.07)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-5",children:"Quick Access"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:f.map((t,s)=>e.jsxs("button",{onClick:()=>g(t.query),className:"flex items-center gap-3 p-4 rounded-xl bg-white/60 backdrop-blur-lg border border-white/40 hover:bg-white/80 hover:shadow-[0_4px_20px_0_rgba(59,130,246,0.12)] hover:scale-[1.02] transition-all duration-300 text-left group",children:[e.jsx("div",{className:`p-2.5 rounded-xl bg-gradient-to-br from-${t.color}-50 to-${t.color}-100 text-${t.color}-600 group-hover:from-${t.color}-100 group-hover:to-${t.color}-200 shadow-sm transition-all duration-300`,children:t.icon}),e.jsx("span",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900 transition-colors",children:t.label})]},s))})]}),e.jsxs("div",{className:"bg-white/50 backdrop-blur-xl rounded-2xl p-6 border border-white/30 shadow-[0_8px_32px_0_rgba(31,38,135,0.07)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-5",children:"Search Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map((t,s)=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2.5 rounded-xl bg-gradient-to-br from-${t.color}-50 to-${t.color}-100 text-${t.color}-600 shadow-sm`,children:t.icon}),e.jsx("h3",{className:"font-semibold text-gray-800",children:t.title})]}),e.jsx("div",{className:"space-y-2",children:t.items.map((t,s)=>e.jsxs("button",{onClick:()=>g(t.query),className:"flex items-center gap-2 w-full p-2.5 rounded-xl hover:bg-white/70 backdrop-blur-sm transition-all duration-200 text-left group",children:[e.jsx("span",{className:"text-sm text-gray-600 group-hover:text-gray-800 transition-colors",children:t.label}),e.jsx(a,{size:14,className:"text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity ml-auto"})]},s))})]},s))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50/60 via-purple-50/40 to-pink-50/60 backdrop-blur-xl rounded-2xl p-6 border border-white/40 shadow-[0_8px_32px_0_rgba(31,38,135,0.07)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-5",children:"Search Tips"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-700 bg-white/40 backdrop-blur-sm rounded-xl p-3 border border-white/30",children:[e.jsx("strong",{className:"text-gray-900",children:"Use filters:"}),' Type "status:active" to find active devices']}),e.jsxs("p",{className:"text-sm text-gray-700 bg-white/40 backdrop-blur-sm rounded-xl p-3 border border-white/30",children:[e.jsx("strong",{className:"text-gray-900",children:"Search by date:"}),' Type "date:2024-01" to find items from January 2024']}),e.jsxs("p",{className:"text-sm text-gray-700 bg-white/40 backdrop-blur-sm rounded-xl p-3 border border-white/30",children:[e.jsx("strong",{className:"text-gray-900",children:"Combine terms:"}),' Type "iphone status:active" to find active iPhones']})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-700 bg-white/40 backdrop-blur-sm rounded-xl p-3 border border-white/30",children:[e.jsx("strong",{className:"text-gray-900",children:"Exact match:"}),' Use quotes for exact phrases: "John Doe"']}),e.jsxs("p",{className:"text-sm text-gray-700 bg-white/40 backdrop-blur-sm rounded-xl p-3 border border-white/30",children:[e.jsx("strong",{className:"text-gray-900",children:"Price range:"}),' Type "price:1000-5000" to find items in price range']}),e.jsxs("p",{className:"text-sm text-gray-700 bg-white/40 backdrop-blur-sm rounded-xl p-3 border border-white/30",children:[e.jsx("strong",{className:"text-gray-900",children:"Location search:"}),' Type "location:Nairobi" to find items by location']})]})]})]})]})};function C(e){return Array.isArray?Array.isArray(e):"[object Array]"===L(e)}function k(e){return"string"==typeof e}function D(e){return"number"==typeof e}function S(e){return!0===e||!1===e||function(e){return M(e)&&null!==e}(e)&&"[object Boolean]"==L(e)}function M(e){return"object"==typeof e}function F(e){return null!=e}function E(e){return!e.trim().length}function L(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const B=Object.prototype.hasOwnProperty;class ${constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(e=>{let s=z(e);this._keys.push(s),this._keyMap[s.id]=s,t+=s.weight}),this._keys.forEach(e=>{e.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function z(e){let t=null,s=null,r=null,a=1,i=null;if(k(e)||C(e))r=e,t=R(e),s=I(e);else{if(!B.call(e,"name"))throw new Error((e=>`Missing ${e} property in key`)("name"));const n=e.name;if(r=n,B.call(e,"weight")&&(a=e.weight,a<=0))throw new Error((e=>`Property 'weight' in key '${e}' must be a positive integer`)(n));t=R(n),s=I(n),i=e.getFn}return{path:t,id:s,weight:a,src:r,getFn:i}}function R(e){return C(e)?e:e.split(".")}function I(e){return C(e)?e.join("."):e}var q={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1,includeMatches:!1,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.6,distance:100,...{useExtendedSearch:!1,getFn:function(e,t){let s=[],r=!1;const a=(e,t,i)=>{if(F(e))if(t[i]){const n=e[t[i]];if(!F(n))return;if(i===t.length-1&&(k(n)||D(n)||S(n)))s.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;let t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(n));else if(C(n)){r=!0;for(let e=0,s=n.length;e<s;e+=1)a(n[e],t,i+1)}else t.length&&a(n,t,i+1)}else s.push(e)};return a(e,k(t)?t.split("."):t,0),r?s:s[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1}};const P=/[^ ]+/g;class T{constructor({getFn:e=q.getFn,fieldNormWeight:t=q.fieldNormWeight}={}){this.norm=function(e=1,t=3){const s=new Map,r=Math.pow(10,t);return{get(t){const a=t.match(P).length;if(s.has(a))return s.get(a);const i=1/Math.pow(a,.5*e),n=parseFloat(Math.round(i*r)/r);return s.set(a,n),n},clear(){s.clear()}}}(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((e,t)=>{this._keysMap[e.id]=t})}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,k(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();k(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!F(e)||E(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((t,r)=>{let a=t.getFn?t.getFn(e):this.getFn(e,t.path);if(F(a))if(C(a)){let e=[];const t=[{nestedArrIndex:-1,value:a}];for(;t.length;){const{nestedArrIndex:s,value:r}=t.pop();if(F(r))if(k(r)&&!E(r)){let t={v:r,i:s,n:this.norm.get(r)};e.push(t)}else C(r)&&r.forEach((e,s)=>{t.push({nestedArrIndex:s,value:e})})}s.$[r]=e}else if(k(a)&&!E(a)){let e={v:a,n:this.norm.get(a)};s.$[r]=e}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function O(e,t,{getFn:s=q.getFn,fieldNormWeight:r=q.fieldNormWeight}={}){const a=new T({getFn:s,fieldNormWeight:r});return a.setKeys(e.map(z)),a.setSources(t),a.create(),a}function W(e,{errors:t=0,currentLocation:s=0,expectedLocation:r=0,distance:a=q.distance,ignoreLocation:i=q.ignoreLocation}={}){const n=t/e.length;if(i)return n;const c=Math.abs(r-s);return a?n+c/a:c?1:n}const Q=32;function Z(e,t,s,{location:r=q.location,distance:a=q.distance,threshold:i=q.threshold,findAllMatches:n=q.findAllMatches,minMatchCharLength:c=q.minMatchCharLength,includeMatches:l=q.includeMatches,ignoreLocation:o=q.ignoreLocation}={}){if(t.length>Q)throw new Error(`Pattern length exceeds max of ${Q}.`);const d=t.length,u=e.length,m=Math.max(0,Math.min(r,u));let h=i,x=m;const p=c>1||l,g=p?Array(u):[];let y;for(;(y=e.indexOf(t,x))>-1;){let e=W(t,{currentLocation:y,expectedLocation:m,distance:a,ignoreLocation:o});if(h=Math.min(e,h),x=y+d,p){let e=0;for(;e<d;)g[y+e]=1,e+=1}}x=-1;let b=[],f=1,j=d+u;const N=1<<d-1;for(let A=0;A<d;A+=1){let r=0,i=j;for(;r<i;){W(t,{errors:A,currentLocation:m+i,expectedLocation:m,distance:a,ignoreLocation:o})<=h?r=i:j=i,i=Math.floor((j-r)/2+r)}j=i;let c=Math.max(1,m-i+1),l=n?u:Math.min(m+i,u)+d,y=Array(l+2);y[l+1]=(1<<A)-1;for(let n=l;n>=c;n-=1){let r=n-1,i=s[e.charAt(r)];if(p&&(g[r]=+!!i),y[n]=(y[n+1]<<1|1)&i,A&&(y[n]|=(b[n+1]|b[n])<<1|1|b[n+1]),y[n]&N&&(f=W(t,{errors:A,currentLocation:r,expectedLocation:m,distance:a,ignoreLocation:o}),f<=h)){if(h=f,x=r,x<=m)break;c=Math.max(1,2*m-x)}}if(W(t,{errors:A+1,currentLocation:m,expectedLocation:m,distance:a,ignoreLocation:o})>h)break;b=y}const v={isMatch:x>=0,score:Math.max(.001,f)};if(p){const e=function(e=[],t=q.minMatchCharLength){let s=[],r=-1,a=-1,i=0;for(let n=e.length;i<n;i+=1){let n=e[i];n&&-1===r?r=i:n||-1===r||(a=i-1,a-r+1>=t&&s.push([r,a]),r=-1)}return e[i-1]&&i-r>=t&&s.push([r,i-1]),s}(g,c);e.length?l&&(v.indices=e):v.isMatch=!1}return v}function V(e){let t={};for(let s=0,r=e.length;s<r;s+=1){const a=e.charAt(s);t[a]=(t[a]||0)|1<<r-s-1}return t}const J=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class K{constructor(e,{location:t=q.location,threshold:s=q.threshold,distance:r=q.distance,includeMatches:a=q.includeMatches,findAllMatches:i=q.findAllMatches,minMatchCharLength:n=q.minMatchCharLength,isCaseSensitive:c=q.isCaseSensitive,ignoreDiacritics:l=q.ignoreDiacritics,ignoreLocation:o=q.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:r,includeMatches:a,findAllMatches:i,minMatchCharLength:n,isCaseSensitive:c,ignoreDiacritics:l,ignoreLocation:o},e=c?e:e.toLowerCase(),e=l?J(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const d=(e,t)=>{this.chunks.push({pattern:e,alphabet:V(e),startIndex:t})},u=this.pattern.length;if(u>Q){let e=0;const t=u%Q,s=u-t;for(;e<s;)d(this.pattern.substr(e,Q),e),e+=Q;if(t){const e=u-Q;d(this.pattern.substr(e),e)}}else d(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=s?J(e):e,this.pattern===e){let t={isMatch:!0,score:0};return r&&(t.indices=[[0,e.length-1]]),t}const{location:a,distance:i,threshold:n,findAllMatches:c,minMatchCharLength:l,ignoreLocation:o}=this.options;let d=[],u=0,m=!1;this.chunks.forEach(({pattern:t,alphabet:s,startIndex:h})=>{const{isMatch:x,score:p,indices:g}=Z(e,t,s,{location:a+h,distance:i,threshold:n,findAllMatches:c,minMatchCharLength:l,includeMatches:r,ignoreLocation:o});x&&(m=!0),u+=p,x&&g&&(d=[...d,...g])});let h={isMatch:m,score:m?u/this.chunks.length:1};return m&&r&&(h.indices=d),h}}class U{constructor(e){this.pattern=e}static isMultiMatch(e){return H(e,this.multiRegex)}static isSingleMatch(e){return H(e,this.singleRegex)}search(){}}function H(e,t){const s=e.match(t);return s?s[1]:null}class G extends U{constructor(e,{location:t=q.location,threshold:s=q.threshold,distance:r=q.distance,includeMatches:a=q.includeMatches,findAllMatches:i=q.findAllMatches,minMatchCharLength:n=q.minMatchCharLength,isCaseSensitive:c=q.isCaseSensitive,ignoreDiacritics:l=q.ignoreDiacritics,ignoreLocation:o=q.ignoreLocation}={}){super(e),this._bitapSearch=new K(e,{location:t,threshold:s,distance:r,includeMatches:a,findAllMatches:i,minMatchCharLength:n,isCaseSensitive:c,ignoreDiacritics:l,ignoreLocation:o})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Y extends U{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t,s=0;const r=[],a=this.pattern.length;for(;(t=e.indexOf(this.pattern,s))>-1;)s=t+a,r.push([t,s-1]);const i=!!r.length;return{isMatch:i,score:i?0:1,indices:r}}}const X=[class extends U{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},Y,class extends U{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},class extends U{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends U{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends U{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},class extends U{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},G],ee=X.length,te=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;const se=new Set([G.type,Y.type]);class re{constructor(e,{isCaseSensitive:t=q.isCaseSensitive,ignoreDiacritics:s=q.ignoreDiacritics,includeMatches:r=q.includeMatches,minMatchCharLength:a=q.minMatchCharLength,ignoreLocation:i=q.ignoreLocation,findAllMatches:n=q.findAllMatches,location:c=q.location,threshold:l=q.threshold,distance:o=q.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r,minMatchCharLength:a,findAllMatches:n,ignoreLocation:i,location:c,threshold:l,distance:o},e=t?e:e.toLowerCase(),e=s?J(e):e,this.pattern=e,this.query=function(e,t={}){return e.split("|").map(e=>{let s=e.trim().split(te).filter(e=>e&&!!e.trim()),r=[];for(let a=0,i=s.length;a<i;a+=1){const e=s[a];let i=!1,n=-1;for(;!i&&++n<ee;){const s=X[n];let a=s.isMultiMatch(e);a&&(r.push(new s(a,t)),i=!0)}if(!i)for(n=-1;++n<ee;){const s=X[n];let a=s.isSingleMatch(e);if(a){r.push(new s(a,t));break}}}return r})}(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:r,ignoreDiacritics:a}=this.options;e=r?e:e.toLowerCase(),e=a?J(e):e;let i=0,n=[],c=0;for(let l=0,o=t.length;l<o;l+=1){const r=t[l];n.length=0,i=0;for(let t=0,a=r.length;t<a;t+=1){const a=r[t],{isMatch:l,indices:o,score:d}=a.search(e);if(!l){c=0,i=0,n.length=0;break}if(i+=1,c+=d,s){const e=a.constructor.type;se.has(e)?n=[...n,...o]:n.push(o)}}if(i){let e={isMatch:!0,score:c/i};return s&&(e.indices=n),e}}return{isMatch:!1,score:1}}}const ae=[];function ie(e,t){for(let s=0,r=ae.length;s<r;s+=1){let r=ae[s];if(r.condition(e,t))return new r(e,t)}return new K(e,t)}const ne="$and",ce="$or",le="$path",oe="$val",de=e=>!(!e[ne]&&!e[ce]),ue=e=>({[ne]:Object.keys(e).map(t=>({[t]:e[t]}))});function me(e,t,{auto:s=!0}={}){const r=e=>{let a=Object.keys(e);const i=(e=>!!e[le])(e);if(!i&&a.length>1&&!de(e))return r(ue(e));if((e=>!C(e)&&M(e)&&!de(e))(e)){const r=i?e[le]:a[0],n=i?e[oe]:e[r];if(!k(n))throw new Error((e=>`Invalid value for key ${e}`)(r));const c={keyId:I(r),pattern:n};return s&&(c.searcher=ie(n,t)),c}let n={children:[],operator:a[0]};return a.forEach(t=>{const s=e[t];C(s)&&s.forEach(e=>{n.children.push(r(e))})}),n};return de(e)||(e=ue(e)),r(e)}function he(e,t){const s=e.matches;t.matches=[],F(s)&&s.forEach(e=>{if(!F(e.indices)||!e.indices.length)return;const{indices:s,value:r}=e;let a={indices:s,value:r};e.key&&(a.key=e.key.src),e.idx>-1&&(a.refIndex=e.idx),t.matches.push(a)})}function xe(e,t){t.score=e.score}class pe{constructor(e,t={},s){this.options={...q,...t},this.options.useExtendedSearch,this._keyStore=new $(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof T))throw new Error("Incorrect 'index' type");this._myIndex=t||O(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){F(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,r=this._docs.length;s<r;s+=1){const a=this._docs[s];e(a,s)&&(this.removeAt(s),s-=1,r-=1,t.push(a))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:r,shouldSort:a,sortFn:i,ignoreFieldNorm:n}=this.options;let c=k(e)?k(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,{ignoreFieldNorm:t=q.ignoreFieldNorm}){e.forEach(e=>{let s=1;e.matches.forEach(({key:e,norm:r,score:a})=>{const i=e?e.weight:null;s*=Math.pow(0===a&&i?Number.EPSILON:a,(i||1)*(t?1:r))}),e.score=s})}(c,{ignoreFieldNorm:n}),a&&c.sort(i),D(t)&&t>-1&&(c=c.slice(0,t)),function(e,t,{includeMatches:s=q.includeMatches,includeScore:r=q.includeScore}={}){const a=[];return s&&a.push(he),r&&a.push(xe),e.map(e=>{const{idx:s}=e,r={item:t[s],refIndex:s};return a.length&&a.forEach(t=>{t(e,r)}),r})}(c,this._docs,{includeMatches:s,includeScore:r})}_searchStringList(e){const t=ie(e,this.options),{records:s}=this._myIndex,r=[];return s.forEach(({v:e,i:s,n:a})=>{if(!F(e))return;const{isMatch:i,score:n,indices:c}=t.searchIn(e);i&&r.push({item:e,idx:s,matches:[{score:n,value:e,norm:a,indices:c}]})}),r}_searchLogical(e){const t=me(e,this.options),s=(e,t,r)=>{if(!e.children){const{keyId:s,searcher:a}=e,i=this._findMatches({key:this._keyStore.get(s),value:this._myIndex.getValueForItemAtKeyId(t,s),searcher:a});return i&&i.length?[{idx:r,item:t,matches:i}]:[]}const a=[];for(let i=0,n=e.children.length;i<n;i+=1){const n=e.children[i],c=s(n,t,r);if(c.length)a.push(...c);else if(e.operator===ne)return[]}return a},r=this._myIndex.records,a={},i=[];return r.forEach(({$:e,i:r})=>{if(F(e)){let n=s(t,e,r);n.length&&(a[r]||(a[r]={idx:r,item:e,matches:[]},i.push(a[r])),n.forEach(({matches:e})=>{a[r].matches.push(...e)}))}}),i}_searchObjectList(e){const t=ie(e,this.options),{keys:s,records:r}=this._myIndex,a=[];return r.forEach(({$:e,i:r})=>{if(!F(e))return;let i=[];s.forEach((s,r)=>{i.push(...this._findMatches({key:s,value:e[r],searcher:t}))}),i.length&&a.push({idx:r,item:e,matches:i})}),a}_findMatches({key:e,value:t,searcher:s}){if(!F(t))return[];let r=[];if(C(t))t.forEach(({v:t,i:a,n:i})=>{if(!F(t))return;const{isMatch:n,score:c,indices:l}=s.searchIn(t);n&&r.push({score:c,key:e,value:t,idx:a,norm:i,indices:l})});else{const{v:a,n:i}=t,{isMatch:n,score:c,indices:l}=s.searchIn(a);n&&r.push({score:c,key:e,value:a,norm:i,indices:l})}return r}}pe.version="7.1.0",pe.createIndex=O,pe.parseIndex=function(e,{getFn:t=q.getFn,fieldNormWeight:s=q.fieldNormWeight}={}){const{keys:r,records:a}=e,i=new T({getFn:t,fieldNormWeight:s});return i.setKeys(r),i.setIndexRecords(a),i},pe.config=q,pe.parseQuery=me,function(...e){ae.push(...e)}(re);class ge{constructor(e){this.cache=new Map,this.cacheExpiry=3e4,this.userRole=e}getCached(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheExpiry?t.results:null}setCache(e,t){this.cache.set(e,{results:t,timestamp:Date.now()})}clearCache(){this.cache.clear()}parseQuery(e){const t={},s=[],r=/(\w+):([^\s]+)/g;let a;for(;null!==(a=r.exec(e));)t[a[1]]=a[2];const i=e.replace(r,"").trim();return i&&s.push(...i.split(/\s+/)),{filters:t,terms:s}}async searchDevices(e,s){try{let r=t.from("devices").select("\n          id,\n          model,\n          serialNumber,\n          status,\n          issue,\n          expectedReturnDate,\n          customerName,\n          created_at,\n          updated_at\n        ").order("created_at",{ascending:!1}).limit(200);e.status&&(r=r.eq("status",e.status));const{data:a,error:i}=await r;if(i)return[];if(!a||0===a.length)return[];let n=a.map(e=>({id:e.id,model:e.model||"",serialNumber:e.serialNumber||"",status:e.status||"",issue:e.issue||"",expectedReturnDate:e.expectedReturnDate||"",customerName:e.customerName||"No customer",createdAt:e.created_at,updatedAt:e.updated_at}));if(e.model&&(n=n.filter(t=>t.model.toLowerCase().includes(e.model.toLowerCase()))),e.customer&&(n=n.filter(t=>t.customerName.toLowerCase().includes(e.customer.toLowerCase()))),s.length>0){const e=new pe(n,{keys:["model","serialNumber","customerName","issue","status"],threshold:.3,includeScore:!0,includeMatches:!0}),t=s.join(" ");return e.search(t).map(e=>{var t;const s=e.item,r=(null==(t=e.matches)?void 0:t.map(e=>e.key||""))||[];return{id:s.id,type:"device",title:s.model,subtitle:s.customerName,description:`Status: ${s.status} | Serial: ${s.serialNumber}`,url:`/devices/${s.id}`,metadata:{status:s.status,serialNumber:s.serialNumber,issue:s.issue,expectedReturnDate:s.expectedReturnDate},priority:"active"===s.status?1:2,score:e.score,matches:r,createdAt:s.createdAt,updatedAt:s.updatedAt}})}return n.map(e=>({id:e.id,type:"device",title:e.model,subtitle:e.customerName,description:`Status: ${e.status} | Serial: ${e.serialNumber}`,url:`/devices/${e.id}`,metadata:{status:e.status,serialNumber:e.serialNumber,issue:e.issue,expectedReturnDate:e.expectedReturnDate},priority:"active"===e.status?1:2,createdAt:e.createdAt,updatedAt:e.updatedAt}))}catch(r){return[]}}async searchCustomers(e,s){try{let r=t.from("customers").select("\n          id,\n          name,\n          phone,\n          email,\n          location,\n          notes,\n          isRead,\n          created_at,\n          updated_at\n        ").order("created_at",{ascending:!1}).limit(200);const{data:a,error:i}=await r;if(i)return[];if(!a||0===a.length)return[];let n=a.map(e=>({id:e.id,name:e.name||"",phone:e.phone||"",email:e.email||"",location:e.location||"",notes:e.notes||"",isRead:e.isRead,createdAt:e.created_at,updatedAt:e.updated_at}));if(e.name&&(n=n.filter(t=>t.name.toLowerCase().includes(e.name.toLowerCase()))),e.phone&&(n=n.filter(t=>!!t.phone&&A(t.phone,e.phone))),e.email&&(n=n.filter(t=>t.email.toLowerCase().includes(e.email.toLowerCase()))),e.location&&(n=n.filter(t=>t.location.toLowerCase().includes(e.location.toLowerCase()))),s.length>0){const e=new pe(n,{keys:["name","phone","email","location","notes"],threshold:.3,includeScore:!0,includeMatches:!0}),t=s.join(" ");return e.search(t).map(e=>{var t;const s=e.item,r=(null==(t=e.matches)?void 0:t.map(e=>e.key||""))||[];return{id:s.id,type:"customer",title:s.name,subtitle:s.phone,description:`${s.email||"No email"} | ${s.location||"No location"}`,url:`/customers/${s.id}`,metadata:{email:s.email,location:s.location,isRead:s.isRead},priority:!1===s.isRead?1:2,score:e.score,matches:r,createdAt:s.createdAt,updatedAt:s.updatedAt}})}return n.map(e=>({id:e.id,type:"customer",title:e.name,subtitle:e.phone,description:`${e.email||"No email"} | ${e.location||"No location"}`,url:`/customers/${e.id}`,metadata:{email:e.email,location:e.location,isRead:e.isRead},priority:!1===e.isRead?1:2,createdAt:e.createdAt,updatedAt:e.updatedAt}))}catch(r){return[]}}async searchProducts(e,s){if("admin"!==this.userRole&&"customer-care"!==this.userRole)return[];try{let r=t.from("lats_inventory").select("\n          id,\n          product_name,\n          sku,\n          barcode,\n          selling_price,\n          quantity,\n          category_id,\n          branch_id,\n          created_at,\n          updated_at\n        ").order("created_at",{ascending:!1}).limit(200);e.category&&(r=r.eq("category_id",e.category));const{data:a,error:i}=await r;if(i)return[];if(!a||0===a.length)return[];let n=a.map(e=>({id:e.id,name:e.product_name||"",sku:e.sku||"",barcode:e.barcode||"",price:e.selling_price||0,stockQuantity:e.quantity||0,categoryId:e.category_id||"",branchId:e.branch_id||"",createdAt:e.created_at,updatedAt:e.updated_at}));if(e.price){const t=e.price.split("-");if(2===t.length){const e=parseFloat(t[0]),s=parseFloat(t[1]);n=n.filter(t=>t.price>=e&&t.price<=s)}else{const t=parseFloat(e.price);n=n.filter(e=>e.price===t)}}if(s.length>0){const e=new pe(n,{keys:["name","sku","barcode"],threshold:.3,includeScore:!0,includeMatches:!0}),t=s.join(" ");return e.search(t).map(e=>{var t;const s=e.item,r=(null==(t=e.matches)?void 0:t.map(e=>e.key||""))||[];return{id:s.id,type:"product",title:s.name,subtitle:s.sku,description:`Price: TZS ${s.price.toLocaleString()} | Stock: ${s.stockQuantity}`,url:"/lats/unified-inventory",metadata:{price:s.price,stock:s.stockQuantity,category:s.categoryId,sku:s.sku,barcode:s.barcode},priority:s.stockQuantity<10?1:2,score:e.score,matches:r,createdAt:s.createdAt,updatedAt:s.updatedAt}})}return n.map(e=>({id:e.id,type:"product",title:e.name,subtitle:e.sku,description:`Price: TZS ${e.price.toLocaleString()} | Stock: ${e.stockQuantity}`,url:"/lats/unified-inventory",metadata:{price:e.price,stock:e.stockQuantity,category:e.categoryId,sku:e.sku,barcode:e.barcode},priority:e.stockQuantity<10?1:2,createdAt:e.createdAt,updatedAt:e.updatedAt}))}catch(r){return[]}}async searchSales(e,s){if("admin"!==this.userRole)return[];try{const{data:r,error:a}=await t.from("lats_sales").select("\n          id,\n          sale_number,\n          customer_name,\n          customer_phone,\n          total_amount,\n          created_at,\n          updated_at\n        ").order("created_at",{ascending:!1}).limit(100);if(a)return[];let i=(r||[]).map(e=>({id:e.id,saleNumber:e.sale_number||"",totalAmount:e.total_amount||0,customerName:e.customer_name||"Walk-in Customer",customerPhone:e.customer_phone||"",createdAt:e.created_at,updatedAt:e.updated_at}));if(e.date){const t=e.date;if(t.includes("-")){const[e,s]=t.split("-");i=i.filter(t=>{const r=new Date(t.createdAt);return r>=new Date(e)&&r<=new Date(s)})}else i=i.filter(e=>{const s=new Date(e.createdAt),r=parseInt(t);return s.getFullYear()===r})}if(e.amount){const t=e.amount.split("-");if(2===t.length){const e=parseFloat(t[0]),s=parseFloat(t[1]);i=i.filter(t=>t.totalAmount>=e&&t.totalAmount<=s)}else{const t=parseFloat(e.amount);i=i.filter(e=>e.totalAmount===t)}}if(e.customer&&(i=i.filter(t=>t.customerName.toLowerCase().includes(e.customer.toLowerCase()))),s.length>0){const e=new pe(i,{keys:["saleNumber","customerName","customerPhone"],threshold:.3,includeScore:!0,includeMatches:!0}),t=s.join(" ");return e.search(t).map(e=>{var t;const s=e.item,r=(null==(t=e.matches)?void 0:t.map(e=>e.key||""))||[];return{id:s.id,type:"sale",title:`Sale #${s.id}`,subtitle:s.customerName,description:`Amount: TZS ${s.totalAmount.toLocaleString()} | Date: ${new Date(s.createdAt).toLocaleDateString()}`,url:"/lats/sales-reports",metadata:{amount:s.totalAmount,date:s.createdAt,customer:s.customerName},priority:2,score:e.score,matches:r,createdAt:s.createdAt,updatedAt:s.updatedAt}})}return i.map(e=>({id:e.id,type:"sale",title:`Sale #${e.id}`,subtitle:e.customerName,description:`Amount: TZS ${e.totalAmount.toLocaleString()} | Date: ${new Date(e.createdAt).toLocaleDateString()}`,url:"/lats/sales-reports",metadata:{amount:e.totalAmount,date:e.createdAt,customer:e.customerName},priority:2,createdAt:e.createdAt,updatedAt:e.updatedAt}))}catch(r){return[]}}searchPagesAndActions(e){const t=[{id:"dashboard",title:"Dashboard",description:"View overview and analytics",url:"/dashboard",icon:"ðŸ“Š"},{id:"devices",title:"Devices",description:"Manage repair devices",url:"/devices",icon:"ðŸ“±"},{id:"customers",title:"Customers",description:"Manage customer information",url:"/customers",icon:"ðŸ‘¥"},{id:"pos",title:"Point of Sale",description:"New sale transaction",url:"/pos",icon:"ðŸ’°"},{id:"inventory",title:"Inventory",description:"Manage product inventory",url:"/lats/unified-inventory",icon:"ðŸ“¦"},{id:"sales",title:"Sales Reports",description:"View sales history and reports",url:"/lats/sales-reports",icon:"ðŸ“ˆ"},{id:"purchase-orders",title:"Purchase Orders",description:"Manage supplier orders",url:"/lats/purchase-orders",icon:"ðŸ›’"},{id:"payments",title:"Payments",description:"Track payment transactions",url:"/payments",icon:"ðŸ’³"},{id:"analytics",title:"Analytics",description:"Business insights and reports",url:"/analytics",icon:"ðŸ“Š"},{id:"settings",title:"Settings",description:"Application settings",url:"/settings",icon:"âš™ï¸"}].filter(e=>"admin"===this.userRole||("customer-care"===this.userRole?!["analytics","purchase-orders"].includes(e.id):["dashboard","devices","customers"].includes(e.id)));if(e.length>0){const s=new pe(t,{keys:["title","description"],threshold:.4,includeScore:!0,includeMatches:!0}),r=e.join(" ");return s.search(r).map(e=>{var t;const s=e.item,r=(null==(t=e.matches)?void 0:t.map(e=>e.key||""))||[];return{id:s.id,type:"page",title:s.title,subtitle:"Navigate to page",description:s.description,url:s.url,metadata:{icon:s.icon},priority:0,score:e.score,matches:r}})}return[]}async search(e){const t=this.getCached(e);if(t)return t;const{filters:s,terms:r}=this.parseQuery(e),a=[];try{const t=this.searchPagesAndActions(r);a.push(...t);const[i,n,c,l]=await Promise.all([this.searchDevices(s,r),this.searchCustomers(s,r),this.searchProducts(s,r),this.searchSales(s,r)]);a.push(...i),a.push(...n),a.push(...c),a.push(...l);const o=a.sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:void 0!==e.score&&void 0!==t.score?e.score-t.score:e.createdAt&&t.createdAt?new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime():e.title.localeCompare(t.title));return this.setCache(e,o),o}catch(i){return[]}}}const ye=({customerId:s,customerName:a,onClose:n})=>{const d=w(),[u,m]=v.useState(!0),[p,b]=v.useState("overview"),[f,j]=v.useState({devices:[],sales:[],payments:[],appointments:[],notes:[],messages:[],totalSpent:0,lastActivity:"",customerInfo:null});v.useEffect(()=>{N()},[s]);const N=async()=>{m(!0);try{const{data:e}=await t.from("customers").select("*").eq("id",s).single(),{data:r,error:a}=await t.from("devices").select("*").eq("customer_id",s).order("created_at",{ascending:!1}).limit(50),{data:i,error:n}=await t.from("customer_payments").select("*").eq("customer_id",s).order("payment_date",{ascending:!1}).limit(50);let c=[];if(null==e?void 0:e.phone){const{data:s,error:r}=await t.from("lats_sales").select("\n            *,\n            lats_customers!inner (\n              phone\n            )\n          ").eq("lats_customers.phone",e.phone).order("created_at",{ascending:!1}).limit(50);r||(c=s||[])}const{data:l,error:o}=await t.from("appointments").select("*").eq("customer_id",s).order("appointment_date",{ascending:!1}).limit(50),{data:d,error:u}=await t.from("customer_notes").select("*").eq("customer_id",s).order("created_at",{ascending:!1}).limit(50),{data:m,error:h}=await t.from("customer_messages").select("*").eq("customer_id",s).order("created_at",{ascending:!1}).limit(50),x=(c||[]).reduce((e,t)=>e+(t.total_amount||0),0),p=[...(r||[]).map(e=>new Date(e.created_at)),...(c||[]).map(e=>new Date(e.created_at)),...(i||[]).map(e=>new Date(e.payment_date)),...(l||[]).map(e=>new Date(e.appointment_date)),...(d||[]).map(e=>new Date(e.created_at)),...(m||[]).map(e=>new Date(e.created_at))].filter(e=>!isNaN(e.getTime())),g=p.length>0?new Date(Math.max(...p.map(e=>e.getTime()))).toLocaleDateString():"No activity";j({devices:r||[],sales:c||[],payments:i||[],appointments:l||[],notes:d||[],messages:m||[],totalSpent:x,lastActivity:g,customerInfo:e})}catch(e){}finally{m(!1)}},A=e=>{d(`/devices/${e}`),n()};return u?e.jsx("div",{className:"fixed inset-0 z-[100000] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-2xl",children:[e.jsx(g,{className:"w-8 h-8 animate-spin text-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading activity..."})]})}):e.jsx("div",{className:"fixed inset-0 z-[100000] flex items-center justify-center bg-black/30 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b px-6 py-4 flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a})}),e.jsx("button",{onClick:n,className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:e.jsx(r,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-px bg-gray-200 border-b",children:[e.jsxs("div",{className:"bg-white p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:f.devices.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Devices"})]}),e.jsxs("div",{className:"bg-white p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:f.sales.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Sales"})]}),e.jsxs("div",{className:"bg-white p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:f.payments.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Payments"})]}),e.jsxs("div",{className:"bg-white p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:f.appointments.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Appts"})]}),e.jsxs("div",{className:"bg-white p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:f.messages.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Messages"})]}),e.jsxs("div",{className:"bg-white p-3 text-center",children:[e.jsx("p",{className:"text-xs font-medium text-gray-900",children:f.lastActivity}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last"})]})]}),e.jsx("div",{className:"border-b bg-white px-4",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto",children:[{key:"overview",label:"All"},{key:"devices",label:`Devices (${f.devices.length})`},{key:"sales",label:`Sales (${f.sales.length})`},{key:"payments",label:`Payments (${f.payments.length})`},{key:"appointments",label:`Appts (${f.appointments.length})`},{key:"notes",label:`Notes (${f.notes.length})`},{key:"messages",label:`Messages (${f.messages.length})`}].map(t=>e.jsx("button",{onClick:()=>b(t.key),className:"px-3 py-2 text-sm font-medium border-b-2 transition-colors whitespace-nowrap "+(p===t.key?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:t.label},t.key))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:["overview"===p&&e.jsxs(e.Fragment,{children:[f.customerInfo&&e.jsx("div",{className:"bg-gray-50 rounded p-4 border",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Phone:"})," ",e.jsx("span",{className:"font-medium ml-1",children:f.customerInfo.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Email:"})," ",e.jsx("span",{className:"font-medium ml-1",children:f.customerInfo.email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"City:"})," ",e.jsx("span",{className:"font-medium ml-1",children:f.customerInfo.city||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Loyalty:"})," ",e.jsx("span",{className:"font-medium ml-1 capitalize",children:f.customerInfo.loyalty_level||"Bronze"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Points:"})," ",e.jsx("span",{className:"font-medium ml-1",children:f.customerInfo.points||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"})," ",e.jsxs("span",{className:"font-medium ml-1",children:["TZS ",f.totalSpent.toLocaleString()]})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-3",children:"Activity Timeline"}),e.jsxs("div",{className:"space-y-2",children:[[...f.devices.map(e=>({type:"device",data:e,date:new Date(e.created_at)})),...f.sales.map(e=>({type:"sale",data:e,date:new Date(e.created_at)})),...f.payments.map(e=>({type:"payment",data:e,date:new Date(e.payment_date)})),...f.appointments.map(e=>({type:"appointment",data:e,date:new Date(e.appointment_date)})),...f.notes.map(e=>({type:"note",data:e,date:new Date(e.created_at)})),...f.messages.map(e=>({type:"message",data:e,date:new Date(e.created_at)}))].sort((e,t)=>t.date.getTime()-e.date.getTime()).map((t,s)=>{if("device"===t.type){const r=t.data;return e.jsxs("div",{onClick:()=>A(r.id),className:"border-l-2 border-blue-500 pl-3 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"text-blue-500",size:16}),e.jsx("span",{className:"font-medium text-gray-900",children:r.model||r.device_name}),e.jsx("span",{className:"text-xs text-gray-500",children:r.status})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5 ml-6",children:r.problem_description||r.issue_description}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5 ml-6",children:t.date.toLocaleString()})]},`device-${r.id}-${s}`)}if("sale"===t.type){const r=t.data;return e.jsxs("div",{className:"border-l-2 border-green-500 pl-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"text-green-500",size:16}),e.jsxs("span",{className:"font-medium text-gray-900",children:["Sale #",r.id]})]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["TZS ",(r.total_amount||0).toLocaleString()]})]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5 ml-6",children:[r.payment_method," â€¢ ",t.date.toLocaleString()]})]},`sale-${r.id}-${s}`)}if("payment"===t.type){const r=t.data;return e.jsxs("div",{className:"border-l-2 border-purple-500 pl-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"text-purple-500",size:16}),e.jsx("span",{className:"font-medium text-gray-900",children:r.method||"Cash"})]}),e.jsxs("span",{className:"font-semibold text-purple-600",children:["TZS ",(r.amount||0).toLocaleString()]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5 ml-6",children:t.date.toLocaleString()})]},`payment-${r.id}-${s}`)}if("appointment"===t.type){const r=t.data;return e.jsxs("div",{className:"border-l-2 border-cyan-500 pl-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"text-cyan-500",size:16}),e.jsx("span",{className:"font-medium text-gray-900",children:r.title}),e.jsx("span",{className:"text-xs text-gray-500",children:r.status})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5 ml-6",children:t.date.toLocaleString()})]},`apt-${r.id}-${s}`)}if("note"===t.type){const r=t.data;return e.jsx("div",{className:"border-l-2 border-amber-500 pl-3 py-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(y,{className:"text-amber-500 mt-0.5",size:16}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-800",children:r.note}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:t.date.toLocaleString()})]})]})},`note-${r.id}-${s}`)}if("message"===t.type){const r=t.data;return e.jsx("div",{className:"border-l-2 pl-3 py-2 "+("outbound"===r.direction?"border-blue-500":"border-indigo-500"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(h,{className:"outbound"===r.direction?"text-blue-500":"text-indigo-500",size:16}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-800",children:r.message}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["outbound"===r.direction?"Sent":"Received"," â€¢ ",r.channel," â€¢ ",t.date.toLocaleString()]})]})]})},`msg-${r.id}-${s}`)}return null}),0===f.devices.length&&0===f.sales.length&&0===f.payments.length&&0===f.appointments.length&&0===f.notes.length&&0===f.messages.length&&e.jsx("div",{className:"text-center py-12 text-gray-400",children:e.jsx("p",{className:"text-sm",children:"No activity found"})})]})]})]}),"devices"===p&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(i,{className:"text-blue-500",size:20}),"Devices (",f.devices.length,")"]}),f.devices.length>0&&e.jsx("button",{onClick:()=>{d(`/devices?customer=${s}`),n()},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All â†’"})]}),f.devices.length>0?e.jsx("div",{className:"space-y-2",children:f.devices.map(t=>e.jsx("div",{onClick:()=>A(t.id),className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-md transition-all cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.model||t.device_name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.problem_description||t.issue_description||"No issue specified"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Serial: ",t.serial_number||"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+("active"===t.status||"in-progress"===t.status?"bg-blue-100 text-blue-700":"done"===t.status||"completed"===t.status?"bg-green-100 text-green-700":"pending"===t.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:t.status}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.created_at).toLocaleDateString()})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(c,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No devices found"})]})]}),"sales"===p&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(l,{className:"text-green-500",size:20}),"Recent Sales (",f.sales.length,")"]}),f.sales.length>0&&e.jsx("button",{onClick:()=>{d(`/lats/sales-reports?customer=${s}`),n()},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All â†’"})]}),f.sales.length>0?e.jsx("div",{className:"space-y-2",children:f.sales.map(t=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-green-300 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:["Sale #",t.id]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.customer_name||"Walk-in"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["TZS ",(t.total_amount||0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.payment_method||"Cash"})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(l,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No sales found"})]})]}),"payments"===p&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(o,{className:"text-purple-500",size:20}),"All Payments (",f.payments.length,")"]}),f.payments.length>0?e.jsx("div",{className:"space-y-2",children:f.payments.map(t=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.method||"Cash"}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.payment_date).toLocaleDateString()}),t.notes&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t.notes})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:["TZS ",(t.amount||0).toLocaleString()]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full "+("completed"===t.status?"bg-green-100 text-green-700":"pending"===t.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:t.status||"completed"})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(o,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No payments found"})]})]}),"appointments"===p&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(x,{className:"text-cyan-500",size:20}),"All Appointments (",f.appointments.length,")"]}),f.appointments.length>0?e.jsx("div",{className:"space-y-2",children:f.appointments.map(t=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description||"No description"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.appointment_date).toLocaleString()})]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+("scheduled"===t.status?"bg-blue-100 text-blue-700":"completed"===t.status?"bg-green-100 text-green-700":"cancelled"===t.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:t.status})]})},t.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(x,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No appointments found"})]})]}),"notes"===p&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(y,{className:"text-amber-500",size:20}),"All Notes (",f.notes.length,")"]}),f.notes.length>0?e.jsx("div",{className:"space-y-2",children:f.notes.map(t=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-gray-800",children:t.note}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(t.created_at).toLocaleString()})]},t.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(y,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No notes found"})]})]}),"messages"===p&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(h,{className:"text-indigo-500",size:20}),"All Messages (",f.messages.length,")"]}),f.messages.length>0?e.jsx("div",{className:"space-y-2",children:f.messages.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 "+("outbound"===t.direction?"bg-blue-50 border-blue-200 ml-8":"bg-white border-gray-200 mr-8"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-medium "+("outbound"===t.direction?"text-blue-700":"text-gray-700"),children:["outbound"===t.direction?"Sent":"Received"," via ",t.channel]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full "+("delivered"===t.status?"bg-green-100 text-green-700":"read"===t.status?"bg-blue-100 text-blue-700":"failed"===t.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:t.status})]}),e.jsx("p",{className:"text-gray-800",children:t.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(t.created_at).toLocaleString()})]},t.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(h,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No messages found"})]})]})]}),e.jsxs("div",{className:"border-t px-6 py-3 flex gap-2 bg-white",children:[e.jsx("button",{onClick:()=>{d(`/customers/${s}`),n()},className:"px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"View Profile"}),e.jsx("button",{onClick:n,className:"px-4 py-2 border text-sm rounded hover:bg-gray-50 transition-colors",children:"Close"})]})]})})},be=({query:t,filter:s,onFilterChange:r,isLoading:h,userRole:x,devices:p,customers:A})=>{const _=w(),[C,k]=v.useState([]),[D,S]=v.useState(!1),[M,F]=v.useState(null),[E,L]=v.useState(0),B=v.useRef([]),[$,z]=v.useState(null),R=v.useMemo(()=>new ge(x),[x]);v.useEffect(()=>{if(!t.trim())return void k([]);const e=setTimeout(async()=>{S(!0),F(null);try{const e=(await R.search(t)).map(e=>({...e,icon:I(e.type)}));k(e)}catch(e){F("An error occurred while searching. Please try again."),k([])}finally{S(!1)}},300);return()=>clearTimeout(e)},[t,R]);const I=t=>{switch(t){case"device":return e.jsx(i,{size:20,className:"text-blue-600"});case"customer":return e.jsx(n,{size:20,className:"text-green-600"});case"product":return e.jsx(c,{size:20,className:"text-purple-600"});case"sale":return e.jsx(l,{size:20,className:"text-amber-600"});case"payment":return e.jsx(o,{size:20,className:"text-emerald-600"});case"loyalty":return e.jsx(d,{size:20,className:"text-yellow-600"});case"inventory":return e.jsx(u,{size:20,className:"text-orange-600"});case"report":return e.jsx(m,{size:20,className:"text-indigo-600"});case"page":return e.jsx(N,{size:20,className:"text-cyan-600"});case"action":return e.jsx(j,{size:20,className:"text-pink-600"});default:return e.jsx(y,{size:20,className:"text-gray-600"})}},q=v.useCallback((t,s)=>{if(!s)return t;const r=s.split(" ").filter(e=>e.length>1);if(0===r.length)return t;const a=[];let i=0;const n=new RegExp(`(${r.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`,"gi");let c;for(;null!==(c=n.exec(t));)c.index>i&&a.push({text:t.slice(i,c.index),isHighlighted:!1}),a.push({text:c[0],isHighlighted:!0}),i=c.index+c[0].length;return i<t.length&&a.push({text:t.slice(i),isHighlighted:!1}),0===a.length?t:e.jsx(e.Fragment,{children:a.map((t,s)=>t.isHighlighted?e.jsx("mark",{className:"bg-yellow-200 text-gray-900 px-0.5 rounded",children:t.text},s):e.jsx("span",{children:t.text},s))})},[]),P=v.useMemo(()=>"all"===s?C:C.filter(e=>e.type===s),[C,s]),T=v.useMemo(()=>{const e=[{key:"all",label:"All Results",count:C.length}],t=C.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{});return Object.entries(t).forEach(([t,s])=>{e.push({key:t,label:{device:"Devices",customer:"Customers",product:"Products",sale:"Sales",payment:"Payments",loyalty:"Loyalty",inventory:"Inventory",report:"Reports",page:"Pages",action:"Actions"}[t]||t,count:s})}),e},[C]);v.useEffect(()=>{L(0),B.current=[]},[P]),v.useEffect(()=>{const e=e=>{if(0!==P.length)switch(e.key){case"ArrowDown":e.preventDefault(),L(e=>Math.min(e+1,P.length-1));break;case"ArrowUp":e.preventDefault(),L(e=>Math.max(e-1,0));break;case"Enter":if(e.preventDefault(),P[E]){const e=P[E];"customer"===e.type?z({id:e.id,name:e.title}):_(e.url)}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[P,E,_]),v.useEffect(()=>{var e;B.current[E]&&(null==(e=B.current[E])||e.scrollIntoView({behavior:"smooth",block:"nearest"}))},[E]);return D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center bg-white/50 backdrop-blur-xl rounded-2xl p-8 border border-white/30 shadow-[0_8px_32px_0_rgba(31,38,135,0.07)]",children:[e.jsx(g,{size:36,className:"animate-spin text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-700 font-medium",children:"Searching..."})]})}):M?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center bg-white/50 backdrop-blur-xl rounded-2xl p-8 border border-red-200/40 shadow-[0_8px_32px_0_rgba(239,68,68,0.1)]",children:[e.jsx(b,{size:36,className:"text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-2 font-semibold",children:"Search Error"}),e.jsx("p",{className:"text-gray-600",children:M})]})}):e.jsxs(e.Fragment,{children:[$&&e.jsx(ye,{customerId:$.id,customerName:$.name,onClose:()=>z(null)}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between bg-white/40 backdrop-blur-xl rounded-2xl p-5 border border-white/30 shadow-[0_4px_16px_0_rgba(31,38,135,0.05)]",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Search Results for ",e.jsxs("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:['"',t,'"']})]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[P.length," result",1!==P.length?"s":""," found"]})]})}),T.length>1&&e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:T.map(t=>e.jsxs("button",{onClick:()=>r(t.key),className:"px-5 py-2.5 rounded-full text-sm font-medium whitespace-nowrap backdrop-blur-xl transition-all duration-300 "+(s===t.key?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-[0_4px_20px_0_rgba(59,130,246,0.3)] scale-105":"bg-white/60 text-gray-700 hover:bg-white/80 border border-white/40 shadow-[0_2px_8px_0_rgba(31,38,135,0.05)] hover:scale-105"),children:[t.label,e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs "+(s===t.key?"bg-white/30":"bg-gray-100"),children:t.count})]},t.key))}),P.length>0?e.jsx("div",{className:"space-y-3",children:P.map((s,r)=>{const i=r===E;return e.jsx("div",{ref:e=>B.current[r]=e,onClick:()=>((e,t)=>{L(t),"customer"===e.type?z({id:e.id,name:e.title}):_(e.url)})(s,r),onMouseEnter:()=>L(r),className:`\n                  rounded-2xl p-5 border backdrop-blur-xl transition-all duration-300 cursor-pointer group\n                  ${i?"bg-gradient-to-r from-blue-50/80 to-purple-50/80 border-blue-300 shadow-[0_8px_32px_0_rgba(59,130,246,0.2)] scale-[1.02]":"bg-white/50 border-white/30 hover:bg-white/70 hover:shadow-[0_8px_32px_0_rgba(59,130,246,0.15)] hover:scale-[1.01] hover:border-blue-300/50"}\n                `,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`\n                    p-3 rounded-xl shadow-sm transition-all duration-300 flex-shrink-0\n                    ${i?"bg-gradient-to-br from-blue-100 to-purple-100":"bg-gradient-to-br from-gray-50 to-gray-100 group-hover:from-blue-50 group-hover:to-purple-50"}\n                  `,children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`\n                          font-semibold text-lg transition-colors mb-1\n                          ${i?"text-gray-900":"text-gray-800 group-hover:text-gray-900"}\n                        `,children:q(s.title,t)}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`\n                            px-3 py-1 rounded-full text-xs font-medium backdrop-blur-sm\n                            ${i?"bg-gradient-to-r from-blue-200 to-purple-200 text-blue-800":"bg-gradient-to-r from-blue-100 to-purple-100 text-blue-700"}\n                          `,children:s.type}),void 0!==s.score&&e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[Math.round(100*(1-s.score)),"% match"]})]})]})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:q(s.subtitle,t)}),e.jsx("p",{className:"text-sm text-gray-500",children:q(s.description,t)}),s.metadata&&e.jsxs("div",{className:"flex items-center gap-3 mt-3 pt-3 border-t border-gray-200/50 flex-wrap",children:[s.metadata.status&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs text-gray-600 bg-gray-100/60 px-2.5 py-1 rounded-full backdrop-blur-sm",children:s.metadata.status})]}),s.metadata.price&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"ðŸ’°"}),e.jsxs("span",{className:"text-xs text-gray-600 bg-gray-100/60 px-2.5 py-1 rounded-full backdrop-blur-sm",children:["TZS ",s.metadata.price.toLocaleString()]})]}),s.metadata.stock&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"ðŸ“¦"}),e.jsxs("span",{className:"text-xs text-gray-600 bg-gray-100/60 px-2.5 py-1 rounded-full backdrop-blur-sm",children:[s.metadata.stock," in stock"]})]}),s.metadata.date&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"ðŸ“…"}),e.jsx("span",{className:"text-xs text-gray-600 bg-gray-100/60 px-2.5 py-1 rounded-full backdrop-blur-sm",children:s.metadata.date instanceof Date?s.metadata.date.toLocaleDateString():s.metadata.date})]}),s.metadata.icon&&e.jsx("span",{className:"text-lg",children:s.metadata.icon})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:["sale"===s.type&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),_(s.url)},className:"px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-md transition-colors",title:"View Sale Details",children:"View"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),window.open(`/sales/${s.id}/receipt`,"_blank")},className:"px-2 py-1 text-xs bg-green-100 hover:bg-green-200 text-green-700 rounded-md transition-colors",title:"Print Receipt",children:"Print"})]}),e.jsx(a,{size:18,className:`\n                      transition-all duration-300\n                      ${i?"opacity-100 text-blue-500":"text-gray-400 opacity-0 group-hover:opacity-100 group-hover:text-blue-500"}\n                    `})]})]})},`${s.type}-${s.id}`)})}):e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"bg-white/50 backdrop-blur-xl rounded-2xl p-10 border border-white/30 shadow-[0_8px_32px_0_rgba(31,38,135,0.07)] inline-block",children:[e.jsx(f,{size:56,className:"text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No results found"}),e.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"Try adjusting your search terms or filters. You can also try searching for different keywords."})]})})]})]})};export{_ as S,be as a};
