import{j as e,G as s,d as t,af as a,ah as r,c as l,u as n,ai as i}from"./index-222cfb29.js";import{r as d}from"./vendor-a2ff445a.js";import{a5 as c,Q as o,aC as x,R as m,$ as u,d as g,Y as h,h as p,y as b,p as j,P as f,j as v,v as y,aP as N,n as w,X as S,N as C,U as k,f as P,u as D,x as A,bl as T,T as O,w as I,bR as $,ah as L,cl as E,V as _,D as R,ax as U,bu as Z,bd as F,a as z,b as M,A as q,cm as V,O as Q,ae as K,ac as B,ad as H,e as Y,bD as G,bE as J,a7 as W,q as X,cn as ee,i as se,aA as te,a2 as ae,r as re,co as le,a8 as ne,cp as ie,bK as de}from"./ui-551a39a6.js";import{u as ce}from"./useDialog-ddaadb89.js";import{u as oe}from"./usePOSClickSounds-710a2a1b.js";import{R as xe,P as me,u as ue,V as ge}from"./VariantProductCard-5f79965a.js";import{A as he}from"./AddSupplierModal-247b2b34.js";import{S as pe}from"./SupplierDetailsModal-8b57c375.js";import{S as be}from"./SupplierForm-e7ec71ff.js";import{f as je,a as fe,S as ve,v as ye,g as Ne}from"./purchaseOrderUtils-e0e1d78b.js";import{g as we}from"./skuUtils-6fbbef44.js";import{g as Se,i as Ce}from"./productUtils-6e390a72.js";import{u as ke}from"./usePurchaseOrderHistory-baa7ee96.js";import{C as Pe}from"./CategoryInput-bba1731d.js";import{u as De}from"./useBodyScrollLock-0216d39f.js";import{u as Ae,S as Te}from"./useSuccessModal-e8b7d685.js";import{S as Oe}from"./SuccessModalIcons-20b743c5.js";import{o as Ie,s as $e,e as Le,Z as Ee}from"./forms-fd94c8fb.js";import{p as _e}from"./draftService-0e50dcac.js";import{a as Re}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";import"./robustImageService-2422a1f9.js";import"./format-0f0b2647.js";import"./GlassInput-ba5c3c0d.js";import"./utils-fb833cf6.js";import"./charts-66cc82bb.js";import"./zod-4c7d126c.js";const Ue=({cartItemsCount:t,totalAmount:a,currency:r,productsCount:l,suppliersCount:n,onCreatePurchaseOrder:i,onClearCart:d,onAddSupplier:h,onAddProduct:p,onViewPurchaseOrders:b,isCreatingPO:j,hasSelectedSupplier:f,onTestPOFetch:v})=>e.jsx("div",{className:"bg-gradient-to-r from-orange-500 via-amber-500 to-orange-600 shadow-xl border-b-4 border-orange-300",children:e.jsx("div",{className:"px-4 sm:px-6 py-4",children:e.jsx("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[b&&e.jsx(s,{onClick:b,variant:"outline",className:"bg-white/20 hover:bg-white/30 text-white border-white/30 hover:border-white/50",icon:e.jsx(c,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"View Orders"})}),p&&e.jsx(s,{onClick:p,variant:"outline",className:"bg-white/20 hover:bg-white/30 text-white border-white/30 hover:border-white/50",icon:e.jsx(o,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"Add Product"})}),h&&e.jsx(s,{onClick:h,variant:"outline",className:"bg-white/20 hover:bg-white/30 text-white border-white/30 hover:border-white/50",icon:e.jsx(x,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"Add Supplier"})}),v&&e.jsx(s,{onClick:v,variant:"outline",className:"bg-blue-500/20 hover:bg-blue-500/30 text-white border-blue-300/50 hover:border-blue-300/70",icon:e.jsx(m,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"ðŸ§ª Test PO"})}),t>0&&e.jsx(s,{onClick:d,variant:"outline",className:"bg-red-500/20 hover:bg-red-500/30 text-white border-red-300/50 hover:border-red-300/70",icon:e.jsx(u,{size:18}),children:e.jsx("span",{className:"hidden sm:inline",children:"Clear"})}),e.jsx(s,{onClick:i,disabled:!f||0===t||j,className:"bg-white text-orange-600 hover:bg-orange-50 disabled:opacity-50 disabled:cursor-not-allowed font-bold",icon:j?e.jsx(m,{size:18,className:"animate-spin"}):e.jsx(g,{size:18}),children:j?"Creating...":"Create PO"})]})})})});function Ze(e,s,t="TZS"){return function(e,s,t="TZS"){if(!(null==e?void 0:e.trim()))return null;const a=[/1\s*([A-Z]{3})\s*=\s*([\d,]+\.?\d*)\s*([A-Z]{3})/i,/([\d,]+\.?\d*)\s*([A-Z]{3})\s*=\s*1\s*([A-Z]{3})/i,/([\d,]+\.?\d*)/i];for(const r of a){const a=e.match(r);if(a)if(4===a.length){const e=a[1]||a[3],r=a[3]||a[1],l=parseFloat(a[2].replace(/,/g,""));if(e===s&&r===t)return{rate:l,source:"manual",date:(new Date).toISOString(),fromCurrency:s,toCurrency:t};if(e===t&&r===s)return{rate:1/l,source:"manual",date:(new Date).toISOString(),fromCurrency:s,toCurrency:t}}else if(2===a.length)return{rate:parseFloat(a[1].replace(/,/g,"")),source:"manual",date:(new Date).toISOString(),fromCurrency:s,toCurrency:t}}return null}(e,s,t)}const Fe={TZ:"ðŸ‡¹ðŸ‡¿",AE:"ðŸ‡¦ðŸ‡ª",CN:"ðŸ‡¨ðŸ‡³",US:"ðŸ‡ºðŸ‡¸",CA:"ðŸ‡¨ðŸ‡¦",UK:"ðŸ‡¬ðŸ‡§",DE:"ðŸ‡©ðŸ‡ª",FR:"ðŸ‡«ðŸ‡·",JP:"ðŸ‡¯ðŸ‡µ",IN:"ðŸ‡®ðŸ‡³",BR:"ðŸ‡§ðŸ‡·",AU:"ðŸ‡¦ðŸ‡º",KE:"ðŸ‡°ðŸ‡ª",UG:"ðŸ‡ºðŸ‡¬",RW:"ðŸ‡·ðŸ‡¼",ET:"ðŸ‡ªðŸ‡¹",NG:"ðŸ‡³ðŸ‡¬",ZA:"ðŸ‡¿ðŸ‡¦",EG:"ðŸ‡ªðŸ‡¬",SA:"ðŸ‡¸ðŸ‡¦",TR:"ðŸ‡¹ðŸ‡·",RU:"ðŸ‡·ðŸ‡º",KR:"ðŸ‡°ðŸ‡·",SG:"ðŸ‡¸ðŸ‡¬",MY:"ðŸ‡²ðŸ‡¾",TH:"ðŸ‡¹ðŸ‡­",VN:"ðŸ‡»ðŸ‡³",ID:"ðŸ‡®ðŸ‡©",PH:"ðŸ‡µðŸ‡­"},ze=({isOpen:r,onClose:l,onSupplierSelect:n,suppliers:i})=>{const[c,m]=d.useState(""),[u,S]=d.useState(""),[C,k]=d.useState("name"),[P,D]=d.useState(!1),[A,T]=d.useState(null),[O,I]=d.useState(!1),[$,L]=d.useState(null),[E,_]=d.useState(!1),[R,U]=d.useState(!1),Z=d.useMemo(()=>{const e=new Set(i.map(e=>e.country).filter(Boolean));return Array.from(e).sort()},[i]),F=d.useMemo(()=>{let e=i.filter(e=>{var s,t,a,r,l,n;if(c.trim()){const i=c.toLowerCase();if(!(((null==(s=e.name)?void 0:s.toLowerCase())||"").includes(i)||((null==(t=e.company_name)?void 0:t.toLowerCase())||"").includes(i)||((null==(a=e.contactPerson)?void 0:a.toLowerCase())||"").includes(i)||(e.phone||"").includes(i)||((null==(r=e.email)?void 0:r.toLowerCase())||"").includes(i)||((null==(l=e.city)?void 0:l.toLowerCase())||"").includes(i)||((null==(n=e.country)?void 0:n.toLowerCase())||"").includes(i)))return!1}return!u||e.country===u});return e.sort((e,s)=>{switch(C){case"name":return(e.name||"").localeCompare(s.name||"");case"orders":return(s.ordersCount||0)-(e.ordersCount||0);case"recent":const t=e.lastOrderDate?new Date(e.lastOrderDate).getTime():0;return(s.lastOrderDate?new Date(s.lastOrderDate).getTime():0)-t;case"rating":return(s.rating||0)-(e.rating||0);default:return 0}}),e},[i,c,u,C]),z=e=>e>=4.5?"text-green-600":e>=4?"text-yellow-600":e>=3?"text-orange-600":"text-red-600",M=e=>(e.ordersCount||0)>=10?"bg-purple-100 text-purple-700":(e.rating||0)>=4.5?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700",q=e=>(e.ordersCount||0)>=10?"Preferred":(e.rating||0)>=4.5?"Top Rated":"Supplier";return r?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:l,children:[e.jsxs(t,{className:"w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-orange-50 to-amber-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-orange-100 rounded-xl",children:e.jsx(h,{className:"w-8 h-8 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Select Supplier"}),e.jsx("p",{className:"text-gray-600",children:"Choose a supplier for your purchase order"})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(p,{className:"w-6 h-6 text-gray-500"})})]})}),e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search suppliers by name, contact, phone, email...",value:c,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]})}),e.jsx("div",{children:e.jsxs("select",{value:u,onChange:e=>S(e.target.value),className:"w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Countries"}),Z.map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsx("div",{children:e.jsxs("select",{value:C,onChange:e=>k(e.target.value),className:"w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"orders",children:"Sort by Orders"}),e.jsx("option",{value:"recent",children:"Sort by Recent"}),e.jsx("option",{value:"rating",children:"Sort by Rating"})]})})]}),e.jsx("div",{className:"mt-4 flex items-center justify-between",children:e.jsxs("div",{className:"text-sm text-gray-500",children:[F.length," of ",i.length," suppliers"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:F.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:F.map(s=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl hover:shadow-lg hover:border-orange-300 transition-all duration-200 bg-white",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-amber-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:s.name}),s.company_name&&s.company_name!==s.name&&e.jsx("p",{className:"text-sm text-gray-600",children:s.company_name}),s.contactPerson&&e.jsx("p",{className:"text-sm text-gray-600",children:s.contactPerson})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${M(s)}`,children:q(s)}),s.rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:`w-4 h-4 fill-current ${z(s.rating)}`}),e.jsx("span",{className:`text-sm font-medium ${z(s.rating)}`,children:s.rating.toFixed(1)})]})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{children:s.email})]}),(s.city||s.country)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsxs("span",{children:[[s.city,s.country].filter(Boolean).join(", "),s.country&&` ${Fe[s.country]||"ðŸŒ"}`]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t border-gray-100",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Orders"}),e.jsx("div",{className:"font-semibold text-gray-900",children:s.ordersCount||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Currency"}),e.jsxs("div",{className:"font-semibold text-gray-900 flex items-center gap-1",children:[s.country&&(Fe[s.country]||"ðŸ’±")," ",s.preferred_currency||s.currency||"TZS"]})]}),s.totalSpent&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Total Spent"}),e.jsx("div",{className:"font-semibold text-green-600",children:je(s.totalSpent,{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})})]}),s.lastOrderDate&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Last Order"}),e.jsx("div",{className:"font-semibold text-gray-900",children:fe(s.lastOrderDate)})]}),s.exchangeRates&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Exchange Rates"}),e.jsx("div",{className:"font-semibold text-gray-900",children:s.exchangeRates})]}),s.leadTimeDays&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Lead Time"}),e.jsxs("div",{className:"font-semibold text-gray-900",children:[s.leadTimeDays," days"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-100 mt-4",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),T(s),I(!0)},className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"View Details"]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),n(s)},className:"flex-1 bg-gradient-to-r from-orange-500 to-orange-600 text-white py-2 px-4 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),"Select Supplier"]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(x,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No suppliers found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c||u?"Try adjusting your search criteria or filters":"No suppliers available in the system"}),e.jsx(s,{onClick:()=>D(!0),icon:e.jsx(o,{size:18}),className:"bg-gradient-to-r from-orange-500 to-amber-600 text-white",children:"Add New Supplier"})]})}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 text-center",children:F.length>0?"Select a supplier to continue with your purchase order":"No suppliers match your criteria"}),e.jsx(s,{onClick:()=>D(!0),icon:e.jsx(o,{size:20}),className:"w-full py-4 bg-gradient-to-r from-orange-500 to-amber-600 text-white text-lg font-semibold",children:"Add New Supplier"})]})})]}),e.jsx(he,{isOpen:P,onClose:()=>D(!1),onSupplierCreated:e=>{D(!1),n(e),l()}}),A&&e.jsx(pe,{supplier:{...A,contact_person:A.contactPerson,is_active:A.isActive,created_at:A.lastOrderDate||(new Date).toISOString(),updated_at:(new Date).toISOString()},isOpen:O,onClose:()=>{I(!1),T(null)},onEdit:e=>{const s={id:e.id,name:e.name,company_name:e.company_name,description:e.description,contact_person:e.contact_person,email:e.email,phone:e.phone,whatsapp:e.whatsapp,address:e.address,city:e.city,country:e.country,tax_id:e.tax_id,payment_terms:e.payment_terms,preferred_currency:e.preferred_currency,exchange_rate:e.exchange_rate,notes:e.notes,rating:e.rating,is_active:e.is_active,created_at:e.created_at,updated_at:e.updated_at};L(s),I(!1),_(!0)}}),E&&$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:e.jsx(be,{supplier:$,onSubmit:async e=>{if($)try{U(!0);await a($.id,e);w.success("Supplier updated successfully!"),_(!1),L(null)}catch(s){const e=s instanceof Error?s.message:"Failed to update supplier";w.error(e)}finally{U(!1)}},onCancel:()=>{_(!1),L(null)},loading:R})})})]}):null},Me=({isOpen:s,onClose:t,onLoadDraft:a,onSaveDraft:r,currentDraft:l})=>{const[n,i]=d.useState([]);d.useState(!1);const[o,x]=d.useState(""),[m,u]=d.useState(!1);d.useEffect(()=>{s&&g()},[s]);const g=()=>{try{const e=localStorage.getItem("purchase_order_drafts");if(e){const s=JSON.parse(e);i(s.sort((e,s)=>new Date(s.updatedAt).getTime()-new Date(e.updatedAt).getTime()))}}catch(e){w.error("Failed to load drafts")}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Purchase Order Drafts"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(S,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(C,{className:"w-4 h-4"}),"Save Current Draft"]}),m&&e.jsx("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:e=>x(e.target.value),placeholder:"Enter draft name...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:()=>{if(!o.trim())return void w.error("Please enter a draft name");if(!l||!l.supplier||!l.cartItems||0===l.cartItems.length)return void w.error("No purchase order data to save");const e={id:`draft_${Date.now()}`,name:o.trim(),supplier:l.supplier,cartItems:l.cartItems,currency:l.currency,paymentTerms:l.paymentTerms||"net_30",notes:l.notes||"",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};try{const s=[e,...JSON.parse(localStorage.getItem("purchase_order_drafts")||"[]")];localStorage.setItem("purchase_order_drafts",JSON.stringify(s)),i(s),x(""),u(!1),r(e),w.success(`Draft saved: ${e.name}`)}catch(s){w.error("Failed to save draft")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Save"}),e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cancel"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Saved Drafts"}),0===n.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(c,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No drafts saved yet"}),e.jsx("p",{className:"text-sm",children:"Save your current purchase order as a draft to continue later"})]}):e.jsx("div",{className:"grid gap-4",children:n.map(s=>{return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm text-gray-600",children:[s.supplier&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsxs("span",{children:["Supplier: ",s.supplier.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.cartItems.length," items"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{children:["Updated: ",(r=s.updatedAt,new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>(e=>{a(e),t(),w.success(`Loaded draft: ${e.name}`)})(s),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Load"}),e.jsx("button",{onClick:()=>(e=>{try{const s=n.filter(s=>s.id!==e);localStorage.setItem("purchase_order_drafts",JSON.stringify(s)),i(s),w.success("Draft deleted")}catch(s){w.error("Failed to delete draft")}})(s.id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:"Delete"})]})]})},s.id);var r})})]})]})]})}):null},qe=({isOpen:s,onClose:t,onSave:a,initialData:r})=>{const[l,n]=d.useState({expectedDelivery:"",shippingAddress:{street:"",city:"Dar es Salaam",region:"Dar es Salaam",country:"Tanzania",postalCode:""},billingAddress:{street:"",city:"Dar es Salaam",region:"Dar es Salaam",country:"Tanzania",postalCode:""},shippingMethod:"standard",trackingNumber:"",notes:""}),[i,c]=d.useState(!0),[o,x]=d.useState(!1);d.useEffect(()=>{s&&r&&n(e=>({...e,...r,shippingAddress:{...e.shippingAddress,...r.shippingAddress},billingAddress:{...e.billingAddress,...r.billingAddress}}))},[s,r]),d.useEffect(()=>{i&&n(e=>({...e,billingAddress:e.shippingAddress}))},[i,l.shippingAddress]);const m=(e,s,t)=>{n(t?a=>({...a,[t+"Address"]:{...a[t+"Address"],[e]:s}}):t=>({...t,[e]:s}))};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Shipping Configuration"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(S,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(D,{className:"w-4 h-4 inline mr-2"}),"Expected Delivery Date"]}),e.jsx("input",{type:"date",value:l.expectedDelivery,onChange:e=>m("expectedDelivery",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:(new Date).toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(h,{className:"w-4 h-4 inline mr-2"}),"Shipping Method"]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{value:"standard",label:"Standard Shipping",description:"5-7 business days"},{value:"express",label:"Express Shipping",description:"2-3 business days"},{value:"overnight",label:"Overnight Shipping",description:"Next business day"},{value:"pickup",label:"Store Pickup",description:"Available for pickup"}].map(s=>e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"shippingMethod",value:s.value,checked:l.shippingMethod===s.value,onChange:e=>m("shippingMethod",e.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.label}),e.jsx("div",{className:"text-sm text-gray-600",children:s.description})]})]},s.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(y,{className:"w-4 h-4 inline mr-2"}),"Shipping Address"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Street Address",value:l.shippingAddress.street,onChange:e=>m("street",e.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("input",{type:"text",placeholder:"City",value:l.shippingAddress.city,onChange:e=>m("city",e.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Region/State",value:l.shippingAddress.region,onChange:e=>m("region",e.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Postal Code",value:l.shippingAddress.postalCode,onChange:e=>m("postalCode",e.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Country",value:l.shippingAddress.country,onChange:e=>m("country",e.target.value,"shipping"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",id:"useSameAddress",checked:i,onChange:e=>c(e.target.checked),className:"mr-2"}),e.jsx("label",{htmlFor:"useSameAddress",className:"text-sm font-medium text-gray-700",children:"Use same address for billing"})]}),!i&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Billing Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Street Address",value:l.billingAddress.street,onChange:e=>m("street",e.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("input",{type:"text",placeholder:"City",value:l.billingAddress.city,onChange:e=>m("city",e.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Region/State",value:l.billingAddress.region,onChange:e=>m("region",e.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Postal Code",value:l.billingAddress.postalCode,onChange:e=>m("postalCode",e.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Country",value:l.billingAddress.country,onChange:e=>m("country",e.target.value,"billing"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(A,{className:"w-4 h-4 inline mr-2"}),"Tracking Number (Optional)"]}),e.jsx("input",{type:"text",placeholder:"Enter tracking number if available",value:l.trackingNumber,onChange:e=>m("trackingNumber",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Shipping Notes (Optional)"}),e.jsx("textarea",{placeholder:"Any special shipping instructions...",value:l.notes,onChange:e=>m("notes",e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if(l.expectedDelivery)if(l.shippingAddress.street&&l.shippingAddress.city)if(i||l.billingAddress.street&&l.billingAddress.city){x(!0);try{await a(l),w.success("Shipping configuration saved"),t()}catch(e){w.error("Failed to save shipping configuration")}finally{x(!1)}}else w.error("Please complete billing address");else w.error("Please complete shipping address");else w.error("Please select expected delivery date")},disabled:o,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(C,{className:"w-4 h-4"}),o?"Saving...":"Save Configuration"]})]})]})}):null},Ve=({isOpen:s,onClose:t,product:a,currency:l,onAddToCart:n,onProductUpdated:i})=>{var c;const o=ve.find(e=>"TZS"===e.code)||ve[0],x=l||o,[m,u]=d.useState(null),[p,b]=d.useState(1),[j,f]=d.useState(""),[v,y]=d.useState(!1),[N,C]=d.useState(x),[k,P]=d.useState(1),[z]=d.useState(1),[M,q]=d.useState(2),[V,Q]=d.useState(new Map),[K,B]=d.useState(!1),[H,Y]=d.useState(null),[G,J]=d.useState(!1),W=r(),{history:X,stats:ee,isLoading:se}=ke(null==a?void 0:a.id),[te,ae]=d.useState("details");d.useEffect(()=>{l&&C(l)},[l]);const re=N||x;d.useEffect(()=>{if(a&&!m){const e=Se(a);e&&(u(e),q(2))}},[a,m]),d.useEffect(()=>{if(!v)if(a&&(null==ee?void 0:ee.lastCostPrice)&&ee.lastCostPrice>0)f(ee.lastCostPrice.toString());else if(a){const e=a.costPrice||.7*(a.price||0);e>0&&f(e.toString())}},[ee,a,v]),d.useEffect(()=>{y(!1)},[null==a?void 0:a.id]),d.useEffect(()=>{if(s&&(null==a?void 0:a.id)){if((H?(new Date).getTime()-H.getTime():1/0)<3e4&&V.has(a.id))return;const e=setTimeout(()=>{le()},100);return()=>clearTimeout(e)}},[s,null==a?void 0:a.id]);const le=async()=>{if(null==a?void 0:a.id)try{B(!0);const e=xe.getInstance(),s=await e.getStockLevels([a.id]),t=new Map;Object.entries(s).forEach(([e,s])=>{const a=s.reduce((e,s)=>e+s.quantity,0);t.set(e,a)}),Q(t),Y(new Date)}catch(e){}finally{B(!1)}},ne=d.useMemo(()=>(null==a?void 0:a.images)&&0!==a.images.length?a.images.map((e,s)=>({id:`temp-${a.id}-${s}`,url:e,thumbnailUrl:e,fileName:`product-image-${s+1}`,fileSize:0,isPrimary:0===s,uploadedAt:(new Date).toISOString()})):[],[null==a?void 0:a.images,null==a?void 0:a.id]);if(!(s&&a&&re&&l))return null;const ie=Ce(a),de=parseFloat(j)||0,ce=(null==a?void 0:a.id)&&V.get(a.id)||0,oe=(()=>{if(!a.variants||0===a.variants.length)return a.stockQuantity??a.totalQuantity??0;return a.variants.filter(e=>!(e.parent_variant_id||"imei_child"===e.variant_type||"imei_child"===e.variantType||e.name&&e.name.toLowerCase().includes("imei:"))).reduce((e,s)=>e+(s.stockQuantity??s.quantity??0),0)})(),ue=ce||oe,ge=de*p,he=0===ue?{status:"Out of Stock",color:"text-red-600",bg:"bg-red-50",border:"border-red-200"}:ue<=M?{status:"Below Min Stock",color:"text-red-600",bg:"bg-red-50",border:"border-red-200"}:ue<=5?{status:"Low Stock",color:"text-amber-600",bg:"bg-amber-50",border:"border-amber-200"}:{status:"In Stock",color:"text-green-600",bg:"bg-green-50",border:"border-green-200"},pe=e=>{b(Math.max(1,p+e))},be=e=>{q(Math.max(0,M+e))},fe=e=>re.code===l.code?e:e*k;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsx("div",{className:"w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"rounded-lg border border-gray-300 bg-white p-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Product Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review and customize before adding to purchase order"})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"border-b border-gray-300 px-6",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ae("details"),className:"px-6 py-3 font-medium text-sm transition-colors relative "+("details"===te?"text-orange-600 border-b-2 border-orange-600":"text-gray-600 hover:text-gray-900"),children:"Product Details"}),e.jsxs("button",{onClick:()=>ae("history"),className:"px-6 py-3 font-medium text-sm transition-colors relative "+("history"===te?"text-orange-600 border-b-2 border-orange-600":"text-gray-600 hover:text-gray-900"),children:["Purchase History",X.length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-orange-100 text-orange-600 text-xs rounded-full",children:X.length})]})]})}),e.jsxs("div",{className:"p-6",children:["details"===te&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Images"}),ne.length>0?e.jsx(me,{images:ne,productName:a.name,size:"xl",className:"w-[392px] h-[392px] rounded-lg"}):e.jsx("div",{className:"w-full h-64 bg-orange-100 rounded-lg flex items-center justify-center border-2 border-dashed border-orange-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"w-12 h-12 text-orange-500 mx-auto mb-2"}),e.jsx("p",{className:"text-orange-600 font-medium",children:"No images available"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Basic Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Product Name:"}),e.jsx("div",{className:"font-medium text-gray-900",children:a.name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"SKU:"}),e.jsx("div",{className:"font-medium text-gray-900 font-mono",children:a.sku})]})]}),a.barcode&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"QrCode:"}),e.jsx("div",{className:"font-medium text-gray-900 font-mono",children:a.barcode})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Category:"}),e.jsx("div",{className:"font-medium text-gray-900",children:a.categoryName||"Uncategorized"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Stock Availability"}),e.jsxs("div",{className:`${he.bg} rounded-lg border ${he.border} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+("In Stock"===he.status?"bg-green-500":"Low Stock"===he.status?"bg-amber-500":"bg-red-500")}),e.jsx("span",{className:`text-xs font-semibold ${he.color} uppercase tracking-wide`,children:he.status})]}),!K&&V.has(a.id)&&e.jsxs("div",{className:"flex items-center gap-1 bg-green-100 px-1.5 py-0.5 rounded-full",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-green-700",children:"Live"})]})]}),e.jsx("div",{className:"text-center py-3",children:K?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Loading stock..."})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:`text-4xl font-bold ${he.color}`,children:ue}),e.jsx("div",{className:"text-sm font-medium text-gray-600 mt-1",children:"units available"})]})}),M>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Min threshold: ",e.jsxs("strong",{className:"text-gray-900",children:[M," units"]})]})]}),ue<=M&&e.jsxs("div",{className:"flex items-center gap-1 bg-red-100 px-2 py-0.5 rounded-full",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-xs font-bold text-red-700 uppercase",children:"Alert"})]})]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[ie&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Select Variant"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:null==(c=a.variants)?void 0:c.map(s=>e.jsx("div",{onClick:()=>(e=>{u(e);const s=(null==ee?void 0:ee.lastCostPrice)||a.costPrice||.7*(a.price||0);f(s.toString())})(s),className:"p-4 border-2 rounded-lg cursor-pointer transition-all duration-200 "+((null==m?void 0:m.id)===s.id?"border-orange-300 bg-orange-50":"border-gray-200 hover:border-orange-200 hover:bg-orange-25"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",s.sku]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",K?"Loading...":s.quantity||0,K&&e.jsx("span",{className:"ml-1 text-orange-500",children:"ðŸ”„"}),!K&&V.has(a.id)&&e.jsx("span",{className:"ml-1 text-green-500",title:"Real-time data",children:"âœ“"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-gray-900",children:je(s.sellingPrice||s.price||s.costPrice||0,l).replace(/\.00$/,"").replace(/\.0$/,"")}),(null==m?void 0:m.id)===s.id&&e.jsx(g,{className:"w-5 h-5 text-orange-600 mt-1"})]})]})},s.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>pe(-1),disabled:p<=1,className:"w-10 h-10 flex items-center justify-center bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100 disabled:text-gray-400 rounded-lg border border-gray-300",children:e.jsx("span",{className:"text-lg font-bold",children:"-"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",value:p,onChange:e=>{const s=parseInt(e.target.value)||1;b(Math.max(1,s))},min:"1",className:"w-full text-center text-xl font-bold text-gray-900 border-2 border-gray-300 rounded-lg py-2 px-4 focus:border-orange-500 focus:outline-none"})}),e.jsx("button",{type:"button",onClick:()=>pe(1),className:"w-10 h-10 flex items-center justify-center bg-gray-200 hover:bg-gray-300 rounded-lg border border-gray-300",children:e.jsx("span",{className:"text-lg font-bold",children:"+"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900",children:"Minimum Stock Level"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>be(-1),disabled:M<=0,className:"w-10 h-10 flex items-center justify-center bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100 disabled:text-gray-400 rounded-lg border border-gray-300",children:e.jsx("span",{className:"text-lg font-bold",children:"-"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",value:M,onChange:e=>{const s=parseInt(e.target.value)||0;q(Math.max(0,s))},min:"0",className:"w-full text-center text-xl font-bold text-gray-900 border-2 border-gray-300 rounded-lg py-2 px-4 focus:border-amber-500 focus:outline-none"})}),e.jsx("button",{type:"button",onClick:()=>be(1),className:"w-10 h-10 flex items-center justify-center bg-gray-200 hover:bg-gray-300 rounded-lg border border-gray-300",children:e.jsx("span",{className:"text-lg font-bold",children:"+"})})]}),e.jsx("div",{className:"bg-amber-50 rounded-lg border border-amber-300 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-amber-700",children:M>0?"Low stock alert set":"No alert set"}),e.jsx("div",{className:"text-xs text-amber-600",children:M>0?`Alert when stock falls below ${M} units`:"Set a threshold to get low stock alerts"})]})]}),M>0&&e.jsx("div",{className:"w-4 h-4 bg-amber-500 rounded-full"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900",children:"Cost Price (per unit)"}),(null==ee?void 0:ee.lastCostPrice)&&ee.lastCostPrice>0&&e.jsxs("button",{type:"button",onClick:()=>{f(ee.lastCostPrice.toString()),y(!1),w.success("Last purchase price filled!")},className:"text-xs text-orange-600 hover:text-orange-700 font-medium flex items-center gap-1 px-2 py-1 rounded hover:bg-orange-50 transition-colors",children:[e.jsx(L,{className:"w-3 h-3"}),"Use Last: ",je(ee.lastCostPrice,re)]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white border-2 border-gray-300 rounded-lg focus-within:border-orange-500",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center gap-2 p-2 bg-gray-200 rounded",children:e.jsx("select",{value:re.code,onChange:e=>{const s=ve.find(s=>s.code===e.target.value);if(s&&(C(s),s.code!==l.code)){const e=(t=s.code,a=l.code,(null==(r={USD:{KES:150,EUR:.85,CNY:7.2},KES:{USD:.0067,EUR:.0057,CNY:.048},EUR:{USD:1.18,KES:175,CNY:8.5},CNY:{USD:.14,KES:21,EUR:.12}}[t])?void 0:r[a])||1);P(e)}var t,a,r},className:"bg-transparent border-none text-gray-900 font-medium text-sm focus:outline-none focus:ring-0 cursor-pointer pr-6",children:ve.map(s=>e.jsxs("option",{value:s.code,children:[s.flag," ",s.code]},s.code))})}),e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:j?(ye=parseFloat(j),ye.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).replace(/\.00$/,"").replace(/\.0$/,"")):"",onChange:e=>{const s=e.target.value.replace(/,/g,"");(""===s||parseFloat(s)>=0)&&(f(s),y(!0))},onFocus:e=>{j&&parseFloat(j)>0&&e.target.select()},onClick:e=>{j&&parseFloat(j)>0&&e.target.select()},placeholder:a.costPrice?a.costPrice.toString():"0",className:"w-full border-0 focus:outline-none focus:ring-0 text-xl font-bold text-gray-900 placeholder-gray-400 bg-transparent",step:"0.01",min:"0"})}),e.jsx("div",{className:"flex-shrink-0",children:re.code!==l.code&&j&&parseFloat(j)>0&&e.jsxs("div",{className:"bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded font-medium",children:["â‰ˆ ",je(fe(parseFloat(j)),l).replace(/\.00$/,"").replace(/\.0$/,"")]})})]}),re.code!==l.code&&j&&parseFloat(j)>0&&e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-blue-700",children:["Price in ",re.code,": ",je(de,re).replace(/\.00$/,"").replace(/\.0$/,"")]}),e.jsx(E,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-blue-700",children:["Converted to ",l.code,": ",je(fe(de),l).replace(/\.00$/,"").replace(/\.0$/,"")]})]})}),(()=>{const s=(null==ee?void 0:ee.lastCostPrice)||a.costPrice,t=!!(null==ee?void 0:ee.lastCostPrice);return s?e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:t?"Last purchase price:":"Suggested cost:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:je(s,re).replace(/\.00$/,"").replace(/\.0$/,"")}),t&&e.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full font-medium",children:"Recent"})]}):null})()]}),e.jsxs("div",{className:"bg-white rounded-lg border-2 border-gray-300 overflow-hidden",children:[e.jsx("div",{className:"bg-orange-500 px-5 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-orange-500"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Order Summary"})]})}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b-2 border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide",children:"Product"}),e.jsx(A,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 text-base",children:a.name}),m&&"Default"!==m.name&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Variant:"}),e.jsx("span",{className:"text-xs font-medium text-gray-700 bg-gray-100 px-2 py-0.5 rounded",children:m.name})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded flex items-center justify-center",children:e.jsx(A,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-blue-600 uppercase",children:"Quantity"}),e.jsx("div",{className:"text-sm text-blue-700",children:"Order units"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:p}),e.jsx("div",{className:"text-xs text-blue-600",children:"units"})]})]}),j&&parseFloat(j)>0&&e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded flex items-center justify-center",children:e.jsx(R,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-purple-600 uppercase",children:"Unit Cost"}),e.jsx("div",{className:"text-sm text-purple-700",children:"Price per unit"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-purple-900",children:je(de,re).replace(/\.00$/,"").replace(/\.0$/,"")}),e.jsx("div",{className:"text-xs text-purple-600",children:re.code})]})]})]}),re.code!==l.code&&j&&parseFloat(j)>0&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700 uppercase",children:"Exchange Rate"})]}),e.jsxs("span",{className:"text-xs font-mono text-blue-900",children:["1 ",re.code," = ",Math.round(k)," ",l.code]})]})}),e.jsx("div",{className:"border-t-2 border-dashed border-gray-300 my-4"}),j&&de>0&&e.jsx("div",{className:"bg-orange-500 rounded-lg p-5 border-2 border-orange-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-white uppercase tracking-wide mb-1",children:"Total Amount"}),e.jsxs("div",{className:"text-xs text-orange-100",children:["in ",l.code]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-3xl font-bold text-white",children:je(re.code!==l.code?fe(ge):ge,l).replace(/\.00$/,"").replace(/\.0$/,"")})})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Calculation:"}),e.jsxs("span",{className:"font-mono text-gray-900",children:[p," Ã— ",je(de,re).replace(/\.00$/,"").replace(/\.0$/,"")]})]}),re.code!==l.code&&e.jsxs("div",{className:"flex justify-between items-center text-sm pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-600",children:"Currency:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:re.code}),e.jsx(E,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.code})]})]})]})]})]})]})]}),"history"===te&&e.jsx("div",{className:"space-y-6",children:se?e.jsx("div",{className:"bg-gray-50 rounded-lg border border-gray-300 p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading purchase history..."})]})}):ee&&0!==X.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Total Orders"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:ee.totalOrders})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-700",children:"Total Ordered"})]}),e.jsx("div",{className:"text-3xl font-bold text-purple-900",children:ee.totalQuantityOrdered}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:["Received: ",ee.totalQuantityReceived]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700",children:"Avg Cost"})]}),e.jsx("div",{className:"text-xl font-bold text-green-900",children:je(ee.averageCostPrice,l)})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-4 border border-amber-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-xs font-medium text-amber-700",children:"Last Order"})]}),e.jsx("div",{className:"text-sm font-bold text-amber-900",children:ee.lastOrderDate?new Date(ee.lastOrderDate).toLocaleDateString():"N/A"})]})]}),ee.lowestCostPrice&&ee.highestCostPrice&&e.jsxs("div",{className:"bg-gray-100 rounded-lg p-6 border border-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Price Range"}),ee.lastCostPrice&&e.jsx("div",{className:"flex items-center gap-1",children:ee.lastCostPrice<ee.averageCostPrice?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Below average"})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm text-red-600 font-medium",children:"Above average"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Lowest"}),e.jsx("div",{className:"font-bold text-green-700 text-lg",children:je(ee.lowestCostPrice,l)})]}),e.jsx("div",{className:"flex-1 mx-6",children:e.jsx("div",{className:"h-3 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Highest"}),e.jsx("div",{className:"font-bold text-red-700 text-lg",children:je(ee.highestCostPrice,l)})]})]})]}),X.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Order History"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[X.length," orders"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:X.map(s=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-300 p-4 hover:border-blue-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-mono text-base font-medium text-blue-600",children:["#",s.orderNumber]}),e.jsx("span",{className:"text-xs px-3 py-1 rounded-full font-medium "+("completed"===s.poStatus||"received"===s.poStatus?"bg-green-100 text-green-700":"cancelled"===s.poStatus?"bg-red-100 text-red-700":"shipped"===s.poStatus||"partial_received"===s.poStatus?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:s.poStatus.replace(/_/g," ")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Supplier"}),e.jsx("div",{className:"font-medium text-gray-900 mt-1",children:s.supplierName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Date"}),e.jsx("div",{className:"font-medium text-gray-900 mt-1",children:new Date(s.orderDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Quantity"}),e.jsxs("div",{className:"font-medium text-gray-900 mt-1",children:[s.receivedQuantity,"/",s.quantity," units",s.receivedQuantity===s.quantity&&e.jsx(F,{className:"w-4 h-4 text-green-600 inline ml-1"})]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cost per unit"}),e.jsx("div",{className:"font-bold text-gray-900 text-base",children:je(s.costPrice,l)})]})})]},s.id))})]})]}):e.jsx("div",{className:"bg-gray-50 rounded-lg border border-gray-300 p-12",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(h,{className:"w-10 h-10 text-blue-500"})}),e.jsx("p",{className:"text-gray-600 font-medium text-lg",children:"No purchase history"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This will be the first order for this product"})]})})})]}),"details"===te&&e.jsx("div",{className:"pt-6 border-t border-gray-300 mt-6 px-6 pb-6",children:e.jsx("button",{type:"button",onClick:async()=>{if(m)if(de<=0)w.error('Please enter a cost price above 0 in the "Cost Price (per unit)" field');else if(p<z)w.error(`Minimum order quantity is ${z} units`);else try{J(!0);const e=re.code!==l.code?fe(de):de;if((await W.updateProductVariantCostPrice(m.id,e)).ok&&(w.success("Cost price updated and saved!"),i)){const s={...a,costPrice:e,minimumStock:M};i(s)}const s={...m,costPrice:e};n(a,s,p),w.success(`Added ${p}x ${a.name} to purchase order`),t()}catch(e){w.error("Failed to save cost price, but product will still be added to cart");const s={...m,costPrice:re.code!==l.code?fe(de):de};n(a,s,p),w.success(`Added ${p}x ${a.name} to purchase order`),t()}finally{J(!1)}else w.error("Please select a variant")},disabled:!m||de<=0||G,className:"w-full py-4 bg-orange-500 text-white hover:bg-orange-600 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed text-lg font-semibold rounded-lg border border-orange-600 disabled:border-gray-400 flex items-center justify-center gap-2",children:G?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Saving Price..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{size:20}),e.jsx("span",{children:"Add to Purchase Order"})]})})})]})})});var ye},Qe=Ie({name:$e().min(1,"Product name must be provided").max(100,"Product name must be less than 100 characters"),description:$e().max(200,"Description must be less than 200 characters").optional(),sku:$e().min(1,"SKU must be provided").max(50,"SKU must be less than 50 characters"),categoryId:$e().min(1,"Category must be selected"),condition:Le(["new","used","refurbished"],{errorMap:()=>({message:"Please select a condition"})}),notes:$e().optional()}),Ke=({isOpen:a,onClose:r,onProductAdded:c,currency:x})=>{const{categories:m,suppliers:u,createProduct:g,loadProducts:h,isCategoriesLoading:p}=l(),{currentUser:b}=n(),[j,f]=d.useState(!1),[v,y]=d.useState({}),[N,C]=d.useState(!1),k=Ae(),[P,D]=d.useState(!1),[T,O]=d.useState(null),$=()=>we(),[L,E]=d.useState({name:"",sku:$(),categoryId:null,condition:"new",description:"",notes:""}),[_,R]=d.useState(!1),[U,Z]=d.useState(!1);d.useEffect(()=>{a&&E(e=>({...e,sku:$()}))},[a]),d.useEffect(()=>{if(a&&0===m.length){const{loadCategories:e}=l.getState();e().catch(e=>{})}},[a,m.length]);const F=(e,s)=>{E(t=>({...t,[e]:s}))};d.useEffect(()=>{const e=setTimeout(()=>{L.name&&(async e=>{if(e.trim()){R(!0);try{Z(!1)}catch(s){}finally{R(!1)}}else Z(!1)})(L.name)},500);return()=>clearTimeout(e)},[L.name]);const z=(e,s,t)=>{O(t=>({...t,...e,costPrice:s.costPrice||e.costPrice,price:s.price||e.price})),c(e),k.show(`${e.name} has been added to your purchase order!`,{title:"Product Added! âœ…",icon:Oe.productAdded,autoCloseDelay:3e3}),r()};return De(a),a?P&&T?e.jsx(Ve,{isOpen:!0,onClose:()=>{D(!1),O(null),E({name:"",sku:$(),categoryId:null,condition:"new",description:"",notes:""})},product:T,currency:x,onAddToCart:z,onProductUpdated:e=>{O(e)}}):e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:r,children:[e.jsx("div",{className:"w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsxs(t,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Add Product to Purchase Order"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add a new product for your purchase order"})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:async e=>{var s,t,a,r,l;if(e.preventDefault(),y({}),(()=>{const e={};try{const e={...L,sku:L.sku.trim()||$()};return Qe.parse(e),y({}),!0}catch(s){return s instanceof Ee&&s.issues.forEach(s=>{s.path.length>0&&(e[s.path[0]]=s.message)}),y(e),!1}})())if(U)w.error("A product with this name already exists");else{f(!0);try{const e={name:L.name,description:L.description||null,sku:L.sku.trim()||$(),categoryId:L.categoryId||null,condition:L.condition||"new",notes:L.notes||null,metadata:{isPurchaseOrderProduct:!0,createdBy:null==b?void 0:b.id,createdAt:(new Date).toISOString()},variants:[]},n=await g(e);if(n.ok&&n.data){w.success("Product created successfully! Review details before adding to purchase order."),i.clearProducts(),await h(null,!0);const e={id:n.data.id,name:n.data.name,sku:(null==(t=null==(s=n.data.variants)?void 0:s[0])?void 0:t.sku)||L.sku.trim()||$(),description:n.data.description,categoryName:(null==(a=m.find(e=>e.id===n.data.categoryId))?void 0:a.name)||"Uncategorized",condition:n.data.condition,costPrice:0,price:0,barcode:n.data.barcode,specification:n.data.specification,attributes:n.data.attributes||{},images:n.data.images||[],variants:[{id:n.data.id,name:"Default",sku:(null==(l=null==(r=n.data.variants)?void 0:r[0])?void 0:l.sku)||L.sku.trim()||$(),costPrice:0,price:0,quantity:0,attributes:{}}]};O(e),D(!0)}else w.error(n.message||"Failed to add product")}catch(n){w.error("Failed to add product")}finally{f(!1)}}else w.error("Please fix the errors before submitting")},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Product Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Enter product name",value:L.name,onChange:e=>F("name",e.target.value),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-colors",required:!0}),e.jsx(A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),_&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})})]}),v.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.name}),U&&e.jsx("p",{className:"mt-1 text-sm text-amber-600",children:"âš ï¸ A product with this name already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SKU *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Auto-generated SKU",value:L.sku,onChange:e=>F("sku",e.target.value),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-colors",required:!0}),e.jsx(I,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),v.sku&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.sku})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (optional)"}),e.jsx("div",{className:"relative",children:N?e.jsx("textarea",{value:L.description,onChange:e=>F("description",e.target.value),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-all duration-200 resize-none border-gray-300 focus:border-blue-500",placeholder:"Brief description...",maxLength:200,rows:3,onBlur:()=>C(!1),autoFocus:!0}):e.jsx("input",{type:"text",value:L.description,onChange:e=>F("description",e.target.value),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-all duration-200 border-gray-300 focus:border-blue-500",placeholder:"Brief description...",maxLength:200,onFocus:()=>C(!0)})}),v.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.description}),N&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[L.description.length,"/200 characters"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),e.jsx(Pe,{value:L.categoryId,onChange:e=>F("categoryId",e),categories:m,placeholder:"Select a category",required:!0,error:v.categoryId,disabled:p})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Condition"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"new",label:"New",color:"bg-green-500 hover:bg-green-600 border-green-500"},{value:"used",label:"Used",color:"bg-blue-500 hover:bg-blue-600 border-blue-500"},{value:"refurbished",label:"Refurbished",color:"bg-purple-500 hover:bg-purple-600 border-purple-500"}].map(s=>e.jsx("button",{type:"button",onClick:()=>F("condition",s.value),className:"py-3 px-4 rounded-lg border-2 transition-all duration-200 font-medium "+(L.condition===s.value?`${s.color} text-white`:"bg-gray-100 hover:bg-gray-200 border-gray-300 text-gray-700"),children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Order Notes"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions"}),e.jsx("textarea",{placeholder:"Any special requirements, delivery instructions, or notes for this order (optional)",value:L.notes,onChange:e=>F("notes",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",rows:3})]})]}),e.jsx("div",{className:"pt-6 border-t border-gray-200",children:e.jsx(s,{type:"submit",disabled:j||_,className:"w-full py-4 bg-orange-600 text-white hover:bg-orange-700 text-lg font-semibold",icon:j?void 0:e.jsx(o,{size:20}),children:j?"Creating Product...":"Create Product & Review"})})]})]})}),e.jsx(Te,{...k.props})]}):null},Be=({item:s,index:t,currency:a,exchangeRates:r,isLatest:l=!1,onUpdateQuantity:n,onUpdateCostPrice:i,onRemove:c})=>{const[x,m]=d.useState(!1),[u,g]=d.useState(!1),[h,b]=d.useState(s.costPrice.toString());let j;try{j=ue()}catch(S){j={show_product_images:!0,enable_animations:!0}}const f=d.useMemo(()=>s.images&&0!==s.images.length?s.images.map((e,t)=>({id:`temp-${s.productId}-${t}`,url:e,thumbnailUrl:e,fileName:`product-image-${t+1}`,fileSize:0,isPrimary:0===t,uploadedAt:(new Date).toISOString()})):[],[s.images,s.productId]),v=d.useMemo(()=>{if(!(null==r?void 0:r.trim()))return null;const e=[/1\s*([A-Z]{3})\s*=\s*([\d,]+\.?\d*)\s*([A-Z]{3})/i,/([\d,]+\.?\d*)\s*([A-Z]{3})\s*=\s*1\s*([A-Z]{3})/i,/([\d,]+\.?\d*)/i];for(const s of e){const e=r.match(s);if(e)if(4===e.length){const s=e[1]||e[3],t=e[3]||e[1],r=parseFloat(e[2].replace(/,/g,""));if(s===a.code&&"TZS"===t)return r;if("TZS"===s&&t===a.code)return 1/r}else if(2===e.length)return parseFloat(e[1].replace(/,/g,""))}return null},[r,a.code]),y=d.useMemo(()=>e=>"TZS"===a.code?e:v?e*v:e,[v,a.code]),N=e=>{const t=Math.max(1,s.quantity+e);n(s.id,t)},w=(()=>{const e=s.currentStock||0;return 0===e?{status:"out",color:"text-red-600",bg:"bg-red-50"}:e<=5?{status:"low",color:"text-amber-600",bg:"bg-amber-50"}:{status:"good",color:"text-green-600",bg:"bg-green-50"}})();return e.jsxs("div",{className:`bg-white border-2 rounded-xl ${(null==j?void 0:j.enable_animations)?"transition-all duration-300":""} ${x?"border-orange-300 shadow-lg":"border-gray-200 hover:border-orange-300 hover:shadow-md"} ${l?"ring-2 ring-orange-200 ring-opacity-50":""}`,children:[e.jsx("div",{className:"p-4 cursor-pointer",onClick:()=>{m(!x)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"relative w-12 h-12 rounded-xl overflow-hidden",children:(null==j?void 0:j.show_product_images)&&f.length>0?e.jsx(me,{images:f,productName:s.name,size:"lg",className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-500 to-amber-600 flex items-center justify-center text-lg font-bold text-white",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-800 truncate text-lg leading-tight",children:s.name}),s.variantName&&"Default"!==s.variantName&&e.jsx("div",{className:"text-sm text-gray-600",children:s.variantName}),e.jsxs("div",{className:"text-lg text-orange-600 mt-1 font-bold",children:[je(s.totalPrice,a),"TZS"!==a.code&&r&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["â‰ˆ ",je(y(s.totalPrice),{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-lg text-sm font-medium",children:[s.quantity,"Ã—"]}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg",children:x?e.jsx(z,{size:16}):e.jsx(M,{size:16})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),c(s.id)},className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-all duration-200",title:"Remove from cart",children:e.jsx(p,{className:"w-4 h-4"})})]})]})}),x&&e.jsx("div",{className:"px-4 pb-4 border-t border-gray-100 bg-gradient-to-br from-orange-50/30 to-amber-50/30",children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"SKU:"}),e.jsx("span",{className:"font-medium",children:s.sku})]}),s.category&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"font-medium",children:s.category})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`flex items-center gap-2 ${w.color}`,children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-gray-600",children:"Current Stock:"}),e.jsx("span",{className:`font-medium px-2 py-1 rounded ${w.bg} ${w.color}`,children:s.currentStock||0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Unit Cost:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:je(s.costPrice,a)}),"TZS"!==a.code&&r&&e.jsxs("div",{className:"text-xs text-blue-600",children:["â‰ˆ ",je(y(s.costPrice),{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cost Price"}),!u&&e.jsx("button",{onClick:()=>g(!0),className:"text-xs text-orange-600 hover:text-orange-700",children:"Edit"})]}),u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",value:h,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",step:"0.01",min:"0",placeholder:"0.00"})}),e.jsx("button",{onClick:()=>{const e=parseFloat(h);!isNaN(e)&&e>0&&i(s.id,e),g(!1)},className:"px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm",children:"Save"}),e.jsx("button",{onClick:()=>{b(s.costPrice.toString()),g(!1)},className:"px-3 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 text-sm",children:"Cancel"})]}):e.jsxs("div",{className:"text-lg font-bold text-orange-600",children:[je(s.costPrice,a),"TZS"!==a.code&&r&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["â‰ˆ ",je(y(s.costPrice),{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-lg p-3 border border-orange-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Order Quantity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>N(-1),disabled:s.quantity<=1,className:"w-8 h-8 flex items-center justify-center border-2 border-orange-300 rounded-lg hover:bg-orange-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Q,{className:"w-4 h-4 text-orange-600"})}),e.jsx("span",{className:"w-12 text-center font-bold text-lg text-gray-900",children:s.quantity}),e.jsx("button",{onClick:()=>N(1),className:"w-8 h-8 flex items-center justify-center border-2 border-orange-300 rounded-lg hover:bg-orange-50 transition-colors",children:e.jsx(o,{className:"w-4 h-4 text-orange-600"})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-orange-600 font-medium",children:"Total Cost:"}),e.jsxs("div",{className:"text-lg font-bold text-orange-700",children:[je(s.totalPrice,a),"TZS"!==a.code&&r&&e.jsxs("div",{className:"text-xs text-blue-600",children:["â‰ˆ ",je(y(s.totalPrice),{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-orange-600 font-medium",children:"Needed:"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[s.quantity," units to stock"]})]})]}),0===(s.currentStock||0)&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-red-600",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsx("span",{children:"Out of stock - Reorder needed"})]})]})]})})]})},He=({isOpen:s,onClose:a})=>{const{purchaseOrders:r,isLoading:n,error:i,loadPurchaseOrders:c,deletePurchaseOrder:o,updatePurchaseOrder:x}=l(),[u,g]=d.useState(""),[h,p]=d.useState("all"),[j,f]=d.useState("all"),[v,y]=d.useState("createdAt"),[N,C]=d.useState("desc"),[k,D]=d.useState("list"),[T,O]=d.useState(null),[I,$]=d.useState(null);d.useEffect(()=>{s&&c()},[s,c]),d.useEffect(()=>{if(!s)return;const e=setInterval(()=>{c()},3e4);return()=>clearInterval(e)},[s,c]),d.useEffect(()=>{if(!s)return;const e=()=>{c()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s,c]);const L=d.useMemo(()=>{let e=r||[];return u&&(e=e.filter(e=>{var s,t,a,r,l;return e.orderNumber.toLowerCase().includes(u.toLowerCase())||(null==(s=e.notes)?void 0:s.toLowerCase().includes(u.toLowerCase()))||(null==(a=null==(t=e.supplier)?void 0:t.name)?void 0:a.toLowerCase().includes(u.toLowerCase()))||(null==(r=e.trackingNumber)?void 0:r.toLowerCase().includes(u.toLowerCase()))||(null==(l=e.currency)?void 0:l.toLowerCase().includes(u.toLowerCase()))})),"all"!==h&&(e=e.filter(e=>e.status===h)),"all"!==j&&(e=e.filter(e=>(e.currency||"TZS")===j)),e.sort((e,s)=>{let t,a;switch(v){case"orderNumber":t=e.orderNumber,a=s.orderNumber;break;case"totalAmount":t=e.totalAmount,a=s.totalAmount;break;case"expectedDelivery":t=e.expectedDeliveryDate||"",a=s.expectedDeliveryDate||"";break;default:t=new Date(e.createdAt).getTime(),a=new Date(s.createdAt).getTime()}return"asc"===N?t>a?1:-1:t<a?1:-1}),e},[r,u,h,j,v,N]),E=async(e,s)=>{try{const t=await x(e,{status:s});t.ok?(w.success(`Order status updated to ${s}`),await c()):w.error(t.message||"Failed to update order status")}catch(t){w.error("Failed to update order status")}},R=async(e,s)=>{try{const t=await x(e,s);t.ok?(w.success("Shipping information updated"),await c(),$(null)):w.error(t.message||"Failed to update shipping information")}catch(t){w.error("Failed to update shipping information")}},U=async e=>{if(window.confirm("Are you sure you want to delete this purchase order?")){const s=await o(e);s.ok?w.success("Purchase order deleted successfully"):w.error(s.message||"Failed to delete purchase order")}},Z=e=>{switch(e){case"sent":return"text-blue-600 bg-blue-100";case"received":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},F=s=>{switch(s){case"sent":return e.jsx(W,{className:"w-4 h-4"});case"received":return e.jsx(J,{className:"w-4 h-4"});default:return e.jsx(P,{className:"w-4 h-4"})}},z=e=>{switch(e){case"pending":return"text-yellow-600 bg-yellow-100";case"packed":return"text-blue-600 bg-blue-100";case"shipped":return"text-indigo-600 bg-indigo-100";case"in_transit":return"text-orange-600 bg-orange-100";case"delivered":return"text-green-600 bg-green-100";case"returned":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},M=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:2}).format(e).replace(".00",""),q=e=>new Date(e).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"});return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity duration-300",onClick:a}),e.jsx("div",{className:"relative w-full max-w-6xl max-h-[90vh] transform transition-all duration-300 scale-100 opacity-100",children:e.jsxs(t,{className:"h-full flex flex-col shadow-2xl border-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(_,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Order Management"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",L.length," ",1===L.length?"order":"orders",")"]})]})]}),e.jsxs("button",{onClick:()=>{c()},className:"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200",title:"Refresh purchase orders",children:[e.jsx(m,{className:"w-4 h-4"}),"Refresh"]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-red-50 hover:text-red-600 rounded-full transition-all duration-200 group",children:e.jsx(S,{className:"w-5 h-5 group-hover:scale-110 transition-transform duration-200"})})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-blue-50",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search orders, suppliers, tracking, currency...",value:u,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm transition-all duration-200 hover:shadow-md focus:shadow-lg"})]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("select",{value:h,onChange:e=>p(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"received",children:"Received"})]}),e.jsxs("select",{value:j,onChange:e=>f(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx("option",{value:"all",children:"All Currencies"}),Array.from(new Set(L.map(e=>e.currency||"TZS"))).map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:v,onChange:e=>y(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx("option",{value:"createdAt",children:"Date Created"}),e.jsx("option",{value:"orderNumber",children:"Order Number"}),e.jsx("option",{value:"shipping",children:"Shipping"}),e.jsx("option",{value:"expectedDelivery",children:"Expected Delivery"})]}),e.jsx("button",{onClick:()=>C("asc"===N?"desc":"asc"),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm",children:e.jsx(K,{className:"w-4 h-4 "+("desc"===N?"rotate-180":"")})}),e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>D("list"),className:"p-2 "+("list"===k?"bg-blue-500 text-white":"bg-white hover:bg-gray-50"),children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>D("grid"),className:"p-2 "+("grid"===k?"bg-blue-500 text-white":"bg-white hover:bg-gray-50"),children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:c,disabled:n,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 text-sm",children:e.jsx(m,{className:"w-4 h-4 "+(n?"animate-spin":"")})})]})]}),e.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:["draft","sent","confirmed","shipping","shipped","received"].map(s=>{const t=L.filter(e=>e.status===s).length;return e.jsx("div",{className:"p-4 rounded-xl cursor-pointer transition-all duration-200 hover:scale-105 "+(h===s?Z(s)+" shadow-lg scale-105":"bg-white hover:bg-blue-50 border border-gray-200 hover:border-blue-300 shadow-sm hover:shadow-md"),onClick:()=>p(h===s?"all":s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium capitalize",children:s}),e.jsx("span",{className:"text-lg font-bold",children:t})]})},s)})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Currency Distribution:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:(()=>{const s=L.reduce((e,s)=>{const t=s.currency||"TZS";return e[t]||(e[t]={count:0,total:0}),e[t].count+=1,e[t].total+=s.totalAmount,e},{});return Object.entries(s).map(([s,t])=>e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600",children:s}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:t.count}),e.jsx("div",{className:"text-xs text-gray-500",children:M(t.total)})]},s))})()})]})]}),i&&e.jsx("div",{className:"mx-6 mt-4 p-4 border border-red-200 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{children:i})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n?e.jsxs("div",{className:"flex items-center justify-center h-32",children:[e.jsx(m,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading orders..."})]}):0===L.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No orders found"}),e.jsx("p",{className:"text-gray-600",children:u||"all"!==h?"Try adjusting your search or filters":"No purchase orders available"})]}):e.jsx("div",{className:"grid"===k?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-3",children:L.map(s=>e.jsx(Ye,{order:s,onStatusUpdate:E,onShippingUpdate:R,onDelete:U,isExpanded:T===s.id,onToggleExpanded:()=>O(T===s.id?null:s.id),isEditingShipping:I===s.id,onEditShipping:e=>$(I===e?null:e),formatCurrency:M,formatDate:q,getStatusColor:Z,getStatusIcon:F,getShippingStatusColor:z,viewMode:k},s.id))})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",L.length," of ",(null==r?void 0:r.length)||0," orders"]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Total Value: ",M(L.reduce((e,s)=>e+s.totalAmount,0))]}),e.jsxs("span",{className:"text-gray-600",children:["In Transit: ",L.filter(e=>["shipping","shipped"].includes(e.status)).length]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 mb-2",children:"Currency Breakdown:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{const s=L.reduce((e,s)=>{const t=s.currency||"TZS";return e[t]||(e[t]=0),e[t]+=s.totalAmount,e},{});return Object.entries(s).map(([s,t])=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white text-blue-700 border border-blue-200",children:[s,": ",M(t)]},s))})()})]})]})]})})]}):null},Ye=({order:t,onStatusUpdate:a,onShippingUpdate:r,onDelete:l,isExpanded:n,onToggleExpanded:i,isEditingShipping:o,onEditShipping:x,formatCurrency:g,formatDate:h,getStatusColor:p,getStatusIcon:b,getShippingStatusColor:f,viewMode:v})=>{var y;const[N,w]=d.useState({trackingNumber:t.trackingNumber||"",estimatedDelivery:t.estimatedDelivery||"",shippingNotes:t.shippingNotes||"",shippingStatus:t.shippingStatus||"pending"}),S=(e=>{switch(e){case"sent":return["received"];case"received":return[];default:return["sent"]}})(t.status);return e.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white hover:shadow-lg transition-all duration-200 hover:scale-[1.02] "+("list"===v?"p-4":"p-5"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.orderNumber}),t.currency&&"TZS"!==t.currency&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200",children:["ðŸ’± ",t.currency]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(null==(y=t.supplier)?void 0:y.name)||"Unknown Supplier"," â€¢ ",h(t.createdAt)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-medium shadow-sm ${p(t.status)}`,children:[b(t.status),e.jsx("span",{className:"capitalize font-semibold",children:t.status})]}),e.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-100 rounded",children:n?e.jsx(z,{className:"w-4 h-4"}):e.jsx(M,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsx("span",{className:"font-semibold",children:g(t.totalAmount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Items:"}),e.jsx("span",{children:t.items.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Currency:"}),e.jsx("span",{className:"font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-full text-xs",children:t.currency||"TZS"})]})]}),n&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[["shipping","shipped","received"].includes(t.status)&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Shipping Information"]}),e.jsx("button",{onClick:()=>x(t.id),className:"text-blue-600 hover:text-blue-700 text-sm",children:o?"Cancel":"Edit"})]}),o?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tracking Number"}),e.jsx("input",{type:"text",value:N.trackingNumber,onChange:e=>w({...N,trackingNumber:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500",placeholder:"Enter tracking number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Shipping Status"}),e.jsxs("select",{value:N.shippingStatus,onChange:e=>w({...N,shippingStatus:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"packed",children:"Packed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"in_transit",children:"In Transit"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"returned",children:"Returned"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Estimated Delivery"}),e.jsx("input",{type:"date",value:N.estimatedDelivery,onChange:e=>w({...N,estimatedDelivery:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Shipping Notes"}),e.jsx("textarea",{value:N.shippingNotes,onChange:e=>w({...N,shippingNotes:e.target.value}),rows:2,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500",placeholder:"Add shipping notes..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{onClick:()=>r(t.id,N),size:"sm",className:"bg-blue-600 text-white",children:"Save"}),e.jsx(s,{onClick:()=>x(t.id),size:"sm",variant:"outline",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-2 text-sm",children:[t.shippingStatus&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Shipping Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${f(t.shippingStatus)}`,children:t.shippingStatus.replace("_"," ").toUpperCase()})]}),t.trackingNumber&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tracking:"}),e.jsx("span",{className:"font-mono",children:t.trackingNumber})]}),t.estimatedDelivery&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Est. Delivery:"}),e.jsx("span",{children:h(t.estimatedDelivery)})]}),t.shippingNotes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Notes:"}),e.jsx("p",{className:"text-gray-800 mt-1",children:t.shippingNotes})]})]})]}),n&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"Order Items (",t.items.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:t.items.map((s,t)=>{var a,r,l;return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:(null==(a=s.product)?void 0:a.name)||`Product ${s.productId}`}),(null==(r=s.variant)?void 0:r.name)&&"Default Variant"!==s.variant.name&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",s.variant.name,")"]}),(null==(l=s.product)?void 0:l.sku)&&e.jsxs("div",{className:"text-xs text-gray-400 font-mono",children:["SKU: ",s.product.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{children:["Qty: ",s.quantity]}),e.jsx("div",{className:"text-gray-600",children:g(s.costPrice)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Total: ",g(s.totalPrice||s.quantity*s.costPrice)]})]})]},t)})})]}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t border-gray-100",children:[S.length>0&&e.jsx("div",{className:"flex gap-1 flex-wrap",children:S.map(s=>e.jsxs("button",{onClick:()=>a(t.id,s),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 hover:scale-105 hover:shadow-md ${p(s)}`,title:`Mark as ${s}`,children:[b(s),e.jsx("span",{className:"ml-1 capitalize font-semibold",children:s})]},s))}),e.jsx("div",{className:"flex gap-1 ml-auto",children:(s=>{const t=[],r=s.status,n=s.paymentStatus||"unpaid";switch(t.push({type:"view",label:"View",icon:e.jsx(X,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}`,"_blank")}),r){case"draft":t.push({type:"edit",label:"Edit",icon:e.jsx(re,{className:"w-4 h-4"}),color:"bg-purple-600 hover:bg-purple-700",onClick:()=>window.open(`/lats/purchase-order/create?edit=${s.id}`,"_blank")}),t.push({type:"approve",label:"Approve",icon:e.jsx(ae,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:()=>a(s.id,"sent")}),t.push({type:"duplicate",label:"Duplicate",icon:e.jsx(c,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}?action=duplicate`,"_blank")}),t.push({type:"print",label:"Print",icon:e.jsx(ne,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}?action=print`,"_blank")}),t.push({type:"delete",label:"Delete",icon:e.jsx(u,{className:"w-4 h-4"}),color:"bg-red-600 hover:bg-red-700",onClick:()=>l(s.id)});break;case"sent":"unpaid"!==n&&"partial"!==n&&n||t.push({type:"pay",label:"Pay",icon:e.jsx(te,{className:"w-4 h-4"}),color:"bg-orange-600 hover:bg-orange-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}?action=pay`,"_blank")}),"paid"===n&&t.push({type:"receive",label:"Receive",icon:e.jsx(ae,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:()=>a(s.id,"received")}),t.push({type:"resend",label:"Resend",icon:e.jsx(W,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}?action=resend`,"_blank")}),t.push({type:"modify",label:"Modify",icon:e.jsx(re,{className:"w-4 h-4"}),color:"bg-purple-600 hover:bg-purple-700",onClick:()=>window.open(`/lats/purchase-order/create?edit=${s.id}`,"_blank")}),t.push({type:"cancel",label:"Cancel",icon:e.jsx(le,{className:"w-4 h-4"}),color:"bg-red-600 hover:bg-red-700",onClick:()=>a(s.id,"cancelled")});break;case"received":t.push({type:"receipt",label:"Receipt",icon:e.jsx(c,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}/receipt`,"_blank")}),t.push({type:"invoice",label:"Invoice",icon:e.jsx(c,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}/invoice`,"_blank")}),t.push({type:"return",label:"Return",icon:e.jsx(se,{className:"w-4 h-4"}),color:"bg-red-600 hover:bg-red-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}?action=return`,"_blank")}),t.push({type:"review",label:"Review",icon:e.jsx(j,{className:"w-4 h-4"}),color:"bg-yellow-600 hover:bg-yellow-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}?action=review`,"_blank")});break;case"cancelled":t.push({type:"restore",label:"Restore",icon:e.jsx(m,{className:"w-4 h-4"}),color:"bg-green-600 hover:bg-green-700",onClick:()=>a(s.id,"draft")}),t.push({type:"duplicate",label:"Duplicate",icon:e.jsx(c,{className:"w-4 h-4"}),color:"bg-blue-600 hover:bg-blue-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}?action=duplicate`,"_blank")}),t.push({type:"archive",label:"Archive",icon:e.jsx(ee,{className:"w-4 h-4"}),color:"bg-gray-600 hover:bg-gray-700",onClick:()=>window.open(`/lats/purchase-orders/${s.id}?action=archive`,"_blank")})}return t})(t).map((s,t)=>e.jsx("button",{onClick:s.onClick,className:`p-2 text-white rounded-lg transition-colors ${s.color}`,title:s.label,children:s.icon},`${s.type}-${t}`))})]})]})]})},Ge=()=>{const a=Re(),{currentUser:i}=n(),{confirm:c,alert:u}=ce(),{playClickSound:j}=oe(),v=Ae(),y=d.useMemo(()=>new URLSearchParams(window.location.search).get("edit"),[]),N=d.useMemo(()=>new URLSearchParams(window.location.search).get("duplicate"),[]),C=d.useMemo(()=>!!y,[y]),P=d.useMemo(()=>!!N,[N]),{products:D,categories:A,suppliers:T,loadProducts:O,loadCategories:I,loadSuppliers:L,createPurchaseOrder:E,getPurchaseOrder:_}=l(),[R,U]=d.useState(""),Z=((e,s)=>{const[t,a]=d.useState(e);return d.useEffect(()=>{const t=setTimeout(()=>{a(e)},s);return()=>{clearTimeout(t)}},[e,s]),t})(R,300),F=d.useRef(null),[z,M]=d.useState(""),[Q,K]=d.useState({min:"",max:""}),[B,H]=d.useState("all"),[Y,G]=d.useState(!1),[J,W]=d.useState("recent"),[X,ee]=d.useState("desc"),[se,te]=d.useState(!1),[ae,re]=d.useState([]),le=d.useMemo(()=>{if(0===D.length||0===A.length)return[];return D.map(e=>{var s,t;const a=e.categoryId||e.category_id||(null==(s=e.category)?void 0:s.id);let r="Unknown Category",l=null;if(a&&A.length>0&&(l=A.find(e=>e.id===a),l&&(r=l.name)),!l&&e.name&&A.length>0){const s=e.name.toLowerCase();l=A.find(e=>{const t=e.name.toLowerCase();return s.includes(t)||t.includes(s)}),l&&(r=l.name)}const n=Array.isArray(e.images)?e.images.map(e=>"string"==typeof e?e:e.url||e.image_url||""):[];return{...e,categoryName:r,categoryId:(null==l?void 0:l.id)||a,images:n.filter(Boolean),tags:[],variants:(null==(t=e.variants)?void 0:t.map(s=>({...s,id:s.id||`variant-${Date.now()}`,sellingPrice:s.price||e.price||0,quantity:s.stockQuantity||0})))||[]}})},[D,A]),{isLoading:ne,error:xe}=l(),me=d.useMemo(()=>{if(se&&ae.length>0)return ae;let e=le;if(Z.trim()&&!se){const s=Z.toLowerCase();e=e.filter(e=>{var t,a,r,l;const n=null==(t=e.variants)?void 0:t[0],i=(null==(a=null==A?void 0:A.find(s=>s.id===e.categoryId))?void 0:a.name)||"";return((null==(r=e.name)?void 0:r.toLowerCase())||"").includes(s)||((null==(l=null==n?void 0:n.sku)?void 0:l.toLowerCase())||"").includes(s)||(i.toLowerCase()||"").includes(s)||e.variants&&e.variants.some(e=>{var t,a,r;return(null==(t=e.name)?void 0:t.toLowerCase().includes(s))||(null==(a=e.sku)?void 0:a.toLowerCase().includes(s))||(null==(r=e.barcode)?void 0:r.toLowerCase().includes(s))})})}return z&&(e=e.filter(e=>e.categoryId===z)),(Q.min||Q.max)&&(e=e.filter(e=>{var s;const t=null==(s=e.variants)?void 0:s[0],a=(null==t?void 0:t.costPrice)||0,r=Q.min?parseFloat(Q.min):0,l=Q.max?parseFloat(Q.max):1/0;return a>=r&&a<=l})),"all"!==B&&(e=e.filter(e=>{var s;const t=null==(s=e.variants)?void 0:s[0],a=(null==t?void 0:t.stockQuantity)||0;switch(B){case"in-stock":return a>10;case"low-stock":return a>0&&a<=10;case"out-of-stock":return 0===a;default:return!0}})),e.sort((e,s)=>{var t,a,r,l,n,i,d,c,o,x;let m,u;switch(J){case"name":m=(null==(t=e.name)?void 0:t.toLowerCase())||"",u=(null==(a=s.name)?void 0:a.toLowerCase())||"";break;case"price":m=(null==(l=null==(r=e.variants)?void 0:r[0])?void 0:l.costPrice)||e.price||0,u=(null==(i=null==(n=s.variants)?void 0:n[0])?void 0:i.costPrice)||s.price||0;break;case"stock":m=(null==(c=null==(d=e.variants)?void 0:d[0])?void 0:c.stockQuantity)||0,u=(null==(x=null==(o=s.variants)?void 0:o[0])?void 0:x.stockQuantity)||0;break;case"recent":m=new Date(e.createdAt||"").getTime(),u=new Date(s.createdAt||"").getTime();break;default:return 0}return"asc"===X?m>u?1:-1:m<u?1:-1}),e},[le,A,Z,z,Q,B,J,X,se,ae]),ue=d.useCallback(async e=>{if(e){Ss(!0),ks(null);try{const s=await _(e);if(s.ok&&s.data){const e=s.data;if(e.supplierId){const s=T.find(s=>s.id===e.supplierId);s&&Se(s)}if(e.items&&e.items.length>0){const s=e.items.map(e=>{var s,t,a,r,l,n;return{id:`${e.productId}-${e.variantId}-${Date.now()}`,productId:e.productId,variantId:e.variantId,name:(null==(s=e.product)?void 0:s.name)||"Unknown Product",variantName:(null==(t=e.variant)?void 0:t.name)||"Default Variant",sku:(null==(a=e.variant)?void 0:a.sku)||"N/A",costPrice:e.costPrice||0,quantity:e.quantity||1,totalPrice:(e.costPrice||0)*(e.quantity||1),currentStock:(null==(r=e.variant)?void 0:r.stockQuantity)||0,category:(null==(l=e.product)?void 0:l.categoryName)||"Unknown Category",images:(null==(n=e.product)?void 0:n.images)||[]}});fe(s)}if(e.expectedDelivery&&(De(e.expectedDelivery),We(s=>({...s,expectedDelivery:e.expectedDelivery}))),e.notes&&Le(e.notes),e.paymentTerms&&Ge(e.paymentTerms),e.currency){const s=ve.find(s=>s.code===e.currency);s&&ke(s)}if(e.exchangeRate&&1!==e.exchangeRate){const s=`1 ${e.currency} = ${Math.round(e.exchangeRate)} TZS`;Ie(s)}e.status&&Fe(e.status),w.success("Purchase order loaded for editing")}else{const e=s.message||"Failed to load purchase order for editing";ks(e),w.error(e)}}catch(s){const e="Error loading purchase order for editing";ks(e),w.error(e)}finally{Ss(!1)}}},[_,T]);d.useEffect(()=>{(async()=>{try{await Promise.all([O({page:1,limit:100}),I(),L()])}catch(e){}})()},[O,I,L]),d.useEffect(()=>{const e=localStorage.getItem("po_latest_exchange_rate");!e||C||P||Ie(e)},[C,P]),d.useEffect(()=>{y&&T.length>0&&ue(y)},[y,T.length,ue]);const pe=d.useCallback(async e=>{Ss(!0),ks("");try{const s=await _(e);if(s.ok&&s.data){const e=s.data;if(e.supplierId){const s=T.find(s=>s.id===e.supplierId);s&&Se(s)}if(e.items&&e.items.length>0){const s=e.items.map(e=>{var s,t,a,r,l,n;return{id:`${e.productId}-${e.variantId}`,productId:e.productId,variantId:e.variantId,name:(null==(s=e.product)?void 0:s.name)||"Unknown Product",variantName:(null==(t=e.variant)?void 0:t.name)||"Default Variant",sku:(null==(a=e.variant)?void 0:a.sku)||"N/A",costPrice:e.costPrice||0,quantity:e.quantity||1,totalPrice:(e.costPrice||0)*(e.quantity||1),currentStock:(null==(r=e.variant)?void 0:r.stockQuantity)||0,category:(null==(l=e.product)?void 0:l.categoryName)||"Unknown Category",images:(null==(n=e.product)?void 0:n.images)||[]}});fe(s)}if(e.expectedDelivery&&(De(e.expectedDelivery),We(s=>({...s,expectedDelivery:e.expectedDelivery}))),e.notes&&Le(e.notes+" (Duplicated)"),e.paymentTerms&&Ge(e.paymentTerms),e.currency){const s=ve.find(s=>s.code===e.currency);s&&ke(s)}if(e.exchangeRate&&1!==e.exchangeRate){const s=`1 ${e.currency} = ${Math.round(e.exchangeRate)} TZS`;Ie(s)}Fe("draft"),w.success("Purchase order duplicated successfully - Review and save")}else{const e=s.message||"Failed to load purchase order for duplication";ks(e),w.error(e)}}catch(s){const e="Error loading purchase order for duplication";ks(e),w.error(e)}finally{Ss(!1)}},[_,T]);d.useEffect(()=>{N&&T.length>0&&pe(N)},[N,T.length,pe]);const[be,fe]=d.useState([]),[we,Se]=d.useState(null),[Ce,ke]=d.useState(()=>ve.find(e=>"TZS"===e.code)||ve[0]);d.useEffect(()=>{if(null==we?void 0:we.currency){const e=ve.find(e=>e.code===we.currency);e&&ke(e)}},[we]);const[Pe,De]=d.useState(""),[Oe,Ie]=d.useState(""),[$e,Le]=d.useState(""),[Ee,Fe]=d.useState("sent"),Qe=Ze(Oe,Ce.code,"TZS"),[Ye,Ge]=d.useState("Net 30"),[Je,We]=d.useState({shippingMethod:"standard",expectedDelivery:"",shippingAddress:"Dar es Salaam, Tanzania",shippingCity:"Dar es Salaam",shippingCountry:"Tanzania",shippingPhone:"",shippingContact:"",shippingNotes:"",trackingNumber:"",estimatedCost:0,carrier:"DHL",requireSignature:!1,enableInsurance:!1,insuranceValue:0}),[Xe,es]=d.useState(!1),[ss,ts]=d.useState(!1),[as,rs]=d.useState(!1),[ls,ns]=d.useState(!1),[is,ds]=d.useState(!1),[cs,os]=d.useState(!1),[xs,ms]=d.useState(null),[us,gs]=d.useState(!1),[hs,ps]=d.useState(!1),[bs,js]=d.useState(!1),[fs,vs]=d.useState(null),[ys,Ns]=d.useState(!1),[ws,Ss]=d.useState(!1),[Cs,ks]=d.useState(null);d.useState(new Set);const Ps=e=>{if(!e.trim())return null;const s=[/1\s*([A-Z]{3})\s*=\s*([\d,]+\.?\d*)\s*([A-Z]{3})/i,/([\d,]+\.?\d*)\s*([A-Z]{3})\s*=\s*1\s*([A-Z]{3})/i,/([\d,]+\.?\d*)/i];for(const t of s){const s=e.match(t);if(s)if(4===s.length){const e=s[1]||s[3],t=s[3]||s[1],a=parseFloat(s[2].replace(/,/g,""));if(e===Ce.code&&"TZS"===t)return a;if("TZS"===e&&t===Ce.code)return 1/a}else if(2===s.length)return parseFloat(s[1].replace(/,/g,""))}return null},Ds=(e,s)=>{if("TZS"===s)return e;const t=Ps(Oe);return t?e*t:e},As=be.reduce((e,s)=>e+s.totalPrice,0),Ts=Ds(As,Ce.code),Os=As-0;Ds(Os,Ce.code);const Is=d.useCallback((e,s,t=1)=>{var a;const r=s||(null==(a=e.variants)?void 0:a[0]);if(!r)return void u("Product has no variants available","No Variants");const l=r.costPrice||.7*e.price,n=r.sku||"N/A",i=r.stockQuantity||0;fe(s=>{const a=s.find(s=>s.productId===e.id&&s.variantId===r.id);if(a)return s.map(e=>e.id===a.id?{...e,quantity:e.quantity+t,totalPrice:(e.quantity+t)*l}:e);{const a={id:`${e.id}-${r.id}-${Date.now()}`,productId:e.id,variantId:r.id,name:e.name,variantName:r.name,sku:n,costPrice:l,sellingPrice:r.sellingPrice||r.price||0,quantity:t,totalPrice:l*t,currentStock:i,category:e.categoryName,images:e.images||[]};return[...s,a]}}),U(""),te(!1)},[]),$s=d.useCallback((e,s)=>{fe(s<=0?s=>s.filter(s=>s.id!==e):t=>t.map(t=>t.id===e?{...t,quantity:s,totalPrice:s*t.costPrice}:t))},[]),Ls=d.useCallback(e=>{fe(s=>s.filter(s=>s.id!==e))},[]);d.useCallback(e=>{We(e),De(e.expectedDelivery),e.shippingMethod&&We(s=>({...s,shippingMethod:e.shippingMethod}))},[]);const Es=d.useCallback((e,s)=>{fe(t=>t.map(t=>t.id===e?{...t,costPrice:s,totalPrice:t.quantity*s}:t))},[]),_s=d.useCallback(async()=>{if(be.length>0){await c("Are you sure you want to clear the purchase cart?")&&fe([])}},[be.length,c]),Rs=d.useCallback(()=>{if(be.length>0)try{_e.autoSave(be,we,Ce,Pe,Ye,$e,Oe)}catch(e){}},[be,we,Ce,Pe,Ye,$e,Oe]);d.useEffect(()=>{const e=setTimeout(()=>{Rs()},2e3);return()=>clearTimeout(e)},[Rs]),d.useCallback(e=>{try{fe(e.cartItems||[]),Se(e.supplier),ke(e.currency||ve[0]),De(e.expectedDelivery||""),Ge(e.paymentTerms||"net_30"),Le(e.notes||""),Ie(e.exchangeRates||""),w.success(`Loaded draft: ${e.name}`)}catch(s){w.error("Failed to load draft. Please try again.")}},[]);const Us=d.useCallback(async()=>{try{const e=r(),s=await e.getPurchaseOrders();s.ok&&s.data}catch(e){}},[]),Zs=d.useCallback(e=>{Se(e);const s=e.preferred_currency||e.currency;if(s){const e=ve.find(e=>e.code===s);e&&(ke(e),w.success(`Currency automatically set to ${s} (${e.name})`))}else{const e=ve.find(e=>"TZS"===e.code)||ve[0];ke(e),w(`No supplier currency specified, using default: ${e.code}`)}e.exchangeRates&&(Ie(e.exchangeRates),w.success("Exchange rates loaded from supplier")),es(!1)},[]),Fs=d.useCallback(e=>{if(Se(e),e.currency){const s=ve.find(s=>s.code===e.currency);s&&(ke(s),w.success(`Currency automatically set to ${e.currency} (${s.name})`))}else{const e=ve.find(e=>"TZS"===e.code)||ve[0];ke(e),w(`No supplier currency specified, using default: ${e.code}`)}e.exchangeRates&&(Ie(e.exchangeRates),w.success("Exchange rates loaded from supplier")),L()},[L]),zs=d.useCallback(e=>{O(),rs(!1),w.success("Product added successfully!")},[O]),Ms=d.useCallback(e=>{ms(e),ds(!0)},[]),qs=d.useCallback(e=>{const s=e.target.value;if(U(s),s.trim()){te(!0);const e=le.filter(e=>{var t,a,r,l;const n=null==(t=e.variants)?void 0:t[0],i=(null==(a=null==A?void 0:A.find(s=>s.id===e.categoryId))?void 0:a.name)||"";return((null==(r=e.name)?void 0:r.toLowerCase())||"").includes(s.toLowerCase())||((null==(l=null==n?void 0:n.sku)?void 0:l.toLowerCase())||"").includes(s.toLowerCase())||(i.toLowerCase()||"").includes(s.toLowerCase())});re(e)}else te(!1),re([])},[le,A]),Vs=d.useCallback(e=>{"Enter"===e.key&&R.trim()&&e.preventDefault()},[R]),Qs=d.useCallback(e=>{var s;e.ctrlKey&&"f"===e.key&&(e.preventDefault(),null==(s=F.current)||s.focus()),e.ctrlKey&&"n"===e.key&&(e.preventDefault(),_s())},[_s]);d.useEffect(()=>(document.addEventListener("keydown",Qs),()=>{document.removeEventListener("keydown",Qs)}),[Qs]);const Ks=d.useCallback(async()=>{const e=ye(we,be,"",Ye,Ce.code,null==Qe?void 0:Qe.rate);if(e.isValid){gs(!0);try{const e=Ne(),s={...C&&y&&{id:y},supplierId:we.id,expectedDelivery:Je.expectedDelivery||"",notes:$e,status:Ee,currency:Ce.code,paymentTerms:Ye,createdBy:(null==i?void 0:i.id)||(null==i?void 0:i.uid)||null,exchangeRate:(null==Qe?void 0:Qe.rate)||1,baseCurrency:"TZS",exchangeRateSource:(null==Qe?void 0:Qe.source)||"manual",exchangeRateDate:(null==Qe?void 0:Qe.date)||(new Date).toISOString(),items:be.map(e=>({productId:e.productId,variantId:e.variantId,quantity:e.quantity,costPrice:e.costPrice,sellingPrice:e.sellingPrice||0,minimumOrderQty:e.minimumOrderQty,notes:e.notes||""}))},t=await E(s);t.ok?(vs(t.data),Oe&&Oe.trim()&&localStorage.setItem("po_latest_exchange_rate",Oe),v.show(`Purchase Order ${e} has been ${C&&!P?"updated":"created"} successfully!`,{title:"PO "+(C&&!P?"Updated":"Created"),actionButtons:[{label:"View Order",onClick:()=>a(`/lats/purchase-orders/${t.data.id}`),variant:"primary"},{label:"Edit Order",onClick:()=>a(`/lats/purchase-orders/${t.data.id}/edit`),variant:"secondary"},{label:"Create Another",onClick:()=>{},variant:"secondary"}]}),fe([]),Se(null),We(e=>({...e,expectedDelivery:""})),Le(""),Fe("sent")):w.error(t.message||"Failed to create purchase order")}catch(s){w.error("Error creating purchase order. Please try again.")}finally{gs(!1)}}else w.error(e.errors.join("\n"))},[we,be,Je.expectedDelivery,Oe,$e,Ee,Ce,E,a]),Bs=(e,s)=>je(e,s||Ce);return i?e.jsxs("div",{className:"min-h-screen",children:[e.jsx(Ue,{cartItemsCount:be.length,totalAmount:Os,currency:Ce,productsCount:le.length,suppliersCount:T.length,onCreatePurchaseOrder:Ks,onClearCart:_s,onAddSupplier:()=>ts(!0),onAddProduct:()=>rs(!0),onViewPurchaseOrders:()=>Ns(!0),isCreatingPO:us,hasSelectedSupplier:!!we,onTestPOFetch:Us}),e.jsx("div",{className:"p-4 sm:p-6 pb-20 max-w-full mx-auto space-y-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:e.jsxs(t,{className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-orange-500"}),e.jsx("input",{ref:F,type:"text",placeholder:C?"Search products to add to this order... (Ctrl+F focus)":"Search products to add to purchase order... (Ctrl+F focus)",value:R,onChange:qs,onKeyPress:Vs,className:"w-full pl-14 pr-24 py-5 text-lg border-2 border-orange-200 rounded-xl bg-white text-gray-900 placeholder-orange-400 focus:outline-none focus:ring-4 focus:ring-orange-500/30 focus:border-orange-500 shadow-lg hover:shadow-xl transition-all duration-200",style:{minHeight:"60px"}}),R.trim()&&R.length>=8&&/^[A-Za-z0-9]+$/.test(R)&&e.jsx("div",{className:"absolute left-14 top-1/2 transform -translate-y-1/2",children:e.jsx($,{className:"w-4 h-4 text-green-500"})}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("button",{onClick:()=>G(!Y),className:"p-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg transition-colors duration-200",title:"Advanced filters",children:e.jsx(ie,{className:"w-5 h-5"})})})]}),ne&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-blue-800 font-medium",children:"Loading products..."})]})}),C&&ws&&e.jsx("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"}),e.jsx("span",{className:"text-purple-800 font-medium",children:"Loading purchase order for editing..."})]})}),C&&Cs&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-red-600"}),e.jsxs("span",{className:"text-red-800 font-medium",children:["Edit Error: ",Cs]})]})}),C&&!P&&!ws&&!Cs&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-green-800 font-medium",children:"Purchase order loaded for editing"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"You can add more items, modify quantities, or change details below"})]})]})}),P&&!ws&&!Cs&&e.jsx("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-800 font-medium",children:"Purchase order duplicated successfully"}),e.jsx("p",{className:"text-sm text-purple-700 mt-1",children:'Review the order details and click "Create PO" to save as a new purchase order'})]})]})}),xe&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-red-600"}),e.jsxs("span",{className:"text-red-800 font-medium",children:["Error: ",xe]})]})}),!ne&&!xe&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-green-800 font-medium",children:le.length>0?`${le.length} products loaded`:"No products found"})]})}),Y&&e.jsxs("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-orange-50 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:z,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"All Categories"}),A.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock Status"}),e.jsxs("select",{value:B,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"all",children:"All Items"}),e.jsx("option",{value:"in-stock",children:"In Stock"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"out-of-stock",children:"Out of Stock"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:J,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"price",children:"Price"}),e.jsx("option",{value:"stock",children:"Stock"}),e.jsx("option",{value:"recent",children:"Recent"})]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>{M(""),K({min:"",max:""}),H("all"),W("name"),ee("asc")},className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:"Clear All Filters"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[se&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-700",children:["Search Results (",me.length,")"]}),e.jsx("button",{onClick:()=>te(!1),className:"text-sm text-orange-600 hover:text-orange-800",children:"Show All Products"})]}),me.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:me.map(s=>e.jsx(ge,{product:s,onAddToCart:Is,onViewDetails:Ms,primaryColor:"orange",actionText:"View Details",allowOutOfStockSelection:!0,showCategory:!0},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:['No products found for "',R,'"']})]})]}),!se&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-700",children:C?"Add More Products to Order":"Available Products"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[le.length," products"]})]}),le.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:le.map(s=>e.jsx(ge,{product:s,onAddToCart:Is,onViewDetails:Ms,primaryColor:"orange",actionText:"View Details",allowOutOfStockSelection:!0,showCategory:!0},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“¦"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products available"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No products found in the database"})]})]})]})]})}),e.jsx("div",{className:"lg:w-[450px] flex-shrink-0",children:e.jsxs(t,{className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 flex-shrink-0",children:[e.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:e.jsx(de,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:C?"Edit Purchase Order":P?"Duplicate Purchase Order":"Purchase Cart"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[be.length," items ",C||P?"in order":"to purchase",(C||P)&&e.jsx("span",{className:"block text-xs text-blue-600 mt-1",children:"ðŸ’¡ You can add more items using the search above"})]})]})]}),e.jsx("div",{className:"mb-6",children:we?e.jsx("div",{className:"p-4 bg-gradient-to-br from-orange-50 via-amber-50 to-orange-50 rounded-xl border-2 border-orange-200 shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 via-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg",children:we.name.charAt(0)}),e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full border-2 border-white flex items-center justify-center bg-gradient-to-r from-green-400 to-emerald-500",children:e.jsx(h,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-lg",children:we.name}),we.contactPerson&&e.jsx("div",{className:"text-sm text-gray-600",children:we.contactPerson}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(f,{className:"w-3 h-3"}),we.phone||"No phone"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-r from-orange-100 to-amber-100 text-orange-700 border border-orange-200",children:we.country||"Unknown Location"}),e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-600 bg-white px-2 py-1 rounded-full border border-gray-200",title:`Currency set by supplier: ${we.currency||Ce.code}`,children:[e.jsx(V,{className:"w-3 h-3"}),we.currency||Ce.code,we.currency&&e.jsx("span",{className:"text-green-600",title:"Auto-set by supplier",children:"âœ“"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{os(!0)},className:"p-2 text-orange-500 hover:text-orange-700 hover:bg-orange-50 rounded-lg transition-all duration-200",title:"View supplier details",children:e.jsx(k,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Se(null),className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-all duration-200",children:e.jsx(p,{className:"w-5 h-5"})})]})]})}):e.jsx("div",{className:"space-y-3",children:e.jsxs("button",{onClick:()=>es(!0),className:"w-full flex items-center justify-center gap-3 p-4 text-base border-2 border-orange-200 rounded-xl bg-white text-gray-900 hover:border-orange-300 hover:shadow-lg transition-all duration-200",children:[e.jsx(b,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{className:"text-gray-600",children:"Select Supplier"}),e.jsx(o,{className:"w-4 h-4 text-orange-500"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===be.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cart is empty"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add products to create a purchase order"})]}):e.jsx("div",{className:"space-y-4 mb-6",children:[...be].reverse().map((s,t)=>e.jsx(Be,{item:s,index:t,currency:Ce,exchangeRates:Oe,isLatest:0===t,onUpdateQuantity:$s,onUpdateCostPrice:Es,onRemove:Ls},s.id))})}),be.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Shipping Information ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(Optional)"})]}),e.jsx("button",{onClick:()=>ps(!0),className:"w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-orange-400 hover:bg-orange-50 transition-colors text-left",children:Je.expectedDelivery?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["Delivery: ",new Date(Je.expectedDelivery).toLocaleDateString()]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Je.carrier," â€¢ ","air"===Je.shippingMethod?"By Air":"sea"===Je.shippingMethod?"By Sea":"Standard"]})]})]}),e.jsx("div",{className:"text-orange-500 text-sm font-medium",children:"Edit"})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-3 text-gray-500",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Click to configure shipping (optional)"})]})})]}),we&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Currency & Exchange Rate"}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white border-2 border-gray-200 rounded-lg hover:border-orange-300 focus-within:border-orange-500 transition-all duration-200",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 p-2 bg-gray-100 rounded-md",children:[e.jsx("span",{className:"text-lg",children:Ce.flag}),e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:Ce.code})]}),e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:Oe,onChange:e=>Ie(e.target.value),placeholder:"Rate (e.g., 1 USD = 150 TZS)",className:"w-full border-0 focus:outline-none focus:ring-0 text-base font-bold text-gray-800 placeholder-gray-400 bg-transparent"})}),Oe&&"TZS"!==Ce.code&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"bg-green-100 text-green-700 text-xs px-2 py-1 rounded-md font-medium",children:["â‰ˆ ",Math.round(Ps(Oe)||0)," TZS"]})})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-orange-50 rounded-xl p-4 border border-gray-200 shadow-sm flex-shrink-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Subtotal"}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-semibold text-gray-900",children:Bs(As)})})]}),"TZS"!==Ce.code&&Oe&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Total in TZS"}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-semibold text-green-600",children:Bs(Ts,{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:"ðŸ‡¹ðŸ‡¿"})})})]}),e.jsx("div",{className:"border-t-2 border-gray-300 pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total Amount"}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xl font-bold text-orange-600",children:Bs(Os)})})]})})]})}),e.jsx("div",{className:"mt-4 space-y-3 flex-shrink-0",children:e.jsx(s,{onClick:Ks,icon:us?e.jsx(m,{size:20,className:"animate-spin"}):e.jsx(g,{size:20}),className:"w-full h-16 bg-gradient-to-r from-orange-500 to-amber-600 text-white text-lg font-bold",disabled:!we||0===be.length||us,children:us?C&&!P?"Updating...":"Creating...":C&&!P?"Update PO":"Create PO"})})]})]})})]})}),Xe&&e.jsx(ze,{isOpen:Xe,onClose:()=>es(!1),onSupplierSelect:Zs,suppliers:T}),hs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Shipping Configuration"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Shipping configuration will be implemented soon."}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{j(),ps(!1)},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Close"})})]})}),ls&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Draft Management"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Draft management functionality will be implemented soon."}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{j(),ns(!1)},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Close"})})]})}),cs&&we&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-lg w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Supplier Details"}),e.jsx("button",{onClick:()=>os(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(x,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:we.name}),e.jsx("p",{className:"text-sm text-gray-600",children:we.category})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email"}),e.jsx("p",{className:"text-gray-900",children:we.email||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("p",{className:"text-gray-900",children:we.phone||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Address"}),e.jsx("p",{className:"text-gray-900",children:we.address||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"City"}),e.jsx("p",{className:"text-gray-900",children:we.city||"Not provided"})]})]}),we.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("p",{className:"text-gray-900",children:we.notes})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{onClick:()=>os(!1),className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"}),e.jsx("button",{onClick:()=>{os(!1),ts(!0)},className:"flex-1 bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors",children:"Edit Supplier"})]})]})]})}),ss&&e.jsx(he,{isOpen:ss,onClose:()=>ts(!1),onSupplierCreated:Fs}),as&&e.jsx(Ke,{isOpen:as,onClose:()=>rs(!1),onProductAdded:zs,currency:Ce}),is&&xs&&e.jsx(Ve,{isOpen:is,onClose:()=>{ds(!1),ms(null)},product:xs,currency:Ce,onAddToCart:Is}),e.jsx(Te,{...v.props}),e.jsx(He,{isOpen:ys,onClose:()=>Ns(!1)}),e.jsx(Me,{isOpen:ls,onClose:()=>ns(!1),onLoadDraft:e=>{Se(e.supplier),fe(e.cartItems),ke(e.currency),Ge(e.paymentTerms),Le(e.notes)},onSaveDraft:e=>{},currentDraft:{supplier:we,cartItems:be,currency:Ce,paymentTerms:Ye,notes:$e}}),e.jsx(qe,{isOpen:bs,onClose:()=>js(!1),onSave:e=>{We(e)},initialData:Je})]}):null};export{Ge as default};
