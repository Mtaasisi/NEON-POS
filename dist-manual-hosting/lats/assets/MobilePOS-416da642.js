import{o as e,j as t,N as s,u as a,a as r,c as l}from"./index-222cfb29.js";import{r as n,b as i}from"./vendor-a2ff445a.js";import{c as o,s as d,S as c}from"./ShareReceiptModal-4bab199d.js";import{format as m}from"./format-0f0b2647.js";import{Q as u,y as x,U as p,ao as b,bd as g,z as h,aa as y,b6 as f,ap as v,X as j,V as N,x as w,O as k}from"./ui-551a39a6.js";import{M as C}from"./MobileAddCustomerModal-ed043a13.js";import{u as S,S as P}from"./useSuccessModal-e8b7d685.js";import{S as A}from"./SuccessModalIcons-20b743c5.js";import{u as L}from"./useMobileBranch-1aee679b.js";import{a as W}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";import"./phoneUtils-1ba19aca.js";import"./MobileSheetContent-ad1cebdf.js";import"./useBodyScrollLock-0216d39f.js";import"./supabase-460661f2.js";const $=({isOpen:s,onClose:a,onCustomerSelect:r,onAddNew:l,selectedCustomer:d})=>{const[c,m]=n.useState(""),[g,h]=n.useState([]),[y,f]=n.useState([]),[v,j]=n.useState(!1);n.useEffect(()=>{s&&N()},[s]),n.useEffect(()=>{if(c.trim()){const e=c.toLowerCase(),t=g.filter(t=>{var s,a;return t.name.toLowerCase().includes(e)||(null==(s=t.phone)?void 0:s.toLowerCase().includes(e))||(null==(a=t.email)?void 0:a.toLowerCase().includes(e))});f(t)}else f(g.slice(0,50))},[c,g]);const N=async()=>{try{j(!0);const t=o.getCustomers();if(t&&t.length>0){h(t),f(t.slice(0,50)),j(!1);return void(o.getCacheAge()>3e5&&e().then(e=>{e&&Array.isArray(e)&&(o.saveCustomers(e),h(e))}).catch(()=>{}))}const s=await e();s&&Array.isArray(s)&&(h(s),f(s.slice(0,50)),o.saveCustomers(s))}catch(t){}finally{j(!1)}},w=e=>{if(!e)return"??";const t=e.trim().split(" ");return t.length>=2?`${t[0][0]}${t[t.length-1][0]}`.toUpperCase():e.substring(0,2).toUpperCase()},k=e=>{if(!e)return 0;let t="string"==typeof e?parseFloat(e.replace(/[^0-9.-]/g,"")):e;return isNaN(t)||!isFinite(t)||t>1e15?0:(t>1e8&&(t/=100),Math.max(0,t))};return s?i.createPortal(t.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:a,children:[t.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[90vh] flex flex-col animate-slide-up",onClick:e=>e.stopPropagation(),style:{animation:"slideUp 0.3s ease-out"},children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[t.jsx("button",{onClick:a,className:"text-blue-500 text-[17px] font-normal",children:"Cancel"}),t.jsx("h2",{className:"text-[17px] font-semibold text-gray-900",children:"Select Customer"}),t.jsx("button",{onClick:()=>{a(),null==l||l()},className:"text-blue-500 text-[17px] font-semibold",children:t.jsx(u,{size:22,strokeWidth:2.5})})]}),t.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:t.jsxs("div",{className:"relative",children:[t.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16,strokeWidth:2}),t.jsx("input",{type:"text",placeholder:"Search customers",value:c,onChange:e=>m(e.target.value),autoFocus:!0,className:"w-full pl-9 pr-4 py-2 bg-[#f2f2f7] border-0 rounded-lg focus:outline-none focus:ring-0 text-gray-900 placeholder-gray-400 text-[15px] font-light",style:{WebkitAppearance:"none"}})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:v?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):0===y.length?t.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[t.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:t.jsx(p,{size:40,className:"text-gray-400",strokeWidth:1.5})}),t.jsx("p",{className:"text-gray-900 text-[17px] font-semibold mb-2",children:c?"No customers found":"No customers yet"}),t.jsx("p",{className:"text-[15px] text-gray-500 mb-6 max-w-sm mx-auto text-center",children:c?"Try adjusting your search terms":"Start building your customer base by adding your first customer"}),!c&&l&&t.jsxs("button",{onClick:()=>{a(),l()},className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-500 text-white rounded-xl font-medium hover:bg-blue-600 active:bg-blue-700 transition-colors shadow-sm",children:[t.jsx(u,{size:20,strokeWidth:2.5}),"Add First Customer"]})]}):t.jsx("div",{className:"border-t border-b border-gray-200",children:y.map((e,s)=>{const l=(null==d?void 0:d.id)===e.id,n=s===y.length-1,i=(e=>k(e.totalSpent)>0)(e),o=k(e.totalSpent);return t.jsxs("button",{onClick:()=>(e=>{r(e),a()})(e),className:"w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-50 active:bg-gray-100 transition-colors border-b border-[#e5e5ea] "+(l?"bg-blue-50":""),style:{borderBottomWidth:n?"0":"0.5px"},children:[t.jsx("div",{className:"flex-shrink-0 w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold text-[15px] shadow-sm "+(l?"bg-gradient-to-br from-blue-500 to-blue-700":"bg-gradient-to-br from-blue-400 to-blue-600"),children:w(e.name)}),t.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-[16px] font-semibold text-gray-900 truncate",children:e.name}),i&&t.jsx("span",{className:"flex-shrink-0 px-1.5 py-0.5 text-[10px] font-medium bg-green-100 text-green-700 rounded",children:"Active"})]}),t.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.jsx("span",{className:"text-[13px] text-gray-500 truncate",children:e.phone||"No phone"}),i&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-gray-300",children:"â€¢"}),t.jsx("span",{className:"text-[13px] font-medium text-gray-700",children:(c=o,c&&!isNaN(c)&&isFinite(c)?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(c):"$0")})]})]})]}),l?t.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0",children:t.jsx("svg",{width:"14",height:"10",viewBox:"0 0 14 10",fill:"none",children:t.jsx("path",{d:"M1 5L5 9L13 1",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}):t.jsx(b,{size:18,className:"text-gray-400 flex-shrink-0",strokeWidth:2})]},e.id);var c})})}),t.jsx("div",{className:"px-4 py-3 border-t border-gray-200",children:t.jsx("button",{onClick:()=>{r(null),a()},className:"w-full py-3 bg-gray-100 text-gray-900 rounded-lg text-[16px] font-medium hover:bg-gray-200 active:bg-gray-300 transition-colors",children:"Continue as Walk-in Customer"})})]}),t.jsx("style",{children:"\n        @keyframes slideUp {\n          from {\n            transform: translateY(100%);\n          }\n          to {\n            transform: translateY(0);\n          }\n        }\n        .animate-slide-up {\n          animation: slideUp 0.3s ease-out;\n        }\n      "})]}),document.body):null},z=({isOpen:e,onClose:a,amount:r,customerId:l,customerName:o,description:d,onPaymentComplete:c})=>{const{paymentMethods:m}=s(),[u,x]=n.useState(""),[p,b]=n.useState(r.toString()),[y,f]=n.useState(""),[v,j]=n.useState(!1),N=m&&m.length>0?m:[{id:"cash",name:"Cash",type:"cash",icon:"ðŸ’µ"},{id:"mpesa",name:"M-Pesa",type:"mobile_money",icon:"ðŸ“±"},{id:"card",name:"Card",type:"card",icon:"ðŸ’³"},{id:"bank",name:"Bank Transfer",type:"bank_transfer",icon:"ðŸ¦"}];n.useEffect(()=>{var t;e&&(x((null==(t=N[0])?void 0:t.id)||"cash"),b(r.toString()),f(""),j(!1))},[e,r,N]);const w=async()=>{const e=parseFloat(p);if(!e||e<=0)h.error("Please enter a valid amount");else if(e<r)h.error("Payment amount cannot be less than total");else try{j(!0);const t=N.find(e=>e.id===u),s=[{paymentMethod:(null==t?void 0:t.name)||"Cash",amount:e,reference:y||void 0,timestamp:(new Date).toISOString()}];await c(s,e),a()}catch(t){h.error(t.message||"Payment failed")}finally{j(!1)}},k=parseFloat(p)-r;return e?i.createPortal(t.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:a,children:[t.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[90vh] flex flex-col animate-slide-up",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[t.jsx("button",{onClick:a,disabled:v,className:"text-blue-500 text-[17px] font-normal disabled:opacity-50",children:"Cancel"}),t.jsx("h2",{className:"text-[17px] font-semibold text-gray-900",children:"Payment"}),t.jsx("button",{onClick:w,disabled:v||!u,className:"text-blue-500 text-[17px] font-semibold disabled:opacity-50",children:v?"Processing...":"Done"})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto",children:[t.jsxs("div",{className:"px-4 py-6 bg-gray-50 border-b border-gray-200 text-center",children:[t.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide mb-2",children:"Total Amount"}),t.jsxs("div",{className:"text-[40px] font-bold text-gray-900",children:["TSh ",r.toLocaleString()]}),o&&t.jsxs("div",{className:"text-[15px] text-gray-600 mt-2",children:["for ",o]})]}),t.jsxs("div",{className:"px-4 py-4",children:[t.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Payment Method"}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:N.map(e=>{const s=u===e.id,a=e.icon||("cash"===e.type?"ðŸ’µ":"mobile_money"===e.type?"ðŸ“±":"card"===e.type?"ðŸ’³":"ðŸ¦");return t.jsxs("button",{onClick:()=>x(e.id),className:"p-4 rounded-xl border-2 transition-all "+(s?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"),children:[t.jsx("div",{className:"text-3xl mb-2",children:a}),t.jsx("div",{className:"text-[14px] font-medium "+(s?"text-blue-600":"text-gray-900"),children:e.name}),s&&t.jsx("div",{className:"mt-2 w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center mx-auto",children:t.jsx(g,{size:14,className:"text-white",strokeWidth:3})})]},e.id)})})]}),t.jsxs("div",{className:"px-4 py-4 border-t border-gray-200",children:[t.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Amount Received"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 text-[20px] font-medium",children:"TSh"}),t.jsx("input",{type:"number",value:p,onChange:e=>b(e.target.value),className:"w-full pl-16 pr-4 py-4 text-[24px] font-bold text-gray-900 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",style:{WebkitAppearance:"none"}})]}),k>0&&t.jsx("div",{className:"mt-3 p-3 bg-green-50 rounded-lg border border-green-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-[15px] text-green-700 font-medium",children:"Change Due:"}),t.jsxs("span",{className:"text-[18px] text-green-700 font-bold",children:["TSh ",k.toLocaleString()]})]})})]}),"cash"!==u&&t.jsxs("div",{className:"px-4 py-4 border-t border-gray-200",children:[t.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Reference / Transaction ID (Optional)"}),t.jsx("input",{type:"text",placeholder:"Enter reference number",value:y,onChange:e=>f(e.target.value),className:"w-full px-4 py-3 text-[16px] text-gray-900 bg-gray-50 border-0 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400",style:{WebkitAppearance:"none"}})]}),t.jsxs("div",{className:"px-4 py-4 border-t border-gray-200",children:[t.jsx("div",{className:"text-[13px] text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Quick Amount"}),t.jsx("div",{className:"grid grid-cols-4 gap-2",children:[r,5e3,1e4,2e4,5e4,1e5].map(e=>t.jsx("button",{onClick:()=>b(e.toString()),className:"px-3 py-2 bg-gray-100 text-gray-900 rounded-lg text-[13px] font-medium hover:bg-gray-200 active:bg-gray-300 transition-colors",children:e>=1e3?e/1e3+"K":e},e))})]})]}),t.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-white",children:t.jsx("button",{onClick:w,disabled:v||!u||parseFloat(p)<r,className:"w-full py-4 bg-blue-500 text-white rounded-xl text-[17px] font-semibold hover:bg-blue-600 active:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:v?t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Processing..."]}):`Complete Payment â€¢ TSh ${parseFloat(p).toLocaleString()}`})})]}),t.jsx("style",{children:"\n        @keyframes slideUp {\n          from {\n            transform: translateY(100%);\n          }\n          to {\n            transform: translateY(0);\n          }\n        }\n        .animate-slide-up {\n          animation: slideUp 0.3s ease-out;\n        }\n      "})]}),document.body):null},T=()=>{var e,s,i;W();const{currentUser:o}=a(),{currentBranch:b,loading:g}=L(),{customers:T,loading:F,error:M,refreshCustomers:I}=r(),{products:D,loadProducts:q,loadCategories:O}=l(),U=S(),[Q,E]=n.useState([]),[B,R]=n.useState(""),[_,Y]=n.useState("All"),[K,V]=n.useState(null),[H,G]=n.useState(0),[J,X]=n.useState("percentage"),[Z,ee]=n.useState(""),[te,se]=n.useState(null),[ae,re]=n.useState(!1),[le,ne]=n.useState(!1),[ie,oe]=n.useState(!1),[de,ce]=n.useState(!1),[me,ue]=n.useState(!1),[xe,pe]=n.useState(!1),[be,ge]=n.useState(!1);n.useEffect(()=>{const e=async()=>{if(!g)try{await Promise.all([q({page:1,limit:200}),O()])}catch(e){h.error("Failed to load products")}};e();const t=()=>{e()};return window.addEventListener("branchChanged",t),()=>{window.removeEventListener("branchChanged",t)}},[b,g,q,O]),n.useEffect(()=>{},[o]),n.useEffect(()=>{F||(M?h.error("Failed to load customers. Click to retry.",{duration:5e3,onClick:()=>{I()}}):T.length)},[T,F,M,o]);const he=n.useMemo(()=>D.map(e=>{var t;const s=null==(t=e.variants)?void 0:t[0],a=(null==s?void 0:s.sellingPrice)??(null==s?void 0:s.price)??e.price??0,r=(null==s?void 0:s.quantity)??e.quantity??0;return{id:e.id,name:e.name,price:"string"==typeof a?parseFloat(a):Number(a),category:e.categoryName||"Uncategorized",image:e.thumbnail_url||"",stockQuantity:r,variants:e.variants||[],sku:e.sku||"N/A"}}),[D]),ye=n.useMemo(()=>["All",...Array.from(new Set(he.map(e=>e.category).filter(Boolean)))],[he]),fe=n.useMemo(()=>he.filter(e=>{const t=e.name.toLowerCase().includes(B.toLowerCase())||e.category.toLowerCase().includes(B.toLowerCase()),s="All"===_||e.category===_;return t&&s}),[he,B,_]),ve=n.useCallback(e=>{const t=e.variants[0],s=(null==t?void 0:t.sellingPrice)??(null==t?void 0:t.price)??e.price;if(!s||s<=0)return void h.error("Invalid product price");if(e.stockQuantity<=0)return void h.error(`${e.name} is out of stock`);const a=Q.find(t=>t.productId===e.id);if(a){if(a.quantity+1>e.stockQuantity)return void h.error(`Only ${e.stockQuantity} units available`);E(Q.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1,totalPrice:(t.quantity+1)*t.unitPrice}:t)),h.success(`${e.name} quantity updated`)}else{const a={id:`${e.id}-${(null==t?void 0:t.id)||"default"}-${Date.now()}`,productId:e.id,variantId:(null==t?void 0:t.id)||"default",productName:e.name,variantName:(null==t?void 0:t.name)||"Default",sku:e.sku,quantity:1,unitPrice:s,totalPrice:s,availableQuantity:e.stockQuantity,image:e.image};E([...Q,a]),h.success(`${e.name} added to cart`)}},[Q]),je=n.useCallback((e,t)=>{E(Q.map(s=>{if(s.id===e){const e=s.quantity+t;return e<=0?s:e>s.availableQuantity?(h.error(`Only ${s.availableQuantity} units available`),s):{...s,quantity:e,totalPrice:e*s.unitPrice}}return s}).filter(e=>e.quantity>0))},[Q]),Ne=n.useCallback(e=>{const t=Q.find(t=>t.id===e);E(Q.filter(t=>t.id!==e)),t&&h.success(`${t.productName} removed from cart`)},[Q]),we=n.useCallback(()=>{E([]),G(0),ee(""),V(null),h.success("Cart cleared")},[]),ke=n.useMemo(()=>Q.reduce((e,t)=>e+t.totalPrice,0),[Q]),Ce=H||0,Se=ke-Ce,Pe=18*Se/100,Ae=Se+Pe,Le=n.useCallback(()=>{if(!Z)return void h.error("Enter discount amount");const e=parseFloat(Z);if(isNaN(e)||e<0)return void h.error("Invalid discount value");const t="percentage"===J?ke*e/100:e;t>=ke?h.error("Discount cannot exceed total amount"):(G(t),ue(!1),h.success("Discount applied"))},[Z,J,ke]),We=n.useCallback(()=>{0!==Q.length?Ae<=0?h.error("Invalid total amount"):oe(!0):h.error("Cart is empty")},[Q,Ae]);return t.jsxs("div",{className:"flex flex-col h-full bg-white",children:[t.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-0 z-10",children:[F&&t.jsxs("div",{className:"mb-2 bg-blue-50 border border-blue-200 rounded-lg px-3 py-2 flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),t.jsx("span",{className:"text-[14px] text-blue-800",children:"Loading customers..."})]}),M&&t.jsxs("div",{className:"mb-2 bg-red-50 border border-red-200 rounded-lg px-3 py-2 flex items-center justify-between",children:[t.jsx("span",{className:"text-[14px] text-red-800",children:"Failed to load customers"}),t.jsx("button",{onClick:()=>I(),className:"text-[12px] bg-red-600 text-white px-2 py-1 rounded-md hover:bg-red-700",children:"Retry"})]}),!F&&!M&&0===T.length&&t.jsxs("div",{className:"mb-2 bg-yellow-50 border border-yellow-200 rounded-lg px-3 py-2 flex items-center justify-between",children:[t.jsx("span",{className:"text-[14px] text-yellow-800",children:"No customers yet"}),t.jsx("button",{onClick:()=>ne(!0),className:"text-[12px] bg-yellow-600 text-white px-2 py-1 rounded-md hover:bg-yellow-700",children:"Add First Customer"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-[32px] font-bold text-black tracking-tight",children:"POS"}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{onClick:()=>pe(!0),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(y,{size:20,className:"text-blue-500"})})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16,strokeWidth:2}),t.jsx("input",{type:"text",placeholder:"Search products",value:B,onChange:e=>R(e.target.value),className:"w-full pl-9 pr-4 py-2 bg-[#f2f2f7] border-0 rounded-lg focus:outline-none focus:ring-0 text-gray-900 placeholder-gray-400 text-[15px] font-light",style:{WebkitAppearance:"none"}})]}),t.jsx("button",{onClick:()=>h("Barcode scanner coming soon!",{icon:"ðŸ“¸"}),className:"p-2 bg-[#f2f2f7] rounded-lg hover:bg-gray-300 active:bg-gray-400 transition-colors","aria-label":"Scan barcode",children:t.jsx(f,{size:20,className:"text-gray-600",strokeWidth:2})})]}),t.jsxs("div",{className:"mt-3",children:[t.jsxs("button",{onClick:()=>ge(!be),className:"flex items-center gap-2 text-blue-500 text-[14px] font-medium",children:[t.jsx("span",{children:"Categories"}),"All"!==_&&t.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full text-[12px] font-semibold",children:_}),t.jsx("span",{className:"transition-transform "+(be?"rotate-180":""),children:"â–¼"})]}),be&&t.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 pt-2 scrollbar-hide -mx-4 px-4",children:ye.map(e=>t.jsx("button",{onClick:()=>{Y(e),"All"!==e&&ge(!1)},className:"px-4 py-2 rounded-full text-[14px] font-medium whitespace-nowrap transition-all "+(_===e?"bg-blue-500 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e},e))})]}),t.jsxs("div",{className:"flex gap-2 mt-3",children:[t.jsxs("button",{onClick:()=>{if(!F)return 0===T.length?(h("No customers found. Add a customer first.",{icon:"ðŸ‘¥",duration:3e3}),void ne(!0)):void re(!0);h("Loading customers, please wait...",{icon:"â³"})},disabled:F,className:"flex-1 flex items-center justify-center gap-2 bg-blue-500 text-white px-4 py-2.5 rounded-xl text-[15px] font-semibold hover:bg-blue-600 active:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm",children:[t.jsx(p,{size:18,strokeWidth:2.5}),F?"Loading...":K?"Change":"Customer"]}),t.jsxs("button",{onClick:()=>ue(!me),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-[15px] font-semibold transition-all shadow-sm "+(me||H>0?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[t.jsx(v,{size:18,strokeWidth:2.5}),H>0?`TSh ${H.toLocaleString()}`:"Discount"]}),Q.length>0&&t.jsx("button",{onClick:we,className:"flex items-center justify-center bg-red-500 text-white px-4 py-2.5 rounded-xl text-[15px] font-semibold hover:bg-red-600 active:bg-red-700 transition-all shadow-sm",children:t.jsx(j,{size:18,strokeWidth:2.5})})]}),Q.length>0&&t.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-xl border border-blue-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{size:18,className:"text-blue-600",strokeWidth:2}),t.jsxs("span",{className:"text-[15px] text-blue-900 font-medium",children:[Q.length," item",1!==Q.length?"s":""," in cart"]})]}),t.jsxs("span",{className:"text-[17px] text-blue-600 font-bold",children:["TSh ",ke.toLocaleString()]})]})}),me&&t.jsxs("div",{className:"mt-3 p-4 bg-white rounded-xl border border-gray-200",children:[t.jsxs("div",{className:"flex gap-2 mb-3",children:[t.jsx("button",{onClick:()=>X("percentage"),className:"flex-1 px-4 py-2.5 rounded-lg text-[15px] font-medium transition-all "+("percentage"===J?"bg-blue-500 text-white shadow-sm":"bg-gray-100 text-gray-700"),children:"Percentage %"}),t.jsx("button",{onClick:()=>X("fixed"),className:"flex-1 px-4 py-2.5 rounded-lg text-[15px] font-medium transition-all "+("fixed"===J?"bg-blue-500 text-white shadow-sm":"bg-gray-100 text-gray-700"),children:"Fixed Amount"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"flex-1 relative",children:["fixed"===J&&t.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-[16px]",children:"TSh"}),t.jsx("input",{type:"number",placeholder:"percentage"===J?"Enter %":"Amount",value:Z,onChange:e=>ee(e.target.value),className:`w-full ${"fixed"===J?"pl-12":"pl-4"} pr-4 py-3 bg-gray-50 border-0 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-[16px] text-gray-900 placeholder-gray-400`,style:{WebkitAppearance:"none"}}),"percentage"===J&&t.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-[16px]",children:"%"})]}),t.jsx("button",{onClick:Le,className:"px-6 py-3 bg-blue-500 text-white rounded-lg text-[15px] font-semibold hover:bg-blue-600 active:bg-blue-700 transition-colors shadow-sm",children:"Apply"})]}),Z&&parseFloat(Z)>0&&t.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded-lg",children:t.jsx("div",{className:"text-[13px] text-blue-600",children:"percentage"===J?`${Z}% discount = TSh ${(ke*parseFloat(Z)/100).toLocaleString()}`:`Discount = TSh ${parseFloat(Z).toLocaleString()}`})})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",style:{paddingBottom:Q.length>0?"400px":"16px"},children:0===fe.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:t.jsx(w,{size:40,className:"text-gray-400",strokeWidth:1.5})}),t.jsx("p",{className:"text-gray-500 text-[15px]",children:"No products found"}),t.jsx("p",{className:"text-[13px] text-gray-400 mt-2",children:"Try a different search term"})]}):t.jsx("div",{className:"grid grid-cols-2 gap-3",style:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:fe.map(e=>t.jsxs("button",{onClick:()=>ve(e),disabled:e.stockQuantity<=0,className:"bg-white rounded-xl p-3 border text-left transition-all "+(e.stockQuantity<=0?"border-gray-200 opacity-50 cursor-not-allowed":"border-gray-200 hover:border-blue-300 active:bg-gray-50"),children:["string"==typeof e.image&&e.image.startsWith("http")?t.jsx("img",{src:e.image,alt:e.name,className:"w-full h-24 object-cover rounded-lg mb-2"}):t.jsx("div",{className:"w-full h-24 bg-gray-100 rounded-lg flex items-center justify-center mb-2",children:t.jsx(w,{size:32,className:"text-gray-400",strokeWidth:1.5})}),t.jsx("div",{className:"font-medium text-gray-900 text-[14px] mb-1 line-clamp-2",children:e.name}),t.jsx("div",{className:"text-[12px] text-gray-500 mb-2",children:e.category}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsxs("div",{className:"text-blue-600 font-semibold text-[15px]",children:["TSh ",e.price.toLocaleString()]}),t.jsxs("div",{className:"text-[11px] text-gray-500",children:[e.stockQuantity," left"]})]}),e.stockQuantity<=0&&t.jsx("div",{className:"mt-1 text-[11px] text-red-600 font-semibold",children:"Out of Stock"})]},e.id))})}),K&&Q.length>0&&t.jsx("div",{className:"fixed bottom-[340px] left-0 right-0 bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 border-t border-b border-blue-200 px-4 py-2.5 shadow-lg z-20",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white font-bold text-[14px] shadow-md flex-shrink-0",children:(e=>{if(!e)return"??";const t=e.trim().split(" ");return t.length>=2?`${t[0][0]}${t[t.length-1][0]}`.toUpperCase():e.substring(0,2).toUpperCase()})(K.name)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"text-[10px] font-semibold text-blue-600 uppercase tracking-wide",children:"Sale For"})}),t.jsx("h3",{className:"text-[15px] font-bold text-gray-900 truncate",children:K.name})]}),t.jsx("button",{onClick:()=>V(null),className:"w-7 h-7 flex items-center justify-center rounded-full bg-white hover:bg-red-50 active:bg-red-100 transition-colors shadow-sm flex-shrink-0 border border-gray-200","aria-label":"Remove customer",children:t.jsx(j,{size:14,className:"text-red-500",strokeWidth:2.5})})]})}),Q.length>0&&t.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-2xl z-20",style:{maxHeight:K?"calc(100vh - 400px)":"calc(100vh - 350px)"},children:[t.jsx("div",{className:"max-h-32 overflow-y-auto px-4 pt-3 space-y-2 scrollbar-thin",children:Q.map(e=>t.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 rounded-lg p-2",children:[t.jsx("div",{className:"w-10 h-10 flex-shrink-0",children:"string"==typeof e.image&&e.image.startsWith("http")?t.jsx("img",{src:e.image,alt:e.productName,className:"w-10 h-10 object-cover rounded"}):t.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded flex items-center justify-center",children:t.jsx(w,{size:20,className:"text-gray-400",strokeWidth:1.5})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-[13px] text-gray-900 truncate",children:e.productName}),t.jsxs("div",{className:"text-[11px] text-gray-500",children:["TSh ",e.unitPrice.toLocaleString()," Ã— ",e.quantity]})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("button",{onClick:()=>je(e.id,-1),className:"p-1 rounded-full bg-gray-200 hover:bg-gray-300 active:bg-gray-400",children:t.jsx(k,{size:12,strokeWidth:3})}),t.jsx("span",{className:"font-semibold text-[13px] w-7 text-center",children:e.quantity}),t.jsx("button",{onClick:()=>je(e.id,1),className:"p-1 rounded-full bg-blue-500 text-white hover:bg-blue-600 active:bg-blue-700",children:t.jsx(u,{size:12,strokeWidth:3})}),t.jsx("button",{onClick:()=>Ne(e.id),className:"p-1 text-red-500 hover:bg-red-50 rounded-full active:bg-red-100",children:t.jsx(j,{size:14,strokeWidth:3})})]})]},e.id))}),t.jsxs("div",{className:"px-4 py-3 space-y-1.5 border-t border-gray-200 bg-gray-50",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-[14px] text-gray-600",children:"Subtotal"}),t.jsxs("span",{className:"text-[15px] font-medium text-gray-900",children:["TSh ",ke.toLocaleString()]})]}),Ce>0&&t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-[14px] text-green-600",children:"Discount"}),t.jsxs("span",{className:"text-[15px] font-medium text-green-600",children:["-TSh ",Ce.toLocaleString()]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{className:"text-[14px] text-gray-600",children:["Tax (",18,"%)"]}),t.jsxs("span",{className:"text-[15px] font-medium text-gray-900",children:["TSh ",Pe.toLocaleString()]})]}),t.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-300",children:[t.jsx("span",{className:"text-[16px] font-semibold text-gray-900",children:"Total"}),t.jsxs("span",{className:"text-[22px] font-bold text-blue-600",children:["TSh ",Ae.toLocaleString()]})]})]}),t.jsx("div",{className:"px-4 py-3 bg-white border-t border-gray-100",children:t.jsxs("button",{onClick:We,className:"w-full bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white px-6 py-3.5 rounded-xl text-[16px] font-semibold flex items-center justify-center gap-2 shadow-lg transition-all active:scale-98",children:[t.jsx(N,{size:20,strokeWidth:2.5}),"Checkout â€¢ ",Q.length," ",1===Q.length?"item":"items"]})})]}),t.jsx($,{isOpen:ae,onClose:()=>re(!1),onCustomerSelect:e=>{V(e),h.success(`Customer "${e.name}" selected`)},onAddNew:()=>ne(!0),selectedCustomer:K}),t.jsx(C,{isOpen:le,onClose:()=>ne(!1),onCustomerCreated:e=>{V(e),ne(!1),h.success(`Customer "${e.name}" created`)},onAddAnother:()=>ne(!0)}),t.jsx(z,{isOpen:ie,onClose:()=>oe(!1),amount:Ae,customerId:null==K?void 0:K.id,customerName:(null==K?void 0:K.name)||"Walk-in Customer",description:`POS Sale - ${Q.length} items`,onPaymentComplete:async(e,t)=>{var s,a;try{const r={customerId:(null==K?void 0:K.id)||null,customerName:(null==K?void 0:K.name)||"Walk-in Customer",customerPhone:(null==K?void 0:K.phone)||null,customerEmail:(null==K?void 0:K.email)||null,branchId:(null==b?void 0:b.id)||null,items:Q.map(e=>({id:e.id,productId:e.productId,variantId:e.variantId,productName:e.productName,variantName:e.variantName,sku:e.sku,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice,costPrice:0,profit:0})),subtotal:ke,tax:Pe,discount:Ce,discountType:J,discountValue:parseFloat(Z)||0,total:Ae,paymentMethod:{type:1===e.length?e[0].paymentMethod:"multiple",details:{payments:e.map(e=>({method:e.paymentMethod,amount:e.amount,accountId:e.paymentAccountId,reference:e.reference,notes:e.notes,timestamp:e.timestamp})),totalPaid:t||Ae},amount:t||Ae},paymentStatus:"completed",soldBy:(null==o?void 0:o.name)||(null==o?void 0:o.email)||"POS User",soldAt:(new Date).toISOString(),notes:e.map(e=>e.notes).filter(Boolean).join("; ")||void 0},l=await d.processSale(r);if(l.success){const r={id:(null==(s=l.sale)?void 0:s.id)||"",date:(new Date).toLocaleDateString(),time:(new Date).toLocaleTimeString(),items:Q.map(e=>({productName:e.productName,variantName:e.variantName,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice})),customer:K?{name:K.name,phone:K.phone,email:K.email}:null,subtotal:ke,tax:Pe,discount:Ce,total:Ae,paymentMethod:{name:1===e.length?e[0].paymentMethod:"Multiple Payments",description:`${e.length} payment(s) - ${m.money(t||Ae)}`,icon:"CreditCard"},cashier:(null==o?void 0:o.name)||"POS User",receiptNumber:(null==(a=l.sale)?void 0:a.saleNumber)||"N/A"};se(r),oe(!1),setTimeout(()=>{var e;U.show(`Payment of ${m.money(t||Ae)} processed successfully!${(null==(e=l.sale)?void 0:e.saleNumber)?` Sale #${l.sale.saleNumber}`:""}`,{title:"Sale Complete! ðŸŽ‰",icon:A.paymentReceived,autoCloseDelay:0,actionButtons:[{label:"Share Receipt",onClick:()=>{ce(!0)},variant:"primary"},{label:"New Sale",onClick:()=>{U.hide()},variant:"secondary"}]})},100),setTimeout(()=>{we()},150)}else h.error(l.error||"Failed to process sale"),oe(!1)}catch(r){h.error(`Payment failed: ${r.message}`)}}}),t.jsx(c,{isOpen:de,onClose:()=>ce(!1),onPrintReceipt:()=>{ce(!1),h.success("Receipt printed")},receiptData:{receiptNumber:(null==te?void 0:te.receiptNumber)||"N/A",amount:(null==te?void 0:te.total)||0,customerName:(null==(e=null==te?void 0:te.customer)?void 0:e.name)||(null==K?void 0:K.name),customerPhone:(null==(s=null==te?void 0:te.customer)?void 0:s.phone)||(null==K?void 0:K.phone),customerEmail:(null==(i=null==te?void 0:te.customer)?void 0:i.email)||(null==K?void 0:K.email),items:(null==te?void 0:te.items)||[]}}),t.jsx(P,{...U})]})};export{T as default};
