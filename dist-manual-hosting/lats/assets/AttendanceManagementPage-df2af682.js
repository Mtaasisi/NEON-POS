import{s as e,j as t}from"./index-222cfb29.js";import{r as a}from"./vendor-a2ff445a.js";import{z as s}from"./ui-551a39a6.js";import{r,t as n,f as l}from"./index-0096d614.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";import"./pdf-33d2fdad.js";function i(e){r(1,arguments);var t=n(e).getDay();return 0===t||6===t}function d(e){r(1,arguments);var t=n(e);return t.setHours(0,0,0,0),t}function o(e){r(1,arguments);var t=n(e),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}function c(e){r(1,arguments);var t=n(e);return t.setDate(1),t.setHours(0,0,0,0),t}const u=()=>{const[u,m]=a.useState([]),[x,g]=a.useState([]),[p,h]=a.useState(new Date),[y,f]=a.useState(!0),[v,b]=a.useState("all");a.useEffect(()=>{j(),w()},[p]);const j=async()=>{try{const{data:t,error:a}=await e.from("employees").select("*").eq("is_active",!0).order("full_name");if(a)throw a;m(t||[])}catch(t){s.error("Failed to load employees")}},w=async()=>{try{f(!0);const t=l(c(p),"yyyy-MM-dd"),a=l(o(p),"yyyy-MM-dd"),{data:s,error:r}=await e.from("attendance_records").select("*").gte("attendance_date",t).lte("attendance_date",a).order("attendance_date");if(r)throw r;g(s||[])}catch(t){s.error("Failed to load attendance records")}finally{f(!1)}},N=(e,t)=>x.find(a=>a.employee_id===e&&function(e,t){r(2,arguments);var a=d(e),s=d(t);return a.getTime()===s.getTime()}(new Date(a.attendance_date),t)),_="all"===v?u:u.filter(e=>e.id===v),S=function(e,t){var a;r(1,arguments);var s=e||{},l=n(s.start),i=n(s.end).getTime();if(!(l.getTime()<=i))throw new RangeError("Invalid interval");var d=[],o=l;o.setHours(0,0,0,0);var c=Number(null!==(a=null==t?void 0:t.step)&&void 0!==a?a:1);if(c<1||isNaN(c))throw new RangeError("`options.step` must be a number greater than 1");for(;o.getTime()<=i;)d.push(n(o)),o.setDate(o.getDate()+c),o.setHours(0,0,0,0);return d}({start:c(p),end:o(p)});return y?t.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading attendance..."})]})}):t.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Attendance Management"}),t.jsx("p",{className:"text-gray-600",children:"Track and manage employee attendance records"})]}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Month"}),t.jsx("input",{type:"month",value:l(p,"yyyy-MM"),onChange:e=>h(new Date(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee"}),t.jsxs("select",{value:v,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"all",children:"All Employees"}),u.map(e=>t.jsxs("option",{value:e.id,children:[e.full_name," - ",e.position]},e.id))]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"sticky left-0 bg-gray-50 px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),S.map(e=>t.jsxs("th",{className:"px-3 py-3 text-center text-xs font-medium uppercase tracking-wider "+(i(e)?"bg-gray-100 text-gray-400":"text-gray-500"),children:[t.jsx("div",{children:l(e,"EEE")}),t.jsx("div",{children:l(e,"d")})]},e.toISOString())),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stats"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map(a=>{const r=(e=>{const t=x.filter(t=>t.employee_id===e);return{present:t.filter(e=>"present"===e.status).length,absent:t.filter(e=>"absent"===e.status).length,late:t.filter(e=>"late"===e.status).length,leave:t.filter(e=>"leave"===e.status).length}})(a.id);return t.jsxs("tr",{children:[t.jsxs("td",{className:"sticky left-0 bg-white px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.full_name}),t.jsx("div",{className:"text-sm text-gray-500",children:a.position})]}),S.map(r=>{const n=N(a.id,r),d=i(r);return t.jsx("td",{className:"px-1 py-2 text-center "+(d?"bg-gray-50":""),children:!d&&t.jsx("button",{onClick:()=>{const t="present"===(null==n?void 0:n.status)?"absent":"present";(async(t,a,r)=>{try{const n=l(a,"yyyy-MM-dd"),{data:i}=await e.from("attendance_records").select("id").eq("employee_id",t).eq("attendance_date",n).maybeSingle();if(i){const{error:t}=await e.from("attendance_records").update({status:r,check_in_time:"present"===r?(new Date).toISOString():null,updated_at:(new Date).toISOString()}).eq("id",i.id);if(t)throw t}else{const{error:a}=await e.from("attendance_records").insert({employee_id:t,attendance_date:n,status:r,check_in_time:"present"===r?(new Date).toISOString():null});if(a)throw a}s.success("Attendance marked successfully"),w()}catch(n){s.error("Failed to mark attendance")}})(a.id,r,t)},className:"w-8 h-8 rounded-lg text-xs font-medium transition-colors "+("present"===(null==n?void 0:n.status)?"bg-green-500 text-white hover:bg-green-600":"absent"===(null==n?void 0:n.status)?"bg-red-500 text-white hover:bg-red-600":"late"===(null==n?void 0:n.status)?"bg-yellow-500 text-white hover:bg-yellow-600":"leave"===(null==n?void 0:n.status)?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-200 text-gray-600 hover:bg-gray-300"),title:(null==n?void 0:n.status)||"No record",children:"present"===(null==n?void 0:n.status)?"P":"absent"===(null==n?void 0:n.status)?"A":"late"===(null==n?void 0:n.status)?"L":"leave"===(null==n?void 0:n.status)?"LV":"-"})},r.toISOString())}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-xs",children:[t.jsxs("div",{className:"text-green-600",children:["P: ",r.present]}),t.jsxs("div",{className:"text-red-600",children:["A: ",r.absent]}),t.jsxs("div",{className:"text-yellow-600",children:["L: ",r.late]}),t.jsxs("div",{className:"text-blue-600",children:["LV: ",r.leave]})]})})]},a.id)})})]})}),0===_.length&&t.jsx("div",{className:"text-center py-12 text-gray-500",children:"No employees found. Add employees to start tracking attendance."})]})};export{u as default};
