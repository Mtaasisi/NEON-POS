import{s as e}from"./index-222cfb29.js";const t={async getReminders(t){let d=e.from("reminders").select("*").order("date",{ascending:!0}).order("time",{ascending:!0});t&&(d=d.eq("branch_id",t));const{data:r,error:a}=await d;if(a)throw a;return(r||[]).map(e=>({...e,relatedTo:e.related_to,assignedTo:e.assigned_to,notifyBefore:e.notify_before,createdBy:e.created_by,createdAt:e.created_at,updatedAt:e.updated_at,completedAt:e.completed_at,branchId:e.branch_id}))},async getPendingReminders(t){let d=e.from("reminders").select("*").eq("status","pending").order("date",{ascending:!0}).order("time",{ascending:!0});t&&(d=d.eq("branch_id",t));const{data:r,error:a}=await d;if(a)throw a;return(r||[]).map(e=>({...e,relatedTo:e.related_to,assignedTo:e.assigned_to,notifyBefore:e.notify_before,createdBy:e.created_by,createdAt:e.created_at,updatedAt:e.updated_at,completedAt:e.completed_at,branchId:e.branch_id}))},async getTodayReminders(t){const d=(new Date).toISOString().split("T")[0];let r=e.from("reminders").select("*").eq("date",d).eq("status","pending").order("time",{ascending:!0});t&&(r=r.eq("branch_id",t));const{data:a,error:o}=await r;if(o)throw o;return(a||[]).map(e=>({...e,relatedTo:e.related_to,assignedTo:e.assigned_to,notifyBefore:e.notify_before,createdBy:e.created_by,createdAt:e.created_at,updatedAt:e.updated_at,completedAt:e.completed_at,branchId:e.branch_id}))},async createReminder(t,d,r){const a={title:t.title,description:t.description,date:t.date,time:t.time,priority:t.priority,category:t.category,status:"pending",created_by:d,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),branch_id:r,notify_before:t.notifyBefore};void 0!==t.relatedTo&&(a.related_to=t.relatedTo),void 0!==t.assignedTo&&(a.assigned_to=t.assignedTo),void 0!==t.recurring&&(a.recurring=t.recurring);const{data:o,error:n}=await e.from("reminders").insert([a]).select("*").single();if(n)throw new Error(`Failed to create reminder: ${n.message}`);if(!o){const{data:o,error:n}=await e.from("reminders").select("*").eq("created_by",d).eq("branch_id",r).eq("title",a.title).eq("date",a.date).eq("time",a.time).order("created_at",{ascending:!1}).limit(1).single();return n||!o?{...a,id:"temporary-id-"+Date.now(),relatedTo:t.relatedTo,assignedTo:t.assignedTo,notifyBefore:t.notifyBefore}:{...o,relatedTo:o.related_to,assignedTo:o.assigned_to,notifyBefore:o.notify_before,createdBy:o.created_by,createdAt:o.created_at,updatedAt:o.updated_at,completedAt:o.completed_at,branchId:o.branch_id}}return{...o,relatedTo:o.related_to,assignedTo:o.assigned_to,notifyBefore:o.notify_before,createdBy:o.created_by,createdAt:o.created_at,updatedAt:o.updated_at,completedAt:o.completed_at,branchId:o.branch_id}},async updateReminder(t,d){const r={...d,updated_at:(new Date).toISOString()};void 0!==d.relatedTo&&(r.related_to=d.relatedTo,delete r.relatedTo),void 0!==d.assignedTo&&(r.assigned_to=d.assignedTo,delete r.assignedTo),void 0!==d.notifyBefore&&(r.notify_before=d.notifyBefore,delete r.notifyBefore),void 0!==d.createdBy&&(r.created_by=d.createdBy,delete r.createdBy),void 0!==d.createdAt&&(r.created_at=d.createdAt,delete r.createdAt),void 0!==d.completedAt&&(r.completed_at=d.completedAt,delete r.completedAt),void 0!==d.branchId&&(r.branch_id=d.branchId,delete r.branchId);const{data:a,error:o}=await e.from("reminders").update(r).eq("id",t).select().single();if(o)throw o;return{...a,relatedTo:a.related_to,assignedTo:a.assigned_to,notifyBefore:a.notify_before,createdBy:a.created_by,createdAt:a.created_at,updatedAt:a.updated_at,completedAt:a.completed_at,branchId:a.branch_id}},async completeReminder(t){const{data:d,error:r}=await e.from("reminders").update({status:"completed",completed_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",t).select().single();if(r)throw r;return{...d,relatedTo:d.related_to,assignedTo:d.assigned_to,notifyBefore:d.notify_before,createdBy:d.created_by,createdAt:d.created_at,updatedAt:d.updated_at,completedAt:d.completed_at,branchId:d.branch_id}},async deleteReminder(t){const{error:d}=await e.from("reminders").delete().eq("id",t);if(d)throw d},async getOverdueReminders(t){const d=new Date,r=d.toISOString().split("T")[0],a=d.toTimeString().split(" ")[0].slice(0,5);let o=e.from("reminders").select("*").eq("status","pending");t&&(o=o.eq("branch_id",t));const{data:n,error:i}=await o;if(i)throw i;return(n||[]).filter(e=>{const t=e.date,d=e.time;return t<r||t===r&&d<a}).map(e=>({...e,relatedTo:e.related_to,assignedTo:e.assigned_to,notifyBefore:e.notify_before,createdBy:e.created_by,createdAt:e.created_at,updatedAt:e.updated_at,completedAt:e.completed_at,branchId:e.branch_id}))}};export{t as r};
