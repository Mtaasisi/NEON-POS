import{n as e}from"./ui-551a39a6.js";import{M as t,Z as s}from"./index-222cfb29.js";const a=new class{async makeRequest(e,t={}){try{const s=await fetch("/.netlify/functions/whatsapp-proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e,...t})}),a=await s.json();if(!s.ok)throw new Error(a.error||`HTTP ${s.status}`);return a}catch(s){throw s}}async getStateInstance(e){return this.makeRequest("getStateInstance",{instanceId:e})}async getSettings(e){return this.makeRequest("getSettings",{instanceId:e})}async getWebhookSettings(e){return this.makeRequest("getWebhookSettings",{instanceId:e})}async setWebhookSettings(e,t,s){return this.makeRequest("setWebhookSettings",{instanceId:e,webhookUrl:t,webhookSecret:s})}async sendMessage(e,t,s){return this.makeRequest("sendMessage",{instanceId:e,chatId:t,message:s})}async sendTextMessage(e,t,s){return this.makeRequest("sendTextMessage",{instanceId:e,chatId:t,text:s})}async sendFileByUrl(e,t,s,a){return this.makeRequest("sendFileByUrl",{instanceId:e,chatId:t,fileUrl:s,fileName:a})}async getChatHistory(e,t,s){return this.makeRequest("getChatHistory",{instanceId:e,chatId:t,count:s||100})}async getMessages(e,t,s){return this.makeRequest("getMessages",{instanceId:e,chatId:t,count:s||100})}async getChats(e){return this.makeRequest("getChats",{instanceId:e})}async getContacts(e){return this.makeRequest("getContacts",{instanceId:e})}async getContactInfo(e,t){return this.makeRequest("getContactInfo",{instanceId:e,chatId:t})}async deleteMessage(e,t,s){return this.makeRequest("deleteMessage",{instanceId:e,chatId:t,messageId:s})}async markMessageAsRead(e,t,s){return this.makeRequest("markMessageAsRead",{instanceId:e,chatId:t,messageId:s})}async health(){return this.makeRequest("health")}async testConnection(e){var t;try{return{connected:!0,state:null==(t=(await this.getStateInstance(e)).data)?void 0:t.stateInstance}}catch(s){return{connected:!1,error:s.message}}}async checkAllInstances(e){const t={};return await Promise.all(e.map(async e=>{t[e]=await this.testConnection(e)})),t}};const n=new class{async checkInstanceStatus(){try{return{authorized:!1,state:"notAuthorized",error:"WhatsApp credentials not configured"}}catch(e){return{authorized:!1,state:"error",error:e.message||"Failed to check WhatsApp status"}}}async sendWhatsAppMessage(a,n,r){try{const r=await t("WHATSAPP_GATEWAY");if(!r)return e.error("WhatsApp not configured. Please set up in Admin Settings → Integrations"),{success:!1,error:"WhatsApp integration not configured. Please set up WhatsApp in Admin Settings → Integrations"};const c=a.replace(/\D/g,"")+"@c.us",i=`${r.api_url||"https://7105.api.greenapi.com"}/waInstance${r.instance_id}/sendMessage/${r.api_token}`,o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:c,message:n})}),h=await o.json(),d=o.ok&&h.idMessage;return s("WHATSAPP_GATEWAY",d).catch(e=>{}),d?{success:!0,messageId:h.idMessage}:{success:!1,error:h.error||"Failed to send WhatsApp message"}}catch(c){return s("WHATSAPP_GATEWAY",!1).catch(e=>{}),{success:!1,error:c.message||"Failed to send WhatsApp message"}}}async testConnection(e){try{return await a.testConnection(e)}catch(t){return{connected:!1,error:t.message}}}async sendMessageViaProxy(e,t,s){try{return await a.sendTextMessage(e,t,s)}catch(n){throw n}}};export{n as w};
