import{s as e,j as s,u as t}from"./index-222cfb29.js";import{r as a}from"./vendor-a2ff445a.js";import{b4 as r,a8 as l,aj as n,X as i,a5 as o,U as d,P as c,j as m,v as x,aA as u,D as h,V as p,n as g,ax as b,R as y,k as f,ah as j,av as v,bg as N,d as w,f as _,e as S,u as k}from"./ui-551a39a6.js";import{r as C,D}from"./rbac-bc517d81.js";import{u as T}from"./useBusinessInfo-13b9c3ff.js";import{a as $}from"./routing-a2f0f6d2.js";import{R as P,A as U,C as O,X as F,Y as M,T as A,e as I,P as L,b as E,c as R,B as q,a as z}from"./charts-66cc82bb.js";import"./supabase-7e851d02.js";const B=({isOpen:t,onClose:b,saleId:y})=>{var f,j,v,N,w,_,S,k,C;const[D,T]=a.useState(null),[$,P]=a.useState(!1),[U,O]=a.useState(null),[F,M]=a.useState("Unknown");a.useEffect(()=>{if(t&&y){if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(y))return void O("Invalid sale ID format");A()}},[t,y]);const A=async()=>{try{P(!0),O(null);const{data:t,error:a}=await e.from("lats_sales").select("*").eq("id",y).single();if(a)return void O(`Failed to load sale: ${a.message}`);if(t.sold_by)try{const{data:s,error:a}=await e.from("users").select("full_name, email").eq("email",t.sold_by).single();if(!a&&s)M(s.full_name||s.email||t.sold_by);else{const e=t.sold_by.split("@")[0].replace(/[._]/g," ");M(e.charAt(0).toUpperCase()+e.slice(1))}}catch(s){const e=t.sold_by.split("@")[0].replace(/[._]/g," ");M(e.charAt(0).toUpperCase()+e.slice(1))}else if(t.created_by){const e=t.created_by.split("@")[0].replace(/[._]/g," ");M(e.charAt(0).toUpperCase()+e.slice(1))}let r=null;if(t.customer_id){const{data:s,error:a}=await e.from("customers").select("*").eq("id",t.customer_id).single();a||(r=s)}const{data:l,error:n}=await e.from("lats_sale_items").select("*").eq("sale_id",y);if(n)return void O(`Failed to load sale items: ${n.message}`);const i=(null==l?void 0:l.map(e=>e.product_id).filter(Boolean))||[],o=(null==l?void 0:l.map(e=>e.variant_id).filter(Boolean))||[];let d={},c={},m={};if(i.length>0){const{data:s,error:t}=await e.from("lats_products").select("*").in("id",i);t||(d=s.reduce((e,s)=>(e[s.id]=s,e),{}))}const x=Object.values(d).map(e=>e.category_id).filter(Boolean);if(x.length>0){const{data:s,error:t}=await e.from("lats_categories").select("*").in("id",x);t||(c=s.reduce((e,s)=>(e[s.id]=s,e),{}))}if(o.length>0){const{data:s,error:t}=await e.from("lats_product_variants").select("*").in("id",o);t||(m=s.reduce((e,s)=>(e[s.id]=s,e),{}))}const{data:u,error:h}=await e.from("sale_inventory_items").select("inventory_item_id, sale_id").eq("sale_id",y);let p={};if(!h&&u&&u.length>0){const s=u.map(e=>e.inventory_item_id),{data:t,error:a}=await e.from("inventory_items").select("*").in("id",s);!a&&t&&t.forEach(e=>{const s=`${e.product_id}_${e.variant_id||"null"}`;p[s]||(p[s]=[]),p[s].push(e)})}const g={...t,customers:r,lats_sale_items:(null==l?void 0:l.map(e=>{var s,t,a;const r=`${e.product_id}_${e.variant_id||"null"}`,l=p[r]||[];return{...e,serial_numbers:l,lats_products:e.product_id?{...d[e.product_id],lats_categories:(null==(s=d[e.product_id])?void 0:s.category_id)?c[d[e.product_id].category_id]:null}:null,lats_product_variants:e.variant_id?{...m[e.variant_id],lats_products:m[e.variant_id]?{id:m[e.variant_id].product_id,name:null==(t=d[m[e.variant_id].product_id])?void 0:t.name,description:null==(a=d[m[e.variant_id].product_id])?void 0:a.description,sku:m[e.variant_id].sku,barcode:m[e.variant_id].barcode}:null}:null}}))||[]};if(!g.subtotal&&g.lats_sale_items&&(g.subtotal=g.lats_sale_items.reduce((e,s)=>e+(s.total_price||0),0)),!g.discount&&g.subtotal&&g.total_amount){const e=g.subtotal-g.total_amount;e>0&&(g.discount=e)}T(g)}catch(s){O(`Unexpected error: ${s instanceof Error?s.message:"Unknown error"}`)}finally{P(!1)}},I=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),L=e=>new Date(e).toLocaleString("en-TZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=e=>{var s,t;if(!e)return null;if("string"==typeof e)try{const t=JSON.parse(e);return(null==(s=t.details)?void 0:s.payments)&&Array.isArray(t.details.payments)&&t.details.payments.length>1?t.details.payments:null}catch{return null}return"object"==typeof e&&(null==(t=e.details)?void 0:t.payments)&&Array.isArray(e.details.payments)&&e.details.payments.length>1?e.details.payments:null};return t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(r,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Sale Details"}),s.jsx("p",{className:"text-sm text-gray-600",children:D?`Sale #${D.sale_number}`:"Loading..."})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{window.print()},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Print",children:s.jsx(l,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>{g.success("Download functionality will be implemented")},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Download",children:s.jsx(n,{className:"w-5 h-5"})}),s.jsx("button",{onClick:b,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(i,{className:"w-5 h-5"})})]})]}),s.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-80px)]",children:$?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),s.jsx("span",{className:"ml-3 text-gray-600",children:"Loading sale details..."})]}):U?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-red-500 text-lg mb-2",children:"âš ï¸"}),s.jsx("p",{className:"text-gray-600",children:U}),s.jsx("button",{onClick:A,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Retry"})]})}):D?s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[s.jsx(o,{className:"w-5 h-5 text-blue-600"}),"Sale Information"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Sale Number"}),s.jsx("p",{className:"text-gray-900 font-mono",children:D.sale_number})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Status"}),s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(e=>{switch(null==e?void 0:e.toLowerCase()){case"completed":case"success":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(D.status)}`,children:D.status})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Cashier"}),s.jsx("p",{className:"text-gray-900",children:F})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Date & Time"}),s.jsx("p",{className:"text-gray-900",children:L(D.created_at)})]})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[s.jsx(d,{className:"w-5 h-5 text-green-600"}),"Customer Information"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Name"}),s.jsx("p",{className:"text-gray-900",children:(null==(f=D.customers)?void 0:f.name)||(D.customer_id?`Customer: ${D.customer_id.slice(0,8)}...`:"Walk-in Customer")}),(null==(j=D.customers)?void 0:j.color_tag)&&s.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full mt-1 "+("vip"===D.customers.color_tag?"bg-purple-100 text-purple-800":"new"===D.customers.color_tag?"bg-green-100 text-green-800":"complainer"===D.customers.color_tag?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:D.customers.color_tag.toUpperCase()})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Phone"}),s.jsx("p",{className:"text-gray-900 flex items-center gap-2",children:(null==(v=D.customers)?void 0:v.phone)||D.customer_phone?s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"w-4 h-4"}),(null==(N=D.customers)?void 0:N.phone)||D.customer_phone]}):"Not provided"}),(null==(w=D.customers)?void 0:w.whatsapp)&&s.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["WhatsApp: ",D.customers.whatsapp]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Email"}),s.jsx("p",{className:"text-gray-900 flex items-center gap-2",children:(null==(_=D.customers)?void 0:_.email)||D.customer_email?s.jsxs(s.Fragment,{children:[s.jsx(m,{className:"w-4 h-4"}),(null==(S=D.customers)?void 0:S.email)||D.customer_email]}):"Not provided"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Location"}),s.jsx("p",{className:"text-gray-900 flex items-center gap-2",children:(null==(k=D.customers)?void 0:k.city)||D.customer_address?s.jsxs(s.Fragment,{children:[s.jsx(x,{className:"w-4 h-4"}),(null==(C=D.customers)?void 0:C.city)||D.customer_address]}):"Not provided"})]}),D.customers&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Loyalty Level"}),s.jsx("p",{className:"text-gray-900",children:s.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+("platinum"===D.customers.loyalty_level?"bg-gray-100 text-gray-800":"gold"===D.customers.loyalty_level?"bg-yellow-100 text-yellow-800":"silver"===D.customers.loyalty_level?"bg-gray-100 text-gray-600":"bg-orange-100 text-orange-800"),children:D.customers.loyalty_level.toUpperCase()})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Spent"}),s.jsx("p",{className:"text-gray-900 font-semibold",children:I(D.customers.total_spent)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Points"}),s.jsx("p",{className:"text-gray-900",children:D.customers.points.toLocaleString()})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Last Visit"}),s.jsx("p",{className:"text-gray-900",children:L(D.customers.last_visit)})]})]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[s.jsx(u,{className:"w-5 h-5 text-purple-600"}),"Payment Information"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Payment Method(s)"}),s.jsx("p",{className:"text-gray-900",children:(e=>{var s,t;if(!e)return"Unknown";if("string"==typeof e)try{const t=JSON.parse(e);if((null==(s=t.details)?void 0:s.payments)&&Array.isArray(t.details.payments)&&t.details.payments.length>1){const e=t.details.payments.map(e=>(e.method||e.paymentMethod||"Unknown").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()));return`Multiple: ${[...new Set(e)].join(" + ")}`}return t.method||t.type||"Unknown"}catch{return e}if("object"==typeof e){if((null==(t=e.details)?void 0:t.payments)&&Array.isArray(e.details.payments)&&e.details.payments.length>1){const s=e.details.payments.map(e=>(e.method||e.paymentMethod||"Unknown").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()));return`Multiple: ${[...new Set(s)].join(" + ")}`}return e.method||e.type||"Unknown"}return"Unknown"})(D.payment_method)}),E(D.payment_method)&&s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),s.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Payment Breakdown:"})]}),s.jsx("div",{className:"space-y-3",children:E(D.payment_method).map((e,t)=>s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200 shadow-sm",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(u,{className:"w-4 h-4 text-blue-600"})}),s.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:e.method?e.method.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown Method"})]}),s.jsxs("div",{className:"space-y-1",children:[e.reference&&s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Reference:"})," ",e.reference]}),e.transactionId&&s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Transaction ID:"})," ",e.transactionId]}),e.timestamp&&s.jsxs("p",{className:"text-sm text-gray-500",children:[s.jsx("span",{className:"font-medium",children:"Time:"})," ",new Date(e.timestamp).toLocaleString("en-TZ")]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xl font-bold text-green-600 mb-2",children:I(e.amount||e.value||0)}),e.status&&s.jsx("span",{className:"inline-flex px-3 py-1 text-xs font-semibold rounded-full "+("completed"===e.status||"success"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"failed"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.status.toUpperCase()})]})]}),e.notes&&s.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:s.jsxs("p",{className:"text-sm text-gray-600 italic",children:[s.jsx("span",{className:"font-medium",children:"Note:"})," ",e.notes]})})]},t))}),s.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[s.jsx(h,{className:"w-4 h-4 text-green-600"}),"Payment Summary"]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Payments:"}),s.jsx("span",{className:"font-semibold text-gray-900",children:I(E(D.payment_method).reduce((e,s)=>e+(s.amount||s.value||0),0))})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Sale Total:"}),s.jsx("span",{className:"font-bold text-green-600 text-lg",children:I(D.subtotal&&D.discount?D.subtotal-D.discount:D.total_amount)})]}),Math.abs(E(D.payment_method).reduce((e,s)=>e+(s.amount||s.value||0),0)-D.total_amount)>.01&&s.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-yellow-800 flex items-center gap-2",children:[s.jsx("span",{className:"text-yellow-600",children:"âš ï¸"}),"Payment total doesn't match sale total"]})})]})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Amount"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:I(D.subtotal&&D.discount?D.subtotal-D.discount:D.total_amount)})]})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[s.jsx(h,{className:"w-5 h-5 text-green-600"}),"Financial Summary"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),s.jsxs("div",{className:"text-right",children:[s.jsx("span",{className:"text-gray-900",children:D.subtotal?I(D.subtotal):D.lats_sale_items?I(D.lats_sale_items.reduce((e,s)=>e+(s.total_price||0),0)):I(0)}),!D.subtotal&&D.lats_sale_items&&s.jsx("div",{className:"text-xs text-blue-600",children:"(calculated from items)"}),!D.subtotal&&!D.lats_sale_items&&s.jsx("div",{className:"text-xs text-red-600",children:"(no data available)"})]})]}),D.discount>0&&s.jsx("div",{className:"space-y-1",children:s.jsxs("div",{className:"flex justify-between text-red-600",children:[s.jsx("span",{children:"Discount:"}),s.jsx("div",{className:"text-right",children:s.jsxs("span",{children:["-",I(D.discount)]})})]})}),0===D.discount&&D.subtotal&&D.total_amount&&s.jsxs("div",{className:"text-xs text-gray-500",children:["No discount applied (subtotal: ",I(D.subtotal),", total: ",I(D.total_amount),")"]}),D.tax>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Tax:"}),s.jsx("span",{className:"text-gray-900",children:I(D.tax)})]}),s.jsx("div",{className:"border-t pt-3",children:s.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[s.jsx("span",{className:"text-gray-900",children:"Total:"}),s.jsx("span",{className:"text-green-600",children:I(D.subtotal&&D.discount?D.subtotal-D.discount:D.total_amount)})]})})]})]})]})]}),D.lats_sale_items&&D.lats_sale_items.length>0&&s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[s.jsx(p,{className:"w-5 h-5 text-orange-600"}),"Sale Items (",D.lats_sale_items.length,")"]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Product"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"SKU"}),s.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-600",children:"Qty"}),s.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"Unit Price"}),s.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"Total"}),D.lats_sale_items.some(e=>e.cost_price)&&s.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"Profit"})]})}),s.jsx("tbody",{children:D.lats_sale_items.map((e,t)=>{var a,r,l,n,i,o,d;return s.jsxs("tr",{className:t%2==0?"bg-gray-50":"bg-white",children:[s.jsx("td",{className:"py-3 px-4",children:s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:(null==(a=e.lats_products)?void 0:a.name)||e.product_name||`Product: ${e.product_id.slice(0,8)}...`}),(null==(r=e.lats_products)?void 0:r.description)&&s.jsx("p",{className:"text-sm text-gray-500",children:e.lats_products.description}),(null==(l=e.lats_product_variants)?void 0:l.name)&&s.jsxs("p",{className:"text-sm text-gray-600",children:["Variant: ",e.lats_product_variants.name]}),(null==(i=null==(n=e.lats_products)?void 0:n.lats_categories)?void 0:i.name)&&s.jsx("p",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full inline-block mt-1",children:e.lats_products.lats_categories.name}),e.notes&&s.jsxs("p",{className:"text-sm text-gray-500 italic",children:["Note: ",e.notes]}),e.serial_numbers&&e.serial_numbers.length>0&&s.jsx("div",{className:"mt-2 space-y-1",children:e.serial_numbers.map((e,t)=>s.jsx("div",{className:"flex items-start gap-2 text-xs bg-blue-50 border border-blue-200 rounded px-2 py-1",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("span",{className:"font-semibold text-blue-900",children:["S/N: ",e.serial_number]}),e.imei&&s.jsxs("span",{className:"ml-2 text-blue-700",children:["â€¢ IMEI: ",e.imei]}),e.mac_address&&s.jsxs("span",{className:"ml-2 text-blue-700",children:["â€¢ MAC: ",e.mac_address]}),e.location&&s.jsxs("span",{className:"ml-2 text-gray-600",children:["â€¢ From: ",e.location]})]})},t))})]})}),s.jsx("td",{className:"py-3 px-4 text-gray-600 font-mono text-sm",children:(null==(o=e.lats_product_variants)?void 0:o.sku)||(null==(d=e.lats_products)?void 0:d.sku)||e.sku||"N/A"}),s.jsx("td",{className:"py-3 px-4 text-center text-gray-900",children:e.quantity}),s.jsx("td",{className:"py-3 px-4 text-right text-gray-900",children:I(e.price||e.unit_price||0)}),s.jsx("td",{className:"py-3 px-4 text-right font-medium text-gray-900",children:I(e.total_price)}),D.lats_sale_items.some(e=>e.cost_price)&&s.jsx("td",{className:"py-3 px-4 text-right",children:e.cost_price?s.jsx("span",{className:"font-medium "+(e.total_price-e.cost_price*e.quantity>=0?"text-green-600":"text-red-600"),children:I(e.total_price-e.cost_price*e.quantity)}):s.jsx("span",{className:"text-gray-400",children:"N/A"})})]},e.id)})})]})})]}),(D.notes||D.metadata)&&s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[s.jsx(o,{className:"w-5 h-5 text-gray-600"}),"Additional Information"]}),D.notes&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notes"}),s.jsx("p",{className:"text-gray-900 mt-1",children:D.notes})]}),D.metadata&&s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Metadata"}),s.jsx("pre",{className:"text-sm text-gray-700 mt-1 bg-gray-50 p-3 rounded-lg overflow-x-auto",children:JSON.stringify(D.metadata,null,2)})]})]})]}):null})]})}):null};const K=e=>e?e.message?{message:e.message,code:e.code,details:e.details}:{message:String(e)}:{message:"Unknown error occurred"},W=async(e,s)=>{try{const{data:a,error:r}=await e();if(r){if(s)try{const e=await s();return e.error?{data:null,error:K(e.error)}:{data:e.data,error:null}}catch(t){return{data:null,error:K(t)}}return{data:null,error:K(r)}}return{data:a,error:null}}catch(a){return{data:null,error:K(a)}}},V=(e,s=100)=>e.from("lats_sales").select("*").order("created_at",{ascending:!1}).limit(s),Z=()=>{const{currentUser:r}=t(),l=$(),{businessInfo:i}=T(),[c,m]=a.useState("1d"),[x,p]=a.useState("daily"),[K,Z]=a.useState({start:(new Date).toISOString().split("T")[0],end:(new Date).toISOString().split("T")[0]}),[J,G]=a.useState([]),[H,Y]=a.useState(!1),[Q,X]=a.useState(null),[ee,se]=a.useState({}),[te,ae]=a.useState(null),[re,le]=a.useState(!1),[ne,ie]=a.useState(!1),[oe,de]=a.useState(!1),[ce,me]=a.useState(!1),[xe,ue]=a.useState(!1),[he,pe]=a.useState(null),ge=e=>{var s,t;if(!e)return"Unknown";if("string"==typeof e)try{const t=JSON.parse(e);if("multiple"===t.type&&(null==(s=t.details)?void 0:s.payments)){const e=t.details.payments.map(e=>(e.method||e.paymentMethod||"Unknown").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()));return[...new Set(e)].join(", ")}return t.method||t.type||"Unknown"}catch{return e}if("object"==typeof e){if("multiple"===e.type&&(null==(t=e.details)?void 0:t.payments)){const s=e.details.payments.map(e=>(e.method||e.paymentMethod||"Unknown").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()));return[...new Set(s)].join(", ")}return e.method||e.type||"Unknown"}return"Unknown"};a.useEffect(()=>{const e=e=>{e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||re||("Escape"===e.key&&l("/pos"),(e.ctrlKey||e.metaKey)&&"p"===e.key&&(e.preventDefault(),l("/pos")))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,re]);const be=a.useMemo(()=>{if(!r)return!1;const e=r.permissions||[];return e.includes("all")||e.includes("view_financial_reports")||"admin"===r.role},[r]),ye=a.useMemo(()=>{const e=(new Date).toISOString().split("T")[0],s="daily"===x&&"1d"===c?J.filter(s=>new Date(s.created_at).toISOString().split("T")[0]===e):J,t=s.reduce((e,s)=>{const t=parseFloat(s.total_amount)||0;return isNaN(t)||!isFinite(t)?e:e+t},0),a=s.length,r=new Set(s.map(e=>e.customer_id)).size,l=a>0?t/a:0;let n=0,i="0.0";return be&&(n=s.reduce((e,s)=>{var t;return e+((null==(t=s.lats_sale_items)?void 0:t.reduce((e,s)=>e+(s.total_price-(s.cost_price||0)*s.quantity),0))||0)},0),i=t>0?(n/t*100).toFixed(1):"0.0"),{totalSales:t,totalTransactions:a,totalCustomers:r,averageOrder:l,totalProfit:n,profitMargin:i}},[J,be,x,c]),fe=a.useMemo(()=>{const e=(()=>{switch(c){case"1d":return 1;case"7d":default:return 7;case"30d":return 30;case"90d":return 90}})(),s={},t=new Date;for(let o=e-1;o>=0;o--){const e=new Date(t);e.setDate(e.getDate()-o);const a=e.toISOString().split("T")[0],r=e.toLocaleDateString("en-US",{month:"short",day:"numeric"});s[a]={date:r,sales:0,count:0}}J.forEach(e=>{const t=new Date(e.created_at).toISOString().split("T")[0],a=parseFloat(e.total_amount)||0;!isNaN(a)&&isFinite(a)&&s[t]&&(s[t].sales+=a,s[t].count+=1)});const a=Object.values(s),r={};J.forEach(e=>{const s=ge(e.payment_method),t=parseFloat(e.total_amount)||0;!isNaN(t)&&isFinite(t)&&(r[s]||(r[s]={name:s,value:0,count:0}),r[s].value+=t,r[s].count+=1)});const l={};J.forEach(e=>{const s=e.customer_name||"Walk-in",t=parseFloat(e.total_amount)||0;!isNaN(t)&&isFinite(t)&&(l[s]||(l[s]={name:s,value:0,orders:0}),l[s].value+=t,l[s].orders+=1)});const n=Object.values(l).sort((e,s)=>s.value-e.value).slice(0,5),i={};for(let o=e-1;o>=0;o--){const e=new Date(t);e.setDate(e.getDate()-o);const s=e.toISOString().split("T")[0],a=e.toLocaleDateString("en-US",{month:"short",day:"numeric"});i[s]={time:a,sales:0,transactions:0}}return J.forEach(e=>{const s=parseFloat(e.total_amount)||0;if(!isNaN(s)&&isFinite(s)){const t=new Date(e.created_at).toISOString().split("T")[0];i[t]&&(i[t].sales+=s,i[t].transactions+=1)}}),{daily:a,payments:Object.values(r),topCustomers:n,trend:Object.values(i)}},[J,c]),je=a.useMemo(()=>!!r&&C.canUser(r,"reports","daily-close"),[r]),ve=a.useMemo(()=>{if(!r)return!1;const e=r.permissions||[];return e.includes("all")||e.includes("view_reports")||C.hasPermission(r.role,"reports","confirm-transactions")||"admin"===r.role},[r]),Ne=async s=>{if(0===s.length)return{};try{const{data:t,error:a}=await e.from("users").select("id, full_name, email").in("id",s);if(a)return{};const r={};return null==t||t.forEach(e=>{r[e.id]=e.full_name||e.email||"Unknown User"}),r}catch(t){return{}}},we=async()=>{var s,t;try{Y(!0),X(null);const t="undefined"!=typeof localStorage?localStorage.getItem("current_branch_id"):null,a=new Date,r=new Date;if("custom"===c)r.setTime(new Date(K.start).getTime()),a.setTime(new Date(K.end).getTime()),a.setHours(23,59,59,999);else switch(c){case"1d":r.setDate(a.getDate()-1);break;case"7d":default:r.setDate(a.getDate()-7);break;case"30d":r.setDate(a.getDate()-30);break;case"90d":r.setDate(a.getDate()-90)}const l=e.from("lats_sales").select("*").order("created_at",{ascending:!1}).limit(200);let n;if(n=t?await W(()=>l.eq("branch_id",t),()=>V(e,200)):await W(()=>l,()=>V(e,200)),n.data&&n.data.length>0){const s=await Promise.all(n.data.map(async s=>{const{data:t,error:a}=await e.from("lats_sale_items").select("id, quantity, total_price, cost_price").eq("sale_id",s.id);return{...s,lats_sale_items:t||[]}}));n.data=s}if(n.error){const e=(null==(s=n.error)?void 0:s.message)||JSON.stringify(n.error);return void X(`Failed to load sales data: ${e}`)}const i=n.data;i&&i.length;const o=(i||[]).filter(e=>{const s=new Date(e.created_at);return s>=r&&s<=a});G(o);const d=[...new Set(o.map(e=>e.user_id).filter(Boolean))].filter(e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e));if(d.length>0){const e=await Ne(d);se(e)}}catch(a){const e=(null==a?void 0:a.message)||(null==(t=null==a?void 0:a.error)?void 0:t.message)||("string"==typeof a?a:"Unknown error occurred");X(`Failed to load sales data: ${e}`)}finally{Y(!1)}};a.useEffect(()=>{(async function(){try{const e=!0;return{connected:e,message:e?"Database URL present":"VITE_DATABASE_URL missing"}}catch(e){return{connected:!1,message:(null==e?void 0:e.message)||"Unknown error"}}})().then(e=>{}),we(),_e()},[c,K]);const _e=async()=>{try{const s=(new Date).toISOString().split("T")[0],{data:t,error:a}=await e.from("daily_sales_closures").select("id, date, closed_at, closed_by").eq("date",s).limit(1).maybeSingle();if(a)return void ie(!1);t?(ie(!0),pe(t.closed_at)):ie(!1)}catch(s){ie(!1)}},Se=()=>{const e=(new Date).toISOString().split("T")[0],s=[["Daily Sales Report",e],["Generated At",(new Date).toLocaleString()],["Total Sales",ye.totalSales],["Total Transactions",ye.totalTransactions],["Total Customers",ye.totalCustomers],["Average Order",ye.averageOrder],...be?[["Profit Margin",ye.profitMargin+"%"],["Total Profit",ye.totalProfit]]:[],[""],["Transaction Details"],["Sale Number","Customer","Amount","Payment Method","Time","Status"],...J.map(e=>[e.sale_number,e.customer_name||"Walk-in",e.total_amount,ge(e.payment_method),Ce(e.created_at),e.status])].map(e=>e.join(",")).join("\n"),t=new Blob([s],{type:"text/csv"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`daily-sales-report-${e}.csv`,r.click(),window.URL.revokeObjectURL(a),g.success("Daily report exported successfully! ðŸ“Š")},ke=e=>{const s=parseFloat(String(e))||0;return isNaN(s)||!isFinite(s)?"TSh 0":new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)},Ce=e=>new Date(e).toLocaleDateString("en-TZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),De=(e,t,a,r="blue")=>{const l=Math.max(...e.map(e=>e[a]));return s.jsx("div",{className:"space-y-2",children:e.map((e,n)=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-24 text-sm text-gray-600 truncate",children:e[t]}),s.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-3",children:s.jsx("div",{className:`bg-${r}-500 h-3 rounded-full transition-all duration-300`,style:{width:e[a]/l*100+"%"}})}),s.jsx("div",{className:"w-20 text-sm font-medium text-gray-900 text-right",children:ke(e[a])})]},n))})};return s.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"transparent"},children:[s.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-40",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Sales Reports"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor and manage daily sales performance"})]}),s.jsxs("button",{onClick:()=>l("/pos"),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-sm hover:shadow-md group",title:"Go back to POS (Press ESC or Ctrl+P)",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),s.jsx("span",{className:"font-medium",children:"Back to POS"}),s.jsx("div",{className:"ml-1 px-2 py-0.5 bg-white/20 rounded text-xs font-mono",children:"ESC"})]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx("div",{className:"px-4 py-2 rounded-full text-sm font-medium "+(ne?"bg-green-100 text-green-800 border border-green-200":"bg-orange-100 text-orange-800 border border-orange-200"),children:ne?"ðŸ”’ Day Closed":"ðŸ• Day Open"})})]})})}),s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm mb-8",children:[s.jsx("div",{className:"p-6 border-b border-gray-200/50",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:s.jsx(b,{className:"w-6 h-6 text-indigo-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Report Controls"}),s.jsx("p",{className:"text-gray-600",children:"Configure your sales report parameters"})]})]})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-end gap-4",children:[s.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),s.jsxs("select",{value:x,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 bg-white/80 backdrop-blur-sm transition-all duration-200 text-sm",children:[s.jsx("option",{value:"daily",children:"ðŸ“Š Daily Sales"}),s.jsx("option",{value:"products",children:"ðŸ“¦ Product Performance"}),s.jsx("option",{value:"customers",children:"ðŸ‘¥ Customer Analysis"}),s.jsx("option",{value:"payments",children:"ðŸ’³ Payment Methods"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Period"}),s.jsxs("select",{value:c,onChange:e=>{m(e.target.value),"custom"!==e.target.value&&setTimeout(()=>we(),100)},className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 bg-white/80 backdrop-blur-sm transition-all duration-200 text-sm",children:[s.jsx("option",{value:"1d",children:"ðŸ“… Today"}),s.jsx("option",{value:"7d",children:"ðŸ“… Last 7 Days"}),s.jsx("option",{value:"30d",children:"ðŸ“… Last 30 Days"}),s.jsx("option",{value:"90d",children:"ðŸ“… Last 90 Days"}),s.jsx("option",{value:"custom",children:"ðŸ—“ï¸ Custom Range"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transactions"}),s.jsx("div",{className:"px-3 py-2 border border-gray-200 rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50",children:s.jsx("div",{className:"text-base font-bold text-gray-900",children:J.length})})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:we,disabled:H,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 disabled:opacity-50 flex items-center gap-1.5 shadow-sm hover:shadow text-sm",title:"Refresh Data",children:[s.jsx(y,{className:"w-4 h-4 "+(H?"animate-spin":"")}),s.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),s.jsxs("button",{onClick:()=>{const e=(new Date).toISOString().split("T")[0],s=window.open("","_blank");if(!s)return void g.error("Please allow popups to print reports");const t=`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Daily Sales Report - ${e}</title>\n          <style>\n            body {\n              font-family: Arial, sans-serif;\n              margin: 20px;\n              padding: 0;\n            }\n            .header {\n              text-align: center;\n              margin-bottom: 30px;\n              border-bottom: 2px solid #333;\n              padding-bottom: 20px;\n            }\n            .logo {\n              height: 60px;\n              width: auto;\n              margin: 0 auto 10px;\n              display: block;\n            }\n            .business-name {\n              font-size: 24px;\n              font-weight: bold;\n              margin: 10px 0;\n            }\n            .business-details {\n              font-size: 12px;\n              color: #666;\n            }\n            .report-title {\n              font-size: 20px;\n              font-weight: bold;\n              margin: 20px 0;\n            }\n            .summary {\n              display: grid;\n              grid-template-columns: repeat(3, 1fr);\n              gap: 20px;\n              margin: 30px 0;\n            }\n            .summary-card {\n              border: 1px solid #ddd;\n              padding: 15px;\n              border-radius: 5px;\n              background: #f9f9f9;\n            }\n            .summary-card h3 {\n              margin: 0 0 10px 0;\n              font-size: 14px;\n              color: #666;\n            }\n            .summary-card .value {\n              font-size: 24px;\n              font-weight: bold;\n              color: #333;\n            }\n            table {\n              width: 100%;\n              border-collapse: collapse;\n              margin-top: 20px;\n            }\n            th, td {\n              border: 1px solid #ddd;\n              padding: 10px;\n              text-align: left;\n            }\n            th {\n              background-color: #f2f2f2;\n              font-weight: bold;\n            }\n            .footer {\n              margin-top: 40px;\n              text-align: center;\n              font-size: 12px;\n              color: #666;\n              border-top: 1px solid #ddd;\n              padding-top: 20px;\n            }\n            @media print {\n              body { margin: 0; }\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            ${i.logo?`<img src="${i.logo}" alt="${i.name}" class="logo" />`:""}\n            <div class="business-name">${i.name}</div>\n            <div class="business-details">\n              ${i.address?`${i.address}<br>`:""}\n              ${i.phone?`Tel: ${i.phone}<br>`:""}\n              ${i.email?`Email: ${i.email}`:""}\n            </div>\n          </div>\n\n          <div class="report-title">Daily Sales Report</div>\n          <div style="font-size: 14px; color: #666; margin-bottom: 20px;">\n            Date: ${e} | Generated: ${(new Date).toLocaleString()}\n          </div>\n\n          <div class="summary">\n            <div class="summary-card">\n              <h3>Total Sales</h3>\n              <div class="value">${ke(ye.totalSales)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Transactions</h3>\n              <div class="value">${ye.totalTransactions}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Average Order</h3>\n              <div class="value">${ke(ye.averageOrder)}</div>\n            </div>\n            ${be?`\n            <div class="summary-card">\n              <h3>Total Profit</h3>\n              <div class="value">${ke(ye.totalProfit)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>Profit Margin</h3>\n              <div class="value">${ye.profitMargin}%</div>\n            </div>\n            `:""}\n            <div class="summary-card">\n              <h3>Total Customers</h3>\n              <div class="value">${ye.totalCustomers}</div>\n            </div>\n          </div>\n\n          <h3>Transaction Details</h3>\n          <table>\n            <thead>\n              <tr>\n                <th>Sale Number</th>\n                <th>Customer</th>\n                <th>Amount</th>\n                <th>Payment Method</th>\n                <th>Time</th>\n                <th>Status</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${J.map(e=>`\n                <tr>\n                  <td>${e.sale_number}</td>\n                  <td>${e.customer_name||"Walk-in"}</td>\n                  <td>${ke(e.total_amount)}</td>\n                  <td>${ge(e.payment_method)}</td>\n                  <td>${Ce(e.created_at)}</td>\n                  <td>${e.status}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n\n          <div class="footer">\n            <p>This report was generated by ${i.name}</p>\n            <p>${i.website?`Visit us at: ${i.website}`:""}</p>\n          </div>\n\n          <script>\n            window.onload = function() {\n              window.print();\n            };\n          <\/script>\n        </body>\n      </html>\n    `;s.document.write(t),s.document.close()},className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-1.5 shadow-sm hover:shadow text-sm",title:"Print Report",children:[s.jsx(o,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Print"})]}),s.jsxs("button",{onClick:Se,className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-200 flex items-center gap-1.5 shadow-sm hover:shadow text-sm",title:"Export to CSV",children:[s.jsx(n,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Export CSV"})]}),"daily"===x&&!ne&&je&&"1d"===c&&s.jsxs("button",{onClick:()=>ue(!0),disabled:oe,className:"px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-all duration-200 disabled:opacity-50 flex items-center gap-1.5 shadow-sm hover:shadow text-sm",title:"Close Day",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:oe?"Closing...":"Close"})]})]})]}),"custom"===c&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-200",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),s.jsx("input",{type:"date",value:K.start,onChange:e=>Z(s=>({...s,start:e.target.value})),onBlur:()=>we(),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 bg-white/80 backdrop-blur-sm transition-all duration-200 text-sm"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),s.jsx("input",{type:"date",value:K.end,onChange:e=>Z(s=>({...s,end:e.target.value})),onBlur:()=>we(),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 bg-white/80 backdrop-blur-sm transition-all duration-200 text-sm"})]})]})]})]}),"daily"===x&&s.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 ${be?"lg:grid-cols-4":"lg:grid-cols-3"} gap-6 mb-8`,children:[s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sales"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ke(ye.totalSales)})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(h,{className:"w-6 h-6 text-blue-600"})})]}),s.jsxs("div",{className:"mt-4 flex items-center text-sm",children:[s.jsx(j,{className:"w-4 h-4 text-green-500 mr-1"}),s.jsx("span",{className:"text-green-600 font-medium",children:"Today's Performance"})]})]}),s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Transactions"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ye.totalTransactions})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:s.jsx(u,{className:"w-6 h-6 text-green-600"})})]}),s.jsx("div",{className:"mt-4 flex items-center text-sm",children:s.jsxs("span",{className:"text-gray-500",children:["Avg: ",ke(ye.averageOrder)]})})]}),s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Customers"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ye.totalCustomers})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:s.jsx(d,{className:"w-6 h-6 text-purple-600"})})]}),s.jsx("div",{className:"mt-4 flex items-center text-sm",children:s.jsx("span",{className:"text-gray-500",children:"Unique customers"})})]}),be&&s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Profit Margin"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[ye.profitMargin,"%"]})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:s.jsx(b,{className:"w-6 h-6 text-orange-600"})})]}),s.jsx("div",{className:"mt-4 flex items-center text-sm",children:s.jsxs("span",{className:"text-gray-500",children:["Total: ",ke(ye.totalProfit)]})})]})]}),"daily"===x&&J.length>0&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sales Trend"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Revenue over time"})]}),s.jsx(v,{className:"w-5 h-5 text-blue-600"})]}),s.jsx(P,{width:"100%",height:250,children:s.jsxs(U,{data:fe.trend,children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),s.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),s.jsx(O,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),s.jsx(F,{dataKey:"time",stroke:"#6b7280",style:{fontSize:"12px"}}),s.jsx(M,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:e=>`${(e/1e3).toFixed(0)}k`}),s.jsx(A,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},formatter:e=>[ke(e),"Sales"]}),s.jsx(I,{type:"monotone",dataKey:"sales",stroke:"#3b82f6",fillOpacity:1,fill:"url(#colorSales)",strokeWidth:2})]})})]}),s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Methods"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Distribution by method"})]}),s.jsx(N,{className:"w-5 h-5 text-green-600"})]}),s.jsx(P,{width:"100%",height:250,children:s.jsxs(L,{children:[s.jsx(E,{data:fe.payments,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e} ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:fe.payments.map((e,t)=>s.jsx(R,{fill:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"][t%5]},`cell-${t}`))}),s.jsx(A,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"},formatter:e=>[ke(e),"Total"]})]})})]}),s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Daily Activity"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Sales by day"})]}),s.jsx(b,{className:"w-5 h-5 text-purple-600"})]}),s.jsx(P,{width:"100%",height:250,children:s.jsxs(q,{data:fe.daily,children:[s.jsx(O,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),s.jsx(F,{dataKey:"date",stroke:"#6b7280",style:{fontSize:"12px"},angle:-45,textAnchor:"end",height:60}),s.jsx(M,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:e=>`${(e/1e3).toFixed(0)}k`}),s.jsx(A,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"},formatter:e=>[ke(e),"Sales"]}),s.jsx(z,{dataKey:"sales",fill:"#8b5cf6",radius:[8,8,0,0]})]})})]}),s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Customers"}),s.jsx("p",{className:"text-sm text-gray-600",children:"By total sales"})]}),s.jsx(d,{className:"w-5 h-5 text-orange-600"})]}),s.jsx(P,{width:"100%",height:250,children:s.jsxs(q,{data:fe.topCustomers,layout:"vertical",children:[s.jsx(O,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),s.jsx(F,{type:"number",stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:e=>`${(e/1e3).toFixed(0)}k`}),s.jsx(M,{dataKey:"name",type:"category",stroke:"#6b7280",style:{fontSize:"12px"},width:100}),s.jsx(A,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"},formatter:e=>[ke(e),"Total"]}),s.jsx(z,{dataKey:"value",fill:"#f59e0b",radius:[0,8,8,0]})]})})]})]}),"daily"!==x&&s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm mb-8",children:[s.jsx("div",{className:"p-6 border-b border-gray-200/50",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:s.jsx(j,{className:"w-6 h-6 text-indigo-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"products"===x?"Product Performance":"customers"===x?"Customer Analysis":"payments"===x?"Payment Methods":"Report"}),s.jsx("p",{className:"text-gray-600",children:"products"===x?"Top performing products by sales":"customers"===x?"Customer spending analysis":"payments"===x?"Payment method breakdown":"Report data"})]})]})}),s.jsx("div",{className:"p-6",children:(()=>{const e=(()=>{switch(x){case"products":const e={};return J.forEach(s=>{var t;null==(t=s.lats_sale_items)||t.forEach(s=>{const t=s.product_id;t&&(e[t]||(e[t]={name:`Product ${t.slice(0,8)}...`,total:0,quantity:0}),e[t].total+=s.total_price||0,e[t].quantity+=s.quantity||0)})}),Object.values(e).sort((e,s)=>s.total-e.total);case"customers":const s={};return J.forEach(e=>{const t=e.customer_id||"walk-in";s[t]||(s[t]={name:"walk-in"===t?"Walk-in Customers":e.customer_name||`Customer ${t.slice(0,8)}...`,total:0,orders:0});const a=parseFloat(String(e.total_amount))||0;s[t].total+=a,s[t].orders+=1}),Object.values(s).sort((e,s)=>s.total-e.total);case"payments":const t={};return J.forEach(e=>{const s=ge(e.payment_method);t[s]||(t[s]={name:s,total:0,count:0});const a=parseFloat(String(e.total_amount))||0;t[s].total+=a,t[s].count+=1}),Object.values(t).sort((e,s)=>s.total-e.total);default:return[]}})();return 0===e.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“Š"}),s.jsxs("p",{children:["No data available for ",x," report"]})]}):s.jsxs("div",{className:"space-y-4",children:["products"===x&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:"Product Sales"}),De(e,"name","total","blue")]}),"customers"===x&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:"Customer Spending"}),De(e,"name","total","green")]}),"payments"===x&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:"Payment Methods"}),De(e,"name","total","purple")]})]})})()})]}),s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm",children:[s.jsx("div",{className:"p-6 border-b border-gray-200/50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center shadow-lg",children:s.jsx(u,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"daily"===x?"Sales Transactions":"Detailed Sales List"}),s.jsxs("p",{className:"text-gray-600",children:[J.length," transactions â€¢ ","1d"===c?"today":"7d"===c?"last 7 days":"30d"===c?"last 30 days":"90d"===c?"last 90 days":"custom"===c?"custom range":"selected period"]})]})]}),H&&s.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-blue-50 rounded-lg",children:[s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-blue-200 border-t-blue-600"}),s.jsx("span",{className:"text-blue-600 font-medium",children:"Loading..."})]})]})}),Q?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"text-red-500 text-lg mb-2",children:"âš ï¸"}),s.jsx("p",{className:"text-gray-600",children:Q}),s.jsx("button",{onClick:we,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Retry"})]}):0===J.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“Š"}),s.jsxs("p",{children:["No sales found for ","1d"===c?"today":"7d"===c?"the last 7 days":"30d"===c?"the last 30 days":"90d"===c?"the last 90 days":"the selected period"]}),s.jsx("p",{className:"text-sm mt-2",children:"Try selecting a different time period or view all sales"}),s.jsxs("div",{className:"flex gap-3 justify-center mt-4",children:[s.jsx("button",{onClick:()=>{(async()=>{try{Y(!0),X(null);const s="undefined"!=typeof localStorage?localStorage.getItem("current_branch_id"):null;let t=e.from("lats_sales").select("\n          id,\n          sale_number,\n          customer_id,\n          customer_name,\n          total_amount,\n          payment_method,\n          status,\n          user_id,\n          sold_by,\n          created_at,\n          branch_id\n        ").order("created_at",{ascending:!1}).limit(100);s&&(t=t.eq("branch_id",s));const{data:a,error:r}=await t;if(!r&&a&&a.length>0){const s=await Promise.all(a.map(async s=>{const{data:t}=await e.from("lats_sale_items").select("id, quantity, total_price, cost_price").eq("sale_id",s.id);return{...s,lats_sale_items:t||[]}}));return G(s),void Y(!1)}if(r)return void X(`Failed to load sales data: ${r.message}`);G(a||[]);const l=[...new Set((a||[]).map(e=>e.user_id).filter(Boolean))].filter(e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e));if(l.length>0){const e=await Ne(l);se(e)}}catch(s){X(`Unexpected error: ${s instanceof Error?s.message:"Unknown error"}`)}finally{Y(!1)}})()},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Show All Sales"}),s.jsx("button",{onClick:()=>m("90d"),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Try 90 Days"})]})]}):s.jsx("div",{className:"p-6",children:s.jsx("div",{className:"space-y-4",children:J.map(t=>{var a;return s.jsx("div",{onClick:()=>(e=>{ae(e),le(!0)})(t),className:"group bg-white/80 backdrop-blur-sm border border-gray-200/50 rounded-xl p-6 hover:bg-gradient-to-r hover:from-blue-50/80 hover:to-indigo-50/80 transition-all duration-200 cursor-pointer hover:shadow-md hover:border-blue-200/50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center shadow-sm "+("confirmed"===t.status?"bg-blue-100":"completed"===t.status?"bg-green-100":"pending"===t.status?"bg-yellow-100":"bg-gray-100"),children:"confirmed"===t.status?s.jsx(w,{className:"w-6 h-6 text-blue-600"}):"completed"===t.status?s.jsx(w,{className:"w-6 h-6 text-green-600"}):"pending"===t.status?s.jsx(_,{className:"w-6 h-6 text-yellow-600"}):s.jsx(S,{className:"w-6 h-6 text-gray-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsxs("h4",{className:"font-semibold text-gray-900",children:["#",t.sale_number]}),s.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("confirmed"===t.status?"bg-blue-100 text-blue-700":"completed"===t.status?"bg-green-100 text-green-700":"pending"===t.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:t.status})]}),s.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(k,{className:"w-4 h-4"}),s.jsx("span",{children:Ce(t.created_at)})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(d,{className:"w-4 h-4"}),s.jsx("span",{children:t.customer_name||"Walk-in"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(u,{className:"w-4 h-4"}),s.jsx("span",{children:ge(t.payment_method)})]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold text-gray-900",children:(null==(a=t.lats_sale_items)?void 0:a.length)||0}),s.jsx("div",{className:"text-xs text-gray-500",children:"items"})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-xl font-bold text-green-600",children:ke(t.total_amount)}),s.jsx("div",{className:"text-xs text-gray-500",children:t.sold_by?t.sold_by.split("@")[0].replace(/[._]/g," ").charAt(0).toUpperCase()+t.sold_by.split("@")[0].replace(/[._]/g," ").slice(1):t.user_id?ee[t.user_id]||`User: ${t.user_id.slice(0,8)}...`:"System"})]}),ve&&"completed"===t.status&&s.jsxs("button",{onClick:s=>(async(s,t)=>{t.stopPropagation();try{const{error:t}=await e.from("lats_sales").update({status:"confirmed"}).eq("id",s);if(t)return void g.error("Failed to confirm transaction");g.success("Transaction confirmed successfully! âœ…"),we()}catch(a){g.error("Failed to confirm transaction")}})(t.id,s),className:"px-3 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center gap-1",children:[s.jsx(w,{className:"w-4 h-4"}),"Confirm"]}),s.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})})]})]})},t.id)})})})]})]}),te&&s.jsx(B,{isOpen:re,onClose:()=>{le(!1),ae(null)},saleId:te.id}),s.jsx(D,{isOpen:xe,onClose:()=>ue(!1),onComplete:()=>{ie(!0),pe((new Date).toISOString()),ue(!1)},currentUser:r}),ce&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-xl max-w-md w-full p-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-orange-100 mb-6",children:s.jsx(w,{className:"h-8 w-8 text-orange-600"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Close Daily Sales?"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"This will finalize today's sales and lock the data. You won't be able to make changes after closing."}),s.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-4 mb-6 text-left",children:[s.jsx("h4",{className:"font-semibold text-orange-800 mb-3",children:"Today's Summary:"}),s.jsxs("div",{className:"space-y-2 text-sm text-orange-700",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Total Sales:"}),s.jsx("span",{className:"font-semibold",children:ke(ye.totalSales)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Transactions:"}),s.jsx("span",{className:"font-semibold",children:ye.totalTransactions})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Customers:"}),s.jsx("span",{className:"font-semibold",children:ye.totalCustomers})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Average Order:"}),s.jsx("span",{className:"font-semibold",children:ke(ye.averageOrder)})]}),be&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Profit Margin:"}),s.jsxs("span",{className:"font-semibold",children:[ye.profitMargin,"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Total Profit:"}),s.jsx("span",{className:"font-semibold",children:ke(ye.totalProfit)})]})]})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>me(!1),className:"flex-1 px-4 py-3 border border-gray-200 rounded-xl text-gray-700 hover:bg-gray-50 transition-all duration-200 font-medium",disabled:oe,children:"Cancel"}),s.jsx("button",{onClick:async()=>{try{de(!0);const s={date:(new Date).toISOString().split("T")[0],total_sales:ye.totalSales,total_transactions:ye.totalTransactions,closed_at:(new Date).toISOString(),closed_by:(null==r?void 0:r.role)||"customer_care",closed_by_user_id:null==r?void 0:r.id,sales_data:J},{error:t}=await e.from("daily_sales_closures").upsert(s,{onConflict:"date",ignoreDuplicates:!1});ie(!0),pe((new Date).toISOString()),me(!1),g.success("Daily sales closed successfully! ðŸŽ‰"),Se()}catch(s){g.error("Failed to close daily sales. Please try again.")}finally{de(!1)}},disabled:oe,className:"flex-1 px-4 py-3 bg-orange-600 text-white rounded-xl hover:bg-orange-700 transition-all duration-200 disabled:opacity-50 font-medium",children:oe?"Closing...":"Close Day"})]})]})})})]})};export{Z as default};
