import{j as e}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import{X as t,T as r,D as a,ap as o,$ as n,i as l,n as d}from"./ui-551a39a6.js";import{u as i}from"./useBodyScrollLock-0216d39f.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";const m=({isOpen:m,onClose:c,onApplyDiscount:x,onClearDiscount:g,currentTotal:p,hasExistingDiscount:b=!1})=>{const[h,u]=s.useState("fixed"),[y,f]=s.useState(""),v=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),j=e=>{if(!e)return"";return e.replace(/,/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",")},w=(()=>{if(!y)return 0;const e=y.replace(/,/g,""),s=parseFloat(e);return isNaN(s)?0:"percentage"===h?p*s/100:s})(),N=p-w,k=()=>{if(!y||parseFloat(y.replace(/,/g,""))<=0)return void d.error("Please enter a valid discount value");const e=y.replace(/,/g,""),s=parseFloat(e);"percentage"===h&&s>100?d.error("Percentage discount cannot exceed 100%"):"fixed"===h&&s>p?d.error("Fixed discount cannot exceed total amount"):(x(h,e),f(""))},D=()=>{f(""),c()},C=e=>{"."===e?y.includes(".")||f(s=>s+e):f("00"===e?e=>e+"00":"000"===e?e=>e+"000":s=>s+e)},F=()=>{f(e=>e.slice(0,-1))};return s.useEffect(()=>{const e=e=>{m&&(e.key>="0"&&e.key<="9"&&(e.preventDefault(),C(e.key)),"."===e.key&&(e.preventDefault(),C(".")),"Backspace"===e.key&&(e.preventDefault(),F()),"Enter"===e.key&&(e.preventDefault(),k()),"Escape"===e.key&&(e.preventDefault(),D()))};if(m)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[m,y,h]),i(m),m?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-[95vw] sm:max-w-md shadow-2xl overflow-hidden relative max-h-[95vh] flex flex-col",children:[e.jsx("button",{onClick:D,className:"absolute top-3 right-3 sm:top-4 sm:right-4 w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-10",children:e.jsx(t,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-6 sm:p-8 text-center transition-all duration-500 bg-gradient-to-br from-orange-50 to-amber-50",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-lg transition-all duration-500 bg-orange-600",children:e.jsx(r,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Apply Discount"})]}),e.jsx("div",{className:"px-4 sm:px-6 pt-4 sm:pt-6",children:e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-3 sm:p-5",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600",children:"Current Total"}),e.jsx("span",{className:"text-base sm:text-lg font-bold text-gray-900",children:v(p)})]}),y&&parseFloat(y.replace(/,/g,""))>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center py-2 px-2 sm:px-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-orange-600 flex items-center gap-1 sm:gap-2",children:[e.jsx(r,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsxs("span",{className:"truncate",children:["Discount ","percentage"===h?`(${j(y)}%)`:""]})]}),e.jsxs("span",{className:"text-base sm:text-lg font-bold text-orange-600 whitespace-nowrap ml-2",children:["-",v(w)]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-2 sm:pt-3 mt-2",children:e.jsxs("div",{className:"flex justify-between items-center bg-green-50 py-2 sm:py-3 px-3 sm:px-4 rounded-lg border border-green-300",children:[e.jsx("span",{className:"text-sm sm:text-base font-bold text-gray-900",children:"New Total"}),e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-green-700",children:v(N)})]})})]})]})})}),e.jsx("div",{className:"px-4 sm:px-6 pt-4 sm:pt-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 mb-3 sm:mb-4",children:[e.jsxs("button",{onClick:()=>{u("fixed"),f("")},className:"p-3 sm:p-4 rounded-xl border-2 transition-all duration-200 "+("fixed"===h?"border-orange-500 bg-orange-50 text-orange-700 shadow-md":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),children:[e.jsx(a,{className:"w-5 h-5 sm:w-6 sm:h-6 mx-auto mb-1 sm:mb-2"}),e.jsx("div",{className:"text-xs sm:text-sm font-semibold",children:"Fixed"}),e.jsx("div",{className:"text-[10px] sm:text-xs text-gray-500 mt-0.5 sm:mt-1",children:"TZS Amount"})]}),e.jsxs("button",{onClick:()=>{u("percentage"),f("")},className:"p-3 sm:p-4 rounded-xl border-2 transition-all duration-200 "+("percentage"===h?"border-orange-500 bg-orange-50 text-orange-700 shadow-md":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),children:[e.jsx(o,{className:"w-5 h-5 sm:w-6 sm:h-6 mx-auto mb-1 sm:mb-2"}),e.jsx("div",{className:"text-xs sm:text-sm font-semibold",children:"Percentage"}),e.jsx("div",{className:"text-[10px] sm:text-xs text-gray-500 mt-0.5 sm:mt-1",children:"% Off"})]})]})}),e.jsx("div",{className:"px-4 sm:px-6 pb-3 sm:pb-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 sm:p-6 border-2 border-gray-200 text-center",children:[e.jsx("div",{className:"text-[10px] sm:text-xs font-medium text-gray-500 mb-1 sm:mb-2 uppercase tracking-wide",children:"percentage"===h?"Discount Percentage":"Discount Amount"}),e.jsxs("div",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-1 min-h-[36px] sm:min-h-[48px] flex items-center justify-center",children:[j(y)||"0",e.jsx("span",{className:"text-lg sm:text-xl md:text-2xl text-gray-500 ml-2",children:"percentage"===h?"%":"TZS"})]})]})}),"percentage"===h&&e.jsx("div",{className:"px-4 sm:px-6 pb-3 sm:pb-4",children:e.jsx("div",{className:"grid grid-cols-4 gap-1.5 sm:gap-2",children:[5,10,15,20].map(s=>e.jsxs("button",{onClick:()=>f(s.toString()),className:"py-1.5 sm:py-2 px-2 sm:px-3 text-xs sm:text-sm font-semibold bg-white hover:bg-orange-50 text-gray-700 hover:text-orange-700 rounded-lg border border-gray-200 hover:border-orange-300 transition-all duration-200 shadow-sm hover:shadow-md",children:[s,"%"]},s))})}),e.jsx("div",{className:"px-4 sm:px-6 pb-3 sm:pb-4",children:e.jsx("div",{className:"bg-white rounded-xl p-2 sm:p-3 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[[1,2,3,4,5,6,7,8,9].map(s=>e.jsx("button",{onClick:()=>C(s.toString()),className:"aspect-square flex items-center justify-center rounded-lg font-semibold text-lg sm:text-xl transition-all duration-200 bg-gray-50 text-gray-900 hover:bg-orange-100 hover:text-orange-700 active:bg-orange-200 border border-gray-200 hover:border-orange-300 cursor-pointer shadow-sm hover:shadow-md active:scale-95",children:s},s)),e.jsx("button",{onClick:()=>{f("")},className:"aspect-square flex items-center justify-center rounded-lg font-semibold text-lg sm:text-xl transition-all duration-200 bg-red-50 text-red-700 hover:bg-red-100 active:bg-red-200 border border-red-200 cursor-pointer shadow-sm hover:shadow-md active:scale-95",children:e.jsx(n,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>C("0"),className:"aspect-square flex items-center justify-center rounded-lg font-semibold text-lg sm:text-xl transition-all duration-200 bg-gray-50 text-gray-900 hover:bg-orange-100 hover:text-orange-700 active:bg-orange-200 border border-gray-200 hover:border-orange-300 cursor-pointer shadow-sm hover:shadow-md active:scale-95",children:"0"}),e.jsx("button",{onClick:F,className:"aspect-square flex items-center justify-center rounded-lg font-semibold text-lg sm:text-xl transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-gray-200 active:bg-gray-300 border border-gray-200 cursor-pointer shadow-sm hover:shadow-md active:scale-95",children:e.jsx(l,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})})}),e.jsx("div",{className:"h-4"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 px-4 sm:px-6 py-3 sm:py-4 rounded-b-2xl shadow-lg",children:[e.jsx("button",{onClick:k,disabled:!y||parseFloat(y.replace(/,/g,""))<=0,className:"w-full px-4 sm:px-6 py-2.5 sm:py-3.5 bg-orange-600 hover:bg-orange-700 text-white rounded-xl transition-all font-semibold shadow-lg hover:shadow-xl text-base sm:text-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-lg",children:b?"Update Discount":"Confirm & Apply"}),b&&e.jsx("button",{onClick:()=>{g(),D()},className:"w-full mt-2 sm:mt-3 px-4 sm:px-6 py-2 sm:py-2.5 bg-red-50 hover:bg-red-100 text-red-700 rounded-xl transition-all font-medium border border-red-200 text-sm sm:text-base",children:"Clear Discount"})]})]})}):null};export{m as default};
