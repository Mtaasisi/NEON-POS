import{s as e,j as t,d as s,G as a,p as r}from"./index-222cfb29.js";import{r as l}from"./vendor-a2ff445a.js";import{P as n}from"./PriceInput-e1556d5b.js";import{P as i}from"./PageHeader-9450e930.js";import{_ as o}from"./supabase-7e851d02.js";import{ak as c,ab as d,Z as m,cy as u,aj as x,a6 as g,s as p,P as h,j as y,ax as v,ag as j,D as b,bK as f,ah as N,f as w,ar as _,d as S,a7 as C,n as P}from"./ui-551a39a6.js";import"./routing-a2f0f6d2.js";const k=new class{async fetchLoyaltyCustomersPaginated(t=1,s=50,a,r,l){try{const{getCurrentBranchId:n,isDataShared:i}=await o(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]);let c=e.from("customers").select("id",{count:"exact",head:!0});const d=n(),m=await i("customers");d&&!m&&(c=c.or(`branch_id.eq.${d},is_shared.eq.true`)),r&&"all"!==r&&(c=c.eq("loyalty_level",r)),l&&"all"!==l&&(c=c.eq("is_active","active"===l));const{count:u,error:x}=await c;if(x)return{customers:[],totalCount:0,currentPage:t,totalPages:0,hasNextPage:!1,hasPreviousPage:!1};const g=(t-1)*s,p=Math.ceil((u||0)/s);let h=e.from("customers").select("*").order("created_at",{ascending:!1}).range(g,g+s-1);d&&!m&&(h=h.or(`branch_id.eq.${d},is_shared.eq.true`)),r&&"all"!==r&&(h=h.eq("loyalty_level",r)),l&&"all"!==l&&(h=h.eq("is_active","active"===l));const{data:y,error:v}=await h;if(v)return{customers:[],totalCount:u||0,currentPage:t,totalPages:p,hasNextPage:!1,hasPreviousPage:t>1};if(!y||0===y.length)return{customers:[],totalCount:u||0,currentPage:t,totalPages:p,hasNextPage:!1,hasPreviousPage:t>1};const j=y.map(e=>({id:e.id,name:e.name||"Unknown Customer",phone:e.phone||"",email:e.email||"",points:e.points||0,tier:this.mapLoyaltyLevel(e.loyalty_level),totalSpent:e.total_spent||0,joinDate:e.joined_date||e.created_at,lastPurchase:e.last_purchase||e.last_visit||e.created_at,orders:e.total_orders||0,status:e.is_active?"active":"inactive",loyaltyLevel:e.loyalty_level||"interested",lastVisit:e.last_visit||e.created_at,isActive:e.is_active||!1,customerId:e.id}));let b=j;a&&(b=j.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())||e.phone.includes(a)||e.email.toLowerCase().includes(a.toLowerCase())));return{customers:b,totalCount:u||0,currentPage:t,totalPages:p,hasNextPage:t<p,hasPreviousPage:t>1}}catch(n){return{customers:[],totalCount:0,currentPage:t,totalPages:0,hasNextPage:!1,hasPreviousPage:!1}}}async fetchLoyaltyCustomers(t,s,a){try{const{getCurrentBranchId:r,isDataShared:l}=await o(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]);let n=e.from("customers").select("id",{count:"exact",head:!0});const i=r(),c=await l("customers");i&&!c&&(n=n.or(`branch_id.eq.${i},is_shared.eq.true`));const{count:d,error:m}=await n;if(m)return[];const u=[],x=1e3,g=Math.ceil((d||0)/x);for(let t=0;t<g;t++){const r=t*x,l=Math.min(r+x-1,(d||0)-1);let n=e.from("customers").select("\n            id, name, email, phone, gender, city, birth_month, birth_day, total_returns, profile_image, created_at, updated_at, whatsapp, notes, is_active, loyalty_level, color_tag, referred_by, total_spent, points, last_visit, created_by, referral_source, initial_notes, referrals, customer_tag\n          ").order("created_at",{ascending:!1}).range(r,l);i&&!c&&(n=n.or(`branch_id.eq.${i},is_shared.eq.true`)),s&&"all"!==s&&(n=n.eq("loyalty_level",s)),a&&"all"!==a&&(n=n.eq("is_active","active"===a));const{data:o,error:m}=await n;if(!m&&(o&&o.length>0)){const t=o.map(e=>e.id),{data:s}=await e.from("customer_payments").select("customer_id, payment_date").in("customer_id",t).order("payment_date",{ascending:!1}),{data:a}=await e.from("devices").select("customer_id, created_at").in("customer_id",t),r=new Map;null==s||s.forEach(e=>{r.has(e.customer_id)||r.set(e.customer_id,[]),r.get(e.customer_id).push(e)});const l=new Map;null==a||a.forEach(e=>{l.has(e.customer_id)||l.set(e.customer_id,[]),l.get(e.customer_id).push(e)});const n=o.map(e=>({...e,customer_payments:r.get(e.id)||[],devices:l.get(e.id)||[]}));u.push(...n)}}if(0===u.length)return[];const p=u.map(e=>{var t,s,a,r,l,n;const i=((null==(t=e.customer_payments)?void 0:t.length)||0)+((null==(s=e.devices)?void 0:s.length)||0),o=null==(r=null==(a=e.customer_payments)?void 0:a[0])?void 0:r.payment_date,c=null==(n=null==(l=e.devices)?void 0:l[0])?void 0:n.created_at,d=o&&c?new Date(o)>new Date(c)?o:c:o||c||e.last_visit;return{id:e.id,name:e.name||"Unknown Customer",phone:e.phone||"",email:e.email||"",points:e.points||0,tier:this.mapLoyaltyLevel(e.loyalty_level),totalSpent:e.total_spent||0,joinDate:e.joined_date||e.created_at,lastPurchase:d||e.last_visit||e.created_at,orders:i,status:e.is_active?"active":"inactive",loyaltyLevel:e.loyalty_level||"interested",lastVisit:e.last_visit||e.created_at,isActive:e.is_active||!1,customerId:e.id}});if(t){return p.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.phone.includes(t)||e.email.toLowerCase().includes(t.toLowerCase()))}return p}catch(r){return[]}}async calculateLoyaltyMetrics(){try{localStorage.getItem("current_branch_id");const{count:t,error:s}=await e.from("customers").select("id",{count:"exact",head:!0});if(s)return{totalCustomers:0,totalPoints:0,vipCustomers:0,activeCustomers:0,totalSpent:0,averagePoints:0};const{data:a,error:r}=await e.from("customers").select("points, loyalty_level, is_active, total_spent").limit(2e3);if(r)return{totalCustomers:t||0,totalPoints:0,vipCustomers:0,activeCustomers:0,totalSpent:0,averagePoints:0};const{data:l,error:n}=await e.from("lats_sales").select("total_amount, status").eq("status","completed"),i=t||0,o=(a||[]).reduce((e,t)=>e+(t.points||0),0),c=(a||[]).filter(e=>"vip"===e.loyalty_level).length,d=(a||[]).filter(e=>e.is_active).length;return{totalCustomers:i,totalPoints:o,vipCustomers:c,activeCustomers:d,totalSpent:(l||[]).reduce((e,t)=>e+(parseFloat(t.total_amount)||0),0),averagePoints:i>0?Math.round(o/i):0}}catch(t){return{totalCustomers:0,totalPoints:0,vipCustomers:0,activeCustomers:0,totalSpent:0,averagePoints:0}}}getLoyaltyTiers(){return[{name:"Bronze",minPoints:0,maxPoints:999,discount:0,benefits:["Basic rewards","Email updates"]},{name:"Silver",minPoints:1e3,maxPoints:1999,discount:2,benefits:["2% discount","Priority support","Free delivery on orders over 50,000 TZS"]},{name:"Gold",minPoints:2e3,maxPoints:4999,discount:3,benefits:["3% discount","Free delivery","Birthday rewards","Exclusive offers"]},{name:"Platinum",minPoints:5e3,maxPoints:999999,discount:5,benefits:["5% discount","Exclusive offers","Personal account manager","VIP events"]}]}getAvailableRewards(){return[{id:"1",name:"Free Delivery",points:500,description:"Free delivery on next order",active:!0},{id:"2",name:"10% Off Next Purchase",points:1e3,description:"10% discount on next purchase",active:!0},{id:"3",name:"Free Product",points:2e3,description:"Free product up to TZS 10,000",active:!0},{id:"4",name:"VIP Event Access",points:5e3,description:"Access to exclusive VIP events",active:!0}]}async fetchPointHistory(t){try{let s=e.from("points_transactions").select("*").order("created_at",{ascending:!1});t&&(s=s.eq("customer_id",t));const{data:a,error:r}=await s;return r?[]:a?a.map(e=>{var t;return{customerId:e.customer_id,type:e.transaction_type,points:e.points_change,reason:e.reason,date:e.created_at,orderId:null==(t=e.metadata)?void 0:t.order_id,deviceId:e.device_id,createdBy:e.created_by}}):[]}catch(s){return[]}}async updateCustomerPoints(t,s,a,r="adjusted",l){try{const{data:n,error:i}=await e.from("customers").select("points").eq("id",t).single();if(i)return!1;const o=(null==n?void 0:n.points)||0,c=Math.max(0,o+s),{error:d}=await e.from("customers").update({points:c}).eq("id",t);if(d)return!1;const{error:m}=await e.from("points_transactions").insert({customer_id:t,points_change:s,transaction_type:r,reason:a,device_id:l,created_by:"system",metadata:{order_id:null}});return!0}catch(n){return!1}}async updateCustomerTier(t){try{const{data:s,error:a}=await e.from("customers").select("points, loyalty_level").eq("id",t).single();if(a)return!1;const r=(null==s?void 0:s.points)||0,l=(null==s?void 0:s.loyalty_level)||"interested",n=this.calculateTierFromPoints(r);if(n!==l){const{error:s}=await e.from("customers").update({loyalty_level:n}).eq("id",t);if(s)return!1;await this.updateCustomerPoints(t,0,`Tier upgraded from ${l} to ${n}`,"adjusted")}return!0}catch(s){return!1}}mapLoyaltyLevel(e){switch(null==e?void 0:e.toLowerCase()){case"vip":return"vip";case"premium":return"premium";case"regular":return"regular";case"active":return"active";case"payment_customer":return"payment_customer";case"engaged":return"engaged";default:return"interested"}}calculateTierFromPoints(e){return e>=1e3?"vip":e>=700?"premium":e>=400?"regular":e>=200?"active":e>=100?"payment_customer":e>=50?"engaged":"interested"}async getCustomers(){try{const{data:t,error:s}=await e.from("customers").select("*").limit(100);return s?[]:(null==t?void 0:t.map(e=>({id:e.id,name:e.name||"Unknown",phone:e.phone||"",email:e.email||"",points:e.points||0,tier:this.mapLoyaltyLevel(e.loyalty_level),totalSpent:e.total_spent||0,joinDate:e.created_at||"",lastPurchase:e.last_purchase||"",orders:e.orders||0,status:e.is_active?"active":"inactive",loyaltyLevel:e.loyalty_level||"bronze",lastVisit:e.last_visit||"",isActive:e.is_active||!1,customerId:e.id})))||[]}catch(t){return[]}}async getMetrics(){try{const{data:t,error:s}=await e.from("customers").select("points, total_spent, is_active, loyalty_level");if(s)return{totalCustomers:0,totalPoints:0,vipCustomers:0,activeCustomers:0,totalSpent:0,averagePoints:0};const a=(null==t?void 0:t.length)||0,r=(null==t?void 0:t.reduce((e,t)=>e+(t.points||0),0))||0,l=(null==t?void 0:t.filter(e=>"vip"===e.loyalty_level||"premium"===e.loyalty_level).length)||0,n=(null==t?void 0:t.filter(e=>e.is_active).length)||0,i=(null==t?void 0:t.reduce((e,t)=>e+(t.total_spent||0),0))||0;return{totalCustomers:a,totalPoints:r,vipCustomers:l,activeCustomers:n,totalSpent:i,averagePoints:a>0?r/a:0}}catch(t){return{totalCustomers:0,totalPoints:0,vipCustomers:0,activeCustomers:0,totalSpent:0,averagePoints:0}}}async getTiers(){return[{name:"Bronze",minPoints:0,maxPoints:999,discount:5,benefits:["Basic rewards"]},{name:"Silver",minPoints:1e3,maxPoints:1999,discount:10,benefits:["Enhanced rewards","Priority support"]},{name:"Gold",minPoints:2e3,maxPoints:4999,discount:15,benefits:["Premium rewards","Exclusive offers"]},{name:"Platinum",minPoints:5e3,maxPoints:999999,discount:20,benefits:["VIP rewards","Personal concierge"]}]}async getRewards(){return[{id:"1",name:"10% Discount",pointsRequired:100,description:"Get 10% off your next purchase",active:!0,type:"discount"},{id:"2",name:"Free Shipping",pointsRequired:200,description:"Free shipping on your next order",active:!0,type:"discount"},{id:"3",name:"Free Product",pointsRequired:500,description:"Get a free product of your choice",active:!0,type:"free_item"},{id:"4",name:"VIP Treatment",pointsRequired:1e3,description:"Exclusive VIP treatment and priority service",active:!0,type:"cashback"}]}async getPointHistory(t){try{const{data:s,error:a}=await e.from("points_transactions").select("*").eq("customer_id",t).order("created_at",{ascending:!1}).limit(50);return a?[]:(null==s?void 0:s.map(e=>{var t;return{customerId:e.customer_id,type:e.transaction_type,amount:e.points_change,reason:e.reason,timestamp:new Date(e.created_at),orderId:null==(t=e.metadata)?void 0:t.order_id,deviceId:e.device_id,createdBy:e.created_by}}))||[]}catch(s){return[]}}async addPoints(e,t,s){return this.updateCustomerPoints(e,t,s,"adjusted")}async redeemReward(e,t){try{const s=(await this.getRewards()).find(e=>e.id===t);return!!s&&this.updateCustomerPoints(e,-s.pointsRequired,`Redeemed: ${s.name}`,"redeemed")}catch(s){return!1}}async getRedemptionHistory(t){try{const{data:s,error:a}=await e.from("points_transactions").select("*").eq("customer_id",t).eq("transaction_type","redeemed").order("created_at",{ascending:!1}).limit(20);return a?[]:(null==s?void 0:s.map(e=>({rewardName:e.reason,pointsUsed:Math.abs(e.points_change),redeemedAt:e.created_at})))||[]}catch(s){return[]}}},L=()=>{const[o,L]=l.useState(""),[I,D]=l.useState("all"),[R,T]=l.useState("all"),[A,F]=l.useState(!1),[q,z]=l.useState(!0),[E,M]=l.useState(!1),[V,O]=l.useState([]),[$,B]=l.useState({totalCustomers:0,totalPoints:0,vipCustomers:0,activeCustomers:0,totalSpent:0,averagePoints:0}),[U,G]=l.useState([]),[H,Z]=l.useState([]),[J,W]=l.useState([]),[Y,K]=l.useState(!1),[Q,X]=l.useState(null),[ee,te]=l.useState(""),[se,ae]=l.useState("whatsapp"),[re,le]=l.useState(!1),[ne,ie]=l.useState(!1),[oe,ce]=l.useState(null),[de,me]=l.useState(null),[ue,xe]=l.useState(!1),[ge,pe]=l.useState([]),[he,ye]=l.useState([]),[ve,je]=l.useState([]),[be,fe]=l.useState(!1),[Ne,we]=l.useState(null),[_e,Se]=l.useState(null),[Ce,Pe]=l.useState(!1),[ke,Le]=l.useState([]),[Ie,De]=l.useState(!1),[Re,Te]=l.useState([]),[Ae,Fe]=l.useState({name:"",message:"",targetTier:"all",targetStatus:"all",scheduledDate:"",type:"whatsapp"}),[qe,ze]=l.useState(!1),[Ee,Me]=l.useState(!1),[Ve,Oe]=l.useState("loyalty-overview"),[$e,Be]=l.useState("30d"),[Ue,Ge]=l.useState(!1),[He,Ze]=l.useState(!1),[Je,We]=l.useState([]),[Ye,Ke]=l.useState("all"),[Qe,Xe]=l.useState(!1),[et,tt]=l.useState([]),[st,at]=l.useState("points"),[rt,lt]=l.useState(0),[nt,it]=l.useState(""),[ot,ct]=l.useState(!1),[dt,mt]=l.useState(!1),[ut,xt]=l.useState(""),[gt,pt]=l.useState(""),[ht,yt]=l.useState(""),[vt,jt]=l.useState("");l.useState("all");const[bt,ft]=l.useState("points"),[Nt,wt]=l.useState("desc"),[_t,St]=l.useState(1),[Ct,Pt]=l.useState(0),[kt,Lt]=l.useState(!1),[It,Dt]=l.useState(!1),[Rt,Tt]=l.useState(0);l.useEffect(()=>{At()},[I,R]),l.useEffect(()=>{St(1),At()},[I,R]),l.useEffect(()=>{V.length>0&&Bt()},[V]);const At=async(e=1,t=!1)=>{1===e?z(!0):M(!0);try{const[s,a,r,l,n]=await Promise.all([k.fetchLoyaltyCustomersPaginated(e,50,o,I,R),k.calculateLoyaltyMetrics(),Promise.resolve(k.getLoyaltyTiers()),Promise.resolve(k.getAvailableRewards()),k.fetchPointHistory()]);O(t&&e>1?e=>[...e,...s.customers]:s.customers),St(s.currentPage),Pt(s.totalPages),Lt(s.hasNextPage),Dt(s.hasPreviousPage),Tt(s.totalCount),1===e&&(B(a),G(r),Z(l),W(n))}catch(s){}finally{z(!1),M(!1)}},Ft=()=>{St(1),At(1,!1)},qt=e=>{const t=e||0,s=Math.abs(t)>1e12;if(!isFinite(t))return"TZS 0 âš ï¸ INVALID";const a=new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS"}).format(t);return s?`${a} âš ï¸`:a},zt=e=>{switch(e){case"vip":return"text-purple-600 bg-purple-100";case"premium":return"text-yellow-600 bg-yellow-100";case"regular":return"text-blue-600 bg-blue-100";case"active":return"text-green-600 bg-green-100";case"payment_customer":return"text-teal-600 bg-teal-100";case"engaged":return"text-indigo-600 bg-indigo-100";default:return"text-gray-600 bg-gray-100"}},Et=(e,t)=>{X(e),ae(t),te(""),K(!0)},Mt=(e,t,s)=>{const a=t.reduce((e,t)=>e+("number"==typeof t.total_amount?t.total_amount:parseFloat(t.total_amount)||0),0),r=s.reduce((e,t)=>{var s,a;return e+("number"==typeof(null==(s=t.lats_spare_parts)?void 0:s.selling_price)?t.lats_spare_parts.selling_price:parseFloat(null==(a=t.lats_spare_parts)?void 0:a.selling_price)||0)},0),l=a+r,n=t.length,i=n>0?a/n:0;let o=0;if(t.length>0){const e=new Date(t[0].created_at);o=Math.floor((Date.now()-e.getTime())/864e5)}return{totalSpent:l,totalPosSpent:a,totalSpareSpent:r,orderCount:n,avgOrderValue:i,daysSinceLastPurchase:o,uniqueProducts:new Set(he.map(e=>{var t;return(null==(t=e.lats_products)?void 0:t.name)||"Unknown"})).size,totalItems:he.reduce((e,t)=>e+(t.quantity||1),0),purchaseFrequency:n>0?n/Math.max(o/30,1):0}},Vt=async t=>{ce(t),ie(!0),await(async t=>{xe(!0);try{const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1),{data:l,error:n}=await e.from("lats_sales").select("\n          id,\n          sale_number,\n          customer_id,\n          subtotal,\n          total_amount,\n          payment_method,\n          status,\n          created_at,\n          updated_at\n        ").eq("customer_id",t).gte("created_at",a.toISOString()).lt("created_at",r.toISOString()).order("created_at",{ascending:!1});let i=l,o=n;if(n){const{data:s,error:l}=await e.from("lats_sales").select("*").eq("customer_id",t).gte("created_at",a.toISOString()).lt("created_at",r.toISOString()).order("created_at",{ascending:!1});l?(i=[],o=null):(i=s,o=null)}const{data:c,error:d}=await e.from("lats_spare_part_usage").select("*").eq("customer_id",t).gte("used_at",a.toISOString()).lt("used_at",r.toISOString()).order("used_at",{ascending:!1});if(!d&&c&&c.length>0){const t=[...new Set(c.map(e=>e.spare_part_id).filter(Boolean))];if(t.length>0){const{data:s}=await e.from("lats_spare_parts").select("id, name, part_number, cost_price, selling_price").in("id",t),a=(s||[]).reduce((e,t)=>(e[t.id]=t,e),{});c.forEach(e=>{e.spare_part_id&&(e.lats_spare_parts=a[e.spare_part_id]||null)})}}if(!o&&i)if(pe(i),i.length>0&&i[0].lats_sale_items){const e=i.flatMap(e=>(e.lats_sale_items||[]).map(t=>({...t,saleNumber:e.sale_number,saleDate:e.created_at,paymentMethod:e.payment_method,saleStatus:e.status})));ye(e)}else ye([]);!d&&c&&je(c);const m=Mt(t,i||[],c||[]);me(m)}catch(s){P.error("Failed to load customer analytics")}finally{xe(!1)}})(t.customerId)},Ot=async t=>{try{const{data:s,error:a}=await e.from("points_transactions").select("*").eq("customer_id",t).eq("transaction_type","redeemed").order("created_at",{ascending:!1}).limit(10);!a&&s&&Le(s)}catch(s){}},$t=e=>H.filter(t=>t.active&&e>=t.points),Bt=()=>{const e=[{name:"VIP Customers",criteria:"VIP tier with high spending",count:V.filter(e=>"vip"===e.tier&&e.totalSpent>1e5).length,color:"purple"},{name:"High Value",criteria:"Premium tier or high points",count:V.filter(e=>"premium"===e.tier||e.points>500).length,color:"yellow"},{name:"Active Customers",criteria:"Recent activity within 30 days",count:V.filter(e=>{const t=new Date(e.lastVisit);return(Date.now()-t.getTime())/864e5<=30}).length,color:"green"},{name:"At Risk",criteria:"No activity for 90+ days",count:V.filter(e=>{const t=new Date(e.lastVisit);return(Date.now()-t.getTime())/864e5>90}).length,color:"red"}];We(e)},Ut=()=>{let e=[...V];return"all"!==I&&(e=e.filter(e=>e.tier===I)),"all"!==R&&(e=e.filter(e=>e.status===R)),o&&(e=e.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.phone.includes(o)||e.email&&e.email.toLowerCase().includes(o.toLowerCase()))),ut&&(e=e.filter(e=>e.points>=parseInt(ut))),gt&&(e=e.filter(e=>e.points<=parseInt(gt))),ht&&(e=e.filter(e=>e.totalSpent>=parseInt(ht))),vt&&(e=e.filter(e=>e.totalSpent<=parseInt(vt))),e.sort((e,t)=>{let s,a;switch(bt){case"points":default:s=e.points,a=t.points;break;case"spent":s=e.totalSpent,a=t.totalSpent;break;case"name":s=e.name,a=t.name;break;case"lastVisit":s=new Date(e.lastVisit).getTime(),a=new Date(t.lastVisit).getTime()}return"asc"===Nt?s>a?1:-1:s<a?1:-1}),e};return q&&1===_t?t.jsxs("div",{className:"min-h-screen p-6",style:{backgroundColor:"transparent"},children:[t.jsx(i,{title:"Customer Loyalty",subtitle:"Manage loyalty points, rewards, and customer tiers",className:"mb-6"}),t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading loyalty data..."})]})})]}):t.jsxs("div",{className:"min-h-screen p-6",style:{backgroundColor:"transparent"},children:[t.jsx(i,{title:"Customer Loyalty",subtitle:"Manage loyalty points, rewards, and customer tiers",className:"mb-6"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6",children:[t.jsxs(s,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Customers"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.totalCustomers})]}),t.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:t.jsx("span",{className:"text-blue-600 text-xl",children:"ðŸ‘¥"})})]}),t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"text-sm text-gray-600",children:"In loyalty program"})})]}),t.jsxs(s,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Points"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.totalPoints.toLocaleString()})]}),t.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:t.jsx("span",{className:"text-green-600 text-xl",children:"â­"})})]}),t.jsx("div",{className:"mt-2",children:t.jsxs("span",{className:"text-sm text-gray-600",children:["Average: ",$.averagePoints]})})]}),t.jsxs(s,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"VIP Customers"}),t.jsx("p",{className:"text-2xl font-bold text-purple-600",children:$.vipCustomers})]}),t.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:t.jsx("span",{className:"text-purple-600 text-xl",children:"ðŸ‘‘"})})]}),t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"text-sm text-gray-600",children:"Platinum tier"})})]}),t.jsxs(s,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Customers"}),t.jsx("p",{className:"text-2xl font-bold text-green-600",children:$.activeCustomers})]}),t.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:t.jsx("span",{className:"text-green-600 text-xl",children:"âœ…"})})]}),t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"text-sm text-gray-600",children:"Recently active"})})]}),t.jsxs(s,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:qt($.totalSpent)})]}),t.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:t.jsx("span",{className:"text-orange-600 text-xl",children:"ðŸ’°"})})]}),t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"text-sm text-gray-600",children:"From all customers"})})]})]}),t.jsxs(s,{className:"p-6 mb-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Customer Management"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs(a,{variant:"secondary",onClick:()=>mt(!dt),icon:dt?t.jsx(c,{size:16}):t.jsx(d,{size:16}),children:[dt?"Hide":"Advanced"," Filters"]}),t.jsx(a,{variant:"secondary",onClick:()=>Xe(!0),icon:t.jsx(m,{size:16}),children:"Bulk Operations"}),t.jsx(a,{variant:"secondary",onClick:()=>De(!0),icon:t.jsx(u,{size:16}),children:"Campaigns"}),t.jsx(a,{variant:"secondary",onClick:()=>Me(!0),icon:t.jsx(x,{size:16}),children:"Reports"}),t.jsx(a,{variant:"secondary",onClick:()=>Ze(!0),icon:t.jsx(g,{size:16}),children:"Segments"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),t.jsx("input",{type:"text",placeholder:"Search customers...",value:o,onChange:e=>L(e.target.value),onKeyPress:e=>"Enter"===e.key&&Ft(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Loyalty Tier"}),t.jsxs("select",{value:I,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"all",children:"All Tiers"}),t.jsx("option",{value:"bronze",children:"Bronze"}),t.jsx("option",{value:"silver",children:"Silver"}),t.jsx("option",{value:"gold",children:"Gold"}),t.jsx("option",{value:"platinum",children:"Platinum"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),t.jsxs("select",{value:R,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),t.jsxs("select",{value:bt,onChange:e=>ft(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"points",children:"Points"}),t.jsx("option",{value:"spent",children:"Total Spent"}),t.jsx("option",{value:"name",children:"Name"}),t.jsx("option",{value:"lastVisit",children:"Last Visit"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order"}),t.jsxs("select",{value:Nt,onChange:e=>wt(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"desc",children:"Descending"}),t.jsx("option",{value:"asc",children:"Ascending"})]})]}),t.jsxs("div",{className:"flex items-end space-x-2",children:[t.jsx(a,{variant:"secondary",onClick:Ft,className:"flex-1",children:"Search"}),t.jsx(a,{variant:"primary",onClick:()=>alert("Add new customer to loyalty program"),className:"flex-1",children:"Add Customer"})]})]}),dt&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-4 border-t border-gray-200",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Points"}),t.jsx("input",{type:"number",placeholder:"0",value:ut,onChange:e=>xt(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Points"}),t.jsx("input",{type:"number",placeholder:"âˆž",value:gt,onChange:e=>pt(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Spent"}),t.jsx(n,{value:parseFloat(ht)||0,onChange:e=>yt(e.toString()),placeholder:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Spent"}),t.jsx(n,{value:parseFloat(vt)||0,onChange:e=>jt(e.toString()),placeholder:"âˆž",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs(s,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Loyalty Customers (",Ut().length," of ",Rt,")"]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs(a,{variant:"secondary",onClick:()=>F(!A),children:[A?"Hide":"Show"," History"]}),t.jsx(a,{variant:"secondary",onClick:()=>alert("Export loyalty data"),children:"Export"})]})]}),t.jsxs("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:et.length===Ut().length&&Ut().length>0,onChange:()=>{tt(V.map(e=>e.customerId))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Select All"})]}),t.jsx("button",{onClick:()=>{tt([])},className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear Selection"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[et.length," selected"]})]}),et.length>0&&t.jsx("div",{className:"flex space-x-2",children:t.jsxs(a,{variant:"secondary",size:"sm",onClick:()=>Xe(!0),children:["Bulk Actions (",et.length,")"]})})]}),t.jsx("div",{className:"space-y-4",children:Ut().map(e=>t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("input",{type:"checkbox",checked:et.includes(e.customerId),onChange:()=>{return t=e.customerId,void tt(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.name}),t.jsx("div",{className:"text-sm text-gray-600",children:e.phone}),e.email&&t.jsx("div",{className:"text-sm text-gray-600",children:e.email})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-semibold text-gray-900",children:[e.points," points"]}),t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${zt(e.tier)}`,children:e.tier})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Total Spent"}),t.jsx("div",{className:"font-medium text-gray-900",children:qt(e.totalSpent)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Orders"}),t.jsx("div",{className:"font-medium text-gray-900",children:e.orders})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Join Date"}),t.jsx("div",{className:"font-medium text-gray-900",children:new Date(e.joinDate).toLocaleDateString()})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Last Purchase"}),t.jsx("div",{className:"font-medium text-gray-900",children:new Date(e.lastPurchase).toLocaleDateString()})]})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-3",children:[t.jsxs("div",{children:["Status: ",e.status]}),t.jsxs("div",{children:["Last Visit: ",new Date(e.lastVisit).toLocaleDateString()]})]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>{const t=prompt("Enter points to add (positive) or subtract (negative):");if(null!==t){const s=parseInt(t);if(!isNaN(s)){const t=prompt("Enter reason for points adjustment:")||"Manual adjustment";(async(e,t,s)=>{try{await k.updateCustomerPoints(e,t,s,t>0?"earned":"adjusted")?(await At(1,!1),alert(`Points adjustment successful: ${t>0?"+":""}${t} points - ${s}`)):alert("Failed to adjust points")}catch(a){alert(`Error adjusting points: ${a}`)}})(e.customerId,s,t)}}},className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Adjust Points"}),t.jsx("button",{onClick:()=>Et(e,"whatsapp"),className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700",title:"Send WhatsApp",children:t.jsx(p,{size:14})}),t.jsx("button",{onClick:()=>Et(e,"sms"),className:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600",title:"Send SMS",children:t.jsx(h,{size:14})}),e.email&&t.jsx("button",{onClick:()=>Et(e,"email"),className:"px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700",title:"Send Email",children:t.jsx(y,{size:14})}),t.jsx("button",{onClick:()=>Vt(e),className:"px-3 py-1 bg-orange-600 text-white text-sm rounded hover:bg-orange-700",title:"View Analytics",children:t.jsx(v,{size:14})}),t.jsx("button",{onClick:()=>(async e=>{we(e),Se(null),fe(!0),await Ot(e.customerId)})(e),className:"px-3 py-1 bg-pink-600 text-white text-sm rounded hover:bg-pink-700",title:"Redeem Rewards",children:t.jsx(j,{size:14})}),t.jsx("button",{onClick:()=>alert(`View ${e.name} loyalty details`),className:"px-3 py-1 border border-gray-300 text-gray-700 text-sm rounded hover:bg-gray-50",children:"View Details"})]}),A&&t.jsxs("div",{className:"mt-4 p-3 bg-white rounded border",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Points History"}),t.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:[J.filter(t=>t.customerId===e.customerId).slice(0,5).map((e,s)=>t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:e.reason}),t.jsxs("span",{className:"font-medium "+(e.points>0?"text-green-600":"text-red-600"),children:[e.points>0?"+":"",e.points]})]},s)),0===J.filter(t=>t.customerId===e.customerId).length&&t.jsx("div",{className:"text-sm text-gray-500",children:"No point history available"})]})]})]},e.id))}),kt&&t.jsx("div",{className:"mt-6 text-center",children:t.jsx(a,{variant:"secondary",onClick:async()=>{kt&&!E&&await At(_t+1,!0)},disabled:E,className:"px-8 py-3",children:E?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),t.jsx("span",{children:"Loading..."})]}):`Load More (${V.length} of ${Rt})`})}),t.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:["Showing ",V.length," of ",Rt," customers",Ct>1&&t.jsxs("span",{children:[" â€¢ Page ",_t," of ",Ct]})]}),0===V.length&&!q&&t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx("div",{className:"text-4xl mb-2",children:"ðŸ‘¥"}),t.jsx("div",{children:"No loyalty customers found"}),t.jsx("div",{className:"text-sm mt-1",children:"Try adjusting your search or filters"})]})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs(s,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Loyalty Tiers"}),t.jsx("div",{className:"space-y-3",children:U.map((e,s)=>t.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[e.discount,"% discount"]})]}),t.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:[e.minPoints," - ",999999===e.maxPoints?"âˆž":e.maxPoints," points"]}),t.jsx("div",{className:"text-xs text-gray-500",children:e.benefits.join(", ")})]},s))})]}),t.jsxs(s,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Available Rewards"}),t.jsx("div",{className:"space-y-3",children:H.map(e=>t.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-sm font-semibold text-blue-600",children:[e.points," points"]})]}),t.jsx("div",{className:"text-xs text-gray-600 mb-2",children:e.description}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(e.active?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"),children:e.active?"Active":"Inactive"}),t.jsx("button",{onClick:()=>alert(`Redeem ${e.name}`),className:"text-xs text-blue-600 hover:text-blue-800",children:"Redeem"})]})]},e.id))})]})]})]}),t.jsx("div",{className:"mt-6",children:t.jsxs(s,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("button",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:[t.jsx("div",{className:"text-blue-600 text-2xl mb-2",children:"ðŸŽ"}),t.jsx("div",{className:"font-medium text-gray-900",children:"Send Rewards"}),t.jsx("div",{className:"text-sm text-gray-600",children:"Send points to customers"})]}),t.jsxs("button",{className:"p-4 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors",children:[t.jsx("div",{className:"text-green-600 text-2xl mb-2",children:"ðŸ“§"}),t.jsx("div",{className:"font-medium text-gray-900",children:"Email Campaign"}),t.jsx("div",{className:"text-sm text-gray-600",children:"Send loyalty promotions"})]}),t.jsxs("button",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 transition-colors",children:[t.jsx("div",{className:"text-purple-600 text-2xl mb-2",children:"ðŸ“Š"}),t.jsx("div",{className:"font-medium text-gray-900",children:"Loyalty Analytics"}),t.jsx("div",{className:"text-sm text-gray-600",children:"View program performance"})]}),t.jsxs("button",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg hover:bg-orange-100 transition-colors",children:[t.jsx("div",{className:"text-orange-600 text-2xl mb-2",children:"âš™ï¸"}),t.jsx("div",{className:"font-medium text-gray-900",children:"Program Settings"}),t.jsx("div",{className:"text-sm text-gray-600",children:"Configure loyalty rules"})]})]})]})}),ne&&oe&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:["Analytics for ",oe.name]}),t.jsx("button",{onClick:()=>ie(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),ue?t.jsxs("div",{className:"flex items-center justify-center h-32",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("span",{className:"ml-3 text-gray-600",children:"Loading analytics..."})]}):de?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(b,{className:"text-blue-600 mr-2",size:20}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Spent"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:qt(de.totalSpent)})]})]})}),t.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(f,{className:"text-green-600 mr-2",size:20}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Orders"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:de.orderCount})]})]})}),t.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(N,{className:"text-purple-600 mr-2",size:20}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Avg Order"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:qt(de.avgOrderValue)})]})]})}),t.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(w,{className:"text-orange-600 mr-2",size:20}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Last Purchase"}),t.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[de.daysSinceLastPurchase,"d ago"]})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"POS Purchases"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Total Spent:"}),t.jsx("span",{className:"font-medium",children:qt(de.totalPosSpent)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Unique Products:"}),t.jsx("span",{className:"font-medium",children:de.uniqueProducts})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Total Items:"}),t.jsx("span",{className:"font-medium",children:de.totalItems})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Purchase Frequency:"}),t.jsxs("span",{className:"font-medium",children:[de.purchaseFrequency.toFixed(1)," orders/month"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Spare Parts Usage"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Total Spent:"}),t.jsx("span",{className:"font-medium",children:qt(de.totalSpareSpent)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Parts Used:"}),t.jsx("span",{className:"font-medium",children:ve.length})]})]})]})]}),ge.length>0&&t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Recent Sales"}),t.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:ge.slice(0,5).map((e,s)=>t.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm",children:["Order #",e.sale_number]}),t.jsx("p",{className:"text-xs text-gray-600",children:new Date(e.created_at).toLocaleDateString()})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-medium text-sm",children:qt(e.total_amount)}),t.jsx("p",{className:"text-xs text-gray-600",children:e.payment_method})]})]},s))})]})]}):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(v,{size:48,className:"mx-auto mb-4 text-gray-300"}),t.jsx("p",{children:"No analytics data available for this customer"})]})]})}),be&&Ne&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:["Redeem Rewards for ",Ne.name]}),t.jsx("button",{onClick:()=>fe(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),t.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Current Points Balance"}),t.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[Ne.points," points"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Loyalty Tier"}),t.jsx("span",{className:`inline-flex px-2 py-1 text-sm font-medium rounded-full ${zt(Ne.tier)}`,children:Ne.tier})]})]})}),t.jsxs("div",{className:"mb-6",children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Available Rewards"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:$t(Ne.points).map(e=>t.jsxs("div",{onClick:()=>Se(e),className:"p-4 border-2 rounded-lg cursor-pointer transition-colors "+((null==_e?void 0:_e.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h5",{className:"font-semibold text-gray-900",children:e.name}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(_,{className:"text-yellow-500 mr-1",size:16}),t.jsxs("span",{className:"font-bold text-gray-900",children:[e.points," pts"]})]})]}),t.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(e.active?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"),children:e.active?"Available":"Unavailable"}),(null==_e?void 0:_e.id)===e.id&&t.jsx(S,{className:"text-blue-500",size:16})]})]},e.id))}),0===$t(Ne.points).length&&t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(j,{size:48,className:"mx-auto mb-4 text-gray-300"}),t.jsx("p",{children:"No rewards available for current points balance"}),t.jsx("p",{className:"text-sm mt-2",children:"Customer needs more points to redeem rewards"})]})]}),ke.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Redemptions"}),t.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:ke.map((e,s)=>t.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.reason||"Reward Redemption"}),t.jsx("p",{className:"text-xs text-gray-600",children:new Date(e.created_at).toLocaleDateString()})]}),t.jsx("div",{className:"text-right",children:t.jsxs("p",{className:"font-medium text-sm text-red-600",children:["-",Math.abs(e.points_change)," pts"]})})]},s))})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>fe(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(Ne&&_e)if(Ne.points<_e.points)P.error("Customer does not have enough points for this reward");else{Pe(!0);try{if(await k.updateCustomerPoints(Ne.customerId,-_e.points,`Redeemed: ${_e.name}`,"redeemed")){const{error:t}=await e.from("reward_redemptions").insert({customer_id:Ne.customerId,reward_id:_e.id,reward_name:_e.name,points_used:_e.points,redeemed_at:(new Date).toISOString(),status:"active"});_e.name,_e.points,Ne.points,_e.points;P.success(`Reward redeemed successfully! ${_e.points} points deducted.`),await At(1,!1),await Ot(Ne.customerId),fe(!1),we(null),Se(null)}else P.error("Failed to redeem reward")}catch(t){P.error("Failed to redeem reward")}finally{Pe(!1)}}else P.error("Please select a customer and reward")},disabled:Ce||!_e,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:Ce?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Redeeming..."]}):t.jsxs(t.Fragment,{children:[t.jsx(j,{size:16,className:"mr-2"}),"Redeem Reward"]})})]})]})}),Qe&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:["Bulk Operations (",et.length," customers selected)"]}),t.jsx("button",{onClick:()=>Xe(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operation Type"}),t.jsxs("select",{value:st,onChange:e=>at(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"points",children:"Adjust Points"}),t.jsx("option",{value:"communication",children:"Send Message"}),t.jsx("option",{value:"export",children:"Export Data"})]})]}),"points"===st&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Points to Add/Subtract"}),t.jsx("input",{type:"number",value:rt,onChange:e=>lt(parseInt(e.target.value)||0),placeholder:"Enter points (positive to add, negative to subtract)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),"communication"===st&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),t.jsx("textarea",{value:nt,onChange:e=>it(e.target.value),placeholder:"Enter message to send to all selected customers...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>Xe(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(0!==et.length){ct(!0);try{let e=!0;switch(st){case"points":for(const l of et){await k.updateCustomerPoints(l,rt,"Bulk points adjustment","adjusted")||(e=!1)}break;case"communication":e=!1,P.error("WhatsApp service not available");break;case"export":const t=V.filter(e=>et.includes(e.customerId)),s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`loyalty-customers-export-${(new Date).toISOString().split("T")[0]}.json`,r.click(),URL.revokeObjectURL(a)}e?(P.success(`Bulk operation completed successfully for ${et.length} customers!`),tt([]),await At(1,!1)):P.error("Some operations failed. Please check the results.")}catch(e){P.error("Failed to complete bulk operation")}finally{ct(!1)}}else P.error("Please select customers for bulk operation")},disabled:ot||"points"===st&&0===rt||"communication"===st&&!nt.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:ot?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(m,{size:16,className:"mr-2"}),"Execute Bulk Operation"]})})]})]})]})}),Ie&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Loyalty Campaigns"}),t.jsx("button",{onClick:()=>De(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Create New Campaign"}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Campaign Name"}),t.jsx("input",{type:"text",value:Ae.name,onChange:e=>Fe({...Ae,name:e.target.value}),placeholder:"Enter campaign name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),t.jsx("textarea",{value:Ae.message,onChange:e=>Fe({...Ae,message:e.target.value}),placeholder:"Enter campaign message",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Tier"}),t.jsxs("select",{value:Ae.targetTier,onChange:e=>Fe({...Ae,targetTier:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"all",children:"All Tiers"}),t.jsx("option",{value:"bronze",children:"Bronze"}),t.jsx("option",{value:"silver",children:"Silver"}),t.jsx("option",{value:"gold",children:"Gold"}),t.jsx("option",{value:"platinum",children:"Platinum"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),t.jsxs("select",{value:Ae.type,onChange:e=>Fe({...Ae,type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"whatsapp",children:"WhatsApp"}),t.jsx("option",{value:"sms",children:"SMS"}),t.jsx("option",{value:"email",children:"Email"})]})]})]}),t.jsx("button",{onClick:async()=>{if(Ae.name&&Ae.message){ze(!0);try{const{error:t}=await e.from("loyalty_campaigns").insert({name:Ae.name,message:Ae.message,target_tier:Ae.targetTier,target_status:Ae.targetStatus,scheduled_date:Ae.scheduledDate,type:Ae.type,status:"scheduled",created_at:(new Date).toISOString()});t?P.error("Failed to create campaign"):(P.success("Campaign created successfully!"),Fe({name:"",message:"",targetTier:"all",targetStatus:"all",scheduledDate:"",type:"whatsapp"}),await(async()=>{try{const{data:t,error:s}=await e.from("loyalty_campaigns").select("*").order("created_at",{ascending:!1});!s&&t&&Te(t)}catch(t){}})())}catch(t){P.error("Failed to create campaign")}finally{ze(!1)}}else P.error("Please fill in all required fields")},disabled:qe||!Ae.name||!Ae.message,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:qe?"Creating...":"Create Campaign"})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Active Campaigns"}),t.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[Re.map((e,s)=>t.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("h5",{className:"font-medium text-gray-900",children:e.name}),t.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+("active"===e.status?"bg-green-100 text-green-600":"bg-yellow-100 text-yellow-600"),children:e.status})]}),t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.message}),t.jsxs("div",{className:"text-xs text-gray-500",children:["Target: ",e.target_tier," â€¢ Type: ",e.type]})]},s)),0===Re.length&&t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(u,{size:48,className:"mx-auto mb-4 text-gray-300"}),t.jsx("p",{children:"No campaigns created yet"})]})]})]})]})]})}),Ee&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Generate Reports"}),t.jsx("button",{onClick:()=>Me(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),t.jsxs("select",{value:Ve,onChange:e=>Oe(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"loyalty-overview",children:"Loyalty Overview"}),t.jsx("option",{value:"customer-segments",children:"Customer Segments"}),t.jsx("option",{value:"points-activity",children:"Points Activity"}),t.jsx("option",{value:"reward-redemptions",children:"Reward Redemptions"}),t.jsx("option",{value:"campaign-performance",children:"Campaign Performance"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Period"}),t.jsxs("select",{value:$e,onChange:e=>Be(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"7d",children:"Last 7 Days"}),t.jsx("option",{value:"30d",children:"Last 30 Days"}),t.jsx("option",{value:"90d",children:"Last 90 Days"}),t.jsx("option",{value:"1y",children:"Last Year"}),t.jsx("option",{value:"all",children:"All Time"})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>Me(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{Ge(!0);try{await new Promise(e=>setTimeout(e,2e3));const e={type:Ve,period:$e,generatedAt:(new Date).toISOString(),data:{totalCustomers:$.totalCustomers,totalPoints:$.totalPoints,totalSpent:$.totalSpent,averagePoints:$.averagePoints,vipCustomers:$.vipCustomers}},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`loyalty-report-${Ve}-${$e}.json`,a.click(),URL.revokeObjectURL(s),P.success("Report generated and downloaded successfully!")}catch(e){P.error("Failed to generate report")}finally{Ge(!1)}},disabled:Ue,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:Ue?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Generating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(x,{size:16,className:"mr-2"}),"Generate Report"]})})]})]})]})}),He&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Customer Segmentation"}),t.jsx("button",{onClick:()=>Ze(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Segments"}),t.jsx("div",{className:"space-y-3",children:Je.map((e,s)=>t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h5",{className:"font-medium text-gray-900",children:e.name}),t.jsxs("span",{className:"text-sm font-bold "+("purple"===e.color?"text-purple-600":"yellow"===e.color?"text-yellow-600":"green"===e.color?"text-green-600":"text-red-600"),children:[e.count," customers"]})]}),t.jsx("p",{className:"text-sm text-gray-600",children:e.criteria})]},s))})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Segment Actions"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Segment"}),t.jsxs("select",{value:Ye,onChange:e=>Ke(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[t.jsx("option",{value:"all",children:"All Customers"}),Je.map((e,s)=>t.jsxs("option",{value:e.name,children:[e.name," (",e.count,")"]},s))]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Send Campaign to Segment"}),t.jsx("button",{className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Export Segment Data"}),t.jsx("button",{className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Analyze Segment"})]})]})]})]})]})}),Y&&Q&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Send ",se.toUpperCase()," to ",Q.name]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),t.jsx("textarea",{value:ee,onChange:e=>te(e.target.value),placeholder:`Enter your ${se} message...`,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",rows:4})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>K(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(Q&&ee.trim()){le(!0);try{let e=!1;switch(se){case"sms":e=(await r.sendSMS(Q.phone,ee)).success;break;case"email":if(!Q.email)return void P.error("Customer has no email address");e=!0,P.success("Email service not yet implemented")}e?(P.success(`${se.toUpperCase()} message sent successfully!`),K(!1),te(""),X(null)):P.error(`Failed to send ${se.toUpperCase()} message`)}catch(e){P.error("Failed to send message")}finally{le(!1)}}else P.error("Please select a customer and enter a message")},disabled:re||!ee.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:re?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):t.jsxs(t.Fragment,{children:[t.jsx(C,{size:16,className:"mr-2"}),"Send ",se.toUpperCase()]})})]})]})})]})};export{L as default};
