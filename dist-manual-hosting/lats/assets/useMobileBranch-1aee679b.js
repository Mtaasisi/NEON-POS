import{r as a}from"./vendor-a2ff445a.js";import"./supabase-460661f2.js";import{z as e}from"./ui-551a39a6.js";import{s as r}from"./index-222cfb29.js";const n=()=>{const[n,t]=a.useState(null),[s,i]=a.useState([]),[o,c]=a.useState(!0),d=a.useCallback(async()=>{try{c(!0);const{data:a,error:e}=await r.from("store_locations").select("id, name, code, city, is_main, is_active, data_isolation_mode, share_products, share_customers, share_inventory").eq("is_active",!0).order("is_main",{ascending:!1}).order("name",{ascending:!0});if(e)throw e;i(a||[]);const n=localStorage.getItem("current_branch_id");let s=null;if(n&&(s=(null==a?void 0:a.find(a=>a.id===n))||null),!s){s=(null==a?void 0:a.find(a=>a.is_main))||(null==a?void 0:a[0])||null,s&&localStorage.setItem("current_branch_id",s.id)}t(s)}catch(a){e.error("Failed to load branch information")}finally{c(!1)}},[]),l=a.useCallback(async a=>{const r=s.find(e=>e.id===a);r?(t(r),localStorage.setItem("current_branch_id",a),e.success(`Switched to ${r.name}`),window.dispatchEvent(new CustomEvent("branchChanged",{detail:{branchId:a}}))):e.error("Branch not found")},[s]),u=a.useCallback(a=>{if(!n)return!0;if("shared"===n.data_isolation_mode)return!0;if("isolated"===n.data_isolation_mode)return!1;return{products:n.share_products,customers:n.share_customers,inventory:n.share_inventory}[a]??!1},[n]),h=a.useCallback(()=>n?{branchId:n.id,mode:n.data_isolation_mode}:null,[n]),_=a.useCallback(async()=>{await d()},[d]);return a.useEffect(()=>{d()},[d]),{currentBranch:n,availableBranches:s,loading:o,switchBranch:l,refreshBranches:_,isDataShared:u,getBranchFilter:h}},t=(a,e,r,n)=>"shared"===r||n?a:"isolated"===r?a.eq("branch_id",e):"hybrid"===r?a.or(`branch_id.eq.${e},is_shared.eq.true,branch_id.is.null`):a.or(`branch_id.eq.${e},branch_id.is.null`);export{t as a,n as u};
