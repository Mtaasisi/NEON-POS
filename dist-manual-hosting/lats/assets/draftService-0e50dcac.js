const t=new class{constructor(){this.STORAGE_KEY="lats_purchase_order_drafts",this.MAX_DRAFTS=20}saveDraft(t,e,r,a,n,s,l,i){const c=this.getAllDrafts(),u=`po_draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:u,name:t.trim(),cartItems:[...e],supplier:r?{...r}:null,currency:a?{...a}:null,expectedDelivery:n,paymentTerms:s,notes:l||"",exchangeRates:i||"",createdAt:new Date,updatedAt:new Date};c.unshift(o),c.length>this.MAX_DRAFTS&&c.splice(this.MAX_DRAFTS);try{return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(c)),u}catch(d){throw new Error("Failed to save draft")}}updateDraft(t,e){const r=this.getAllDrafts(),a=r.findIndex(e=>e.id===t);if(-1===a)return!1;r[a]={...r[a],...e,updatedAt:new Date};try{return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r)),!0}catch(n){return!1}}getAllDrafts(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return[];return JSON.parse(t).map(t=>({...t,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)}))}catch(t){return[]}}getDraft(t){return this.getAllDrafts().find(e=>e.id===t)||null}getLatestDraft(){const t=this.getAllDrafts();return 0===t.length?null:t[0]}deleteDraft(t){const e=this.getAllDrafts(),r=e.filter(e=>e.id!==t);if(r.length===e.length)return!1;try{return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r)),!0}catch(a){return!1}}clearAllDrafts(){try{return localStorage.removeItem(this.STORAGE_KEY),!0}catch(t){return!1}}hasDrafts(){return this.getAllDrafts().length>0}savePOSDraft(t,e,r,a){const n=`POS Draft ${(new Date).toLocaleString()}`;return this.saveDraft(n,t,e,{code:"TZS",name:"Tanzanian Shilling"},"","",a||"","")}autoSave(t,e,r,a,n,s,l){if(0===t.length)return null;const i=`Auto-save ${(new Date).toLocaleString()}`;try{return this.saveDraft(i,t,e,r,a,n,s,l)}catch(c){return null}}getDraftSummary(t){var e,r;const a=t.cartItems.reduce((t,e)=>t+(e.totalPrice||0),0),n=t.cartItems.length;return{id:t.id,name:t.name,supplier:(null==(e=t.supplier)?void 0:e.name)||"No supplier",itemCount:n,totalAmount:a,currency:(null==(r=t.currency)?void 0:r.code)||"TZS",createdAt:t.createdAt,updatedAt:t.updatedAt}}},e=t;export{e as d,t as p};
