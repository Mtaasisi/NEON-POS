import{j as e,d as s,x as a,y as t,G as r,z as n,A as l,B as i,q as c,C as o,s as d,D as m,E as x,F as g,H as u,I as h,J as p,v as b,K as y,L as f,u as j}from"./index-222cfb29.js";import{r as v,R as N}from"./vendor-a2ff445a.js";import{c as w}from"./routing-a2f0f6d2.js";import{g as _,s as k}from"./attendanceSettingsApi-f32cc1d2.js";import{_ as C}from"./supabase-7e851d02.js";import{e as S,v as A,z as P,R as I,aa as T,$ as E,aP as R,aQ as D,aR as M,aS as L,aT as F,Q as O,ak as q,q as B,N as W,d as z,A as $,h as U,m as G,s as K,j as H,aA as J,aU as V,Z as Y,aV as Q,aW as Z,S as X,M as ee,aX as se,az as ae,aY as te,n as re,am as ne,P as le,T as ie,x as ce,r as oe,a4 as de,aB as me,D as xe,a1 as ge,aZ as ue,ax as he,ay as pe,X as be,ai as ye,f as fe,t as je,a_ as ve,aG as Ne,a$ as we,b0 as _e,b1 as ke,y as Ce,C as Se,K as Ae,b2 as Pe,av as Ie,c as Te,ag as Ee,ah as Re,a as De,b as Me,u as Le,ar as Fe,aq as Oe,G as qe,p as Be,a6 as We,a5 as ze,aj as $e,b3 as Ue,b4 as Ge,b5 as Ke,I as He,b6 as Je,b7 as Ve,Y as Ye,b8 as Qe,b9 as Ze,ba as Xe,bb as es,bc as ss,aK as as,bd as ts,be as rs,a0 as ns,bf as ls,a8 as is,aC as cs,bg as os,bh as ds,bi as ms,_ as xs,bj as gs,ao as us,O as hs,bk as ps,bl as bs,k as ys,a2 as fs,bm as js,J as vs,bn as Ns,bo as ws}from"./ui-551a39a6.js";import{G as _s}from"./GlassInput-ba5c3c0d.js";import{G as ks}from"./GlassSelect-3b56e5f5.js";import{l as Cs,s as Ss}from"./userSettingsApi-39de17fd.js";import"./utils-fb833cf6.js";import"./charts-66cc82bb.js";class As{constructor(){this.isLoaded=!1,this.isLoading=!1,this.loadPromise=null,this.error=null}static getInstance(){return As.instance||(As.instance=new As),As.instance}async getApiKey(){var e;try{const{getIntegration:s}=await C(()=>import("./index-222cfb29.js").then(e=>e.aT),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),a=await s("GOOGLE_MAPS");if(a&&a.is_enabled&&(null==(e=a.credentials)?void 0:e.api_key))return a.credentials.api_key;const t={}.VITE_GOOGLE_MAPS_API_KEY;return t||null}catch(s){return{}.VITE_GOOGLE_MAPS_API_KEY||null}}async load(e={}){return this.isLoaded?Promise.resolve():this.isLoading&&this.loadPromise?this.loadPromise:window.google&&window.google.maps?(this.isLoaded=!0,Promise.resolve()):(this.isLoading=!0,this.error=null,this.loadPromise=new Promise(async(s,a)=>{try{const t=e.apiKey||await this.getApiKey();if(!t||"YOUR_API_KEY"===t){const e="Google Maps API key not configured. Please set VITE_GOOGLE_MAPS_API_KEY environment variable.";return this.error=e,this.isLoading=!1,void a(new Error(e))}const r=e.libraries||["geometry","marker"],n=e.version||"weekly",l=document.createElement("script");l.src=`https://maps.googleapis.com/maps/api/js?key=${t}&libraries=${r.join(",")}&v=${n}&loading=async`,l.async=!0,l.defer=!0,l.onerror=e=>{clearTimeout(i);const s="Failed to load Google Maps API script";this.error=s,this.isLoading=!1,a(new Error(s))};const i=setTimeout(()=>{const e="Google Maps API loading timed out";this.error=e,this.isLoading=!1,a(new Error(e))},1e4);l.onload=()=>{clearTimeout(i);const e=()=>{var a,t,r,n;(null==(t=null==(a=window.google)?void 0:a.maps)?void 0:t.Map)&&(null==(n=null==(r=window.google)?void 0:r.maps)?void 0:n.marker)?(this.isLoaded=!0,this.isLoading=!1,s()):setTimeout(e,50)};e()},document.head.appendChild(l)}catch(t){this.error=`Setup error: ${t}`,this.isLoading=!1,a(t)}}),this.loadPromise)}isReady(){var e,s,a,t;return this.isLoaded&&!(!(null==(s=null==(e=window.google)?void 0:e.maps)?void 0:s.Map)||!(null==(t=null==(a=window.google)?void 0:a.maps)?void 0:t.marker))}getError(){return this.error}async testAPI(){if(!this.isReady())return!1;try{const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);new window.google.maps.Map(e,{center:{lat:0,lng:0},zoom:1});return document.body.removeChild(e),!0}catch(e){return!1}}getGoogleMaps(){if(!this.isReady())throw new Error("Google Maps API not ready");return window.google.maps}reset(){this.isLoaded=!1,this.isLoading=!1,this.loadPromise=null,this.error=null}}const Ps=As.getInstance(),Is=({offices:a,selectedOffice:t,onOfficeSelect:r,showRadius:n=!0,className:l=""})=>{const[i,c]=v.useState(null),[o,d]=v.useState(null),[m,x]=v.useState([]),[g,u]=v.useState([]),[h,p]=v.useState(!1),[b,y]=v.useState(null);return v.useEffect(()=>{(async()=>{try{await Ps.load(),p(!0)}catch(e){y(Ps.getError()||"Failed to load Google Maps API")}})()},[]),v.useEffect(()=>{var e,s;if(h&&i&&0!==a.length)try{if(!Ps.isReady()||!(null==(s=null==(e=window.google)?void 0:e.maps)?void 0:s.Map))return;const t=a[0]?{lat:a[0].lat,lng:a[0].lng}:{lat:-3.359178,lng:36.661366},r=new window.google.maps.Map(i,{center:t,zoom:13,mapTypeId:"roadmap",mapId:"DEMO_MAP_ID"});d(r)}catch(t){}},[h,i,a]),v.useEffect(()=>{var e,s;if(o&&h)try{if(!Ps.isReady()||!(null==(s=null==(e=window.google)?void 0:e.maps)?void 0:s.marker))return;m.forEach(e=>{e.map&&(e.map=null)}),g.forEach(e=>e.setMap(null));const i=[],c=[];if(a.forEach((e,s)=>{try{const a=new window.google.maps.marker.PinElement({background:(null==t?void 0:t.name)===e.name?"#3B82F6":"#EF4444",borderColor:"#FFFFFF",glyphColor:"#FFFFFF",glyph:(s+1).toString(),scale:1.2}),l=new window.google.maps.marker.AdvancedMarkerElement({position:{lat:e.lat,lng:e.lng},map:o,title:e.name,content:a.element}),d=new window.google.maps.InfoWindow({content:`\n          <div style="padding: 8px; max-width: 250px;">\n            <h3 style="margin: 0 0 8px 0; color: #1F2937; font-weight: bold;">${e.name}</h3>\n            <p style="margin: 0 0 4px 0; color: #6B7280; font-size: 12px;">${e.address}</p>\n            <p style="margin: 0 0 4px 0; color: #6B7280; font-size: 12px;">\n              <strong>Radius:</strong> ${e.radius}m\n            </p>\n            <p style="margin: 0 0 4px 0; color: #6B7280; font-size: 12px;">\n              <strong>WiFi Networks:</strong> ${e.networks.length}\n            </p>\n            <div style="margin-top: 8px;">\n              ${e.networks.map(e=>`<div style="font-size: 11px; color: #059669;">ðŸ“¶ ${e.ssid}</div>`).join("")}\n            </div>\n          </div>\n        `});if(l.addListener("click",()=>{d.open({map:o,anchor:l}),r&&r(e)}),i.push(l),n){const s=new window.google.maps.Circle({strokeColor:(null==t?void 0:t.name)===e.name?"#3B82F6":"#EF4444",strokeOpacity:.8,strokeWeight:2,fillColor:(null==t?void 0:t.name)===e.name?"#3B82F6":"#EF4444",fillOpacity:.1,map:o,center:{lat:e.lat,lng:e.lng},radius:e.radius});c.push(s)}}catch(a){}}),x(i),u(c),a.length>1)try{const e=new window.google.maps.LatLngBounds;a.forEach(s=>{e.extend({lat:s.lat,lng:s.lng})}),o.fitBounds(e)}catch(l){}}catch(l){}},[o,a,t,n,h]),v.useEffect(()=>{if(o&&t)try{o.setCenter({lat:t.lat,lng:t.lng}),o.setZoom(15)}catch(e){}},[o,t]),h?e.jsxs(s,{className:`p-4 ${l}`,children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600"}),"Office Locations Map"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{children:"Office"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Selected"})]})]})]}),e.jsx("div",{ref:c,className:"w-full h-80 rounded-lg border border-gray-200",style:{minHeight:"320px"}}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsx("p",{children:"ðŸ’¡ Click on any office marker to view details and select it"}),e.jsx("p",{children:"ðŸ“ Circles show the check-in radius for each office"})]})]}):e.jsx(s,{className:`p-6 ${l}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx(S,{className:"w-8 h-8 mx-auto"})}),e.jsx("p",{className:"text-red-600 font-medium",children:"Map Loading Failed"}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:b}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading map..."})]})})})})},Ts=()=>{var c,o;const[d,m]=v.useState([]),[x]=v.useState(a()),[g,u]=v.useState(!0),[h,p]=v.useState(null),[b,y]=v.useState(!1),[f,j]=v.useState({}),[N,w]=v.useState(!1),[_,k]=v.useState(null),[C,S]=v.useState({});v.useEffect(()=>{Z()},[]);const Z=async()=>{u(!0);try{const e=await t();m(e)}catch(e){P.error("Failed to load integrations")}finally{u(!1)}},X=async e=>e.credentials.api_key?{success:!0,message:`SMS credentials validated. API Key: ${e.credentials.api_key.substring(0,8)}...`}:{success:!1,message:"API key is required"},ee=async e=>{if(!e.credentials.instance_id||!e.credentials.api_token)return{success:!1,message:"Instance ID and API token are required"};try{const s=`${e.config.api_url||"https://7105.api.greenapi.com"}/waInstance${e.credentials.instance_id}/getStateInstance/${e.credentials.api_token}`,a=await fetch(s),t=await a.json();return"authorized"===t.stateInstance?{success:!0,message:`Connected! Status: ${t.stateInstance}`}:{success:!1,message:`Status: ${t.stateInstance}. Please scan QR code to authorize.`}}catch(s){return{success:!1,message:s.message}}},se=async e=>e.credentials.api_key||e.credentials.username?{success:!0,message:"Email credentials validated successfully"}:{success:!1,message:"Email credentials are incomplete"},ae=async e=>e.credentials.api_key||e.credentials.secret_key||e.credentials.consumer_key?{success:!0,message:"Payment credentials validated successfully"}:{success:!1,message:"Payment credentials are incomplete"},te=async e=>e.credentials.tracking_id||e.credentials.measurement_id?{success:!0,message:"Analytics credentials validated successfully"}:{success:!1,message:"Analytics tracking ID is required"},re=async e=>e.credentials.api_key?{success:!0,message:"AI credentials validated successfully"}:{success:!1,message:"AI API key is required"},ne=async e=>({success:!0,message:"Social media credentials validated successfully"}),le=async e=>e.credentials.api_key?e.credentials.api_key.startsWith("AIza")?{success:!0,message:"Google Maps API key validated. Maps services are ready to use."}:{success:!1,message:'Invalid Google Maps API key format (should start with "AIza")'}:{success:!1,message:"Maps API key is required"},ie=async e=>"HOSTINGER_STORAGE"===e.integration_name?e.credentials.api_token&&e.credentials.domain?{success:!0,message:"Hostinger credentials validated. File storage is ready to use."}:{success:!1,message:"Hostinger credentials incomplete (API Token and Domain required)"}:e.credentials.api_key||e.credentials.api_token?{success:!0,message:"Storage credentials validated successfully"}:{success:!1,message:"Storage credentials are incomplete"},ce=async e=>e.credentials.api_key||e.credentials.api_url?{success:!0,message:"Integration credentials validated successfully"}:{success:!1,message:"API credentials are incomplete"},oe=e=>({Smartphone:G,MessageCircle:K,Mail:H,CreditCard:J,BarChart:V,Zap:Y,Globe:R,MapPin:A,HardDrive:Q}[e]||R),de=s=>s.is_enabled&&s.is_active?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:[e.jsx(z,{className:"w-3 h-3"}),"Active"]}):s.is_enabled?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-medium",children:[e.jsx($,{className:"w-3 h-3"}),"Enabled"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium",children:[e.jsx(U,{className:"w-3 h-3"}),"Disabled"]}),me=e=>x.find(s=>s.integration_name===e);return g?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(T,{className:"w-7 h-7 text-blue-600"}),"Integrations Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure and manage all your third-party integrations"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d.some(e=>e.is_test_mode)&&e.jsxs(r,{onClick:async()=>{const e=d.filter(e=>e.is_test_mode);if(0!==e.length){if(confirm(`Are you sure you want to delete all ${e.length} test integration(s)?`))try{for(const s of e)await l(s.integration_name);P.success(`Successfully deleted ${e.length} test integration(s)!`),await Z()}catch(s){P.error("Failed to delete test integrations")}}else P.error("No test integrations found")},variant:"outline",className:"flex items-center gap-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(E,{className:"w-4 h-4"}),"Delete Test Integrations"]}),e.jsxs(r,{onClick:Z,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Refresh"]})]})]}),d.length>0&&e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Active Integrations (",d.length,")"]}),e.jsx("div",{className:"space-y-3",children:d.map(s=>{const a=me(s.integration_name),t=a?oe(a.icon):R;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg",children:e.jsx(t,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.provider_name||s.integration_name}),de(s)]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description||`${s.integration_type} integration`}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.is_test_mode&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"Test Mode"}),C[s.integration_name]&&e.jsxs("span",{className:"text-xs font-medium px-2 py-0.5 rounded "+(C[s.integration_name].success?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:["Last test: ",C[s.integration_name].success?"âœ… Passed":"âŒ Failed"]})]}),C[s.integration_name]&&!C[s.integration_name].success&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:C[s.integration_name].message})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{onClick:()=>(async e=>{k(e.integration_name);try{let s={success:!1,message:""};switch(e.integration_type){case"sms":s=await X(e);break;case"whatsapp":s=await ee(e);break;case"email":s=await se(e);break;case"payment":s=await ae(e);break;case"analytics":s=await te(e);break;case"ai":s=await re(e);break;case"social":s=await ne(e);break;case"maps":s=await le(e);break;case"storage":s=await ie(e);break;default:s=await ce(e)}S(a=>({...a,[e.integration_name]:s})),s.success?P.success(`âœ… ${e.provider_name} test passed!`):P.error(`âŒ ${e.provider_name} test failed: ${s.message}`)}catch(s){const a=s.message||"Unknown error";S(s=>({...s,[e.integration_name]:{success:!1,message:a}})),P.error(`Test error: ${a}`)}finally{k(null)}})(s),variant:"outline",size:"sm",disabled:_===s.integration_name,className:"flex items-center gap-1 text-blue-600 hover:text-blue-700",title:"Test integration",children:_===s.integration_name?e.jsx(I,{className:"w-4 h-4 animate-spin"}):e.jsx(D,{className:"w-4 h-4"})}),e.jsx(r,{onClick:()=>(async(e,s)=>{try{await i(e,s),P.success(`Integration ${s?"enabled":"disabled"} successfully!`),await Z()}catch(a){P.error("Failed to toggle integration")}})(s.integration_name,!s.is_enabled),variant:"outline",size:"sm",className:"flex items-center gap-1 "+(s.is_enabled?"text-green-600 hover:text-green-700":"text-gray-600 hover:text-gray-700"),title:s.is_enabled?"Disable":"Enable",children:s.is_enabled?e.jsx(M,{className:"w-4 h-4"}):e.jsx(L,{className:"w-4 h-4"})}),e.jsx(r,{onClick:()=>(e=>{p({...e}),y(!0)})(s),variant:"outline",size:"sm",className:"flex items-center gap-1",title:"Edit integration",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx(r,{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this integration?"))try{await l(e),P.success("Integration deleted successfully!"),await Z()}catch(s){P.error("Failed to delete integration")}})(s.integration_name),variant:"outline",size:"sm",className:"flex items-center gap-1 text-red-600 hover:text-red-700",title:"Delete integration",children:e.jsx(E,{className:"w-4 h-4"})})]})]},s.id)})})]}),e.jsxs(s,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Integration"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(s=>{const a=oe(s.icon),t=d.find(e=>e.integration_name===s.integration_name);return e.jsxs("div",{className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors cursor-pointer",onClick:()=>!t&&(e=>{p({integration_name:e.integration_name,integration_type:e.integration_type,provider_name:e.provider_name,is_enabled:!1,is_active:!1,is_test_mode:!0,environment:"test",credentials:{},config:{},description:e.description}),y(!0)})(s),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(a,{className:"w-6 h-6 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:s.provider_name})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),t?e.jsx("button",{className:"w-full py-2 px-4 bg-gray-100 text-gray-500 rounded-lg cursor-not-allowed",disabled:!0,children:"Already Added"}):e.jsxs("button",{className:"w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Add Integration"]})]},s.integration_name)})})]}),b&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[h.id?"Edit":"Add"," Integration"]}),e.jsx("button",{onClick:()=>{y(!1),p(null)},className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Provider Name"}),e.jsx("input",{type:"text",value:h.provider_name||"",onChange:e=>p({...h,provider_name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:h.description||"",onChange:e=>p({...h,description:e.target.value}),rows:2,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),e.jsxs("select",{value:h.environment,onChange:e=>p({...h,environment:e.target.value,is_test_mode:"test"===e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"test",children:"Test"}),e.jsx("option",{value:"sandbox",children:"Sandbox"}),e.jsx("option",{value:"production",children:"Production"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-8",children:[e.jsx("input",{type:"checkbox",id:"enabled",checked:h.is_enabled,onChange:e=>p({...h,is_enabled:e.target.checked,is_active:e.target.checked}),className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"enabled",className:"font-medium",children:"Enable Integration"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Credentials"}),null==(c=me(h.integration_name))?void 0:c.credentials_fields.map(s=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s.label," ",s.required&&"*"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"password"!==s.type||f[s.name]?"text":"password",value:h.credentials[s.name]||"",onChange:e=>p({...h,credentials:{...h.credentials,[s.name]:e.target.value}}),placeholder:s.placeholder,className:"w-full px-4 py-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),"password"===s.type&&e.jsx("button",{type:"button",onClick:()=>{return e=s.name,void j(s=>({...s,[e]:!s[e]}));var e},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:f[s.name]?e.jsx(q,{className:"w-5 h-5"}):e.jsx(B,{className:"w-5 h-5"})})]})]},s.name))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Configuration"}),null==(o=me(h.integration_name))?void 0:o.config_fields.map(s=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s.label," ",s.required&&"*"]}),"checkbox"===s.type?e.jsx("input",{type:"checkbox",checked:h.config[s.name]||!1,onChange:e=>p({...h,config:{...h.config,[s.name]:e.target.checked}}),className:"w-5 h-5 text-blue-600 rounded"}):"select"===s.type&&s.options?e.jsx("select",{value:h.config[s.name]||"",onChange:e=>p({...h,config:{...h.config,[s.name]:e.target.value}}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:s.options.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}):e.jsx("input",{type:s.type,value:h.config[s.name]||"",onChange:e=>p({...h,config:{...h.config,[s.name]:e.target.value}}),placeholder:s.placeholder,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]},s.name))]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex gap-3 justify-end",children:[e.jsx(r,{onClick:()=>{y(!1),p(null)},variant:"outline",children:"Cancel"}),e.jsx(r,{onClick:async()=>{if(h){w(!0);try{await n(h),P.success("Integration saved successfully!"),y(!1),p(null),await Z()}catch(e){P.error("Failed to save integration")}finally{w(!1)}}},disabled:N,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4"}),"Save Integration"]})})]})]})})]})},Es=({isActive:a})=>{const{theme:t,setTheme:n}=c(),{settings:l,updateSettings:i,loading:d}=o(),[m,x]=v.useState(t),[g,u]=v.useState(()=>localStorage.getItem("accentColor")||"#3B82F6"),[h,p]=v.useState(()=>localStorage.getItem("fontSize")||"medium");v.useEffect(()=>{(null==l?void 0:l.font_size)&&p(l.font_size)},[l]),v.useEffect(()=>{x(t)},[t]);const b=async e=>{var s;p(e),s=e,document.documentElement.style.fontSize={tiny:"11px","extra-small":"12px",small:"14px",medium:"16px",large:"18px"}[s],localStorage.setItem("fontSize",s);try{await i({font_size:e}),re.success(`Font size changed to ${e.replace("-"," ")}`),window.dispatchEvent(new CustomEvent("settingsUpdated",{detail:{type:"general"}}))}catch(a){re.error("Failed to save font size setting")}};return a?e.jsx("div",{className:"space-y-6",children:e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(Z,{className:"w-5 h-5 text-indigo-600"}),"Appearance Settings"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Theme Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"light",label:"Light",icon:X,desc:"Bright & Clean",preview:"bg-gradient-to-br from-blue-50 to-indigo-100"},{value:"dark",label:"Dark",icon:ee,desc:"Easy on Eyes",preview:"bg-gradient-to-br from-slate-800 to-slate-900"},{value:"dark-cards",label:"Dark Pro",icon:se,desc:"Premium Dark",preview:"bg-gradient-to-br from-slate-900 to-gray-900"}].map(({value:s,label:a,icon:t,desc:r,preview:l})=>e.jsxs("button",{onClick:()=>{return x(e=s),n(e),void re.success("Theme changed to "+("dark"===e?"Dark":"dark-cards"===e?"Dark Cards":"Light"));var e},className:"relative p-4 rounded-xl border-2 transition-all overflow-hidden group "+(m===s?"border-indigo-500 bg-indigo-50 shadow-lg scale-105":"border-gray-300 bg-white hover:bg-gray-50 hover:border-indigo-300"),children:[e.jsx("div",{className:`absolute top-2 right-2 w-8 h-8 rounded-md ${l} opacity-40 group-hover:opacity-60 transition-opacity`}),m===s&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(ae,{className:"w-5 h-5 text-indigo-600"})}),e.jsx(t,{className:"w-8 h-8 mx-auto mb-2 mt-2 "+(m===s?"text-indigo-600":"text-gray-600")}),e.jsx("div",{className:"text-sm font-semibold mb-1 "+(m===s?"text-indigo-700":"text-gray-700"),children:a}),e.jsx("div",{className:"text-xs text-gray-500",children:r})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Accent Color"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"color",value:g,onChange:e=>u(e.target.value),className:"w-16 h-12 rounded-lg border-2 border-white/20 cursor-pointer"}),e.jsx("span",{className:"text-white",children:g})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-indigo-600"}),"Font Size (Affects Entire App)"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:h,onChange:e=>b(e.target.value),disabled:d,className:"w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[e.jsx("option",{value:"tiny",children:"Tiny (11px) - Ultra Compact âœ¨"}),e.jsx("option",{value:"extra-small",children:"Extra Small (12px) - Very Compact"}),e.jsx("option",{value:"small",children:"Small (14px) - Compact"}),e.jsx("option",{value:"medium",children:"Medium (16px) - Default â­"}),e.jsx("option",{value:"large",children:"Large (18px) - Comfortable"})]}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"ðŸ’¡ Changes apply immediately across all pages and components"})]})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(r,{onClick:()=>{localStorage.setItem("accentColor",g),re.success("Appearance settings saved successfully")},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Accent Color"]})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ’¡ Pro Tip:"})," Font size changes are saved automatically and apply instantly across your entire app!"]})})]})}):null},Rs=({isActive:a})=>{const[t,n]=v.useState({emailNotifications:!0,smsNotifications:!1,pushNotifications:!0,whatsappNotifications:!0,lowStockAlerts:!0,salesReports:!0,systemUpdates:!1,marketingEmails:!1});return e.jsx("div",{className:"space-y-6",children:e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(ne,{className:"w-5 h-5 text-indigo-600"}),"Notification Preferences"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"Notification Channels"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.emailNotifications,onChange:e=>n({...t,emailNotifications:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx(H,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"text-gray-800",children:"Email Notifications"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.smsNotifications,onChange:e=>n({...t,smsNotifications:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx(le,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"text-gray-800",children:"SMS Notifications"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.pushNotifications,onChange:e=>n({...t,pushNotifications:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx(ne,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"text-gray-800",children:"Push Notifications"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.whatsappNotifications,onChange:e=>n({...t,whatsappNotifications:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx(K,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"text-gray-800",children:"WhatsApp Notifications"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"Notification Types"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.lowStockAlerts,onChange:e=>n({...t,lowStockAlerts:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx("span",{className:"text-gray-800",children:"Low Stock Alerts"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.salesReports,onChange:e=>n({...t,salesReports:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx("span",{className:"text-gray-800",children:"Daily Sales Reports"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.systemUpdates,onChange:e=>n({...t,systemUpdates:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx("span",{className:"text-gray-800",children:"System Updates"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg bg-white/5 hover:bg-white/10",children:[e.jsx("input",{type:"checkbox",checked:t.marketingEmails,onChange:e=>n({...t,marketingEmails:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded"}),e.jsx("span",{className:"text-gray-800",children:"Marketing Emails"})]})]})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(r,{onClick:()=>{localStorage.setItem("notificationSettings",JSON.stringify(t)),re.success("Notification settings saved")},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Notification Settings"]})})]})})},Ds=({isActive:a})=>{const[t,n]=w(),l=t.get("tab"),[i,c]=v.useState(l||"categories"),[o,m]=v.useState([]),[x,g]=v.useState(!1),[u,h]=v.useState(null),[p,b]=v.useState(!1),[y,f]=v.useState({name:"",description:"",icon:"Package",color:"blue"}),[j,N]=v.useState({beemEnabled:!0,beemApiKey:"",beemSecretKey:"",beemEnvironment:"sandbox"}),[_,k]=v.useState({cashEnabled:!0,cardEnabled:!0,mobileMoneyEnabled:!0,autoConfirmPayments:!1,requireReceipt:!0,allowPartialPayments:!0,taxRate:18,defaultCurrency:"TSh"}),[C,A]=v.useState({sendReceiptEmail:!0,sendReceiptSMS:!1,sendReceiptWhatsApp:!0,autoSendOnSuccess:!0,notifyOnFailure:!0,notifyAdminOnPayment:!1,receiptTemplate:"modern",includeQRCode:!0,includeLogo:!0}),[P,T]=v.useState({baseCurrency:"TZS",enabledCurrencies:["TZS","USD","EUR"],exchangeRateSource:"manual",autoUpdateRates:!1,updateFrequency:"daily",usdToTzs:2350,eurToTzs:2580,showCurrencySymbol:!0}),[M,L]=v.useState({enableRefunds:!0,requireApproval:!0,allowPartialRefund:!0,refundTimeLimit:30,autoProcessRefunds:!1,notifyCustomerOnRefund:!0,trackDisputes:!0}),[F,q]=v.useState({defaultPeriod:"month",autoGenerateReports:!1,reportFrequency:"weekly",reportFormat:"pdf",emailReports:!1,reportRecipients:"",includeCharts:!0,includeTransactionDetails:!0});v.useEffect(()=>{$(),B()},[]),v.useEffect(()=>{const e=t.get("tab");e&&["gateway","categories","preferences","notifications","currency","refunds","reports"].includes(e)&&c(e)},[t]);const B=()=>{const e=localStorage.getItem("paymentGatewaySettings"),s=localStorage.getItem("paymentPreferences"),a=localStorage.getItem("paymentNotifications"),t=localStorage.getItem("paymentCurrency"),r=localStorage.getItem("paymentRefunds"),n=localStorage.getItem("paymentReports");e&&N(JSON.parse(e)),s&&k(JSON.parse(s)),a&&A(JSON.parse(a)),t&&T(JSON.parse(t)),r&&L(JSON.parse(r)),n&&q(JSON.parse(n))},$=async()=>{g(!0);try{const{data:e,error:s}=await d.from("expense_categories").select("*").order("name");if(s)throw s;m(e||[])}catch(e){re.error("Failed to load expense categories")}finally{g(!1)}},G=[{id:"categories",label:"Expense Categories",icon:ie},{id:"gateway",label:"Payment Gateway",icon:de},{id:"preferences",label:"Preferences",icon:J},{id:"notifications",label:"Notifications & Receipts",icon:H},{id:"currency",label:"Currency Management",icon:R},{id:"refunds",label:"Refunds & Disputes",icon:ue},{id:"reports",label:"Payment Reports",icon:he}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payment Settings"}),e.jsx("p",{className:"text-gray-600",children:"Manage payment gateways, expense categories, and payment preferences"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-4 overflow-x-auto",children:G.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>(e=>{c(e),n({tab:e})})(s.id),className:`\n                  flex items-center gap-2 py-4 px-3 border-b-2 font-medium text-sm transition-colors whitespace-nowrap\n                  ${i===s.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}\n                `,children:[e.jsx(a,{className:"w-5 h-5"}),s.label]},s.id)})})}),"categories"===i&&e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-indigo-600"}),"Expense Categories"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage categories for organizing expenses"})]}),!p&&e.jsxs(r,{onClick:()=>b(!0),className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Add Category"]})]}),p&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:u?"Edit Category":"New Category"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(_s,{label:"Category Name *",value:y.name,onChange:e=>f({...y,name:e.target.value}),placeholder:"e.g., Office Supplies"})}),e.jsx("div",{children:e.jsx(_s,{label:"Description",value:y.description,onChange:e=>f({...y,description:e.target.value}),placeholder:"Brief description"})}),e.jsx("div",{children:e.jsx(ks,{label:"Icon",value:y.icon,onChange:e=>f({...y,icon:e}),options:[{value:"Package",label:"Package"},{value:"Building",label:"Building"},{value:"Wallet",label:"Wallet"},{value:"DollarSign",label:"Dollar Sign"},{value:"FileText",label:"File Text"},{value:"Tag",label:"Tag"},{value:"CreditCard",label:"Credit Card"},{value:"TrendingUp",label:"Trending Up"}]})}),e.jsx("div",{children:e.jsx(ks,{label:"Color",value:y.color,onChange:e=>f({...y,color:e}),options:[{value:"blue",label:"Blue"},{value:"green",label:"Green"},{value:"red",label:"Red"},{value:"yellow",label:"Yellow"},{value:"purple",label:"Purple"},{value:"pink",label:"Pink"},{value:"indigo",label:"Indigo"},{value:"gray",label:"Gray"}]})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(r,{onClick:async()=>{if(y.name.trim()){g(!0);try{if(u){const{error:e}=await d.from("expense_categories").update({name:y.name,description:y.description,icon:y.icon,color:y.color}).eq("id",u.id);if(e)throw e;re.success("Category updated successfully")}else{const{error:e}=await d.from("expense_categories").insert([{name:y.name,description:y.description,icon:y.icon,color:y.color,is_active:!0}]);if(e)throw e;re.success("Category created successfully")}f({name:"",description:"",icon:"Package",color:"blue"}),h(null),b(!1),$()}catch(e){re.error(e.message||"Failed to save category")}finally{g(!1)}}else re.error("Category name is required")},disabled:x,className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),u?"Update":"Create"," Category"]}),e.jsx(r,{onClick:()=>{h(null),b(!1),f({name:"",description:"",icon:"Package",color:"blue"})},variant:"secondary",children:"Cancel"})]})]}),x?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading categories..."})]}):0===o.length?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No expense categories yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Click "Add Category" to create your first one'})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(s=>e.jsxs("div",{className:`\n                    p-4 rounded-lg border-2 transition-all\n                    ${s.is_active?"bg-white border-gray-200 hover:border-indigo-300 hover:shadow-md":"bg-gray-50 border-gray-200 opacity-60"}\n                  `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`\n                        w-10 h-10 rounded-lg flex items-center justify-center\n                        bg-${s.color}-100\n                      `,children:e.jsx(ce,{className:`w-5 h-5 text-${s.color}-600`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>(async e=>{try{const{error:s}=await d.from("expense_categories").update({is_active:!e.is_active}).eq("id",e.id);if(s)throw s;re.success("Category "+(e.is_active?"deactivated":"activated")),$()}catch(s){re.error("Failed to update category status")}})(s),className:"p-1 hover:bg-gray-100 rounded",title:s.is_active?"Deactivate":"Activate",children:s.is_active?e.jsx(z,{className:"w-5 h-5 text-green-600"}):e.jsx(U,{className:"w-5 h-5 text-gray-400"})})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>(e=>{h(e),f({name:e.name,description:e.description||"",icon:e.icon||"Package",color:e.color||"blue"}),b(!0)})(s),className:"flex-1 px-3 py-1.5 text-sm bg-indigo-50 text-indigo-700 rounded hover:bg-indigo-100 flex items-center justify-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),"Edit"]}),e.jsxs("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this category? This action cannot be undone."))try{const{error:s}=await d.from("expense_categories").delete().eq("id",e);if(s)throw s;re.success("Category deleted successfully"),$()}catch(s){re.error("Failed to delete category")}})(s.id),className:"flex-1 px-3 py-1.5 text-sm bg-red-50 text-red-700 rounded hover:bg-red-100 flex items-center justify-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),"Delete"]})]})]},s.id))})]}),"gateway"===i&&e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(de,{className:"w-5 h-5 text-indigo-600"}),"Payment Gateway Configuration"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-800 flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Beem Payment Gateway"]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.beemEnabled,onChange:e=>N({...j,beemEnabled:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-800 text-sm font-medium",children:"Enable"})]})]}),j.beemEnabled&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{children:e.jsx(_s,{label:"API Key",type:"password",value:j.beemApiKey,onChange:e=>N({...j,beemApiKey:e.target.value}),placeholder:"Enter API Key"})}),e.jsx("div",{children:e.jsx(_s,{label:"Secret Key",type:"password",value:j.beemSecretKey,onChange:e=>N({...j,beemSecretKey:e.target.value}),placeholder:"Enter Secret Key"})}),e.jsx("div",{children:e.jsx(ks,{label:"Environment",value:j.beemEnvironment,onChange:e=>N({...j,beemEnvironment:e}),options:[{value:"sandbox",label:"Sandbox (Testing)"},{value:"production",label:"Production (Live)"}]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs(r,{onClick:()=>{re.success("Testing payment connection...")},className:"flex items-center gap-2 w-full",variant:"secondary",children:[e.jsx(D,{className:"w-4 h-4"}),"Test Connection"]})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{onClick:()=>{localStorage.setItem("paymentGatewaySettings",JSON.stringify(j)),re.success("Gateway settings saved")},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Gateway Settings"]})})]})]}),"preferences"===i&&e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(J,{className:"w-5 h-5 text-indigo-600"}),"Payment Preferences"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Enabled Payment Methods"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:_.cashEnabled,onChange:e=>k({..._,cashEnabled:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx(me,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-800 font-medium",children:"Cash Payments"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:_.cardEnabled,onChange:e=>k({..._,cardEnabled:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx(J,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-800 font-medium",children:"Card Payments"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:_.mobileMoneyEnabled,onChange:e=>k({..._,mobileMoneyEnabled:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx(xe,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-800 font-medium",children:"Mobile Money"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Transaction Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Auto-confirm successful payments"}),e.jsx("input",{type:"checkbox",checked:_.autoConfirmPayments,onChange:e=>k({..._,autoConfirmPayments:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Require receipt for all transactions"}),e.jsx("input",{type:"checkbox",checked:_.requireReceipt,onChange:e=>k({..._,requireReceipt:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Allow partial payments"}),e.jsx("input",{type:"checkbox",checked:_.allowPartialPayments,onChange:e=>k({..._,allowPartialPayments:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Tax & Currency"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(_s,{label:"Default Tax Rate (%)",type:"number",value:_.taxRate.toString(),onChange:e=>k({..._,taxRate:parseFloat(e.target.value)||0}),placeholder:"18",min:"0",max:"100",step:"0.1"})}),e.jsx("div",{children:e.jsx(_s,{label:"Default Currency",value:_.defaultCurrency,onChange:e=>k({..._,defaultCurrency:e.target.value}),placeholder:"TSh"})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{onClick:()=>{localStorage.setItem("paymentPreferences",JSON.stringify(_)),re.success("Preferences saved")},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Preferences"]})})]})]}),"notifications"===i&&e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(H,{className:"w-5 h-5 text-indigo-600"}),"Payment Notifications & Receipts"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Receipt Delivery Methods"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Email Receipts"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send receipt via email after payment"})]})]}),e.jsx("input",{type:"checkbox",checked:C.sendReceiptEmail,onChange:e=>A({...C,sendReceiptEmail:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"SMS Receipts"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send receipt via SMS (charges apply)"})]})]}),e.jsx("input",{type:"checkbox",checked:C.sendReceiptSMS,onChange:e=>A({...C,sendReceiptSMS:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"WhatsApp Receipts"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send receipt via WhatsApp"})]})]}),e.jsx("input",{type:"checkbox",checked:C.sendReceiptWhatsApp,onChange:e=>A({...C,sendReceiptWhatsApp:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Notification Triggers"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Auto-send on payment success"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Automatically send receipt when payment is successful"})]}),e.jsx("input",{type:"checkbox",checked:C.autoSendOnSuccess,onChange:e=>A({...C,autoSendOnSuccess:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Notify on payment failure"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send notification when payment fails"})]}),e.jsx("input",{type:"checkbox",checked:C.notifyOnFailure,onChange:e=>A({...C,notifyOnFailure:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Notify admin on payments"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send notifications to admin for all payments"})]}),e.jsx("input",{type:"checkbox",checked:C.notifyAdminOnPayment,onChange:e=>A({...C,notifyAdminOnPayment:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Receipt Template & Customization"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{children:e.jsx(ks,{label:"Receipt Template",value:C.receiptTemplate,onChange:e=>A({...C,receiptTemplate:e}),options:[{value:"modern",label:"Modern"},{value:"classic",label:"Classic"},{value:"minimal",label:"Minimal"},{value:"detailed",label:"Detailed"}]})})}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Include QR code in receipt"}),e.jsx("input",{type:"checkbox",checked:C.includeQRCode,onChange:e=>A({...C,includeQRCode:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Include company logo in receipt"}),e.jsx("input",{type:"checkbox",checked:C.includeLogo,onChange:e=>A({...C,includeLogo:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{onClick:()=>{localStorage.setItem("paymentNotifications",JSON.stringify(C)),re.success("Notification settings saved")},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Notification Settings"]})})]})]}),"currency"===i&&e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(R,{className:"w-5 h-5 text-indigo-600"}),"Multi-Currency Management"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Base Currency Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(ks,{label:"Base Currency",value:P.baseCurrency,onChange:e=>T({...P,baseCurrency:e}),options:[{value:"TZS",label:"Tanzanian Shilling (TZS)"},{value:"USD",label:"US Dollar (USD)"},{value:"EUR",label:"Euro (EUR)"},{value:"GBP",label:"British Pound (GBP)"},{value:"KES",label:"Kenyan Shilling (KES)"}]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all w-full",children:[e.jsx("input",{type:"checkbox",checked:P.showCurrencySymbol,onChange:e=>T({...P,showCurrencySymbol:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"text-gray-800 font-medium",children:"Show currency symbol"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Exchange Rate Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(ks,{label:"Exchange Rate Source",value:P.exchangeRateSource,onChange:e=>T({...P,exchangeRateSource:e}),options:[{value:"manual",label:"Manual Entry"},{value:"api",label:"Auto-update from API"},{value:"bank",label:"Bank of Tanzania Rates"}]})}),"api"===P.exchangeRateSource&&e.jsx("div",{children:e.jsx(ks,{label:"Update Frequency",value:P.updateFrequency,onChange:e=>T({...P,updateFrequency:e}),options:[{value:"hourly",label:"Every Hour"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"}]})})]}),"api"===P.exchangeRateSource&&e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:P.autoUpdateRates,onChange:e=>T({...P,autoUpdateRates:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Auto-update exchange rates"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Automatically fetch latest rates from API"})]})]})]}),"manual"===P.exchangeRateSource&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Exchange Rates (Manual)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(_s,{label:"USD to TZS Rate",type:"number",value:P.usdToTzs.toString(),onChange:e=>T({...P,usdToTzs:parseFloat(e.target.value)||0}),placeholder:"2350",step:"0.01"})}),e.jsx("div",{children:e.jsx(_s,{label:"EUR to TZS Rate",type:"number",value:P.eurToTzs.toString(),onChange:e=>T({...P,eurToTzs:parseFloat(e.target.value)||0}),placeholder:"2580",step:"0.01"})})]}),e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(S,{className:"w-5 h-5 text-blue-600"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Last updated manually. Click save to apply new rates."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Enabled Currencies"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:["TZS","USD","EUR","GBP","KES"].map(s=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-3 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",checked:P.enabledCurrencies.includes(s),onChange:e=>{e.target.checked?T({...P,enabledCurrencies:[...P.enabledCurrencies,s]}):T({...P,enabledCurrencies:P.enabledCurrencies.filter(e=>e!==s)})},className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"text-gray-800 font-medium",children:s})]},s))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:["api"===P.exchangeRateSource&&e.jsxs(r,{onClick:()=>re.success("Fetching latest exchange rates..."),className:"flex items-center gap-2",variant:"secondary",children:[e.jsx(I,{className:"w-4 h-4"}),"Refresh Rates Now"]}),e.jsxs(r,{onClick:()=>{localStorage.setItem("paymentCurrency",JSON.stringify(P)),re.success("Currency settings saved")},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Currency Settings"]})]})]})]}),"refunds"===i&&e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(ue,{className:"w-5 h-5 text-indigo-600"}),"Refunds & Dispute Management"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Refund Policies"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Enable refunds"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Allow customers to request refunds"})]}),e.jsx("input",{type:"checkbox",checked:M.enableRefunds,onChange:e=>L({...M,enableRefunds:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),M.enableRefunds&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Require approval"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Refunds must be approved by admin"})]}),e.jsx("input",{type:"checkbox",checked:M.requireApproval,onChange:e=>L({...M,requireApproval:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Allow partial refunds"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Enable partial refund amounts"})]}),e.jsx("input",{type:"checkbox",checked:M.allowPartialRefund,onChange:e=>L({...M,allowPartialRefund:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Auto-process refunds"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Automatically process approved refunds"})]}),e.jsx("input",{type:"checkbox",checked:M.autoProcessRefunds,onChange:e=>L({...M,autoProcessRefunds:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]})]}),M.enableRefunds&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Refund Time Limit"}),e.jsxs("div",{children:[e.jsx(_s,{label:"Refund window (days)",type:"number",value:M.refundTimeLimit.toString(),onChange:e=>L({...M,refundTimeLimit:parseInt(e.target.value)||0}),placeholder:"30",min:"1",max:"365"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Customers can request refunds within ",M.refundTimeLimit," days of payment"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Refund Notifications"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Notify customer on refund"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send notification when refund is processed"})]}),e.jsx("input",{type:"checkbox",checked:M.notifyCustomerOnRefund,onChange:e=>L({...M,notifyCustomerOnRefund:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Dispute & Chargeback Management"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Track payment disputes"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Enable dispute tracking and management"})]}),e.jsx("input",{type:"checkbox",checked:M.trackDisputes,onChange:e=>L({...M,trackDisputes:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})}),M.trackDisputes&&e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(S,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Dispute Management Active"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"All disputed transactions will be tracked. You'll receive notifications for new disputes."})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{onClick:()=>{localStorage.setItem("paymentRefunds",JSON.stringify(M)),re.success("Refund settings saved")},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Refund Settings"]})})]})]}),"reports"===i&&e.jsxs(s,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2 mb-6",children:[e.jsx(he,{className:"w-5 h-5 text-indigo-600"}),"Payment Reports & Analytics"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Default Report Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(ks,{label:"Default Report Period",value:F.defaultPeriod,onChange:e=>q({...F,defaultPeriod:e}),options:[{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"},{value:"quarter",label:"This Quarter"},{value:"year",label:"This Year"},{value:"custom",label:"Custom Range"}]})}),e.jsx("div",{children:e.jsx(ks,{label:"Report Format",value:F.reportFormat,onChange:e=>q({...F,reportFormat:e}),options:[{value:"pdf",label:"PDF"},{value:"excel",label:"Excel (XLSX)"},{value:"csv",label:"CSV"},{value:"json",label:"JSON"}]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Automated Reports"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Enable auto-generated reports"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Automatically generate periodic payment reports"})]}),e.jsx("input",{type:"checkbox",checked:F.autoGenerateReports,onChange:e=>q({...F,autoGenerateReports:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),F.autoGenerateReports&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(ks,{label:"Report Frequency",value:F.reportFrequency,onChange:e=>q({...F,reportFrequency:e}),options:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"}]})}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Email reports automatically"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Send generated reports via email"})]}),e.jsx("input",{type:"checkbox",checked:F.emailReports,onChange:e=>q({...F,emailReports:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),F.emailReports&&e.jsx("div",{children:e.jsx(_s,{label:"Report Recipients (comma separated)",value:F.reportRecipients,onChange:e=>q({...F,reportRecipients:e.target.value}),placeholder:"admin@example.com, finance@example.com"})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Report Content"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Include charts and graphs"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Add visual analytics to reports"})]}),e.jsx("input",{type:"checkbox",checked:F.includeCharts,onChange:e=>q({...F,includeCharts:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-800 font-medium block",children:"Include transaction details"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Add individual transaction breakdown"})]}),e.jsx("input",{type:"checkbox",checked:F.includeTransactionDetails,onChange:e=>q({...F,includeTransactionDetails:e.target.checked}),className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800",children:"Key Metrics to Track"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:["Total Revenue","Transaction Count","Average Transaction Value","Success Rate","Payment Method Breakdown","Refund Rate","Peak Transaction Times","Customer Payment Trends"].map(s=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-3 rounded-lg border border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-800",children:s})]},s))})]}),e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-indigo-50 border border-indigo-200 rounded-lg",children:[e.jsx(he,{className:"w-5 h-5 text-indigo-600"}),e.jsx("p",{className:"text-sm text-indigo-800",children:"Reports will be generated based on your configured settings and can be accessed from the Payment Management page."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{onClick:()=>{localStorage.setItem("paymentReports",JSON.stringify(F)),re.success("Report settings saved")},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Report Settings"]})})]})]})]})},Ms=()=>{const[a,t]=v.useState(!0),[n,l]=v.useState(!1),[i,c]=v.useState(null),[o,x]=v.useState(null),[g,u]=v.useState(!1),h=v.useRef(null),[p,b]=v.useState({businessName:"",businessPhone:"",businessEmail:"",businessWebsite:"",businessAddress:"",businessLogo:null});v.useEffect(()=>{y()},[]);const y=async()=>{try{t(!0);const{data:e,error:s}=await d.from("lats_pos_general_settings").select("id, business_name, business_phone, business_email, business_website, business_address, business_logo").limit(1).single();if(s)throw s;e&&(c(e.id),b({businessName:e.business_name||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessWebsite:e.business_website||"",businessAddress:e.business_address||"",businessLogo:e.business_logo||null}),x(e.business_logo||null))}catch(e){P.error("Failed to load business information")}finally{t(!1)}};return a?e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading business information..."})]})}):e.jsxs(s,{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"w-6 h-6 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Business Information"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure your business details and branding"})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Name"}),e.jsx("input",{type:"text",value:p.businessName,onChange:e=>b({...p,businessName:e.target.value}),placeholder:"My Store",className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Phone"}),e.jsx("input",{type:"tel",value:p.businessPhone,onChange:e=>b({...p,businessPhone:e.target.value}),placeholder:"+255 123 456 789",className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Email"}),e.jsx("input",{type:"email",value:p.businessEmail,onChange:e=>b({...p,businessEmail:e.target.value}),placeholder:"info@mystore.com",className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Website"}),e.jsx("input",{type:"url",value:p.businessWebsite,onChange:e=>b({...p,businessWebsite:e.target.value}),placeholder:"www.mystore.com",className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Address"}),e.jsx("input",{type:"text",value:p.businessAddress,onChange:e=>b({...p,businessAddress:e.target.value}),placeholder:"123 Main Street, City, Country",className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Logo"}),e.jsxs("div",{className:"flex items-start gap-4",children:[o?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 border-2 border-gray-200 rounded-lg overflow-hidden bg-white flex items-center justify-center",children:e.jsx("img",{src:o,alt:"Business Logo",className:"max-w-full max-h-full object-contain"})}),e.jsx("button",{type:"button",onClick:()=>{x(null),b(e=>({...e,businessLogo:null})),h.current&&(h.current.value=""),P.success("Logo removed. Remember to save.")},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",title:"Remove logo",children:e.jsx(be,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50",children:e.jsx(ye,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:h,type:"file",accept:"image/*",onChange:async e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(a)if(a.type.startsWith("image/"))if(a.size>2097152)P.error("Image size should be less than 2MB");else{u(!0);try{const e=new FileReader;e.onloadend=()=>{const s=e.result;x(s),b(e=>({...e,businessLogo:s})),P.success("Logo uploaded! Remember to save.")},e.onerror=()=>{P.error("Failed to read image file")},e.readAsDataURL(a)}catch(t){P.error("Failed to upload logo")}finally{u(!1)}}else P.error("Please upload an image file")},className:"hidden",id:"logo-upload"}),e.jsxs("label",{htmlFor:"logo-upload",className:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer transition-colors "+(g?"opacity-50 cursor-not-allowed":""),children:[e.jsx(ye,{className:"w-4 h-4"}),g?"Uploading...":o?"Change Logo":"Upload Logo"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Upload your business logo. Recommended size: 200x200px. Max size: 2MB. Supported formats: JPG, PNG, GIF, WebP."})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:e.jsx(r,{onClick:async()=>{if(i)try{l(!0);const{error:e}=await d.from("lats_pos_general_settings").update({business_name:p.businessName,business_phone:p.businessPhone,business_email:p.businessEmail,business_website:p.businessWebsite,business_address:p.businessAddress,business_logo:p.businessLogo}).eq("id",i);if(e)throw e;m.clearCache(),window.dispatchEvent(new CustomEvent("settingsUpdated",{detail:{type:"general"}})),P.success("Business information updated successfully - All components will refresh")}catch(e){P.error("Failed to update business information")}finally{l(!1)}else P.error("Settings ID not found")},disabled:n,className:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4"}),"Save Changes"]})})})]})]})},Ls=()=>{const[s,a]=v.useState([]),[t,r]=v.useState(!0),[n,l]=v.useState(!1),[i,c]=v.useState(null),[o,m]=v.useState(!1),x=v.useMemo(()=>({name:"",code:"",address:"",city:"",state:"",zip_code:"",country:"",phone:"",email:"",manager_name:"",is_main:!1,is_active:!0,opening_time:"09:00",closing_time:"18:00",data_isolation_mode:"hybrid",share_products:!1,share_customers:!1,share_inventory:!1,share_suppliers:!1,share_categories:!1,share_employees:!1,allow_stock_transfer:!0,auto_sync_products:!0,auto_sync_prices:!0,require_approval_for_transfers:!1,pricing_model:"centralized",can_view_other_branches:!1,can_transfer_to_branches:[]}),[]);v.useEffect(()=>{g()},[]);const g=async()=>{r(!0);try{const{data:e,error:s}=await d.from("store_locations").select("*").order("is_main",{ascending:!1}).order("name",{ascending:!0});if(s)throw s;a(e||[])}catch(e){P.error("Failed to load stores")}finally{r(!1)}},u=v.useCallback(async e=>{if(e.name&&e.code){l(!0);try{const s={...e};if(Array.isArray(s.can_transfer_to_branches)&&0===s.can_transfer_to_branches.length&&delete s.can_transfer_to_branches,e.id){const{error:a}=await d.from("store_locations").update(s).eq("id",e.id);if(a)throw a;P.success("Store updated successfully")}else{const{data:e,error:a}=await d.from("store_locations").insert([s]);if(a)throw a;P.success("Store created successfully")}c(null),m(!1),await g()}catch(s){P.error(s.message||"Failed to save store")}finally{l(!1)}}else P.error("Store name and code are required")},[]),h=({store:s,onSave:a,onCancel:t})=>{const[r,n]=v.useState(s),[l,i]=v.useState(!1),[c,o]=v.useState(!1),[m,x]=v.useState(null),[g,u]=v.useState([]),[h,p]=v.useState(!0),b=`store-draft-${s.id||"new"}`;v.useEffect(()=>{(async()=>{try{const{data:e,error:s}=await d.from("users").select("id, full_name").eq("is_active",!0).order("full_name",{ascending:!0});if(s)throw s;u(e||[])}catch(e){}finally{p(!1)}})()},[]),v.useEffect(()=>{const e=localStorage.getItem(b);if(e)try{const s=JSON.parse(e);n(s.formData),o(!0),x(new Date(s.savedAt))}catch(a){localStorage.removeItem(b)}else n(s),o(!1),x(null)},[s.id,b]),v.useEffect(()=>{const e=setTimeout(()=>{if(r.name||r.code||r.address){const e={formData:r,savedAt:(new Date).toISOString()};localStorage.setItem(b,JSON.stringify(e)),o(!0),x(new Date)}},800);return()=>clearTimeout(e)},[r,b]);const y=()=>{localStorage.removeItem(b),o(!1),x(null)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.id?"Edit Store":"Add New Store"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Fill in all required fields marked with *"})]})]}),c&&m&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 bg-green-100 text-green-700 text-xs px-3 py-1.5 rounded-full",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),"Auto-saved"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Store Name *"}),e.jsx("input",{type:"text",value:r.name||"",onChange:e=>n({...r,name:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter store name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Store Code *"}),e.jsx("input",{type:"text",value:r.code||"",onChange:e=>n({...r,code:e.target.value.toUpperCase()}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"e.g., STORE-001",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),e.jsx("input",{type:"text",value:r.address||"",onChange:e=>n({...r,address:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Street address",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsx("input",{type:"text",value:r.city||"",onChange:e=>n({...r,city:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"City",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State/Province"}),e.jsx("input",{type:"text",value:r.state||"",onChange:e=>n({...r,state:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ZIP/Postal Code"}),e.jsx("input",{type:"text",value:r.zip_code||"",onChange:e=>n({...r,zip_code:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"ZIP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country *"}),e.jsx("input",{type:"text",value:r.country||"",onChange:e=>n({...r,country:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Country",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",value:r.phone||"",onChange:e=>n({...r,phone:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:r.email||"",onChange:e=>n({...r,email:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Store Manager"}),e.jsxs("select",{value:r.manager_name||"",onChange:e=>n({...r,manager_name:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-colors",disabled:h,children:[e.jsx("option",{value:"",children:"Select a manager"}),g.map(s=>e.jsx("option",{value:s.full_name,children:s.full_name},s.id))]}),h&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Loading users..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Opening Time"}),e.jsx("input",{type:"time",value:r.opening_time||"",onChange:e=>n({...r,opening_time:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Closing Time"}),e.jsx("input",{type:"time",value:r.closing_time||"",onChange:e=>n({...r,closing_time:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Isolation Configuration"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Configure what data this branch shares with other branches. Toggle each feature individually."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{key:"share_products",label:"Products & Catalog",Icon:ve,description:"Share product catalog"},{key:"share_customers",label:"Customers",Icon:je,description:"Share customer database"},{key:"share_inventory",label:"Inventory",Icon:Ne,description:"Share inventory tracking"},{key:"share_suppliers",label:"Suppliers",Icon:we,description:"Share supplier contacts"},{key:"share_categories",label:"Categories",Icon:_e,description:"Share product categories"},{key:"share_employees",label:"Employees",Icon:ke,description:"Share employee lists"}].map(({key:s,label:a,Icon:t,description:l})=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(t,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a}),e.jsx("p",{className:"text-xs text-gray-500",children:l})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[e.jsx("input",{type:"checkbox",checked:r[s],onChange:e=>n({...r,[s]:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]},s))})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer & Synchronization"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Configure stock transfer and synchronization settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Allow Stock Transfers"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enable transferring stock between branches"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.allow_stock_transfer,onChange:e=>n({...r,allow_stock_transfer:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),r.allow_stock_transfer&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Require Approval for Transfers"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Transfers need manager approval"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.require_approval_for_transfers,onChange:e=>n({...r,require_approval_for_transfers:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Auto-Sync Products"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync product catalog changes"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.auto_sync_products,onChange:e=>n({...r,auto_sync_products:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Auto-Sync Prices"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Keep prices synchronized across branches"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.auto_sync_prices,onChange:e=>n({...r,auto_sync_prices:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch Configuration"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Configure branch settings and permissions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Main Store"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This is the primary/headquarters location"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.is_main,onChange:e=>n({...r,is_main:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Store is currently operational"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.is_active,onChange:e=>n({...r,is_active:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pricing Model"}),e.jsxs("select",{value:r.pricing_model,onChange:e=>n({...r,pricing_model:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 transition-colors text-gray-900",children:[e.jsx("option",{value:"centralized",children:"Centralized Pricing (Same prices for all stores)"}),e.jsx("option",{value:"location-specific",children:"Location-Specific Pricing"})]})]}),"location-specific"===r.pricing_model&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Rate Override (%)"}),e.jsx("input",{type:"number",step:"0.01",value:r.tax_rate_override||"",onChange:e=>n({...r,tax_rate_override:parseFloat(e.target.value)}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 transition-colors text-gray-900",placeholder:"Leave empty to use default tax rate"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 mt-6 border-t",children:[e.jsxs("button",{onClick:async()=>{i(!0);try{await a(r),y()}finally{i(!1)}},disabled:l||!r.name||!r.code,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(W,{className:"w-4 h-4"}),l?"Saving...":s.id?"Update Store":"Create Store"]}),e.jsxs("button",{onClick:()=>{y(),t()},disabled:l,className:"flex items-center gap-2 px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(be,{className:"w-4 h-4"}),"Cancel"]})]}),c&&m&&e.jsxs("div",{className:"flex items-center justify-between text-xs bg-green-50 border border-green-200 p-3 rounded-lg mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-700 font-medium",children:"All changes are automatically saved"})]}),e.jsxs("span",{className:"text-green-600",children:["Last saved: ",m.toLocaleTimeString()]})]})]})};return e.jsxs("div",{children:[!o&&!i&&e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Store & Branch Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your store locations and branches"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:[e.jsx(O,{className:"w-4 h-4"}),"Add Store"]})})]})}),(o||i)&&e.jsx(h,{store:i||x,onSave:u,onCancel:()=>{m(!1),c(null)}},(null==i?void 0:i.id)||"new-store"),!o&&!i&&e.jsx("div",{className:"space-y-4",children:t?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading stores..."})]}):0===s.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No stores configured yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Click "Add Store" to create your first location'})]}):s.map(s=>e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-gray-200 hover:border-blue-300 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),s.is_main&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full",children:"Main Store"}),s.is_active?e.jsx(z,{className:"w-5 h-5 text-green-500"}):e.jsx($,{className:"w-5 h-5 text-red-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[s.address,", ",s.city]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.phone||"No phone"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[s.opening_time," - ",s.closing_time]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.manager_name||"No manager assigned"})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded",children:["Code: ",s.code]}),e.jsx("span",{className:"px-2 py-1 text-xs rounded font-medium "+("shared"===s.data_isolation_mode?"bg-blue-100 text-blue-700":"isolated"===s.data_isolation_mode?"bg-red-100 text-red-700":"bg-purple-100 text-purple-700"),children:"shared"===s.data_isolation_mode?"Shared Data":"isolated"===s.data_isolation_mode?"Isolated Data":"Hybrid Model"}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded",children:"centralized"===s.pricing_model?"Centralized Pricing":"Location-Specific Pricing"}),s.allow_stock_transfer&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded",children:"Stock Transfers"}),s.share_inventory&&e.jsx("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded",children:"Shared Inventory"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>c(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})}),!s.is_main&&e.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this store? This action cannot be undone."))try{const{error:s}=await d.from("store_locations").delete().eq("id",e);if(s)throw s;P.success("Store deleted successfully"),g()}catch(s){P.error(s.message||"Failed to delete store")}})(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(E,{className:"w-5 h-5"})})]})]})},s.id))})]})},Fs=v.forwardRef(({type:s="text",placeholder:a,value:t,onChange:r,onBlur:n,onFocus:l,className:i="",disabled:c=!1,required:o=!1,error:d,success:m=!1,loading:x=!1,icon:g,iconPosition:u="left",size:h="md",variant:p="default",fullWidth:b=!1,label:y,helperText:f,showPasswordToggle:j=!1,autoComplete:v,name:w,id:_,...k},C)=>{const[A,P]=N.useState(!1),[I,T]=N.useState(!1),E=d?"border-red-500 focus:border-red-500 focus:ring-red-500/20":m?"border-green-500 focus:border-green-500 focus:ring-green-500/20":"",R=b?"w-full":"",D=c?"opacity-50 cursor-not-allowed":"",M="password"===s&&A?"text":s;return e.jsxs("div",{className:`${b?"w-full":""} ${i}`,children:[y&&e.jsxs("label",{htmlFor:_,className:"block text-sm font-medium text-gray-700 mb-1",children:[y,o&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[g&&"left"===u&&e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g}),"search"===s&&!g&&e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(Ce,{size:16})}),e.jsx("input",{ref:C,type:M,id:_,name:w,value:t,onChange:r,onFocus:e=>{T(!0),null==l||l(e)},onBlur:e=>{T(!1),null==n||n(e)},placeholder:a,disabled:c||x,autoComplete:v,className:`\n            rounded-lg transition-all duration-200 placeholder-gray-400 focus:outline-none\n            ${{sm:"px-3 py-1.5 text-sm",md:"px-4 py-3 text-base",lg:"px-5 py-3 text-lg"}[h]}\n            ${{default:"bg-white border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20",glass:"bg-white/60 backdrop-blur-sm border border-white/20 focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20",outline:"bg-transparent border-2 border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"}[p]}\n            ${E}\n            ${R}\n            ${D}\n            ${g&&"left"===u?"pl-10":""}\n            ${"search"!==s||g?"":"pl-10"}\n            ${g&&"right"===u||j||d||m?"pr-10":""}\n          `,...k}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[x&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),!x&&m&&e.jsx(z,{size:16,className:"text-green-500"}),!x&&d&&e.jsx(S,{size:16,className:"text-red-500"}),!x&&j&&"password"===s&&e.jsx("button",{type:"button",onClick:()=>P(!A),className:"text-gray-400 hover:text-gray-600 transition-colors",children:A?e.jsx(q,{size:16}):e.jsx(B,{size:16})}),!x&&g&&"right"===u&&e.jsx("span",{className:"text-gray-400",children:g})]})]}),(f||d)&&e.jsx("p",{className:"mt-1 text-sm "+(d?"text-red-600":"text-gray-500"),children:d||f})]})});Fs.displayName="EnhancedInput";const Os=()=>{const[a,t]=v.useState([]),[n,l]=v.useState([]),[i,c]=v.useState(!0),[o,m]=v.useState("api-keys"),[x,g]=v.useState(!1),[u,h]=v.useState(!1),[p,b]=v.useState(null),[y,f]=v.useState(null),[j,N]=v.useState(new Set),[w,_]=v.useState({requests_per_minute:60,requests_per_hour:1e3,requests_per_day:1e4,enable_rate_limiting:!0,whitelist_ips:[],blacklist_ips:[]});v.useEffect(()=>{k()},[]);const k=async()=>{c(!0);try{const{data:s,error:a}=await d.from("api_keys").select("*").order("created_at",{ascending:!1});a||t(s||[]);const{data:r,error:n}=await d.from("webhook_endpoints").select("*").order("created_at",{ascending:!1});n||l(r||[]);const{data:i,error:c}=await d.from("settings").select("*").eq("key","api_rate_limits").single();if(!c&&i)try{const e=JSON.parse(i.value);_(e)}catch(e){}}catch(s){P.error("Failed to load API settings")}finally{c(!1)}},C=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="sk_";for(let a=0;a<48;a++)s+=e.charAt(Math.floor(62*Math.random()));return s},S=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="whsec_";for(let a=0;a<32;a++)s+=e.charAt(Math.floor(62*Math.random()));return s};return i?e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Loading API settings..."})]})}):e.jsxs(s,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"API & Webhooks"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage API keys, webhooks, and rate limits"})]})]})}),e.jsxs("div",{className:"flex gap-2 mb-6 border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>m("api-keys"),className:"px-4 py-2 font-medium transition-colors "+("api-keys"===o?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"),children:[e.jsx(Ae,{className:"w-4 h-4 inline mr-2"}),"API Keys"]}),e.jsxs("button",{onClick:()=>m("webhooks"),className:"px-4 py-2 font-medium transition-colors "+("webhooks"===o?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"),children:[e.jsx(Pe,{className:"w-4 h-4 inline mr-2"}),"Webhooks"]}),e.jsxs("button",{onClick:()=>m("rate-limits"),className:"px-4 py-2 font-medium transition-colors "+("rate-limits"===o?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"),children:[e.jsx(Ie,{className:"w-4 h-4 inline mr-2"}),"Rate Limits"]})]}),"api-keys"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"API keys allow external applications to access your system"}),!x&&!p&&e.jsxs(r,{onClick:()=>g(!0),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4"}),"Generate API Key"]})]}),(x||p)&&e.jsx(qs,{apiKey:p||{name:"",key:"",scopes:[],is_active:!0},onSave:async e=>{try{if(e.id){const{error:s}=await d.from("api_keys").update(e).eq("id",e.id);if(s)throw s;P.success("API key updated successfully")}else{const s={...e,key:C()},{error:a}=await d.from("api_keys").insert([s]);if(a)throw a;P.success("API key created successfully")}g(!1),b(null),k()}catch(s){P.error(s.message||"Failed to save API key")}},onCancel:()=>{g(!1),b(null)},availableScopes:[{id:"products:read",label:"Read Products",description:"View product information"},{id:"products:write",label:"Write Products",description:"Create/update products"},{id:"orders:read",label:"Read Orders",description:"View order information"},{id:"orders:write",label:"Write Orders",description:"Create/update orders"},{id:"customers:read",label:"Read Customers",description:"View customer information"},{id:"customers:write",label:"Write Customers",description:"Create/update customers"},{id:"inventory:read",label:"Read Inventory",description:"View inventory levels"},{id:"inventory:write",label:"Write Inventory",description:"Update inventory levels"},{id:"reports:read",label:"Read Reports",description:"Access reports and analytics"}]}),e.jsx("div",{className:"space-y-3",children:0===a.length?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No API keys configured"})]}):a.map(s=>{return e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),s.is_active?e.jsx(z,{className:"w-5 h-5 text-green-500"}):e.jsx(U,{className:"w-5 h-5 text-red-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("code",{className:"text-sm bg-gray-100 px-3 py-1 rounded font-mono",children:j.has(s.id)?s.key:(a=s.key,a.length<=12?a:a.substring(0,10)+"â€¢".repeat(a.length-14)+a.substring(a.length-4))}),e.jsx("button",{onClick:()=>{return e=s.id,void N(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a});var e},className:"p-1 hover:bg-gray-100 rounded",children:j.has(s.id)?e.jsx(q,{className:"w-4 h-4 text-gray-600"}):e.jsx(B,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>{return e=s.key,a="API key",navigator.clipboard.writeText(e),void P.success(`${a} copied to clipboard`);var e,a},className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Te,{className:"w-4 h-4 text-gray-600"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.scopes.map(s=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded",children:s},s))}),s.last_used&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Last used: ",new Date(s.last_used).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this API key?"))try{const{error:s}=await d.from("api_keys").delete().eq("id",e);if(s)throw s;P.success("API key deleted successfully"),k()}catch(s){P.error(s.message||"Failed to delete API key")}})(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(E,{className:"w-5 h-5"})})]})]})},s.id);var a})})]}),"webhooks"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Webhooks notify your application when events happen"}),!u&&!y&&e.jsxs(r,{onClick:()=>h(!0),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4"}),"Add Webhook"]})]}),(u||y)&&e.jsx(Bs,{webhook:y||{name:"",url:"",events:[],is_active:!0,secret:"",retry_attempts:3,timeout_seconds:30,success_count:0,failure_count:0},onSave:async e=>{try{if(e.id){const{error:s}=await d.from("webhook_endpoints").update(e).eq("id",e.id);if(s)throw s;P.success("Webhook updated successfully")}else{const s={...e,secret:S()},{error:a}=await d.from("webhook_endpoints").insert([s]);if(a)throw a;P.success("Webhook created successfully")}h(!1),f(null),k()}catch(s){P.error(s.message||"Failed to save webhook")}},onCancel:()=>{h(!1),f(null)},availableEvents:[{id:"order.created",label:"Order Created"},{id:"order.updated",label:"Order Updated"},{id:"order.cancelled",label:"Order Cancelled"},{id:"product.created",label:"Product Created"},{id:"product.updated",label:"Product Updated"},{id:"customer.created",label:"Customer Created"},{id:"customer.updated",label:"Customer Updated"},{id:"inventory.low",label:"Low Inventory Alert"},{id:"payment.received",label:"Payment Received"},{id:"payment.failed",label:"Payment Failed"}]}),e.jsx("div",{className:"space-y-3",children:0===n.length?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No webhooks configured"})]}):n.map(s=>e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),s.is_active?e.jsx(z,{className:"w-5 h-5 text-green-500"}):e.jsx(U,{className:"w-5 h-5 text-red-500"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.url}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:s.events.map(s=>e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded",children:s},s))}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["âœ… ",s.success_count," successful"]}),e.jsxs("span",{children:["âŒ ",s.failure_count," failed"]}),e.jsxs("span",{children:["â±ï¸ ",s.timeout_seconds,"s timeout"]}),e.jsxs("span",{children:["ðŸ”„ ",s.retry_attempts," retries"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>(async e=>{try{P.loading("Testing webhook...");const s=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json","X-Webhook-Secret":e.secret},body:JSON.stringify({event:"test.webhook",data:{message:"This is a test webhook event"},timestamp:(new Date).toISOString()})});P.dismiss(),s.ok?P.success("Webhook test successful!"):P.error(`Webhook test failed: ${s.statusText}`)}catch(s){P.dismiss(),P.error(`Webhook test failed: ${s.message}`)}})(s),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg",title:"Test Webhook",children:e.jsx(Ie,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>f(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this webhook?"))try{const{error:s}=await d.from("webhook_endpoints").delete().eq("id",e);if(s)throw s;P.success("Webhook deleted successfully"),k()}catch(s){P.error(s.message||"Failed to delete webhook")}})(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(E,{className:"w-5 h-5"})})]})]})},s.id))})]}),"rate-limits"===o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(Ie,{className:"h-5 w-5 text-blue-600 mr-2"}),"Rate Limiting Configuration"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx(Fs,{label:"Requests per Minute",type:"number",value:w.requests_per_minute,onChange:e=>_({...w,requests_per_minute:parseInt(e.target.value)})}),e.jsx(Fs,{label:"Requests per Hour",type:"number",value:w.requests_per_hour,onChange:e=>_({...w,requests_per_hour:parseInt(e.target.value)})}),e.jsx(Fs,{label:"Requests per Day",type:"number",value:w.requests_per_day,onChange:e=>_({...w,requests_per_day:parseInt(e.target.value)})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Enable Rate Limiting"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w.enable_rate_limiting,onChange:e=>_({...w,enable_rate_limiting:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{onClick:async()=>{try{const{error:e}=await d.from("settings").upsert({key:"api_rate_limits",value:JSON.stringify(w)},{onConflict:"key"});if(e)throw e;P.success("Rate limit settings saved successfully")}catch(e){P.error(e.message||"Failed to save rate limit settings")}},className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Rate Limits"]})})]})]})},qs=({apiKey:s,onSave:a,onCancel:t,availableScopes:n})=>{const[l,i]=v.useState(s);return e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-blue-200 space-y-4",children:[e.jsx(Fs,{label:"API Key Name *",value:l.name,onChange:e=>i({...l,name:e.target.value}),placeholder:"e.g., Mobile App API Key",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions (Scopes)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:n.map(s=>e.jsxs("label",{className:"flex items-start p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:l.scopes.includes(s.id),onChange:()=>(e=>{const s=l.scopes.includes(e)?l.scopes.filter(s=>s!==e):[...l.scopes,e];i({...l,scopes:s})})(s.id),className:"mt-1 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:s.label}),e.jsx("div",{className:"text-xs text-gray-600",children:s.description})]})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.is_active,onChange:e=>i({...l,is_active:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(r,{onClick:()=>a(l),disabled:!l.name||0===l.scopes.length,className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),s.id?"Update":"Generate"," API Key"]}),e.jsx(r,{onClick:t,variant:"outline",children:"Cancel"})]})]})},Bs=({webhook:s,onSave:a,onCancel:t,availableEvents:n})=>{const[l,i]=v.useState(s);return e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-purple-200 space-y-4",children:[e.jsx(Fs,{label:"Webhook Name *",value:l.name,onChange:e=>i({...l,name:e.target.value}),placeholder:"e.g., Order Notification Webhook",required:!0}),e.jsx(Fs,{label:"Webhook URL *",value:l.url,onChange:e=>i({...l,url:e.target.value}),placeholder:"https://your-app.com/webhooks/endpoint",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Events to Listen For"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:n.map(s=>e.jsxs("label",{className:"flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:l.events.includes(s.id),onChange:()=>(e=>{const s=l.events.includes(e)?l.events.filter(s=>s!==e):[...l.events,e];i({...l,events:s})})(s.id),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.label})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Fs,{label:"Retry Attempts",type:"number",value:l.retry_attempts,onChange:e=>i({...l,retry_attempts:parseInt(e.target.value)}),min:"0",max:"10"}),e.jsx(Fs,{label:"Timeout (seconds)",type:"number",value:l.timeout_seconds,onChange:e=>i({...l,timeout_seconds:parseInt(e.target.value)}),min:"5",max:"120"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.is_active,onChange:e=>i({...l,is_active:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(r,{onClick:()=>a(l),disabled:!l.name||!l.url||0===l.events.length,className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),s.id?"Update":"Create"," Webhook"]}),e.jsx(r,{onClick:t,variant:"outline",children:"Cancel"})]})]})},Ws=()=>{const[a,t]=v.useState(!0),[n,l]=v.useState(!1),[i,c]=v.useState("points-config"),[o,m]=v.useState({enabled:!0,points_per_currency:1,currency_per_point:.01,min_purchase_for_points:1,points_expiry_days:365,enable_birthday_bonus:!0,birthday_bonus_points:500,enable_referral_bonus:!0,referral_bonus_points:1e3,enable_tiers:!0,tiers:[{name:"Bronze",min_points:0,max_points:999,discount_percentage:5,special_benefits:["Early sale access","Birthday bonus"],color:"#CD7F32",icon:"star"},{name:"Silver",min_points:1e3,max_points:4999,discount_percentage:10,special_benefits:["Early sale access","Birthday bonus","Free shipping"],color:"#C0C0C0",icon:"award"},{name:"Gold",min_points:5e3,max_points:9999,discount_percentage:15,special_benefits:["Early sale access","Birthday bonus","Free shipping","Priority support"],color:"#FFD700",icon:"crown"},{name:"Platinum",min_points:1e4,discount_percentage:20,special_benefits:["Early sale access","Birthday bonus","Free shipping","Priority support","Exclusive events"],color:"#E5E4E2",icon:"sparkles"}],welcome_bonus_points:100,min_redemption_points:100,max_redemption_percent:50}),[x,g]=v.useState(null),[u,h]=v.useState(!1),p=e=>{c(i===e?"":e)};v.useEffect(()=>{b()},[]);const b=async()=>{t(!0);try{const{data:s,error:a}=await d.from("settings").select("*").eq("key","loyalty_program").single();if(a);else if(s)try{const e=JSON.parse(s.value);m(e)}catch(e){}}catch(s){P.error("Failed to load loyalty program settings")}finally{t(!1)}},y=({tier:s,onSave:a,onCancel:t})=>{const[n,l]=v.useState(s);return e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-blue-200 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Fs,{label:"Tier Name *",value:n.name,onChange:e=>l({...n,name:e.target.value}),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tier Color"}),e.jsx("input",{type:"color",value:n.color,onChange:e=>l({...n,color:e.target.value}),className:"w-full h-10 rounded border border-gray-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Fs,{label:"Min Points *",type:"number",value:n.min_points,onChange:e=>l({...n,min_points:parseInt(e.target.value)}),required:!0}),e.jsx(Fs,{label:"Max Points",type:"number",value:n.max_points||"",onChange:e=>l({...n,max_points:e.target.value?parseInt(e.target.value):void 0}),placeholder:"Leave empty for no limit"}),e.jsx(Fs,{label:"Discount % *",type:"number",step:"0.1",value:n.discount_percentage,onChange:e=>l({...n,discount_percentage:parseFloat(e.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Benefits (one per line)"}),e.jsx("textarea",{value:n.special_benefits.join("\n"),onChange:e=>l({...n,special_benefits:e.target.value.split("\n").filter(e=>e.trim())}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,placeholder:"e.g., Free shipping\nPriority support\nExclusive discounts"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(r,{onClick:()=>a(n),disabled:!n.name,className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Tier"]}),e.jsx(r,{onClick:t,variant:"outline",children:"Cancel"})]})]})};return a?e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Loading loyalty program settings..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(s,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Ee,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Loyalty Program"}),e.jsx("p",{className:"text-xs text-gray-600",children:o.enabled?"Customers can earn and redeem points":"Program is currently disabled"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.enabled,onChange:e=>m({...o,enabled:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"})]})]})}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>p("points-config"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Re,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Points Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure how customers earn and redeem points"})]})]}),"points-config"===i?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"points-config"===i&&e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Fs,{label:"Points per Dollar Spent",type:"number",step:"0.1",value:o.points_per_currency,onChange:e=>m({...o,points_per_currency:parseFloat(e.target.value)}),help:"How many points customers earn per dollar spent"}),e.jsx(Fs,{label:"Dollar Value per Point",type:"number",step:"0.01",value:o.currency_per_point,onChange:e=>m({...o,currency_per_point:parseFloat(e.target.value)}),help:"How much each point is worth when redeemed"}),e.jsx(Fs,{label:"Minimum Purchase for Points ($)",type:"number",value:o.min_purchase_for_points,onChange:e=>m({...o,min_purchase_for_points:parseFloat(e.target.value)})}),e.jsx(Fs,{label:"Points Expiry (days)",type:"number",value:o.points_expiry_days,onChange:e=>m({...o,points_expiry_days:parseInt(e.target.value)}),help:"0 = never expire"}),e.jsx(Fs,{label:"Welcome Bonus Points",type:"number",value:o.welcome_bonus_points,onChange:e=>m({...o,welcome_bonus_points:parseInt(e.target.value)}),help:"Points given to new customers"}),e.jsx(Fs,{label:"Minimum Redemption Points",type:"number",value:o.min_redemption_points,onChange:e=>m({...o,min_redemption_points:parseInt(e.target.value)}),help:"Minimum points needed to redeem"}),e.jsx(Fs,{label:"Max Redemption Percentage (%)",type:"number",value:o.max_redemption_percent,onChange:e=>m({...o,max_redemption_percent:parseInt(e.target.value)}),help:"Max % of purchase that can be paid with points"})]})})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>p("bonus-programs"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Ee,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bonus Programs"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure birthday and referral bonuses"})]})]}),"bonus-programs"===i?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"bonus-programs"===i&&e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-pink-600"}),"Birthday Bonus"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Give bonus points on customer's birthday"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.enable_birthday_bonus,onChange:e=>m({...o,enable_birthday_bonus:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600"})]})]}),o.enable_birthday_bonus&&e.jsx(Fs,{label:"Birthday Bonus Points",type:"number",value:o.birthday_bonus_points,onChange:e=>m({...o,birthday_bonus_points:parseInt(e.target.value)})}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-green-600"}),"Referral Bonus"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Give bonus points for referring new customers"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.enable_referral_bonus,onChange:e=>m({...o,enable_referral_bonus:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),o.enable_referral_bonus&&e.jsx(Fs,{label:"Referral Bonus Points",type:"number",value:o.referral_bonus_points,onChange:e=>m({...o,referral_bonus_points:parseInt(e.target.value)})})]})})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>p("loyalty-tiers"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(Fe,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Loyalty Tiers"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create and manage customer loyalty tiers"})]})]}),"loyalty-tiers"===i?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"loyalty-tiers"===i&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.enable_tiers,onChange:e=>m({...o,enable_tiers:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"})]}),o.enable_tiers&&!u&&!x&&e.jsxs(r,{onClick:()=>h(!0),size:"sm",className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Add Tier"]})]})}),o.enable_tiers&&e.jsxs(e.Fragment,{children:[(u||x)&&e.jsx("div",{className:"mb-4",children:e.jsx(y,{tier:x||{name:"",min_points:0,discount_percentage:5,special_benefits:[],color:"#3B82F6",icon:"star"},onSave:e=>{if(x){((e,s)=>{const a=[...o.tiers];a[e]=s,m({...o,tiers:a}),g(null)})(o.tiers.findIndex(e=>e.name===x.name),e)}else(e=>{m({...o,tiers:[...o.tiers,e]}),h(!1)})(e)},onCancel:()=>{h(!1),g(null)}})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.tiers.map((s,a)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2",style:{borderColor:s.color},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:["crown"===s.icon&&e.jsx(Oe,{className:"w-5 h-5",style:{color:s.color}}),"sparkles"===s.icon&&e.jsx(qe,{className:"w-5 h-5",style:{color:s.color}}),"star"===s.icon&&e.jsx(Be,{className:"w-5 h-5",style:{color:s.color}}),"award"===s.icon&&e.jsx(Fe,{className:"w-5 h-5",style:{color:s.color}}),e.jsx("h5",{className:"font-semibold text-gray-900",children:s.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(s),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(We,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>(e=>{if(!confirm("Are you sure you want to delete this tier?"))return;const s=o.tiers.filter((s,a)=>a!==e);m({...o,tiers:s}),P.success("Tier deleted successfully")})(a),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(E,{className:"w-4 h-4 text-red-600"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Points Range:"}),e.jsxs("span",{className:"font-medium",children:[s.min_points," - ",s.max_points||"âˆž"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Discount:"}),e.jsxs("span",{className:"font-medium",children:[s.discount_percentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Benefits:"}),e.jsx("ul",{className:"mt-1 space-y-1",children:s.special_benefits.map((s,a)=>e.jsxs("li",{className:"text-xs text-gray-700 flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full"}),s]},a))})]})]})]},a))})]})]})]}),e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs(r,{onClick:b,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Reset"]}),e.jsxs(r,{onClick:async()=>{l(!0);try{const{error:e}=await d.from("settings").upsert({key:"loyalty_program",value:JSON.stringify(o)},{onConflict:"key"});if(e)throw e;P.success("Loyalty program settings saved successfully")}catch(e){P.error(e.message||"Failed to save settings")}finally{l(!1)}},disabled:n,className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),n?"Saving...":"Save Loyalty Settings"]})]})})]})},zs=()=>{const[a,t]=v.useState([]),[n,l]=v.useState(!0),[i,c]=v.useState(!1),[o,m]=v.useState(null),[x,g]=v.useState(null),[u,h]=v.useState("list"),p=[{value:"invoice",label:"Invoice",icon:ze,description:"Sales invoice template"},{value:"quote",label:"Quote",icon:Ue,description:"Quote/Estimate template"},{value:"purchase_order",label:"Purchase Order",icon:ce,description:"Purchase order template"},{value:"repair_order",label:"Repair Order",icon:ze,description:"Repair service order template"},{value:"receipt",label:"Receipt",icon:Ge,description:"Payment receipt template"}],b=[{var:"{{business_name}}",description:"Business name"},{var:"{{business_address}}",description:"Business address"},{var:"{{business_phone}}",description:"Business phone"},{var:"{{business_email}}",description:"Business email"},{var:"{{customer_name}}",description:"Customer name"},{var:"{{customer_address}}",description:"Customer address"},{var:"{{customer_phone}}",description:"Customer phone"},{var:"{{customer_email}}",description:"Customer email"},{var:"{{document_number}}",description:"Document number"},{var:"{{document_date}}",description:"Document date"},{var:"{{due_date}}",description:"Due date"},{var:"{{items_table}}",description:"Items table"},{var:"{{subtotal}}",description:"Subtotal amount"},{var:"{{tax}}",description:"Tax amount"},{var:"{{discount}}",description:"Discount amount"},{var:"{{total}}",description:"Total amount"},{var:"{{amount_paid}}",description:"Amount paid"},{var:"{{balance_due}}",description:"Balance due"},{var:"{{payment_method}}",description:"Payment method"},{var:"{{notes}}",description:"Additional notes"},{var:"{{terms}}",description:"Terms and conditions"}],y=e=>`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <style>\n    body { font-family: Arial, sans-serif; margin: 20px; }\n    .header { text-align: center; margin-bottom: 30px; }\n    .logo { max-width: 200px; }\n    .business-info { text-align: center; margin-bottom: 20px; }\n    .document-title { font-size: 24px; font-weight: bold; margin: 20px 0; }\n    .customer-info { margin: 20px 0; padding: 15px; background: #f5f5f5; }\n    .items-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n    .items-table th { background: #333; color: white; padding: 10px; text-align: left; }\n    .items-table td { padding: 10px; border-bottom: 1px solid #ddd; }\n    .totals { margin-top: 20px; float: right; width: 300px; }\n    .totals-row { display: flex; justify-content: space-between; padding: 5px 0; }\n    .total-row { font-weight: bold; font-size: 18px; border-top: 2px solid #333; padding-top: 10px; }\n    .footer { margin-top: 50px; text-align: center; color: #666; font-size: 12px; }\n  </style>\n</head>\n<body>\n  <div class="header">\n    {{#if show_logo}}\n    <img src="{{logo_url}}" alt="Logo" class="logo">\n    {{/if}}\n  </div>\n  \n  {{#if show_business_info}}\n  <div class="business-info">\n    <h2>{{business_name}}</h2>\n    <p>{{business_address}}</p>\n    <p>Phone: {{business_phone}} | Email: {{business_email}}</p>\n  </div>\n  {{/if}}\n  \n  <div class="document-title">${e.toUpperCase()}</div>\n  \n  <div style="display: flex; justify-content: space-between;">\n    <div>\n      <strong>${e} Number:</strong> {{document_number}}<br>\n      <strong>Date:</strong> {{document_date}}<br>\n      {{#if due_date}}\n      <strong>Due Date:</strong> {{due_date}}\n      {{/if}}\n    </div>\n    \n    {{#if show_customer_info}}\n    <div class="customer-info">\n      <strong>Bill To:</strong><br>\n      {{customer_name}}<br>\n      {{customer_address}}<br>\n      {{customer_phone}}<br>\n      {{customer_email}}\n    </div>\n    {{/if}}\n  </div>\n  \n  {{items_table}}\n  \n  <div class="totals">\n    <div class="totals-row">\n      <span>Subtotal:</span>\n      <span>{{subtotal}}</span>\n    </div>\n    <div class="totals-row">\n      <span>Tax:</span>\n      <span>{{tax}}</span>\n    </div>\n    <div class="totals-row">\n      <span>Discount:</span>\n      <span>{{discount}}</span>\n    </div>\n    <div class="totals-row total-row">\n      <span>Total:</span>\n      <span>{{total}}</span>\n    </div>\n    {{#if show_payment_info}}\n    <div class="totals-row">\n      <span>Amount Paid:</span>\n      <span>{{amount_paid}}</span>\n    </div>\n    <div class="totals-row">\n      <span>Balance Due:</span>\n      <span>{{balance_due}}</span>\n    </div>\n    {{/if}}\n  </div>\n  \n  <div style="clear: both;"></div>\n  \n  {{#if notes}}\n  <div style="margin-top: 30px;">\n    <strong>Notes:</strong>\n    <p>{{notes}}</p>\n  </div>\n  {{/if}}\n  \n  {{#if show_terms}}\n  <div class="footer">\n    <strong>Terms & Conditions:</strong>\n    <p>{{terms}}</p>\n  </div>\n  {{/if}}\n  \n  {{#if show_signature}}\n  <div style="margin-top: 50px;">\n    <div style="border-top: 1px solid #000; width: 200px; margin: 0 auto;">\n      <p style="text-align: center; margin-top: 5px;">Signature</p>\n    </div>\n  </div>\n  {{/if}}\n</body>\n</html>`;v.useEffect(()=>{f()},[]);const f=async()=>{l(!0);try{const{data:e,error:s}=await d.from("document_templates").select("*").order("type",{ascending:!0});if(s)throw s;t(e||[])}catch(e){P.error("Failed to load document templates")}finally{l(!1)}},j=async()=>{try{const e=p.map(e=>({type:e.value,name:`Default ${e.label}`,content:y(e.value),is_default:!0,variables:b.map(e=>e.var),paper_size:"A4",orientation:"portrait",show_logo:!0,show_business_info:!0,show_customer_info:!0,show_payment_info:!0,show_terms:!0,terms_text:"Payment is due within 30 days. Late payments may incur additional charges.",show_signature:!0})),{error:s}=await d.from("document_templates").insert(e);if(s)throw s;P.success("Default templates created successfully"),f()}catch(e){P.error(e.message||"Failed to create default templates")}},N=e=>{const s=new Blob([e.content],{type:"text/html"}),a=URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download=`${e.name.replace(/\s+/g,"-")}.html`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a),P.success("Template downloaded")},w=({template:s})=>{const[a,t]=v.useState(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Template Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Fs,{label:"Template Name *",value:a.name,onChange:e=>t({...a,name:e.target.value}),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Document Type *"}),e.jsx("select",{value:a.type,onChange:e=>t({...a,type:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:p.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paper Size"}),e.jsxs("select",{value:a.paper_size,onChange:e=>t({...a,paper_size:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"A4",children:"A4"}),e.jsx("option",{value:"Letter",children:"Letter"}),e.jsx("option",{value:"Thermal-80mm",children:"Thermal 80mm"}),e.jsx("option",{value:"Thermal-58mm",children:"Thermal 58mm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Orientation"}),e.jsxs("select",{value:a.orientation,onChange:e=>t({...a,orientation:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"portrait",children:"Portrait"}),e.jsx("option",{value:"landscape",children:"Landscape"})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Display Options"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{key:"show_logo",label:"Show Logo"},{key:"show_business_info",label:"Show Business Info"},{key:"show_customer_info",label:"Show Customer Info"},{key:"show_payment_info",label:"Show Payment Info"},{key:"show_terms",label:"Show Terms & Conditions"},{key:"show_signature",label:"Show Signature Line"}].map(({key:s,label:r})=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a[s],onChange:e=>t({...a,[s]:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]},s))})]}),a.show_logo&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(Ke,{className:"w-5 h-5 text-purple-600 mr-2"}),"Logo Configuration"]}),e.jsx(Fs,{label:"Logo URL",value:a.logo_url||"",onChange:e=>t({...a,logo_url:e.target.value}),placeholder:"https://example.com/logo.png"})]}),a.show_terms&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Terms & Conditions"}),e.jsx("textarea",{value:a.terms_text||"",onChange:e=>t({...a,terms_text:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",rows:4,placeholder:"Enter terms and conditions..."})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-slate-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(Se,{className:"w-5 h-5 text-gray-600 mr-2"}),"HTML Template"]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-blue-800 font-medium mb-2 flex items-center",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Available Variables:"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:b.map(s=>e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.var),P.success(`Copied: ${s.var}`)},className:"text-left p-2 bg-white rounded hover:bg-blue-100 transition-colors",title:s.description,children:e.jsx("code",{className:"text-blue-600",children:s.var})},s.var))})]})}),e.jsx("textarea",{value:a.content,onChange:e=>t({...a,content:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-gray-500 font-mono text-sm",rows:20,placeholder:"Enter HTML template..."})]}),e.jsxs("div",{className:"flex justify-between gap-3 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(r,{onClick:()=>g(a),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Preview"]}),e.jsxs(r,{onClick:()=>N(a),variant:"outline",className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"Download"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(r,{onClick:()=>{h("list"),m(null)},variant:"outline",children:"Cancel"}),e.jsxs(r,{onClick:()=>(async e=>{c(!0);try{if(e.id){const{error:s}=await d.from("document_templates").update(e).eq("id",e.id);if(s)throw s;P.success("Template updated successfully")}else{const{error:s}=await d.from("document_templates").insert([e]);if(s)throw s;P.success("Template created successfully")}f(),h("list"),m(null)}catch(s){P.error(s.message||"Failed to save template")}finally{c(!1)}})(a),disabled:i||!a.name,className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),i?"Saving...":"Save Template"]})]})]})]})};return n?e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Loading document templates..."})]})}):e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Document Templates"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customize invoice, quote, and order templates"})]})]}),"list"===u&&e.jsxs("div",{className:"flex gap-2",children:[0===a.length&&e.jsxs(r,{onClick:j,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(O,{className:"w-4 h-4"}),"Create Default Templates"]}),e.jsxs(r,{onClick:()=>{m({type:"invoice",name:"",content:y("invoice"),is_default:!1,variables:b.map(e=>e.var),paper_size:"A4",orientation:"portrait",show_logo:!0,show_business_info:!0,show_customer_info:!0,show_payment_info:!0,show_terms:!0,show_signature:!0}),h("edit")},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4"}),"New Template"]})]})]}),"list"===u&&e.jsx("div",{className:"space-y-4",children:0===a.length?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(ze,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No document templates configured"}),e.jsx(r,{onClick:j,className:"bg-blue-600 hover:bg-blue-700",children:"Create Default Templates"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.map(s=>{var a;const t=p.find(e=>e.value===s.type),r=(null==t?void 0:t.icon)||ze;return e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:null==t?void 0:t.label})]})]}),s.is_default&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded",children:"Default"})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 mb-3",children:[e.jsxs("p",{children:["Paper: ",s.paper_size," â€¢ ",s.orientation]}),e.jsxs("p",{children:[(null==(a=s.variables)?void 0:a.length)||0," variables configured"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{m(s),h("edit")},className:"flex-1 p-2 text-blue-600 hover:bg-blue-50 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>(async e=>{const s={...e,id:void 0,name:`${e.name} (Copy)`,is_default:!1};try{const{error:e}=await d.from("document_templates").insert([s]);if(e)throw e;P.success("Template duplicated successfully"),f()}catch(a){P.error(a.message||"Failed to duplicate template")}})(s),className:"flex-1 p-2 text-purple-600 hover:bg-purple-50 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Te,{className:"w-4 h-4"}),"Duplicate"]}),e.jsxs("button",{onClick:()=>N(s),className:"flex-1 p-2 text-green-600 hover:bg-green-50 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),"Download"]})]})]},s.id)})})}),"edit"===u&&o&&e.jsx(w,{template:o}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Template Preview"}),e.jsx("button",{onClick:()=>g(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx($s,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("iframe",{srcDoc:x.content,className:"w-full h-[600px] border-2 border-gray-200 rounded-lg",title:"Template Preview"})})]})})]})},$s=({className:s})=>e.jsx("svg",{className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),Us={low_stock_threshold:10,critical_stock_threshold:5,auto_reorder_enabled:!1,reorder_point_percentage:20,minimum_order_quantity:1,maximum_stock_level:1e3,safety_stock_level:5,stock_counting_frequency:"weekly",default_markup_percentage:30,enable_dynamic_pricing:!1,price_rounding_method:"nearest",cost_calculation_method:"average",auto_price_update:!1,enable_bulk_discount:!0,enable_seasonal_pricing:!1,price_history_days:365,low_stock_alerts:!0,out_of_stock_alerts:!0,price_change_alerts:!1,email_notifications:!0,sms_notifications:!1,whatsapp_notifications:!1,expiry_alert_days:30,overstock_alerts:!0,slow_moving_alert_days:90,stock_discrepancy_alerts:!0,enable_barcode_tracking:!0,enable_serial_tracking:!1,enable_batch_tracking:!1,enable_expiry_tracking:!0,enable_location_tracking:!1,enable_sku_auto_generation:!0,barcode_format:"EAN-13",enable_qr_code:!0,enable_branch_isolation:!0,allow_inter_branch_transfer:!0,transfer_approval_required:!1,default_source_branch:"",stock_visibility_mode:"own_branch",auto_stock_sync:!1,sync_frequency:"hourly",require_approval_stock_adjustment:!1,require_approval_price_change:!1,enable_audit_logging:!0,require_manager_pin:!1,approval_threshold_amount:1e4,lock_historical_inventory:!1,max_adjustment_percentage:50,auto_backup_enabled:!0,backup_frequency:"daily",backup_retention_days:90,export_format:"excel",enable_data_archiving:!0,archive_after_months:12,cache_inventory_data:!0,auto_refresh_interval:300,enable_analytics:!0,enable_lazy_loading:!0,pagination_size:50,enable_search_indexing:!0,enable_image_optimization:!0,auto_assign_categories:!1,enable_subcategories:!0,max_category_depth:3,default_category_id:"",enable_tags:!0,enable_product_bundles:!0,enable_product_variants:!0,enable_supplier_tracking:!0,default_lead_time_days:7,preferred_supplier_auto_select:!1,track_supplier_performance:!0,enable_purchase_orders:!0,auto_create_po_at_reorder:!1,stock_valuation_report_frequency:"weekly",enable_inventory_turnover:!0,enable_abc_analysis:!0,dead_stock_threshold_days:180,enable_realtime_reporting:!0,dashboard_refresh_rate:60,enable_pos_integration:!0,enable_ecommerce_sync:!1,enable_accounting_integration:!1,enable_api_access:!0,webhook_stock_changes:"",allow_returns_to_inventory:!0,return_inspection_required:!0,damaged_stock_handling:"separate_bin",adjustment_reason_required:!0,max_return_period_days:30,enable_multiple_uom:!0,default_uom:"piece",enable_uom_conversion:!0,quantity_decimal_places:2},Gs=async()=>{try{const{data:e,error:s}=await d.from("admin_settings").select("setting_key, setting_value, setting_type").eq("category","inventory").eq("is_active",!0);if(s)throw s;if(!e||0===e.length)return Us;const a={...Us};return e.forEach(e=>{const s=e.setting_key,t=e.setting_value,r=e.setting_type;a[s]="boolean"===r?"true"===t||!0===t:"number"===r?parseFloat(t)||0:t}),a}catch(e){return Us}},Ks=async(e,s)=>{try{const s=Object.entries(e).map(async([e,s])=>{const a="boolean"==typeof s||"number"==typeof s?s.toString():String(s),t="boolean"==typeof s?"boolean":"number"==typeof s?"number":"string",{data:r}=await d.from("admin_settings").select("id").eq("category","inventory").eq("setting_key",e).single();if(r){const{error:s}=await d.from("admin_settings").update({setting_value:a,setting_type:t,updated_at:(new Date).toISOString()}).eq("category","inventory").eq("setting_key",e);if(s)throw s}else{const{error:s}=await d.from("admin_settings").insert({category:"inventory",setting_key:e,setting_value:a,setting_type:t,updated_at:(new Date).toISOString()});if(s)throw s}});return await Promise.all(s),!0}catch(a){throw a}},Hs=({label:s,description:a,checked:t,onChange:r,icon:n})=>e.jsxs("div",{className:"flex items-start justify-between p-4 bg-white rounded-lg border border-gray-200 hover:border-indigo-300 transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n,e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s})]}),a&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 ml-6",children:a})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:e=>r(e.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"})]})]}),Js=()=>{const[a,t]=v.useState(null),[n,l]=v.useState(!0),[i,c]=v.useState(!1),[o,d]=v.useState(!1),[m,x]=v.useState(null),[g,u]=v.useState("stock-management");v.useEffect(()=>{h()},[]);const h=async()=>{l(!0);try{const e=await Gs();t(e),d(!1)}catch(e){P.error("Failed to load inventory settings")}finally{l(!1)}},p=(e,s)=>{a&&(t({...a,[e]:s}),d(!0))},b=e=>{u(g===e?"":e)},y=async()=>{if(a){c(!0);try{await Ks(a),d(!1),x(new Date),P.success("Inventory settings saved successfully!")}catch(e){P.error("Failed to save inventory settings")}finally{c(!1)}}};return n?e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading inventory settings..."})]})}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl",children:e.jsx(ce,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Inventory Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure how your inventory system operates across all branches"}),m&&e.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),"Last saved: ",m.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{onClick:async()=>{try{const e=await(async()=>{try{const e=await Gs();return JSON.stringify(e,null,2)}catch(e){throw e}})(),s=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download=`inventory-settings-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a),P.success("Settings exported successfully")}catch(e){P.error("Failed to export settings")}},variant:"outline",className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"Export"]}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs(r,{as:"span",variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Import"]}),e.jsx("input",{type:"file",accept:".json",onChange:async e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(a){try{const e=await a.text();await(async e=>{try{const s=JSON.parse(e);return await Ks(s)}catch(s){throw s}})(e),await h(),P.success("Settings imported successfully")}catch(t){P.error("Failed to import settings")}e.target.value=""}},className:"hidden"})]}),e.jsxs(r,{onClick:async()=>{if(confirm("Are you sure you want to reset all inventory settings to defaults? This action cannot be undone.")){c(!0);try{await(async()=>{try{return await Ks(Us)}catch(e){throw e}})(),await h(),P.success("Inventory settings reset to defaults")}catch(e){P.error("Failed to reset inventory settings")}finally{c(!1)}}},variant:"outline",className:"flex items-center gap-2 text-orange-600 hover:text-orange-700",disabled:i,children:[e.jsx(ue,{className:"w-4 h-4"}),"Reset"]})]})]}),o&&e.jsx("div",{className:"mt-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border-2 border-indigo-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-indigo-900",children:"You have unsaved changes"})]}),e.jsxs(r,{onClick:y,disabled:i,className:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white",children:[e.jsx(W,{className:"w-4 h-4"}),i?"Saving...":"Save All Changes"]})]})})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("stock-management"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ce,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Stock Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Control stock levels and reorder points"})]})]}),"stock-management"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"stock-management"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Fs,{label:"Low Stock Threshold",type:"number",value:a.low_stock_threshold,onChange:e=>p("low_stock_threshold",parseInt(e.target.value)||0),description:"Alert when stock falls below this number"}),e.jsx(Fs,{label:"Critical Stock Threshold",type:"number",value:a.critical_stock_threshold,onChange:e=>p("critical_stock_threshold",parseInt(e.target.value)||0),description:"Critical alert threshold"}),e.jsx(Fs,{label:"Reorder Point %",type:"number",value:a.reorder_point_percentage,onChange:e=>p("reorder_point_percentage",parseInt(e.target.value)||0),description:"Percentage to trigger reorder"}),e.jsx(Fs,{label:"Maximum Stock Level",type:"number",value:a.maximum_stock_level,onChange:e=>p("maximum_stock_level",parseInt(e.target.value)||0),description:"Max stock allowed per item"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock Counting Frequency"}),e.jsxs("select",{value:a.stock_counting_frequency,onChange:e=>p("stock_counting_frequency",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]})]}),e.jsx("div",{className:"mt-4 space-y-3",children:e.jsx(Hs,{label:"Enable Auto Reorder",description:"Automatically create purchase orders when stock is low",checked:a.auto_reorder_enabled,onChange:e=>p("auto_reorder_enabled",e)})})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("pricing-valuation"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(xe,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pricing & Valuation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure pricing rules and cost calculations"})]})]}),"pricing-valuation"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"pricing-valuation"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Fs,{label:"Default Markup %",type:"number",value:a.default_markup_percentage,onChange:e=>p("default_markup_percentage",parseInt(e.target.value)||0),description:"Default markup for new products"}),e.jsx(Fs,{label:"Price History (Days)",type:"number",value:a.price_history_days,onChange:e=>p("price_history_days",parseInt(e.target.value)||0),description:"Days to keep price history"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Rounding"}),e.jsxs("select",{value:a.price_rounding_method,onChange:e=>p("price_rounding_method",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"nearest",children:"Round to Nearest"}),e.jsx("option",{value:"up",children:"Round Up"}),e.jsx("option",{value:"down",children:"Round Down"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Calculation Method"}),e.jsxs("select",{value:a.cost_calculation_method,onChange:e=>p("cost_calculation_method",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"fifo",children:"FIFO (First In, First Out)"}),e.jsx("option",{value:"lifo",children:"LIFO (Last In, First Out)"}),e.jsx("option",{value:"average",children:"Average Cost"})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(Hs,{label:"Enable Dynamic Pricing",description:"Adjust prices based on demand and supply",checked:a.enable_dynamic_pricing,onChange:e=>p("enable_dynamic_pricing",e)}),e.jsx(Hs,{label:"Auto Price Update",description:"Automatically update prices when cost changes",checked:a.auto_price_update,onChange:e=>p("auto_price_update",e)}),e.jsx(Hs,{label:"Enable Bulk Discounts",description:"Allow bulk discount rules",checked:a.enable_bulk_discount,onChange:e=>p("enable_bulk_discount",e)}),e.jsx(Hs,{label:"Enable Seasonal Pricing",description:"Support seasonal price adjustments",checked:a.enable_seasonal_pricing,onChange:e=>p("enable_seasonal_pricing",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("notifications"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ne,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications & Alerts"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure alert preferences and channels"})]})]}),"notifications"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"notifications"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Expiry Alert (Days Before)",type:"number",value:a.expiry_alert_days,onChange:e=>p("expiry_alert_days",parseInt(e.target.value)||0),description:"Alert X days before expiry"}),e.jsx(Fs,{label:"Slow Moving Alert (Days)",type:"number",value:a.slow_moving_alert_days,onChange:e=>p("slow_moving_alert_days",parseInt(e.target.value)||0),description:"Alert if no sales in X days"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Low Stock Alerts",description:"Send alerts when stock is low",checked:a.low_stock_alerts,onChange:e=>p("low_stock_alerts",e)}),e.jsx(Hs,{label:"Out of Stock Alerts",description:"Send alerts when stock is depleted",checked:a.out_of_stock_alerts,onChange:e=>p("out_of_stock_alerts",e)}),e.jsx(Hs,{label:"Price Change Alerts",description:"Notify on price changes",checked:a.price_change_alerts,onChange:e=>p("price_change_alerts",e)}),e.jsx(Hs,{label:"Overstock Alerts",description:"Alert when stock exceeds maximum",checked:a.overstock_alerts,onChange:e=>p("overstock_alerts",e)}),e.jsx(Hs,{label:"Stock Discrepancy Alerts",description:"Alert on inventory count discrepancies",checked:a.stock_discrepancy_alerts,onChange:e=>p("stock_discrepancy_alerts",e)})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Notification Channels"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Email Notifications",description:"Send notifications via email",checked:a.email_notifications,onChange:e=>p("email_notifications",e)}),e.jsx(Hs,{label:"SMS Notifications",description:"Send notifications via SMS",checked:a.sms_notifications,onChange:e=>p("sms_notifications",e)}),e.jsx(Hs,{label:"WhatsApp Notifications",description:"Send notifications via WhatsApp",checked:a.whatsapp_notifications,onChange:e=>p("whatsapp_notifications",e)})]})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("tracking"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(Je,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tracking & Identification"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure product tracking methods"})]})]}),"tracking"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"tracking"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(Fs,{label:"Barcode Format",value:a.barcode_format,onChange:e=>p("barcode_format",e.target.value),description:"Default barcode format",placeholder:"EAN-13, UPC-A, Code-128, QR"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Enable Barcode Tracking",description:"Track products using barcodes",checked:a.enable_barcode_tracking,onChange:e=>p("enable_barcode_tracking",e)}),e.jsx(Hs,{label:"Enable Serial Number Tracking",description:"Track individual items by serial number",checked:a.enable_serial_tracking,onChange:e=>p("enable_serial_tracking",e)}),e.jsx(Hs,{label:"Enable Batch Tracking",description:"Track products by batch/lot number",checked:a.enable_batch_tracking,onChange:e=>p("enable_batch_tracking",e)}),e.jsx(Hs,{label:"Enable Expiry Tracking",description:"Track product expiration dates",checked:a.enable_expiry_tracking,onChange:e=>p("enable_expiry_tracking",e)}),e.jsx(Hs,{label:"Enable Location Tracking",description:"Track items by warehouse location/bin",checked:a.enable_location_tracking,onChange:e=>p("enable_location_tracking",e)}),e.jsx(Hs,{label:"Auto-Generate SKU",description:"Automatically generate SKU codes",checked:a.enable_sku_auto_generation,onChange:e=>p("enable_sku_auto_generation",e)}),e.jsx(Hs,{label:"Enable QR Codes",description:"Support QR code scanning",checked:a.enable_qr_code,onChange:e=>p("enable_qr_code",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("multi-branch"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-cyan-100 rounded-lg",children:e.jsx(pe,{className:"w-6 h-6 text-cyan-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Multi-Branch / Multi-Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure inventory across multiple branches"})]})]}),"multi-branch"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"multi-branch"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock Visibility"}),e.jsxs("select",{value:a.stock_visibility_mode,onChange:e=>p("stock_visibility_mode",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"own_branch",children:"Own Branch Only"}),e.jsx("option",{value:"all_branches",children:"All Branches"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sync Frequency"}),e.jsxs("select",{value:a.sync_frequency,onChange:e=>p("sync_frequency",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"realtime",children:"Real-time"}),e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Enable Branch Isolation",description:"Keep inventory separate per branch",checked:a.enable_branch_isolation,onChange:e=>p("enable_branch_isolation",e)}),e.jsx(Hs,{label:"Allow Inter-Branch Transfers",description:"Enable stock transfers between branches",checked:a.allow_inter_branch_transfer,onChange:e=>p("allow_inter_branch_transfer",e)}),e.jsx(Hs,{label:"Transfer Approval Required",description:"Require approval for branch transfers",checked:a.transfer_approval_required,onChange:e=>p("transfer_approval_required",e)}),e.jsx(Hs,{label:"Auto Stock Sync",description:"Automatically sync stock between branches",checked:a.auto_stock_sync,onChange:e=>p("auto_stock_sync",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("security"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(de,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Security & Approvals"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Control access and approval workflows"})]})]}),"security"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"security"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Approval Threshold Amount",type:"number",value:a.approval_threshold_amount,onChange:e=>p("approval_threshold_amount",parseInt(e.target.value)||0),description:"Amount above which approval is needed"}),e.jsx(Fs,{label:"Max Adjustment %",type:"number",value:a.max_adjustment_percentage,onChange:e=>p("max_adjustment_percentage",parseInt(e.target.value)||0),description:"Maximum allowed adjustment percentage"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Require Approval for Stock Adjustments",description:"Manager must approve stock adjustments",checked:a.require_approval_stock_adjustment,onChange:e=>p("require_approval_stock_adjustment",e)}),e.jsx(Hs,{label:"Require Approval for Price Changes",description:"Manager must approve price changes",checked:a.require_approval_price_change,onChange:e=>p("require_approval_price_change",e)}),e.jsx(Hs,{label:"Enable Audit Logging",description:"Log all inventory changes",checked:a.enable_audit_logging,onChange:e=>p("enable_audit_logging",e)}),e.jsx(Hs,{label:"Require Manager PIN",description:"Require PIN for sensitive operations",checked:a.require_manager_pin,onChange:e=>p("require_manager_pin",e)}),e.jsx(Hs,{label:"Lock Historical Inventory",description:"Prevent backdating inventory changes",checked:a.lock_historical_inventory,onChange:e=>p("lock_historical_inventory",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("performance"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:e.jsx(Re,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance & Analytics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Optimize performance and enable analytics"})]})]}),"performance"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"performance"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Auto Refresh Interval (seconds)",type:"number",value:a.auto_refresh_interval,onChange:e=>p("auto_refresh_interval",parseInt(e.target.value)||0),description:"How often to refresh data"}),e.jsx(Fs,{label:"Pagination Size",type:"number",value:a.pagination_size,onChange:e=>p("pagination_size",parseInt(e.target.value)||0),description:"Items per page"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Cache Inventory Data",description:"Cache data for faster access",checked:a.cache_inventory_data,onChange:e=>p("cache_inventory_data",e)}),e.jsx(Hs,{label:"Enable Analytics",description:"Enable inventory analytics and reports",checked:a.enable_analytics,onChange:e=>p("enable_analytics",e)}),e.jsx(Hs,{label:"Enable Lazy Loading",description:"Load data as needed for large inventories",checked:a.enable_lazy_loading,onChange:e=>p("enable_lazy_loading",e)}),e.jsx(Hs,{label:"Enable Search Indexing",description:"Faster search performance",checked:a.enable_search_indexing,onChange:e=>p("enable_search_indexing",e)}),e.jsx(Hs,{label:"Enable Image Optimization",description:"Compress product images",checked:a.enable_image_optimization,onChange:e=>p("enable_image_optimization",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("backup"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(Ve,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Backup & Data Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure backup and archiving settings"})]})]}),"backup"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"backup"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Backup Retention (Days)",type:"number",value:a.backup_retention_days,onChange:e=>p("backup_retention_days",parseInt(e.target.value)||0),description:"Days to keep backups"}),e.jsx(Fs,{label:"Archive After (Months)",type:"number",value:a.archive_after_months,onChange:e=>p("archive_after_months",parseInt(e.target.value)||0),description:"Archive old data after X months"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Frequency"}),e.jsxs("select",{value:a.backup_frequency,onChange:e=>p("backup_frequency",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),e.jsxs("select",{value:a.export_format,onChange:e=>p("export_format",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"excel",children:"Excel"}),e.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Auto Backup Enabled",description:"Automatically backup inventory data",checked:a.auto_backup_enabled,onChange:e=>p("auto_backup_enabled",e)}),e.jsx(Hs,{label:"Enable Data Archiving",description:"Archive old inventory data",checked:a.enable_data_archiving,onChange:e=>p("enable_data_archiving",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("product-org"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-pink-100 rounded-lg",children:e.jsx(ie,{className:"w-6 h-6 text-pink-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Product Organization"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure product categorization and organization"})]})]}),"product-org"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"product-org"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Max Category Depth",type:"number",value:a.max_category_depth,onChange:e=>p("max_category_depth",parseInt(e.target.value)||0),description:"Maximum category nesting level"}),e.jsx(Fs,{label:"Default Category ID",value:a.default_category_id,onChange:e=>p("default_category_id",e.target.value),description:"Default category for new products",placeholder:"Leave empty for none"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Auto-Assign Categories",description:"Automatically categorize products based on name",checked:a.auto_assign_categories,onChange:e=>p("auto_assign_categories",e)}),e.jsx(Hs,{label:"Enable Subcategories",description:"Allow nested product categories",checked:a.enable_subcategories,onChange:e=>p("enable_subcategories",e)}),e.jsx(Hs,{label:"Enable Tags",description:"Allow product tags and labels",checked:a.enable_tags,onChange:e=>p("enable_tags",e)}),e.jsx(Hs,{label:"Enable Product Bundles",description:"Create product bundles and kits",checked:a.enable_product_bundles,onChange:e=>p("enable_product_bundles",e)}),e.jsx(Hs,{label:"Enable Product Variants",description:"Support size, color, and other variants",checked:a.enable_product_variants,onChange:e=>p("enable_product_variants",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("supplier"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-teal-100 rounded-lg",children:e.jsx(Ye,{className:"w-6 h-6 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Supplier Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure supplier tracking and purchase orders"})]})]}),"supplier"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"supplier"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(Fs,{label:"Default Lead Time (Days)",type:"number",value:a.default_lead_time_days,onChange:e=>p("default_lead_time_days",parseInt(e.target.value)||0),description:"Default supplier lead time in days"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Enable Supplier Tracking",description:"Track suppliers for each product",checked:a.enable_supplier_tracking,onChange:e=>p("enable_supplier_tracking",e)}),e.jsx(Hs,{label:"Preferred Supplier Auto-Select",description:"Automatically select preferred supplier",checked:a.preferred_supplier_auto_select,onChange:e=>p("preferred_supplier_auto_select",e)}),e.jsx(Hs,{label:"Track Supplier Performance",description:"Monitor delivery times and quality",checked:a.track_supplier_performance,onChange:e=>p("track_supplier_performance",e)}),e.jsx(Hs,{label:"Enable Purchase Orders",description:"Create and manage purchase orders",checked:a.enable_purchase_orders,onChange:e=>p("enable_purchase_orders",e)}),e.jsx(Hs,{label:"Auto-Create PO at Reorder",description:"Automatically create PO when stock hits reorder point",checked:a.auto_create_po_at_reorder,onChange:e=>p("auto_create_po_at_reorder",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("reporting"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-violet-100 rounded-lg",children:e.jsx(he,{className:"w-6 h-6 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Reporting & Analytics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure inventory reporting and analysis"})]})]}),"reporting"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"reporting"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Dead Stock Threshold (Days)",type:"number",value:a.dead_stock_threshold_days,onChange:e=>p("dead_stock_threshold_days",parseInt(e.target.value)||0),description:"Days without movement to flag as dead stock"}),e.jsx(Fs,{label:"Dashboard Refresh Rate (Seconds)",type:"number",value:a.dashboard_refresh_rate,onChange:e=>p("dashboard_refresh_rate",parseInt(e.target.value)||0),description:"How often to refresh dashboard"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock Valuation Report Frequency"}),e.jsxs("select",{value:a.stock_valuation_report_frequency,onChange:e=>p("stock_valuation_report_frequency",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Enable Inventory Turnover",description:"Calculate inventory turnover ratio",checked:a.enable_inventory_turnover,onChange:e=>p("enable_inventory_turnover",e)}),e.jsx(Hs,{label:"Enable ABC Analysis",description:"Classify items by value (A/B/C)",checked:a.enable_abc_analysis,onChange:e=>p("enable_abc_analysis",e)}),e.jsx(Hs,{label:"Enable Real-time Reporting",description:"Generate reports in real-time",checked:a.enable_realtime_reporting,onChange:e=>p("enable_realtime_reporting",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("integration"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(Qe,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Integration Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure external integrations and APIs"})]})]}),"integration"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"integration"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(Fs,{label:"Webhook URL for Stock Changes",value:a.webhook_stock_changes,onChange:e=>p("webhook_stock_changes",e.target.value),description:"Webhook endpoint for stock change notifications",placeholder:"https://your-webhook-url.com"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Enable POS Integration",description:"Integrate with POS system",checked:a.enable_pos_integration,onChange:e=>p("enable_pos_integration",e)}),e.jsx(Hs,{label:"Enable E-commerce Sync",description:"Sync with e-commerce platforms",checked:a.enable_ecommerce_sync,onChange:e=>p("enable_ecommerce_sync",e)}),e.jsx(Hs,{label:"Enable Accounting Integration",description:"Integrate with accounting software",checked:a.enable_accounting_integration,onChange:e=>p("enable_accounting_integration",e)}),e.jsx(Hs,{label:"Enable API Access",description:"Allow API access for inventory data",checked:a.enable_api_access,onChange:e=>p("enable_api_access",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("returns"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-rose-100 rounded-lg",children:e.jsx(ue,{className:"w-6 h-6 text-rose-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Returns & Adjustments"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure return and adjustment policies"})]})]}),"returns"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"returns"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Max Return Period (Days)",type:"number",value:a.max_return_period_days,onChange:e=>p("max_return_period_days",parseInt(e.target.value)||0),description:"Maximum days to accept returns"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Damaged Stock Handling"}),e.jsxs("select",{value:a.damaged_stock_handling,onChange:e=>p("damaged_stock_handling",e.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"separate_bin",children:"Move to Separate Bin"}),e.jsx("option",{value:"write_off",children:"Write Off Immediately"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Allow Returns to Inventory",description:"Returned items can be added back to inventory",checked:a.allow_returns_to_inventory,onChange:e=>p("allow_returns_to_inventory",e)}),e.jsx(Hs,{label:"Return Inspection Required",description:"Require inspection before restocking returns",checked:a.return_inspection_required,onChange:e=>p("return_inspection_required",e)}),e.jsx(Hs,{label:"Adjustment Reason Required",description:"Require reason for all stock adjustments",checked:a.adjustment_reason_required,onChange:e=>p("adjustment_reason_required",e)})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>b("units"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(Ze,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Units of Measure"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure units and measurement settings"})]})]}),"units"===g?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"units"===g&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Default Unit of Measure",value:a.default_uom,onChange:e=>p("default_uom",e.target.value),description:"Default UOM for new products",placeholder:"piece, kg, liter, etc."}),e.jsx(Fs,{label:"Quantity Decimal Places",type:"number",value:a.quantity_decimal_places,onChange:e=>p("quantity_decimal_places",parseInt(e.target.value)||0),description:"Decimal precision for quantities"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Hs,{label:"Enable Multiple UOM",description:"Support multiple units of measure per product",checked:a.enable_multiple_uom,onChange:e=>p("enable_multiple_uom",e)}),e.jsx(Hs,{label:"Enable UOM Conversion",description:"Allow conversion between different units",checked:a.enable_uom_conversion,onChange:e=>p("enable_uom_conversion",e)})]})]})]}),o&&e.jsx(s,{className:"p-6 sticky bottom-4 shadow-2xl border-2 border-indigo-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"w-6 h-6 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Unsaved Changes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Don't forget to save your settings"})]})]}),e.jsxs(r,{onClick:y,disabled:i,className:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 text-lg",children:[e.jsx(W,{className:"w-5 h-5"}),i?"Saving...":"Save All Changes"]})]})})]}):e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load inventory settings"}),e.jsx(r,{onClick:h,className:"mt-4",children:"Retry"})]})})},Vs=()=>{var s;const[a,t]=v.useState(null),[r,n]=v.useState(!1),[l,i]=v.useState(x()),[c,o]=v.useState(!1);v.useEffect(()=>{let e;return c&&(e=setInterval(()=>{d()},1e4)),()=>{e&&clearInterval(e)}},[c]);const d=async()=>{const e=g();if(e){n(!0);try{const s=await u(e);t(s),s.summary.failed>0?P.error(`${s.summary.failed} isolation test(s) failed!`):s.summary.warnings>0?P(`Tests passed with ${s.summary.warnings} warning(s)`,{icon:"âš ï¸"}):P.success("All isolation tests passed!")}catch(s){P.error(s.message||"Failed to run tests")}finally{n(!1)}}else P.error("Please select a branch first")},m=s=>s.passed?s.details.includes("âš ï¸")?e.jsx($,{className:"w-5 h-5 text-yellow-500"}):e.jsx(z,{className:"w-5 h-5 text-green-500"}):e.jsx(U,{className:"w-5 h-5 text-red-500"}),b=s=>{switch(s){case"Products":return e.jsx(ce,{className:"w-5 h-5"});case"Customers":return e.jsx(je,{className:"w-5 h-5"});case"Inventory":return e.jsx(Ne,{className:"w-5 h-5"});case"Suppliers":return e.jsx(we,{className:"w-5 h-5"});case"Categories":return e.jsx(_e,{className:"w-5 h-5"});default:return e.jsx(Ve,{className:"w-5 h-5"})}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Xe,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Branch Isolation Debugger"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Test and verify data isolation is working correctly"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{l?(h(),i(!1),P.success("Debug mode disabled")):(p(),i(!0),P.success("Debug mode enabled - Check console for query logs"))},className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+(l?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[l?e.jsx(B,{className:"w-4 h-4"}):e.jsx(q,{className:"w-4 h-4"}),l?"Debug On":"Debug Off"]}),e.jsxs("button",{onClick:()=>o(!c),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+(c?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[e.jsx(I,{className:"w-4 h-4 "+(c?"animate-spin":"")}),"Auto-refresh ",c?"On":"Off"]}),e.jsxs("button",{onClick:d,disabled:r||!g(),className:"flex items-center gap-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r?e.jsx(I,{className:"w-4 h-4 animate-spin"}):e.jsx(es,{className:"w-4 h-4"}),r?"Testing...":"Run Test"]})]})]}),!a&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{className:"w-6 h-6 text-blue-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"How to Use the Debugger"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"1."}),e.jsx("span",{children:"Select a branch from the branch selector in the navigation"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"2."}),e.jsx("span",{children:'Click "Run Test" to check if isolation is working correctly'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"3."}),e.jsx("span",{children:'Enable "Debug Mode" to see detailed query logs in the browser console'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold",children:"4."}),e.jsx("span",{children:'Enable "Auto-refresh" to continuously monitor isolation (updates every 10s)'})]})]})]})]})}),a&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Branch Name"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:a.branchName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Branch ID"}),e.jsx("p",{className:"text-sm font-mono text-gray-700",children:a.branchId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Isolation Mode"}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-semibold "+("shared"===a.isolationMode?"bg-blue-100 text-blue-700":"isolated"===a.isolationMode?"bg-red-100 text-red-700":"bg-purple-100 text-purple-700"),children:[e.jsx(de,{className:"w-4 h-4"}),a.isolationMode.toUpperCase()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Last Tested"}),e.jsx("p",{className:"text-sm text-gray-700",children:new Date(null==(s=a.testResults[0])?void 0:s.timestamp).toLocaleTimeString()})]})]})})}),a&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 mb-1",children:"Tests Passed"}),e.jsx("p",{className:"text-3xl font-bold text-green-700",children:a.summary.passed})]}),e.jsx(z,{className:"w-10 h-10 text-green-500"})]})}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 mb-1",children:"Tests Failed"}),e.jsx("p",{className:"text-3xl font-bold text-red-700",children:a.summary.failed})]}),e.jsx(U,{className:"w-10 h-10 text-red-500"})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-600 mb-1",children:"Warnings"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-700",children:a.summary.warnings})]}),e.jsx($,{className:"w-10 h-10 text-yellow-500"})]})})]}),a&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Branch Configuration"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.entries(a.settings).map(([s,a])=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border-2 "+(a?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"),children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.replace("share_","").charAt(0).toUpperCase()+s.replace("share_","").slice(1)}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+(a?"bg-blue-600 text-white":"bg-gray-300 text-gray-700"),children:a?"SHARED":"ISOLATED"})]},s))})]}),a&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Isolation Test Results"]}),e.jsx("div",{className:"space-y-4",children:a.testResults.map((s,a)=>e.jsxs("div",{className:"border-2 rounded-lg p-4 transition-all "+(s.passed?s.details.includes("âš ï¸")?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[b(s.feature),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:s.feature}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Expected: ",e.jsx("span",{className:"font-semibold",children:s.expected.toUpperCase()})," "," | "," ","Actual: ",e.jsx("span",{className:"font-semibold",children:s.actual.toUpperCase()})]})]})]}),m(s)]}),e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-sm text-gray-700",children:s.details})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Current Branch"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:s.dataCount.currentBranch})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Other Branches"}),e.jsx("p",{className:"text-xl font-bold text-purple-600",children:s.dataCount.otherBranches})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Shared Items"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:s.dataCount.shared})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Visible"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:s.dataCount.total})]})]})]},a))})]}),l&&e.jsx("div",{className:"mt-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(B,{className:"w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-purple-900 mb-1",children:"Debug Mode is Active"}),e.jsx("p",{className:"text-xs text-purple-700",children:"All database queries will be logged to the browser console with detailed isolation information. Open the browser console (F12) to see the logs."})]})]})})]})},Ys=()=>{const{currentBranch:s}=b(),[a,t]=v.useState(!1),[r,n]=v.useState([]),[l,i]=v.useState(!1),[c,o]=v.useState("reassign"),d=async()=>{t(!0),n([]);try{const e=await y();n(e),P.success("Analysis completed!")}catch(e){P.error(`Analysis failed: ${e.message}`)}finally{t(!1)}},m=async e=>{t(!0);try{const s={action:c,dryRun:e,confirmationRequired:!1};await f(s),e?P.success("âœ… Dry run completed! Check console for details."):(P.success("âœ… Cleanup completed successfully!"),setTimeout(()=>d(),1e3)),i(!1)}catch(s){P.error(`Cleanup failed: ${s.message}`)}finally{t(!1)}},x=r.reduce((e,s)=>e+s.otherBranchRecords,0),g=r.reduce((e,s)=>e+s.unassignedRecords,0),u=x>0;return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(E,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Branch Data Cleanup"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Identify and fix branch isolation violations"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:d,disabled:a||!s,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[a?e.jsx(I,{className:"w-4 h-4 animate-spin"}):e.jsx(Ce,{className:"w-4 h-4"}),a?"Analyzing...":"Analyze Data"]}),u&&e.jsxs("button",{onClick:()=>i(!0),disabled:a||!s,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(E,{className:"w-4 h-4"}),"Cleanup Data"]})]})]}),!s&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:"Please select a branch to use this tool."})})]})}),r.length>0&&e.jsxs(e.Fragment,{children:[u&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"âš ï¸ Branch Isolation Violation Detected!"}),e.jsxs("p",{className:"text-sm text-red-700",children:["Your branch is in ISOLATED mode but has ",x," records from other branches. This violates branch isolation rules. Use the cleanup tool to fix this issue."]})]})]})}),g>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-900 mb-1",children:"ðŸ“‹ Unassigned Records Found"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["Found ",g," records without branch assignment. These will be visible in shared/hybrid modes."]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-b-2 border-gray-300",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Table"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Current Branch"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Other Branches"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Unassigned"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:r.map(s=>{const a=s.otherBranchRecords>0;return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-gray-500"}),s.table.replace("lats_","")]})}),e.jsx("td",{className:"p-3 text-sm text-gray-700 text-right",children:s.totalRecords}),e.jsx("td",{className:"p-3 text-sm text-gray-700 text-right",children:s.currentBranchRecords}),e.jsx("td",{className:"p-3 text-sm text-right",children:e.jsx("span",{className:a?"font-bold text-red-600":"text-gray-700",children:s.otherBranchRecords})}),e.jsx("td",{className:"p-3 text-sm text-gray-700 text-right",children:s.unassignedRecords}),e.jsx("td",{className:"p-3 text-center",children:a?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded",children:[e.jsx(U,{className:"w-3 h-3"}),"Violation"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded",children:[e.jsx(z,{className:"w-3 h-3"}),"OK"]})})]},s.table)})})]})}),e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{children:"Note:"})," This tool helps identify and fix branch isolation issues. Records from other branches should not be visible when your branch is in ISOLATED mode."]})})]}),0===r.length&&!a&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx(Ve,{className:"w-12 h-12 text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-blue-800",children:'Click "Analyze Data" to check for branch isolation issues.'})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(E,{className:"w-6 h-6 text-orange-600"}),"Cleanup Branch Data"]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"This will modify database records. Please choose carefully!"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Cleanup Action"}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"cleanup-action",value:"reassign",checked:"reassign"===c,onChange:e=>o(e.target.value),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Reassign to Current Branch (Recommended)"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Move all data from other branches to the current branch. No data will be lost."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 border-red-200 rounded-lg cursor-pointer hover:bg-red-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"cleanup-action",value:"delete",checked:"delete"===c,onChange:e=>o(e.target.value),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"Delete Records (Dangerous!)"}),e.jsx("p",{className:"text-xs text-red-700",children:"Permanently delete all records from other branches. This cannot be undone!"})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"}),' Try "Dry Run" first to preview what will happen without making any actual changes.']})})]}),e.jsxs("div",{className:"p-6 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:()=>m(!0),disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Dry Run"]}),e.jsxs("button",{onClick:()=>m(!1),disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50",children:[a?e.jsx(I,{className:"w-4 h-4 animate-spin"}):e.jsx(ss,{className:"w-4 h-4"}),"Apply Changes"]})]})]})})]})},Qs=()=>{const[s,a]=v.useState(!1),[t,r]=v.useState(0),[n,l]=v.useState(!1),[i,c]=v.useState(""),[o,m]=v.useState(null),x=g(),u=async()=>{if(!x)return;const e=await(async()=>{const e=g();if(!e)return 0;const{count:s}=await d.from("lats_products").select("*",{count:"exact",head:!0}).eq("branch_id",e);return s||0})();r(e)};v.useEffect(()=>{u()},[x]);return x?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(ce,{className:"text-blue-600",size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Branch Products"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage products for this branch"})]})]}),e.jsx("button",{onClick:u,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh count",children:e.jsx(I,{size:18})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Products in Current Branch"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t})]}),t>0&&e.jsxs("button",{onClick:()=>{l(!0),m(null),c("")},disabled:s,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:[e.jsx(E,{size:18}),"Delete All Products in This Branch"]}),0===t&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No products to delete"})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx($,{className:"text-red-600",size:24})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Confirm Deletion"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("p",{className:"text-gray-700",children:["You are about to delete ",e.jsxs("span",{className:"font-bold text-red-600",children:[t," products"]})," from this branch."]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium mb-2",children:"âš ï¸ Warning:"}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"This action cannot be undone"}),e.jsx("li",{children:"All product variants will be deleted"}),e.jsx("li",{children:"Sales history will be preserved (items set to NULL)"}),e.jsx("li",{children:"Purchase order history will be preserved"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Type ",e.jsx("span",{className:"font-bold text-red-600",children:"DELETE ALL PRODUCTS"})," to confirm:"]}),e.jsx("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"DELETE ALL PRODUCTS",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",disabled:s})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{l(!1),c("")},disabled:s,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if("DELETE ALL PRODUCTS"===i){a(!0);try{const e=await(async()=>{try{const e=g();if(!e)throw new Error("No branch selected. Please select a branch first.");const{data:s,error:a}=await d.from("lats_store_locations").select("id, name").eq("id",e).single();if(a||!s)throw new Error("Failed to fetch branch details");const{count:t}=await d.from("lats_products").select("*",{count:"exact",head:!0}).eq("branch_id",e),{count:r}=await d.from("lats_product_variants").select("*",{count:"exact",head:!0}).eq("branch_id",e),{error:n}=await d.from("lats_product_variants").delete().eq("branch_id",e);if(n)throw new Error(`Failed to delete variants: ${n.message}`);const{error:l}=await d.from("lats_products").delete().eq("branch_id",e);if(l)throw new Error(`Failed to delete products: ${l.message}`);return{success:!0,productsDeleted:t||0,variantsDeleted:r||0,branchId:s.id,branchName:s.name}}catch(e){return{success:!1,productsDeleted:0,variantsDeleted:0,branchId:g()||"",branchName:"Unknown",error:e.message||"Unknown error occurred"}}})();m(e),l(!1),c(""),await u(),e.success&&setTimeout(()=>{window.location.reload()},2e3)}catch(e){}finally{a(!1)}}else alert('Please type "DELETE ALL PRODUCTS" to confirm')},disabled:s||"DELETE ALL PRODUCTS"!==i,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:s?"Deleting...":"Delete All Products"})]})]})}),o&&e.jsx("div",{className:"rounded-lg border p-4 "+(o.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:e.jsx("div",{className:"flex items-start gap-3",children:o.success?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl",children:"âœ…"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"Products Deleted Successfully!"}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsxs("p",{children:["â€¢ Branch: ",e.jsx("span",{className:"font-medium",children:o.branchName})]}),e.jsxs("p",{children:["â€¢ Products deleted: ",e.jsx("span",{className:"font-medium",children:o.productsDeleted})]}),e.jsxs("p",{children:["â€¢ Variants deleted: ",e.jsx("span",{className:"font-medium",children:o.variantsDeleted})]})]}),e.jsx("p",{className:"text-sm text-green-700 mt-3",children:"The page will refresh in 2 seconds..."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl",children:"âŒ"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Failed to Delete Products"}),e.jsx("p",{className:"text-sm text-red-800",children:o.error||"An unknown error occurred"})]})]})})})]}):e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"text-yellow-600",size:20}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"Please select a branch first to manage products"})]})})},Zs=()=>{const{currentUser:s}=j(),[a,t]=v.useState(!0),[r,n]=v.useState(!1),[l,i]=v.useState({quickActions:{devices:!0,addDevice:!0,customers:!0,inventory:!0,appointments:!0,purchaseOrders:!0,payments:!0,adGenerator:!0,pos:!0,reports:!0,employees:!0,whatsapp:!0,settings:!0,search:!0,loyalty:!0,backup:!0,sms:!0,bulkSms:!0,smsLogs:!0,smsSettings:!0,excelImport:!0,excelTemplates:!0,productExport:!0,customerImport:!0,userManagement:!0,databaseSetup:!0,integrationSettings:!0,integrationsTest:!0,aiTraining:!0,bluetoothPrinter:!0,categoryManagement:!0,supplierManagement:!0,storeLocations:!0,reminders:!0,mobile:!0,myAttendance:!0},widgets:{revenueTrendChart:!0,deviceStatusChart:!0,appointmentsTrendChart:!0,stockLevelChart:!0,performanceMetricsChart:!0,customerActivityChart:!0,salesFunnelChart:!0,purchaseOrderChart:!0,appointmentWidget:!0,employeeWidget:!0,notificationWidget:!0,financialWidget:!0,analyticsWidget:!0,serviceWidget:!0,reminderWidget:!0,customerInsightsWidget:!0,systemHealthWidget:!0,inventoryWidget:!0,activityFeedWidget:!0,purchaseOrderWidget:!0,chatWidget:!0}});v.useEffect(()=>{c()},[null==s?void 0:s.id]);const c=async()=>{if(null==s?void 0:s.id)try{t(!0);const e=await Cs(s.id);(null==e?void 0:e.dashboard)&&i(e.dashboard)}catch(e){P.error("Failed to load dashboard settings")}finally{t(!1)}},o=e=>{i(s=>({...s,widgets:{...s.widgets,[e]:!s.widgets[e]}}))},d=e=>{i(s=>({...s,quickActions:Object.keys(s.quickActions).reduce((s,a)=>({...s,[a]:e}),{})}))},m=[{key:"devices",label:"Devices",icon:G,description:"Manage devices"},{key:"addDevice",label:"Add Device",icon:O,description:"Add new device"},{key:"customers",label:"Customers",icon:je,description:"View customers"},{key:"inventory",label:"Inventory",icon:ce,description:"Stock & parts"},{key:"appointments",label:"Appointments",icon:Le,description:"Schedule appointments"},{key:"purchaseOrders",label:"Purchase Orders",icon:ve,description:"Manage orders"},{key:"payments",label:"Payments",icon:xe,description:"Payment management"},{key:"adGenerator",label:"Ad Generator",icon:ze,description:"Create product ads"},{key:"pos",label:"POS System",icon:xe,description:"Point of sale"},{key:"reports",label:"Sales Reports",icon:he,description:"View sales reports"},{key:"employees",label:"Employees",icon:je,description:"Manage staff"},{key:"whatsapp",label:"WhatsApp",icon:K,description:"WhatsApp chat"},{key:"settings",label:"Settings",icon:T,description:"System settings"},{key:"search",label:"Search",icon:Ce,description:"Global search"},{key:"loyalty",label:"Loyalty Program",icon:Be,description:"Customer loyalty"},{key:"backup",label:"Backup",icon:Q,description:"Data backup"},{key:"sms",label:"SMS Center",icon:ge,description:"SMS management"},{key:"bulkSms",label:"Bulk SMS",icon:ge,description:"Mass messaging"},{key:"smsLogs",label:"SMS Logs",icon:ge,description:"Message history"},{key:"smsSettings",label:"SMS Settings",icon:T,description:"SMS configuration"},{key:"excelImport",label:"Excel Import",icon:ye,description:"Data import"},{key:"excelTemplates",label:"Excel Templates",icon:$e,description:"Template downloads"},{key:"productExport",label:"Product Export",icon:$e,description:"Export products"},{key:"customerImport",label:"Customer Import",icon:ye,description:"Import customers"},{key:"userManagement",label:"User Management",icon:ns,description:"User administration"},{key:"databaseSetup",label:"Database Setup",icon:Ve,description:"Database configuration"},{key:"integrationSettings",label:"Integration Settings",icon:T,description:"System integrations"},{key:"integrationsTest",label:"Integrations Test",icon:We,description:"Test integrations"},{key:"aiTraining",label:"AI Training",icon:ls,description:"AI training system"},{key:"bluetoothPrinter",label:"Bluetooth Printer",icon:is,description:"Printer management"},{key:"categoryManagement",label:"Category Management",icon:ie,description:"Product categories"},{key:"supplierManagement",label:"Supplier Management",icon:cs,description:"Supplier management"},{key:"storeLocations",label:"Store Locations",icon:A,description:"Location management"},{key:"reminders",label:"Reminders",icon:fe,description:"Reminder system"},{key:"mobile",label:"Mobile",icon:G,description:"Mobile features"},{key:"myAttendance",label:"My Attendance",icon:fe,description:"Personal attendance"}],x=[{key:"revenueTrendChart",label:"Revenue Trend Chart",icon:Re,category:"Charts"},{key:"deviceStatusChart",label:"Device Status Chart",icon:G,category:"Charts"},{key:"appointmentsTrendChart",label:"Appointments Trend Chart",icon:Le,category:"Charts"},{key:"stockLevelChart",label:"Stock Level Chart",icon:ce,category:"Charts"},{key:"performanceMetricsChart",label:"Performance Metrics Chart",icon:Ie,category:"Charts"},{key:"customerActivityChart",label:"Customer Activity Chart",icon:je,category:"Charts"},{key:"salesFunnelChart",label:"Sales Funnel Chart",icon:os,category:"Charts"},{key:"purchaseOrderChart",label:"Purchase Order Chart",icon:ve,category:"Charts"},{key:"salesChart",label:"Sales Chart",icon:xe,category:"Charts"},{key:"paymentMethodsChart",label:"Payment Methods Chart",icon:ds,category:"Charts"},{key:"salesByCategoryChart",label:"Sales by Category Chart",icon:ie,category:"Charts"},{key:"profitMarginChart",label:"Profit Margin Chart",icon:Re,category:"Charts"},{key:"appointmentWidget",label:"Appointment Widget",icon:Le,category:"Widgets"},{key:"employeeWidget",label:"Employee Widget",icon:ms,category:"Widgets"},{key:"notificationWidget",label:"Notification Widget",icon:ne,category:"Widgets"},{key:"financialWidget",label:"Financial Widget",icon:xe,category:"Widgets"},{key:"analyticsWidget",label:"Analytics Widget",icon:he,category:"Widgets"},{key:"serviceWidget",label:"Service Widget",icon:xs,category:"Widgets"},{key:"reminderWidget",label:"Reminder Widget",icon:ne,category:"Widgets"},{key:"customerInsightsWidget",label:"Customer Insights Widget",icon:je,category:"Widgets"},{key:"systemHealthWidget",label:"System Health Widget",icon:Ie,category:"Widgets"},{key:"inventoryWidget",label:"Inventory Widget",icon:ce,category:"Widgets"},{key:"activityFeedWidget",label:"Activity Feed Widget",icon:gs,category:"Widgets"},{key:"purchaseOrderWidget",label:"Purchase Order Widget",icon:ve,category:"Widgets"},{key:"chatWidget",label:"Chat Widget",icon:K,category:"Widgets"},{key:"salesWidget",label:"Sales Widget",icon:xe,category:"Widgets"},{key:"topProductsWidget",label:"Top Products Widget",icon:Re,category:"Widgets"},{key:"expensesWidget",label:"Expenses Widget",icon:ds,category:"Widgets"},{key:"staffPerformanceWidget",label:"Staff Performance Widget",icon:je,category:"Widgets"}];if(a)return e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading dashboard settings..."})]});const g=x.filter(e=>"Charts"===e.category),u=x.filter(e=>"Widgets"===e.category),h=Object.values(l.quickActions).filter(Boolean).length,p=g.filter(e=>l.widgets[e.key]).length,b=u.filter(e=>l.widgets[e.key]).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(as,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Dashboard Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click items to add or remove from your dashboard"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"px-3 py-1.5 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:[h+p+b," items selected"]})})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:async()=>{if(null==s?void 0:s.id)try{n(!0);const e={...await Cs(s.id),dashboard:l};await Ss(s.id,e,"Dashboard")?P.success("Dashboard settings saved successfully"):P.error("Failed to save dashboard settings")}catch(e){P.error("Failed to save dashboard settings")}finally{n(!1)}else P.error("User not authenticated")},disabled:r,className:"flex items-center gap-2 px-5 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 font-medium",children:[e.jsx(W,{size:18}),r?"Saving...":"Save Changes"]}),e.jsxs("button",{onClick:()=>{i({quickActions:{devices:!0,addDevice:!0,customers:!0,inventory:!0,appointments:!0,purchaseOrders:!0,payments:!0,adGenerator:!0,pos:!0,reports:!0,employees:!0,whatsapp:!0,settings:!0,search:!0,loyalty:!0,backup:!0,sms:!0,bulkSms:!0,smsLogs:!0,smsSettings:!0,excelImport:!0,excelTemplates:!0,productExport:!0,customerImport:!0,userManagement:!0,databaseSetup:!0,integrationSettings:!0,integrationsTest:!0,aiTraining:!0,bluetoothPrinter:!0,categoryManagement:!0,supplierManagement:!0,storeLocations:!0,reminders:!0,mobile:!0,myAttendance:!0},widgets:{revenueTrendChart:!0,deviceStatusChart:!0,appointmentsTrendChart:!0,stockLevelChart:!0,performanceMetricsChart:!0,customerActivityChart:!0,salesFunnelChart:!0,purchaseOrderChart:!0,appointmentWidget:!0,employeeWidget:!0,notificationWidget:!0,financialWidget:!0,analyticsWidget:!0,serviceWidget:!0,customerInsightsWidget:!0,systemHealthWidget:!0,inventoryWidget:!0,activityFeedWidget:!0,purchaseOrderWidget:!0,chatWidget:!0,salesWidget:!0,topProductsWidget:!0,expensesWidget:!0,staffPerformanceWidget:!0,salesChart:!0,paymentMethodsChart:!0,salesByCategoryChart:!0,profitMarginChart:!0}}),P.success("Dashboard settings reset to default")},className:"flex items-center gap-2 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:[e.jsx(ue,{size:18}),"Reset to Default"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Actions"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"font-semibold text-blue-600",children:[h," of 39"]})," selected"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors font-medium",children:[e.jsx(ts,{size:16}),"Add All"]}),e.jsxs("button",{onClick:()=>d(!1),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors font-medium",children:[e.jsx(U,{size:16}),"Remove All"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:m.map(s=>{const a=s.icon,t=l.quickActions[s.key];return e.jsxs("button",{onClick:()=>{return e=s.key,void i(s=>({...s,quickActions:{...s.quickActions,[e]:!s.quickActions[e]}}));var e},className:"group p-4 rounded-xl border-2 transition-all text-left relative overflow-hidden "+(t?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-blue-50 shadow-sm hover:shadow-md":"border-gray-200 bg-white hover:border-indigo-300 hover:bg-indigo-50/30"),children:[e.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 rounded-full text-xs font-medium "+(t?"bg-green-500 text-white":"bg-gray-300 text-gray-600"),children:t?"Added":"Click to Add"}),e.jsx("div",{className:"flex items-start gap-3 mb-2 mt-2",children:e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center transition-all "+(t?"bg-indigo-600 shadow-lg shadow-indigo-200":"bg-gray-300 group-hover:bg-indigo-400"),children:e.jsx(a,{className:"w-5 h-5 text-white"})})}),e.jsx("h4",{className:"font-semibold text-sm mb-1 "+(t?"text-indigo-900":"text-gray-700"),children:s.label}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:s.description}),e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-xs font-medium transition-opacity "+(t?"text-red-600 opacity-0 group-hover:opacity-100":"text-indigo-600 opacity-0 group-hover:opacity-100"),children:[e.jsx(rs,{size:12}),t?"Click to remove":"Click to add"]})]},s.key)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(he,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Dashboard Charts"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"font-semibold text-purple-600",children:[p," of 7"]})," selected"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{g.forEach(e=>{i(s=>({...s,widgets:{...s.widgets,[e.key]:!0}}))})},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors font-medium",children:[e.jsx(ts,{size:16}),"Add All"]}),e.jsxs("button",{onClick:()=>{g.forEach(e=>{i(s=>({...s,widgets:{...s.widgets,[e.key]:!1}}))})},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors font-medium",children:[e.jsx(U,{size:16}),"Remove All"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map(s=>{const a=s.icon,t=l.widgets[s.key];return e.jsxs("button",{onClick:()=>o(s.key),className:"group p-4 rounded-xl border-2 transition-all text-left relative overflow-hidden "+(t?"border-purple-500 bg-gradient-to-br from-purple-50 to-pink-50 shadow-sm hover:shadow-md":"border-gray-200 bg-white hover:border-purple-300 hover:bg-purple-50/30"),children:[e.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 rounded-full text-xs font-medium "+(t?"bg-green-500 text-white":"bg-gray-300 text-gray-600"),children:t?"Added":"Click to Add"}),e.jsx("div",{className:"flex items-start gap-3 mb-2 mt-2",children:e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center transition-all "+(t?"bg-purple-600 shadow-lg shadow-purple-200":"bg-gray-300 group-hover:bg-purple-400"),children:e.jsx(a,{className:"w-5 h-5 text-white"})})}),e.jsx("h4",{className:"font-semibold text-sm mb-1 "+(t?"text-purple-900":"text-gray-700"),children:s.label}),e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-xs font-medium transition-opacity "+(t?"text-red-600 opacity-0 group-hover:opacity-100":"text-purple-600 opacity-0 group-hover:opacity-100"),children:[e.jsx(rs,{size:12}),t?"Click to remove":"Click to add"]})]},s.key)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Dashboard Widgets"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"font-semibold text-green-600",children:[b," of 10"]})," selected"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{u.forEach(e=>{i(s=>({...s,widgets:{...s.widgets,[e.key]:!0}}))})},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors font-medium",children:[e.jsx(ts,{size:16}),"Add All"]}),e.jsxs("button",{onClick:()=>{u.forEach(e=>{i(s=>({...s,widgets:{...s.widgets,[e.key]:!1}}))})},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors font-medium",children:[e.jsx(U,{size:16}),"Remove All"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(s=>{const a=s.icon,t=l.widgets[s.key];return e.jsxs("button",{onClick:()=>o(s.key),className:"group p-4 rounded-xl border-2 transition-all text-left relative overflow-hidden "+(t?"border-green-500 bg-gradient-to-br from-green-50 to-emerald-50 shadow-sm hover:shadow-md":"border-gray-200 bg-white hover:border-green-300 hover:bg-green-50/30"),children:[e.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 rounded-full text-xs font-medium "+(t?"bg-green-500 text-white":"bg-gray-300 text-gray-600"),children:t?"Added":"Click to Add"}),e.jsx("div",{className:"flex items-start gap-3 mb-2 mt-2",children:e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center transition-all "+(t?"bg-green-600 shadow-lg shadow-green-200":"bg-gray-300 group-hover:bg-green-400"),children:e.jsx(a,{className:"w-5 h-5 text-white"})})}),e.jsx("h4",{className:"font-semibold text-sm mb-1 "+(t?"text-green-900":"text-gray-700"),children:s.label}),e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-xs font-medium transition-opacity "+(t?"text-red-600 opacity-0 group-hover:opacity-100":"text-green-600 opacity-0 group-hover:opacity-100"),children:[e.jsx(rs,{size:12}),t?"Click to remove":"Click to add"]})]},s.key)})})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-5",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx(S,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2 text-base",children:"ðŸ’¡ How to Use"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:"â†’"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Click any card"})," to add it to your dashboard (green badge = added)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:"â†’"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Click again"})," to remove it from your dashboard"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:"â†’"}),e.jsxs("span",{children:["Use ",e.jsx("strong",{children:'"Add All"'})," or ",e.jsx("strong",{children:'"Remove All"'})," buttons for quick selection"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:"â†’"}),e.jsxs("span",{children:["Don't forget to click ",e.jsx("strong",{children:'"Save Changes"'})," when done!"]})]})]})]})]})})]})},Xs=[{name:"Sales & Transactions",description:"Sales records, POS transactions, and related data",tables:["lats_sales","lats_sale_items","lats_receipts","account_transactions","payment_transactions","mobile_money_transactions","customer_payments","installment_payments","gift_card_transactions","points_transactions"]},{name:"Customers",description:"Customer profiles, communications, and activity",tables:["lats_customers","customer_notes","customer_messages","customer_communications","customer_checkins","customer_preferences","customer_revenue","customer_special_orders","customer_installment_plans","customer_installment_plan_payments","customer_points_history","whatsapp_customers","contact_history","contact_methods","contact_preferences","buyer_details"]},{name:"Inventory & Products",description:"Products, stock movements, and inventory tracking",tables:["lats_products","lats_product_variants","lats_inventory_items","inventory_items","lats_stock_movements","lats_inventory_adjustments","product_images","product_interests","imei_validation","serial_number_movements","lats_product_validation"]},{name:"Purchase Orders & Suppliers",description:"Purchase orders, supplier data, and receiving records",tables:["lats_purchase_orders","lats_purchase_order_items","lats_purchase_order_payments","lats_purchase_order_audit_log","purchase_order_audit","purchase_order_messages","purchase_order_payments","purchase_order_quality_checks","purchase_order_quality_check_items","lats_suppliers","suppliers"]},{name:"Devices & Repairs",description:"Device repair tracking, diagnostics, and service records",tables:["devices","device_attachments","device_checklists","device_ratings","device_remarks","device_transitions","diagnostic_requests","diagnostic_devices","diagnostic_checks","diagnostic_checklist_results","diagnostic_problem_templates","diagnostic_templates","repair_parts","quality_checks","quality_check_items","quality_check_results","quality_check_criteria","quality_check_templates"]},{name:"Trade-Ins",description:"Trade-in transactions and assessments",tables:["lats_trade_in_transactions","lats_trade_in_contracts","lats_trade_in_damage_assessments","lats_trade_in_prices","lats_trade_in_settings"]},{name:"Employees & Attendance",description:"Employee records, shifts, and attendance tracking",tables:["employees","lats_employees","employees_backup_migration","employee_shifts","attendance_records","shift_templates","leave_requests","user_daily_goals","user_branch_assignments"]},{name:"Communications",description:"SMS, email, WhatsApp, and notification logs",tables:["sms_logs","sms_triggers","sms_trigger_logs","email_logs","chat_messages","communication_log","communication_templates","notifications","notification_templates","whatsapp_message_templates","whatsapp_templates","whatsapp_instances_comprehensive"]},{name:"Finance & Expenses",description:"Expense tracking, accounts, and financial records",tables:["expenses","finance_expenses","expense_categories","finance_expense_categories","finance_accounts","finance_transfers","recurring_expenses","recurring_expense_history"]},{name:"Shipping & Logistics",description:"Shipping records and cargo tracking",tables:["lats_shipping","lats_shipping_cargo_items"]},{name:"Branches & Transfers",description:"Branch transfers and stock movement between locations",tables:["branch_transfers","branch_activity_log","scheduled_transfers","scheduled_transfer_executions"]},{name:"Spare Parts",description:"Spare parts inventory and usage tracking",tables:["lats_spare_parts","lats_spare_part_variants","lats_spare_part_usage"]},{name:"System & Audit Logs",description:"System logs, audit trails, and API logs",tables:["audit_logs","api_request_logs","webhook_logs","admin_settings_log","auto_reorder_log"]},{name:"Sales & Marketing",description:"Sales pipeline, appointments, and customer engagement",tables:["sales_pipeline","appointments","reminders","special_order_payments"]},{name:"Returns & Gift Cards",description:"Product returns and gift card management",tables:["returns","gift_cards"]},{name:"Backup Tables",description:"System backup and migration tables",tables:["customer_fix_backup"]}],ea=()=>{const[a,t]=v.useState(!1),[n,l]=v.useState(!1),[i,c]=v.useState(!1),[o,m]=v.useState([]),[x,g]=v.useState(""),[u,h]=v.useState("all"),[p,b]=v.useState(""),[y,f]=v.useState(!1),[j,N]=v.useState(!1),[w,_]=v.useState(new Set),k=async()=>{l(!0),t(!0);try{re.loading("Scanning database...",{id:"scan"});const{data:e,error:s}=await d.from("information_schema.tables").select("table_name").eq("table_schema","public").order("table_name");if(s)throw new Error("Failed to fetch database schema");const a=((null==e?void 0:e.map(e=>e.table_name))||[]).map(async e=>{try{const{count:s,error:a}=await d.from(e).select("*",{count:"exact",head:!0});return a?{table_name:e,row_count:0,checked:!1,category:C(e)}:{table_name:e,row_count:s||0,checked:!1,category:C(e)}}catch(s){return{table_name:e,row_count:0,checked:!1,category:C(e)}}}),t=await Promise.all(a);m(t.sort((e,s)=>s.row_count-e.row_count)),re.success(`Scanned ${t.length} tables`,{id:"scan"})}catch(e){re.error(e.message||"Failed to scan database",{id:"scan"})}finally{l(!1),t(!1)}},C=e=>{for(const s of Xs)if(s.tables.includes(e))return s.name;return"Other"},S=o.filter(e=>{const s=e.table_name.toLowerCase().includes(x.toLowerCase()),a="all"===u||e.category===u;return s&&a}),A=Xs.map(e=>({...e,tables:S.filter(s=>e.tables.includes(s.table_name)),totalRows:S.filter(s=>e.tables.includes(s.table_name)).reduce((e,s)=>e+s.row_count,0)})).filter(e=>e.tables.length>0),P=S.filter(e=>"Other"===e.category);P.length>0&&A.push({name:"Other",description:"Uncategorized tables",tables:P,totalRows:P.reduce((e,s)=>e+s.row_count,0)});const T=o.filter(e=>e.checked),R=o.reduce((e,s)=>e+s.row_count,0),D=T.reduce((e,s)=>e+s.row_count,0);return v.useEffect(()=>{k()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Database Data Cleanup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select tables to remove data from"})]})]}),e.jsxs(r,{onClick:k,disabled:n,variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 "+(n?"animate-spin":"")}),n?"Scanning...":"Refresh Scan"]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-900 mb-1",children:"âš ï¸ Warning: Irreversible Action"}),e.jsx("p",{className:"text-sm text-red-700",children:"This action will permanently delete data from the selected tables. This cannot be undone. Please ensure you have a backup before proceeding."})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(He,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"â„¹ï¸ Foreign Key Constraints"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Some tables have relationships with other tables. If deletion fails due to foreign key constraints, you need to delete dependent (child) tables first, or use SQL with CASCADE option."}),e.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:[e.jsx("strong",{children:"Example:"})," Delete ",e.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"purchase_order_payments"})," before",e.jsx("code",{className:"bg-blue-100 px-1 rounded ml-1",children:"finance_accounts"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Total Tables"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:o.length})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-purple-600 font-medium mb-1",children:"Total Rows"}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:R.toLocaleString()})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium mb-1",children:"Selected Tables"}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:T.length})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium mb-1",children:"Rows to Delete"}),e.jsx("div",{className:"text-2xl font-bold text-red-900",children:D.toLocaleString()})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ce,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{type:"text",placeholder:"Search tables...",value:x,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>{const e=!j;N(e),m(s=>s.map(s=>({...s,checked:e})))},className:"px-4 py-2 rounded-lg font-medium transition-colors "+(j?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:j?"Deselect All":"Select All"})})]}),a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"w-8 h-8 text-indigo-600 animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Loading database tables..."})]}):0===A.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ve,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No tables found"})]}):e.jsx("div",{className:"space-y-4",children:A.map(s=>{const a=w.has(s.name),t=s.tables,r=t.every(e=>e.checked),n=t.some(e=>e.checked)&&!r;return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:()=>{return e=s.name,void _(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a});var e},className:"p-1 hover:bg-gray-200 rounded",children:a?e.jsx(Me,{className:"w-5 h-5 text-gray-600"}):e.jsx(us,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("button",{onClick:()=>(e=>{const s=Xs.find(s=>s.name===e);if(!s)return;const a=o.filter(e=>s.tables.includes(e.table_name)).every(e=>e.checked);m(e=>e.map(e=>s.tables.includes(e.table_name)?{...e,checked:!a}:e))})(s.name),className:"w-5 h-5 rounded border-2 flex items-center justify-center transition-colors "+(r?"bg-indigo-600 border-indigo-600":n?"bg-indigo-200 border-indigo-600":"border-gray-300 hover:border-indigo-600"),children:[r&&e.jsx(ae,{className:"w-4 h-4 text-white"}),n&&e.jsx(hs,{className:"w-4 h-4 text-indigo-600"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.length," table",1!==t.length?"s":""]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[s.totalRows.toLocaleString()," rows"]})]})})]}),a&&e.jsx("div",{className:"divide-y divide-gray-200",children:t.map(s=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50 transition-colors "+(s.checked?"bg-indigo-50":""),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:()=>{return e=s.table_name,void m(s=>s.map(s=>s.table_name===e?{...s,checked:!s.checked}:s));var e},className:"w-5 h-5 rounded border-2 flex items-center justify-center transition-colors "+(s.checked?"bg-indigo-600 border-indigo-600":"border-gray-300 hover:border-indigo-600"),children:s.checked&&e.jsx(ae,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-mono text-sm text-gray-900",children:s.table_name})})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.row_count.toLocaleString()," rows"]})})})]},s.table_name))})]},s.name)})}),T.length>0&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs(r,{onClick:()=>f(!0),disabled:i,variant:"danger",className:"w-full flex items-center justify-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Delete Data from ",T.length," Selected Table",1!==T.length?"s":"","(",D.toLocaleString()," rows)"]})})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Data Deletion"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-red-900 mb-2",children:"You are about to permanently delete data from:"}),e.jsx("ul",{className:"text-sm text-red-800 space-y-1 max-h-40 overflow-y-auto",children:T.map(s=>e.jsxs("li",{className:"font-mono",children:["â€¢ ",s.table_name," (",s.row_count.toLocaleString()," rows)"]},s.table_name))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-red-200",children:e.jsxs("p",{className:"text-sm font-semibold text-red-900",children:["Total: ",D.toLocaleString()," rows will be deleted"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Type ",e.jsx("span",{className:"font-bold text-red-600",children:"DELETE"})," to confirm:"]}),e.jsx("input",{type:"text",value:p,onChange:e=>b(e.target.value),placeholder:"DELETE",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{f(!1),b("")},className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",disabled:i,children:"Cancel"}),e.jsx("button",{onClick:async()=>{const e=o.filter(e=>e.checked);if(0===e.length)return void re.error("No tables selected");if("DELETE"!==p)return void re.error("Please type DELETE to confirm");c(!0);const s=[];try{re.loading(`Deleting data from ${e.length} tables...`,{id:"delete"});for(const l of e)try{const{count:e}=await d.from(l.table_name).select("*",{count:"exact",head:!0}),{error:a}=await d.from(l.table_name).delete().neq("id","00000000-0000-0000-0000-000000000000");if(a){let e=a.message;a.message.includes("foreign key constraint")&&(e="Cannot delete: Referenced by other tables. Delete dependent tables first or use SQL with CASCADE."),s.push({table:l.table_name,success:!1,error:e})}else s.push({table:l.table_name,success:!0,deletedRows:e||0})}catch(a){let e=a.message||"Unknown error";e.includes("foreign key constraint")&&(e="Cannot delete: Referenced by other tables. Delete dependent tables first."),s.push({table:l.table_name,success:!1,error:e})}const t=s.filter(e=>e.success).length,r=s.filter(e=>!e.success).length,n=s.filter(e=>e.success).reduce((e,s)=>e+(s.deletedRows||0),0);t>0&&re.success(`Successfully deleted ${n.toLocaleString()} rows from ${t} table(s)`,{id:"delete",duration:5e3}),r>0&&re.error(`Failed to delete data from ${r} table(s)`,{id:"delete-error",duration:5e3}),await k(),b(""),f(!1),m(e=>e.map(e=>({...e,checked:!1}))),N(!1)}catch(t){re.error(t.message||"Failed to delete data",{id:"delete"})}finally{c(!1)}},disabled:"DELETE"!==p||i,className:"flex-1 px-4 py-2 rounded-lg font-medium text-white transition-colors "+("DELETE"!==p||i?"bg-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-700"),children:i?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):"Delete Data"})]})]})})]})},sa={}.VITE_API_URL||"http://localhost:8000",aa=()=>{const[a,t]=v.useState([]),[r,n]=v.useState(""),[l,i]=v.useState(""),[c,o]=v.useState(!1),[d,m]=v.useState(!1),[x,g]=v.useState([]),[u,h]=v.useState(null),[p,b]=v.useState("both"),[y,f]=v.useState(""),[j,N]=v.useState(""),[w,_]=v.useState(""),[k,C]=v.useState(!1),[S,A]=v.useState(!0),[T,E]=v.useState(""),[R,D]=v.useState(""),[M,L]=v.useState("Development"),[F,O]=v.useState("Production");v.useEffect(()=>{const e=localStorage.getItem("neon_api_key"),s=localStorage.getItem("neon_project_id"),a=localStorage.getItem("source_connection_string"),t=localStorage.getItem("target_connection_string"),r=localStorage.getItem("source_branch_name"),n=localStorage.getItem("target_branch_name"),l=localStorage.getItem("use_direct_connection");e&&N(e),s&&_(s),a&&E(a),t&&D(t),r&&L(r),n&&O(n),null!==l&&A("true"===l)},[]);const q=async()=>{var e;if(!j||!w)return P.error("Please configure Neon API credentials first"),void C(!0);o(!0);try{const s=await fetch(`${sa}/api/neon/branches?projectId=${w}`,{headers:{Authorization:`Bearer ${j}`}});if(!s.ok)throw new Error("Failed to load branches");const a=await s.json();t(a.branches||[]),P.success(`Loaded ${(null==(e=a.branches)?void 0:e.length)||0} branches`)}catch(s){P.error("Failed to load branches. Check your API credentials.")}finally{o(!1)}},B=()=>{const e=x.every(e=>e.selected);g(x.map(s=>({...s,selected:!e})))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ps,{className:"w-5 h-5 text-indigo-600"}),"Database Branch Migration"]}),e.jsxs("button",{onClick:()=>C(!k),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Configure Neon API"]})]}),k&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Branch Configuration"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:S,onChange:()=>A(!0),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Direct Connection Strings (Recommended)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:!S,onChange:()=>A(!1),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Neon API"})]})]}),S?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Quick Setup:"})," Paste your PostgreSQL connection strings from Neon Console â†’ Branches â†’ Connection Details"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source Branch Name (e.g., Development)"}),e.jsx("input",{type:"text",value:M,onChange:e=>L(e.target.value),placeholder:"Development",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source Connection String"}),e.jsx("textarea",{value:T,onChange:e=>E(e.target.value),placeholder:"postgresql://user:password@ep-dev-branch.neon.tech/neondb?sslmode=require",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Get from Neon Console â†’ Your Project â†’ Branches â†’ Dev Branch â†’ Connection String"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Branch Name (e.g., Production)"}),e.jsx("input",{type:"text",value:F,onChange:e=>O(e.target.value),placeholder:"Production",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Connection String"}),e.jsx("textarea",{value:R,onChange:e=>D(e.target.value),placeholder:"postgresql://user:password@ep-main-branch.neon.tech/neondb?sslmode=require",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Get from Neon Console â†’ Your Project â†’ Branches â†’ Main Branch â†’ Connection String"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Neon Project ID"}),e.jsx("input",{type:"text",value:w,onChange:e=>_(e.target.value),placeholder:"e.g., ep-young-firefly-123456",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Find this in your Neon console URL or project settings"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Neon API Key"}),e.jsx("input",{type:"password",value:j,onChange:e=>N(e.target.value),placeholder:"Enter your Neon API key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Generate an API key in your Neon account settings"})]})]}),e.jsx("button",{onClick:()=>{S?(localStorage.setItem("source_connection_string",T),localStorage.setItem("target_connection_string",R),localStorage.setItem("source_branch_name",M),localStorage.setItem("target_branch_name",F),localStorage.setItem("use_direct_connection","true"),P.success("Connection strings saved successfully"),C(!1)):(localStorage.setItem("neon_api_key",j),localStorage.setItem("neon_project_id",w),localStorage.setItem("use_direct_connection","false"),P.success("Neon API configuration saved"),C(!1),q())},disabled:S?!T||!R:!j||!w,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save Configuration"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg flex gap-3",children:[e.jsx(He,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"How it works:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:S?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"Configure your source and target connection strings above"}),e.jsx("li",{children:'Click "Load Tables" to see available tables'}),e.jsx("li",{children:"Choose which tables to migrate"}),e.jsx("li",{children:"Select migration type (schema, data, or both)"}),e.jsx("li",{children:"Review and execute the migration"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"Select source branch (your development branch)"}),e.jsx("li",{children:"Select target branch (your production/main branch)"}),e.jsx("li",{children:"Choose which tables to migrate"}),e.jsx("li",{children:"Select migration type (schema, data, or both)"}),e.jsx("li",{children:"Review and execute the migration"})]})})]})]}),S?e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source Branch"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-md",children:[e.jsx(Ve,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:M||"Not configured"}),T&&e.jsx(z,{className:"w-4 h-4 text-green-600 ml-auto"})]}),T&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1 font-mono truncate",children:[T.substring(0,50),"..."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Branch"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-md",children:[e.jsx(Ve,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:F||"Not configured"}),R&&e.jsx(z,{className:"w-4 h-4 text-green-600 ml-auto"})]}),R&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1 font-mono truncate",children:[R.substring(0,50),"..."]})]})]})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Source Branch (From)"}),e.jsxs("select",{value:r,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",disabled:c,children:[e.jsx("option",{value:"",children:"Select source branch..."}),a.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.database_name,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Branch (To)"}),e.jsxs("select",{value:l,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",disabled:c,children:[e.jsx("option",{value:"",children:"Select target branch..."}),a.filter(e=>e.id!==r).map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.database_name,")"]},s.id))]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[!S&&e.jsxs("button",{onClick:q,disabled:c,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 "+(c?"animate-spin":"")}),c?"Loading...":"Load Branches"]}),e.jsxs("button",{onClick:async()=>{if(S){if(!T)return void P.error("Please enter source connection string")}else if(!r)return void P.error("Please select a source branch");o(!0);try{const e=S?{connectionString:T,useDirectConnection:!0}:{branchId:r,apiKey:j,projectId:w,useDirectConnection:!1},s=await fetch(`${sa}/api/neon/tables`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to load tables");const a=await s.json();g(a.tables.map(e=>({...e,selected:!0}))),P.success(`Loaded ${a.tables.length} tables`)}catch(e){P.error("Failed to load tables from source branch")}finally{o(!1)}},disabled:c||(S?!T:!r),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Load Tables"]}),e.jsxs("button",{onClick:async()=>{if(S){if(!T||!R)return void P.error("Please enter both source and target connection strings")}else if(!r||!l)return void P.error("Please select both source and target branches");o(!0);try{const e=S?{sourceConnectionString:T,targetConnectionString:R,useDirectConnection:!0}:{sourceBranchId:r,targetBranchId:l,apiKey:j,projectId:w,useDirectConnection:!1},s=await fetch(`${sa}/api/neon/compare-schemas`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to compare schemas");const a=await s.json();h(a.diff),P.success("Schema comparison complete")}catch(e){P.error("Failed to compare schemas")}finally{o(!1)}},disabled:c||(S?!T||!R:!r||!l),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4"}),"Compare Schemas"]})]}),x.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Migration Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"schema",checked:"schema"===p,onChange:e=>b(e.target.value),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Schema Only"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"data",checked:"data"===p,onChange:e=>b(e.target.value),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Data Only"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"both",checked:"both"===p,onChange:e=>b(e.target.value),className:"text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Schema + Data"})]})]})]}),u&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Schema Differences"}),u.tables_only_in_source.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-sm font-medium text-green-700 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"New Tables in Source (",u.tables_only_in_source.length,")"]}),e.jsx("ul",{className:"ml-6 mt-1 text-sm text-gray-600 list-disc",children:u.tables_only_in_source.map(s=>e.jsx("li",{children:s},s))})]}),u.tables_only_in_target.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-sm font-medium text-orange-700 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Tables Only in Target (",u.tables_only_in_target.length,")"]}),e.jsx("ul",{className:"ml-6 mt-1 text-sm text-gray-600 list-disc",children:u.tables_only_in_target.map(s=>e.jsx("li",{children:s},s))})]}),Object.keys(u.columns_diff).length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-blue-700 flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Column Differences"]}),Object.entries(u.columns_diff).map(([s,a])=>e.jsxs("div",{className:"ml-6 mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:s}),a.only_in_source.length>0&&e.jsxs("p",{className:"text-xs text-green-600 ml-4",children:["New columns: ",a.only_in_source.join(", ")]}),a.type_changes.length>0&&e.jsxs("p",{className:"text-xs text-orange-600 ml-4",children:["Type changes: ",a.type_changes.map(e=>`${e.column} (${e.source_type} â†’ ${e.target_type})`).join(", ")]})]},s))]})]}),x.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Select Tables to Migrate (",x.filter(e=>e.selected).length,"/",x.length,")"]}),e.jsx("button",{onClick:B,className:"text-sm text-indigo-600 hover:text-indigo-700",children:x.every(e=>e.selected)?"Deselect All":"Select All"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:e.jsx("input",{type:"checkbox",checked:x.every(e=>e.selected),onChange:B,className:"rounded text-indigo-600"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Table Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rows"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Size"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 "+(s.selected?"bg-indigo-50":""),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:s.selected,onChange:()=>{return e=s.table_name,void g(x.map(s=>s.table_name===e?{...s,selected:!s.selected}:s));var e},className:"rounded text-indigo-600"})}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:s.table_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:s.row_count.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:s.size})]},s.table_name))})]})})]}),d&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(I,{className:"w-5 h-5 text-indigo-600 animate-spin"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Migration in Progress"})]}),e.jsx("p",{className:"text-sm text-gray-700 ml-8",children:y})]}),x.length>0&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[x.filter(e=>e.selected).length," table(s) selected for migration"]}),e.jsxs("button",{onClick:async()=>{var e,s,t;if(S){if(!T||!R)return void P.error("Please enter both source and target connection strings")}else if(!r||!l)return void P.error("Please select both source and target branches");const n=x.filter(e=>e.selected).map(e=>e.table_name);if(0===n.length)return void P.error("Please select at least one table to migrate");const i=S?M:null==(e=a.find(e=>e.id===r))?void 0:e.name,c=S?F:null==(s=a.find(e=>e.id===l))?void 0:s.name;if(window.confirm(`Are you sure you want to migrate ${n.length} table(s) from ${i} to ${c}?\n\nThis will:\n- ${"schema"===p||"both"===p?"Update schema structure":""}\n- ${"data"===p||"both"===p?"Copy data records":""}\n\nThis action cannot be undone.`)){m(!0),f("Starting migration...");try{const e=S?{sourceConnectionString:T,targetConnectionString:R,tables:n,migrationType:p,useDirectConnection:!0}:{sourceBranchId:r,targetBranchId:l,tables:n,migrationType:p,apiKey:j,projectId:w,useDirectConnection:!1},s=await fetch(`${sa}/api/neon/migrate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const e=await s.json();throw new Error(e.message||"Migration failed")}const a=null==(t=s.body)?void 0:t.getReader(),i=new TextDecoder;if(a)for(;;){const{done:e,value:s}=await a.read();if(e)break;const t=i.decode(s).split("\n").filter(e=>e.trim());for(const a of t)if(a.startsWith("data: ")){const e=JSON.parse(a.slice(6));f(e.message),e.error&&P.error(e.message)}}P.success("Migration completed successfully!"),f("Migration completed!")}catch(o){P.error(o.message||"Migration failed"),f(`Error: ${o.message}`)}finally{m(!1)}}},disabled:d||0===x.filter(e=>e.selected).length||(S?!R:!l),className:"px-6 py-3 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 flex items-center gap-2 font-medium",children:[e.jsx(ye,{className:"w-5 h-5"}),"Start Migration"]})]})]}),e.jsxs(s,{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-50",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-blue-600"}),"Important Notes"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â€¢"}),e.jsx("span",{children:"Always test migrations on a copy of your data first"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â€¢"}),e.jsx("span",{children:"Large tables may take several minutes to migrate"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â€¢"}),e.jsx("span",{children:"Schema migration will create tables and columns if they don't exist"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â€¢"}),e.jsx("span",{children:"Data migration will INSERT new records (won't update existing ones)"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â€¢"}),e.jsx("span",{children:"Get your Neon API key from: console.neon.tech â†’ Account Settings â†’ API Keys"})]})]})]})]})},ta=()=>{const{currentUser:a}=j(),[t]=w(),[n,l]=v.useState("branding"),[i,c]=v.useState(!1),[o,m]=v.useState(!1),[x,g]=v.useState({branding:{appLogo:"",companyName:"Repair Shop Management",primaryColor:"#3B82F6",secondaryColor:"#1E40AF",logoSize:"medium",logoPosition:"left"},database:{url:"https://jxhzveborezjhsmzsgbc.supabase.co",projectId:"jxhzveborezjhsmzsgbc",region:"us-east-1",status:"online",lastSync:(new Date).toISOString(),connectionPool:10,maxConnections:100,activeConnections:5},integrations:{sms:{provider:"Mobishastra",status:"active",balance:1e3,lastUsed:(new Date).toISOString()},email:{provider:"Supabase Auth",status:"active",dailyLimit:1e3,usedToday:45},whatsapp:{provider:"Green API",status:"inactive",connected:!1,lastMessage:""},ai:{provider:"Google Gemini",status:"active",model:"gemini-pro",apiKeyConfigured:!0}},performance:{cacheEnabled:!0,cacheSize:512,compressionEnabled:!0,cdnEnabled:!1,loadBalancing:!1},automation:{autoBackup:!0,autoCleanup:!0,autoScaling:!1,autoUpdates:!1},attendance:{enabled:!0,allowEmployeeChoice:!0,availableSecurityModes:["auto-location","manual-location","wifi-only"],defaultSecurityMode:"auto-location",requireLocation:!0,requireWifi:!0,requirePhoto:!0,allowMobileData:!0,gpsAccuracy:50,checkInRadius:100,checkInTime:"08:00",checkOutTime:"17:00",gracePeriod:15,offices:[{name:"Arusha Main Office",lat:-3.359178,lng:36.661366,radius:100,address:"Main Office, Arusha, Tanzania",networks:[{ssid:"Office_WiFi",bssid:"00:11:22:33:44:55",description:"Main office WiFi network"},{ssid:"Office_Guest",description:"Guest WiFi network"},{ssid:"4G_Mobile",description:"Mobile data connection"}]}]},performanceMonitoring:{realTimeMetrics:!0,alertThresholds:{cpuUsage:80,memoryUsage:80,diskUsage:80,responseTime:2e3,errorRate:.5,activeConnections:100},autoScaling:{enabled:!1,minInstances:1,maxInstances:10,scaleUpThreshold:90,scaleDownThreshold:70},resourceLimits:{maxCpu:100,maxMemory:100,maxDisk:100,maxBandwidth:100,maxRequestsPerMinute:1e3},monitoringIntervals:{metricsCollection:60,alertCheck:60,healthCheck:60},performanceAlerts:{emailNotifications:!0,slackNotifications:!0,smsNotifications:!0,alertCooldown:15}}});v.useEffect(()=>{u();const e=t.get("section");e&&l(e)},[t]);const u=async()=>{c(!0);try{const{data:e,error:s}=await d.from("settings").select("key, value");if(s)return void P.error("Failed to load system settings");const a={};null==e||e.forEach(e=>{try{a[e.key]=JSON.parse(e.value)}catch{a[e.key]=e.value}});const t=await _();g(e=>({...e,...a,attendance:t})),P.success("System settings loaded successfully")}catch(e){P.error("Failed to load system settings")}finally{c(!1)}},h=async(e,s)=>{m(!0);try{if("attendance"===e)await k(s),g(e=>({...e,attendance:s}));else{const{error:a}=await d.from("settings").upsert(Object.entries(s).map(([s,a])=>({key:`${e}_${s}`,value:JSON.stringify(a)})),{onConflict:"key"});if(a)return void P.error("Failed to save settings")}P.success("Settings saved successfully")}catch(a){P.error("Failed to save settings")}finally{m(!1)}},p=e=>{switch(e){case"online":case"active":return"text-green-500";case"offline":case"inactive":return"text-gray-500";case"error":return"text-red-500";default:return"text-yellow-500"}},b=s=>{switch(s){case"online":case"active":return e.jsx(z,{className:"w-4 h-4 text-green-500"});case"offline":case"inactive":return e.jsx(S,{className:"w-4 h-4 text-gray-500"});case"error":return e.jsx($,{className:"w-4 h-4 text-red-500"});default:return e.jsx(He,{className:"w-4 h-4 text-yellow-500"})}};return a&&"admin"===a.role?e.jsx("div",{className:"min-h-screen p-4",style:{backgroundColor:"transparent"},children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(T,{className:"w-8 h-8 text-indigo-600"}),"Admin Settings"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage system configuration, backend settings, and database connections"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{onClick:()=>window.location.href="/integration-testing",className:"flex items-center gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(D,{className:"w-4 h-4"}),"Test Integrations"]}),e.jsxs(r,{onClick:u,disabled:i,className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 "+(i?"animate-spin":"")}),"Refresh"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(s,{className:"p-4 sticky top-4 max-h-[calc(100vh-120px)]",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Settings Categories"}),e.jsx("nav",{className:"space-y-2 overflow-y-auto max-h-[calc(100vh-200px)] pr-2 sidebar-scrollbar",children:[{id:"branding",label:"Business Information",icon:pe},{id:"dashboard",label:"Dashboard",icon:as},{id:"stores",label:"Store Management",icon:A},{id:"branch-debug",label:"Branch Isolation Debug",icon:Xe},{id:"inventory",label:"Inventory",icon:ce},{id:"payments",label:"Payments",icon:J},{id:"attendance",label:"Attendance",icon:je},{id:"loyalty",label:"Loyalty Program",icon:Be},{id:"integrations",label:"Integrations",icon:R},{id:"api-webhooks",label:"API & Webhooks",icon:Se},{id:"documents",label:"Document Templates",icon:ze},{id:"appearance",label:"Appearance",icon:Z},{id:"notifications",label:"Notifications",icon:ne},{id:"database",label:"Database",icon:Ve},{id:"branch-migration",label:"Branch Migration",icon:ps},{id:"automation",label:"Automation",icon:ue}].map(s=>e.jsxs("button",{onClick:()=>l(s.id),className:"w-full flex items-center gap-3 p-3 rounded-lg transition-colors "+(n===s.id?"bg-indigo-100 text-indigo-700":"text-gray-800 hover:bg-gray-100"),children:[e.jsx(s.icon,{className:"w-5 h-5"}),s.label]},s.id))})]})}),e.jsxs("div",{className:"lg:col-span-3",children:["branding"===n&&e.jsx(Ms,{}),"dashboard"===n&&e.jsx(Zs,{}),"stores"===n&&e.jsx(Ls,{}),"branch-debug"===n&&e.jsxs(e.Fragment,{children:[e.jsx(Vs,{}),e.jsx(Ys,{}),e.jsx("div",{className:"mt-6",children:e.jsx(Qs,{})})]}),"inventory"===n&&e.jsx(Js,{}),"appearance"===n&&e.jsx(Es,{isActive:!0}),"notifications"===n&&e.jsx(Rs,{isActive:!0}),"payments"===n&&e.jsx(Ds,{isActive:!0}),"loyalty"===n&&e.jsx(Ws,{}),"api-webhooks"===n&&e.jsx(Os,{}),"documents"===n&&e.jsx(zs,{}),"database"===n&&e.jsx(na,{}),"integrations"===n&&e.jsx(Ts,{}),"attendance"===n&&e.jsx(ra,{settings:x.attendance,onSave:e=>h("attendance",e),getStatusIcon:b,getStatusColor:p}),"branch-migration"===n&&e.jsx(aa,{}),"automation"===n&&e.jsx(la,{settings:x.automation,onSave:e=>h("automation",e),getStatusIcon:b,getStatusColor:p})]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"transparent"},children:e.jsxs(s,{className:"p-8 text-center",children:[e.jsx($,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You need admin privileges to access this page."})]})})},ra=({settings:a,onSave:t,getStatusIcon:n,getStatusColor:l})=>{var i;const[c,o]=v.useState(a),[d,m]=v.useState(!1),[x,g]=v.useState("general");v.useEffect(()=>{o(a)},[a]);const[u,h]=v.useState(null),[p,b]=v.useState(null),[y,f]=v.useState({name:"",lat:"",lng:"",radius:"100",address:"",networks:[{ssid:"",description:""}]}),[j,N]=v.useState([]),w=e=>{g(x===e?"":e)},_=(e,s,a)=>{const t=[...c.offices];t[e]={...t[e],[s]:a},o({...c,offices:t})},k=(e,s,a,t)=>{const r=[...c.offices];r[e].networks[s]={...r[e].networks[s],[a]:t},o({...c,offices:r})};return e.jsxs("div",{className:"space-y-6",children:[j.length>0&&e.jsx("div",{className:"mb-6 bg-red-50 border-2 border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-red-900",children:"Validation Errors"}),e.jsx("button",{onClick:()=>N([]),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Dismiss"})]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-red-800",children:j.map((s,a)=>e.jsx("li",{children:s},a))})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>w("general"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(T,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"General Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure basic attendance options"})]})]}),"general"===x?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"general"===x&&e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Enable Attendance"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c.enabled,onChange:e=>o({...c,enabled:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Require Photo Verification"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c.requirePhoto,onChange:e=>o({...c,requirePhoto:e.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 via-blue-50 to-purple-50 rounded-xl p-6 border-2 border-indigo-200 shadow-md",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(de,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Security Mode Configuration"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Control how employees verify their attendance"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx("button",{onClick:()=>o({...c,allowEmployeeChoice:!0}),className:"p-4 rounded-xl border-2 transition-all text-left "+(c.allowEmployeeChoice?"border-green-500 bg-gradient-to-br from-green-50 to-emerald-50 shadow-lg scale-105":"border-gray-200 bg-white hover:border-green-300 hover:shadow-md"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg "+(c.allowEmployeeChoice?"bg-green-500":"bg-gray-300"),children:e.jsx(je,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"Employee Choice"}),c.allowEmployeeChoice&&e.jsx(z,{className:"w-5 h-5 text-green-600"})]}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:"Let employees pick their preferred security method from your approved list. Flexible & convenient!"})]})]})}),e.jsx("button",{onClick:()=>o({...c,allowEmployeeChoice:!1}),className:"p-4 rounded-xl border-2 transition-all text-left "+(c.allowEmployeeChoice?"border-gray-200 bg-white hover:border-orange-300 hover:shadow-md":"border-orange-500 bg-gradient-to-br from-orange-50 to-amber-50 shadow-lg scale-105"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg "+(c.allowEmployeeChoice?"bg-gray-300":"bg-orange-500"),children:e.jsx(ys,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"Enforced Mode"}),!c.allowEmployeeChoice&&e.jsx(z,{className:"w-5 h-5 text-orange-600"})]}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:"Require all employees to use one specific security method. Consistent & simple!"})]})]})})]}),c.allowEmployeeChoice&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fs,{className:"w-5 h-5 text-blue-600"}),e.jsx("label",{className:"text-sm font-bold text-gray-900",children:"Select Available Security Modes"}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(null==(i=c.availableSecurityModes)?void 0:i.length)||0," selected"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[{value:"auto-location",icon:We,label:"Auto-Location",desc:"GPS auto-detection with fallback",color:"blue",iconColor:"text-blue-600",badge:"Recommended"},{value:"manual-location",icon:A,label:"Manual Location",desc:"Select office + GPS verify",color:"indigo",iconColor:"text-indigo-600",badge:null},{value:"wifi-only",icon:js,label:"WiFi Only",desc:"Network verification only",color:"purple",iconColor:"text-purple-600",badge:null},{value:"location-and-wifi",icon:ys,label:"Location + WiFi",desc:"Both GPS and network",color:"orange",iconColor:"text-orange-600",badge:"High Security"},{value:"photo-only",icon:bs,label:"Photo Only",desc:"Photo verification only",color:"pink",iconColor:"text-pink-600",badge:"Least Secure"},{value:"all-security",icon:de,label:"Maximum Security",desc:"GPS + WiFi + Photo",color:"red",iconColor:"text-red-600",badge:"Max Security"}].map(s=>{var a;const t=(null==(a=c.availableSecurityModes)?void 0:a.includes(s.value))||!1;return e.jsxs("label",{className:"relative p-4 rounded-xl border-2 cursor-pointer transition-all "+(t?`${{blue:"border-blue-500 bg-gradient-to-br from-blue-50 to-blue-100",indigo:"border-indigo-500 bg-gradient-to-br from-indigo-50 to-indigo-100",purple:"border-purple-500 bg-gradient-to-br from-purple-50 to-purple-100",orange:"border-orange-500 bg-gradient-to-br from-orange-50 to-orange-100",pink:"border-pink-500 bg-gradient-to-br from-pink-50 to-pink-100",red:"border-red-500 bg-gradient-to-br from-red-50 to-red-100"}[s.color]} shadow-md`:"border-gray-200 bg-white hover:border-gray-300 hover:shadow-sm"),children:[e.jsx("input",{type:"checkbox",checked:t,onChange:e=>{const a=c.availableSecurityModes||[];e.target.checked?o({...c,availableSecurityModes:[...a,s.value]}):o({...c,availableSecurityModes:a.filter(e=>e!==s.value)})},className:"sr-only"}),s.badge&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-bold "+("Recommended"===s.badge?"bg-green-500 text-white":"High Security"===s.badge?"bg-orange-500 text-white":"Max Security"===s.badge?"bg-red-500 text-white":"bg-yellow-500 text-white"),children:s.badge})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg "+(t?"bg-white":"bg-gray-100"),children:e.jsx(s.icon,{className:`w-6 h-6 ${t?s.iconColor:"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900 truncate",children:s.label}),t&&e.jsx(z,{className:"w-4 h-4 text-green-600 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-gray-600 leading-snug",children:s.desc})]})]})]},s.value)})}),(!c.availableSecurityModes||0===c.availableSecurityModes.length)&&e.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-yellow-600"}),e.jsx("p",{className:"text-xs text-yellow-800",children:"Please select at least one security mode for employees"})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl border-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded",children:e.jsx(Be,{className:"w-4 h-4 text-blue-600"})}),e.jsx("label",{className:"text-sm font-bold text-gray-900",children:c.allowEmployeeChoice?"Default Security Mode":"Required Security Mode"})]}),e.jsxs("select",{value:c.defaultSecurityMode||"auto-location",onChange:e=>o({...c,defaultSecurityMode:e.target.value}),className:"w-full px-4 py-3 bg-gradient-to-r from-gray-50 to-gray-100 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-medium hover:border-blue-400 transition-colors",children:[e.jsx("option",{value:"auto-location",children:"Auto-Location (GPS Auto-Detect)"}),e.jsx("option",{value:"manual-location",children:"Manual Location Selection"}),e.jsx("option",{value:"wifi-only",children:"WiFi Only"}),e.jsx("option",{value:"location-and-wifi",children:"Location + WiFi (High Security)"}),e.jsx("option",{value:"photo-only",children:"Photo Only"}),e.jsx("option",{value:"all-security",children:"Maximum Security (All Methods)"})]}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg flex items-start gap-2",children:[e.jsx(vs,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-blue-800 leading-relaxed",children:c.allowEmployeeChoice?"This mode will be pre-selected for employees. They can change it to any available mode you selected above.":"All employees will be required to use this security mode. No other options will be available."})]})]})]})]})})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>w("location"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure GPS, radius, and time settings"})]})]}),"location"===x?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"location"===x&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Fs,{label:"GPS Accuracy (meters)",type:"number",value:c.gpsAccuracy||0,onChange:e=>o({...c,gpsAccuracy:parseInt(e.target.value)||0}),min:"10",max:"1000"}),e.jsx(Fs,{label:"Check-in Radius (meters)",type:"number",value:c.checkInRadius||0,onChange:e=>o({...c,checkInRadius:parseInt(e.target.value)||0}),min:"10",max:"1000"}),e.jsx(Fs,{label:"Grace Period (minutes)",type:"number",value:c.gracePeriod||0,onChange:e=>o({...c,gracePeriod:parseInt(e.target.value)||0}),min:"0",max:"60"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(Fs,{label:"Check-in Time",type:"time",value:c.checkInTime||"",onChange:e=>o({...c,checkInTime:e.target.value})}),e.jsx(Fs,{label:"Check-out Time",type:"time",value:c.checkOutTime||"",onChange:e=>o({...c,checkOutTime:e.target.value})})]})]})]}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>w("offices"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(pe,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Office Locations"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage office locations and WiFi networks"})]})]}),"offices"===x?e.jsx(De,{className:"w-6 h-6 text-gray-600"}):e.jsx(Me,{className:"w-6 h-6 text-gray-600"})]}),"offices"===x&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(Is,{offices:c.offices,selectedOffice:p,onOfficeSelect:e=>{b(e);const s=c.offices.findIndex(s=>s.name===(null==e?void 0:e.name)&&s.lat===(null==e?void 0:e.lat)&&s.lng===(null==e?void 0:e.lng));-1!==s&&h(s)},showRadius:!0}),p&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Selected:"})," ",p.name," - ",p.address]})})]}),c.offices.map((s,a)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(u===a?null:a),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{return e=a,void o({...c,offices:c.offices.filter((s,a)=>a!==e)});var e},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(E,{className:"w-4 h-4"})})]})]}),u===a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Fs,{label:"Office Name",value:s.name,onChange:e=>_(a,"name",e.target.value)}),e.jsx(Fs,{label:"Address",value:s.address,onChange:e=>_(a,"address",e.target.value)}),e.jsx(Fs,{label:"Latitude",type:"number",step:"any",value:s.lat||0,onChange:e=>_(a,"lat",parseFloat(e.target.value)||0)}),e.jsx(Fs,{label:"Longitude",type:"number",step:"any",value:s.lng||0,onChange:e=>_(a,"lng",parseFloat(e.target.value)||0)}),e.jsx(Fs,{label:"Radius (meters)",type:"number",value:s.radius||0,onChange:e=>_(a,"radius",parseInt(e.target.value)||0)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h6",{className:"font-medium text-gray-700",children:"WiFi Networks"}),e.jsx("button",{onClick:()=>(e=>{const s=[...c.offices];s[e].networks.push({ssid:"",description:""}),o({...c,offices:s})})(a),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(O,{className:"w-4 h-4"})})]}),s.networks.map((s,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"SSID",value:s.ssid,onChange:e=>k(a,t,"ssid",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Description",value:s.description,onChange:e=>k(a,t,"description",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:()=>((e,s)=>{const a=[...c.offices];a[e].networks.splice(s,1),o({...c,offices:a})})(a,t),className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(E,{className:"w-4 h-4"})})]},t))]})]}):e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",s.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Coordinates:"})," ",s.lat,", ",s.lng]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Radius:"})," ",s.radius,"m"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Networks:"})," ",s.networks.length," configured"]})]})]},a)),e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-dashed border-gray-300",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-4",children:"Add New Office"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs(r,{onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{f(s=>({...s,lat:e.coords.latitude.toString(),lng:e.coords.longitude.toString()})),P.success("Current location detected!")},e=>{P.error("Failed to get current location. Please enter coordinates manually.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):P.error("Geolocation is not supported by this browser.")},className:"bg-green-600 text-white hover:bg-green-700",children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Get Current Location"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"ðŸ’¡ Click this button to automatically detect your current location for the new office"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(Fs,{label:"Office Name",value:y.name||"",onChange:e=>f({...y,name:e.target.value})}),e.jsx(Fs,{label:"Address",value:y.address||"",onChange:e=>f({...y,address:e.target.value})}),e.jsx(Fs,{label:"Latitude",type:"number",step:"any",value:y.lat||"",onChange:e=>f({...y,lat:e.target.value})}),e.jsx(Fs,{label:"Longitude",type:"number",step:"any",value:y.lng||"",onChange:e=>f({...y,lng:e.target.value})}),e.jsx(Fs,{label:"Radius (meters)",type:"number",value:y.radius||"",onChange:e=>f({...y,radius:e.target.value})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"font-medium text-gray-700 mb-2",children:"WiFi Networks"}),y.networks.map((s,a)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"SSID",value:s.ssid,onChange:e=>{const s=[...y.networks];s[a].ssid=e.target.value,f({...y,networks:s})},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Description",value:s.description,onChange:e=>{const s=[...y.networks];s[a].description=e.target.value,f({...y,networks:s})},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),y.networks.length>1&&e.jsx("button",{onClick:()=>{const e=y.networks.filter((e,s)=>s!==a);f({...y,networks:e})},className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(E,{className:"w-4 h-4"})})]},a)),e.jsxs("button",{onClick:()=>f({...y,networks:[...y.networks,{ssid:"",description:""}]}),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Add Network"]})]}),e.jsx("button",{onClick:()=>{if(!y.name.trim())return void P.error("Office name is required");if(!y.lat||!y.lng)return void P.error("Office coordinates (latitude and longitude) are required");const e=parseFloat(y.lat),s=parseFloat(y.lng);if(isNaN(e)||isNaN(s))return void P.error("Invalid coordinates. Please enter valid numbers.");if(e<-90||e>90)return void P.error("Latitude must be between -90 and 90");if(s<-180||s>180)return void P.error("Longitude must be between -180 and 180");const a=parseInt(y.radius);if(isNaN(a)||a<10)return void P.error("Radius must be at least 10 meters");const t=y.networks.filter(e=>e.ssid.trim());0!==t.length?(o({...c,offices:[...c.offices,{name:y.name,lat:e,lng:s,radius:a,address:y.address,networks:t}]}),f({name:"",lat:"",lng:"",radius:"100",address:"",networks:[{ssid:"",description:""}]}),P.success(`Office "${y.name}" added successfully`),N([])):P.error("At least one WiFi network with SSID is required")},className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Add Office"})]})]})]}),e.jsx(s,{className:"p-6",children:e.jsx("div",{className:"flex justify-end",children:e.jsx(r,{onClick:async()=>{if((()=>{const e=[];return!c.enabled||(c.checkInRadius<10&&e.push("Check-in radius must be at least 10 meters"),c.gpsAccuracy<10&&e.push("GPS accuracy must be at least 10 meters"),(c.gracePeriod<0||c.gracePeriod>60)&&e.push("Grace period must be between 0 and 60 minutes"),0===c.offices.length&&e.push("At least one office location must be configured"),!c.allowEmployeeChoice||c.availableSecurityModes&&0!==c.availableSecurityModes.length||e.push("Please select at least one security mode for employees"),c.offices.forEach((s,a)=>{s.name.trim()||e.push(`Office ${a+1}: Name is required`),s.radius<10&&e.push(`Office ${a+1}: Radius must be at least 10 meters`),0===s.networks.length&&e.push(`Office ${a+1}: At least one WiFi network must be configured`)}),N(e),0===e.length)})()){m(!0);try{await t(c),P.success("Attendance settings saved successfully"),N([])}catch(e){P.error("Failed to save attendance settings")}finally{m(!1)}}else P.error("Please fix validation errors before saving")},disabled:d,className:"bg-blue-600 text-white hover:bg-blue-700",children:d?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Save Settings"]})})})})]})]})},na=()=>{const[a,t]=v.useState(!1),[n,l]=v.useState(0),[i,c]=v.useState(""),[o,m]=v.useState("full"),[x,g]=v.useState(!0),[u,h]=v.useState(null),[p,b]=v.useState(!1),[y,f]=v.useState("daily"),[j,N]=v.useState("02:00"),[w,_]=v.useState("full"),[k,C]=v.useState(null);v.useEffect(()=>{S()},[]);const S=async()=>{try{g(!0);const{data:e,error:s}=await d.from("lats_pos_general_settings").select("id, auto_backup_enabled, auto_backup_frequency, auto_backup_time, auto_backup_type, last_auto_backup").limit(1).single();if(s)throw s;e&&(h(e.id),b(e.auto_backup_enabled||!1),f(e.auto_backup_frequency||"daily"),N(e.auto_backup_time||"02:00"),_(e.auto_backup_type||"full"),C(e.last_auto_backup||null))}catch(e){P.error("Failed to load automatic backup settings")}finally{g(!1)}};v.useEffect(()=>{if(!p||!u)return;const e=async()=>{const e=new Date,s=k?new Date(k):null,[a,t]=j.split(":").map(Number),r=new Date(e);r.setHours(a,t,0,0);if((()=>{if(!s)return!0;const a=Math.floor((e.getTime()-s.getTime())/864e5);return"daily"===y&&a>=1||("weekly"===y&&a>=7||"monthly"===y&&a>=30)})()&&e>=r){try{await d.from("lats_pos_general_settings").update({last_auto_backup:e.toISOString()}).eq("id",u),C(e.toISOString())}catch(n){}m(w),A()}},s=setInterval(e,36e5);return e(),()=>clearInterval(s)},[p,y,j,w,k,u]);const A=async()=>{t(!0),l(0),c("Fetching database schema...");try{c("Loading complete database schema..."),l(5);const{data:s,error:a}=await d.from("information_schema.tables").select("table_name").eq("table_schema","public").order("table_name");if(a)throw new Error("Failed to fetch database schema");const r=(null==s?void 0:s.map(e=>e.table_name))||[];c(`Found ${r.length} tables. Fetching schema definitions...`),l(10);const{data:n,error:i}=await d.from("information_schema.columns").select("table_name, column_name, data_type, is_nullable, column_default").eq("table_schema","public").order("table_name").order("ordinal_position"),m={};null==n||n.forEach(e=>{m[e.table_name]||(m[e.table_name]=[]),m[e.table_name].push({name:e.column_name,type:e.data_type,nullable:"YES"===e.is_nullable,default:e.column_default})}),c(`Schema loaded. Backing up ${r.length} tables...`),l(15);const x="schema-only"===o?"SCHEMA_ONLY":"data-only"===o?"DATA_ONLY":"FULL_SCHEMA_AND_DATA",g={timestamp:(new Date).toISOString(),backupType:x,databaseInfo:{totalTables:r.length,backupIncludes:"schema-only"===o?"Table schemas only (no data)":"data-only"===o?"Table data only (no schema definitions)":"All tables with full schema and data (including empty tables)"},schema:"data-only"===o?void 0:m,tables:{},summary:{totalTables:0,tablesWithData:0,emptyTables:0,totalRecords:0}};let u=0,h=0,p=0,b=0;for(const t of r)try{b++;const e=15+b/r.length*80;if(l(e),c(`Processing: ${t} (${b}/${r.length})`),"schema-only"===o){g.tables[t]={exists:!0,recordCount:0,schema:m[t]||[],data:null,note:"Schema only - data not included"};continue}const s=[];let a=0;const n=1e3;for(;;){const{data:e,error:r}=await d.from(t).select("*").range(a,a+n-1);if(r){g.tables[t]={exists:!0,recordCount:0,schema:"data-only"===o?void 0:m[t]||[],data:[],error:r.message},p++;break}if(!e||0===e.length){0===a&&(g.tables[t]={exists:!0,recordCount:0,schema:"data-only"===o?void 0:m[t]||[],data:[]},p++);break}if(s.push(...e),e.length<n)break;a+=n,await new Promise(e=>setTimeout(e,30))}if(s.length>0){const e=s.length;g.tables[t]={exists:!0,recordCount:e,schema:"data-only"===o?void 0:m[t]||[],data:s},u+=e,h++}}catch(e){g.tables[t]={exists:!0,error:(null==e?void 0:e.message)||"Unknown error",schema:"data-only"===o?void 0:m[t]||[],data:null}}g.summary.totalTables=r.length,g.summary.tablesWithData=h,g.summary.emptyTables=p,g.summary.totalRecords=u,c("Creating backup file..."),l(95);const y=JSON.stringify(g,null,2),f=new Blob([y],{type:"application/json"}),j=URL.createObjectURL(f),v=document.createElement("a");v.href=j;const N="schema-only"===o?"schema-only-backup":"data-only"===o?"data-only-backup":"full-schema-backup";v.download=`${N}-${(new Date).toISOString().replace(/[:.]/g,"-")}.json`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(j);const w="schema-only"===o?`âœ… Schema backup completed! ${r.length} table schemas exported`:"data-only"===o?`âœ… Data backup completed! ${u.toLocaleString()} records from ${h} tables`:`âœ… Full backup completed! ${u.toLocaleString()} records from ${h} tables (${p} empty tables included)`;c(w),l(100);const _="schema-only"===o?`Schema backup: ${r.length} tables`:"data-only"===o?`Data backup: ${u.toLocaleString()} records`:`Full backup: ${r.length} tables, ${u.toLocaleString()} records`;P.success(_),setTimeout(()=>{t(!1),l(0),c("")},5e3)}catch(e){c(`âŒ Backup failed: ${e.message}`),P.error(`Backup failed: ${e.message}`),t(!1)}};return x?e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading backup settings..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(s,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Database Backup & Management"})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(ue,{className:"h-5 w-5 text-blue-600 mr-2"}),"Automatic Backup Schedule"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-800",children:"Enable Automatic Backup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Automatically backup database on schedule"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:e=>b(e.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),p&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Frequency"}),e.jsxs("select",{value:y,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Time"}),e.jsx("input",{type:"time",value:j,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Type"}),e.jsxs("select",{value:w,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"full",children:"Full (Schema + Data)"}),e.jsx("option",{value:"schema-only",children:"Schema Only"}),e.jsx("option",{value:"data-only",children:"Data Only"})]})]})]}),p&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[e.jsxs("p",{className:"text-xs text-yellow-800",children:[e.jsx("strong",{children:"â° Schedule:"})," Backup will run automatically every"," ",e.jsx("strong",{children:y})," at ",e.jsx("strong",{children:j})," ","(","full"===w?"Full backup":"schema-only"===w?"Schema only":"Data only",")"]}),e.jsxs("p",{className:"text-xs text-yellow-700 mt-1",children:["Last automatic backup: ",k?new Date(k).toLocaleString():"Never"]})]}),e.jsxs(r,{onClick:async()=>{if(u)try{const{error:e}=await d.from("lats_pos_general_settings").update({auto_backup_enabled:p,auto_backup_frequency:y,auto_backup_time:j,auto_backup_type:w}).eq("id",u);if(e)throw e;P.success("Automatic backup settings saved to database!")}catch(e){P.error("Failed to save automatic backup settings")}else P.error("Settings ID not found")},className:"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(W,{className:"w-4 h-4"}),"Save Automatic Backup Settings"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx($e,{className:"h-5 w-5 text-orange-600 mr-2"}),"Manual Database Backup"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Type"}),e.jsxs("select",{value:o,onChange:e=>m(e.target.value),disabled:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"full",children:"Full Backup (Schema + Data)"}),e.jsx("option",{value:"schema-only",children:"Schema Only (No Data)"}),e.jsx("option",{value:"data-only",children:"Data Only (No Schema)"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["full"===o&&"ðŸ“¦ Includes table structures AND all records (recommended for complete backup)","schema-only"===o&&"ðŸ“‹ Only table structures - useful for database migration or documentation","data-only"===o&&"ðŸ’¾ Only data records - useful for data export or analysis"]})]}),a&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:i}),e.jsxs("span",{className:"font-medium text-blue-600",children:[Math.round(n),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${n}%`}})})]}),!a&&i&&e.jsx("div",{className:"p-3 rounded-lg "+(i.includes("âœ…")?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.jsx("p",{className:"text-sm font-medium",children:i})}),e.jsx(r,{onClick:A,disabled:a,className:"w-full flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Backing up..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4"}),"full"===o&&"Download Full Backup","schema-only"===o&&"Download Schema Only","data-only"===o&&"Download Data Only"]})}),"full"===o&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-800",children:e.jsx("strong",{children:"ðŸ“¦ Full Backup includes:"})}),e.jsxs("ul",{className:"text-xs text-blue-700 mt-1 ml-4 list-disc space-y-1",children:[e.jsx("li",{children:"Complete schema for ALL tables (column names, data types, constraints)"}),e.jsx("li",{children:"All data records from every table"}),e.jsx("li",{children:"Empty tables with their schema definitions"}),e.jsx("li",{children:"Total record count and table statistics"})]})]}),"schema-only"===o&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-purple-800",children:e.jsx("strong",{children:"ðŸ“‹ Schema Only includes:"})}),e.jsxs("ul",{className:"text-xs text-purple-700 mt-1 ml-4 list-disc space-y-1",children:[e.jsx("li",{children:"All table names"}),e.jsx("li",{children:"Column definitions (names, types, nullable, defaults)"}),e.jsx("li",{children:"Table structure for database recreation"}),e.jsxs("li",{children:[e.jsx("strong",{children:"No actual data"})," - much smaller file size"]})]})]}),"data-only"===o&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-800",children:e.jsx("strong",{children:"ðŸ’¾ Data Only includes:"})}),e.jsxs("ul",{className:"text-xs text-green-700 mt-1 ml-4 list-disc space-y-1",children:[e.jsx("li",{children:"All records from all tables"}),e.jsx("li",{children:"Complete data export for analysis"}),e.jsxs("li",{children:[e.jsx("strong",{children:"No schema definitions"})," - data only"]}),e.jsx("li",{children:"Useful for data migration or import into existing database"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Keep this backup in a safe place for disaster recovery and database migration."})]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(ea,{})})]})},la=({settings:a,onSave:t,getStatusIcon:r,getStatusColor:n})=>{const[l,i]=v.useState(a),[c,o]=v.useState(!1),d=[{key:"autoBackup",title:"Automatic Backup",description:"Automatically backup data at scheduled intervals",icon:ws,color:"purple",enabled:l.autoBackup},{key:"autoCleanup",title:"Automatic Cleanup",description:"Clean up old logs and temporary files",icon:E,color:"green",enabled:l.autoCleanup},{key:"autoScaling",title:"Auto Scaling",description:"Automatically scale resources based on demand",icon:Ie,color:"blue",enabled:l.autoScaling},{key:"autoUpdates",title:"Automatic Updates",description:"Automatically update system components",icon:I,color:"orange",enabled:l.autoUpdates}];return e.jsxs(s,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Automation Settings"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(s=>{const a=s.icon;return e.jsxs("div",{className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(a,{className:"w-6 h-6 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:s.title})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsx("button",{onClick:()=>(async(e,s)=>{const a={...l,[e]:s};i(a),o(!0);try{await t(a),P.success(`${e.replace("auto","Auto ")} ${s?"enabled":"disabled"} successfully!`)}catch(r){P.error("Failed to update automation settings"),i(l)}finally{o(!1)}})(s.key,!s.enabled),disabled:c,className:"w-full py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 "+(s.enabled?"bg-gray-100 text-gray-500 hover:bg-gray-200":"bg-blue-600 text-white hover:bg-blue-700"),children:s.enabled?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),"Enabled"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4"}),"Enable"]})})]},s.key)})})]})};export{ta as default};
