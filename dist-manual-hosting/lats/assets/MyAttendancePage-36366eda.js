import{u as e,v as s,s as t,j as a,d as l}from"./index-222cfb29.js";import{r,R as n}from"./vendor-a2ff445a.js";import{B as c}from"./BackButton-e41d1482.js";import{u as i,E as o,m as d}from"./officeConfig-b4b33ec9.js";import{n as x,e as m,av as h,au as g,d as u,f as p,u as j,ar as f,h as y,bA as N,S as b,M as v}from"./ui-551a39a6.js";import{e as w}from"./employeeService-806781a0.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";import"./attendanceSettingsApi-f32cc1d2.js";const k=()=>{var k;const{currentUser:D}=e();s();const{settings:S}=i(),[H,T]=r.useState(null),[C,F]=r.useState([]),[I,R]=r.useState(!0),[O,M]=r.useState(null);r.useEffect(()=>{A()},[D]);const A=async()=>{if(null==D?void 0:D.id){R(!0);try{const{data:e,error:s}=await t.from("employees").select("*").eq("user_id",D.id).single();if(s||!e)return void x.error("Employee record not found. Please contact HR.");T(e);const a=await w.getAttendanceByEmployeeId(e.id);F(a);const l=(new Date).toISOString().split("T")[0],r=a.find(e=>e.attendanceDate===l);M(r||null)}catch(e){x.error("Failed to load attendance data")}finally{R(!1)}}},L=n.useMemo(()=>{const e=C.filter(e=>{const s=new Date(e.attendanceDate),t=new Date;return s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear()}),s=e.filter(e=>"present"===e.status).length,t=e.filter(e=>"late"===e.status).length,a=e.reduce((e,s)=>e+(s.totalHours||0),0),l=e.length>0?a/e.length:0;return{thisMonthDays:e.length,presentDays:s,lateDays:t,totalHours:a,avgHours:l,attendanceRate:(null==H?void 0:H.attendance)||0,performance:(null==H?void 0:H.performance)||0}},[C,H]),E=(()=>{const e=(new Date).getHours();return e<12?{text:"Good Morning",icon:b}:e<18?{text:"Good Afternoon",icon:b}:{text:"Good Evening",icon:v}})(),P=E.icon;return I?a.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto space-y-6",children:a.jsxs("div",{className:"flex items-center justify-center h-64",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),a.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading your attendance..."})]})}):H?a.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto space-y-6",children:[a.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(c,{to:"/dashboard"}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(P,{className:"w-6 h-6 text-yellow-500"}),a.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[E.text,"!"]})]}),a.jsxs("p",{className:"text-gray-600",children:[H.firstName," ",H.lastName," - ",a.jsx("span",{className:"font-medium",children:H.position})]})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("div",{className:"px-4 py-2 bg-green-50 rounded-lg",children:[a.jsx("div",{className:"text-xs text-green-600 font-medium",children:"Attendance"}),a.jsxs("div",{className:"text-2xl font-bold text-green-700",children:[L.attendanceRate,"%"]})]}),a.jsxs("div",{className:"px-4 py-2 bg-purple-50 rounded-lg",children:[a.jsx("div",{className:"text-xs text-purple-600 font-medium",children:"Performance"}),a.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[L.performance.toFixed(1),"/5"]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsx(o,{employeeId:H.id,employeeName:`${H.firstName} ${H.lastName}`,onCheckIn:async(e,s)=>{try{await w.checkIn(e),await A(),x.success("Checked in successfully! Have a great day! ðŸŽ‰")}catch(t){x.error("Check-in failed. Please try again.")}},onCheckOut:async(e,s)=>{try{await w.checkOut(e),await A(),x.success("Checked out successfully! See you tomorrow! ðŸ‘‹")}catch(t){x.error("Check-out failed. Please try again.")}},officeLocation:d,officeNetworks:(null==(k=S.offices[0])?void 0:k.networks)||[]})}),a.jsx("div",{children:a.jsxs(l,{className:"p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[a.jsx(g,{className:"w-5 h-5 text-blue-600"}),"Today's Summary"]}),a.jsx("div",{className:"space-y-4",children:O?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(u,{className:"w-4 h-4 text-green-600"}),a.jsx("span",{className:"text-sm font-medium text-green-900",children:"Status"})]}),a.jsx("p",{className:"text-lg font-bold text-green-700 capitalize",children:O.status})]}),O.checkInTime&&a.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[a.jsx("div",{className:"text-sm font-medium text-blue-900 mb-1",children:"Check In"}),a.jsx("p",{className:"text-lg font-mono font-bold text-blue-700",children:new Date(O.checkInTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),O.checkOutTime&&a.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[a.jsx("div",{className:"text-sm font-medium text-purple-900 mb-1",children:"Check Out"}),a.jsx("p",{className:"text-lg font-mono font-bold text-purple-700",children:new Date(O.checkOutTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),O.totalHours>0&&a.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[a.jsx("div",{className:"text-sm font-medium text-orange-900 mb-1",children:"Hours Worked"}),a.jsxs("p",{className:"text-lg font-bold text-orange-700",children:[O.totalHours.toFixed(1)," hours"]})]})]}):a.jsxs("div",{className:"text-center py-6",children:[a.jsx(p,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-500",children:"No attendance record for today"})]})})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[a.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(j,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"This Month"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:L.thisMonthDays}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[L.presentDays," present"]})]})]})}),a.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(u,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Attendance Rate"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[L.attendanceRate,"%"]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"overall"})]})]})}),a.jsx("div",{className:"bg-purple-50 rounded-lg p-5 hover:bg-purple-100 transition-colors",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(p,{className:"w-7 h-7 text-purple-600 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Hours"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:L.totalHours.toFixed(0)}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[L.avgHours.toFixed(1),"h avg/day"]})]})]})}),a.jsx("div",{className:"bg-orange-50 rounded-lg p-5 hover:bg-orange-100 transition-colors",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(f,{className:"w-7 h-7 text-orange-600 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Performance"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:L.performance.toFixed(1)}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"out of 5.0"})]})]})})]}),a.jsx(l,{children:a.jsxs("div",{className:"p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[a.jsx(h,{className:"w-5 h-5 text-blue-600"}),"Recent Attendance History"]}),0===C.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(j,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500",children:"No attendance records yet"})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Date"}),a.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Check In"}),a.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Check Out"}),a.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Hours"}),a.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Status"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100",children:C.slice(0,10).map(e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"py-3 px-4",children:a.jsx("p",{className:"font-medium text-gray-900",children:new Date(e.attendanceDate).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})}),a.jsx("td",{className:"py-3 px-4",children:e.checkInTime?a.jsx("span",{className:"text-sm font-mono text-gray-700",children:new Date(e.checkInTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}):a.jsx("span",{className:"text-xs text-gray-400",children:"--:--"})}),a.jsx("td",{className:"py-3 px-4",children:e.checkOutTime?a.jsx("span",{className:"text-sm font-mono text-gray-700",children:new Date(e.checkOutTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}):a.jsx("span",{className:"text-xs text-gray-400",children:"--:--"})}),a.jsx("td",{className:"py-3 px-4",children:a.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[e.totalHours.toFixed(1),"h"]})}),a.jsx("td",{className:"py-3 px-4",children:a.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium "+("present"===e.status?"bg-green-100 text-green-700":"late"===e.status?"bg-yellow-100 text-yellow-700":"half-day"===e.status?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"),children:["present"===e.status&&a.jsx(u,{className:"w-3 h-3 mr-1"}),"absent"===e.status&&a.jsx(y,{className:"w-3 h-3 mr-1"}),e.status.replace("-"," ")]})})]},e.id))})]})})]})}),L.attendanceRate>=95&&L.performance>=4&&a.jsx(l,{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border-yellow-200",children:a.jsxs("div",{className:"p-6 flex items-center gap-4",children:[a.jsx("div",{className:"bg-yellow-500 rounded-full p-3",children:a.jsx(N,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Outstanding Performance! ðŸŽ‰"}),a.jsxs("p",{className:"text-gray-700",children:["You're doing amazing! Keep up the excellent work with ",L.attendanceRate,"% attendance and ",L.performance.toFixed(1),"/5.0 performance rating!"]})]})]})})]}):a.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto space-y-6",children:[a.jsx(c,{to:"/dashboard"}),a.jsxs(l,{className:"p-12 text-center max-w-2xl mx-auto",children:[a.jsx(m,{className:"w-16 h-16 text-orange-500 mx-auto mb-4"}),a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Employee Record Not Found"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Your user account is not linked to an employee record in the system."}),a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-left",children:[a.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[a.jsx(h,{className:"w-4 h-4"}),"Why am I seeing this?"]}),a.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"To use attendance tracking, your user account needs to be connected to an employee record. This connection allows the system to track your attendance, performance, and other HR-related data."})]}),a.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6 text-left",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"How to fix this:"}),a.jsxs("ol",{className:"text-sm text-gray-700 space-y-2 list-decimal list-inside",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"For Administrators:"}),' Go to User Management, click the "Link" button (ðŸ”—), and use the auto-link feature or manually link users to employees.']}),a.jsxs("li",{children:[a.jsx("strong",{children:"For Other Users:"})," Contact your HR department or system administrator to link your account (",null==D?void 0:D.email,") to your employee record."]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:["admin"===(null==D?void 0:D.role)&&a.jsx("button",{onClick:()=>window.location.href="/users",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Go to User Management"}),a.jsx("button",{onClick:()=>window.location.href="/dashboard",className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Back to Dashboard"})]}),a.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:a.jsxs("p",{className:"text-xs text-gray-500",children:["Your account email: ",a.jsx("span",{className:"font-mono font-medium",children:null==D?void 0:D.email})]})})]})]})};export{k as default};
