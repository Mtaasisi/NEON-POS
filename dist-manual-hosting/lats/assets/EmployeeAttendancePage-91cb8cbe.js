import{u as e,j as t}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import{B as a}from"./BackButton-e41d1482.js";import{u as r,E as n,m as l}from"./officeConfig-b4b33ec9.js";import{e as i,aa as c,f as d,u as o,ax as x,A as m,d as h,au as g,ah as u,av as p,n as y}from"./ui-551a39a6.js";import{e as j}from"./employeeService-806781a0.js";import{a as b}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";import"./attendanceSettingsApi-f32cc1d2.js";const N=()=>{const{currentUser:N}=e(),f=b(),{settings:v,loading:w}=r(),[k,S]=s.useState([]),[D,T]=s.useState(null),[I,A]=s.useState(""),[O,C]=s.useState(!0),[L,$]=s.useState(null),[H,z]=s.useState("today");s.useEffect(()=>{(async()=>{if(N){C(!0),$(null);try{const e=await j.getEmployeeByUserId(N.id);if(e){T(e.id),A(N.fullName||N.full_name||`${e.firstName} ${e.lastName}`);const t=(await j.getAttendanceByEmployeeId(e.id,30)).map(e=>({id:e.id,date:e.attendanceDate,checkIn:e.checkInTime?new Date(e.checkInTime).toLocaleTimeString("en-US",{hour12:!1}):void 0,checkOut:e.checkOutTime?new Date(e.checkOutTime).toLocaleTimeString("en-US",{hour12:!1}):void 0,status:e.status,hours:Number(e.totalHours)||0,notes:e.notes}));S(t)}else $("Employee record not found. Please contact your administrator to link your account to an employee profile.")}catch(e){$("Failed to load attendance data. Please try again."),y.error("Failed to load attendance history")}finally{C(!1)}}})()},[N]);const F=s.useCallback(async()=>{if(N)try{const e=await j.getEmployeeByUserId(N.id);if(e){const t=(await j.getAttendanceByEmployeeId(e.id,30)).map(e=>({id:e.id,date:e.attendanceDate,checkIn:e.checkInTime?new Date(e.checkInTime).toLocaleTimeString("en-US",{hour12:!1}):void 0,checkOut:e.checkOutTime?new Date(e.checkOutTime).toLocaleTimeString("en-US",{hour12:!1}):void 0,status:e.status,hours:Number(e.totalHours)||0,notes:e.notes}));S(t)}}catch(e){}},[N]);if(O||w)return t.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("span",{className:"ml-3 text-gray-600",children:"Loading attendance..."})]})});if(L)return t.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(a,{to:"/dashboard"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Attendance"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your daily check-ins and view history"})]})]}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:t.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[t.jsx(i,{className:"w-16 h-16 text-red-500 mb-4"}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Failed to Load Attendance"}),t.jsx("p",{className:"text-gray-600 mb-6 max-w-md",children:L}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-5 py-2.5 bg-blue-600 text-white hover:bg-blue-700 rounded-lg font-medium transition-colors text-sm",children:"Try Again"})]})})]});const U=(()=>{const e=k.length,t=k.filter(e=>"present"===e.status||"late"===e.status).length,s=k.filter(e=>"late"===e.status).length,a=k.reduce((e,t)=>e+t.hours,0);return{totalDays:e,presentDays:t,lateDays:s,totalHours:a,avgHours:e>0?a/e:0,attendanceRate:e>0?t/e*100:0}})(),q=(()=>{const e=(new Date).toISOString().split("T")[0];return k.find(t=>t.date===e)})(),M=(()=>{const e=new Date,t=e.getFullYear(),s=e.getMonth(),a=new Date(t,s+1,0).getDate(),r=[];for(let n=1;n<=a;n++){const e=`${t}-${String(s+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`,a=k.find(t=>t.date===e);r.push({day:n,dateStr:e,hasAttendance:!!a,status:null==a?void 0:a.status})}return r})();return t.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(a,{to:"/dashboard"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Attendance"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your daily check-ins and view history"})]})]}),"admin"===(null==N?void 0:N.role)||"manager"===(null==N?void 0:N.role)?t.jsx("div",{className:"flex gap-2",children:t.jsxs("button",{onClick:()=>f("/employees/attendance-management"),className:"flex items-center gap-2 px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:[t.jsx(c,{size:18}),"Attendance Setup"]})}):null]}),t.jsxs("div",{className:"flex gap-1 bg-gray-100 p-1 rounded-lg w-fit",children:[t.jsx("button",{onClick:()=>z("today"),className:"px-4 py-2 font-medium text-sm rounded-md transition-colors "+("today"===H?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(d,{size:16}),"Today"]})}),t.jsx("button",{onClick:()=>z("history"),className:"px-4 py-2 font-medium text-sm rounded-md transition-colors "+("history"===H?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(o,{size:16}),"History"]})}),t.jsx("button",{onClick:()=>z("stats"),className:"px-4 py-2 font-medium text-sm rounded-md transition-colors "+("stats"===H?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(x,{size:16}),"Statistics"]})})]}),"today"===H&&!v.enabled&&t.jsx("div",{className:"bg-yellow-50 rounded-lg border border-yellow-200 p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(m,{className:"w-5 h-5 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-yellow-900",children:"Attendance System Disabled"}),t.jsx("p",{className:"text-sm text-yellow-700",children:"Contact administrator to enable attendance tracking."})]})]})}),"today"===H&&v.enabled&&t.jsxs("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(d,{className:"w-5 h-5 text-blue-600"}),t.jsx("p",{className:"font-medium text-blue-900",children:"Active Verification Methods"})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[v.requireLocation&&t.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:"ðŸ“ Location"}),v.requireWifi&&t.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:"ðŸ“¶ WiFi"}),v.requirePhoto&&t.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:"ðŸ“· Photo"}),!v.requireLocation&&!v.requireWifi&&!v.requirePhoto&&t.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium",children:"No verification required"})]})]}),"today"===H&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[t.jsx(n,{employeeId:D||"",employeeName:I||"Loading...",onCheckIn:async(e,t)=>{try{await j.checkIn(e),await F()}catch(s){}},onCheckOut:async(e,t)=>{try{await j.checkOut(e),await F()}catch(s){}},officeLocation:l.location,officeNetworks:l.networks}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:"Today's Summary"}),q?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),t.jsx("span",{className:"text-sm font-medium capitalize "+("present"===q.status?"text-green-600":"late"===q.status?"text-yellow-600":"absent"===q.status?"text-red-600":"text-orange-600"),children:q.status})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Check In:"}),t.jsx("span",{className:"text-sm font-mono font-medium",children:q.checkIn||"Not checked in"})]}),q.checkOut&&t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Check Out:"}),t.jsx("span",{className:"text-sm font-mono font-medium",children:q.checkOut})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Hours Worked:"}),t.jsxs("span",{className:"text-sm font-medium",children:[(e=>{if(!e||!e.checkIn)return 0;if(e.checkOut)return e.hours;const t=new Date(`2000-01-01T${e.checkIn}`),s=(new Date(`2000-01-01T${(new Date).toTimeString().split(" ")[0]}`).getTime()-t.getTime())/36e5;return Math.max(0,s)})(q).toFixed(1)," hours"]})]})]}):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(o,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No attendance recorded for today"}),t.jsx("p",{className:"text-xs mt-1",children:"Please check in to start tracking"})]})]})]}),"history"===H&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:"Attendance History"}),k.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-200",children:[t.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Date"}),t.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Check In"}),t.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Check Out"}),t.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),t.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Hours"})]})}),t.jsx("tbody",{children:k.map(e=>t.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[t.jsxs("td",{className:"py-3 px-4",children:[t.jsx("p",{className:"font-medium text-gray-900",children:new Date(e.date).toLocaleDateString()}),t.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.date).toLocaleDateString("en-US",{weekday:"short"})})]}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(d,{size:14,className:"text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-600",children:e.checkIn||"Not checked in"})]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(d,{size:14,className:"text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-600",children:e.checkOut||"Not checked out"})]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium capitalize "+("present"===e.status?"bg-green-100 text-green-800":"absent"===e.status?"bg-red-100 text-red-800":"late"===e.status?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"),children:e.status})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["number"==typeof e.hours?e.hours.toFixed(1):"0.0","h"]}),e.hours>=8&&t.jsx(h,{size:14,className:"text-green-500"})]})})]},e.id))})]})}):t.jsxs("div",{className:"text-center py-12 text-gray-500",children:[t.jsx(g,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),t.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Attendance History"}),t.jsx("p",{className:"text-sm",children:"You haven't recorded any attendance yet."}),t.jsx("p",{className:"text-xs mt-1",children:"Check in today to start tracking your attendance!"})]})]}),"stats"===H&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[t.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(g,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Days"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:U.totalDays})]})]})}),t.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(h,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Present Days"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:U.presentDays})]})]})}),t.jsx("div",{className:"bg-purple-50 rounded-lg p-5 hover:bg-purple-100 transition-colors",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(u,{className:"w-7 h-7 text-purple-600 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Attendance Rate"}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[U.attendanceRate.toFixed(1).replace(/\.0$/,""),"%"]})]})]})}),t.jsx("div",{className:"bg-orange-50 rounded-lg p-5 hover:bg-orange-100 transition-colors",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(p,{className:"w-7 h-7 text-orange-600 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Avg. Hours"}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[U.avgHours.toFixed(1).replace(/\.0$/,""),"h"]})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:["Monthly Overview - ",(new Date).toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),t.jsx("div",{className:"grid grid-cols-7 gap-2",children:M.map(e=>{const s=e.dateStr===(new Date).toISOString().split("T")[0];return t.jsx("div",{className:`aspect-square rounded-lg flex items-center justify-center text-xs font-medium transition-all ${s?"ring-2 ring-blue-500 ring-offset-1":""} ${e.hasAttendance?"present"===e.status?"bg-green-100 text-green-800 hover:bg-green-200":"late"===e.status?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"absent"===e.status?"bg-red-100 text-red-800 hover:bg-red-200":"bg-orange-100 text-orange-800 hover:bg-orange-200":"bg-gray-100 text-gray-400"}`,title:e.hasAttendance?`${e.status} on ${e.dateStr}`:"No attendance record",children:e.day},e.day)})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-green-100 rounded border border-green-300"}),t.jsx("span",{children:"Present"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-yellow-100 rounded border border-yellow-300"}),t.jsx("span",{children:"Late"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-100 rounded border border-red-300"}),t.jsx("span",{children:"Absent"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-gray-100 rounded border border-gray-300"}),t.jsx("span",{children:"No Record"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-white rounded border-2 border-blue-500"}),t.jsx("span",{children:"Today"})]})]})]})]})]})};export{N as default};
