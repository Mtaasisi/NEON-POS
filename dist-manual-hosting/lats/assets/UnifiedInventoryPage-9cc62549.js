import{j as e,d as t,G as s,s as a,c as r,ay as l,az as i,as as n}from"./index-222cfb29.js";import{r as o,R as c}from"./vendor-a2ff445a.js";import{B as d}from"./BackButton-e41d1482.js";import{P as u}from"./PageErrorBoundary-d0d559c5.js";import{u as m}from"./useErrorHandler-ea2ee44d.js";import{E as x}from"./ErrorState-0516fc54.js";import{X as p,x as h,ai as g,aj as b,I as f,d as y,e as v,a5 as j,n as N,g as w,G as S,y as k,bf as P,c as C,R as _,N as A,T as I,a8 as T,bR as B,A as $,D as M,ah as E,ac as D,ad as R,cz as O,p as L,a2 as G,co as F,cA as U,$ as z,h as q,ck as V,r as K,q as Q,a9 as H,aM as W,V as Y,f as Z,Y as X,ab as J,Q as ee,u as te,cB as se,s as ae,j as re,bg as le,ax as ie,aC as ne,av as oe,b7 as ce,aa as de,cC as ue}from"./ui-551a39a6.js";import{S as me,P as xe,a as pe,E as he}from"./ProductModal-44d6d29a.js";import{C as ge}from"./CategoryFormModal-788e39ee.js";import{_ as be}from"./supabase-7e851d02.js";import{S as fe}from"./SupplierForm-e7ec71ff.js";import{o as ye,s as ve,n as je,u as Ne,C as we}from"./forms-fd94c8fb.js";import{t as Se}from"./zod-4c7d126c.js";import{G as ke}from"./GlassInput-ba5c3c0d.js";import{u as Pe}from"./useBodyScrollLock-0216d39f.js";import{u as Ce,S as _e}from"./useSuccessModal-e8b7d685.js";import{S as Ae}from"./SuccessModalIcons-20b743c5.js";import{C as Ie}from"./CategoryInput-bba1731d.js";import{P as Te}from"./PricingAndStockForm-1324ba4c.js";import{S as Be}from"./SearchBar-2b6f451f.js";import{G as $e}from"./GlassSelect-3b56e5f5.js";import{M as Me}from"./ModernLoadingOverlay-8a052a4d.js";import{V as Ee}from"./VariantProductCard-5f79965a.js";import{u as De}from"./useBluetoothPrinter-08dc31b9.js";import{Q as Re}from"./qr-a0592e4b.js";import{v as Oe}from"./productUtils-6e390a72.js";import{u as Le}from"./useDialog-ddaadb89.js";import{format as Ge}from"./format-0f0b2647.js";import{a as Fe}from"./routing-a2f0f6d2.js";import"./robustImageService-2422a1f9.js";import"./CircularProgress-471d8e37.js";import"./specificationUtils-8355804c.js";import"./variantUtils-422e46bb.js";import"./usePurchaseOrderHistory-baa7ee96.js";import"./productCalculations-9e8647a1.js";import"./GlassBadge-18f019e2.js";import"./utils-fb833cf6.js";import"./charts-66cc82bb.js";import"./PriceInput-e1556d5b.js";import"./storeShelfApi-d8b142f6.js";const Ue=({isOpen:r,onClose:l,onImportComplete:i})=>{const[n,c]=o.useState(null),[d,u]=o.useState([]),[m,x]=o.useState([]),[w,S]=o.useState(!1),[k,P]=o.useState(!1),[C,_]=o.useState("upload"),[A,I]=o.useState(0),[T,B]=o.useState([]),[$,M]=o.useState([]),[E,D]=o.useState(!1),[R,O]=o.useState([]),[L,G]=o.useState(!1),F=o.useRef(null),U=(e,t)=>{const s=[];return(!e.name||e.name.trim().length<2)&&s.push(`Row ${t}: Product name must be at least 2 characters long`),(!e.sku||e.sku.trim().length<3)&&s.push(`Row ${t}: SKU must be at least 3 characters long`),e.categoryId&&0!==e.categoryId.trim().length||s.push(`Row ${t}: Category ID is required`),e.price<0&&s.push(`Row ${t}: Price cannot be negative`),e.costPrice<0&&s.push(`Row ${t}: Cost price cannot be negative`),e.stockQuantity<0&&s.push(`Row ${t}: Stock quantity cannot be negative`),e.minStockLevel<0&&s.push(`Row ${t}: Minimum stock level cannot be negative`),s},z=async e=>{S(!0),M([]);try{const s=await be(()=>import("./utils-99ffde2f.js"),[]),a=await e.arrayBuffer(),r=s.read(a,{type:"array"}),l=r.SheetNames[0],i=r.Sheets[l],n=s.utils.sheet_to_json(i,{header:1});if(n.length<2)throw new Error("Excel file must contain at least a header row and one data row");const o=n[0],c=["name","description","category","price","cost","quantity","sku","barcode"].filter(e=>!o.some(t=>null==t?void 0:t.toLowerCase().includes(e.toLowerCase())));if(c.length>0)throw new Error(`Missing required columns: ${c.join(", ")}`);const d=[],u=[];for(let e=1;e<n.length;e++){const s=n[e];try{const t={name:s[0]||"",description:s[1]||"",category:s[2]||"",price:parseFloat(s[3])||0,cost:parseFloat(s[4])||0,quantity:parseInt(s[5])||0,sku:s[6]||"",barcode:s[7]||"",brand:s[8]||"",model:s[9]||"",color:s[10]||"",size:s[11]||"",weight:s[12]||"",dimensions:s[13]||"",supplier:s[14]||"",notes:s[15]||""};if(!t.name)throw new Error(`Row ${e+1}: Product name is required`);if(t.price<=0)throw new Error(`Row ${e+1}: Price must be greater than 0`);if(t.quantity<0)throw new Error(`Row ${e+1}: Quantity cannot be negative`);d.push(t)}catch(t){u.push(`Row ${e+1}: ${t.message}`)}}u.length>0?(M(u),N.error(`Found ${u.length} validation errors. Please fix them and try again.`)):(setParsedProducts(d),N.success(`Successfully parsed ${d.length} products from Excel file`))}catch(t){N.error(`Failed to process Excel file: ${t.message}`),M([t.message])}finally{S(!1)}},q=()=>{c(null),u([]),x([]),O([]),_("upload"),I(0),B([]),M([]),S(!1),P(!1),D(!1),G(!1),F.current&&(F.current.value=""),l()};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:e.jsxs(t,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto p-6 relative",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700",onClick:q,children:e.jsx(p,{size:24})}),e.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Import Products from Excel"}),"upload"===C&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx(h,{size:48,className:"mx-auto text-blue-500"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Upload Excel File"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Upload an Excel file (.xlsx, .xls) or CSV file with product data"}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsxs(s,{onClick:()=>{var e;return null==(e=F.current)?void 0:e.click()},disabled:w,children:[e.jsx(g,{size:16,className:"mr-2"}),w?"Processing...":"Choose File"]}),e.jsxs(s,{variant:"secondary",onClick:()=>{const e=[["Name","SKU","Barcode","Category ID","Supplier ID","Condition","Internal Notes","Price","Cost Price","Stock Quantity","Min Stock Level","Short Description","Is Active"],["iPhone 14 Pro","IPH14PRO-128GB","1234567890123","smartphones","supplier1","new","Latest model","1200000","1000000","10","2","Latest iPhone with advanced features","true"]].map(e=>e.join(",")).join("\n"),t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="product_import_template.csv",a.click(),window.URL.revokeObjectURL(s)},children:[e.jsx(b,{size:16,className:"mr-2"}),"Download Template"]})]}),e.jsx("input",{ref:F,type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&(c(s),z(s))},className:"hidden"})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(f,{size:20,className:"text-blue-500 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Import Guidelines"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Required fields: Name, SKU, Category ID, Price, Cost Price"}),e.jsx("li",{children:"• SKU must be unique and at least 3 characters long"}),e.jsx("li",{children:"• Condition can be: new, used, refurbished"}),e.jsx("li",{children:"• Prices should be in Tanzanian Shillings (TZS)"}),e.jsx("li",{children:"• Stock quantities and minimum levels must be non-negative"})]})]})]})})]}),"preview"===C&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Preview Data"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{variant:"secondary",onClick:()=>D(!E),children:E?"View Mode":"Edit Mode"}),e.jsx(s,{variant:"secondary",onClick:()=>G(!L),children:L?"Detailed View":"Compact View"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Name"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"SKU"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Category"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Price (TZS)"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Stock"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Condition"})]})}),e.jsx("tbody",{children:m.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:t.name}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:t.sku}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:t.categoryId}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:t.price.toLocaleString()}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:t.stockQuantity}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:t.condition})]},s))})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(s,{variant:"secondary",onClick:()=>_("upload"),children:"Back"}),e.jsx(s,{onClick:async()=>{P(!0),I(0),_("import");const e=[],t=m.length;for(let l=0;l<t;l++){const s=m[l],i=U(s,l+1);if(i.length>0)e.push({success:!1,error:i.join(", "),rowNumber:l+1});else try{const{data:t,error:r}=await a.from("lats_products").insert([{name:s.name,sku:s.sku,barcode:s.barcode,category_id:s.categoryId,supplier_id:s.supplierId,condition:s.condition,internal_notes:s.internalNotes,price:s.price,cost_price:s.costPrice,stock_quantity:s.stockQuantity,min_stock_level:s.minStockLevel,short_description:s.shortDescription,is_active:s.isActive,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select().single();if(r)throw new Error(r.message);e.push({success:!0,product:t,rowNumber:l+1})}catch(r){e.push({success:!1,error:r.message||"Failed to import product",rowNumber:l+1})}I((l+1)/t*100),await new Promise(e=>setTimeout(e,100))}B(e),P(!1);const s=e.filter(e=>e.success);if(s.length>0){const e=s.map(e=>e.product).filter(Boolean);i(e),N.success(`Successfully imported ${s.length} products`)}},disabled:k,children:k?"Importing...":"Import Products"})]})]}),"import"===C&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Import Results"}),k&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Importing products..."}),e.jsxs("span",{children:[Math.round(A),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${A}%`}})})]}),!k&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{size:20,className:"text-green-500 mr-2"}),e.jsxs("span",{className:"font-semibold text-green-900",children:[T.filter(e=>e.success).length," Successful"]})]})}),e.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{size:20,className:"text-red-500 mr-2"}),e.jsxs("span",{className:"font-semibold text-red-900",children:[T.filter(e=>!e.success).length," Failed"]})]})}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{size:20,className:"text-blue-500 mr-2"}),e.jsxs("span",{className:"font-semibold text-blue-900",children:[T.length," Total"]})]})})]}),T.filter(e=>!e.success).length>0&&e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-red-900 mb-2",children:"Failed Imports"}),e.jsx("div",{className:"space-y-1",children:T.filter(e=>!e.success).map((t,s)=>e.jsxs("div",{className:"text-sm text-red-800",children:["Row ",t.rowNumber,": ",t.error]},s))})]})]}),e.jsx("div",{className:"flex gap-2 justify-end",children:e.jsx(s,{variant:"secondary",onClick:q,children:"Close"})})]})]})}):null},ze={WEB_SEARCH_API:{}.VITE_WEB_SEARCH_API||"mock",GOOGLE_SEARCH_API_KEY:{}.VITE_GOOGLE_SEARCH_API_KEY,GOOGLE_SEARCH_ENGINE_ID:{}.VITE_GOOGLE_SEARCH_ENGINE_ID,BING_SEARCH_API_KEY:{}.VITE_BING_SEARCH_API_KEY,SERPAPI_KEY:{}.VITE_SERPAPI_KEY,AI_GENERATION_API:{}.VITE_AI_GENERATION_API||"mock",OPENAI_API_KEY:{}.VITE_OPENAI_API_KEY,ANTHROPIC_API_KEY:{}.VITE_ANTHROPIC_API_KEY,GEMINI_API_KEY:{}.VITE_GEMINI_API_KEY};function qe(e){const{name:t,model:s,category:a,brand:r}=e,l=t.toLowerCase(),i=(null==s?void 0:s.toLowerCase())||"";let n="",o={},c={},d=[];return l.includes("iphone")||(null==r?void 0:r.toLowerCase().includes("apple"))?l.includes("iphone 15 pro max")?(n="A3102",o={chip:"A17 Pro chip with 6-core GPU",display:"6.7-inch Super Retina XDR display",resolution:"2796 x 1290 pixels at 460 ppi",camera:"48MP Main | 12MP Ultra Wide | 12MP Telephoto",frontCamera:"12MP TrueDepth camera",storage:"256GB, 512GB, 1TB",memory:"8GB RAM",battery:"4441mAh lithium-ion battery",charging:"USB-C with USB 2",connectivity:"5G (sub-6 GHz and mmWave)",dimensions:"159.9 x 76.7 x 8.25 mm",weight:"221 grams",colors:"Natural Titanium, Blue Titanium, White Titanium, Black Titanium",os:"iOS 17"},c={processor:"A17 Pro chip with 6-core GPU",storage:"256GB, 512GB, 1TB",camera:"48MP Main + 12MP Ultra Wide + 12MP Telephoto",display:"6.7-inch Super Retina XDR",battery:"4441mAh lithium-ion"},d=["A17 Pro chip with 6-core GPU","48MP Main camera with 2x Telephoto","Action button","USB-C connector","Titanium design","Always-On display"]):l.includes("iphone 15 pro")?(n="A3101",o={chip:"A17 Pro chip with 6-core GPU",display:"6.1-inch Super Retina XDR display",resolution:"2556 x 1179 pixels at 460 ppi",camera:"48MP Main | 12MP Ultra Wide | 12MP Telephoto",frontCamera:"12MP TrueDepth camera",storage:"128GB, 256GB, 512GB, 1TB",memory:"8GB RAM",battery:"3274mAh lithium-ion battery",charging:"USB-C with USB 2",connectivity:"5G (sub-6 GHz and mmWave)",dimensions:"146.7 x 71.5 x 8.25 mm",weight:"187 grams",colors:"Natural Titanium, Blue Titanium, White Titanium, Black Titanium",os:"iOS 17"},c={processor:"A17 Pro chip with 6-core GPU",storage:"128GB, 256GB, 512GB, 1TB",camera:"48MP Main + 12MP Ultra Wide + 12MP Telephoto",display:"6.1-inch Super Retina XDR",battery:"3274mAh lithium-ion"},d=["A17 Pro chip with 6-core GPU","48MP Main camera with 2x Telephoto","Action button","USB-C connector","Titanium design","Always-On display"]):l.includes("iphone 14 pro max")?(n="A2894",o={chip:"A16 Bionic chip with 5-core GPU",display:"6.7-inch Super Retina XDR display",resolution:"2796 x 1290 pixels at 460 ppi",camera:"48MP Main | 12MP Ultra Wide | 12MP Telephoto",frontCamera:"12MP TrueDepth camera",storage:"128GB, 256GB, 512GB, 1TB",memory:"6GB RAM",battery:"4323mAh lithium-ion battery",charging:"Lightning connector",connectivity:"5G (sub-6 GHz and mmWave)",dimensions:"160.7 x 77.6 x 7.85 mm",weight:"240 grams",colors:"Space Black, Silver, Gold, Deep Purple",os:"iOS 16"},c={processor:"A16 Bionic chip with 5-core GPU",storage:"128GB, 256GB, 512GB, 1TB",camera:"48MP Main + 12MP Ultra Wide + 12MP Telephoto",display:"6.7-inch Super Retina XDR",battery:"4323mAh lithium-ion"},d=["A16 Bionic chip with 5-core GPU","48MP Main camera with 2x Telephoto","Dynamic Island","Always-On display","Emergency SOS via satellite","Crash Detection"]):l.includes("macbook pro")&&i.includes("m1")?(n="A2338",o={chip:"Apple M1 chip with 8-core CPU and 8-core GPU",display:"13.3-inch Retina display",resolution:"2560 x 1600 pixels",memory:"8GB or 16GB unified memory",storage:"256GB, 512GB, 1TB, or 2TB SSD",battery:"58.2-watt-hour lithium-polymer battery",charging:"61W USB-C Power Adapter",ports:"Two Thunderbolt / USB 4 ports",keyboard:"Backlit Magic Keyboard with Touch Bar",trackpad:"Force Touch trackpad",audio:"Stereo speakers with high dynamic range",camera:"720p FaceTime HD camera",dimensions:"304.1 x 212.4 x 15.6 mm",weight:"1.4 kg (3.0 pounds)",colors:"Space Gray, Silver",os:"macOS Big Sur"},c={processor:"Apple M1 chip with 8-core CPU and 8-core GPU",memory:"8GB or 16GB unified memory",storage:"256GB, 512GB, 1TB, or 2TB SSD",display:"13.3-inch Retina display",battery:"58.2-watt-hour lithium-polymer"},d=["Apple M1 chip with 8-core CPU and 8-core GPU","13.3-inch Retina display","Backlit Magic Keyboard with Touch Bar","Two Thunderbolt / USB 4 ports","Up to 20 hours battery life","Fanless design"]):l.includes("macbook air")&&i.includes("m1")?(n="A2337",o={chip:"Apple M1 chip with 8-core CPU and 7-core GPU",display:"13.3-inch Retina display",resolution:"2560 x 1600 pixels",memory:"8GB or 16GB unified memory",storage:"256GB, 512GB, 1TB, or 2TB SSD",battery:"49.9-watt-hour lithium-polymer battery",charging:"30W USB-C Power Adapter",ports:"Two Thunderbolt / USB 4 ports",keyboard:"Backlit Magic Keyboard",trackpad:"Force Touch trackpad",audio:"Stereo speakers with high dynamic range",camera:"720p FaceTime HD camera",dimensions:"304.1 x 212.4 x 16.1 mm",weight:"1.29 kg (2.8 pounds)",colors:"Space Gray, Silver, Gold",os:"macOS Big Sur"},c={processor:"Apple M1 chip with 8-core CPU and 7-core GPU",memory:"8GB or 16GB unified memory",storage:"256GB, 512GB, 1TB, or 2TB SSD",display:"13.3-inch Retina display",battery:"49.9-watt-hour lithium-polymer"},d=["Apple M1 chip with 8-core CPU and 7-core GPU","13.3-inch Retina display","Backlit Magic Keyboard","Two Thunderbolt / USB 4 ports","Up to 18 hours battery life","Fanless design"]):(n=Ve(t,r),o={chip:"Apple Silicon or Intel processor",display:"Retina display",memory:"8GB or 16GB unified memory",storage:"256GB, 512GB, 1TB SSD",battery:"Lithium-polymer battery",charging:"USB-C Power Adapter",ports:"Thunderbolt / USB 4 ports",keyboard:"Backlit Magic Keyboard",trackpad:"Force Touch trackpad",audio:"Stereo speakers",camera:"FaceTime HD camera",os:"macOS or iOS"},c={processor:"Apple Silicon or Intel processor",memory:"8GB or 16GB unified memory",storage:"256GB, 512GB, 1TB SSD",display:"Retina display",battery:"Lithium-polymer battery"},d=["Apple Silicon or Intel processor","Retina display","Backlit Magic Keyboard","Thunderbolt / USB 4 ports","Long battery life","Premium design"]):l.includes("samsung")||(null==r?void 0:r.toLowerCase().includes("samsung"))?l.includes("galaxy s24 ultra")?(n="SM-S928B",o={chip:"Snapdragon 8 Gen 3 for Galaxy",display:"6.8-inch Dynamic AMOLED 2X",resolution:"3088 x 1440 pixels (QHD+)",refreshRate:"120Hz adaptive refresh rate",camera:"200MP Main | 12MP Ultra Wide | 50MP Telephoto | 10MP Telephoto",frontCamera:"12MP Selfie Camera",storage:"256GB, 512GB, 1TB",memory:"12GB RAM",battery:"5000mAh lithium-ion battery",charging:"45W wired, 15W wireless",connectivity:"5G, Wi-Fi 7, Bluetooth 5.3",dimensions:"163.4 x 79.0 x 8.6 mm",weight:"232 grams",colors:"Titanium Gray, Titanium Black, Titanium Violet, Titanium Yellow",os:"Android 14 with One UI 6.1"},c={processor:"Snapdragon 8 Gen 3 for Galaxy",storage:"256GB, 512GB, 1TB",camera:"200MP Main + 12MP Ultra Wide + 50MP Telephoto + 10MP Telephoto",display:"6.8-inch Dynamic AMOLED 2X",battery:"5000mAh lithium-ion"},d=["Snapdragon 8 Gen 3 for Galaxy","200MP Main camera with 5x optical zoom","S Pen support","Titanium frame","5000mAh battery","AI-powered features"]):(n=Ve(t,r),o={chip:"Snapdragon or Exynos processor",display:"Dynamic AMOLED display",memory:"8GB or 12GB RAM",storage:"128GB, 256GB, 512GB",battery:"Lithium-ion battery",charging:"Fast charging support",connectivity:"5G, Wi-Fi 6, Bluetooth 5.0",camera:"Multi-camera system",os:"Android with One UI"},c={processor:"Snapdragon or Exynos processor",memory:"8GB or 12GB RAM",storage:"128GB, 256GB, 512GB",display:"Dynamic AMOLED display",battery:"Lithium-ion battery"},d=["Snapdragon or Exynos processor","Dynamic AMOLED display","Multi-camera system","Fast charging","5G connectivity","One UI software"]):(n=Ve(t,r),o={processor:"High-performance processor",display:"High-resolution display",memory:"8GB or 16GB RAM",storage:"256GB, 512GB, 1TB",battery:"Lithium-ion battery",connectivity:"Wi-Fi, Bluetooth",dimensions:"Standard dimensions",weight:"Standard weight",os:"Operating system"},c={processor:"High-performance processor",memory:"8GB or 16GB RAM",storage:"256GB, 512GB, 1TB",display:"High-resolution display",battery:"Lithium-ion battery"},d=["High-performance processor","High-resolution display","Ample storage","Long battery life","Fast connectivity","Quality construction"]),{modelIdentifier:n,technicalSpecs:o,specifications:c,features:d}}function Ve(e,t){const s=Date.now().toString().slice(-4);return`${(null==t?void 0:t.toUpperCase().slice(0,3))||"PRD"}${e.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,3)}${s}`}async function Ke(e){try{const t=`${e.name} ${e.model||""} ${e.brand||""} specifications features model identifier`.trim(),s=(function(e,t){let s="";e.forEach(e=>{s+=`${e.title}\n${e.snippet}\n\n`}),s+=`Product: ${t.name}`,t.model&&(s+=`\nModel: ${t.model}`),t.category&&(s+=`\nCategory: ${t.category}`),t.brand&&(s+=`\nBrand: ${t.brand}`)}(await async function(e){return await new Promise(e=>setTimeout(e,1e3)),[{title:`${e} - Official Product Information`,snippet:`Official specifications and features for ${e}. Find detailed information about performance, design, and capabilities.`,url:`https://example.com/products/${encodeURIComponent(e)}`},{title:`${e} Review and Specifications`,snippet:`Comprehensive review of ${e} including technical specifications, performance benchmarks, and user feedback.`,url:`https://techreview.com/${encodeURIComponent(e)}`},{title:`${e} - Technical Specifications`,snippet:`Detailed technical specifications for ${e} including dimensions, weight, materials, and performance data.`,url:`https://specs.com/${encodeURIComponent(e)}`}]}(t),e),await async function(e){await new Promise(e=>setTimeout(e,2e3));const t=qe(e),{name:s,category:a}=e,r=s.toLowerCase();let l="";return l=r.includes("iphone")||r.includes("phone")||(null==a?void 0:a.toLowerCase().includes("phone"))?`${s} (Model ${t.modelIdentifier}) is a premium smartphone featuring cutting-edge technology and innovative design. Built with high-quality materials and advanced engineering, this device delivers exceptional performance for both personal and professional use.`:r.includes("macbook")||r.includes("laptop")||r.includes("computer")||(null==a?void 0:a.toLowerCase().includes("computer"))?`${s} (Model ${t.modelIdentifier}) is a powerful computing solution designed for productivity and performance. Featuring robust hardware and reliable software, this device is perfect for work, gaming, and creative tasks.`:r.includes("cable")||r.includes("wire")||(null==a?void 0:a.toLowerCase().includes("cable"))?`${s} (Model ${t.modelIdentifier}) is a high-quality cable designed for reliable connectivity and data transfer. Built with durable materials and precision engineering, this cable ensures stable connections for various electronic devices.`:`${s} (Model ${t.modelIdentifier}) is a high-quality product designed for optimal performance and reliability. Built with attention to detail and quality materials, this item meets the highest standards for functionality and durability.`,{description:l,specifications:t.specifications,features:t.features,modelIdentifier:t.modelIdentifier,technicalSpecs:t.technicalSpecs,source:"AI-generated based on web search"}}(e));return s}catch(t){const s=qe(e);return{description:`${e.name} (Model ${s.modelIdentifier}) is a quality product designed for optimal performance and reliability.`,modelIdentifier:s.modelIdentifier,technicalSpecs:s.technicalSpecs,specifications:s.specifications,features:s.features,source:"Fallback description"}}}const Qe=({productName:t,productModel:s,categoryName:a,brandName:r,currentDescription:l,onDescriptionGenerated:i,disabled:n=!1})=>{const[c,d]=o.useState(!1),[u,m]=o.useState(null),[x,p]=o.useState(null),[h,g]=o.useState(!1),b=async()=>{if(t.trim()&&!c){d(!0),p(null),m(null);try{const e={name:t,model:s,category:a,brand:r},l=await Ke(e);m(l),g(!0)}catch(e){p("Failed to generate description. Please try again.")}finally{d(!1)}}};return"mock"!==ze.WEB_SEARCH_API||ze.GOOGLE_SEARCH_API_KEY||ze.BING_SEARCH_API_KEY||ze.SERPAPI_KEY||"mock"!==ze.AI_GENERATION_API||ze.OPENAI_API_KEY||ze.ANTHROPIC_API_KEY||ze.GEMINI_API_KEY||!0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:b,disabled:n||c||!t.trim(),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 "+(n||c||!t.trim()?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white shadow-lg hover:shadow-xl"),children:c?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate AI Description"})]})}),c&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(k,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Searching web..."}),e.jsxs("span",{className:"text-xs",children:["(~",3,"s)"]})]})]}),x&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(v,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-700",children:x})]}),u&&h&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gradient-to-br from-blue-50 to-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"AI Generated Description"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:u.source})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{u&&navigator.clipboard.writeText(u.description)},className:"p-1 text-gray-500 hover:text-gray-700 transition-colors",title:"Copy description",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>{m(null),g(!1),b()},className:"p-1 text-gray-500 hover:text-gray-700 transition-colors",title:"Regenerate",children:e.jsx(_,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:u.description})}),u.modelIdentifier&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-2",children:"Model Identifier:"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsx("code",{className:"text-sm font-mono text-blue-800 bg-blue-100 px-2 py-1 rounded",children:u.modelIdentifier})})]}),u.technicalSpecs&&Object.keys(u.technicalSpecs).length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-2",children:"Technical Specifications:"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"space-y-2 text-xs",children:Object.entries(u.technicalSpecs).map(([t,s])=>e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("span",{className:"text-gray-600 capitalize font-medium min-w-[80px]",children:[t,":"]}),e.jsx("span",{className:"text-gray-900 text-right flex-1 ml-2",children:s})]},t))})})]}),u.specifications&&Object.keys(u.specifications).length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-2",children:"Key Specifications:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(u.specifications).slice(0,4).map(([t,s])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600 capitalize",children:[t,":"]}),e.jsx("span",{className:"text-gray-900 font-medium",children:s})]},t))})]}),u.features&&u.features.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-2",children:"Key Features:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:u.features.slice(0,3).map((t,s)=>e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:t},s))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{u&&(i(u.description),g(!1))},className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{children:"Use This Description"})]}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[e.jsx(P,{className:"w-3 h-3"}),e.jsx("span",{children:"AI searches the web using product name and model to generate detailed specifications like Apple's website"})]})]}):null},He=ye({name:ve().min(1,"Product name is required").max(100,"Product name must be less than 100 characters"),description:ve().max(200,"Description must be less than 200 characters").optional(),sku:ve().min(1,"SKU is required").max(50,"SKU must be less than 50 characters"),categoryId:ve().min(1,"Category is required"),condition:ve().optional(),storageRoomId:ve().optional(),shelfId:ve().optional(),price:je().min(0,"Price must be 0 or greater").optional().default(0),costPrice:je().min(0,"Cost price must be 0 or greater").optional().default(0),stockQuantity:je().min(0,"Stock quantity must be 0 or greater").optional().default(0),minStockLevel:je().min(0,"Minimum stock level must be 0 or greater").optional().default(0)}),We=({isOpen:i,onClose:n,productId:c,onProductUpdated:d})=>{var u,m,x,g,b,f;const{categories:y,updateProduct:v,loadCategories:w,getProduct:S}=r(),k=Ce(),[P,C]=o.useState(!1),[_,I]=o.useState(null),[T,B]=o.useState(!1),[$,M]=o.useState(!1),[E,D]=o.useState(!0),[R,O]=o.useState([]),[L,G]=o.useState(!1),[F,U]=o.useState(null);Pe(i);const{control:z,handleSubmit:q,formState:{errors:V,isSubmitting:K},reset:Q,watch:H,setValue:W}=Ne({resolver:Se(He),defaultValues:{name:"",description:"",sku:"",categoryId:"",condition:"new",storageRoomId:"",shelfId:"",price:0,costPrice:0,stockQuantity:0,minStockLevel:0}});if(o.useEffect(()=>{i&&w()},[i]),o.useEffect(()=>{if(c&&i){(async()=>{C(!0);try{const e=await S(c);if(e&&e.data){const t=e.data;I(t),Q({name:t.name,description:t.description||"",sku:t.sku,categoryId:t.categoryId||"",condition:t.condition||"",storageRoomId:"",shelfId:"",price:t.price||0,costPrice:t.costPrice||0,stockQuantity:t.stockQuantity||0,minStockLevel:t.minStockLevel||0});const{data:s,error:r}=await a.from("lats_product_variants").select("*").eq("product_id",c).is("parent_variant_id",null);if(r);else if(s&&s.length>0){const e=s.filter(e=>e&&e.id).map(e=>({id:e.id,sku:e.sku||"",name:e.variant_name||e.name||"",barcode:e.barcode||void 0,price:e.selling_price||0,costPrice:e.cost_price||0,stockQuantity:e.quantity||0,minStockLevel:e.min_quantity||0,attributes:e.variant_attributes||e.attributes||{}}));e.length>0&&(O(e),M(!0))}}else N.error("Failed to load product data"),n()}catch(e){N.error("Failed to load product data"),n()}finally{C(!1)}})()}},[c,i]),!i)return null;if(P||!_)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50 backdrop-blur-sm",onClick:n,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",style:{pointerEvents:"auto"},children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx(CircularProgress,{size:48,strokeWidth:4,color:"blue"}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Loading product data..."})]})})})]});const Y=()=>{Q(),O([]),M(!1),n()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50 backdrop-blur-sm",onClick:Y,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsx("div",{className:"relative w-full max-w-4xl max-h-[90vh] overflow-y-auto",style:{pointerEvents:"auto"},children:e.jsxs(t,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:l(_?"Edit Product":"Add Product")})]}),e.jsx("button",{onClick:Y,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(p,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:q(async e=>{try{if($&&R.length>0){const e=R.map(e=>e.sku).filter(Boolean),t=e.filter((t,s)=>e.indexOf(t)!==s);if(t.length>0)return void N.error(`Duplicate SKU detected: ${t.join(", ")}. Each variant must have a unique SKU.`)}const t={name:e.name,description:e.description,sku:e.sku,categoryId:e.categoryId,condition:e.condition,storageRoomId:e.storageRoomId,shelfId:e.shelfId,...!$&&{price:e.price||0,costPrice:e.costPrice||0,stockQuantity:e.stockQuantity||0,minStockLevel:e.minStockLevel||0},...$&&R.length>0&&{variants:R.filter(e=>e&&e.sku).map(e=>({id:e.id||void 0,sku:e.sku,name:e.name||"",barcode:e.barcode||void 0,costPrice:"string"==typeof e.costPrice?parseFloat(e.costPrice)||0:e.costPrice||0,sellingPrice:"string"==typeof e.price?parseFloat(e.price)||0:e.price||0,price:"string"==typeof e.price?parseFloat(e.price)||0:e.price||0,quantity:"string"==typeof e.stockQuantity?parseInt(e.stockQuantity)||0:e.stockQuantity||0,stockQuantity:"string"==typeof e.stockQuantity?parseInt(e.stockQuantity)||0:e.stockQuantity||0,minQuantity:"string"==typeof e.minStockLevel?parseInt(e.minStockLevel)||0:e.minStockLevel||0,minStockLevel:"string"==typeof e.minStockLevel?parseInt(e.minStockLevel)||0:e.minStockLevel||0,attributes:e.attributes||{}}))}},s=await v(c,t);s.ok?(k.show(`${e.name} has been updated successfully!${$?` with ${R.length} variant(s)`:""}`,{title:"Product Updated! ✅",icon:Ae.productUpdated,autoCloseDelay:3e3}),null==d||d(s.data),Y()):N.error(s.message||"Failed to update product")}catch(t){N.error((null==t?void 0:t.message)||"Failed to update product")}}),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(we,{name:"name",control:z,render:({field:t})=>{var s;return e.jsx(ke,{...t,label:l("Product Name"),placeholder:l("Enter product name"),error:null==(s=V.name)?void 0:s.message})}}),e.jsx(we,{name:"sku",control:z,render:({field:t})=>{var s;return e.jsx(ke,{...t,label:l("SKU"),placeholder:l("Enter SKU"),error:null==(s=V.sku)?void 0:s.message})}})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(we,{name:"categoryId",control:z,render:({field:t})=>{var s,a;return e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium "+((null==(s=V.categoryId)?void 0:s.message)?"text-red-600":"text-gray-700"),children:[l("Category")," *"]}),e.jsx(Ie,{value:t.value||"",onChange:t.onChange,placeholder:l("Search categories..."),categories:y||[],required:!0,error:null==(a=V.categoryId)?void 0:a.message,className:"w-full"})]})}})}),e.jsx(me,{formData:{storageRoomId:H("storageRoomId")||"",shelfId:H("shelfId")||""},setFormData:e=>{const t="function"==typeof e?e({storageRoomId:H("storageRoomId"),shelfId:H("shelfId")}):e;W("storageRoomId",t.storageRoomId),W("shelfId",t.shelfId)},currentErrors:{storageRoomId:(null==(u=V.storageRoomId)?void 0:u.message)||"",shelfId:(null==(m=V.shelfId)?void 0:m.message)||""}}),!$&&e.jsx(Te,{formData:{price:H("price"),costPrice:H("costPrice"),stockQuantity:H("stockQuantity"),minStockLevel:H("minStockLevel")},setFormData:e=>{const t={price:H("price"),costPrice:H("costPrice"),stockQuantity:H("stockQuantity"),minStockLevel:H("minStockLevel")},s="function"==typeof e?e(t):e;void 0!==s.price&&W("price",s.price),void 0!==s.costPrice&&W("costPrice",s.costPrice),void 0!==s.stockQuantity&&W("stockQuantity",s.stockQuantity),void 0!==s.minStockLevel&&W("minStockLevel",s.minStockLevel)},currentErrors:{price:(null==(x=V.price)?void 0:x.message)||"",costPrice:(null==(g=V.costPrice)?void 0:g.message)||"",stockQuantity:(null==(b=V.stockQuantity)?void 0:b.message)||"",minStockLevel:(null==(f=V.minStockLevel)?void 0:f.message)||""}}),$&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Variants Mode Enabled"}),e.jsx("p",{className:"mt-1 text-sm text-blue-700",children:"Pricing and stock are managed individually for each variant below. Product-level pricing is not used when variants are enabled."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(we,{name:"description",control:z,render:({field:t})=>{var s,a,r,i,n,o;return e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium "+((null==(s=V.description)?void 0:s.message)?"text-red-600":"text-gray-700"),children:l("Description")}),e.jsxs("div",{className:"relative",children:[T?e.jsx("textarea",{...t,onBlur:()=>{t.onBlur(),B(!1)},className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-all duration-200 resize-none "+((null==(a=V.description)?void 0:a.message)?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"),placeholder:l("Enter detailed description..."),maxLength:200,rows:4,autoFocus:!0}):e.jsx("input",{...t,type:"text",onFocus:()=>{B(!0)},className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-all duration-200 "+((null==(r=V.description)?void 0:r.message)?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"),placeholder:l("Enter product description"),maxLength:200}),e.jsx(j,{className:"absolute left-3 text-gray-500 transition-all duration-200 "+(T?"top-4":"top-1/2 -translate-y-1/2"),size:16})]}),(null==(i=V.description)?void 0:i.message)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:V.description.message}),e.jsx("div",{className:"mt-4",children:e.jsx(Qe,{productName:H("name"),categoryName:(null==(n=null==y?void 0:y.find(e=>(null==e?void 0:e.id)===H("categoryId")))?void 0:n.name)||"",currentDescription:H("description")||"",onDescriptionGenerated:e=>W("description",e),disabled:!(null==(o=H("name"))?void 0:o.trim())})})]})}}),e.jsx(we,{name:"condition",control:z,render:({field:t})=>{var s,a;return e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 font-medium "+((null==(s=V.condition)?void 0:s.message)?"text-red-600":"text-gray-700"),children:[l("Condition")," *"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"new",label:l("New"),color:"bg-green-500 hover:bg-green-600"},{value:"used",label:l("Used"),color:"bg-blue-500 hover:bg-blue-600"},{value:"refurbished",label:l("Refurbished"),color:"bg-purple-500 hover:bg-purple-600"}].map(s=>e.jsx("button",{type:"button",onClick:()=>t.onChange(s.value),className:"px-3 py-3 text-sm font-medium rounded-lg border-2 transition-colors "+(t.value===s.value?`${s.color} text-white border-transparent shadow-md`:"bg-white/30 backdrop-blur-md text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400"),children:s.label},s.value))}),(null==(a=V.condition)?void 0:a.message)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:V.condition.message})]})}})]}),e.jsx("div",{className:"border-t border-gray-200 pt-6",children:e.jsx(xe,{variants:R,setVariants:O,useVariants:$,setUseVariants:M,showVariants:E,setShowVariants:D,isReorderingVariants:L,setIsReorderingVariants:G,draggedVariantIndex:F,setDraggedVariantIndex:U,onVariantSpecificationsClick:e=>{var t;N.success(`Edit specifications for ${(null==(t=R[e])?void 0:t.name)||`Variant ${e+1}`}`)},baseSku:H("sku")||""})}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[e.jsx(s,{type:"button",onClick:Y,variant:"secondary",disabled:K||P,children:l("Cancel")}),e.jsx(s,{type:"submit",disabled:K||P,className:"flex items-center space-x-2",children:K||P?e.jsxs(e.Fragment,{children:[e.jsx(CircularProgress,{size:16,strokeWidth:2,color:"white"}),e.jsx("span",{children:l("Saving...")})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:l("Save Changes")})]})})]})]})]})})}),e.jsx(_e,{...k.props})]})},Ye=({isOpen:a,onClose:r,product:l,formatMoney:i})=>{const{isConnected:n,isPrinting:c,printLabel:d,connectedDevice:u}=De();Pe(a);const[m,x]=o.useState({title:l.name,barcode:l.barcode||l.sku,qrCode:`https://latschance.com/product/${l.id}`,text:`${l.brand||""} ${l.category||""}`.trim(),price:i(l.price),sku:l.sku,size:l.size||"",color:l.color||""}),[h,g]=o.useState(1);if(!a)return null;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:r,children:e.jsxs(t,{className:"max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(I,{className:"w-6 h-6"}),"Print Product Label"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Print label for ",l.name]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(p,{className:"w-6 h-6 text-gray-500"})})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full "+(n?"bg-green-100":"bg-gray-100"),children:n?e.jsx(T,{className:"w-4 h-4 text-green-600"}):e.jsx(p,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:n?"Bluetooth Printer Connected":"Bluetooth Printer Not Connected"}),e.jsx("p",{className:"text-xs text-gray-600",children:n?null==u?void 0:u.name:"Connect a Bluetooth printer to print labels"})]})]}),!n&&e.jsx(s,{onClick:()=>window.open("/bluetooth-printer","_blank"),variant:"primary",size:"sm",children:"Connect Printer"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Label Preview"}),e.jsx("div",{className:"border-2 border-gray-300 rounded-lg p-4 bg-white",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-lg font-bold",children:m.title}),m.text&&e.jsx("div",{className:"text-sm text-gray-600",children:m.text}),m.barcode&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-mono",children:m.barcode})]}),m.qrCode&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-gray-500"}),e.jsx("img",{src:(b=m.qrCode,`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(b)}`),alt:"QR Code",className:"w-16 h-16"})]}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:m.price}),e.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",m.sku]}),(m.size||m.color)&&e.jsx("div",{className:"text-sm text-gray-600",children:[m.size,m.color].filter(Boolean).join(" | ")})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Label Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:m.title,onChange:e=>x({...m,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price"}),e.jsx("input",{type:"text",value:m.price,onChange:e=>x({...m,price:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"QrCode"}),e.jsx("input",{type:"text",value:m.barcode,onChange:e=>x({...m,barcode:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU"}),e.jsx("input",{type:"text",value:m.sku,onChange:e=>x({...m,sku:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Size"}),e.jsx("input",{type:"text",value:m.size,onChange:e=>x({...m,size:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color"}),e.jsx("input",{type:"text",value:m.color,onChange:e=>x({...m,color:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:m.text,onChange:e=>x({...m,text:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Copies"}),e.jsx("input",{type:"number",min:"1",max:"10",value:h,onChange:e=>g(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs(s,{onClick:async()=>{try{await d(m)}catch(e){alert("Failed to print label. Please check your printer connection.")}},variant:"primary",disabled:!n||c,className:"w-full py-4 text-lg font-semibold",children:[e.jsx(T,{className:"w-5 h-5 mr-2"}),c?"Printing...":"Print Label"+(h>1?` (${h} copies)`:"")]})})]})});var b},Ze=o.memo(({products:a,metrics:l,setSearchQuery:i,selectedCategory:n,setSelectedCategory:d,selectedStatus:u,setSelectedStatus:m,showLowStockOnly:x,setShowLowStockOnly:g,showFeaturedOnly:f,setShowFeaturedOnly:v,viewMode:j,setViewMode:w,sortBy:S,setSortBy:k,selectedProducts:P,setSelectedProducts:_,categories:A,formatMoney:I,getStatusColor:Y,handleBulkAction:Z,setShowStockAdjustModal:X,setSelectedProductForHistory:J,setShowDeleteConfirmation:ee,toggleProductSelection:te,toggleSelectAll:se,productModals:ae,navigate:re,deleteProduct:le})=>{const ie=e=>e>=1e9?`TSh ${(e/1e9).toFixed(1)}B`:e>=1e6?`TSh ${(e/1e6).toFixed(1)}M`:e>=1e3?`TSh ${(e/1e3).toFixed(1)}K`:`TSh ${e.toFixed(0)}`,[ne,oe]=o.useState(!1),[ce,de]=o.useState(null),[ue,me]=o.useState(!1),[xe,he]=o.useState(null);o.useState({current:0,total:0,action:""});const[ge,be]=o.useState(!1),[fe,ye]=o.useState(""),[ve,je]=o.useState(null);o.useState(!1),o.useState(null);const[Ne,we]=o.useState(!1),[Se,ke]=o.useState(!1),Pe=[{id:"product",label:"Product",required:!0},{id:"sku",label:"SKU",required:!1},{id:"category",label:"Category",required:!1},{id:"supplier",label:"Supplier",required:!1},{id:"shelf",label:"Shelf",required:!1},{id:"price",label:"Price",required:!1},{id:"stock",label:"Stock",required:!1},{id:"actions",label:"Actions",required:!0}],[Ce,_e]=o.useState(()=>{try{const e=localStorage.getItem("inventory-visible-columns");return e?JSON.parse(e):Pe.map(e=>e.id)}catch{return Pe.map(e=>e.id)}}),[Ae,Ie]=o.useState(!1);o.useEffect(()=>{(null==a?void 0:a.length)>0&&Ae&&Ie(!1)},[a,Ae]);const[Te,De]=o.useState(!1);o.useEffect(()=>{a&&a.length,0},[a,Te]);const[Oe,Le]=c.useState("detailed"),[Ge,Fe]=c.useState(!1),[Ue,ze]=c.useState(()=>{try{const e=localStorage.getItem("inventory-grid-columns");return e?parseInt(e):4}catch{return 4}});c.useEffect(()=>{try{localStorage.setItem("inventory-grid-columns",Ue.toString())}catch(e){}},[Ue]),c.useEffect(()=>{try{localStorage.setItem("inventory-visible-columns",JSON.stringify(Ce))}catch(e){}},[Ce]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:[e.jsx(t,{className:"bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Products"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[l.totalItems," ",e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",l.activeProducts," active)"]})]})]}),e.jsx("div",{className:"p-2 bg-blue-50/20 rounded-full",children:e.jsx(h,{className:"w-5 h-5 text-blue-600"})})]})}),e.jsx(t,{className:"bg-gradient-to-br from-orange-50 to-orange-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"In Stock"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:[l.totalItems-l.lowStockItems-l.outOfStockItems," ",e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",l.lowStockItems," low, ",l.outOfStockItems," out)"]})]})]}),e.jsx("div",{className:"p-2 bg-orange-50/20 rounded-full",children:e.jsx(y,{className:"w-5 h-5 text-orange-600"})})]})}),e.jsx(t,{className:"bg-gradient-to-br from-red-50 to-red-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Reorder Alerts"}),e.jsxs("p",{className:"text-2xl font-bold text-red-900",children:[l.reorderAlerts," ",e.jsx("span",{className:"text-sm font-normal text-gray-600",children:"(Need attention)"})]})]}),e.jsx("div",{className:"p-2 bg-red-50/20 rounded-full",children:e.jsx($,{className:"w-5 h-5 text-red-600"})})]})}),e.jsx(t,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[ie(l.totalValue)," ",e.jsx("span",{className:"text-sm font-normal text-gray-600",children:"(Cost)"})]})]}),e.jsx("div",{className:"p-2 bg-green-50/20 rounded-full",children:e.jsx(M,{className:"w-5 h-5 text-green-600"})})]})}),e.jsx(t,{className:"bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Retail Value"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:[ie(l.retailValue||0)," ",e.jsx("span",{className:"text-sm font-normal text-gray-600",children:"(Selling)"})]})]}),e.jsx("div",{className:"p-2 bg-purple-50/20 rounded-full",children:e.jsx(E,{className:"w-5 h-5 text-purple-600"})})]})})]}),e.jsx("div",{className:"bg-white/60 backdrop-blur-sm rounded-lg border border-white/20 p-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(Be,{onSearch:i,placeholder:"Search products, SKU, brand...",className:"w-full",suggestions:[...a.map(e=>e.name),...a.map(e=>{var t,s;return(null==(s=null==(t=e.variants)?void 0:t[0])?void 0:s.sku)||""}).filter(Boolean),...a.map(e=>{var t;return(null==(t=A.find(t=>t.id===e.categoryId))?void 0:t.name)||""}).filter(Boolean)],searchKey:"enhanced_inventory_search"})}),(qe=A,Ve=n,Ke=d,Qe="Category",He=(null==A?void 0:A.length)||0,e.jsx("div",{className:"min-w-[120px]",children:e.jsx($e,{options:[{value:"all",label:`All ${Qe}s`},...(qe||[]).map(e=>({value:e.name,label:e.name}))],value:Ve,onChange:Ke,placeholder:`${Qe} (${He})`})})),e.jsx("div",{className:"min-w-[100px]",children:e.jsxs("select",{value:u,onChange:e=>m(e.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-200 rounded-md bg-white/80 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"in-stock",children:"In Stock"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"out-of-stock",children:"Out of Stock"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})}),e.jsx("div",{className:"min-w-[100px]",children:e.jsxs("select",{value:S,onChange:e=>k(e.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-200 rounded-md bg-white/80 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"price",children:"Price (High to Low)"}),e.jsx("option",{value:"stock",children:"Stock Level"}),e.jsx("option",{value:"created",children:"Recently Added"}),e.jsx("option",{value:"updated",children:"Recently Updated"})]})}),e.jsx("button",{onClick:()=>w("grid"===j?"list":"grid"),className:"px-2 py-1.5 border border-gray-200 rounded-md hover:bg-gray-50 transition-colors",title:`Switch to ${"grid"===j?"list":"grid"} view`,children:"grid"===j?e.jsx(D,{size:16}):e.jsx(R,{size:16})}),"grid"===j&&e.jsx("button",{onClick:()=>Le("detailed"===Oe?"default":"detailed"),className:"px-2 py-1.5 border border-gray-200 rounded-md hover:bg-gray-50 transition-colors",title:`Switch to ${"detailed"===Oe?"compact":"detailed"} cards`,children:"detailed"===Oe?e.jsx(h,{size:16}):e.jsx(R,{size:16})}),"list"===j&&e.jsx("button",{onClick:()=>we(!0),className:"px-2 py-1.5 border border-gray-200 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-1",title:"Customize columns",children:e.jsx(O,{size:16})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:e=>g(e.target.checked),className:"w-3 h-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-600",children:"Low Stock"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:e=>v(e.target.checked),className:"w-3 h-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-600",children:"Featured"})]})]})]})}),P.length>0&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-5 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-600 text-white rounded-full p-2",children:e.jsx(y,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-bold text-blue-900",children:[P.length," product",1!==P.length?"s":""," selected"]}),e.jsx("div",{className:"text-xs text-blue-700",children:"Choose an action below"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>Z("export"),className:"flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Export selected products to CSV",children:[e.jsx(b,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),e.jsxs("button",{onClick:()=>Z("feature"),className:"flex items-center gap-2 px-4 py-2.5 bg-yellow-500 text-white rounded-lg text-sm font-medium hover:bg-yellow-600 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Toggle featured status",children:[e.jsx(L,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Feature"})]}),e.jsxs("button",{onClick:()=>Z("activate"),className:"flex items-center gap-2 px-4 py-2.5 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Activate selected products",children:[e.jsx(G,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Activate"})]}),e.jsxs("button",{onClick:()=>Z("deactivate"),className:"flex items-center gap-2 px-4 py-2.5 bg-orange-600 text-white rounded-lg text-sm font-medium hover:bg-orange-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Deactivate selected products",children:[e.jsx(F,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Deactivate"})]}),e.jsxs("button",{onClick:()=>{var e,t,s,r,l,i,n,o,c,d,u,m,x,p;const h=a.find(e=>P.includes(e.id));h?(de({id:h.id,name:h.name,sku:(null==(t=null==(e=h.variants)?void 0:e[0])?void 0:t.sku)||h.id,barcode:(null==(r=null==(s=h.variants)?void 0:s[0])?void 0:r.sku)||h.id,price:(null==(i=null==(l=h.variants)?void 0:l[0])?void 0:i.sellingPrice)||0,size:(null==(c=null==(o=null==(n=h.variants)?void 0:n[0])?void 0:o.attributes)?void 0:c.size)||"",color:(null==(m=null==(u=null==(d=h.variants)?void 0:d[0])?void 0:u.attributes)?void 0:m.color)||"",brand:(null==(x=h.brand)?void 0:x.name)||"",category:(null==(p=A.find(e=>e.id===h.categoryId))?void 0:p.name)||""}),oe(!0)):N.error("Please select at least one product")},className:"flex items-center gap-2 px-4 py-2.5 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Print product labels",children:[e.jsx(T,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Labels"})]}),e.jsxs("button",{onClick:()=>Z("duplicate"),className:"flex items-center gap-2 px-4 py-2.5 bg-teal-600 text-white rounded-lg text-sm font-medium hover:bg-teal-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Duplicate selected products",children:[e.jsx(U,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Duplicate"})]}),e.jsxs("button",{onClick:()=>ee(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Delete all selected products",children:[e.jsx(z,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Delete"})]}),e.jsxs("button",{onClick:()=>_([]),className:"flex items-center gap-2 px-4 py-2.5 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700 active:scale-95 transition-all shadow-md hover:shadow-lg",title:"Clear selection",children:[e.jsx(q,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Clear"})]})]})]})}),"list"===j?e.jsx(t,{className:"overflow-visible",children:e.jsx("div",{className:"overflow-x-auto overflow-y-visible",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200/50",children:[e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:e.jsx("input",{type:"checkbox",checked:P.length===a.length&&a.length>0,onChange:se,className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2"})}),Ce.includes("product")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Product"}),Ce.includes("sku")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"SKU"}),Ce.includes("category")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Category"}),Ce.includes("supplier")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Supplier"}),Ce.includes("shelf")&&e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Shelf"}),Ce.includes("price")&&e.jsx("th",{className:"text-right py-4 px-4 font-medium text-gray-700",children:"Price"}),Ce.includes("stock")&&e.jsx("th",{className:"text-right py-4 px-4 font-medium text-gray-700",children:"Stock"}),Ce.includes("actions")&&e.jsx("th",{className:"text-center py-4 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(t=>{var s,a,l,i,n,o;const c=A.find(e=>e.id===t.categoryId),d=(()=>{if(!t.variants||0===t.variants.length)return null;const e=t.variants.find(e=>(e.quantity||0)>0);if(e)return e;const s=[...t.variants].sort((e,t)=>(t.sellingPrice||0)-(e.sellingPrice||0))[0];return s&&s.sellingPrice>0?s:t.variants[0]})(),u=t.variants&&t.variants.length>0,m=u?t.variants.reduce((e,t)=>e+(t.quantity||0),0):0,x=u?m:t.stockQuantity||t.stock_quantity||0,p=(null==(s=t.variants)?void 0:s.reduce((e,t)=>e+(t.reservedQuantity||t.reserved_quantity||0),0))||0,g=x-p,b=g<=0?"out-of-stock":g<=10?"low-stock":"in-stock";return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-blue-50 transition-colors cursor-pointer group",onClick:async()=>{ke(!0);try{const e=await r.getState().getProduct(t.id);if(!(null==e?void 0:e.ok)||!(null==e?void 0:e.data))return ke(!1),void alert("Failed to load product details. Please try again.");if(!e.data.variants||0===e.data.variants.length)return ke(!1),void alert(`Product "${t.name}" has no variants. Please add at least one variant to this product first.`);he(e.data),me(!0)}finally{setTimeout(()=>ke(!1),100)}},title:"Click to view product details",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"checkbox",checked:P.includes(t.id),onChange:e=>{e.stopPropagation(),te(t.id)},className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2"})}),Ce.includes("product")&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[t.images&&t.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border-2 border-blue-200 bg-white",children:e.jsx("img",{src:t.images[0],alt:t.name,className:"w-full h-full object-cover",onError:e=>{var s;const a=(null==(s=t.variants)?void 0:s.length)||0;e.currentTarget.style.display="none",e.currentTarget.parentElement.innerHTML='\n                                          <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center border-2 border-blue-200">\n                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500">\n                                              <path d="M16.5 9.4 7.55 4.24"></path>\n                                              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>\n                                              <polyline points="3.29 7 12 12 20.71 7"></polyline>\n                                              <line x1="12" x2="12" y1="22" y2="12"></line>\n                                            </svg>\n                                          </div>\n                                        ';const r=document.createElement("div");r.className="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",r.innerHTML='<span class="text-xs font-bold text-white">'+a+"</span>",e.currentTarget.parentElement.parentElement.appendChild(r)}})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center z-10",children:e.jsx("span",{className:"text-xs font-bold text-white",children:(null==(a=t.variants)?void 0:a.length)||0})})]}):e.jsxs("div",{className:"w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center border-2 border-blue-200 relative",children:[e.jsx(h,{className:"w-6 h-6 text-blue-500",strokeWidth:2}),e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:(null==(l=t.variants)?void 0:l.length)||0})})]}),t.isFeatured&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center border-2 border-white",children:e.jsx(L,{className:"w-3 h-3 text-white fill-current"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[250px]",title:t.name,children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 truncate max-w-[300px]",children:t.description}),(null==d?void 0:d.sku)&&e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["SKU: ",d.sku]})]})]})}),Ce.includes("sku")&&e.jsx("td",{className:"py-3 px-4",children:e.jsx("button",{onClick:e=>{e.stopPropagation(),ye((null==d?void 0:d.sku)||t.sku||"N/A"),be(!0)},className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 transition-colors",title:"View QR Code",children:e.jsx(B,{size:18})})}),Ce.includes("category")&&e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-blue-500 text-white shadow-sm inline-block max-w-[150px] truncate",title:(null==c?void 0:c.name)||"Uncategorized",children:(null==c?void 0:c.name)||"Uncategorized"})}),Ce.includes("supplier")&&e.jsx("td",{className:"py-3 px-4",children:(null==(n=null==(i=t.supplier)?void 0:i.name)?void 0:n.startsWith("Trade-In:"))?e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-blue-600",children:t.supplier.name.replace("Trade-In: ","")}),e.jsx("div",{className:"text-xs text-gray-500",children:"Trade-In Customer"})]}):e.jsx("span",{className:"text-sm text-gray-600",children:(null==(o=t.supplier)?void 0:o.name)||"N/A"})}),Ce.includes("shelf")&&e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-sm text-gray-600",children:t.shelfName||t.shelfCode||"N/A"})}),Ce.includes("price")&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:I((null==d?void 0:d.sellingPrice)||0)}),(null==d?void 0:d.costPrice)&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Cost: ",I(d.costPrice)]})]})}),Ce.includes("stock")&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold shadow-sm inline-block max-w-[120px] truncate "+("out-of-stock"===b?"bg-red-500 text-white":"low-stock"===b?"bg-orange-500 text-white":"bg-green-500 text-white"),title:`${g} in stock${p>0?` (${p} reserved)`:""}`,children:[g," in stock"]}),p>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1 truncate max-w-[120px]",title:`${p} reserved`,children:[p," reserved"]})]})}),Ce.includes("actions")&&e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),je(ve===t.id?null:t.id)},className:"p-2 text-gray-600 hover:text-white hover:bg-blue-500 rounded-lg transition-all duration-200 hover:shadow-md",title:"Actions",children:e.jsx(V,{className:"w-5 h-5"})}),ve===t.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[998]",onClick:e=>{e.stopPropagation(),je(null)}}),e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-2xl border border-gray-100 z-[999] overflow-hidden",children:e.jsxs("div",{className:"py-2",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),re(`/lats/products/${t.id}/edit`),je(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-blue-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 group-hover:bg-blue-500 flex items-center justify-center transition-colors",children:e.jsx(K,{className:"w-4 h-4 text-blue-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-blue-600",children:"Edit Product"})]}),e.jsxs("button",{onClick:async e=>{e.stopPropagation();const s=await r.getState().getProduct(t.id);he(s||t),me(!0),je(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-green-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 group-hover:bg-green-500 flex items-center justify-center transition-colors",children:e.jsx(Q,{className:"w-4 h-4 text-green-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-green-600",children:"View Details"})]}),e.jsx("div",{className:"my-1 border-t border-gray-100"}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),J(t.id),X(!0),je(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-orange-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-orange-100 group-hover:bg-orange-500 flex items-center justify-center transition-colors",children:e.jsx(H,{className:"w-4 h-4 text-orange-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-orange-600",children:"Adjust Stock"})]}),e.jsxs("button",{onClick:e=>{var s,a,r,l,i,n,o,c,d,u,m,x,p,h;e.stopPropagation(),de({id:t.id,name:t.name,sku:(null==(a=null==(s=t.variants)?void 0:s[0])?void 0:a.sku)||t.id,barcode:(null==(l=null==(r=t.variants)?void 0:r[0])?void 0:l.sku)||t.id,price:(null==(n=null==(i=t.variants)?void 0:i[0])?void 0:n.sellingPrice)||0,size:(null==(d=null==(c=null==(o=t.variants)?void 0:o[0])?void 0:c.attributes)?void 0:d.size)||"",color:(null==(x=null==(m=null==(u=t.variants)?void 0:u[0])?void 0:m.attributes)?void 0:x.color)||"",brand:(null==(p=t.brand)?void 0:p.name)||"",category:(null==(h=A.find(e=>e.id===t.categoryId))?void 0:h.name)||""}),oe(!0),je(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-purple-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-100 group-hover:bg-purple-500 flex items-center justify-center transition-colors",children:e.jsx(T,{className:"w-4 h-4 text-purple-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-purple-600",children:"Print Label"})]}),e.jsx("div",{className:"my-1 border-t border-gray-100"}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),(e=>{var t;try{const s={productId:e.id,productName:e.name,variants:(null==(t=e.variants)?void 0:t.map(t=>{var s;return{id:t.id,variant_name:t.name||(null==(s=t.attributes)?void 0:s.color)||"Default",sku:t.sku,quantity:t.quantity||0,selling_price:t.sellingPrice||t.price||0,cost_price:t.costPrice||0,product_id:e.id,product:{name:e.name}}}))||[]};sessionStorage.setItem("preselectedTransferProduct",JSON.stringify(s)),re("/lats/stock-transfers?autoOpen=true"),N.success(`Product "${e.name}" ready for transfer`)}catch(s){N.error("Failed to prepare stock transfer")}})(t),je(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-indigo-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-100 group-hover:bg-indigo-500 flex items-center justify-center transition-colors",children:e.jsx(W,{className:"w-4 h-4 text-indigo-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-indigo-600",children:"Stock Transfer"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),(async e=>{var t;try{const s={...e,name:`${e.name} (Copy)`,id:void 0,variants:null==(t=e.variants)?void 0:t.map((e,t)=>{var s;return{...e,id:void 0,sku:`${e.sku}-COPY-${Date.now()}-${t}`,name:`${e.name||(null==(s=e.attributes)?void 0:s.color)||"Variant"} (Copy)`}})};sessionStorage.setItem("duplicateProductData",JSON.stringify(s)),re("/lats/add-product?duplicate=true"),N.success("Opening duplicate product form...")}catch(s){N.error("Failed to duplicate product")}})(t),je(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-teal-50 flex items-center gap-3 transition-all duration-200 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-teal-100 group-hover:bg-teal-500 flex items-center justify-center transition-colors",children:e.jsx(C,{className:"w-4 h-4 text-teal-600 group-hover:text-white"})}),e.jsx("span",{className:"font-medium group-hover:text-teal-600",children:"Duplicate"})]})]})})]})]})})]},t.id)})})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(t,{className:"mb-4 bg-gradient-to-r from-gray-50 to-blue-50 border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[a.length," Products"]})]}),P.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[P.length," Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Ge?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:se,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 rounded-lg transition-colors",children:P.length===a.length&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4"}),"Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4"}),"Select All"]})}),e.jsxs("button",{onClick:()=>{Fe(!1),_([])},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-white text-red-600 hover:bg-red-50 border border-red-300 rounded-lg transition-colors",children:[e.jsx(q,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs("button",{onClick:()=>Fe(!0),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 border border-blue-600 rounded-lg transition-colors shadow-sm",children:[e.jsx(y,{className:"w-4 h-4"}),"Select"]}),"default"===Oe&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Per Row:"}),e.jsx("input",{type:"number",min:"1",max:"12",value:Ue,onChange:e=>{const t=parseInt(e.target.value);t>=1&&t<=12&&ze(t)},className:"w-16 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("button",{onClick:()=>Le("detailed"===Oe?"default":"detailed"),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 rounded-lg transition-colors",title:`Switch to ${"detailed"===Oe?"compact":"detailed"} view`,children:"detailed"===Oe?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4"}),"Compact"]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4"}),"Detailed"]})})]})]})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"detailed"===Oe?"repeat(auto-fit, minmax(min(280px, 100%), 1fr))":`repeat(${Ue}, minmax(0, 1fr))`,gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},children:a.map(t=>{const s=A.find(e=>e.id===t.categoryId),a=t.brand;return e.jsx(Ee,{product:{...t,categoryName:null==s?void 0:s.name,brandName:null==a?void 0:a.name},className:"w-full h-full",onView:async e=>{ke(!0);try{const t=await r.getState().getProduct(e.id);if(!(null==t?void 0:t.ok)||!(null==t?void 0:t.data))return ke(!1),void alert("Failed to load product details. Please try again.");if(!t.data.variants||0===t.data.variants.length)return ke(!1),void alert(`Product "${e.name}" has no variants. Please add at least one variant to this product first.`);he(t.data),me(!0)}finally{setTimeout(()=>ke(!1),100)}},onEdit:e=>{re(`/lats/products/${e.id}/edit`)},onDelete:e=>{confirm("Are you sure you want to delete this product?")&&le(e.id)},showActions:!0,variant:Oe,isSelected:P.includes(t.id),onSelect:te,showCheckbox:Ge},t.id)})})]}),0===a.length&&e.jsxs(t,{className:"text-center py-12",children:[e.jsx(h,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search or filter criteria"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsx(s,{onClick:()=>re("/lats/add-product"),icon:e.jsx(h,{size:18}),children:"Add Your First Product"})})]}),ce&&e.jsx(Ye,{isOpen:ne,onClose:()=>{oe(!1),de(null)},product:ce,formatMoney:I}),xe&&e.jsx(pe,{isOpen:ue,onClose:()=>{me(!1),he(null)},product:xe,onEdit:e=>{me(!1),he(null),re(`/lats/products/${e.id}/edit`)}}),ge&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 relative",children:[e.jsx("button",{onClick:()=>be(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(p,{size:24})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Product QR Code"}),e.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-gray-200 inline-block mb-4",children:e.jsx(Re,{value:fe,size:200,level:"H"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"SKU"}),e.jsx("p",{className:"font-mono text-lg font-semibold text-gray-900",children:fe})]})]})]})}),Ne&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full p-6 relative",children:[e.jsx("button",{onClick:()=>we(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(p,{size:24})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Customize Columns"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose which columns to display in the table"})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:Pe.map(t=>e.jsxs("label",{className:"flex items-center gap-3 p-4 rounded-lg border transition-all "+(t.required?"cursor-not-allowed bg-gray-50 border-gray-200":"cursor-pointer hover:bg-blue-50 border-gray-200 hover:border-blue-300"),children:[e.jsx("input",{type:"checkbox",checked:Ce.includes(t.id),onChange:()=>(e=>{const t=Pe.find(t=>t.id===e);(null==t?void 0:t.required)||_e(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(t.id),disabled:t.required,className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.label}),t.required&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(always visible)"})]}),t.required&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]},t.id))}),e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{_e(Pe.map(e=>e.id)),N.success("All columns enabled")},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Show All Columns"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>we(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>we(!1),className:"px-4 py-2 text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors",children:"Done"})]})]})]})}),Se&&e.jsx(Me,{})]});var qe,Ve,Ke,Qe,He},(e,t)=>{const s=["products","metrics","categories","selectedProducts","selectedCategory","selectedStatus","showLowStockOnly","showFeaturedOnly","viewMode","sortBy"];for(const a of s)if(e[a]!==t[a])return!1;return!0}),Xe=({navigate:a,useInventoryStore:r})=>{const{confirm:l}=Le(),{purchaseOrders:i,isLoading:n,error:c,loadPurchaseOrders:d,deletePurchaseOrder:u,receivePurchaseOrder:m,approvePurchaseOrder:x,updatePurchaseOrder:g,suppliers:f,loadSuppliers:j}=r(),[w,S]=o.useState(""),[P,C]=o.useState("all"),[A,I]=o.useState("createdAt"),[B,$]=o.useState("desc"),[E,O]=o.useState(null),[L,F]=o.useState("list"),[U,V]=o.useState(25),[K,H]=o.useState(25),W=o.useRef(null),[le,ie]=o.useState(new Set),[ne,oe]=o.useState(!1),[ce,de]=o.useState(!1),[ue,me]=o.useState(""),[xe,pe]=o.useState(""),[he,ge]=o.useState("all"),[be,fe]=o.useState("all"),[ye,ve]=o.useState(""),[je,Ne]=o.useState("");o.useState(!1),o.useState(null);const we=async()=>{Date.now();try{await d(),await j();Date.now();O(new Date)}catch(e){}};o.useEffect(()=>{we();const e=setInterval(()=>{we()},3e4);return()=>clearInterval(e)},[]);const Se=o.useMemo(()=>{let e=i||[];if(w&&(e=e.filter(e=>{var t,s,a;return e.orderNumber.toLowerCase().includes(w.toLowerCase())||(null==(s=null==(t=e.supplier)?void 0:t.name)?void 0:s.toLowerCase().includes(w.toLowerCase()))||(null==(a=e.notes)?void 0:a.toLowerCase().includes(w.toLowerCase()))})),"all"!==P&&(e=e.filter(e=>e.status===P)),"all"!==he&&(e=e.filter(e=>e.supplierId===he)),"all"!==be&&(e=e.filter(e=>(e.payment_status||e.paymentStatus||"unpaid")===be)),ue){const t=new Date(ue);e=e.filter(e=>new Date(e.createdAt)>=t)}if(xe){const t=new Date(xe);t.setHours(23,59,59),e=e.filter(e=>new Date(e.createdAt)<=t)}if(ye){const t=parseFloat(ye);e=e.filter(e=>(e.totalAmount||0)>=t)}if(je){const t=parseFloat(je);e=e.filter(e=>(e.totalAmount||0)<=t)}return e.sort((e,t)=>{let s,a;switch(A){case"orderNumber":s=e.orderNumber,a=t.orderNumber;break;case"totalAmount":s=e.totalAmount||0,a=t.totalAmount||0;break;default:s=new Date(e.createdAt).getTime(),a=new Date(t.createdAt).getTime()}return"asc"===B?s>a?1:-1:s<a?1:-1}),e},[i,w,P,A,B,he,be,ue,xe,ye,je]),ke=Se.slice(0,U),Pe=U<Se.length;o.useEffect(()=>{V(25)},[w,P,he,be,ue,xe,ye,je,K]),o.useEffect(()=>{const e=new IntersectionObserver(e=>{e[0].isIntersecting&&Pe&&!n&&V(e=>e+K)},{threshold:.1}),t=W.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[Pe,n,K]);const Ce=e=>{const t=new Set(le);t.has(e)?t.delete(e):t.add(e),ie(t)},_e=()=>{ie(new Set),oe(!1)},Ae=e=>{var t,s,a,r,l;const i=window.open("","_blank");i&&(i.document.write(`\n        <html>\n          <head>\n            <title>Purchase Order - ${e.orderNumber}</title>\n            <style>\n              body { font-family: Arial, sans-serif; margin: 40px; }\n              .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }\n              .header h1 { margin: 0; color: #333; }\n              .header p { margin: 5px 0; color: #666; }\n              .section { margin: 20px 0; }\n              .section-title { font-weight: bold; font-size: 16px; margin-bottom: 10px; color: #333; }\n              .info-row { display: flex; justify-content: space-between; margin: 8px 0; }\n              .info-label { font-weight: bold; color: #666; }\n              table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n              th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n              th { background-color: #f5f5f5; font-weight: bold; }\n              .total-row { font-weight: bold; background-color: #f9f9f9; }\n              .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; }\n              .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; }\n              .status-${e.status} { background-color: #e3f2fd; color: #1976d2; }\n            </style>\n          </head>\n          <body>\n            <div class="header">\n              <h1>PURCHASE ORDER</h1>\n              <p>LATS CHANCE - Purchase Management</p>\n              <p>Date: ${(new Date).toLocaleDateString()}</p>\n            </div>\n\n            <div class="section">\n              <div class="section-title">Order Information</div>\n              <div class="info-row">\n                <span class="info-label">Order Number:</span>\n                <span>${e.orderNumber}</span>\n              </div>\n              <div class="info-row">\n                <span class="info-label">Order Date:</span>\n                <span>${De(e.createdAt)}</span>\n              </div>\n              <div class="info-row">\n                <span class="info-label">Status:</span>\n                <span class="status-badge status-${e.status}">${e.status.replace("_"," ").toUpperCase()}</span>\n              </div>\n              ${e.expectedDeliveryDate?`\n              <div class="info-row">\n                <span class="info-label">Expected Delivery:</span>\n                <span>${De(e.expectedDeliveryDate)}</span>\n              </div>\n              `:""}\n            </div>\n\n            <div class="section">\n              <div class="section-title">Supplier Information</div>\n              <div class="info-row">\n                <span class="info-label">Supplier Name:</span>\n                <span>${(null==(t=e.supplier)?void 0:t.name)||"N/A"}</span>\n              </div>\n              ${(null==(s=e.supplier)?void 0:s.email)?`\n              <div class="info-row">\n                <span class="info-label">Email:</span>\n                <span>${e.supplier.email}</span>\n              </div>\n              `:""}\n              ${(null==(a=e.supplier)?void 0:a.phone)?`\n              <div class="info-row">\n                <span class="info-label">Phone:</span>\n                <span>${e.supplier.phone}</span>\n              </div>\n              `:""}\n              ${(null==(r=e.supplier)?void 0:r.country)?`\n              <div class="info-row">\n                <span class="info-label">Country:</span>\n                <span>${e.supplier.country}</span>\n              </div>\n              `:""}\n            </div>\n\n            <div class="section">\n              <div class="section-title">Order Items</div>\n              <table>\n                <thead>\n                  <tr>\n                    <th>Item</th>\n                    <th>Quantity</th>\n                    <th>Unit Price</th>\n                    <th>Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${(null==(l=e.items)?void 0:l.map(t=>{var s,a;return`\n                    <tr>\n                      <td>${(null==(s=t.product)?void 0:s.name)||"Product"} ${(null==(a=t.variant)?void 0:a.name)?`(${t.variant.name})`:""}</td>\n                      <td>${t.quantity}</td>\n                      <td>${Ee(t.costPrice,e.currency)}</td>\n                      <td>${Ee(t.totalPrice||t.quantity*t.costPrice,e.currency)}</td>\n                    </tr>\n                  `}).join(""))||'<tr><td colspan="4">No items</td></tr>'}\n                  <tr class="total-row">\n                    <td colspan="3" style="text-align: right;">TOTAL:</td>\n                    <td>${Ee(e.totalAmount||0,e.currency)}</td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n\n            ${e.notes?`\n            <div class="section">\n              <div class="section-title">Notes</div>\n              <p>${e.notes}</p>\n            </div>\n            `:""}\n\n            ${e.paymentTerms?`\n            <div class="section">\n              <div class="section-title">Payment Terms</div>\n              <p>${e.paymentTerms}</p>\n            </div>\n            `:""}\n\n            <div class="footer">\n              <p>This is a computer-generated document. No signature required.</p>\n              <p>LATS CHANCE - Inventory Management System</p>\n            </div>\n          </body>\n        </html>\n      `),i.document.close(),i.print(),N.success("Print dialog opened"))},Ie=e=>{var t;if(!(null==(t=e.supplier)?void 0:t.phone))return void N.error("Supplier phone number not available");const s=`Hello! Regarding Purchase Order ${e.orderNumber}. `,a=`https://wa.me/${e.supplier.phone.replace(/\D/g,"")}?text=${encodeURIComponent(s)}`;window.open(a,"_blank"),N.success("Opening WhatsApp...")},Te=e=>{switch(e){case"draft":return"bg-gray-500 text-white shadow-sm";case"sent":return"bg-blue-600 text-white shadow-sm";case"partial_received":return"bg-orange-500 text-white shadow-sm";case"received":return"bg-sky-500 text-white shadow-sm";case"completed":return"bg-green-600 text-white shadow-sm";case"cancelled":return"bg-red-500 text-white shadow-sm";default:return"bg-gray-400 text-white shadow-sm"}},Be=e=>{switch(e){case"paid":return"bg-blue-500 text-white shadow-sm";case"partial":return"bg-orange-500 text-white shadow-sm";case"unpaid":return"bg-red-500 text-white shadow-sm";case"overpaid":return"bg-purple-500 text-white shadow-sm";default:return"bg-gray-500 text-white shadow-sm"}},$e=t=>{switch(t){case"paid":return e.jsx(y,{className:"w-3 h-3"});case"partial":return e.jsx(v,{className:"w-3 h-3"});case"unpaid":return e.jsx(q,{className:"w-3 h-3"});case"overpaid":return e.jsx(M,{className:"w-3 h-3"});default:return null}},Ee=(e,t="TZS")=>{const s="string"==typeof e?parseFloat(e)||0:e||0;if(!s||0===s)return"TSh 0";if("TZS"===t||!t)return`TSh ${s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}`;try{return new Intl.NumberFormat("en-TZ",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}catch(a){return`${t} ${s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}`}},De=e=>{if(!e)return"Not set";const t=new Date(e);return isNaN(t.getTime())?"Not set":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Re=[w,"all"!==P,"all"!==he,"all"!==be,ue,xe,ye,je].filter(Boolean).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(t,{className:"bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(null==i?void 0:i.length)||0})]}),e.jsx("div",{className:"p-3 bg-blue-50/20 rounded-full",children:e.jsx(Y,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx(t,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:(null==i?void 0:i.filter(e=>"draft"===e.status||"sent"===e.status||"partial_received"===e.status).length)||0})]}),e.jsx("div",{className:"p-3 bg-yellow-50/20 rounded-full",children:e.jsx(Z,{className:"w-6 h-6 text-yellow-600"})})]})}),e.jsx(t,{className:"bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"In Transit"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(null==i?void 0:i.filter(e=>"sent"===e.status||"shipped"===e.status).length)||0})]}),e.jsx("div",{className:"p-3 bg-purple-50/20 rounded-full",children:e.jsx(X,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx(t,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:(null==i?void 0:i.filter(e=>"received"===e.status||"completed"===e.status).length)||0})]}),e.jsx("div",{className:"p-3 bg-green-50/20 rounded-full",children:e.jsx(y,{className:"w-6 h-6 text-green-600"})})]})})]}),e.jsx(t,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row gap-4 items-start xl:items-center",children:[e.jsx("div",{className:"flex-1 min-w-0 w-full",children:e.jsxs("div",{className:"relative group",children:[e.jsx(k,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search orders, suppliers, or notes...",value:w,onChange:e=>S(e.target.value),className:"w-full pl-12 pr-4 py-3 bg-white/60 backdrop-blur-sm border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-400 transition-all"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{onClick:()=>de(!ce),className:"flex items-center gap-2 px-4 py-3 border rounded-xl transition-all "+(ce?"bg-blue-50 border-blue-300 text-blue-700":"bg-white/60 border-gray-200 text-gray-700 hover:bg-white/80"),children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Filters"}),Re>0&&e.jsx("span",{className:"bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full",children:Re})]}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>F("list"),className:"p-2 transition-colors "+("list"===L?"bg-blue-500 text-white":"text-gray-600 hover:bg-gray-50"),title:"List View",children:e.jsx(D,{size:16})}),e.jsx("button",{onClick:()=>F("grid"),className:"p-2 transition-colors "+("grid"===L?"bg-blue-500 text-white":"text-gray-600 hover:bg-gray-50"),title:"Grid View",children:e.jsx(R,{size:16})})]}),e.jsx("button",{onClick:we,disabled:n,className:"flex items-center gap-2 px-4 py-3 bg-white/60 border border-gray-200 rounded-xl hover:bg-white/80 transition-all disabled:opacity-50",children:e.jsx(_,{className:"w-4 h-4 "+(n?"animate-spin":"")})}),e.jsxs("button",{onClick:()=>{try{const e=["Order Number","Supplier","Status","Total Amount","Currency","Payment Status","Total Quantity","Created Date"],t=Se.map(e=>{var t,s;return[e.orderNumber,(null==(t=e.supplier)?void 0:t.name)||"N/A",e.status,e.totalAmount||0,e.currency||"TZS",e.payment_status||e.paymentStatus||"unpaid",(null==(s=e.items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0,De(e.createdAt)]}),s=[e.join(","),...t.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=`purchase-orders-${(new Date).toISOString().split("T")[0]}.csv`,r.click(),N.success("Purchase orders exported successfully")}catch(e){N.error("Failed to export purchase orders")}},className:"flex items-center gap-2 px-4 py-3 bg-white/60 border border-gray-200 rounded-xl hover:bg-white/80 transition-all",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),e.jsx(s,{onClick:()=>a("/lats/purchase-order/create"),icon:e.jsx(ee,{size:18}),className:"bg-gradient-to-r from-orange-500 to-amber-600 text-white font-semibold",children:"Create PO"})]})]}),ce&&e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:P,onChange:e=>C(e.target.value),className:"w-full bg-white/60 border border-gray-200 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"pending_approval",children:"Pending Approval"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"partial_received",children:"Partial Received"}),e.jsx("option",{value:"received",children:"Received"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier"}),e.jsxs("select",{value:he,onChange:e=>ge(e.target.value),className:"w-full bg-white/60 border border-gray-200 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Suppliers"}),null==f?void 0:f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Status"}),e.jsxs("select",{value:be,onChange:e=>fe(e.target.value),className:"w-full bg-white/60 border border-gray-200 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Payment Status"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"partial",children:"Partially Paid"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"overpaid",children:"Overpaid"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:A,onChange:e=>I(e.target.value),className:"flex-1 bg-white/60 border border-gray-200 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"createdAt",children:"Date"}),e.jsx("option",{value:"orderNumber",children:"Order #"}),e.jsx("option",{value:"totalAmount",children:"Amount"})]}),e.jsx("button",{onClick:()=>$("asc"===B?"desc":"asc"),className:"px-3 bg-white/60 border border-gray-200 rounded-xl hover:bg-white/80 transition-all",children:"asc"===B?"↑":"↓"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date From"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"date",value:ue,onChange:e=>me(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/60 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date To"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"date",value:xe,onChange:e=>pe(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/60 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Amount"}),e.jsx("input",{type:"number",placeholder:"0",value:ye,onChange:e=>ve(e.target.value),className:"w-full bg-white/60 border border-gray-200 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Amount"}),e.jsx("input",{type:"number",placeholder:"∞",value:je,onChange:e=>Ne(e.target.value),className:"w-full bg-white/60 border border-gray-200 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-500"})]})]}),Re>0&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{S(""),C("all"),ge("all"),fe("all"),me(""),pe(""),ve(""),Ne(""),I("createdAt"),$("desc")},className:"flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 rounded-xl transition-all",children:[e.jsx(p,{className:"w-4 h-4"}),"Clear all filters"]})})]}),E&&e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Last updated: ",E.toLocaleTimeString()]})]})}),le.size>0&&e.jsxs(t,{className:"p-4 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[le.size," order",1!==le.size?"s":""," selected"]}),e.jsx("button",{onClick:_e,className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Clear selection"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:async()=>{if(await l(`Are you sure you want to approve ${le.size} purchase orders?`)){let e=0;for(const t of le){(await x(t)).ok&&e++}N.success(`Approved ${e} purchase orders successfully`),_e()}},className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(G,{className:"w-4 h-4"}),"Approve Selected"]}),e.jsxs("button",{onClick:()=>oe(!ne),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(se,{className:"w-4 h-4"}),"More Actions"]}),e.jsxs("button",{onClick:async()=>{if(await l(`Are you sure you want to delete ${le.size} purchase orders?`)){let e=0;for(const t of le){(await u(t)).ok&&e++}N.success(`Deleted ${e} purchase orders successfully`),_e()}},className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(z,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),ne&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-3",children:"Change status to:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["approved","sent","confirmed","shipped","received","completed","cancelled"].map(t=>e.jsx("button",{onClick:()=>(async e=>{if(await l(`Are you sure you want to change status of ${le.size} orders to "${e}"?`)){let t=0;for(const s of le)(await g(s,{status:e})).ok&&t++;N.success(`Updated ${t} purchase orders successfully`),_e()}})(t),className:"px-3 py-1 text-sm bg-white border border-blue-200 hover:bg-blue-100 rounded-lg transition-colors capitalize",children:t.replace("_"," ")},t))})]})]}),c&&e.jsx(t,{className:"p-6 bg-red-50 border-red-200",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(v,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:c})]})]})}),n?e.jsx(Me,{}):0===Se.length?e.jsxs(t,{className:"p-12 text-center",children:[e.jsx(h,{className:"w-20 h-20 text-gray-300 mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"No purchase orders found"}),e.jsx("p",{className:"text-gray-600 mb-8",children:w||Re>0?"Try adjusting your search or filters":"Get started by creating your first purchase order"}),!w&&0===Re&&e.jsx(s,{onClick:()=>a("/lats/purchase-order/create"),icon:e.jsx(ee,{size:20}),className:"bg-gradient-to-r from-orange-500 to-amber-600 text-white font-bold text-lg px-8 py-4",children:"Create Purchase Order"})]}):"list"===L?e.jsx(t,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200/50",children:[e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:e.jsx("input",{type:"checkbox",checked:le.size===ke.length&&ke.length>0,onChange:()=>{le.size===ke.length?ie(new Set):ie(new Set(ke.map(e=>e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Order"}),e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Supplier"}),e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Items"}),e.jsx("th",{className:"text-right py-4 px-4 font-medium text-gray-700",children:"Total Amount"}),e.jsx("th",{className:"text-center py-4 px-4 font-medium text-gray-700",children:"Payment"}),e.jsx("th",{className:"text-center py-4 px-4 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-center py-4 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:ke.map(t=>{var s;return e.jsxs("tr",{className:"border-b border-gray-200/30 hover:bg-blue-50 cursor-pointer transition-colors",onClick:()=>a(`/lats/purchase-orders/${t.id}`),children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"checkbox",checked:le.has(t.id),onChange:e=>{e.stopPropagation(),Ce(t.id)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold",children:e.jsx(h,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.orderNumber}),e.jsx("p",{className:"text-sm text-gray-600",children:De(t.createdAt)})]})]})}),e.jsx("td",{className:"py-4 px-4",children:t.supplier?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.supplier.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.supplier.country||"Tanzania"})]}):e.jsx("span",{className:"text-gray-400 italic text-sm",children:"No supplier"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-gray-900 font-semibold",children:[(null==(s=t.items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0," qty"]}),t.paymentTerms&&e.jsx("p",{className:"text-sm text-gray-600",children:t.paymentTerms})]})}),e.jsxs("td",{className:"py-4 px-4 text-right",children:[e.jsx("p",{className:"text-gray-900 font-semibold",children:Ee(t.totalAmount||0,t.currency)}),t.currency&&"TZS"!==t.currency&&e.jsx("p",{className:"text-sm text-gray-600",children:t.currency})]}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm font-semibold ${Be(t.payment_status||t.paymentStatus||"unpaid")}`,children:[$e(t.payment_status||t.paymentStatus||"unpaid"),e.jsx("span",{className:"capitalize",children:(t.payment_status||t.paymentStatus||"unpaid").replace("_"," ")})]})})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm font-semibold ${Te(t.status)}`,children:e.jsx("span",{className:"capitalize",children:t.status.replace("_"," ")})})})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),a(`/lats/purchase-orders/${t.id}`)},className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"View Details",children:e.jsx(Q,{size:16})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),Ae(t)},className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"Print Order",children:e.jsx(T,{size:16})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),Ie(t)},className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"WhatsApp Supplier",children:e.jsx(ae,{size:16})}),"draft"===t.status&&e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{try{const t=await x(e);t.ok?N.success("Purchase order approved successfully"):N.error(t.message||"Failed to approve purchase order")}catch(t){N.error("Failed to approve purchase order")}})(t.id)},className:"p-1 text-gray-500 hover:text-purple-600 transition-colors",title:"Approve Order",children:e.jsx(G,{size:16})})]})})]},t.id)})})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ke.map(s=>{var r;return e.jsxs(t,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>a(`/lats/purchase-orders/${s.id}`),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white",children:e.jsx(h,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:s.orderNumber}),e.jsx("p",{className:"text-sm text-gray-600",children:De(s.createdAt)})]})]}),e.jsx("input",{type:"checkbox",checked:le.has(s.id),onChange:e=>{e.stopPropagation(),Ce(s.id)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Supplier"}),s.supplier?e.jsx("p",{className:"font-medium text-gray-900",children:s.supplier.name}):e.jsx("p",{className:"text-gray-400 italic",children:"No supplier"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total Amount"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Ee(s.totalAmount||0,s.currency)})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${Te(s.status)}`,children:e.jsx("span",{className:"capitalize",children:s.status.replace("_"," ")})}),e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${Be(s.payment_status||s.paymentStatus||"unpaid")}`,children:[$e(s.payment_status||s.paymentStatus||"unpaid"),e.jsx("span",{className:"capitalize",children:(s.payment_status||s.paymentStatus||"unpaid").replace("_"," ")})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Quantity: ",e.jsx("span",{className:"font-semibold",children:(null==(r=s.items)?void 0:r.reduce((e,t)=>e+(t.quantity||0),0))||0})]})}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),a(`/lats/purchase-orders/${s.id}`)},className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(Q,{size:14}),e.jsx("span",{children:"View"})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),Ae(s)},className:"p-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",title:"Print",children:e.jsx(T,{size:14})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),Ie(s)},className:"p-2 bg-green-100 hover:bg-green-200 text-green-700 rounded-lg transition-colors",title:"WhatsApp",children:e.jsx(ae,{size:14})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(e=>{var t;if(!(null==(t=e.supplier)?void 0:t.email))return void N.error("Supplier email not available");const s=`Purchase Order ${e.orderNumber}`,a=`Dear ${e.supplier.name},\n\nRegarding Purchase Order: ${e.orderNumber}\nTotal Amount: ${Ee(e.totalAmount,e.currency)}\n\nPlease confirm receipt of this order.\n\nBest regards`,r=`mailto:${e.supplier.email}?subject=${encodeURIComponent(s)}&body=${encodeURIComponent(a)}`;window.open(r),N.success("Opening email client...")})(s)},className:"p-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:"Email",children:e.jsx(re,{size:14})})]})]},s.id)})}),Se.length>0&&e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Show:"}),e.jsxs("select",{value:K,onChange:e=>{H(Number(e.target.value)),setCurrentPage(1)},className:"bg-white border border-gray-200 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"per page"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",ke.length," of ",Se.length," orders"]}),e.jsxs("div",{ref:W,className:"py-2",children:[Pe&&!n&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-600",children:[e.jsx(_,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading more orders..."})]}),!Pe&&ke.length>0&&e.jsx("div",{className:"text-gray-500 text-sm",children:"✓ All orders loaded"})]})]})}),Se.length>0&&e.jsx(t,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center",children:e.jsx(h,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Showing ",Se.length," of ",(null==i?void 0:i.length)||0," purchase orders"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[Re>0?`${Re} filter${1!==Re?"s":""} applied`:"All orders"," • ","grid"===L?"Grid View":"List View"]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Ee(Se.reduce((e,t)=>e+(t.totalAmount||0),0),"TZS")}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Value"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Se.reduce((e,t)=>{var s;return e+((null==(s=t.items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0)},0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Quantity"})]})]})]})})]})},Je=({products:t,categories:s,formatMoney:r})=>{const[l,i]=c.useState(!1),[n,o]=c.useState(0),[d,u]=c.useState(""),[m,x]=c.useState(null),[p,g]=c.useState(null),[b,f]=c.useState([]),[j,N]=c.useState(!1);c.useEffect(()=>{(async()=>{if(t&&0!==t.length){N(!0);try{const{data:e,error:t}=await a.from("lats_sales").select("\n            id,\n            total_amount,\n            created_at\n          ").gte("created_at",new Date(Date.now()-2592e6).toISOString());if(!t&&e&&Array.isArray(e)){const t=e.reduce((e,t)=>e+("number"==typeof t.total_amount?t.total_amount:parseFloat(t.total_amount)||0),0),s=e.length;x({topSellingProducts:[],totalRevenue:t,totalTransactions:s,averageOrderValue:s>0?t/s:0})}const{data:s,error:r}=await a.from("lats_suppliers").select("\n            id,\n            name,\n            contact_person,\n            phone,\n            email,\n            is_active\n          ");!r&&s&&Array.isArray(s)&&g({totalSuppliers:s.length,activeSuppliers:s.filter(e=>e.is_active).length,topSuppliers:s.slice(0,5)});const{data:l,error:i}=await a.from("lats_sales").select("\n            id,\n            total_amount,\n            created_at,\n            customer_name,\n            status\n          ").order("created_at",{ascending:!1}).limit(10);!i&&l&&Array.isArray(l)&&f(l.map(e=>({id:e.id,type:"sale",description:`Sale to ${e.customer_name||"Customer"}`,amount:e.total_amount,date:e.created_at,status:e.status})))}catch(e){}finally{N(!1)}}})()},[t]);const w=c.useMemo(()=>{const e=(null==t?void 0:t.length)||0,s=(null==t?void 0:t.filter(e=>e.isActive).length)||0,a=e-s,r=(null==t?void 0:t.filter(e=>e.isFeatured).length)||0,l=(null==t?void 0:t.filter(e=>{var t,s,a;const r=(null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0,l=(null==(a=null==(s=e.variants)?void 0:s[0])?void 0:a.minQuantity)||e.minStockLevel||5;return r>0&&r<=l}).length)||0,i=(null==t?void 0:t.filter(e=>{var t;return((null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0)<=0}).length)||0,n=(null==t?void 0:t.filter(e=>{var t,s,a;return((null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0)>((null==(a=null==(s=e.variants)?void 0:s[0])?void 0:a.minQuantity)||e.minStockLevel||5)}).length)||0,o=(null==t?void 0:t.filter(e=>{var t,s,a;const r=(null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0;return r<=((null==(a=null==(s=e.variants)?void 0:s[0])?void 0:a.minQuantity)||e.minStockLevel||5)&&r>0}).length)||0,c=(null==t?void 0:t.reduce((e,t)=>{var s;const a=(null==(s=t.variants)?void 0:s.reduce((e,t)=>{const s=Number(t.costPrice)||0,a=Number(t.quantity)||0;return Number(e)+s*a},0))||0;return Number(e)+Number(a)},0))||0,d=(null==t?void 0:t.reduce((e,t)=>{var s;const a=(null==(s=t.variants)?void 0:s.reduce((e,t)=>{const s=Number(t.costPrice)||0,a=Number(t.sellingPrice)||1.5*s||0,r=Number(t.quantity)||0;return Number(e)+a*r},0))||0;return Number(e)+Number(a)},0))||0,u=d-c,m=c>0?u/c*100:0,x=new Map;null==t||t.forEach(e=>{var t,s;let a="Electronics";const r=(null==(t=e.name)?void 0:t.toLowerCase())||"";r.includes("iphone")||r.includes("ipad")||r.includes("macbook")?a="iPhones":r.includes("jbl")||r.includes("speaker")||r.includes("soundbar")?a="Bluetooth Speakers":r.includes("soundbar")||r.includes("bar")?a="Soundbars":r.includes("keyboard")||r.includes("mechanical")?a="Keyboards":r.includes("cpu")||r.includes("min")||r.includes("desktop")?a="CPU":(r.includes("monitor")||r.includes("display"))&&(a="Monitors"),x.has(a)||x.set(a,{name:a,products:[],count:0,value:0});const l=x.get(a);l.products.push(e),l.count+=1;const i=(null==(s=e.variants)?void 0:s.reduce((e,t)=>{const s=Number(t.costPrice)||0,a=Number(t.sellingPrice)||1.5*s||0,r=Number(t.quantity)||0;return Number(e)+a*r},0))||0;l.value=Number(l.value)+Number(i)});const p=Array.from(x.values()).map(t=>({name:t.name,count:t.count,value:t.value,percentage:e>0?t.count/e*100:0})).sort((e,t)=>t.value-e.value);return{totalProducts:e,activeProducts:s,inactiveProducts:a,featuredProducts:r,lowStockProducts:l,outOfStockProducts:i,wellStockedProducts:n,reorderAlerts:o,totalValue:c,retailValue:d,potentialProfit:u,profitMargin:m,categoryStats:p}},[t,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-7 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(h,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Total Products"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[w.activeProducts," active"]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:w.totalProducts})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-emerald-50 hover:bg-emerald-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{size:14,className:"text-emerald-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Active"})]}),e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:w.activeProducts})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(v,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Inactive"})]}),e.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:w.inactiveProducts})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Stock Health"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[w.lowStockProducts," low stock"]})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-600",children:w.wellStockedProducts}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Well stocked items"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-emerald-50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Well Stocked"}),e.jsx("span",{className:"text-sm font-semibold text-emerald-600",children:w.wellStockedProducts})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-amber-50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Low Stock"}),e.jsx("span",{className:"text-sm font-semibold text-amber-600",children:w.lowStockProducts})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-rose-50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Out of Stock"}),e.jsx("span",{className:"text-sm font-semibold text-rose-600",children:w.outOfStockProducts})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(M,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Inventory Value"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Total retail value"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:r(w.retailValue)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Avg Margin: ",w.profitMargin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Cost Value"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:r(w.totalValue)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Retail Value"}),e.jsx("span",{className:"text-sm font-semibold text-purple-600",children:r(w.retailValue)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Potential Profit"}),e.jsx("span",{className:"text-sm font-semibold text-emerald-600",children:r(w.potentialProfit)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Profit Margin"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Average margin"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-emerald-600",children:r(w.potentialProfit)})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Profit margin: ",w.profitMargin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Profit Margin"}),e.jsxs("span",{children:[w.profitMargin.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(w.profitMargin>=50?"bg-emerald-500":w.profitMargin>=30?"bg-amber-500":"bg-rose-500"),style:{width:`${Math.min(w.profitMargin,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:""+(w.profitMargin>=50?"text-emerald-600 font-semibold":"text-gray-500"),children:"Excellent (50%+)"}),e.jsx("span",{className:""+(w.profitMargin>=30&&w.profitMargin<50?"text-amber-600 font-semibold":"text-gray-500"),children:"Good (30-50%)"}),e.jsx("span",{className:""+(w.profitMargin<30?"text-rose-600 font-semibold":"text-gray-500"),children:"Low (<30%)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-7 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(le,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Stock Distribution"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[w.totalProducts," products tracked"]})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:w.totalProducts}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total Products"})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Well Stocked"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w.totalProducts>0?Math.round(w.wellStockedProducts/w.totalProducts*100):0,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Low Stock"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w.totalProducts>0?Math.round(w.lowStockProducts/w.totalProducts*100):0,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-rose-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Out of Stock"})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w.totalProducts>0?Math.round(w.outOfStockProducts/w.totalProducts*100):0,"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex h-2 rounded-full overflow-hidden",children:[e.jsx("div",{className:"bg-emerald-500 transition-all duration-300",style:{width:(w.totalProducts>0?w.wellStockedProducts/w.totalProducts*100:0)+"%"}}),e.jsx("div",{className:"bg-amber-500 transition-all duration-300",style:{width:(w.totalProducts>0?w.lowStockProducts/w.totalProducts*100:0)+"%"}}),e.jsx("div",{className:"bg-rose-500 transition-all duration-300",style:{width:(w.totalProducts>0?w.outOfStockProducts/w.totalProducts*100:0)+"%"}})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:w.wellStockedProducts}),e.jsx("span",{children:w.lowStockProducts}),e.jsx("span",{children:w.outOfStockProducts})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Top Categories"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"By value"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:w.categoryStats.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total Categories"})]}),e.jsx("div",{className:"space-y-2 flex-grow max-h-48 overflow-y-auto",children:w.categoryStats.slice(0,5).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-white",children:s+1})}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 ml-8",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[t.count," products"]}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.percentage.toFixed(1),"%"]})]})]}),e.jsx("span",{className:"text-sm font-semibold text-purple-600 ml-2",children:r(t.value)})]},t.name))})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(M,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Financial Overview"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Inventory value"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cost Value"}),e.jsx("span",{className:"text-sm font-semibold text-red-600",children:r(w.totalValue)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Retail Value"}),e.jsx("span",{className:"text-sm font-semibold text-green-600",children:r(w.retailValue)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Profit Margin"}),e.jsxs("span",{className:"text-sm font-semibold "+(w.profitMargin>=0?"text-green-600":"text-red-600"),children:[w.profitMargin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Profit Margin"}),e.jsxs("span",{children:[w.profitMargin.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(w.profitMargin>=50?"bg-green-500":w.profitMargin>=30?"bg-yellow-500":"bg-red-500"),style:{width:`${Math.min(w.profitMargin,100)}%`}})})]})]})]})]}),m&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Sales Performance"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Last 30 days"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:r(m.totalRevenue)}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:m.totalTransactions}),e.jsx("div",{className:"text-xs text-gray-500",children:"Transactions"})]})]}),m.topSellingProducts.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700",children:"Top Products"}),m.topSellingProducts.slice(0,3).map((s,a)=>{const r=t.find(e=>e.id===s.productId);return e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:a+1})}),e.jsx("span",{className:"text-xs text-gray-700 truncate",children:(null==r?void 0:r.name)||"Unknown"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-900",children:s.totalSold}),e.jsx("div",{className:"text-xs text-gray-500",children:"units"})]})]},s.productId)})]})]}),p&&e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Supplier Performance"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[p.totalSuppliers," suppliers"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:p.totalSuppliers}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total Suppliers"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:p.activeSuppliers}),e.jsx("div",{className:"text-xs text-gray-500",children:"Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:p.topSuppliers.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Listed"})]})]}),p.topSuppliers.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700",children:"Top Suppliers"}),p.topSuppliers.slice(0,3).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-orange-600",children:s+1})}),e.jsx("span",{className:"text-xs text-gray-700 truncate",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+(t.is_active?"bg-green-500":"bg-gray-400")}),e.jsx("span",{className:"text-xs text-gray-600",children:t.is_active?"Active":"Inactive"})]})]},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[b.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Recent Activity"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Latest transactions"})]})]}),e.jsx("div",{className:"space-y-2",children:b.slice(0,4).map(t=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"w-3 h-3 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 truncate",children:t.description}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.date).toLocaleDateString()})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-900",children:r(t.amount)}),e.jsx("div",{className:"text-xs px-1 py-0.5 rounded-full "+("completed"===t.status?"bg-green-100 text-green-700":"pending"===t.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:t.status})]})]},t.id))})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Business Intelligence"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Key metrics"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"ABC Analysis"}),e.jsxs("span",{className:"text-xs font-semibold text-gray-900",children:[w.categoryStats.slice(0,1).length,"A, ",w.categoryStats.slice(1,3).length,"B, ",w.categoryStats.slice(3).length,"C"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Inventory Turnover"}),e.jsxs("span",{className:"text-xs font-semibold text-gray-900",children:[m?(m.totalRevenue/w.totalValue).toFixed(2):"N/A","x"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Profitability"}),e.jsxs("span",{className:"text-xs font-semibold "+(w.profitMargin>=50?"text-green-600":w.profitMargin>=30?"text-yellow-600":"text-red-600"),children:[w.profitMargin.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Database Backup"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Export all data"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Create a complete backup of all your data"}),e.jsx("button",{onClick:async()=>{i(!0),o(0),u("Starting backup...");try{const t=["customers","lats_categories","lats_products","lats_product_variants","lats_suppliers","employees","appointments","settings","devices","auth_users","integrations","system_settings","notification_templates","audit_logs","product_images","user_settings","lats_pos_general_settings","lats_pos_receipt_settings","lats_pos_advanced_settings","lats_purchase_orders","lats_stock_movements","user_daily_goals","customer_payments","finance_accounts","finance_expenses","finance_expense_categories","finance_transfers","gift_cards","gift_card_transactions","installment_payments","device_attachments","device_checklists","device_ratings","device_remarks","device_transitions","diagnostic_checks","diagnostic_devices","diagnostic_requests","diagnostic_templates","customer_notes","customer_checkins","customer_revenue","contact_history","contact_methods","contact_preferences","communication_templates","email_logs","chat_messages","whatsapp_message_templates","whatsapp_instance_settings_view","whatsapp_templates","sms_logs","sms_triggers","admin_settings","admin_settings_log","admin_settings_view","uuid_diagnostic_log"];u(`Backing up ${t.length} active tables...`);const s={timestamp:(new Date).toISOString(),databaseInfo:{totalTables:t.length,backupType:"UI BACKUP - ACTIVE TABLES ONLY"},tables:{},summary:{totalTables:0,tablesWithData:0,totalRecords:0}};let r=0,l=0,n=0;for(const i of t)try{n++;const e=n/t.length*100;o(e),u(`Backing up table: ${i} (${n}/${t.length})`);const c=[];let d=0;const m=1e3;for(;;){const{data:e,error:t}=await a.from(i).select("*").range(d,d+m-1);if(t)break;if(!e||0===e.length)break;if(c.push(...e),e.length<m)break;d+=m,await new Promise(e=>setTimeout(e,50))}const x=c.length;s.tables[i]={exists:!0,recordCount:x,data:c},r+=x,x>0&&l++}catch(e){const t=(null==e?void 0:e.message)||"Unknown error";s.tables[i]={exists:!0,error:t,data:null}}s.summary.totalTables=t.length,s.summary.tablesWithData=l,s.summary.totalRecords=r;const c=JSON.stringify(s,null,2),d=new Blob([c],{type:"application/json"}),m=URL.createObjectURL(d),x=document.createElement("a");x.href=m,x.download=`database-backup-${(new Date).toISOString().replace(/[:.]/g,"-")}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(m),u(`✅ Backup completed! ${r.toLocaleString()} records backed up from ${l} tables`),o(100),setTimeout(()=>{i(!1),o(0),u("")},3e3)}catch(e){u(`❌ Backup failed: ${e.message}`),i(!1)}},disabled:l,className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg font-medium transition-all "+(l?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700 active:scale-95"),children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Backing Up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),"Backup Database"]})}),l&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-indigo-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${n}%`}})}),e.jsx("p",{className:"text-xs text-indigo-700",children:d})]}),!l&&d&&e.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-xs text-green-700",children:d})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Featured"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[w.totalProducts>0?(w.featuredProducts/w.totalProducts*100).toFixed(1):0,"% of total"]})]})]})}),e.jsx("div",{className:"text-3xl font-bold text-amber-600",children:w.featuredProducts})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(h,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Reorder Alerts"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Need restocking"})]})]})}),e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:w.reorderAlerts})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Out of Stock"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Products unavailable"})]})]})}),e.jsx("div",{className:"text-3xl font-bold text-rose-600",children:w.outOfStockProducts})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Categories"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Product categories"})]})]})}),e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:w.categoryStats.length})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(h,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Complete Category Breakdown"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[w.categoryStats.length," categories"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.categoryStats.map((t,s)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:s+1})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.count," products"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Value"}),e.jsx("span",{className:"font-semibold text-gray-900",children:r(t.value)})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Percentage"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[t.percentage.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mt-2",children:e.jsx("div",{className:"bg-purple-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${t.percentage}%`}})})]})]},t.name))})]}),j&&e.jsx("div",{className:"bg-white rounded-2xl p-7",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})})]})};class et{static clearCache(){this.cache.data=null,this.cache.timestamp=0}static async getLiveInventoryMetrics(){const e=Date.now();if(this.cache.data&&e-this.cache.timestamp<this.CACHE_DURATION)return this.cache.data;try{0;const t=localStorage.getItem("current_branch_id"),s=await i();let r=a.from("lats_product_variants").select("id, product_id, quantity, cost_price, unit_price, selling_price, min_quantity, branch_id, is_shared");t&&(r=r.or(`branch_id.eq.${t},is_shared.eq.true,branch_id.is.null`));const{data:l,error:n}=await r;if(n)throw n;const o=s.map(e=>({id:e.id,name:e.name,is_active:e.isActive,branch_id:e.branchId,is_shared:e.isShared})),c=l.reduce((e,t)=>(e[t.product_id]||(e[t.product_id]=[]),e[t.product_id].push(t),e),{}),d=o.map(e=>({...e,lats_product_variants:c[e.id]||[]}));0;let u=0,m=0,x=0,p=(null==d?void 0:d.length)||0,h=0,g=0,b=0,f=0;null==d||d.forEach(e=>{const t=e.lats_product_variants||[];e.is_active&&h++;const s=t.reduce((e,t)=>e+(t.quantity||0),0);x+=s;const a=t.reduce((e,t)=>e+(t.cost_price||0)*(t.quantity||0),0);u+=a;const r=t.reduce((e,t)=>e+(t.selling_price||0)*(t.quantity||0),0);m+=r,s<=0?b++:s<=10&&g++;const l=t[0];(null==l?void 0:l.min_quantity)&&s<=l.min_quantity&&f++});const y={totalValue:u,retailValue:m,totalStock:x,totalProducts:p,activeProducts:h,lowStockItems:g,outOfStockItems:b,reorderAlerts:f,lastUpdated:(new Date).toISOString()};return this.cache.data=y,this.cache.timestamp=e,y}catch(t){throw t}}static async getLiveInventoryValue(){try{const{data:e,error:t}=await a.from("lats_product_variants").select("\n          id,\n          quantity,\n          cost_price,\n          unit_price,\n          lats_products!inner(\n            id,\n            is_active\n          )\n        ").eq("lats_products.is_active",!0);if(t)throw t;let s=0,r=0;null==e||e.forEach(e=>{const t=e.quantity||0,a=e.cost_price||0,l=e.selling_price||0;s+=a*t,r+=l*t});const l=r-s;return{costValue:s,retailValue:r,potentialProfit:l,profitMargin:s>0?l/s*100:0}}catch(e){throw e}}static async getLiveCategoryMetrics(e){try{const[t,s]=await Promise.allSettled([a.from("lats_products").select("id, name, is_active, category_id").eq("category_id",e),a.from("lats_product_variants").select("id, product_id, quantity, cost_price, unit_price, selling_price, min_quantity")]);if("rejected"===t.status)throw t.reason;const r=t.value.data||[],l="fulfilled"===s.status&&s.value.data||[],i=new Set(r.map(e=>e.id)),n=l.filter(e=>i.has(e.product_id)).reduce((e,t)=>(e[t.product_id]||(e[t.product_id]=[]),e[t.product_id].push(t),e),{}),o=r.map(e=>({...e,lats_product_variants:n[e.id]||[]}));let c=0,d=0,u=(null==o?void 0:o.length)||0,m=0,x=0,p=0,h=0;return null==o||o.forEach(e=>{const t=e.lats_product_variants||[];e.is_active&&m++;const s=t.reduce((e,t)=>e+(t.quantity||0),0);d+=s;const a=t.reduce((e,t)=>e+(t.cost_price||0)*(t.quantity||0),0);c+=a,s<=0?p++:s<=10&&x++;const r=t[0];(null==r?void 0:r.min_quantity)&&s<=r.min_quantity&&h++}),{totalValue:c,totalStock:d,totalProducts:u,activeProducts:m,lowStockItems:x,outOfStockItems:p,reorderAlerts:h,lastUpdated:(new Date).toISOString()}}catch(t){throw t}}static async getLiveSupplierMetrics(e){try{const[t,s]=await Promise.allSettled([a.from("lats_products").select("id, name, is_active, supplier_id").eq("supplier_id",e),a.from("lats_product_variants").select("id, product_id, quantity, cost_price, unit_price, selling_price, min_quantity")]);if("rejected"===t.status)throw t.reason;const r=t.value.data||[],l="fulfilled"===s.status&&s.value.data||[],i=new Set(r.map(e=>e.id)),n=l.filter(e=>i.has(e.product_id)).reduce((e,t)=>(e[t.product_id]||(e[t.product_id]=[]),e[t.product_id].push(t),e),{}),o=r.map(e=>({...e,lats_product_variants:n[e.id]||[]}));let c=0,d=0,u=(null==o?void 0:o.length)||0,m=0,x=0,p=0,h=0;return null==o||o.forEach(e=>{const t=e.lats_product_variants||[];e.is_active&&m++;const s=t.reduce((e,t)=>e+(t.quantity||0),0);d+=s;const a=t.reduce((e,t)=>e+(t.cost_price||0)*(t.quantity||0),0);c+=a,s<=0?p++:s<=10&&x++;const r=t[0];(null==r?void 0:r.min_quantity)&&s<=r.min_quantity&&h++}),{totalValue:c,totalStock:d,totalProducts:u,activeProducts:m,lowStockItems:x,outOfStockItems:p,reorderAlerts:h,lastUpdated:(new Date).toISOString()}}catch(t){throw t}}}et.cache={data:null,timestamp:0},et.CACHE_DURATION=3e4;const tt=()=>{const t=Fe(),a=(()=>{const[e,t]=o.useState(!1),[s,a]=o.useState(!1),[r,l]=o.useState(null);return{showAddModal:e,openAddModal:()=>{t(!0)},closeAddModal:()=>{t(!1)},showEditModal:s,editingProductId:r,openEditModal:e=>{l(e),a(!0)},closeEditModal:()=>{a(!1),l(null)}}})(),{errorState:l,clearError:i,withErrorHandling:p}=m({maxRetries:3,showToast:!0,logToConsole:!0}),{products:f,categories:y,suppliers:v,stockMovements:w,sales:S,isLoading:k,loadProducts:P,loadCategories:C,loadSuppliers:A,loadStockMovements:T,loadSales:B,createCategory:$,createSupplier:M,updateProduct:E,deleteProduct:D,adjustStock:R,forceRefreshProducts:O}=r(),[L,G]=o.useState("connecting"),[F,U]=o.useState(!1),[q,V]=o.useState(0),[K,Q]=o.useState(!0),[H,W]=o.useState({categories:!1,suppliers:!1,products:!1,stockMovements:!1,sales:!1}),[Z,J]=o.useState({categories:null,suppliers:null,products:null,stockMovements:null,sales:null}),[te,ae]=o.useState(null),[re,le]=o.useState(!1),[ne,oe]=o.useState("inventory"),[ce,me]=o.useState(""),[xe,pe]=o.useState("all"),be=c.useRef(null),[ye,ve]=o.useState("all"),[je,Ne]=o.useState("all"),[we,Se]=o.useState(!1),[ke,Pe]=o.useState(!1),[Ce,_e]=o.useState(!1),[Ae,Ie]=o.useState("list"),[Te,Be]=o.useState("created"),[$e,Me]=o.useState([]),[Ee,De]=o.useState(!1),[Re,Oe]=o.useState(!1),[Le,ze]=o.useState(!1),[qe,Ve]=o.useState(!1),[Ke,Qe]=o.useState(null),[He,Ye]=o.useState(!1);o.useEffect(()=>{const e=e=>{e.target.closest(".more-actions-dropdown")||Ye(!1)};return He&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[He]),o.useEffect(()=>{(async()=>{if(F)return;Date.now()-q<3e3&&Z.products&&Z.categories?Q(!1):await p(async()=>{U(!0),G("connecting"),Q(!0);try{const e=Date.now();W({categories:!1,suppliers:!1,products:!1,stockMovements:!1,sales:!1});const t=[C().then(()=>{W(e=>({...e,categories:!0}))}),A().then(()=>{W(e=>({...e,suppliers:!0}))})];await Promise.all(t),await P({page:1,limit:100}),W(e=>({...e,products:!0}));const s=[T().then(()=>{W(e=>({...e,stockMovements:!0}))}),B().then(()=>{W(e=>({...e,sales:!0}))})];await Promise.all(s),J({categories:y,suppliers:v,products:f,stockMovements:w,sales:S});Date.now();G("connected"),V(Date.now()),Q(!1)}catch(e){N.error("Failed to load data from database"),G("error"),Q(!1)}finally{U(!1)}},"Loading unified inventory data")})()},[]);const tt=o.useCallback(async()=>{if(!re){le(!0);try{const e=await et.getLiveInventoryMetrics();ae(e)}catch(e){}finally{le(!1)}}},[]);o.useEffect(()=>{if(f.length>0&&!re){const e=setTimeout(()=>{tt()},1e3);return()=>clearTimeout(e)}},[f.length]),o.useEffect(()=>{const e=n.subscribe("lats:stock.updated",e=>{setTimeout(()=>{tt()},500)}),t=n.subscribe("lats:product.updated",e=>{setTimeout(()=>{tt()},500)}),s=n.subscribe("lats:sale.completed",e=>{setTimeout(()=>{tt()},500)}),a=n.subscribe("lats:purchase-order.received",e=>{setTimeout(async()=>{await P({page:1,limit:100}),tt()},1e3)});return()=>{e(),t(),s(),a()}},[tt,P]);const st=o.useCallback(()=>{try{const e="data:text/csv;charset=utf-8,Name,SKU,Category,Price,Stock,Status,Description\n"+f.map(e=>{var t;const s=y.find(t=>t.id===e.categoryId),a=null==(t=e.variants)?void 0:t[0];return`"${e.name}","${(null==a?void 0:a.sku)||"N/A"}","${(null==s?void 0:s.name)||"Uncategorized"}","${(null==a?void 0:a.sellingPrice)||0}","${e.totalQuantity||0}","${e.isActive?"Active":"Inactive"}","${e.description||""}"`}).join("\n"),t=encodeURI(e),s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download",`product-inventory-${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s),N.success("Product inventory exported successfully!")}catch(e){N.error("Failed to export product inventory")}},[f,y]);o.useEffect(()=>{const e=e=>{var s,a,r;if((e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),null==(s=be.current)||s.focus(),null==(a=be.current)||a.select()),(e.ctrlKey||e.metaKey)&&"n"===e.key&&(e.preventDefault(),t("/lats/add-product")),(e.ctrlKey||e.metaKey)&&"i"===e.key&&(e.preventDefault(),t("/lats/bulk-import")),(e.ctrlKey||e.metaKey)&&"e"===e.key&&(e.preventDefault(),st()),"Escape"===e.key&&ce&&(me(""),null==(r=be.current)||r.blur()),e.key>="1"&&e.key<="3"&&!e.ctrlKey&&!e.metaKey&&!e.altKey){const t=e.target;if("INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName){const t=["inventory","purchase-orders","analytics"],s=parseInt(e.key)-1;t[s]&&oe(t[s])}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,ce,st]);const at=o.useMemo(()=>{if(te)return{totalItems:te.totalProducts,lowStockItems:te.lowStockItems,outOfStockItems:te.outOfStockItems,reorderAlerts:te.reorderAlerts,totalValue:te.totalValue,retailValue:te.retailValue||0,activeProducts:te.activeProducts,featuredProducts:f.filter(e=>e.isFeatured).length,lastUpdated:te.lastUpdated};return{totalItems:f.length,lowStockItems:f.filter(e=>{var t;const s=(null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0;return s>0&&s<=10}).length,outOfStockItems:f.filter(e=>{var t;return((null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0)<=0}).length,reorderAlerts:f.filter(e=>{var t,s;const a=null==(t=e.variants)?void 0:t[0],r=(null==(s=e.variants)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0;return(null==a?void 0:a.minQuantity)&&r<=a.minQuantity}).length,totalValue:f.reduce((e,t)=>{var s;return e+((null==(s=t.variants)?void 0:s.reduce((e,t)=>e+(t.costPrice||0)*(t.quantity||0),0))||0)},0),retailValue:f.reduce((e,t)=>{var s;return e+((null==(s=t.variants)?void 0:s.reduce((e,t)=>e+(t.sellingPrice||t.price||0)*(t.quantity||0),0))||0)},0),activeProducts:f.filter(e=>e.isActive).length,featuredProducts:f.filter(e=>e.isFeatured).length,lastUpdated:(new Date).toISOString()}},[f,te]),rt=o.useMemo(()=>{let e=f;if(ce){const t=ce.toLowerCase();e=e.filter(e=>{var s,a,r;return e.name.toLowerCase().includes(t)||(null==(s=e.description)?void 0:s.toLowerCase().includes(t))||(null==(a=e.category)?void 0:a.name.toLowerCase().includes(t))||(null==(r=e.variants)?void 0:r.some(e=>{var s,a,r;return(null==(s=e.name)?void 0:s.toLowerCase().includes(t))||(null==(a=e.sku)?void 0:a.toLowerCase().includes(t))||(null==(r=e.barcode)?void 0:r.toLowerCase().includes(t))}))})}return"all"!==xe&&(e=e.filter(e=>{var t;return(null==(t=y.find(t=>t.id===e.categoryId))?void 0:t.name)===xe})),"inventory"===ne?"in-stock"===ye?e=e.filter(e=>{var t;return((null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0)>10}):"low-stock"===ye?e=e.filter(e=>{var t;const s=(null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0;return s>0&&s<=10}):"out-of-stock"===ye&&(e=e.filter(e=>{var t;return((null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0)<=0})):"all"!==ye&&(e=e.filter(e=>e.isActive===("active"===ye))),"inventory"===ne&&ke&&(e=e.filter(e=>{var t;const s=(null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0;return s>0&&s<=10})),"inventory"===ne&&Ce&&(e=e.filter(e=>e.isFeatured)),e.sort((e,t)=>{var s,a,r,l,i,n;switch(Te){case"name":return e.name.localeCompare(t.name);case"price":return((null==(a=null==(s=e.variants)?void 0:s[0])?void 0:a.sellingPrice)||0)-((null==(l=null==(r=t.variants)?void 0:r[0])?void 0:l.sellingPrice)||0);case"stock":const o=(null==(i=e.variants)?void 0:i.reduce((e,t)=>e+(t.quantity||0),0))||0;return((null==(n=t.variants)?void 0:n.reduce((e,t)=>e+(t.quantity||0),0))||0)-o;case"created":return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime();default:return 0}}),e},[f,ce,xe,ye,ke,Ce,Te,ne,y]),lt=e=>Ge.money(e),it=async(e,t,s,a)=>{try{await R(e,t,s,a),N.success("Stock adjusted successfully"),setTimeout(()=>{tt()},1e3)}catch(r){N.error("Failed to adjust stock")}},nt=async e=>{if(0!==$e.length)switch(e){case"export":try{const e="data:text/csv;charset=utf-8,Name,SKU,Category,Price,Stock,Status\n"+$e.map(e=>{var t;const s=f.find(t=>t.id===e);if(!s)return"";const a=y.find(e=>e.id===s.categoryId),r=null==(t=s.variants)?void 0:t[0];return`${s.name},${(null==r?void 0:r.sku)||"N/A"},${(null==a?void 0:a.name)||"Uncategorized"},${(null==r?void 0:r.sellingPrice)||0},${s.totalQuantity||0},${s.isActive?"Active":"Inactive"}`}).filter(e=>""!==e).join("\n"),t=encodeURI(e),s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download",`products-export-${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s),N.success(`Exported ${$e.length} products successfully!`)}catch(t){N.error("Failed to export products")}break;case"delete":if(confirm(`Are you sure you want to delete ${$e.length} products? This action cannot be undone.`))try{const e=$e.map(e=>D(e));await Promise.all(e),N.success(`Successfully deleted ${$e.length} products`),Me([])}catch(t){N.error("Failed to delete some products")}break;case"feature":try{const e=$e.map(async e=>{const t=f.find(t=>t.id===e);if(t){const s=!t.isFeatured;await E(e,{isFeatured:s,isActive:!0})}});await Promise.all(e);const t=f.find(e=>e.id===$e[0]),s=(null==t?void 0:t.isFeatured)?"unfeatured":"featured";N.success(`Successfully ${s} ${$e.length} product${1!==$e.length?"s":""}`),Me([])}catch(t){N.error("Failed to update product featured status")}break;case"print-labels":try{N.success(`Preparing labels for ${$e.length} product${1!==$e.length?"s":""}...`)}catch(t){N.error("Failed to print labels")}break;case"activate":try{const e=$e.map(async e=>{await E(e,{isActive:!0})});await Promise.all(e),N.success(`Successfully activated ${$e.length} product${1!==$e.length?"s":""}`),Me([])}catch(t){N.error("Failed to activate products")}break;case"deactivate":try{const e=$e.map(async e=>{await E(e,{isActive:!1})});await Promise.all(e),N.success(`Successfully deactivated ${$e.length} product${1!==$e.length?"s":""}`),Me([])}catch(t){N.error("Failed to deactivate products")}break;case"duplicate":try{const e=$e.map(e=>{var t;const s=f.find(t=>t.id===e);return s?{name:s.name,categoryId:s.categoryId,variants:null==(t=s.variants)?void 0:t.map(e=>({sku:e.sku,sellingPrice:e.sellingPrice,costPrice:e.costPrice,quantity:e.quantity,attributes:e.attributes}))}:null}).filter(Boolean),t=JSON.stringify(e,null,2);navigator.clipboard.writeText(t),N.success(`Copied ${$e.length} product${1!==$e.length?"s":""} data to clipboard!\nYou can use this to create new products.`,{duration:4e3})}catch(t){N.error("Failed to copy product data to clipboard")}break;default:N.error("Unknown action")}else N.error("Please select products first")};return l.hasError?e.jsx(x,{error:l.error||"An unexpected error occurred",action:{label:"Retry",onClick:()=>window.location.reload(),variant:"primary"},secondaryAction:{label:"Clear Error",onClick:i,variant:"secondary"}}):e.jsxs(u,{pageName:"Unified Inventory Management",showDetails:!0,children:[e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 group",children:[e.jsxs("button",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-3 py-2 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2 text-sm font-medium",onClick:()=>Ye(!He),children:[e.jsx("span",{children:"⌨️"}),e.jsx("span",{className:"hidden md:inline",children:"Shortcuts"})]}),e.jsxs("div",{className:"absolute bottom-14 right-0 w-64 bg-white/95 backdrop-blur-xl rounded-xl shadow-2xl border border-gray-200/50 p-4 opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity duration-200",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-800 mb-2",children:"⌨️ Keyboard Shortcuts"}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Focus Search"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"⌘K"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Add Product"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"⌘N"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Bulk Import"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"⌘I"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Export Data"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"⌘E"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Clear Search"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"ESC"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Switch Tabs"}),e.jsx("kbd",{className:"px-2 py-0.5 bg-gray-100 rounded border border-gray-300",children:"1-3"})]})]})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{to:"/dashboard"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Inventory"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage products and inventory in one place"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(s,{onClick:()=>t("/lats/add-product"),icon:e.jsx(ee,{size:18}),className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",title:"Add a new product (⌘N)",children:"Add Product"}),e.jsx(s,{onClick:()=>t("/lats/bulk-import"),icon:e.jsx(g,{size:18}),className:"bg-gradient-to-r from-green-500 to-teal-600 text-white",title:"Bulk import products (⌘I)",children:"Bulk Import"}),e.jsx(s,{onClick:async()=>{U(!0);try{await Promise.all([tt(),O()]),N.success("Data refreshed successfully!")}catch(e){N.error("Failed to refresh data")}finally{U(!1)}},icon:e.jsx(_,{size:18,className:re||F?"animate-spin":""}),className:"bg-gradient-to-r from-indigo-500 to-blue-600 text-white",disabled:re||F,title:"Refresh all inventory data",children:re||F?"Refreshing...":"Refresh"}),"error"===L&&e.jsx(s,{onClick:async()=>{G("connecting");try{await Promise.all([P({page:1,limit:100}),C(),A()]),G("connected"),N.success("Reconnected successfully!")}catch(e){G("error"),N.error("Failed to reconnect")}},icon:e.jsx(_,{size:18}),className:"bg-gradient-to-r from-red-500 to-pink-600 text-white",children:"Retry Connection"}),e.jsxs("div",{className:"relative more-actions-dropdown",children:[e.jsx(s,{onClick:()=>Ye(!He),icon:e.jsx(se,{size:18}),className:"bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:"More Actions"}),He&&e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-80 bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-gray-200/50 z-50 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-50 px-4 py-3 border-b border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(de,{size:16,className:"text-slate-600"}),"Quick Actions"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Manage your inventory efficiently"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("button",{onClick:()=>{try{ze(!0),Ye(!1)}catch(e){N.error("Failed to open category form")}},className:"group flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-blue-50 to-blue-100/50 hover:from-blue-100 hover:to-blue-200/50 border border-blue-200/30 hover:border-blue-300/50 transition-all duration-200 hover:shadow-md",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center group-hover:bg-blue-500/20 transition-colors",children:e.jsx(I,{size:18,className:"text-blue-600"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-blue-900 text-sm",children:"Add Category"}),e.jsx("div",{className:"text-xs text-blue-600",children:"Organize products"})]}),e.jsx("div",{className:"w-6 h-6 bg-blue-500/10 rounded-full flex items-center justify-center group-hover:bg-blue-500/20 transition-colors",children:e.jsx(ee,{size:12,className:"text-blue-600"})})]}),e.jsxs("button",{onClick:()=>{try{Ve(!0),Ye(!1)}catch(e){N.error("Failed to open supplier form")}},className:"group flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-purple-50 to-purple-100/50 hover:from-purple-100 hover:to-purple-200/50 border border-purple-200/30 hover:border-purple-300/50 transition-all duration-200 hover:shadow-md",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-500/10 rounded-lg flex items-center justify-center group-hover:bg-purple-500/20 transition-colors",children:e.jsx(X,{size:18,className:"text-purple-600"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-purple-900 text-sm",children:"Add Supplier"}),e.jsx("div",{className:"text-xs text-purple-600",children:"Manage suppliers"})]}),e.jsx("div",{className:"w-6 h-6 bg-purple-500/10 rounded-full flex items-center justify-center group-hover:bg-purple-500/20 transition-colors",children:e.jsx(ee,{size:12,className:"text-purple-600"})})]}),e.jsxs("button",{onClick:()=>{try{t("/excel-templates"),Ye(!1)}catch(e){N.error("Failed to open templates page")}},className:"group flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-indigo-50 to-indigo-100/50 hover:from-indigo-100 hover:to-indigo-200/50 border border-indigo-200/30 hover:border-indigo-300/50 transition-all duration-200 hover:shadow-md",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-500/10 rounded-lg flex items-center justify-center group-hover:bg-indigo-500/20 transition-colors",children:e.jsx(b,{size:18,className:"text-indigo-600"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-indigo-900 text-sm",children:"Download Template"}),e.jsx("div",{className:"text-xs text-indigo-600",children:"Excel templates"})]}),e.jsx("div",{className:"w-6 h-6 bg-indigo-500/10 rounded-full flex items-center justify-center group-hover:bg-indigo-500/20 transition-colors",children:e.jsx(j,{size:12,className:"text-indigo-600"})})]}),e.jsxs("button",{onClick:()=>{try{st(),Ye(!1)}catch(e){N.error("Failed to start export process")}},className:"group flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-orange-50 to-orange-100/50 hover:from-orange-100 hover:to-orange-200/50 border border-orange-200/30 hover:border-orange-300/50 transition-all duration-200 hover:shadow-md",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-500/10 rounded-lg flex items-center justify-center group-hover:bg-orange-500/20 transition-colors",children:e.jsx(b,{size:18,className:"text-orange-600"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-orange-900 text-sm",children:"Export Products"}),e.jsx("div",{className:"text-xs text-orange-600",children:"Download CSV data"})]}),e.jsx("div",{className:"w-6 h-6 bg-orange-500/10 rounded-full flex items-center justify-center group-hover:bg-orange-500/20 transition-colors",children:e.jsx(ue,{size:12,className:"text-orange-600"})})]})]})}),e.jsx("div",{className:"bg-gray-50/50 px-4 py-2 border-t border-gray-100",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Click outside to close"})})]})]})]})]}),K&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(8)].map((t,s)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},s))})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl border border-gray-200/50 p-1",children:e.jsx("div",{className:"flex space-x-1",children:[{id:"inventory",label:"Inventory Management",icon:h,activeClass:"bg-blue-500 text-white shadow-lg",hoverClass:"text-blue-600 hover:bg-blue-50"},{id:"purchase-orders",label:"Purchase Orders",icon:Y,activeClass:"bg-purple-500 text-white shadow-lg",hoverClass:"text-purple-600 hover:bg-purple-50"},{id:"analytics",label:"Analytics",icon:ie,activeClass:"bg-green-500 text-white shadow-lg",hoverClass:"text-green-600 hover:bg-green-50"}].map(t=>{const s=t.icon,a=ne===t.id;return e.jsxs("button",{onClick:()=>oe(t.id),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-200 ${a?t.activeClass:`text-gray-600 ${t.hoverClass}`}`,children:[e.jsx(s,{size:18}),t.label]},t.id)})})}),"inventory"===ne&&e.jsx(Ze,{products:rt,metrics:at,searchQuery:ce,setSearchQuery:me,selectedCategory:xe,setSelectedCategory:pe,selectedBrand:je,setSelectedBrand:Ne,selectedStatus:ye,setSelectedStatus:ve,showLowStockOnly:ke,setShowLowStockOnly:Pe,showFeaturedOnly:Ce,setShowFeaturedOnly:_e,viewMode:Ae,setViewMode:Ie,sortBy:Te,setSortBy:Be,selectedProducts:$e,setSelectedProducts:Me,categories:y,brands:[],formatMoney:lt,getStatusColor:e=>{switch(e){case"in-stock":return"bg-green-100 text-green-800";case"low-stock":return"bg-yellow-100 text-yellow-800";case"out-of-stock":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},handleStockAdjustment:it,handleBulkAction:nt,setShowStockAdjustModal:Oe,setSelectedProductForHistory:Qe,setShowDeleteConfirmation:De,toggleProductSelection:e=>{Me(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},toggleSelectAll:()=>{$e.length===rt.length?Me([]):Me(rt.map(e=>e.id))},navigate:t,productModals:a,deleteProduct:D}),"purchase-orders"===ne&&e.jsx(Xe,{navigate:t,useInventoryStore:r}),"analytics"===ne&&e.jsx(Je,{products:f,metrics:at,categories:y,formatMoney:lt,liveMetrics:te,isLoadingLiveMetrics:re,onRefreshLiveMetrics:tt}),e.jsx(We,{isOpen:a.showEditModal,onClose:a.closeEditModal,productId:a.editingProductId||"",onProductUpdated:()=>{N.success("Product updated successfully!"),P({page:1,limit:50})}}),Re&&Ke&&e.jsx(he,{product:f.find(e=>e.id===Ke)||void 0,isOpen:Re,onClose:()=>{Oe(!1),Qe(null)},onSubmit:async e=>{const{variant:t,...s}=e;let a=s.quantity;"out"===s.adjustmentType?a=-a:"set"===s.adjustmentType&&(a-=t.quantity),await it(Ke,t.id,a,s.reason)},loading:k}),e.jsx(ge,{isOpen:Le,onClose:()=>ze(!1),onSubmit:async e=>{try{await $(e),N.success("Category created successfully"),ze(!1)}catch(t){N.error("Failed to create category")}},parentCategories:y,loading:k}),qe&&e.jsx(fe,{onSubmit:async e=>{try{const t={...e,leadTimeDays:7,isActive:!0,country:e.country||"TZ",currency:e.currency||"TZS"};await M(t),N.success("Supplier created successfully"),Ve(!1)}catch(t){N.error("Failed to create supplier")}},onClose:()=>Ve(!1)}),Ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>De(!1),children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(z,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Products"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),e.jsxs("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold",children:$e.length})," product",1!==$e.length?"s":"","? This action will permanently remove them from your inventory."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(s,{variant:"secondary",onClick:()=>De(!1),className:"text-sm",children:"Cancel"}),e.jsxs(s,{onClick:()=>{nt("delete"),De(!1)},className:"text-sm bg-red-600 hover:bg-red-700 text-white",children:["Delete ",$e.length," Product",1!==$e.length?"s":""]})]})]})})]}),e.jsx(Ue,{isOpen:we,onClose:()=>Se(!1),onImportComplete:async e=>{Se(!1),N.success(`Successfully imported ${e.length} products!`),await Promise.all([P({page:1,limit:50}),C(),A()])}})]})};export{tt as default};
