import{j as e}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import{m as t}from"./mobileOfflineCache-7b8975c6.js";import{z as r,b7 as a,bm as i,W as n,e as l,R as o,d as c,x as d,t as m,y as x,am as g,U as h,Q as u,H as b,a9 as p,a5 as f}from"./ui-551a39a6.js";import{a as j,u as y,O as v}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";import"./supabase-460661f2.js";const N=({children:x})=>{const[g,h]=s.useState(!1),[u,b]=s.useState(!0),[p,f]=s.useState({step:"Starting...",progress:0,total:7,error:!1,message:"Initializing mobile app..."}),[j,y]=s.useState(navigator.onLine),[v,N]=s.useState(!1);s.useEffect(()=>{w();const e=()=>y(!0),s=()=>y(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]);const w=async()=>{try{f({step:"Database",progress:1,total:7,error:!1,message:"Initializing local database..."}),await new Promise(e=>setTimeout(e,500)),await t.init(),f({step:"Checking Cache",progress:2,total:7,error:!1,message:"Checking cached data..."});const s=await t.getCacheStats(),a=s.products.count>0,i=s.customers.count>0,n=(s.branches.count,s.categories.count,a||i);N(n);const l=navigator.onLine;if(f({step:"Network",progress:3,total:7,error:!1,message:l?"Connected to internet":"No internet connection"}),l){f({step:"Products",progress:4,total:7,error:!1,message:"Syncing products..."+(a?` (${s.products.count} cached)`:"")});try{await t.syncProducts()}catch(e){}f({step:"Customers",progress:5,total:7,error:!1,message:"Syncing customers..."+(i?` (${s.customers.count} cached)`:"")});try{await t.syncCustomers()}catch(e){}f({step:"Settings",progress:6,total:7,error:!1,message:"Syncing branches, categories, and settings..."});try{await Promise.all([t.syncBranches(),t.syncCategories(),t.syncPaymentAccounts(),t.syncRecentSales()])}catch(e){}f({step:"Complete",progress:7,total:7,error:!1,message:"All data synced successfully!"});await t.getCacheStats();r.success("Mobile app ready!",{duration:2e3})}else{if(!n)return void f({step:"Error",progress:3,total:7,error:!0,message:"No internet connection and no cached data. Please connect to the internet for first-time setup."});f({step:"Ready",progress:7,total:7,error:!1,message:"Working offline with cached data"}),r("Working offline with cached data",{icon:"ðŸ“µ",duration:3e3})}await new Promise(e=>setTimeout(e,1e3)),h(!0),b(!1)}catch(e){f({step:"Error",progress:p.progress,total:7,error:!0,message:`Initialization failed: ${e instanceof Error?e.message:"Unknown error"}`})}};return g?e.jsx(e.Fragment,{children:x}):e.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-3xl mx-auto mb-4 flex items-center justify-center shadow-lg",children:e.jsx(a,{size:40,className:"text-white",strokeWidth:2})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"LATS POS Mobile"}),e.jsx("p",{className:"text-gray-600",children:"Setting up your mobile app..."})]}),e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center gap-3 mb-6 pb-4 border-b border-gray-100",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(i,{size:20,className:"text-green-600",strokeWidth:2.5})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"Connected"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Syncing with server"})]}),e.jsx("div",{className:"ml-auto w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-10 h-10 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(n,{size:20,className:"text-orange-600",strokeWidth:2.5})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"Offline"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Using cached data"})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:p.step}),e.jsxs("span",{className:"text-sm text-gray-500",children:[p.progress," / ",p.total]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 overflow-hidden",children:e.jsx("div",{className:"h-2.5 rounded-full transition-all duration-500 "+(p.error?"bg-red-500":"bg-blue-500"),style:{width:p.progress/p.total*100+"%"}})})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-xl",children:[p.error?e.jsx(l,{size:20,className:"text-red-500 flex-shrink-0 mt-0.5",strokeWidth:2}):u?e.jsx(o,{size:20,className:"text-blue-500 flex-shrink-0 mt-0.5 animate-spin",strokeWidth:2}):e.jsx(c,{size:20,className:"text-green-500 flex-shrink-0 mt-0.5",strokeWidth:2}),e.jsx("p",{className:"text-sm "+(p.error?"text-red-700":"text-gray-700"),children:p.message})]}),!p.error&&u&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{icon:a,label:"DB",step:1},{icon:d,label:"Products",step:4},{icon:m,label:"Customers",step:5},{icon:c,label:"Done",step:7}].map((s,t)=>{const r=s.icon,a=p.progress>=s.step,i=p.progress===s.step;return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 mx-auto rounded-lg flex items-center justify-center mb-1 transition-all "+(a?"bg-blue-500 text-white":i?"bg-blue-100 text-blue-600 animate-pulse":"bg-gray-100 text-gray-400"),children:e.jsx(r,{size:18,strokeWidth:2.5})}),e.jsx("div",{className:"text-xs "+(a?"text-gray-900 font-medium":"text-gray-400"),children:s.label})]},t)})})})]}),p.error&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>{b(!0),f({step:"Retrying...",progress:0,total:7,error:!1,message:"Retrying initialization..."}),w()},className:"w-full bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white px-6 py-3.5 rounded-xl font-semibold transition-all shadow-lg flex items-center justify-center gap-2",children:[e.jsx(o,{size:20,strokeWidth:2.5}),"Retry"]}),v&&e.jsxs("button",{onClick:()=>{v&&(h(!0),b(!1),r("Working offline with limited data",{icon:"ðŸ“µ",duration:3e3}))},className:"w-full bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-700 px-6 py-3.5 rounded-xl font-semibold transition-all flex items-center justify-center gap-2",children:[e.jsx(n,{size:20,strokeWidth:2.5}),"Continue Offline"]})]}),!p.error&&e.jsx("p",{className:"text-center text-sm text-gray-500 mt-4",children:j?"This may take a few moments on first launch":"Connect to the internet for full functionality"})]})})},w=()=>{const s=j(),t=y(),r=[{id:"home",label:"Home",icon:b,path:"/mobile/dashboard"},{id:"clients",label:"Clients",icon:m,path:"/mobile/clients"},{id:"pos",label:"POS",icon:p,path:"/mobile/pos"},{id:"inventory",label:"Inventory",icon:f,path:"/mobile/inventory"},{id:"more",label:"More",icon:null,path:"/mobile/more"}];return e.jsx(N,{children:e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50 overflow-hidden",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3 pb-4",children:e.jsxs("div",{className:"flex justify-end items-center gap-4 mb-4",children:[e.jsx("button",{className:"text-gray-500 hover:text-gray-700",children:e.jsx(x,{size:20})}),e.jsxs("button",{className:"text-gray-500 hover:text-gray-700 relative",children:[e.jsx(g,{size:20}),e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:"3"})]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700",children:e.jsx(h,{size:20})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(v,{})}),e.jsx("button",{className:"fixed bottom-24 right-5 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg z-50 transition-all",onClick:()=>s("/mobile/create"),children:e.jsx(u,{size:26,strokeWidth:2.5})}),e.jsx("nav",{className:"bg-white border-t border-gray-200 px-2 py-2 safe-area-inset-bottom",children:e.jsx("div",{className:"flex justify-around items-center",children:r.map(r=>{const a=r.icon,i=(n=r.path,t.pathname===n);var n;return e.jsxs("button",{onClick:()=>s(r.path),className:"flex flex-col items-center justify-center py-2 px-4 min-w-[60px] transition-colors "+(i?"text-blue-500":"text-gray-500"),children:[a?e.jsx(a,{size:24,className:"mb-1",strokeWidth:i?2.5:2}):e.jsxs("div",{className:"mb-1 flex gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-current rounded-full"}),e.jsx("span",{className:"w-1 h-1 bg-current rounded-full"}),e.jsx("span",{className:"w-1 h-1 bg-current rounded-full"})]}),e.jsx("span",{className:"text-xs "+(i?"font-semibold":"font-normal"),children:r.label})]},r.id)})})})]})})};export{w as default};
