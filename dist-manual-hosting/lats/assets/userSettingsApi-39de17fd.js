import{s as e}from"./index-222cfb29.js";import{z as t}from"./ui-551a39a6.js";const s=async t=>{var s,r;let i=0;for(;i<3;)try{const{data:r,error:n}=await e.from("user_settings").select("id").limit(1);if(n){if("42P01"===n.code)return null;if("42710"!==n.code)return"42601"===n.code||"42P10"===n.code||n.code,null}const{data:o,error:u}=await e.from("user_settings").select("*").eq("user_id",t).single();if(u){if(("406"===u.code||(null==(s=u.message)?void 0:s.includes("406")))&&(i++,i<3)){await new Promise(e=>setTimeout(e,1e3*i));continue}if("PGRST116"===u.code)return null;throw u}return(null==o?void 0:o.settings)||null}catch(n){if(i>=2)return null==(r=n.message)||r.includes("406"),null;i++,await new Promise(e=>setTimeout(e,1e3*i))}return null},r=async(s,r,i)=>{var n,o;let u=0;for(;u<3;)try{const{error:o}=await e.from("user_settings").upsert({user_id:s,settings:r,updated_at:(new Date).toISOString()});if(o){if(("406"===o.code||(null==(n=o.message)?void 0:n.includes("406")))&&(u++,u<3)){await new Promise(e=>setTimeout(e,1e3*u));continue}if("42P01"===o.code)return!1;if("42710"===o.code)continue;throw o}return i&&t.success(`${i} settings saved successfully`),!0}catch(a){if(u>=2)return(null==(o=a.message)?void 0:o.includes("406"))||t.error("Failed to save settings"),!1;u++,await new Promise(e=>setTimeout(e,1e3*u))}return!1};export{s as l,r as s};
