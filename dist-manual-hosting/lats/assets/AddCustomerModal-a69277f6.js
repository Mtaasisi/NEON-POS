import{a as e,j as t}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import{o as a,X as o,n as r}from"./ui-551a39a6.js";import{C as n}from"./CustomerForm-05944812.js";import{f as l,a as i}from"./phoneUtils-1ba19aca.js";import{u as d,S as c}from"./useSuccessModal-e8b7d685.js";import{S as m}from"./SuccessModalIcons-20b743c5.js";const u=({isOpen:u,onClose:h,onCustomerCreated:p,onAddAnother:x})=>{const{addCustomer:b}=e(),[g,y]=s.useState(!1),v=d();return t.jsxs(t.Fragment,{children:[u&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed bg-black/50",onClick:h,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),t.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:t.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",style:{pointerEvents:"auto"},children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx(a,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Add New Customer"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Enter customer details below"})]})]}),t.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(o,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(n,{onSubmit:async e=>{var t,s;try{y(!0);const t={name:e.name,phone:l(e.phone),email:"",gender:e.gender,city:e.city,whatsapp:i(e.whatsapp||""),referralSource:e.referralSource,birthMonth:e.birthMonth,birthDay:e.birthDay,notes:[],loyaltyLevel:"interested",colorTag:e.customerTag,referrals:[],totalSpent:0,points:0,lastVisit:(new Date).toISOString(),isActive:!0,devices:[]},s=await b(t);s?(v.show(`${s.name} has been added to your customer list!`,{title:"Customer Added! âœ…",icon:m.customerAdded,autoCloseDelay:0,actionButtons:[{label:"Message on WhatsApp",onClick:()=>{const e=s.whatsapp||s.phone,t=null==e?void 0:e.replace(/\D/g,"");if(t){const e=encodeURIComponent(`Hello ${s.name}, thank you for becoming our customer!`);window.open(`https://wa.me/${t}?text=${e}`,"_blank")}else r.error("Customer has no phone number")},variant:"whatsapp"},{label:"View Customer",onClick:()=>{p&&p(s)},variant:"secondary"},{label:"Add Another",onClick:()=>{x?x():r.success("Ready to add another customer!")},variant:"secondary"}]}),h()):r.error("Failed to create customer. Please try again.")}catch(a){let e="Failed to create customer. Please try again.";(null==(t=null==a?void 0:a.message)?void 0:t.includes("not authenticated"))?e="You are not logged in. Please log in and try again.":"23505"===(null==a?void 0:a.code)?e="A customer with this phone number already exists.":"23502"===(null==a?void 0:a.code)?e="Missing required field. Please check all required fields.":"42P01"===(null==a?void 0:a.code)?e="Database table not found. Please contact support.":"42703"===(null==a?void 0:a.code)?e="Database column not found. Please contact support.":(null==(s=null==a?void 0:a.message)?void 0:s.includes("RLS"))&&(e="Database security policy blocking insert. Please contact support."),r.error(e)}finally{y(!1)}},onCancel:h,isLoading:g,renderActionsInModal:!1}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsx("button",{type:"button",onClick:h,disabled:g,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),t.jsx("button",{type:"button",onClick:()=>{const e=document.getElementById("customer-form");e&&e.requestSubmit()},disabled:g,className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Adding...":"Add Customer"})]}),t.jsx("p",{className:"text-xs text-center text-gray-500 mt-2",children:"All changes are saved automatically"})]})]})})})]}),t.jsx(c,{...v.props})]})};export{u as A};
