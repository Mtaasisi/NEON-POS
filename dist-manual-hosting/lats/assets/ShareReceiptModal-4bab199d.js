import{_ as t}from"./supabase-7e851d02.js";import{s as e,a3 as a,a4 as s,j as r,p as n}from"./index-222cfb29.js";import{n as o,X as i,b8 as c,g as l,s as u,a7 as d,j as m,a8 as p,aj as f}from"./ui-551a39a6.js";import{r as h,b as y}from"./vendor-a2ff445a.js";import{u as _,S as g}from"./useSuccessModal-e8b7d685.js";import{S as v}from"./SuccessModalIcons-20b743c5.js";const S=new class{async ensureAuthentication(){try{const{data:{user:a},error:s}=await e.auth.getUser();if(a&&!s)return{success:!0,user:a};const r=localStorage.getItem("user");if(r)try{const t=JSON.parse(r);return{success:!0,user:{email:t.email,id:t.id||"system",user_metadata:{name:t.name||t.email}}}}catch(t){}return{success:!0,user:{email:"system@neon.direct",id:"system",user_metadata:{name:"System User"}}}}catch(a){return{success:!0,user:{email:"system@neon.direct",id:"system",user_metadata:{name:"System User"}}}}}async processSale(t){try{const e=await this.ensureAuthentication();if(!e.success)return{success:!1,error:e.error||"Authentication required. Please log in to process sales."};if(!t.customerId)return{success:!1,error:"Please select a customer before creating a sale"};const{stockValidation:s,itemsWithCosts:r}=await this.validateStockAndCalculateCosts(t.items);if(!s.success)return{success:!1,error:s.error};const n=await this.saveSaleToDatabase({...t,items:r});if(!n.success)return{success:!1,error:n.error};const[i,c,l,u]=await Promise.allSettled([this.updateInventory(t.items),this.generateReceipt(n.sale),this.updateCustomerStats(t),this.linkSerialNumbers(n.saleId,t.items,t.customerId)]);return"rejected"===i.status||i.value.success,"rejected"===c.status||c.value.success,"rejected"===l.status||l.value.success,"rejected"===u.status||u.value.success,this.sendNotifications(n.sale).catch(t=>{}),o.success("Sale completed successfully!"),a(n.sale),{success:!0,saleId:n.saleId,sale:n.sale}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}async validateStockAndCalculateCosts(t){try{const a=t.map(t=>t.variantId);if(0===a.length)return{stockValidation:{success:!0},itemsWithCosts:[]};const{data:s,error:r}=await e.from("lats_product_variants").select("id, quantity, cost_price, is_parent, variant_type, parent_variant_id").in("id",a);if(r)return{stockValidation:{success:!1,error:`Failed to check stock and costs: ${r.message}`},itemsWithCosts:t.map(t=>({...t,costPrice:0,profit:t.totalPrice}))};const n=new Map((null==s?void 0:s.map(t=>[t.id,t]))||[]),o=[];for(const i of t){const t=n.get(i.variantId);if(!t)return{stockValidation:{success:!1,error:`Product variant not found: ${i.productName}`},itemsWithCosts:[]};let a=t.quantity;if(t.is_parent||"parent"===t.variant_type){const{data:t}=await e.from("lats_product_variants").select("quantity").eq("parent_variant_id",i.variantId).eq("is_active",!0);a=(null==t?void 0:t.reduce((t,e)=>t+(e.quantity||0),0))||0}if(a<i.quantity)return{stockValidation:{success:!1,error:`Insufficient stock for ${i.productName} (${i.variantName}). Available: ${a}, Requested: ${i.quantity}`},itemsWithCosts:[]};const s=t.cost_price||0,r=s*i.quantity,c=i.totalPrice-r;o.push({...i,costPrice:s,profit:c})}return{stockValidation:{success:!0},itemsWithCosts:o}}catch(a){return{stockValidation:{success:!1,error:`Failed to validate stock and calculate costs: ${a instanceof Error?a.message:"Unknown error"}`},itemsWithCosts:t.map(t=>({...t,costPrice:0,profit:t.totalPrice}))}}}async validateStock(t){try{const a=t.map(t=>t.variantId);if(0===a.length)return{success:!0};const{data:s,error:r}=await e.from("lats_product_variants").select("id, quantity").in("id",a);if(r)return{success:!1,error:"Failed to check stock availability"};const n=new Map((null==s?void 0:s.map(t=>[t.id,t.quantity]))||[]);for(const e of t){const t=n.get(e.variantId);if(void 0===t)return{success:!1,error:`Product variant not found: ${e.productName}`};if(t<e.quantity)return{success:!1,error:`Insufficient stock for ${e.productName} (${e.variantName}). Available: ${t}, Requested: ${e.quantity}`}}return{success:!0}}catch(a){return{success:!1,error:"Failed to validate stock availability"}}}async calculateCostsAndProfits(t){try{const a=t.map(t=>t.variantId);if(0===a.length)return[];const{data:s,error:r}=await e.from("lats_product_variants").select("id, cost_price").in("id",a);if(r)return t.map(t=>({...t,unitPrice:t.quantity>0?t.totalPrice/t.quantity:0,costPrice:0,profit:t.totalPrice}));const n=new Map((null==s?void 0:s.map(t=>[t.id,t.cost_price||0]))||[]);return t.map(t=>{const e=n.get(t.variantId)||0,a=e*t.quantity,s=t.totalPrice-a,r=t.quantity>0?t.totalPrice/t.quantity:0;return{...t,unitPrice:r,costPrice:e,profit:s}})}catch(a){return t.map(t=>({...t,unitPrice:t.quantity>0?t.totalPrice/t.quantity:0,costPrice:0,profit:t.totalPrice}))}}async saveSaleToDatabase(t){var a,s,r,n,o,i,c,l,u,d,m,p,f,h,y;try{const S=this.generateSaleNumber(),b=await this.ensureAuthentication();if(!b.success)return{success:!1,error:b.error||"Authentication required. Please log in to process sales."};const w=(null==(a=b.user)?void 0:a.email)||"system",x=((null==(r=null==(s=b.user)?void 0:s.user_metadata)?void 0:r.name)||(null==(o=null==(n=b.user)?void 0:n.user_metadata)?void 0:o.full_name)||(null==(c=null==(i=b.user)?void 0:i.email)||c.split("@")[0]),{...t.paymentMethod,amount:t.total}),N="string"==typeof t.subtotal?parseFloat(t.subtotal):t.subtotal,I="string"==typeof t.discount?parseFloat(t.discount):t.discount,P="string"==typeof t.tax?parseFloat(t.tax):t.tax,$=1e9,k=0;if(t.total<k||t.total>$)return{success:!1,error:`Invalid sale amount: ${t.total}. Must be between ${k} and ${$}`};if(!Number.isSafeInteger(Math.round(100*t.total)))return{success:!1,error:`Sale amount is too large: ${t.total}`};if(void 0!==N&&(N<k||N>$))return{success:!1,error:`Invalid subtotal: ${N}`};const C="undefined"!=typeof localStorage?localStorage.getItem("current_branch_id"):null,j=JSON.parse(JSON.stringify(x)),M={sale_number:S,customer_id:t.customerId,total_amount:t.total,payment_method:j,payment_status:t.paymentStatus||"completed",sold_by:w,branch_id:C,...void 0!==N&&!isNaN(N)&&{subtotal:N},...void 0!==I&&!isNaN(I)&&{discount:I},...t.customerName&&{customer_name:t.customerName},...t.customerPhone&&{customer_phone:t.customerPhone},...t.customerEmail&&{customer_email:t.customerEmail},...void 0!==P&&!isNaN(P)&&{tax:P},...t.notes&&{notes:t.notes}};let E,q;const{data:T,error:R}=await e.from("lats_sales").insert([M]).select().single();if(R){const a={sale_number:S,customer_id:t.customerId,total_amount:t.total,payment_method:j,payment_status:t.paymentStatus||"completed",sold_by:w,branch_id:C,...void 0!==N&&!isNaN(N)&&{subtotal:N},...void 0!==I&&!isNaN(I)&&{discount:I},...void 0!==P&&!isNaN(P)&&{tax:P},...t.customerName&&{customer_name:t.customerName},...t.customerPhone&&{customer_phone:t.customerPhone},...t.customerEmail&&{customer_email:t.customerEmail}},{data:s,error:r}=await e.from("lats_sales").insert([a]).select().single();if(r)return{success:!1,error:`Failed to create sale: ${R.message}. Fallback also failed: ${r.message}`};E=s,q=null}else E=T,q=null;const D=t.items.map(t=>{const e=t=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t);e(t.productId),e(t.variantId);const a="string"==typeof t.unitPrice?parseFloat(t.unitPrice):t.unitPrice||0,s="string"==typeof t.totalPrice?parseFloat(t.totalPrice):t.totalPrice||0,r="string"==typeof t.costPrice?parseFloat(t.costPrice):t.costPrice||0,n="string"==typeof t.profit?parseFloat(t.profit):t.profit||0;return{sale_id:E.id,product_id:t.productId,variant_id:t.variantId,product_name:t.productName,variant_name:t.variantName,sku:t.sku,quantity:t.quantity,unit_price:a,total_price:s,cost_price:r,profit:n}}),{error:A}=await e.from("lats_sale_items").insert(D);if(A)return{success:!1,error:`Sale created but items failed: ${A.message}`};try{const a=null==(u=null==(l=null==t?void 0:t.paymentMethod)?void 0:l.details)?void 0:u.payments,s=Array.isArray(a)?a:[{method:null==(d=null==t?void 0:t.paymentMethod)?void 0:d.type,amount:(null==(m=null==t?void 0:t.paymentMethod)?void 0:m.amount)??t.total,accountId:null==(f=null==(p=null==t?void 0:t.paymentMethod)?void 0:p.details)?void 0:f.accountId,reference:null==(y=null==(h=null==t?void 0:t.paymentMethod)?void 0:h.details)?void 0:y.reference,notes:null==t?void 0:t.notes,timestamp:null==t?void 0:t.soldAt}];for(const r of s)if((null==r?void 0:r.amount)&&!(r.amount<=0)&&r.accountId){try{const{data:t,error:a}=await e.from("finance_accounts").select("balance").eq("id",r.accountId).single();if(a)continue;if(t&&"number"==typeof t.balance){const a=t.balance+r.amount,{error:s}=await e.from("finance_accounts").update({balance:a,updated_at:(new Date).toISOString()}).eq("id",r.accountId)}}catch(_){}try{const{error:a}=await e.from("account_transactions").insert({account_id:r.accountId,transaction_type:"payment_received",amount:r.amount,reference_number:S,description:`POS sale payment (${r.method||"payment"})`,metadata:{sale_id:E.id,customer_id:t.customerId},created_at:(new Date).toISOString()})}catch(g){}}}catch(v){v instanceof Error?v.message:String(v),v instanceof Error&&v.stack}const O={...t,id:E.id,saleNumber:S,soldBy:w,createdAt:E.created_at};return{success:!0,saleId:E.id,sale:O}}catch(S){return{success:!1,error:S instanceof Error?S.message:"Failed to save sale to database"}}}async updateCustomerStats(a){try{if(!a.customerId)return{success:!0};const r=Math.floor(a.total/1e3);try{const s={last_visit:(new Date).toISOString(),updated_at:(new Date).toISOString()},{data:n}=await e.from("lats_customers").select("*").eq("id",a.customerId).single();if(n){const{parseAmount:e}=await t(()=>import("./format-0f0b2647.js"),[]);if("total_spent"in n){const t=e(n.total_spent),r=t+e(a.total);if(r>1e12)return{success:!1,error:"Customer total would exceed realistic limit"};s.total_spent=Math.max(0,r)}if("total_orders"in n){const t=e(n.total_orders);s.total_orders=t+1}if("points"in n){const t=e(n.points);s.points=t+r}}const{error:o}=await e.from("lats_customers").update(s).eq("id",a.customerId);if(o)return{success:!0}}catch(s){return{success:!0}}return{success:!0}}catch(r){return{success:!1,error:"Failed to update customer stats"}}}async updateInventory(t){try{let r="system";try{const{data:{user:t}}=await e.auth.getUser();r=(null==t?void 0:t.id)||"system"}catch{r="system"}const n=t.map(t=>t.variantId);if(0===n.length)return{success:!0};const{data:o,error:i}=await e.from("lats_product_variants").select("id, quantity, is_parent, variant_type").in("id",n);if(i)throw new Error(`Failed to fetch current stock: ${i.message}`);const c=new Map(o.map(t=>[t.id,t])),l=t.map(t=>{const a=c.get(t.variantId),s=(null==a?void 0:a.quantity)||0,r=Math.max(0,s-t.quantity);return(null==a?void 0:a.is_parent)||null==a||a.variant_type,e.from("lats_product_variants").update({quantity:r,updated_at:(new Date).toISOString()}).eq("id",t.variantId)}),u=t.map(t=>{const e=c.get(t.variantId),a=(null==e?void 0:e.quantity)||0,s=Math.max(0,a-t.quantity);return{product_id:t.productId,variant_id:t.variantId,movement_type:"out",quantity:t.quantity,previous_quantity:a,new_quantity:s,reason:"Sale",reference:`Sale ${t.sku}`,notes:`Sold ${t.quantity} units of ${t.productName} (${t.variantName})`,created_by:r}}),d=await Promise.allSettled(l);for(let e=0;e<d.length;e++){const a=d[e];if("rejected"===a.status)return{success:!1,error:`Failed to update inventory for ${t[e].productName}`};if("fulfilled"===a.status&&a.value.error)return{success:!1,error:`Failed to update inventory for ${t[e].productName}`}}try{const{error:t}=await e.from("lats_stock_movements").insert(u)}catch(a){}return t.forEach(t=>{s(t.productId,t.variantId,t.quantity)}),{success:!0}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to update inventory"}}}async linkSerialNumbers(t,a,s){try{const r=[];for(const t of a)if(t.selectedSerialNumbers&&Array.isArray(t.selectedSerialNumbers)){const e=t.selectedSerialNumbers;for(const t of e)t.id&&r.push(t.id)}if(0===r.length)return{success:!0};const n=r.map(e=>({sale_id:t,inventory_item_id:e,customer_id:s||null})),{error:o}=await e.from("sale_inventory_items").insert(n);if(o)return{success:!1,error:o.message};const{error:i}=await e.from("inventory_items").update({status:"sold"}).in("id",r);return i?{success:!1,error:i.message}:{success:!0}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async generateReceipt(a){try{const{businessInfoService:r}=await t(()=>import("./index-222cfb29.js").then(t=>t.aP),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),n=await r.getBusinessInfo();try{const{error:t}=await e.from("lats_receipts").insert([{sale_id:a.id,receipt_number:`RCP-${a.saleNumber}`,customer_name:a.customerName||"Walk-in Customer",customer_phone:a.customerPhone||null,total_amount:a.total,payment_method:a.paymentMethod.type,items_count:a.items.length,generated_by:a.soldBy,receipt_content:{sale:a,generated_at:(new Date).toISOString(),business_info:{name:n.name,address:n.address,phone:n.phone,email:n.email,website:n.website,logo:n.logo}}}]);if(t)return{success:!0}}catch(s){return{success:!0}}return{success:!0}}catch(r){return{success:!0}}}async sendNotifications(t){try{t.customerPhone&&await this.sendSMSNotification(t)}catch(e){}}async sendSMSNotification(e){try{const s=await this.generateSMSMessage(e);try{const{smsService:a}=await t(()=>import("./index-222cfb29.js").then(t=>t.aU),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),r=await a.sendSMS(e.customerPhone,s);r.success||r.error&&!r.error.includes("Network error")&&r.error.includes("Failed to fetch")}catch(a){}}catch(s){}}async generateSMSMessage(e){const a=e.items.map(t=>`${t.productName} x${t.quantity}`).join(", "),s=e.discount>0?`\nDiscount: ${this.formatMoney(e.discount)}`:"";let r="Thank you for your purchase!",n="Thank you for choosing us!";try{const{POSSettingsService:e}=await t(()=>import("./index-222cfb29.js").then(t=>t.aQ),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),a=await e.loadReceiptSettings();(null==a?void 0:a.sms_header_message)&&(r=a.sms_header_message),(null==a?void 0:a.sms_footer_message)&&(n=a.sms_footer_message)}catch(o){}return`${r}\nSale #${e.saleNumber}\nItems: ${a}\nTotal: ${this.formatMoney(e.total)}${s}\nPayment: ${e.paymentMethod.type.toUpperCase()}\n${n}`}formatMoney(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}generateSaleNumber(){return`SALE-${Date.now().toString().slice(-8)}-${Math.random().toString(36).substr(2,4).toUpperCase()}`}async getSaleById(t){try{const{data:a,error:s}=await e.from("lats_sales").select("*").eq("id",t).single();if(s)return null;const{data:r}=await e.from("lats_sale_items").select("*").eq("sale_id",t);if(r&&r.length>0){const t=[...new Set(r.map(t=>t.product_id).filter(Boolean))],s=[...new Set(r.map(t=>t.variant_id).filter(Boolean))],[n,o]=await Promise.all([t.length>0?e.from("lats_products").select("id, name").in("id",t):{data:[]},s.length>0?e.from("lats_product_variants").select("id, name, variant_name, sku").in("id",s):{data:[]}]),i=new Map((n.data||[]).map(t=>[t.id,t])),c=new Map((o.data||[]).map(t=>[t.id,{...t,name:t.variant_name||t.name}])),l=r.map(t=>({...t,lats_products:i.get(t.product_id),lats_product_variants:c.get(t.variant_id)}));return{...a,lats_sale_items:l}}return{...a,lats_sale_items:[]}}catch(a){return null}}async getRecentSales(t=10){try{const{data:a,error:s}=await e.from("lats_sales").select("*").order("created_at",{ascending:!1}).limit(t);if(s)return[];if(!a||0===a.length)return[];const r=a.map(t=>t.id),{data:n}=await e.from("lats_sale_items").select("*").in("sale_id",r);if(n&&n.length>0){const t=[...new Set(n.map(t=>t.product_id).filter(Boolean))],s=[...new Set(n.map(t=>t.variant_id).filter(Boolean))],[r,o]=await Promise.all([t.length>0?e.from("lats_products").select("id, name").in("id",t):{data:[]},s.length>0?e.from("lats_product_variants").select("id, name, variant_name, sku").in("id",s):{data:[]}]),i=new Map((r.data||[]).map(t=>[t.id,t])),c=new Map((o.data||[]).map(t=>[t.id,{...t,name:t.variant_name||t.name}])),l=new Map;return n.forEach(t=>{l.has(t.sale_id)||l.set(t.sale_id,[]),l.get(t.sale_id).push({...t,lats_products:i.get(t.product_id),lats_product_variants:c.get(t.variant_id)})}),a.map(t=>({...t,lats_sale_items:l.get(t.id)||[]}))}return a.map(t=>({...t,lats_sale_items:[]}))}catch(a){return[]}}},b=class t{saveCustomers(e){try{const a={data:e,timestamp:Date.now(),version:"1.2"};localStorage.setItem(t.CUSTOMERS_KEY,JSON.stringify(a))}catch(a){}}getCustomers(){try{const e=localStorage.getItem(t.CUSTOMERS_KEY);if(!e)return null;const a=JSON.parse(e);if("1.2"!==a.version)return this.clearCustomers(),null;return Date.now()-a.timestamp>9e5?(this.clearCustomers(),null):a.data}catch(e){return null}}clearCustomers(){localStorage.removeItem(t.CUSTOMERS_KEY)}getCacheAge(){try{const e=localStorage.getItem(t.CUSTOMERS_KEY);if(!e)return 1/0;const a=JSON.parse(e);return Date.now()-a.timestamp}catch{return 1/0}}};b.CUSTOMERS_KEY="pos_customers_cache";const w=new b,x=({isOpen:t,onClose:e,onPrintReceipt:a,receiptData:s})=>{const[S,b]=h.useState(!1),[w,x]=h.useState(""),N=_();if(!t)return null;const I=()=>{const t=["ðŸ§¾ RECEIPT #"+s.receiptNumber,"ðŸ“… "+(new Date).toLocaleDateString()+", "+(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),""];return s.items&&s.items.length>0&&(t.push("ðŸ“¦ Items: "+s.items.length),s.items.forEach((e,a)=>{const s=`${a+1}. ${e.productName}${e.quantity>1?" x"+e.quantity:""} - ${e.totalPrice.toLocaleString()} TZS`;t.push(s)})),t.push(""),t.push("ðŸ’° TOTAL: "+s.amount.toLocaleString()+" TZS"),t.push(""),t.push("âœ¨ Thank you for shopping with us!"),t.join("\n")},P=[{name:"WhatsApp",icon:u,color:"#25D366",onClick:()=>{const t=I(),e=s.customerPhone||"",a=e?`https://wa.me/${e.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(t)}`:`https://wa.me/?text=${encodeURIComponent(t)}`;window.open(a,"_blank")}},{name:"SMS",icon:d,color:"#0088cc",onClick:async()=>{const t=I(),a=s.customerPhone;if(!a)return void o.error("No customer phone number available");const r=a.replace(/[^0-9+]/g,"");b(!0),x("SMS");try{const s=await n.sendSMS(r,t);s.success?(N.show(`Receipt sent successfully to ${a}!`,{title:"SMS Sent! âœ…",icon:v.messageSent,autoCloseDelay:3e3}),setTimeout(()=>{e()},500)):o.error(s.error||"Failed to send SMS")}catch(i){o.error("Failed to send SMS. Please try again.")}finally{b(!1),x("")}}},{name:"Email",icon:m,color:"#EA4335",onClick:()=>{const t=`Receipt #${s.receiptNumber}`,e=I(),a=`mailto:${s.customerEmail||""}?subject=${encodeURIComponent(t)}&body=${encodeURIComponent(e)}`;window.location.href=a}},{name:"Print",icon:p,color:"#F59E0B",onClick:()=>{a?(a(),setTimeout(()=>e(),300)):o.error("Print function not available")}},{name:"Download",icon:f,color:"#8B5CF6",onClick:()=>{const t=`\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Receipt #${s.receiptNumber}</title>\n  <style>\n    body { font-family: Arial, sans-serif; max-width: 400px; margin: 20px auto; padding: 20px; }\n    h1 { text-align: center; color: #333; }\n    .receipt-info { margin: 20px 0; }\n    .items { margin: 20px 0; border-top: 2px dashed #ccc; border-bottom: 2px dashed #ccc; padding: 10px 0; }\n    .item { margin: 5px 0; }\n    .total { font-size: 1.2em; font-weight: bold; text-align: right; margin-top: 10px; }\n  </style>\n</head>\n<body>\n  <h1>RECEIPT</h1>\n  <div class="receipt-info">\n    <div>Receipt #: ${s.receiptNumber}</div>\n    <div>Date: ${(new Date).toLocaleDateString()}</div>\n    <div>Time: ${(new Date).toLocaleTimeString()}</div>\n    ${s.customerName?`<div>Customer: ${s.customerName}</div>`:""}\n  </div>\n  <div class="items">\n    <h3>Items:</h3>\n    ${(null==(e=s.items)?void 0:e.map(t=>`\n      <div class="item">\n        ${t.productName} (x${t.quantity}) - ${t.totalPrice.toLocaleString()} TZS\n      </div>\n    `).join(""))||""}\n  </div>\n  <div class="total">TOTAL: ${s.amount.toLocaleString()} TZS</div>\n  <p style="text-align: center; margin-top: 20px; color: #666;">Thank you for your business!</p>\n</body>\n</html>\n    `;var e;const a=new Blob([t],{type:"text/html"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=`receipt-${s.receiptNumber}.html`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}},{name:"Share",icon:c,color:"#10B981",onClick:async()=>{const t=I();if(navigator.share)try{await navigator.share({title:`Receipt #${s.receiptNumber}`,text:t})}catch(e){}else alert("Share feature not supported in this browser. Please use WhatsApp, SMS, or Email buttons instead.")}}];return y.createPortal(r.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center bg-black/40 animate-fadeIn",onClick:e,children:[r.jsx("style",{children:"\n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        @keyframes slideUp {\n          from {\n            opacity: 0;\n            transform: translateY(20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        .animate-fadeIn {\n          animation: fadeIn 0.2s ease-out;\n        }\n        .animate-slideUp {\n          animation: slideUp 0.3s ease-out;\n        }\n      "}),r.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden relative animate-slideUp",onClick:t=>t.stopPropagation(),children:[r.jsx("button",{onClick:e,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-10",children:r.jsx(i,{className:"w-5 h-5",strokeWidth:2})}),r.jsxs("div",{className:"p-8 text-center bg-gradient-to-br from-blue-50 to-indigo-50",children:[r.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:"linear-gradient(135deg, rgb(59, 130, 246) 0%, rgb(37, 99, 235) 100%)",boxShadow:"rgba(59, 130, 246, 0.3) 0px 8px 24px"},children:r.jsx(c,{className:"w-10 h-10 text-white",strokeWidth:2.5})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Share Receipt"}),r.jsxs("p",{className:"text-base text-gray-600",children:["Receipt #",s.receiptNumber]})]}),S&&r.jsxs("div",{className:"absolute inset-0 bg-white/95 rounded-2xl flex flex-col items-center justify-center z-10",children:[r.jsx(l,{size:48,color:"#0088cc",className:"animate-spin"}),r.jsxs("p",{className:"mt-4 text-base font-semibold text-gray-700",children:["Sending ",w,"..."]}),r.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Please wait"}),r.jsx("style",{children:"\n              @keyframes spin {\n                from { transform: rotate(0deg); }\n                to { transform: rotate(360deg); }\n              }\n              .animate-spin {\n                animation: spin 1s linear infinite;\n              }\n            "})]}),r.jsxs("div",{className:"p-6",children:[r.jsx("div",{className:"grid grid-cols-3 gap-3 mb-5",style:{opacity:S?.5:1,pointerEvents:S?"none":"auto"},children:P.map((t,a)=>{const s=t.icon,n="SMS"===t.name;return r.jsxs("button",{onClick:()=>{n?t.onClick():(t.onClick(),setTimeout(()=>e(),500))},disabled:S,className:"flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl bg-white cursor-pointer transition-all hover:-translate-y-1 hover:shadow-lg disabled:cursor-not-allowed disabled:opacity-60",style:{opacity:S?.6:1},onMouseEnter:e=>{S||(e.currentTarget.style.borderColor=t.color,e.currentTarget.style.background=`${t.color}08`,e.currentTarget.style.boxShadow=`0 8px 16px ${t.color}20`)},onMouseLeave:t=>{S||(t.currentTarget.style.borderColor="#e5e7eb",t.currentTarget.style.background="#fff")},children:[r.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mb-2",style:{background:`${t.color}15`},children:r.jsx(s,{size:24,color:t.color,strokeWidth:2})}),r.jsx("span",{className:"text-sm font-semibold text-gray-700",children:t.name})]},a)})}),(s.customerPhone||s.customerEmail)&&r.jsxs("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border border-gray-200",children:[r.jsx("div",{className:"font-bold text-gray-800 mb-2 text-sm",children:"Customer:"}),s.customerName&&r.jsx("div",{className:"text-sm text-gray-700 font-medium",children:s.customerName}),s.customerPhone&&r.jsx("div",{className:"text-sm text-gray-600",children:s.customerPhone}),s.customerEmail&&r.jsx("div",{className:"text-sm text-gray-600",children:s.customerEmail})]})]})]}),r.jsx(g,{...N.props})]}),document.body)};export{x as S,w as c,S as s};
