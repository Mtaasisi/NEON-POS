import{u as e,s as t,t as s,j as a,G as n,d as r}from"./index-222cfb29.js";import{r as l,R as c}from"./vendor-a2ff445a.js";import{G as i}from"./GlassInput-ba5c3c0d.js";import{G as o}from"./GlassSelect-3b56e5f5.js";import{M as d}from"./Modal-ccfa5014.js";import{n as x,ba as m,R as p,Q as u,aj as g,$ as h,f,bu as j,b4 as y,aC as b,D as v,y as N,a5 as E,u as w,av as S,d as _,h as C,A as F,b7 as T,J as A,x as D,Y as R,U as O,H as P,a4 as k}from"./ui-551a39a6.js";import{u as $,S as I}from"./useSuccessModal-e8b7d685.js";const L=()=>{const{currentUser:L}=e(),H=$(),[X,q]=l.useState([]),[M,U]=l.useState([]),[G,z]=l.useState([]),[V,Z]=l.useState(!0),[B,J]=l.useState(!1),[Y,Q]=l.useState(""),[K,W]=l.useState("all"),[ee,te]=l.useState("all");l.useState("30");const[se,ae]=l.useState(!1),[ne,re]=l.useState([]),[le,ce]=l.useState("all"),ie=l.useRef(0),[oe,de]=l.useState({account_id:"",category:"",description:"",amount:"",expense_date:(new Date).toISOString().split("T")[0],vendor_name:"",reference_number:"",notes:""}),xe=l.useCallback((e,t,s,a,n)=>{const r={id:"log-"+ie.current++,timestamp:(new Date).toISOString(),type:e,category:t,message:s,data:a,duration:n};re(e=>[r,...e].slice(0,100))},[]),me=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),pe=l.useCallback(async()=>{const e=performance.now();xe("api","FETCH_EXPENSES","Starting to fetch expenses...");try{Z(!0),xe("info","FETCH_EXPENSES","Loading state set to true");const{data:s,error:a}=await t.from("account_transactions").select("*").eq("transaction_type","expense").order("created_at",{ascending:!1}).limit(100);if(a)throw xe("error","FETCH_EXPENSES","Supabase query failed",a),a;if(xe("success","FETCH_EXPENSES",`Fetched ${(null==s?void 0:s.length)||0} expense transactions`,{count:null==s?void 0:s.length,transactions:null==s?void 0:s.slice(0,3)}),s&&s.length>0){const e=[...new Set(s.map(e=>e.account_id).filter(Boolean))];if(xe("info","FETCH_EXPENSES",`Found ${e.length} unique account IDs`,e),e.length>0){const{data:a,error:n}=await t.from("finance_accounts").select("id, name, type, currency").in("id",e);if(!n&&a){xe("success","FETCH_EXPENSES",`Fetched ${a.length} account details`,a);const e=new Map(a.map(e=>[e.id,e])),t=s.map(t=>({...t,finance_accounts:t.account_id?e.get(t.account_id):null}));q(t),xe("success","FETCH_EXPENSES","Successfully mapped accounts to expenses")}else xe("warning","FETCH_EXPENSES","Account fetch failed, showing expenses without account details",n),q(s)}else q(s)}else xe("info","FETCH_EXPENSES","No expense transactions found"),q([]);const n=performance.now()-e;xe("success","FETCH_EXPENSES","Fetch completed successfully",{totalExpenses:(null==s?void 0:s.length)||0},n)}catch(s){const t=performance.now()-e;xe("error","FETCH_EXPENSES","Failed to load expenses",s,t),x.error("Failed to load expenses")}finally{Z(!1),xe("info","FETCH_EXPENSES","Loading state set to false")}},[xe]),ue=l.useCallback(async()=>{const e=performance.now();xe("api","FETCH_ACCOUNTS","Fetching payment accounts...");try{const t=await s.getPaymentMethods();U(t);const a=performance.now()-e;xe("success","FETCH_ACCOUNTS",`Fetched ${t.length} payment accounts`,{accounts:t.map(e=>({id:e.id,name:e.name,balance:e.balance}))},a)}catch(t){const s=performance.now()-e;xe("error","FETCH_ACCOUNTS","Failed to fetch payment accounts",t,s)}},[xe]),ge=l.useCallback(async()=>{const e=performance.now();xe("api","FETCH_CATEGORIES","Fetching expense categories...");try{const{data:s,error:a}=await t.from("expense_categories").select("*").eq("is_active",!0).order("name");if(a)throw xe("error","FETCH_CATEGORIES","Supabase query failed",a),a;z(s||[]);const n=performance.now()-e;xe("success","FETCH_CATEGORIES",`Fetched ${(null==s?void 0:s.length)||0} active categories`,{categories:null==s?void 0:s.map(e=>e.name)},n)}catch(s){const t=performance.now()-e;xe("error","FETCH_CATEGORIES","Failed to fetch expense categories",s,t)}},[xe]);l.useEffect(()=>{xe("info","LIFECYCLE","Component mounted, initializing data fetch"),pe(),ue(),ge()},[pe,ue,ge,xe]);const he=(e,t)=>{xe("info","FORM",`Field "${e}" changed`,{field:e,value:t}),de(s=>({...s,[e]:t}))},fe=c.useMemo(()=>{xe("info","FILTER","Filtering expenses",{searchQuery:Y,categoryFilter:K,accountFilter:ee});const e=X.filter(e=>{var t,s,a,n;const r=(null==(t=e.description)?void 0:t.toLowerCase().includes(Y.toLowerCase()))||(null==(s=e.reference_number)?void 0:s.toLowerCase().includes(Y.toLowerCase())),l="all"===ee||e.account_id===ee,c=(null==(a=e.metadata)?void 0:a.category)||((null==(n=e.description)?void 0:n.split(":")[0])||"").trim();return r&&l&&("all"===K||c===K)});return xe("success","FILTER",`Filtered to ${e.length} expenses`,{total:X.length,filtered:e.length}),e},[X,Y,K,ee,xe]),je=c.useMemo(()=>{const e=fe.reduce((e,t)=>e+Number(t.amount),0),t=fe.length,s={};fe.forEach(e=>{var t;const a=(null==(t=e.metadata)?void 0:t.category)||"Other";s[a]=(s[a]||0)+Number(e.amount)});const a={};fe.forEach(e=>{var t;const s=(null==(t=e.finance_accounts)?void 0:t.name)||"Unknown";a[s]=(a[s]||0)+Number(e.amount)});const n={totalExpenses:e,expenseCount:t,byCategory:s,byAccount:a};return xe("info","STATS","Calculated summary statistics",n),n},[fe,xe]);if(V)return a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),a.jsx("span",{className:"ml-3 text-gray-600",children:"Loading expenses..."})]});const ye="all"===le?ne:ne.filter(e=>e.type===le);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Expense Management"}),a.jsx("p",{className:"text-gray-600",children:"Track and manage business expenses"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(n,{onClick:()=>ae(!se),variant:se?"primary":"secondary",className:"flex items-center gap-2",children:[a.jsx(m,{size:16}),"Debug"]}),a.jsxs(n,{onClick:pe,variant:"secondary",children:[a.jsx(p,{size:16}),"Refresh"]}),a.jsxs(n,{onClick:()=>J(!0),children:[a.jsx(u,{size:16}),"Add Expense"]})]})]}),se&&a.jsxs(r,{className:"p-6 bg-gray-900 text-white border-2 border-indigo-500",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(m,{className:"w-5 h-5 text-indigo-400"}),a.jsx("h3",{className:"text-lg font-semibold text-indigo-400",children:"Debug Panel"}),a.jsxs("span",{className:"text-sm text-gray-400",children:["(",ne.length," logs)"]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>{const e=JSON.stringify(ne,null,2),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`expense-debug-logs-${(new Date).toISOString()}.json`,a.click(),xe("success","DEBUG","Debug logs exported")},className:"px-3 py-1 text-sm bg-indigo-600 hover:bg-indigo-700 rounded flex items-center gap-1",children:[a.jsx(g,{size:14}),"Export"]}),a.jsxs("button",{onClick:()=>{re([]),xe("info","DEBUG","Debug logs cleared")},className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 rounded flex items-center gap-1",children:[a.jsx(h,{size:14}),"Clear"]})]})]}),a.jsx("div",{className:"flex gap-2 mb-4",children:["all","info","success","error","warning","api"].map(e=>a.jsx("button",{onClick:()=>ce(e),className:"px-3 py-1 text-xs rounded capitalize "+(le===e?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:e},e))}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 p-4 bg-gray-800 rounded",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Total Expenses"}),a.jsx("div",{className:"text-lg font-bold",children:X.length})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Filtered"}),a.jsx("div",{className:"text-lg font-bold",children:fe.length})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Categories"}),a.jsx("div",{className:"text-lg font-bold",children:G.length})]})]}),a.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:0===ye.length?a.jsx("div",{className:"text-center py-8 text-gray-500",children:"No debug logs yet"}):ye.map(e=>{const t={info:S,success:_,error:C,warning:F,api:T}[e.type];return a.jsx("div",{className:`p-3 rounded border ${{info:"text-blue-400 bg-blue-900/30",success:"text-green-400 bg-green-900/30",error:"text-red-400 bg-red-900/30",warning:"text-yellow-400 bg-yellow-900/30",api:"text-purple-400 bg-purple-900/30"}[e.type]} border-opacity-50`,children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(t,{size:16,className:"mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 mb-1",children:[a.jsx(f,{size:12}),a.jsx("span",{children:new Date(e.timestamp).toLocaleTimeString()}),a.jsx("span",{className:"font-mono bg-gray-800 px-2 py-0.5 rounded",children:e.category}),e.duration&&a.jsxs("span",{className:"text-green-400",children:[e.duration.toFixed(2),"ms"]})]}),a.jsx("div",{className:"text-sm font-medium mb-1",children:e.message}),e.data&&a.jsxs("details",{className:"text-xs",children:[a.jsx("summary",{className:"cursor-pointer text-gray-400 hover:text-gray-300",children:"View Data"}),a.jsx("pre",{className:"mt-2 p-2 bg-gray-950 rounded overflow-x-auto text-xs",children:JSON.stringify(e.data,null,2)})]})]})]})},e.id)})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(r,{className:"p-6 bg-gradient-to-br from-red-50 to-red-100 border-red-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-red-600",children:"Total Expenses"}),a.jsx("p",{className:"text-2xl font-bold text-red-900",children:me(je.totalExpenses)})]}),a.jsx("div",{className:"p-3 bg-red-500 rounded-lg",children:a.jsx(j,{className:"w-6 h-6 text-white"})})]})}),a.jsx(r,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Expense Count"}),a.jsx("p",{className:"text-2xl font-bold text-blue-900",children:je.expenseCount})]}),a.jsx("div",{className:"p-3 bg-blue-500 rounded-lg",children:a.jsx(y,{className:"w-6 h-6 text-white"})})]})}),a.jsx(r,{className:"p-6 bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Categories"}),a.jsx("p",{className:"text-2xl font-bold text-purple-900",children:Object.keys(je.byCategory).length})]}),a.jsx("div",{className:"p-3 bg-purple-500 rounded-lg",children:a.jsx(b,{className:"w-6 h-6 text-white"})})]})}),a.jsx(r,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-green-600",children:"Avg per Expense"}),a.jsx("p",{className:"text-2xl font-bold text-green-900",children:me(je.expenseCount>0?je.totalExpenses/je.expenseCount:0)})]}),a.jsx("div",{className:"p-3 bg-green-500 rounded-lg",children:a.jsx(v,{className:"w-6 h-6 text-white"})})]})})]}),a.jsx(r,{className:"p-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),a.jsx("input",{type:"text",placeholder:"Search expenses...",value:Y,onChange:e=>{Q(e.target.value),xe("info","SEARCH",`Search query changed: "${e.target.value}"`)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(o,{value:ee,onChange:e=>{te(e.target.value),xe("info","FILTER",`Account filter changed: "${e.target.value}"`)},className:"min-w-[160px]",children:[a.jsx("option",{value:"all",children:"All Accounts"}),M.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}),a.jsxs(o,{value:K,onChange:e=>{W(e.target.value),xe("info","FILTER",`Category filter changed: "${e.target.value}"`)},className:"min-w-[160px]",children:[a.jsx("option",{value:"all",children:"All Categories"}),G.map(e=>a.jsx("option",{value:e.name,children:e.name},e.id))]})]})]})}),a.jsxs(r,{className:"p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Recent Expenses (",fe.length,")"]}),0===fe.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"mb-4 inline-block p-6 bg-gray-100 rounded-full",children:a.jsx(y,{className:"w-16 h-16 text-gray-400"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Expenses Found"}),a.jsx("p",{className:"text-gray-600 mb-4",children:0===X.length?"No expenses have been recorded yet.":"No expenses match your current filters."}),0===X.length&&a.jsxs(n,{onClick:()=>J(!0),children:[a.jsx(u,{size:16}),"Add Your First Expense"]})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-gray-200",children:[a.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Status"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Category"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Description"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Account"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Amount"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Date"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Reference"}),"admin"===(null==L?void 0:L.role)&&a.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),a.jsx("tbody",{children:fe.map(e=>{var s,n,r,l,i;const o=(null==(s=e.metadata)?void 0:s.category)||"Other",d=(null==(n=e.finance_accounts)?void 0:n.name)||"Unknown",m=e.status||(null==(r=e.metadata)?void 0:r.approval_status)||"approved",p={pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Pending"},approved:{bg:"bg-green-100",text:"text-green-800",label:"Approved"},rejected:{bg:"bg-red-100",text:"text-red-800",label:"Rejected"}},u=p[m]||p.approved;return a.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[a.jsx("td",{className:"py-3 px-4",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${u.bg} ${u.text}`,children:u.label})}),a.jsx("td",{className:"py-3 px-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[c.createElement((g=o,{Rent:b,Utilities:A,Supplies:D,Transportation:R,Salaries:O,Maintenance:P,Marketing:E,Insurance:k,Taxes:y,Other:E}[g]||E),{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:o})]})}),a.jsxs("td",{className:"py-3 px-4",children:[a.jsx("div",{className:"text-sm text-gray-900",children:e.description}),(null==(l=e.metadata)?void 0:l.vendor_name)&&a.jsxs("div",{className:"text-xs text-gray-500",children:["Vendor: ",e.metadata.vendor_name]}),(null==(i=e.metadata)?void 0:i.rejection_reason)&&a.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Reason: ",e.metadata.rejection_reason]})]}),a.jsx("td",{className:"py-3 px-4",children:a.jsx("div",{className:"text-sm font-medium text-gray-700",children:d})}),a.jsx("td",{className:"py-3 px-4",children:a.jsx("div",{className:"text-sm font-semibold text-red-600",children:me(e.amount)})}),a.jsxs("td",{className:"py-3 px-4",children:[a.jsx("div",{className:"text-sm text-gray-900",children:new Date(e.created_at).toLocaleDateString()}),a.jsx("div",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleTimeString()})]}),a.jsx("td",{className:"py-3 px-4",children:a.jsx("div",{className:"text-xs text-gray-600 font-mono",children:e.reference_number||"N/A"})}),"admin"===(null==L?void 0:L.role)&&a.jsxs("td",{className:"py-3 px-4",children:["pending"===m&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>(async e=>{try{if("admin"!==(null==L?void 0:L.role))return void x.error("Only admins can approve expenses");const{error:s}=await t.from("account_transactions").update({status:"approved",metadata:t.raw(`metadata || '{"approval_status": "approved", "approved_by": "${L.id}", "approved_at": "${(new Date).toISOString()}"}'::jsonb`)}).eq("id",e);if(s)throw s;x.success("Expense approved successfully!"),pe(),ue()}catch(s){x.error("Failed to approve expense")}})(e.id),className:"px-3 py-1 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded transition-colors",children:"Approve"}),a.jsx("button",{onClick:()=>{const s=prompt("Rejection reason (optional):");(async(e,s)=>{try{if("admin"!==(null==L?void 0:L.role))return void x.error("Only admins can reject expenses");const{error:a}=await t.from("account_transactions").update({status:"rejected",metadata:t.raw(`metadata || '{"approval_status": "rejected", "rejected_by": "${L.id}", "rejected_at": "${(new Date).toISOString()}", "rejection_reason": "${s||"No reason provided"}"}'::jsonb`)}).eq("id",e);if(a)throw a;x.success("Expense rejected"),pe()}catch(a){x.error("Failed to reject expense")}})(e.id,s||void 0)},className:"px-3 py-1 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded transition-colors",children:"Reject"})]}),"approved"===m&&a.jsx("span",{className:"text-xs text-green-600",children:"✓ Approved"}),"rejected"===m&&a.jsx("span",{className:"text-xs text-red-600",children:"✗ Rejected"})]})]},e.id);var g})})]})})]}),a.jsx(d,{isOpen:B,onClose:()=>{J(!1),xe("info","MODAL","Add expense modal closed")},title:"Add New Expense",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Account *"}),a.jsxs(o,{value:oe.account_id,onChange:e=>he("account_id",e.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Select Account"}),M.map(e=>a.jsxs("option",{value:e.id,children:[e.name," - ",me(e.balance||0)]},e.id))]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[a.jsx(E,{className:"w-4 h-4"}),"Category *"]}),a.jsxs(o,{value:oe.category,onChange:e=>he("category",e.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Select Category"}),G.map(e=>a.jsx("option",{value:e.name,children:e.name},e.id))]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[a.jsx(E,{className:"w-4 h-4"}),"Description *"]}),a.jsx(i,{type:"text",value:oe.description,onChange:e=>he("description",e.target.value),placeholder:"e.g., October rent payment",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[a.jsx(v,{className:"w-4 h-4"}),"Amount (TSh) *"]}),a.jsx(i,{type:"number",value:oe.amount,onChange:e=>he("amount",e.target.value),placeholder:"0.00",min:"0",step:"0.01",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[a.jsx(b,{className:"w-4 h-4"}),"Vendor Name"]}),a.jsx(i,{type:"text",value:oe.vendor_name,onChange:e=>he("vendor_name",e.target.value),placeholder:"Vendor or supplier name"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[a.jsx(y,{className:"w-4 h-4"}),"Reference Number"]}),a.jsx(i,{type:"text",value:oe.reference_number,onChange:e=>he("reference_number",e.target.value),placeholder:"e.g., INV-2025-001"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[a.jsx(w,{className:"w-4 h-4"}),"Expense Date"]}),a.jsx(i,{type:"date",value:oe.expense_date,onChange:e=>he("expense_date",e.target.value)})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[a.jsx(E,{className:"w-4 h-4"}),"Notes"]}),a.jsx("textarea",{value:oe.notes,onChange:e=>he("notes",e.target.value),placeholder:"Additional notes...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(n,{variant:"secondary",onClick:()=>{J(!1),xe("info","MODAL","Add expense cancelled")},children:"Cancel"}),a.jsx(n,{onClick:async()=>{const e=performance.now();xe("api","ADD_EXPENSE","Starting expense creation...",oe);try{if(!oe.account_id||!oe.amount||!oe.description)return xe("warning","ADD_EXPENSE","Validation failed: Missing required fields",{account_id:!!oe.account_id,amount:!!oe.amount,description:!!oe.description}),void x.error("Please fill in all required fields");const s=parseFloat(oe.amount);if(isNaN(s)||s<=0)return xe("warning","ADD_EXPENSE","Validation failed: Invalid amount",{amount:oe.amount}),void x.error("Please enter a valid amount");xe("info","ADD_EXPENSE","Validation passed, inserting into database",{amount:s,account_id:oe.account_id,category:oe.category});const a="admin"===(null==L?void 0:L.role),n=a?"approved":"pending",{data:r,error:l}=await t.from("account_transactions").insert({account_id:oe.account_id,transaction_type:"expense",amount:s,description:`${oe.category?oe.category+": ":""}${oe.description}`,reference_number:oe.reference_number||null,status:n,metadata:{category:oe.category||null,vendor_name:oe.vendor_name||null,notes:oe.notes||null,expense_date:oe.expense_date,approval_status:n,requires_approval:!a},created_by:null==L?void 0:L.id}).select().single();if(l)throw xe("error","ADD_EXPENSE","Database insert failed",l),l;const c=performance.now()-e;xe("success","ADD_EXPENSE","Expense created successfully!",{expenseId:r.id,amount:s,category:oe.category,status:n},c),xe("info","ADD_EXPENSE","Resetting form and refreshing data"),de({account_id:"",category:"",description:"",amount:"",expense_date:(new Date).toISOString().split("T")[0],vendor_name:"",reference_number:"",notes:""}),J(!1),pe(),ue();const i=a?`Expense of ${s.toLocaleString("en-TZ",{style:"currency",currency:"TZS"})} has been recorded successfully!`:`Expense of ${s.toLocaleString("en-TZ",{style:"currency",currency:"TZS"})} has been submitted for admin approval!`;H.show(i,{title:a?"Expense Recorded":"Expense Submitted",actionButtons:[{label:"View Expenses",onClick:()=>{},variant:"primary"},{label:"Add Another",onClick:()=>J(!0),variant:"secondary"}]})}catch(s){const t=performance.now()-e;xe("error","ADD_EXPENSE","Failed to record expense",s,t),x.error(s.message||"Failed to record expense")}},children:"Add Expense"})]})]})}),a.jsx(I,{...H.props})]})};export{L as E};
