import{O as e,u as a,j as t,G as s,d as l,P as r,Q as i,R as c}from"./index-222cfb29.js";import{r as o}from"./vendor-a2ff445a.js";import{n,i as d,y as x,Q as g,T as u,r as m,$ as b,X as y}from"./ui-551a39a6.js";import{a as h}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";const f=()=>{a();const f=h(),[p,j]=o.useState([]),[v,N]=o.useState(""),[C,w]=o.useState(!1),[k,E]=o.useState(null),[F,B]=o.useState(!1),{categories:A,loading:D,error:S,refetch:z}=((a={})=>{const{activeOnly:t=!1,searchQuery:s="",autoFetch:l=!0,forceRefresh:r=!1}=a,[i,c]=o.useState([]),[n,d]=o.useState(!1),[x,g]=o.useState(null),u=o.useCallback(async(a=!1)=>{try{let l;d(!0),g(null),l=s?await e.searchCategories(s,a):t?await e.getActiveCategories(a):await e.getCategories(a),c(l)}catch(l){const e=l instanceof Error?l.message:"Failed to fetch categories";g(e)}finally{d(!1)}},[t,s]),m=o.useCallback(async()=>{await u(!0)},[u]),b=o.useCallback(async a=>{try{d(!0),g(null);const t=await e.searchCategories(a);c(t)}catch(t){const e=t instanceof Error?t.message:"Failed to search categories";g(e)}finally{d(!1)}},[]),y=o.useCallback(e=>i.find(a=>a.id===e)||null,[i]),h=o.useCallback(async()=>await e.getCategoryStats(),[]);return o.useEffect(()=>{l&&u(r)},[l,r,u]),{categories:i,loading:n,error:x,refetch:m,search:b,getCategoryById:y,getCategoryStats:h}})({activeOnly:!0,autoFetch:!0});o.useEffect(()=>{},[]),o.useEffect(()=>{L()},[A,v]),o.useEffect(()=>{S&&n.error("Failed to fetch categories: "+S)},[S]);const L=()=>{let e=A;v.trim()&&(e=e.filter(e=>{var a;return e.name.toLowerCase().includes(v.toLowerCase())||(null==(a=e.description)?void 0:a.toLowerCase().includes(v.toLowerCase()))})),j(e)},T=()=>{w(!1),E(null)},O=e=>{const a={"#3B82F6":"bg-blue-100 text-blue-800","#10B981":"bg-green-100 text-green-800","#8B5CF6":"bg-purple-100 text-purple-800","#F59E0B":"bg-orange-100 text-orange-800","#EF4444":"bg-red-100 text-red-800","#EC4899":"bg-pink-100 text-pink-800","#6366F1":"bg-indigo-100 text-indigo-800","#EAB308":"bg-yellow-100 text-yellow-800","#14B8A6":"bg-teal-100 text-teal-800","#06B6D4":"bg-cyan-100 text-cyan-800","#F97316":"bg-amber-100 text-amber-800","#059669":"bg-emerald-100 text-emerald-800","#7C3AED":"bg-violet-100 text-violet-800","#475569":"bg-slate-100 text-slate-800","#E11D48":"bg-rose-100 text-rose-800","#0284C7":"bg-sky-100 text-sky-800","#84CC16":"bg-lime-100 text-lime-800","#C026D3":"bg-fuchsia-100 text-fuchsia-800","#EA580C":"bg-orange-100 text-orange-800","#4F46E5":"bg-indigo-100 text-indigo-800","#6B7280":"bg-gray-100 text-gray-800"};return a[e]||a["#6B7280"]};return t.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(s,{onClick:()=>f("/dashboard"),className:"flex items-center gap-2",children:[t.jsx(d,{size:20}),"Back to Dashboard"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Category Management"}),t.jsx("p",{className:"text-gray-600",children:"Manage device categories and their colors"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[t.jsxs(l,{className:"p-4 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600",children:A.length}),t.jsx("div",{className:"text-sm text-gray-600",children:"Total Categories"})]}),t.jsxs(l,{className:"p-4 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:A.filter(e=>e.description).length}),t.jsx("div",{className:"text-sm text-gray-600",children:"With Description"})]}),t.jsxs(l,{className:"p-4 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-purple-600",children:new Set(A.map(e=>e.color)).size}),t.jsx("div",{className:"text-sm text-gray-600",children:"Color Variants"})]})]}),t.jsx(l,{className:"mb-6",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-4",children:t.jsxs("div",{className:"relative flex-1 md:w-80",children:[t.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),t.jsx("input",{type:"text",placeholder:"Search categories...",value:v,onChange:e=>(async e=>{N(e)})(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(s,{onClick:()=>w(!0),className:"flex items-center gap-2",children:[t.jsx(g,{size:16}),"Add Category"]})})]})}),D?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===p.length?t.jsxs(l,{className:"text-center py-12",children:[t.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No categories found"}),t.jsx("p",{className:"text-gray-600 mb-4",children:v?"Try adjusting your search":"Get started by creating your first category"}),!v&&t.jsxs(s,{onClick:()=>w(!0),className:"flex items-center gap-2",children:[t.jsx(g,{size:16}),"Create First Category"]})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:p.map(e=>t.jsxs(l,{className:"relative group",children:[t.jsx("div",{className:"flex items-center justify-center h-32 mb-4 rounded-lg",style:{backgroundColor:e.color+"20"},children:t.jsx("div",{className:"text-4xl font-bold rounded-full w-16 h-16 flex items-center justify-center",style:{backgroundColor:e.color,color:"white"},children:e.name.charAt(0)})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:e.name}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"})})]}),e.description&&t.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),t.jsx("div",{className:"flex flex-wrap gap-1",children:t.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${O(e.color)}`,style:{backgroundColor:e.color+"20",color:e.color},children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),e.color]})}),t.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[t.jsx("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:t.jsxs("span",{children:["Created: ",new Date(e.created_at).toLocaleDateString()]})}),t.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:()=>(e=>{E(e),w(!0)})(e),className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"Edit Category",children:t.jsx(m,{size:14})}),t.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Are you sure you want to delete ${e.name}?`))try{await c(e.id),n.success("Category deleted successfully!"),await z()}catch(a){n.error("Failed to delete category")}})(e),className:"p-1 text-gray-500 hover:text-red-600 transition-colors",title:"Delete Category",children:t.jsx(b,{size:14})})]})]})]})]},e.id))}),C&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&T()},children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-semibold",children:k?`Edit Category: ${k.name}`:"Add New Category"}),t.jsx("button",{onClick:T,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(y,{size:20})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const a=new FormData(e.currentTarget);(async e=>{B(!0);try{k?(await r(k.id,e),n.success("Category updated successfully!")):(await i(e),n.success("Category created successfully!")),await z()}catch(a){throw n.error(a.message||"Failed to save category"),a}finally{B(!1)}})({name:a.get("name"),description:a.get("description"),color:a.get("color")}),T()},className:"p-6 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category Name *"}),t.jsx("input",{name:"name",type:"text",defaultValue:(null==k?void 0:k.name)||"",className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter category name",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color"}),t.jsx("select",{name:"color",defaultValue:(null==k?void 0:k.color)||"#3B82F6",className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",children:[{value:"#3B82F6",label:"Blue"},{value:"#10B981",label:"Green"},{value:"#8B5CF6",label:"Purple"},{value:"#F59E0B",label:"Orange"},{value:"#EF4444",label:"Red"},{value:"#EC4899",label:"Pink"},{value:"#6366F1",label:"Indigo"},{value:"#EAB308",label:"Yellow"},{value:"#14B8A6",label:"Teal"},{value:"#06B6D4",label:"Cyan"},{value:"#F97316",label:"Amber"},{value:"#059669",label:"Emerald"},{value:"#7C3AED",label:"Violet"},{value:"#475569",label:"Slate"},{value:"#E11D48",label:"Rose"},{value:"#0284C7",label:"Sky"},{value:"#84CC16",label:"Lime"},{value:"#C026D3",label:"Fuchsia"},{value:"#EA580C",label:"Orange"},{value:"#4F46E5",label:"Indigo"},{value:"#6B7280",label:"Gray"}].map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),t.jsx("textarea",{name:"description",defaultValue:(null==k?void 0:k.description)||"",className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter category description",rows:3})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("button",{type:"submit",disabled:F,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:F?t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),k?"Updating...":"Adding..."]}):k?"Update Category":"Add Category"}),t.jsx("button",{type:"button",onClick:T,disabled:F,className:"px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]})})]})};export{f as default};
