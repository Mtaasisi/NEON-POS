import{j as e,d as t,G as s,s as a}from"./index-222cfb29.js";import{r}from"./vendor-a2ff445a.js";import{M as o}from"./Modal-ccfa5014.js";import{n as l}from"./ui-551a39a6.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";import"./useBodyScrollLock-0216d39f.js";const n=()=>{const[n,c]=r.useState([]),[d,u]=r.useState(!1),[m,p]=r.useState(null),[g,x]=r.useState(!1),[h,b]=r.useState(""),[y,f]=r.useState(""),[v,j]=r.useState("name"),_=r.useRef(null),N=n.filter(e=>{var t,s,a,r;return(null==(t=e.name)?void 0:t.toLowerCase().includes(h.toLowerCase()))||(null==(s=e.email)?void 0:s.toLowerCase().includes(h.toLowerCase()))||(null==(a=e.phone)?void 0:a.includes(h))||(null==(r=e.whatsapp)?void 0:r.includes(h))}).filter(e=>!y||e.customer_tag===y).sort((e,t)=>{switch(v){case"points":return(t.points||0)-(e.points||0);case"total_spent":return(t.total_spent||0)-(e.total_spent||0);default:return(e.name||"").localeCompare(t.name||"")}});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Customer Data Update"}),e.jsx("p",{className:"text-gray-600",children:"Update customer information, import/export data, and manage customer records"})]}),e.jsxs(t,{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx(s,{onClick:async()=>{u(!0);try{const{data:e,error:t}=await a.from("customers").select("*").order("name").limit(5e4);if(t)throw t;c(e||[]),l.success(`Loaded ${(null==e?void 0:e.length)||0} customers`)}catch(e){l.error("Failed to load customers")}finally{u(!1)}},disabled:d,children:d?"Loading...":"Load Customers"}),e.jsx("input",{ref:_,type:"file",accept:".csv",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;try{const s=(null==(t=e.target)?void 0:t.result).split("\n"),a=s[0].split(",").map(e=>e.trim().replace(/"/g,"")),r=[];for(let e=1;e<s.length;e++)if(s[e].trim()){const t=s[e].split(",").map(e=>e.trim().replace(/"/g,"")),o={};a.forEach((e,s)=>{o[e.toLowerCase().replace(/\s+/g,"_")]=t[s]||""}),r.push(o)}c(r),l.success(`Imported ${r.length} customers from CSV`)}catch(s){l.error("Failed to parse CSV file")}},a.readAsText(s)},className:"hidden"}),e.jsx(s,{onClick:()=>{var e;return null==(e=_.current)?void 0:e.click()},variant:"secondary",children:"Import CSV"}),e.jsx(s,{onClick:()=>{const e=[["ID","Name","Email","Phone","Gender","City","WhatsApp","Referral Source","Birth Month","Birth Day","Total Returns","Initial Notes","Location Description","National ID","Points","Total Spent","Loyalty Level","Color Tag","Customer Tag","Notes","Is Active"].join(","),...n.map(e=>[e.id,`"${(e.name||"").replace(/"/g,'""')}"`,`"${(e.email||"").replace(/"/g,'""')}"`,`"${(e.phone||"").replace(/"/g,'""')}"`,`"${(e.gender||"").replace(/"/g,'""')}"`,`"${(e.city||"").replace(/"/g,'""')}"`,`"${(e.whatsapp||"").replace(/"/g,'""')}"`,`"${(e.referral_source||"").replace(/"/g,'""')}"`,`"${(e.birth_month||"").replace(/"/g,'""')}"`,`"${(e.birth_day||"").replace(/"/g,'""')}"`,e.total_returns||0,`"${(e.location_description||"").replace(/"/g,'""')}"`,`"${(e.national_id||"").replace(/"/g,'""')}"`,e.points||0,e.total_spent||0,`"${(e.loyalty_level||"").replace(/"/g,'""')}"`,`"${(e.color_tag||"").replace(/"/g,'""')}"`,`"${(e.customer_tag||"").replace(/"/g,'""')}"`,`"${(e.notes||"").replace(/"/g,'""')}"`,e.is_active?"Yes":"No"].join(","))].join("\n"),t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`customer_data_updated_${(new Date).toISOString().split("T")[0]}.csv`,a.click(),window.URL.revokeObjectURL(s),l.success("CSV exported successfully")},variant:"secondary",disabled:0===n.length,children:"Export CSV"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("input",{type:"text",placeholder:"Search customers...",value:h,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("select",{value:y,onChange:e=>f(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Tags"}),e.jsx("option",{value:"vip",children:"VIP"}),e.jsx("option",{value:"regular",children:"Regular"}),e.jsx("option",{value:"new",children:"New"})]}),e.jsxs("select",{value:v,onChange:e=>j(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"points",children:"Sort by Points"}),e.jsx("option",{value:"total_spent",children:"Sort by Total Spent"})]})]}),e.jsx("div",{className:"space-y-4",children:N.map(t=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200 hover:border-blue-300 cursor-pointer",onClick:()=>{p(t),x(!0)},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-blue-600 font-medium",children:t.phone}),e.jsx("p",{className:"text-sm text-gray-500",children:t.city})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Points: ",t.points||0]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Spent: $",t.total_spent||0]}),t.customer_tag&&e.jsx("span",{className:"inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:t.customer_tag})]})]})},t.id))}),0===N.length&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No customers found. Click "Load Customers" to load data from the database.'})]}),m&&e.jsx(o,{isOpen:g,onClose:()=>{x(!1),p(null)},title:"Edit Customer",children:e.jsx(i,{customer:m,onSave:async e=>{try{const{error:t}=await a.from("lats_customers").update({name:e.name,email:e.email,phone:e.phone,gender:e.gender,city:e.city,whatsapp:e.whatsapp,referral_source:e.referral_source,birth_month:e.birth_month,birth_day:e.birth_day,total_returns:e.total_returns,location_description:e.location_description,national_id:e.national_id,points:e.points,total_spent:e.total_spent,loyalty_level:e.loyalty_level,color_tag:e.color_tag,customer_tag:e.customer_tag,notes:e.notes,is_active:e.is_active,updated_at:(new Date).toISOString()}).eq("id",e.id);if(t)throw t;c(t=>t.map(t=>t.id===e.id?e:t)),x(!1),p(null),l.success("Customer updated successfully")}catch(t){l.error("Failed to update customer")}},onCancel:()=>{x(!1),p(null)}})})]})})},i=({customer:t,onSave:s,onCancel:a})=>{const[o,l]=r.useState(t);return e.jsxs("form",{onSubmit:e=>{e.preventDefault(),s(o)},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:o.name||"",onChange:e=>l({...o,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:o.email||"",onChange:e=>l({...o,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:o.phone||"",onChange:e=>l({...o,phone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:o.city||"",onChange:e=>l({...o,city:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Save Changes"})]})]})};export{n as default};
