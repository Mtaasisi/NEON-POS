import{j as e,s as t}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import"./supabase-460661f2.js";import{x as a,A as l,ah as r,Q as i,y as n,bP as o,bQ as c,ab as d,ao as x,z as m}from"./ui-551a39a6.js";import{u,a as p}from"./useMobileBranch-1aee679b.js";import{a as h}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";const f=()=>{const f=h(),{currentBranch:g,loading:y,isDataShared:b}=u(),[j,v]=s.useState(""),[N,k]=s.useState(!1),[w,C]=s.useState("All"),[S,_]=s.useState("asc"),[A,z]=s.useState([]),[L,W]=s.useState(!0);s.useEffect(()=>{const e=async()=>{if(!y){W(!0);try{let e=t.from("lats_products").select("*, image_url").eq("is_active",!0).order("created_at",{ascending:!1});if(g){const t=b("products");e=p(e,g.id,g.data_isolation_mode,t)}const{data:s,error:a}=await e;if(a)throw a;if(!s)return void z([]);const l=s.map(e=>({id:e.id,name:e.name||"Unnamed Product",sku:e.sku||"N/A",category:e.category||"Uncategorized",stock:e.stock_quantity||0,price:e.selling_price||0,status:0===e.stock_quantity?"out-of-stock":e.min_stock_level&&e.stock_quantity<=e.min_stock_level?"low-stock":"in-stock",image:e.image_url}));z(l)}catch(e){m.error((null==e?void 0:e.message)||"Failed to load products"),z([])}finally{W(!1)}}};e();const s=()=>{e()};return window.addEventListener("branchChanged",s),()=>{window.removeEventListener("branchChanged",s)}},[g,y,b]);const T=["All",...Array.from(new Set(A.map(e=>e.category)))],E=A.filter(e=>{const t=e.name.toLowerCase().includes(j.toLowerCase())||e.sku.toLowerCase().includes(j.toLowerCase()),s="All"===w||e.category===w;return t&&s}).sort((e,t)=>{const s=e.name.localeCompare(t.name);return"asc"===S?s:-s}),q=[{label:"Total Products",value:A.length,icon:a,color:"blue"},{label:"Low Stock",value:A.filter(e=>"low-stock"===e.status).length,icon:l,color:"yellow"},{label:"Out of Stock",value:A.filter(e=>"out-of-stock"===e.status).length,icon:l,color:"red"},{label:"Total Value",value:`TSh ${(A.reduce((e,t)=>e+t.price*t.stock,0)/1e6).toFixed(1)}M`,icon:r,color:"green"}];return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"px-4 pt-3 pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-[32px] font-bold text-black tracking-tight",children:"Inventory"}),e.jsx("button",{onClick:()=>f("/mobile/inventory/add"),className:"flex items-center justify-center text-blue-500 hover:text-blue-600 active:text-blue-700 transition-colors flex-shrink-0 p-1","aria-label":"Add product",children:e.jsx(i,{size:28,strokeWidth:2.5})})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16,strokeWidth:2}),e.jsx("input",{type:"text",placeholder:"Search products",value:j,onChange:e=>v(e.target.value),className:"w-full pl-9 pr-4 py-2 bg-[#f2f2f7] border-0 rounded-lg focus:outline-none focus:ring-0 text-gray-900 placeholder-gray-400 text-[15px] font-light",style:{WebkitAppearance:"none"}})]}),e.jsxs("div",{className:"flex items-center justify-between py-2.5 px-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(o,{size:16,className:"text-blue-500",strokeWidth:2.5}),e.jsx("span",{className:"text-gray-900 font-normal text-[15px]",children:"Sorted alphabetically"})]}),e.jsx("button",{onClick:()=>{_("asc"===S?"desc":"asc")},className:"p-0.5 hover:opacity-70 transition-opacity","aria-label":"Toggle sort order",children:e.jsx(c,{size:16,strokeWidth:2.5,className:"text-blue-500 transition-transform "+("desc"===S?"rotate-180":"")})})]}),e.jsx("div",{className:"py-2",children:e.jsxs("button",{onClick:()=>k(!N),className:"flex items-center gap-2 text-blue-500 text-[15px] font-medium",children:[e.jsx(d,{size:16,strokeWidth:2.5}),e.jsx("span",{children:"Filter by Category"}),"All"!==w&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full text-[13px]",children:w})]})}),N&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-3 pt-1 scrollbar-hide -mx-4 px-4",children:T.map(t=>e.jsx("button",{onClick:()=>{C(t),k(!1)},className:"px-4 py-2 rounded-full text-[14px] font-medium whitespace-nowrap transition-colors "+(w===t?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t},t))})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-y border-gray-200",children:e.jsx("div",{className:"grid grid-cols-4 gap-2 text-center",children:q.map((t,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-[16px] font-bold text-gray-900",children:t.value}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-0.5",children:t.label})]},s))})}),L&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-[15px]",children:"Loading products..."})]})}),!L&&e.jsxs("div",{className:"flex-1 overflow-y-auto pb-20",children:[E.map((t,s)=>e.jsxs("div",{onClick:()=>f(`/mobile/inventory/${t.id}`),className:"flex items-center justify-between px-4 py-3 border-b border-[#e5e5ea] hover:bg-gray-50 active:bg-gray-100 cursor-pointer transition-colors",style:{borderBottomWidth:s===E.length-1?"0":"0.5px"},children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 flex-shrink-0 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;t&&(t.innerHTML='<div class="text-gray-400 flex items-center justify-center w-full h-full"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></div>')}}):e.jsx(a,{size:24,className:"text-gray-400",strokeWidth:1.5})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"text-black text-[16px] font-normal truncate",children:t.name}),"low-stock"===t.status&&e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full bg-yellow-100 text-yellow-700 text-[10px] font-semibold flex-shrink-0",children:"LOW"}),"out-of-stock"===t.status&&e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full bg-red-100 text-red-700 text-[10px] font-semibold flex-shrink-0",children:"OUT"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[14px] text-gray-500",children:[e.jsx("span",{className:"font-mono",children:t.sku}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[t.stock," units"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-gray-900 text-[16px] font-medium",children:["TSh ",t.price.toLocaleString()]}),e.jsx(x,{size:18,className:"text-gray-400",strokeWidth:2})]})]},t.id)),0===E.length&&e.jsxs("div",{className:"text-center py-16 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(a,{size:40,className:"text-gray-400",strokeWidth:1.5})}),e.jsx("p",{className:"text-gray-500 text-[15px] font-normal",children:"No products found"}),e.jsx("p",{className:"text-[13px] text-gray-400 mt-1.5 font-light",children:0===A.length?"Add your first product to get started":"Try a different search term"})]})]})]})};export{f as default};
