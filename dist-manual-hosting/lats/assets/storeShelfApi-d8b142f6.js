import{s as e}from"./index-222cfb29.js";const t=new class{constructor(){this.tableName="lats_store_rooms"}async getAll(){try{const{data:t,error:r}=await e.from(this.tableName).select("*").order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(t){throw t}}async getById(t){try{const{data:r,error:a}=await e.from(this.tableName).select("*").eq("id",t).single();if(a)throw a;return r}catch(r){throw r}}async getByStoreLocation(t){try{const{data:r,error:a}=await e.from(this.tableName).select("*").eq("store_location_id",t).order("name",{ascending:!0});if(a)throw a;return r||[]}catch(r){throw r}}async create(t){try{const{data:r,error:a}=await e.from(this.tableName).insert([t]).select().single();if(a)throw a;return r}catch(r){throw r}}async update(t){try{const{id:r,...a}=t,{data:o,error:s}=await e.from(this.tableName).update(a).eq("id",r).select().single();if(s)throw s;return o}catch(r){throw r}}async delete(t){try{const{error:r}=await e.from(this.tableName).delete().eq("id",t);if(r)throw r}catch(r){throw r}}async getActive(){try{const{data:t,error:r}=await e.from(this.tableName).select("*").eq("is_active",!0).order("name",{ascending:!0});if(r)throw r;return t||[]}catch(t){throw t}}async getSecure(){try{const{data:t,error:r}=await e.from(this.tableName).select("*").eq("is_secure",!0).order("name",{ascending:!0});if(r)throw r;return t||[]}catch(t){throw t}}async updateCapacity(t,r){try{const{error:a}=await e.from(this.tableName).update({current_capacity:r}).eq("id",t);if(a)throw a}catch(a){throw a}}async search(t){try{const{data:r,error:a}=await e.from(this.tableName).select("*").or(`name.ilike.%${t}%,code.ilike.%${t}%,description.ilike.%${t}%`).order("name",{ascending:!0});if(a)throw a;return r||[]}catch(r){throw r}}async getStats(){try{const{data:t,error:r}=await e.from(this.tableName).select("is_active, is_secure, max_capacity, current_capacity");if(r)throw r;return{total:(null==t?void 0:t.length)||0,active:(null==t?void 0:t.filter(e=>e.is_active).length)||0,secure:(null==t?void 0:t.filter(e=>e.is_secure).length)||0,totalCapacity:(null==t?void 0:t.reduce((e,t)=>e+(t.max_capacity||0),0))||0,usedCapacity:(null==t?void 0:t.reduce((e,t)=>e+(t.current_capacity||0),0))||0}}catch(t){throw t}}};const r=new class{constructor(){this.tableName="lats_store_shelves"}async getAll(t){let r=e.from(this.tableName).select("\n        *,\n        store_location:lats_store_locations(name, code, city)\n      ").order("priority_order",{ascending:!0}).order("name",{ascending:!0});t&&(t.search&&(r=r.or(`name.ilike.%${t.search}%,code.ilike.%${t.search}%,section.ilike.%${t.search}%`)),t.store_location_id&&(r=r.eq("store_location_id",t.store_location_id)),t.storage_room_id&&(r=r.eq("storage_room_id",t.storage_room_id)),t.shelf_type&&(r=r.eq("shelf_type",t.shelf_type)),t.section&&(r=r.eq("section",t.section)),t.zone&&(r=r.eq("zone",t.zone)),void 0!==t.is_active&&(r=r.eq("is_active",t.is_active)),void 0!==t.is_accessible&&(r=r.eq("is_accessible",t.is_accessible)),void 0!==t.is_refrigerated&&(r=r.eq("is_refrigerated",t.is_refrigerated)),void 0!==t.requires_ladder&&(r=r.eq("requires_ladder",t.requires_ladder)));const{data:a,error:o}=await r;if(o)throw new Error(`Failed to fetch store shelves: ${o.message}`);return a||[]}async getById(t){const{data:r,error:a}=await e.from(this.tableName).select("\n        *,\n        store_location:lats_store_locations(name, code, city)\n      ").eq("id",t).single();if(a){if("PGRST116"===a.code)return null;throw new Error(`Failed to fetch store shelf: ${a.message}`)}return r}async getByCode(t){const{data:r,error:a}=await e.from(this.tableName).select("\n        *,\n        store_location:lats_store_locations(name, code, city)\n      ").eq("code",t).single();if(a){if("PGRST116"===a.code)return null;throw new Error(`Failed to fetch store shelf: ${a.message}`)}return r}async getShelvesByLocation(t){const{data:r,error:a}=await e.from(this.tableName).select("*").eq("store_location_id",t).eq("is_active",!0).order("priority_order",{ascending:!0}).order("name",{ascending:!0});if(a)throw new Error(`Failed to fetch shelves for location: ${a.message}`);return r||[]}async getShelvesByStorageRoom(t){const{data:r,error:a}=await e.from(this.tableName).select("*").eq("storage_room_id",t).eq("is_active",!0).order("row_number",{ascending:!0}).order("column_number",{ascending:!0});if(a)throw new Error(`Failed to fetch shelves for storage room: ${a.message}`);return r||[]}async create(t){var r,a,o;const{data:s,error:i}=await e.from(this.tableName).insert([{...t,created_by:null==(r=(await e.auth.getUser()).data.user)?void 0:r.id,updated_by:null==(a=(await e.auth.getUser()).data.user)?void 0:a.id}]).select().single();if(i){if("23505"===i.code||(null==(o=i.message)?void 0:o.includes("duplicate")))throw new Error(`Shelf with code "${t.code}" already exists in this location`);throw new Error(`Failed to create store shelf: ${i.message}`)}return s}async update(t,r){var a;const{data:o,error:s}=await e.from(this.tableName).update({...r,updated_by:null==(a=(await e.auth.getUser()).data.user)?void 0:a.id}).eq("id",t).select().single();if(s)throw new Error(`Failed to update store shelf: ${s.message}`);return o}async delete(t){const{error:r}=await e.from(this.tableName).delete().eq("id",t);if(r)throw new Error(`Failed to delete store shelf: ${r.message}`)}async updateCapacity(t,r){var a;const{data:o,error:s}=await e.from(this.tableName).update({current_capacity:r,updated_by:null==(a=(await e.auth.getUser()).data.user)?void 0:a.id}).eq("id",t).select().single();if(s)throw new Error(`Failed to update shelf capacity: ${s.message}`);return o}async moveProductToShelf(t,r){const a=await this.getByCode(r);if(!a)throw new Error(`Shelf with code ${r} not found`);const{error:o}=await e.from("lats_products").update({store_shelf:r}).eq("id",t);if(o)throw new Error(`Failed to move product to shelf: ${o.message}`);await this.updateCapacity(a.id,a.current_capacity+1)}async getStats(e){const t=await this.getAll(e),r=t.length,a=t.filter(e=>e.is_active).length,o=t.reduce((e,t)=>e+(t.max_capacity||0),0),s=t.reduce((e,t)=>e+t.current_capacity,0),i=o>0?s/o*100:0,c=t.filter(e=>e.is_refrigerated).length,n=t.filter(e=>"display"===e.shelf_type).length,l=t.filter(e=>"storage"===e.shelf_type).length;return{total_shelves:r,active_shelves:a,total_capacity:o,used_capacity:s,utilization_percentage:Math.round(100*i)/100,refrigerated_shelves:c,display_shelves:n,storage_shelves:l}}async generateShelfCode(e,t){const r=await this.getShelvesByLocation(e),a=t?r.filter(e=>e.section===t):r,o=t?`${t.toUpperCase().substring(0,3)}`:"SHELF",s=a.map(e=>e.code);let i=1,c=`${o}${i.toString().padStart(3,"0")}`;for(;s.includes(c);)i++,c=`${o}${i.toString().padStart(3,"0")}`;return c}};export{r as a,t as s};
