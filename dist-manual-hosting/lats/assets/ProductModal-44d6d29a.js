import{j as e,d as s,G as t,s as a,c as r}from"./index-222cfb29.js";import{x as l,X as i,I as n,aa as d,d as c,e as o,v as x,az as m,aC as g,y as u,cs as h,l as b,cu as p,$ as j,Q as v,ab as y,b as N,ao as f,m as w,h as k,w as S,A as C,ax as P,b4 as _,a5 as I,bQ as q,a6 as A,D,ah as L,bu as z,aD as V,p as R,ap as T,aU as O,bj as $,a_ as F,aG as E,n as Q,r as U,N as M,a as G,Y as B,V as H,u as K,by as W,bd as J,aA as Z,t as Y,bR as X,c as ee,aj as se}from"./ui-551a39a6.js";import{r as te,R as ae,b as re}from"./vendor-a2ff445a.js";import{R as le}from"./robustImageService-2422a1f9.js";import{format as ie}from"./format-0f0b2647.js";import{C as ne}from"./CircularProgress-471d8e37.js";import{p as de,f as ce}from"./specificationUtils-8355804c.js";import{e as oe}from"./productUtils-6e390a72.js";import{i as xe,g as me,a as ge,f as ue,b as he}from"./variantUtils-422e46bb.js";import{u as be}from"./usePurchaseOrderHistory-baa7ee96.js";import{c as pe,a as je,b as ve,d as ye,e as Ne,g as fe}from"./productCalculations-9e8647a1.js";import{o as we,s as ke,e as Se,n as Ce,u as Pe,C as _e}from"./forms-fd94c8fb.js";import{t as Ie}from"./zod-4c7d126c.js";import{G as qe}from"./GlassInput-ba5c3c0d.js";import{G as Ae}from"./GlassSelect-3b56e5f5.js";import{G as De}from"./GlassBadge-18f019e2.js";import{P as Le}from"./PriceInput-e1556d5b.js";import{u as ze}from"./useBodyScrollLock-0216d39f.js";import{s as Ve,a as Re}from"./storeShelfApi-d8b142f6.js";const Te=we({selectedVariantId:ke().min(1,"Please select a variant"),adjustmentType:Se(["in","out","set"]),quantity:Ce().min(.01,"Quantity must be greater than 0"),reason:ke().min(1,"Reason is required").max(200,"Reason must be less than 200 characters"),reference:ke().max(100,"Reference must be less than 100 characters").optional(),notes:ke().max(500,"Notes must be less than 500 characters").optional(),cost:Ce().min(0,"Cost must be 0 or greater").optional(),location:ke().max(100,"Location must be less than 100 characters").optional()}),Oe=({product:a,isOpen:r,onClose:x,onSubmit:m,loading:g=!1})=>{var u,h;const[b,p]=te.useState(!1),[j,v]=te.useState(null);ze(r);const{control:y,handleSubmit:N,formState:{errors:f,isDirty:w},watch:k,reset:S,setValue:C}=Pe({resolver:Ie(Te),defaultValues:{selectedVariantId:"",adjustmentType:"in",quantity:0,reason:"",reference:"",notes:"",cost:0,location:""}}),P=k(),_=P.selectedVariantId,I=P.adjustmentType,q=P.quantity;te.useEffect(()=>{if(_&&(null==a?void 0:a.variants)){const e=a.variants.find(e=>e.id===_);v(e||null)}else v(null)},[_,null==a?void 0:a.variants]);const A=(()=>{if(!j)return 0;switch(I){case"in":return j.quantity+q;case"out":return Math.max(0,j.quantity-q);case"set":return q;default:return j.quantity}})(),D=e=>j&&e<=j.minQuantity?"low":"normal",L=j?D(j.quantity):"normal",z=j?D(A):"normal",V=()=>{w?confirm("Are you sure you want to discard your changes?")&&(S(),v(null),null==x||x()):(S(),v(null),null==x||x())},R=[{value:"in",label:"Stock In",icon:"ðŸ“¥",description:"Add to current stock"},{value:"out",label:"Stock Out",icon:"ðŸ“¤",description:"Remove from current stock"},{value:"set",label:"Set Stock",icon:"âš™ï¸",description:"Set to specific quantity"}],T=[{value:"purchase",label:"Purchase Order"},{value:"sale",label:"Sale"},{value:"return",label:"Customer Return"},{value:"damage",label:"Damaged Goods"},{value:"expiry",label:"Expired Goods"},{value:"theft",label:"Theft/Loss"},{value:"adjustment",label:"Manual Adjustment"},{value:"transfer",label:"Location Transfer"},{value:"audit",label:"Stock Audit"},{value:"other",label:"Other"}],O=[{value:"main",label:"Main Warehouse"},{value:"secondary",label:"Secondary Warehouse"},{value:"store",label:"Store Front"},{value:"transit",label:"In Transit"},{value:"supplier",label:"At Supplier"}],$=s=>"low"===s?e.jsxs(De,{variant:"error",className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-3 h-3"}),"Low Stock"]}):e.jsxs(De,{variant:"success",className:"flex items-center gap-1",children:[e.jsx(c,{className:"w-3 h-3"}),"Normal"]});return r&&a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50 backdrop-blur-sm",onClick:x,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsx("div",{className:"relative max-w-4xl w-full max-h-[90vh] overflow-y-auto",style:{pointerEvents:"auto"},children:e.jsx(s,{className:"w-full",children:e.jsxs("form",{onSubmit:N(async e=>{try{m&&j&&(await m({...e,variant:j}),S(),v(null),null==x||x())}catch(s){}}),className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-lats-glass-border",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-lats-text flex items-center gap-2",children:[e.jsx(l,{className:"w-6 h-6 text-lats-primary"}),"Adjust Stock Level"]}),e.jsxs("p",{className:"text-sm text-lats-text-secondary mt-1",children:[a.name," - Select variant to adjust"]})]}),e.jsx("button",{onClick:V,className:"p-2 hover:bg-lats-surface-hover rounded-lg transition-colors",type:"button",children:e.jsx(i,{className:"w-5 h-5 text-lats-text-secondary"})})]}),e.jsxs("div",{className:"p-4 bg-lats-surface/30 rounded-lats-radius-md border border-lats-glass-border",children:[e.jsxs("h3",{className:"text-lg font-medium text-lats-text mb-3 flex items-center gap-2",children:[e.jsx(n,{className:"w-5 h-5 text-lats-primary"}),"Product Overview"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-lats-text-secondary",children:"Product Name"}),e.jsx("div",{className:"font-medium text-lats-text",children:a.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-lats-text-secondary",children:"Total Variants"}),e.jsx("div",{className:"font-medium text-lats-text",children:(null==(u=a.variants)?void 0:u.length)||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-lats-text-secondary",children:"Total Stock"}),e.jsx("div",{className:"font-medium text-lats-text",children:(null==(h=a.variants)?void 0:h.reduce((e,s)=>e+(s.quantity||0),0))||0})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-lats-text",children:"Select Variant to Adjust"}),e.jsx(_e,{name:"selectedVariantId",control:y,render:({field:s})=>{var t;return e.jsxs("div",{className:"space-y-3",children:[null==(t=a.variants)?void 0:t.map(t=>e.jsx("div",{className:"p-4 rounded-lats-radius-md border-2 cursor-pointer transition-all "+(s.value===t.id?"border-lats-primary bg-lats-primary/10":"border-lats-glass-border hover:border-lats-primary/50 hover:bg-lats-surface/50"),onClick:()=>s.onChange(t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("input",{type:"radio",checked:s.value===t.id,onChange:()=>s.onChange(t.id),className:"w-4 h-4 text-lats-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-lats-text",children:t.name}),e.jsxs("div",{className:"text-sm text-lats-text-secondary",children:["SKU: ",t.sku]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lats-text-secondary",children:"Current Stock"}),e.jsx("div",{className:"font-medium text-lats-text",children:t.quantity})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lats-text-secondary",children:"Min Level"}),e.jsx("div",{className:"font-medium text-lats-text",children:t.minQuantity})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lats-text-secondary",children:"Price"}),e.jsx("div",{className:"font-medium text-lats-text",children:ie.money(t.sellingPrice)})]})]})]}),e.jsx("div",{className:"ml-4",children:$(D(t.quantity))})]})},t.id)),f.selectedVariantId&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:f.selectedVariantId.message})]})}})]}),j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-lats-text",children:"Adjustment Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-lats-text",children:["Adjustment Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(_e,{name:"adjustmentType",control:y,render:({field:s})=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:R.map(t=>e.jsx("button",{type:"button",onClick:()=>s.onChange(t.value),className:"p-4 rounded-lats-radius-md border-2 transition-all duration-200 hover:scale-105 "+(s.value===t.value?"in"===t.value?"border-green-500 bg-green-500/10 text-green-700 shadow-lg shadow-green-500/20":"out"===t.value?"border-red-500 bg-red-500/10 text-red-700 shadow-lg shadow-red-500/20":"border-lats-primary bg-lats-primary/10 text-lats-primary shadow-lg shadow-lats-primary/20":"border-lats-glass-border hover:border-lats-primary/50 hover:bg-lats-surface/50 text-lats-text hover:shadow-md"),children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"text-2xl",children:t.icon}),e.jsx("div",{className:"font-medium",children:t.label}),e.jsx("div",{className:"text-xs text-center opacity-75",children:t.description})]})},t.value))})}),f.adjustmentType&&e.jsx("p",{className:"text-red-500 text-sm",children:f.adjustmentType.message})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(_e,{name:"quantity",control:y,render:({field:s})=>{var t;return e.jsx(qe,{label:"Quantity",placeholder:"0",type:"number",value:s.value,onChange:e=>s.onChange(parseFloat(e.target.value)||0),error:null==(t=f.quantity)?void 0:t.message,min:.01,step:.01,required:!0,helperText:"set"===I?"Set stock to this quantity":"in"===I?"Add to current stock":"Remove from current stock"})}})}),e.jsx(_e,{name:"reason",control:y,render:({field:s})=>{var t;return e.jsx(Ae,{label:"Reason",placeholder:"Select reason",value:s.value,onChange:s.onChange,error:null==(t=f.reason)?void 0:t.message,options:T,required:!0})}}),e.jsx(_e,{name:"reference",control:y,render:({field:s})=>{var t;return e.jsx(qe,{label:"Reference",placeholder:"e.g., PO-001, Invoice #123",value:s.value,onChange:s.onChange,error:null==(t=f.reference)?void 0:t.message,maxLength:100,helperText:"Optional reference number or document"})}}),e.jsx(_e,{name:"notes",control:y,render:({field:s})=>{var t,a;return e.jsx(qe,{label:"Notes",placeholder:"Additional notes about this adjustment",value:s.value,onChange:s.onChange,error:null==(t=f.notes)?void 0:t.message,multiline:!0,rows:3,maxLength:500,helperText:`${(null==(a=s.value)?void 0:a.length)||0}/500 characters`})}})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-lats-text",children:"Advanced Settings"}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>p(!b),icon:e.jsx(d,{className:"w-4 h-4 transition-transform "+(b?"rotate-180":"")}),children:[b?"Hide":"Show"," Advanced"]})]}),b&&e.jsx("div",{className:"space-y-4 p-4 bg-lats-surface/30 rounded-lats-radius-md border border-lats-glass-border",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_e,{name:"cost",control:y,render:({field:s})=>{var t;return e.jsx(Le,{label:"Unit Cost",placeholder:"0",value:s.value,onChange:s.onChange,error:null==(t=f.cost)?void 0:t.message,helperText:"Cost per unit for this adjustment"})}}),e.jsx(_e,{name:"location",control:y,render:({field:s})=>{var t;return e.jsx(Ae,{label:"Location",placeholder:"Select location",value:s.value,onChange:s.onChange,error:null==(t=f.location)?void 0:t.message,options:O,clearable:!0})}})]})})]}),e.jsxs("div",{className:"p-4 bg-lats-surface/30 rounded-lats-radius-md border border-lats-glass-border",children:[e.jsx("h3",{className:"text-lg font-medium text-lats-text mb-3",children:"Preview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-lats-text-secondary mb-1",children:"Current Stock"}),e.jsx("div",{className:"text-xl font-bold text-lats-text",children:j.quantity}),$(L)]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-lats-text-secondary mb-1",children:"New Stock"}),e.jsx("div",{className:"text-xl font-bold text-lats-text",children:A}),$(z)]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[(s=>{const t=R.find(e=>e.value===s);return t?e.jsxs(De,{variant:"in"===s?"success":"out"===s?"error":"info",children:[t.icon," ",t.label]}):null})(I),e.jsxs("span",{className:"text-sm text-lats-text-secondary",children:["in"===I&&`+${q} units`,"out"===I&&`-${q} units`,"set"===I&&`Set to ${q} units`]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-6 border-t border-lats-glass-border",children:[e.jsx(t,{type:"submit",variant:"primary",loading:g,disabled:!w||!j,className:"flex-1 sm:flex-none",children:g?"Processing...":"Apply Adjustment"}),e.jsx(t,{type:"button",variant:"secondary",onClick:V,disabled:g,className:"flex-1 sm:flex-none",children:"Cancel"})]})]})})})})]}):null};Oe.displayName="EnhancedStockAdjustModal";const $e=({formData:s,setFormData:t,currentErrors:a})=>{const[r,n]=te.useState([]),[d,c]=te.useState({}),[o,b]=te.useState(!1),[p,j]=te.useState(!1),[v,y]=te.useState(""),[N,f]=te.useState(""),[w,k]=te.useState("");te.useEffect(()=>{S()},[]),te.useEffect(()=>{r.length>0&&C()},[r]),te.useEffect(()=>{var e;p&&y(s.storageRoomId||(null==(e=r[0])?void 0:e.id)||"")},[p,s.storageRoomId,r]);const S=async()=>{try{b(!0);const e=await Ve.getAll();n(e||[])}catch(e){n([])}finally{b(!1)}},C=async()=>{try{const e={};for(const s of r){const t=await Re.getShelvesByStorageRoom(s.id);e[s.id]=t||[]}c(e)}catch(e){c({})}},P=()=>(d[v]||[]).filter(e=>e&&e.code).sort((e,s)=>{const t=e.name||e.code||"",a=s.name||s.code||"",r=t.toLowerCase().localeCompare(a.toLowerCase());return 0!==r?r:e.id.localeCompare(s.id)}),_=()=>{let e=P();return N&&(e=e.filter(e=>e.code.toLowerCase().includes(N.toLowerCase())||e.name&&e.name.toLowerCase().includes(N.toLowerCase()))),w&&(e=e.filter(e=>e.code.toUpperCase().includes(w))),e};return e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(x,{size:18,className:"text-blue-600"}),"Storage Location"]}),0===r.length&&!o&&e.jsx("div",{className:"mb-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3 text-amber-800",children:[e.jsx(l,{size:24,className:"text-amber-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:"No Storage Data Available"}),e.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:["You need to create storage rooms and shelves before adding products. Go to ",e.jsx("strong",{children:"Settings â†’ Storage Management"})," to set up your storage infrastructure."]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:"Storage Location (optional)"}),e.jsxs("button",{type:"button",onClick:()=>j(!0),disabled:o||0===r.length,className:`relative w-full py-3 pl-10 pr-4 bg-white border-2 rounded text-left ${a.storageRoomId||a.shelfId?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500 hover:border-blue-400"} ${o||0===r.length?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(x,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx("span",{className:s.storageRoomId&&s.shelfId?"text-gray-900 font-medium":"text-gray-500",children:(()=>{var e;if(!s.storageRoomId||!s.shelfId)return"Select storage location";const t=r.find(e=>e.id===s.storageRoomId),a=null==(e=d[s.storageRoomId])?void 0:e.find(e=>e.id===s.shelfId);return t&&a?`${t.code} - ${a.code}`:"Select storage location"})()}),s.storageRoomId&&s.shelfId&&e.jsx(m,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-green-500",size:18})]}),(a.storageRoomId||a.shelfId)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.storageRoomId||a.shelfId})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[85vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{size:20,className:"text-gray-700"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Select Storage Location"})]}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(i,{size:20,className:"text-gray-500"})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-gray-50",children:e.jsx("div",{className:"flex overflow-x-auto px-4 py-2 gap-2",children:r.map(s=>e.jsx("button",{onClick:()=>y(s.id),className:"flex-shrink-0 px-4 py-2 rounded font-medium text-sm "+(v===s.id?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{size:14}),e.jsx("span",{children:s.name}),e.jsxs("span",{className:"text-xs opacity-75",children:["(",s.code,")"]})]})},s.id))})}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search shelves...",value:N,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-3 py-2 bg-white border border-gray-300 rounded focus:outline-none focus:border-blue-500"})]}),e.jsx("div",{className:"flex gap-1",children:(()=>{const e=P(),s=new Set;return e.forEach(e=>{const t=e.code.toUpperCase();for(let a=0;a<t.length;a++){const e=t[a];if(e>="A"&&e<="Z"){s.add(e);break}}}),Array.from(s).sort()})().map(s=>e.jsx("button",{onClick:()=>k(w===s?"":s),className:"px-3 py-2 rounded font-medium text-sm "+(w===s?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"),children:s},s))})]})}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[50vh]",children:_().length>0?e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3",children:_().map((a,l)=>{var i;if(!a||!a.code)return null;const n=r.find(e=>e.id===v),d=(null==n?void 0:n.code)||"",c=a.code.startsWith(d)?a.code:`${d}${a.code}`,o=s.storageRoomId===v&&s.shelfId===a.id,x=null==(i=a.code.toUpperCase().match(/[A-Z]/))?void 0:i[0],m=x?{A:"bg-blue-500",B:"bg-green-500",C:"bg-purple-500",D:"bg-orange-500",E:"bg-red-500",F:"bg-teal-500",G:"bg-pink-500",H:"bg-indigo-500",I:"bg-emerald-500",J:"bg-cyan-500",K:"bg-lime-500",L:"bg-amber-500",M:"bg-rose-500",N:"bg-violet-500",O:"bg-sky-500",P:"bg-fuchsia-500",Q:"bg-slate-500",R:"bg-zinc-500",S:"bg-stone-500",T:"bg-neutral-500",U:"bg-yellow-500",V:"bg-orange-600",W:"bg-red-600",X:"bg-pink-600",Y:"bg-purple-600",Z:"bg-indigo-600"}[x]||"bg-gray-500":"bg-gray-500";return e.jsx("button",{onClick:()=>{return e=v,s=a.id,t(t=>({...t,storageRoomId:e,shelfId:s})),void j(!1);var e,s},className:"py-3 px-2 rounded border-2 font-bold text-center text-white text-sm "+(o?`${m} border-white ring-2 ring-blue-600`:`${m} border-transparent hover:border-white`),children:c},a.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Shelves Found"}),e.jsx("p",{className:"text-sm text-gray-600",children:N||w?"Try adjusting your search or filter.":"No shelves available in this room."})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[_().length," shelf",1!==_().length?"ves":""," found"]}),e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded",children:"Cancel"})]})]})})]})},Fe=({variants:s,setVariants:t,useVariants:a,setUseVariants:r,showVariants:i,setShowVariants:n,isReorderingVariants:d,setIsReorderingVariants:c,draggedVariantIndex:o,setDraggedVariantIndex:x,onVariantSpecificationsClick:g,baseSku:u})=>{const h=e=>`${u}-V${e.toString().padStart(2,"0")}`,y=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"};return e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(b,{size:20,className:"text-green-600"}),"Product Variants"]}),e.jsx("div",{className:"flex items-center gap-3",children:s.length>0&&e.jsxs("button",{type:"button",onClick:()=>c(!d),className:"text-xs px-3 py-1 rounded "+(d?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"),title:"Toggle reorder mode",children:[e.jsx(p,{size:14,className:"inline mr-1"}),d?"Done":"Reorder"]})})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:s.map((s,a)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",draggable:d,onDragStart:e=>((e,s)=>{x(s),e.dataTransfer.effectAllowed="move"})(e,a),onDragOver:y,onDrop:e=>((e,s)=>{e.preventDefault(),null!==o&&o!==s&&(t(e=>{const t=[...e],a=t[o];return t.splice(o,1),t.splice(s,0,a),t}),x(null))})(e,a),onDragEnd:()=>x(null),style:{cursor:d?"grabbing":"grab"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d&&e.jsx("div",{className:"w-6 h-6 flex items-center justify-center text-gray-400",children:e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 6h8v2H8V6zm0 5h8v2H8v-2zm0 5h8v2H8v-2z"})})}),e.jsx("h4",{className:"font-medium text-gray-900",children:s.name||`Variant ${a+1}`})]}),e.jsx("div",{className:"flex items-center gap-2",children:!d&&e.jsx("button",{type:"button",onClick:()=>(e=>{t(s=>s.filter((s,t)=>t!==e))})(a),className:"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50 transition-colors","aria-label":"Remove variant",children:e.jsx(j,{size:16})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Variant Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:s.name,onChange:e=>((e,s,a)=>{t(t=>t.map((t,r)=>r===e?{...t,[s]:a}:t))})(a,"name",e.target.value),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors border-gray-300 focus:border-blue-500",placeholder:"Enter variant name (e.g., 256GB - Space Black)",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(l,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>g(a),className:"w-full bg-white border-2 border-gray-200 rounded-xl hover:border-purple-400 hover:shadow-lg transition-all p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),s.attributes&&Object.keys(s.attributes).length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center shadow-md",children:e.jsx(m,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Specifications"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:s.attributes&&Object.keys(s.attributes).length>0?`${Object.keys(s.attributes).length} spec${1!==Object.keys(s.attributes).length?"s":""} added`:"Add variant specifications"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.attributes&&Object.keys(s.attributes).length>0&&e.jsx("div",{className:"px-3 py-1.5 bg-purple-600 text-white text-sm font-bold rounded-full shadow-md",children:Object.keys(s.attributes).length}),e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})})]})]})})})]},a))}),e.jsxs("button",{type:"button",onClick:()=>{const e=s.length>0?s[s.length-1]:null,a={name:`Variant ${s.length+1}`,sku:h(s.length+1),attributes:(null==e?void 0:e.attributes)?{...e.attributes}:{}};t(e=>[...e,a])},className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all flex items-center justify-center gap-2 text-gray-600 hover:text-blue-600",children:[e.jsx(v,{size:20}),"Add New Variant"]})]})]})},Ee=async e=>{try{const{data:s,error:t}=await a.from("lats_product_variants").select("*").eq("parent_variant_id",e).eq("variant_type","imei_child").order("created_at",{ascending:!1});return t?[]:s||[]}catch(s){return[]}},Qe=({productId:s,variants:t,showFinancials:a=!0,showSearch:r=!0,onChildClick:i})=>{const[n,d]=te.useState({}),[o,m]=te.useState({}),[g,h]=te.useState({}),[p,j]=te.useState(""),[v,C]=te.useState("all");te.useState(!1);const[P,_]=te.useState({totalDevices:0,availableDevices:0});te.useEffect(()=>{(()=>{const e=Object.values(o).flat().length,s=Object.values(o).flat().filter(e=>e.is_active&&e.quantity>0).length,a=t.filter(e=>!o[e.id]).reduce((e,s)=>e+(void 0!==s.available_imeis?s.available_imeis:s.quantity||0),0);_({totalDevices:e+a,availableDevices:s+a})})()},[t,o]);const I=t.filter(e=>{if(!p)return!0;const s=e.variant_name||e.name||"",t=e.sku||"";return s.toLowerCase().includes(p.toLowerCase())||t.toLowerCase().includes(p.toLowerCase())});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-600 rounded",children:e.jsx(b,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Variant Hierarchy"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[I.length," parent variant",1!==I.length?"s":""," â€¢ ",P.totalDevices," devices"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{const e={};t.forEach(s=>{e[s.id]=!0}),d(e);for(const a of t)if(!o[a.id]){h(e=>({...e,[a.id]:!0}));try{const e=await Ee(a.id);m(s=>({...s,[a.id]:e}))}catch(s){}finally{h(e=>({...e,[a.id]:!1}))}}},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700",children:"Expand All"}),e.jsx("button",{onClick:()=>{d({})},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded hover:bg-gray-300",children:"Collapse All"})]})]}),r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:p,onChange:e=>j(e.target.value),placeholder:"Search variants, IMEIs, serial numbers...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded focus:outline-none focus:border-blue-500 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 border border-gray-300 rounded bg-white",children:[e.jsx(y,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:v,onChange:e=>C(e.target.value),className:"text-sm border-none focus:outline-none bg-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"sold",children:"Sold"})]})]})]}),e.jsx("div",{className:"space-y-3",children:0===I.length?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded border border-gray-300",children:[e.jsx(l,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold mb-1",children:"No variants found"}),e.jsx("p",{className:"text-sm text-gray-500",children:p?"Try adjusting your search or filter criteria":"This product has no variants yet"})]}):I.map(s=>{const t=n[s.id],r=o[s.id]||[],l=g[s.id],j=((e,s=0)=>{const t=o[e]||[],a=t.filter(e=>e.is_active&&e.quantity>0).length,r=t.filter(e=>!e.is_active||0===e.quantity).length,l=t.filter(e=>e.is_active&&e.quantity>0).reduce((e,t)=>e+(t.selling_price||s),0);return{total:t.length,available:a,sold:r,totalValue:l}})(s.id,s.selling_price||0),y=(e=>e?e.filter(e=>{var s,t,a;const r=(null==(s=e.variant_attributes)?void 0:s.imei)||"",l=(null==(t=e.variant_attributes)?void 0:t.serial_number)||"",i=(null==(a=e.variant_attributes)?void 0:a.mac_address)||"",n=""===p||r.toLowerCase().includes(p.toLowerCase())||l.toLowerCase().includes(p.toLowerCase())||i.toLowerCase().includes(p.toLowerCase()),d=e.is_active&&e.quantity>0;return n&&("all"===v||"available"===v&&d||"sold"===v&&!d)}):[])(r),C=s.is_parent||"parent"===s.variant_type;return e.jsxs("div",{className:"bg-white rounded border-2 border-gray-200 hover:border-purple-400",children:[e.jsx("div",{onClick:()=>(async e=>{const s=!n[e];if(d(t=>({...t,[e]:s})),s&&!o[e]){h(s=>({...s,[e]:!0}));try{const s=await Ee(e);m(t=>({...t,[e]:s}))}catch(t){}finally{h(s=>({...s,[e]:!1}))}}})(s.id),className:"p-4 cursor-pointer hover:bg-gray-50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:t?e.jsx(N,{className:"w-5 h-5 text-gray-600"}):e.jsx(f,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-purple-100 rounded flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900 truncate",children:s.variant_name||s.name||"Unnamed Variant"}),C&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-purple-100 text-purple-700 rounded",children:"Parent"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",s.sku]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Stock"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:s.quantity||0})]}),C&&r.length>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Devices"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:[j.available," / ",j.total]})]}),a&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Price"}),e.jsx("div",{className:"text-base font-bold text-green-600",children:ie.money(s.selling_price||0)})]})]})]})})}),t&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50",children:l?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-300 border-t-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading devices..."})]}):0===r.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(w,{className:"w-10 h-10 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-700 font-medium mb-1",children:"No child devices"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This parent variant has no IMEI children yet"})]}):0===y.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(u,{className:"w-10 h-10 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-700 font-medium mb-1",children:"No matches found"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Try adjusting your search or filter criteria"})]}):e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-300",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[j.total," Device",1!==j.total?"s":""]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[j.available," available â€¢ ",j.sold," sold"]})]}),a&&j.totalValue>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total Value"}),e.jsx("p",{className:"text-base font-bold text-green-600",children:ie.money(j.totalValue)})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2",children:y.map((t,r)=>{var l,n,d,o,m;const g=(null==(l=t.variant_attributes)?void 0:l.imei)||"N/A",u=null==(n=t.variant_attributes)?void 0:n.serial_number,h=null==(d=t.variant_attributes)?void 0:d.mac_address,b=null==(o=t.variant_attributes)?void 0:o.condition,p=null==(m=t.variant_attributes)?void 0:m.location,j=t.is_active&&t.quantity>0,v=(e=>{if(!e)return{bg:"bg-gray-100",text:"text-gray-700",label:"N/A"};const s={new:{bg:"bg-green-100",text:"text-green-700",label:"New"},excellent:{bg:"bg-blue-100",text:"text-blue-700",label:"Excellent"},good:{bg:"bg-yellow-100",text:"text-yellow-700",label:"Good"},fair:{bg:"bg-orange-100",text:"text-orange-700",label:"Fair"},poor:{bg:"bg-red-100",text:"text-red-700",label:"Poor"},used:{bg:"bg-gray-100",text:"text-gray-700",label:"Used"}};return s[e.toLowerCase()]||s.used})(b);return e.jsxs("div",{onClick:()=>null==i?void 0:i(t),className:"p-3 rounded border-2 "+(j?"bg-white border-gray-200 hover:border-blue-400 cursor-pointer":"bg-gray-100 border-gray-300 opacity-60"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(w,{className:"w-4 h-4 flex-shrink-0 "+(j?"text-blue-600":"text-gray-400")}),e.jsx("span",{className:"font-mono text-sm font-semibold text-gray-900 truncate",children:g})]}),j?e.jsx(c,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(k,{className:"w-4 h-4 text-red-500 flex-shrink-0"})]}),e.jsxs("div",{className:"space-y-1",children:[u&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(S,{className:"w-3 h-3"}),e.jsxs("span",{className:"truncate",children:["S/N: ",u]})]}),h&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(S,{className:"w-3 h-3"}),e.jsxs("span",{className:"truncate",children:["MAC: ",h]})]}),p&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(x,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:p})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-2 border-t border-gray-200",children:[e.jsx("span",{className:`inline-flex px-2 py-0.5 rounded text-xs font-medium ${v.bg} ${v.text}`,children:v.label}),a&&e.jsx("span",{className:"text-xs font-bold text-green-600",children:ie.money(t.selling_price||s.selling_price||0)})]})]})]},t.id)})})]})})]},s.id)})})]})},Ue=({isOpen:s,onClose:d,product:o,onEdit:m})=>{var u,h,p,y,f,k,we,ke,Se,Ce;const{adjustStock:Pe,getProduct:_e}=r(),[Ie,qe]=te.useState(o);ze(s);const[Ae,De]=te.useState(!1),[Le,Ve]=te.useState(null),[Re,Te]=te.useState(0),[Fe,Ee]=te.useState(""),[Ue,Me]=te.useState(!1),[Ge,Be]=te.useState(null),[He,Ke]=te.useState(null),[We,Je]=te.useState(!1),[Ze,Ye]=te.useState({name:"",sku:"",costPrice:0,sellingPrice:0,quantity:0,minQuantity:2}),[Xe,es]=te.useState(!1),[ss,ts]=te.useState({storageRoomId:o.storageRoomId||"",shelfId:o.shelfId||""}),[as,rs]=te.useState(!1),[ls,is]=te.useState(null),[ns,ds]=te.useState("overview"),[cs,os]=te.useState(!1);te.useEffect(()=>{var e;if(!s)return void Ts(!0);Ts(!0);const t=(null==(e=null==o?void 0:o.variants)?void 0:e.reduce((e,s)=>e+(s.quantity||0),0))||0,a={...o,totalQuantity:t};qe(a),(null==o?void 0:o.variants)&&o.variants.length>0&&Vs(o.variants[0]);const r=setTimeout(()=>{Ts(!1)},300);return()=>clearTimeout(r)},[o,!1,s]),te.useEffect(()=>{"purchase-orders"!==ns||cs||os(!0)},[ns,cs]),te.useEffect(()=>{const e=e=>{const{updatedProducts:s}=e.detail;o&&s.includes(o.id)&&qe({...o})};return window.addEventListener("productDataUpdated",e),()=>{window.removeEventListener("productDataUpdated",e)}},[o]);const[xs,ms]=te.useState([]),[gs,us]=te.useState(0),[hs,bs]=te.useState(!1),[ps,js]=te.useState(""),[vs,ys]=te.useState(!1),[Ns,fs]=te.useState(!1),ws=ae.useRef(null),{history:ks,stats:Ss,isLoading:Cs}=be(cs?null==o?void 0:o.id:void 0);te.useState(!1);const[Ps,_s]=te.useState(!1),Is=ae.useRef(null),[qs,As]=te.useState(!1),[Ds,Ls]=te.useState(!1),[zs,Vs]=te.useState(null),[Rs,Ts]=te.useState(!0);te.useEffect(()=>{const e=e=>{const s=e.target;_s(s.scrollTop>20)},s=Is.current;if(s)return s.addEventListener("scroll",e),()=>s.removeEventListener("scroll",e)},[]),te.useEffect(()=>{if(s&&o){const e=setTimeout(()=>{(async()=>{if(null==o?void 0:o.id)try{fs(!0);const e=await le.getProductImages(o.id);ms(e)}catch(e){}finally{fs(!1)}})()},100);return()=>clearTimeout(e)}},[s,null==o?void 0:o.id]);const Os=()=>{ws.current&&ws.current.click()},$s=ae.useMemo(()=>s&&(null==o?void 0:o.variants)&&0!==o.variants.length?{totalStock:pe(o.variants),totalCostValue:je(o.variants),totalRetailValue:ve(o.variants),potentialProfit:ye(o.variants),profitMargin:Ne(o.variants),stockStatus:fe(o.variants)}:null,[null==o?void 0:o.variants,s]),Fs=ae.useMemo(()=>{var e,t;if(!s||"overview"!==ns)return{};const a=null==(e=null==o?void 0:o.variants)?void 0:e[0];return(null==(t=null==a?void 0:a.attributes)?void 0:t.specification)?de(a.attributes.specification):{}},[null==o?void 0:o.variants,s,ns]);if(!s||!o)return null;const Es=(()=>{if(!o.variants||0===o.variants.length)return null;const e=o.variants.find(e=>(e.quantity||0)>0);if(e)return e;const s=[...o.variants].sort((e,s)=>(s.sellingPrice||0)-(e.sellingPrice||0))[0];return s&&s.sellingPrice>0?s:o.variants[0]})();if(!o.variants||0===o.variants.length)return re.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Product Has No Variants"}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(i,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(C,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Product ",e.jsxs("strong",{children:['"',o.name,'"']})," has no variants configured."]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Please add at least one variant to this product before viewing details."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(t,{onClick:d,variant:"secondary",className:"flex-1",children:"Close"}),m&&e.jsx(t,{onClick:()=>{d(),m(o)},className:"flex-1",children:"Edit Product"})]})]})]})}),document.body);o.createdAt&&Math.floor((Date.now()-new Date(o.createdAt).getTime())/864e5),Math.round((o.name?20:0)+(o.description?15:0)+(xs.length>0?25:0)+(Object.keys(Fs).length>0?20:0)+((null==Es?void 0:Es.sellingPrice)>0?20:0));const Qs=()=>{try{const e=`${window.location.origin}/lats/products/${o.id}/edit`,s=`Product: ${o.name}\nSKU: ${(null==Es?void 0:Es.sku)||"N/A"}\nPrice: ${ie.money((null==Es?void 0:Es.sellingPrice)||0)}\nDetails: ${e}`,t=`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(s)}`;js(t),bs(!0),Q.success("QR Code generated!")}catch(e){Q.error("Failed to generate QR code")}},Us=()=>{Be(null),Ke(null)},Ms=async()=>{if(Ge&&He)try{const{error:e}=await a.from("lats_product_variants").update({variant_name:He.name,sku:He.sku,cost_price:He.costPrice,selling_price:He.sellingPrice,quantity:He.quantity,min_quantity:He.minQuantity}).eq("id",Ge);if(e)throw e;Q.success("Variant updated!"),Be(null),Ke(null);const s=await _e(o.id);s.ok&&s.data&&qe(s.data)}catch(e){Q.error(`Failed: ${e.message}`)}};return re.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/30 backdrop-blur-sm animate-fade-in",onClick:d,style:{zIndex:35,left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0}}),e.jsx("div",{className:"fixed flex items-center justify-center p-2 sm:p-4 overflow-y-auto",style:{zIndex:50,left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,pointerEvents:"none"},children:e.jsxs("div",{className:"relative bg-white rounded-lg sm:rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] sm:max-h-[85vh] overflow-hidden flex flex-col my-2 sm:my-4 animate-scale-in",onClick:e=>e.stopPropagation(),style:{pointerEvents:"auto"},children:[Rs&&e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent overflow-hidden z-50",children:e.jsx("div",{className:"h-full w-1/3 bg-gradient-to-r from-blue-400 via-blue-600 to-blue-400 animate-progress-bar"})}),e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-gray-100 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(l,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900",children:o.name})}),e.jsx("p",{className:"text-xs text-gray-500",children:(null==Es?void 0:Es.sku)||"No SKU"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:d,className:"p-2.5 bg-red-500/90 hover:bg-red-600 text-white rounded-full shadow-lg backdrop-blur-sm transition-all duration-200 transform hover:scale-110 flex-shrink-0",title:"Close modal",children:e.jsx(i,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex w-full",children:[e.jsx("button",{onClick:()=>!Rs&&ds("overview"),disabled:Rs,className:"flex-1 py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed "+("overview"===ns?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]})}),e.jsx("button",{onClick:()=>!Rs&&ds("financials"),disabled:Rs,className:"flex-1 py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed "+("financials"===ns?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Financials"}),e.jsx("span",{className:"sm:hidden",children:"Money"})]})}),e.jsx("button",{onClick:()=>!Rs&&ds("inventory"),disabled:Rs,className:"flex-1 py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed "+("inventory"===ns?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(l,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Inventory"}),e.jsx("span",{className:"sm:hidden",children:"Stock"})]})}),e.jsx("button",{onClick:()=>!Rs&&ds("variants"),disabled:Rs,className:"flex-1 py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed "+("variants"===ns?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:"Variants"})]})}),e.jsx("button",{onClick:()=>!Rs&&ds("purchase-orders"),disabled:Rs,className:"flex-1 py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed "+("purchase-orders"===ns?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Orders"}),e.jsx("span",{className:"sm:hidden",children:"PO"})]})}),xe(Ie.variants)&&e.jsx("button",{onClick:()=>!Rs&&ds("tradein"),disabled:Rs,className:"flex-1 py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed "+("tradein"===ns?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Trade-In"}),e.jsx("span",{className:"sm:hidden",children:"TI"})]})}),e.jsx("button",{onClick:()=>!Rs&&ds("details"),disabled:Rs,className:"flex-1 py-2 sm:py-3 px-3 sm:px-4 border-b-2 font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed "+("details"===ns?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Details"}),e.jsx("span",{className:"sm:hidden",children:"More"})]})})]})}),e.jsxs("div",{ref:Is,className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 scroll-smooth relative",style:{minHeight:0},children:[Ps&&e.jsx("button",{onClick:()=>{var e;return null==(e=Is.current)?void 0:e.scrollTo({top:0,behavior:"smooth"})},className:"fixed bottom-24 right-6 p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 z-50 group",children:e.jsx(q,{className:"w-5 h-5 group-hover:animate-bounce"})}),Rs?e.jsx("div",{className:"p-3 sm:p-4 pb-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"aspect-square bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded-lg flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsx(l,{className:"w-16 h-16 text-gray-400 mx-auto mb-2 animate-pulse"}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Loading product..."})]})]}),e.jsxs("div",{className:"bg-gray-100 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded w-1/3 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded w-2/3 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})}),e.jsx("div",{className:"h-4 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded w-full relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded w-2/3 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})}),e.jsx("div",{className:"h-4 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded w-full relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-gray-100 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded w-1/3 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded-lg h-20 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})}),e.jsx("div",{className:"bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded-lg h-20 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})})]})]}),e.jsxs("div",{className:"bg-gray-100 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded w-1/3 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})}),e.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})}),e.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 rounded relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent animate-shimmer opacity-50",style:{backgroundSize:"1000px 100%"}})})]})]})]})]})}):e.jsxs("div",{className:"p-3 sm:p-4 pb-6",children:[qs&&e.jsxs("div",{className:"mb-6 bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-yellow-300",children:[e.jsx(A,{className:"w-5 h-5 text-yellow-700"}),e.jsx("h3",{className:"text-sm font-bold text-yellow-900",children:"Debug Panel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-2",children:"Product Info"}),e.jsxs("div",{className:"space-y-1 text-gray-700 font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"ID:"})," ",o.id]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Name:"})," ",o.name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Active:"})," ",o.isActive?"âœ…":"âŒ"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-2",children:"Variants"}),e.jsxs("div",{className:"space-y-1 text-gray-700 font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Count:"})," ",(null==(u=Ie.variants)?void 0:u.length)||0]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Stock:"})," ",Ie.totalQuantity||0]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-2",children:"UI State"}),e.jsxs("div",{className:"space-y-1 text-gray-700 font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tab:"})," ",ns]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Images:"})," ",xs.length]})]})]})]})]}),"overview"===ns&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{ref:ws,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files;if(s&&0!==s.length&&(null==o?void 0:o.id)){ys(!0);try{const e=s[0];if(!e.type.startsWith("image/"))return Q.error("Please select an image file"),void ys(!1);if(e.size>10485760)return Q.error("Image size must be less than 10MB"),void ys(!1);Q.loading("Uploading image...",{id:"image-upload"});let a=null;try{const e=localStorage.getItem("user");if(e){const s=JSON.parse(e);a=s.id&&"system"!==s.id?s.id:null}}catch(t){}const r=await le.uploadImage(e,o.id,a,0===xs.length);if(!r.success)throw new Error(r.error||"Upload failed");const l=await le.getProductImages(o.id);ms(l),Q.success("Image uploaded successfully!",{id:"image-upload"}),ws.current&&(ws.current.value="")}catch(a){const e=a instanceof Error?a.message:"Failed to upload image";Q.error(e,{id:"image-upload"})}finally{ys(!1)}}},className:"hidden"}),e.jsxs("div",{className:"aspect-square relative rounded-lg overflow-hidden bg-gray-50 border-2 border-dashed transition-all "+(xs.length>0?"border-gray-200":vs||Ns?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-blue-50/30 cursor-pointer"),onClick:0!==xs.length||Ns?void 0:Os,children:[Ns&&0===xs.length?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx(ne,{size:80,strokeWidth:6,color:"blue"}),e.jsx("p",{className:"text-sm font-medium text-blue-600 mt-4",children:"Loading images..."})]}):xs.length>0?e.jsxs(e.Fragment,{children:[(()=>{const s=xs[gs]||xs[0],t=(null==s?void 0:s.url)||(null==s?void 0:s.thumbnailUrl);return t&&(t.includes(".png")||t.includes("image/png"))?e.jsx("div",{className:"absolute inset-0 bg-white"}):null})(),e.jsx("img",{src:(null==(h=xs[gs])?void 0:h.url)||(null==(p=xs[gs])?void 0:p.thumbnailUrl)||(null==(y=xs[0])?void 0:y.url)||(null==(f=xs[0])?void 0:f.thumbnailUrl),alt:o.name,className:"w-full h-full object-contain relative z-10 cursor-pointer hover:scale-105 transition-transform",onClick:()=>Ls(!0),loading:"eager"}),e.jsx("button",{onClick:()=>Ls(!0),className:"absolute top-3 left-3 p-2 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg hover:bg-white transition-colors z-20",title:"View Gallery",children:e.jsx(l,{className:"w-5 h-5 text-gray-700"})})]}):e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-400 group hover:text-blue-500 transition-colors",children:vs?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:80,strokeWidth:6,color:"blue"}),e.jsx("p",{className:"text-sm font-medium text-blue-600 mt-4",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{className:"w-20 h-20 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("p",{className:"text-sm font-medium group-hover:text-blue-600",children:"Click to upload"}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"PNG, JPG, WEBP (Max 10MB)"})]})}),xs.length>0&&e.jsx("button",{onClick:e=>{e.stopPropagation(),Os()},disabled:vs,className:"absolute bottom-3 right-3 bg-white/90 backdrop-blur-sm hover:bg-blue-500 hover:text-white text-gray-700 p-2 rounded-full shadow-lg transition-all duration-200",children:e.jsx(v,{className:"w-5 h-5"})})]}),xs.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:xs.map((s,t)=>e.jsxs("button",{onClick:()=>us(t),className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden border-2 transition-all relative "+(t===gs?"border-blue-500":"border-gray-200 hover:border-gray-300"),children:[(()=>{const t=s.thumbnailUrl||s.url;return t&&(t.includes(".png")||t.includes("image/png"))?e.jsx("div",{className:"absolute inset-0 bg-white"}):null})(),e.jsx("img",{src:s.thumbnailUrl||s.url,alt:`${o.name} ${t+1}`,className:"w-full h-full object-cover relative z-10"})]},s.id))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(n,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Basic Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(k=Ie.category)?void 0:k.name)||"Uncategorized"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),e.jsx("p",{className:"text-sm font-medium "+(o.isActive?"text-green-600":"text-red-600"),children:o.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Variants"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(we=o.variants)?void 0:we.length)||0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Stock"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ie.totalQuantity||0})]})]})]}),Object.keys(Fs).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Specifications"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[Object.entries(Fs).slice(0,6).map(([s,t])=>{const a=ce(s,t);return e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 capitalize",children:s.replace(/_/g," ")}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:a})]},s)}),Object.keys(Fs).length>6&&e.jsxs("div",{className:"text-xs text-gray-500 text-center py-2",children:["+",Object.keys(Fs).length-6," more specifications"]})]})]}),o.description&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Description"}),e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed bg-gray-50 rounded-lg p-3",children:o.description})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-center w-7 h-7 bg-green-50 rounded-lg",children:e.jsx(D,{className:"w-3.5 h-3.5 text-green-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Pricing"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-2 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[e.jsx(L,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"text-[9px] font-bold text-green-700 uppercase tracking-wide",children:"Price"})]}),e.jsx("p",{className:"text-lg font-bold text-green-700",children:ie.money((null==Es?void 0:Es.sellingPrice)||0)})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-2 border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[e.jsx(z,{className:"w-3 h-3 text-red-600"}),e.jsx("span",{className:"text-[9px] font-bold text-red-700 uppercase tracking-wide",children:"Cost"})]}),e.jsx("p",{className:"text-lg font-bold text-red-700",children:ie.money((null==Es?void 0:Es.costPrice)||0)})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2 border border-blue-200",children:[e.jsx("span",{className:"text-[9px] font-bold text-blue-700 uppercase tracking-wide block mb-0.5",children:"Profit"}),e.jsx("p",{className:"text-sm font-bold text-blue-700",children:ie.money(((null==Es?void 0:Es.sellingPrice)||0)-((null==Es?void 0:Es.costPrice)||0))})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-2 border border-purple-200",children:[e.jsx("span",{className:"text-[9px] font-bold text-purple-700 uppercase tracking-wide block mb-0.5",children:"Markup"}),e.jsx("p",{className:"text-sm font-bold text-purple-700",children:(null==Es?void 0:Es.costPrice)>0?`${((Es.sellingPrice-Es.costPrice)/Es.costPrice*100).toFixed(1)}%`:"N/A"})]})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-2.5 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:"text-[9px] font-bold text-orange-700 uppercase tracking-wide",children:"Total Value"}),e.jsx(V,{className:"w-3.5 h-3.5 text-orange-600"})]}),e.jsx("p",{className:"text-lg font-bold text-orange-700",children:ie.money((null==$s?void 0:$s.totalRetailValue)||0)})]})]}),o.variants&&o.variants.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(b,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variants"})]}),e.jsxs("div",{className:"space-y-2",children:[o.variants.slice(0,3).map((s,t)=>{const a=me(s);let r=ge(s,`Variant ${t+1}`);if(r.length>45&&r.includes("IMEI:")){const e=r.split("IMEI:");if(e[1]){const s=e[1].trim();s.length>10&&(r=e[0]+"IMEI:..."+s.slice(-6))}}return e.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:r}),a&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${a.className}`,children:a.text})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium "+(0===(s.quantity||0)?"bg-red-100 text-red-700":(s.quantity||0)<=(s.minQuantity||0)?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"),children:["Stock: ",s.quantity||0]}),e.jsx("span",{className:"font-semibold text-gray-900",children:ie.money(s.sellingPrice||s.price||0)})]})]},s.id||t)}),o.variants.length>3&&e.jsxs("button",{onClick:()=>ds("variants"),className:"text-xs text-gray-500 text-center py-2 bg-gray-50 rounded-lg w-full hover:bg-gray-100 hover:text-gray-700 transition-colors cursor-pointer",children:["+",o.variants.length-3," more variants"]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200",children:[e.jsx(c,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Product Status"})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"Condition"})]}),e.jsx("span",{className:"px-3 py-1 bg-purple-500 text-white text-sm font-semibold rounded capitalize",children:o.condition||"New"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white border border-green-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium uppercase",children:"In Stock"}),e.jsx(c,{className:"w-3 h-3 text-green-500"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:o.variants?o.variants.filter(e=>(e.quantity||0)>0).length:0}),e.jsx("div",{className:"text-xs text-gray-500",children:"variants"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center "+((o.variants?o.variants.filter(e=>(e.quantity||0)>0&&(e.quantity||0)<5).length:0)>0?"border-2 border-orange-500":"border border-gray-200"),children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium uppercase",children:"Low Stock"}),(o.variants?o.variants.filter(e=>(e.quantity||0)>0&&(e.quantity||0)<5).length:0)>0&&e.jsx(C,{className:"w-3 h-3 text-orange-500"})]}),e.jsx("div",{className:"text-3xl font-bold text-orange-600 mb-1",children:o.variants?o.variants.filter(e=>(e.quantity||0)>0&&(e.quantity||0)<5).length:0}),e.jsx("div",{className:"text-xs text-gray-500",children:"variants < 5"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center "+((o.variants?o.variants.filter(e=>(e.quantity||0)<=0).length:0)>0?"border-2 border-red-300":"border border-gray-200"),children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium uppercase",children:"No Stock"}),(o.variants?o.variants.filter(e=>(e.quantity||0)<=0).length:0)>0&&e.jsx(i,{className:"w-3 h-3 text-red-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-600 mb-1",children:o.variants?o.variants.filter(e=>(e.quantity||0)<=0).length:0}),e.jsx("div",{className:"text-xs text-gray-500",children:"variants"})]})]}),o.variants&&o.variants.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold",children:"Stock Health"}),e.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:[o.variants.filter(e=>(e.quantity||0)>(e.minQuantity||0)).length," of ",o.variants.length," healthy"]})]}),e.jsx("div",{className:"relative w-full h-2 bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded transition-all duration-500",style:{width:`${(o.variants.filter(e=>(e.quantity||0)>(e.minQuantity||0)).length/o.variants.length*100).toFixed(0)}%`}})})]})]})]})]})}),"financials"===ns&&$s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 uppercase",children:"Total Cost Value"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:ie.money($s.totalCostValue)}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"Investment"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 uppercase",children:"Total Retail Value"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:ie.money($s.totalRetailValue)}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Revenue Potential"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-700 uppercase",children:"Potential Profit"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:ie.money($s.potentialProfit)}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"If all sold"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"text-xs font-medium text-orange-700 uppercase",children:"Profit Margin"})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[$s.profitMargin.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-orange-700 mt-1",children:"Average margin"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(O,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Average Pricing"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Avg Cost Price"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:ie.money($s.totalStock>0?$s.totalCostValue/$s.totalStock:0)})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Avg Selling Price"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:ie.money($s.totalStock>0?$s.totalRetailValue/$s.totalStock:0)})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Avg Profit/Unit"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:ie.money($s.totalStock>0?$s.potentialProfit/$s.totalStock:0)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx($,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Variant Profitability Analysis"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Variant"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Stock"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Cost"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Price"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Profit/Unit"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Total Profit"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Markup %"})]})}),e.jsx("tbody",{children:(Array.isArray(Ie.variants)?Ie.variants:[]).map((s,t)=>{const a=(s.sellingPrice||0)-(s.costPrice||0),r=a*(s.quantity||0),l=s.costPrice>0?a/s.costPrice*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:ge(s,`Variant ${t+1}`)}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:s.sku})]}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"font-medium "+(0===(s.quantity||0)?"text-red-600":(s.quantity||0)<=(s.minQuantity||0)?"text-orange-600":"text-green-600"),children:s.quantity||0})}),e.jsx("td",{className:"p-3 text-right font-medium text-red-600",children:ie.money(s.costPrice||0)}),e.jsx("td",{className:"p-3 text-right font-medium text-green-600",children:ie.money(s.sellingPrice||0)}),e.jsx("td",{className:"p-3 text-right font-bold text-blue-600",children:ie.money(a)}),e.jsx("td",{className:"p-3 text-right font-bold text-purple-600",children:ie.money(r)}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("span",{className:"font-bold "+(l>50?"text-green-600":l>20?"text-orange-600":"text-red-600"),children:[l.toFixed(1),"%"]})})]},s.id)})})]})})]})]}),"inventory"===ns&&e.jsx("div",{className:"space-y-6",children:Rs||!$s?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-6 relative",children:[e.jsx(ne,{size:72,strokeWidth:6,color:"blue",className:"mx-auto"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(l,{className:"w-8 h-8 text-blue-500 animate-pulse"})})]}),e.jsx("p",{className:"text-gray-700 font-medium text-lg mb-2",children:"Loading Inventory"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Fetching stock data and analytics..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 uppercase",children:"Total Stock"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:$s.totalStock}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"units across all variants"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 uppercase",children:"In Stock"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-900",children:(null==(ke=Ie.variants)?void 0:ke.filter(e=>(e.quantity||0)>0).length)||0}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"variants available"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-xs font-medium text-red-700 uppercase",children:"Needs Attention"})]}),e.jsx("div",{className:"text-3xl font-bold text-red-900",children:(null==(Se=Ie.variants)?void 0:Se.filter(e=>(e.quantity||0)<=(e.minQuantity||0)).length)||0}),e.jsx("div",{className:"text-xs text-red-700 mt-1",children:"low or out of stock"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(E,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Stock by Variant"})]}),e.jsx("div",{className:"space-y-3",children:(Array.isArray(Ie.variants)?Ie.variants:[]).map((s,t)=>{const a=s.minQuantity>0?Math.min((s.quantity||0)/s.minQuantity*100,100):100,r=0===(s.quantity||0)?"empty":(s.quantity||0)<=s.minQuantity?"low":"good";return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:ge(s,`Variant ${t+1}`)}),(l=s.quantity||0,i=s.minQuantity||0,0===l?e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:"Out of Stock"}):l<=i?e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 text-xs font-medium rounded-full",children:"Low Stock"}):e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:"In Stock"}))]}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:s.sku})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s.quantity||0}),e.jsxs("div",{className:"text-xs text-gray-600",children:["/ ",s.minQuantity||0," min"]})]})]}),e.jsx("div",{className:"relative w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full transition-all "+("empty"===r?"bg-red-500":"low"===r?"bg-orange-500":"bg-green-500"),style:{width:`${Math.min(a,100)}%`}})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Current"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.quantity||0," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Min Level"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.minQuantity||0," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Value"}),e.jsx("span",{className:"font-medium text-gray-900",children:ie.money((s.quantity||0)*(s.sellingPrice||0))})]})]})]},s.id);var l,i})})]}),(Ie.storageRoomName||Ie.shelfName)&&e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(x,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Storage Location"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Ie.storageRoomName&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("span",{className:"text-xs text-green-700 block mb-1",children:"Storage Room"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Ie.storageRoomName})]}),Ie.shelfName&&e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"text-xs text-purple-700 block mb-1",children:"Shelf"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Ie.shelfName})]})]})]})]})}),"variants"===ns&&e.jsxs("div",{className:"space-y-6",children:[Ie.variants&&Ie.variants.length>0&&e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-xl p-6",children:e.jsx(Qe,{productId:Ie.id,variants:Ie.variants,showFinancials:!0,showSearch:!0,onChildClick:e=>{var s;Q.success(`Selected: ${(null==(s=e.variant_attributes)?void 0:s.imei)||"Device"}`)}})}),Ie.variants&&Ie.variants.length>0&&e.jsx("div",{className:"border-t-2 border-gray-200 pt-6",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-gray-600"}),"Variant Management"]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Manage Variants (",(null==(Ce=Ie.variants)?void 0:Ce.length)||0,")"]}),e.jsxs("button",{onClick:()=>Je(!We),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(v,{className:"w-4 h-4"}),"Add Variant"]})]}),We&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-blue-600"}),"New Variant"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name*"}),e.jsx("input",{type:"text",value:Ze.name,onChange:e=>Ye({...Ze,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 256GB Blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU*"}),e.jsx("input",{type:"text",value:Ze.sku,onChange:e=>Ye({...Ze,sku:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., PROD-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Price"}),e.jsx("input",{type:"number",value:Ze.costPrice,onChange:e=>Ye({...Ze,costPrice:parseFloat(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selling Price"}),e.jsx("input",{type:"number",value:Ze.sellingPrice,onChange:e=>Ye({...Ze,sellingPrice:parseFloat(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",value:Ze.quantity,onChange:e=>Ye({...Ze,quantity:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Level"}),e.jsx("input",{type:"number",value:Ze.minQuantity,onChange:e=>Ye({...Ze,minQuantity:parseInt(e.target.value)||2}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:async()=>{if(Ze.name&&Ze.sku)try{const{error:e}=await a.from("lats_product_variants").insert({product_id:o.id,variant_name:Ze.name,sku:Ze.sku,cost_price:Ze.costPrice,selling_price:Ze.sellingPrice,quantity:Ze.quantity,min_quantity:Ze.minQuantity,is_active:!0});if(e){if("23505"!==e.code)throw e;return void Q.error("SKU already exists")}Q.success("Variant added!"),Je(!1),Ye({name:"",sku:"",costPrice:0,sellingPrice:0,quantity:0,minQuantity:2});const s=await _e(o.id);s.ok&&s.data&&qe(s.data)}catch(e){Q.error(`Failed: ${e.message}`)}else Q.error("Please fill in name and SKU")},className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(M,{className:"w-4 h-4"}),"Save"]}),e.jsx("button",{onClick:()=>{Je(!1),Ye({name:"",sku:"",costPrice:0,sellingPrice:0,quantity:0,minQuantity:2})},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors text-sm font-medium",children:"Cancel"})]})]}),Ie.variants&&Ie.variants.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(b,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variant List"})]}),e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Stock"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden md:table-cell",children:"Min"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden lg:table-cell",children:"Cost"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Price"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700 hidden lg:table-cell",children:"Markup"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:Ie.variants.map(s=>{const t=s.costPrice>0?(s.sellingPrice-s.costPrice)/s.costPrice*100:0,r=Ge===s.id,l=ls===s.id,d=me(s),m=ue(s);return r&&He?e.jsxs("tr",{className:"border-b border-gray-100 bg-blue-50",children:[e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"text",value:He.name,onChange:e=>Ke({...He,name:e.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:He.quantity,onChange:e=>Ke({...He,quantity:parseInt(e.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"})}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:e.jsx("input",{type:"number",value:He.minQuantity,onChange:e=>Ke({...He,minQuantity:parseInt(e.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:e.jsx("input",{type:"number",value:He.costPrice,onChange:e=>Ke({...He,costPrice:parseFloat(e.target.value)||0}),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm",step:"0.01"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:He.sellingPrice,onChange:e=>Ke({...He,sellingPrice:parseFloat(e.target.value)||0}),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm",step:"0.01"})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:"-"}),e.jsx("td",{className:"p-3",children:"-"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:Ms,className:"p-1 text-green-600 hover:bg-green-50 rounded",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Us,className:"p-1 text-gray-600 hover:bg-gray-50 rounded",children:e.jsx(i,{className:"w-4 h-4"})})]})})]},s.id):e.jsxs(ae.Fragment,{children:[e.jsxs("tr",{className:`border-b border-gray-100 transition-colors ${s.quantity<=0?"bg-gray-100/50 opacity-75":l?"bg-blue-50 hover:bg-blue-100":"hover:bg-gray-50"} ${m.length>0?"cursor-pointer":""}`,onClick:()=>{m.length>0&&is(l?null:s.id)},children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.isPrimary&&e.jsx(R,{className:"w-4 h-4 text-yellow-500"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-sm "+(s.quantity<=0?"text-gray-500 line-through":""),children:ge(s)}),s.quantity<=0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-bold bg-red-600 text-white",children:[e.jsx(i,{className:"w-3 h-3"}),"SOLD"]}),d&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${d.className}`,children:d.text})]})})]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium text-sm "+(s.quantity<=0?"text-red-600":s.quantity<=s.minQuantity?"text-orange-600":"text-green-600"),children:s.quantity})}),e.jsx("td",{className:"p-3 text-gray-600 text-sm hidden md:table-cell",children:s.minQuantity}),e.jsx("td",{className:"p-3 font-medium text-sm hidden lg:table-cell",children:ie.money(s.costPrice)}),e.jsx("td",{className:"p-3 font-medium text-sm",children:ie.money(s.sellingPrice)}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:e.jsxs("span",{className:"font-medium text-sm "+(t>50?"text-green-600":t>20?"text-orange-600":"text-red-600"),children:[t.toFixed(1),"%"]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium "+(s.quantity>s.minQuantity?"bg-green-100 text-green-700":s.quantity>0?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700 font-bold"),children:s.quantity>s.minQuantity?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-3 h-3"}),"Available"]}):s.quantity>0?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-3 h-3"}),"Low Stock"]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-3 h-3"}),"SOLD"]})})}),e.jsx("td",{className:"p-3",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[m.length>0&&e.jsx("button",{onClick:()=>is(l?null:s.id),className:"p-1 text-gray-600 hover:bg-gray-50 rounded",children:l?e.jsx(G,{className:"w-4 h-4"}):e.jsx(N,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(e=>{Be(e.id),Ke({name:ge(e),sku:e.sku,costPrice:e.costPrice||0,sellingPrice:e.sellingPrice||0,quantity:e.quantity||0,minQuantity:e.minQuantity||2})})(s),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(async(e,s)=>{if(confirm(`Delete variant "${s}"?`))try{const{error:s}=await a.from("lats_product_variants").delete().eq("id",e);if(s){if("23503"!==s.code)throw s;return void Q.error("Cannot delete: referenced in orders")}Q.success("Variant deleted!");const t=await _e(o.id);t.ok&&t.data&&qe(t.data)}catch(t){Q.error(`Failed: ${t.message}`)}})(s.id,ge(s)),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:e.jsx(j,{className:"w-4 h-4"})})]})})]}),l&&m.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-50 rounded-lg",children:e.jsx(n,{className:"w-4 h-4 text-blue-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variant Details"}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500 font-medium",children:[m.length," ",1===m.length?"attribute":"attributes"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:m.map((s,t)=>{const a="condition"===s.label.toLowerCase(),r=(s=>{const t=s.toLowerCase();return t.includes("imei")?e.jsx(w,{className:"w-3.5 h-3.5 text-indigo-600"}):t.includes("serial")?e.jsx(X,{className:"w-3.5 h-3.5 text-blue-600"}):t.includes("condition")?e.jsx(J,{className:"w-3.5 h-3.5 text-green-600"}):t.includes("warranty")?e.jsx(K,{className:"w-3.5 h-3.5 text-purple-600"}):t.includes("created")?e.jsx(K,{className:"w-3.5 h-3.5 text-orange-600"}):t.includes("location")?e.jsx(x,{className:"w-3.5 h-3.5 text-red-600"}):null})(s.label);return e.jsxs("div",{className:"space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[r&&e.jsx("span",{className:"opacity-70 group-hover:opacity-100 transition-opacity",children:r}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:s.label})]}),a?e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-semibold "+("new"===s.value.toLowerCase()?"bg-purple-100 text-purple-700 ring-1 ring-purple-200":"excellent"===s.value.toLowerCase()?"bg-green-100 text-green-700 ring-1 ring-green-200":"good"===s.value.toLowerCase()?"bg-blue-100 text-blue-700 ring-1 ring-blue-200":"bg-gray-100 text-gray-700 ring-1 ring-gray-200"),children:s.value}):e.jsx("p",{className:"text-sm font-semibold text-gray-900 break-words leading-snug",children:((e,s)=>{const t=s.toLowerCase();if((t.includes("date")||t.includes("warranty")||t.includes("created"))&&e.match(/^\d{4}-\d{2}-\d{2}/))try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return e}return e})(s.value,s.label)})]},t)})})]})})})]},s.id)})})]})})]}),(!Ie.variants||0===Ie.variants.length)&&!We&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No variants found"}),e.jsxs("button",{onClick:()=>Je(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(v,{className:"w-4 h-4"}),"Add First Variant"]})]})]}),"purchase-orders"===ns&&e.jsx("div",{className:"space-y-6",children:Cs?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{size:64,strokeWidth:5,color:"blue",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading purchase history..."})]})}):Ss&&0!==ks.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 uppercase",children:"Total Orders"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:Ss.totalOrders})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-700 uppercase",children:"Total Ordered"})]}),e.jsx("div",{className:"text-3xl font-bold text-purple-900",children:Ss.totalQuantityOrdered})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 uppercase",children:"Avg Cost"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:ie.money(Ss.averageCostPrice)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl p-4 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-xs font-medium text-amber-700 uppercase",children:"Last Order"})]}),e.jsx("div",{className:"text-sm font-bold text-amber-900",children:Ss.lastOrderDate?new Date(Ss.lastOrderDate).toLocaleDateString():"N/A"})]})]}),Ss.lowestCostPrice&&Ss.highestCostPrice&&e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Price Trend"})]}),Ss.lastCostPrice&&e.jsx("div",{className:"flex items-center gap-2",children:Ss.lastCostPrice<Ss.averageCostPrice?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Below Average"})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm text-red-600 font-medium",children:"Above Average"})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-xs text-green-700 mb-2",children:"Lowest"}),e.jsx("div",{className:"text-xl font-bold text-green-900",children:ie.money(Ss.lowestCostPrice)})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-xs text-blue-700 mb-2",children:"Average"}),e.jsx("div",{className:"text-xl font-bold text-blue-900",children:ie.money(Ss.averageCostPrice)})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-xs text-red-700 mb-2",children:"Highest"}),e.jsx("div",{className:"text-xl font-bold text-red-900",children:ie.money(Ss.highestCostPrice)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsx(W,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Order History"}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["(",ks.length," orders)"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:ks.map(s=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-mono text-sm font-medium text-blue-600",children:["#",s.orderNumber]}),e.jsx("span",{className:"text-xs px-3 py-1 rounded-full font-medium "+("completed"===s.poStatus||"received"===s.poStatus?"bg-green-100 text-green-700":"cancelled"===s.poStatus?"bg-red-100 text-red-700":"shipped"===s.poStatus||"partial_received"===s.poStatus?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:s.poStatus.replace(/_/g," ")})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block text-xs",children:"Supplier"}),e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s.supplierName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block text-xs",children:"Date"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(s.orderDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block text-xs",children:"Quantity"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[s.receivedQuantity,"/",s.quantity," units",s.receivedQuantity===s.quantity&&e.jsx(J,{className:"w-4 h-4 text-green-600 inline ml-1"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block text-xs",children:"Cost/Unit"}),e.jsx("div",{className:"font-bold text-gray-900",children:ie.money(s.costPrice)})]})]})]},s.id))})]})]}):e.jsxs("div",{className:"text-center py-12 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border-2 border-dashed border-gray-300",children:[e.jsx(B,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No Purchase History"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This product has no purchase order history yet"})]})}),"tradein"===ns&&e.jsx("div",{className:"space-y-6",children:(()=>{var s;const t=(null==(s=Ie.variants)?void 0:s.filter(e=>he(e)))||[];if(0===t.length)return e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx(w,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No trade-in information available"})]});const a=t[0],r=a.attributes||{};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Trade-In Device"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Original device information and details"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-100 text-xs mb-1",children:"Device"}),e.jsx("div",{className:"font-semibold",children:r.device_model||Ie.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-100 text-xs mb-1",children:"Condition"}),e.jsx("div",{className:"font-semibold capitalize",children:r.condition_rating||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-100 text-xs mb-1",children:"Storage"}),e.jsx("div",{className:"font-semibold",children:r.storage_capacity||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-100 text-xs mb-1",children:"Value"}),e.jsx("div",{className:"font-semibold text-xl",children:ie.money(r.trade_in_value||r.agreed_value||0)})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-200",children:[e.jsx(w,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Device Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.device_model&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",children:[e.jsx("span",{className:"text-xs text-blue-700 uppercase tracking-wide block mb-2 font-semibold",children:"Device Model"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:r.device_model})]}),r.imei&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",children:[e.jsx("span",{className:"text-xs text-purple-700 uppercase tracking-wide block mb-2 font-semibold",children:"IMEI"}),e.jsx("p",{className:"text-base font-mono font-bold text-gray-900",children:r.imei})]}),r.serial_number&&e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-lg p-4 border border-indigo-200",children:[e.jsx("span",{className:"text-xs text-indigo-700 uppercase tracking-wide block mb-2 font-semibold",children:"Serial Number"}),e.jsx("p",{className:"text-base font-mono font-bold text-gray-900",children:r.serial_number})]}),r.condition_rating&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200",children:[e.jsx("span",{className:"text-xs text-green-700 uppercase tracking-wide block mb-2 font-semibold",children:"Condition"}),e.jsx("p",{className:"text-base font-bold text-gray-900 capitalize",children:r.condition_rating})]}),r.storage_capacity&&e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",children:[e.jsx("span",{className:"text-xs text-orange-700 uppercase tracking-wide block mb-2 font-semibold",children:"Storage"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:r.storage_capacity})]}),r.color&&e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg p-4 border border-pink-200",children:[e.jsx("span",{className:"text-xs text-pink-700 uppercase tracking-wide block mb-2 font-semibold",children:"Color"}),e.jsx("p",{className:"text-base font-bold text-gray-900 capitalize",children:r.color})]})]})]}),(r.trade_in_value||r.agreed_value)&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-green-200 mb-4",children:[e.jsx(Z,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Financial Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Agreed Trade-In Value"}),e.jsx(D,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:ie.money(r.trade_in_value||r.agreed_value||0)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Selling Price"}),e.jsx(V,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:ie.money(a.sellingPrice||0)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Potential Profit"}),e.jsx(L,{className:"w-5 h-5 text-purple-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:ie.money((a.sellingPrice||0)-(r.trade_in_value||r.agreed_value||0))})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Markup Percentage"}),e.jsx(T,{className:"w-5 h-5 text-orange-500"})]}),e.jsxs("p",{className:"text-3xl font-bold text-orange-600",children:[((r.trade_in_value||r.agreed_value||0)>0?((a.sellingPrice||0)-(r.trade_in_value||r.agreed_value||0))/(r.trade_in_value||r.agreed_value||0)*100:0).toFixed(1),"%"]})]})]})]}),(r.customer_name||r.customer_phone||r.customer_email)&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-200 mb-4",children:[e.jsx(Y,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Original Customer"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.customer_name&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block mb-2",children:"Full Name"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:r.customer_name})]}),r.customer_phone&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block mb-2",children:"Phone Number"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:r.customer_phone})]}),r.customer_email&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block mb-2",children:"Email Address"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:r.customer_email})]})]})]}),r.condition_description&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-200 mb-4",children:[e.jsx(I,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Condition Assessment"})]}),e.jsx("div",{className:"bg-amber-50 rounded-lg p-4 border border-amber-200",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed whitespace-pre-wrap",children:r.condition_description})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-200 mb-4",children:[e.jsx(n,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Additional Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.trade_in_date&&e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx(K,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block",children:"Trade-In Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Date(r.trade_in_date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx(l,{className:"w-5 h-5 text-purple-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide block",children:"Current Stock"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[a.quantity||0," units"]})]})]})]})]}),e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(n,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Trade-In Product"}),e.jsx("p",{className:"text-sm text-blue-800",children:"This product was acquired through a trade-in transaction. The information above reflects the original device details and customer information at the time of trade-in."})]})]})})]})})()}),"details"===ns&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(S,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Identification"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"SKU"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:(null==Es?void 0:Es.sku)||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Product ID"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:o.id})]})]}),e.jsx("div",{className:"flex gap-3 pt-3",children:e.jsxs("button",{onClick:Qs,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(X,{className:"w-4 h-4"}),"QR Code"]})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Storage"})]}),e.jsxs("button",{onClick:()=>es(!0),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors",children:[e.jsx(U,{className:"w-3.5 h-3.5"}),"Edit"]})]}),o.storageRoomName||o.shelfName?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.storageRoomName&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Room"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:o.storageRoomName})]}),o.shelfName&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Shelf"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:o.shelfName})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(x,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No location assigned"})]})]}),(()=>{const s=xe(Ie.variants);return Ie.supplier&&!s?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(g,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Supplier Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ie.supplier.name})]}),Ie.supplier.contactPerson&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Contact"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ie.supplier.contactPerson})]}),Ie.supplier.phone&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Phone"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ie.supplier.phone})]}),Ie.supplier.email&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ie.supplier.email})]})]})]}):null})(),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(K,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Timestamps"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ie.createdAt?new Date(Ie.createdAt).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ie.updatedAt?new Date(Ie.updatedAt).toLocaleString():"N/A"})]})]})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 border-t border-gray-200 bg-white p-3 sm:p-4 transition-shadow "+(Ps?"shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]":""),children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-3",children:[e.jsxs("button",{onClick:()=>{try{localStorage.setItem("pos_quick_add",JSON.stringify({productId:o.id,variantId:null==Es?void 0:Es.id,timestamp:Date.now()})),Q.success("Redirecting to POS..."),setTimeout(()=>{window.open("/lats/pos","_blank")},1e3)}catch(e){Q.error("Failed to add to cart")}},disabled:Rs,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to POS"})]}),e.jsxs("button",{onClick:()=>{try{localStorage.setItem("stock_transfer_quick_add",JSON.stringify({productId:o.id,productName:o.name,variants:o.variants||[],timestamp:Date.now()})),Q.success("Opening stock transfer..."),setTimeout(()=>{window.location.href="/lats/stock-transfers?autoOpen=true"},500)}catch(e){Q.error("Failed to initiate transfer")}},disabled:Rs||!Es||0===((null==Es?void 0:Es.quantity)||0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Transfer to another branch",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Transfer"}),e.jsx("span",{className:"sm:hidden",children:"Transfer"})]}),e.jsxs("button",{onClick:()=>{try{localStorage.setItem("po_quick_add",JSON.stringify({productId:o.id,productName:o.name,variantId:null==Es?void 0:Es.id,sku:null==Es?void 0:Es.sku,timestamp:Date.now()})),Q.success("Redirecting to Purchase Orders..."),setTimeout(()=>{window.location.href="/lats/purchase-orders"},1e3)}catch(e){Q.error("Failed to add to purchase order")}},disabled:Rs,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Add to Purchase Order",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add to PO"}),e.jsx("span",{className:"sm:hidden",children:"PO"})]}),e.jsxs("button",{onClick:Qs,disabled:Rs,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"QR Code"}),e.jsx("span",{className:"sm:hidden",children:"QR"})]}),e.jsxs("button",{onClick:()=>{var e;const s=`\nProduct: ${Ie.name}\nSKU: ${(null==Es?void 0:Es.sku)||"N/A"}\nPrice: ${ie.money((null==Es?void 0:Es.sellingPrice)||0)}\nStock: ${(null==$s?void 0:$s.totalStock)||0} units\nCategory: ${(null==(e=Ie.category)?void 0:e.name)||"N/A"}\nStatus: ${Ie.isActive?"Active":"Inactive"}\n    `.trim();navigator.clipboard.writeText(s),Q.success("Product info copied to clipboard!")},disabled:Rs,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy Info"}),e.jsx("span",{className:"sm:hidden",children:"Copy"})]}),e.jsxs("button",{onClick:()=>{var e;try{const s={name:o.name,sku:(null==Es?void 0:Es.sku)||"",categoryId:o.categoryId,condition:(null==Es?void 0:Es.condition)||"",description:o.description||"",specification:(null==(e=null==Es?void 0:Es.attributes)?void 0:e.specification)||"",price:(null==Es?void 0:Es.sellingPrice)||0,costPrice:(null==Es?void 0:Es.costPrice)||0,stockQuantity:(null==Es?void 0:Es.quantity)||0,minStockLevel:(null==Es?void 0:Es.minQuantity)||0,storageRoomId:"",shelfId:"",images:[],metadata:o.metadata||{},variants:[]},t=o.variants||[],a=oe(s,t),r=new Blob([a],{type:"application/json"}),l=window.URL.createObjectURL(r),i=document.createElement("a");i.href=l,i.download=`${o.name.replace(/[^a-zA-Z0-9]/g,"_")}_export_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(l),Q.success("Product exported!")}catch(s){Q.error("Export failed")}},disabled:Rs,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"}),e.jsx("span",{className:"sm:hidden",children:"Save"})]}),m&&e.jsxs("button",{onClick:()=>m(o),disabled:Rs,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]})]})}),hs&&re.createPortal(e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center p-4",style:{zIndex:1e5},children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:()=>bs(!1)}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"QR Code"}),e.jsx("button",{onClick:()=>bs(!1),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(i,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200 inline-block",children:e.jsx("img",{src:ps,alt:"QR Code",className:"w-64 h-64 object-contain"})}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium",children:o.name}),e.jsxs("p",{children:["SKU: ",null==Es?void 0:Es.sku]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(t,{onClick:()=>{const e=document.createElement("a");e.href=ps,e.download=`${o.name.replace(/[^a-zA-Z0-9]/g,"_")}_QR.png`,e.click(),Q.success("Downloaded!")},className:"flex-1",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Download"]})})]})]})]}),document.body),Ds&&xs.length>0&&re.createPortal(e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center p-4",style:{zIndex:1e5},children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>Ls(!1)}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Image Gallery"}),e.jsx("button",{onClick:()=>Ls(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(i,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[xs.map((s,t)=>e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:"aspect-square relative rounded-lg overflow-hidden bg-gray-100",children:[(()=>{const t=s.url;return t&&(t.includes(".png")||t.includes("image/png"))?e.jsx("div",{className:"absolute inset-0 bg-white"}):null})(),e.jsx("img",{src:s.url,alt:`${Ie.name} ${t+1}`,className:"w-full h-full object-contain relative z-10 cursor-pointer",onClick:()=>{us(t),Ls(!1)}}),s.isPrimary&&e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full font-medium",children:"Primary"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this image?"))try{Q.loading("Deleting image...",{id:"delete-image"});const{error:s}=await a.from("product_images").delete().eq("id",e);if(s)throw s;const t=xs.find(s=>s.id===e);if(null==t?void 0:t.url){const e=t.url.split("/").pop();if(e){const{error:s}=await a.storage.from("product-images").remove([e])}}const r=xs.filter(s=>s.id!==e);ms(r),gs>=r.length&&us(Math.max(0,r.length-1)),Q.success("Image deleted successfully!",{id:"delete-image"})}catch(s){Q.error("Failed to delete image",{id:"delete-image"})}})(s.id)},className:"absolute top-2 right-2 p-2 bg-red-500/90 hover:bg-red-600 text-white rounded-full shadow-xl backdrop-blur-sm transition-all duration-200 transform hover:scale-110 z-20",title:"Delete image",children:e.jsx(i,{className:"w-4 h-4"})})]})},s.id)),e.jsx("div",{className:"relative group",children:e.jsxs("button",{onClick:Os,disabled:vs,className:"aspect-square relative rounded-lg overflow-hidden bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-dashed border-blue-300 hover:border-blue-500 transition-all duration-200 w-full flex flex-col items-center justify-center gap-3 group-hover:from-blue-100 group-hover:to-indigo-100",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 group-hover:bg-blue-200 flex items-center justify-center transition-colors",children:e.jsx(v,{className:"w-8 h-8 text-blue-600 group-hover:scale-110 transition-transform"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600 group-hover:text-blue-700",children:"Add More"}),e.jsx("p",{className:"text-xs text-blue-500 mt-1",children:"Upload image"})]})]})})]})})]})]}),document.body),Ae&&e.jsx(Oe,{product:Ie,isOpen:Ae,onClose:()=>{De(!1)},onSubmit:async e=>{await(async()=>{if(Le&&0!==Re&&Fe.trim()){Me(!0);try{const e=await Pe(o.id,Le.id,Re,Fe);if(e.ok){Q.success("Stock adjusted!"),De(!1),Ve(null),Te(0),Ee("");const e=await _e(o.id);e.ok&&e.data&&qe(e.data)}else Q.error(e.message||"Failed to adjust stock")}catch(e){Q.error("Failed to adjust stock")}finally{Me(!1)}}else Q.error("Please fill all fields")})()},loading:Ue}),Xe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[85vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{size:20,className:"text-gray-700"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Assign Storage"})]}),e.jsx("button",{onClick:()=>es(!1),className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(i,{size:20,className:"text-gray-500"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(85vh-140px)]",children:e.jsx($e,{formData:ss,setFormData:ts,currentErrors:{}})}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:()=>es(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(ss.storageRoomId&&ss.shelfId){rs(!0);try{const{error:e}=await a.from("lats_products").update({storage_room_id:ss.storageRoomId,shelf_id:ss.shelfId,updated_at:(new Date).toISOString()}).eq("id",o.id);if(e)throw e;qe({...Ie,storageRoomId:ss.storageRoomId,shelfId:ss.shelfId}),Q.success("Storage location updated!"),es(!1),window.dispatchEvent(new CustomEvent("productDataUpdated",{detail:{updatedProducts:[o.id]}}))}catch(e){Q.error("Failed to update storage location")}finally{rs(!1)}}else Q.error("Please select both storage room and shelf")},disabled:as,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:as?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:16,strokeWidth:2,color:"white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{size:16}),"Save"]})})]})]})})]})})]}),document.body)};export{Oe as E,Fe as P,$e as S,Ue as a};
