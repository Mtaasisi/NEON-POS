import{j as t,s as e}from"./index-222cfb29.js";import{a,u as r}from"./routing-a2f0f6d2.js";import{i as n,am as i,H as s,bK as o,x as c,bO as l,U as d}from"./ui-551a39a6.js";const u=({children:e,title:u,showBackButton:m=!1,showBottomNav:p=!0})=>{const _=a(),y=r(),g=[{icon:s,label:"Home",path:"/customer-portal/dashboard"},{icon:o,label:"Shop",path:"/customer-portal/products"},{icon:c,label:"Orders",path:"/customer-portal/orders"},{icon:l,label:"Rewards",path:"/customer-portal/loyalty"},{icon:d,label:"Profile",path:"/customer-portal/profile"}];return t.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[t.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:t.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[m?t.jsx("button",{onClick:()=>_(-1),className:"p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors",children:t.jsx(n,{size:20,className:"text-gray-700"})}):t.jsx("div",{className:"w-8"}),u&&t.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate flex-1 text-center",children:u}),t.jsxs("button",{onClick:()=>_("/customer-portal/notifications"),className:"p-2 -mr-2 hover:bg-gray-100 rounded-full transition-colors relative",children:[t.jsx(i,{size:20,className:"text-gray-700"}),t.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]})]})}),t.jsx("main",{className:"flex-1 overflow-y-auto pb-20",children:e}),p&&t.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50",children:t.jsx("div",{className:"flex items-center justify-around px-2 py-2",children:g.map(e=>{const a=e.icon,r=(n=e.path,y.pathname===n);var n;return t.jsxs("button",{onClick:()=>_(e.path),className:"flex flex-col items-center justify-center flex-1 py-2 px-1 rounded-lg transition-colors "+(r?"text-blue-600":"text-gray-600 hover:bg-gray-50"),children:[t.jsx(a,{size:22,strokeWidth:r?2.5:2}),t.jsx("span",{className:"text-xs mt-1 font-medium "+(r?"font-semibold":""),children:e.label})]},e.path)})})})]})};const m=new class{async getCustomerByPhone(t){try{const{data:a,error:r}=await e.from("customers").select("*").eq("phone",t).eq("is_active",!0).single();return r?null:a}catch(a){return null}}async getCustomerById(t){try{const{data:a,error:r}=await e.from("customers").select("*").eq("id",t).single();return r?null:a}catch(a){return null}}async updateCustomerProfile(t,a){try{const{data:r,error:n}=await e.from("lats_customers").update({...a,updated_at:(new Date).toISOString()}).eq("id",t).select().single();return n?{success:!1,error:n.message}:{success:!0,data:r}}catch(r){return{success:!1,error:"Failed to update profile"}}}async getProducts(t){try{let a=e.from("lats_products").select("\n          id, \n          name, \n          description, \n          image_url, \n          created_at, \n          is_active,\n          category_id,\n          brand,\n          category:lats_categories!category_id(name)\n        ");a=a.eq("is_active",!0),(null==t?void 0:t.search)&&(a=a.or(`name.ilike.%${t.search}%,description.ilike.%${t.search}%`)),(null==t?void 0:t.category)&&(a=a.eq("category.name",t.category)),(null==t?void 0:t.brand)&&(a=a.eq("brand",t.brand)),a=a.order("created_at",{ascending:!1});const{data:r,error:n}=await a;if(n)throw n;if(!r||0===r.length)return[];const i=r.map(t=>t.id);let s=[];const{data:o,error:c}=await e.from("lats_variants").select("id, product_id, variant_name, unit_price, compare_at_price, total_quantity, is_parent, variant_type, parent_variant_id").in("product_id",i);if(!c&&o&&o.length>0)s=o.filter(t=>!t.parent_variant_id||t.is_parent);else{const{data:t,error:a}=await e.from("lats_product_variants").select("id, product_id, variant_name, selling_price, cost_price, stock_quantity, quantity, is_parent, variant_type, parent_variant_id").in("product_id",i);a||t&&t.length>0&&(s=t.filter(t=>!t.parent_variant_id||t.is_parent))}s.length;const l=s.reduce((t,e)=>(t[e.product_id]||(t[e.product_id]=[]),t[e.product_id].push(e),t),{});return r.map(t=>{var e;const a=l[t.id]||[],r=a.map(t=>t.unit_price||t.selling_price||0).filter(t=>t>0),n=r.length>0?Math.min(...r):0,i=a.reduce((t,e)=>t+(e.total_quantity||e.quantity||e.stock_quantity||0),0);return{id:t.id,name:t.name,description:t.description,price:n,category:(null==(e=t.category)?void 0:e.name)||"Uncategorized",brand:t.brand||"Generic",imageUrl:t.image_url,images:t.image_url?[t.image_url]:[],inStock:i>0,stockQuantity:i,specifications:{},variants:a.map(t=>({id:t.id,name:t.variant_name,price:t.unit_price||t.selling_price||0,compareAtPrice:t.compare_at_price||t.cost_price,inStock:(t.total_quantity||t.quantity||t.stock_quantity||0)>0,stockQuantity:t.total_quantity||t.quantity||t.stock_quantity||0})),rating:2*Math.random()+3,reviewCount:Math.floor(100*Math.random())}})}catch(a){throw a}}async getProductById(t){var a;try{const{data:r,error:n}=await e.from("lats_products").select("\n          id, \n          name, \n          description, \n          image_url, \n          created_at, \n          is_active,\n          category_id,\n          brand,\n          category:lats_categories!category_id(name)\n        ").eq("id",t).eq("is_active",!0).single();if(n)return null;if(!r)return null;let i=[];const{data:s,error:o}=await e.from("lats_variants").select("id, variant_name, unit_price, compare_at_price, total_quantity, is_parent, parent_variant_id").eq("product_id",t);if(!o&&s&&s.length>0)i=s.filter(t=>!t.parent_variant_id||t.is_parent);else{const{data:a,error:r}=await e.from("lats_product_variants").select("id, variant_name, selling_price, cost_price, stock_quantity, quantity, is_parent, parent_variant_id").eq("product_id",t);!r&&a&&(i=a.filter(t=>!t.parent_variant_id||t.is_parent))}const c=i.map(t=>t.unit_price||t.selling_price||0).filter(t=>t>0),l=c.length>0?Math.min(...c):0,d=i.reduce((t,e)=>t+(e.total_quantity||e.quantity||e.stock_quantity||0),0);return{id:r.id,name:r.name,description:r.description,price:l,category:(null==(a=r.category)?void 0:a.name)||"Uncategorized",brand:r.brand||"Generic",imageUrl:r.image_url,images:r.image_url?[r.image_url]:[],inStock:d>0,stockQuantity:d,specifications:{},variants:i.map(t=>({id:t.id,name:t.variant_name,price:t.unit_price||t.selling_price||0,compareAtPrice:t.compare_at_price||t.cost_price,inStock:(t.total_quantity||t.quantity||t.stock_quantity||0)>0,stockQuantity:t.total_quantity||t.quantity||t.stock_quantity||0})),rating:2*Math.random()+3,reviewCount:Math.floor(100*Math.random())}}catch(r){return null}}async getCustomerOrders(t){try{const{data:a,error:r}=await e.from("lats_sales").select("\n          id,\n          sale_number,\n          customer_id,\n          total_amount,\n          payment_method,\n          status,\n          created_at,\n          lats_sale_items (\n            id,\n            product_name,\n            variant_name,\n            quantity,\n            unit_price,\n            total_price,\n            image_url\n          )\n        ").eq("customer_id",t).order("created_at",{ascending:!1});if(r)return[];return(a||[]).map(t=>({id:t.id,orderNumber:t.sale_number,date:t.created_at,totalAmount:t.total_amount,status:this.mapSaleStatus(t.status),paymentMethod:this.getPaymentMethodDisplay(t.payment_method),items:(t.lats_sale_items||[]).map(t=>({id:t.id,productName:t.product_name,variantName:t.variant_name,quantity:t.quantity,unitPrice:t.unit_price,totalPrice:t.total_price,imageUrl:t.image_url}))}))}catch(a){return[]}}async getCustomerDevices(t){try{const{data:a,error:r}=await e.from("devices").select("*").eq("customer_id",t).order("intake_date",{ascending:!1});return r?[]:a||[]}catch(a){return[]}}async getCategories(){try{const{data:t,error:a}=await e.from("lats_products").select("category").eq("is_active",!0).not("category","is",null);if(a)return[];return[...new Set((t||[]).map(t=>t.category).filter(Boolean))]}catch(t){return[]}}async getBrands(){try{const{data:t,error:a}=await e.from("lats_products").select("brand").eq("is_active",!0).not("brand","is",null);if(a)return[];return[...new Set((t||[]).map(t=>t.brand).filter(Boolean))]}catch(t){return[]}}mapSaleStatus(t){switch(null==t?void 0:t.toLowerCase()){case"completed":default:return"completed";case"pending":return"pending";case"processing":return"processing";case"cancelled":return"cancelled"}}getPaymentMethodDisplay(t){return"string"==typeof t?t:"object"==typeof t&&null!==t&&(t.method||t.type)||"Cash"}};export{u as M,m as c};
