import{u as e,j as t,q as s,s as a,F as r,a7 as l,v as i,az as n}from"./index-222cfb29.js";import{r as c}from"./vendor-a2ff445a.js";import{P as d}from"./PageErrorWrapper-024e3cfe.js";import{u as o}from"./useErrorHandler-ea2ee44d.js";import{l as m}from"./userSettingsApi-39de17fd.js";import{g as x,a as g,i as u,b as h,c as p,d as f}from"./roleBasedWidgets-3988ddf5.js";import{u as y,b as j,ay as b,az as N,am as v,E as w,f as S,t as _,Q as k,U as C,x as T,e as D,D as $,aA as A,ah as M,bu as z,ax as F,a6 as E,_ as I,d as L,n as R,av as O,b7 as W,aV as P,a4 as B,b5 as V,m as q,A as K,bO as U,ag as G,ar as H,p as Q,V as Z,s as Y,a7 as J,bK as X,b4 as ee,X as te,z as se,R as ae,o as re,ab as le,aB as ie,T as ne,Z as ce,a5 as de,aa as oe,y as me,a1 as xe,ai as ge,aj as ue,a0 as he,bf as pe,a8 as fe,aC as ye,v as je}from"./ui-551a39a6.js";import{d as be}from"./dashboardService-33c47c64.js";import{a as Ne}from"./routing-a2f0f6d2.js";import{r as ve}from"./reminderApi-01c80b0e.js";import{EnhancedReminderModal as we}from"./RemindersPage-bd00f085.js";import{_ as Se}from"./supabase-7e851d02.js";import{R as _e,A as ke,C as Ce,X as Te,Y as De,T as $e,e as Ae,P as Me,b as ze,c as Fe,B as Ee,a as Ie,L as Le,d as Re,l as Oe}from"./charts-66cc82bb.js";import{A as We}from"./AppointmentModal-4524caae.js";import{c as Pe}from"./appointments-4d8aac45.js";import"./PageErrorBoundary-d0d559c5.js";import"./ErrorState-0516fc54.js";import"./BackButton-e41d1482.js";import"./useSuccessModal-e8b7d685.js";import"./useBodyScrollLock-0216d39f.js";import"./SuccessModalIcons-20b743c5.js";const Be={quickActions:{devices:!0,addDevice:!0,customers:!0,inventory:!0,appointments:!0,purchaseOrders:!0,payments:!0,adGenerator:!0,pos:!0,reports:!0,employees:!0,whatsapp:!0,settings:!0,search:!0,loyalty:!0,backup:!0,sms:!0,bulkSms:!0,smsLogs:!0,smsSettings:!0,excelImport:!0,excelTemplates:!0,productExport:!0,customerImport:!0,userManagement:!0,databaseSetup:!0,integrationSettings:!0,integrationsTest:!0,aiTraining:!0,bluetoothPrinter:!0,categoryManagement:!0,supplierManagement:!0,storeLocations:!0,reminders:!0,mobile:!0,myAttendance:!0},widgets:{revenueTrendChart:!0,deviceStatusChart:!0,appointmentsTrendChart:!0,stockLevelChart:!0,performanceMetricsChart:!0,customerActivityChart:!0,salesFunnelChart:!0,purchaseOrderChart:!0,appointmentWidget:!0,employeeWidget:!0,notificationWidget:!0,financialWidget:!0,analyticsWidget:!0,serviceWidget:!0,reminderWidget:!0,customerInsightsWidget:!0,systemHealthWidget:!0,inventoryWidget:!0,activityFeedWidget:!0,purchaseOrderWidget:!0,chatWidget:!0,salesWidget:!0,topProductsWidget:!0,expensesWidget:!0,staffPerformanceWidget:!0,salesChart:!0,paymentMethodsChart:!0,salesByCategoryChart:!0,profitMarginChart:!0},autoArrange:!1};function Ve(){const{currentUser:t}=e(),[s,a]=c.useState(Be),[r,l]=c.useState(!0),[i,n]=c.useState(0),d=async()=>{if(null==t?void 0:t.id)try{l(!0);const e=await m(t.id),s=x(t.role),r=g(t.role),i={quickActions:{...Be.quickActions,...r},widgets:{...Be.widgets,...s}};if(null==e?void 0:e.dashboard){const t={quickActions:Object.keys(i.quickActions).reduce((t,s)=>{const a=s;return t[a]=i.quickActions[a]&&(e.dashboard.quickActions[a]??!0),t},{}),widgets:Object.keys(i.widgets).reduce((t,s)=>{const a=s;return t[a]=i.widgets[a]&&(e.dashboard.widgets[a]??!0),t},{}),widgetSizes:e.dashboard.widgetSizes||{},autoArrange:e.dashboard.autoArrange??!1};a(t)}else a(i)}catch(e){if(null==t?void 0:t.role){const e=x(t.role),s=g(t.role);a({quickActions:{...Be.quickActions,...s},widgets:{...Be.widgets,...e}})}else a(Be)}finally{l(!1)}else l(!1)};c.useEffect(()=>{d()},[null==t?void 0:t.id,i]),c.useEffect(()=>{const e=()=>{n(e=>e+1)};return window.addEventListener("dashboardSettingsChanged",e),()=>{window.removeEventListener("dashboardSettingsChanged",e)}},[]);const o=e=>{var t;return(null==(t=s.widgetSizes)?void 0:t[e])||"medium"};return{dashboardSettings:s,loading:r,isQuickActionEnabled:e=>{if(!(null==t?void 0:t.role))return!1;return!!u(e,t.role)&&s.quickActions[e]},isWidgetEnabled:e=>{if(!(null==t?void 0:t.role))return!1;return!!h(e,t.role)&&s.widgets[e]},getEnabledQuickActions:()=>Object.entries(s.quickActions).filter(([e,t])=>t).map(([e])=>e),getEnabledWidgets:()=>Object.entries(s.widgets).filter(([e,t])=>t).map(([e])=>e),refreshSettings:()=>{d()},getWidgetSize:o,getWidgetColumnSpan:e=>{switch(o(e)){case"small":return 1;case"medium":default:return 2;case"large":return 3}},getAutoArrange:()=>s.autoArrange??!1}}function qe(e,t=3){const s=e.filter(e=>e.enabled);if(0===s.length)return{gridTemplateColumns:`repeat(${t}, 1fr)`,widgets:[]};const a=s.reduce((e,t)=>e+t.columnSpan,0);if(a===t)return{gridTemplateColumns:`repeat(${t}, 1fr)`,widgets:s.map(e=>({key:e.key,gridColumn:`span ${e.columnSpan}`}))};if(a<t){return function(e,t,s){const a={gridTemplateColumns:`repeat(${t}, 1fr)`,widgets:[]};if(1===e.length)return a.widgets.push({key:e[0].key,gridColumn:`span ${t}`,expanded:e[0].columnSpan<t}),a;for(let r=0;r<e.length;r++){const t=e[r];if(r===e.length-1&&s>0){const e=t.columnSpan+s;a.widgets.push({key:t.key,gridColumn:`span ${e}`,expanded:!0})}else a.widgets.push({key:t.key,gridColumn:`span ${t.columnSpan}`,expanded:!1})}return a}(s,t,t-a)}if(a>t){const e=[];let a=[],r=0;const l=[...s].sort((e,t)=>void 0!==e.priority&&void 0!==t.priority?t.priority-e.priority:e.columnSpan-t.columnSpan);for(const s of l)r+s.columnSpan<=t?(a.push(s),r+=s.columnSpan):(a.length>0&&e.push([...a]),a=[s],r=s.columnSpan);a.length>0&&e.push(a);return{gridTemplateColumns:`repeat(${t}, 1fr)`,widgets:(e[0]||[]).map(e=>({key:e.key,gridColumn:`span ${e.columnSpan}`}))}}return{gridTemplateColumns:`repeat(${t}, 1fr)`,widgets:s.map(e=>({key:e.key,gridColumn:`span ${e.columnSpan}`}))}}function Ke(e){return{appointmentWidget:10,notificationWidget:9,salesWidget:8,financialWidget:7,customerInsightsWidget:6,employeeWidget:5,serviceWidget:4,inventoryWidget:3,systemHealthWidget:2,reminderWidget:1,chatWidget:1,activityFeedWidget:1,revenueTrendChart:5,salesChart:5,deviceStatusChart:4,appointmentsTrendChart:4,purchaseOrderChart:3,paymentMethodsChart:3,salesByCategoryChart:3,profitMarginChart:3,performanceMetricsChart:4,customerActivityChart:4,salesFunnelChart:3,analyticsWidget:2,topProductsWidget:2,expensesWidget:2,purchaseOrderWidget:2,staffPerformanceWidget:1}[e]||0}function Ue(){const{isWidgetEnabled:e,getWidgetColumnSpan:t,getAutoArrange:s}=Ve();return{createSmartLayout:(s,a=3)=>qe(s.map(s=>({key:s,enabled:e(s),columnSpan:t(s),priority:Ke(s)})),a),createResponsiveLayout:(s,a="lg")=>function(e,t="lg"){return qe(e,{sm:1,md:2,lg:3,xl:4}[t])}(s.map(s=>({key:s,enabled:e(s),columnSpan:t(s),priority:Ke(s)})),a),autoArrangeWidgets:a=>{const r=a.filter(t=>e(t)),l=s();if(0===r.length)return{gridTemplateColumns:"repeat(3, 1fr)",widgets:[]};const i=r.reduce((e,s)=>e+t(s),0);if(l&&i<3){const e=3-i,s=[];if(1===r.length)s.push({key:r[0],gridColumn:"span 3",expanded:t(r[0])<3});else for(let a=0;a<r.length;a++){const l=r[a],i=t(l);if(a===r.length-1&&e>0){const t=i+e;s.push({key:l,gridColumn:`span ${t}`,expanded:!0})}else s.push({key:l,gridColumn:`span ${i}`,expanded:!1})}return{gridTemplateColumns:"repeat(3, 1fr)",widgets:s}}return{gridTemplateColumns:"repeat(3, 1fr)",widgets:r.map(e=>({key:e,gridColumn:`span ${t(e)}`,expanded:!1}))}}}}const Ge=[{value:"7days",label:"Last 7 Days"},{value:"1month",label:"Last Month"},{value:"3months",label:"Last 3 Months"},{value:"6months",label:"Last 6 Months"},{value:"custom",label:"Custom Range"}],He=({value:e,onChange:s,className:a=""})=>{const[r,l]=c.useState(!1),[i,n]=c.useState(!1),[d,o]=c.useState(""),[m,x]=c.useState(""),g=t=>{"custom"===t?n(!0):(n(!1),s((t=>{const s=new Date,a=new Date;switch(t){case"7days":a.setDate(s.getDate()-7);break;case"1month":a.setMonth(s.getMonth()-1);break;case"3months":a.setMonth(s.getMonth()-3);break;case"6months":a.setMonth(s.getMonth()-6);break;case"custom":return e}return{startDate:a,endDate:s,preset:t}})(t)),l(!1))};return t.jsxs("div",{className:`relative ${a}`,children:[t.jsxs("button",{onClick:()=>l(!r),className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[t.jsx(y,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:(u=e,"custom"===u.preset?`${u.startDate.toLocaleDateString()} - ${u.endDate.toLocaleDateString()}`:(null==(h=Ge.find(e=>e.value===u.preset))?void 0:h.label)||"Select Range")}),t.jsx(j,{className:"w-4 h-4 text-gray-600 transition-transform "+(r?"rotate-180":"")})]}),r&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>{l(!1),n(!1)}}),t.jsx("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:i?t.jsxs("div",{className:"p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Custom Date Range"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Date"}),t.jsx("input",{type:"date",value:d,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Date"}),t.jsx("input",{type:"date",value:m,onChange:e=>x(e.target.value),min:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsx("button",{onClick:()=>n(!1),className:"flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),t.jsx("button",{onClick:()=>{d&&m&&(s({startDate:new Date(d),endDate:new Date(m),preset:"custom"}),n(!1),l(!1))},disabled:!d||!m,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Apply"})]})]})]}):t.jsx("div",{className:"p-2",children:Ge.map(s=>t.jsx("button",{onClick:()=>g(s.value),className:"w-full text-left px-3 py-2 rounded-md hover:bg-gray-100 transition-colors "+(e.preset===s.value?"bg-indigo-50 text-indigo-600 font-medium":"text-gray-700"),children:s.label},s.value))})})]})]});var u,h},Qe=({onBranchChange:e,defaultToCurrent:l=!0,className:i=""})=>{const{isDark:n}=s(),[d,o]=c.useState([]),[m,x]=c.useState(null),[g,u]=c.useState(!1),[h,p]=c.useState(!0);c.useEffect(()=>{f()},[]);const f=async()=>{try{p(!0);const{data:t,error:s}=await a.from("store_locations").select("id, name, code, city, is_main").eq("is_active",!0).order("is_main",{ascending:!1}).order("name",{ascending:!0});if(s)throw s;if(o(t||[]),l){const t=r();x(t),e(t)}else x(null),e(null)}catch(t){}finally{p(!1)}},y=t=>{x(t),e(t),u(!1)};return h?t.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg border ${n?"bg-slate-800 border-slate-700":"bg-white border-slate-200"} ${i}`,children:[t.jsx(b,{className:"w-5 h-5 text-slate-400"}),t.jsx("span",{className:"text-sm",children:"Loading..."})]}):t.jsxs("div",{className:`relative ${i}`,children:[t.jsxs("button",{onClick:()=>u(!g),className:"flex items-center gap-2 px-4 py-2 rounded-lg border transition-all "+(n?"bg-slate-800 border-slate-700 text-slate-200 hover:bg-slate-700":"bg-white border-slate-200 text-slate-700 hover:bg-slate-50"),children:[t.jsx(b,{className:"w-5 h-5"}),t.jsx("span",{className:"text-sm font-medium",children:(()=>{if(!m)return"All Branches";const e=d.find(e=>e.id===m);return e?`${e.name} ${e.code?`(${e.code})`:""}`:"Select Branch"})()}),t.jsx(j,{className:"w-4 h-4 transition-transform "+(g?"rotate-180":"")})]}),g&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)}),t.jsxs("div",{className:"absolute right-0 top-full mt-2 w-64 rounded-lg border shadow-lg z-50 max-h-96 overflow-y-auto "+(n?"bg-slate-800 border-slate-700":"bg-white border-slate-200"),children:[t.jsxs("button",{onClick:()=>y(null),className:"w-full flex items-center justify-between px-4 py-3 text-left transition-colors "+(null===m?n?"bg-indigo-900/30 text-indigo-300":"bg-indigo-50 text-indigo-700":n?"hover:bg-slate-700 text-slate-200":"hover:bg-slate-50 text-slate-700"),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(b,{className:"w-5 h-5"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm",children:"All Branches"}),t.jsx("div",{className:"text-xs "+(null===m?"text-indigo-400":"text-slate-500"),children:"View combined data from all locations"})]})]}),null===m&&t.jsx(N,{className:"w-5 h-5 text-indigo-500"})]}),t.jsx("div",{className:"border-t "+(n?"border-slate-700":"border-slate-200")}),d.map(e=>t.jsxs("button",{onClick:()=>y(e.id),className:"w-full flex items-center justify-between px-4 py-3 text-left transition-colors "+(m===e.id?n?"bg-indigo-900/30 text-indigo-300":"bg-indigo-50 text-indigo-700":n?"hover:bg-slate-700 text-slate-200":"hover:bg-slate-50 text-slate-700"),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(b,{className:"w-5 h-5"}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-sm",children:[e.name,e.is_main&&t.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded "+(n?"bg-yellow-900/30 text-yellow-400":"bg-yellow-100 text-yellow-700"),children:"Main"})]}),t.jsxs("div",{className:"text-xs "+(m===e.id?"text-indigo-400":"text-slate-500"),children:[e.code&&`${e.code} • `,e.city||"Location"]})]})]}),m===e.id&&t.jsx(N,{className:"w-5 h-5 text-indigo-500"})]},e.id))]})]})]})},Ze=c.createContext(void 0),Ye=({children:e})=>{const[s,a]=c.useState(()=>r()),l=null===s;return t.jsx(Ze.Provider,{value:{dashboardBranchId:s,setDashboardBranchId:e=>{a(e)},isViewingAllBranches:l},children:e})},Je=({className:s})=>{const{currentUser:a}=e(),r=Ne(),[l,i]=c.useState([]),[n,d]=c.useState(0),[o,m]=c.useState(!0);c.useEffect(()=>{(null==a?void 0:a.id)&&x()},[null==a?void 0:a.id]);const x=async()=>{if(null==a?void 0:a.id)try{m(!0);const[e,t]=await Promise.all([be.getRecentNotifications(a.id,5),be.getDashboardStats(a.id)]);i(e),d(t.unreadNotifications)}catch(e){}finally{m(!1)}},g=e=>{const t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/36e5);return a<1?"Just now":a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`};return o?t.jsx("div",{className:`bg-white rounded-2xl p-7 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(v,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Notifications"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:n>0?`${n} unread messages`:"All caught up"})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[n>0&&t.jsxs("div",{className:"px-3 py-1.5 rounded-full bg-rose-50 flex items-center gap-1.5",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-rose-500 animate-pulse"}),t.jsx("span",{className:"text-xs font-medium text-rose-500",children:n})]}),t.jsxs("button",{onClick:()=>r("/notifications"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Notifications",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]})]}),t.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:l.length>0?l.map(e=>t.jsx("div",{className:"p-4 rounded-lg transition-colors "+(e.isRead?"bg-gray-50 hover:bg-gray-100":"bg-blue-50 hover:bg-blue-100"),children:t.jsx("div",{className:"flex items-start gap-3",children:t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm truncate flex-1",children:e.title}),t.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium capitalize "+("urgent"===e.priority?"bg-rose-100 text-rose-600":"high"===e.priority?"bg-amber-100 text-amber-600":"bg-gray-100 text-gray-600"),children:e.priority})]}),t.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:e.message}),t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-400",children:[t.jsx(S,{size:12}),t.jsx("span",{children:g(e.createdAt)})]})]})})},e.id)):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(v,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No notifications yet"})]})})]})},Xe=({className:s})=>{const a=Ne(),{currentUser:r}=e(),[l,i]=c.useState([]),[n,d]=c.useState({present:0,total:0,onLeave:0,attendanceRate:0}),[o,m]=c.useState(!0);c.useEffect(()=>{x()},[]);const x=async()=>{try{m(!0);const[e,t]=await Promise.all([be.getTodayEmployeeStatus(),be.getDashboardStats((null==r?void 0:r.id)||"")]);i(e),d({present:t.presentToday,total:t.totalEmployees,onLeave:t.onLeaveToday,attendanceRate:t.attendanceRate})}catch(e){}finally{m(!1)}};return o?t.jsx("div",{className:`bg-white rounded-2xl p-7 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(_,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Staff Today"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[n.present,"/",n.total," present • ",n.attendanceRate,"%"]})]})]}),t.jsxs("button",{onClick:()=>a("/employees"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Employees",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Present"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.present})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"On Leave"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.onLeave})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Rate"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[n.attendanceRate,"%"]})]})]}),t.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:l.length>0?l.slice(0,5).map(e=>{var s;return t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"w-9 h-9 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"text-sm font-semibold text-gray-700",children:(null==(s=e.full_name)?void 0:s.split(" ").map(e=>e[0]).join(""))||"U"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:e.full_name||e.email}),t.jsx("p",{className:"text-xs text-gray-400",children:e.checkInTime?`Checked in at ${e.checkInTime}`:"No check-in"})]}),t.jsx("span",{className:"text-xs font-medium capitalize "+("present"===e.status?"text-emerald-600":"late"===e.status?"text-amber-600":"absent"===e.status?"text-rose-600":"text-gray-600"),children:e.status})]},e.id)}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(_,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No employee data"})]})}),t.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:t.jsxs("button",{onClick:()=>a("/employees/add"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"Add Employee"})]})})]})},et=({className:s})=>{const a=Ne(),{currentUser:r}=e(),[l,i]=c.useState([]),[n,d]=c.useState({today:0,upcoming:0,completionRate:0}),[o,m]=c.useState(!0);c.useEffect(()=>{x()},[]);const x=async()=>{try{m(!0);const[e,t]=await Promise.all([be.getTodayAppointments(4),be.getDashboardStats((null==r?void 0:r.id)||"")]);i(e),d({today:t.todayAppointments,upcoming:t.upcomingAppointments,completionRate:t.appointmentCompletionRate})}catch(e){}finally{m(!1)}},g=e=>{try{return new Date(`2000-01-01T${e}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return e}};return o?t.jsx("div",{className:`bg-white rounded-2xl p-7 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(y,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Today's Schedule"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[n.today," appointments • ",n.completionRate,"% done"]})]})]}),t.jsxs("button",{onClick:()=>a("/appointments"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Appointments",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Today"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.today})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Upcoming"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.upcoming})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Done"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[n.completionRate,"%"]})]})]}),t.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:l.length>0?l.map(e=>t.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[t.jsx(S,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-sm font-semibold text-gray-900",children:g(e.time)}),t.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium capitalize "+("confirmed"===e.status||"completed"===e.status?"bg-emerald-50 text-emerald-600":"in-progress"===e.status?"bg-blue-50 text-blue-600":"cancelled"===e.status?"bg-rose-50 text-rose-600":"bg-gray-100 text-gray-600"),children:e.status})]}),t.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:e.customerName}),t.jsx("p",{className:"text-xs text-gray-600 truncate",children:e.serviceName}),e.technicianName&&t.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[t.jsx(C,{size:12,className:"text-gray-400"}),t.jsx("span",{className:"text-xs text-gray-400",children:e.technicianName})]})]})})},e.id)):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(y,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No appointments today"})]})}),t.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:t.jsxs("button",{onClick:()=>a("/appointments/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"Add Appointment"})]})})]})},tt=({className:s})=>{const a=Ne(),{currentUser:r}=e(),[l,i]=c.useState([]),[n,d]=c.useState({lowStock:0,critical:0,total:0,value:0}),[o,m]=c.useState(!0);c.useEffect(()=>{x()},[]);const x=async()=>{try{m(!0);const[e,t]=await Promise.all([be.getInventoryAlerts(4),be.getDashboardStats((null==r?void 0:r.id)||"")]);i(e),d({lowStock:t.lowStockItems,critical:t.criticalStockAlerts,total:t.totalProducts,value:t.inventoryValue})}catch(e){}finally{m(!1)}};return o?t.jsx("div",{className:`bg-white rounded-2xl p-7 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(T,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Inventory Status"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[n.total," products tracked"]})]})]}),t.jsxs("button",{onClick:()=>a("/lats/inventory"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Products",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Critical"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.critical})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Low Stock"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.lowStock})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Value"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:(e=>{if(!e||isNaN(e)||e<0)return"TSh 0";const t="string"==typeof e?parseFloat(e):e;return t>=1e9?`TSh ${(t/1e9).toFixed(1)}B`:t>=1e6?`TSh ${(t/1e6).toFixed(1)}M`:t>=1e3?`TSh ${(t/1e3).toFixed(1)}K`:`TSh ${t.toLocaleString()}`})(n.value)})]})]}),t.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:l.length>0?l.map(e=>t.jsx("div",{className:`p-3 rounded-lg ${"out-of-stock"===e.alertLevel?"bg-rose-50":"critical"===e.alertLevel?"bg-amber-50":"bg-gray-50"} hover:opacity-80 transition-opacity`,children:t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:e.productName}),t.jsxs("div",{className:"flex items-center justify-between mt-1",children:[t.jsx("span",{className:"text-xs text-gray-500",children:e.category}),t.jsxs("span",{className:"text-xs font-medium "+("out-of-stock"===e.alertLevel?"text-rose-600":"critical"===e.alertLevel?"text-amber-600":"text-gray-600"),children:[e.currentStock,"/",e.minimumStock," units"]})]})]})})},e.id)):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(T,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"All stock levels normal"})]})}),t.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:t.jsxs("button",{onClick:()=>a("/lats/add-product"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"Add Product"})]})})]})},st=({className:e})=>{const s=Ne(),[a,r]=c.useState(null),[l,i]=c.useState(!0);c.useEffect(()=>{n()},[]);const n=async()=>{try{i(!0);const e=await be.getFinancialSummary();r(e)}catch(e){}finally{i(!1)}},d=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),o=e=>!e||isNaN(e)||e<0?"TSh 0":e>1e11?"TSh ??? (Check Data)":e>=1e9?`TSh ${(e/1e9).toFixed(1)}B`:e>=1e6?`TSh ${(e/1e6).toFixed(1)}M`:e>=1e3?`TSh ${(e/1e3).toFixed(1)}K`:d(e);return l?t.jsx("div",{className:`bg-white rounded-2xl p-7 ${e}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):a?t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${e}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx($,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Financial Overview"}),t.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.jsxs("p",{className:"text-xs text-gray-400",children:[o(a.monthlyRevenue)," this month"]}),0!==a.revenueGrowth&&t.jsxs("div",{className:"flex items-center gap-0.5 "+(a.revenueGrowth>0?"text-emerald-500":"text-rose-500"),children:[(m=a.revenueGrowth,m>0?t.jsx(M,{size:12}):m<0?t.jsx(z,{size:12}):null),t.jsxs("span",{className:"text-xs font-medium",children:[Math.abs(a.revenueGrowth),"%"]})]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[a.outstandingAmount>0&&t.jsx("div",{className:"px-3 py-1.5 rounded-full bg-amber-50",children:t.jsx("span",{className:"text-xs font-medium text-amber-600",children:o(a.outstandingAmount)})}),t.jsxs("button",{onClick:()=>s("/finance/payments"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Payments",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Today"}),t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:o(a.todayRevenue)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"This Week"}),t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:o(a.weeklyRevenue)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Payments"}),t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:a.completedPayments})]})]}),t.jsxs("div",{className:"space-y-2 mb-6 flex-grow max-h-64 overflow-y-auto",children:[t.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Payment Methods"}),a.paymentMethods.length>0?a.paymentMethods.map((e,s)=>{const a=(e=>{const t=[{bg:"bg-blue-50",hover:"hover:bg-blue-100",icon:"text-blue-500",text:"text-blue-900"},{bg:"bg-emerald-50",hover:"hover:bg-emerald-100",icon:"text-emerald-500",text:"text-emerald-900"},{bg:"bg-purple-50",hover:"hover:bg-purple-100",icon:"text-purple-500",text:"text-purple-900"},{bg:"bg-orange-50",hover:"hover:bg-orange-100",icon:"text-orange-500",text:"text-orange-900"},{bg:"bg-pink-50",hover:"hover:bg-pink-100",icon:"text-pink-500",text:"text-pink-900"},{bg:"bg-cyan-50",hover:"hover:bg-cyan-100",icon:"text-cyan-500",text:"text-cyan-900"},{bg:"bg-indigo-50",hover:"hover:bg-indigo-100",icon:"text-indigo-500",text:"text-indigo-900"},{bg:"bg-teal-50",hover:"hover:bg-teal-100",icon:"text-teal-500",text:"text-teal-900"}];return t[e%t.length]})(s);return t.jsxs("div",{className:`flex items-center justify-between p-3 ${a.bg} rounded-lg ${a.hover} transition-colors`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(A,{size:14,className:a.icon}),t.jsx("span",{className:`text-sm font-medium ${a.text} capitalize`,children:e.method})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:`text-sm font-semibold ${a.text}`,children:o(e.amount)}),t.jsxs("p",{className:"text-xs text-gray-500",children:[e.count," trans."]})]})]},s)}):t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-sm text-gray-500",children:"No payment data"})})]}),a.outstandingAmount>0&&t.jsx("div",{className:"mb-6 p-3 bg-amber-50 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{size:16,className:"text-amber-600"}),t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm font-medium text-amber-900",children:["Outstanding: ",d(a.outstandingAmount)]}),t.jsxs("p",{className:"text-xs text-amber-600",children:[a.pendingPayments," pending payments"]})]})]})})]}):t.jsx("div",{className:`bg-white rounded-2xl p-7 ${e}`,children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(D,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"Unable to load financial data"})]})});var m},at=({className:s})=>{const a=Ne();e();const{dateRange:r,getDateRangeForQuery:i}=l(),[n,d]=c.useState({revenueGrowth:0,customerGrowth:0,avgOrderValue:0,totalOrders:0,topPerformingServices:[]}),[o,m]=c.useState(!0);c.useEffect(()=>{x()},[r]);const x=async()=>{try{m(!0);const{startDate:e,endDate:t}=i(),s=await be.getAnalyticsData(e,t);d({revenueGrowth:s.revenueGrowth,customerGrowth:s.customerGrowth,avgOrderValue:s.averageOrderValue,totalOrders:s.completedToday,topPerformingServices:[]})}catch(e){}finally{m(!1)}};return o?t.jsx("div",{className:`bg-white rounded-2xl p-7 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(F,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Business Analytics"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Key performance indicators"})]})]}),t.jsxs("button",{onClick:()=>a("/lats/analytics"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Analytics",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(180px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},className:"mb-8",children:[t.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.revenueGrowth>0?t.jsx(M,{size:14,className:"text-emerald-500"}):n.revenueGrowth<0?t.jsx(z,{size:14,className:"text-rose-500"}):t.jsx(E,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Revenue Growth"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsxs("span",{className:"text-2xl font-semibold "+(n.revenueGrowth>0?"text-emerald-600":n.revenueGrowth<0?"text-rose-600":"text-gray-900"),children:[n.revenueGrowth>0?"+":"",n.revenueGrowth,"%"]})})]}),t.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.customerGrowth>0?t.jsx(M,{size:14,className:"text-emerald-500"}):n.customerGrowth<0?t.jsx(z,{size:14,className:"text-rose-500"}):t.jsx(_,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Customer Growth"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsxs("span",{className:"text-2xl font-semibold "+(n.customerGrowth>0?"text-emerald-600":n.customerGrowth<0?"text-rose-600":"text-gray-900"),children:[n.customerGrowth>0?"+":"",n.customerGrowth,"%"]})})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(150px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},className:"mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Avg Order Value"}),t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:(g=n.avgOrderValue,null==g||isNaN(g)?"TSh 0":g>=1e9?`TSh ${(g/1e9).toFixed(1)}B`:g>=1e6?`TSh ${(g/1e6).toFixed(1)}M`:g>=1e3?`TSh ${(g/1e3).toFixed(1)}K`:`TSh ${g.toLocaleString()}`)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Orders Today"}),t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:n.totalOrders??0})]})]}),n.topPerformingServices.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Popular Services"}),t.jsx("div",{className:"space-y-2",children:n.topPerformingServices.slice(0,3).map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"w-6 h-6 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"text-xs font-bold text-white",children:s+1})}),t.jsx("span",{className:"text-sm text-gray-900 truncate",children:e})]},s))})]})]});var g},rt=({className:s})=>{const l=Ne();e();const[i,n]=c.useState({activeServices:0,completedToday:0,completedThisWeek:0,inProgressServices:0,completionRate:0,avgCompletionTime:0,popularServices:[]}),[d,o]=c.useState(!0);c.useEffect(()=>{m()},[]);const m=async()=>{try{o(!0);const e=r();let t=a.from("devices").select("id, status, problem_description, created_at, updated_at, estimated_completion_date");e&&(t=t.eq("branch_id",e));const{data:s,error:l}=await t;if(l)throw l;const i=new Date,c=new Date(i.getFullYear(),i.getMonth(),i.getDate()),d=new Date(c);d.setDate(d.getDate()-d.getDay());const m=s||[],x=m.filter(e=>!["done","failed","repair-complete"].includes(e.status)).length,g=m.filter(e=>["done","repair-complete"].includes(e.status)&&new Date(e.updated_at)>=c).length,u=m.filter(e=>["done","repair-complete"].includes(e.status)&&new Date(e.updated_at)>=d).length,h=m.filter(e=>["diagnosis-started","in-repair","reassembled-testing"].includes(e.status)).length,p=new Date(i.getFullYear(),i.getMonth(),1),f=m.filter(e=>new Date(e.created_at)>=p),y=f.filter(e=>["done","repair-complete"].includes(e.status)).length,j=f.length>0?Math.round(y/f.length*100):0,b=m.filter(e=>["done","repair-complete"].includes(e.status)&&e.created_at&&e.updated_at);let N=0;if(b.length>0){const e=b.reduce((e,t)=>{const s=new Date(t.created_at).getTime();return e+(new Date(t.updated_at).getTime()-s)},0);N=Math.round(e/b.length/36e5)}const v={};m.forEach(e=>{if(e.problem_description){const t=e.problem_description.toLowerCase();t.includes("screen")||t.includes("display")?v["Screen Repair"]=(v["Screen Repair"]||0)+1:t.includes("battery")?v["Battery Replacement"]=(v["Battery Replacement"]||0)+1:t.includes("water")||t.includes("liquid")?v["Water Damage"]=(v["Water Damage"]||0)+1:t.includes("charge")||t.includes("charging")?v["Charging Issue"]=(v["Charging Issue"]||0)+1:t.includes("software")||t.includes("update")?v["Software Issue"]=(v["Software Issue"]||0)+1:v["General Repair"]=(v["General Repair"]||0)+1}});const w=Object.entries(v).map(([e,t])=>({name:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,5);n({activeServices:x,completedToday:g,completedThisWeek:u,inProgressServices:h,completionRate:j,avgCompletionTime:N,popularServices:w})}catch(e){}finally{o(!1)}};return d?t.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(I,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Service Tracking"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Repair & maintenance overview"})]})]}),t.jsxs("button",{onClick:()=>l("/devices"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Devices",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[t.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(S,{size:14,className:"text-blue-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Active Services"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:i.activeServices})})]}),t.jsxs("div",{className:"p-4 rounded-lg bg-emerald-50 hover:bg-emerald-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(L,{size:14,className:"text-emerald-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Completed Today"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:i.completedToday})})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"In Progress"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:i.inProgressServices}),t.jsx(D,{size:14,className:"text-orange-500"})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Completion Rate"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("p",{className:"text-xl font-semibold "+(x=i.completionRate,x>=80?"text-emerald-600":x>=60?"text-blue-600":x>=40?"text-orange-600":"text-rose-600"),children:[i.completionRate,"%"]}),i.completionRate>=70&&t.jsx(M,{size:14,className:"text-emerald-500"})]})]})]}),i.avgCompletionTime>0&&t.jsx("div",{className:"mb-6 p-3 rounded-lg bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Avg. Completion Time"}),t.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[i.avgCompletionTime,"h"]})]})}),i.popularServices.length>0&&t.jsxs("div",{className:"mb-6 flex-grow max-h-64 overflow-y-auto",children:[t.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Popular Service Types"}),t.jsx("div",{className:"space-y-2",children:i.popularServices.slice(0,4).map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[t.jsx("div",{className:"w-6 h-6 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"text-xs font-bold text-white",children:s+1})}),t.jsx("span",{className:"text-sm text-gray-900 truncate",children:e.name})]}),t.jsx("span",{className:"text-xs font-semibold text-gray-600 ml-2",children:e.count})]},s))})]}),t.jsx("div",{className:"mb-6 p-3 rounded-lg bg-blue-50 border border-blue-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Completed This Week"}),t.jsx("span",{className:"text-lg font-bold text-blue-600",children:i.completedThisWeek})]})}),t.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:t.jsxs("button",{onClick:()=>l("/devices/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"Add Service"})]})})]});var x},lt=({className:s})=>{const a=Ne(),{currentUser:r}=e(),{currentBranch:l}=i(),[n,d]=c.useState([]),[o,m]=c.useState(!0),[x,g]=c.useState(!1);c.useEffect(()=>{l&&u()},[l]);const u=async()=>{try{m(!0);const e=(await ve.getReminders(null==l?void 0:l.id)).filter(e=>"pending"===e.status).sort((e,t)=>{const s=new Date(`${e.date}T${e.time}`),a=new Date(`${t.date}T${t.time}`);return s.getTime()-a.getTime()}).slice(0,5);d(e)}catch(e){}finally{m(!1)}},h=e=>new Date(`${e.date}T${e.time}`)<new Date,p=e=>{const t=new Date,s=new Date(`${e.date}T${e.time}`).getTime()-t.getTime();if(s<0){const e=Math.abs(s),t=Math.floor(e/36e5);if(t>24){return`${Math.floor(t/24)}d overdue`}return`${t}h overdue`}const a=Math.floor(s/36e5);if(a>24){return`in ${Math.floor(a/24)}d`}if(a>0)return`in ${a}h`;return`in ${Math.floor(s/6e4)}m`},f=e=>{switch(e){case"high":return"bg-red-100 text-red-600";case"medium":return"bg-yellow-100 text-yellow-600";case"low":return"bg-green-100 text-green-600";default:return"bg-gray-100 text-gray-600"}},y=n.filter(h).length,j=n.filter(e=>!h(e)).length;return o?t.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(v,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Reminders"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:y>0?`${y} overdue`:"Stay on track"})]})]}),t.jsxs("button",{onClick:()=>a("/reminders"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Reminders",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[t.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(S,{size:14,className:"text-blue-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Upcoming"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:j})})]}),t.jsxs("div",{className:"p-4 rounded-lg bg-red-50 hover:bg-red-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(D,{size:14,className:"text-red-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Overdue"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:y})})]})]}),t.jsx("div",{className:"space-y-2 flex-grow mb-6 max-h-64 overflow-y-auto",children:0===n.length?t.jsxs("div",{className:"text-center py-6",children:[t.jsx(v,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),t.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"No upcoming reminders"}),t.jsxs("button",{onClick:()=>g(!0),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 mx-auto",children:[t.jsx(k,{size:16}),"Create reminder"]})]}):n.map(e=>t.jsx("div",{className:`\n                p-3 rounded-lg border transition-all group\n                ${h(e)?"bg-red-50 border-red-200 hover:border-red-300":"bg-gray-50 border-gray-200 hover:border-gray-300"}\n              `,children:t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{onClick:()=>a("/reminders"),className:"flex-1 min-w-0 cursor-pointer",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[h(e)&&t.jsx(D,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),t.jsx("h4",{className:"font-medium text-sm text-gray-900 truncate",children:e.title})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.jsx("span",{className:`px-2 py-0.5 rounded-full font-medium ${f(e.priority)}`,children:e.priority}),t.jsx("span",{className:""+(h(e)?"text-red-600 font-medium":"text-gray-500"),children:p(e)})]})]}),t.jsx("button",{onClick:t=>(async(e,t)=>{t.stopPropagation();try{await ve.updateReminder(e,{status:"completed"}),R.success("Reminder completed!"),u()}catch(s){R.error("Failed to complete reminder")}})(e.id,t),className:"relative w-8 h-8 rounded-full border-2 border-emerald-500 bg-emerald-500 hover:bg-emerald-600 hover:border-emerald-600 hover:scale-110 text-white transition-all duration-200 flex items-center justify-center flex-shrink-0 shadow-sm hover:shadow-md",title:"Mark as completed",children:t.jsx(N,{className:"w-4 h-4 transition-transform duration-200 hover:scale-105",strokeWidth:2.5})})]})},e.id))}),t.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:t.jsxs("button",{onClick:()=>g(!0),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"Add Reminder"})]})}),x&&t.jsx(we,{isOpen:x,onClose:()=>g(!1),onSuccess:()=>{g(!1),u(),R.success("Reminder created successfully!")},reminder:null,currentUser:r,branchId:null==l?void 0:l.id})]})},it=({className:e})=>{const s=Ne(),[r,l]=c.useState({database:"healthy",backup:"current",security:"secure",imageStorage:"normal",lastBackup:(new Date).toISOString(),responseTime:125,imageStorageSize:"0 KB",totalTables:0,totalRecords:0,largestTable:"-",largestTableSize:"0 KB",databaseSize:"0 MB",dataGrowthRate:"0 KB/day"}),[i,n]=c.useState(!0);c.useEffect(()=>{d();const e=setInterval(d,3e4);return()=>clearInterval(e)},[]);const d=async()=>{try{n(!0);const e=await o();l(e)}catch(e){}finally{n(!1)}},o=async()=>{try{const l=Date.now(),i=await m(),n=Date.now()-l,{data:{session:c}}=await a.auth.getSession(),d=c?"secure":"warning";let o=(new Date).toISOString(),x="current";try{const{data:e}=await a.from("lats_sales").select("created_at").order("created_at",{ascending:!1}).limit(1);if(e&&e.length>0){o=e[0].created_at;(Date.now()-new Date(o).getTime())/36e5>48&&(x="outdated")}}catch(e){}let g=0,u=0,h="-",p="0 KB",f="0 MB",y="0 KB/day";try{const e=[{name:"lats_sales",displayName:"Sales"},{name:"lats_products",displayName:"Products"},{name:"customers",displayName:"Customers"},{name:"product_images",displayName:"Images"},{name:"lats_sale_items",displayName:"Sale Items"},{name:"lats_stock_movements",displayName:"Stock Mvmt"},{name:"lats_purchase_orders",displayName:"POs"},{name:"employees",displayName:"Employees"}],s=await Promise.all(e.map(async e=>{try{const{count:t,error:s}=await a.from(e.name).select("id",{count:"exact",head:!0});return{name:e.name,displayName:e.displayName,count:s?0:t||0}}catch{return{name:e.name,displayName:e.displayName,count:0}}}));g=s.filter(e=>e.count>0).length,u=s.reduce((e,t)=>e+t.count,0);const r=[...s].sort((e,t)=>t.count-e.count);if(r.length>0&&r[0].count>0){h=r[0].displayName;const e=Math.round(2*r[0].count);p=e>1024?`${(e/1024).toFixed(1)} MB`:`${e} KB`}const l=2*u,i=l/1024;f=i>=1?`${i.toFixed(1)} MB`:`${l.toFixed(0)} KB`;const n=localStorage.getItem("db_size_history");if(n)try{const e=JSON.parse(n),t=Date.now()-864e5,s=e.filter(e=>e.timestamp>t);if(s.length>=2){const e=s[0],t=(s[s.length-1],(l-e.size)/s.length);y=t>1024?`${(t/1024).toFixed(1)} MB/day`:t>0?`${t.toFixed(0)} KB/day`:"0 KB/day"}}catch(t){localStorage.removeItem("db_size_history")}const c=n?JSON.parse(n):[];c.push({timestamp:Date.now(),size:l});const d=Date.now()-2592e6,o=c.filter(e=>e.timestamp>d);localStorage.setItem("db_size_history",JSON.stringify(o))}catch(s){}let j="normal",b=0,N="0 KB";try{const{data:e,error:t}=await a.from("product_images").select("image_url, thumbnail_url");if(!t&&e){b=e.length;const t=e.reduce((e,t)=>{var s,a;return e+((null==(s=t.image_url)?void 0:s.length)||0)+((null==(a=t.thumbnail_url)?void 0:a.length)||0)},0)/1024,s=t/1024;N=s>=1?`${s.toFixed(1)} MB`:`${t.toFixed(0)} KB`,s>100?j="critical":s>50&&(j="warning")}}catch(r){}return{database:i?n<1e3?"healthy":"slow":"critical",backup:x,security:d,imageStorage:j,lastBackup:o,responseTime:n,imageStorageSize:N,totalTables:g,totalRecords:u,largestTable:h,largestTableSize:p,databaseSize:f,dataGrowthRate:y}}catch(l){return{database:"critical",backup:"failed",security:"warning",imageStorage:"warning",lastBackup:(new Date).toISOString(),responseTime:0,imageStorageSize:"0 KB",totalTables:0,totalRecords:0,largestTable:"-",largestTableSize:"0 KB",databaseSize:"0 MB",dataGrowthRate:"0 KB/day"}}},m=async()=>{try{const{data:e,error:t}=await a.from("customers").select("id").limit(1);return!t}catch{return!0}},x=(()=>{const e=[r.database,r.backup,r.security,r.imageStorage];return e.some(e=>["critical","failed","offline","compromised"].includes(e))?{status:"critical",color:"red"}:e.some(e=>["slow","outdated","unstable","warning"].includes(e))?{status:"warning",color:"orange"}:{status:"healthy",color:"green"}})();if(i)return t.jsx("div",{className:`bg-white rounded-2xl p-7 ${e}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})});const g="green"===x.color?"text-emerald-500":"orange"===x.color?"text-amber-500":"text-rose-500",u="green"===x.color?"bg-emerald-50":"orange"===x.color?"bg-amber-50":"bg-rose-50";return t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${e}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(O,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"System Health"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Real-time monitoring"})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:`px-3 py-1.5 rounded-full ${u} flex items-center gap-1.5`,children:[t.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${g.replace("text-","bg-")} animate-pulse`}),t.jsx("span",{className:`text-xs font-medium ${g} capitalize`,children:x.status})]}),t.jsxs("button",{onClick:()=>s("/settings"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View Settings",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(120px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},className:"mb-8",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Response Time"}),t.jsxs("p",{className:"text-xl font-semibold text-gray-900",children:[r.responseTime,t.jsx("span",{className:"text-sm text-gray-400 ml-1",children:"ms"})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Total Records"}),t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:(h=r.totalRecords,h>=1e6?`${(h/1e6).toFixed(1)}M`:h>=1e3?`${(h/1e3).toFixed(1)}K`:h.toString())})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"DB Size"}),t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:r.databaseSize})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(200px, 100%), 1fr))",gap:"clamp(0.5rem, 1.5vw, 0.75rem)",gridAutoRows:"1fr"},className:"mb-6 flex-grow",children:[t.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(W,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Database"})]}),t.jsx("p",{className:"text-sm font-medium capitalize "+("healthy"===r.database?"text-emerald-600":"slow"===r.database?"text-amber-600":"text-rose-600"),children:r.database})]}),t.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(P,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Backup"})]}),t.jsx("p",{className:"text-sm font-medium capitalize "+("current"===r.backup?"text-emerald-600":"outdated"===r.backup?"text-amber-600":"text-rose-600"),children:r.backup})]}),t.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(B,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Security"})]}),t.jsx("p",{className:"text-sm font-medium capitalize "+("secure"===r.security?"text-emerald-600":"warning"===r.security?"text-amber-600":"text-rose-600"),children:r.security})]}),t.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(V,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Images"})]}),t.jsx("p",{className:"text-sm font-medium "+("normal"===r.imageStorage?"text-emerald-600":"warning"===r.imageStorage?"text-amber-600":"text-rose-600"),children:r.imageStorageSize})]}),t.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(W,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Active Tables"})]}),t.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.totalTables})]}),t.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(M,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Growth Rate"})]}),t.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.dataGrowthRate})]})]}),t.jsxs("div",{className:"space-y-3 mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 rounded-lg bg-gradient-to-r from-gray-50 to-transparent",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Largest table"}),t.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[r.largestTable," (",r.largestTableSize,")"]})]}),t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 rounded-lg bg-gradient-to-r from-gray-50 to-transparent",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Last backup completed"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:(e=>{const t=new Date(e),s=new Date,a=Math.floor((s.getTime()-t.getTime())/36e5);return a<1?"Just now":a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`})(r.lastBackup)})]})]}),t.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:t.jsxs("button",{onClick:d,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(O,{size:14}),t.jsx("span",{children:"Refresh"})]})})]});var h},nt=({className:e})=>{const s=Ne(),[a,r]=c.useState([]),[l,i]=c.useState(!0);c.useEffect(()=>{n();const e=setInterval(n,6e4);return()=>clearInterval(e)},[]);const n=async()=>{try{l&&i(!0);const e=await be.getRecentActivities(8);r(e)}catch(e){}finally{i(!1)}},d=e=>{const t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/6e4);return a<1?"Just now":a<60?`${a}m ago`:a<1440?`${Math.floor(a/60)}h ago`:`${Math.floor(a/1440)}d ago`};return l&&0===a.length?t.jsx("div",{className:`bg-white rounded-2xl p-7 ${e}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${e}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(O,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Recent Activity"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Live system activities"})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-emerald-50",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"}),t.jsx("span",{className:"text-xs text-emerald-600 font-medium",children:"Live"})]}),t.jsxs("button",{onClick:()=>s("/reports"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Reports",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]})]}),t.jsx("div",{className:"space-y-3 h-64 overflow-y-auto mb-6 flex-grow",children:a.length>0?a.map(e=>{return t.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:"device"===e.type?t.jsx(q,{size:14,className:"text-gray-700"}):"customer"===e.type?t.jsx(_,{size:14,className:"text-gray-700"}):"payment"===e.type?t.jsx(A,{size:14,className:"text-gray-700"}):"appointment"===e.type?t.jsx(y,{size:14,className:"text-gray-700"}):"inventory"===e.type?t.jsx(T,{size:14,className:"text-gray-700"}):t.jsx(O,{size:14,className:"text-gray-700"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:e.title}),"completed"===e.status&&t.jsx(L,{size:12,className:"text-emerald-600"}),"pending"===e.status&&t.jsx(S,{size:12,className:"text-amber-600"}),"failed"===e.status&&t.jsx(K,{size:12,className:"text-rose-600"})]}),t.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:e.description}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("span",{className:"text-xs text-gray-400",children:d(e.time)}),e.amount&&t.jsx("span",{className:"text-xs font-medium text-gray-900",children:(s=e.amount,new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(s))})]})]})]})},e.id);var s}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(O,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No recent activities"})]})})]})},ct=({className:e})=>{const s=Ne(),[a,r]=c.useState({totalCustomers:0,newThisMonth:0,loyaltyMembers:0,averageSatisfaction:0,topCustomers:[],satisfactionTrend:0,retentionRate:0}),[l,i]=c.useState(!0);c.useEffect(()=>{n()},[]);const n=async()=>{try{i(!0);const{supabase:e}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{getCurrentBranchId:t}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=t();let a=e.from("customers").select("id, name, total_spent, joined_date, points, is_active, last_visit");s&&(a=a.eq("branch_id",s));const{data:l,error:n}=await a;if(n)throw n;const c=l||[],d=new Date,o=new Date(d.getFullYear(),d.getMonth(),1),m=c.length,x=c.filter(e=>new Date(e.joined_date)>=o).length,g=c.filter(e=>(e.points||0)>0).length,u=4.5,h=c.filter(e=>e.total_spent&&e.total_spent>0).sort((e,t)=>(t.total_spent||0)-(e.total_spent||0)).slice(0,3).map(e=>({id:e.id,name:e.name,totalSpent:e.total_spent||0,loyaltyPoints:e.points||0,lastVisit:e.last_visit||e.joined_date})),p=c.filter(e=>(e.total_spent||0)>0&&e.is_active).length,f=m>0?Math.round(p/m*100):0;r({totalCustomers:m,newThisMonth:x,loyaltyMembers:g,averageSatisfaction:u,topCustomers:h,satisfactionTrend:8.5,retentionRate:f})}catch(e){}finally{i(!1)}},d=e=>{const t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/864e5);return 0===a?"Today":1===a?"Yesterday":`${a}d ago`},o=e=>e>=4.5?"text-green-600":e>=4?"text-yellow-600":"text-red-600";return l?t.jsx("div",{className:`bg-white rounded-2xl p-7 ${e}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${e}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(U,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Customer Insights"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[a.totalCustomers," customers • ",a.retentionRate,"% retention"]})]})]}),t.jsxs("button",{onClick:()=>s("/customers"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Customers",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"New"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.newThisMonth})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Loyalty"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.loyaltyMembers})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Retention"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[a.retentionRate,"%"]})]})]}),t.jsx("div",{className:"p-4 bg-gray-50 rounded-lg mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1.5",children:"Customer Satisfaction"}),(m=a.averageSatisfaction,t.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(e=>t.jsx(Q,{size:12,className:e<=m?"text-yellow-400 fill-current":"text-gray-300"},e)),t.jsx("span",{className:`text-sm font-medium ml-1 ${o(m)}`,children:m.toFixed(1)})]}))]}),t.jsxs("div",{className:"flex items-center gap-1 "+(a.satisfactionTrend>0?"text-emerald-600":"text-rose-600"),children:[t.jsx(M,{size:14}),t.jsxs("span",{className:"text-sm font-medium",children:[a.satisfactionTrend>0?"+":"",a.satisfactionTrend,"%"]})]})]})}),t.jsxs("div",{className:"space-y-3 mb-6 flex-grow",children:[t.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Top Customers"}),a.topCustomers.slice(0,3).map((e,s)=>{return t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-6 h-6 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"text-xs font-bold text-white",children:s+1})}),t.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"text-xs font-medium text-gray-700",children:e.name.split(" ").map(e=>e[0]).join("")})})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:e.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:[(a=e.totalSpent,new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(a))," spent"]}),t.jsx("span",{className:"text-xs text-gray-400",children:"•"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(G,{size:10,className:"text-gray-500"}),t.jsxs("span",{className:"text-xs text-gray-500",children:[e.loyaltyPoints," pts"]})]})]})]}),t.jsx("span",{className:"text-xs text-gray-400",children:d(e.lastVisit)})]},e.id);var a})]}),t.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:t.jsxs("button",{onClick:()=>s("/customers/loyalty"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(H,{size:14}),t.jsx("span",{children:"Loyalty Program"})]})})]});var m},dt=({className:s})=>{const l=Ne();e();const[i,n]=c.useState({pending:0,received:0,total:0,recentOrders:[]}),[d,o]=c.useState(!0);c.useEffect(()=>{m()},[]);const m=async()=>{try{o(!0);const e=r();let t=a.from("lats_purchase_orders").select("id, po_number, status, total_amount, created_at, supplier_id, currency, exchange_rate, total_amount_base_currency, payment_terms").order("created_at",{ascending:!1});e&&(t=t.eq("branch_id",e));const{data:s,error:l}=await t.limit(50);if(l)throw l;const i=s||[],c=i.map(e=>e.supplier_id).filter(Boolean),{data:d}=c.length>0?await a.from("lats_suppliers").select("id, name").in("id",c):{data:[]},m=new Map((null==d?void 0:d.map(e=>[e.id,e]))||[]),x=i.filter(e=>"pending"===e.status||"ordered"===e.status).length,g=i.filter(e=>"received"===e.status).length,u=i.slice(0,4).map(e=>{var t;return{id:e.id,orderNumber:e.po_number||"N/A",supplier:e.supplier_id&&(null==(t=m.get(e.supplier_id))?void 0:t.name)||"Unknown Supplier",status:e.status,totalAmount:e.total_amount||0,createdAt:e.created_at}});n({pending:x,received:g,total:i.length,recentOrders:u})}catch(e){}finally{o(!1)}},x=e=>{switch(e){case"received":return"bg-emerald-100 text-emerald-700";case"pending":case"ordered":return"bg-amber-100 text-amber-700";case"cancelled":return"bg-rose-100 text-rose-700";default:return"bg-gray-100 text-gray-700"}},g=e=>{switch(e){case"received":return t.jsx(L,{size:12,className:"text-emerald-600"});case"pending":case"ordered":return t.jsx(S,{size:12,className:"text-amber-600"});default:return t.jsx(D,{size:12,className:"text-gray-600"})}},u=e=>{const t=new Date(e),s=new Date,a=Math.abs(s.getTime()-t.getTime()),r=Math.ceil(a/864e5);return 0===r?"Today":1===r?"Yesterday":r<7?`${r}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return d?t.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:t.jsx(Z,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Purchase Orders"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[i.total," orders tracked"]})]})]}),t.jsxs("button",{onClick:()=>l("/lats/purchase-orders"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Purchase Orders",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[t.jsxs("div",{className:"p-4 rounded-lg bg-amber-50 hover:bg-amber-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(S,{size:14,className:"text-amber-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Pending"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:i.pending})})]}),t.jsxs("div",{className:"p-4 rounded-lg bg-emerald-50 hover:bg-emerald-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(L,{size:14,className:"text-emerald-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Received"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:i.received})})]})]}),t.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:i.recentOrders.length>0?i.recentOrders.map(e=>{return t.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>l(`/lats/purchase-orders/${e.id}`),children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(T,{size:14,className:"text-gray-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.orderNumber})]}),t.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${x(e.status)}`,children:[g(e.status),t.jsx("span",{className:"capitalize",children:e.status})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs text-gray-500 truncate",children:e.supplier}),t.jsxs("div",{className:"flex flex-col items-end gap-1",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-900",children:(s=e.totalAmount,new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(s))}),t.jsx("span",{className:"text-xs text-gray-400",children:u(e.createdAt)})]})]})]},e.id);var s}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(Z,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No purchase orders yet"})]})}),t.jsxs("div",{className:"flex gap-2 mt-auto pt-6",children:[t.jsxs("button",{onClick:()=>l("/lats/purchase-orders/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"Create Order"})]}),t.jsxs("button",{onClick:()=>l("/lats/purchase-orders"),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-100 text-sm text-gray-700 hover:bg-gray-200 transition-colors",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]})]})},ot=({className:s})=>{const r=Ne();e();const[l,i]=c.useState({unreadMessages:0,activeChats:0,totalMessages:0,recentChats:[]}),[n,d]=c.useState(!0);c.useEffect(()=>{o()},[]);const o=async()=>{try{d(!0);const{getCurrentBranchId:e}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),t=e();let s=a.from("customer_messages").select("\n          id,\n          customer_id,\n          message,\n          status,\n          created_at\n        ").order("created_at",{ascending:!1}).limit(50);t&&(s=s.eq("branch_id",t));const{data:r,error:l}=await s;if(l)throw l;const n=[...new Set((null==r?void 0:r.map(e=>e.customer_id))||[])],c=new Map;if(n.length>0){const{data:e}=await a.from("customers").select("id, name").in("id",n);null==e||e.forEach(e=>{c.set(e.id,e.name)})}const o=new Map;null==r||r.forEach(e=>{var t;const s=e.customer_id,a=c.get(s)||"Unknown Customer";if(!o.has(s)){const r=a.split(" "),l=r.length>=2?`${r[0][0]}${r[1][0]}`.toUpperCase():(null==(t=r[0])?void 0:t.substring(0,2).toUpperCase())||"U";o.set(s,{id:e.id,customerName:a,lastMessage:e.message,timestamp:e.created_at,unread:"read"!==e.status,customerInitials:l})}});const m=Array.from(o.values()).slice(0,4),x=m.filter(e=>e.unread).length,{count:g}=await a.from("customer_messages").select("*",{count:"exact",head:!0});i({unreadMessages:x,activeChats:o.size,totalMessages:g||0,recentChats:m})}catch(e){i({unreadMessages:0,activeChats:0,totalMessages:0,recentChats:[]})}finally{d(!1)}},m=e=>{const t=new Date(e),s=new Date,a=Math.abs(s.getTime()-t.getTime()),r=Math.floor(a/6e4),l=Math.floor(a/36e5),i=Math.floor(a/864e5);return r<1?"Just now":r<60?`${r}m ago`:l<24?`${l}h ago`:1===i?"Yesterday":i<7?`${i}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},x=e=>{const t=["bg-blue-500","bg-emerald-500","bg-purple-500","bg-orange-500","bg-pink-500","bg-indigo-500"];return t[e.charCodeAt(0)%t.length]};return n?t.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center relative",children:[t.jsx(Y,{className:"w-5 h-5 text-purple-600"}),l.unreadMessages>0&&t.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-xs font-bold text-white",children:l.unreadMessages})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Messages"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[l.activeChats," active conversations"]})]})]}),t.jsxs("button",{onClick:()=>r("/messages"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Messages",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[t.jsxs("div",{className:"p-4 rounded-lg bg-red-50 hover:bg-red-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Y,{size:14,className:"text-red-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Unread"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:l.unreadMessages})})]}),t.jsxs("div",{className:"p-4 rounded-lg bg-purple-50 hover:bg-purple-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(C,{size:14,className:"text-purple-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Active"})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:l.activeChats})})]})]}),t.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-6 flex-grow",children:l.recentChats.length>0?l.recentChats.map(e=>t.jsx("div",{className:"p-3 rounded-lg transition-colors cursor-pointer "+(e.unread?"bg-purple-50 hover:bg-purple-100":"bg-gray-50 hover:bg-gray-100"),onClick:()=>r(`/messages/${e.id}`),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded-full ${x(e.customerInitials)} flex items-center justify-center flex-shrink-0`,children:t.jsx("span",{className:"text-sm font-bold text-white",children:e.customerInitials})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-sm font-medium "+(e.unread?"text-gray-900":"text-gray-700"),children:e.customerName}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[t.jsx(S,{size:10}),t.jsx("span",{children:m(e.timestamp)})]})]}),t.jsx("p",{className:"text-xs truncate "+(e.unread?"text-gray-700 font-medium":"text-gray-500"),children:e.lastMessage})]})]})},e.id)):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(Y,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No messages yet"})]})}),t.jsxs("div",{className:"flex gap-2 mt-auto pt-6",children:[t.jsxs("button",{onClick:()=>r("/messages/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"New Message"})]}),t.jsxs("button",{onClick:()=>r("/messages"),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-100 text-sm text-gray-700 hover:bg-gray-200 transition-colors",children:[t.jsx(J,{size:14}),t.jsx("span",{children:"All Chats"})]})]})]})},mt=({className:s})=>{const l=Ne();e();const[i,n]=c.useState({todaySales:0,todayTransactions:0,averageTransaction:0,yesterdaySales:0,growth:0,recentTransactions:[]}),[d,o]=c.useState(!0);c.useEffect(()=>{m()},[]);const m=async()=>{try{o(!0);const e=r(),t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate());s.setHours(0,0,0,0);const l=new Date(s);l.setDate(l.getDate()+1);const i=new Date(s);i.setDate(i.getDate()-1);let c=a.from("lats_sales").select("id, total_amount, customer_name, created_at").gte("created_at",s.toISOString()).lt("created_at",l.toISOString()).order("created_at",{ascending:!1});e&&(c=c.eq("branch_id",e));const{data:d,error:m}=await c;if(m)throw m;let x=a.from("lats_sales").select("total_amount, created_at").gte("created_at",i.toISOString()).lt("created_at",s.toISOString());e&&(x=x.eq("branch_id",e));const{data:g,error:u}=await x;if(u)throw u;const h=d||[],p=h.reduce((e,t)=>{const s="string"==typeof t.total_amount?parseFloat(t.total_amount):t.total_amount;return e+(isNaN(s)?0:s)},0),f=(g||[]).reduce((e,t)=>{const s="string"==typeof t.total_amount?parseFloat(t.total_amount):t.total_amount;return e+(isNaN(s)?0:s)},0),y=h.length,j=y>0?p/y:0,b=f>0?(p-f)/f*100:0,N=h.slice(0,5).map(e=>({id:e.id,amount:"string"==typeof e.total_amount?parseFloat(e.total_amount):e.total_amount,customer:e.customer_name||"Walk-in Customer",time:new Date(e.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}));n({todaySales:p,todayTransactions:y,averageTransaction:j,yesterdaySales:f,growth:Math.round(10*b)/10,recentTransactions:N})}catch(e){}finally{o(!1)}},x=e=>e>=1e6?`TSh ${(e/1e6).toFixed(1)}M`:e>=1e3?`TSh ${(e/1e3).toFixed(0)}K`:`TSh ${e.toFixed(0)}`;return d?t.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center",children:t.jsx($,{className:"w-5 h-5 text-emerald-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Today's Sales"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[i.todayTransactions," transactions"]})]})]}),t.jsxs("button",{onClick:()=>l("/lats/sales"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Sales",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[t.jsx("span",{className:"text-3xl font-bold text-gray-900",children:x(i.todaySales)}),0!==i.growth&&t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold "+(i.growth>=0?"bg-emerald-50 text-emerald-600":"bg-rose-50 text-rose-600"),children:[t.jsx(M,{size:12,className:i.growth<0?"rotate-180":""}),t.jsxs("span",{children:[i.growth>=0?"+":"",i.growth,"%"]})]})]}),t.jsxs("p",{className:"text-xs text-gray-500",children:["vs yesterday: ",x(i.yesterdaySales)]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[t.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(X,{size:14,className:"text-blue-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Transactions"})]}),t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:i.todayTransactions})]}),t.jsxs("div",{className:"p-4 rounded-lg bg-purple-50 hover:bg-purple-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(A,{size:14,className:"text-purple-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Avg Sale"})]}),t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:x(i.averageTransaction)})]})]}),i.recentTransactions.length>0&&t.jsxs("div",{className:"mb-6 flex-grow max-h-48 overflow-y-auto",children:[t.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Recent Transactions"}),t.jsx("div",{className:"space-y-2",children:i.recentTransactions.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.customer}),t.jsx("p",{className:"text-xs text-gray-500",children:e.time})]}),t.jsx("span",{className:"text-sm font-semibold text-emerald-600 ml-2",children:x(e.amount)})]},e.id))})]}),t.jsxs("div",{className:"flex gap-2 mt-auto pt-6",children:[t.jsxs("button",{onClick:()=>l("/pos"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"New Sale"})]}),t.jsxs("button",{onClick:()=>l("/lats/sales"),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-100 text-sm text-gray-700 hover:bg-gray-200 transition-colors",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"All Sales"})]})]})]})},xt=({className:s})=>{const l=Ne();e();const[i,n]=c.useState([]),[d,o]=c.useState(!0),[m,x]=c.useState(0);c.useEffect(()=>{g()},[]);const g=async()=>{try{o(!0);const e=r(),t=new Date;t.setDate(t.getDate()-7);let s=a.from("lats_sales").select("id, created_at, branch_id").gte("created_at",t.toISOString());e&&(s=s.eq("branch_id",e));const{data:l,error:i}=await s;if(i)throw i;if(!l||0===l.length)return n([]),void x(0);const c=l.map(e=>e.id),{data:d,error:m}=await a.from("lats_sale_items").select("id, product_id, variant_id, quantity, unit_price, sale_id").in("sale_id",c);if(m)throw m;if(!d||0===d.length)return n([]),void x(0);const g=[...new Set(d.map(e=>e.product_id).filter(Boolean))],{data:u,error:h}=await a.from("lats_products").select("id, name, category").in("id",g);if(h)throw h;const p=new Map((u||[]).map(e=>[e.id,e])),f=new Map;let y=0;(d||[]).forEach(e=>{const t=p.get(e.product_id);if(!t)return;const s=e.product_id,a="string"==typeof e.unit_price?parseFloat(e.unit_price):e.unit_price,r=e.quantity||0,l=(a||0)*r;if(y+=l,f.has(s)){const e=f.get(s);e.quantitySold+=r,e.revenue+=l}else f.set(s,{id:s,name:t.name||"Unknown Product",quantitySold:r,revenue:l,category:t.category||"Uncategorized"})});const j=Array.from(f.values()).sort((e,t)=>t.revenue-e.revenue).slice(0,5);n(j),x(y)}catch(e){}finally{o(!1)}},u=e=>e>=1e6?`TSh ${(e/1e6).toFixed(1)}M`:e>=1e3?`TSh ${(e/1e3).toFixed(0)}K`:`TSh ${e.toFixed(0)}`;return d?t.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center",children:t.jsx(M,{className:"w-5 h-5 text-orange-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Top Products"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Last 7 days"})]})]}),t.jsxs("button",{onClick:()=>l("/lats/inventory"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View Products",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-gradient-to-br from-orange-50 to-red-50",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Revenue (Top 5)"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u(m)})]}),t.jsx("div",{className:"space-y-3 flex-grow max-h-72 overflow-y-auto mb-6",children:i.length>0?i.map((e,s)=>t.jsx("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 "+(0===s?"bg-yellow-500":1===s?"bg-gray-400":2===s?"bg-orange-600":"bg-gray-300"),children:t.jsxs("span",{className:"text-sm font-bold text-white",children:["#",s+1]})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:e.category}),t.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Z,{size:12,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs text-gray-600",children:[e.quantitySold," sold"]})]}),t.jsx("span",{className:"text-sm font-semibold text-orange-600",children:u(e.revenue)})]})]})]})},e.id)):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(T,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No sales data yet"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Start selling to see top products"})]})}),t.jsx("div",{className:"mt-auto pt-6",children:t.jsxs("button",{onClick:()=>l("/lats/inventory"),className:"w-full flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(T,{size:14}),t.jsx("span",{children:"View All Products"})]})})]})},gt=({className:s})=>{var l,i;const n=Ne(),{currentUser:d}=e(),[o,m]=c.useState({todayExpenses:0,monthExpenses:0,recentExpenses:[],topCategory:"",topCategoryAmount:0,pendingCount:0}),[x,g]=c.useState(!0);c.useEffect(()=>{u()},[]);const u=async()=>{var e,t;try{g(!0);r();const s=new Date,l=new Date(s.getFullYear(),s.getMonth(),s.getDate());l.setHours(0,0,0,0);const i=new Date(l);i.setDate(i.getDate()+1);const n=new Date(s.getFullYear(),s.getMonth(),1),{data:c,error:o}=await a.from("account_transactions").select("*").eq("transaction_type","expense").order("created_at",{ascending:!1});if(o)return void m({todayExpenses:0,monthExpenses:0,recentExpenses:[],topCategory:"",topCategoryAmount:0,pendingCount:0});const x=(null==(e=null==d?void 0:d.permissions)?void 0:e.includes("all"))||(null==(t=null==d?void 0:d.permissions)?void 0:t.includes("view_financial_reports"))||"admin"===(null==d?void 0:d.role),u=x?(c||[]).filter(e=>{var t;return"pending"===(e.status||(null==(t=e.metadata)?void 0:t.approval_status)||"approved")}).length:0,h=(c||[]).filter(e=>{var t;const s=e.status||(null==(t=e.metadata)?void 0:t.approval_status)||"approved";return x||"approved"===s}),p=h.filter(e=>{const t=new Date(e.created_at);return t>=l&&t<i}),f=h.filter(e=>new Date(e.created_at)>=n),y=p.reduce((e,t)=>e+(parseFloat(t.amount)||0),0),j=f.reduce((e,t)=>e+(parseFloat(t.amount)||0),0),b=new Map;f.forEach(e=>{var t;const s=(null==(t=e.metadata)?void 0:t.category)||"Other",a=parseFloat(e.amount)||0;b.set(s,(b.get(s)||0)+a)});let N="",v=0;b.forEach((e,t)=>{e>v&&(v=e,N=t)});const w=new Date(s);w.setDate(w.getDate()-30);const S=h.filter(e=>new Date(e.created_at)>=w).sort((e,t)=>{var s,a;if(x){const r=e.status||(null==(s=e.metadata)?void 0:s.approval_status)||"approved",l=t.status||(null==(a=t.metadata)?void 0:a.approval_status)||"approved";if("pending"===r&&"pending"!==l)return-1;if("pending"!==r&&"pending"===l)return 1}return new Date(t.created_at).getTime()-new Date(e.created_at).getTime()}).slice(0,5).map(e=>{var t,s;return{id:e.id,description:e.description||"No description",amount:parseFloat(e.amount)||0,category:(null==(t=e.metadata)?void 0:t.category)||"Other",status:e.status||(null==(s=e.metadata)?void 0:s.approval_status)||"approved",time:new Date(e.created_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}});m({todayExpenses:y,monthExpenses:j,recentExpenses:S,topCategory:N,topCategoryAmount:v,pendingCount:u})}catch(s){m({todayExpenses:0,monthExpenses:0,recentExpenses:[],topCategory:"",topCategoryAmount:0})}finally{g(!1)}},h=e=>e>=1e6?`TSh ${(e/1e6).toFixed(1)}M`:e>=1e3?`TSh ${(e/1e3).toFixed(0)}K`:`TSh ${e.toFixed(0)}`;return x?t.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:t.jsx(ee,{className:"w-5 h-5 text-red-600"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Expenses"}),((null==(l=null==d?void 0:d.permissions)?void 0:l.includes("all"))||(null==(i=null==d?void 0:d.permissions)?void 0:i.includes("view_financial_reports"))||"admin"===(null==d?void 0:d.role))&&o.pendingCount>0&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[o.pendingCount," pending"]})]}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Track your spending"})]})]}),t.jsxs("button",{onClick:()=>n("/expenses"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Expenses",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(180px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},className:"mb-8",children:[t.jsxs("div",{className:"p-4 rounded-lg bg-red-50 hover:bg-red-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(z,{size:14,className:"text-red-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Today"})]}),t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:h(o.todayExpenses)})]}),t.jsxs("div",{className:"p-4 rounded-lg bg-orange-50 hover:bg-orange-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx($,{size:14,className:"text-orange-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"This Month"})]}),t.jsx("span",{className:"text-2xl font-semibold text-gray-900",children:h(o.monthExpenses)})]})]}),o.topCategory&&t.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-gradient-to-br from-red-50 to-orange-50",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Top Category"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.topCategory}),t.jsx("p",{className:"text-base font-bold text-red-600",children:h(o.topCategoryAmount)})]})]}),t.jsx("div",{className:"space-y-3 flex-grow max-h-48 overflow-y-auto mb-6 pr-2",children:o.recentExpenses.length>0?t.jsxs(t.Fragment,{children:[t.jsx("h4",{className:"text-xs text-gray-400 mb-3",children:"Recent Expenses (Last 30 Days)"}),o.recentExpenses.map(e=>{var s,r;const l={pending:{bg:"bg-yellow-50",border:"border-yellow-200",badge:"bg-yellow-100 text-yellow-800"},approved:{bg:"bg-gray-50",border:"border-gray-200",badge:"bg-green-100 text-green-800"},rejected:{bg:"bg-red-50",border:"border-red-200",badge:"bg-red-100 text-red-800"}},i=l[e.status]||l.approved;return t.jsx("div",{className:`p-3 ${i.bg} border ${i.border} rounded-lg hover:opacity-90 transition-all`,children:t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.description}),"approved"!==e.status&&t.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${i.badge}`,children:e.status})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:e.category}),t.jsxs("span",{className:"text-xs text-gray-400",children:["• ",e.time]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-sm font-semibold text-red-600",children:["-",h(e.amount)]}),((null==(s=null==d?void 0:d.permissions)?void 0:s.includes("all"))||(null==(r=null==d?void 0:d.permissions)?void 0:r.includes("view_financial_reports"))||"admin"===(null==d?void 0:d.role))&&"pending"===e.status&&t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:()=>(async e=>{try{const{error:t}=await a.from("account_transactions").update({status:"approved",metadata:a.raw(`metadata || '{"approval_status": "approved", "approved_by": "${null==d?void 0:d.id}", "approved_at": "${(new Date).toISOString()}"}'::jsonb`)}).eq("id",e);if(t)throw t;se.success("Expense approved!"),u()}catch(t){se.error("Failed to approve expense")}})(e.id),className:"p-1 rounded bg-green-600 hover:bg-green-700 text-white transition-colors",title:"Approve",children:t.jsx(N,{size:14})}),t.jsx("button",{onClick:()=>(async e=>{try{const{error:t}=await a.from("account_transactions").update({status:"rejected",metadata:a.raw(`metadata || '{"approval_status": "rejected", "rejected_by": "${null==d?void 0:d.id}", "rejected_at": "${(new Date).toISOString()}"}'::jsonb`)}).eq("id",e);if(t)throw t;se.success("Expense rejected"),u()}catch(t){se.error("Failed to reject expense")}})(e.id),className:"p-1 rounded bg-red-600 hover:bg-red-700 text-white transition-colors",title:"Reject",children:t.jsx(te,{size:14})})]})]})]})},e.id)})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(ee,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No recent expenses"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Last 30 days"})]})}),t.jsx("div",{className:"flex gap-2 mt-auto pt-6",children:t.jsxs("button",{onClick:()=>n("/expenses/new"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"Add Expense"})]})})]})},ut=({className:e})=>{const s=Ne(),{dateRange:i,getDateRangeForQuery:n}=l(),[d,o]=c.useState([]),[m,x]=c.useState(!0),[g,u]=c.useState(0);c.useEffect(()=>{h()},[i]);const h=async()=>{try{x(!0);const e=r(),{startDate:t,endDate:s}=n();let l=a.from("lats_sales").select("id, total_amount, sold_by, created_at, branch_id").gte("created_at",t).lte("created_at",s);e&&(l=l.eq("branch_id",e));const{data:i,error:c}=await l;if(c)throw c;if(!i||0===i.length)return o([]),void u(0);const d=[...new Set(i.map(e=>e.sold_by).filter(Boolean))];let m=new Map;if(d.length>0){const e=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e),t=d.filter(t=>e(t)),s=d.filter(t=>!e(t));if(t.length>0){const{data:e,error:s}=await a.from("users").select("id, email, full_name").in("id",t);!s&&e&&e.forEach(e=>{m.set(e.id,e)});const{data:r,error:l}=await a.from("employees").select("id, email, full_name").in("id",t);!l&&r&&r.forEach(e=>{m.has(e.id)||m.set(e.id,e)})}if(s.length>0){const{data:e,error:t}=await a.from("users").select("id, email, full_name").in("email",s);!t&&e&&e.forEach(e=>{m.set(e.email,e)});const{data:r,error:l}=await a.from("employees").select("id, email, full_name").in("email",s);!l&&r&&r.forEach(e=>{m.has(e.email)||m.set(e.email,e)})}}const g=new Map;(i||[]).forEach(e=>{var t;const s=e.sold_by;if(!s)return;const a="string"==typeof e.total_amount?parseFloat(e.total_amount):e.total_amount||0,r=m.get(s),l=(null==r?void 0:r.full_name)||(null==r?void 0:r.name)||(null==(t=null==r?void 0:r.email)?void 0:t.split("@")[0])||(null==r?void 0:r.email)||`Staff #${s.substring(0,8)}`;if(g.has(s)){const e=g.get(s);e.sales+=a,e.count+=1}else g.set(s,{sales:a,count:1,name:l})});const h=Array.from(g.entries()).map(([e,t])=>({id:e,name:t.name,sales:t.sales,transactions:t.count,avatar:t.name.substring(0,2).toUpperCase()})).sort((e,t)=>t.sales-e.sales).slice(0,5);o(h),u(g.size)}catch(e){}finally{x(!1)}},p=e=>e>=1e6?`TSh ${(e/1e6).toFixed(1)}M`:e>=1e3?`TSh ${(e/1e3).toFixed(0)}K`:`TSh ${e.toFixed(0)}`,f=e=>{const t=["bg-blue-500","bg-emerald-500","bg-purple-500","bg-orange-500","bg-pink-500"];return t[e%t.length]};return m?t.jsx("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${e}`,children:t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-7 flex flex-col ${e}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:t.jsx(_,{className:"w-5 h-5 text-indigo-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Staff Performance"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[g," active members · ","7days"===i.preset?"Last 7 days":"1month"===i.preset?"Last month":"3months"===i.preset?"Last 3 months":"6months"===i.preset?"Last 6 months":"Custom range"]})]})]}),t.jsxs("button",{onClick:()=>s("/employees"),className:"px-3 py-1.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Staff",children:[t.jsx(w,{size:14}),t.jsx("span",{children:"View All"})]})]}),t.jsx("div",{className:"space-y-3 flex-grow mb-6",children:d.length>0?d.map((e,s)=>t.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors relative overflow-hidden",children:[s<3&&t.jsxs("div",{className:"absolute top-2 right-2 w-6 h-6 rounded-full flex items-center justify-center "+(0===s?"bg-yellow-500":1===s?"bg-gray-400":"bg-orange-600"),children:[0===s&&t.jsx(H,{size:14,className:"text-white"}),s>0&&t.jsxs("span",{className:"text-xs font-bold text-white",children:["#",s+1]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${f(s)}`,children:t.jsx("span",{className:"text-sm font-bold text-white",children:e.avatar})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),t.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:[e.transactions," sales"]}),t.jsx("span",{className:"text-sm font-semibold text-indigo-600",children:p(e.sales)})]})]})]})]},e.id)):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:t.jsx(_,{className:"w-6 h-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500",children:"No staff activity yet"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Sales data will appear here"})]})}),d.length>0&&t.jsx("div",{className:"mt-auto pt-6 border-t border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(H,{className:"w-5 h-5 text-indigo-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Top Performer"}),t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:d[0].name})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-lg font-bold text-indigo-600",children:p(d[0].sales)}),t.jsxs("p",{className:"text-xs text-gray-600",children:[d[0].transactions," sales"]})]})]})})]})},ht=({className:e})=>{const[s,a]=c.useState([]),[r,l]=c.useState(!0),[i,n]=c.useState(0),[d,o]=c.useState(0);c.useEffect(()=>{m()},[]);const m=async()=>{try{l(!0);const{supabase:e}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{getCurrentBranchId:t}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=t(),r=[],i=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];let c=0;for(let a=6;a>=0;a--){const t=new Date;t.setDate(t.getDate()-a);const l=i[t.getDay()],n=new Date(t);n.setHours(0,0,0,0);const d=new Date(t);d.setHours(23,59,59,999);let o=e.from("lats_sales").select("total_amount").gte("created_at",n.toISOString()).lte("created_at",d.toISOString());s&&(o=o.eq("branch_id",s));const{data:m,error:x}=await o,g=(null==m?void 0:m.reduce((e,t)=>{const s=t.total_amount,a="string"==typeof s?parseFloat(s):s;return e+(isNaN(a)||null==a?0:a)},0))||0;c+=g,r.push({day:l,revenue:g,date:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})})}const d=r.map(e=>({...e,revenue:isNaN(e.revenue)||null===e.revenue||void 0===e.revenue?0:e.revenue}));a(d),n(isNaN(c)||null==c?0:c);const m=r.slice(-3).reduce((e,t)=>e+(t.revenue||0),0)/3,x=r.slice(0,4).reduce((e,t)=>e+(t.revenue||0),0)/4,g=x>0?(m-x)/x*100:0,u=isNaN(g)?0:g;o(Math.round(10*u)/10)}catch(e){}finally{l(!1)}},x=e=>{const t="string"==typeof e?parseFloat(e):e;return isNaN(t)||null==t?"0":t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(0)}K`:t.toFixed(0)},g=({active:e,payload:s})=>e&&s&&s.length?t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-xs font-medium mb-1",children:s[0].payload.date}),t.jsxs("p",{className:"text-sm font-bold",children:["TSh ",x(s[0].value)]})]}):null;return r?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${e}`,children:t.jsx("div",{className:"flex items-center justify-center h-48",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${e}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx($,{className:"w-5 h-5 text-gray-700"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Revenue This Week"})]}),t.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["TSh ",x(i)]})]}),t.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg "+(d>=0?"bg-emerald-50":"bg-red-50"),children:[t.jsx(M,{className:"w-4 h-4 "+(d>=0?"text-emerald-600":"text-red-600")}),t.jsxs("span",{className:"text-sm font-semibold "+(d>=0?"text-emerald-600":"text-red-600"),children:[d>=0?"+":"",d,"%"]})]})]}),t.jsx("div",{className:"flex-grow -mx-2 -mb-2 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(ke,{data:s,margin:{top:0,right:0,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"#10b981",stopOpacity:.4}),t.jsx("stop",{offset:"30%",stopColor:"#10b981",stopOpacity:.2}),t.jsx("stop",{offset:"70%",stopColor:"#10b981",stopOpacity:.1}),t.jsx("stop",{offset:"100%",stopColor:"#10b981",stopOpacity:.05})]})}),t.jsx(Ce,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),t.jsx(Te,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),t.jsx(De,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickFormatter:x,tickLine:!1,axisLine:!1,width:50,domain:[0,"auto"]}),t.jsx($e,{content:t.jsx(g,{})}),t.jsx(Ae,{type:"monotone",dataKey:"revenue",stroke:"#10b981",strokeWidth:3,fill:"url(#colorRevenue)",connectNulls:!1})]})})})]})},pt=({className:s})=>{const{currentUser:a}=e(),[r,l]=c.useState([]),[i,n]=c.useState(!0),[d,o]=c.useState(0),[m,x]=c.useState(new Date),g={"Active Repairs":"#3b82f6","Awaiting Parts":"#f59e0b",Completed:"#10b981","New/Assigned":"#8b5cf6",Failed:"#ef4444"};c.useEffect(()=>{u();const e=setInterval(()=>{u()},3e4);return()=>clearInterval(e)},[null==a?void 0:a.id]);const u=async()=>{try{if(n(!0),null==a?void 0:a.id){const{supabase:e}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{getCurrentBranchId:t}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=t();let a=e.from("devices").select("id, status, created_at, updated_at, problem_description, branch_id");s&&(a=a.eq("branch_id",s));const{data:r,error:i}=await a;if(i)throw i;const n={"Active Repairs":0,"Awaiting Parts":0,Completed:0,"New/Assigned":0,Failed:0};null==r||r.forEach(e=>{var t;const s=(null==(t=e.status)?void 0:t.toLowerCase())||"";["in-repair","diagnosis-started","reassembled-testing"].includes(s)?n["Active Repairs"]++:["awaiting-parts","parts-arrived"].includes(s)?n["Awaiting Parts"]++:["done","repair-complete","completed"].includes(s)?n.Completed++:["assigned","returned-to-customer-care","pending"].includes(s)?n["New/Assigned"]++:"failed"===s&&n.Failed++});const c=Object.entries(n).filter(([e,t])=>t>0).map(([e,t])=>({name:e,value:t,color:g[e]}));l(c),o((null==r?void 0:r.length)||0),x(new Date)}}catch(e){}finally{n(!1)}},h=({active:e,payload:s})=>e&&s&&s.length?t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-sm font-semibold",children:s[0].name}),t.jsxs("p",{className:"text-xs text-gray-300 mt-1",children:[s[0].value," devices (",(s[0].value/d*100).toFixed(1),"%)"]})]}):null;return i?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(q,{className:"w-5 h-5 text-gray-700"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Repair Status"}),t.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[t.jsx("span",{className:"text-xs text-gray-400",children:(e=>{const t=Math.floor(((new Date).getTime()-e.getTime())/1e3);if(t<60)return"Just now";const s=Math.floor(t/60);if(s<60)return`${s}m ago`;const a=Math.floor(s/60);return a<24?`${a}h ago`:"Today"})(m)}),t.jsx("button",{onClick:u,disabled:i,className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",title:"Refresh data",children:t.jsx(ae,{className:"w-4 h-4 text-gray-600 "+(i?"animate-spin":"")})})]})]}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:d}),t.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Total Repairs • Live Data"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),t.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-400 rounded-full animate-ping opacity-75"})]})]})]}),t.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center ml-4",children:t.jsx(O,{className:"w-5 h-5 text-blue-600"})})]}),0===r.length?t.jsx("div",{className:"flex-grow flex items-center justify-center min-h-48",children:t.jsxs("div",{className:"text-center",children:[t.jsx(q,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-gray-500",children:"No repairs found"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Device repairs will appear here when added"})]})}):t.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(ze,{data:r,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,paddingAngle:3,dataKey:"value",label:e=>`${(e.value/d*100).toFixed(0)}%`,labelLine:!1,children:r.map((e,s)=>t.jsx(Fe,{fill:e.color},`cell-${s}`))}),t.jsx($e,{content:t.jsx(h,{})})]})})}),t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-4",children:r.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-xs text-gray-600 truncate",children:e.name}),t.jsx("span",{className:"text-xs font-semibold text-gray-900 ml-auto",children:e.value})]},s))})]})},ft=({className:s})=>{const a=Ne(),{currentUser:r}=e(),[l,i]=c.useState([]),[n,d]=c.useState(!0),[o,m]=c.useState(0),[x,g]=c.useState(0),[u,h]=c.useState(!1);c.useEffect(()=>{p()},[null==r?void 0:r.id]);const p=async()=>{var e;try{if(d(!0),null==r?void 0:r.id){const{supabase:t}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{getCurrentBranchId:s}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),a=s();let r=t.from("appointments").select("id, appointment_date, appointment_time, status");a&&(r=r.eq("branch_id",a));const{data:l,error:n}=await r;if(n)return i([]),m(0),void g(0);const c=[],d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];let o=0;for(let e=6;e>=0;e--){const t=new Date;t.setDate(t.getDate()-e);const s=d[t.getDay()],a=t.toISOString().split("T")[0],r=(null==l?void 0:l.filter(e=>{if(!e.appointment_date)return!1;const t=e.appointment_date.split("T")[0]===a;return t}).length)||0;o+=r,c.push({day:s,appointments:r,isToday:0===e})}i(c),m((null==(e=c[c.length-1])?void 0:e.appointments)||0),g(o)}}catch(t){}finally{d(!1)}},f=({active:e,payload:s})=>e&&s&&s.length?t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-xs font-medium mb-1",children:s[0].payload.day}),t.jsxs("p",{className:"text-sm font-bold",children:[s[0].value," appointments"]})]}):null;return n?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(y,{className:"w-5 h-5 text-gray-700"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Appointments"})]}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:o}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Today • ",x," this week"]})]}),t.jsx("div",{className:"px-2.5 py-1.5 rounded-lg bg-pink-50",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(M,{className:"w-4 h-4 text-pink-600"}),t.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:[Math.round(x/7*10)/10," avg"]})]})})]}),t.jsx("div",{className:"flex-grow -mx-2 mb-4 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(Ee,{data:l,margin:{top:0,right:0,left:0,bottom:0},children:[t.jsx(Ce,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),t.jsx(Te,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),t.jsx(De,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,width:50,domain:[0,"dataMax"]}),t.jsx($e,{content:t.jsx(f,{}),cursor:{fill:"rgba(236, 72, 153, 0.1)"}}),t.jsx(Ie,{dataKey:"appointments",radius:[6,6,0,0],children:l.map((e,s)=>t.jsx(Fe,{fill:e.isToday?"#ec4899":"#f9a8d4"},`cell-${s}`))})]})})}),t.jsxs("div",{className:"flex gap-2 pt-4",children:[t.jsxs("button",{onClick:()=>h(!0),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-gray-900 text-sm text-white hover:bg-gray-800 transition-colors",children:[t.jsx(k,{size:14}),t.jsx("span",{children:"Add Appointment"})]}),t.jsx("button",{onClick:()=>a("/appointments"),className:"px-3 py-2.5 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 text-xs font-medium transition-colors flex items-center gap-1.5",title:"View All Appointments",children:t.jsx(w,{size:14})})]}),t.jsx(We,{isOpen:u,onClose:()=>h(!1),mode:"create",onSave:async e=>{try{await Pe(e),R.success("Appointment created successfully!"),h(!1),p()}catch(t){throw R.error("Failed to create appointment"),t}}})]})},yt=({className:s})=>{const{currentUser:a}=e(),[r,l]=c.useState([]),[i,d]=c.useState(!0),[o,m]=c.useState(0);c.useEffect(()=>{x()},[null==a?void 0:a.id]);const x=async()=>{try{if(d(!0),null==a?void 0:a.id){const e=await n(),t=[];let s=0,a=0;e.forEach(e=>{if(e.variants&&e.variants.length>0){const r=e.variants.reduce((e,t)=>{const s=Number(t.quantity);return e+(isNaN(s)?0:s)},0),l=e.variants.reduce((e,t)=>{const s=Number(t.minQuantity);return e+(isNaN(s)?0:s)},0)/e.variants.length;let i=0;l>0&&!isNaN(l)&&!isNaN(r)?i=Math.min(100,Math.round(r/l*100)):r>0&&(i=100),!isNaN(i)&&isFinite(i)||(i=0);let n="good";0===r?(n="critical",a++):r<=l&&(n="low",s++);const c=e.name||"Unnamed Product",d=c.trim().substring(0,25);t.push({name:c.length>25?d+"...":d,stock:i,status:n,actualQuantity:r,minQuantity:Math.round(l)})}});const r=t.filter(e=>{const t=!isNaN(e.stock)&&isFinite(e.stock)&&e.stock>=0,s=!isNaN(e.actualQuantity)&&isFinite(e.actualQuantity),a=!isNaN(e.minQuantity)&&isFinite(e.minQuantity);return t&&s&&a}).sort((e,t)=>{const s={critical:0,low:1,good:2};return s[e.status]!==s[t.status]?s[e.status]-s[t.status]:e.stock-t.stock}).slice(0,10);r.length>0?l(r):l([]),m(s+a)}}catch(e){l([]),m(0)}finally{d(!1)}},g=e=>{switch(e){case"good":return"#10b981";case"low":return"#f59e0b";case"critical":return"#ef4444";default:return"#6b7280"}},u=({active:e,payload:s})=>{if(e&&s&&s.length){const e=s[0].payload,a=e.status;return t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-sm font-semibold",children:e.name}),t.jsxs("p",{className:"text-xs text-gray-300 mt-1",children:["Current: ",e.actualQuantity," units"]}),t.jsxs("p",{className:"text-xs text-gray-300",children:["Min Required: ",e.minQuantity," units"]}),t.jsxs("p",{className:"text-xs text-gray-300 mt-1",children:["Stock Level: ",s[0].value,"%"]}),t.jsx("p",{className:"text-xs mt-1 font-medium "+("good"===a?"text-green-400":"low"===a?"text-amber-400":"text-red-400"),children:"good"===a?"✓ Good Stock":"low"===a?"⚠ Low Stock":"✗ Critical Level"})]})}return null};if(i)return t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})});const h=(Array.isArray(r)?r:[]).filter(e=>{const t=!isNaN(e.stock)&&isFinite(e.stock)&&e.stock>=0;return t});return t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(T,{className:"w-5 h-5 text-gray-700"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Stock Levels"})]}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:h.length}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:10===h.length?"Top 10 products":`Product${1!==h.length?"s":""} tracked`})]}),o>0&&t.jsx("div",{className:"px-2.5 py-1.5 rounded-lg bg-amber-50",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(K,{className:"w-4 h-4 text-amber-600"}),t.jsxs("span",{className:"text-sm font-semibold text-amber-600",children:[o," low"]})]})})]}),0===h.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[t.jsx(T,{className:"w-12 h-12 mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No inventory data available"}),t.jsx("p",{className:"text-xs mt-1",children:"Add products to see stock levels"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:h.length>0&&t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(Ee,{data:h,layout:"horizontal",margin:{left:0,right:10},children:[t.jsx(Ce,{strokeDasharray:"3 3",stroke:"#f0f0f0",horizontal:!1}),t.jsx(Te,{type:"number",domain:[0,100],allowDataOverflow:!1,stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>{const t=Number(e);return isNaN(t)?"0%":`${t}%`}}),t.jsx(De,{type:"category",dataKey:"name",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,width:120}),t.jsx($e,{content:t.jsx(u,{}),cursor:{fill:"rgba(0,0,0,0.05)"}}),t.jsx(Ie,{dataKey:"stock",radius:[0,4,4,0],maxBarSize:20,fill:"#10b981",children:h.map((e,s)=>t.jsx(Fe,{fill:g(e.status)},`cell-${s}`))})]})})}),t.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 pt-4 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Good"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Low"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Critical"})]})]})]})]})},jt=({className:s})=>{const{currentUser:a}=e(),[r,l]=c.useState([]),[i,n]=c.useState(!0),[d,o]=c.useState(0),[m,x]=c.useState(0);c.useEffect(()=>{g()},[null==a?void 0:a.id]);const g=async()=>{try{if(n(!0),null==a?void 0:a.id){const{supabase:e}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{getCurrentBranchId:t}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=t(),r=await be.getDashboardStats(a.id),i=[],n=new Date;let c=0;for(let a=29;a>=0;a--){const t=new Date(n);t.setDate(t.getDate()-a);const r=new Date(t);r.setHours(0,0,0,0);const l=new Date(t);l.setHours(23,59,59,999);let d=e.from("customers").select("id, created_at").gte("created_at",r.toISOString()).lte("created_at",l.toISOString());s&&(d=d.eq("branch_id",s));const{data:o}=await d,m=(null==o?void 0:o.length)||0;let x=e.from("devices").select("id, created_at, updated_at").or(`created_at.gte.${r.toISOString()},updated_at.gte.${r.toISOString()}`).lte("created_at",l.toISOString());s&&(x=x.eq("branch_id",s));const{data:g}=await x,u=(null==g?void 0:g.length)||0;a<7&&(c+=m),i.push({date:t.toLocaleDateString("en-US",{month:"short",day:"numeric"}),activity:u,newCustomers:m})}l(i),o(r.activeCustomers),x(c)}}catch(e){}finally{n(!1)}},u=({active:e,payload:s})=>e&&s&&s.length?t.jsxs("div",{className:"bg-gray-900 text-white px-4 py-3 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-xs font-medium mb-2",children:s[0].payload.date}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsx("span",{className:"text-xs text-gray-300",children:"Activity:"}),t.jsx("span",{className:"text-sm font-bold text-blue-400",children:s[0].value})]}),t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsx("span",{className:"text-xs text-gray-300",children:"New:"}),t.jsx("span",{className:"text-sm font-bold text-green-400",children:s[1].value})]})]})]}):null;return i?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col w-full ${s}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(_,{className:"w-5 h-5 text-gray-700"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Customer Activity"})]}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:d}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total active customers"})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[t.jsx(re,{className:"w-4 h-4 text-green-600"}),t.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["+",m]})]}),t.jsx("p",{className:"text-xs text-gray-500",children:"New this week"})]})]}),t.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(ke,{data:r,children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"colorActivity",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),t.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]}),t.jsxs("linearGradient",{id:"colorNew",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),t.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})]}),t.jsx(Ce,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),t.jsx(Te,{dataKey:"date",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,interval:4}),t.jsx(De,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1}),t.jsx($e,{content:t.jsx(u,{})}),t.jsx(Ae,{type:"monotone",dataKey:"activity",stroke:"#3b82f6",strokeWidth:2,fill:"url(#colorActivity)"}),t.jsx(Ae,{type:"monotone",dataKey:"newCustomers",stroke:"#10b981",strokeWidth:2,fill:"url(#colorNew)"})]})})}),t.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Activity"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"New Customers"})]})]})]})},bt=({className:s})=>{const{currentUser:a}=e(),[r,l]=c.useState([]),[i,n]=c.useState(!0),[d,o]=c.useState(0);c.useEffect(()=>{m()},[null==a?void 0:a.id]);const m=async()=>{try{n(!0);const{supabase:e}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{getCurrentBranchId:t}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=t(),a=[];for(let l=13;l>=0;l--){const t=new Date;t.setDate(t.getDate()-l);const r=new Date(t);r.setHours(0,0,0,0);const i=new Date(t);i.setHours(23,59,59,999);let n=e.from("lats_sales").select("total_amount").gte("created_at",r.toISOString()).lte("created_at",i.toISOString());s&&(n=n.eq("branch_id",s));const{data:c}=await n,d=(null==c?void 0:c.reduce((e,t)=>{const s=t.total_amount,a="string"==typeof s?parseFloat(s):s;return e+(isNaN(a)||null==a?0:a)},0))||0;let o=e.from("devices").select("status, created_at, updated_at").gte("created_at",r.toISOString()).lte("created_at",i.toISOString());s&&(o=o.eq("branch_id",s));const{data:m}=await o,x=(null==m?void 0:m.filter(e=>["done","repair-complete"].includes(e.status)).length)||0,g=(null==m?void 0:m.length)||0,u=g>0?Math.min(100,Math.round(x/g*100)):85,h=1e5,p=Math.min(100,Math.round(d/h*100)),f=g>0?Math.min(100,Math.round(x/g*100)):85,y=isNaN(p)||!isFinite(p)?0:Math.max(0,Math.min(100,p)),j=isNaN(f)||!isFinite(f)?0:Math.max(0,Math.min(100,f)),b=isNaN(u)||!isFinite(u)?0:Math.max(0,Math.min(100,u));a.push({date:t.toLocaleDateString("en-US",{month:"short",day:"numeric"}),sales:y,service:j,satisfaction:b})}const r=a.slice(-3).reduce((e,t)=>e+(t.sales||0)+(t.service||0)+(t.satisfaction||0),0)/9,i=a.slice(0,3).reduce((e,t)=>e+(t.sales||0)+(t.service||0)+(t.satisfaction||0),0)/9,c=i>0?(r-i)/i*100:0,d=isNaN(c)?0:c;l(a),o(Math.round(10*d)/10)}catch(e){}finally{n(!1)}},x=({active:e,payload:s})=>e&&s&&s.length?t.jsxs("div",{className:"bg-gray-900 text-white px-4 py-3 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-xs font-medium mb-2",children:s[0].payload.date}),t.jsx("div",{className:"space-y-1",children:s.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),t.jsxs("span",{className:"text-xs text-gray-300 capitalize",children:[e.name,":"]})]}),t.jsxs("span",{className:"text-sm font-bold",style:{color:e.color},children:[e.value,"%"]})]},s))})]}):null;if(i)return t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})});const g=r.filter(e=>{const t=!isNaN(e.sales)&&isFinite(e.sales)&&!isNaN(e.service)&&isFinite(e.service)&&!isNaN(e.satisfaction)&&isFinite(e.satisfaction);return t});return t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col w-full ${s}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(O,{className:"w-5 h-5 text-gray-700"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Performance Metrics"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 2 weeks trend analysis"})]}),t.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg "+(d>=0?"bg-emerald-50":"bg-red-50"),children:[t.jsx(M,{className:"w-4 h-4 "+(d>=0?"text-emerald-600":"text-red-600")}),t.jsxs("span",{className:"text-sm font-semibold "+(d>=0?"text-emerald-600":"text-red-600"),children:[d>=0?"+":"",d,"%"]})]})]}),t.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(Le,{data:g,children:[t.jsx(Ce,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),t.jsx(Te,{dataKey:"date",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,interval:2}),t.jsx(De,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,domain:[0,100]}),t.jsx($e,{content:t.jsx(x,{})}),t.jsx(Re,{type:"monotone",dataKey:"sales",stroke:"#fbbf24",strokeWidth:2.5,dot:{fill:"#fbbf24",r:3},activeDot:{r:5},name:"Sales"}),t.jsx(Re,{type:"monotone",dataKey:"service",stroke:"#60a5fa",strokeWidth:2.5,dot:{fill:"#60a5fa",r:3},activeDot:{r:5},name:"Service"}),t.jsx(Re,{type:"monotone",dataKey:"satisfaction",stroke:"#34d399",strokeWidth:2.5,dot:{fill:"#34d399",r:3},activeDot:{r:5},name:"Satisfaction"})]})})}),t.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-400"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Sales"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-400"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Service"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-green-400"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Satisfaction"})]})]})]})},Nt=({className:e})=>{var s,a,r,l;const[i,n]=c.useState([]),[d,o]=c.useState(!0),[m,x]=c.useState(0);c.useEffect(()=>{g()},[]);const g=async()=>{try{o(!0);const{supabase:e}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{getCurrentBranchId:t}=await Se(()=>import("./index-222cfb29.js").then(e=>e.aV),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=t();let a=e.from("lats_sales").select("payment_status, total_amount, created_at, customer_id");s&&(a=a.eq("branch_id",s));const{data:r,error:l}=await a;if(l)throw l;const i=r||[],c={Leads:new Set(i.map(e=>e.customer_id)).size,Initiated:0,Pending:0,Completed:0,Converted:0};let d=0;i.forEach(e=>{var t;const s=(null==(t=e.payment_status)?void 0:t.toLowerCase())||"pending";c.Initiated++,"pending"===s?c.Pending++:"completed"===s&&(c.Completed++,c.Converted++,d+=parseFloat(e.total_amount||0))});const m=[{stage:"Leads",value:c.Leads,color:"#3b82f6"},{stage:"Initiated",value:c.Initiated,color:"#8b5cf6"},{stage:"Pending",value:c.Pending,color:"#f59e0b"},{stage:"Completed",value:c.Completed,color:"#10b981"},{stage:"Revenue",value:Math.round(d),color:"#059669",isRevenue:!0}],g=Math.max(c.Leads,c.Initiated),u=m.map(e=>{const t=g>0?Math.round(e.value/g*100):0;return{...e,percentage:Math.min(t,100)}}),h=g>0?Math.round(c.Completed/g*100):0;n(u),x(h)}catch(e){n([]),x(0)}finally{o(!1)}};return d?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${e}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 ${e}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(le,{className:"w-5 h-5 text-gray-700"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Sales Funnel"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Conversion pipeline analysis"})]}),t.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-green-50",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(M,{className:"w-4 h-4 text-green-600"}),t.jsxs("span",{className:"text-sm font-semibold text-green-600",children:[m,"%"]})]})})]}),t.jsx("div",{className:"space-y-2 mb-6",children:i.map((e,s)=>{const a=e.percentage,r="Revenue"===e.stage;return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700 w-24",children:e.stage}),t.jsx("span",{className:"text-xs text-gray-500",children:r?`TSh ${e.value.toLocaleString()}`:e.value})]}),t.jsx("div",{className:"w-full bg-gray-100 rounded-full h-8 overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full flex items-center justify-end px-3 transition-all duration-500",style:{width:`${a}%`,backgroundColor:e.color},children:t.jsxs("span",{className:"text-xs font-semibold text-white",children:[e.percentage,"%"]})})})]},s)})}),t.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-4 border-gray-100",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Leads"}),t.jsx("p",{className:"text-lg font-bold text-blue-600",children:(null==(s=i[0])?void 0:s.value)||0})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Drop-off"}),t.jsx("p",{className:"text-lg font-bold text-amber-600",children:Math.max(0,((null==(a=i[0])?void 0:a.value)||0)-((null==(r=i[3])?void 0:r.value)||0))})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Revenue"}),t.jsxs("p",{className:"text-lg font-bold text-green-600",children:["TSh ",((null==(l=i[4])?void 0:l.value)||0).toLocaleString()]})]})]})]})},vt=({className:s})=>{const{currentUser:l}=e(),[i,n]=c.useState([]),[d,o]=c.useState(!0),[m,x]=c.useState(0),[g,u]=c.useState(0);c.useEffect(()=>{h()},[null==l?void 0:l.id]);const h=async()=>{try{o(!0);const e=r(),t=[],s=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];let l=0;for(let r=6;r>=0;r--){const i=new Date;i.setDate(i.getDate()-r);const n=s[i.getDay()],c=new Date(i);c.setHours(0,0,0,0);const d=new Date(i);d.setHours(23,59,59,999);let o=a.from("lats_purchase_orders").select("id, status").gte("created_at",c.toISOString()).lte("created_at",d.toISOString());e&&(o=o.eq("branch_id",e));const{data:m,error:x}=await o,g=m||[],u=g.filter(e=>"pending"===e.status||"ordered"===e.status).length,h=g.filter(e=>"received"===e.status).length,p=g.length;l+=p,t.push({day:n,date:i.toLocaleDateString("en-US",{month:"short",day:"numeric"}),pending:u,received:h,total:p})}n(t),x(l);const i=t.slice(-3).reduce((e,t)=>e+(t.total||0),0)/3,c=t.slice(0,4).reduce((e,t)=>e+(t.total||0),0)/4,d=c>0?(i-c)/c*100:0;u(Math.round(10*d)/10)}catch(e){}finally{o(!1)}},p=({active:e,payload:s,label:a})=>{if(e&&s&&s.length){const e=s[0].payload;return t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-xs font-medium mb-2",children:e.date}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"text-xs",children:[t.jsx("span",{className:"text-amber-400",children:"● Pending:"})," ",e.pending]}),t.jsxs("p",{className:"text-xs",children:[t.jsx("span",{className:"text-emerald-400",children:"● Received:"})," ",e.received]}),t.jsxs("p",{className:"text-xs font-semibold border-t border-gray-700 pt-1 mt-1",children:["Total: ",e.total]})]})]})}return null};return d?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(Z,{className:"w-5 h-5 text-blue-600"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Purchase Orders This Week"})]}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:m}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total orders created"})]}),t.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg "+(g>=0?"bg-emerald-50":"bg-red-50"),children:[t.jsx(M,{className:"w-4 h-4 "+(g>=0?"text-emerald-600":"text-red-600")}),t.jsxs("span",{className:"text-sm font-semibold "+(g>=0?"text-emerald-600":"text-red-600"),children:[g>=0?"+":"",g,"%"]})]})]}),0===i.length||0===m?t.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[t.jsx(T,{className:"w-12 h-12 mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No purchase orders this week"}),t.jsx("p",{className:"text-xs mt-1",children:"Create your first order to see trends"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(Ee,{data:i,margin:{top:10,right:10,left:-20,bottom:0},children:[t.jsx(Ce,{strokeDasharray:"3 3",stroke:"#f0f0f0",vertical:!1}),t.jsx(Te,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),t.jsx(De,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,width:40,allowDecimals:!1}),t.jsx($e,{content:t.jsx(p,{}),cursor:{fill:"rgba(0,0,0,0.05)"}}),t.jsx(Ie,{dataKey:"pending",stackId:"a",fill:"#f59e0b",radius:[0,0,0,0],maxBarSize:40}),t.jsx(Ie,{dataKey:"received",stackId:"a",fill:"#10b981",radius:[4,4,0,0],maxBarSize:40})]})})}),t.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded bg-amber-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Pending Orders"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded bg-emerald-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Received Orders"})]})]})]})]})},wt=({className:s})=>{const{currentUser:l}=e(),[i,n]=c.useState([]),[d,o]=c.useState(!0),[m,x]=c.useState(0),[g,u]=c.useState(0);c.useEffect(()=>{h()},[null==l?void 0:l.id]);const h=async()=>{try{o(!0);const e=r(),t=[],s=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];let l=0;for(let r=6;r>=0;r--){const i=new Date;i.setDate(i.getDate()-r);const n=s[i.getDay()],c=new Date(i);c.setHours(0,0,0,0);const d=new Date(i);d.setHours(23,59,59,999);let o=a.from("lats_sales").select("total_amount").gte("created_at",c.toISOString()).lte("created_at",d.toISOString());e&&(o=o.eq("branch_id",e));const{data:m,error:x}=await o,g=(null==m?void 0:m.reduce((e,t)=>{const s=t.total_amount,a="string"==typeof s?parseFloat(s):s;return e+(isNaN(a)||null==a?0:a)},0))||0;l+=g,t.push({day:n,sales:g,date:i.toLocaleDateString("en-US",{month:"short",day:"numeric"})})}const i=t.map(e=>({...e,sales:isNaN(e.sales)||null===e.sales||void 0===e.sales?0:e.sales}));n(i),x(isNaN(l)||null==l?0:l);const c=t.slice(-3).reduce((e,t)=>e+(t.sales||0),0)/3,d=t.slice(0,4).reduce((e,t)=>e+(t.sales||0),0)/4,m=d>0?(c-d)/d*100:0,g=isNaN(m)?0:m;u(Math.round(10*g)/10)}catch(e){}finally{o(!1)}},p=e=>{const t="string"==typeof e?parseFloat(e):e;return isNaN(t)||null==t?"0":t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(0)}K`:t.toFixed(0)},f=({active:e,payload:s})=>e&&s&&s.length?t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-xs font-medium mb-1",children:s[0].payload.date}),t.jsxs("p",{className:"text-sm font-bold",children:["TSh ",p(s[0].value)]})]}):null;return d?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-48",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx($,{className:"w-5 h-5 text-emerald-600"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Sales This Week"})]}),t.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["TSh ",p(m)]})]}),t.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg "+(g>=0?"bg-emerald-50":"bg-red-50"),children:[t.jsx(M,{className:"w-4 h-4 "+(g>=0?"text-emerald-600":"text-red-600")}),t.jsxs("span",{className:"text-sm font-semibold "+(g>=0?"text-emerald-600":"text-red-600"),children:[g>=0?"+":"",g,"%"]})]})]}),t.jsx("div",{className:"flex-grow -mx-2 -mb-2 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(ke,{data:i,margin:{top:0,right:0,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"#10b981",stopOpacity:.4}),t.jsx("stop",{offset:"30%",stopColor:"#10b981",stopOpacity:.2}),t.jsx("stop",{offset:"70%",stopColor:"#10b981",stopOpacity:.1}),t.jsx("stop",{offset:"100%",stopColor:"#10b981",stopOpacity:.05})]})}),t.jsx(Ce,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),t.jsx(Te,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),t.jsx(De,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickFormatter:p,tickLine:!1,axisLine:!1,width:50,domain:[0,"auto"]}),t.jsx($e,{content:t.jsx(f,{})}),t.jsx(Ae,{type:"monotone",dataKey:"sales",stroke:"#10b981",strokeWidth:3,fill:"url(#colorSales)",connectNulls:!1})]})})})]})},St=({className:s})=>{const{currentUser:l}=e(),[i,n]=c.useState([]),[d,o]=c.useState(!0),[m,x]=c.useState(0),[g,u]=c.useState(0);c.useEffect(()=>{h()},[null==l?void 0:l.id]);const h=async()=>{try{o(!0);const e=r(),t=new Date;t.setDate(t.getDate()-7);let s=a.from("lats_sales").select("payment_method, total_amount").gte("created_at",t.toISOString());e&&(s=s.eq("branch_id",e));const{data:l,error:i}=await s;if(i)throw i;const c=new Map;let d=0,m=0;(l||[]).forEach(e=>{let t="Unknown";e.payment_method&&("string"==typeof e.payment_method?t=e.payment_method:"object"==typeof e.payment_method&&(t=e.payment_method.method||e.payment_method.name||e.payment_method.type||Object.keys(e.payment_method)[0]||"Unknown"));const s="string"==typeof e.total_amount?parseFloat(e.total_amount):e.total_amount||0;if(d++,m+=s,c.has(t)){const e=c.get(t);e.total+=s,e.count+=1}else c.set(t,{total:s,count:1})});const g={cash:"#10b981",card:"#3b82f6",credit_card:"#3b82f6",debit_card:"#6366f1",mobile_money:"#f59e0b",mpesa:"#f59e0b",bank_transfer:"#8b5cf6",unknown:"#6b7280"},h=Array.from(c.entries()).map(([e,t])=>{const s=String(e||"Unknown");return{name:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),value:t.total,count:t.count,color:g[s.toLowerCase()]||"#6b7280"}});n(h),x(d),u(m)}catch(e){}finally{o(!1)}},p=e=>e>=1e6?`TSh ${(e/1e6).toFixed(1)}M`:e>=1e3?`TSh ${(e/1e3).toFixed(0)}K`:`TSh ${e.toFixed(0)}`,f=({active:e,payload:s})=>{if(e&&s&&s.length){const e=s[0].payload,a=g>0?(e.value/g*100).toFixed(1):0;return t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-sm font-semibold mb-1",children:e.name}),t.jsxs("p",{className:"text-xs text-gray-300",children:["Amount: ",p(e.value)]}),t.jsxs("p",{className:"text-xs text-gray-300",children:["Transactions: ",e.count]}),t.jsxs("p",{className:"text-xs text-emerald-400 font-medium mt-1",children:[a,"% of total"]})]})}return null};return d?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col w-full ${s}`,children:[t.jsx("div",{className:"flex items-start justify-between mb-4",children:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(ie,{className:"w-5 h-5 text-blue-600"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Payment Methods"})]}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:m}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total: ",p(g)]})]})}),0===i.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[t.jsx(A,{className:"w-12 h-12 mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No payment data available"}),t.jsx("p",{className:"text-xs mt-1",children:"Make sales to see payment distribution"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(ze,{data:i,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:i.map((e,s)=>t.jsx(Fe,{fill:e.color},`cell-${s}`))}),t.jsx($e,{content:t.jsx(f,{})})]})})}),t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(150px, 100%), 1fr))",gap:"clamp(0.5rem, 1.5vw, 0.75rem)",gridAutoRows:"1fr"},children:i.map((e,s)=>{const a=g>0?(e.value/g*100).toFixed(0):0;return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:e.color}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-xs text-gray-900 font-medium truncate",children:e.name}),t.jsxs("p",{className:"text-xs text-gray-500",children:[a,"%"]})]})]},s)})})})]})]})},_t=({className:s})=>{const{currentUser:l}=e(),[i,n]=c.useState([]),[d,o]=c.useState(!0),[m,x]=c.useState(0);c.useEffect(()=>{g()},[null==l?void 0:l.id]);const g=async()=>{try{o(!0);const e=r(),t=new Date;t.setDate(t.getDate()-7);let s=a.from("lats_sales").select("id, created_at, branch_id").gte("created_at",t.toISOString());e&&(s=s.eq("branch_id",e));const{data:l,error:i}=await s;if(i)throw i;if(!l||0===l.length)return n([]),void x(0);const c=l.map(e=>e.id),{data:d,error:m}=await a.from("lats_sale_items").select("id, quantity, unit_price, sale_id, product_id").in("sale_id",c);if(m)throw m;if(!d||0===d.length)return n([]),void x(0);const g=[...new Set(d.map(e=>e.product_id).filter(Boolean))],{data:u,error:h}=await a.from("lats_products").select("id, category").in("id",g);if(h)throw h;const p=new Map((u||[]).map(e=>[e.id,e])),f=new Map;let y=0;(d||[]).forEach(e=>{const t=p.get(e.product_id),s=(null==t?void 0:t.category)||"Uncategorized",a="string"==typeof e.unit_price?parseFloat(e.unit_price):e.unit_price,r=isNaN(a)||null==a?0:a,l=isNaN(e.quantity)||null===e.quantity||void 0===e.quantity?0:e.quantity,i=r*l,n=isNaN(i)||!isFinite(i)?0:i;if(y+=n,f.has(s)){const e=f.get(s);e.total+=n,e.count+=l}else f.set(s,{total:n,count:l})});const j=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444","#06b6d4","#ec4899","#84cc16"],b=Array.from(f.entries()).map(([e,t],s)=>({name:e.length>15?e.substring(0,15)+"...":e,sales:t.total,count:t.count,color:j[s%j.length]})).filter(e=>{const t=!isNaN(e.sales)&&isFinite(e.sales)&&!isNaN(e.count)&&isFinite(e.count);return t}).sort((e,t)=>t.sales-e.sales).slice(0,8),N=isNaN(y)||!isFinite(y)?0:y;n(b),x(N)}catch(e){}finally{o(!1)}},u=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?"0":t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(0)}K`:t.toFixed(0)},h=({active:e,payload:s})=>{if(e&&s&&s.length){const e=s[0].payload,a=m>0?(e.sales/m*100).toFixed(1):0;return t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-sm font-semibold mb-1",children:e.name}),t.jsxs("p",{className:"text-xs text-gray-300",children:["Sales: TSh ",u(e.sales)]}),t.jsxs("p",{className:"text-xs text-gray-300",children:["Items Sold: ",e.count]}),t.jsxs("p",{className:"text-xs text-emerald-400 font-medium mt-1",children:[a,"% of total"]})]})}return null};return d?t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})}):t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${s}`,children:[t.jsx("div",{className:"flex items-start justify-between mb-4",children:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(ne,{className:"w-5 h-5 text-purple-600"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Sales by Category"})]}),t.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["TSh ",u(m)]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 7 days"})]})}),0===i.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[t.jsx(ne,{className:"w-12 h-12 mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No category data available"}),t.jsx("p",{className:"text-xs mt-1",children:"Sales will be categorized here"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:i.length>0&&t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(Ee,{data:i,margin:{top:10,right:10,left:-20,bottom:20},children:[t.jsx(Ce,{strokeDasharray:"3 3",stroke:"#f0f0f0",vertical:!1}),t.jsx(Te,{dataKey:"name",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,angle:-45,textAnchor:"end",height:60}),t.jsx(De,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,tickFormatter:u,width:50}),t.jsx($e,{content:t.jsx(h,{}),cursor:{fill:"rgba(0,0,0,0.05)"}}),t.jsx(Ie,{dataKey:"sales",radius:[8,8,0,0],maxBarSize:40,children:i.map((e,s)=>t.jsx(Fe,{fill:e.color},`cell-${s}`))})]})})}),i.length>0&&t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(M,{className:"w-4 h-4 text-purple-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Top Category"}),t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i[0].name})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"text-lg font-bold text-purple-600",children:["TSh ",u(i[0].sales)]}),t.jsxs("p",{className:"text-xs text-gray-600",children:[i[0].count," items"]})]})]})})]})]})},kt=({className:s})=>{const{currentUser:l}=e(),[i,n]=c.useState([]),[d,o]=c.useState(!0),[m,x]=c.useState(0),[g,u]=c.useState(0);c.useEffect(()=>{h()},[null==l?void 0:l.id]);const h=async()=>{try{o(!0);const e=r(),t=[],s=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];let l=0,i=0,c=0;for(let r=6;r>=0;r--){const n=new Date;n.setDate(n.getDate()-r);const d=s[n.getDay()],o=new Date(n);o.setHours(0,0,0,0);const m=new Date(n);m.setHours(23,59,59,999);let x=a.from("lats_sales").select("total_amount").gte("created_at",o.toISOString()).lte("created_at",m.toISOString());e&&(x=x.eq("branch_id",e));const{data:g,error:u}=await x,h=(g||[]).reduce((e,t)=>e+("string"==typeof t.total_amount?parseFloat(t.total_amount):t.total_amount||0),0);let p=a.from("lats_sale_items").select("id, quantity, unit_price, variant_id, sale_id, created_at").gte("created_at",o.toISOString()).lte("created_at",m.toISOString());e&&(p=p.eq("branch_id",e));const{data:f,error:y}=await p;let j=0;if(f&&f.length>0){const e=[...new Set(f.map(e=>e.variant_id).filter(Boolean))];if(e.length>0){const{data:t,error:s}=await a.from("lats_product_variants").select("id, cost_price").in("id",e);if(!s&&t){const e=new Map(t.map(e=>[e.id,e]));j=f.reduce((t,s)=>{const a=e.get(s.variant_id),r=(null==a?void 0:a.cost_price)||0,l=s.quantity||0;return t+("string"==typeof r?parseFloat(r):r)*l},0)}}}const b=isNaN(h)||!isFinite(h)?0:h,N=isNaN(j)||!isFinite(j)?0:j,v=b-N,w=b>0?v/b*100:0,S=isNaN(w)||!isFinite(w)?0:w,_=isNaN(v)||!isFinite(v)?0:v;l+=_,b>0&&(i+=S,c++),t.push({day:d,date:n.toLocaleDateString("en-US",{month:"short",day:"numeric"}),revenue:b,cost:N,profit:_,margin:S})}n(t),x(l),u(c>0?i/c:0)}catch(e){}finally{o(!1)}},p=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(0)}K`:e.toFixed(0),f=({active:e,payload:s})=>{if(e&&s&&s.length){const e=s[0].payload;return t.jsxs("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg",children:[t.jsx("p",{className:"text-xs font-medium mb-2",children:e.date}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"text-xs",children:[t.jsx("span",{className:"text-emerald-400",children:"Revenue:"})," TSh ",p(e.revenue)]}),t.jsxs("p",{className:"text-xs",children:[t.jsx("span",{className:"text-red-400",children:"Cost:"})," TSh ",p(e.cost)]}),t.jsxs("p",{className:"text-xs font-semibold border-t border-gray-700 pt-1 mt-1",children:[t.jsx("span",{className:"text-blue-400",children:"Profit:"})," TSh ",p(e.profit)]}),t.jsxs("p",{className:"text-xs",children:[t.jsx("span",{className:"text-yellow-400",children:"Margin:"})," ",e.margin.toFixed(1),"%"]})]})]})}return null};if(d)return t.jsx("div",{className:`bg-white rounded-2xl p-6 ${s}`,children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"})]})})});const y=i.filter(e=>{const t=!isNaN(e.profit)&&isFinite(e.profit)&&!isNaN(e.margin)&&isFinite(e.margin)&&!isNaN(e.revenue)&&isFinite(e.revenue)&&!isNaN(e.cost)&&isFinite(e.cost);return t});return t.jsxs("div",{className:`bg-white rounded-2xl p-6 h-full flex flex-col ${s}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(M,{className:"w-5 h-5 text-green-600"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Profit & Margin"})]}),t.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["TSh ",p(m)]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Avg Margin: ",g.toFixed(1),"%"]})]}),t.jsx("div",{className:"px-3 py-2 rounded-lg bg-emerald-50",children:t.jsx("p",{className:"text-sm font-semibold text-emerald-600",children:"Week Profit"})})]}),t.jsx("div",{className:"flex-grow -mx-2 min-h-48",children:t.jsx(_e,{width:"100%",height:"100%",children:t.jsxs(Oe,{data:y,margin:{top:10,right:10,left:-20,bottom:0},children:[t.jsx(Ce,{strokeDasharray:"3 3",stroke:"#f0f0f0",vertical:!1}),t.jsx(Te,{dataKey:"day",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,height:20}),t.jsx(De,{yAxisId:"left",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,tickFormatter:p,width:50}),t.jsx(De,{yAxisId:"right",orientation:"right",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:10},tickLine:!1,axisLine:!1,tickFormatter:e=>`${e.toFixed(0)}%`,width:50}),t.jsx($e,{content:t.jsx(f,{})}),t.jsx(Ie,{yAxisId:"left",dataKey:"profit",fill:"#10b981",radius:[4,4,0,0],maxBarSize:30}),t.jsx(Re,{yAxisId:"right",type:"monotone",dataKey:"margin",stroke:"#f59e0b",strokeWidth:2,dot:{fill:"#f59e0b",r:4}})]})})}),t.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded bg-emerald-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Profit (TSh)"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Margin (%)"})]})]})]})},Ct=()=>{var s,a;const{currentUser:r}=e(),i=Ne(),{isQuickActionEnabled:n,isWidgetEnabled:m,getWidgetColumnSpan:x,loading:g}=Ve(),{autoArrangeWidgets:u}=Ue(),{dateRange:h,setDateRange:j,getDateRangeForQuery:b}=l(),{dashboardBranchId:N,setDashboardBranchId:v}=(()=>{const e=c.useContext(Ze);if(void 0===e)throw new Error("useDashboardBranch must be used within a DashboardBranchProvider");return e})(),{handleError:w,withErrorHandling:C}=o({maxRetries:3,showToast:!0,logToConsole:!0}),[D,A]=c.useState(!0),[M,z]=c.useState(null),[I,L]=c.useState([]),R=c.useRef([]),O=()=>{try{const e=localStorage.getItem("dashboard_widget_order");if(e){const t=JSON.parse(e).filter(e=>m(e));L(t),R.current=t}else{const e=["revenueTrendChart","salesChart","deviceStatusChart","appointmentsTrendChart","purchaseOrderChart","paymentMethodsChart","analyticsWidget","salesByCategoryChart","profitMarginChart","stockLevelChart","performanceMetricsChart","customerActivityChart","appointmentWidget","employeeWidget","notificationWidget","financialWidget","salesFunnelChart","customerInsightsWidget","serviceWidget","reminderWidget","systemHealthWidget","inventoryWidget","activityFeedWidget","purchaseOrderWidget","chatWidget","salesWidget","topProductsWidget","expensesWidget","staffPerformanceWidget"].filter(e=>m(e));L(e),R.current=e}}catch(e){}};c.useEffect(()=>{O()},[]),c.useEffect(()=>{const e=e=>{"dashboard_widget_order"===e.key&&O()},t=()=>{O()};return window.addEventListener("storage",e),window.addEventListener("widgetOrderUpdated",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("widgetOrderUpdated",t)}},[]),c.useEffect(()=>{},[I]),c.useEffect(()=>{(async()=>{await C(async()=>{if(A(!0),null==r?void 0:r.id){const e=b(),t=localStorage.getItem("current_branch_id");null!==N?localStorage.setItem("current_branch_id",N):localStorage.removeItem("current_branch_id");const s=await be.getDashboardStats(r.id,e.startDate,e.endDate);t?localStorage.setItem("current_branch_id",t):localStorage.removeItem("current_branch_id"),z(s)}A(!1)},"Loading dashboard data")})()},[null==r?void 0:r.id,C,h,N]),c.useEffect(()=>{const e=setInterval(()=>{if((null==r?void 0:r.id)&&!D){const e=b(),t=localStorage.getItem("current_branch_id");null!==N?localStorage.setItem("current_branch_id",N):localStorage.removeItem("current_branch_id"),be.getDashboardStats(r.id,e.startDate,e.endDate).then(e=>{z(e),t?localStorage.setItem("current_branch_id",t):localStorage.removeItem("current_branch_id")})}},3e5);return()=>clearInterval(e)},[null==r?void 0:r.id,D,h,N,b]);const B=e=>{try{i(e)}catch(t){w(t,"Navigation")}},V=[{id:"devices",title:"Devices",description:"Manage devices",icon:q,color:"from-indigo-500 to-indigo-600",path:"/devices"},{id:"addDevice",title:"Add Device",description:"New device",icon:k,color:"from-blue-500 to-blue-600",path:"/devices/new"},{id:"customers",title:"Customers",description:"Customer data",icon:_,color:"from-green-500 to-green-600",path:"/customers"},{id:"inventory",title:"Inventory",description:"Stock & parts",icon:T,color:"from-purple-500 to-purple-600",path:"/lats/unified-inventory"},{id:"appointments",title:"Appointments",description:"Scheduling",icon:y,color:"from-pink-500 to-pink-500",path:"/appointments"},{id:"purchaseOrders",title:"Purchase Orders",description:"Manage orders",icon:T,color:"from-orange-500 to-orange-600",path:"/lats/purchase-orders"},{id:"payments",title:"Payments",description:"Payment management",icon:$,color:"from-emerald-500 to-emerald-600",path:"/payments"},{id:"adGenerator",title:"Ad Generator",description:"Create product ads",icon:de,color:"from-rose-500 to-rose-600",path:"/ad-generator"},{id:"pos",title:"POS System",description:"Point of sale",icon:$,color:"from-cyan-500 to-cyan-600",path:"/pos"},{id:"reports",title:"Sales Reports",description:"View sales reports",icon:F,color:"from-violet-500 to-violet-600",path:"/lats/sales-reports"},{id:"employees",title:"Employees",description:"Manage staff",icon:_,color:"from-teal-500 to-teal-600",path:"/employees"},{id:"whatsapp",title:"WhatsApp",description:"WhatsApp chat",icon:Y,color:"from-green-500 to-green-600",path:"/lats/whatsapp-chat"},{id:"settings",title:"Settings",description:"System settings",icon:oe,color:"from-gray-500 to-gray-600",path:"/admin-settings"},{id:"search",title:"Search",description:"Global search",icon:me,color:"from-amber-500 to-amber-600",path:"/search"},{id:"loyalty",title:"Loyalty Program",description:"Customer loyalty",icon:Q,color:"from-yellow-500 to-yellow-600",path:"/lats/loyalty"},{id:"backup",title:"Backup",description:"Data backup",icon:P,color:"from-slate-500 to-slate-600",path:"/backup-management"},{id:"sms",title:"SMS Center",description:"SMS management",icon:xe,color:"from-blue-500 to-blue-600",path:"/sms"},{id:"bulkSms",title:"Bulk SMS",description:"Mass messaging",icon:xe,color:"from-indigo-500 to-indigo-600",path:"/sms/bulk"},{id:"smsLogs",title:"SMS Logs",description:"Message history",icon:xe,color:"from-purple-500 to-purple-600",path:"/sms/logs"},{id:"smsSettings",title:"SMS Settings",description:"SMS configuration",icon:oe,color:"from-gray-500 to-gray-600",path:"/sms/settings"},{id:"excelImport",title:"Excel Import",description:"Data import",icon:ge,color:"from-emerald-500 to-emerald-600",path:"/excel-import"},{id:"excelTemplates",title:"Excel Templates",description:"Template downloads",icon:ue,color:"from-cyan-500 to-cyan-600",path:"/excel-templates"},{id:"productExport",title:"Product Export",description:"Export products",icon:ue,color:"from-pink-500 to-pink-600",path:"/product-export"},{id:"customerImport",title:"Customer Import",description:"Import customers",icon:ge,color:"from-rose-500 to-rose-600",path:"/customers/import"},{id:"userManagement",title:"User Management",description:"User administration",icon:he,color:"from-indigo-500 to-indigo-600",path:"/users"},{id:"databaseSetup",title:"Database Setup",description:"Database configuration",icon:W,color:"from-slate-500 to-slate-600",path:"/database-setup"},{id:"integrationSettings",title:"Integration Settings",description:"System integrations",icon:oe,color:"from-gray-500 to-gray-600",path:"/integration-settings"},{id:"integrationsTest",title:"Integrations Test",description:"Test integrations",icon:E,color:"from-orange-500 to-orange-600",path:"/integrations-test"},{id:"aiTraining",title:"AI Training",description:"AI training system",icon:pe,color:"from-purple-500 to-purple-600",path:"/ai-training"},{id:"bluetoothPrinter",title:"Bluetooth Printer",description:"Printer management",icon:fe,color:"from-blue-500 to-blue-600",path:"/bluetooth-printer"},{id:"categoryManagement",title:"Category Management",description:"Product categories",icon:ne,color:"from-green-500 to-green-600",path:"/category-management"},{id:"supplierManagement",title:"Supplier Management",description:"Supplier management",icon:ye,color:"from-indigo-500 to-indigo-600",path:"/supplier-management"},{id:"storeLocations",title:"Store Locations",description:"Location management",icon:je,color:"from-red-500 to-red-600",path:"/store-locations"},{id:"reminders",title:"Reminders",description:"Reminder system",icon:S,color:"from-yellow-500 to-yellow-600",path:"/reminders"},{id:"mobile",title:"Mobile",description:"Mobile features",icon:q,color:"from-cyan-500 to-cyan-600",path:"/mobile"},{id:"myAttendance",title:"My Attendance",description:"Personal attendance",icon:S,color:"from-blue-500 to-blue-600",path:"/my-attendance"}].filter(e=>n(e.id));return t.jsx(d,{pageName:"Dashboard",showDetails:!0,children:t.jsx("div",{className:"p-4 sm:p-6 h-full overflow-y-auto",children:t.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:p((null==r?void 0:r.role)||"user")}),t.jsx("p",{className:"text-gray-600 mt-1",children:f((null==r?void 0:r.role)||"user",(null==r?void 0:r.name)||(null==r?void 0:r.email))})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[((null==(s=null==r?void 0:r.permissions)?void 0:s.includes("all"))||(null==(a=null==r?void 0:r.permissions)?void 0:a.includes("manage_users"))||"admin"===(null==r?void 0:r.role))&&t.jsx(Qe,{onBranchChange:e=>{v(e)},defaultToCurrent:!0}),t.jsx(He,{value:h,onChange:j}),t.jsxs("button",{onClick:()=>B("/devices/new"),className:"flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm",children:[t.jsx(k,{size:18}),"Add Device"]}),t.jsx("button",{onClick:async()=>{if(null==r?void 0:r.id){A(!0);try{const e=b(),t=localStorage.getItem("current_branch_id");null!==N?localStorage.setItem("current_branch_id",N):localStorage.removeItem("current_branch_id");const s=await be.getDashboardStats(r.id,e.startDate,e.endDate);z(s),t?localStorage.setItem("current_branch_id",t):localStorage.removeItem("current_branch_id")}catch(e){w(e,"Refreshing dashboard")}finally{A(!1)}}},disabled:D,className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors text-sm disabled:opacity-50",children:t.jsx(ae,{size:18})})]})]}),!D&&!g&&V.length>0&&t.jsxs("div",{className:"bg-white rounded-2xl p-7",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(ce,{className:"w-5 h-5 text-gray-700"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Quick Actions"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Access frequently used features"})]})]}),t.jsx("div",{className:"quick-actions flex flex-wrap gap-4 md:flex-row md:gap-8 flex-col gap-2 w-full",children:V.map((e,s)=>{const a=e.icon;return t.jsxs("button",{onClick:()=>B(e.path),className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors text-center group w-full md:flex-1 md:min-w-[150px]",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-900 flex items-center justify-center mx-auto mb-3",children:t.jsx(a,{className:"w-5 h-5 text-white"})}),t.jsx("h4",{className:"font-medium text-sm text-gray-900 mb-1",children:e.title}),t.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:e.description})]},s)})})]}),D&&t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#3498db]"}),t.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading dashboard..."})]}),!D&&!g&&M&&(()=>{const e={revenueTrendChart:ht,salesChart:wt,deviceStatusChart:pt,appointmentsTrendChart:ft,purchaseOrderChart:vt,paymentMethodsChart:St,analyticsWidget:at,salesByCategoryChart:_t,profitMarginChart:kt,stockLevelChart:yt,performanceMetricsChart:bt,customerActivityChart:jt},s=(R.current.length>0?R.current:I).filter(t=>m(t)&&e[t]);if(0===s.length)return null;const a=[];for(let t=0;t<s.length;t+=3)a.push(s.slice(t,t+3));return t.jsx(t.Fragment,{children:a.map((s,a)=>{const r=u(s);return t.jsx("div",{className:"dashboard-cards grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 w-full",style:{alignItems:"stretch"},children:r.widgets.map(({key:s,gridColumn:a,expanded:r,repositioned:l})=>{const i=e[s];if(!i)return null;return t.jsxs("div",{style:{height:"100%",transition:"all 0.3s ease",...r&&{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",borderRadius:"12px"},...l&&{background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",borderRadius:"12px"}},className:`dashboard-card ${n=a,n.includes("span 2")?"md:col-span-2 lg:col-span-2":n.includes("span 3")?"md:col-span-2 lg:col-span-3":"md:col-span-1"} relative ${r||l?"shadow-lg":""}`,children:[t.jsx(i,{className:"h-full"}),r&&t.jsx("div",{className:"absolute top-2 right-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full z-10",children:"Auto-Expanded"}),l&&!r&&t.jsx("div",{className:"absolute top-2 right-2 bg-amber-500 text-white text-xs px-2 py-1 rounded-full z-10",children:"Moved to Fill Gap"})]},s);var n})},`chart-row-${a}`)})})})(),!D&&!g&&M&&(()=>{const e={appointmentWidget:et,employeeWidget:Xe,notificationWidget:Je,financialWidget:st,salesFunnelChart:Nt,customerInsightsWidget:ct,serviceWidget:rt,reminderWidget:lt,salesWidget:mt,topProductsWidget:xt,expensesWidget:gt,purchaseOrderWidget:dt,chatWidget:ot,staffPerformanceWidget:ut,systemHealthWidget:it,inventoryWidget:tt,activityFeedWidget:nt},s=(R.current.length>0?R.current:I).filter(t=>m(t)&&e[t]);if(0===s.length)return null;const a=[];for(let t=0;t<s.length;t+=3)a.push(s.slice(t,t+3));return t.jsx("div",{className:"space-y-6",children:a.map((s,a)=>{const r=u(s);return t.jsx("div",{className:"dashboard-cards grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 w-full",style:{alignItems:"stretch"},children:r.widgets.map(({key:s,gridColumn:a,expanded:r,repositioned:l})=>{const i=e[s];if(!i)return null;return t.jsxs("div",{style:{height:"100%",transition:"all 0.3s ease",...r&&{background:"linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)",borderRadius:"12px"},...l&&{background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",borderRadius:"12px"}},className:`dashboard-card ${n=a,n.includes("span 2")?"md:col-span-2 lg:col-span-2":n.includes("span 3")?"md:col-span-2 lg:col-span-3":"md:col-span-1"} relative ${r||l?"shadow-lg":""}`,children:[t.jsx(i,{className:"h-full"}),r&&t.jsx("div",{className:"absolute top-2 right-2 bg-cyan-500 text-white text-xs px-2 py-1 rounded-full z-10",children:"Auto-Expanded"}),l&&!r&&t.jsx("div",{className:"absolute top-2 right-2 bg-amber-500 text-white text-xs px-2 py-1 rounded-full z-10",children:"Moved to Fill Gap"})]},s);var n})},`widget-row-${a}`)})})})()]})})})},Tt=()=>t.jsx(Ye,{children:t.jsx(Ct,{})});export{Tt as default};
