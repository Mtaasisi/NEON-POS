import{j as e,s as t}from"./index-222cfb29.js";import{r as s,R as a,b as r}from"./vendor-a2ff445a.js";import"./supabase-460661f2.js";import{x as i,i as l,V as n,bR as c,c as d,$ as o,Q as x,O as m,l as p,z as u,X as h}from"./ui-551a39a6.js";import{R as g}from"./robustImageService-2422a1f9.js";import{format as b}from"./format-0f0b2647.js";import{g as y,f,a as j}from"./variantUtils-422e46bb.js";import{p as v,f as N}from"./specificationUtils-8355804c.js";import{u as w}from"./useMobileBranch-1aee679b.js";import{d as k,a as P}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";const _=()=>{var _,C,S;const{productId:q}=k(),z=P(),{currentBranch:$}=w(),[D,I]=s.useState(null),[Q,U]=s.useState(!0),[A,R]=s.useState("overview"),[W,E]=s.useState([]),[F,B]=s.useState(0),[O,L]=s.useState(!1),[M,T]=s.useState(!1),[K,V]=s.useState(!1),J=s.useRef(null),[Y,G]=s.useState(!1),[H,Z]=s.useState(""),[X,ee]=s.useState(null);s.useEffect(()=>{const e=async()=>{var e;if(q){U(!0);try{const{data:s,error:a}=await t.from("lats_products").select("\n            *,\n            category:lats_categories(id, name),\n            variants:lats_product_variants(id, variant_name, sku, cost_price, selling_price, quantity, min_quantity, is_active, variant_attributes)\n          ").eq("id",q).single();if(a)throw a;if(!s)throw new Error("Product not found");if($&&s.branch_id&&s.branch_id!==$.id&&!s.is_shared)return u.error("Product not found in current branch"),void z("/mobile/inventory");const r={...s,price:s.selling_price||0,cost_price:s.cost_price,stock_quantity:s.quantity||0,low_stock_threshold:s.min_stock_level,status:s.is_active?"active":"inactive",category:(null==(e=s.category)?void 0:e.name)||"Uncategorized",variants:Array.isArray(s.variants)?s.variants.map(e=>({id:e.id,name:e.variant_name,sku:e.sku,costPrice:e.cost_price||0,sellingPrice:e.selling_price||0,quantity:e.quantity||0,minQuantity:e.min_quantity||0,isActive:e.is_active,attributes:e.variant_attributes||{}})):[],totalQuantity:Array.isArray(s.variants)?s.variants.reduce((e,t)=>e+(t.quantity||0),0):0};I(r)}catch(s){u.error("Failed to load product")}finally{U(!1)}}};e();const s=()=>{e()};return window.addEventListener("branchChanged",s),()=>{window.removeEventListener("branchChanged",s)}},[q,$,z]),s.useEffect(()=>{q&&(async()=>{if(q)try{L(!0);const e=await g.getProductImages(q);E(e)}catch(e){}finally{L(!1)}})()},[q]);const te=a.useMemo(()=>{var e,t;const s=null==(e=null==D?void 0:D.variants)?void 0:e[0];return(null==(t=null==s?void 0:s.attributes)?void 0:t.specification)?v(s.attributes.specification):{}},[null==D?void 0:D.variants]),se=(()=>{if(!(null==D?void 0:D.variants)||0===D.variants.length)return null;const e=D.variants.find(e=>(e.quantity||0)>0);if(e)return e;const t=[...D.variants].sort((e,t)=>(t.sellingPrice||0)-(e.sellingPrice||0))[0];return t&&t.sellingPrice>0?t:D.variants[0]})(),ae=(null==se?void 0:se.costPrice)?((se.sellingPrice-se.costPrice)/se.sellingPrice*100).toFixed(1):"N/A",re=async(e,s)=>{var a,r;if(!D)return;const i=null==(a=D.variants)?void 0:a.find(t=>t.id===e);if(!i)return;const l=Math.max(0,i.quantity+s);try{const{error:a}=await t.from("lats_product_variants").update({quantity:l}).eq("id",e);if(a)throw a;I({...D,variants:null==(r=D.variants)?void 0:r.map(t=>t.id===e?{...t,quantity:l}:t),totalQuantity:(D.totalQuantity||0)+s}),u.success("Stock "+(s>0?"increased":"decreased"))}catch(n){u.error("Failed to update stock")}};return Q?e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Loading product..."})]})})}):D?e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("button",{onClick:()=>z("/mobile/inventory"),className:"flex items-center gap-1 text-blue-500",children:[e.jsx(l,{size:20,strokeWidth:2}),e.jsx("span",{className:"text-[17px]",children:"Back"})]}),e.jsxs("h1",{className:"text-[17px] font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2",children:[D.name.slice(0,20),D.name.length>20?"...":""]}),e.jsx("button",{onClick:()=>z(`/mobile/inventory/${q}/edit`),className:"text-blue-500 text-[17px]",children:"Edit"})]})}),e.jsx("div",{className:"bg-white px-3 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("button",{onClick:()=>{if(D&&se)try{localStorage.setItem("pos_quick_add",JSON.stringify({productId:D.id,variantId:se.id,timestamp:Date.now()})),u.success("Redirecting to POS..."),setTimeout(()=>z("/mobile/pos"),500)}catch(e){u.error("Failed to add to cart")}},className:"flex flex-col items-center gap-2 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-50 rounded-2xl flex items-center justify-center",children:e.jsx(n,{size:24,className:"text-blue-500",strokeWidth:2})}),e.jsx("span",{className:"text-[11px] text-gray-700 font-medium",children:"Add to POS"})]}),e.jsxs("button",{onClick:()=>{if(D&&se)try{const e=`${window.location.origin}/mobile/inventory/${D.id}`,t=`Product: ${D.name}\nSKU: ${se.sku||"N/A"}\nPrice: ${b.money(se.sellingPrice||0)}\nDetails: ${e}`,s=`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(t)}`;Z(s),G(!0),u.success("QR Code generated!")}catch(e){u.error("Failed to generate QR code")}},className:"flex flex-col items-center gap-2 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-purple-50 rounded-2xl flex items-center justify-center",children:e.jsx(c,{size:24,className:"text-purple-500",strokeWidth:2})}),e.jsx("span",{className:"text-[11px] text-gray-700 font-medium",children:"QR Code"})]}),e.jsxs("button",{onClick:()=>{if(!D||!se)return;const e=`Product: ${D.name}\nSKU: ${se.sku||"N/A"}\nPrice: ${b.money(se.sellingPrice||0)}\nStock: ${D.totalQuantity||0} units\nCategory: ${D.category}\nStatus: ${D.status}`.trim();navigator.clipboard.writeText(e),u.success("Product info copied to clipboard!")},className:"flex flex-col items-center gap-2 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-green-50 rounded-2xl flex items-center justify-center",children:e.jsx(d,{size:24,className:"text-green-500",strokeWidth:2})}),e.jsx("span",{className:"text-[11px] text-gray-700 font-medium",children:"Copy Info"})]}),e.jsxs("button",{onClick:async()=>{if(D&&window.confirm(`Are you sure you want to delete "${D.name}"?`))try{const{error:e}=await t.from("lats_products").delete().eq("id",D.id);if(e)throw e;u.success("Product deleted successfully"),z("/mobile/inventory")}catch(e){u.error("Failed to delete product")}},className:"flex flex-col items-center gap-2 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-red-50 rounded-2xl flex items-center justify-center",children:e.jsx(o,{size:24,className:"text-red-500",strokeWidth:2})}),e.jsx("span",{className:"text-[11px] text-gray-700 font-medium",children:"Delete"})]})]})}),e.jsx("div",{className:"bg-white px-4 py-3",children:e.jsxs("div",{className:"bg-gray-100 rounded-lg p-0.5 flex",children:[e.jsx("button",{onClick:()=>R("overview"),className:"flex-1 py-2 text-center text-[12px] font-medium rounded-md transition-all "+("overview"===A?"bg-white text-gray-900 font-semibold shadow-sm":"text-gray-600"),children:"Overview"}),e.jsx("button",{onClick:()=>R("variants"),className:"flex-1 py-2 text-center text-[12px] font-medium rounded-md transition-all "+("variants"===A?"bg-white text-gray-900 font-semibold shadow-sm":"text-gray-600"),children:"Variants"}),e.jsx("button",{onClick:()=>R("details"),className:"flex-1 py-2 text-center text-[12px] font-medium rounded-md transition-all "+("details"===A?"bg-white text-gray-900 font-semibold shadow-sm":"text-gray-600"),children:"Details"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto pb-20",children:[e.jsxs("div",{className:"w-full aspect-square bg-gray-100 flex items-center justify-center relative overflow-hidden border-b border-gray-200",children:[O&&0===W.length?e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}):W.length>0?e.jsx("img",{src:(null==(_=W[F])?void 0:_.url)||(null==(C=W[F])?void 0:C.thumbnailUrl),alt:D.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>V(!0)}):e.jsx(i,{size:64,className:"text-gray-300",strokeWidth:1.5}),e.jsx("input",{ref:J,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files;if(t&&0!==t.length&&q){T(!0);try{const e=t[0];if(!e.type.startsWith("image/"))return void u.error("Please select an image file");if(e.size>10485760)return void u.error("Image size must be less than 10MB");u.loading("Uploading image...",{id:"image-upload"});let a=null;try{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);a=t.id&&"system"!==t.id?t.id:null}}catch(s){}const r=await g.uploadImage(e,q,a,0===W.length);if(!r.success)throw new Error(r.error||"Upload failed");const i=await g.getProductImages(q);E(i),u.success("Image uploaded successfully!",{id:"image-upload"}),J.current&&(J.current.value="")}catch(a){const e=a instanceof Error?a.message:"Failed to upload image";u.error(e,{id:"image-upload"})}finally{T(!1)}}},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=J.current)?void 0:e.click()},disabled:M,className:"absolute bottom-4 right-4 p-4 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-full shadow-2xl hover:from-blue-600 hover:to-blue-700 active:scale-95 disabled:opacity-50 transition-all",style:{boxShadow:"0 10px 25px rgba(59, 130, 246, 0.4)"},children:M?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}):e.jsx(x,{size:22,strokeWidth:3})})]}),"overview"===A&&e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"px-4 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-green-50 rounded-xl p-3 text-center border border-green-100",children:[e.jsx("div",{className:"text-[18px] font-bold text-green-600",children:b.money((null==se?void 0:se.sellingPrice)||0).replace("TSh ","")}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-1 uppercase tracking-wide",children:"Price"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 text-center border border-blue-100",children:[e.jsx("div",{className:"text-[18px] font-bold text-blue-600",children:D.totalQuantity||0}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-1 uppercase tracking-wide",children:"Stock"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-center border border-gray-200",children:[e.jsx("div",{className:"text-[18px] font-bold text-gray-900",children:(null==(S=D.variants)?void 0:S.length)||0}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-1 uppercase tracking-wide",children:"Variants"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 text-center border border-purple-100",children:[e.jsxs("div",{className:"text-[18px] font-bold text-purple-600",children:[ae,"%"]}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-1 uppercase tracking-wide",children:"Margin"})]})]})}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Name"}),e.jsx("span",{className:"text-gray-900 text-[15px] text-right font-medium max-w-[60%]",children:D.name})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"SKU"}),e.jsx("span",{className:"text-gray-900 text-[15px] font-mono",children:(null==se?void 0:se.sku)||"N/A"})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Category"}),e.jsx("span",{className:"text-gray-900 text-[15px]",children:D.category})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Selling Price"}),e.jsx("span",{className:"text-green-600 text-[15px] font-semibold",children:b.money((null==se?void 0:se.sellingPrice)||0)})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Cost Price"}),e.jsx("span",{className:"text-red-600 text-[15px] font-semibold",children:b.money((null==se?void 0:se.costPrice)||0)})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Profit per Unit"}),e.jsx("span",{className:"text-blue-600 text-[15px] font-semibold",children:b.money(((null==se?void 0:se.sellingPrice)||0)-((null==se?void 0:se.costPrice)||0))})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Profit Margin"}),e.jsxs("span",{className:"text-purple-600 text-[15px] font-semibold",children:[ae,"%"]})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Total Stock"}),e.jsxs("span",{className:"text-[15px] font-semibold "+(0===(D.totalQuantity||0)?"text-red-600":(D.totalQuantity||0)<=(D.low_stock_threshold||5)?"text-yellow-600":"text-green-600"),children:[D.totalQuantity||0," units"]})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Status"}),e.jsx("span",{className:"text-[15px] font-medium capitalize "+("active"===D.status?"text-green-600":"text-gray-600"),children:D.status})]}),Object.keys(te).length>0&&Object.entries(te).slice(0,6).map(([t,s])=>{const a=N(t,s);return e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px] capitalize",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-gray-900 text-[15px] font-medium",children:a})]},t)}),D.description&&e.jsxs("div",{className:"px-5 py-4 border-b border-gray-200",children:[e.jsx("div",{className:"text-gray-900 text-[15px] mb-2",children:"Description"}),e.jsx("div",{className:"text-gray-600 text-[15px] leading-relaxed",children:D.description})]})]}),"variants"===A&&e.jsx("div",{className:"bg-[#f2f2f7] p-4 space-y-3",children:D.variants&&D.variants.length>0?D.variants.map((s,a)=>{const r=y(s),i=f(s),l=X===s.id;return e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-4 py-3 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[17px] font-bold text-gray-900",children:j(s,`Variant ${a+1}`)}),r&&e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-bold uppercase ${r.className}`,children:r.text})]}),e.jsx("p",{className:"text-[13px] text-gray-500 font-mono",children:s.sku})]}),e.jsx("button",{onClick:()=>(async(e,s)=>{if(confirm(`Delete variant "${s}"?`))try{const{error:s}=await t.from("lats_product_variants").delete().eq("id",e);if(s)throw s;u.success("Variant deleted!"),window.location.reload()}catch(a){u.error(`Failed: ${a.message}`)}})(s.id,j(s)),className:"text-red-500 text-[15px] font-semibold",children:"Delete"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3",children:[e.jsxs("div",{className:"bg-white rounded-xl p-2 text-center shadow-sm",children:[e.jsx("div",{className:"text-[16px] font-bold text-green-600",children:b.money(s.sellingPrice||0).replace("TSh ","")}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-0.5 uppercase tracking-wide",children:"Price"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-2 text-center shadow-sm",children:[e.jsx("div",{className:"text-[16px] font-bold "+(0===(s.quantity||0)?"text-red-600":(s.quantity||0)<=(s.minQuantity||0)?"text-yellow-600":"text-green-600"),children:s.quantity||0}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-0.5 uppercase tracking-wide",children:"Stock"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-2 text-center shadow-sm",children:[e.jsx("div",{className:"text-[16px] font-bold text-blue-600",children:b.money((s.sellingPrice||0)-(s.costPrice||0)).replace("TSh ","")}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-0.5 uppercase tracking-wide",children:"Profit"})]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-xl p-3",children:[e.jsx("span",{className:"text-[15px] text-gray-700 font-medium",children:"Adjust Stock"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>re(s.id,-1),className:"w-9 h-9 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center active:scale-95 transition-all shadow-sm",children:e.jsx(m,{size:16,strokeWidth:3})}),e.jsx("span",{className:"text-[18px] font-bold text-gray-900 w-12 text-center",children:s.quantity||0}),e.jsx("button",{onClick:()=>re(s.id,1),className:"w-9 h-9 rounded-full bg-blue-500 text-white hover:bg-blue-600 flex items-center justify-center active:scale-95 transition-all shadow-sm",children:e.jsx(x,{size:16,strokeWidth:3})})]})]})}),i.length>0&&e.jsxs("div",{className:"px-4 pb-3",children:[e.jsx("button",{onClick:()=>ee(l?null:s.id),className:"w-full py-2.5 text-blue-500 text-[15px] font-semibold hover:bg-gray-50 active:bg-gray-100 rounded-lg transition-colors",children:l?"▲ Hide Details":"▼ Show Details"}),l&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-2.5",children:i.map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[14px] text-gray-600 capitalize",children:t.label}),e.jsx("span",{className:"text-[15px] font-semibold text-gray-900",children:t.value})]},s))})]})]},s.id)}):e.jsxs("div",{className:"px-5 py-12 text-center bg-white rounded-2xl",children:[e.jsx(p,{className:"w-16 h-16 text-gray-300 mx-auto mb-3",strokeWidth:1.5}),e.jsx("p",{className:"text-[16px] text-gray-500 font-medium",children:"No variants found"}),e.jsx("p",{className:"text-[14px] text-gray-400 mt-1",children:"Add variants to manage different options"})]})}),"details"===A&&e.jsxs("div",{className:"bg-white",children:[e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Product ID"}),e.jsx("span",{className:"text-gray-900 text-[15px] font-mono text-right max-w-[60%] truncate",children:D.id})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"SKU"}),e.jsx("span",{className:"text-gray-900 text-[15px] font-mono",children:(null==se?void 0:se.sku)||"N/A"})]}),D.barcode&&e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Barcode"}),e.jsx("span",{className:"text-gray-900 text-[15px] font-mono",children:D.barcode})]}),D.brand&&e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Brand"}),e.jsx("span",{className:"text-gray-900 text-[15px]",children:D.brand})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Created"}),e.jsx("span",{className:"text-gray-900 text-[15px]",children:new Date(D.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Last Updated"}),e.jsx("span",{className:"text-gray-900 text-[15px]",children:new Date(D.updated_at).toLocaleDateString()})]}),D.low_stock_threshold&&e.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[e.jsx("span",{className:"text-gray-900 text-[15px]",children:"Low Stock Alert"}),e.jsxs("span",{className:"text-gray-900 text-[15px]",children:[D.low_stock_threshold," units"]})]})]})]}),Y&&r.createPortal(e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:()=>G(!1),children:e.jsxs("div",{className:"w-[90%] max-w-sm bg-white rounded-3xl overflow-hidden shadow-2xl animate-scale-up",onClick:e=>e.stopPropagation(),children:[e.jsx("div",{className:"px-6 pt-6 pb-4 border-b border-gray-100",children:e.jsx("h3",{className:"text-[22px] font-bold text-gray-900 text-center",children:"QR Code"})}),e.jsxs("div",{className:"p-6 text-center space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 inline-block shadow-sm",children:e.jsx("img",{src:H,alt:"QR Code",className:"w-56 h-56 object-contain"})}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-[16px] font-semibold text-gray-900 mb-2",children:D.name}),e.jsxs("p",{className:"font-mono text-[14px] text-gray-600",children:["SKU: ",null==se?void 0:se.sku]}),e.jsx("p",{className:"text-[15px] text-gray-600 mt-2",children:b.money((null==se?void 0:se.sellingPrice)||0)})]})]}),e.jsxs("div",{className:"px-6 pb-6 space-y-2",children:[e.jsx("button",{onClick:()=>{const e=document.createElement("a");e.href=H,e.download=`${D.name.replace(/[^a-zA-Z0-9]/g,"_")}_QR.png`,e.click(),u.success("Downloaded!")},className:"w-full py-4 bg-blue-500 text-white rounded-xl font-semibold text-[17px] hover:bg-blue-600 active:bg-blue-700 transition-all shadow-sm",children:"Download QR Code"}),e.jsx("button",{onClick:()=>G(!1),className:"w-full py-3 text-gray-700 rounded-xl font-medium text-[16px] hover:bg-gray-50 active:bg-gray-100 transition-colors",children:"Close"})]})]})}),document.body),K&&W.length>0&&r.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:()=>V(!1),children:e.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[95vh] flex flex-col animate-slide-up",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 sticky top-0 bg-white z-10",children:[e.jsx("button",{onClick:()=>V(!1),className:"text-blue-500 text-[17px]",children:"Done"}),e.jsxs("h3",{className:"text-[17px] font-semibold text-gray-900",children:["Gallery (",W.length,")"]}),e.jsx("div",{className:"w-12"})," "]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:W.map((s,a)=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"aspect-square relative rounded-2xl overflow-hidden bg-gray-100 border border-gray-200 shadow-sm",children:[e.jsx("img",{src:s.url,alt:`${D.name} ${a+1}`,className:"w-full h-full object-cover cursor-pointer hover:opacity-90 transition-opacity active:scale-95",onClick:()=>{B(a),V(!1)}}),s.isPrimary&&e.jsx("div",{className:"absolute top-2 left-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-[10px] px-2.5 py-1 rounded-full font-bold shadow-md uppercase tracking-wide",children:"Primary"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this image?"))try{u.loading("Deleting image...",{id:"delete-image"});const{error:s}=await t.from("product_images").delete().eq("id",e);if(s)throw s;const a=W.find(t=>t.id===e);if(null==a?void 0:a.url){const e=a.url.split("/").pop();e&&await t.storage.from("product-images").remove([e])}const r=W.filter(t=>t.id!==e);E(r),F>=r.length&&B(Math.max(0,r.length-1)),u.success("Image deleted successfully!",{id:"delete-image"})}catch(s){u.error("Failed to delete image",{id:"delete-image"})}})(s.id)},className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full shadow-lg hover:bg-red-600 active:bg-red-700 active:scale-95 transition-all",children:e.jsx(h,{size:14,strokeWidth:3})})]}),e.jsxs("div",{className:"text-center mt-2 text-[12px] text-gray-500",children:["Image ",a+1]})]},s.id))})})]})}),document.body)]}):e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(i,{size:48,className:"mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Product not found"}),e.jsx("button",{onClick:()=>z("/mobile/inventory"),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg",children:"Back to Inventory"})]})})})};if("undefined"!=typeof document&&!document.getElementById("mobile-product-detail-styles")){const e=document.createElement("style");e.id="mobile-product-detail-styles",e.textContent="\n  @keyframes slideUp {\n    from {\n      transform: translateY(100%);\n    }\n    to {\n      transform: translateY(0);\n    }\n  }\n  @keyframes scaleUp {\n    from {\n      transform: scale(0.95);\n      opacity: 0;\n    }\n    to {\n      transform: scale(1);\n      opacity: 1;\n    }\n  }\n  .animate-slide-up {\n    animation: slideUp 0.3s ease-out;\n  }\n  .animate-scale-up {\n    animation: scaleUp 0.25s ease-out;\n  }\n",document.head.appendChild(e)}export{_ as default};
