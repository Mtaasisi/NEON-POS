import{j as e,G as t,s as a,u as s,t as r,d as n,N as l}from"./index-222cfb29.js";import{r as i,R as c}from"./vendor-a2ff445a.js";import{P as o}from"./PageErrorBoundary-d0d559c5.js";import{u as d}from"./useErrorHandler-ea2ee44d.js";import{G as m}from"./GlassBadge-18f019e2.js";import{X as u,e as x,I as h,d as p,A as g,n as y,D as b,f,aA as j,x as v,t as N,aB as w,aC as _,av as S,m as k,ah as C,bu as D,ax as P,bg as T,aa as A,R,aj as F,y as E,V as $,Q as z,bd as I,bs as O,bt as M,u as L,q,bv as B,O as U,N as Z,aL as G,aM as V,bc as K,aZ as H,bb as W,bw as Y,$ as J,h as Q,ab as X,bx as ee,by as te,Z as ae,a5 as se,b4 as re,J as ne,Y as le,U as ie,H as ce,a4 as oe,aK as de,w as me,ay as ue,P as xe,au as he,aD as pe,c as ge,a8 as ye,bz as be,r as fe}from"./ui-551a39a6.js";import{M as je}from"./Modal-ccfa5014.js";import{u as ve}from"./useBodyScrollLock-0216d39f.js";import{paymentTrackingService as Ne}from"./paymentTrackingService-7b6db13e.js";import{f as we}from"./financialService-1702c0e7.js";import{_ as _e}from"./supabase-7e851d02.js";import{S as Se,g as ke,a as Ce,D as De,f as Pe,b as Te,P as Ae}from"./PaymentsPopupModal-70ab4c91.js";import{R as Re,B as Fe,C as Ee,X as $e,Y as ze,T as Ie,a as Oe,P as Me,b as Le,c as qe,L as Be,d as Ue,A as Ze,e as Ge,f as Ve}from"./charts-66cc82bb.js";import{G as Ke}from"./GlassSelect-3b56e5f5.js";import{G as He}from"./GlassInput-ba5c3c0d.js";import{E as We}from"./ExpenseManagement-035bea7d.js";import{format as Ye}from"./format-0f0b2647.js";import"./routing-a2f0f6d2.js";import"./utils-fb833cf6.js";import"./useSuccessModal-e8b7d685.js";const Je=({isOpen:a,onClose:s,onConfirm:r,title:n,message:l,type:i="warning",confirmText:c="Confirm",cancelText:o="Cancel",loading:d=!1})=>{if(ve(a),!a)return null;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[(()=>{switch(i){case"danger":return e.jsx(g,{className:"w-8 h-8 text-red-500"});case"success":return e.jsx(p,{className:"w-8 h-8 text-green-500"});case"info":return e.jsx(h,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(x,{className:"w-8 h-8 text-amber-500"})}})(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n})]}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",disabled:d,children:e.jsx(u,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"flex-1 px-6 pb-4 overflow-y-auto",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:l})}),e.jsxs("div",{className:"flex gap-3 justify-end p-6 pt-4 border-t border-gray-100 bg-white rounded-b-2xl",children:[e.jsx(t,{variant:"outline",onClick:s,disabled:d,size:"md",children:o}),e.jsx(t,{variant:(()=>{switch(i){case"danger":return"danger";case"success":return"success";case"info":return"primary";default:return"warning"}})(),onClick:r,loading:d,size:"md",children:c})]})]})]})};const Qe=new class{async getPaymentAnalytics(e,t){var a;try{const[s,r,n]=await Promise.all([this.calculatePaymentMetrics(e,t),this.getPaymentMethodSummary(e,t),this.getDailySummary(7)]),l=(null==(a=r[0])?void 0:a.method)||"M-Pesa",i="14:00-15:00",c=15.2,o=[];return parseFloat(s.successRate)<95&&o.push("Low payment success rate"),s.pendingAmount>.1*s.totalAmount&&o.push("High number of pending payments"),s.failedAmount>.05*s.totalAmount&&o.push("High payment failure rate"),{totalRevenue:s.totalAmount,totalTransactions:s.totalPayments,successRate:parseFloat(s.successRate),averageTicketSize:s.totalAmount/(s.totalPayments||1),topPaymentMethod:l,peakHour:i,growthRate:c,riskFactors:o}}catch(s){throw s}}async getPaymentInsights(){try{const e=await this.getPaymentAnalytics(),t=await this.calculateTrends(),a=[];e.successRate<95&&a.push("Consider reviewing payment provider configurations"),e.riskFactors.length>0&&a.push("Address identified risk factors to improve payment performance"),t.averageTicket<0&&a.push("Investigate reasons for declining average ticket size");const s=[];return e.successRate<95&&s.push({type:"warning",message:`Payment success rate is below 95% (${e.successRate}%)`,severity:"medium"}),e.riskFactors.length>2&&s.push({type:"error",message:"Multiple risk factors detected in payment system",severity:"high"}),{trends:t,recommendations:a,alerts:s}}catch(e){throw e}}async getPaymentProviders(){try{const{data:e,error:t}=await a.from("finance_accounts").select("*").eq("is_active",!0).eq("is_payment_method",!0).order("name");if(t)throw t;return(e||[]).map(e=>({id:e.id,name:e.name,type:e.type,status:e.is_active?"active":"inactive",performance:{successRate:95,averageResponseTime:2.5,totalTransactions:0,uptime:99},fees:{percentage:"mobile_money"===e.type?1.5:0,fixed:0,currency:e.currency||"TZS"},limits:{minAmount:100,maxAmount:"cash"===e.type?999999999:1e6,dailyLimit:1e7}}))}catch(e){throw e}}async testPaymentProvider(e){try{const t=Date.now(),{data:s,error:r}=await a.from("payment_providers").select("*").eq("id",e).single();if(r||!s)throw new Error("Provider not found");let n=!1,l="";switch(s.type){case"mobile_money":n=await this.testMobileMoneyProvider(s),l=n?"Mobile money provider test successful":"Mobile money provider test failed";break;case"card":n=await this.testCardProvider(s),l=n?"Card provider test successful":"Card provider test failed";break;case"bank":n=await this.testBankProvider(s),l=n?"Bank provider test successful":"Bank provider test failed";break;default:n=!1,l="Unknown provider type"}const i=Date.now()-t;return await a.from("payment_providers").update({last_tested:(new Date).toISOString(),test_status:n?"success":"failed"}).eq("id",e),{success:n,message:l,responseTime:i}}catch(t){return{success:!1,message:`Provider test failed: ${t instanceof Error?t.message:"Unknown error"}`,responseTime:0}}}async exportPaymentData(e,t){try{let s=a.from("customer_payments").select("*");(null==t?void 0:t.startDate)&&(s=s.gte("payment_date",t.startDate)),(null==t?void 0:t.endDate)&&(s=s.lte("payment_date",t.endDate)),(null==t?void 0:t.status)&&(s=s.eq("status",t.status)),(null==t?void 0:t.method)&&(s=s.eq("method",t.method));const{data:r,error:n}=await s;if(n)throw new Error(`Failed to fetch payment data: ${n.message}`);return{success:!0,downloadUrl:(await this.generateExportFile(r,e)).downloadUrl,message:`Payment data exported successfully in ${e.toUpperCase()} format`}}catch(s){return{success:!1,message:`Failed to export payment data: ${s instanceof Error?s.message:"Unknown error"}`}}}async getReconciliationData(e){try{const{data:t,error:s}=await a.from("customer_payments").select("*").gte("payment_date",`${e}T00:00:00`).lte("payment_date",`${e}T23:59:59`);if(s)throw new Error(`Failed to fetch payment data: ${s.message}`);const r=t.reduce((e,t)=>{const a=t.method;return e[a]||(e[a]={total:0,count:0}),e[a].total+=t.amount,e[a].count+=1,e},{}),n=Object.entries(r).map(([e,t])=>({method:e,expected:t.total,actual:t.total,variance:0,status:"reconciled"})),l={totalReconciled:n.filter(e=>"reconciled"===e.status).length,totalPending:n.filter(e=>"pending"===e.status).length,totalDiscrepancies:n.filter(e=>"discrepancy"===e.status).length,totalVariance:n.reduce((e,t)=>e+t.variance,0)};return{records:n,summary:l}}catch(t){throw t}}async calculatePaymentMetrics(e,t){const{paymentTrackingService:a}=await _e(()=>import("./paymentTrackingService-7b6db13e.js"),["assets/paymentTrackingService-7b6db13e.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]);return a.calculatePaymentMetrics(e,t)}async getPaymentMethodSummary(e,t){const{paymentTrackingService:a}=await _e(()=>import("./paymentTrackingService-7b6db13e.js"),["assets/paymentTrackingService-7b6db13e.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]);return a.getPaymentMethodSummary(e,t)}async getDailySummary(e){const{paymentTrackingService:t}=await _e(()=>import("./paymentTrackingService-7b6db13e.js"),["assets/paymentTrackingService-7b6db13e.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]);return t.getDailySummary(e)}async calculateTrends(){try{const e=new Date,t=new Date;t.setDate(e.getDate()-30);const[a,s]=await Promise.all([this.calculatePaymentMetrics(e.toISOString().split("T")[0],e.toISOString().split("T")[0]),this.calculatePaymentMetrics(t.toISOString().split("T")[0],t.toISOString().split("T")[0])]),r=s.totalAmount>0?(a.totalAmount-s.totalAmount)/s.totalAmount*100:0,n=s.totalPayments>0?(a.totalPayments-s.totalPayments)/s.totalPayments*100:0,l=parseFloat(s.successRate)>0?(parseFloat(a.successRate)-parseFloat(s.successRate))/parseFloat(s.successRate)*100:0,i=a.totalPayments>0?a.totalAmount/a.totalPayments:0,c=s.totalPayments>0?s.totalAmount/s.totalPayments:0,o=c>0?(i-c)/c*100:0;return{revenue:Math.round(100*r)/100,transactions:Math.round(100*n)/100,successRate:Math.round(100*l)/100,averageTicket:Math.round(100*o)/100}}catch(e){return{revenue:0,transactions:0,successRate:0,averageTicket:0}}}async testMobileMoneyProvider(e){try{return(await fetch(`${e.base_url}/test`,{method:"POST",headers:{Authorization:`Bearer ${e.api_key}`,"Content-Type":"application/json"},body:JSON.stringify({test:!0,amount:100})})).ok}catch(t){return!1}}async testCardProvider(e){try{return(await fetch(`${e.base_url}/test`,{method:"POST",headers:{Authorization:`Bearer ${e.api_key}`,"Content-Type":"application/json"},body:JSON.stringify({test:!0,amount:100})})).ok}catch(t){return!1}}async testBankProvider(e){try{return(await fetch(`${e.base_url}/test`,{method:"POST",headers:{Authorization:`Bearer ${e.api_key}`,"Content-Type":"application/json"},body:JSON.stringify({test:!0,amount:100})})).ok}catch(t){return!1}}async generateExportFile(e,t){try{const e=`payments_export_${Date.now()}.${t}`;return{downloadUrl:`/exports/${e}`}}catch(a){throw a}}};const Xe=new class{constructor(){this.cache=new Map,this.CACHE_DURATION=3e5}clearCache(){this.cache.clear()}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.CACHE_DURATION?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}async getPaymentProviders(){var e;try{const s="payment_providers",r=this.getCachedData(s);if(r)return r;let n,l=3;for(;l>0;)try{const{data:e,error:t}=await a.from("finance_accounts").select("*").eq("is_active",!0).eq("is_payment_method",!0).order("name",{ascending:!0});if(t)throw t;const r=(null==e?void 0:e.map(e=>({id:e.id,name:e.name,type:this.mapAccountTypeToProviderType(e.type),status:e.is_active?"active":"inactive",configuration:{apiKey:"",secretKey:"",webhookUrl:"",merchantId:"",terminalId:"",currency:e.currency||"TZS",fees:{percentage:this.getDefaultFeePercentage(e.type),fixed:this.getDefaultFixedFee(e.type),minimum:this.getDefaultMinAmount(e.type),maximum:this.getDefaultMaxAmount(e.type)},limits:{daily:this.getDefaultDailyLimit(e.type),monthly:this.getDefaultMonthlyLimit(e.type),perTransaction:this.getDefaultMaxAmount(e.type)},supportedMethods:[e.name],processingTime:this.getDefaultProcessingTime(e.type),settlementTime:this.getDefaultSettlementTime(e.type)},metadata:{description:e.payment_description||e.notes||"",website:"",supportEmail:"",supportPhone:"",documentation:""},performance:{successRate:this.getDefaultSuccessRate(e.type),averageResponseTime:this.getDefaultResponseTime(e.type),totalTransactions:0,totalVolume:0,lastUsed:e.updated_at||(new Date).toISOString()},createdAt:e.created_at||(new Date).toISOString(),updatedAt:e.updated_at||(new Date).toISOString(),createdBy:"system",updatedBy:void 0})))||[];return this.setCachedData(s,r),r}catch(t){n=t,l--,l>0&&await new Promise(e=>setTimeout(e,1e3))}const i=null==(e=this.cache.get(s))?void 0:e.data;if(i)return i;throw n}catch(t){return[]}}mapAccountTypeToProviderType(e){switch(null==e?void 0:e.toLowerCase()){case"mobile_money":case"mpesa":case"airtel_money":default:return"mobile_money";case"bank":case"bank_transfer":return"bank_transfer";case"card":case"credit_card":case"debit_card":return"card_processor";case"cash":return"cash"}}getDefaultFeePercentage(e){switch(null==e?void 0:e.toLowerCase()){case"cash":return 0;case"mobile_money":return 1.5;case"credit_card":return 2.5;case"bank":return.5;default:return 1}}getDefaultFixedFee(e){switch(null==e?void 0:e.toLowerCase()){case"cash":case"mobile_money":case"bank":default:return 0;case"credit_card":return 50}}getDefaultMinAmount(e){switch(null==e?void 0:e.toLowerCase()){case"cash":return 0;case"mobile_money":case"credit_card":default:return 100;case"bank":return 1e3}}getDefaultMaxAmount(e){switch(null==e?void 0:e.toLowerCase()){case"cash":return 999999999;case"mobile_money":default:return 1e6;case"credit_card":return 2e6;case"bank":return 5e6}}getDefaultDailyLimit(e){switch(null==e?void 0:e.toLowerCase()){case"cash":return 999999999;case"mobile_money":default:return 1e7;case"credit_card":return 2e7;case"bank":return 5e7}}getDefaultMonthlyLimit(e){return 30*this.getDefaultDailyLimit(e)}getDefaultProcessingTime(e){switch(null==e?void 0:e.toLowerCase()){case"cash":return"Instant";case"mobile_money":default:return"2-5 seconds";case"credit_card":return"3-10 seconds";case"bank":return"1-3 business days"}}getDefaultSettlementTime(e){switch(null==e?void 0:e.toLowerCase()){case"cash":return"Instant";case"mobile_money":case"bank":default:return"1-3 business days";case"credit_card":return"2-5 business days"}}getDefaultSuccessRate(e){switch(null==e?void 0:e.toLowerCase()){case"cash":return 100;case"mobile_money":return 98.5;case"credit_card":return 97;case"bank":return 99.2;default:return 95}}getDefaultResponseTime(e){switch(null==e?void 0:e.toLowerCase()){case"cash":return 0;case"mobile_money":default:return 2.5;case"credit_card":return 4;case"bank":return 5}}async getActivePaymentProviders(){try{return(await this.getPaymentProviders()).filter(e=>"active"===e.status)}catch(e){return[]}}async getPaymentProvidersWithRealMetrics(){try{const e=await this.getPaymentProviders();return await Promise.all(e.map(async e=>{const t=await this.calculateRealPerformanceMetrics(e.id);return{...e,performance:{...e.performance,...t}}}))}catch(e){return[]}}async getPaymentProvider(e){try{const{data:t,error:s}=await a.from("finance_accounts").select("*").eq("id",e).eq("is_payment_method",!0).single();return s||!t?null:{id:t.id,name:t.name,type:this.mapAccountTypeToProviderType(t.type),status:t.is_active?"active":"inactive",configuration:{apiKey:"",secretKey:"",webhookUrl:"",merchantId:"",terminalId:"",currency:t.currency||"TZS",fees:{percentage:this.getDefaultFeePercentage(t.type),fixed:this.getDefaultFixedFee(t.type),minimum:this.getDefaultMinAmount(t.type),maximum:this.getDefaultMaxAmount(t.type)},limits:{daily:this.getDefaultDailyLimit(t.type),monthly:this.getDefaultMonthlyLimit(t.type),perTransaction:this.getDefaultMaxAmount(t.type)},supportedMethods:[t.name],processingTime:this.getDefaultProcessingTime(t.type),settlementTime:this.getDefaultSettlementTime(t.type)},metadata:{description:t.payment_description||t.notes||"",website:"",supportEmail:"",supportPhone:"",documentation:""},performance:{successRate:this.getDefaultSuccessRate(t.type),averageResponseTime:this.getDefaultResponseTime(t.type),totalTransactions:0,totalVolume:0,lastUsed:t.updated_at||(new Date).toISOString()},createdAt:t.created_at||(new Date).toISOString(),updatedAt:t.updated_at||(new Date).toISOString(),createdBy:"system",updatedBy:void 0}}catch(t){return null}}async createPaymentProvider(e,t){try{const{data:s,error:r}=await a.from("payment_providers").insert({name:e.name,type:e.type,status:e.status,configuration:e.configuration,metadata:e.metadata,performance:{successRate:0,averageResponseTime:0,totalTransactions:0,totalVolume:0},created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),created_by:t}).select().single();if(r)throw r;return this.clearCache(),{id:s.id,name:s.name,type:s.type,status:s.status,configuration:s.configuration,metadata:s.metadata,performance:s.performance,createdAt:s.created_at,updatedAt:s.updated_at,createdBy:s.created_by,updatedBy:s.updated_by}}catch(s){return null}}async updatePaymentProvider(e,t,s){try{const r={updated_at:(new Date).toISOString(),updated_by:s};t.name&&(r.name=t.name),t.type&&(r.type=t.type),t.status&&(r.status=t.status),t.configuration&&(r.configuration=t.configuration),t.metadata&&(r.metadata=t.metadata);const{error:n}=await a.from("payment_providers").update(r).eq("id",e);if(n)throw n;return this.clearCache(),!0}catch(r){return!1}}async updateProviderPerformance(e,t){try{const{data:s,error:r}=await a.from("payment_providers").select("performance").eq("id",e).single();if(r)throw r;const n={...s.performance,...t},{error:l}=await a.from("payment_providers").update({performance:n,updated_at:(new Date).toISOString()}).eq("id",e);if(l)throw l;return this.clearCache(),!0}catch(s){return!1}}async getProviderMetrics(){try{const e="provider_metrics",t=this.getCachedData(e);if(t)return t;const a=await this.getPaymentProviders(),s=a.length,r=a.filter(e=>"active"===e.status).length,n=a.reduce((e,t)=>e+t.performance.totalVolume,0),l=a.length>0?a.reduce((e,t)=>e+t.performance.successRate,0)/a.length:0,i=a.length>0?a.reduce((e,t)=>t.performance.successRate>e.performance.successRate?t:e).name:"",c={totalProviders:s,activeProviders:r,totalVolume:n,averageSuccessRate:l,topPerformer:i,recentFailures:a.reduce((e,t)=>e+Math.floor(t.performance.totalTransactions*(1-t.performance.successRate/100)*.1),0)};return this.setCachedData(e,c),c}catch(e){return{totalProviders:0,activeProviders:0,totalVolume:0,averageSuccessRate:0,topPerformer:"",recentFailures:0}}}async testProviderConnection(e){try{if(!(await this.getPaymentProvider(e)))return{success:!1,responseTime:0,error:"Provider not found"};const t=Date.now();await new Promise(e=>setTimeout(e,1e3*Math.random()+500));const a=Date.now()-t,s=Math.random()>.1;return s&&await this.updateProviderPerformance(e,{lastUsed:(new Date).toISOString(),averageResponseTime:a}),{success:s,responseTime:a,error:s?void 0:"Connection test failed"}}catch(t){return{success:!1,responseTime:0,error:t instanceof Error?t.message:"Unknown error"}}}async deletePaymentProvider(e){try{const{error:t}=await a.from("finance_accounts").update({is_active:!1,is_payment_method:!1,updated_at:(new Date).toISOString()}).eq("id",e).eq("is_payment_method",!0);if(t)throw t;return this.clearCache(),!0}catch(t){return!1}}async calculateRealPerformanceMetrics(e){try{const t=await this.getPaymentProvider(e);if(!t)return{successRate:0,averageResponseTime:0,totalTransactions:0,totalVolume:0};const s=this.mapProviderToPaymentMethodNames(t.name,t.type),[r,n]=await Promise.all([a.from("customer_payments").select("amount, status, created_at").in("method",s),a.from("lats_sales").select("total_amount, payment_method, created_at").in("payment_method",s)]),l=r.data||[],i=n.data||[],c=[...l.map(e=>({amount:e.amount,status:e.status,created_at:e.created_at})),...i.map(e=>({amount:e.total_amount,status:"completed",created_at:e.created_at}))];if(0===c.length)return{successRate:0,averageResponseTime:0,totalTransactions:0,totalVolume:0};const o=c.length,d=c.filter(e=>"completed"===e.status||"success"===e.status).length/o*100,m=c.reduce((e,t)=>e+(t.amount||0),0),u=this.getDefaultResponseTime(t.type);return{successRate:Math.round(100*d)/100,averageResponseTime:u,totalTransactions:o,totalVolume:m}}catch(t){return{successRate:0,averageResponseTime:0,totalTransactions:0,totalVolume:0}}}mapProviderToPaymentMethodNames(e,t){const a=e.toLowerCase();switch(t.toLowerCase()){case"cash":return["cash"];case"mobile_money":return a.includes("mpesa")?["M-Pesa","mpesa","mobile_money"]:a.includes("airtel")?["Airtel Money","airtel","mobile_money"]:a.includes("zenopay")?["ZenoPay","zenopay","mobile_money"]:["mobile_money","Mobile Money"];case"card_processor":return["card","Card","credit_card","debit_card"];case"bank_transfer":return["bank","Bank Transfer","bank_transfer","transfer"];default:return[e,a]}}clearProviderCache(){this.clearCache()}};const et=new class{async getPaymentMethods(){try{const{data:e,error:t}=await a.from("payment_methods").select("*").eq("is_active",!0).order("name");if(t)throw t;return e||[]}catch(e){return[]}}async getPaymentMethodByCode(e){try{const{data:t,error:s}=await a.from("payment_methods").select("*").eq("code",e).eq("is_active",!0).single();if(s)throw s;return t}catch(t){return null}}async getPaymentMethodAccounts(){try{const{data:e,error:t}=await a.from("payment_method_accounts").select("*").order("created_at");if(t)throw t;return e||[]}catch(e){return[]}}async getDefaultAccountForPaymentMethod(e){try{const{data:t,error:s}=await a.from("payment_method_accounts").select("account_id").eq("payment_method_id",e).eq("is_default",!0).eq("auto_route",!0).single();if(s)throw s;return(null==t?void 0:t.account_id)||null}catch(t){return null}}async routePaymentToAccount(e,t,s="pos_sale",r,n,l){try{const{data:i,error:c}=await a.rpc("route_payment_to_account",{p_payment_method_id:e,p_amount:t,p_source_type:s,p_order_id:r,p_customer_id:n,p_description:l});if(c)throw c;return i}catch(i){return null}}async createPaymentTransaction(e,t,s,r,n,l,i,c){try{if(("payment"===r||"pos_sale"===n||"device_payment"===n)&&!i)return null;const o=l||`order-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,{data:d,error:m}=await a.from("payment_transactions").insert([{order_id:o,provider:t||"manual",amount:s,currency:"TZS",status:"completed",customer_id:i||"00000000-0000-0000-0000-000000000000",reference:c,metadata:{transaction_type:r,source_type:n,account_id:e}}]).select().single();if(m)throw m;return d}catch(o){return null}}async getPaymentTransactionsForAccount(e,t=50,s=0){try{const{data:e,error:r}=await a.from("payment_transactions").select("*").order("created_at",{ascending:!1}).range(s,s+t-1);if(r)throw r;return e||[]}catch(r){return[]}}async getPaymentTransactionsForOrder(e){try{const{data:t,error:s}=await a.from("payment_transactions").select("*").eq("order_id",e).order("created_at",{ascending:!1});if(s)throw s;return t||[]}catch(t){return[]}}async getPaymentSummary(){try{const{data:e,error:t}=await a.from("payment_summary").select("*").order("account_name").limit(1);return t?("PGRST116"===t.code||t.message.includes('relation "payment_summary" does not exist')||t.message.includes("does not exist")||t.status,[]):e||[]}catch(e){return[]}}async getPaymentMethodSummary(){try{const{data:e,error:t}=await a.from("payment_method_summary").select("*").order("payment_method_name");return t?[]:e||[]}catch(e){return[]}}async createPaymentRoutingRule(e,t,s,r="all",n=0,l,i=1){try{const{data:c,error:o}=await a.from("payment_routing_rules").insert([{rule_name:e,payment_method_id:s,source_type:r,min_amount:n,max_amount:l,target_account_id:t,priority:i,is_active:!0}]).select().single();if(o)throw o;return c}catch(c){return null}}async getPaymentRoutingRules(){try{const{data:e,error:t}=await a.from("payment_routing_rules").select("*").eq("is_active",!0).order("priority",{ascending:!1});if(t)throw t;return e||[]}catch(e){return[]}}async updatePaymentRoutingRule(e,t){try{const{data:s,error:r}=await a.from("payment_routing_rules").update(t).eq("id",e).select().single();if(r)throw r;return s}catch(s){return null}}async deletePaymentRoutingRule(e){try{const{error:t}=await a.from("payment_routing_rules").delete().eq("id",e);if(t)throw t;return!0}catch(t){return!1}}async linkPaymentMethodToAccount(e,t,s=!1,r=!0){try{const{data:n,error:l}=await a.from("payment_method_accounts").insert([{payment_method_id:e,account_id:t,is_default:s,auto_route:r}]).select().single();if(l)throw l;return n}catch(n){return null}}async unlinkPaymentMethodFromAccount(e,t){try{const{error:s}=await a.from("payment_method_accounts").delete().eq("payment_method_id",e).eq("account_id",t);if(s)throw s;return!0}catch(s){return!1}}async processPOSPayment(e,t,a,s,r){return this.routePaymentToAccount(e,t,"pos_sale",a,s,r||`POS payment for order ${a}`)}async processDevicePayment(e,t,a,s,r){return this.routePaymentToAccount(e,t,"device_payment",void 0,s,r||`Device payment for device ${a}`)}async getAccountBalanceHistory(e,t=50,s=0){try{const{data:r,error:n}=await a.from("account_balance_history").select("*").eq("account_id",e).order("created_at",{ascending:!1}).range(s,s+t-1);if(n)throw n;return r||[]}catch(r){return[]}}};const tt=new class{constructor(){this.cache=new Map,this.CACHE_DURATION=3e5}async getSupportedCurrencies(){const e="supported_currencies",t=this.getCachedData(e);if(t)return t;try{const t=Se.map(e=>({code:e.code,name:e.name,symbol:e.symbol,flag:e.flag,exchangeRate:"TZS"===e.code?1:void 0,lastUpdated:(new Date).toISOString()}));return this.setCachedData(e,t),t}catch(a){return Se.map(e=>({code:e.code,name:e.name,symbol:e.symbol,flag:e.flag,exchangeRate:"TZS"===e.code?1:void 0,lastUpdated:(new Date).toISOString()}))}}async getCurrencyFilterOptions(){return(await this.getSupportedCurrencies()).map(e=>({value:e.code,label:ke(e),currency:e}))}async getCurrenciesUsedInPayments(){const e="currencies_used_in_payments",t=this.getCachedData(e);if(t)return t;try{const[t,s]=await Promise.allSettled([a.from("customer_payments").select("currency").not("currency","is",null),a.from("purchase_order_payments").select("currency").not("currency","is",null)]),r=new Set;"fulfilled"===t.status&&t.value.data&&t.value.data.forEach(e=>{e.currency&&r.add(e.currency)}),"fulfilled"===s.status&&s.value.data&&s.value.data.forEach(e=>{e.currency&&r.add(e.currency)}),r.add("TZS");const n=Array.from(r).sort();return this.setCachedData(e,n),n}catch(s){return["TZS","USD","EUR","GBP"]}}async getCurrencyStatistics(){const e="currency_statistics",t=this.getCachedData(e);if(t)return t;try{const t={};try{const{data:e,error:s}=await a.from("customer_payments").select("currency, amount").not("currency","is",null);s||e&&e.length>0&&e.forEach(e=>{const a=e.currency||"TZS";t[a]||(t[a]={count:0,totalAmount:0}),t[a].count+=1,t[a].totalAmount+=e.amount||0})}catch(s){}try{const{data:e,error:s}=await a.from("purchase_order_payments").select("currency, amount").not("currency","is",null);s||e&&e.length>0&&e.forEach(e=>{const a=e.currency||"TZS";t[a]||(t[a]={count:0,totalAmount:0}),t[a].count+=1,t[a].totalAmount+=e.amount||0})}catch(s){}return Object.keys(t).length>0&&this.setCachedData(e,t),t}catch(r){return{}}}formatAmount(e,t){const a=Ce(t)||De;return Pe(e,a)}getCurrencyDisplayName(e){const t=Ce(e);return t?ke(t):`${e} (Unknown)`}isValidCurrency(e){return void 0!==Ce(e)}getDefaultCurrency(){return De}getCurrencySelectOptions(){return Te()}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.CACHE_DURATION?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.cache.clear()}clearCacheEntry(e){this.cache.delete(e)}},at=({onViewDetails:t,onRefund:n,onExport:l,onNavigateToTab:c})=>{var o,d,m,u,x,h,R,F,E,$,z,I,O,M,L,q,B,U,Z,G;s();const[V,K]=i.useState(!0),[H,W]=i.useState(""),[Y,J]=i.useState("all"),[Q,X]=i.useState("all"),[ee,te]=i.useState("all"),[ae,se]=i.useState("");i.useState(!1);const[re,ne]=i.useState(!0);i.useState("cards");const[le,ie]=i.useState([]),[ce,oe]=i.useState({totalPayments:0,totalAmount:0,completedAmount:0,pendingAmount:0,failedAmount:0,totalFees:0,successRate:"0.0"}),[de,me]=i.useState([]),[ue,xe]=i.useState([]),[he,pe]=i.useState(null),[ge,ye]=i.useState(null),[be,fe]=i.useState(null),[je,ve]=i.useState([]),[_e,Se]=i.useState([]),[ke,Ce]=i.useState([]),[De,Pe]=i.useState([]),[Te,Ae]=i.useState([]),[Ke,He]=i.useState([]),[We,Ye]=i.useState([]),[Je,at]=i.useState([]);i.useState(null);const[st,rt]=i.useState([]),[nt,lt]=i.useState([]),[it,ct]=i.useState([]),[ot,dt]=i.useState([]);i.useState([]);const[mt,ut]=i.useState([]),[xt,ht]=i.useState([]);i.useState([]);const[pt,gt]=i.useState([]),[yt,bt]=i.useState([]),[ft,jt]=i.useState([]),vt=i.useMemo(()=>{var e,t,a,s,r,n;const l=ue.map(e=>({date:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),amount:e.totalAmount,transactions:e.transactionCount,fullDate:e.date})),i=[...le,...Te,...Ke,...We,...Je,...nt],c=i.reduce((e,t)=>{var a,s;const r=t.method||t.payment_method||(null==(a=t.metadata)?void 0:a.method)||(null==(s=t.metadata)?void 0:s.payment_method)||"unknown";e[r]||(e[r]={total:0,count:0});const n=Number(t.amount||t.total_amount||0);return e[r].total+=isNaN(n)?0:n,e[r].count+=1,e},{}),o=Object.values(c).reduce((e,t)=>{const a=Number(t.total);return e+(isNaN(a)?0:a)},0),d=Object.entries(c).map(([e,t])=>{const a=e||"unknown";return{name:a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," "),value:t.total,count:t.count,percentage:o>0?t.total/o*100:0}}).sort((e,t)=>t.value-e.value),m=i.reduce((e,t)=>{const a=t.status||t.payment_status||"unknown",s=String(a).toLowerCase(),r="success"===s?"completed":s;e[r]||(e[r]={total:0,count:0});const n=Number(t.amount||t.total_amount||0);return e[r].total+=isNaN(n)?0:n,e[r].count+=1,e},{});i.length;return{dailyData:l,methodsData:d,statusData:[{status:"Completed",amount:(null==(e=m.completed)?void 0:e.total)||0,count:(null==(t=m.completed)?void 0:t.count)||0,color:"#10B981"},{status:"Pending",amount:(null==(a=m.pending)?void 0:a.total)||0,count:(null==(s=m.pending)?void 0:s.count)||0,color:"#F59E0B"},{status:"Failed",amount:(null==(r=m.failed)?void 0:r.total)||0,count:(null==(n=m.failed)?void 0:n.count)||0,color:"#EF4444"}].filter(e=>e.amount>0||e.count>0),monthlyData:st.map(e=>({month:new Date(e.month).toLocaleDateString("en-US",{month:"short",year:"numeric"}),amount:e.total_amount||0,transactions:e.transaction_count||0,fullDate:e.month})),currencyData:mt.map(e=>({currency:e.currency_code,amount:e.total_amount,count:e.transaction_count,percentage:e.percentage})),hourlyData:yt.map(e=>({hour:`${e.hour}:00`,amount:e.total_amount,transactions:e.transaction_count})),customerData:pt.map(e=>({name:e.customer_name,amount:e.total_amount,transactions:e.transaction_count})),failedPaymentData:ft.map(e=>({reason:e.failure_reason,count:e.failure_count,amount:e.total_amount})),dailyBreakdownData:xt.map(e=>({date:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),amount:e.total_amount,transactions:e.transaction_count,methods:e.method_breakdown})),totalPayments:i.length,totalRevenue:o,totalAccounts:it.length,totalProviders:ot.length}},[ue,de,ce,le,Te,Ke,We,Je,st,nt,mt,yt,pt,ft,xt,it,ot]),Nt=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4"],wt=i.useCallback(async()=>{var e,t;K(!0);try{const{data:{user:s},error:n}=await a.auth.getUser();if(n||!s)return void K(!1);const[l,i,c,o,d,m,u,x,h,p,g,b,f,j,v,N,w,_,S]=await Promise.allSettled([Ne.debouncedFetchPaymentTransactions(ae||void 0,ae||void 0,"all"!==Y?Y:void 0,"all"!==Q?Q:void 0),Ne.calculatePaymentMetrics(ae||void 0,ae||void 0),Ne.getPaymentMethodSummary(ae||void 0,ae||void 0),Ne.getDailySummary(7),we.getComprehensiveFinancialData(),Qe.getPaymentAnalytics(ae||void 0,ae||void 0),Qe.getPaymentInsights(),Xe.getPaymentProviders(),r.getActiveFinanceAccounts(),et.getPaymentTransactionsForAccount("all",1e3,0),tt.getCurrenciesUsedInPayments(),tt.getCurrencyStatistics(),a.from("customer_payments").select("*").order("created_at",{ascending:!1}).limit(500).then(e=>e.error?{data:[],error:e.error}:e),a.from("purchase_order_payments").select("*").order("created_at",{ascending:!1}).limit(500).then(e=>e.error?{data:[],error:e.error}:e),a.from("customer_payments").select("*").not("device_id","is",null).order("created_at",{ascending:!1}).limit(500).then(e=>e.error?{data:[],error:e.error}:e),a.from("customer_payments").select("*").not("device_id","is",null).order("created_at",{ascending:!1}).limit(500).then(e=>e.error?{data:[],error:e.error}:e),a.from("payment_transactions").select("*").order("created_at",{ascending:!1}).limit(1e3).then(e=>e.error?{data:[],error:e.error}:e),a.from("finance_accounts").select("*").order("created_at",{ascending:!1}).then(e=>e.error?{data:[],error:e.error}:e),a.from("finance_accounts").select("*").eq("is_payment_method",!0).order("created_at",{ascending:!1}).then(e=>e.error?{data:[],error:e.error}:e)]);if("fulfilled"===l.status&&ie(l.value),"fulfilled"===i.status&&oe(i.value),"fulfilled"===c.status&&me(c.value),"fulfilled"===o.status&&xe(o.value),"fulfilled"===d.status&&pe(d.value),"fulfilled"===m.status&&ye(m.value),"fulfilled"===u.status&&fe(u.value),"fulfilled"===x.status&&ve(x.value),"fulfilled"===h.status&&Se(h.value),"fulfilled"===p.status&&Ce(p.value),"fulfilled"===g.status&&Pe(g.value),"fulfilled"===f.status&&Ae(f.value.data||[]),"fulfilled"===j.status&&He(j.value.data||[]),"fulfilled"===v.status&&Ye(v.value.data||[]),"fulfilled"===N.status&&at(N.value.data||[]),"fulfilled"===w.status&&lt(w.value.data||[]),"fulfilled"===_.status&&ct(_.value.data||[]),"fulfilled"===S.status&&dt(S.value.data||[]),"fulfilled"===b.status){const e=b.value;if(0===Object.keys(e).length)ut([]);else{const t=Object.entries(e).map(([e,t])=>({currency_code:e,total_amount:t.totalAmount||0,transaction_count:t.count||0,percentage:0})),a=t.reduce((e,t)=>e+t.total_amount,0);t.forEach(e=>{e.percentage=a>0?e.total_amount/a*100:0}),ut(t)}}else ut([]);const k=[..."fulfilled"===l.status?l.value:[],..."fulfilled"===f.status&&f.value.data||[],..."fulfilled"===j.status&&j.value.data||[],..."fulfilled"===w.status&&w.value.data||[]],C=[],D={};k.forEach(e=>{const t=e.payment_date||e.created_at||e.date;if(t){const a=new Date(t).getHours();D[a]||(D[a]={total_amount:0,transaction_count:0}),D[a].total_amount+=Number(e.amount||e.total_amount||0),D[a].transaction_count+=1}});for(let a=0;a<24;a++)C.push({hour:a,total_amount:(null==(e=D[a])?void 0:e.total_amount)||0,transaction_count:(null==(t=D[a])?void 0:t.transaction_count)||0});bt(C);const P={};k.forEach(e=>{var t;const a=e.customer_id||e.customerId||e.customer_email||e.customer_phone||"unknown",s=e.customer_name||e.customerName||(null==(t=e.customers)?void 0:t.name)||e.customer_email||`Customer ${String(a).substring(0,8)}`;s&&"unknown"!==s&&!s.includes("undefined")&&(P[a]||(P[a]={customer_name:s,total_amount:0,transaction_count:0}),P[a].total_amount+=Number(e.amount||e.total_amount||0),P[a].transaction_count+=1)});const T=Object.values(P).sort((e,t)=>t.total_amount-e.total_amount).slice(0,20);gt(T);const A=k.filter(e=>"failed"===e.status||"failed"===e.payment_status),R={};A.forEach(e=>{var t;const a=e.failure_reason||(null==(t=e.metadata)?void 0:t.failure_reason)||e.notes||e.error_message||"Unknown Reason";R[a]||(R[a]={failure_count:0,total_amount:0}),R[a].failure_count+=1,R[a].total_amount+=Number(e.amount||e.total_amount||0)});const F=Object.entries(R).map(([e,t])=>({failure_reason:e,failure_count:t.failure_count,total_amount:t.total_amount}));jt(F);const E={},$=new Date;$.setDate($.getDate()-30),k.forEach(e=>{const t=e.payment_date||e.created_at||e.date;if(t){const a=new Date(t);if(a>=$){const t=a.toISOString().split("T")[0];E[t]||(E[t]={total_amount:0,transaction_count:0,method_breakdown:{}});const s=Number(e.amount||e.total_amount||0);E[t].total_amount+=s,E[t].transaction_count+=1;const r=e.method||e.payment_method||"unknown";E[t].method_breakdown[r]=(E[t].method_breakdown[r]||0)+s}}});const z=Object.entries(E).map(([e,t])=>({date:e,total_amount:t.total_amount,transaction_count:t.transaction_count,method_breakdown:t.method_breakdown})).sort((e,t)=>e.date.localeCompare(t.date));ht(z);const I={},O=new Date;O.setMonth(O.getMonth()-12),k.forEach(e=>{const t=e.payment_date||e.created_at||e.date;if(t){const a=new Date(t);if(a>=O){const t=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-01`;I[t]||(I[t]={total_amount:0,transaction_count:0}),I[t].total_amount+=Number(e.amount||e.total_amount||0),I[t].transaction_count+=1}}});const M=Object.entries(I).map(([e,t])=>({month:e,total_amount:t.total_amount,transaction_count:t.transaction_count})).sort((e,t)=>e.month.localeCompare(t.month));rt(M);[l,i,c,o,d,m,u,x,h,p,g,b,f,j,v,N,w,_,S].filter(e=>"fulfilled"===e.status).length>=10||y.error("Some payment data failed to load. Check your connection.")}catch(s){y.error("Failed to load payment data")}finally{K(!1)}},[ae,Y,Q]);i.useEffect(()=>{if(wt(),re){const e=setInterval(wt,3e4);return()=>clearInterval(e)}},[wt,re]);const _t=i.useCallback(()=>{clearTimeout(reconnectTimeout),reconnectTimeout=setTimeout(()=>{wt()},2e3)},[wt]);i.useEffect(()=>{if(!re)return;let e,t=0;let s=!1,r=!1,n=0;const l=()=>{const i=Date.now();if(!(r||i-n<5e3))try{r=!0,n=i,e&&e.unsubscribe(),e=a.channel("comprehensive-payment-tracking-updates").on("postgres_changes",{event:"*",schema:"public",table:"customer_payments"},e=>{_t()}).on("postgres_changes",{event:"*",schema:"public",table:"lats_sales"},e=>{_t()}).on("postgres_changes",{event:"*",schema:"public",table:"lats_sale_items"},e=>{_t()}).on("postgres_changes",{event:"*",schema:"public",table:"finance_accounts"},e=>{_t()}).on("postgres_changes",{event:"*",schema:"public",table:"finance_transactions"},e=>{_t()}).on("postgres_changes",{event:"*",schema:"public",table:"customers"},e=>{_t()}).on("postgres_changes",{event:"*",schema:"public",table:"devices"},e=>{_t()}).on("postgres_changes",{event:"*",schema:"public",table:"payment_audit_log"},e=>{_t()}).on("postgres_changes",{event:"*",schema:"public",table:"payment_reconciliation"},e=>{_t()}).subscribe(e=>{if(r=!1,"SUBSCRIBED"===e)t=0,s=!0;else if(("CLOSED"===e||"CHANNEL_ERROR"===e)&&(s=!1,t<2)){t++;const e=1e4*Math.pow(2,t-1);setTimeout(()=>{s||r||!re||l()},e)}})}catch(c){if(s=!1,r=!1,t<2){t++;const e=1e4*Math.pow(2,t-1);setTimeout(()=>{s||r||!re||l()},e)}}};return setTimeout(()=>{l()},1e3),()=>{clearTimeout(undefined),s=!1,r=!1,e&&e.unsubscribe()}},[wt,re]),i.useMemo(()=>{let e=le;if(H.trim()){const t=H.toLowerCase();e=e.filter(e=>e.customerName.toLowerCase().includes(t)||e.transactionId.toLowerCase().includes(t)||e.reference.toLowerCase().includes(t)||e.method.toLowerCase().includes(t)||e.currency&&e.currency.toLowerCase().includes(t))}return"all"!==Y&&(e=e.filter(e=>e.status===Y)),"all"!==Q&&(e=e.filter(e=>e.method===Q)),"all"!==ee&&(e=e.filter(e=>e.currency===ee)),e},[le,H,Y,Q,ee]);const St=e=>{const t=Number(e);return!isFinite(t)||isNaN(t)?new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(0):new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"p-2.5 bg-emerald-50 rounded-xl",children:e.jsx(b,{className:"w-5 h-5 text-emerald-600"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:St(vt.totalRevenue||ce.totalAmount)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[vt.totalPayments||ce.totalPayments," transactions"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"p-2.5 bg-blue-50 rounded-xl",children:e.jsx(p,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg bg-emerald-50",children:e.jsxs("span",{className:"text-sm font-semibold text-emerald-600",children:[ce.successRate,"%"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:St(ce.completedAmount)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Success rate"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"p-2.5 bg-orange-50 rounded-xl",children:e.jsx(f,{className:"w-5 h-5 text-orange-600"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:St(ce.pendingAmount)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Awaiting confirmation"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"p-2.5 bg-purple-50 rounded-xl",children:e.jsx(j,{className:"w-5 h-5 text-purple-600"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Processing Fees"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:St(ce.totalFees)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Total fees collected"})]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"All Systems Connected"})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:vt.totalPayments}),e.jsx("span",{className:"text-gray-500",children:"Transactions"})]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:je.length}),e.jsx("span",{className:"text-gray-500",children:"Providers"})]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:_e.length}),e.jsx("span",{className:"text-gray-500",children:"Accounts"})]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:De.length}),e.jsx("span",{className:"text-gray-500",children:"Currencies"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(S,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Payment Status"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Amount by status"})]})}),e.jsx("div",{className:"h-64",children:vt.statusData.length>0?e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:vt.statusData,layout:"horizontal",children:[e.jsx(Ee,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx($e,{type:"number",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`${(e/1e3).toFixed(0)}K`}),e.jsx(ze,{type:"category",dataKey:"status",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:(e,t,a)=>[St(e),`${a.payload.status} (${a.payload.count} transactions)`]}),e.jsx(Oe,{dataKey:"amount",fill:"#3B82F6",radius:[0,8,8,0]})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx(S,{className:"w-12 h-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"No payment status data available"}),e.jsx("p",{className:"text-xs mt-1",children:"Process payments to see status breakdown"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[vt.methodsData.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Payment Methods"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Distribution by method"})]})}),e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Me,{children:[e.jsx(Le,{data:vt.methodsData,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:vt.methodsData.map((t,a)=>e.jsx(qe,{fill:Nt[a%Nt.length]},`cell-${a}`))}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:(e,t,a)=>[St(e),`${a.payload.name} (${a.payload.count} transactions)`]})]})})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:vt.methodsData.map((t,a)=>{const s=t.percentage.toFixed(0);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Nt[a%Nt.length]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-900 font-medium truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s,"%"]})]})]},a)})})})]}),vt.currencyData.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Currency Usage"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Transactions by currency"})]})}),e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:vt.currencyData,children:[e.jsx(Ee,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx($e,{dataKey:"currency",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(ze,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`${(e/1e3).toFixed(0)}K`}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:(e,t,a)=>[St(e),`${a.payload.currency} (${a.payload.count} transactions)`]}),e.jsx(Oe,{dataKey:"amount",fill:"#8B5CF6",radius:[8,8,0,0]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(f,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Hourly Trends"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Payment activity by hour"})]})}),vt.hourlyData.filter(e=>e.transaction_count>0).length>0?e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Be,{data:vt.hourlyData,children:[e.jsx(Ee,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx($e,{dataKey:"hour",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(ze,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`${(e/1e3).toFixed(0)}K`}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:(e,t,a)=>[St(e),`Amount (${a.payload.transactions} transactions)`]}),e.jsx(Ue,{type:"monotone",dataKey:"amount",stroke:"#3B82F6",strokeWidth:3,dot:{fill:"#3B82F6",strokeWidth:2,r:3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hourly trend data available yet"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(N,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Top Customers"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Highest paying customers"})]})}),vt.customerData.length>0?e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:vt.customerData.slice(0,10),layout:"horizontal",children:[e.jsx(Ee,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx($e,{type:"number",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`${(e/1e3).toFixed(0)}K`}),e.jsx(ze,{type:"category",dataKey:"name",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,width:100}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:(e,t,a)=>[St(e),`${a.payload.name} (${a.payload.transactions} transactions)`]}),e.jsx(Oe,{dataKey:"amount",fill:"#10B981",radius:[0,8,8,0]})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No customer payment data available yet"})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(g,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Failed Payments"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Analysis of payment failures"})]})}),vt.failedPaymentData.length>0?e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Me,{children:[e.jsx(Le,{data:vt.failedPaymentData,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"count",children:vt.failedPaymentData.map((t,a)=>e.jsx(qe,{fill:["#EF4444","#F59E0B","#8B5CF6","#06B6D4"][a%4]},`cell-${a}`))}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:(e,t,a)=>[`${e} failures`,`${a.payload.reason} (${St(a.payload.amount)} lost)`]})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-2 text-emerald-300"}),e.jsx("p",{className:"font-medium text-emerald-600 text-sm",children:"Great! No failed payments"}),e.jsx("p",{className:"text-xs",children:"All transactions are successful"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Top Payment Methods"})}),e.jsx("button",{onClick:()=>null==c?void 0:c("providers"),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"View All "})]}),e.jsx("div",{className:"space-y-2",children:de.slice(0,4).map(t=>{const a=t.method?t.method.replace(/_/g," "):"unknown";return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"p-2 bg-white rounded-lg",children:["cash"===t.method&&e.jsx(b,{className:"w-4 h-4 text-orange-500"}),"mobile_money"===t.method&&e.jsx(k,{className:"w-4 h-4 text-emerald-500"}),"card"===t.method&&e.jsx(j,{className:"w-4 h-4 text-blue-500"}),"bank_transfer"===t.method&&e.jsx(_,{className:"w-4 h-4 text-purple-500"}),!["cash","mobile_money","card","bank_transfer"].includes(t.method)&&e.jsx(w,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm capitalize",children:a}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.count," transactions"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:St(t.totalAmount)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.percentage.toFixed(1),"%"]})]})]},t.method||"unknown")})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Recent Activity"})}),e.jsx("button",{onClick:()=>null==c?void 0:c("transactions"),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"View All "})]}),e.jsx("div",{className:"space-y-2",children:le.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg "+("completed"===t.status?"bg-emerald-50":"pending"===t.status?"bg-orange-50":"bg-red-50"),children:e.jsx(j,{className:"w-4 h-4 "+("completed"===t.status?"text-emerald-600":"pending"===t.status?"text-orange-600":"text-red-600")})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:t.customerName}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.date).toLocaleDateString()})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:St(t.amount)})})]},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Daily Performance"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Revenue trends over the last 7 days"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{className:"px-2.5 py-1 text-xs bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 font-medium",children:"7D"}),e.jsx("button",{className:"px-2.5 py-1 text-xs bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100 font-medium",children:"30D"})]})]}),vt.dailyData.length>0?e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:vt.dailyData,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorAmount",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#3B82F6",stopOpacity:.4}),e.jsx("stop",{offset:"30%",stopColor:"#3B82F6",stopOpacity:.2}),e.jsx("stop",{offset:"70%",stopColor:"#3B82F6",stopOpacity:.1}),e.jsx("stop",{offset:"100%",stopColor:"#3B82F6",stopOpacity:.05})]})}),e.jsx(Ee,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx($e,{dataKey:"date",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(ze,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`${(e/1e3).toFixed(0)}K`}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:e=>[St(e),"Amount"],labelFormatter:e=>`Date: ${e}`}),e.jsx(Ge,{type:"monotone",dataKey:"amount",stroke:"#3B82F6",strokeWidth:3,fillOpacity:1,fill:"url(#colorAmount)"})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No daily performance data available yet"})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(C,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Monthly Trends"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Revenue trends over the last 12 months"})]})}),vt.monthlyData.length>0?e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Be,{data:vt.monthlyData,children:[e.jsx(Ee,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx($e,{dataKey:"month",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(ze,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`${(e/1e3).toFixed(0)}K`}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:e=>[St(e),"Amount"],labelFormatter:e=>`Month: ${e}`}),e.jsx(Ue,{type:"monotone",dataKey:"amount",stroke:"#10B981",strokeWidth:3,dot:{fill:"#10B981",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#10B981",strokeWidth:2}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No monthly trend data available yet"})]})})]})]}),(he||ge||be)&&e.jsxs("div",{className:"space-y-6",children:[he&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"p-2.5 bg-blue-50 rounded-xl",children:e.jsx(C,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg bg-emerald-50",children:e.jsxs("span",{className:"text-xs font-semibold text-emerald-600",children:["+",(null==(d=null==(o=null==he?void 0:he.summary)?void 0:o.revenueGrowth)?void 0:d.toFixed(1))||"0.0","%"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:St((null==(m=null==he?void 0:he.summary)?void 0:m.totalRevenue)||0)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Revenue growth"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"p-2.5 bg-orange-50 rounded-xl",children:e.jsx(D,{className:"w-5 h-5 text-orange-600"})}),e.jsx("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg bg-orange-50",children:e.jsxs("span",{className:"text-xs font-semibold text-orange-600",children:["+",(null==(x=null==(u=null==he?void 0:he.summary)?void 0:u.expenseGrowth)?void 0:x.toFixed(1))||"0.0","%"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Total Expenses"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:St((null==(h=null==he?void 0:he.summary)?void 0:h.totalExpenses)||0)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Expense growth"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"p-2.5 bg-emerald-50 rounded-xl",children:e.jsx(b,{className:"w-5 h-5 text-emerald-600"})}),e.jsx("div",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg bg-emerald-50",children:e.jsxs("span",{className:"text-xs font-semibold text-emerald-600",children:["+",(null==(F=null==(R=null==he?void 0:he.summary)?void 0:R.profitGrowth)?void 0:F.toFixed(1))||"0.0","%"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Net Profit"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:St((null==(E=null==he?void 0:he.summary)?void 0:E.netProfit)||0)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Profit growth"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(P,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Financial Overview"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Revenue, Expenses & Profit comparison"})]})}),e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:[{name:"Revenue",value:(null==($=null==he?void 0:he.summary)?void 0:$.totalRevenue)||0,color:"#3B82F6"},{name:"Expenses",value:(null==(z=null==he?void 0:he.summary)?void 0:z.totalExpenses)||0,color:"#F59E0B"},{name:"Net Profit",value:(null==(I=null==he?void 0:he.summary)?void 0:I.netProfit)||0,color:"#10B981"}],children:[e.jsx(Ee,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx($e,{dataKey:"name",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(ze,{stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`${(e/1e3).toFixed(0)}K`}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:e=>[St(e),"Amount"]}),e.jsx(Oe,{dataKey:"value",radius:[8,8,0,0],children:[{color:"#3B82F6"},{color:"#F59E0B"},{color:"#10B981"}].map((t,a)=>e.jsx(qe,{fill:t.color},`cell-${a}`))})]})})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(C,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Growth Trends"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Year-over-year growth percentages"})]})}),e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:[{name:"Revenue Growth",value:(null==(O=null==he?void 0:he.summary)?void 0:O.revenueGrowth)||0,color:"#3B82F6"},{name:"Expense Growth",value:(null==(M=null==he?void 0:he.summary)?void 0:M.expenseGrowth)||0,color:"#F59E0B"},{name:"Profit Growth",value:(null==(L=null==he?void 0:he.summary)?void 0:L.profitGrowth)||0,color:"#10B981"}],layout:"horizontal",children:[e.jsx(Ee,{strokeDasharray:"2 2",stroke:"#f0f0f0",vertical:!1}),e.jsx($e,{type:"number",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`${e}%`}),e.jsx(ze,{type:"category",dataKey:"name",stroke:"#9ca3af",tick:{fill:"#6b7280",fontSize:11},tickLine:!1,axisLine:!1,width:120}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:e=>[`${e.toFixed(1)}%`,"Growth"]}),e.jsx(Oe,{dataKey:"value",radius:[0,8,8,0],children:[{color:"#3B82F6"},{color:"#F59E0B"},{color:"#10B981"}].map((t,a)=>e.jsx(qe,{fill:t.color},`cell-${a}`))})]})})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(T,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Financial Distribution"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Revenue vs Expenses breakdown"})]})}),e.jsx("div",{className:"h-80",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Me,{children:[e.jsxs(Le,{data:[{name:"Revenue",value:(null==(q=null==he?void 0:he.summary)?void 0:q.totalRevenue)||0,color:"#3B82F6"},{name:"Expenses",value:(null==(B=null==he?void 0:he.summary)?void 0:B.totalExpenses)||0,color:"#F59E0B"}],cx:"50%",cy:"50%",labelLine:!0,label:({name:e,value:t,percent:a})=>`${e}: ${St(t)} (${(100*a).toFixed(1)}%)`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:[e.jsx(qe,{fill:"#3B82F6"}),e.jsx(qe,{fill:"#F59E0B"})]}),e.jsx(Ie,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",color:"white"},formatter:e=>[St(e),"Amount"]}),e.jsx(Ve,{verticalAlign:"bottom",height:36,formatter:e=>e})]})})})]})]}),be&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Payment Insights"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-emerald-50 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:(null==be?void 0:be.topPaymentMethod)||"N/A"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Top Method"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:St((null==be?void 0:be.averageTransactionValue)||0)}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Avg Transaction"})]})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(null==be?void 0:be.peakHour)||"N/A"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Peak Hour"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[(null==(U=null==be?void 0:be.successRate)?void 0:U.toFixed(1))||"0.0","%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Success"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[(null==(Z=null==be?void 0:be.failureRate)?void 0:Z.toFixed(1))||"0.0","%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Failure"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[(null==(G=null==be?void 0:be.refundRate)?void 0:G.toFixed(1))||"0.0","%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Refund"})]})]})]})]})]}),_e.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"p-2.5 bg-emerald-50 rounded-xl",children:e.jsx(w,{className:"w-5 h-5 text-emerald-600"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Total Accounts"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:_e.length})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"p-2.5 bg-blue-50 rounded-xl",children:e.jsx(p,{className:"w-5 h-5 text-blue-600"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Active Accounts"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:_e.filter(e=>e.is_active).length})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"p-2.5 bg-purple-50 rounded-xl",children:e.jsx(b,{className:"w-5 h-5 text-purple-600"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Total Balance"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:St(_e.reduce((e,t)=>e+(t.balance||0),0))})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Top Accounts by Balance"})}),_e.length>3&&e.jsxs("button",{onClick:()=>null==c?void 0:c("providers"),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:["View all ",_e.length," accounts "]})]}),e.jsx("div",{className:"space-y-2",children:_e.sort((e,t)=>(t.balance||0)-(e.balance||0)).slice(0,3).map(t=>{const a=t.type?t.type.replace(/_/g," "):"unknown";return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1 bg-white rounded",children:(t=>{switch(t){case"cash":return e.jsx(b,{className:"w-4 h-4 text-orange-600"});case"bank":return e.jsx(_,{className:"w-4 h-4 text-blue-600"});case"mobile_money":return e.jsx(k,{className:"w-4 h-4 text-green-600"});case"credit_card":return e.jsx(j,{className:"w-4 h-4 text-purple-600"});default:return e.jsx(j,{className:"w-4 h-4 text-gray-600"})}})(t.type)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:t.name}),e.jsx("div",{className:"text-xs text-gray-600 capitalize",children:a})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:St(t.balance||0)})}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(s=t.is_active,s?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:t.is_active?"Active":"Inactive"})]})]},t.id);var s})})]})]}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Quick Actions"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Common payment management tasks"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>null==c?void 0:c("transactions"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium shadow-sm",children:[e.jsx(j,{size:16}),"View All Transactions"]}),e.jsxs("button",{onClick:()=>null==c?void 0:c("providers"),className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors font-medium shadow-sm",children:[e.jsx(A,{size:16}),"Manage Accounts"]}),e.jsxs("button",{onClick:()=>null==c?void 0:c("purchase-orders"),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors font-medium shadow-sm",children:[e.jsx(v,{size:16}),"Purchase Orders"]})]})]})})]})},st=({onViewDetails:t,onMakePayment:s,onExport:l})=>{var o;const[d,m]=i.useState([]),[u,h]=i.useState([]),[p,N]=i.useState([]),[w,S]=i.useState(!0),[k,C]=i.useState(""),[D,P]=i.useState("all"),[T,A]=i.useState("all"),[B,U]=i.useState(null),[Z,G]=i.useState(!1),V=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),K=(e,t)=>{if(void 0!==t&&t<0)return"bg-orange-100 text-orange-700";switch(e){case"paid":return"bg-green-100 text-green-700";case"partial":return"bg-yellow-100 text-yellow-700";case"unpaid":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},H=c.useMemo(()=>{const e=d.length,t=d.filter(e=>e.totalAmount-(e.totalPaid||0)>0&&"paid"!==e.paymentStatus).length,a=d.filter(e=>e.totalAmount-(e.totalPaid||0)>0&&"partial"===e.paymentStatus).length,s=d.filter(e=>e.totalAmount-(e.totalPaid||0)<=0).length,r=d.filter(e=>e.totalAmount-(e.totalPaid||0)<0).length,n=d.reduce((e,t)=>e+t.totalAmount,0),l=d.reduce((e,t)=>e+(t.totalPaid||0),0);return{totalOrders:e,unpaidOrders:t,partialOrders:a,paidOrders:s,overpaidOrders:r,totalAmount:n,totalPaid:l,totalOutstanding:Math.max(0,n-l)}},[d]),W=i.useCallback(async()=>{try{S(!0);const{data:e,error:t}=await a.from("lats_purchase_orders").select("\n          id,\n          order_number,\n          supplier_id,\n          status,\n          currency,\n          exchange_rate,\n          total_amount_base_currency,\n          payment_terms,\n          total_amount,\n          total_paid,\n          payment_status,\n          expected_delivery,\n          created_at,\n          updated_at\n        ").order("created_at",{ascending:!1}).limit(50);if(t)throw t;if(!e||0===e.length)return void m([]);const s=[...new Set(e.map(e=>e.supplier_id).filter(Boolean))];let r=[];if(s.length>0){const{data:e,error:t}=await a.from("lats_suppliers").select("id, name, contact_person, phone").in("id",s);t||(r=e||[])}const n=e.map(e=>({...e,orderNumber:e.order_number,supplierId:e.supplier_id,supplier:r.find(t=>t.id===e.supplier_id),totalAmount:e.total_amount,totalPaid:e.total_paid||0,paymentStatus:e.payment_status,expectedDelivery:e.expected_delivery,createdAt:e.created_at,updatedAt:e.updated_at}));m(n)}catch(e){y.error("Failed to load purchase orders")}finally{S(!1)}},[]),Y=i.useCallback(async()=>{try{const{data:e,error:t}=await a.from("purchase_order_payments").select("\n          id,\n          purchase_order_id,\n          amount,\n          currency,\n          payment_method,\n          status,\n          payment_date,\n          reference,\n          notes\n        ").order("payment_date",{ascending:!1}).limit(10);if(t)return;h(e||[])}catch(e){}},[]),J=i.useCallback(async()=>{try{const e=await r.getPaymentMethods();N(e)}catch(e){}},[]);i.useEffect(()=>{W(),Y(),J()},[W,Y,J]),i.useEffect(()=>{const e=a.channel("purchase_order_payments_changes").on("postgres_changes",{event:"*",schema:"public",table:"purchase_order_payments"},e=>{W(),Y(),"INSERT"===e.eventType?y.success("Payment recorded successfully!"):"UPDATE"===e.eventType&&y.success("Payment updated!")}).subscribe(),t=a.channel("purchase_orders_payment_status").on("postgres_changes",{event:"UPDATE",schema:"public",table:"lats_purchase_orders",filter:"payment_status=neq.unpaid"},e=>{var t;W();const a=null==(t=e.new)?void 0:t.payment_status;"paid"===a?y.success("Purchase order fully paid!",{icon:"",duration:3e3}):"partial"===a&&y.success("Partial payment received!",{icon:"",duration:3e3})}).subscribe();return()=>{e.unsubscribe(),t.unsubscribe()}},[W,Y]);const Q=d.filter(e=>{var t,a,s;const r=(null==(t=e.orderNumber)?void 0:t.toLowerCase().includes(k.toLowerCase()))||(null==(s=null==(a=e.supplier)?void 0:a.name)?void 0:s.toLowerCase().includes(k.toLowerCase())),n="all"===D||e.paymentStatus===D,l="all"===T||e.currency===T;return r&&n&&l});return w?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading purchase orders..."})]}):e.jsxs("div",{className:"min-h-screen p-6 space-y-6",style:{backgroundColor:"transparent"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Purchase Orders"}),e.jsx("p",{className:"text-gray-600",children:"Manage supplier payments and track purchase orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{W(),Y()},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(R,{size:16}),"Refresh"]}),e.jsxs("button",{onClick:l,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(F,{size:16}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(n,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:H.totalOrders})]}),e.jsx("div",{className:"p-3 bg-blue-500 rounded-lg",children:e.jsx(v,{className:"w-6 h-6 text-white"})})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:V(H.totalAmount)})]}),e.jsx("div",{className:"p-3 bg-green-500 rounded-lg",children:e.jsx(b,{className:"w-6 h-6 text-white"})})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Outstanding"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:V(H.totalOutstanding)})]}),e.jsx("div",{className:"p-3 bg-yellow-500 rounded-lg",children:e.jsx(x,{className:"w-6 h-6 text-white"})})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Unpaid Orders"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:H.unpaidOrders})]}),e.jsx("div",{className:"p-3 bg-purple-500 rounded-lg",children:e.jsx(f,{className:"w-6 h-6 text-white"})})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Overpaid Orders"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:H.overpaidOrders})]}),e.jsx("div",{className:"p-3 bg-orange-500 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-white"})})]})})]}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search purchase orders or suppliers...",value:k,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ke,{value:D,onChange:e=>P(e.target.value),className:"min-w-[140px]",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"paid",children:"Paid"})]}),e.jsxs(Ke,{value:T,onChange:e=>A(e.target.value),className:"min-w-[160px]",children:[e.jsx("option",{value:"all",children:"All Currencies"}),e.jsx("option",{value:"TZS",children:"Tanzanian Shilling (TZS)"}),e.jsx("option",{value:"USD",children:"US Dollar (USD)"}),e.jsx("option",{value:"EUR",children:"Euro (EUR)"}),e.jsx("option",{value:"GBP",children:"British Pound (GBP)"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:Q.map(t=>{var a;const s=t.totalAmount-(t.totalPaid||0),r=Math.min((t.totalPaid||0)/t.totalAmount*100,100);return e.jsxs(n,{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx($,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["PO-",t.orderNumber]}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),(null==(a=t.supplier)?void 0:a.name)||"Unknown Supplier"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${K(t.paymentStatus||"unpaid",s)}`,children:s<0?"overpaid":t.paymentStatus||"unpaid"}),s>0?e.jsxs("button",{onClick:()=>(e=>{const t=e.totalAmount||0,a=e.totalPaid||0;0!==t?t-a<=0?y.error(`Purchase order is fully paid. Total: ${t.toLocaleString()}, Paid: ${a.toLocaleString()}`):(U(e),G(!0)):y.error("Cannot make payment: Purchase order has no total amount")})(t),className:"flex items-center gap-1 px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-xs font-medium",children:[e.jsx(z,{size:12}),"Pay"]}):e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-gray-100 text-gray-500 rounded-lg text-xs font-medium cursor-not-allowed",children:[e.jsx(I,{size:12}),s<0?"Overpaid":"Fully Paid"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Progress"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium",children:[Math.round(r),"%"]}),s<0&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full",children:"Overpaid"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(s<0?"bg-gradient-to-r from-orange-400 to-orange-600":100===r?"bg-gradient-to-r from-green-400 to-green-600":"bg-gradient-to-r from-blue-400 to-blue-600"),style:{width:`${Math.min(r,100)}%`}})})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"font-semibold text-gray-900",children:V(t.totalAmount)})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Paid"}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"font-medium text-green-600 flex items-center gap-1",children:[e.jsx(O,{className:"w-3 h-3"}),V(t.totalPaid||0)]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Remaining"}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"font-medium flex items-center gap-1 "+(s<0?"text-orange-600":0===s?"text-green-600":"text-red-600"),children:[s<0?e.jsx(O,{className:"w-3 h-3"}):e.jsx(M,{className:"w-3 h-3"}),V(s<0?Math.abs(s):s)]})})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),"Expected: ",new Date(t.expectedDelivery).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),new Date(t.createdAt).toLocaleDateString()]})]})})]},t.id)})}),u.length>0&&e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Payments"}),e.jsx("button",{onClick:()=>{},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:u.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg hover:from-gray-100 hover:to-gray-200 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(j,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:V(a.amount)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[a.payment_method,"  ",new Date(a.payment_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+("completed"===a.status?"bg-green-100 text-green-700":"pending"===a.status?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"),children:a.status}),e.jsx("button",{onClick:()=>t(a),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(q,{className:"w-4 h-4"})})]})]},a.id))})]}),e.jsx(Ae,{isOpen:Z,onClose:()=>G(!1),amount:B?B.totalAmount-(B.totalPaid||0):0,customerId:null==B?void 0:B.supplier_id,customerName:(null==(o=null==B?void 0:B.supplier)?void 0:o.name)||"Supplier",description:`Payment for Purchase Order PO-${null==B?void 0:B.orderNumber}`,onPaymentComplete:async(e,t)=>{if(B)try{const{purchaseOrderPaymentService:t}=await _e(()=>import("./purchaseOrderPaymentService-6c3df30a.js"),["assets/purchaseOrderPaymentService-6c3df30a.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{data:{user:s}}=await a.auth.getUser(),r=(await Promise.all(e.map(async e=>await t.processPayment({purchaseOrderId:B.id,paymentAccountId:e.paymentAccountId,amount:e.amount,currency:e.currency,paymentMethod:e.paymentMethod,paymentMethodId:e.paymentMethodId,reference:e.reference||`PO-${B.orderNumber}`,notes:e.notes||`Payment via ${e.paymentMethod}`,createdBy:(null==s?void 0:s.id)||""})))).filter(e=>!e.success);if(r.length>0){const e=r.map(e=>e.message).join("; ");y.error(`Some payments failed: ${e}`)}else y.success("All payments processed successfully");G(!1),U(null),await Promise.all([W(),Y(),J()])}catch(s){y.error(s.message||"Failed to process payment")}else y.error("No purchase order selected")},title:"Purchase Order Payment",paymentType:"cash_out"})]})},rt=({type:t,size:a="md",className:s=""})=>{const r={sm:{container:"w-8 h-8",icon:16},md:{container:"w-12 h-12",icon:24},lg:{container:"w-16 h-16",icon:32}},n=(t=>{switch(t){case"cash":return{icon:e.jsx(b,{size:r[a].icon}),bgColor:"bg-gradient-to-br from-green-400 to-green-600",borderColor:"border-green-200",shadowColor:"shadow-green-200"};case"bank":return{icon:e.jsx(_,{size:r[a].icon}),bgColor:"bg-gradient-to-br from-blue-400 to-blue-600",borderColor:"border-blue-200",shadowColor:"shadow-blue-200"};case"mobile_money":return{icon:e.jsx(k,{size:r[a].icon}),bgColor:"bg-gradient-to-br from-purple-400 to-purple-600",borderColor:"border-purple-200",shadowColor:"shadow-purple-200"};case"credit_card":return{icon:e.jsx(j,{size:r[a].icon}),bgColor:"bg-gradient-to-br from-orange-400 to-orange-600",borderColor:"border-orange-200",shadowColor:"shadow-orange-200"};case"savings":return{icon:e.jsx(B,{size:r[a].icon}),bgColor:"bg-gradient-to-br from-indigo-400 to-indigo-600",borderColor:"border-indigo-200",shadowColor:"shadow-indigo-200"};case"wallet":return{icon:e.jsx(w,{size:r[a].icon}),bgColor:"bg-gradient-to-br from-teal-400 to-teal-600",borderColor:"border-teal-200",shadowColor:"shadow-teal-200"};default:return{icon:e.jsx(A,{size:r[a].icon}),bgColor:"bg-gradient-to-br from-gray-400 to-gray-600",borderColor:"border-gray-200",shadowColor:"shadow-gray-200"}}})(t);return e.jsx("div",{className:`\n        ${r[a].container}\n        ${n.bgColor}\n        ${n.borderColor}\n        ${n.shadowColor}\n        rounded-xl\n        border-2\n        shadow-lg\n        flex\n        items-center\n        justify-center\n        text-white\n        transition-all\n        duration-200\n        hover:scale-105\n        hover:shadow-xl\n        ${s}\n      `,children:n.icon})},nt=({account:t,onClose:s,onSuccess:r})=>{const[n,l]=i.useState({type:"deposit",amount:"",description:"",reference:""}),[c,o]=i.useState(!1);return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[(()=>{switch(n.type){case"deposit":return e.jsx(z,{className:"text-green-600",size:20});case"withdrawal":return e.jsx(U,{className:"text-red-600",size:20});default:return e.jsx(b,{className:"text-blue-600",size:20})}})(),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Manual Transaction"}),e.jsx("p",{className:"text-blue-100 text-sm",children:t.name})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/20 rounded-lg transition-all",disabled:c,children:e.jsx(u,{size:20})})]})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const l=parseFloat(n.amount);if(!n.amount||isNaN(l)||l<=0)y.error("Please enter a valid amount");else if(n.description&&""!==n.description.trim())if("withdrawal"===n.type&&l>(t.balance||0))y.error("Insufficient balance for withdrawal");else{o(!0);try{const{data:e,error:i}=await a.from("finance_accounts").select("balance").eq("id",t.id).single();if(i)throw i;const c=Number(e.balance)||0,o=l;let d,m;"deposit"===n.type?(d=c+o,m="payment_received"):"withdrawal"===n.type?(d=c-o,m="expense"):(d=c+o,m="adjustment");const{error:u}=await a.from("finance_accounts").update({balance:d,updated_at:(new Date).toISOString()}).eq("id",t.id);if(u)throw u;const{error:x}=await a.from("account_transactions").insert({account_id:t.id,transaction_type:m,amount:o,balance_before:c,balance_after:d,description:n.description,reference_number:n.reference||`MAN-${Date.now().toString(36).toUpperCase()}`,metadata:{manual_entry:!0,entry_type:n.type,account_name:t.name},created_at:(new Date).toISOString()});if(x)throw x;y.success("deposit"===n.type?"Deposit recorded successfully":"withdrawal"===n.type?"Withdrawal recorded successfully":"Adjustment recorded successfully"),r(),s()}catch(i){y.error(i.message||"Failed to record transaction")}finally{o(!1)}}else y.error("Please enter a description")},className:"p-6 space-y-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Current Balance"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:t.currency||"TZS"}).format(t.balance||0)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Transaction Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>l({...n,type:"deposit"}),className:"p-3 rounded-lg border-2 transition-all "+("deposit"===n.type?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"),children:[e.jsx(z,{size:20,className:"mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-medium",children:"Deposit"})]}),e.jsxs("button",{type:"button",onClick:()=>l({...n,type:"withdrawal"}),className:"p-3 rounded-lg border-2 transition-all "+("withdrawal"===n.type?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"),children:[e.jsx(U,{size:20,className:"mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-medium",children:"Withdrawal"})]}),e.jsxs("button",{type:"button",onClick:()=>l({...n,type:"adjustment"}),className:"p-3 rounded-lg border-2 transition-all "+("adjustment"===n.type?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[e.jsx(b,{size:20,className:"mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-medium",children:"Adjust"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(He,{type:"number",value:n.amount,onChange:e=>l({...n,amount:e.target.value}),placeholder:"0.00",step:"0.01",min:"0",required:!0}),"withdrawal"===n.type&&n.amount&&parseFloat(n.amount)>(t.balance||0)&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-red-600 text-sm",children:[e.jsx(x,{size:16}),e.jsx("span",{children:"Insufficient balance"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:n.description,onChange:e=>l({...n,description:e.target.value}),placeholder:"Enter transaction description...",required:!0,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 bg-white/80 backdrop-blur-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number (Optional)"}),e.jsx(He,{value:n.reference,onChange:e=>l({...n,reference:e.target.value}),placeholder:"Auto-generated if blank"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(x,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:["deposit"===n.type&&e.jsxs(e.Fragment,{children:["This will ",e.jsx("strong",{children:"add"})," money to the account balance."]}),"withdrawal"===n.type&&e.jsxs(e.Fragment,{children:["This will ",e.jsx("strong",{children:"subtract"})," money from the account balance."]}),"adjustment"===n.type&&e.jsx(e.Fragment,{children:"Use this to correct balance discrepancies or make adjustments."})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:s,disabled:c,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:c,className:`flex-1 px-4 py-3 bg-gradient-to-r ${(()=>{switch(n.type){case"deposit":return"from-green-500 to-green-600";case"withdrawal":return"from-red-500 to-red-600";default:return"from-blue-500 to-blue-600"}})()} text-white rounded-lg hover:opacity-90 transition-all font-medium flex items-center justify-center gap-2 disabled:opacity-50`,children:[e.jsx(Z,{size:16}),c?"Recording...":"Record Transaction"]})]})]})]})})},lt=({accounts:t,defaultSourceAccount:r,onClose:n,onSuccess:l})=>{const{currentUser:c}=s(),[o,d]=i.useState({sourceAccountId:(null==r?void 0:r.id)||"",destinationAccountId:"",amount:"",description:"",reference:""}),[m,h]=i.useState(!1),[p,g]=i.useState(!1),[b,j]=i.useState({frequency:"monthly",startDate:(new Date).toISOString().split("T")[0],endDate:"",autoExecute:!0,notificationEnabled:!0,notificationDaysBefore:1}),v=t.find(e=>e.id===o.sourceAccountId),N=t.find(e=>e.id===o.destinationAccountId),w=t.filter(e=>e.id!==o.sourceAccountId),_=t.filter(e=>e.id!==o.destinationAccountId),S=async e=>{const{data:t,error:s}=await a.from("finance_accounts").select("balance, name, currency").eq("id",o.sourceAccountId).single();if(s)throw s;const{data:r,error:i}=await a.from("finance_accounts").select("balance, name, currency").eq("id",o.destinationAccountId).single();if(i)throw i;const c=Number(t.balance)||0,d=Number(r.balance)||0;if(e>c)return void y.error("Insufficient balance in source account");const m=c-e,u=d+e,x=o.reference||`TRF-${Date.now().toString(36).toUpperCase()}`,{error:h}=await a.from("finance_accounts").update({balance:m,updated_at:(new Date).toISOString()}).eq("id",o.sourceAccountId);if(h)throw h;const{error:p}=await a.from("finance_accounts").update({balance:u,updated_at:(new Date).toISOString()}).eq("id",o.destinationAccountId);if(p)throw await a.from("finance_accounts").update({balance:c}).eq("id",o.sourceAccountId),p;const{error:g}=await a.from("account_transactions").insert({account_id:o.sourceAccountId,transaction_type:"transfer_out",amount:e,balance_before:c,balance_after:m,description:`Transfer to ${r.name}: ${o.description}`,reference_number:x,metadata:{transfer:!0,transfer_type:"outgoing",destination_account_id:o.destinationAccountId,destination_account_name:r.name,destination_currency:r.currency},created_at:(new Date).toISOString()}),{error:b}=await a.from("account_transactions").insert({account_id:o.destinationAccountId,transaction_type:"transfer_in",amount:e,balance_before:d,balance_after:u,description:`Transfer from ${t.name}: ${o.description}`,reference_number:x,metadata:{transfer:!0,transfer_type:"incoming",source_account_id:o.sourceAccountId,source_account_name:t.name,source_currency:t.currency},created_at:(new Date).toISOString()});y.success(`Successfully transferred ${new Intl.NumberFormat("en-TZ",{style:"currency",currency:t.currency||"TZS"}).format(e)}`),l(),n()},k=async e=>{new Date(b.startDate);const t=b.startDate,{data:s,error:r}=await a.from("scheduled_transfers").insert({source_account_id:o.sourceAccountId,destination_account_id:o.destinationAccountId,amount:e,description:o.description,reference_prefix:o.reference||"SCHED-TRF",frequency:b.frequency,start_date:b.startDate,end_date:b.endDate||null,next_execution_date:t,auto_execute:b.autoExecute,notification_enabled:b.notificationEnabled,notification_days_before:b.notificationDaysBefore,is_active:!0,execution_count:0,created_by:null==c?void 0:c.id,metadata:{source_account_name:null==v?void 0:v.name,destination_account_name:null==N?void 0:N.name,currency:null==v?void 0:v.currency}}).select().single();if(r)throw r;y.success(`Scheduled ${b.frequency} transfer created successfully! First execution: ${b.startDate}`),l(),n()},C=(e,t="TZS")=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p?e.jsx(G,{size:24}):e.jsx(V,{size:24}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:p?"Schedule Recurring Transfer":"Transfer Between Accounts"}),e.jsx("p",{className:"text-purple-100 text-sm",children:p?"Set up automatic recurring transfers":"Move money from one account to another"})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-all",disabled:m,children:e.jsx(u,{size:20})})]})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!o.sourceAccountId)return void y.error("Please select a source account");if(!o.destinationAccountId)return void y.error("Please select a destination account");if(o.sourceAccountId===o.destinationAccountId)return void y.error("Source and destination accounts must be different");const t=parseFloat(o.amount);if(!o.amount||isNaN(t)||t<=0)y.error("Please enter a valid amount");else if(p||v&&!(t>(v.balance||0)))if(o.description&&""!==o.description.trim()){if(p){if(!b.startDate)return void y.error("Please select a start date");if(b.endDate&&b.endDate<b.startDate)return void y.error("End date must be after start date")}h(!0);try{p?await k(t):await S(t)}catch(a){y.error(a.message||"Failed to process transfer")}finally{h(!1)}}else y.error("Please enter a description");else y.error("Insufficient balance in source account")},className:"p-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["From Account ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o.sourceAccountId,onChange:e=>d({...o,sourceAccountId:e.target.value}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 bg-white",children:[e.jsx("option",{value:"",children:"Select source account"}),_.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",C(t.balance||0,t.currency),")"]},t.id))]}),v&&e.jsxs("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Available Balance"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:C(v.balance||0,v.currency)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["To Account ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o.destinationAccountId,onChange:e=>d({...o,destinationAccountId:e.target.value}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 bg-white",children:[e.jsx("option",{value:"",children:"Select destination account"}),w.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",C(t.balance||0,t.currency),")"]},t.id))]}),N&&e.jsxs("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Current Balance"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:C(N.balance||0,N.currency)})]})]})]}),v&&N&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:v.name}),e.jsx("div",{className:"text-xs text-gray-500",children:v.currency})]}),e.jsx(K,{className:"text-purple-600 mx-4",size:24}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:N.name}),e.jsx("div",{className:"text-xs text-gray-500",children:N.currency})]})]}),v.currency!==N.currency&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-amber-700 text-sm bg-amber-50 p-2 rounded-lg",children:[e.jsx(x,{size:16}),e.jsxs("span",{children:["Currency mismatch: ",v.currency,"  ",N.currency]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Transfer Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(He,{type:"number",value:o.amount,onChange:e=>d({...o,amount:e.target.value}),placeholder:"0.00",step:"0.01",min:"0",required:!0}),o.amount&&v&&parseFloat(o.amount)>(v.balance||0)&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-red-600 text-sm",children:[e.jsx(x,{size:16}),e.jsx("span",{children:"Insufficient balance in source account"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:o.description,onChange:e=>d({...o,description:e.target.value}),placeholder:"Reason for transfer...",required:!0,rows:2,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 bg-white resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number (Optional)"}),e.jsx(He,{value:o.reference,onChange:e=>d({...o,reference:e.target.value}),placeholder:"Auto-generated if blank"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"text-purple-600",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Schedule Recurring Transfer"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Set up automatic recurring transfers"})]})]}),e.jsx("button",{type:"button",onClick:()=>g(!p),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(p?"bg-purple-600":"bg-gray-200"),children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(p?"translate-x-6":"translate-x-1")})})]}),p&&e.jsxs("div",{className:"space-y-4 bg-purple-50 rounded-xl p-4 border border-purple-200",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Frequency ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:b.frequency,onChange:e=>j({...b,frequency:e.target.value}),required:p,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 bg-white",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"biweekly",children:"Bi-weekly (Every 2 weeks)"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly (Every 3 months)"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Start Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"date",value:b.startDate,onChange:e=>j({...b,startDate:e.target.value}),min:(new Date).toISOString().split("T")[0],required:p,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 bg-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"date",value:b.endDate,onChange:e=>j({...b,endDate:e.target.value}),min:b.startDate,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 bg-white"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for indefinite"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Auto-Execute"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Automatically process transfers on schedule"})]}),e.jsx("button",{type:"button",onClick:()=>j({...b,autoExecute:!b.autoExecute}),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(b.autoExecute?"bg-green-600":"bg-gray-200"),children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(b.autoExecute?"translate-x-6":"translate-x-1")})})]}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Notifications"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Get notified before transfers"})]}),e.jsx("button",{type:"button",onClick:()=>j({...b,notificationEnabled:!b.notificationEnabled}),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(b.notificationEnabled?"bg-blue-600":"bg-gray-200"),children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(b.notificationEnabled?"translate-x-6":"translate-x-1")})})]}),b.notificationEnabled&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Days before transfer:"}),e.jsx("input",{type:"number",min:"0",max:"30",value:b.notificationDaysBefore,onChange:e=>j({...b,notificationDaysBefore:parseInt(e.target.value)||1}),className:"w-24 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 bg-white"})]})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg p-4 border border-purple-200",children:[e.jsxs("div",{className:"text-sm font-medium text-purple-900 mb-2 flex items-center gap-2",children:[e.jsx(f,{size:16}),"Schedule Summary"]}),e.jsxs("div",{className:"space-y-1 text-sm text-purple-800",children:[e.jsxs("div",{children:[" Transfer will occur ",e.jsx("span",{className:"font-bold",children:b.frequency})]}),e.jsxs("div",{children:[" Starting from ",e.jsx("span",{className:"font-bold",children:new Date(b.startDate).toLocaleDateString()})]}),b.endDate&&e.jsxs("div",{children:[" Ending on ",e.jsx("span",{className:"font-bold",children:new Date(b.endDate).toLocaleDateString()})]}),!b.endDate&&e.jsx("div",{children:" No end date (will continue indefinitely)"}),b.autoExecute?e.jsx("div",{className:"text-green-700",children:" Will execute automatically"}):e.jsx("div",{className:"text-amber-700",children:" Requires manual approval"})]})]})]})]}),o.amount&&v&&N&&parseFloat(o.amount)>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Transfer Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-blue-700",children:"Amount to transfer:"}),e.jsx("span",{className:"font-bold text-blue-900",children:C(parseFloat(o.amount),v.currency)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-blue-700",children:[v.name," new balance:"]}),e.jsx("span",{className:"font-bold text-blue-900",children:C((v.balance||0)-parseFloat(o.amount),v.currency)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-blue-700",children:[N.name," new balance:"]}),e.jsx("span",{className:"font-bold text-blue-900",children:C((N.balance||0)+parseFloat(o.amount),N.currency)})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,disabled:m,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:m,className:"flex-1 px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:opacity-90 transition-all font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:[p?e.jsx(G,{size:16}):e.jsx(Z,{size:16}),m?"Processing...":p?"Create Schedule":"Transfer Now"]})]})]})]})})},it=({transaction:t,accountName:s,accountCurrency:r,onClose:n,onSuccess:l})=>{const[c,o]=i.useState(""),[d,m]=i.useState(!1),x=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:r||"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),h=e=>({payment_received:"Payment Received",expense:"Expense",transfer_in:"Transfer In",transfer_out:"Transfer Out",adjustment:"Adjustment"}[e]||e);return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{size:24}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Reverse Transaction"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"This action will create a reversal entry"})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-all",disabled:d,children:e.jsx(u,{size:20})})]})}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(g,{className:"text-orange-600 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-orange-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Important:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"This will create a reversal transaction"}),e.jsx("li",{children:"The account balance will be adjusted"}),e.jsx("li",{children:"Original transaction will be marked as reversed"}),e.jsx("li",{children:"This action cannot be undone"})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Transaction to Reverse:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Account"}),e.jsx("div",{className:"font-medium text-gray-900",children:s})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Date"}),e.jsx("div",{className:"font-medium text-gray-900",children:(p=t.created_at,new Date(p).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Type"}),e.jsx("div",{className:"font-medium text-gray-900",children:h(t.transaction_type)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Amount"}),e.jsx("div",{className:"font-medium text-gray-900",children:x(t.amount)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Description"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.description||"No description"})]}),t.reference_number&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Reference"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.reference_number})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Impact of Reversal:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Original Transaction:"}),e.jsxs("span",{className:"font-bold text-blue-900",children:["payment_received"===t.transaction_type||"transfer_in"===t.transaction_type?"+":"-",x(t.amount)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Reversal Effect:"}),e.jsxs("span",{className:"font-bold text-blue-900",children:["payment_received"===t.transaction_type||"transfer_in"===t.transaction_type?"-":"+",x(t.amount)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason for Reversal ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:c,onChange:e=>o(e.target.value),placeholder:"e.g., Duplicate entry, Error in amount, Wrong account...",required:!0,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500/30 focus:border-orange-500 resize-none",disabled:d}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will be recorded in the reversal transaction"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,disabled:d,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if(c&&""!==c.trim()){if(confirm("Are you sure you want to reverse this transaction? This action cannot be undone.")){m(!0);try{const{data:e,error:s}=await a.from("finance_accounts").select("balance").eq("id",t.account_id).single();if(s)throw s;const r=Number(e.balance)||0,i="payment_received"===t.transaction_type||"transfer_in"===t.transaction_type,o=t.amount,d=i?r-o:r+o;if(d<0)return y.error("Reversal would result in negative balance. Cannot proceed."),void m(!1);const{error:u}=await a.from("finance_accounts").update({balance:d,updated_at:(new Date).toISOString()}).eq("id",t.account_id);if(u)throw u;const{error:x}=await a.from("account_transactions").insert({account_id:t.account_id,transaction_type:"adjustment",amount:o,balance_before:r,balance_after:d,description:`REVERSAL: ${t.description||h(t.transaction_type)}`,reference_number:`REV-${t.reference_number||t.id.substring(0,8)}`,related_entity_type:"transaction_reversal",related_entity_id:t.id,metadata:{reversal:!0,original_transaction_id:t.id,original_type:t.transaction_type,original_amount:t.amount,original_date:t.created_at,original_reference:t.reference_number,reversal_reason:c,reversed_at:(new Date).toISOString()},created_at:(new Date).toISOString()});if(x)throw x;const p=t.metadata||{},{error:g}=await a.from("account_transactions").update({metadata:{...p,reversed:!0,reversed_at:(new Date).toISOString(),reversal_reason:c},updated_at:(new Date).toISOString()}).eq("id",t.id);y.success("Transaction reversed successfully"),l(),n()}catch(e){y.error(e.message||"Failed to reverse transaction")}finally{m(!1)}}}else y.error("Please provide a reason for reversal")},disabled:d||!c.trim(),className:"flex-1 px-4 py-3 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white rounded-lg transition-all font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(H,{size:16}),d?"Reversing...":"Reverse Transaction"]})]})]})]})});var p},ct=({onRefresh:s})=>{const[r,l]=i.useState([]),[c,o]=i.useState(!0),[d,u]=i.useState(null),[x,h]=i.useState(!1),[g,j]=i.useState([]),[v,N]=i.useState(!1),[w,_]=i.useState("all");i.useEffect(()=>{S()},[]);const S=async()=>{o(!0);try{const{data:e,error:t}=await a.from("scheduled_transfers").select("\n          *,\n          source_account:finance_accounts!source_account_id(name, currency),\n          destination_account:finance_accounts!destination_account_id(name, currency)\n        ").order("next_execution_date",{ascending:!0});if(t)throw t;l(e||[])}catch(e){y.error("Failed to load scheduled transfers")}finally{o(!1)}},k=e=>{u(e),h(!0),(async e=>{N(!0);try{const{data:t,error:s}=await a.from("scheduled_transfer_executions").select("*").eq("scheduled_transfer_id",e).order("execution_date",{ascending:!1}).limit(20);if(s)throw s;j(t||[])}catch(t){y.error("Failed to load execution history")}finally{N(!1)}})(e.id)},D=(e,t="TZS")=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e),P=e=>{const t=Math.ceil((new Date(e).getTime()-(new Date).getTime())/864e5);return t<0?"Overdue":0===t?"Today":1===t?"Tomorrow":`in ${t} days`},T=r.filter(e=>"active"===w?e.is_active:"inactive"!==w||!e.is_active);return c?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading scheduled transfers..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(G,{className:"text-purple-600",size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.filter(e=>e.is_active).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Active Schedules"})]})]})}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(p,{className:"text-green-600",size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.reduce((e,t)=>e+t.execution_count,0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Executions"})]})]})}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"text-blue-600",size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:D(r.filter(e=>e.is_active).reduce((e,t)=>e+t.amount,0))}),e.jsx("div",{className:"text-sm text-gray-600",children:"Monthly Volume"})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>_("all"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all "+("all"===w?"bg-purple-600 text-white shadow-lg shadow-purple-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-purple-300"),children:["All (",r.length,")"]}),e.jsxs("button",{onClick:()=>_("active"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all "+("active"===w?"bg-green-600 text-white shadow-lg shadow-green-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-green-300"),children:["Active (",r.filter(e=>e.is_active).length,")"]}),e.jsxs("button",{onClick:()=>_("inactive"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all "+("inactive"===w?"bg-gray-600 text-white shadow-lg shadow-gray-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"),children:["Paused (",r.filter(e=>!e.is_active).length,")"]}),e.jsx("div",{className:"ml-auto",children:e.jsxs(t,{onClick:S,size:"sm",children:[e.jsx(R,{size:16,className:"mr-2"}),"Refresh"]})})]}),0===T.length?e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(G,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["No ","all"!==w?w:""," scheduled transfers"]}),e.jsx("p",{className:"text-gray-600",children:"all"===w?"Create your first scheduled transfer to automate recurring payments.":`Switch to another tab to see ${"active"===w?"paused":"active"} transfers.`})]}):e.jsx("div",{className:"grid gap-4",children:T.map(t=>{var r,l,i,c;return e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t.description}),!t.is_active&&e.jsx(m,{variant:"secondary",size:"sm",children:"Paused"}),t.auto_execute&&e.jsx(m,{variant:"success",size:"sm",children:"Auto"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{size:14}),e.jsx("span",{className:"font-medium",children:(c=t.frequency,{daily:"Daily",weekly:"Weekly",biweekly:"Bi-weekly",monthly:"Monthly",quarterly:"Quarterly",yearly:"Yearly"}[c]||c)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{size:14}),e.jsx("span",{className:"font-bold text-gray-900",children:D(t.amount,null==(r=t.source_account)?void 0:r.currency)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:14}),e.jsxs("span",{children:["Executed ",t.execution_count,"x"]})]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-3 py-1 bg-blue-50 rounded-lg text-blue-700 font-medium",children:null==(l=t.source_account)?void 0:l.name}),e.jsx(K,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"px-3 py-1 bg-green-50 rounded-lg text-green-700 font-medium",children:null==(i=t.destination_account)?void 0:i.name})]})})]}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Next Transfer"}),e.jsx("div",{className:"text-sm font-bold text-gray-900",children:new Date(t.next_execution_date).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-purple-600 font-medium",children:P(t.next_execution_date)})]})})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>(async e=>{try{const{data:t,error:r}=await a.rpc("execute_scheduled_transfer",{p_scheduled_transfer_id:e.id});if(r)throw r;if(t&&t.length>0&&t[0].success)y.success("Transfer executed successfully!"),S(),null==s||s();else{const e=t&&t.length>0?t[0].message:"Unknown error";y.error(`Failed to execute transfer: ${e}`)}}catch(t){y.error(t.message||"Failed to execute transfer")}})(t),className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all text-sm font-medium",disabled:!t.is_active,children:[e.jsx(W,{size:14}),"Execute Now"]}),e.jsxs("button",{onClick:()=>(async e=>{try{const{error:t}=await a.from("scheduled_transfers").update({is_active:!e.is_active}).eq("id",e.id);if(t)throw t;y.success("Transfer "+(e.is_active?"paused":"activated")),S(),null==s||s()}catch(t){y.error("Failed to update transfer status")}})(t),className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-all text-sm font-medium "+(t.is_active?"bg-amber-100 text-amber-700 hover:bg-amber-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:[t.is_active?e.jsx(Y,{size:14}):e.jsx(W,{size:14}),t.is_active?"Pause":"Activate"]}),e.jsxs("button",{onClick:()=>k(t),className:"flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all text-sm font-medium",children:[e.jsx(q,{size:14}),"History"]}),e.jsxs("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this scheduled transfer? This action cannot be undone."))try{const{error:t}=await a.from("scheduled_transfers").delete().eq("id",e);if(t)throw t;y.success("Scheduled transfer deleted"),S(),null==s||s()}catch(t){y.error("Failed to delete scheduled transfer")}})(t.id),className:"flex items-center gap-2 px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-all text-sm font-medium ml-auto",children:[e.jsx(J,{size:14}),"Delete"]})]})]},t.id)})}),x&&d&&e.jsx(je,{isOpen:x,onClose:()=>{h(!1),u(null),j([])},title:`Execution History - ${d.description}`,children:e.jsx("div",{className:"space-y-4",children:v?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading history..."})]}):0===g.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(f,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No execution history yet"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:g.map(t=>{var a;return e.jsxs("div",{className:"p-4 rounded-lg border-2 "+("success"===t.status?"bg-green-50 border-green-200":"failed"===t.status?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:["success"===t.status&&e.jsx(p,{className:"text-green-600",size:16}),"failed"===t.status&&e.jsx(Q,{className:"text-red-600",size:16}),"pending"===t.status&&e.jsx(f,{className:"text-gray-600",size:16}),e.jsx("span",{className:"text-sm font-bold "+("success"===t.status?"text-green-700":"failed"===t.status?"text-red-700":"text-gray-700"),children:t.status.toUpperCase()})]}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:D(t.amount,null==(a=d.source_account)?void 0:a.currency)})]}),e.jsx("div",{className:"text-xs text-gray-600",children:new Date(t.execution_date).toLocaleString()}),t.error_message&&e.jsx("div",{className:"mt-2 text-xs text-red-600 bg-red-100 p-2 rounded",children:t.error_message})]},t.id)})})})})]})},ot=e=>new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),dt=e=>new Date(e).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),mt=(e,t="TZS")=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e),ut=e=>({payment_received:"Payment Received",expense:"Expense",transfer_in:"Transfer In",transfer_out:"Transfer Out",adjustment:"Adjustment"}[e]||e),xt=()=>{s();const{refreshPaymentMethods:t}=l(),[n,o]=i.useState([]),[d,m]=i.useState(!0),[x,h]=i.useState(!1),[g,f]=i.useState(null),[v,N]=i.useState("all"),[S,T]=i.useState(!1),[A,F]=i.useState(null),[E,$]=i.useState([]),[I,q]=i.useState(!1),[B,U]=i.useState("all"),[K,H]=i.useState({start:"",end:""}),[W,Y]=i.useState(!1),[ae,se]=i.useState(null),[re,ne]=i.useState(!1),[le,ie]=i.useState(!1),[ce,oe]=i.useState(null),[de,me]=i.useState("accounts"),[ue,xe]=i.useState({name:"",type:"cash",balance:0,currency:"TZS",is_active:!0,is_payment_method:!0,requires_reference:!1,requires_account_number:!1}),he=(e,t="TZS")=>{const a=Number(e);return!isFinite(a)||isNaN(a)?new Intl.NumberFormat("en-TZ",{style:"currency",currency:t||"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(0):new Intl.NumberFormat("en-TZ",{style:"currency",currency:t||"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)},pe=c.useMemo(()=>"all"===v?n:n.filter(e=>e.currency===v),[n,v]),ge=c.useMemo(()=>{const e=pe.length,t=pe.filter(e=>e.is_active).length,a=pe.reduce((e,t)=>{const a=Number(t.balance);return e+(isNaN(a)?0:a)},0),s=pe.reduce((e,t)=>{const a=Number(t.totalReceived);return e+(isNaN(a)?0:a)},0),r=pe.reduce((e,t)=>{const a=Number(t.totalSpent);return e+(isNaN(a)?0:a)},0);return{totalAccounts:e,activeAccounts:t,totalBalance:a,totalReceived:s,totalSpent:r,netFlow:s-r,accountTypes:pe.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{})}},[pe]),ye=i.useCallback(async()=>{m(!0);try{const e=await r.getPaymentMethods(),t=await Promise.all(e.map(async e=>{const{data:t}=await a.from("account_transactions").select("*").eq("account_id",e.id).order("created_at",{ascending:!1}).limit(5),{data:s}=await a.from("account_transactions").select("transaction_type, amount").eq("account_id",e.id),r=(null==s?void 0:s.filter(e=>"payment_received"===e.transaction_type||"transfer_in"===e.transaction_type).reduce((e,t)=>e+Number(t.amount),0))||0,n=(null==s?void 0:s.filter(e=>"payment_made"===e.transaction_type||"expense"===e.transaction_type||"transfer_out"===e.transaction_type).reduce((e,t)=>e+Number(t.amount),0))||0,l=Number(e.balance)||0;return{...e,balance:l,recentTransactions:t||[],totalReceived:r,totalSpent:n}}));o(t)}catch(e){y.error("Failed to load payment accounts")}finally{m(!1)}},[]),be=i.useCallback(async()=>{await t(),await ye()},[t,ye]);i.useEffect(()=>{ye();const e=setInterval(()=>{ye()},3e4);return()=>{clearInterval(e)}},[ye]);const fe=(e,t)=>{xe(a=>({...a,[e]:t}))},je=async e=>{F(e),T(!0),U("all"),await(async e=>{q(!0);try{const{data:t,error:s}=await a.from("account_transactions").select("*").eq("account_id",e).order("created_at",{ascending:!1});if(s)throw s;$(t||[])}catch(t){y.error("Failed to load transaction history")}finally{q(!1)}})(e.id)};return d?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading payment accounts..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-1",children:"Payment Accounts"}),e.jsx("p",{className:"text-gray-500",children:"Track balances and manage your payment methods"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:ye,className:"flex items-center gap-2 px-5 py-2.5 bg-white border border-gray-200 hover:border-gray-300 hover:shadow-sm text-gray-700 rounded-xl transition-all font-medium",children:[e.jsx(R,{size:18}),e.jsx("span",{children:"Refresh"})]}),e.jsxs("button",{onClick:()=>ne(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-xl transition-all font-medium shadow-lg shadow-purple-500/30",children:[e.jsx(V,{size:18}),e.jsx("span",{children:"Transfer"})]}),e.jsxs("button",{onClick:async()=>{m(!0),await ye(),m(!1)},className:"flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl transition-all font-medium shadow-lg shadow-green-500/30",title:"Refresh account balances from database",children:[e.jsx(R,{size:18,className:d?"animate-spin":""}),e.jsx("span",{children:"Refresh"})]}),e.jsxs("button",{onClick:()=>{f(null),xe({name:"",type:"cash",balance:0,currency:"TZS",is_active:!0,is_payment_method:!0,requires_reference:!1,requires_account_number:!1}),h(!0)},className:"flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl transition-all font-medium shadow-lg shadow-blue-500/30",children:[e.jsx(z,{size:18}),e.jsx("span",{children:"Add Account"})]})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsxs("button",{onClick:()=>me("accounts"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors "+("accounts"===de?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(w,{size:16}),"Payment Accounts"]}),e.jsxs("button",{onClick:()=>me("scheduled"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors "+("scheduled"===de?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(G,{size:16}),"Scheduled Transfers"]})]})}),"scheduled"===de?e.jsx(ct,{onRefresh:ye}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{size:18,className:"text-gray-400"}),e.jsxs("select",{value:v,onChange:e=>N(e.target.value),className:"px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 text-sm font-medium",children:[e.jsx("option",{value:"all",children:"All Currencies"}),e.jsx("option",{value:"TZS",children:"Tanzanian Shilling (TZS)"}),e.jsx("option",{value:"USD",children:"US Dollar (USD)"}),e.jsx("option",{value:"EUR",children:"Euro (EUR)"}),e.jsx("option",{value:"GBP",children:"British Pound (GBP)"})]})]}),"all"!==v&&e.jsxs("button",{onClick:()=>N("all"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1",children:[e.jsx(u,{size:14}),"Clear Filter"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg shadow-blue-500/30",children:e.jsx(w,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-medium mb-1",children:"Total Accounts"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ge.totalAccounts})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl shadow-lg shadow-emerald-500/30",children:e.jsx(b,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-medium mb-1",children:"Total Balance"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:he(ge.totalBalance,"all"!==v?v:"TZS")})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg shadow-purple-500/30",children:e.jsx(p,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-medium mb-1",children:"Active Accounts"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ge.activeAccounts})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg shadow-orange-500/30",children:e.jsx(P,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-medium mb-1",children:"Net Flow"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:he(ge.netFlow,"all"!==v?v:"TZS")})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:pe.map(t=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-xl hover:border-gray-300 transition-all group",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rt,{type:t.type,size:"md"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500 capitalize flex items-center gap-1 mt-0.5",children:["cash"===t.type&&e.jsx(b,{className:"w-3 h-3"}),"bank"===t.type&&e.jsx(_,{className:"w-3 h-3"}),"mobile_money"===t.type&&e.jsx(k,{className:"w-3 h-3"}),"credit_card"===t.type&&e.jsx(j,{className:"w-3 h-3"}),t.type.replace("_"," ")]})]})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),se(t),Y(!0)},className:"p-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg transition-all shadow-sm",title:"Add transaction",children:e.jsx(z,{size:14})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(e=>{f(e),xe(e),h(!0)})(t)},className:"p-2 bg-white hover:bg-gray-100 text-gray-600 hover:text-gray-900 rounded-lg transition-all border border-gray-200 shadow-sm",title:"Edit account",children:e.jsx(ee,{size:14})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this account?"))try{const{error:t}=await a.from("finance_accounts").delete().eq("id",e);if(t)throw t;y.success("Account deleted successfully"),await be()}catch(t){y.error(t.message||"Failed to delete account")}})(t.id)},className:"p-2 bg-white hover:bg-red-50 text-gray-600 hover:text-red-600 rounded-lg transition-all border border-gray-200 shadow-sm",title:"Delete account",children:e.jsx(J,{size:14})})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wide mb-1",children:"Current Balance"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:he(t.balance,t.currency)}),"TZS"!==t.currency&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Currency: ",t.currency]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl p-4 border border-emerald-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-700 mb-1",children:[e.jsx(C,{size:14}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Received"})]}),e.jsx("div",{className:"text-base font-bold text-emerald-900",children:he(t.totalReceived,t.currency)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-red-700 mb-1",children:[e.jsx(D,{size:14}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Spent"})]}),e.jsx("div",{className:"text-base font-bold text-red-900",children:he(t.totalSpent,t.currency)})]})]}),t.recentTransactions.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-2",children:t.recentTransactions.slice(0,2).map(a=>{const s="payment_received"===a.transaction_type||"transfer_in"===a.transaction_type;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors border border-gray-100",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-900 font-medium truncate",children:a.description}),e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:new Date(a.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-sm font-bold ml-3 "+(s?"text-emerald-600":"text-red-600"),children:[s?"+":"-",he(a.amount,t.currency)]})]},a.id)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium "+(t.is_active?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"),children:[t.is_active?e.jsx(p,{size:12}):e.jsx(Q,{size:12}),t.is_active?"Active":"Inactive"]})}),t.is_payment_method&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-700 bg-blue-100 px-3 py-1.5 rounded-lg font-medium",children:[e.jsx(j,{size:12}),"Payment Method"]})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),je(t)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl transition-all font-semibold text-sm shadow-lg shadow-blue-500/30 hover:shadow-xl",children:[e.jsx(te,{size:16}),"View Full History"]})]})]})]},t.id))}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(w,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g?"Edit Account":"Add New Account"}),e.jsx("p",{className:"text-sm text-gray-600",children:g?"Update account details":"Create a new payment account"})]})]}),e.jsx("button",{onClick:()=>h(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(u,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rt,{type:ue.type||"cash",size:"sm"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:ue.name||"Account Name"}),e.jsx("div",{className:"text-xs text-blue-600 capitalize",children:(ue.type||"cash").replace("_"," ")})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Account Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(He,{value:ue.name||"",onChange:e=>fe("name",e.target.value),placeholder:"e.g., Cash Drawer, CRDB Bank",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Account Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:ue.type||"cash",onChange:e=>fe("type",e.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 bg-white/80 backdrop-blur-sm text-sm font-medium transition-all",children:[e.jsx("option",{value:"cash",children:" Cash"}),e.jsx("option",{value:"bank",children:" Bank"}),e.jsx("option",{value:"mobile_money",children:" Mobile Money"}),e.jsx("option",{value:"credit_card",children:" Credit Card"}),e.jsx("option",{value:"savings",children:" Savings"}),e.jsx("option",{value:"other",children:" Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Currency ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:ue.currency||"TZS",onChange:e=>fe("currency",e.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 bg-white/80 backdrop-blur-sm text-sm font-medium transition-all",children:[e.jsx("option",{value:"TZS",children:" TZS - Tanzanian Shilling"}),e.jsx("option",{value:"USD",children:" USD - US Dollar"}),e.jsx("option",{value:"EUR",children:" EUR - Euro"}),e.jsx("option",{value:"GBP",children:" GBP - British Pound"}),e.jsx("option",{value:"KES",children:" KES - Kenyan Shilling"}),e.jsx("option",{value:"UGX",children:" UGX - Ugandan Shilling"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Balance"}),e.jsx(He,{type:"number",value:ue.balance||0,onChange:e=>fe("balance",Number(e.target.value)),placeholder:"0",step:"0.01",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Starting balance for this account (cannot be negative)"})]}),"bank"===ue.type&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Bank Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(He,{value:ue.bank_name||"",onChange:e=>fe("bank_name",e.target.value),placeholder:"e.g., CRDB Bank, NMB Bank",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number"}),e.jsx(He,{value:ue.account_number||"",onChange:e=>fe("account_number",e.target.value),placeholder:"Bank account number"})]})]}),"mobile_money"===ue.type&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Mobile Money Provider ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(He,{value:ue.bank_name||"",onChange:e=>fe("bank_name",e.target.value),placeholder:"e.g., M-Pesa, Tigo Pesa, Airtel Money",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(He,{value:ue.account_number||"",onChange:e=>fe("account_number",e.target.value),placeholder:"e.g., +255712345678",required:!0})]})]}),"credit_card"===ue.type&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Issuer"}),e.jsx(He,{value:ue.bank_name||"",onChange:e=>fe("bank_name",e.target.value),placeholder:"e.g., Visa, Mastercard"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last 4 Digits"}),e.jsx(He,{value:ue.account_number||"",onChange:e=>{const t=e.target.value.replace(/\D/g,"").slice(0,4);fe("account_number",t)},placeholder:"Last 4 digits of card",pattern:"\\d{0,4}"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:ue.notes||"",onChange:e=>fe("notes",e.target.value),placeholder:"Optional notes or description",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 bg-white/50 backdrop-blur-sm text-sm",rows:3})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Account Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ue.is_active||!1,onChange:e=>fe("is_active",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active Account"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enable this account for transactions"})]})]})}),e.jsx("label",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ue.is_payment_method||!1,onChange:e=>fe("is_payment_method",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Payment Method"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow this account to be used for payments"})]})]})}),e.jsx("label",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ue.requires_reference||!1,onChange:e=>fe("requires_reference",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Require Reference Number"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Require reference/transaction number for payments"})]})]})}),e.jsx("label",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ue.requires_account_number||!1,onChange:e=>fe("requires_account_number",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Require Account Number"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Require account/phone number for payments"})]})]})})]})]})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if(ue.name&&""!==ue.name.trim())if(ue.type)if(ue.currency)if("bank"!==ue.type||ue.bank_name){if("mobile_money"===ue.type){if(!ue.bank_name)return void y.error("Mobile money provider is required");if(!ue.account_number)return void y.error("Phone number is required for mobile money accounts")}if(ue.balance&&ue.balance<0)y.error("Balance cannot be negative");else try{if(g){const{error:e}=await a.from("finance_accounts").update({name:ue.name,type:ue.type,balance:ue.balance,currency:ue.currency,is_active:ue.is_active,is_payment_method:ue.is_payment_method,requires_reference:ue.requires_reference,requires_account_number:ue.requires_account_number,account_number:ue.account_number,bank_name:ue.bank_name,notes:ue.notes}).eq("id",g.id);if(e)throw e;y.success("Account updated successfully")}else{const{error:e}=await a.from("finance_accounts").insert({name:ue.name,type:ue.type,balance:ue.balance||0,currency:ue.currency||"TZS",is_active:ue.is_active,is_payment_method:ue.is_payment_method,requires_reference:ue.requires_reference,requires_account_number:ue.requires_account_number,account_number:ue.account_number,bank_name:ue.bank_name,notes:ue.notes});if(e)throw e;y.success("Account created successfully")}h(!1),f(null),xe({name:"",type:"cash",balance:0,currency:"TZS",is_active:!0,is_payment_method:!0,requires_reference:!1,requires_account_number:!1}),await be()}catch(e){y.error(e.message||"Failed to save account")}}else y.error("Bank name is required for bank accounts");else y.error("Currency is required");else y.error("Account type is required");else y.error("Account name is required")},className:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg transition-all font-medium flex items-center justify-center gap-2",children:[e.jsx(Z,{size:16}),g?"Update Account":"Create Account"]})]})]})}),S&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"relative p-8 border-b border-gray-200 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-2xl shadow-lg shadow-blue-500/30",children:e.jsx(te,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Transaction History"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:A.name})]})]}),e.jsx("button",{onClick:()=>T(!1),className:"p-2.5 text-gray-400 hover:text-gray-600 hover:bg-white/80 rounded-xl transition-all",children:e.jsx(u,{size:22})})]})}),e.jsx("div",{className:"p-8 bg-gradient-to-br from-gray-50 to-gray-100 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-5",children:[e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xs text-gray-500 font-semibold uppercase tracking-wide mb-2",children:"Initial Balance"}),e.jsx("div",{className:"text-xl font-bold text-gray-700",children:he(A.initialBalance||0,A.currency)}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Starting amount"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 p-5 rounded-2xl border border-emerald-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"text-xs text-emerald-700 font-semibold uppercase tracking-wide mb-2 flex items-center gap-1.5",children:[e.jsx(C,{size:14}),"Received"]}),e.jsx("div",{className:"text-xl font-bold text-emerald-900",children:he(A.totalReceived,A.currency)}),e.jsx("div",{className:"text-xs text-emerald-600 mt-1",children:"Money in"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 p-5 rounded-2xl border border-red-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"text-xs text-red-700 font-semibold uppercase tracking-wide mb-2 flex items-center gap-1.5",children:[e.jsx(D,{size:14}),"Spent"]}),e.jsx("div",{className:"text-xl font-bold text-red-900",children:he(A.totalSpent,A.currency)}),e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Money out"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-5 rounded-2xl border border-blue-200 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xs text-blue-700 font-semibold uppercase tracking-wide mb-2",children:"Current Balance"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:he(A.balance,A.currency)}),e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"Available now"})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xs text-gray-500 font-semibold uppercase tracking-wide mb-2",children:"Total Transactions"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:E.length}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"All time"})]})]})}),e.jsx("div",{className:"p-6 bg-white border-b border-gray-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(X,{size:18,className:"text-gray-400"}),e.jsxs("select",{value:B,onChange:e=>U(e.target.value),className:"px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 text-sm font-medium bg-white",children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"payment_received",children:"Money In"}),e.jsx("option",{value:"expense",children:"Expenses"}),e.jsx("option",{value:"payment_made",children:"Payments Made"}),e.jsx("option",{value:"transfer_in",children:"Transfers In"}),e.jsx("option",{value:"transfer_out",children:"Transfers Out"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{if(!A)return;((e,t)=>{const a=e.map(e=>[ot(e.created_at),dt(e.created_at),ut(e.transaction_type),e.description||"",e.reference_number||"",e.amount.toFixed(2),e.balance_before.toFixed(2),e.balance_after.toFixed(2)]);let s="data:text/csv;charset=utf-8,";s+=`"${t.accountName} - Transaction History"\n`,s+=`"Currency: ${t.currency}"\n`,t.dateRange&&(s+=`"Period: ${ot(t.dateRange.start)} to ${ot(t.dateRange.end)}"\n`),s+=`"Generated: ${ot((new Date).toISOString())} at ${dt((new Date).toISOString())}"\n`,s+="\n",s+=["Date","Time","Type","Description","Reference","Amount","Balance Before","Balance After"].map(e=>`"${e}"`).join(",")+"\n",a.forEach(e=>{s+=e.map(e=>`"${e}"`).join(",")+"\n"});const r=e.filter(e=>"payment_received"===e.transaction_type||"transfer_in"===e.transaction_type).reduce((e,t)=>e+t.amount,0),n=e.filter(e=>"expense"===e.transaction_type||"transfer_out"===e.transaction_type).reduce((e,t)=>e+t.amount,0);s+="\n",s+='"Summary:"\n',s+=`"Total Transactions:","${e.length}"\n`,s+=`"Total Received:","${mt(r,t.currency)}"\n`,s+=`"Total Spent:","${mt(n,t.currency)}"\n`,s+=`"Net Change:","${mt(r-n,t.currency)}"\n`;const l=encodeURI(s),i=document.createElement("a");i.setAttribute("href",l),i.setAttribute("download",`${t.accountName.replace(/\s+/g,"_")}_Transactions_${ot((new Date).toISOString()).replace(/\//g,"-")}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)})(E.filter(e=>{if("all"!==B&&e.transaction_type!==B)return!1;if(K.start&&new Date(e.created_at)<new Date(K.start))return!1;if(K.end){const t=new Date(K.end);if(t.setHours(23,59,59,999),new Date(e.created_at)>t)return!1}return!0}),{accountName:A.name,currency:A.currency||"TZS",dateRange:K.start&&K.end?K:void 0}),y.success("CSV exported successfully")},className:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg transition-all text-sm font-medium",children:" CSV"}),e.jsx("button",{onClick:()=>{if(!A)return;((e,t)=>{const a=window.open("","_blank");if(!a)return void alert("Please allow popups to export PDF");const s=e.filter(e=>"payment_received"===e.transaction_type||"transfer_in"===e.transaction_type).reduce((e,t)=>e+t.amount,0),r=e.filter(e=>"expense"===e.transaction_type||"transfer_out"===e.transaction_type).reduce((e,t)=>e+t.amount,0),n=`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>${t.accountName} - Transaction History</title>\n      <style>\n        @media print {\n          @page {\n            margin: 20mm;\n          }\n        }\n        body {\n          font-family: Arial, sans-serif;\n          padding: 20px;\n          color: #333;\n        }\n        .header {\n          text-align: center;\n          margin-bottom: 30px;\n          border-bottom: 2px solid #2563eb;\n          padding-bottom: 15px;\n        }\n        .header h1 {\n          margin: 0;\n          color: #1e40af;\n          font-size: 24px;\n        }\n        .header p {\n          margin: 5px 0;\n          color: #666;\n        }\n        table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: 20px 0;\n          font-size: 12px;\n        }\n        th {\n          background-color: #2563eb;\n          color: white;\n          padding: 10px;\n          text-align: left;\n          font-weight: 600;\n        }\n        td {\n          padding: 8px;\n          border-bottom: 1px solid #e5e7eb;\n        }\n        tr:nth-child(even) {\n          background-color: #f9fafb;\n        }\n        .amount-in {\n          color: #059669;\n          font-weight: 600;\n        }\n        .amount-out {\n          color: #dc2626;\n          font-weight: 600;\n        }\n        .summary {\n          margin-top: 30px;\n          padding: 15px;\n          background-color: #f3f4f6;\n          border-radius: 8px;\n        }\n        .summary-row {\n          display: flex;\n          justify-content: space-between;\n          padding: 8px 0;\n          font-size: 14px;\n        }\n        .summary-row.total {\n          border-top: 2px solid #2563eb;\n          margin-top: 10px;\n          padding-top: 15px;\n          font-weight: bold;\n          font-size: 16px;\n        }\n        .footer {\n          margin-top: 30px;\n          text-align: center;\n          color: #6b7280;\n          font-size: 11px;\n          border-top: 1px solid #e5e7eb;\n          padding-top: 15px;\n        }\n      </style>\n    </head>\n    <body>\n      <div class="header">\n        <h1>${t.accountName}</h1>\n        <p><strong>Transaction History</strong></p>\n        <p>Currency: ${t.currency}</p>\n        ${t.dateRange?`<p>Period: ${ot(t.dateRange.start)} to ${ot(t.dateRange.end)}</p>`:""}\n        <p>Generated: ${ot((new Date).toISOString())} at ${dt((new Date).toISOString())}</p>\n      </div>\n\n      <table>\n        <thead>\n          <tr>\n            <th style="width: 10%">Date</th>\n            <th style="width: 8%">Time</th>\n            <th style="width: 15%">Type</th>\n            <th style="width: 30%">Description</th>\n            <th style="width: 12%">Reference</th>\n            <th style="width: 12%; text-align: right">Amount</th>\n            <th style="width: 13%; text-align: right">Balance After</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${e.map(e=>{const a="payment_received"===e.transaction_type||"transfer_in"===e.transaction_type,s="expense"===e.transaction_type||"transfer_out"===e.transaction_type;return`\n              <tr>\n                <td>${ot(e.created_at)}</td>\n                <td>${dt(e.created_at)}</td>\n                <td>${ut(e.transaction_type)}</td>\n                <td>${e.description||"-"}</td>\n                <td>${e.reference_number||"-"}</td>\n                <td class="${a?"amount-in":s?"amount-out":""}" style="text-align: right">\n                  ${a?"+":s?"-":""}${mt(e.amount,t.currency)}\n                </td>\n                <td style="text-align: right">${mt(e.balance_after,t.currency)}</td>\n              </tr>\n            `}).join("")}\n        </tbody>\n      </table>\n\n      <div class="summary">\n        <h3 style="margin-top: 0; color: #1e40af;">Summary</h3>\n        <div class="summary-row">\n          <span>Total Transactions:</span>\n          <span><strong>${e.length}</strong></span>\n        </div>\n        <div class="summary-row">\n          <span>Total Received:</span>\n          <span style="color: #059669"><strong>${mt(s,t.currency)}</strong></span>\n        </div>\n        <div class="summary-row">\n          <span>Total Spent:</span>\n          <span style="color: #dc2626"><strong>${mt(r,t.currency)}</strong></span>\n        </div>\n        <div class="summary-row total">\n          <span>Net Change:</span>\n          <span style="color: ${s-r>=0?"#059669":"#dc2626"}">\n            <strong>${mt(s-r,t.currency)}</strong>\n          </span>\n        </div>\n      </div>\n\n      <div class="footer">\n        <p>This is a computer-generated document. No signature is required.</p>\n        <p> ${(new Date).getFullYear()} ${t.accountName}</p>\n      </div>\n\n      <script>\n        window.onload = function() {\n          window.print();\n          // Close after printing (commented out for user convenience)\n          // setTimeout(() => window.close(), 100);\n        };\n      <\/script>\n    </body>\n    </html>\n  `;a.document.write(n),a.document.close()})(E.filter(e=>{if("all"!==B&&e.transaction_type!==B)return!1;if(K.start&&new Date(e.created_at)<new Date(K.start))return!1;if(K.end){const t=new Date(K.end);if(t.setHours(23,59,59,999),new Date(e.created_at)>t)return!1}return!0}),{accountName:A.name,currency:A.currency||"TZS",dateRange:K.start&&K.end?K:void 0}),y.success("PDF opened in new window")},className:"px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg transition-all text-sm font-medium",children:" PDF"})]}),e.jsx("div",{className:"text-sm text-gray-500 bg-gray-100 px-4 py-2.5 rounded-xl font-medium",children:"all"===B?`${E.length} transactions`:`${E.filter(e=>e.transaction_type===B).length} transactions`})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{size:18,className:"text-gray-400"}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("input",{type:"date",value:K.start,onChange:e=>H({...K,start:e.target.value}),className:"px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/30",placeholder:"Start date"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:K.end,onChange:e=>H({...K,end:e.target.value}),className:"px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/30",placeholder:"End date"}),(K.start||K.end)&&e.jsx("button",{onClick:()=>H({start:"",end:""}),className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all",children:"Clear"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:I?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"}),e.jsx("span",{className:"mt-4 text-gray-600 font-medium",children:"Loading transactions..."})]}):0===E.length?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 rounded-3xl mb-4",children:e.jsx(te,{size:36,className:"text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No transactions yet"}),e.jsx("p",{className:"text-gray-500",children:"This account has no transaction history."})]}):e.jsx("div",{className:"space-y-3",children:E.filter(e=>{if("all"!==B&&e.transaction_type!==B)return!1;if(K.start&&new Date(e.created_at)<new Date(K.start))return!1;if(K.end){const t=new Date(K.end);if(t.setHours(23,59,59,999),new Date(e.created_at)>t)return!1}return!0}).map(t=>{var a,s,r;const n="payment_received"===t.transaction_type||"transfer_in"===t.transaction_type,l="expense"===t.transaction_type||"payment_made"===t.transaction_type||"transfer_out"===t.transaction_type;return e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n&&e.jsx("div",{className:"p-1 bg-green-100 rounded",children:e.jsx(M,{size:14,className:"text-green-600"})}),l&&e.jsx("div",{className:"p-1 bg-red-100 rounded",children:e.jsx(O,{size:14,className:"text-red-600"})}),e.jsx("h4",{className:"font-medium text-gray-900",children:t.description||"No description"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{size:12}),new Date(t.created_at).toLocaleString()]}),t.reference_number&&e.jsxs("div",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:["Ref: ",t.reference_number]}),e.jsx("div",{className:"text-xs px-2 py-1 rounded capitalize "+(n?"bg-green-100 text-green-700":l?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:t.transaction_type.replace("_"," ")})]}),"purchase_order_payment"===(null==(a=t.metadata)?void 0:a.type)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex items-center gap-2",children:[e.jsxs("span",{className:"bg-purple-100 text-purple-700 px-2 py-1 rounded",children:["PO: ",t.metadata.po_reference]}),t.metadata.supplier&&e.jsxs("span",{children:["Supplier: ",t.metadata.supplier]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:"text-xl font-bold "+(n?"text-green-600":l?"text-red-600":"text-gray-900"),children:[n&&"+",l&&"-",he(t.amount,A.currency)]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Balance: ",he(t.balance_after,A.currency)]})]}),!(null==(s=t.metadata)?void 0:s.reversed)&&e.jsx("button",{onClick:e=>{e.stopPropagation(),oe(t),ie(!0)},className:"px-3 py-1.5 text-xs bg-orange-50 hover:bg-orange-100 text-orange-700 hover:text-orange-900 rounded-lg transition-all font-medium border border-orange-200",title:"Reverse this transaction",children:"Reverse"}),(null==(r=t.metadata)?void 0:r.reversed)&&e.jsx("span",{className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-500 rounded-lg font-medium border border-gray-200",children:"Reversed"})]})},t.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex justify-end",children:e.jsx("button",{onClick:()=>T(!1),className:"px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium",children:"Close"})})]})})]}),W&&ae&&e.jsx(nt,{account:ae,onClose:()=>{Y(!1),se(null)},onSuccess:()=>{ye()}}),re&&e.jsx(lt,{accounts:n,onClose:()=>ne(!1),onSuccess:()=>{ye()}}),le&&ce&&A&&e.jsx(it,{transaction:ce,accountName:A.name,accountCurrency:A.currency||"TZS",onClose:()=>{ie(!1),oe(null)},onSuccess:()=>{ye(),A&&je(A)}})]})},ht=()=>{const{currentUser:l}=s(),[c,o]=i.useState([]),[d,m]=i.useState([]),[u,x]=i.useState(!0),[h,j]=i.useState(!1),[N,w]=i.useState(null),[S,k]=i.useState({name:"",description:"",account_id:"",category:"",amount:"",frequency:"monthly",start_date:(new Date).toISOString().split("T")[0],vendor_name:"",reference_prefix:"",auto_process:!1,notification_days_before:3}),C=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),D=i.useCallback(async()=>{try{x(!0);const{data:e,error:t}=await a.from("recurring_expenses").select("*").order("next_due_date",{ascending:!0});if(t)throw t;o(e||[])}catch(e){y.error("Failed to load recurring expenses")}finally{x(!1)}},[]),P=i.useCallback(async()=>{try{const e=await r.getPaymentMethods();m(e)}catch(e){}},[]);i.useEffect(()=>{D(),P()},[D,P]);const T=(e,t)=>{k(a=>({...a,[e]:t}))},A=()=>{k({name:"",description:"",account_id:"",category:"",amount:"",frequency:"monthly",start_date:(new Date).toISOString().split("T")[0],vendor_name:"",reference_prefix:"",auto_process:!1,notification_days_before:3})};return u?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading recurring expenses..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Recurring Expenses"}),e.jsx("p",{className:"text-gray-600",children:"Automate fixed expenses like salaries, rent, and subscriptions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{onClick:D,variant:"secondary",children:[e.jsx(R,{size:16}),"Refresh"]}),e.jsxs(t,{onClick:()=>{A(),j(!0)},children:[e.jsx(z,{size:16}),"Add Recurring Expense"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(n,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Recurring"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:c.length})]}),e.jsx("div",{className:"p-3 bg-blue-500 rounded-lg",children:e.jsx(G,{className:"w-6 h-6 text-white"})})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:c.filter(e=>e.is_active).length})]}),e.jsx("div",{className:"p-3 bg-green-500 rounded-lg",children:e.jsx(p,{className:"w-6 h-6 text-white"})})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Due Soon"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:c.filter(e=>{const t=new Date(e.next_due_date),a=new Date,s=Math.ceil((t.getTime()-a.getTime())/864e5);return s>=0&&s<=7}).length})]}),e.jsx("div",{className:"p-3 bg-orange-500 rounded-lg",children:e.jsx(f,{className:"w-6 h-6 text-white"})})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Monthly Total"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:C(c.filter(e=>"monthly"===e.frequency&&e.is_active).reduce((e,t)=>e+t.amount,0))})]}),e.jsx("div",{className:"p-3 bg-purple-500 rounded-lg",children:e.jsx(b,{className:"w-6 h-6 text-white"})})]})})]}),e.jsxs(n,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Scheduled Expenses (",c.length,")"]}),0===c.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mb-4 inline-block p-6 bg-gray-100 rounded-full",children:e.jsx(G,{className:"w-16 h-16 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Recurring Expenses"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Set up automatic expenses for salaries, rent, utilities, and more"}),e.jsxs(t,{onClick:()=>{A(),j(!0)},children:[e.jsx(z,{size:16}),"Create First Recurring Expense"]})]}):e.jsx("div",{className:"space-y-3",children:c.map(t=>{var s;const r=(n=t.category,{Rent:_,Utilities:ne,Supplies:v,Transportation:le,Salaries:ie,Maintenance:ce,Marketing:se,Insurance:oe,Taxes:re,Other:se}[n]||se);var n;const l=(e=>{const t=new Date(e),a=new Date,s=Math.ceil((t.getTime()-a.getTime())/864e5);return s<0?{label:"Overdue",color:"red",icon:g}:0===s?{label:"Due Today",color:"orange",icon:f}:s<=7?{label:"Due Soon",color:"yellow",icon:L}:{label:"Scheduled",color:"green",icon:p}})(t.next_due_date),i=l.icon;return e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-white rounded-xl border border-gray-200 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(r,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.auto_process?e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),"Auto"]}):e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Manual"}),t.is_active?e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),"Active"]}):e.jsxs("span",{className:"px-3 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(Y,{className:"w-3 h-3"}),"Paused"]})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Amount"}),e.jsx("div",{className:"font-semibold text-gray-900",children:C(t.amount)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Frequency"}),e.jsx("div",{className:"font-medium text-gray-900",children:(c=t.frequency,{daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"}[c]||c)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Next Due"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{className:`w-3 h-3 text-${l.color}-600`}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(t.next_due_date).toLocaleDateString()})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Account"}),e.jsx("div",{className:"font-medium text-gray-900",children:(null==(s=d.find(e=>e.id===t.account_id))?void 0:s.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 text-xs",children:"Vendor"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.vendor_name||"N/A"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.is_active&&e.jsx("button",{onClick:()=>(async()=>{try{const{data:e,error:t}=await a.rpc("process_due_recurring_expenses");if(t)throw t;y.success("Processed! Check Expense Management for transaction."),D()}catch(e){y.error("Failed to process expense")}})(),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Process Now",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(e=>{w(e),k({name:e.name,description:e.description||"",account_id:e.account_id,category:e.category,amount:e.amount.toString(),frequency:e.frequency,start_date:e.start_date,vendor_name:e.vendor_name||"",reference_prefix:e.reference_prefix||"",auto_process:e.auto_process,notification_days_before:e.notification_days_before||3}),j(!0)})(t),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(async(e,t)=>{try{const{error:s}=await a.from("recurring_expenses").update({is_active:!t}).eq("id",e);if(s)throw s;y.success(t?"Paused":"Resumed"),D()}catch(s){y.error("Failed to update status")}})(t.id,t.is_active),className:`p-2 ${t.is_active?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50"} rounded-lg transition-colors`,title:t.is_active?"Pause":"Resume",children:t.is_active?e.jsx(Y,{className:"w-4 h-4"}):e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(async(e,t)=>{if(confirm(`Delete recurring expense "${t}"?`))try{const{error:t}=await a.from("recurring_expenses").delete().eq("id",e);if(t)throw t;y.success("Recurring expense deleted"),D()}catch(s){y.error("Failed to delete recurring expense")}})(t.id,t.name),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(J,{className:"w-4 h-4"})})]})]})},t.id);var c})})]}),e.jsx(je,{isOpen:h,onClose:()=>{j(!1),w(null),A()},title:N?"Edit Recurring Expense":"Add Recurring Expense",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(se,{className:"w-4 h-4"}),"Expense Name *"]}),e.jsx(He,{type:"text",value:S.name,onChange:e=>T("name",e.target.value),placeholder:"e.g., Monthly Office Rent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(_,{className:"w-4 h-4"}),"Account *"]}),e.jsxs(Ke,{value:S.account_id,onChange:e=>T("account_id",e.target.value),children:[e.jsx("option",{value:"",children:"Select Account"}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(se,{className:"w-4 h-4"}),"Category *"]}),e.jsxs(Ke,{value:S.category,onChange:e=>T("category",e.target.value),children:[e.jsx("option",{value:"",children:"Select Category"}),e.jsx("option",{value:"Salaries",children:"Salaries"}),e.jsx("option",{value:"Rent",children:"Rent"}),e.jsx("option",{value:"Utilities",children:"Utilities"}),e.jsx("option",{value:"Supplies",children:"Supplies"}),e.jsx("option",{value:"Insurance",children:"Insurance"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"}),e.jsx("option",{value:"Marketing",children:"Marketing"}),e.jsx("option",{value:"Transportation",children:"Transportation"}),e.jsx("option",{value:"Taxes",children:"Taxes"}),e.jsx("option",{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(b,{className:"w-4 h-4"}),"Amount (TSh) *"]}),e.jsx(He,{type:"number",value:S.amount,onChange:e=>T("amount",e.target.value),placeholder:"0.00",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(G,{className:"w-4 h-4"}),"Frequency *"]}),e.jsxs(Ke,{value:S.frequency,onChange:e=>T("frequency",e.target.value),children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(L,{className:"w-4 h-4"}),"Start Date *"]}),e.jsx(He,{type:"date",value:S.start_date,onChange:e=>T("start_date",e.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(_,{className:"w-4 h-4"}),"Vendor"]}),e.jsx(He,{type:"text",value:S.vendor_name,onChange:e=>T("vendor_name",e.target.value),placeholder:"Supplier or vendor"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(se,{className:"w-4 h-4"}),"Description"]}),e.jsx("textarea",{value:S.description,onChange:e=>T("description",e.target.value),placeholder:"Additional details about this recurring expense",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[e.jsx(re,{className:"w-4 h-4"}),"Reference Prefix"]}),e.jsx(He,{type:"text",value:S.reference_prefix,onChange:e=>T("reference_prefix",e.target.value),placeholder:"e.g., SAL, RENT, ELEC",maxLength:10}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Will generate references like: ",S.reference_prefix||"REF","-20251013"]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S.auto_process,onChange:e=>T("auto_process",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-900",children:[e.jsx(ae,{className:"w-4 h-4 text-yellow-600"}),"Auto-Process (Automatic Deduction)"]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 ml-6",children:S.auto_process?" Expense will be automatically deducted on due date":" You will be notified but must process manually"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(t,{variant:"secondary",onClick:()=>{j(!1),w(null),A()},children:"Cancel"}),e.jsxs(t,{onClick:async()=>{try{if(!(S.name&&S.account_id&&S.amount&&S.category))return void y.error("Please fill in all required fields");const e=parseFloat(S.amount);if(isNaN(e)||e<=0)return void y.error("Please enter a valid amount");const t={name:S.name,description:S.description,account_id:S.account_id,category:S.category,amount:e,frequency:S.frequency,start_date:S.start_date,next_due_date:S.start_date,vendor_name:S.vendor_name||null,reference_prefix:S.reference_prefix||S.category.substring(0,4).toUpperCase(),auto_process:S.auto_process,notification_days_before:S.notification_days_before,created_by:null==l?void 0:l.id};if(N){const{error:e}=await a.from("recurring_expenses").update(t).eq("id",N.id);if(e)throw e;y.success("Recurring expense updated!")}else{const{error:e}=await a.from("recurring_expenses").insert(t);if(e)throw e;y.success("Recurring expense created!")}A(),j(!1),w(null),D()}catch(e){y.error(e.message||"Failed to save recurring expense")}},children:[N?"Update":"Create"," Recurring Expense"]})]})]})})]})},pt=()=>{var r,l;const{currentUser:c}=s(),[x,h]=i.useState("tracking"),[g,v]=i.useState(0);d({maxRetries:3,showToast:!0,logToConsole:!0});const N=i.useCallback(()=>{v(e=>e+1)},[]),[_,S]=i.useState([]),[k,C]=i.useState(!1),[P,T]=i.useState({status:"all",provider:"all",dateRange:"30",source:"all"}),[A,F]=i.useState(""),[z,I]=i.useState(!1),[O,q]=i.useState(null),[B,U]=i.useState(!1),[Z,V]=i.useState(!1),[K,H]=i.useState({amount:"",currency:"",status:"",notes:""}),[W,Y]=i.useState(!1);i.useEffect(()=>{"history"===x&&ee()},[x,P]);const ee=async()=>{C(!0);try{Ne.clearPaymentCache();const e=await Ne.fetchPaymentTransactions();e&&e.length>0?(S(e),y.success(`Loaded ${e.length} transactions from all payment sources`)):S([])}catch(e){y.error("Failed to load payment history"),S([])}finally{C(!1)}},ae=e=>{switch(e.toLowerCase()){case"completed":case"success":return"success";case"failed":case"cancelled":return"error";case"pending":return"warning";default:return"secondary"}},re=e=>{const t=e.toLowerCase();return"success"===t?"Completed":"pending"===t?"Pending":"failed"===t?"Failed":"cancelled"===t?"Cancelled":e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},ne=e=>{switch(e.toLowerCase()){case"multiple":return"";case"m-pesa":case"mpesa":case"tigopesa":case"airtel money":case"airtelmoney":case"mobile_money":case"zenopay":return"";case"stripe":case"card":return"";case"bank transfer":case"transfer":return"";case"paypal":return"";case"flutterwave":return"";case"cash":return"";case"credit":return"";case"mock":return"";default:return""}},le=_.filter(e=>{var t;if(A){const a=A.toLowerCase();if(![e.transactionId,e.customerName,e.method,e.reference,e.deviceName,e.purchaseOrderNumber,e.status,e.source,null==(t=e.amount)?void 0:t.toString()].filter(Boolean).join(" ").toLowerCase().includes(a))return!1}if("all"!==P.status){const t=e.status.toLowerCase(),a=P.status;if("completed"===a&&"success"!==t&&"completed"!==t)return!1;if("completed"!==a&&t!==a)return!1}return("all"===P.provider||e.method===P.provider)&&("all"===P.source||e.source===P.source)}).sort((e,t)=>{const a=new Date(e.date||e.timestamp).getTime();return new Date(t.date||t.timestamp).getTime()-a}),ce=e=>{let t=`Transaction: ${e.transactionId}\nCustomer: ${e.customerName||"N/A"}\nAmount: ${Ye.money(e.amount)}\nPayment Method: ${e.method}\nSource: ${e.source}\nStatus: ${re(e.status)}\nDate: ${new Date(e.date||e.timestamp).toLocaleString()}\nReference: ${e.reference||"N/A"}`;"device_payment"===e.source&&e.deviceName?t+=`\nDevice: ${e.deviceName}`:"purchase_order"===e.source&&e.purchaseOrderNumber&&(t+=`\nPurchase Order: ${e.purchaseOrderNumber}`,t+=`\nSupplier: ${e.supplierName||"N/A"}`),e.customerPhone&&(t+=`\nPhone: ${e.customerPhone}`),e.customerEmail&&(t+=`\nEmail: ${e.customerEmail}`),navigator.clipboard.writeText(t).then(()=>{y.success("Transaction details copied to clipboard")}).catch(()=>{y.error("Failed to copy to clipboard")})};return e.jsx(o,{pageName:"Payment Management",showDetails:!0,children:e.jsx("div",{className:"p-6 flex justify-center",children:e.jsxs("div",{className:"w-full max-w-7xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Payment Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage payments, providers, and purchase orders"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6",children:[e.jsxs("button",{onClick:()=>h("tracking"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 "+("tracking"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(de,{size:16}),"Overview"]}),e.jsxs("button",{onClick:()=>h("providers"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 "+("providers"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(w,{size:16}),"Payment Accounts"]}),e.jsxs("button",{onClick:()=>h("purchase-orders"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 "+("purchase-orders"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx($,{size:16}),"Purchase Orders"]}),e.jsxs("button",{onClick:()=>h("history"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 "+("history"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(te,{size:16}),"Transactions"]}),e.jsxs("button",{onClick:()=>h("expenses"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 "+("expenses"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(D,{size:16}),"Expenses"]}),e.jsxs("button",{onClick:()=>h("recurring"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 "+("recurring"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(G,{size:16}),"Recurring"]})]})})}),e.jsxs("div",{children:["tracking"===x&&e.jsx(at,{onViewDetails:e=>{},onRefund:e=>{},onExport:()=>{},onNavigateToTab:e=>{h(e)}},g),"providers"===x&&e.jsx(xt,{}),"purchase-orders"===x&&e.jsx(st,{onViewDetails:e=>{},onMakePayment:e=>{N()},onExport:()=>{}}),"expenses"===x&&e.jsx(We,{}),"recurring"===x&&e.jsx(ht,{}),"history"===x&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Transactions"}),e.jsx("p",{className:"text-gray-600",children:"Track all payment transactions and their status"})]}),e.jsx(n,{className:"p-4 mb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:A,onChange:e=>F(e.target.value),placeholder:"Search by transaction ID, customer, amount, reference...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-sm"}),A&&e.jsx("button",{onClick:()=>F(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(u,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>I(!z),className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium text-sm transition-all duration-200 "+(z?"bg-blue-500 text-white shadow-md":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:[e.jsx(X,{className:"w-4 h-4"}),"Filters",("all"!==P.status||"all"!==P.provider||"all"!==P.source||"30"!==P.dateRange)&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-white/20 rounded-full text-xs",children:"Active"})]})]})}),z&&e.jsx(n,{className:"p-5 mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 min-w-[100px]",children:"Source:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"All"},{value:"pos_sale",label:"POS Sales"},{value:"device_payment",label:"Device Repairs"},{value:"purchase_order",label:"Purchase Orders"}].map(t=>e.jsx("button",{onClick:()=>T(e=>({...e,source:t.value})),className:"px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 "+(P.source===t.value?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-blue-300 hover:text-blue-600"),children:t.label},t.value))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 min-w-[100px]",children:"Status:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>T(e=>({...e,status:"all"})),className:"px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 "+("all"===P.status?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-blue-300 hover:text-blue-600"),children:"All"}),e.jsx("button",{onClick:()=>T(e=>({...e,status:"pending"})),className:"px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 "+("pending"===P.status?"bg-yellow-500 text-white shadow-lg shadow-yellow-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-yellow-300 hover:text-yellow-600"),children:"Pending"}),e.jsx("button",{onClick:()=>T(e=>({...e,status:"completed"})),className:"px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 "+("completed"===P.status?"bg-green-500 text-white shadow-lg shadow-green-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-green-300 hover:text-green-600"),children:"Completed"}),e.jsx("button",{onClick:()=>T(e=>({...e,status:"failed"})),className:"px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 "+("failed"===P.status?"bg-red-500 text-white shadow-lg shadow-red-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-red-300 hover:text-red-600"),children:"Failed"}),e.jsx("button",{onClick:()=>T(e=>({...e,status:"cancelled"})),className:"px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 "+("cancelled"===P.status?"bg-gray-500 text-white shadow-lg shadow-gray-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300 hover:text-gray-600"),children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 min-w-[100px]",children:"Payment:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"All"},{value:"Cash",label:"Cash"},{value:"M-Pesa",label:"M-Pesa"},{value:"Tigopesa",label:"Tigopesa"},{value:"Airtel Money",label:"Airtel"},{value:"Bank Transfer",label:"Bank"},{value:"Card",label:"Card"},{value:"Credit",label:"Credit"}].map(t=>e.jsx("button",{onClick:()=>T(e=>({...e,provider:t.value})),className:"px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 "+(P.provider===t.value?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-blue-300 hover:text-blue-600"),children:t.label},t.value))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 min-w-[100px]",children:"Period:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"7",label:"7 days"},{value:"30",label:"30 days"},{value:"90",label:"90 days"},{value:"365",label:"1 year"}].map(t=>e.jsx("button",{onClick:()=>T(e=>({...e,dateRange:t.value})),className:"px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-200 "+(P.dateRange===t.value?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-white text-gray-600 border border-gray-200 hover:border-blue-300 hover:text-blue-600"),children:t.label},t.value))})]})]})}),e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:["Transactions (",le.length,")"]}),e.jsx(t,{onClick:ee,disabled:k,children:k?"Loading...":"Refresh"})]}),k?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading transactions..."})]}):0===le.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:""}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Transactions Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:0===_.length?"No payment transactions have been recorded yet.":"No transactions match your current filters."}),0===_.length&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg text-sm text-gray-700 max-w-md mx-auto",children:[e.jsx("p",{className:"font-medium mb-2",children:" To see payment history:"}),e.jsxs("ul",{className:"text-left space-y-1",children:[e.jsx("li",{children:" Process payments through the POS"}),e.jsx("li",{children:" Record purchase order payments"}),e.jsx("li",{children:" Complete device repair payments"})]})]}),_.length>0&&e.jsx(t,{onClick:()=>T({status:"all",provider:"all",dateRange:"30",source:"all"}),className:"mt-4",children:"Clear Filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Source"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Date",e.jsx(D,{className:"w-4 h-4 text-blue-600",title:"Most recent first"})]})}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Method"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Reference"})]})}),e.jsx("tbody",{children:le.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>q(t),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 text-lg",children:t.customerName||"N/A"}),t.customerEmail&&e.jsx("div",{className:"text-gray-500 text-xs",children:t.customerEmail})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full font-medium "+("pos_sale"===t.source?"bg-purple-100 text-purple-800":"device_payment"===t.source?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"),children:"pos_sale"===t.source?" POS":"device_payment"===t.source?" Repair":" PO"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"font-semibold text-gray-900",children:Ye.money(t.amount)})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[new Date(t.date||t.timestamp).toLocaleDateString(),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(t.date||t.timestamp).toLocaleTimeString()})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:ne(t.method)}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.method})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(m,{variant:ae(t.status),size:"sm",children:re(t.status)})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm text-gray-600 font-mono",children:t.reference||"N/A"})})]},t.id))})]})})]})]})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 pt-16 animate-fadeIn",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[85vh] overflow-hidden animate-slideUp",children:[e.jsxs("div",{className:"relative bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 px-8 py-6 text-white",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsxs("div",{className:"relative flex items-start justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Payment Transaction"}),e.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Complete transaction details"})]})]})}),e.jsx("button",{onClick:()=>q(null),className:"w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg transition-all flex items-center justify-center group",children:e.jsx(u,{className:"w-5 h-5 text-white group-hover:rotate-90 transition-transform duration-300"})})]}),e.jsx("div",{className:"relative mt-4",children:e.jsx(m,{variant:ae(O.status),size:"lg",children:e.jsxs("span",{className:"text-base font-semibold px-3 py-1 flex items-center gap-2",children:["success"===O.status.toLowerCase()||"completed"===O.status.toLowerCase()?e.jsx(p,{className:"w-4 h-4"}):"pending"===O.status.toLowerCase()?e.jsx(f,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"}),re(O.status)]})})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(85vh-280px)] px-8 py-6 bg-gray-50",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500 via-teal-600 to-cyan-600 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full -ml-24 -mb-24"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(b,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium opacity-90",children:"Transaction Amount"})]}),e.jsx("div",{className:"text-5xl font-bold mb-2",children:Ye.money(O.amount)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-sm font-medium",children:"pos_sale"===O.source?" POS Sale":"device_payment"===O.source?" Device Repair":" Purchase Order"}),e.jsxs("span",{className:"text-sm opacity-75",children:[" ",new Date(O.date||O.timestamp).toLocaleDateString()]})]})]})]}),(null==(l=null==(r=O.metadata)?void 0:r.details)?void 0:l.payments)&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600"}),"Payment Details"]}),e.jsxs("div",{className:"space-y-4",children:[O.metadata.details.payments.map((t,a)=>e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(j,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{className:"font-semibold text-gray-900",children:t.method})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-lg font-bold text-gray-900",children:Ye.money(t.amount)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Account ID:"}),e.jsx("span",{className:"font-mono text-gray-900 break-all",children:t.accountId})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"Timestamp:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(t.timestamp).toLocaleString()})]})]})]},a)),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(p,{className:"w-4 h-4 text-green-600"})}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Paid"})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xl font-bold text-green-700",children:Ye.money(O.metadata.details.totalPaid)})})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Transaction Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(me,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Transaction ID"}),e.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 break-all",children:O.transactionId})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ue,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Payment Method"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:ne(O.method)}),e.jsx("span",{className:"font-semibold text-gray-900",children:O.method})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(se,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Reference"}),e.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 break-all",children:O.reference||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ie,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Served By"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:O.cashier||"N/A"})]})]}),"device_payment"===O.source&&O.deviceName&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx($,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Device"}),e.jsx("div",{className:"font-semibold text-gray-900",children:O.deviceName})]})]}),"purchase_order"===O.source&&e.jsxs(e.Fragment,{children:[O.purchaseOrderNumber&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(se,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Purchase Order"}),e.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 break-all",children:O.purchaseOrderNumber})]})]}),O.supplierName&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ue,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Supplier"}),e.jsx("div",{className:"font-semibold text-gray-900",children:O.supplierName})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-blue-600"}),"Customer Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ie,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Customer Name"}),e.jsx("div",{className:"font-semibold text-gray-900",children:O.customerName||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(xe,{className:"w-5 h-5 text-teal-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Phone Number"}),e.jsx("div",{className:"font-semibold text-gray-900",children:O.customerPhone||"N/A"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-blue-600"}),"Transaction Timeline"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(f,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Transaction Date"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:new Date(O.date||O.timestamp).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),O.createdAt&&e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(R,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Record Created"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:new Date(O.createdAt).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),"completed"===O.status&&e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(p,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Status"}),e.jsx("div",{className:"text-sm font-semibold text-green-700",children:"Completed"})]})]})]})]}),O.metadata&&Object.keys(O.metadata).length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Additional Information"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(O.metadata).map(([t,a])=>{var s;if("paymentMethod"===t&&"object"==typeof a&&null!==a){const r=a;return"multiple"===r.type&&(null==(s=r.details)?void 0:s.payments)?e.jsxs("div",{className:"md:col-span-2 p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-blue-600"}),"Multiple Payment Methods Breakdown"]}),e.jsxs("div",{className:"space-y-2",children:[r.details.payments.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:ne(t.method)}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.method})]}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:Ye.money(t.amount)})]},a)),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg border-t-2 border-green-200 mt-2",children:[e.jsx("span",{className:"text-sm font-bold text-green-800",children:"Total Paid"}),e.jsx("span",{className:"text-base font-bold text-green-800",children:Ye.money(r.details.totalPaid)})]})]})]},t):null}return e.jsxs("div",{className:"flex items-start justify-between gap-4 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 capitalize",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-sm font-semibold text-gray-900 text-right break-all",children:"object"==typeof a?JSON.stringify(a,null,2):String(a)})]},t)})})]}),O.pos_session_id&&e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl shadow-sm border border-orange-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"POS Session"})]}),e.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 bg-white/50 rounded-lg p-3 break-all",children:O.pos_session_id})]})]})}),e.jsxs("div",{className:"bg-white border-t border-gray-200 px-8 py-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 mb-5",children:[e.jsxs("button",{onClick:()=>ce(O),className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 text-gray-700 rounded-xl hover:from-gray-100 hover:to-gray-200 hover:border-gray-300 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy"})]}),e.jsxs("button",{onClick:()=>(e=>{const t=window.open("","_blank");if(t){let a=`\n        <html>\n          <head>\n            <title>Transaction Receipt</title>\n            <style>\n              body { font-family: Arial, sans-serif; padding: 20px; }\n              h2 { color: #1a202c; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; }\n              .detail { margin: 10px 0; }\n              .label { font-weight: bold; color: #4b5563; }\n              .source-badge { display: inline-block; padding: 4px 12px; background-color: #e0e7ff; color: #4338ca; border-radius: 12px; font-size: 12px; margin: 10px 0; }\n            </style>\n          </head>\n          <body>\n            <h2>Transaction Receipt</h2>\n            <div class="source-badge">${"pos_sale"===e.source?"POS Sale":"device_payment"===e.source?"Device Payment":"Purchase Order"}</div>\n            <div class="detail"><span class="label">Transaction ID:</span> ${e.transactionId}</div>\n            <div class="detail"><span class="label">Customer:</span> ${e.customerName||"N/A"}</div>\n            <div class="detail"><span class="label">Email:</span> ${e.customerEmail||"N/A"}</div>\n            <div class="detail"><span class="label">Phone:</span> ${e.customerPhone||"N/A"}</div>\n            <div class="detail"><span class="label">Amount:</span> ${Ye.money(e.amount)}</div>\n            <div class="detail"><span class="label">Payment Method:</span> ${e.method}</div>\n            <div class="detail"><span class="label">Status:</span> ${re(e.status)}</div>\n            <div class="detail"><span class="label">Date:</span> ${new Date(e.date||e.timestamp).toLocaleString()}</div>\n            <div class="detail"><span class="label">Reference:</span> ${e.reference||"N/A"}</div>\n            <div class="detail"><span class="label">Cashier:</span> ${e.cashier||"N/A"}</div>`;"device_payment"===e.source&&e.deviceName?a+=`<div class="detail"><span class="label">Device:</span> ${e.deviceName}</div>`:"purchase_order"===e.source&&(e.purchaseOrderNumber&&(a+=`<div class="detail"><span class="label">Purchase Order:</span> ${e.purchaseOrderNumber}</div>`),e.supplierName&&(a+=`<div class="detail"><span class="label">Supplier:</span> ${e.supplierName}</div>`)),a+="\n          </body>\n        </html>",t.document.write(a),t.document.close(),t.print()}})(O),className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 text-gray-700 rounded-xl hover:from-gray-100 hover:to-gray-200 hover:border-gray-300 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Print"})]}),e.jsxs("button",{onClick:()=>{return e=O,void(navigator.share?navigator.share({title:"Transaction Details",text:`Transaction ${e.transactionId} - ${e.customerName||"N/A"} - ${Ye.money(e.amount)}`,url:window.location.href}).catch(()=>{y.error("Failed to share")}):ce(e));var e},className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 text-gray-700 rounded-xl hover:from-gray-100 hover:to-gray-200 hover:border-gray-300 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Share"})]}),e.jsxs("button",{onClick:()=>{return H({amount:(e=O).amount.toString(),currency:e.currency||"TZS",status:e.status.toLowerCase(),notes:""}),void U(!0);var e},className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Edit"})]}),("success"===O.status.toLowerCase()||"completed"===O.status.toLowerCase())&&e.jsxs("button",{onClick:()=>(async e=>{try{Y(!0);const{error:t}=await a.from("payment_transactions").update({status:"FAILED",metadata:{...e.metadata,refunded:!0,refunded_at:(new Date).toISOString(),refunded_by:null==c?void 0:c.id},updated_at:(new Date).toISOString()}).eq("id",e.id);if(t)throw t;y.success("Transaction refunded successfully"),ee(),q(null)}catch(t){y.error("Failed to refund transaction")}finally{Y(!1)}})(O),disabled:W,className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl hover:from-orange-700 hover:to-orange-800 transition-all shadow-sm hover:shadow-md font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:W?"Processing...":"Refund"})]}),e.jsxs("button",{onClick:()=>{V(!0)},className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"ID:"}),e.jsx("span",{className:"font-mono font-semibold text-gray-900 bg-gray-100 px-3 py-1 rounded-lg",children:O.id})]}),e.jsx("button",{onClick:()=>q(null),className:"px-6 py-2.5 bg-gradient-to-r from-gray-700 to-gray-800 text-white rounded-xl hover:from-gray-800 hover:to-gray-900 transition-all shadow-sm hover:shadow-md font-medium",children:"Close"})]})]})]})}),e.jsx(je,{isOpen:B,onClose:()=>U(!1),title:"Edit Transaction",footer:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(t,{variant:"secondary",onClick:()=>U(!1),children:"Cancel"}),e.jsx(t,{onClick:async()=>{if(O)try{Y(!0);const e=parseFloat(K.amount);if(isNaN(e)||e<0)return void y.error("Please enter a valid amount");const{error:t}=await a.from("payment_transactions").update({amount:e,currency:K.currency,status:K.status.toUpperCase(),metadata:{...O.metadata,edited:!0,edited_at:(new Date).toISOString(),edited_by:null==c?void 0:c.id,notes:K.notes},updated_at:(new Date).toISOString()}).eq("id",O.id);if(t)throw t;y.success("Transaction updated successfully"),U(!1),ee(),q(null)}catch(e){y.error("Failed to update transaction")}finally{Y(!1)}},disabled:W,children:W?"Saving...":"Save Changes"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",value:K.amount,onChange:e=>H({...K,amount:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter amount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsxs("select",{value:K.currency,onChange:e=>H({...K,currency:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"TZS",children:"TZS - Tanzanian Shilling"}),e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:K.status,onChange:e=>H({...K,status:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"success",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:K.notes,onChange:e=>H({...K,notes:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Enter notes or description"})]})]})}),e.jsx(Je,{isOpen:Z,onClose:()=>V(!1),onConfirm:async()=>{if(O)try{Y(!0);const{error:e}=await a.from("payment_transactions").delete().eq("id",O.id);if(e)throw e;y.success("Transaction deleted successfully"),V(!1),ee(),q(null)}catch(e){y.error("Failed to delete transaction")}finally{Y(!1)}},title:"Delete Transaction",message:"Are you sure you want to delete this transaction? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",type:"danger",loading:W})]})})})},gt=document.createElement("style");gt.textContent="\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n  \n  @keyframes slideUp {\n    from {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n  \n  .animate-fadeIn {\n    animation: fadeIn 0.2s ease-out;\n  }\n  \n  .animate-slideUp {\n    animation: slideUp 0.3s ease-out;\n  }\n","undefined"==typeof document||document.getElementById("payment-modal-animations")||(gt.id="payment-modal-animations",document.head.appendChild(gt));export{pt as default};
