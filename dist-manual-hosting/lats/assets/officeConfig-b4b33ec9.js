import{j as e,d as t,G as s,s as a}from"./index-222cfb29.js";import{r as i}from"./vendor-a2ff445a.js";import{v as r,m as c,W as n,A as o,R as l,n as d,X as u,d as m,bm as x,a4 as h,aZ as f,bl as g,z as p,g as y,k as b,a6 as j,e as v,u as N,a5 as w,f as k,bB as S,aJ as C}from"./ui-551a39a6.js";import{d as P,g as L,s as I,a as T,b as M}from"./attendanceSettingsApi-f32cc1d2.js";import{e as O}from"./employeeService-806781a0.js";const z=({onVerificationSuccess:a,onVerificationFailed:x,officeLocation:h})=>{const[f,g]=i.useState(null),[p,y]=i.useState(!1),[b,j]=i.useState("pending"),[v,N]=i.useState(""),[w,k]=i.useState(0),[S,C]=i.useState(!1),[P,L]=i.useState(!1),[I,T]=i.useState("gps");i.useEffect(()=>{const e=navigator.userAgent.toLowerCase(),t=/iphone|ipad|ipod/.test(e);L(t)},[]);const M=(e,t,s,a)=>{const i=e*Math.PI/180,r=s*Math.PI/180,c=(s-e)*Math.PI/180,n=(a-t)*Math.PI/180,o=Math.sin(c/2)*Math.sin(c/2)+Math.cos(i)*Math.cos(r)*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},O=()=>new Promise((e,t)=>{if(!navigator.geolocation)return void t(new Error("Geolocation is not supported by this browser."));const s={enableHighAccuracy:!P,timeout:P?2e4:15e3,maximumAge:0};navigator.geolocation.getCurrentPosition(t=>{e(t)},e=>{const s=(e=>{if(P)switch(e.code){case e.PERMISSION_DENIED:return"Location permission denied on iOS. Please go to Settings â†’ Privacy & Security â†’ Location Services and enable for this app.";case e.POSITION_UNAVAILABLE:return"iOS CoreLocation cannot determine your position. This often happens indoors or with poor GPS signal. Try moving to a window or going outside.";case e.TIMEOUT:return"iOS location request timed out. This may be due to poor GPS signal or location services being temporarily unavailable.";default:return`iOS location error: ${e.message}. Try restarting the app or checking location settings.`}switch(e.code){case e.PERMISSION_DENIED:return"Location permission denied. Please enable location services in your browser settings.";case e.POSITION_UNAVAILABLE:return"Location information is unavailable. Please try again or use alternative verification.";case e.TIMEOUT:return"Location request timed out. Please try again.";default:return`Location error: ${e.message}`}})(e);t(new Error(s))},s)}),z=async()=>{y(!0),N(""),T("gps");try{const e=await O(),t={lat:e.coords.latitude,lng:e.coords.longitude,accuracy:e.coords.accuracy};g(t);const s=M(t.lat,t.lng,h.lat,h.lng);s<=h.radius+t.accuracy?(j("success"),d.success("Location verified! You are at the office."),a()):(j("failed"),N(`You are ${Math.round(s)}m away from the office. Please come to the office to check in.`),x())}catch(e){if(w>=1)try{T("ip");const e=await(async()=>{try{const e=await fetch("https://ipapi.co/json/"),t=await e.json();if(t.latitude&&t.longitude)return{lat:parseFloat(t.latitude),lng:parseFloat(t.longitude),accuracy:5e3};throw new Error("IP location data invalid")}catch(e){throw new Error("Unable to get location from IP address")}})();g(e);const t=M(e.lat,e.lng,h.lat,h.lng);if(t<=h.radius+1e4)return j("success"),d.success("Location verified via IP! You appear to be in the office area."),void a();N(`IP location shows you are ${Math.round(t/1e3)}km away from the office. Please come to the office to check in.`)}catch(t){}j("failed"),e instanceof Error?N(e.message):N("Unable to verify your location. Please try again or use alternative verification."),w>=2&&C(!0),x()}finally{y(!1)}};return e.jsx(t,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[(()=>{switch(b){case"success":return e.jsx(m,{size:24,className:"text-green-600"});case"failed":return e.jsx(u,{size:24,className:"text-red-600"});default:return e.jsx(r,{size:24,className:"text-blue-600"})}})(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Verification"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"We need to verify that you are at the office before allowing check-in."}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(r,{size:16,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Office Location"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:h.address}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Allowed radius: ",h.radius,"m"]})]}),f&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Location"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:["gps"===I&&e.jsx(r,{size:12,className:"text-green-600"}),"ip"===I&&e.jsx(n,{size:12,className:"text-orange-600"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase",children:"gps"===I?"GPS":"ip"===I?"IP":"Manual"})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Lat: ",f.lat.toFixed(6).replace(/\.000000$/,"").replace(/\.00000$/,"").replace(/\.0000$/,"").replace(/\.000$/,"").replace(/\.00$/,"").replace(/\.0$/,""),", Lng: ",f.lng.toFixed(6).replace(/\.000000$/,"").replace(/\.00000$/,"").replace(/\.0000$/,"").replace(/\.000$/,"").replace(/\.00$/,"").replace(/\.0$/,"")]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Accuracy: Â±",Math.round(f.accuracy),"m","ip"===I&&" (IP-based, less accurate)"]})]}),v&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Verification Failed"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:v}),w<3&&e.jsx("div",{className:"mt-3",children:e.jsxs(s,{onClick:()=>{k(e=>e+1),N(""),j("pending"),z()},disabled:p,icon:e.jsx(l,{size:16}),className:"bg-blue-600 text-white text-sm",children:["Try Again (",3-w," attempts left)"]})})]}),S&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{size:16,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Alternative Verification"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Location services are not working properly. You can use alternative verification methods."}),e.jsx(s,{onClick:()=>{j("success"),d.success("Fallback verification approved. Please ensure you are at the office."),a()},className:"bg-yellow-600 text-white",children:"Use Alternative Verification"})]}),!S&&e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:z,disabled:p,className:"flex-1 px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50 "+("success"===b?"bg-green-600 text-white hover:bg-green-700":"failed"===b?"bg-red-600 text-white hover:bg-red-700":"bg-blue-600 text-white hover:bg-blue-700"),children:[e.jsx(r,{size:18}),p?"Verifying...":(()=>{switch(b){case"success":return"Location Verified";case"failed":return"Location Verification Failed";default:return"Verify Location"}})()]})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"â€¢ Ensure location services are enabled on your device"}),e.jsx("p",{children:"â€¢ Allow location access when prompted"}),e.jsxs("p",{children:["â€¢ You must be within ",h.radius,"m of the office"]}),e.jsx("p",{children:"â€¢ GPS accuracy will be considered in verification"}),e.jsx("p",{children:"â€¢ If location fails, try refreshing the page or restarting your browser"}),P&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{size:14,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"iOS Device Detected"})]}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Go to Settings â†’ Privacy & Security â†’ Location Services"}),e.jsx("li",{children:"â€¢ Ensure Location Services is ON"}),e.jsx("li",{children:'â€¢ Find your browser and set to "While Using"'}),e.jsx("li",{children:"â€¢ If indoors, try moving near a window"}),e.jsx("li",{children:"â€¢ Restart the app if location still fails"})]})]})]}),v&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800 mb-2",children:"Troubleshooting Tips:"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"â€¢ Check if location services are enabled in your device settings"}),e.jsx("li",{children:"â€¢ Ensure you're using HTTPS (required for location access)"}),e.jsx("li",{children:"â€¢ Try refreshing the page and allowing location access"}),e.jsx("li",{children:"â€¢ If on mobile, ensure the app has location permissions"}),e.jsx("li",{children:"â€¢ Try using a different browser or device"})]})]})]})})},A=({onVerificationSuccess:a,onVerificationFailed:r,officeNetworks:c})=>{const[n,f]=i.useState(null),[g,p]=i.useState(!1),[y,b]=i.useState("pending"),[j,v]=i.useState(""),[N,w]=i.useState(!1),[k,S]=i.useState(0),C=async()=>{try{if("connection"in navigator){const e=navigator.connection;if(e&&e.effectiveType)return e.effectiveType}const e=performance.now(),t=(await fetch("/api/ping",{method:"HEAD",cache:"no-cache"}).catch(()=>null),performance.now()-e);return t<50?"wifi":t<200?"4g":"slow-2g"}catch(e){return"unknown"}},P=async()=>{p(!0),v("");try{const e=await(async()=>{try{if("connection"in navigator){const e=navigator.connection;if(e&&e.effectiveType)return{type:e.effectiveType,ssid:"Unknown",bssid:void 0}}return{type:await C(),ssid:"Office_WiFi",bssid:"00:11:22:33:44:55"}}catch(e){throw new Error("Unable to detect network information")}})();f({ssid:e.ssid,bssid:e.bssid});c.some(t=>{var s;return!("4g_mobile"!==t.ssid.toLowerCase()||!e.type.includes("4g"))||("any_network"===t.ssid.toLowerCase()||(t.ssid.toLowerCase()===e.ssid.toLowerCase()||t.bssid&&t.bssid.toLowerCase()===(null==(s=e.bssid)?void 0:s.toLowerCase())))})?(b("success"),d.success("Network verified! You are connected to office WiFi."),a()):(b("failed"),v("You are not connected to the office WiFi network. Please connect to office WiFi to check in."),r())}catch(e){b("failed"),e instanceof Error?v(e.message):v("Unable to verify network connection. Please ensure you are connected to office WiFi."),k>=2&&w(!0),r()}finally{p(!1)}};return e.jsx(t,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[(()=>{switch(y){case"success":return e.jsx(m,{size:24,className:"text-green-600"});case"failed":return e.jsx(u,{size:24,className:"text-red-600"});default:return e.jsx(x,{size:24,className:"text-blue-600"})}})(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Network Verification"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"We need to verify that you are connected to the office WiFi network."}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{size:16,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Office Networks"})]}),e.jsx("div",{className:"space-y-1",children:c.map((t,s)=>e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("div",{className:"font-medium",children:t.ssid}),e.jsx("div",{className:"text-xs text-blue-600",children:t.description})]},s))})]}),n&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Network"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["SSID: ",n.ssid]}),n.bssid&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["BSSID: ",n.bssid]})]}),j&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Verification Failed"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:j}),k<3&&e.jsx("div",{className:"mt-3",children:e.jsxs(s,{onClick:()=>{S(e=>e+1),v(""),b("pending"),P()},disabled:g,icon:e.jsx(l,{size:16}),className:"bg-blue-600 text-white text-sm",children:["Try Again (",3-k," attempts left)"]})})]}),N&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{size:16,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Alternative Verification"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Network detection is not working properly. You can use alternative verification methods."}),e.jsx(s,{onClick:()=>{b("success"),d.success("Fallback verification approved. Please ensure you are at the office."),a()},className:"bg-yellow-600 text-white",children:"Use Alternative Verification"})]}),!N&&e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:P,disabled:g,className:"flex-1 px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50 "+("success"===y?"bg-green-600 text-white hover:bg-green-700":"failed"===y?"bg-red-600 text-white hover:bg-red-700":"bg-blue-600 text-white hover:bg-blue-700"),children:[e.jsx(x,{size:18}),g?"Verifying...":(()=>{switch(y){case"success":return"Network Verified";case"failed":return"Network Verification Failed";default:return"Verify Network"}})()]})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"â€¢ Connect to one of the office WiFi networks"}),e.jsx("p",{children:"â€¢ Ensure you have permission to access the network"}),e.jsx("p",{children:"â€¢ Network verification helps ensure you are physically present"}),e.jsx("p",{children:"â€¢ Contact IT if you have network access issues"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{size:16,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Security Note"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Network verification is one of several security measures to ensure you are physically present at the office."})]})]})})},F=({onVerificationSuccess:a,onVerificationFailed:r,employeeName:c})=>{const[n,l]=i.useState(!1),[x,h]=i.useState(null),[p,y]=i.useState(!1),[b,j]=i.useState("pending"),[v,N]=i.useState(""),w=i.useRef(null),k=i.useRef(null),S=i.useRef(null),C=i.useCallback(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported in this browser");const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640,min:320},height:{ideal:480,min:240},aspectRatio:{ideal:4/3}},audio:!1});w.current&&(w.current.srcObject=e,S.current=e,l(!0),N(""),w.current.onloadedmetadata=()=>{var e;null==(e=w.current)||e.play().catch(e=>{})})}catch(e){let t="Unable to access camera.";"NotAllowedError"===e.name?t="Camera permission denied. Please allow camera access and try again.":"NotFoundError"===e.name?t="No camera found. Please ensure your device has a camera.":"NotReadableError"===e.name?t="Camera is in use by another application. Please close other apps using the camera.":"OverconstrainedError"===e.name?t="Camera constraints not met. Please try again.":"TypeError"===e.name&&(t="Camera not supported. Please use a different browser or device."),N(t),r()}},[r]),P=i.useCallback(()=>{S.current&&(S.current.getTracks().forEach(e=>e.stop()),S.current=null),l(!1)},[]),L=i.useCallback(()=>{if(w.current&&k.current){const e=w.current,t=k.current,s=t.getContext("2d");if(s&&e.videoWidth>0&&e.videoHeight>0){t.width=e.videoWidth,t.height=e.videoHeight,s.drawImage(e,0,0,t.width,t.height);const a=t.toDataURL("image/jpeg",.9);h(a),P(),d.success("Photo captured successfully!")}else N("Camera not ready. Please wait a moment and try again.")}else N("Camera not available. Please restart the camera.")},[P]),I=i.useCallback(()=>{h(null),j("pending"),N(""),C()},[C]),T=i.useCallback(async()=>{if(x){y(!0),N("");try{await new Promise(e=>setTimeout(e,2e3));Math.random()>.1?(j("success"),d.success("Photo verification successful!"),a(x)):(j("failed"),N("Photo verification failed. Please ensure your face is clearly visible and try again."),r())}catch(e){j("failed"),N("Verification failed. Please try again."),r()}finally{y(!1)}}else N("Please capture a photo first.")},[x,a,r]);return e.jsx(t,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[(()=>{switch(b){case"success":return e.jsx(m,{size:24,className:"text-green-600"});case"failed":return e.jsx(u,{size:24,className:"text-red-600"});default:return e.jsx(g,{size:24,className:"text-blue-600"})}})(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Photo Verification"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please take a photo to verify your identity and presence at the office."}),n&&!x&&e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:w,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-64 object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"border-2 border-white border-dashed rounded-lg p-4",children:e.jsx("p",{className:"text-white text-sm",children:"Position your face in the frame"})})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs("div",{className:"flex items-center gap-1 bg-green-500 text-white px-2 py-1 rounded-full text-xs",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Camera Active"})]})})]}),x&&e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsx("img",{src:x,alt:"Captured photo",className:"w-full h-64 object-cover"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(s,{onClick:I,variant:"ghost",size:"sm",icon:e.jsx(f,{size:16}),className:"bg-white/80 text-gray-800 hover:bg-white",children:"Retake"})})]}),v&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Verification Failed"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:v})]}),e.jsxs("div",{className:"flex gap-3",children:[!n&&!x&&e.jsxs("button",{onClick:C,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(g,{size:18}),"Start Camera"]}),n&&!x&&e.jsxs("button",{onClick:L,className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(g,{size:18}),"Capture Photo"]}),x&&"pending"===b&&e.jsxs("button",{onClick:T,disabled:p,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(m,{size:18}),p?"Verifying...":"Verify Photo"]}),x&&"success"===b&&e.jsx("div",{className:"flex-1 text-center text-sm text-green-600 py-3 px-4 bg-green-50 rounded-lg border border-green-200",children:"Photo verified successfully"}),x&&"failed"===b&&e.jsxs("button",{onClick:I,className:"flex-1 px-4 py-3 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(f,{size:18}),"Retake Photo"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"â€¢ Ensure good lighting for clear photo"}),e.jsx("p",{children:"â€¢ Position your face clearly in the frame"}),e.jsx("p",{children:"â€¢ Remove sunglasses or hats that obscure your face"}),e.jsx("p",{children:"â€¢ Photo will be used for attendance verification only"})]}),v&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Camera Troubleshooting:"}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Check if camera permissions are granted in browser settings"}),e.jsx("li",{children:"â€¢ Ensure no other apps are using the camera"}),e.jsx("li",{children:"â€¢ Try refreshing the page and allowing camera access"}),e.jsx("li",{children:"â€¢ If on mobile, ensure the app has camera permissions"}),e.jsx("li",{children:"â€¢ Try using a different browser (Chrome, Firefox, Safari)"}),e.jsx("li",{children:"â€¢ Ensure you're using HTTPS (required for camera access)"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Privacy Notice"}),e.jsx("p",{className:"text-xs",children:"Your photo will be used solely for attendance verification and will be stored securely. It will not be shared with third parties without your consent."})]})})]})})},E=()=>{const[e,t]=i.useState(P),[s,a]=i.useState(!0),[r,c]=i.useState(!1);i.useEffect(()=>{n()},[]);const n=async()=>{try{a(!0);const e=await L();t(e)}catch(e){p.error("Failed to load attendance settings")}finally{a(!1)}},o=async e=>{try{c(!0),await I(e),t(e),p.success("Attendance settings updated successfully")}catch(s){throw p.error("Failed to update attendance settings"),s}finally{c(!1)}};return{settings:e,loading:s,saving:r,updateSettings:o,updateSetting:async(t,s)=>{const a={...e,[t]:s};await o(a)},getOfficeConfig:t=>t?e.offices.find(e=>e.name.toLowerCase().includes(t.toLowerCase()))||e.offices[0]||null:e.offices[0]||null,getAllOffices:()=>e.offices,isAttendanceEnabled:()=>e.enabled,getLocationRequirements:()=>({requireLocation:e.requireLocation,requireWifi:e.requireWifi,allowMobileData:e.allowMobileData,gpsAccuracy:e.gpsAccuracy,checkInRadius:e.checkInRadius}),getTimeSettings:()=>({checkInTime:e.checkInTime,checkOutTime:e.checkOutTime,gracePeriod:e.gracePeriod}),detectNearestOfficeByLocation:async(e,t)=>await T(e,t),getOfficeWithDetection:async(e,t,s)=>await M(e,t,s),reload:n,refresh:()=>{n()}}},V=({onVerificationSuccess:t,onVerificationFailed:s,employeeName:a})=>{const{detectNearestOfficeByLocation:r,settings:c,getAllOffices:n}=E(),[l,u]=i.useState(!1),[x,h]=i.useState(""),[f,g]=i.useState(!1),[p,b]=i.useState(null),[j,v]=i.useState(null),[N,w]=i.useState(0),[k,S]=i.useState(!1),C=async()=>{u(!0),h("");try{const e=await new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>e(t),e=>t(e),{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):t(new Error("Geolocation is not supported by this browser"))}),a={lat:e.coords.latitude,lng:e.coords.longitude,accuracy:e.coords.accuracy};b(a);const i=await r(a.lat,a.lng);if(!i.office)return h("No office locations configured. Please contact your administrator."),void s();v(i.office),w(i.distance),S(i.isWithinRange),i.isWithinRange?(d.success(`Detected: ${i.office.name} (${Math.round(i.distance)}m away)`),t({office:i.office,userLocation:a,distance:i.distance,detectionMethod:"auto"})):(h(`You are ${Math.round(i.distance)}m away from ${i.office.name}. Please come within ${i.office.radius}m to check in.`),s())}catch(e){1===e.code?h("Location access denied. Please enable location services and try again."):2===e.code?h("Location unavailable. Please check your GPS signal and try again."):3===e.code?h("Location request timed out. Please try again."):h("Failed to detect office location. Please try again."),s()}finally{u(!1)}};return i.useEffect(()=>{C()},[]),e.jsxs("div",{className:"space-y-4",children:[l&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(y,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Detecting office..."})]}),x&&!l&&!f&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-600",children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Too Far Away"})]}),e.jsx("p",{className:"text-red-600 text-sm",children:x}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Try Again"}),e.jsx("button",{onClick:()=>g(!0),className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",children:"Select Manually"})]})]}),f&&!l&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-center text-gray-900 font-medium",children:"Select Your Office"}),e.jsx("div",{className:"space-y-2",children:n().map((s,a)=>e.jsxs("button",{onClick:()=>(e=>{v(e),d.success(`Office selected: ${e.name}`),t({office:e,userLocation:null,distance:0,detectionMethod:"manual"})})(s),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition-all",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.address})]},a))}),e.jsx("button",{onClick:()=>g(!1),className:"w-full py-2 text-gray-600 text-sm hover:text-gray-800",children:"â† Back to Auto-Detect"})]}),j&&k&&!l&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(m,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:j.name}),e.jsxs("p",{className:"text-sm text-green-600",children:["âœ“ Within range (",Math.round(N),"m away)"]})]}),j&&!k&&!l&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(o,{className:"w-12 h-12 text-orange-600 mx-auto mb-3"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:j.name}),e.jsxs("p",{className:"text-sm text-orange-600",children:["âš ï¸ ",Math.round(N),"m away (need to be within ",j.radius,"m)"]})]})]})},D=({onAllVerificationsComplete:t,onVerificationFailed:s,employeeName:a,officeLocation:c,officeNetworks:n})=>{const{settings:o}=E(),[l,f]=i.useState(()=>{if(o.allowEmployeeChoice){return localStorage.getItem("employeeSecurityMode")||o.defaultSecurityMode}return o.defaultSecurityMode}),[p,y]=i.useState(!1),v=()=>"photo-only"===l?"photo":"wifi-only"===l?"network":"location",[N,w]=i.useState(v()),[k,S]=i.useState({location:!1,network:!1,photo:!1}),C="auto-location"===l||"manual-location"===l||"location-and-wifi"===l||"all-security"===l,P="wifi-only"===l||"location-and-wifi"===l||"all-security"===l,L=o.requirePhoto&&("photo-only"===l||"all-security"===l||"auto-location"===l||"manual-location"===l||"wifi-only"===l||"location-and-wifi"===l),[I,T]=i.useState(null),M=e=>{f(e),localStorage.setItem("employeeSecurityMode",e),y(!1),d.success(`Security mode changed to ${(()=>{switch(l){case"auto-location":return{icon:j,name:"Auto-Location",desc:"GPS auto-detection",color:"text-blue-600"};case"manual-location":return{icon:r,name:"Manual Location",desc:"Manual office selection",color:"text-indigo-600"};case"wifi-only":return{icon:x,name:"WiFi Only",desc:"Network verification",color:"text-purple-600"};case"location-and-wifi":return{icon:b,name:"Location + WiFi",desc:"GPS and WiFi required",color:"text-orange-600"};case"photo-only":return{icon:g,name:"Photo Only",desc:"Photo verification",color:"text-pink-600"};case"all-security":return{icon:h,name:"Maximum Security",desc:"All methods required",color:"text-red-600"};default:return{icon:b,name:"Secure Mode",desc:"Security verification",color:"text-gray-600"}}})().name}`),w(v()),S({location:!1,network:!1,photo:!1})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50",onClick:s,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsxs("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:[e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(h,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Check In Verification"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Secure attendance verification process"})]})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(u,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Progress"}),e.jsx("div",{className:"relative w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-600 rounded-full transition-all duration-500",style:{width:`${(()=>{const e=[C,P,L].filter(Boolean).length,t=[C&&k.location,P&&k.network,L&&k.photo].filter(Boolean).length;return e>0?t/e*100:0})()}%`}})})]}),e.jsxs("div",{className:"space-y-6",children:["location"===N&&C&&("auto-location"===l||"all-security"===l?e.jsx(V,{onVerificationSuccess:e=>{T(e.office),S(e=>({...e,location:!0})),P?(w("network"),d.success(`Office detected: ${e.office.name}! Moving to network verification.`)):L?(w("photo"),d.success(`Office detected: ${e.office.name}! Moving to photo verification.`)):(w("complete"),d.success(`Office detected: ${e.office.name}! All checks complete.`),t())},onVerificationFailed:()=>{S(e=>({...e,location:!1}))},employeeName:a}):e.jsx(z,{onVerificationSuccess:()=>{S(e=>({...e,location:!0})),P?(w("network"),d.success("Location verified! Moving to network verification.")):L?(w("photo"),d.success("Location verified! Moving to photo verification.")):(w("complete"),d.success("Location verified! All checks complete."),t())},onVerificationFailed:()=>{S(e=>({...e,location:!1})),s()},officeLocation:c})),"network"===N&&P&&e.jsx(A,{onVerificationSuccess:()=>{S(e=>({...e,network:!0})),L?(w("photo"),d.success("Network verified! Moving to photo verification.")):(w("complete"),d.success("Network verified! All checks complete."),t())},onVerificationFailed:()=>{S(e=>({...e,network:!1})),s()},officeNetworks:(null==I?void 0:I.networks)||n}),"photo"===N&&L&&e.jsx(F,{onVerificationSuccess:e=>{S(e=>({...e,photo:!0})),w("complete"),d.success("All security checks passed!"),t()},onVerificationFailed:()=>{S(e=>({...e,photo:!1})),s()},employeeName:a}),"complete"===N&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Verification Status"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:"âœ… Complete"})]}),e.jsx(m,{className:"w-16 h-16 text-green-600"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"All security checks passed successfully"})]})]}),"complete"!==N&&e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{d("Retrying verification...",{icon:"ðŸ”„"});const e=N;w("location"),setTimeout(()=>w(e),10)},className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Retry"}),e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Cancel"})]}),"complete"===N&&e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors",children:"Complete Check In"})})]})}),p&&o.allowEmployeeChoice&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[99999]",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(h,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Security Method"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose verification method"})]})]}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(u,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"space-y-3",children:o.availableSecurityModes.map(t=>{const s=(()=>{switch(t){case"auto-location":return{icon:j,name:"Auto-Location",color:"text-blue-600"};case"manual-location":return{icon:r,name:"Manual Location",color:"text-indigo-600"};case"wifi-only":return{icon:x,name:"WiFi Only",color:"text-purple-600"};case"location-and-wifi":return{icon:b,name:"Location + WiFi",color:"text-orange-600"};case"photo-only":return{icon:g,name:"Photo Only",color:"text-pink-600"};case"all-security":return{icon:h,name:"Maximum Security",color:"text-red-600"};default:return{icon:b,name:t,color:"text-gray-600"}}})(),a=l===t;return e.jsx("button",{onClick:()=>M(t),className:"w-full p-4 rounded-lg border-2 transition-all text-left "+(a?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.icon,{className:`w-5 h-5 ${a?s.color:"text-gray-400"}`}),e.jsx("span",{className:"font-medium "+(a?"text-gray-900":"text-gray-700"),children:s.name}),a&&e.jsx(m,{className:"w-5 h-5 text-blue-600 ml-auto"})]})},t)})})]})})})]})]})},q=({employeeId:a,employeeName:r,onClose:c,onSuccess:n})=>{const[o,l]=i.useState("annual"),[m,x]=i.useState(""),[h,f]=i.useState(""),[g,p]=i.useState(""),[y,b]=i.useState(!1),[j,k]=i.useState(""),S=()=>{if(m&&h){const e=new Date(m),t=new Date(h),s=Math.abs(t.getTime()-e.getTime());return Math.ceil(s/864e5)+1}return 0};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(t,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Request Leave"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r})]}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(u,{size:24})})]}),j&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[e.jsx(v,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"Error"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:j})]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k(""),m&&h)if(new Date(m)>new Date(h))k("End date must be after start date");else if(g.trim()){b(!0);try{await O.createLeaveRequest({employeeId:a,leaveType:o,startDate:m,endDate:h,reason:g.trim(),status:"pending"}),n()}catch(t){k(t.message||"Failed to submit leave request"),d.error("Failed to submit leave request")}finally{b(!1)}}else k("Please provide a reason for leave");else k("Please select start and end dates")},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Leave Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[{value:"annual",label:"Annual Leave",color:"blue"},{value:"sick",label:"Sick Leave",color:"red"},{value:"personal",label:"Personal Leave",color:"purple"},{value:"emergency",label:"Emergency Leave",color:"orange"},{value:"unpaid",label:"Unpaid Leave",color:"gray"}].map(t=>e.jsx("button",{type:"button",onClick:()=>l(t.value),className:"p-3 rounded-lg border-2 transition-all "+(o===t.value?`border-${t.color}-500 bg-${t.color}-50`:"border-gray-200 bg-white hover:border-gray-300"),children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.label})},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Start Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"date",value:m,onChange:e=>x(e.target.value),min:(new Date).toISOString().split("T")[0],className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["End Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"date",value:h,onChange:e=>f(e.target.value),min:m||(new Date).toISOString().split("T")[0],className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]})]}),m&&h&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Total Duration"}),e.jsxs("span",{className:"text-lg font-bold text-blue-900",children:[S()," ",1===S()?"day":"days"]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsx("textarea",{value:g,onChange:e=>p(e.target.value),placeholder:"Please provide a detailed reason for your leave request...",rows:4,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",required:!0})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[g.length," / 500 characters"]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx(s,{type:"button",variant:"ghost",onClick:c,className:"flex-1",disabled:y,children:"Cancel"}),e.jsx(s,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white",disabled:y,children:y?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Submitting..."]}):"Submit Request"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{children:"Note:"})," Your leave request will be sent to your manager for approval. You will be notified once your request has been reviewed."]})})]})})})},$=({employeeId:t,employeeName:s,onCheckIn:r,onCheckOut:c,officeLocation:n,officeNetworks:u})=>{var x;const{settings:h,loading:f}=E(),[g,p]=i.useState(new Date),[y,b]=i.useState({status:"not-started"}),[j,v]=i.useState(!0),[w,P]=i.useState(!1),[L,I]=i.useState(!1),T=n||h.offices[0],M=u||(null==(x=h.offices[0])?void 0:x.networks)||[];i.useEffect(()=>{z()},[t]),i.useEffect(()=>{const e=setInterval(()=>{p(new Date)},1e3);return()=>clearInterval(e)},[]);const z=async()=>{try{v(!0);const e=await O.getTodayAttendance(t);if(e){const t=e.checkInTime?new Date(e.checkInTime).toTimeString().split(" ")[0]:void 0,s=e.checkOutTime?new Date(e.checkOutTime).toTimeString().split(" ")[0]:void 0;let a="not-started";t&&s?a="checked-out":t&&(a="checked-in"),b({checkIn:t,checkOut:s,status:a})}else b({status:"not-started"})}catch(e){}finally{v(!1)}},A=async()=>{try{const e=(new Date).toTimeString().split(" ")[0];b({checkIn:e,status:"checked-in"}),await r(t,e),await z()}catch(e){await z()}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:j?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading attendance..."})]}):e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-3xl font-bold text-gray-900",children:s})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(k,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current Time"})]}),e.jsx("div",{className:"text-2xl font-mono font-bold text-gray-900",children:(F=g,F.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}))}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:g.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:`flex items-center justify-center gap-2 ${(()=>{switch(y.status){case"checked-in":return"text-green-600";case"checked-out":return"text-blue-600";default:return"text-gray-600"}})()}`,children:["checked-in"===y.status&&e.jsx(m,{size:20}),"checked-out"===y.status&&e.jsx(o,{size:20}),e.jsx("span",{className:"font-medium",children:(()=>{switch(y.status){case"checked-in":return"Currently Working";case"checked-out":return"Checked Out";default:return"Not Checked In"}})()})]}),(y.checkIn||y.checkOut)&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[y.checkIn&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Check In:"}),e.jsx("span",{className:"font-mono font-medium text-green-700",children:y.checkIn})]}),y.checkOut&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Check Out:"}),e.jsx("span",{className:"font-mono font-medium text-blue-700",children:y.checkOut})]})]}),e.jsxs("div",{className:"flex gap-3",children:["not-started"===y.status&&e.jsxs("button",{onClick:()=>{h.enabled?T&&M&&(h.requireLocation||h.requireWifi||h.requirePhoto)?I(!0):A():d.error("Attendance system is disabled")},className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(S,{size:18}),"Check In"]}),"checked-in"===y.status&&e.jsxs("button",{onClick:async()=>{try{const e=(new Date).toTimeString().split(" ")[0];b(t=>({...t,checkOut:e,status:"checked-out"})),await c(t,e),await z()}catch(e){await z()}},className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(C,{size:18}),"Check Out"]}),"checked-out"===y.status&&e.jsx("div",{className:"flex-1 text-center text-sm text-gray-500 py-3 px-4 bg-gray-50 rounded-lg border border-gray-200",children:"Day completed"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{className:"px-3 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(N,{size:16}),"View History"]}),e.jsxs("button",{onClick:()=>P(!0),className:"px-3 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(k,{size:16}),"Request Leave"]})]}),("checked-in"===y.status||"checked-out"===y.status)&&e.jsxs("button",{onClick:async()=>{try{const e=(new Date).toISOString().split("T")[0],{error:s}=await a.from("attendance_records").delete().eq("employee_id",t).eq("attendance_date",e);if(s)throw s;b({status:"not-started"}),d.success("Today's attendance cleared! You can now test check-in."),await z()}catch(e){d.error("Failed to clear today's attendance")}},className:"w-full mt-2 px-3 py-2 border-2 border-orange-200 rounded-lg text-sm font-medium text-orange-700 hover:bg-orange-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(l,{size:16}),"Reset Today (Testing)"]})]})]})}),L&&n&&u&&e.jsx(D,{onAllVerificationsComplete:()=>{I(!1),A()},onVerificationFailed:()=>{I(!1),d.error("Security verification failed. Please try again.")},employeeName:s,officeLocation:n,officeNetworks:u}),w&&e.jsx(q,{employeeId:t,employeeName:s,onClose:()=>P(!1),onSuccess:()=>{P(!1),d.success("Leave request submitted successfully")}})]});var F},W={location:{lat:-3.359178,lng:36.661366,radius:100,address:"Main Office, Arusha, Tanzania",name:"Arusha Main Office"},networks:[{ssid:"Office_WiFi",bssid:"00:11:22:33:44:55",description:"Main office WiFi network"},{ssid:"Office_Guest",description:"Guest WiFi network"},{ssid:"4G_Mobile",description:"Mobile data connection"},{ssid:"Any_Network",description:"Any network connection"}]};export{$ as E,W as m,E as u};
