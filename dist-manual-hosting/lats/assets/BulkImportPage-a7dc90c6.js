import{u as e,c as s,j as t,aB as a,ai as r,s as i}from"./index-222cfb29.js";import{B as l}from"./BackButton-e41d1482.js";import{r as n}from"./vendor-a2ff445a.js";import{u as c}from"./index-7d29ff6f.js";import{n as d,N as o,a5 as x,aj as m,ai as g,q as u,$ as h,Q as p,ax as b,d as v,e as j,X as f,a as y,b as N,x as S,bx as k}from"./ui-551a39a6.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";import"./charts-66cc82bb.js";const w=({product:e,index:s,isExpanded:a,isEditing:r,onToggleExpansion:i,onStartEditing:l,onSaveEditing:c,onCancelEditing:d})=>{const[x,m]=n.useState(e),g=()=>{c(s,x)},u=()=>{m(e),d()};return t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md hover:border-blue-300 transition-all",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>i(s),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a?t.jsx(y,{size:16,className:"text-gray-700"}):t.jsx(N,{size:16,className:"text-gray-700"})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:t.jsx(S,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:e.name}),t.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",e.sku]})]})]})]}),t.jsx("div",{className:"flex items-center gap-2",children:r?t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:g,className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Save changes",children:t.jsx(o,{size:16})}),t.jsx("button",{onClick:u,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Cancel editing",children:t.jsx(f,{size:16})})]}):t.jsx("button",{onClick:()=>l(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit product",children:t.jsx(k,{size:16})})})]}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Cost Price"}),t.jsxs("div",{className:"text-base font-bold text-gray-900",children:["TZS ",e.costPrice.toLocaleString()]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Selling Price"}),t.jsxs("div",{className:"text-base font-bold text-gray-900",children:["TZS ",e.sellingPrice.toLocaleString()]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Stock"}),t.jsx("div",{className:"text-base font-bold text-gray-900",children:e.stockQuantity})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Min Level"}),t.jsx("div",{className:"text-base font-bold text-gray-900",children:e.minStockLevel})]})]})}),a&&t.jsx("div",{className:"border-t border-gray-200 p-4 bg-gray-50",children:r?t.jsx(C,{product:x,onChange:m,onSave:g,onCancel:u}):t.jsx(P,{product:e})})]})},P=({product:e})=>{var s;return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[t.jsx("h3",{className:"text-base font-bold text-gray-900 mb-3",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Product Name"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:e.name})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"SKU"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900 font-mono",children:e.sku})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Category"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:e.category||"Not specified"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Supplier"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:e.supplier||"Not specified"})]})]}),e.description&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Description"}),t.jsx("div",{className:"text-sm text-gray-800 bg-gray-50 rounded-lg p-3",children:e.description})]})]}),t.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[t.jsx("h3",{className:"text-base font-bold text-gray-900 mb-3",children:"Pricing & Stock"}),t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Cost Price"}),t.jsxs("div",{className:"text-base font-bold text-gray-900",children:["TZS ",e.costPrice.toLocaleString()]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Selling Price"}),t.jsxs("div",{className:"text-base font-bold text-gray-900",children:["TZS ",e.sellingPrice.toLocaleString()]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Stock Quantity"}),t.jsx("div",{className:"text-base font-bold text-gray-900",children:e.stockQuantity})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Min Stock Level"}),t.jsx("div",{className:"text-base font-bold text-gray-900",children:e.minStockLevel})]})]}),t.jsx("div",{className:"mt-4 bg-green-50 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-xs font-medium text-green-700",children:"Profit Margin"}),t.jsxs("div",{className:"text-lg font-bold text-green-900",children:[((e.sellingPrice-e.costPrice)/e.costPrice*100).toFixed(1),"%"]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"text-base font-bold text-gray-900",children:"Product Variants"}),t.jsxs("span",{className:"text-sm text-gray-500",children:[e.variants?e.variants.length:0," variant",1!==((null==(s=e.variants)?void 0:s.length)||0)?"s":""]})]}),e.variants&&e.variants.length>0?t.jsx("div",{className:"space-y-4",children:e.variants.map((e,s)=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:e.name}),t.jsxs("span",{className:"text-xs text-gray-500",children:["#",s+1]})]}),t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-3",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"SKU"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900 font-mono",children:e.sku})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Cost Price"}),t.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["TZS ",e.costPrice.toLocaleString()]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Selling Price"}),t.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["TZS ",e.sellingPrice.toLocaleString()]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Stock"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:e.stockQuantity})]})]}),t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-3",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Min Stock Level"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:e.minStockLevel})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Profit Margin"}),t.jsxs("div",{className:"text-sm font-semibold text-green-600",children:[((e.sellingPrice-e.costPrice)/e.costPrice*100).toFixed(1),"%"]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Total Value"}),t.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["TZS ",(e.stockQuantity*e.sellingPrice).toLocaleString()]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Status"}),t.jsx("div",{className:"text-sm font-semibold "+(e.stockQuantity<=e.minStockLevel?"text-red-600":e.stockQuantity<=2*e.minStockLevel?"text-yellow-600":"text-green-600"),children:e.stockQuantity<=e.minStockLevel?"Low Stock":e.stockQuantity<=2*e.minStockLevel?"Medium Stock":"In Stock"})]})]}),e.attributes&&Object.keys(e.attributes).length>0&&t.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"Variant Specifications"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:Object.entries(e.attributes).map(([e,s])=>t.jsxs("div",{className:"bg-white rounded p-2 border border-gray-100",children:[t.jsx("div",{className:"text-xs font-medium text-gray-700 capitalize",children:e.replace(/_/g," ")}),t.jsx("div",{className:"text-xs text-gray-600 truncate",children:String(s)||"Not set"})]},e))})]})]},s))}):t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[t.jsxs("div",{className:"text-center py-4",children:[t.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"No variants found"}),t.jsx("div",{className:"text-xs text-gray-400",children:"This product uses the main product data as a single variant"})]}),t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Variant Name"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"Default"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Variant SKU"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900 font-mono",children:e.sku})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Cost Price"}),t.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["TZS ",e.costPrice.toLocaleString()]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Selling Price"}),t.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["TZS ",e.sellingPrice.toLocaleString()]})]})]})]})]}),e.specifications&&Object.keys(e.specifications).length>0&&t.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Specifications"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2",children:Object.entries(e.specifications).map(([e,s])=>String(s).split(/[,\n]/).filter(e=>e.trim()&&!e.trim().toLowerCase().includes("note")).map((s,a)=>t.jsxs("div",{className:"bg-gray-50 rounded-md p-2 border border-gray-200 hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1 capitalize",children:e.replace(/_/g," ")}),t.jsx("div",{className:"text-xs font-semibold text-gray-900 truncate",title:s.trim(),children:s.trim()||"Not set"})]},`${e}-${a}`)))})]})]})},C=({product:e,onChange:s,onSave:a,onCancel:r})=>{const i=(t,a)=>{s({...e,[t]:a})};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Name"}),t.jsx("input",{type:"text",value:e.name,onChange:e=>i("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU"}),t.jsx("input",{type:"text",value:e.sku,onChange:e=>i("sku",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),t.jsx("input",{type:"text",value:e.category||"",onChange:e=>i("category",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier"}),t.jsx("input",{type:"text",value:e.supplier||"",onChange:e=>i("supplier",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Price (TZS)"}),t.jsx("input",{type:"number",value:e.costPrice,onChange:e=>i("costPrice",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selling Price (TZS)"}),t.jsx("input",{type:"number",value:e.sellingPrice,onChange:e=>i("sellingPrice",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Quantity"}),t.jsx("input",{type:"number",value:e.stockQuantity,onChange:e=>i("stockQuantity",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Stock Level"}),t.jsx("input",{type:"number",value:e.minStockLevel,onChange:e=>i("minStockLevel",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),t.jsx("textarea",{value:e.description||"",onChange:e=>i("description",e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Product Variants"}),t.jsx("button",{type:"button",onClick:()=>{var s,t;const a={name:`Variant ${((null==(s=e.variants)?void 0:s.length)||0)+1}`,sku:`${e.sku}-V${(((null==(t=e.variants)?void 0:t.length)||0)+1).toString().padStart(2,"0")}`,costPrice:e.costPrice,sellingPrice:e.sellingPrice,stockQuantity:e.stockQuantity,minStockLevel:e.minStockLevel,attributes:{}};i("variants",[...e.variants||[],a])},className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm",children:"Add Variant"})]}),e.variants&&e.variants.length>0?t.jsx("div",{className:"space-y-3",children:e.variants.map((s,a)=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h5",{className:"font-medium text-gray-900",children:["Variant ",a+1]}),e.variants&&e.variants.length>1&&t.jsx("button",{type:"button",onClick:()=>{var s;const t=(null==(s=e.variants)?void 0:s.filter((e,s)=>s!==a))||[];i("variants",t)},className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Variant Name"}),t.jsx("input",{type:"text",value:s.name,onChange:t=>{const r=[...e.variants||[]];r[a]={...s,name:t.target.value},i("variants",r)},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Variant SKU"}),t.jsx("input",{type:"text",value:s.sku,onChange:t=>{const r=[...e.variants||[]];r[a]={...s,sku:t.target.value},i("variants",r)},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Cost Price"}),t.jsx("input",{type:"number",value:s.costPrice,onChange:t=>{const r=[...e.variants||[]];r[a]={...s,costPrice:parseFloat(t.target.value)||0},i("variants",r)},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Selling Price"}),t.jsx("input",{type:"number",value:s.sellingPrice,onChange:t=>{const r=[...e.variants||[]];r[a]={...s,sellingPrice:parseFloat(t.target.value)||0},i("variants",r)},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Stock Quantity"}),t.jsx("input",{type:"number",value:s.stockQuantity,onChange:t=>{const r=[...e.variants||[]];r[a]={...s,stockQuantity:parseInt(t.target.value)||0},i("variants",r)},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Min Stock Level"}),t.jsx("input",{type:"number",value:s.minStockLevel,onChange:t=>{const r=[...e.variants||[]];r[a]={...s,minStockLevel:parseInt(t.target.value)||0},i("variants",r)},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]})]},a))}):t.jsx("div",{className:"text-center py-4 text-gray-500",children:t.jsx("p",{className:"text-sm",children:'No variants added yet. Click "Add Variant" to create one.'})})]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[t.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),t.jsx("button",{onClick:a,className:"px-4 py-2 text-white bg-blue-600 hover:bg-blue-700 rounded-md",children:"Save Changes"})]})]})},L=()=>{const{currentUser:l}=e(),{loadProducts:y}=s(),[N,S]=n.useState([]),[k,P]=n.useState(!1),[C,L]=n.useState([]),[I,D]=n.useState([]),[Q,z]=n.useState(!0),[M,E]=n.useState(null),[A,B]=n.useState(new Set),[T,V]=n.useState(""),[F,O]=n.useState(!1),U=n.useCallback(e=>{const s=e[0];s&&Z(s)},[]),{getRootProps:G,getInputProps:R,isDragActive:$}=c({onDrop:U,accept:{"text/csv":[".csv"],"application/json":[".json"]},multiple:!1}),Z=e=>{const s=new FileReader;s.onload=e=>{var s;const t=(null==(s=e.target)?void 0:s.result).split("\n"),a=e=>{const s=[];let t="",a=!1;for(let r=0;r<e.length;r++){const i=e[r];'"'===i?a=!a:","!==i||a?t+=i:(s.push(t.trim()),t="")}return s.push(t.trim()),s},r=a(t[0]),i=[];for(let n=1;n<t.length;n++){const e=t[n].trim();if(!e)continue;const s=a(e);if(s.length<r.length)continue;let c={};if(s[9])try{c=JSON.parse(s[9])}catch(l){c={note:s[9]}}const d={name:"Default",sku:s[2]||"",costPrice:parseFloat(s[4])||0,sellingPrice:parseFloat(s[5])||0,stockQuantity:parseInt(s[6])||0,minStockLevel:parseInt(s[7])||0,attributes:c},o={name:s[0]||"",description:s[1]||"",sku:s[2]||"",category:s[3]||"",costPrice:parseFloat(s[4])||0,sellingPrice:parseFloat(s[5])||0,stockQuantity:parseInt(s[6])||0,minStockLevel:parseInt(s[7])||0,supplier:s[8]||"",specifications:c,variants:[d],useVariants:!1};i.push(o)}S(i),D(i),d.success(`Loaded ${i.length} products from CSV`)},s.readAsText(e)},J=async e=>{try{const{data:s}=await i.from("lats_categories").select("id").eq("name",e).single();if(s&&"id"in s)return s.id;const{data:t,error:a}=await i.from("lats_categories").insert({name:e,description:`Category for ${e} products`,color:"#3B82F6"}).select("id").single();if(a)throw a;return t.id}catch(s){return"00000000-0000-0000-0000-000000000000"}},_=()=>JSON.parse(localStorage.getItem("bulkImportDrafts")||"[]"),K=e=>{const s=new Set(A);s.has(e)?s.delete(e):s.add(e),B(s)},q=e=>{E(e)},W=(e,s)=>{const t=[...N];t[e]=s,S(t);const a=[...I];e<a.length&&(a[e]=s),D(a),E(null),d.success(`Product "${s.name}" updated successfully`)},X=()=>{E(null)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"flex gap-2",children:N.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>O(!0),className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:[t.jsx(o,{size:14}),t.jsx("span",{className:"hidden sm:inline",children:"Save Draft"}),t.jsx("span",{className:"sm:hidden",children:"Save"})]}),t.jsxs("button",{onClick:()=>{_().length>0?O(!0):d.success("No saved drafts found")},className:"flex items-center gap-2 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm",children:[t.jsx(x,{size:14}),t.jsx("span",{className:"hidden sm:inline",children:"Load Draft"}),t.jsx("span",{className:"sm:hidden",children:"Load"})]})]})}),t.jsxs("button",{onClick:()=>{const e=["name,description,sku,category,cost_price,selling_price,stock_quantity,min_stock_level,supplier,specifications",'"Samsung Galaxy S23","Latest Samsung smartphone with advanced camera","SAM-GS23-001","Electronics",850000,1200000,50,5,"Samsung Electronics","{"Screen Size":"6.1 inches","Storage":"128GB","RAM":"8GB","Camera":"50MP","Battery":"3900mAh"}"','"iPhone 15 Pro","Apple flagship smartphone with titanium design","APP-IP15P-001","Electronics",1200000,1800000,30,3,"Apple Inc","{"Screen Size":"6.1 inches","Storage":"256GB","RAM":"8GB","Camera":"48MP","Battery":"3274mAh"}"','"Dell XPS 13 Laptop","Premium ultrabook for professionals","DELL-XPS13-001","Electronics",1800000,2500000,15,2,"Dell Technologies","{"Screen Size":"13.4 inches","RAM":"16GB","Storage":"512GB SSD","Processor":"Intel i7","Graphics":"Intel Iris Xe"}"','"Nike Air Max 270","Comfortable running shoes","NIKE-AM270-001","Footwear",120000,180000,100,10,"Nike Inc","{"Size":"US 9","Color":"Black/White","Material":"Mesh/Leather","Weight":"320g"}"','"MacBook Pro 16-inch","Professional laptop for creators","APP-MBP16-001","Electronics",3500000,4500000,8,1,"Apple Inc","{"Screen Size":"16.2 inches","RAM":"32GB","Storage":"1TB SSD","Processor":"Apple M3 Pro","Graphics":"Apple M3 Pro GPU"}"'].join("\n"),s=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="product-import-template.csv",a.click(),window.URL.revokeObjectURL(t)},className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[t.jsx(m,{size:14}),t.jsx("span",{className:"hidden sm:inline",children:"Download Template"}),t.jsx("span",{className:"sm:hidden",children:"Template"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center",children:t.jsx(x,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Upload File"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Choose your CSV or JSON file to import products"})]})]}),t.jsxs("div",{...G(),className:"border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all duration-200 "+($?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-gray-50"),children:[t.jsx("input",{...R()}),t.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(g,{size:32,className:"text-blue-600"})}),t.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:$?"Drop your file here":"Upload CSV or JSON file"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Drag and drop your product data file, or click to browse"}),t.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-gray-500",children:[t.jsxs("span",{className:"flex items-center gap-2 px-2 py-1 bg-green-100 text-green-700 rounded-full",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"CSV"]}),t.jsxs("span",{className:"flex items-center gap-2 px-2 py-1 bg-blue-100 text-blue-700 rounded-full",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"JSON"]})]})]})]}),I.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center",children:t.jsx(u,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Product Preview"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[N.length," products loaded • ",I.length," shown"]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>z(!Q),className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[t.jsx(u,{size:14}),Q?"Hide":"Show"," Details"]}),t.jsxs("button",{onClick:()=>{S([]),D([]),L([]),z(!1),E(null),B(new Set)},className:"flex items-center gap-2 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:[t.jsx(h,{size:14}),"Clear"]})]})]}),Q&&t.jsx("div",{className:"space-y-4",children:I.map((e,s)=>t.jsx(w,{product:e,index:s,isExpanded:A.has(s),isEditing:M===s,onToggleExpansion:K,onStartEditing:q,onSaveEditing:W,onCancelEditing:X},s))})]}),N.length>0&&t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center",children:t.jsx(p,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Ready to Import"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[N.length," products ready for import"]})]})]}),t.jsx("button",{onClick:async()=>{if(0===N.length)return void d.error("No products to import");P(!0);const e=[];try{for(const r of N)try{const s=await J(r.category||"General"),t={name:r.name,description:r.description,sku:r.sku,categoryId:s,variants:r.variants&&r.variants.length>0?r.variants.map(e=>({sku:e.sku,name:e.name,sellingPrice:e.sellingPrice,costPrice:e.costPrice,quantity:e.stockQuantity,minQuantity:e.minStockLevel,attributes:e.attributes||{}})):[{sku:r.sku,name:"Default",sellingPrice:r.sellingPrice,costPrice:r.costPrice,quantity:r.stockQuantity,minQuantity:r.minStockLevel,attributes:r.specifications||{}}]};await a(t,(null==l?void 0:l.id)||""),e.push({product:r.name,status:"success"})}catch(s){e.push({product:r.name,status:"error",error:s instanceof Error?s.message:"Unknown error"})}L(e);const t=e.filter(e=>"success"===e.status).length,i=e.filter(e=>"error"===e.status).length;t>0&&(r.clearProducts(),await y(null,!0)),d.success(`Import completed: ${t} success, ${i} errors`)}catch(s){d.error("Failed to import products")}finally{P(!1)}},disabled:k,className:"flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:k?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Importing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(p,{size:16}),"Import Products"]})})]})}),C.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:t.jsx(b,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Import Results"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[C.filter(e=>"success"===e.status).length," successful, ",C.filter(e=>"error"===e.status).length," failed"]})]})]}),t.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:C.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border "+("success"===e.status?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:["success"===e.status?t.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:t.jsx(v,{size:16,className:"text-green-600"})}):t.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:t.jsx(j,{size:16,className:"text-red-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-base font-bold text-gray-900",children:e.product}),e.error&&t.jsx("p",{className:"text-red-600 mt-1 text-sm",children:e.error})]})]},s))})]}),F&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Draft Management"}),t.jsx("button",{onClick:()=>O(!1),className:"text-gray-400 hover:text-gray-600",children:t.jsx(f,{size:20})})]}),N.length>0&&t.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[t.jsx("h4",{className:"text-sm font-semibold text-green-800 mb-2",children:"Save Current Work"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:T,onChange:e=>V(e.target.value),placeholder:"Enter draft name...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-green-500"}),t.jsx("button",{onClick:()=>{if(!T.trim())return void d.error("Please enter a draft name");if(0===N.length)return void d.error("No data to save as draft");const e={id:Date.now().toString(),name:T.trim(),data:N,previewData:I,createdAt:(new Date).toISOString(),productCount:N.length},s=JSON.parse(localStorage.getItem("bulkImportDrafts")||"[]");s.push(e),localStorage.setItem("bulkImportDrafts",JSON.stringify(s)),d.success(`Draft "${T}" saved successfully`),V(""),O(!1)},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm",children:"Save"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-3",children:"Load Saved Draft"}),_().length>0?t.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:_().map(e=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.productCount," products • ",new Date(e.createdAt).toLocaleDateString()]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{(e=>{S(e.data),D(e.previewData),z(!0),E(null),B(new Set),d.success(`Draft "${e.name}" loaded successfully`)})(e),O(!1)},className:"px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700",children:"Load"}),t.jsx("button",{onClick:()=>(e=>{const s=_().filter(s=>s.id!==e);localStorage.setItem("bulkImportDrafts",JSON.stringify(s)),d.success("Draft deleted successfully")})(e.id),className:"px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700",children:"Delete"})]})]},e.id))}):t.jsxs("div",{className:"text-center py-4 text-gray-500",children:[t.jsx(x,{size:32,className:"mx-auto mb-2 text-gray-400"}),t.jsx("p",{className:"text-sm",children:"No saved drafts found"})]})]})]})})]})},I=()=>t.jsx("div",{className:"p-2 sm:p-4 h-full overflow-y-auto pt-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto space-y-3",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(l,{to:"/lats/unified-inventory"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Bulk Product Import"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Import multiple products from CSV or JSON files"})]})]})}),t.jsx(L,{})]})});export{I as default};
