import{j as e}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import{c as t,M as a}from"./customerPortalService-ebbdd244.js";import{V as l,bO as r,p as i,z as o,y as n,X as c,bP as d,ad as u,ac as m,ah as x}from"./ui-551a39a6.js";import{a as g}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";const p=({product:s,onProductClick:t,onAddToCart:a,onToggleFavorite:o,isFavorite:n=!1})=>{var c;const d=s.compareAtPrice&&s.compareAtPrice>s.price,u=d?Math.round((s.compareAtPrice-s.price)/s.compareAtPrice*100):0;return e.jsxs("div",{onClick:()=>t(s),className:"bg-white rounded-lg shadow-sm overflow-hidden active:scale-95 transition-transform cursor-pointer",children:[e.jsxs("div",{className:"relative aspect-square bg-gray-100",children:[s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(l,{size:48})}),d&&e.jsxs("div",{className:"absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded",children:["-",u,"%"]}),o&&e.jsx("button",{onClick:e=>{e.stopPropagation(),o&&o(s.id)},className:"absolute top-2 right-2 bg-white rounded-full p-2 shadow-md active:scale-90 transition-transform",children:e.jsx(r,{size:18,className:n?"fill-red-500 text-red-500":"text-gray-600"})}),!s.inStock&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsx("span",{className:"bg-white text-gray-900 px-3 py-1 rounded-full text-sm font-medium",children:"Out of Stock"})})]}),e.jsxs("div",{className:"p-3",children:[(s.category||s.brand)&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.brand&&e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:s.brand}),s.category&&e.jsxs("span",{className:"text-xs text-gray-500",children:["â€¢ ",s.category]})]}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 line-clamp-2 mb-2 min-h-[2.5rem]",children:s.name}),void 0!==s.rating&&e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(i,{size:14,className:"fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:s.rating.toFixed(1)}),s.reviewCount&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.reviewCount,")"]})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["Tsh ",s.price.toLocaleString()]})}),d&&e.jsxs("span",{className:"text-xs text-gray-500 line-through",children:["Tsh ",null==(c=s.compareAtPrice)?void 0:c.toLocaleString()]})]}),a&&s.inStock&&e.jsx("button",{onClick:e=>{e.stopPropagation(),a&&s.inStock&&a(s)},className:"bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 active:scale-90 transition-all shadow-md",children:e.jsx(l,{size:18})})]}),s.inStock&&void 0!==s.stockQuantity&&s.stockQuantity<10&&e.jsxs("div",{className:"mt-2 text-xs text-orange-600 font-medium",children:["Only ",s.stockQuantity," left!"]})]})]})},h=()=>{const l=g(),[r,i]=s.useState([]),[h,b]=s.useState(!0),[f,j]=s.useState(null),[y,v]=s.useState(0),[N,w]=s.useState(""),[k,C]=s.useState("all"),[S,P]=s.useState("all"),[A,L]=s.useState("popular"),[z,T]=s.useState("grid"),[F,_]=s.useState(!1),[B,M]=s.useState([]),[O,H]=s.useState([]),[R,Q]=s.useState([]);s.useEffect(()=>{V(),$()},[]);const V=async(e=!1)=>{try{b(!0),j(null);const e=await t.getProducts();if(0===e.length)j("no_products");else{i(e),j(null);const s=[...new Set(e.map(e=>e.category).filter(Boolean))],t=[...new Set(e.map(e=>e.brand).filter(Boolean))];H(s),Q(t)}}catch(s){j("fetch_failed"),o.error("Failed to load products. Please check your connection.",{duration:5e3})}finally{b(!1)}},$=()=>{const e=localStorage.getItem("customer_favorites");e&&M(JSON.parse(e))},I=e=>{M(s=>{const t=s.includes(e)?s.filter(s=>s!==e):[...s,e];return localStorage.setItem("customer_favorites",JSON.stringify(t)),o.success(t.includes(e)?"Added to favorites":"Removed from favorites"),t})},J=s.useMemo(()=>{let e=r;switch(N&&(e=e.filter(e=>{var s,t;return e.name.toLowerCase().includes(N.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(N.toLowerCase()))||(null==(t=e.brand)?void 0:t.toLowerCase().includes(N.toLowerCase()))})),"all"!==k&&(e=e.filter(e=>e.category===k)),"all"!==S&&(e=e.filter(e=>e.brand===S)),A){case"price-low":e.sort((e,s)=>e.price-s.price);break;case"price-high":e.sort((e,s)=>s.price-e.price);break;case"newest":break;case"popular":e.sort((e,s)=>(s.rating||0)-(e.rating||0))}return e},[r,N,k,S,A]),U=e=>{l(`/customer-portal/products/${e.id}`)},W=e=>{l(`/customer-portal/products/${e.id}`)};return e.jsxs(a,{title:"Shop",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 p-4 sticky top-14 z-40",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search products...",value:N,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),N&&e.jsx("button",{onClick:()=>w(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(c,{size:20})})]}),e.jsx("button",{onClick:()=>_(!F),className:"p-3 border rounded-lg "+(F?"bg-blue-600 text-white border-blue-600":"border-gray-300 text-gray-700"),children:e.jsx(d,{size:20})})]})}),F&&e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"View Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T("grid"),className:"p-2 rounded-lg "+("grid"===z?"bg-blue-600 text-white":"bg-gray-100 text-gray-600"),children:e.jsx(u,{size:18})}),e.jsx("button",{onClick:()=>T("list"),className:"p-2 rounded-lg "+("list"===z?"bg-blue-600 text-white":"bg-gray-100 text-gray-600"),children:e.jsx(m,{size:18})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Category"}),e.jsxs("select",{value:k,onChange:e=>C(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),O.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Brand"}),e.jsxs("select",{value:S,onChange:e=>P(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Brands"}),R.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Sort By"}),e.jsxs("select",{value:A,onChange:e=>L(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"popular",children:"Most Popular"}),e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"price-low",children:"Price: Low to High"}),e.jsx("option",{value:"price-high",children:"Price: High to Low"})]})]}),e.jsx("button",{onClick:()=>{C("all"),P("all"),L("popular"),w("")},className:"w-full py-2 text-blue-600 font-medium hover:bg-blue-50 rounded-lg transition-colors",children:"Clear All Filters"})]}),e.jsxs("div",{className:"bg-gray-50 px-4 py-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[J.length," ",1===J.length?"product":"products"]}),("all"!==k||"all"!==S||N)&&e.jsx("button",{onClick:()=>{C("all"),P("all"),w("")},className:"text-sm text-blue-600 font-medium",children:"Clear filters"})]}),h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading products..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Please wait"})]}):f?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[e.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(c,{size:40,className:"text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"no_products"===f?"No Products Available":"Failed to Load Products"}),e.jsx("p",{className:"text-gray-600 text-center mb-4 max-w-sm",children:"no_products"===f?"There are no products in the catalog yet. Please check back soon!":"We couldn't load the products. This might be a connection issue."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>{v(e=>e+1),V(!0)},className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-medium flex items-center gap-2 hover:bg-blue-700 active:scale-95 transition-all",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Retry ",y>0&&`(${y+1})`]}),"fetch_failed"===f&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50",children:"Refresh Page"})]}),e.jsxs("div",{className:"mt-6 p-3 bg-gray-100 rounded-lg text-xs text-gray-600 max-w-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Troubleshooting:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Check your internet connection"}),e.jsx("li",{children:"Verify database is accessible"}),e.jsx("li",{children:"Contact support if issue persists"})]})]})]}):0===J.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[e.jsx(x,{size:64,className:"text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 text-center mb-4",children:"Try adjusting your filters or search terms"}),e.jsx("button",{onClick:()=>{C("all"),P("all"),w("")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium",children:"Clear Filters"})]}):"grid"===z?e.jsx("div",{className:"p-4",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(160px, 100%), 1fr))",gap:"clamp(0.75rem, 2vw, 1rem)",gridAutoRows:"1fr"},children:J.map(s=>e.jsx(p,{product:s,onProductClick:U,onAddToCart:W,onToggleFavorite:I,isFavorite:B.includes(s.id)},s.id))}):e.jsx("div",{className:"p-4 space-y-4",children:J.map(s=>e.jsx(p,{product:s,onProductClick:U,onAddToCart:W,onToggleFavorite:I,isFavorite:B.includes(s.id)},s.id))})]})};export{h as default};
