import{aM as e,q as s,j as t,s as a}from"./index-222cfb29.js";import{r}from"./vendor-a2ff445a.js";import{t as n}from"./toastUtils-fdf4803f.js";import{g as l,G as i,W as o,M as c,N as d,S as x,b as u,a as m}from"./StatusSettingsSection-7ad006b2.js";import{s as h,ao as g,R as b,U as p,y as j,aa as f,ck as v,h as y,aj as N,cE as w,bb as k,b5 as C,a5 as S,b_ as z,Q as M,cD as L,a7 as $,X as I,N as _,cF as E,cG as T,az as F,f as A}from"./ui-551a39a6.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";const B=()=>{var B,D,W,U,H,O;const{instances:R,loading:P}=e();s();const[V,Y]=r.useState(null),[q,G]=r.useState(!1),[Q,K]=r.useState(null),[J,X]=r.useState(""),[Z,ee]=r.useState([]),[se,te]=r.useState(""),[ae,re]=r.useState([]),[ne,le]=r.useState(!1),[ie,oe]=r.useState([]),[ce,de]=r.useState(!1),[xe,ue]=r.useState(!1),[me,he]=r.useState(!1),[ge,be]=r.useState(!1),[pe,je]=r.useState(null),[fe,ve]=r.useState(null),[ye,Ne]=r.useState("text"),[we,ke]=r.useState("Frequently Used"),[Ce,Se]=r.useState([]),[ze,Me]=r.useState([]),[Le,$e]=r.useState(!1),[Ie,_e]=r.useState(null),[Ee,Te]=r.useState(""),[Fe,Ae]=r.useState("Frequently Used"),[Be,De]=r.useState(!1),[We,Ue]=r.useState(null),[He,Oe]=r.useState("");r.useState(!1);const[Re,Pe]=r.useState(!1),[Ve,Ye]=r.useState(""),[qe,Ge]=r.useState(""),[Qe,Ke]=r.useState([{id:"btn1",text:"Yes"}]);r.useState(!1);const[Je,Xe]=r.useState(!1),[Ze,es]=r.useState(null),[ss,ts]=r.useState(null);r.useState(0),r.useState(!1);const[as,rs]=r.useState(!1),[ns,ls]=r.useState(0),[is,os]=r.useState(null),[cs,ds]=r.useState(null),[xs,us]=r.useState(""),[ms,hs]=r.useState([]),[gs,bs]=r.useState(!1);r.useState({}),r.useState(null);const[ps,js]=r.useState({}),[fs,vs]=r.useState(!1),[ys,Ns]=r.useState({}),[ws,ks]=r.useState(!1),[Cs,Ss]=r.useState(!1),[zs,Ms]=r.useState("general"),Ls={Greetings:["Hello! How can I help you today?","Hi there! Welcome to our service.","Good morning! How may I assist you?","Hello! Thank you for contacting us.","Hi! I'm here to help you."],"Customer Service":["Thank you for your patience.","I understand your concern.","Let me check that for you.","I'll get back to you shortly.","Is there anything else I can help with?"],"Sales & Orders":["Your order has been confirmed.","Your payment has been received.","Your item is ready for pickup.","Your delivery is on the way.","Would you like to place an order?"],"Technical Support":["Let me troubleshoot this issue.","Have you tried restarting?","I'll escalate this to our technical team.","Can you provide more details?","This should resolve your issue."],Appointments:["Your appointment is confirmed.","Would you like to reschedule?","What time works best for you?","I'll send you a reminder.","Your appointment is tomorrow."],"Frequently Used":["Thank you!","You're welcome!","Have a great day!","See you soon!","Take care!"]},[$s,Is]=r.useState("chat"),_s=async()=>{try{if(!a)return void n.error("Database connection not available");const{data:e,error:s}=await a.from("customers").select("id, name, phone, email, created_at").order("name",{ascending:!0});if(s)throw s;ee(e||[]),re(e||[])}catch(e){n.error("Failed to load customers")}};r.useEffect(()=>{if(""===se.trim())re(Z);else{const e=Z.filter(e=>{var s,t,a;return(null==(s=e.name)?void 0:s.toLowerCase().includes(se.toLowerCase()))||(null==(t=e.phone)?void 0:t.includes(se))||(null==(a=e.email)?void 0:a.toLowerCase().includes(se.toLowerCase()))});re(e)}},[se,Z]),r.useEffect(()=>{_s()},[]),r.useEffect(()=>{if(R&&R.length>0&&!V){const e=R.find(e=>"connected"===e.status);e?Y(e):R.length>0&&Y(R[0])}},[R,V]),r.useEffect(()=>{const e=e=>{const s=e.target;q&&!s.closest(".instance-selector")&&G(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[q]),r.useEffect(()=>{V&&V.instance_id&&V.api_token&&Es()},[V]);const Es=async()=>{if(V)try{ks(!0);let e=await l.loadSettingsFromDatabase(V.instance_id);e?Ns(e):(e=await l.getSettings(V.instance_id,V.api_token),Ns(e),await l.saveSettingsToDatabase(V.instance_id,e))}catch(e){const s=l.getDefaultSettings();Ns(s),n.error("Using default settings")}finally{ks(!1)}},Ts=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},Fs=e=>{var s;switch(null==(s=e.split(".").pop())?void 0:s.toLowerCase()){case"pdf":return t.jsx(S,{size:20,className:"text-red-500"});case"doc":case"docx":return t.jsx(S,{size:20,className:"text-blue-500"});case"xls":case"xlsx":return t.jsx(S,{size:20,className:"text-green-500"});case"ppt":case"pptx":return t.jsx(S,{size:20,className:"text-orange-500"});case"txt":return t.jsx(S,{size:20,className:"text-gray-500"});default:return t.jsx(E,{size:20,className:"text-gray-500"})}},As=()=>"Favorites"===we?Ce:"Recent"===we?ze:Ls[we]||[],Bs=e=>{if(e.trim()&&!Ls[e.trim()]){const s={...Ls};s[e.trim()]=[],Object.assign(Ls,s),Oe(""),n.success(`Category "${e.trim()}" created!`)}else Ls[e.trim()]&&n.error("Category already exists!")},Ds=(e,s)=>{if(s.trim()&&s.trim()!==e){if(Ls[s.trim()])return void n.error("Category name already exists!");const t={...Ls};t[s.trim()]=t[e],delete t[e],Object.assign(Ls,t),we===e&&ke(s.trim()),Ue(null),n.success(`Category renamed to "${s.trim()}"!`)}},Ws=e=>{var s;if(Object.keys(Ls).length<=1)n.error("Cannot delete the last category!");else if((null==(s=Ls[e])?void 0:s.length)>0){const s=prompt(`Category "${e}" has ${Ls[e].length} replies. Enter a category to move them to:`,Object.keys(Ls).find(s=>s!==e)||"");if(s&&Ls[s]){const t={...Ls};t[s]=[...t[s],...t[e]],delete t[e],Object.assign(Ls,t),we===e&&ke(s),n.success(`Category deleted and replies moved to "${s}"!`)}}else{const s={...Ls};delete s[e],Object.assign(Ls,s),we===e&&ke(Object.keys(s)[0]),n.success("Category deleted!")}},Us=e=>{let s=1,t=`${e} (Copy)`;for(;Ls[t];)t=`${e} (Copy ${s})`,s++;const a={...Ls};a[t]=[...a[e]],Object.assign(Ls,a),n.success(`Category duplicated as "${t}"!`)},Hs=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;r.useEffect(()=>{if(""===xs.trim())hs(ie);else{const e=ie.filter(e=>{var s,t,a;return(null==(s=e.content)?void 0:s.toLowerCase().includes(xs.toLowerCase()))||(null==(a=null==(t=e.customer)?void 0:t.name)?void 0:a.toLowerCase().includes(xs.toLowerCase()))});hs(e)}},[xs,ie]);const Os=e=>{const s=new Date(e),t=((new Date).getTime()-s.getTime())/36e5;return t<24?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t<48?"Yesterday":t<168?s.toLocaleDateString([],{weekday:"short"}):s.toLocaleDateString([],{month:"short",day:"numeric"})},Rs=(e,s)=>{if(!s)return!0;return new Date(e.timestamp).toDateString()!==new Date(s.timestamp).toDateString()},Ps=(e,s)=>{js(t=>({...t,[e]:s}))},Vs=e=>{switch(e){case"sending":return t.jsx(A,{size:10,className:"text-gray-400"});case"sent":return t.jsx(F,{size:10,className:"text-gray-400"});case"delivered":return t.jsx(T,{size:10,className:"text-gray-400"});case"read":return t.jsx(T,{size:10,className:"text-green-500"});default:return null}},Ys=async()=>{if(Q&&(null==R?void 0:R.length))if("text"!==ye||J.trim())if("button"!==ye||Ve.trim()&&0!==Qe.length)if("image"!==ye||pe)if("document"!==ye||Ze)if("audio"!==ye||is){le(!0),de(!1);try{if(!V)return void n.error("Please select a WhatsApp instance first");if("connected"!==V.status)return void n.error(`Selected instance "${V.instance_name||V.instance_id}" is not connected`);const s=(e=>{let s=e.replace(/[^\d+]/g,"");return s.startsWith("+")||(s="+"+s),s=s.replace(/\+{2,}/g,"+"),s})(Q.phone);let t;if("button"===ye)if(Je){let e=Ve;Qe.length>0&&(e+="\n\nPlease reply with the number of your choice:\n",e+=Qe.map((e,s)=>`${s+1}. ${e.text}`).join("\n")),qe&&qe.trim()&&(e+=`\n\n${qe}`),e+="\n\nðŸ’¡ Tip: Reply with the number (1, 2, 3) to select your option.",t=await m.sendMessage({instanceId:V.instance_id,chatId:s,message:e,messageType:"text"}),n.success("Message sent as numbered options!")}else try{const e=await(async(e,s)=>{try{if(!Qe||0===Qe.length)throw new Error("No interactive buttons provided");if(Qe.length>3)throw new Error("Maximum 3 buttons allowed");if(Qe.filter(e=>!e.text||e.text.length>20).length>0)throw new Error("Button text must be between 1-20 characters");if(!Ve||0===Ve.trim().length)throw new Error("Message body is required for interactive buttons");if(Ve.length>1024)throw new Error("Message body must be 1024 characters or less");const a=Qe.map((e,s)=>({buttonId:e.id||`btn_${s+1}`,buttonText:e.text.trim().substring(0,20)}));if(!s||!s.instance_id||!s.api_token)throw new Error("Invalid WhatsApp instance configuration");if("connected"!==s.status)throw new Error("WhatsApp instance is not connected");const r=`${s.green_api_host||"https://7105.api.greenapi.com"}/waInstance${s.instance_id}/sendButtons/${s.api_token}`;let n=e;n.includes("@c.us")||(n=n.replace(/[^\d+]/g,""),n.startsWith("+")||(n=`+${n}`),n=n.replace("+",""),n=`${n}@c.us`);const l={chatId:n,message:(Ve||"Please select an option:").substring(0,1024),buttons:a};if(qe&&qe.trim()){let e=l.message;if(qe.length>60)throw new Error("Footer text must be 60 characters or less");e+=`\n\n_${qe.trim().substring(0,60)}_`,l.message=e}const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(i.ok)return{success:!0,data:await i.json()};{const e=await i.text();if(400!==i.status)throw 403===i.status?new Error("Buttons are temporarily disabled by Green API (403 error)"):466===i.status?new Error("Message sent outside 24-hour window - buttons not allowed"):429===i.status?new Error("Rate limit exceeded - please wait before sending more messages"):new Error(`API Error ${i.status}: ${e}`);try{const s=JSON.parse(e);if(s.error)throw new Error(`Buttons error: ${s.error}`);if(s.message)throw new Error(`Buttons error: ${s.message}`)}catch(t){throw new Error(`Buttons format invalid or not supported (400 error): ${e}`)}}}catch(a){throw a}})(s,V);if(!(null==e?void 0:e.success))throw new Error("Interactive buttons failed to send");n.success("Interactive buttons sent successfully!"),t=e}catch(e){let a=Ve;Qe.length>0&&(a+="\n\nPlease reply with the number of your choice:\n",a+=Qe.map((e,s)=>`${s+1}. ${e.text}`).join("\n")),qe&&qe.trim()&&(a+=`\n\n${qe}`),a+="\n\nðŸ’¡ Tip: Reply with the number (1, 2, 3) to select your option.",t=await m.sendMessage({instanceId:V.instance_id,chatId:s,message:a,messageType:"text"}),n.info("Interactive buttons not supported. Sent as numbered options instead.",{duration:5e3,action:{label:"Use Text Format",onClick:()=>Xe(!0)}})}else t="image"===ye&&pe?await m.sendMessage({instanceId:V.instance_id,chatId:s,message:J||"Image shared",messageType:"image",metadata:{imageFile:pe}}):"document"===ye&&Ze?await m.sendMessage({instanceId:V.instance_id,chatId:s,message:J||`File: ${Ze.name}`,messageType:"document",metadata:{documentFile:Ze}}):"audio"===ye&&is?await m.sendMessage({instanceId:V.instance_id,chatId:s,message:J||"Voice message",messageType:"audio",metadata:{audioBlob:is}}):await m.sendMessage({instanceId:V.instance_id,chatId:s,message:J,messageType:"text"});const a=Date.now(),r={id:a,content:"image"===ye?"Image shared":"document"===ye?`File: ${null==Ze?void 0:Ze.name}`:"audio"===ye?"Voice message":"button"===ye?Ve:J,sender:"business",timestamp:(new Date).toISOString(),status:"sent",customer:Q,type:ye,imageUrl:"image"===ye?fe:null,fileUrl:"document"===ye?ss:null,audioUrl:"audio"===ye?cs:null,fileName:null==Ze?void 0:Ze.name,fileSize:null==Ze?void 0:Ze.size,audioDuration:"audio"===ye?Hs(ns):null,buttons:"button"===ye?Qe:null,buttonFooter:"button"===ye?qe:null};Ps(a,"sending"),oe(e=>[...e,r]),setTimeout(()=>Ps(a,"sent"),1e3),setTimeout(()=>Ps(a,"delivered"),2e3),setTimeout(()=>Ps(a,"read"),5e3),X(""),Ye(""),Ge(""),je(null),ve(null),es(null),ts(null),os(null),ds(null),ls(0),Ne("text"),Pe(!1);const l="button"===ye?"Interactive buttons":"Message";n.success(`${l} sent to ${Q.name}`)}catch(e){n.error("Failed to send message: "+e.message)}finally{le(!1)}}else n.error("Please record an audio message");else n.error("Please select a file");else n.error("Please select an image");else n.error("Please enter a message and add at least one button");else n.error("Please enter a message");else n.error("Please select a customer and ensure WhatsApp is connected")};return t.jsxs("div",{className:"h-[90vh] max-h-[90vh] bg-white flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"bg-green-600 text-white p-3 flex items-center gap-3 border-b border-green-700 flex-shrink-0",children:[t.jsx("div",{className:"w-8 h-8 bg-green-500 rounded flex items-center justify-center",children:t.jsx(h,{size:16})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-sm",children:"WhatsApp Chat"}),t.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.jsxs("div",{className:"relative instance-selector",children:[t.jsxs("button",{onClick:()=>G(!q),className:"flex items-center gap-2 px-2 py-1 bg-green-500 rounded text-xs hover:bg-green-700",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full "+("connected"===(null==V?void 0:V.status)?"bg-white":"connecting"===(null==V?void 0:V.status)?"bg-yellow-300":"bg-red-300")}),t.jsx("span",{className:"text-xs",children:V?V.instance_name||V.instance_id:"Select Instance"}),t.jsx(g,{size:10,className:q?"rotate-90":""})]}),q&&t.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-white rounded border border-gray-300 shadow-md z-50",children:[t.jsx("div",{className:"p-2 border-b border-gray-200",children:t.jsx("h4",{className:"font-medium text-gray-900 text-xs",children:"Select Instance"})}),t.jsx("div",{className:"max-h-48 overflow-y-auto",children:R&&R.length>0?R.map(e=>t.jsx("button",{onClick:()=>{Y(e),G(!1),n.success(`Selected: ${e.instance_name||e.instance_id}`)},className:"w-full p-2 text-left hover:bg-gray-100 "+((null==V?void 0:V.id)===e.id?"bg-green-50":""),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full "+("connected"===e.status?"bg-green-500":"connecting"===e.status?"bg-yellow-500":"bg-red-500")}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium text-gray-900 text-xs",children:e.instance_name||e.instance_id}),t.jsx("p",{className:"text-gray-500 text-xs",children:e.phone_number?`+${e.phone_number}`:"No phone"})]}),t.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs "+("connected"===e.status?"bg-green-100 text-green-700":"connecting"===e.status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:e.status})]})},e.id)):t.jsx("div",{className:"p-3 text-center text-gray-500",children:t.jsx("p",{className:"text-xs",children:"No instances found"})})})]})]}),t.jsxs("div",{className:"text-white text-xs flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"}),(null==(B=null==R?void 0:R.filter(e=>"connected"===e.status))?void 0:B.length)||0," connected"]})]})]}),t.jsx("button",{onClick:_s,className:"p-1.5 hover:bg-green-500 rounded",children:t.jsx(b,{size:14})})]}),t.jsxs("div",{className:"flex-1 flex overflow-hidden min-h-0",children:[t.jsxs("div",{className:"w-80 bg-gray-50 border-r border-gray-300 flex flex-col h-full",children:[t.jsxs("div",{className:"p-3 border-b border-gray-300 bg-white flex-shrink-0",children:[t.jsxs("div",{className:"flex gap-1 bg-gray-100 rounded p-1 mb-3",children:[t.jsx("button",{onClick:()=>Is("chat"),className:"flex-1 py-2 px-3 rounded text-xs font-medium "+("chat"===$s?"bg-green-600 text-white":"text-gray-600 hover:text-gray-900"),children:t.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[t.jsx(h,{size:14}),"Chat"]})}),t.jsx("button",{onClick:()=>Is("contacts"),className:"flex-1 py-2 px-3 rounded text-xs font-medium "+("contacts"===$s?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"),children:t.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[t.jsx(p,{size:14}),"Contacts"]})})]}),t.jsxs("div",{className:"relative",children:[t.jsx(j,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400",size:14}),t.jsx("input",{type:"text",placeholder:"Search customers...",value:se,onChange:e=>te(e.target.value),className:"w-full pl-8 pr-3 py-1.5 border border-gray-300 rounded text-xs focus:border-green-500 focus:outline-none"})]}),t.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-500",children:[t.jsxs("span",{children:[ae.length," customers"]}),t.jsxs("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded text-xs",children:[(null==(D=null==R?void 0:R.filter(e=>"connected"===e.status))?void 0:D.length)||0," Connected"]})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:"chat"===$s?t.jsxs("div",{className:"p-3 text-center text-gray-500",children:[t.jsx("div",{className:"w-12 h-12 bg-green-100 rounded flex items-center justify-center mx-auto mb-3",children:t.jsx(h,{size:24,className:"text-green-600"})}),t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"Recent Chats"}),t.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Your conversations will appear here"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"p-2 bg-white rounded border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded flex items-center justify-center text-white font-medium text-xs",children:"A"}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("h4",{className:"font-medium text-gray-900 text-xs",children:"Abdalah"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Hello! How can I help you?"})]}),t.jsx("div",{className:"text-xs text-gray-400",children:"2m"})]})}),t.jsx("div",{className:"p-2 bg-white rounded border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded flex items-center justify-center text-white font-medium text-xs",children:"S"}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("h4",{className:"font-medium text-gray-900 text-xs",children:"Sarah"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Thank you for your help!"})]}),t.jsx("div",{className:"text-xs text-gray-400",children:"1h"})]})})]})]}):t.jsx(t.Fragment,{children:0===ae.length?t.jsxs("div",{className:"p-3 text-center text-gray-500",children:[t.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center mx-auto mb-2",children:t.jsx(p,{size:16,className:"text-gray-400"})}),t.jsx("p",{className:"text-xs font-medium",children:"No customers found"}),t.jsx("p",{className:"text-xs mt-1",children:"Try adjusting your search"})]}):t.jsx("div",{className:"divide-y divide-gray-200",children:ae.map(e=>{var s,a;return t.jsx("button",{onClick:()=>(e=>{K(e),X(""),oe([])})(e),className:"w-full p-2 text-left hover:bg-gray-100 "+((null==Q?void 0:Q.id)===e.id?"bg-green-50 border-l-2 border-green-600":""),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 rounded flex items-center justify-center text-white font-medium text-xs "+((null==Q?void 0:Q.id)===e.id?"bg-green-600":"bg-blue-600"),children:(null==(a=null==(s=e.name)?void 0:s.charAt(0))?void 0:a.toUpperCase())||"C"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-medium text-gray-900 truncate text-xs",children:e.name||"Unknown Customer"}),t.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.phone||e.email||"No contact"})]}),t.jsx(g,{size:14,className:"text-gray-400"})]})},e.id)})})})})]}),t.jsx("div",{className:"flex-1 flex flex-col bg-white h-full min-h-0",children:Q?t.jsxs(t.Fragment,{children:[V&&t.jsx("div",{className:"bg-blue-50 p-2 border-b border-blue-200 flex-shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full "+("connected"===V.status?"bg-green-500":"connecting"===V.status?"bg-yellow-500":"bg-red-500")}),t.jsxs("span",{className:"text-xs font-medium text-blue-800",children:["Using: ",V.instance_name||V.instance_id]}),t.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs "+("connected"===V.status?"bg-green-100 text-green-700":"connecting"===V.status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:V.status})]}),V.phone_number&&t.jsxs("span",{className:"text-xs text-blue-600",children:["+",V.phone_number]})]})}),t.jsxs("div",{className:"bg-gray-50 p-3 border-b border-gray-300 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-green-600 rounded flex items-center justify-center text-white font-medium text-sm",children:(null==(U=null==(W=Q.name)?void 0:W.charAt(0))?void 0:U.toUpperCase())||"C"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:Q.name||"Unknown Customer"}),t.jsx("p",{className:"text-xs text-gray-500",children:Q.phone||Q.email})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>bs(!gs),className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-200 rounded",title:"Search",children:t.jsx(j,{size:16})}),t.jsx("button",{onClick:()=>{V?vs(!0):n.error("Please select a WhatsApp instance first")},className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-200 rounded",title:"Settings",children:t.jsx(f,{size:16})}),t.jsx("button",{className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-200 rounded",title:"More",children:t.jsx(v,{size:16})})]})]}),gs&&t.jsxs("div",{className:"mt-2 relative",children:[t.jsx(j,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400",size:14}),t.jsx("input",{type:"text",placeholder:"Search in chat...",value:xs,onChange:e=>us(e.target.value),className:"w-full pl-8 pr-8 py-1.5 border border-gray-300 rounded text-xs focus:border-green-500 focus:outline-none"}),xs&&t.jsx("button",{onClick:()=>us(""),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-0.5 text-gray-400 hover:text-gray-600",children:t.jsx(y,{size:14})})]})]}),t.jsx("div",{className:"flex-1 bg-gray-100 p-3 overflow-y-auto min-h-0",children:0===ie.length?t.jsxs("div",{className:"text-center py-4",children:[t.jsx("div",{className:"w-12 h-12 bg-white rounded flex items-center justify-center mx-auto mb-2 border border-gray-200",children:t.jsx(h,{size:20,className:"text-green-600"})}),t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"Start a conversation"}),t.jsxs("p",{className:"text-gray-600 text-xs",children:["Send your first message to ",Q.name]})]}):t.jsxs("div",{className:"space-y-2",children:[(xs?ms:ie).map((e,s)=>t.jsxs("div",{children:[Rs(e,ie[s-1])&&t.jsx("div",{className:"flex justify-center my-2",children:t.jsx("div",{className:"bg-white text-gray-600 px-2 py-1 rounded text-xs border border-gray-200",children:Os(e.timestamp)})}),t.jsx("div",{className:"flex "+("business"===e.sender?"justify-end":"justify-start"),children:t.jsx("div",{className:"relative group",children:t.jsxs("div",{className:"max-w-xs lg:max-w-md px-3 py-2 rounded "+("business"===e.sender?"bg-green-600 text-white":"bg-white text-gray-900 border border-gray-300"),children:["image"===e.type&&e.imageUrl&&t.jsx("div",{className:"mb-1",children:t.jsx("img",{src:e.imageUrl,alt:"Shared image",className:"w-full h-32 object-cover rounded"})}),"document"===e.type&&e.fileName&&t.jsx("div",{className:"mb-1 p-2 bg-black/10 rounded",children:t.jsxs("div",{className:"flex items-center gap-2",children:[Fs(e.fileName),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-xs font-medium truncate",children:e.fileName}),t.jsx("p",{className:"text-xs opacity-80",children:Ts(e.fileSize||0)})]}),t.jsx("button",{className:"p-1 hover:bg-black/10 rounded",children:t.jsx(N,{size:14})})]})}),"audio"===e.type&&e.audioUrl&&t.jsx("div",{className:"mb-1 p-2 bg-black/10 rounded",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-6 h-6 bg-black/10 rounded flex items-center justify-center",children:t.jsx(w,{size:12})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-xs font-medium",children:"Voice Message"}),t.jsx("p",{className:"text-xs opacity-80",children:e.audioDuration})]}),t.jsx("button",{className:"p-1 bg-black/10 rounded hover:bg-black/20",children:t.jsx(k,{size:12})})]})}),t.jsx("p",{className:"text-xs",children:e.content}),"button"===e.type&&e.buttons&&t.jsxs("div",{className:"mt-1 space-y-1",children:[e.buttons.map((e,s)=>t.jsx("div",{className:"p-1.5 bg-black/10 rounded border border-white/20 text-center",children:t.jsx("span",{className:"text-xs font-medium",children:e.text})},s)),e.buttonFooter&&t.jsx("p",{className:"text-xs opacity-80 mt-0.5",children:e.buttonFooter})]}),t.jsxs("div",{className:"flex items-center justify-between mt-1 "+("business"===e.sender?"text-white/70":"text-gray-500"),children:[t.jsx("span",{className:"text-xs",children:Os(e.timestamp)}),"business"===e.sender&&t.jsx("div",{className:"flex items-center gap-0.5",children:Vs(ps[e.id]||"sent")})]})]})})})]},e.id)),ce&&t.jsx("div",{className:"flex justify-start",children:t.jsx("div",{className:"bg-white text-gray-900 border border-gray-300 px-3 py-2 rounded",children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),t.jsx("span",{className:"text-xs text-gray-500",children:"typing..."})]})})})]})}),t.jsxs("div",{className:"bg-white p-3 border-t border-gray-300 flex-shrink-0",children:[fe&&t.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Image"}),t.jsx("button",{onClick:()=>{je(null),ve(null),Ne("text")},className:"p-0.5 text-gray-400 hover:text-red-500",children:t.jsx(y,{size:12})})]}),t.jsx("img",{src:fe,alt:"Preview",className:"w-full h-20 object-cover rounded"})]}),ss&&Ze&&t.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"File"}),t.jsx("button",{onClick:()=>{es(null),ts(null),Ne("text")},className:"p-0.5 text-gray-400 hover:text-red-500",children:t.jsx(y,{size:12})})]}),t.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-white rounded",children:[Fs(Ze.name),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-xs font-medium text-gray-900 truncate",children:Ze.name}),t.jsx("p",{className:"text-xs text-gray-500",children:Ts(Ze.size)})]})]})]}),cs&&is&&t.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Voice"}),t.jsx("button",{onClick:()=>{os(null),ds(null),ls(0),Ne("text")},className:"p-0.5 text-gray-400 hover:text-red-500",children:t.jsx(y,{size:12})})]}),t.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-white rounded",children:[t.jsx("div",{className:"w-8 h-8 bg-red-600 rounded flex items-center justify-center",children:t.jsx(w,{size:14,className:"text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-xs font-medium text-gray-900",children:"Voice Message"}),t.jsx("p",{className:"text-xs text-gray-500",children:Hs(ns)})]}),t.jsx("button",{className:"p-1.5 bg-green-600 text-white rounded hover:bg-green-700",children:t.jsx(k,{size:12})})]})]}),Re&&t.jsxs("div",{className:"mb-3 p-3 bg-blue-50 rounded border border-blue-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Interactive Buttons"}),t.jsx("span",{className:"px-1.5 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded",children:"âš ï¸ May not work"})]}),t.jsx("button",{onClick:()=>{Pe(!1),Ne("text")},className:"p-1 text-gray-400 hover:text-gray-600",children:t.jsx(y,{size:14})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Message Text"}),t.jsx("textarea",{value:Ve,onChange:e=>Ye(e.target.value),placeholder:"Enter message...",className:"w-full px-2 py-1.5 border border-gray-300 rounded text-xs focus:border-blue-500 focus:outline-none resize-none",rows:2})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Buttons"}),t.jsxs("div",{className:"space-y-1",children:[Qe.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"text",value:e.text,onChange:e=>{const t=[...Qe];t[s].text=e.target.value,Ke(t)},placeholder:`Button ${s+1}`,className:"flex-1 px-2 py-1 border border-gray-300 rounded text-xs focus:border-blue-500 focus:outline-none"}),t.jsx("button",{onClick:()=>{Ke(e=>e.filter((e,t)=>t!==s))},className:"p-1 text-red-500 hover:bg-red-50 rounded",disabled:1===Qe.length,children:t.jsx(y,{size:12})})]},s)),Qe.length<3&&t.jsx("button",{onClick:()=>{Ke(e=>[...e,{id:`btn${e.length+1}`,text:`Button ${e.length+1}`}])},className:"w-full py-1 border border-dashed border-blue-300 text-blue-600 rounded hover:bg-blue-50 text-xs",children:"+ Add Button"})]})]})]})]}),ge&&t.jsxs("div",{className:"mb-3 bg-white rounded border border-gray-300 overflow-hidden",children:[t.jsxs("div",{className:"bg-purple-600 p-2 text-white flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(h,{size:14}),t.jsx("h3",{className:"font-medium text-sm",children:"Quick Replies"})]}),t.jsx("button",{onClick:()=>be(!1),className:"p-0.5 hover:bg-white/20 rounded",children:t.jsx(y,{size:14})})]}),t.jsx("div",{className:"bg-gray-100 p-2 border-b border-gray-300",children:t.jsx("div",{className:"flex gap-1 overflow-x-auto",children:["Frequently Used","Recent","Favorites","Greetings","Customer Service"].map(e=>t.jsx("button",{onClick:()=>ke(e),className:"px-2 py-1 rounded text-xs font-medium whitespace-nowrap "+(we===e?"bg-purple-600 text-white":"bg-white text-gray-600 hover:bg-gray-200 border border-gray-300"),children:e},e))})}),t.jsx("div",{className:"p-2 max-h-60 overflow-y-auto",children:As().length>0?t.jsx("div",{className:"space-y-1",children:As().map((e,s)=>t.jsxs("div",{className:"bg-gray-50 rounded p-2 hover:bg-purple-50 border border-gray-200",children:[t.jsx("p",{className:"text-xs text-gray-800 mb-1 line-clamp-2",children:e}),t.jsx("button",{onClick:()=>(e=>{X(e),be(!1),Me(s=>{const t=s.filter(s=>s!==e);return[e,...t.slice(0,4)]})})(e),className:"px-2 py-0.5 bg-purple-600 text-white rounded text-xs hover:bg-purple-700",children:"Send"})]},s))}):t.jsx("div",{className:"text-center py-4",children:t.jsx("p",{className:"text-gray-500 text-xs",children:"Favorites"===we?"No favorites":"Recent"===we?"No recent replies":"No replies"})})})]}),me&&t.jsxs("div",{className:"mb-2 p-2 bg-white rounded border border-gray-300",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-800",children:"Add Attachment"}),t.jsx("button",{onClick:()=>he(!1),className:"p-0.5 text-gray-400 hover:text-gray-600",children:t.jsx(y,{size:12})})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[t.jsx("label",{className:"bg-blue-50 rounded p-2 hover:bg-blue-100 cursor-pointer border border-blue-200",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded flex items-center justify-center mb-1",children:t.jsx(C,{size:14,className:"text-white"})}),t.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Image"}),t.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t&&t.type.startsWith("image/")){je(t),Ne("image");const e=new FileReader;e.onload=e=>{var s;ve(null==(s=e.target)?void 0:s.result)},e.readAsDataURL(t)}},className:"hidden"})]})}),t.jsx("label",{className:"bg-purple-50 rounded p-2 hover:bg-purple-100 cursor-pointer border border-purple-200",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded flex items-center justify-center mb-1",children:t.jsx(S,{size:14,className:"text-white"})}),t.jsx("span",{className:"text-xs font-medium text-purple-700",children:"File"}),t.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt",onChange:e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t){es(t),Ne("document");const e=new FileReader;e.onload=e=>{var s;ts(null==(s=e.target)?void 0:s.result)},e.readAsDataURL(t)}},className:"hidden"})]})}),t.jsx("button",{onClick:as?()=>{const e=window.mediaRecorder,s=window.recordingTimer;e&&e.stop(),s&&clearInterval(s),rs(!1)}:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(e),t=[];s.ondataavailable=e=>{t.push(e.data)},s.onstop=()=>{const s=new Blob(t,{type:"audio/wav"});os(s),ds(URL.createObjectURL(s)),Ne("audio"),e.getTracks().forEach(e=>e.stop())},s.start(),rs(!0),ls(0);const a=setInterval(()=>{ls(e=>e+1)},1e3);window.mediaRecorder=s,window.recordingTimer=a}catch(e){n.error("Could not access microphone")}},className:"bg-red-50 rounded p-2 hover:bg-red-100 border border-red-200 "+(as?"animate-pulse":""),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"w-8 h-8 bg-red-600 rounded flex items-center justify-center mb-1",children:t.jsx(z,{size:14,className:"text-white"})}),t.jsx("span",{className:"text-xs font-medium text-red-700",children:as?"Stop":"Voice"})]})})]})]}),xe&&t.jsxs("div",{className:"mb-2 p-2 bg-white rounded border border-gray-300",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-800",children:"Emoji"}),t.jsx("button",{onClick:()=>ue(!1),className:"p-0.5 text-gray-400 hover:text-gray-600",children:t.jsx(y,{size:12})})]}),t.jsx("div",{className:"grid grid-cols-8 gap-1 max-h-40 overflow-y-auto",children:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ˜","ðŸ˜’","ðŸ˜ž","ðŸ˜”","ðŸ˜Ÿ","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜©","ðŸ¥º","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ¤¯","ðŸ˜³","ðŸ¥µ","ðŸ¥¶","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¥","ðŸ˜“","ðŸ¤—","ðŸ¤”","ðŸ¤­","ðŸ¤«","ðŸ¤¥","ðŸ˜¶","ðŸ˜","ðŸ˜‘","ðŸ˜¯","ðŸ˜¦","ðŸ˜§","ðŸ˜®","ðŸ˜²","ðŸ¥±","ðŸ˜´","ðŸ¤¤","ðŸ˜ª","ðŸ˜µ","ðŸ¤","ðŸ¥´","ðŸ¤¢","ðŸ¤®","ðŸ¤§","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤‘","ðŸ¤ ","ðŸ’©","ðŸ‘»","ðŸ’€","â˜ ï¸","ðŸ‘½","ðŸ‘¾","ðŸ¤–","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ‘¶","ðŸ‘§","ðŸ§’","ðŸ‘¦","ðŸ‘©","ðŸ§‘","ðŸ‘¨","ðŸ‘µ","ðŸ§“","ðŸ‘´","ðŸ‘®â€â™€ï¸","ðŸ‘®","ðŸ‘®â€â™‚ï¸","ðŸ•µï¸â€â™€ï¸","ðŸ•µï¸","ðŸ•µï¸â€â™‚ï¸","ðŸ’‚â€â™€ï¸","ðŸ’‚","ðŸ’‚â€â™‚ï¸","ðŸ‘·â€â™€ï¸","ðŸ‘·","ðŸ‘·â€â™‚ï¸","ðŸ¤´","ðŸ‘¸","ðŸ‘³â€â™€ï¸","ðŸ‘³","ðŸ‘³â€â™‚ï¸","ðŸ‘²","ðŸ§•","ðŸ¤µâ€â™€ï¸","ðŸ¤µ","ðŸ¤µâ€â™‚ï¸","ðŸ‘°â€â™€ï¸","ðŸ‘°","ðŸ‘°â€â™‚ï¸","ðŸ¤°","ðŸ¤±","ðŸ‘¼","ðŸŽ…","ðŸ¤¶","ðŸ§™â€â™€ï¸","ðŸ§™","ðŸ§™â€â™‚ï¸","ðŸ§â€â™€ï¸","ðŸ§","ðŸ§â€â™‚ï¸","ðŸ§›â€â™€ï¸","ðŸ§›","ðŸ§›â€â™‚ï¸","ðŸ§Ÿâ€â™€ï¸","ðŸ§Ÿ","ðŸ§Ÿâ€â™‚ï¸","ðŸ§žâ€â™€ï¸","ðŸ§ž","ðŸ§žâ€â™‚ï¸","ðŸ§œâ€â™€ï¸","ðŸ§œ","ðŸ§œâ€â™‚ï¸","ðŸ§šâ€â™€ï¸","ðŸ§š","ðŸ§šâ€â™‚ï¸","ðŸ‘¼","ðŸ¤°","ðŸ¤±","ðŸ‘¼","ðŸŽ…","ðŸ¤¶","ðŸ§™â€â™€ï¸","ðŸ§™","ðŸ§™â€â™‚ï¸","ðŸ§â€â™€ï¸","ðŸ§","ðŸ§â€â™‚ï¸","ðŸ§›â€â™€ï¸","ðŸ§›","ðŸ§›â€â™‚ï¸","ðŸ§Ÿâ€â™€ï¸","ðŸ§Ÿ","ðŸ§Ÿâ€â™‚ï¸","ðŸ§žâ€â™€ï¸","ðŸ§ž","ðŸ§žâ€â™‚ï¸","ðŸ§œâ€â™€ï¸","ðŸ§œ","ðŸ§œâ€â™‚ï¸","ðŸ§šâ€â™€ï¸","ðŸ§š","ðŸ§šâ€â™‚ï¸"].slice(0,56).map((e,s)=>t.jsx("button",{onClick:()=>(e=>{X(s=>s+e),ue(!1)})(e),className:"p-1 text-base hover:bg-gray-100 rounded",children:e},s))})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>he(!me),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded",children:t.jsx(M,{size:16})}),t.jsx("button",{onClick:()=>be(!ge),className:"p-2 rounded "+(ge?"bg-purple-600 text-white":"text-purple-600 hover:bg-purple-50"),children:t.jsx(h,{size:16})}),t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("input",{type:"text",value:J,onChange:e=>{return s=e.target.value,X(s),de(!0),clearTimeout(window.typingTimeout),void(window.typingTimeout=setTimeout(()=>{de(!1)},2e3));var s},onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&Ys(),placeholder:`Message ${Q.name}...`,className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded text-xs focus:border-green-500 focus:outline-none"}),t.jsx("button",{onClick:()=>ue(!xe),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:t.jsx(L,{size:14})})]}),t.jsx("button",{onClick:Ys,disabled:"text"===ye&&!J.trim()||"button"===ye&&(!Ve.trim()||0===Qe.length)||"image"===ye&&!pe||"document"===ye&&!Ze||"audio"===ye&&!is||ne,className:"p-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:ne?t.jsx(b,{size:16,className:"animate-spin"}):t.jsx($,{size:16})})]})]})]}):t.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-100",children:t.jsxs("div",{className:"text-center max-w-md",children:[t.jsx("div",{className:"w-16 h-16 bg-green-600 rounded flex items-center justify-center mx-auto mb-3",children:t.jsx(h,{size:32,className:"text-white"})}),t.jsx("h3",{className:"text-base font-medium text-gray-900 mb-2",children:"Select a customer"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Choose a customer from the list to start chatting"})]})})})]}),Le&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[t.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 p-6 text-white",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:t.jsx(h,{size:24})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Quick Reply Manager"}),t.jsx("p",{className:"text-purple-100",children:"Create, edit, and organize your quick replies"})]})]}),t.jsx("button",{onClick:()=>$e(!1),className:"p-3 hover:bg-white/20 rounded-full transition-all duration-200",children:t.jsx(y,{size:24})})]})}),t.jsxs("div",{className:"flex h-[calc(90vh-120px)]",children:[t.jsxs("div",{className:"w-80 bg-gray-50 border-r border-gray-200 p-4 overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"font-semibold text-gray-800",children:"Categories"}),t.jsx("button",{onClick:()=>De(!0),className:"p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Manage Categories",children:t.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),t.jsx("div",{className:"space-y-2",children:Object.keys(Ls).map(e=>{var s;return t.jsxs("div",{className:"group relative rounded-xl transition-all duration-200 "+(we===e?"bg-purple-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"),children:[t.jsx("button",{onClick:()=>ke(e),className:"w-full text-left p-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium",children:e}),t.jsx("span",{className:"text-sm opacity-70",children:(null==(s=Ls[e])?void 0:s.length)||0})]})}),t.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:s=>{s.stopPropagation(),Ue({oldName:e,newName:e})},className:"p-1 text-blue-500 hover:bg-blue-50 rounded transition-colors",title:"Rename",children:t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),t.jsx("button",{onClick:s=>{s.stopPropagation(),Us(e)},className:"p-1 text-green-500 hover:bg-green-50 rounded transition-colors",title:"Duplicate",children:t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),Object.keys(Ls).length>1&&t.jsx("button",{onClick:s=>{s.stopPropagation(),confirm(`Are you sure you want to delete the category "${e}"?`)&&Ws(e)},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",title:"Delete",children:t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},e)})})]}),t.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[t.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6",children:[t.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Add New Quick Reply"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),t.jsx("select",{value:Fe,onChange:e=>Ae(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-1 transition-all duration-200",children:Object.keys(Ls).map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),t.jsx("textarea",{value:Ee,onChange:e=>Te(e.target.value),placeholder:"Enter your quick reply message...",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-1 transition-all duration-200 resize-none",rows:3})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>((e,s)=>{if(e.trim()){const t={...Ls};t[s]||(t[s]=[]),t[s]=[...t[s],e.trim()],Object.assign(Ls,t),Te(""),Ae("Frequently Used"),n.success("Quick reply added successfully!")}})(Ee,Fe),disabled:!Ee.trim(),className:"px-6 py-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl font-medium hover:from-purple-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:"Add Reply"})})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("h3",{className:"font-semibold text-gray-800",children:[we," (",(null==(H=Ls[we])?void 0:H.length)||0," replies)"]})}),t.jsxs("div",{className:"space-y-3",children:[null==(O=Ls[we])?void 0:O.map((e,s)=>t.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 hover:shadow-lg transition-all duration-200",children:(null==Ie?void 0:Ie.index)===s&&(null==Ie?void 0:Ie.category)===we?t.jsxs("div",{className:"space-y-3",children:[t.jsx("textarea",{value:Ie.text,onChange:e=>_e({...Ie,text:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-1 resize-none",rows:2}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>((e,s,t)=>{if(s.trim()){const a={...Ls};a[t]&&(a[t][e]=s.trim(),Object.assign(Ls,a),_e(null),n.success("Quick reply updated!"))}})(s,Ie.text,we),className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm",children:"Save"}),t.jsx("button",{onClick:()=>_e(null),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm",children:"Cancel"})]})]}):t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsx("div",{className:"flex-1",children:t.jsx("p",{className:"text-gray-800 leading-relaxed",children:e})}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsx("button",{onClick:()=>_e({index:s,text:e,category:we}),className:"p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),t.jsx("div",{className:"relative",children:t.jsx("button",{onClick:()=>{const e=prompt("Move to category:",we);e&&e!==we&&((e,s,t)=>{const a={...Ls},r=a[e][s];a[e]=a[e].filter((e,t)=>t!==s),a[t]||(a[t]=[]),a[t].push(r),Object.assign(Ls,a),n.success(`Moved to ${t}!`)})(we,s,e)},className:"p-2 text-green-500 hover:bg-green-50 rounded-lg transition-colors",title:"Move",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})}),t.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this quick reply?")&&((e,s)=>{const t={...Ls};t[s]&&(t[s]=t[s].filter((s,t)=>t!==e),Object.assign(Ls,t),n.success("Quick reply deleted!"))})(s,we)},className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},s)),(!Ls[we]||0===Ls[we].length)&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3",children:t.jsx(h,{size:24,className:"text-gray-400"})}),t.jsx("p",{className:"text-gray-500",children:"No replies in this category yet."}),t.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Add a new reply above to get started!"})]})]})]})]})]})]})}),Be&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[t.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-6 text-white",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Category Manager"}),t.jsx("p",{className:"text-blue-100",children:"Create, edit, and organize your categories"})]})]}),t.jsx("button",{onClick:()=>De(!1),className:"p-3 hover:bg-white/20 rounded-full transition-all duration-200",children:t.jsx(y,{size:24})})]})}),t.jsxs("div",{className:"p-6 max-h-[calc(80vh-120px)] overflow-y-auto",children:[t.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6",children:[t.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Add New Category"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("input",{type:"text",value:He,onChange:e=>Oe(e.target.value),placeholder:"Enter category name...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition-all duration-200",onKeyPress:e=>"Enter"===e.key&&Bs(He)}),t.jsx("button",{onClick:()=>Bs(He),disabled:!He.trim(),className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:"Add"})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4",children:["Categories (",Object.keys(Ls).length,")"]}),t.jsx("div",{className:"space-y-3",children:Object.keys(Ls).map(e=>{var s;return t.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 hover:shadow-lg transition-all duration-200",children:(null==We?void 0:We.oldName)===e?t.jsxs("div",{className:"space-y-3",children:[t.jsx("input",{type:"text",value:We.newName,onChange:e=>Ue({...We,newName:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition-all duration-200",onKeyPress:s=>"Enter"===s.key&&Ds(e,We.newName)}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>Ds(e,We.newName),className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm",children:"Save"}),t.jsx("button",{onClick:()=>Ue(null),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm",children:"Cancel"})]})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium text-gray-800",children:e}),t.jsxs("p",{className:"text-sm text-gray-500",children:[(null==(s=Ls[e])?void 0:s.length)||0," replies"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>Ue({oldName:e,newName:e}),className:"p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Rename",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),t.jsx("button",{onClick:()=>Us(e),className:"p-2 text-green-500 hover:bg-green-50 rounded-lg transition-colors",title:"Duplicate",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),Object.keys(Ls).length>1&&t.jsx("button",{onClick:()=>{confirm(`Are you sure you want to delete the category "${e}"?`)&&Ws(e)},className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e)})})]})]})]})}),fs&&V&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsx("div",{className:"relative bg-gradient-to-r from-green-500 to-green-600 px-8 py-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:t.jsx(f,{size:24,className:"text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Green API Settings"}),t.jsxs("p",{className:"text-green-100 mt-1",children:["Configure ",V.instance_name||V.instance_id]})]})]}),t.jsx("button",{onClick:()=>vs(!1),className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-xl transition-all duration-200",children:t.jsx(I,{size:24})})]})}),t.jsx("div",{className:"border-b border-gray-200 bg-gray-50",children:t.jsx("div",{className:"flex overflow-x-auto",children:[{id:"general",label:"General",icon:f},{id:"webhooks",label:"Webhooks",icon:h},{id:"messages",label:"Messages",icon:$},{id:"notifications",label:"Notifications",icon:h},{id:"security",label:"Security",icon:h},{id:"status",label:"Status",icon:h}].map(e=>t.jsxs("button",{onClick:()=>Ms(e.id),className:"flex items-center gap-2 px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors "+(zs===e.id?"border-green-500 text-green-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[t.jsx(e.icon,{size:16}),e.label]},e.id))})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:ws?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-center",children:[t.jsx(b,{className:"animate-spin mx-auto h-8 w-8 text-green-500 mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading settings..."})]})}):t.jsxs(t.Fragment,{children:["general"===zs&&t.jsx(i,{settings:ys,setSettings:Ns}),"webhooks"===zs&&t.jsx(o,{settings:ys,setSettings:Ns}),"messages"===zs&&t.jsx(c,{settings:ys,setSettings:Ns}),"notifications"===zs&&t.jsx(d,{settings:ys,setSettings:Ns}),"security"===zs&&t.jsx(x,{settings:ys,setSettings:Ns}),"status"===zs&&t.jsx(u,{settings:ys,setSettings:Ns})]})}),t.jsxs("div",{className:"px-8 py-6 bg-gray-50 border-t border-gray-200 flex justify-end gap-4",children:[t.jsx("button",{onClick:()=>vs(!1),className:"px-6 py-3 border border-gray-300 rounded-xl text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(V)try{Ss(!0);const e=l.validateSettings(ys);if(!e.isValid)return void n.error(`Invalid settings: ${e.errors.join(", ")}`);await l.setSettings(V.instance_id,V.api_token,ys),await l.saveSettingsToDatabase(V.instance_id,ys),n.success("âœ… Settings saved successfully!"),vs(!1)}catch(e){n.error(`Failed to save settings: ${e.message}`)}finally{Ss(!1)}},disabled:Cs,className:"px-8 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-medium hover:from-green-600 hover:to-green-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:Cs?t.jsxs(t.Fragment,{children:[t.jsx(b,{size:18,className:"animate-spin"}),"Saving..."]}):t.jsxs(t.Fragment,{children:[t.jsx(_,{size:18}),"Save Settings"]})})]})]})})]})};export{B as default};
