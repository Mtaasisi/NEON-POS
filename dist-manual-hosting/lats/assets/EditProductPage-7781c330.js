import{u as e,j as t,s,d as a,G as r,a5 as i,aA as n}from"./index-222cfb29.js";import{R as o,r as c}from"./vendor-a2ff445a.js";import{B as l}from"./BackButton-e41d1482.js";import{n as d,A as u,i as m,N as x,l as p,X as g,Q as h,az as b,a5 as f}from"./ui-551a39a6.js";import{s as y,g as v,a as j}from"./specificationCategories-9f98df80.js";import{g as N}from"./skuUtils-6fbbef44.js";import{c as k}from"./productUtils-6e390a72.js";import{P as w}from"./ProductInformationForm-61fc6c83.js";import{P as S}from"./PricingAndStockForm-1324ba4c.js";import{P as _,S as C,a as P}from"./ProductModal-44d6d29a.js";import{u as I,S as O}from"./useSuccessModal-e8b7d685.js";import{d as q,a as V}from"./routing-a2f0f6d2.js";import{o as Q,s as L,e as z,n as E,g as $,h as A,a as R,Z as D}from"./forms-fd94c8fb.js";import"./supabase-7e851d02.js";import"./CategoryInput-bba1731d.js";import"./specificationUtils-8355804c.js";import"./PriceInput-e1556d5b.js";import"./format-0f0b2647.js";import"./robustImageService-2422a1f9.js";import"./CircularProgress-471d8e37.js";import"./variantUtils-422e46bb.js";import"./usePurchaseOrderHistory-baa7ee96.js";import"./productCalculations-9e8647a1.js";import"./zod-4c7d126c.js";import"./GlassInput-ba5c3c0d.js";import"./utils-fb833cf6.js";import"./charts-66cc82bb.js";import"./GlassSelect-3b56e5f5.js";import"./GlassBadge-18f019e2.js";import"./useBodyScrollLock-0216d39f.js";import"./storeShelfApi-d8b142f6.js";const F=Q({name:L().min(1,"Product name must be provided").max(100,"Product name must be less than 100 characters"),description:L().max(200,"Description must be less than 200 characters").optional(),specification:L().max(1e3,"Specification must be less than 1000 characters").optional().refine(e=>{if(!e)return!0;try{return JSON.parse(e),!0}catch{return!1}},{message:"Specification must be valid JSON"}),sku:L().min(1,"SKU must be provided").max(50,"SKU must be less than 50 characters"),categoryId:L().min(1,"Category must be selected - Please choose one from the dropdown"),condition:z(["new","used","refurbished"],{errorMap:()=>({message:"Please select a condition"})}),price:E().min(0,"Price must be 0 or greater"),costPrice:E().min(0,"Cost price must be 0 or greater"),stockQuantity:E().min(0,"Stock quantity must be 0 or greater"),minStockLevel:E().min(0,"Minimum stock level must be 0 or greater"),storageRoomId:L().optional(),shelfId:L().optional(),metadata:$(L(),A()).optional().default({}),variants:R(A()).optional().default([])}),J=()=>{try{return e(),t.jsx(U,{})}catch(s){return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading authentication..."})]})})}},U=()=>{var e,Q,L,z,E;const $=o.useRef(0);$.current+=1;const{productId:A}=q(),R=V(),J=I();$.current;const[U,G]=c.useState([]),[B,T]=c.useState({}),[K,M]=c.useState({name:"",sku:"",categoryId:"",condition:"new",description:"",specification:"",price:0,costPrice:0,stockQuantity:0,minStockLevel:2,storageRoomId:"",shelfId:"",metadata:{},variants:[]}),H=o.useRef();c.useEffect(()=>{if(H.current!==K.categoryId){if(K.categoryId){U.find(e=>e.id===K.categoryId)}H.current=K.categoryId}},[K.categoryId,U]);const[Z,W]=c.useState(!1),[X,Y]=c.useState(!0),[ee,te]=c.useState(!1),[se,ae]=c.useState(null),[re,ie]=c.useState([]),[ne,oe]=c.useState(!1),[ce,le]=c.useState(!1),[de,ue]=c.useState(!1),[me,xe]=c.useState(!1),[pe,ge]=c.useState(null),[he,be]=c.useState(!1),[fe,ye]=c.useState(null),[ve,je]=c.useState(null),[Ne,ke]=c.useState(""),[we,Se]=c.useState("laptop"),[_e,Ce]=c.useState(!1),[Pe,Ie]=c.useState(!1),[Oe,qe]=c.useState(""),[Ve,Qe]=c.useState("laptop"),[Le,ze]=c.useState(!1),[Ee,$e]=c.useState(!1),[Ae,Re]=c.useState(""),De=(e,t,s)=>{const a={...re[e].attributes,[t]:s};Me(e,"attributes",a)},Fe=(e,t)=>{const s={...K.specification?JSON.parse(K.specification):{},[e]:t};M(e=>({...e,specification:JSON.stringify(s)}))},Je=()=>({name:"Variant 1",sku:`${K.sku}-V01`,costPrice:K.costPrice,price:K.price,stockQuantity:K.stockQuantity,minStockLevel:K.minStockLevel,specification:K.specification,attributes:{specification:K.specification||null}}),Ue=o.useRef(!0),Ge=o.useRef({costPrice:K.costPrice,price:K.price,stockQuantity:K.stockQuantity,minStockLevel:K.minStockLevel,specification:K.specification});c.useEffect(()=>{if(Ue.current)return Ue.current=!1,void(Ge.current={costPrice:K.costPrice,price:K.price,stockQuantity:K.stockQuantity,minStockLevel:K.minStockLevel,specification:K.specification});const e=Ge.current.costPrice!==K.costPrice||Ge.current.price!==K.price||Ge.current.stockQuantity!==K.stockQuantity||Ge.current.minStockLevel!==K.minStockLevel||Ge.current.specification!==K.specification;if(ce&&re.length>0&&e){const e=Je();ie(t=>t.map((t,s)=>0===s?{...t,...e}:t)),Ge.current={costPrice:K.costPrice,price:K.price,stockQuantity:K.stockQuantity,minStockLevel:K.minStockLevel,specification:K.specification}}},[K.costPrice,K.price,K.stockQuantity,K.minStockLevel,K.specification,ce,re.length]);const Be=async e=>{if(e.trim())if(Ae&&e.trim()===Ae.trim())$e(!1);else{ze(!0);try{const{data:t,error:a}=await s.from("lats_products").select("id").ilike("name",`%${e.trim()}%`).neq("id",A||"").limit(1);if(a)throw a;$e(t&&t.length>0)}catch(t){}finally{ze(!1)}}else $e(!1)},Te=c.useCallback(async()=>{var e;if(A)if(s){Y(!0);try{let t=null;const{data:a,error:r}=await s.from("lats_products").select("*").eq("id",A).single();if(r)throw r;if(!a)return void d.error(`Product with ID ${A} not found`);const{data:i,error:n}=await s.from("lats_product_variants").select("*").eq("product_id",A);if(t=n?a?{...a,variants:[]}:null:a?{...a,variants:i||[]}:null,t){Re(t.name||"");const s={name:t.name||"",description:t.description||"",specification:(()=>{try{if(t.specification){if("string"==typeof t.specification)return JSON.parse(t.specification),t.specification;if("object"==typeof t.specification)return JSON.stringify(t.specification)}return""}catch{return""}})(),sku:t.sku||t.barcode||N(),categoryId:t.category_id||"",condition:t.condition||"new",price:t.selling_price||0,costPrice:t.cost_price||0,stockQuantity:t.stock_quantity||0,minStockLevel:t.min_stock_level||0,storageRoomId:t.storage_room_id||"",shelfId:t.shelf_id||"",metadata:t.attributes||{},variants:[]};if(s.categoryId&&U.length>0){U.find(e=>e.id===s.categoryId)}else s.categoryId;M(s);const a=!0===(null==(e=t.metadata)?void 0:e.useVariants)||!0===t.has_variants||t.variants&&t.variants.length>1||t.variants&&t.variants.some(e=>e.name||e.variant_name||e.sku&&e.sku!==t.sku||e.attributes&&Object.keys(e.attributes).length>0||e.variant_attributes&&Object.keys(e.variant_attributes).length>0);if(ue(a),t.variants&&t.variants.length>0){const e=t.variants.map((e,t)=>{var s,a;return{name:e.name||e.variant_name||"",sku:e.sku||"",costPrice:e.cost_price||0,price:e.selling_price||0,stockQuantity:e.quantity||0,minStockLevel:e.min_quantity||0,specification:(null==(s=e.attributes)?void 0:s.specification)||(null==(a=e.variant_attributes)?void 0:a.specification)||"",attributes:e.attributes||e.variant_attributes||{}}});ie(e),le(a),oe(a)}else ue(!1),le(!1),oe(!1)}}catch(t){let e="Failed to load product data";"PGRST116"===(null==t?void 0:t.code)?e=`Product with ID "${A}" not found in database`:"PGRST301"===(null==t?void 0:t.code)?e="Database connection error. Please check your internet connection.":(null==t?void 0:t.message)&&(e=`Database error: ${t.message}`),d.error(e)}finally{Y(!1)}}else d.error("Database connection not available");else d.error("No product ID provided")},[A,U]);c.useEffect(()=>{(async()=>{try{const e=await i();G(e||[])}catch(e){d.error("Failed to load form data")}})()},[]),c.useEffect(()=>{A&&U.length>0&&Te()},[A,U.length,Te]),c.useEffect(()=>{(ce||de)&&oe(!0)},[ce,de]),c.useEffect(()=>{const e=setTimeout(()=>{K.name&&Be(K.name)},500);return()=>clearTimeout(e)},[K.name]);const Ke=e=>{if(Ne.trim()){((e,t)=>{const s={...re[e].attributes,[t]:""};Me(e,"attributes",s)})(e,Ne.trim().toLowerCase().replace(/\s+/g,"_")),je(null),ke("")}},Me=(e,t,s)=>{ie(a=>a.map((a,r)=>r===e?{...a,[t]:s}:a))},He=()=>{if(Oe.trim()){((e,t="")=>{const s={...K.specification?JSON.parse(K.specification):{},[e]:t};M(e=>({...e,specification:JSON.stringify(s)}))})(Oe.trim().toLowerCase().replace(/\s+/g,"_")),Ie(!1),qe("")}};return t.jsxs("div",{className:"p-4 sm:p-6 h-full overflow-y-auto pt-8",children:[t.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 sm:space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(l,{to:"/lats/unified-inventory"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Product"}),t.jsx("p",{className:"text-gray-600",children:"Update product information and details"})]})]})}),t.jsx(a,{className:"mb-6",children:X?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading product data..."})]})}):t.jsxs("div",{className:"space-y-6",children:[!X&&!K.categoryId&&t.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg animate-pulse",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx(u,{className:"w-5 h-5 text-yellow-500 mt-0.5 mr-3 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-sm font-medium text-yellow-800 mb-1",children:"âš ï¸ Action Required: Category Missing"}),t.jsx("p",{className:"text-sm text-yellow-700 mb-2",children:"This product doesn't have a category assigned in the database."}),t.jsx("p",{className:"text-sm text-yellow-800 font-medium",children:'ðŸ‘‰ Please scroll down to the "Category" field and select a category before saving.'}),0===U.length&&t.jsx("p",{className:"text-sm text-red-600 mt-2 font-medium",children:"âŒ No categories found! Please refresh the page or contact support."}),U.length>0&&t.jsxs("div",{className:"mt-3 space-y-2",children:[t.jsxs("p",{className:"text-sm text-green-600",children:["âœ… ",U.length," categories available to choose from"]}),t.jsx("button",{onClick:()=>{const e=document.querySelector('[name="categoryId"]')||document.querySelector('select[id*="category"]')||document.querySelector(".category-input");e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.style.border="2px solid #f59e0b",setTimeout(()=>{e.style.border=""},3e3))},className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:"ðŸ“ Jump to Category Field"})]})]})]})}),Object.keys(B).length>0&&t.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx(u,{className:"w-5 h-5 text-red-500 mt-0.5 mr-3 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800 mb-2",children:"Please fix the following errors:"}),t.jsx("ul",{className:"list-disc list-inside text-sm text-red-700 space-y-1",children:Object.entries(B).map(([e,s])=>t.jsxs("li",{children:[t.jsx("span",{className:"font-medium capitalize",children:e.replace(/_/g," ")}),": ",s,"categoryId"===e&&t.jsx("button",{onClick:()=>{const e=document.querySelector('[name="categoryId"]')||document.querySelector('select[id*="category"]')||document.querySelector(".category-input");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},className:"ml-2 text-xs underline hover:text-red-900",children:"Go to field"})]},e))})]})]})}),t.jsx(w,{formData:K,setFormData:M,categories:U,currentErrors:B,isCheckingName:Le,nameExists:Ee,onNameCheck:Be,onSpecificationsClick:()=>{Ce(!0)},useVariants:ce,onGenerateSKU:()=>N()}),!ce&&t.jsx(S,{formData:K,setFormData:M,currentErrors:B}),t.jsx(_,{variants:re,setVariants:ie,useVariants:ce,setUseVariants:e=>{if(le(e),e&&0===re.length){const e=Je();ie([e]),oe(!0)}else e||(ie([]),oe(!1))},showVariants:ne,setShowVariants:oe,isReorderingVariants:me,setIsReorderingVariants:xe,draggedVariantIndex:pe,setDraggedVariantIndex:ge,onVariantSpecificationsClick:e=>{ye(e),be(!0)},baseSku:K.sku}),t.jsx(C,{formData:K,setFormData:M,currentErrors:B}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[t.jsx(r,{onClick:()=>R("/lats/unified-inventory"),variant:"secondary",icon:t.jsx(m,{size:18}),className:"flex-1 sm:flex-none",children:"Cancel"}),t.jsx("div",{className:"flex-1"}),t.jsx(r,{onClick:async()=>{const e=(()=>{const e={};try{const t=ce?F.omit({price:!0,costPrice:!0,stockQuantity:!0,minStockLevel:!0,specification:!0}):F,s={...K,variants:ce?re:[]};return t.parse(s),ce&&(0===re.length?e.variants="At least one variant is required when using variants":re.forEach((t,s)=>{t.name&&""!==t.name.trim()||(e[`variant_${s}_name`]="Variant name is required"),t.price<0&&(e[`variant_${s}_price`]="Variant price must be 0 or greater"),t.costPrice<0&&(e[`variant_${s}_costPrice`]="Variant cost price must be 0 or greater"),t.stockQuantity<0&&(e[`variant_${s}_stockQuantity`]="Variant stock quantity must be 0 or greater"),t.minStockLevel<0&&(e[`variant_${s}_minStockLevel`]="Variant min stock level must be 0 or greater")})),T(e),{isValid:0===Object.keys(e).length,errors:e}}catch(t){return t instanceof D?t.issues.forEach(t=>{if(t.path.length>0){const s=t.path[0];e[s]=t.message}else e._general=t.message}):e._general="Validation failed: "+(t instanceof Error?t.message:"Unknown error"),T(e),{isValid:!1,errors:e}}})();if(!e.isValid){const s=Object.entries(e.errors).filter(([e])=>"_general"!==e),a=e.errors._general;return void(s.length>0||a?d.error(t.jsxs("div",{className:"text-left",children:[t.jsx("div",{className:"font-bold mb-1",children:"Please fix these errors:"}),t.jsxs("div",{className:"text-sm space-y-1",children:[a&&t.jsxs("div",{className:"text-red-600",children:["â€¢ ",a]}),s.map(([e,s])=>t.jsxs("div",{children:["â€¢ ",s]},e))]})]}),{duration:6e3}):d.error("Please fix the errors before submitting"))}if(Ee&&K.name.trim()!==Ae.trim())d.error("Another product with a similar name already exists");else{W(!0);try{const e=ce&&re.length>0?re.reduce((e,t)=>e+(t.stockQuantity||0),0):K.stockQuantity||0,t=ce&&re.length>0?re.reduce((e,t)=>e+(t.stockQuantity||0)*(t.price||0),0):(K.stockQuantity||0)*(K.price||0),r={name:K.name,description:K.description||null,category_id:K.categoryId||null,condition:K.condition||"new",total_quantity:e,total_value:t,storage_room_id:K.storageRoomId||null,shelf_id:K.shelfId||null};K.specification&&(r.specification=K.specification),K.sku&&(r.sku=K.sku),void 0!==K.costPrice&&(r.cost_price=K.costPrice),void 0!==K.price&&(r.selling_price=K.price),void 0!==K.stockQuantity&&(r.stock_quantity=K.stockQuantity),void 0!==K.minStockLevel&&(r.min_stock_level=K.minStockLevel);const i={name:K.name,description:K.description||null,category_id:K.categoryId||null},o=k(r);if(!o.isValid)return void d.error(`Validation failed: ${o.errors.join(", ")}`);let{data:c,error:l}=await n(async()=>await s.from("lats_products").update(r).eq("id",A).select().single());if(l){const e=await n(async()=>await s.from("lats_products").update(i).eq("id",A).select().single());if(e.error)throw e.error;c=e.data}if(ce&&re.length>0&&c)try{const{data:e}=await s.from("lats_product_variants").select("id, sku").eq("product_id",A),t=[],a=[];re.forEach((s,r)=>{const i=null==e?void 0:e.find(e=>e.sku===s.sku),n={product_id:A,sku:s.sku,variant_name:s.name,cost_price:s.costPrice,selling_price:s.price,quantity:s.stockQuantity,min_quantity:s.minStockLevel,variant_attributes:{...s.attributes,specification:s.specification||null}};i?(n.id=i.id,t.push(n)):a.push(n)});let r=null;if(t.length>0){const{error:e}=await n(async()=>await s.from("lats_product_variants").upsert(t,{onConflict:"id"}));e&&(r=e)}if(a.length>0&&!r){const{error:e}=await n(async()=>await s.from("lats_product_variants").insert(a));e&&(r=e)}r&&d.error("Product updated but failed to update variants")}catch(a){d.error("Product updated but failed to update variants")}J.show(`Product "${K.name}" has been updated successfully!`,{title:"Product Updated",actionButtons:[{label:"View Product",onClick:async()=>{try{const{data:e,error:t}=await s.from("lats_products").select("\n                    *,\n                    category:lats_categories(id, name),\n                    variants:lats_product_variants(*)\n                  ").eq("id",A).single();if(t)return void d.error("Failed to load product details");if(e){const t=Array.isArray(e.variants)?e.variants:[],s=t[0],a={id:e.id,name:e.name,sku:(null==s?void 0:s.sku)||e.sku||"",description:e.description||"",categoryId:e.category_id,category:e.category,condition:(null==s?void 0:s.condition)||e.condition||"new",price:(null==s?void 0:s.selling_price)||0,costPrice:(null==s?void 0:s.cost_price)||0,stockQuantity:(null==s?void 0:s.quantity)||0,minStockLevel:(null==s?void 0:s.min_quantity)||0,status:e.is_active?"active":"inactive",isActive:e.is_active,isFeatured:e.is_featured||!1,totalQuantity:t.reduce((e,t)=>e+(t.quantity||0),0),images:[],variants:t.map(e=>({id:e.id,sku:e.sku,name:e.variant_name||e.name,price:e.selling_price,costPrice:e.cost_price,stockQuantity:e.quantity,minStockLevel:e.min_quantity,quantity:e.quantity,minQuantity:e.min_quantity,sellingPrice:e.selling_price,condition:e.condition,isPrimary:e.is_primary,attributes:e.attributes||{}})),attributes:e.attributes||{},metadata:e.metadata||{},createdAt:e.created_at,updatedAt:e.updated_at};ae(a),te(!0)}}catch(e){d.error("Failed to load product details")}},variant:"primary"},{label:"Back to Inventory",onClick:()=>R("/lats/unified-inventory"),variant:"secondary"}]})}catch(r){d.error("Failed to update product. Please try again.")}finally{W(!1)}}},loading:Z,icon:t.jsx(x,{size:18}),className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white flex-1 sm:flex-none",disabled:Z||Le,children:Z?"Updating...":"Update Product"})]})]})})]}),he&&null!==fe&&t.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50 p-2",role:"dialog","aria-modal":"true","aria-labelledby":"variant-specifications-modal-title",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-4xl w-full max-h-[85vh] overflow-hidden mx-auto",children:[t.jsx("div",{className:"bg-blue-600 p-4 text-white",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(p,{className:"w-5 h-5"}),t.jsxs("div",{children:[t.jsx("h2",{id:"variant-specifications-modal-title",className:"text-lg font-semibold",children:"Variant Specs"}),t.jsx("p",{className:"text-blue-100 text-xs",children:(null==(e=re[fe])?void 0:e.name)||`Variant ${fe+1}`})]})]}),t.jsx("button",{onClick:()=>be(!1),className:"p-1 hover:bg-white/20 rounded transition-colors","aria-label":"Close modal",children:t.jsx(g,{size:18})})]})}),t.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-4 py-2",children:t.jsx("div",{className:"flex gap-1 overflow-x-auto",children:y.map(e=>{const s=e.icon,a=we===e.id;return t.jsxs("button",{onClick:()=>Se(e.id),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors "+(a?`bg-${e.color}-500 text-white`:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-100"),children:[t.jsx(s,{size:14}),e.name]},e.id)})})}),t.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(85vh-140px)]",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(h,{size:16,className:"text-blue-600"}),null==(Q=y.find(e=>e.id===we))?void 0:Q.name]}),Object.entries(v(we)).map(([e,s])=>0===s.length?null:t.jsxs("div",{className:"mb-4",children:[t.jsxs("h4",{className:"text-xs font-medium text-gray-700 mb-2 flex items-center gap-2",children:[t.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:j(e)}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.length,")"]})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:s.map(e=>{var s,a;const r=e.icon,i=(null==(a=null==(s=re[fe])?void 0:s.attributes)?void 0:a[e.key])||"",n="boolean"===e.type;return t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center gap-1",children:[t.jsx(r,{size:12,className:"text-gray-500"}),e.name,e.unit&&t.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.unit,")"]})]}),n?t.jsx("button",{type:"button",onClick:()=>De(fe,e.key,!i),className:"w-full p-2 border rounded-lg transition-colors "+(i?"bg-green-50 border-green-300 text-green-800":"bg-white border-gray-300 text-gray-600 hover:border-blue-500 hover:bg-blue-50"),children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(b,{size:14,className:i?"text-green-600":"text-gray-400"})})}):"select"===e.type&&e.options?t.jsxs("select",{value:i,onChange:t=>De(fe,e.key,t.target.value),className:"w-full py-1.5 px-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",children:[t.jsx("option",{value:"",children:"Select"}),e.options.map(e=>t.jsx("option",{value:e,children:e},e))]}):t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"number"===e.type?"number":"text",value:i,onChange:t=>De(fe,e.key,t.target.value),placeholder:e.placeholder||`Enter ${e.name.toLowerCase()}`,className:"w-full py-1.5 px-2 pr-6 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),i&&t.jsx("button",{type:"button",onClick:()=>De(fe,e.key,""),className:"absolute right-1 top-1.5 text-red-500 hover:text-red-700",title:"Clear value",children:t.jsx(g,{size:12})})]})]},e.key)})})]},e))]}),t.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(h,{size:16,className:"text-gray-600"}),"Custom"]}),ve===fe?t.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",value:Ne,onChange:e=>ke(e.target.value),placeholder:"Enter custom spec name...",className:"flex-1 py-1.5 px-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",onKeyPress:e=>{"Enter"===e.key&&Ne.trim()&&Ke(fe)},autoFocus:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),t.jsx("button",{type:"button",onClick:()=>Ke(fe),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium",children:"Add"}),t.jsx("button",{type:"button",onClick:()=>{je(null),ke("")},className:"px-3 py-1.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-xs font-medium",children:"Cancel"})]})}):t.jsxs("button",{type:"button",onClick:()=>{je(fe),ke("")},className:"flex items-center gap-2 p-2 bg-white border border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors w-full",children:[t.jsx(h,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Add Custom"})]})]}),(null==(L=re[fe])?void 0:L.attributes)&&Object.keys(re[fe].attributes).length>0&&t.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(b,{size:16,className:"text-green-600"}),"Current",t.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs font-medium",children:Object.keys(re[fe].attributes).length})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:Object.entries(re[fe].attributes).map(([e,s])=>t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-green-800 capitalize truncate",children:e.replace(/_/g," ")}),t.jsx("div",{className:"text-xs text-green-600 truncate",children:String(s)||"Not set"})]}),t.jsx("button",{type:"button",onClick:()=>((e,t)=>{const s={...re[e].attributes};delete s[t],Me(e,"attributes",s)})(fe,e),className:"ml-1 text-red-500 hover:text-red-700 flex-shrink-0",title:"Remove specification",children:t.jsx(g,{size:12})})]})},e))})]})]})}),t.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"text-xs text-gray-600",children:(null==(z=re[fe])?void 0:z.attributes)&&Object.keys(re[fe].attributes).length>0?`${Object.keys(re[fe].attributes).length} spec${1!==Object.keys(re[fe].attributes).length?"s":""} added`:"No specs added yet"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>be(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors text-xs font-medium",children:"Cancel"}),t.jsx("button",{type:"button",onClick:()=>{be(!1),d.success("Variant specifications saved successfully!")},className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium",children:"Save"})]})]})})]})}),_e&&t.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50 p-2",role:"dialog","aria-modal":"true","aria-labelledby":"product-specifications-modal-title",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-4xl w-full max-h-[85vh] overflow-hidden mx-auto",children:[t.jsx("div",{className:"bg-blue-600 p-4 text-white",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(f,{className:"w-5 h-5"}),t.jsxs("div",{children:[t.jsx("h2",{id:"product-specifications-modal-title",className:"text-lg font-semibold",children:"Product Specs"}),t.jsx("p",{className:"text-blue-100 text-xs",children:"Add product specifications"})]})]}),t.jsx("button",{onClick:()=>Ce(!1),className:"p-1 hover:bg-white/20 rounded transition-colors","aria-label":"Close modal",children:t.jsx(g,{size:18})})]})}),t.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-4 py-2",children:t.jsx("div",{className:"flex gap-1 overflow-x-auto",children:y.map(e=>{const s=e.icon,a=Ve===e.id;return t.jsxs("button",{onClick:()=>Qe(e.id),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors "+(a?`bg-${e.color}-500 text-white`:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-100"),children:[t.jsx(s,{size:14}),e.name]},e.id)})})}),t.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(85vh-140px)]",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(h,{size:16,className:"text-blue-600"}),null==(E=y.find(e=>e.id===Ve))?void 0:E.name]}),Object.entries(v(Ve)).map(([e,s])=>0===s.length?null:t.jsxs("div",{className:"mb-4",children:[t.jsxs("h4",{className:"text-xs font-medium text-gray-700 mb-2 flex items-center gap-2",children:[t.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:j(e)}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.length,")"]})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:s.map(e=>{const s=e.icon,a=(K.specification?JSON.parse(K.specification):{})[e.key]||"",r="boolean"===e.type;return t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center gap-1",children:[t.jsx(s,{size:12,className:"text-gray-500"}),e.name,e.unit&&t.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.unit,")"]})]}),r?t.jsx("button",{type:"button",onClick:()=>Fe(e.key,!a),className:"w-full p-2 border rounded-lg transition-colors "+(a?"bg-green-50 border-green-300 text-green-800":"bg-white border-gray-300 text-gray-600 hover:border-blue-500 hover:bg-blue-50"),children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(b,{size:14,className:a?"text-green-600":"text-gray-400"})})}):"select"===e.type&&e.options?t.jsxs("select",{value:a,onChange:t=>Fe(e.key,t.target.value),className:"w-full py-1.5 px-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",children:[t.jsx("option",{value:"",children:"Select"}),e.options.map(e=>t.jsx("option",{value:e,children:e},e))]}):t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"number"===e.type?"number":"text",value:a,onChange:t=>Fe(e.key,t.target.value),placeholder:e.placeholder||`Enter ${e.name.toLowerCase()}`,className:"w-full py-1.5 px-2 pr-6 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),a&&t.jsx("button",{type:"button",onClick:()=>Fe(e.key,""),className:"absolute right-1 top-1.5 text-red-500 hover:text-red-700",title:"Clear value",children:t.jsx(g,{size:12})})]})]},e.key)})})]},e))]}),t.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(h,{size:16,className:"text-gray-600"}),"Custom"]}),Pe?t.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",value:Oe,onChange:e=>qe(e.target.value),placeholder:"Enter custom spec name...",className:"flex-1 py-1.5 px-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",onKeyPress:e=>{"Enter"===e.key&&Oe.trim()&&He()},autoFocus:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),t.jsx("button",{type:"button",onClick:He,className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium",children:"Add"}),t.jsx("button",{type:"button",onClick:()=>{Ie(!1),qe("")},className:"px-3 py-1.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-xs font-medium",children:"Cancel"})]})}):t.jsxs("button",{type:"button",onClick:()=>{Ie(!0),qe("")},className:"flex items-center gap-2 p-2 bg-white border border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors w-full",children:[t.jsx(h,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Add Custom"})]})]}),(()=>{const e=K.specification?JSON.parse(K.specification):{};return Object.keys(e).length>0?t.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(b,{size:16,className:"text-green-600"}),"Current",t.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs font-medium",children:Object.keys(e).length})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:Object.entries(e).map(([e,s])=>t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-green-800 capitalize truncate",children:e.replace(/_/g," ")}),t.jsx("div",{className:"text-xs text-green-600 truncate",children:String(s)||"Not set"})]}),t.jsx("button",{type:"button",onClick:()=>(e=>{const t={...K.specification?JSON.parse(K.specification):{}};delete t[e],M(e=>({...e,specification:JSON.stringify(t)}))})(e),className:"ml-1 text-red-500 hover:text-red-700 flex-shrink-0",title:"Remove specification",children:t.jsx(g,{size:12})})]})},e))})]}):t.jsxs("div",{className:"text-center py-6",children:[t.jsx(f,{className:"w-8 h-8 text-gray-300 mx-auto mb-3"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No Specifications Added"}),t.jsx("p",{className:"text-gray-500 text-xs",children:"Click the buttons above to add specifications for this product."})]})})()]})}),t.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"text-xs text-gray-600",children:(()=>{const e=K.specification?JSON.parse(K.specification):{};return Object.keys(e).length>0?`${Object.keys(e).length} spec${1!==Object.keys(e).length?"s":""} added`:"No specs added yet"})()}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>Ce(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors text-xs font-medium",children:"Cancel"}),t.jsx("button",{type:"button",onClick:()=>{Ce(!1),d.success("Product specifications saved successfully!")},className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium",children:"Save"})]})]})})]})}),t.jsx(O,{...J.props}),se&&t.jsx(P,{isOpen:ee,onClose:()=>{te(!1),ae(null)},product:se,onEdit:e=>{te(!1),window.location.reload()}})]})};export{J as default};
