import{j as e}from"./index-222cfb29.js";import{r as s,R as t}from"./vendor-a2ff445a.js";import{a,t as r,c as l,g as i,b as n,d,u as c,e as o}from"./tradeInApi-966791f7.js";import{format as x}from"./format-0f0b2647.js";import{u as m}from"./useBodyScrollLock-0216d39f.js";import{m as g,X as u,d as p,V as h,e as b,x as j,U as y,_ as N,D as v,u as f,w,a5 as _,f as C,h as S,y as k,ab as T,q as F,Q as P,aT as A,$ as D,by as I}from"./ui-551a39a6.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";const R=({transaction:t,onClose:i,onStatusChange:n})=>{const[d,c]=s.useState(!1);m(!0);const o=(e=>{const s={pending:{bg:"bg-yellow-100",text:"text-yellow-800",icon:C,label:"Pending"},approved:{bg:"bg-blue-100",text:"text-blue-800",icon:p,label:"Approved"},completed:{bg:"bg-green-100",text:"text-green-800",icon:p,label:"Completed"},cancelled:{bg:"bg-red-100",text:"text-red-800",icon:S,label:"Cancelled"}};return s[e]||s.pending})(t.status),k=o.icon;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(g,{className:"w-7 h-7 text-blue-600"}),"Trade-In Details"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Transaction #",t.transaction_number]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Close",children:e.jsx(u,{className:"w-6 h-6 text-gray-600"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`${o.bg} ${o.text} rounded-lg p-4 flex items-center gap-3`,children:[e.jsx(k,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-lg",children:o.label}),t.contract_signed&&e.jsxs("div",{className:"text-sm flex items-center gap-1 mt-1",children:[e.jsx(p,{className:"w-4 h-4"}),"Contract Signed"]})]})]}),"completed"===t.status&&!t.inventory_item_id&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(h,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-900",children:"Ready for Inventory"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"This device can now be added to POS inventory and sold to customers."})]})]}),"completed"!==t.status&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(b,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-yellow-900",children:"Not Ready for Sale"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["This device cannot be added to inventory or sold until an admin marks it as ",e.jsx("strong",{children:"Completed"}),".","pending"===t.status&&" Please approve and complete this transaction first.","approved"===t.status&&" Please complete this transaction to proceed."]})]})]}),t.inventory_item_id&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-blue-900",children:"Already in Inventory"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This device has been added to inventory and is available for sale in POS."})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5 text-blue-600"}),"Device Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Device Name"}),e.jsx("p",{className:"text-base font-semibold text-gray-900 mt-1",children:t.device_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Model"}),e.jsx("p",{className:"text-base font-semibold text-gray-900 mt-1",children:t.device_model})]}),t.device_imei&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"IMEI"}),e.jsx("p",{className:"text-base font-mono text-gray-900 mt-1",children:t.device_imei})]}),t.device_serial_number&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Serial Number"}),e.jsx("p",{className:"text-base font-mono text-gray-900 mt-1",children:t.device_serial_number})]})]})]}),t.customer&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-blue-600"}),"Customer Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Name"}),e.jsx("p",{className:"text-base font-semibold text-gray-900 mt-1",children:t.customer.name})]}),t.customer.phone&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Phone"}),e.jsx("p",{className:"text-base text-gray-900 mt-1",children:t.customer.phone})]}),t.customer.email&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Email"}),e.jsx("p",{className:"text-base text-gray-900 mt-1",children:t.customer.email})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-blue-600"}),"Condition Assessment"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Overall Condition"}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-flex px-4 py-2 rounded-lg font-semibold capitalize ${T=t.condition_rating,{excellent:"text-green-600 bg-green-50",good:"text-blue-600 bg-blue-50",fair:"text-yellow-600 bg-yellow-50",poor:"text-red-600 bg-red-50"}[T]||"text-gray-600 bg-gray-50"}`,children:t.condition_rating})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Damage Deductions"}),e.jsx("p",{className:"text-base font-semibold text-red-600 mt-1",children:t.total_damage_deductions>0?`-${x.money(t.total_damage_deductions)}`:"None"})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[t.needs_repair&&e.jsxs("div",{className:"flex items-center gap-2 bg-purple-50 text-purple-700 px-4 py-2 rounded-lg",children:[e.jsx(N,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Needs Repair"})]}),t.ready_for_resale&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 text-green-700 px-4 py-2 rounded-lg",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Ready for Resale"})]})]}),t.damage_notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Damage Notes"}),e.jsx("p",{className:"text-sm text-gray-900 mt-1 bg-white p-3 rounded border border-gray-200",children:t.damage_notes})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-5 border border-green-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-green-600"}),"Pricing Breakdown"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Base Trade-In Price:"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:x.money(t.base_trade_in_price)})]}),t.total_damage_deductions>0&&e.jsxs("div",{className:"flex justify-between items-center text-red-600",children:[e.jsx("span",{className:"text-sm",children:"Damage Deductions:"}),e.jsxs("span",{className:"text-base font-semibold",children:["-",x.money(t.total_damage_deductions)]})]}),e.jsxs("div",{className:"border-t border-green-300 pt-3 flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Final Trade-In Value:"}),e.jsx("span",{className:"text-2xl font-bold text-green-700",children:x.money(t.final_trade_in_value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Transaction Date"})]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:x.dateTime(new Date(t.created_at))})]}),t.transaction_number&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Transaction Number"})]}),e.jsx("p",{className:"text-base font-mono font-semibold text-gray-900",children:t.transaction_number})]})]}),t.notes&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-600"}),"Additional Notes"]}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap bg-white p-4 rounded border border-gray-200",children:t.notes})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 p-6 flex justify-between",children:[e.jsxs("div",{className:"flex gap-3",children:["pending"===t.status&&e.jsxs("button",{onClick:async()=>{c(!0);const e=await a(t.id);c(!1),e.success?(r.success("Transaction approved successfully!"),null==n||n(),i()):r.error(e.error||"Failed to approve transaction")},disabled:d,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),d?"Approving...":"Approve Transaction"]}),("pending"===t.status||"approved"===t.status)&&e.jsxs("button",{onClick:async()=>{c(!0);const e=await l(t.id);c(!1),e.success?(r.success("Transaction completed successfully!"),null==n||n(),i()):r.error(e.error||"Failed to complete transaction")},disabled:d,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),d?"Completing...":"Complete Transaction"]})]}),e.jsx("button",{onClick:i,disabled:d,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Close"})]})]})});var T},V=()=>{const[a,l]=s.useState([]),[n,d]=s.useState(!0),[c,o]=s.useState(""),[m,u]=s.useState(!1),[h,b]=s.useState(null);s.useState({});const[y,f]=s.useState(""),[w,_]=s.useState(""),[P,A]=s.useState(void 0),[D,I]=s.useState(void 0),V=async()=>{d(!0);const e={search:c||void 0,status:y||void 0,condition_rating:w||void 0,needs_repair:P,ready_for_resale:D},s=await i(e);s.success&&s.data?l(s.data):r.error(s.error||"Failed to load transactions"),d(!1)};s.useEffect(()=>{V()},[y,w,P,D]);const E=t.useMemo(()=>{if(0===a.length)return{totalTransactions:0,totalValue:0,averageValue:0,pendingCount:0,completedCount:0,needsRepairCount:0,readyForResaleCount:0};const e=a.filter(e=>{const s=Number(e.final_trade_in_value)||0;return Math.abs(s)<=1e12&&isFinite(s)}),s=e.reduce((e,s)=>e+(Number(s.final_trade_in_value)||0),0);return{totalTransactions:a.length,totalValue:s,averageValue:e.length>0?s/e.length:0,pendingCount:a.filter(e=>"pending"===e.status).length,completedCount:a.filter(e=>"completed"===e.status).length,needsRepairCount:a.filter(e=>e.needs_repair&&!e.ready_for_resale).length,readyForResaleCount:a.filter(e=>e.ready_for_resale).length}},[a]),M=()=>{V()},L=s=>{const t={pending:{bg:"bg-yellow-100",text:"text-yellow-800",icon:C},approved:{bg:"bg-blue-100",text:"text-blue-800",icon:p},completed:{bg:"bg-green-100",text:"text-green-800",icon:p},cancelled:{bg:"bg-red-100",text:"text-red-800",icon:S}}[s],a=t.icon;return e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t.bg} ${t.text} flex items-center gap-1`,children:[e.jsx(a,{className:"w-3 h-3"}),s.charAt(0).toUpperCase()+s.slice(1)]})};return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:E.totalTransactions})]}),e.jsx(g,{className:"w-10 h-10 text-blue-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-green-900 mt-1",children:x.money(E.totalValue)})]}),e.jsx(v,{className:"w-10 h-10 text-green-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Needs Repair"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:E.needsRepairCount})]}),e.jsx(N,{className:"w-10 h-10 text-purple-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600 font-medium",children:"Ready for Sale"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900 mt-1",children:E.readyForResaleCount})]}),e.jsx(j,{className:"w-10 h-10 text-orange-600 opacity-50"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by device, IMEI, or customer...",value:c,onChange:e=>o(e.target.value),onKeyDown:e=>"Enter"===e.key&&M(),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:()=>u(!m),className:"px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors "+(m?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(T,{className:"w-5 h-5"}),"Filters"]}),e.jsx("button",{onClick:M,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Search"})]}),m&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:y,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Condition"}),e.jsxs("select",{value:w,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Conditions"}),e.jsx("option",{value:"excellent",children:"Excellent"}),e.jsx("option",{value:"good",children:"Good"}),e.jsx("option",{value:"fair",children:"Fair"}),e.jsx("option",{value:"poor",children:"Poor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repair Status"}),e.jsxs("select",{value:void 0===P?"":P.toString(),onChange:e=>A(""===e.target.value?void 0:"true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"true",children:"Needs Repair"}),e.jsx("option",{value:"false",children:"No Repair Needed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sale Status"}),e.jsxs("select",{value:void 0===D?"":D.toString(),onChange:e=>I(""===e.target.value?void 0:"true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"true",children:"Ready for Sale"}),e.jsx("option",{value:"false",children:"Not Ready"})]})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:n?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading transactions..."})]}):0===a.length?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(g,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Trade-In Transactions"}),e.jsx("p",{className:"text-gray-600",children:c?"No transactions match your search":"Start trading in devices to see them here"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transaction"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Device"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Condition"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(s=>{var t,a,r;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.transaction_number}),s.contract_signed&&e.jsxs("div",{className:"text-xs text-green-600 flex items-center gap-1 mt-1",children:[e.jsx(p,{className:"w-3 h-3"}),"Contract Signed"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.device_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.device_model}),s.device_imei&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["IMEI: ",s.device_imei]})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:null==(t=s.customer)?void 0:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:null==(a=s.customer)?void 0:a.phone})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:`text-sm font-medium capitalize ${r=s.condition_rating,{excellent:"text-green-600",good:"text-blue-600",fair:"text-yellow-600",poor:"text-red-600"}[r]}`,children:s.condition_rating}),s.total_damage_deductions>0&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["-",x.money(s.total_damage_deductions)," deducted"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:x.money(s.final_trade_in_value)}),s.needs_repair&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-600 mt-1",children:[e.jsx(N,{className:"w-3 h-3"}),"Needs Repair"]}),s.ready_for_resale&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mt-1",children:[e.jsx(j,{className:"w-3 h-3"}),"Ready for Sale"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:L(s.status)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleTimeString()})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("button",{onClick:()=>b(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Details",children:e.jsx(F,{className:"w-4 h-4"})})})]},s.id)})})]})})}),a.length>0&&e.jsx("div",{className:"mt-6 bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:["Showing ",a.length," transaction",1!==a.length?"s":""]}),e.jsxs("div",{className:"text-gray-900 font-medium",children:["Average Value: ",x.money(E.averageValue)]})]})}),h&&e.jsx(R,{transaction:h,onClose:()=>b(null),onStatusChange:()=>{V(),b(null)}})]})},E=()=>{const[t,a]=s.useState([]),[l,i]=s.useState(!0),[c,o]=s.useState(""),[m,u]=s.useState(!0),[p,h]=s.useState(!1),[b,j]=s.useState(null),y=async()=>{i(!0);const e=await n({is_active:m});e.success&&e.data?a(e.data):r.error(e.error||"Failed to load prices"),i(!1)};s.useEffect(()=>{y()},[m]);const N=t.filter(e=>{if(!c)return!0;const s=c.toLowerCase();return e.device_name.toLowerCase().includes(s)||e.device_model.toLowerCase().includes(s)}),v=()=>{h(!1),j(null)};return e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search device name or model...",value:c,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:e=>u(e.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Active Only"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 font-medium",children:[e.jsx(P,{className:"w-5 h-5"}),"Add Trade-In Price"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:l?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading prices..."})]}):0===N.length?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(g,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Trade-In Prices"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c?"No prices match your search":"Start by adding base trade-in prices for your devices"}),!c&&e.jsx("button",{onClick:()=>h(!0),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add First Price"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Device"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Condition Multipliers"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.device_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.device_model}),s.notes&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:s.notes})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:x.money(s.base_trade_in_price)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-gray-600",children:"Excellent:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[(100*s.excellent_multiplier).toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-gray-600",children:"Good:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[(100*s.good_multiplier).toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-gray-600",children:"Fair:"}),e.jsxs("span",{className:"font-medium text-yellow-600",children:[(100*s.fair_multiplier).toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-gray-600",children:"Poor:"}),e.jsxs("span",{className:"font-medium text-red-600",children:[(100*s.poor_multiplier).toFixed(0),"%"]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+(s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>(e=>{j(e),h(!0)})(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(async e=>{if(!confirm("Are you sure you want to delete this trade-in price?"))return;const s=await d(e);s.success?(r.success("Trade-in price deleted"),y()):r.error(s.error||"Failed to delete")})(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(D,{className:"w-4 h-4"})})]})})]},s.id))})]})})}),p&&e.jsx(M,{price:b,onClose:v,onSave:()=>{y(),v()}})]})},M=({price:t,onClose:a,onSave:l})=>{const[i,n]=s.useState({device_name:(null==t?void 0:t.device_name)||"",device_model:(null==t?void 0:t.device_model)||"",base_trade_in_price:(null==t?void 0:t.base_trade_in_price)||0,excellent_multiplier:(null==t?void 0:t.excellent_multiplier)||1,good_multiplier:(null==t?void 0:t.good_multiplier)||.85,fair_multiplier:(null==t?void 0:t.fair_multiplier)||.7,poor_multiplier:(null==t?void 0:t.poor_multiplier)||.5,notes:(null==t?void 0:t.notes)||"",is_active:(null==t?void 0:t.is_active)??!0}),[d,x]=s.useState(!1);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t?"Edit Trade-In Price":"Add Trade-In Price"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),x(!0);const s=t?await c(t.id,i):await o(i);x(!1),s.success?(r.success(t?"Price updated successfully":"Price created successfully"),l()):r.error(s.error||"Failed to save price")},className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Device Name *"}),e.jsx("input",{type:"text",required:!0,value:i.device_name,onChange:e=>n({...i,device_name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., iPhone 14 Pro"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Device Model *"}),e.jsx("input",{type:"text",required:!0,value:i.device_model,onChange:e=>n({...i,device_model:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., A2890 256GB"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Base Trade-In Price *"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:i.base_trade_in_price,onChange:e=>n({...i,base_trade_in_price:parseFloat(e.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"This is the maximum trade-in value for an excellent condition device"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Condition Multipliers"}),e.jsxs("div",{className:"space-y-3 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Excellent Condition:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"1",step:"0.01",value:i.excellent_multiplier,onChange:e=>n({...i,excellent_multiplier:parseFloat(e.target.value)||1}),className:"w-20 px-3 py-1 border border-gray-300 rounded text-center"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",(100*i.excellent_multiplier).toFixed(0),"%)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Good Condition:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"1",step:"0.01",value:i.good_multiplier,onChange:e=>n({...i,good_multiplier:parseFloat(e.target.value)||.85}),className:"w-20 px-3 py-1 border border-gray-300 rounded text-center"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",(100*i.good_multiplier).toFixed(0),"%)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Fair Condition:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"1",step:"0.01",value:i.fair_multiplier,onChange:e=>n({...i,fair_multiplier:parseFloat(e.target.value)||.7}),className:"w-20 px-3 py-1 border border-gray-300 rounded text-center"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",(100*i.fair_multiplier).toFixed(0),"%)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Poor Condition:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"1",step:"0.01",value:i.poor_multiplier,onChange:e=>n({...i,poor_multiplier:parseFloat(e.target.value)||.5}),className:"w-20 px-3 py-1 border border-gray-300 rounded text-center"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",(100*i.poor_multiplier).toFixed(0),"%)"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:i.notes,onChange:e=>n({...i,notes:e.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Additional notes about this pricing..."})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.is_active,onChange:e=>n({...i,is_active:e.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:a,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Saving...":t?"Update Price":"Create Price"})]})]})]})})},L=()=>{const[t,a]=s.useState("history"),r=[{id:"history",label:"History & Reports",icon:I,description:"View all trade-in transactions with filtering and analytics"},{id:"pricing",label:"Pricing Management",icon:v,description:"Set and manage base trade-in prices for devices"}];return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(I,{className:"w-8 h-8 text-blue-600"}),"Trade-In Management"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage device trade-ins, pricing, and transaction history"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-6 border border-gray-200",children:e.jsx("div",{className:"flex border-b border-gray-200",children:r.map(s=>{const r=s.icon,l=t===s.id;return e.jsx("button",{onClick:()=>a(s.id),className:"flex-1 px-6 py-4 text-left transition-all "+(l?"border-b-2 border-blue-600 bg-blue-50":"hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"w-5 h-5 "+(l?"text-blue-600":"text-gray-400")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold "+(l?"text-blue-600":"text-gray-700"),children:s.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:s.description})]})]})},s.id)})})}),e.jsxs("div",{className:"tab-content",children:["history"===t&&e.jsx(V,{}),"pricing"===t&&e.jsx(E,{})]})]})};export{L as TradeInManagementPage,L as default};
