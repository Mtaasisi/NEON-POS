import{v as e,c as t,u as s,j as a,d as r,G as i,a5 as l,s as n,aA as o,ai as c}from"./index-222cfb29.js";import{r as d}from"./vendor-a2ff445a.js";import{B as m}from"./BackButton-e41d1482.js";import{az as x,f as u,i as p,N as g,X as h,l as b,n as f,a5 as y,Q as j}from"./ui-551a39a6.js";import{s as v,g as N,a as w}from"./specificationCategories-9f98df80.js";import{g as k}from"./skuUtils-6fbbef44.js";import{P as C}from"./ProductInformationForm-61fc6c83.js";import{P as S,a as _}from"./ProductModal-44d6d29a.js";import{u as O,S as P}from"./useSuccessModal-e8b7d685.js";import{u as V}from"./useBodyScrollLock-0216d39f.js";import{a as A}from"./routing-a2f0f6d2.js";import{o as z,s as $,e as E,g as I,h as q,a as D,Z as J}from"./forms-fd94c8fb.js";import"./supabase-7e851d02.js";import"./CategoryInput-bba1731d.js";import"./specificationUtils-8355804c.js";import"./robustImageService-2422a1f9.js";import"./format-0f0b2647.js";import"./CircularProgress-471d8e37.js";import"./productUtils-6e390a72.js";import"./variantUtils-422e46bb.js";import"./usePurchaseOrderHistory-baa7ee96.js";import"./productCalculations-9e8647a1.js";import"./zod-4c7d126c.js";import"./GlassInput-ba5c3c0d.js";import"./utils-fb833cf6.js";import"./charts-66cc82bb.js";import"./GlassSelect-3b56e5f5.js";import"./GlassBadge-18f019e2.js";import"./PriceInput-e1556d5b.js";import"./storeShelfApi-d8b142f6.js";const B=z({name:$().min(1,"Product name must be provided").max(100,"Product name must be less than 100 characters"),description:$().max(200,"Description must be less than 200 characters").optional(),specification:$().max(1e3,"Specification must be less than 1000 characters").optional().refine(e=>{if(!e)return!0;try{return JSON.parse(e),!0}catch{return!1}},{message:"Specification must be valid JSON"}),sku:$().max(50,"SKU must be less than 50 characters").optional(),categoryId:$().min(1,"Category must be selected"),condition:E(["new","used","refurbished"],{errorMap:()=>({message:"Please select a condition"})}),metadata:I($(),q()).optional().default({}),variants:D(q()).optional().default([])}),F=()=>{var z,$,E;const I=A(),{currentBranch:q}=e(),{loadProducts:D}=t(),[F,T]=d.useState([]),[U,L]=d.useState({}),G=()=>k(),[Q,R]=d.useState({name:"",sku:G(),categoryId:"",condition:"new",description:"",specification:"",metadata:{},variants:[]}),[K,M]=d.useState(!1),[Y,H]=d.useState(!1),[W,Z]=d.useState(null),[X,ee]=d.useState([{name:"Variant 1",sku:"",attributes:{}}]),[te,se]=d.useState(!0),[ae,re]=d.useState(!0),[ie,le]=d.useState(!1),[ne,oe]=d.useState(null),[ce,de]=d.useState(!1),[me,xe]=d.useState(null),[ue,pe]=d.useState(""),[ge,he]=d.useState(""),[be,fe]=d.useState("laptop"),[ye,je]=d.useState(0),[ve,Ne]=d.useState(!1),[we,ke]=d.useState(!1),[Ce,Se]=d.useState(!1),[_e,Oe]=d.useState(""),[Pe,Ve]=d.useState("laptop");V(we||ce),d.useEffect(()=>{X.length>0&&Q.sku&&ee(e=>e.map((e,t)=>({...e,sku:`${Q.sku}-V${(t+1).toString().padStart(2,"0")}`})))},[Q.sku]);const[Ae,ze]=d.useState(!1),[$e,Ee]=d.useState(!1),[Ie,qe]=d.useState(!1),[De,Je]=d.useState(null),[Be,Fe]=d.useState(null),Te=O(),{currentUser:Ue}=s(),Le=`product_draft_${(null==Ue?void 0:Ue.id)||"anonymous"}`,Ge=d.useCallback(()=>{try{const e={formData:Q,variants:X,useVariants:ae,savedAt:(new Date).toISOString()};localStorage.setItem(Le,JSON.stringify(e)),qe(!0),Je(new Date),setTimeout(()=>qe(!1),2e3)}catch(e){}},[Q,X,ae,Le]),Qe=d.useCallback(()=>{var e;try{const t=localStorage.getItem(Le);if(t){const s=JSON.parse(t);return R(s.formData),ee(s.variants||[{name:"Variant 1",sku:`${(null==(e=s.formData)?void 0:e.sku)||""}-V01`,attributes:{}}]),re(!0),se(!0),Je(new Date(s.savedAt)),!0}}catch(t){}return!1},[Le]),Re=d.useCallback(()=>{try{localStorage.removeItem(Le),Je(null),qe(!1)}catch(e){}},[Le]);d.useEffect(()=>{(async()=>{try{const e=await l();T(e||[]),Qe()}catch(e){f.error("Failed to load form data")}})()},[Qe]),d.useEffect(()=>{Be&&clearTimeout(Be);const e=setTimeout(()=>{(Q.name.trim()||Q.description.trim()||X.length>0)&&Ge()},2e3);return Fe(e),()=>{e&&clearTimeout(e)}},[Q,X,ae,Ge]),d.useEffect(()=>{(async()=>{try{const e=localStorage.getItem(Le);if(e){const t=JSON.parse(e),s=(new Date).getTime()-new Date(t.savedAt).getTime();s/36e5<24?Qe():Re()}}catch(e){}})()},[Le,Qe,Re]);const Ke=async e=>{if(e.trim()){ze(!0);try{const{data:t,error:s}=await n.from("lats_products").select("id").ilike("name",`%${e.trim()}%`).limit(1);if(s)throw s;Ee(t&&t.length>0)}catch(t){}finally{ze(!1)}}else Ee(!1)};d.useEffect(()=>{const e=setTimeout(()=>{Q.name&&Ke(Q.name)},500);return()=>clearTimeout(e)},[Q.name]);const Me=(e,t,s)=>{const a={...X[e].attributes,[t]:s};He(e,"attributes",a)},Ye=e=>{if(ue.trim()){((e,t,s="")=>{const a={...X[e].attributes,[t]:s};He(e,"attributes",a)})(e,ue.trim().toLowerCase().replace(/\s+/g,"_"),ge.trim()||""),pe(""),he(""),f.success("Custom specification added!")}},He=(e,t,s)=>{ee(a=>a.map((a,r)=>r===e?{...a,[t]:s}:a))},We=(e,t)=>{const s={...X[e].attributes};delete s[t],He(e,"attributes",s)},Ze=(e,t)=>{const s={...Q.specification?JSON.parse(Q.specification):{},[e]:t};R(e=>({...e,specification:JSON.stringify(s)}))},Xe=()=>{if(_e.trim()){((e,t="")=>{const s={...Q.specification?JSON.parse(Q.specification):{},[e]:t};R(e=>({...e,specification:JSON.stringify(s)}))})(_e.trim().toLowerCase().replace(/\s+/g,"_")),Se(!1),Oe("")}};return a.jsxs("div",{className:"p-2 sm:p-4 h-full overflow-y-auto pt-4",children:[a.jsxs("div",{className:"max-w-4xl mx-auto space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(m,{to:"/lats/unified-inventory"}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Add Product"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Create new inventory item"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[Ie&&a.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-50 border border-green-200 rounded text-xs",children:[a.jsx(x,{className:"w-3 h-3 text-green-600"}),a.jsx("span",{className:"text-green-700 font-medium",children:"Saved"})]}),De&&!Ie&&a.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-blue-50 border border-blue-200 rounded text-xs",children:[a.jsx(u,{className:"w-3 h-3 text-blue-600"}),a.jsx("span",{className:"text-blue-700",children:De.toLocaleTimeString()})]}),De&&a.jsx("button",{onClick:Re,className:"px-2 py-1 text-xs text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Clear draft",children:"Clear"})]})]}),a.jsx(r,{className:"mb-3",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(C,{formData:Q,setFormData:R,categories:F,currentErrors:U,isCheckingName:Ae,nameExists:$e,onNameCheck:Ke,onSpecificationsClick:()=>{ke(!0)},useVariants:ae,onGenerateSKU:G}),a.jsx(S,{variants:X,setVariants:ee,useVariants:ae,setUseVariants:()=>{},showVariants:te,setShowVariants:se,isReorderingVariants:ie,setIsReorderingVariants:le,draggedVariantIndex:ne,setDraggedVariantIndex:oe,onVariantSpecificationsClick:e=>{xe(e),je(0),pe(""),he(""),Ne(!1),de(!0)},baseSku:Q.sku}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[a.jsx(i,{onClick:()=>I("/lats/unified-inventory"),variant:"secondary",icon:a.jsx(p,{size:16}),className:"flex-1 sm:flex-none text-sm py-2",children:"Cancel"}),a.jsx("div",{className:"flex-1"}),a.jsx(i,{onClick:async()=>{const e=(()=>{const e={};try{return B.parse({...Q,variants:ae?X:[]}),ae&&(0===X.length?e.variants="At least one variant is required when using variants":X.forEach((t,s)=>{t.name&&""!==t.name.trim()||(e[`variant_${s}_name`]="Variant name is required")})),L(e),{isValid:0===Object.keys(e).length,errors:e}}catch(t){return t instanceof J?t.issues.forEach(t=>{if(t.path.length>0){const s=t.path[0];e[s]=t.message}else e._general=t.message}):e._general="Validation failed: "+(t instanceof Error?t.message:"Unknown error"),L(e),{isValid:!1,errors:e}}})();if(!e.isValid){const t=Object.entries(e.errors).filter(([e])=>"_general"!==e),s=e.errors._general;return void(t.length>0||s?f.error(a.jsxs("div",{className:"text-left",children:[a.jsx("div",{className:"font-bold mb-1",children:"Please fix these errors:"}),a.jsxs("div",{className:"text-sm space-y-1",children:[s&&a.jsxs("div",{className:"text-red-600",children:["• ",s]}),t.map(([e,t])=>a.jsxs("div",{children:["• ",t]},e))]})]}),{duration:6e3}):f.error("Please fix the errors before submitting"))}if($e)f.error("A product with this name already exists");else{M(!0);try{const e=0,t=0,s=Q.sku||G(),a={...Q.metadata||{},...Q.specification?{specification:Q.specification}:{},...Q.condition?{condition:Q.condition}:{}},r={name:Q.name,description:Q.description||null,sku:s,category_id:Q.categoryId||null,branch_id:(null==q?void 0:q.id)||null,cost_price:0,selling_price:0,stock_quantity:0,min_stock_level:0,total_quantity:e,total_value:t,attributes:a,metadata:{useVariants:ae,variantCount:ae?X.length:0,createdBy:null==Ue?void 0:Ue.id,createdAt:(new Date).toISOString()}},{data:i,error:l}=await o(async()=>await n.from("lats_products").insert([r]).select().single());if(l)throw l;if(!i){const{data:{user:e}}=await n.auth.getUser();return void f.error("Product creation failed - database returned no data. Check console for details.")}if(i){let e=[];ae&&X.length>0&&(e=X.map((e,t)=>({product_id:i.id,sku:e.sku||`${Q.sku}-V${t+1}`,variant_name:e.name||`Variant ${t+1}`,cost_price:0,selling_price:0,quantity:0,min_quantity:0,variant_attributes:{...e.attributes,specification:e.specification||null}})));let t=null,s=null;if(e.length>0){const a=await o(async()=>await n.from("lats_product_variants").insert(e).select());t=a.data,s=a.error}s&&f.error("Product created but failed to create variants")}if(!i)return void f.error("Product creation failed - please check database permissions");Re(),c.clearProducts(),await D(),Te.show(`Product "${Q.name}" has been created successfully!`,{title:"Product Created",actionButtons:[{label:"Go to PO",onClick:()=>{I("/lats/purchase-order/create")},variant:"primary"},{label:"View Product",onClick:async()=>{try{const{data:e,error:t}=await n.from("lats_products").select("\n                    *,\n                    category:lats_categories(id, name),\n                    variants:lats_product_variants(*)\n                  ").eq("id",i.id).single();if(t)return void f.error("Failed to load product details");if(e){const t=Array.isArray(e.variants)?e.variants:[],s=t[0],a={id:e.id,name:e.name,sku:(null==s?void 0:s.sku)||e.sku||"",description:e.description||"",categoryId:e.category_id,category:e.category,condition:(null==s?void 0:s.condition)||e.condition||"new",price:(null==s?void 0:s.selling_price)||0,costPrice:(null==s?void 0:s.cost_price)||0,stockQuantity:(null==s?void 0:s.quantity)||0,minStockLevel:(null==s?void 0:s.min_quantity)||0,status:e.is_active?"active":"inactive",isActive:e.is_active,isFeatured:e.is_featured||!1,totalQuantity:t.reduce((e,t)=>e+(t.quantity||0),0)||0,images:[],variants:t.map((e,t)=>({id:e.id,sku:e.sku,name:e.variant_name||e.name||`Variant ${t+1}`,variant_name:e.variant_name,price:e.selling_price,costPrice:e.cost_price,stockQuantity:e.quantity,minStockLevel:e.min_quantity,quantity:e.quantity,minQuantity:e.min_quantity,sellingPrice:e.selling_price,condition:e.condition,isPrimary:e.is_primary,attributes:e.attributes||{},variant_attributes:e.variant_attributes||{}})),attributes:e.attributes||{},metadata:e.metadata||{},createdAt:e.created_at,updatedAt:e.updated_at};Z(a),H(!0)}}catch(e){f.error("Failed to load product details")}},variant:"primary"},{label:"Edit Product",onClick:()=>I(`/lats/products/${i.id}/edit`),variant:"secondary"},{label:"Create Another",onClick:()=>{const e=G();R({name:"",sku:e,categoryId:"",condition:"new",description:"",specification:"",metadata:{},variants:[]}),ee([{name:"Variant 1",sku:"",attributes:{}}])},variant:"secondary"}]})}catch(t){f.error("Failed to create product. Please try again.")}finally{M(!1)}}},loading:K,icon:a.jsx(g,{size:16}),className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white flex-1 sm:flex-none text-sm py-2",disabled:K||Ae,children:K?"Creating...":"Create Product"})]})]})})]}),ce&&null!==me&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>{de(!1),je(0),pe(""),he(""),Ne(!1)}}),a.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4 pointer-events-none",children:a.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-sm sm:max-w-2xl md:max-w-4xl lg:max-w-5xl xl:max-w-6xl shadow-2xl overflow-hidden relative pointer-events-auto max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"variant-specifications-modal-title",children:[a.jsx("button",{onClick:()=>{de(!1),je(0),pe(""),he(""),Ne(!1)},className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-10","aria-label":"Close modal",children:a.jsx(h,{className:"w-5 h-5"})}),a.jsxs("div",{className:"p-6 sm:p-7 md:p-8 text-center transition-all duration-500 bg-gradient-to-br from-purple-50 to-purple-100 flex-shrink-0",children:[a.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-lg transition-all duration-500 bg-purple-600",children:a.jsx(b,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})}),a.jsx("h3",{id:"variant-specifications-modal-title",className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Variant Specifications"}),a.jsx("p",{className:"text-purple-700 text-xs sm:text-sm mt-1.5 sm:mt-2",children:(null==(z=X[me])?void 0:z.name)||`Variant ${me+1}`})]}),a.jsx("div",{className:"px-4 sm:px-6 md:px-8 py-4 sm:py-5 md:py-6 bg-gradient-to-br from-gray-50 to-gray-100 border-b border-gray-200 flex-shrink-0",children:a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3",children:v.map(e=>{const t=e.icon,s=be===e.id;return a.jsxs("button",{onClick:()=>{fe(e.id),je(0)},className:"flex flex-col items-center gap-1.5 sm:gap-2 p-3 sm:p-4 rounded-xl transition-all "+(s?"bg-purple-600 text-white shadow-lg scale-105":"bg-white text-gray-700 hover:bg-purple-50 hover:shadow-md border border-gray-200"),children:[a.jsx(t,{size:20,className:"sm:w-6 sm:h-6 "+(s?"text-white":"text-purple-600")}),a.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-center leading-tight",children:e.name})]},e.id)})})}),a.jsxs("div",{className:"p-4 sm:p-5 md:p-6 overflow-y-auto bg-white flex-1 min-h-0",children:[a.jsxs("div",{className:"mb-4 sm:mb-5 md:mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:["Step ",ye+1," of ",Object.keys(N(be)).length+1]}),a.jsx("span",{className:"text-xs text-gray-600",children:(null==($=X[me])?void 0:$.attributes)&&Object.keys(X[me].attributes).length>0?`${Object.keys(X[me].attributes).length} spec${1!==Object.keys(X[me].attributes).length?"s":""} added`:"No specs yet"})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:(ye+1)/(Object.keys(N(be)).length+1)*100+"%"}})})]}),a.jsxs("div",{className:"space-y-5",children:[(()=>{const e=Object.entries(N(be));if(ye>=e.length)return a.jsxs("div",{children:[a.jsx("h4",{className:"text-lg font-bold text-gray-900 mb-2 text-center",children:"Custom Specifications"}),a.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center",children:"Add your own custom specification fields"}),a.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 sm:p-5 md:p-6 border-2 border-purple-300",children:a.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[a.jsx("label",{className:"text-sm sm:text-base font-semibold text-purple-900 text-center",children:"Create Your Own Specification"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2",children:"Specification Name *"}),a.jsx("input",{type:"text",value:ue,onChange:e=>pe(e.target.value),placeholder:"e.g., Brand, Warranty, Color",className:"w-full py-3 px-4 border-2 border-purple-400 rounded-lg focus:border-purple-600 focus:outline-none text-sm focus:ring-2 focus:ring-purple-200",autoFocus:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2",children:"Value"}),a.jsx("input",{type:"text",value:ge,onChange:e=>he(e.target.value),placeholder:"e.g., Apple, 2 years, Black",className:"w-full py-3 px-4 border-2 border-purple-400 rounded-lg focus:border-purple-600 focus:outline-none text-sm focus:ring-2 focus:ring-purple-200",onKeyPress:e=>{"Enter"===e.key&&ue.trim()&&Ye(me)},autoComplete:"off",autoCorrect:"off",spellCheck:!1})]})]}),a.jsx("button",{type:"button",onClick:()=>{null!==me&&ue.trim()&&Ye(me)},disabled:!ue.trim(),className:"w-full py-3.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all font-bold text-base disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl",children:"➕ Add Custom Specification"}),a.jsx("p",{className:"text-xs text-purple-700 text-center",children:"Add as many custom specifications as you need"})]})}),(()=>{var e;const t=(null==(e=X[me])?void 0:e.attributes)||{},s=new Set;Object.entries(N(be)).forEach(([e,t])=>{t.forEach(e=>s.add(e.key))});const r=Object.entries(t).filter(([e])=>!s.has(e));return r.length>0?a.jsxs("div",{className:"mt-4 sm:mt-5 md:mt-6",children:[a.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-3 text-center",children:["Your Custom Specs ",a.jsxs("span",{className:"text-purple-600",children:["(",r.length,")"]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 sm:gap-3",children:r.map(([e,t])=>a.jsx("div",{className:"bg-white border-2 border-purple-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-all",children:a.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"text-xs font-bold text-purple-900 uppercase tracking-wide mb-1",children:e.replace(/_/g," ")}),a.jsx("div",{className:"text-sm text-gray-800 font-medium",children:String(t)||a.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})]}),a.jsx("button",{type:"button",onClick:()=>We(me,e),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg flex-shrink-0 transition-colors",title:"Remove specification",children:a.jsx(h,{size:14})})]})},e))})]}):null})()]});const[t,s]=e[ye];return s&&0!==s.length?a.jsxs("div",{children:[a.jsx("h4",{className:"text-lg font-bold text-gray-900 mb-2 text-center",children:w(t)}),a.jsxs("p",{className:"text-sm text-gray-600 mb-6 text-center",children:[s.length," specification",1!==s.length?"s":""," available"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:s.map(e=>{var t,s;const r=e.icon,i=(null==(s=null==(t=X[me])?void 0:t.attributes)?void 0:s[e.key])||"",l="boolean"===e.type,n=""!==i&&null!=i;return a.jsxs("div",{className:"bg-white border-2 rounded-xl p-3 sm:p-4 transition-all "+(n?"border-green-300 bg-green-50 shadow-md":"border-gray-200 hover:border-purple-400 hover:shadow-lg"),children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-bold text-gray-800 mb-2 sm:mb-3 flex items-center gap-2",children:[a.jsx("div",{className:"w-6 h-6 sm:w-7 sm:h-7 rounded-lg flex items-center justify-center "+(n?"bg-green-500":"bg-gray-200"),children:a.jsx(r,{size:13,className:"sm:w-3.5 sm:h-3.5 "+(n?"text-white":"text-gray-500")})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{children:e.name}),e.unit&&a.jsxs("span",{className:"text-[9px] sm:text-[10px] text-gray-500 font-normal",children:["(",e.unit,")"]})]})]}),l?a.jsx("button",{type:"button",onClick:()=>Me(me,e.key,!i),className:"w-full py-2.5 sm:py-3 px-3 sm:px-4 border-2 rounded-lg transition-all font-bold text-xs sm:text-sm "+(i?"bg-green-500 border-green-500 text-white shadow-lg":"bg-white border-gray-300 text-gray-600 hover:border-purple-500 hover:bg-purple-50"),children:a.jsxs("div",{className:"flex items-center justify-center gap-1.5 sm:gap-2",children:[a.jsx(x,{size:14,className:"sm:w-4 sm:h-4 "+(i?"text-white":"text-gray-400")}),a.jsx("span",{children:i?"Yes":"No"})]})}):"select"===e.type&&e.options?a.jsxs("select",{value:i,onChange:t=>Me(me,e.key,t.target.value),className:"w-full py-2.5 sm:py-3 px-2.5 sm:px-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none text-xs sm:text-sm transition-colors bg-white",children:[a.jsx("option",{value:"",children:"Select..."}),e.options.map(e=>a.jsx("option",{value:e,children:e},e))]}):a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"number"===e.type?"number":"text",value:i,onChange:t=>Me(me,e.key,t.target.value),placeholder:e.placeholder||`Enter ${e.name.toLowerCase()}`,className:"w-full py-2.5 sm:py-3 px-2.5 sm:px-3 pr-9 sm:pr-10 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none text-xs sm:text-sm transition-colors",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),i&&a.jsx("button",{type:"button",onClick:()=>Me(me,e.key,""),className:"absolute right-1.5 sm:right-2 top-2.5 sm:top-3 text-gray-400 hover:text-red-600 p-1 hover:bg-red-50 rounded transition-colors",title:"Clear",children:a.jsx(h,{size:14,className:"sm:w-4 sm:h-4"})})]})]},e.key)})})]}):null})(),(()=>{var e;const t=(null==(e=X[me])?void 0:e.attributes)||{},s=Object.entries(t).reverse(),r=s.length;if(r>0){const e=ve?s:s.slice(0,3),t=r>3;return a.jsxs("div",{className:"border-t border-gray-100 pt-5 mt-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:["Added Specs ",a.jsxs("span",{className:"text-green-600",children:["(",r,")"]})]}),t&&a.jsx("button",{type:"button",onClick:()=>Ne(!ve),className:"text-xs font-semibold text-purple-600 hover:text-purple-700 transition-colors",children:ve?"↑ Show Less":`↓ Show All (${r-3} more)`})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3",children:e.map(([e,t])=>a.jsx("div",{className:"bg-white border-2 border-green-200 rounded-xl p-3 sm:p-4 shadow-sm hover:shadow-md transition-all",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"text-xs font-bold text-green-900 uppercase tracking-wide mb-1",children:e.replace(/_/g," ")}),a.jsx("div",{className:"text-sm text-gray-800 font-medium",children:String(t)||a.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})]}),a.jsx("button",{type:"button",onClick:()=>We(me,e),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg flex-shrink-0 transition-colors",title:"Remove specification",children:a.jsx(h,{size:14})})]})},e))})]})}return null})()]})]}),a.jsx("div",{className:"p-4 sm:p-5 md:p-6 pt-3 sm:pt-4",children:(()=>{const e=Object.entries(N(be)).length+1,t=ye>=e-1,s=0===ye;return a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[!s&&a.jsx("button",{type:"button",onClick:()=>je(ye-1),className:"flex-1 px-4 sm:px-6 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all font-semibold text-sm sm:text-base",children:"← Previous"}),t?a.jsx("button",{type:"button",onClick:()=>{de(!1),je(0),pe(""),he(""),Ne(!1),f.success("Specifications saved!")},className:"px-4 sm:px-6 py-3 sm:py-3.5 bg-purple-600 hover:bg-purple-700 text-white rounded-xl transition-all font-semibold shadow-lg hover:shadow-xl text-base sm:text-lg "+(s?"w-full":"flex-1"),children:"Done ✓"}):a.jsx("button",{type:"button",onClick:()=>je(ye+1),className:"px-4 sm:px-6 py-3 sm:py-3.5 bg-purple-600 hover:bg-purple-700 text-white rounded-xl transition-all font-semibold shadow-lg hover:shadow-xl text-base sm:text-lg "+(s?"w-full":"flex-1"),children:"Next →"})]})})()})]})})]}),we&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>ke(!1)}),a.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4 pointer-events-none",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-sm sm:max-w-2xl md:max-w-4xl lg:max-w-5xl xl:max-w-6xl max-h-[90vh] overflow-hidden flex flex-col pointer-events-auto",role:"dialog","aria-modal":"true","aria-labelledby":"product-specifications-modal-title",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-white flex-shrink-0",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:a.jsx(y,{className:"w-6 h-6"})}),a.jsxs("div",{children:[a.jsx("h2",{id:"product-specifications-modal-title",className:"text-2xl font-bold",children:"Product Specifications"}),a.jsx("p",{className:"text-blue-100 text-sm",children:"Add technical details and features"})]})]}),a.jsx("button",{onClick:()=>ke(!1),className:"w-10 h-10 hover:bg-white/20 rounded-lg transition-colors flex items-center justify-center","aria-label":"Close modal",children:a.jsx(h,{size:24})})]})}),a.jsx("div",{className:"px-4 sm:px-6 md:px-8 py-4 sm:py-5 md:py-6 bg-gradient-to-br from-gray-50 to-gray-100 border-b border-gray-200 flex-shrink-0",children:a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3",children:v.map(e=>{const t=e.icon,s=Pe===e.id;return a.jsxs("button",{onClick:()=>Ve(e.id),className:"flex flex-col items-center gap-1.5 sm:gap-2 p-3 sm:p-4 rounded-xl transition-all "+(s?"bg-blue-600 text-white shadow-lg scale-105":"bg-white text-gray-700 hover:bg-blue-50 hover:shadow-md border border-gray-200"),children:[a.jsx(t,{size:20,className:"sm:w-6 sm:h-6 "+(s?"text-white":"text-blue-600")}),a.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-center leading-tight",children:e.name})]},e.id)})})}),a.jsx("div",{className:"p-6 overflow-y-auto bg-white flex-1 min-h-0",children:a.jsxs("div",{className:"space-y-6",children:[(()=>{const e=Q.specification?JSON.parse(Q.specification):{},t=Object.keys(e).length;if(t>0)return a.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center",children:a.jsx(x,{size:20,className:"text-white"})}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-sm font-semibold text-green-900",children:[t," Specification",1!==t?"s":""," Added"]}),a.jsx("p",{className:"text-xs text-green-600",children:"Click any spec below to modify"})]})]}),a.jsx("button",{type:"button",onClick:()=>{window.confirm("Clear all specifications?")&&(R(e=>({...e,specification:""})),f.success("All specifications cleared"))},className:"px-3 py-2 bg-white border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors text-xs font-medium",children:"Clear All"})]})})(),a.jsxs("div",{children:[a.jsxs("div",{className:"mb-4",children:[a.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[a.jsx(b,{size:18,className:"text-blue-600"}),null==(E=v.find(e=>e.id===Pe))?void 0:E.name]}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Click on any specification to add or modify"})]}),Object.entries(N(Pe)).map(([e,t])=>0===t.length?null:a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-gray-200",children:[a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:w(e)}),a.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.length,")"]})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>{const t=e.icon,s=(Q.specification?JSON.parse(Q.specification):{})[e.key]||"",r="boolean"===e.type,i=""!==s&&null!=s;return a.jsxs("div",{className:"bg-white border rounded-lg p-4 transition-all "+(i?"border-green-400 bg-green-50":"border-gray-200 hover:border-blue-400"),children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[a.jsx(t,{size:14,className:i?"text-green-600":"text-gray-400"}),a.jsx("span",{children:e.name}),e.unit&&a.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.unit,")"]})]}),r?a.jsx("button",{type:"button",onClick:()=>Ze(e.key,!s),className:"w-full py-2.5 px-4 border-2 rounded-lg transition-all font-medium text-sm "+(s?"bg-green-500 border-green-500 text-white":"bg-white border-gray-300 text-gray-600 hover:border-blue-500 hover:bg-blue-50"),children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(x,{size:16,className:s?"text-white":"text-gray-400"}),a.jsx("span",{children:s?"Yes":"No"})]})}):"select"===e.type&&e.options?a.jsxs("select",{value:s,onChange:t=>Ze(e.key,t.target.value),className:"w-full py-2.5 px-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-sm transition-colors",children:[a.jsx("option",{value:"",children:"Select..."}),e.options.map(e=>a.jsx("option",{value:e,children:e},e))]}):a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"number"===e.type?"number":"text",value:s,onChange:t=>Ze(e.key,t.target.value),placeholder:e.placeholder||`Enter ${e.name.toLowerCase()}`,className:"w-full py-2.5 px-3 pr-10 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-sm transition-colors",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),s&&a.jsx("button",{type:"button",onClick:()=>Ze(e.key,""),className:"absolute right-2 top-2.5 text-gray-400 hover:text-red-600 p-1 hover:bg-red-50 rounded transition-colors",title:"Clear",children:a.jsx(h,{size:16})})]})]},e.key)})})]},e))]}),a.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[a.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[a.jsx(j,{size:18,className:"text-gray-600"}),"Custom Specification"]}),Ce?a.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"text",value:_e,onChange:e=>Oe(e.target.value),placeholder:"Enter custom specification name...",className:"flex-1 py-2.5 px-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm",onKeyPress:e=>{"Enter"===e.key&&_e.trim()&&Xe()},autoFocus:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),a.jsx("button",{type:"button",onClick:Xe,className:"px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Add"}),a.jsx("button",{type:"button",onClick:()=>{Se(!1),Oe("")},className:"px-4 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Cancel"})]})}):a.jsxs("button",{type:"button",onClick:()=>{Se(!0),Oe("")},className:"flex items-center justify-center gap-2 p-4 bg-white border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all w-full",children:[a.jsx(j,{className:"w-5 h-5 text-gray-400"}),a.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Add Custom Specification"})]})]}),(()=>{const e=Q.specification?JSON.parse(Q.specification):{};return Object.keys(e).length>0?a.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[a.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[a.jsx(x,{size:18,className:"text-green-600"}),"Added Specifications (",Object.keys(e).length,")"]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Object.entries(e).map(([e,t])=>a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 hover:bg-green-100 transition-colors",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-green-900 capitalize truncate",children:e.replace(/_/g," ")}),a.jsx("div",{className:"text-sm text-green-700 truncate mt-0.5",children:String(t)||"Not set"})]}),a.jsx("button",{type:"button",onClick:()=>(e=>{const t={...Q.specification?JSON.parse(Q.specification):{}};delete t[e],R(e=>({...e,specification:JSON.stringify(t)}))})(e),className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded flex-shrink-0 transition-colors",title:"Remove",children:a.jsx(h,{size:16})})]})},e))})]}):null})()]})}),a.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex-shrink-0",children:a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("span",{className:"text-sm text-gray-600",children:(()=>{const e=Q.specification?JSON.parse(Q.specification):{},t=Object.keys(e).length;return t>0?`${t} specification${1!==t?"s":""} added`:"No specifications added yet"})()}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>ke(!1),className:"px-5 py-2.5 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium",children:"Cancel"}),a.jsx("button",{type:"button",onClick:()=>{ke(!1),f.success("Specifications saved!")},className:"px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Save & Close"})]})]})})]})})]}),a.jsx(P,{...Te.props}),W&&a.jsx(_,{isOpen:Y,onClose:()=>{H(!1),Z(null)},product:W,onEdit:e=>{H(!1),I(`/lats/products/${e.id}/edit`)}})]})};export{F as default};
