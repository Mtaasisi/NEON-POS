import{y as e,j as s,d as t,G as a,M as n,p as r}from"./index-222cfb29.js";import{r as l}from"./vendor-a2ff445a.js";import{z as i,R as c,aQ as d,e as o,m,s as x,f as g,h,d as u,aP as j,j as p,aA as f,aU as N,Z as b}from"./ui-551a39a6.js";import{w as y}from"./whatsappService-37f3bd6b.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";const v=()=>{const[v,w]=l.useState([]),[S,A]=l.useState(!0),[T,M]=l.useState(!1),[k,C]=l.useState([]);l.useState(null);const[D,W]=l.useState(""),[_,P]=l.useState("Test message from LATS POS");l.useState(""),l.useEffect(()=>{E()},[]);const E=async()=>{A(!0);try{const s=await e();w(s.filter(e=>e.is_enabled))}catch(s){i.error("Failed to load integrations")}finally{A(!1)}},R=e=>{C(s=>[...s,{...e,timestamp:new Date}])},$=(e,s)=>{C(t=>{const a=[...t];return a[e]={...a[e],...s},a})},F=async e=>{const s=Date.now(),t=k.length;R({integration:e,test:"Fetch Credentials",status:"running"});try{const a=await n(e),r=Date.now()-s;a?($(t,{status:"passed",message:`Credentials fetched successfully (${Object.keys(a).length} fields) in ${r}ms`,duration:r}),i.success(`${e} credentials loaded!`)):($(t,{status:"failed",message:"Integration not found or not enabled",duration:r}),i.warning(`${e} not configured`))}catch(a){const e=Date.now()-s;$(t,{status:"failed",message:a.message,duration:e}),i.error("Credentials fetch error")}},I=e=>{switch(e){case"passed":return s.jsx(u,{className:"w-5 h-5 text-green-600"});case"failed":return s.jsx(h,{className:"w-5 h-5 text-red-600"});case"running":return s.jsx(c,{className:"w-5 h-5 text-blue-600 animate-spin"});default:return s.jsx(g,{className:"w-5 h-5 text-gray-400"})}},G=e=>{const t={sms:m,whatsapp:x,email:p,payment:f,analytics:N,ai:b,custom:j}[e.integration_type]||j;return s.jsx(t,{className:"w-5 h-5 text-blue-600"})},z={total:k.length,passed:k.filter(e=>"passed"===e.status).length,failed:k.filter(e=>"failed"===e.status).length,running:k.filter(e=>"running"===e.status).length,avgDuration:k.length>0?Math.round(k.reduce((e,s)=>e+(s.duration||0),0)/k.length):0};return S?s.jsx("div",{className:"flex items-center justify-center h-screen",children:s.jsx(c,{className:"w-8 h-8 animate-spin text-blue-600"})}):s.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[s.jsx(d,{className:"w-8 h-8 text-blue-600"}),"Integrations Testing Center"]}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Test all your integrations to ensure they're working correctly"})]}),k.length>0&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[s.jsxs(t,{className:"p-4",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Total Tests"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:z.total})]}),s.jsxs(t,{className:"p-4",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Passed"}),s.jsx("div",{className:"text-2xl font-bold text-green-600",children:z.passed})]}),s.jsxs(t,{className:"p-4",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Failed"}),s.jsx("div",{className:"text-2xl font-bold text-red-600",children:z.failed})]}),s.jsxs(t,{className:"p-4",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Running"}),s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:z.running})]}),s.jsxs(t,{className:"p-4",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Avg Duration"}),s.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[z.avgDuration,"ms"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs(t,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-xl font-semibold",children:["Enabled Integrations (",v.length,")"]}),s.jsxs(a,{onClick:E,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[s.jsx(c,{className:"w-4 h-4"}),"Refresh"]})]}),0===v.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(o,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),s.jsx("p",{children:"No enabled integrations found"}),s.jsx("p",{className:"text-sm mt-2",children:"Go to Admin Settings â†’ Integrations to enable some"})]}):s.jsx("div",{className:"space-y-3",children:v.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[G(e),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.provider_name||e.integration_name}),s.jsxs("div",{className:"text-sm text-gray-600",children:[e.integration_type,e.is_test_mode&&s.jsx("span",{className:"ml-2 text-xs text-orange-600 font-medium",children:"Test Mode"})]})]})]}),s.jsxs(a,{onClick:()=>F(e.integration_name),variant:"outline",size:"sm",className:"flex items-center gap-1",children:[s.jsx(d,{className:"w-4 h-4"}),"Test"]})]},e.id))})]}),s.jsxs(t,{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Quick Actions"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(a,{onClick:async()=>{M(!0),C([]);for(const e of v)await F(e.integration_name),await new Promise(e=>setTimeout(e,500));M(!1),i.success("All tests completed!")},disabled:T||0===v.length,className:"w-full bg-blue-600 hover:bg-blue-700 text-white flex items-center justify-center gap-2",children:T?s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"w-5 h-5 animate-spin"}),"Testing All..."]}):s.jsxs(s.Fragment,{children:[s.jsx(d,{className:"w-5 h-5"}),"Test All Integrations"]})}),s.jsxs(a,{onClick:()=>{C([]),i.success("Results cleared")},variant:"outline",className:"w-full flex items-center justify-center gap-2",disabled:0===k.length,children:[s.jsx(c,{className:"w-5 h-5"}),"Clear Results"]})]})]}),s.jsxs(t,{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Manual Tests"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Phone Number"}),s.jsx("input",{type:"tel",value:D,onChange:e=>W(e.target.value),placeholder:"e.g., +255712345678",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Message"}),s.jsx("textarea",{value:_,onChange:e=>P(e.target.value),rows:3,placeholder:"Enter test message",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs(a,{onClick:async()=>{if(!D)return void i.error("Please enter a phone number");const e=Date.now(),s=k.length;R({integration:"SMS",test:"Send Test SMS",status:"running"});try{if(!(await n("SMS_GATEWAY")))throw new Error("SMS not configured");const t=await r.sendSMS(D,_),a=Date.now()-e;t.success?($(s,{status:"passed",message:`SMS sent successfully in ${a}ms`,duration:a}),i.success("SMS test passed!")):($(s,{status:"failed",message:t.error||"Unknown error",duration:a}),i.error("SMS test failed"))}catch(t){const a=Date.now()-e;$(s,{status:"failed",message:t.message,duration:a}),i.error("SMS test error: "+t.message)}},disabled:!D||!_,className:"flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[s.jsx(m,{className:"w-4 h-4"}),"Test SMS"]}),s.jsxs(a,{onClick:async()=>{if(!D)return void i.error("Please enter a phone number");const e=Date.now(),s=k.length;R({integration:"WhatsApp",test:"Send Test WhatsApp Message",status:"running"});try{if(!(await n("WHATSAPP_GATEWAY")))throw new Error("WhatsApp not configured");const t=await y.sendWhatsAppMessage(D,_),a=Date.now()-e;t.success?($(s,{status:"passed",message:`WhatsApp message sent successfully in ${a}ms`,duration:a}),i.success("WhatsApp test passed!")):($(s,{status:"failed",message:t.error||"Unknown error",duration:a}),i.error("WhatsApp test failed"))}catch(t){const a=Date.now()-e;$(s,{status:"failed",message:t.message,duration:a}),i.error("WhatsApp test error: "+t.message)}},disabled:!D||!_,className:"flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[s.jsx(x,{className:"w-4 h-4"}),"Test WhatsApp"]})]})]})]})]}),s.jsx("div",{children:s.jsxs(t,{className:"p-6 h-full",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Test Results"}),k.length>0&&s.jsxs("span",{className:"text-sm text-gray-600",children:[k.length," test",1!==k.length?"s":""]})]}),0===k.length?s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(d,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),s.jsx("p",{className:"text-lg font-medium",children:"No tests run yet"}),s.jsx("p",{className:"text-sm mt-2",children:'Click "Test All" or test individual integrations'})]}):s.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:k.map((e,t)=>s.jsxs("div",{className:"p-4 border-2 rounded-lg transition-all "+("passed"===e.status?"border-green-200 bg-green-50":"failed"===e.status?"border-red-200 bg-red-50":"running"===e.status?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50"),children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[I(e.status),s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold text-gray-900",children:e.integration}),s.jsx("div",{className:"text-sm text-gray-600",children:e.test})]})]}),e.duration&&s.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[s.jsx(g,{className:"w-3 h-3"}),e.duration,"ms"]})]}),e.message&&s.jsx("div",{className:"text-sm mt-2 p-2 rounded "+("passed"===e.status?"bg-green-100 text-green-800":"failed"===e.status?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:e.message}),e.timestamp&&s.jsx("div",{className:"text-xs text-gray-500 mt-2",children:e.timestamp.toLocaleTimeString()})]},t))})]})})]})]})};export{v as default};
