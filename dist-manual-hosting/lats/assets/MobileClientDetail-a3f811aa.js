import{u as e,s as t,U as s,j as a,i as r,X as l,p as n,W as i}from"./index-222cfb29.js";import{r as c}from"./vendor-a2ff445a.js";import"./supabase-460661f2.js";import{z as d,i as x,s as o,P as p,ag as m,d as u,u as h,r as g,D as b,m as y,bK as f,f as j,x as N,T as v,aZ as w,o as k,t as S}from"./ui-551a39a6.js";import{a as C}from"./appointments-4d8aac45.js";import{f as _}from"./returns-0428af68.js";import{d as D,a as z}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";const P=()=>{const{clientId:P}=D(),A=z(),{currentUser:L}=e(),[W,I]=c.useState(null),[T,M]=c.useState(!0),[q,R]=c.useState("activity"),[O,B]=c.useState([]),[F,$]=c.useState([]),[V,U]=c.useState([]),[E,Q]=c.useState([]),[J,Y]=c.useState([]),[G,H]=c.useState([]),[X,K]=c.useState(null),[Z,ee]=c.useState(!1),[te,se]=c.useState([]),[ae,re]=c.useState([]),[le,ne]=c.useState([]),[ie,ce]=c.useState([]),[de,xe]=c.useState(!1),[oe,pe]=c.useState(null),[me,ue]=c.useState(!1),[he,ge]=c.useState(!1),[be,ye]=c.useState(""),[fe,je]=c.useState(!1),[Ne,ve]=c.useState(!1),[we,ke]=c.useState(""),[Se,Ce]=c.useState(""),[_e,De]=c.useState(!1),[ze,Pe]=c.useState(!1),[Ae,Le]=c.useState(!1),[We,Ie]=c.useState(!1),[Te,Me]=c.useState(!1),[qe,Re]=c.useState(!1),[Oe,Be]=c.useState(""),[Fe,$e]=c.useState(""),[Ve,Ue]=c.useState(""),[Ee,Qe]=c.useState(""),[Je,Ye]=c.useState(!1),[Ge,He]=c.useState({});c.useEffect(()=>{P&&(Xe(),Ke(),Ze(),et())},[P]);const Xe=async()=>{if(P){M(!0);try{const{data:e,error:s}=await t.from("customers").select("*").eq("id",P).single();if(s)throw s;const a={...e,totalSpent:e.total_spent,createdAt:e.created_at,updatedAt:e.updated_at};I(a);const{data:r}=await t.from("lats_sales").select("*").eq("customer_id",P).order("created_at",{ascending:!1}).limit(10);r&&B(r)}catch(e){d.error("Failed to load client details")}finally{M(!1)}}},Ke=async()=>{if(P){ee(!0);try{const{data:s}=await t.from("devices").select("*").eq("customer_id",P).order("created_at",{ascending:!1});if(s){const e=s.map(e=>({...e,customerId:e.customer_id,createdAt:e.created_at}));$(e)}const{data:a}=await t.from("customer_payments").select("*").eq("customer_id",P).order("payment_date",{ascending:!1});if(a){const e=a.map(e=>({id:e.id,customerId:e.customer_id,deviceId:e.device_id,amount:e.amount,method:e.method,type:e.payment_type,status:e.status,date:e.payment_date,createdAt:e.created_at}));U(e)}const{data:r}=await t.from("lats_sales").select("*").eq("customer_id",P).order("created_at",{ascending:!1});if(r&&(Q(r),r.length>0)){const e=r.map(e=>e.id),{data:s}=await t.from("lats_sale_items").select("*").in("sale_id",e);s&&Y(s.map(e=>e))}try{const{data:e}=await t.from("lats_spare_part_usage").select("*").eq("customer_id",P).order("used_at",{ascending:!1});e&&H(e)}catch(e){}const l=tt(P,r||[],s||[],a||[]);K(l)}catch(e){}finally{ee(!1)}}},Ze=async()=>{if(P){xe(!0);try{try{const e=await C(P);se(e||[])}catch(e){se([])}try{const e=await _(P);re(e||[])}catch(e){re([])}try{const{data:e}=await t.from("customer_communications").select("*").eq("customer_id",P).order("sent_at",{ascending:!1}).limit(50);e&&ne(e)}catch(e){ne([])}try{const{data:e}=await t.from("customers").select("id, name, phone, created_at, total_spent").eq("referred_by",P).order("created_at",{ascending:!1});e&&ce(e)}catch(e){ce([])}}catch(e){}finally{xe(!1)}}},et=async()=>{if(P){ue(!0);try{const e=await s(P);pe(e)}catch(e){pe(null)}finally{ue(!1)}}},tt=(e,t,s,a)=>{const r=t.reduce((e,t)=>e+(t.total_amount||0),0),l=s.filter(t=>t.customer_id===e).map(e=>e.id),n=a.filter(e=>e.deviceId&&l.includes(e.deviceId)),i=n.reduce((e,t)=>e+(t.amount||0),0),c=n.filter(e=>"deposit"===e.type).reduce((e,t)=>e+(t.amount||0),0),d=n.filter(e=>"payment"===e.type).reduce((e,t)=>e+(t.amount||0),0),x=n.filter(e=>"refund"===e.type).reduce((e,t)=>e+(t.amount||0),0),o=r+i,p=t.length>0?r/t.length:0,m=t.length>0?new Date(t[0].created_at):null,u=m?Math.floor((Date.now()-m.getTime())/864e5):null,h=new Set(J.map(e=>e.product_id)).size,g=J.reduce((e,t)=>e+(t.quantity||0),0),b=(null==W?void 0:W.createdAt)||(null==W?void 0:W.created_at)||Date.now(),y=Math.floor((Date.now()-new Date(b).getTime())/864e5),f=Math.max(1,Math.floor(y/30)),j=t.length/f;let N="Regular Customer";return o>1e7?N="Diamond Customer":o>5e6?N="Platinum Customer":o>1e6?N="Gold Customer":o>5e5?N="VIP Customer":o>1e5&&(N="Top Customer"),{totalSpent:o,totalPosSpent:r,totalDeviceSpent:i,deviceBreakdown:{payments:d,deposits:c,refunds:x,totalPayments:i},averageOrderValue:p,lastPurchaseDate:m,daysSinceLastPurchase:u,totalOrders:t.length,totalDevices:s.length,activeRepairs:s.filter(e=>["assigned","diagnosis-started","awaiting-parts","in-repair","reassembled-testing"].includes(e.status)).length,completedRepairs:s.filter(e=>"done"===e.status).length,uniqueProducts:h,totalItems:g,purchaseFrequency:Number(j.toFixed(2)),customerRanking:N}},st=async e=>{if(P)try{await l(P,e),await et()}catch(t){}},at=async()=>{if(be.trim()&&W){je(!0);try{const s=W.phone.replace(/\D/g,""),a=await n.sendSMS(s,be);if(a.success){try{await t.from("customer_communications").insert({customer_id:P,type:"sms",message:be,status:"sent",phone_number:s,sent_by:null==L?void 0:L.id,sent_at:(new Date).toISOString()})}catch(e){}d.success("SMS sent successfully!"),ye(""),ge(!1),await Ze(),await st("sms_sent")}else d.error(`SMS Failed: ${a.error||"Unknown error"}`)}catch(e){d.error((null==e?void 0:e.message)||"Failed to send SMS")}finally{je(!1)}}};return c.useEffect(()=>{qe&&W&&He({name:W.name||"",phone:W.phone||"",email:W.email||"",whatsapp:W.whatsapp||"",address:W.address||"",city:W.city||"",country:W.country||"",notes:"string"==typeof W.notes?W.notes:""})},[qe,W]),T?a.jsx("div",{className:"flex flex-col h-full bg-white",children:a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-3"}),a.jsx("p",{className:"text-gray-500",children:"Loading client..."})]})})}):W?a.jsxs("div",{className:"flex flex-col h-full bg-white",children:[a.jsx("div",{className:"bg-white border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[a.jsxs("button",{onClick:()=>A("/mobile/clients"),className:"flex items-center gap-1 text-blue-500",children:[a.jsx(x,{size:20}),a.jsx("span",{className:"text-[17px]",children:"Back"})]}),a.jsx("h1",{className:"text-[17px] font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2",children:W.name}),a.jsx("button",{onClick:()=>A(`/mobile/clients/${P}/edit`),className:"text-blue-500 text-[17px]",children:"Edit"})]})}),a.jsx("div",{className:"bg-white px-2 py-4 border-b border-gray-200",children:a.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[a.jsxs("button",{onClick:()=>{ge(!0),st("sms_opened")},className:"flex flex-col items-center gap-1",children:[a.jsx(o,{size:24,className:"text-blue-500",strokeWidth:1.5}),a.jsx("span",{className:"text-[9px] text-gray-600",children:"SMS"})]}),a.jsxs("button",{onClick:()=>{(null==W?void 0:W.phone)&&(window.location.href=`tel:${W.phone}`)},className:"flex flex-col items-center gap-1",children:[a.jsx(p,{size:24,className:"text-blue-500",strokeWidth:1.5}),a.jsx("span",{className:"text-[9px] text-gray-600",children:"call"})]}),a.jsxs("button",{onClick:()=>ve(!0),className:"flex flex-col items-center gap-1",children:[a.jsx(m,{size:24,className:"text-blue-500",strokeWidth:1.5}),a.jsx("span",{className:"text-[9px] text-gray-600",children:"points"})]}),a.jsxs("button",{onClick:()=>{Pe(!0),st("checkin_opened")},className:"flex flex-col items-center gap-1",children:[a.jsx(u,{size:24,className:"text-blue-500",strokeWidth:1.5}),a.jsx("span",{className:"text-[9px] text-gray-600",children:"check-in"})]}),a.jsxs("button",{onClick:()=>{Me(!0),st("appointment_opened")},className:"flex flex-col items-center gap-1",children:[a.jsx(h,{size:24,className:"text-blue-500",strokeWidth:1.5}),a.jsx("span",{className:"text-[9px] text-gray-600",children:"schedule"})]}),a.jsxs("button",{onClick:()=>Re(!0),className:"flex flex-col items-center gap-1",children:[a.jsx(g,{size:24,className:"text-blue-500",strokeWidth:1.5}),a.jsx("span",{className:"text-[9px] text-gray-600",children:"edit"})]})]})}),a.jsx("div",{className:"bg-white px-4 py-3",children:a.jsxs("div",{className:"bg-gray-100 rounded-lg p-0.5 flex",children:[a.jsx("button",{onClick:()=>R("activity"),className:"flex-1 py-2 text-center text-[12px] font-medium rounded-md transition-all "+("activity"===q?"bg-white text-gray-900 font-semibold shadow-sm":"text-gray-600"),children:"Activity"}),a.jsx("button",{onClick:()=>R("info"),className:"flex-1 py-2 text-center text-[12px] font-medium rounded-md transition-all "+("info"===q?"bg-white text-gray-900 font-semibold shadow-sm":"text-gray-600"),children:"Info"}),a.jsx("button",{onClick:()=>R("journey"),className:"flex-1 py-2 text-center text-[12px] font-medium rounded-md transition-all "+("journey"===q?"bg-white text-gray-900 font-semibold shadow-sm":"text-gray-600"),children:"Journey"})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto pb-20",children:["activity"===q&&a.jsxs("div",{className:"bg-white space-y-4 pb-6",children:[oe&&a.jsx("div",{className:"px-4 py-3 bg-blue-50 border-b border-blue-100",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-[13px] font-semibold text-gray-900",children:oe.statusReason||"Active Customer"}),null!==oe.daysSinceActivity&&a.jsxs("div",{className:"text-[11px] text-gray-600 mt-0.5",children:["Last activity: ",0===oe.daysSinceActivity?"Today":`${oe.daysSinceActivity} days ago`]})]}),(null==X?void 0:X.customerRanking)&&a.jsx("div",{className:"bg-blue-500 text-white px-3 py-1 rounded-full text-[10px] font-semibold",children:X.customerRanking})]})}),a.jsxs("div",{className:"px-4 py-4 grid grid-cols-4 gap-2 border-b border-gray-200",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-xl font-semibold text-gray-900",children:(null==X?void 0:X.totalOrders)||E.length}),a.jsx("div",{className:"text-[10px] text-gray-500 mt-1",children:"Orders"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-xl font-semibold text-gray-900",children:(null==X?void 0:X.totalDevices)||F.length}),a.jsx("div",{className:"text-[10px] text-gray-500 mt-1",children:"Devices"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-xl font-semibold text-gray-900",children:r((null==X?void 0:X.totalSpent)||0).replace("Tsh ","")}),a.jsx("div",{className:"text-[10px] text-gray-500 mt-1",children:"Spent"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-xl font-semibold text-blue-500",children:W.points||W.loyaltyPoints||0}),a.jsx("div",{className:"text-[10px] text-gray-500 mt-1",children:"Points"})]})]}),X&&a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(b,{size:16,className:"text-green-500"}),"Financial Breakdown"]}),a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm",children:[a.jsxs("div",{className:"px-4 py-3 flex justify-between items-center border-b border-gray-100",children:[a.jsx("span",{className:"text-[15px] text-gray-600",children:"POS Sales"}),a.jsx("span",{className:"text-[16px] font-semibold text-gray-900",children:r(X.totalPosSpent||0)})]}),a.jsxs("div",{className:"px-4 py-3 flex justify-between items-center border-b border-gray-100",children:[a.jsx("span",{className:"text-[15px] text-gray-600",children:"Device Payments"}),a.jsx("span",{className:"text-[16px] font-semibold text-gray-900",children:r(X.totalDeviceSpent||0)})]}),X.deviceBreakdown&&a.jsxs("div",{className:"px-4 py-2 bg-gray-50 space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-[13px]",children:[a.jsx("span",{className:"text-gray-500 ml-3",children:"â€¢ Deposits"}),a.jsx("span",{className:"text-blue-600 font-medium",children:r(X.deviceBreakdown.deposits||0)})]}),a.jsxs("div",{className:"flex justify-between text-[13px]",children:[a.jsx("span",{className:"text-gray-500 ml-3",children:"â€¢ Payments"}),a.jsx("span",{className:"text-green-600 font-medium",children:r(X.deviceBreakdown.payments||0)})]}),X.deviceBreakdown.refunds>0&&a.jsxs("div",{className:"flex justify-between text-[13px]",children:[a.jsx("span",{className:"text-gray-500 ml-3",children:"â€¢ Refunds"}),a.jsxs("span",{className:"text-red-600 font-medium",children:["-",r(X.deviceBreakdown.refunds||0)]})]})]}),a.jsxs("div",{className:"px-4 py-3 bg-green-50 flex justify-between items-center",children:[a.jsx("span",{className:"text-[16px] font-semibold text-gray-900",children:"Total Spent"}),a.jsx("span",{className:"text-[18px] font-bold text-green-600",children:r(X.totalSpent||0)})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-3",children:[a.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center shadow-sm",children:[a.jsx("div",{className:"text-[11px] text-gray-500 uppercase tracking-wide mb-1",children:"Avg Order"}),a.jsx("div",{className:"text-[17px] font-bold text-gray-900",children:r(X.averageOrderValue||0).replace("Tsh ","")})]}),a.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center shadow-sm",children:[a.jsx("div",{className:"text-[11px] text-gray-500 uppercase tracking-wide mb-1",children:"Frequency"}),a.jsxs("div",{className:"text-[17px] font-bold text-gray-900",children:[X.purchaseFrequency,"/mo"]})]}),X.uniqueProducts>0&&a.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center shadow-sm",children:[a.jsx("div",{className:"text-[11px] text-gray-500 uppercase tracking-wide mb-1",children:"Products"}),a.jsx("div",{className:"text-[17px] font-bold text-gray-900",children:X.uniqueProducts})]}),X.totalItems>0&&a.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center shadow-sm",children:[a.jsx("div",{className:"text-[11px] text-gray-500 uppercase tracking-wide mb-1",children:"Total Items"}),a.jsx("div",{className:"text-[17px] font-bold text-gray-900",children:X.totalItems})]})]})]}),F.length>0&&a.jsxs("div",{className:"px-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide flex items-center gap-2",children:[a.jsx(y,{size:16,className:"text-blue-500"}),"Repairs (",F.length,")"]}),a.jsxs("span",{className:"text-[11px] px-2 py-1 bg-blue-100 text-blue-600 rounded-full font-semibold",children:[(null==X?void 0:X.activeRepairs)||0," active"]})]}),a.jsxs("div",{className:"space-y-2",children:[F.slice(0,5).map(e=>{const t=V.filter(t=>t.deviceId===e.id&&"completed"===t.status).reduce((e,t)=>e+(Number(t.amount)||0),0);return a.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"text-[15px] font-semibold text-gray-900",children:[e.brand," ",e.model]}),a.jsx("div",{className:"text-[13px] text-gray-600 mt-1 line-clamp-2",children:e.issueDescription})]}),a.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full font-bold uppercase "+("done"===e.status?"bg-green-100 text-green-700":"failed"===e.status?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:e.status.replace(/-/g," ")})]}),a.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-gray-100",children:[a.jsx("span",{className:"text-[12px] text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),t>0&&a.jsx("span",{className:"text-[13px] text-green-600 font-semibold",children:r(t)})]})]},e.id)}),F.length>5&&a.jsxs("button",{className:"w-full text-center text-[14px] text-blue-500 py-2 hover:bg-gray-50 active:bg-gray-100 rounded-lg transition-colors font-medium",children:["View all ",F.length," devices"]})]})]}),a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(f,{size:16,className:"text-green-500"}),"Recent Sales (",E.length,")"]}),E.length>0?a.jsxs("div",{className:"space-y-2",children:[E.slice(0,5).map(e=>a.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"text-[15px] font-semibold text-gray-900",children:["Sale #",e.sale_number||e.id.slice(0,8)]}),a.jsxs("div",{className:"text-[13px] text-gray-500 mt-1 flex items-center gap-1",children:[a.jsx(j,{size:12}),new Date(e.created_at).toLocaleDateString()]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-[16px] font-bold text-green-600",children:["TSh ",(e.total_amount||0).toLocaleString()]}),a.jsx("div",{className:"text-[12px] text-gray-500 capitalize mt-1",children:e.payment_method})]})]})},e.id)),E.length>5&&a.jsxs("button",{className:"w-full text-center text-[14px] text-blue-500 py-2 hover:bg-gray-50 active:bg-gray-100 rounded-lg transition-colors font-medium",children:["View all ",E.length," sales"]})]}):a.jsxs("div",{className:"text-center py-8 text-gray-400",children:[a.jsx(f,{size:36,className:"mx-auto mb-2",strokeWidth:1.5}),a.jsx("p",{className:"text-[14px]",children:"No sales yet"})]})]}),te.length>0&&a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(h,{size:16,className:"text-purple-500"}),"Appointments (",te.length,")"]}),a.jsx("div",{className:"space-y-2",children:te.slice(0,3).map(e=>a.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"text-[15px] font-semibold text-gray-900 capitalize",children:e.service_type}),a.jsxs("div",{className:"text-[13px] text-gray-500 mt-1",children:[new Date(e.appointment_date).toLocaleDateString()," â€¢ ",e.appointment_time]})]}),a.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full font-bold uppercase "+("completed"===e.status?"bg-green-100 text-green-700":"confirmed"===e.status?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"),children:e.status})]})},e.id))})]}),le.length>0&&a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(o,{size:16,className:"text-green-500"}),"Messages (",le.length,")"]}),a.jsx("div",{className:"space-y-2",children:le.slice(0,3).map((e,t)=>a.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsx("span",{className:"text-[11px] font-bold text-gray-500 uppercase tracking-wide",children:e.type||"SMS"}),a.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-bold uppercase "+("delivered"===e.status?"bg-green-100 text-green-700":"sent"===e.status?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"),children:e.status})]}),a.jsx("div",{className:"text-[14px] text-gray-900 mb-2 line-clamp-2",children:e.message}),a.jsx("div",{className:"text-[12px] text-gray-500",children:new Date(e.created_at||e.sent_at).toLocaleString()})]},t))})]}),le.length>0&&a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(o,{size:16,className:"text-green-500"}),"Messages (",le.length,")"]}),a.jsx("div",{className:"space-y-2",children:le.slice(0,3).map((e,t)=>a.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsx("span",{className:"text-[11px] font-bold text-gray-500 uppercase tracking-wide",children:e.type||"SMS"}),a.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-bold uppercase "+("delivered"===e.status?"bg-green-100 text-green-700":"sent"===e.status?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"),children:e.status})]}),a.jsx("div",{className:"text-[14px] text-gray-900 mb-2 line-clamp-2",children:e.message}),a.jsx("div",{className:"text-[12px] text-gray-500",children:new Date(e.created_at||e.sent_at).toLocaleString()})]},t))})]}),J.length>0&&a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(N,{size:16,className:"text-indigo-500"}),"Purchased Products (",J.length,")"]}),a.jsxs("div",{className:"space-y-2",children:[J.slice(0,5).map((e,t)=>{var s;return a.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"text-[15px] font-semibold text-gray-900",children:["Product #",null==(s=e.product_id)?void 0:s.slice(0,8)]}),a.jsxs("div",{className:"text-[13px] text-gray-500 mt-1",children:["Qty: ",e.quantity," Ã— ",r(e.unit_price||0)]})]}),a.jsx("div",{className:"text-[16px] font-bold text-gray-900",children:r(e.total_price||0)})]})},t)}),J.length>5&&a.jsxs("button",{className:"w-full text-center text-[14px] text-blue-500 py-2 hover:bg-gray-50 active:bg-gray-100 rounded-lg transition-colors font-medium",children:["View all ",J.length," items"]})]})]}),G.length>0&&a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(v,{size:16,className:"text-orange-500"}),"Spare Parts Used (",G.length,")"]}),a.jsxs("div",{className:"space-y-2",children:[G.slice(0,5).map(e=>a.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"text-[15px] font-semibold text-gray-900",children:e.spare_part_name||"Spare Part"}),a.jsxs("div",{className:"text-[13px] text-gray-500 mt-1",children:["Qty: ",e.quantity||1," â€¢ ",new Date(e.used_at).toLocaleDateString()]})]}),e.cost&&a.jsx("div",{className:"text-[16px] font-bold text-gray-900",children:r(e.cost)})]})},e.id)),G.length>5&&a.jsxs("button",{className:"w-full text-center text-[14px] text-blue-500 py-2 hover:bg-gray-50 active:bg-gray-100 rounded-lg transition-colors font-medium",children:["View all ",G.length," parts"]})]})]}),ae.length>0&&a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(w,{size:16,className:"text-red-500"}),"Returns & Warranty (",ae.length,")"]}),a.jsx("div",{className:"space-y-2",children:ae.map(e=>a.jsxs("div",{className:"bg-white rounded-xl border border-red-200 p-3 shadow-sm",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"text-[15px] font-semibold text-gray-900",children:e.reason||"Product Return"}),a.jsx("div",{className:"text-[13px] text-gray-500 mt-1",children:new Date(e.created_at).toLocaleDateString()})]}),a.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full font-bold uppercase "+("completed"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:e.status})]}),e.refund_amount&&a.jsx("div",{className:"pt-2 border-t border-gray-100",children:a.jsxs("div",{className:"text-[14px] text-red-600 font-semibold",children:["Refund: ",r(e.refund_amount)]})})]},e.id))})]}),ie.length>0&&a.jsxs("div",{className:"px-4",children:[a.jsxs("h3",{className:"text-[13px] font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[a.jsx(k,{size:16,className:"text-purple-500"}),"Customers Referred (",ie.length,")"]}),a.jsxs("div",{className:"space-y-2",children:[ie.slice(0,3).map(e=>a.jsx("div",{className:"bg-white rounded-xl border border-purple-200 p-3 shadow-sm",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"text-[15px] font-semibold text-gray-900",children:e.name}),a.jsx("div",{className:"text-[13px] text-gray-500 mt-1",children:e.phone}),a.jsxs("div",{className:"text-[12px] text-gray-400 mt-1",children:["Joined ",new Date(e.created_at).toLocaleDateString()]})]}),e.total_spent>0&&a.jsx("div",{className:"text-[16px] font-bold text-purple-600",children:r(e.total_spent)})]})},e.id)),ie.length>3&&a.jsxs("button",{className:"w-full text-center text-[14px] text-blue-500 py-2 hover:bg-gray-50 active:bg-gray-100 rounded-lg transition-colors font-medium",children:["View all ",ie.length," referrals"]})]})]})]}),"info"===q&&a.jsxs("div",{className:"bg-white",children:[a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Name"}),a.jsx("span",{className:"text-gray-900 text-[15px] text-right font-medium",children:W.name})]}),W.phone&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"mobile"}),a.jsx("a",{href:`tel:${W.phone}`,className:"text-blue-500 text-[15px]",children:W.phone})]}),W.whatsapp&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"WhatsApp"}),a.jsx("a",{href:`https://wa.me/${W.whatsapp.replace(/\D/g,"")}`,className:"text-blue-500 text-[15px]",children:W.whatsapp})]}),W.email&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"email"}),a.jsx("a",{href:`mailto:${W.email}`,className:"text-blue-500 text-[15px]",children:W.email})]}),W.gender&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Gender"}),a.jsx("span",{className:"text-gray-900 text-[15px] capitalize",children:W.gender})]}),W.birthMonth&&W.birthDay&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Birthday"}),a.jsxs("span",{className:"text-gray-900 text-[15px]",children:[W.birthMonth,"/",W.birthDay]})]}),W.address&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-start border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Address"}),a.jsx("span",{className:"text-gray-900 text-[15px] text-right max-w-[60%]",children:W.address})]}),W.city&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"City"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:W.city})]}),W.country&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Country"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:W.country})]}),W.website&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Website"}),a.jsx("a",{href:W.website.startsWith("http")?W.website:`https://${W.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 text-[15px]",children:W.website})]}),W.loyaltyLevel&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Loyalty Level"}),a.jsx("span",{className:"text-gray-900 text-[15px] font-medium",children:W.loyaltyLevel})]}),W.colorTag&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Tag"}),a.jsx("span",{className:"text-gray-900 text-[15px] capitalize",children:W.colorTag})]}),(void 0!==W.points||void 0!==W.loyaltyPoints||void 0!==W.loyalty_points)&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Loyalty Points"}),a.jsxs("span",{className:"text-blue-500 text-[15px]",children:[W.points||W.loyaltyPoints||W.loyalty_points||0," pts"]})]}),(void 0!==W.totalSpent||void 0!==W.total_purchases)&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Total Spent"}),a.jsxs("span",{className:"text-gray-900 text-[15px]",children:["TSh ",(W.totalSpent||W.total_purchases||0).toLocaleString()]})]}),void 0!==W.totalPurchases&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Total Purchases"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:W.totalPurchases})]}),W.lastPurchaseDate&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Last Purchase"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:new Date(W.lastPurchaseDate).toLocaleDateString()})]}),void 0!==W.totalCalls&&W.totalCalls>0&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Total Calls"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:W.totalCalls})]}),W.callLoyaltyLevel&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Call Level"}),a.jsx("span",{className:"text-gray-900 text-[15px] font-medium",children:W.callLoyaltyLevel})]}),W.lastCallDate&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Last Call"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:new Date(W.lastCallDate).toLocaleDateString()})]}),W.branchName&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Branch"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:W.branchName})]}),W.referralSource&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Referral Source"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:W.referralSource})]}),a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Status"}),a.jsx("span",{className:"text-[15px] font-medium "+(W.isActive?"text-green-600":"text-red-600"),children:!1!==W.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Customer Since"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:new Date(W.createdAt||W.joinedDate||W.created_at).toLocaleDateString()})]}),W.lastVisit&&a.jsxs("div",{className:"px-5 py-4 flex justify-between items-center border-b border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Last Visit"}),a.jsx("span",{className:"text-gray-900 text-[15px]",children:new Date(W.lastVisit).toLocaleDateString()})]}),W.notes&&a.jsxs("div",{className:"px-5 py-4 border-b border-gray-200",children:[a.jsx("div",{className:"text-gray-900 text-[15px] mb-2",children:"Notes"}),a.jsx("div",{className:"text-gray-600 text-[15px]",children:"string"==typeof W.notes?W.notes:Array.isArray(W.notes)&&W.notes.length>0?W.notes[W.notes.length-1].content||W.notes[W.notes.length-1]:""})]})]}),"journey"===q&&a.jsxs("div",{className:"bg-[#f2f2f7] space-y-3 pb-6",children:[a.jsxs("div",{className:"px-4 py-4 bg-white",children:[a.jsx("h2",{className:"text-[17px] font-semibold text-gray-900 mb-1",children:"Customer Journey"}),a.jsx("p",{className:"text-[14px] text-gray-500",children:"Complete timeline of all interactions"})]}),a.jsx("div",{className:"px-4",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-1 bg-gradient-to-b from-blue-200 via-purple-200 to-green-200 rounded-full"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"relative flex gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center flex-shrink-0 z-10 shadow-md",children:a.jsx(S,{size:18,className:"text-white",strokeWidth:2.5})}),a.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:[a.jsx("div",{className:"font-semibold text-[15px] text-gray-900",children:"Customer Created"}),a.jsx("div",{className:"text-[13px] text-gray-500 mt-1",children:new Date(W.createdAt||W.created_at).toLocaleDateString()})]})]}),F.slice(0,5).map(e=>a.jsxs("div",{className:"relative flex gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center flex-shrink-0 z-10 shadow-md",children:a.jsx(y,{size:18,className:"text-white",strokeWidth:2.5})}),a.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:[a.jsxs("div",{className:"font-semibold text-[15px] text-gray-900",children:[e.brand," ",e.model]}),a.jsx("div",{className:"text-[13px] text-gray-600 mt-1 line-clamp-2",children:e.issueDescription}),a.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-gray-100",children:[a.jsx("span",{className:"text-[12px] text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),a.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full font-bold uppercase "+("done"===e.status?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"),children:e.status})]})]})]},e.id)),E.slice(0,5).map(e=>a.jsxs("div",{className:"relative flex gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center flex-shrink-0 z-10 shadow-md",children:a.jsx(f,{size:18,className:"text-white",strokeWidth:2.5})}),a.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:[a.jsxs("div",{className:"font-semibold text-[15px] text-gray-900",children:["Sale #",e.sale_number||e.id.slice(0,8)]}),a.jsxs("div",{className:"flex justify-between items-center mt-2",children:[a.jsx("span",{className:"text-[13px] text-gray-500",children:new Date(e.created_at).toLocaleDateString()}),a.jsxs("span",{className:"text-[15px] font-bold text-green-600",children:["TSh ",(e.total_amount||0).toLocaleString()]})]})]})]},e.id)),te.slice(0,3).map(e=>a.jsxs("div",{className:"relative flex gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center flex-shrink-0 z-10 shadow-md",children:a.jsx(h,{size:18,className:"text-white",strokeWidth:2.5})}),a.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:[a.jsx("div",{className:"font-semibold text-[15px] text-gray-900 capitalize",children:e.service_type}),a.jsxs("div",{className:"text-[13px] text-gray-500 mt-1",children:[new Date(e.appointment_date).toLocaleDateString()," â€¢ ",e.appointment_time]})]})]},e.id)),le.slice(0,3).map((e,t)=>{var s;return a.jsxs("div",{className:"relative flex gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-500 flex items-center justify-center flex-shrink-0 z-10 shadow-md",children:a.jsx(o,{size:18,className:"text-white",strokeWidth:2.5})}),a.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-gray-200 p-3 shadow-sm",children:[a.jsxs("div",{className:"font-semibold text-[15px] text-gray-900",children:[(null==(s=e.type)?void 0:s.toUpperCase())||"SMS"," Message"]}),a.jsx("div",{className:"text-[13px] text-gray-600 mt-1 line-clamp-2",children:e.message}),a.jsx("div",{className:"text-[12px] text-gray-500 mt-2",children:new Date(e.sent_at||e.created_at).toLocaleDateString()})]})]},t)})]})]})})]})]}),he&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:()=>ge(!1),children:a.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[90vh] overflow-y-auto animate-slide-up",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 sticky top-0 bg-white z-10",children:[a.jsx("button",{onClick:()=>ge(!1),className:"text-blue-500 text-[17px]",children:"Cancel"}),a.jsx("h3",{className:"text-[17px] font-semibold text-gray-900",children:"Send SMS"}),a.jsx("button",{onClick:at,disabled:fe||!be.trim(),className:"text-blue-500 text-[17px] font-semibold disabled:text-gray-400",children:fe?"Sending...":"Send"})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsx("div",{className:"border-t border-b border-gray-200 -mx-4",children:a.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"To"}),a.jsx("span",{className:"text-gray-900 text-[15px] font-medium",children:null==W?void 0:W.phone})]})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Message"}),a.jsx("textarea",{value:be,onChange:e=>ye(e.target.value),rows:6,className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Type your message...",style:{WebkitAppearance:"none"},autoFocus:!0}),a.jsxs("div",{className:"text-[13px] text-gray-400 mt-2 px-1",children:[be.length," characters"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Quick Templates"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("button",{onClick:()=>ye(`Hi ${null==W?void 0:W.name}, your order is ready for pickup!`),className:"w-full p-3 bg-gray-50 rounded-lg text-left text-[14px] text-gray-700 hover:bg-gray-100 active:bg-gray-200 transition-colors",children:"ðŸ“¦ Order Ready"}),a.jsx("button",{onClick:()=>ye(`Hi ${null==W?void 0:W.name}, thank you for your purchase!`),className:"w-full p-3 bg-gray-50 rounded-lg text-left text-[14px] text-gray-700 hover:bg-gray-100 active:bg-gray-200 transition-colors",children:"ðŸ™ Thank You"})]})]})]}),a.jsx("div",{className:"px-4 pb-4 pt-2",children:a.jsx("button",{onClick:at,disabled:fe||!be.trim(),className:"w-full py-4 bg-blue-500 text-white rounded-xl font-semibold text-[17px] disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-blue-600 active:bg-blue-700 transition-all shadow-sm",children:fe?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Sending..."]}):"Send SMS"})})]})}),Ne&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:()=>ve(!1),children:a.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[90vh] overflow-y-auto animate-slide-up",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 sticky top-0 bg-white z-10",children:[a.jsx("button",{onClick:()=>ve(!1),className:"text-blue-500 text-[17px]",children:"Cancel"}),a.jsx("h3",{className:"text-[17px] font-semibold text-gray-900",children:"Manage Points"}),a.jsx("button",{onClick:async()=>{if(we&&W){De(!0);try{const s=parseInt(we);if(isNaN(s))return void d.error("Invalid points amount");const a=(W.points||0)+s,{error:r}=await t.from("customers").update({points:a}).eq("id",P);if(r)throw r;try{await t.from("loyalty_points_transactions").insert({customer_id:P,points:s,transaction_type:s>0?"earned":"redeemed",reason:Se||"Manual adjustment",created_by:null==L?void 0:L.id,created_at:(new Date).toISOString()})}catch(e){}d.success(`${s>0?"Added":"Deducted"} ${Math.abs(s)} points!`),I({...W,points:a}),ke(""),Ce(""),ve(!1),await st("points_updated")}catch(s){d.error((null==s?void 0:s.message)||"Failed to update points")}finally{De(!1)}}},disabled:_e||!we,className:"text-blue-500 text-[17px] font-semibold disabled:text-gray-400",children:_e?"Saving...":"Done"})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"text-center py-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl",children:[a.jsx("div",{className:"text-[13px] text-blue-100 uppercase tracking-wide mb-2",children:"Current Points"}),a.jsx("div",{className:"text-[48px] font-bold text-white",children:(null==W?void 0:W.points)||0}),a.jsx("div",{className:"text-[15px] text-blue-100",children:"loyalty points"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Adjust Points"}),a.jsx("div",{className:"relative",children:a.jsx("input",{type:"number",value:we,onChange:e=>ke(e.target.value),className:"w-full px-4 py-4 bg-[#f2f2f7] border-0 rounded-xl text-[20px] font-semibold text-center text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",style:{WebkitAppearance:"none"},autoFocus:!0})}),a.jsx("div",{className:"text-[13px] text-gray-500 mt-2 text-center px-1",children:"Use positive numbers to add, negative to remove"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Quick Add"}),a.jsx("div",{className:"grid grid-cols-4 gap-2",children:[10,25,50,100].map(e=>a.jsxs("button",{onClick:()=>ke(e.toString()),className:"py-3 bg-gray-100 text-gray-900 rounded-xl text-[15px] font-semibold hover:bg-gray-200 active:bg-gray-300 transition-colors",children:["+",e]},e))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Reason (Optional)"}),a.jsx("input",{type:"text",value:Se,onChange:e=>Ce(e.target.value),className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"E.g., Bonus points, Purchase return",style:{WebkitAppearance:"none"}})]}),we&&a.jsx("div",{className:"p-4 rounded-xl "+(parseInt(we)>=0?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:`text-[13px] ${parseInt(we)>=0?"text-green-600":"text-red-600"} font-medium mb-1`,children:parseInt(we)>=0?"Adding Points":"Removing Points"}),a.jsxs("div",{className:"text-[24px] font-bold "+(parseInt(we)>=0?"text-green-600":"text-red-600"),children:[parseInt(we)>=0?"+":"",we]}),a.jsxs("div",{className:"text-[15px] text-gray-600 mt-2",children:["New balance: ",((null==W?void 0:W.points)||0)+parseInt(we||"0")," points"]})]})})]})]})}),ze&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:()=>Pe(!1),children:a.jsx("div",{className:"w-[90%] max-w-sm bg-white rounded-2xl overflow-hidden shadow-2xl animate-scale-up",onClick:e=>e.stopPropagation(),children:Ae?a.jsxs("div",{className:"text-center py-8 px-6",children:[a.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(u,{size:40,className:"text-green-600",strokeWidth:2.5})}),a.jsx("h4",{className:"text-[20px] font-bold text-gray-900 mb-2",children:"Check-in Successful!"}),a.jsx("p",{className:"text-[16px] text-gray-600 mb-1",children:"20 points awarded"}),a.jsxs("p",{className:"text-[14px] text-gray-500",children:["to ",null==W?void 0:W.name]}),a.jsx("button",{onClick:()=>{Pe(!1),Le(!1)},className:"mt-6 w-full py-3.5 bg-blue-500 text-white rounded-xl font-semibold text-[17px] hover:bg-blue-600 active:bg-blue-700 transition-all",children:"Done"})]}):a.jsxs("div",{className:"p-6",children:[a.jsx("h3",{className:"text-[20px] font-bold text-gray-900 mb-1 text-center",children:"Customer Check-in"}),a.jsxs("div",{className:"text-center mb-6 mt-4",children:[a.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:a.jsx(u,{size:32,className:"text-blue-600",strokeWidth:2.5})}),a.jsx("p",{className:"text-[18px] font-semibold text-gray-900",children:null==W?void 0:W.name}),a.jsx("p",{className:"text-[15px] text-gray-500 mt-1",children:null==W?void 0:W.phone})]}),a.jsx("button",{onClick:async()=>{if(P&&L){Ie(!0);try{const e=await i(P,L.id);e.success?(Le(!0),e.wasReactivated?d.success("Customer checked in and reactivated! Points awarded."):d.success("Check-in successful! Points awarded."),await et(),await Xe(),W&&I({...W,isActive:!0,lastVisit:(new Date).toISOString()})):d.error(e.message||"Check-in failed")}catch(e){d.error((null==e?void 0:e.message)||"Check-in failed")}finally{Ie(!1)}}},disabled:We,className:"w-full py-4 bg-green-500 text-white rounded-xl font-semibold text-[17px] disabled:bg-gray-300 disabled:cursor-not-allowed mb-3 hover:bg-green-600 active:bg-green-700 transition-all shadow-sm",children:We?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Checking in..."]}):"âœ“ Check In Now"}),a.jsx("button",{onClick:()=>Pe(!1),className:"w-full py-3 text-gray-700 rounded-xl font-medium text-[16px] hover:bg-gray-50 active:bg-gray-100 transition-colors",children:"Cancel"})]})})}),Te&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:()=>Me(!1),children:a.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[90vh] overflow-y-auto animate-slide-up",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 sticky top-0 bg-white z-10",children:[a.jsx("button",{onClick:()=>Me(!1),className:"text-blue-500 text-[17px]",children:"Cancel"}),a.jsx("h3",{className:"text-[17px] font-semibold text-gray-900",children:"New Appointment"}),a.jsx("button",{onClick:async()=>{if(Oe&&Fe&&Ve){Ye(!0);try{const{error:e}=await t.from("appointments").insert({customer_id:P,appointment_date:Oe,appointment_time:Fe,service_type:Ve,notes:Ee,status:"pending",created_by:null==L?void 0:L.id,created_at:(new Date).toISOString()});if(e)throw e;d.success("Appointment created successfully!"),Me(!1),Be(""),$e(""),Ue(""),Qe(""),await Ze(),await st("appointment_created")}catch(e){d.error((null==e?void 0:e.message)||"Failed to create appointment")}finally{Ye(!1)}}else d.error("Please fill in all required fields")},disabled:Je||!Oe||!Fe||!Ve,className:"text-blue-500 text-[17px] font-semibold disabled:text-gray-400",children:Je?"Saving...":"Done"})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"border-t border-b border-gray-200 -mx-4",children:[a.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Customer"}),a.jsx("span",{className:"text-gray-900 text-[15px] font-medium",children:null==W?void 0:W.name})]}),a.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-t border-gray-200",children:[a.jsx("span",{className:"text-gray-900 text-[15px]",children:"Phone"}),a.jsx("span",{className:"text-gray-900 text-[15px] font-mono",children:null==W?void 0:W.phone})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Date & Time"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"date",value:Oe,onChange:e=>Be(e.target.value),className:"flex-1 px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",style:{WebkitAppearance:"none"}}),a.jsx("input",{type:"time",value:Fe,onChange:e=>$e(e.target.value),className:"px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",style:{WebkitAppearance:"none",width:"140px"}})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Service Type"}),a.jsxs("select",{value:Ve,onChange:e=>Ue(e.target.value),className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",style:{WebkitAppearance:"none"},children:[a.jsx("option",{value:"",children:"Select service"}),a.jsx("option",{value:"repair",children:"ðŸ”§ Repair"}),a.jsx("option",{value:"consultation",children:"ðŸ’¬ Consultation"}),a.jsx("option",{value:"pickup",children:"ðŸ“¦ Pickup"}),a.jsx("option",{value:"delivery",children:"ðŸšš Delivery"}),a.jsx("option",{value:"other",children:"ðŸ“ Other"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Notes (Optional)"}),a.jsx("textarea",{value:Ee,onChange:e=>Qe(e.target.value),rows:4,className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Additional notes...",style:{WebkitAppearance:"none"}})]})]})]})}),qe&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-end",style:{backgroundColor:"rgba(0, 0, 0, 0.4)"},onClick:()=>Re(!1),children:a.jsxs("div",{className:"w-full bg-white rounded-t-[20px] max-h-[90vh] overflow-y-auto animate-slide-up",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 sticky top-0 bg-white z-10",children:[a.jsx("button",{onClick:()=>Re(!1),className:"text-blue-500 text-[17px]",children:"Cancel"}),a.jsx("h3",{className:"text-[17px] font-semibold text-gray-900",children:"Edit Customer"}),a.jsx("button",{onClick:async()=>{if(Ge.name&&Ge.phone)try{const{error:e}=await t.from("customers").update({name:Ge.name,phone:Ge.phone,email:Ge.email,whatsapp:Ge.whatsapp,address:Ge.address,city:Ge.city,country:Ge.country,notes:Ge.notes,updated_at:(new Date).toISOString()}).eq("id",P);if(e)throw e;d.success("Customer updated successfully!"),Re(!1),await Xe()}catch(e){d.error((null==e?void 0:e.message)||"Failed to update customer")}else d.error("Name and phone are required")},disabled:!Ge.name||!Ge.phone,className:"text-blue-500 text-[17px] font-semibold disabled:text-gray-400",children:"Save"})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Basic Information"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("input",{type:"text",value:Ge.name||"",onChange:e=>He({...Ge,name:e.target.value}),className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Customer name",style:{WebkitAppearance:"none"}}),a.jsx("input",{type:"tel",value:Ge.phone||"",onChange:e=>He({...Ge,phone:e.target.value}),className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Phone number",style:{WebkitAppearance:"none"}})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Contact Details"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("input",{type:"email",value:Ge.email||"",onChange:e=>He({...Ge,email:e.target.value}),className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email address",style:{WebkitAppearance:"none"}}),a.jsx("input",{type:"tel",value:Ge.whatsapp||"",onChange:e=>He({...Ge,whatsapp:e.target.value}),className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"WhatsApp number",style:{WebkitAppearance:"none"}})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Location"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("input",{type:"text",value:Ge.address||"",onChange:e=>He({...Ge,address:e.target.value}),className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Street address",style:{WebkitAppearance:"none"}}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:Ge.city||"",onChange:e=>He({...Ge,city:e.target.value}),className:"flex-1 px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"City",style:{WebkitAppearance:"none"}}),a.jsx("input",{type:"text",value:Ge.country||"",onChange:e=>He({...Ge,country:e.target.value}),className:"flex-1 px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Country",style:{WebkitAppearance:"none"}})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[13px] text-gray-500 uppercase tracking-wide mb-2 px-1",children:"Notes"}),a.jsx("textarea",{value:Ge.notes||"",onChange:e=>He({...Ge,notes:e.target.value}),rows:4,className:"w-full px-4 py-3 bg-[#f2f2f7] border-0 rounded-xl text-[16px] text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Additional notes...",style:{WebkitAppearance:"none"}})]})]})]})})]}):a.jsx("div",{className:"flex flex-col h-full bg-white",children:a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-6xl mb-3",children:"ðŸ‘¤"}),a.jsx("p",{className:"text-gray-500",children:"Client not found"}),a.jsx("button",{onClick:()=>A("/mobile/clients"),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg",children:"Back to Clients"})]})})})};if("undefined"!=typeof document&&!document.getElementById("mobile-client-detail-styles")){const e=document.createElement("style");e.id="mobile-client-detail-styles",e.textContent="\n  @keyframes slideUp {\n    from {\n      transform: translateY(100%);\n    }\n    to {\n      transform: translateY(0);\n    }\n  }\n  @keyframes scaleUp {\n    from {\n      transform: scale(0.9);\n      opacity: 0;\n    }\n    to {\n      transform: scale(1);\n      opacity: 1;\n    }\n  }\n  .animate-slide-up {\n    animation: slideUp 0.3s ease-out;\n  }\n  .animate-scale-up {\n    animation: scaleUp 0.3s ease-out;\n  }\n",document.head.appendChild(e)}export{P as default};
