import{j as e,s as t,u as r,c as a,d as s,G as n,an as i,ao as l,ap as o,aq as c}from"./index-222cfb29.js";import{r as d,R as u}from"./vendor-a2ff445a.js";import{ai as m,p as g,X as x,l as h,cu as b,$ as p,x as f,bR as y,b5 as v,az as j,D as N,Q as w,T as k,y as S,n as _,w as A,a5 as C,h as P,v as I,N as U,aC as L,cs as F,m as E,bV as q,bW as D,aX as R,bX as M,bZ as T,bl as $,cj as O,an as z,ao as Q,O as B,e as V,_ as H,I as G,ax as W,d as K,ah as X,a6 as Y,R as Z,r as J,ad as ee,ac as te,q as re}from"./ui-551a39a6.js";import{_ as ae}from"./supabase-7e851d02.js";import{C as se}from"./CategoryInput-bba1731d.js";import{P as ne}from"./PriceInput-e1556d5b.js";import{s as ie,g as le,a as oe}from"./specificationCategories-9f98df80.js";import{s as ce}from"./storeLocationApi-de3f7bfa.js";import{s as de,a as ue}from"./storeShelfApi-d8b142f6.js";import{format as me}from"./format-0f0b2647.js";import{S as ge,f as xe}from"./purchaseOrderUtils-e0e1d78b.js";import{S as he}from"./SafeImage-bfaf74c6.js";import"./routing-a2f0f6d2.js";function be(e,t){return new Promise(function(r,a){let s;return pe(e).then(function(e){try{return s=e,r(new Blob([t.slice(0,2),s,t.slice(2)],{type:"image/jpeg"}))}catch(n){return a(n)}},a)})}const pe=e=>new Promise((t,r)=>{const a=new FileReader;a.addEventListener("load",({target:{result:e}})=>{const a=new DataView(e);let s=0;if(65496!==a.getUint16(s))return r("not a valid JPEG");for(s+=2;;){const n=a.getUint16(s);if(65498===n)break;const i=a.getUint16(s+2);if(65505===n&&1165519206===a.getUint32(s+4)){const n=s+10;let l;switch(a.getUint16(n)){case 18761:l=!0;break;case 19789:l=!1;break;default:return r("TIFF header contains invalid endian")}if(42!==a.getUint16(n+2,l))return r("TIFF header contains invalid version");const o=a.getUint32(n+4,l),c=n+o+2+12*a.getUint16(n+o,l);for(let e=n+o+2;e<c;e+=12)if(274==a.getUint16(e,l)){if(3!==a.getUint16(e+2,l))return r("Orientation data type is invalid");if(1!==a.getUint32(e+4,l))return r("Orientation data count is invalid");a.setUint16(e+8,1,l);break}return t(e.slice(s,s+2+i))}s+=2+i}return t(new Blob)}),a.readAsArrayBuffer(e)});var fe,ye,ve,je={},Ne={get exports(){return je},set exports(e){je=e}};ve={},Ne.exports=ve,ve.parse=function(e,t){for(var r=ve.bin.readUshort,a=ve.bin.readUint,s=0,n={},i=new Uint8Array(e),l=i.length-4;101010256!=a(i,l);)l--;s=l,s+=4;var o=r(i,s+=4);r(i,s+=2);var c=a(i,s+=2),d=a(i,s+=4);s+=4,s=d;for(var u=0;u<o;u++){a(i,s),s+=4,s+=4,s+=4,a(i,s+=4),c=a(i,s+=4);var m=a(i,s+=4),g=r(i,s+=4),x=r(i,s+2),h=r(i,s+4);s+=6;var b=a(i,s+=8);s+=4,s+=g+x+h,ve._readLocal(i,b,n,c,m,t)}return n},ve._readLocal=function(e,t,r,a,s,n){var i=ve.bin.readUshort,l=ve.bin.readUint;l(e,t),i(e,t+=4),i(e,t+=2);var o=i(e,t+=2);l(e,t+=2),l(e,t+=4),t+=4;var c=i(e,t+=8),d=i(e,t+=2);t+=2;var u=ve.bin.readUTF8(e,t,c);if(t+=c,t+=d,n)r[u]={size:s,csize:a};else{var m=new Uint8Array(e.buffer,t);if(0==o)r[u]=new Uint8Array(m.buffer.slice(t,t+a));else{if(8!=o)throw"unknown compression method: "+o;var g=new Uint8Array(s);ve.inflateRaw(m,g),r[u]=g}}},ve.inflateRaw=function(e,t){return ve.F.inflate(e,t)},ve.inflate=function(e,t){return e[0],e[1],ve.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},ve.deflate=function(e,t){null==t&&(t={level:6});var r=0,a=new Uint8Array(50+Math.floor(1.1*e.length));a[r]=120,a[r+1]=156,r+=2,r=ve.F.deflateRaw(e,a,r,t.level);var s=ve.adler(e,0,e.length);return a[r+0]=s>>>24&255,a[r+1]=s>>>16&255,a[r+2]=s>>>8&255,a[r+3]=s>>>0&255,new Uint8Array(a.buffer,0,r+4)},ve.deflateRaw=function(e,t){null==t&&(t={level:6});var r=new Uint8Array(50+Math.floor(1.1*e.length)),a=ve.F.deflateRaw(e,r,a,t.level);return new Uint8Array(r.buffer,0,a)},ve.encode=function(e,t){null==t&&(t=!1);var r=0,a=ve.bin.writeUint,s=ve.bin.writeUshort,n={};for(var i in e){var l=!ve._noNeed(i)&&!t,o=e[i],c=ve.crc.crc(o,0,o.length);n[i]={cpr:l,usize:o.length,crc:c,file:l?ve.deflateRaw(o):o}}for(var i in n)r+=n[i].file.length+30+46+2*ve.bin.sizeUTF8(i);r+=22;var d=new Uint8Array(r),u=0,m=[];for(var i in n){var g=n[i];m.push(u),u=ve._writeHeader(d,u,i,g,0)}var x=0,h=u;for(var i in n)g=n[i],m.push(u),u=ve._writeHeader(d,u,i,g,1,m[x++]);var b=u-h;return a(d,u,101010256),u+=4,s(d,u+=4,x),s(d,u+=2,x),a(d,u+=2,b),a(d,u+=4,h),u+=4,u+=2,d.buffer},ve._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return-1!="png,jpg,jpeg,zip".indexOf(t)},ve._writeHeader=function(e,t,r,a,s,n){var i=ve.bin.writeUint,l=ve.bin.writeUshort,o=a.file;return i(e,t,0==s?67324752:33639248),t+=4,1==s&&(t+=2),l(e,t,20),l(e,t+=2,0),l(e,t+=2,a.cpr?8:0),i(e,t+=2,0),i(e,t+=4,a.crc),i(e,t+=4,o.length),i(e,t+=4,a.usize),l(e,t+=4,ve.bin.sizeUTF8(r)),l(e,t+=2,0),t+=2,1==s&&(t+=2,t+=2,i(e,t+=6,n),t+=4),t+=ve.bin.writeUTF8(e,t,r),0==s&&(e.set(o,t),t+=o.length),t},ve.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,a=0;a<8;a++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update:function(e,t,r,a){for(var s=0;s<a;s++)e=ve.crc.table[255&(e^t[r+s])]^e>>>8;return e},crc:function(e,t,r){return 4294967295^ve.crc.update(4294967295,e,t,r)}},ve.adler=function(e,t,r){for(var a=1,s=0,n=t,i=t+r;n<i;){for(var l=Math.min(n+5552,i);n<l;)s+=a+=e[n++];a%=65521,s%=65521}return s<<16|a},ve.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,r){e[t]=255&r,e[t+1]=r>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,r){e[t]=255&r,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255},readASCII:function(e,t,r){for(var a="",s=0;s<r;s++)a+=String.fromCharCode(e[t+s]);return a},writeASCII:function(e,t,r){for(var a=0;a<r.length;a++)e[t+a]=r.charCodeAt(a)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,r){for(var a,s="",n=0;n<r;n++)s+="%"+ve.bin.pad(e[t+n].toString(16));try{a=decodeURIComponent(s)}catch(i){return ve.bin.readASCII(e,t,r)}return a},writeUTF8:function(e,t,r){for(var a=r.length,s=0,n=0;n<a;n++){var i=r.charCodeAt(n);if(4294967168&i)if(4294965248&i)if(4294901760&i){if(4292870144&i)throw"e";e[t+s]=240|i>>18,e[t+s+1]=128|i>>12&63,e[t+s+2]=128|i>>6&63,e[t+s+3]=128|63&i,s+=4}else e[t+s]=224|i>>12,e[t+s+1]=128|i>>6&63,e[t+s+2]=128|63&i,s+=3;else e[t+s]=192|i>>6,e[t+s+1]=128|63&i,s+=2;else e[t+s]=i,s++}return s},sizeUTF8:function(e){for(var t=e.length,r=0,a=0;a<t;a++){var s=e.charCodeAt(a);if(4294967168&s)if(4294965248&s)if(4294901760&s){if(4292870144&s)throw"e";r+=4}else r+=3;else r+=2;else r++}return r}},ve.F={},ve.F.deflateRaw=function(e,t,r,a){var s=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],n=ve.F.U,i=ve.F._goodIndex;ve.F._hash;var l=ve.F._putsE,o=0,c=r<<3,d=0,u=e.length;if(0==a){for(;o<u;)l(t,c,o+(w=Math.min(65535,u-o))==u?1:0),c=ve.F._copyExact(e,o,w,t,c+8),o+=w;return c>>>3}var m=n.lits,g=n.strt,x=n.prev,h=0,b=0,p=0,f=0,y=0,v=0;for(u>2&&(g[v=ve.F._hash(e,0)]=0),o=0;o<u;o++){if(y=v,o+1<u-2){v=ve.F._hash(e,o+1);var j=o+1&32767;x[j]=g[v],g[v]=j}if(d<=o){(h>14e3||b>26697)&&u-o>100&&(d<o&&(m[h]=o-d,h+=2,d=o),c=ve.F._writeBlock(o==u-1||d==u?1:0,m,h,f,e,p,o-p,t,c),h=b=f=0,p=o);var N=0;o<u-2&&(N=ve.F._bestMatch(e,o,x,y,Math.min(s[2],u-o),s[3]));var w=N>>>16,k=65535&N;if(0!=N){k=65535&N;var S=i(w=N>>>16,n.of0);n.lhst[257+S]++;var _=i(k,n.df0);n.dhst[_]++,f+=n.exb[S]+n.dxb[_],m[h]=w<<23|o-d,m[h+1]=k<<16|S<<8|_,h+=2,d=o+w}else n.lhst[e[o]]++;b++}}for(p==o&&0!=e.length||(d<o&&(m[h]=o-d,h+=2,d=o),c=ve.F._writeBlock(1,m,h,f,e,p,o-p,t,c),h=0,b=0,h=b=f=0,p=o);7&c;)c++;return c>>>3},ve.F._bestMatch=function(e,t,r,a,s,n){var i=32767&t,l=r[i],o=i-l+32768&32767;if(l==i||a!=ve.F._hash(e,t-o))return 0;for(var c=0,d=0,u=Math.min(32767,t);o<=u&&0!=--n&&l!=i;){if(0==c||e[t+c]==e[t+c-o]){var m=ve.F._howLong(e,t,o);if(m>c){if(d=o,(c=m)>=s)break;o+2<m&&(m=o+2);for(var g=0,x=0;x<m-2;x++){var h=t-o+x+32768&32767,b=h-r[h]+32768&32767;b>g&&(g=b,l=h)}}}o+=(i=l)-(l=r[i])+32768&32767}return c<<16|d},ve.F._howLong=function(e,t,r){if(e[t]!=e[t-r]||e[t+1]!=e[t+1-r]||e[t+2]!=e[t+2-r])return 0;var a=t,s=Math.min(e.length,t+258);for(t+=3;t<s&&e[t]==e[t-r];)t++;return t-a},ve.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},ve.saved=0,ve.F._writeBlock=function(e,t,r,a,s,n,i,l,o){var c,d,u,m,g,x,h,b,p,f=ve.F.U,y=ve.F._putsF,v=ve.F._putsE;f.lhst[256]++,d=(c=ve.F.getTrees())[0],u=c[1],m=c[2],g=c[3],x=c[4],h=c[5],b=c[6],p=c[7];var j=32+(o+3&7?8-(o+3&7):0)+(i<<3),N=a+ve.F.contSize(f.fltree,f.lhst)+ve.F.contSize(f.fdtree,f.dhst),w=a+ve.F.contSize(f.ltree,f.lhst)+ve.F.contSize(f.dtree,f.dhst);w+=14+3*h+ve.F.contSize(f.itree,f.ihst)+(2*f.ihst[16]+3*f.ihst[17]+7*f.ihst[18]);for(var k=0;k<286;k++)f.lhst[k]=0;for(k=0;k<30;k++)f.dhst[k]=0;for(k=0;k<19;k++)f.ihst[k]=0;var S=j<N&&j<w?0:N<w?1:2;if(y(l,o,e),y(l,o+1,S),o+=3,0==S){for(;7&o;)o++;o=ve.F._copyExact(s,n,i,l,o)}else{var _,A;if(1==S&&(_=f.fltree,A=f.fdtree),2==S){ve.F.makeCodes(f.ltree,d),ve.F.revCodes(f.ltree,d),ve.F.makeCodes(f.dtree,u),ve.F.revCodes(f.dtree,u),ve.F.makeCodes(f.itree,m),ve.F.revCodes(f.itree,m),_=f.ltree,A=f.dtree,v(l,o,g-257),v(l,o+=5,x-1),v(l,o+=5,h-4),o+=4;for(var C=0;C<h;C++)v(l,o+3*C,f.itree[1+(f.ordr[C]<<1)]);o+=3*h,o=ve.F._codeTiny(b,f.itree,l,o),o=ve.F._codeTiny(p,f.itree,l,o)}for(var P=n,I=0;I<r;I+=2){for(var U=t[I],L=U>>>23,F=P+(8388607&U);P<F;)o=ve.F._writeLit(s[P++],_,l,o);if(0!=L){var E=t[I+1],q=E>>16,D=E>>8&255,R=255&E;v(l,o=ve.F._writeLit(257+D,_,l,o),L-f.of0[D]),o+=f.exb[D],y(l,o=ve.F._writeLit(R,A,l,o),q-f.df0[R]),o+=f.dxb[R],P+=L}}o=ve.F._writeLit(256,_,l,o)}return o},ve.F._copyExact=function(e,t,r,a,s){var n=s>>>3;return a[n]=r,a[n+1]=r>>>8,a[n+2]=255-a[n],a[n+3]=255-a[n+1],n+=4,a.set(new Uint8Array(e.buffer,t,r),n),s+(r+4<<3)},ve.F.getTrees=function(){for(var e=ve.F.U,t=ve.F._hufTree(e.lhst,e.ltree,15),r=ve.F._hufTree(e.dhst,e.dtree,15),a=[],s=ve.F._lenCodes(e.ltree,a),n=[],i=ve.F._lenCodes(e.dtree,n),l=0;l<a.length;l+=2)e.ihst[a[l]]++;for(l=0;l<n.length;l+=2)e.ihst[n[l]]++;for(var o=ve.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,r,o,s,i,c,a,n]},ve.F.getSecond=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(e[r+1]);return t},ve.F.nonZero=function(e){for(var t="",r=0;r<e.length;r+=2)0!=e[r+1]&&(t+=(r>>1)+",");return t},ve.F.contSize=function(e,t){for(var r=0,a=0;a<t.length;a++)r+=t[a]*e[1+(a<<1)];return r},ve.F._codeTiny=function(e,t,r,a){for(var s=0;s<e.length;s+=2){var n=e[s],i=e[s+1];a=ve.F._writeLit(n,t,r,a);var l=16==n?2:17==n?3:7;n>15&&(ve.F._putsE(r,a,i,l),a+=l)}return a},ve.F._lenCodes=function(e,t){for(var r=e.length;2!=r&&0==e[r-1];)r-=2;for(var a=0;a<r;a+=2){var s=e[a+1],n=a+3<r?e[a+3]:-1,i=a+5<r?e[a+5]:-1,l=0==a?-1:e[a-1];if(0==s&&n==s&&i==s){for(var o=a+5;o+2<r&&e[o+2]==s;)o+=2;(c=Math.min(o+1-a>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),a+=2*c-2}else if(s==l&&n==s&&i==s){for(o=a+5;o+2<r&&e[o+2]==s;)o+=2;var c=Math.min(o+1-a>>>1,6);t.push(16,c-3),a+=2*c-2}else t.push(s,0)}return r>>>1},ve.F._hufTree=function(e,t,r){var a=[],s=e.length,n=t.length,i=0;for(i=0;i<n;i+=2)t[i]=0,t[i+1]=0;for(i=0;i<s;i++)0!=e[i]&&a.push({lit:i,f:e[i]});var l=a.length,o=a.slice(0);if(0==l)return 0;if(1==l){var c=a[0].lit;return o=0==c?1:0,t[1+(c<<1)]=1,t[1+(o<<1)]=1,1}a.sort(function(e,t){return e.f-t.f});var d=a[0],u=a[1],m=0,g=1,x=2;for(a[0]={lit:-1,f:d.f+u.f,l:d,r:u,d:0};g!=l-1;)d=m!=g&&(x==l||a[m].f<a[x].f)?a[m++]:a[x++],u=m!=g&&(x==l||a[m].f<a[x].f)?a[m++]:a[x++],a[g++]={lit:-1,f:d.f+u.f,l:d,r:u};var h=ve.F.setDepth(a[g-1],0);for(h>r&&(ve.F.restrictDepth(o,r,h),h=r),i=0;i<l;i++)t[1+(o[i].lit<<1)]=o[i].d;return h},ve.F.setDepth=function(e,t){return-1!=e.lit?(e.d=t,t):Math.max(ve.F.setDepth(e.l,t+1),ve.F.setDepth(e.r,t+1))},ve.F.restrictDepth=function(e,t,r){var a=0,s=1<<r-t,n=0;for(e.sort(function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d}),a=0;a<e.length&&e[a].d>t;a++){var i=e[a].d;e[a].d=t,n+=s-(1<<r-i)}for(n>>>=r-t;n>0;)(i=e[a].d)<t?(e[a].d++,n-=1<<t-i-1):a++;for(;a>=0;a--)e[a].d==t&&n<0&&(e[a].d--,n++)},ve.F._goodIndex=function(e,t){var r=0;return t[16|r]<=e&&(r|=16),t[8|r]<=e&&(r|=8),t[4|r]<=e&&(r|=4),t[2|r]<=e&&(r|=2),t[1|r]<=e&&(r|=1),r},ve.F._writeLit=function(e,t,r,a){return ve.F._putsF(r,a,t[e<<1]),a+t[1+(e<<1)]},ve.F.inflate=function(e,t){var r=Uint8Array;if(3==e[0]&&0==e[1])return t||new r(0);var a=ve.F,s=a._bitsF,n=a._bitsE,i=a._decodeTiny,l=a.makeCodes,o=a.codes2map,c=a._get17,d=a.U,u=null==t;u&&(t=new r(e.length>>>2<<3));for(var m,g,x=0,h=0,b=0,p=0,f=0,y=0,v=0,j=0,N=0;0==x;)if(x=s(e,N,1),h=s(e,N+1,2),N+=3,0!=h){if(u&&(t=ve.F._check(t,j+(1<<17))),1==h&&(m=d.flmap,g=d.fdmap,y=511,v=31),2==h){b=n(e,N,5)+257,p=n(e,N+5,5)+1,f=n(e,N+10,4)+4,N+=14;for(var w=0;w<38;w+=2)d.itree[w]=0,d.itree[w+1]=0;var k=1;for(w=0;w<f;w++){var S=n(e,N+3*w,3);d.itree[1+(d.ordr[w]<<1)]=S,S>k&&(k=S)}N+=3*f,l(d.itree,k),o(d.itree,k,d.imap),m=d.lmap,g=d.dmap,N=i(d.imap,(1<<k)-1,b+p,e,N,d.ttree);var _=a._copyOut(d.ttree,0,b,d.ltree);y=(1<<_)-1;var A=a._copyOut(d.ttree,b,p,d.dtree);v=(1<<A)-1,l(d.ltree,_),o(d.ltree,_,m),l(d.dtree,A),o(d.dtree,A,g)}for(;;){var C=m[c(e,N)&y];N+=15&C;var P=C>>>4;if(P>>>8==0)t[j++]=P;else{if(256==P)break;var I=j+P-254;if(P>264){var U=d.ldef[P-257];I=j+(U>>>3)+n(e,N,7&U),N+=7&U}var L=g[c(e,N)&v];N+=15&L;var F=L>>>4,E=d.ddef[F],q=(E>>>4)+s(e,N,15&E);for(N+=15&E,u&&(t=ve.F._check(t,j+(1<<17)));j<I;)t[j]=t[j++-q],t[j]=t[j++-q],t[j]=t[j++-q],t[j]=t[j++-q];j=I}}}else{7&N&&(N+=8-(7&N));var D=4+(N>>>3),R=e[D-4]|e[D-3]<<8;u&&(t=ve.F._check(t,j+R)),t.set(new r(e.buffer,e.byteOffset+D,R),j),N=D+R<<3,j+=R}return t.length==j?t:t.slice(0,j)},ve.F._check=function(e,t){var r=e.length;if(t<=r)return e;var a=new Uint8Array(Math.max(r<<1,t));return a.set(e,0),a},ve.F._decodeTiny=function(e,t,r,a,s,n){for(var i=ve.F._bitsE,l=ve.F._get17,o=0;o<r;){var c=e[l(a,s)&t];s+=15&c;var d=c>>>4;if(d<=15)n[o]=d,o++;else{var u=0,m=0;16==d?(m=3+i(a,s,2),s+=2,u=n[o-1]):17==d?(m=3+i(a,s,3),s+=3):18==d&&(m=11+i(a,s,7),s+=7);for(var g=o+m;o<g;)n[o]=u,o++}}return s},ve.F._copyOut=function(e,t,r,a){for(var s=0,n=0,i=a.length>>>1;n<r;){var l=e[n+t];a[n<<1]=0,a[1+(n<<1)]=l,l>s&&(s=l),n++}for(;n<i;)a[n<<1]=0,a[1+(n<<1)]=0,n++;return s},ve.F.makeCodes=function(e,t){for(var r,a,s,n,i=ve.F.U,l=e.length,o=i.bl_count,c=0;c<=t;c++)o[c]=0;for(c=1;c<l;c+=2)o[e[c]]++;var d=i.next_code;for(r=0,o[0]=0,a=1;a<=t;a++)r=r+o[a-1]<<1,d[a]=r;for(s=0;s<l;s+=2)0!=(n=e[s+1])&&(e[s]=d[n],d[n]++)},ve.F.codes2map=function(e,t,r){for(var a=e.length,s=ve.F.U.rev15,n=0;n<a;n+=2)if(0!=e[n+1])for(var i=n>>1,l=e[n+1],o=i<<4|l,c=t-l,d=e[n]<<c,u=d+(1<<c);d!=u;)r[s[d]>>>15-t]=o,d++},ve.F.revCodes=function(e,t){for(var r=ve.F.U.rev15,a=15-t,s=0;s<e.length;s+=2){var n=e[s]<<t-e[s+1];e[s]=r[n]>>>a}},ve.F._putsE=function(e,t,r){r<<=7&t;var a=t>>>3;e[a]|=r,e[a+1]|=r>>>8},ve.F._putsF=function(e,t,r){r<<=7&t;var a=t>>>3;e[a]|=r,e[a+1]|=r>>>8,e[a+2]|=r>>>16},ve.F._bitsE=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},ve.F._bitsF=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},ve.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},ve.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},ve.F.U=(fe=Uint16Array,ye=Uint32Array,{next_code:new fe(16),bl_count:new fe(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new fe(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new ye(32),flmap:new fe(512),fltree:[],fdmap:new fe(32),fdtree:[],lmap:new fe(32768),ltree:[],ttree:[],dmap:new fe(32768),dtree:[],imap:new fe(512),itree:[],rev15:new fe(32768),lhst:new ye(286),dhst:new ye(30),ihst:new ye(19),lits:new ye(15e3),strt:new fe(65536),prev:new fe(32768)}),function(){for(var e=ve.F.U,t=0;t<32768;t++){var r=t;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,e.rev15[t]=(r>>>16|r<<16)>>>17}function a(e,t,r){for(;0!=t--;)e.push(0,r)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];a(e.fltree,144,8),a(e.fltree,112,9),a(e.fltree,24,7),a(e.fltree,8,8),ve.F.makeCodes(e.fltree,9),ve.F.codes2map(e.fltree,9,e.flmap),ve.F.revCodes(e.fltree,9),a(e.fdtree,32,5),ve.F.makeCodes(e.fdtree,5),ve.F.codes2map(e.fdtree,5,e.fdmap),ve.F.revCodes(e.fdtree,5),a(e.itree,19,0),a(e.ltree,286,0),a(e.dtree,30,0),a(e.ttree,320,0)}();var we,ke=(we={__proto__:null,default:je},[je].forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(t){if("default"!==t&&!(t in we)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(we,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}})}),Object.freeze(we));const Se=function(){var e={nextZero(e,t){for(;0!=e[t];)t++;return t},readUshort:(e,t)=>e[t]<<8|e[t+1],writeUshort(e,t,r){e[t]=r>>8&255,e[t+1]=255&r},readUint:(e,t)=>16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3]),writeUint(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},readASCII(e,t,r){let a="";for(let s=0;s<r;s++)a+=String.fromCharCode(e[t+s]);return a},writeASCII(e,t,r){for(let a=0;a<r.length;a++)e[t+a]=r.charCodeAt(a)},readBytes(e,t,r){const a=[];for(let s=0;s<r;s++)a.push(e[t+s]);return a},pad:e=>e.length<2?`0${e}`:e,readUTF8(t,r,a){let s,n="";for(let l=0;l<a;l++)n+=`%${e.pad(t[r+l].toString(16))}`;try{s=decodeURIComponent(n)}catch(i){return e.readASCII(t,r,a)}return s}};function t(t,r,a,s){const i=r*a,l=n(s),o=Math.ceil(r*l/8),c=new Uint8Array(4*i),d=new Uint32Array(c.buffer),{ctype:u}=s,{depth:m}=s,g=e.readUshort;if(6==u){const e=i<<2;if(8==m)for(var x=0;x<e;x+=4)c[x]=t[x],c[x+1]=t[x+1],c[x+2]=t[x+2],c[x+3]=t[x+3];if(16==m)for(x=0;x<e;x++)c[x]=t[x<<1]}else if(2==u){const e=s.tabs.tRNS;if(null==e){if(8==m)for(x=0;x<i;x++){var h=3*x;d[x]=255<<24|t[h+2]<<16|t[h+1]<<8|t[h]}if(16==m)for(x=0;x<i;x++)h=6*x,d[x]=255<<24|t[h+4]<<16|t[h+2]<<8|t[h]}else{var b=e[0];const r=e[1],a=e[2];if(8==m)for(x=0;x<i;x++){var p=x<<2;h=3*x,d[x]=255<<24|t[h+2]<<16|t[h+1]<<8|t[h],t[h]==b&&t[h+1]==r&&t[h+2]==a&&(c[p+3]=0)}if(16==m)for(x=0;x<i;x++)p=x<<2,h=6*x,d[x]=255<<24|t[h+4]<<16|t[h+2]<<8|t[h],g(t,h)==b&&g(t,h+2)==r&&g(t,h+4)==a&&(c[p+3]=0)}}else if(3==u){const e=s.tabs.PLTE,n=s.tabs.tRNS,l=n?n.length:0;if(1==m)for(var f=0;f<a;f++){var y=f*o,v=f*r;for(x=0;x<r;x++){p=v+x<<2;var j=3*(N=t[y+(x>>3)]>>7-(7&x)&1);c[p]=e[j],c[p+1]=e[j+1],c[p+2]=e[j+2],c[p+3]=N<l?n[N]:255}}if(2==m)for(f=0;f<a;f++)for(y=f*o,v=f*r,x=0;x<r;x++)p=v+x<<2,j=3*(N=t[y+(x>>2)]>>6-((3&x)<<1)&3),c[p]=e[j],c[p+1]=e[j+1],c[p+2]=e[j+2],c[p+3]=N<l?n[N]:255;if(4==m)for(f=0;f<a;f++)for(y=f*o,v=f*r,x=0;x<r;x++)p=v+x<<2,j=3*(N=t[y+(x>>1)]>>4-((1&x)<<2)&15),c[p]=e[j],c[p+1]=e[j+1],c[p+2]=e[j+2],c[p+3]=N<l?n[N]:255;if(8==m)for(x=0;x<i;x++){var N;p=x<<2,j=3*(N=t[x]),c[p]=e[j],c[p+1]=e[j+1],c[p+2]=e[j+2],c[p+3]=N<l?n[N]:255}}else if(4==u){if(8==m)for(x=0;x<i;x++){p=x<<2;var w=t[k=x<<1];c[p]=w,c[p+1]=w,c[p+2]=w,c[p+3]=t[k+1]}if(16==m)for(x=0;x<i;x++){var k;p=x<<2,w=t[k=x<<2],c[p]=w,c[p+1]=w,c[p+2]=w,c[p+3]=t[k+2]}}else if(0==u)for(b=s.tabs.tRNS?s.tabs.tRNS:-1,f=0;f<a;f++){const e=f*o,a=f*r;if(1==m)for(var S=0;S<r;S++){var _=(w=255*(t[e+(S>>>3)]>>>7-(7&S)&1))==255*b?0:255;d[a+S]=_<<24|w<<16|w<<8|w}else if(2==m)for(S=0;S<r;S++)_=(w=85*(t[e+(S>>>2)]>>>6-((3&S)<<1)&3))==85*b?0:255,d[a+S]=_<<24|w<<16|w<<8|w;else if(4==m)for(S=0;S<r;S++)_=(w=17*(t[e+(S>>>1)]>>>4-((1&S)<<2)&15))==17*b?0:255,d[a+S]=_<<24|w<<16|w<<8|w;else if(8==m)for(S=0;S<r;S++)_=(w=t[e+S])==b?0:255,d[a+S]=_<<24|w<<16|w<<8|w;else if(16==m)for(S=0;S<r;S++)w=t[e+(S<<1)],_=g(t,e+(S<<1))==b?0:255,d[a+S]=_<<24|w<<16|w<<8|w}return c}function r(e,t,r,l){const o=n(e),c=Math.ceil(r*o/8),d=new Uint8Array((c+1+e.interlace)*l);return t=e.tabs.CgBI?s(t,d):a(t,d),0==e.interlace?t=i(t,e,0,r,l):1==e.interlace&&(t=function(e,t){const r=t.width,a=t.height,s=n(t),l=s>>3,o=Math.ceil(r*s/8),c=new Uint8Array(a*o);let d=0;const u=[0,0,4,0,2,0,1],m=[0,4,0,2,0,1,0],g=[8,8,8,4,4,2,2],x=[8,8,4,4,2,2,1];let h=0;for(;h<7;){const n=g[h],p=x[h];let f=0,y=0,v=u[h];for(;v<a;)v+=n,y++;let j=m[h];for(;j<r;)j+=p,f++;const N=Math.ceil(f*s/8);i(e,t,d,f,y);let w=0,k=u[h];for(;k<a;){let t=m[h],a=d+w*N<<3;for(;t<r;){var b;if(1==s&&(b=(b=e[a>>3])>>7-(7&a)&1,c[k*o+(t>>3)]|=b<<7-(7&t)),2==s&&(b=(b=e[a>>3])>>6-(7&a)&3,c[k*o+(t>>2)]|=b<<6-((3&t)<<1)),4==s&&(b=(b=e[a>>3])>>4-(7&a)&15,c[k*o+(t>>1)]|=b<<4-((1&t)<<2)),s>=8){const r=k*o+t*l;for(let t=0;t<l;t++)c[r+t]=e[(a>>3)+t]}a+=s,t+=p}w++,k+=n}f*y!=0&&(d+=y*(1+N)),h+=1}return c}(t,e)),t}function a(e,t){return s(new Uint8Array(e.buffer,2,e.length-6),t)}var s=function(){const e={H:{}};return e.H.N=function(t,r){const a=Uint8Array;let s,n,i=0,l=0,o=0,c=0,d=0,u=0,m=0,g=0,x=0;if(3==t[0]&&0==t[1])return r||new a(0);const h=e.H,b=h.b,p=h.e,f=h.R,y=h.n,v=h.A,j=h.Z,N=h.m,w=null==r;for(w&&(r=new a(t.length>>>2<<5));0==i;)if(i=b(t,x,1),l=b(t,x+1,2),x+=3,0!=l){if(w&&(r=e.H.W(r,g+(1<<17))),1==l&&(s=N.J,n=N.h,u=511,m=31),2==l){o=p(t,x,5)+257,c=p(t,x+5,5)+1,d=p(t,x+10,4)+4,x+=14;let e=1;for(var k=0;k<38;k+=2)N.Q[k]=0,N.Q[k+1]=0;for(k=0;k<d;k++){const r=p(t,x+3*k,3);N.Q[1+(N.X[k]<<1)]=r,r>e&&(e=r)}x+=3*d,y(N.Q,e),v(N.Q,e,N.u),s=N.w,n=N.d,x=f(N.u,(1<<e)-1,o+c,t,x,N.v);const r=h.V(N.v,0,o,N.C);u=(1<<r)-1;const a=h.V(N.v,o,c,N.D);m=(1<<a)-1,y(N.C,r),v(N.C,r,s),y(N.D,a),v(N.D,a,n)}for(;;){const e=s[j(t,x)&u];x+=15&e;const a=e>>>4;if(a>>>8==0)r[g++]=a;else{if(256==a)break;{let e=g+a-254;if(a>264){const r=N.q[a-257];e=g+(r>>>3)+p(t,x,7&r),x+=7&r}const s=n[j(t,x)&m];x+=15&s;const i=s>>>4,l=N.c[i],o=(l>>>4)+b(t,x,15&l);for(x+=15&l;g<e;)r[g]=r[g++-o],r[g]=r[g++-o],r[g]=r[g++-o],r[g]=r[g++-o];g=e}}}}else{7&x&&(x+=8-(7&x));const s=4+(x>>>3),n=t[s-4]|t[s-3]<<8;w&&(r=e.H.W(r,g+n)),r.set(new a(t.buffer,t.byteOffset+s,n),g),x=s+n<<3,g+=n}return r.length==g?r:r.slice(0,g)},e.H.W=function(e,t){const r=e.length;if(t<=r)return e;const a=new Uint8Array(r<<1);return a.set(e,0),a},e.H.R=function(t,r,a,s,n,i){const l=e.H.e,o=e.H.Z;let c=0;for(;c<a;){const e=t[o(s,n)&r];n+=15&e;const a=e>>>4;if(a<=15)i[c]=a,c++;else{let e=0,t=0;16==a?(t=3+l(s,n,2),n+=2,e=i[c-1]):17==a?(t=3+l(s,n,3),n+=3):18==a&&(t=11+l(s,n,7),n+=7);const r=c+t;for(;c<r;)i[c]=e,c++}}return n},e.H.V=function(e,t,r,a){let s=0,n=0;const i=a.length>>>1;for(;n<r;){const r=e[n+t];a[n<<1]=0,a[1+(n<<1)]=r,r>s&&(s=r),n++}for(;n<i;)a[n<<1]=0,a[1+(n<<1)]=0,n++;return s},e.H.n=function(t,r){const a=e.H.m,s=t.length;let n,i,l,o;const c=a.j;for(var d=0;d<=r;d++)c[d]=0;for(d=1;d<s;d+=2)c[t[d]]++;const u=a.K;for(n=0,c[0]=0,i=1;i<=r;i++)n=n+c[i-1]<<1,u[i]=n;for(l=0;l<s;l+=2)o=t[l+1],0!=o&&(t[l]=u[o],u[o]++)},e.H.A=function(t,r,a){const s=t.length,n=e.H.m.r;for(let e=0;e<s;e+=2)if(0!=t[e+1]){const s=e>>1,i=t[e+1],l=s<<4|i,o=r-i;let c=t[e]<<o;const d=c+(1<<o);for(;c!=d;)a[n[c]>>>15-r]=l,c++}},e.H.l=function(t,r){const a=e.H.m.r,s=15-r;for(let e=0;e<t.length;e+=2){const n=t[e]<<r-t[e+1];t[e]=a[n]>>>s}},e.H.M=function(e,t,r){r<<=7&t;const a=t>>>3;e[a]|=r,e[a+1]|=r>>>8},e.H.I=function(e,t,r){r<<=7&t;const a=t>>>3;e[a]|=r,e[a+1]|=r>>>8,e[a+2]|=r>>>16},e.H.e=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},e.H.b=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},e.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},e.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},e.H.m=function(){const e=Uint16Array,t=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new t(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new t(286),Y:new t(30),a:new t(19),t:new t(15e3),k:new e(65536),g:new e(32768)}}(),function(){const t=e.H.m;for(var r=0;r<32768;r++){let e=r;e=(2863311530&e)>>>1|(1431655765&e)<<1,e=(3435973836&e)>>>2|(858993459&e)<<2,e=(4042322160&e)>>>4|(252645135&e)<<4,e=(4278255360&e)>>>8|(16711935&e)<<8,t.r[r]=(e>>>16|e<<16)>>>17}function a(e,t,r){for(;0!=t--;)e.push(0,r)}for(r=0;r<32;r++)t.q[r]=t.S[r]<<3|t.T[r],t.c[r]=t.p[r]<<4|t.z[r];a(t._,144,8),a(t._,112,9),a(t._,24,7),a(t._,8,8),e.H.n(t._,9),e.H.A(t._,9,t.J),e.H.l(t._,9),a(t.$,32,5),e.H.n(t.$,5),e.H.A(t.$,5,t.h),e.H.l(t.$,5),a(t.Q,19,0),a(t.C,286,0),a(t.D,30,0),a(t.v,320,0)}(),e.H.N}();function n(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth}function i(e,t,r,a,s){let i=n(t);const o=Math.ceil(a*i/8);let c,d;i=Math.ceil(i/8);let u=e[r],m=0;if(u>1&&(e[r]=[0,0,1][u-2]),3==u)for(m=i;m<o;m++)e[m+1]=e[m+1]+(e[m+1-i]>>>1)&255;for(let n=0;n<s;n++)if(c=r+n*o,d=c+n+1,u=e[d-1],m=0,0==u)for(;m<o;m++)e[c+m]=e[d+m];else if(1==u){for(;m<i;m++)e[c+m]=e[d+m];for(;m<o;m++)e[c+m]=e[d+m]+e[c+m-i]}else if(2==u)for(;m<o;m++)e[c+m]=e[d+m]+e[c+m-o];else if(3==u){for(;m<i;m++)e[c+m]=e[d+m]+(e[c+m-o]>>>1);for(;m<o;m++)e[c+m]=e[d+m]+(e[c+m-o]+e[c+m-i]>>>1)}else{for(;m<i;m++)e[c+m]=e[d+m]+l(0,e[c+m-o],0);for(;m<o;m++)e[c+m]=e[d+m]+l(e[c+m-i],e[c+m-o],e[c+m-i-o])}return e}function l(e,t,r){const a=e+t-r,s=a-e,n=a-t,i=a-r;return s*s<=n*n&&s*s<=i*i?e:n*n<=i*i?t:r}function o(t,r,a){a.width=e.readUint(t,r),r+=4,a.height=e.readUint(t,r),r+=4,a.depth=t[r],r++,a.ctype=t[r],r++,a.compress=t[r],r++,a.filter=t[r],r++,a.interlace=t[r],r++}function c(e,t,r,a,s,n,i,l,o){const c=Math.min(t,s),d=Math.min(r,n);let u=0,m=0;for(let j=0;j<d;j++)for(let r=0;r<c;r++)if(i>=0&&l>=0?(u=j*t+r<<2,m=(l+j)*s+i+r<<2):(u=(-l+j)*t-i+r<<2,m=j*s+r<<2),0==o)a[m]=e[u],a[m+1]=e[u+1],a[m+2]=e[u+2],a[m+3]=e[u+3];else if(1==o){var g=e[u+3]*(1/255),x=e[u]*g,h=e[u+1]*g,b=e[u+2]*g,p=a[m+3]*(1/255),f=a[m]*p,y=a[m+1]*p,v=a[m+2]*p;const t=1-g,r=g+p*t,s=0==r?0:1/r;a[m+3]=255*r,a[m+0]=(x+f*t)*s,a[m+1]=(h+y*t)*s,a[m+2]=(b+v*t)*s}else if(2==o)g=e[u+3],x=e[u],h=e[u+1],b=e[u+2],p=a[m+3],f=a[m],y=a[m+1],v=a[m+2],g==p&&x==f&&h==y&&b==v?(a[m]=0,a[m+1]=0,a[m+2]=0,a[m+3]=0):(a[m]=x,a[m+1]=h,a[m+2]=b,a[m+3]=g);else if(3==o){if(g=e[u+3],x=e[u],h=e[u+1],b=e[u+2],p=a[m+3],f=a[m],y=a[m+1],v=a[m+2],g==p&&x==f&&h==y&&b==v)continue;if(g<220&&p>20)return!1}return!0}return{decode:function(t){const n=new Uint8Array(t);let i=8;const l=e,c=l.readUshort,d=l.readUint,u={tabs:{},frames:[]},m=new Uint8Array(n.length);let g,x=0,h=0;const b=[137,80,78,71,13,10,26,10];for(var p=0;p<8;p++)if(n[p]!=b[p])throw"The input is not a PNG file!";for(;i<n.length;){const e=l.readUint(n,i);i+=4;const t=l.readASCII(n,i,4);if(i+=4,"IHDR"==t)o(n,i,u);else if("iCCP"==t){for(var f=i;0!=n[f];)f++;l.readASCII(n,i,f-i),n[f+1];const r=n.slice(f+2,i+e);let o=null;try{o=a(r)}catch(S){o=s(r)}u.tabs[t]=o}else if("CgBI"==t)u.tabs[t]=n.slice(i,i+4);else if("IDAT"==t){for(p=0;p<e;p++)m[x+p]=n[i+p];x+=e}else if("acTL"==t)u.tabs[t]={num_frames:d(n,i),num_plays:d(n,i+4)},g=new Uint8Array(n.length);else if("fcTL"==t){0!=h&&((k=u.frames[u.frames.length-1]).data=r(u,g.slice(0,h),k.rect.width,k.rect.height),h=0);const e={x:d(n,i+12),y:d(n,i+16),width:d(n,i+4),height:d(n,i+8)};let t=c(n,i+22);t=c(n,i+20)/(0==t?100:t);const a={rect:e,delay:Math.round(1e3*t),dispose:n[i+24],blend:n[i+25]};u.frames.push(a)}else if("fdAT"==t){for(p=0;p<e-4;p++)g[h+p]=n[i+p+4];h+=e-4}else if("pHYs"==t)u.tabs[t]=[l.readUint(n,i),l.readUint(n,i+4),n[i+8]];else if("cHRM"==t)for(u.tabs[t]=[],p=0;p<8;p++)u.tabs[t].push(l.readUint(n,i+4*p));else if("tEXt"==t||"zTXt"==t){null==u.tabs[t]&&(u.tabs[t]={});var y=l.nextZero(n,i),v=l.readASCII(n,i,y-i),j=i+e-y-1;if("tEXt"==t)w=l.readASCII(n,y+1,j);else{var N=a(n.slice(y+2,y+2+j));w=l.readUTF8(N,0,N.length)}u.tabs[t][v]=w}else if("iTXt"==t){null==u.tabs[t]&&(u.tabs[t]={}),y=0,f=i,y=l.nextZero(n,f),v=l.readASCII(n,f,y-f);const r=n[f=y+1];var w;n[f+1],f+=2,y=l.nextZero(n,f),l.readASCII(n,f,y-f),f=y+1,y=l.nextZero(n,f),l.readUTF8(n,f,y-f),j=e-((f=y+1)-i),0==r?w=l.readUTF8(n,f,j):(N=a(n.slice(f,f+j)),w=l.readUTF8(N,0,N.length)),u.tabs[t][v]=w}else if("PLTE"==t)u.tabs[t]=l.readBytes(n,i,e);else if("hIST"==t){const e=u.tabs.PLTE.length/3;for(u.tabs[t]=[],p=0;p<e;p++)u.tabs[t].push(c(n,i+2*p))}else if("tRNS"==t)3==u.ctype?u.tabs[t]=l.readBytes(n,i,e):0==u.ctype?u.tabs[t]=c(n,i):2==u.ctype&&(u.tabs[t]=[c(n,i),c(n,i+2),c(n,i+4)]);else if("gAMA"==t)u.tabs[t]=l.readUint(n,i)/1e5;else if("sRGB"==t)u.tabs[t]=n[i];else if("bKGD"==t)0==u.ctype||4==u.ctype?u.tabs[t]=[c(n,i)]:2==u.ctype||6==u.ctype?u.tabs[t]=[c(n,i),c(n,i+2),c(n,i+4)]:3==u.ctype&&(u.tabs[t]=n[i]);else if("IEND"==t)break;i+=e,l.readUint(n,i),i+=4}var k;return 0!=h&&((k=u.frames[u.frames.length-1]).data=r(u,g.slice(0,h),k.rect.width,k.rect.height)),u.data=r(u,m,u.width,u.height),delete u.compress,delete u.interlace,delete u.filter,u},toRGBA8:function(e){const r=e.width,a=e.height;if(null==e.tabs.acTL)return[t(e.data,r,a,e).buffer];const s=[];null==e.frames[0].data&&(e.frames[0].data=e.data);const n=r*a*4,i=new Uint8Array(n),l=new Uint8Array(n),o=new Uint8Array(n);for(let u=0;u<e.frames.length;u++){const m=e.frames[u],g=m.rect.x,x=m.rect.y,h=m.rect.width,b=m.rect.height,p=t(m.data,h,b,e);if(0!=u)for(var d=0;d<n;d++)o[d]=i[d];if(0==m.blend?c(p,h,b,i,r,a,g,x,0):1==m.blend&&c(p,h,b,i,r,a,g,x,1),s.push(i.buffer.slice(0)),0==m.dispose);else if(1==m.dispose)c(l,h,b,i,r,a,g,x,0);else if(2==m.dispose)for(d=0;d<n;d++)i[d]=o[d]}return s},_paeth:l,_copyTile:c,_bin:e}}();!function(){const{_copyTile:e}=Se,{_bin:t}=Se,r=Se._paeth;var a={table:function(){const e=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let e=0;e<8;e++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update(e,t,r,s){for(let n=0;n<s;n++)e=a.table[255&(e^t[r+n])]^e>>>8;return e},crc:(e,t,r)=>4294967295^a.update(4294967295,e,t,r)};function s(e,t,r,a){t[r]+=e[0]*a>>4,t[r+1]+=e[1]*a>>4,t[r+2]+=e[2]*a>>4,t[r+3]+=e[3]*a>>4}function n(e){return Math.max(0,Math.min(255,e))}function i(e,t){const r=e[0]-t[0],a=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+a*a+s*s+n*n}function l(e,t,r,a,l,o,c){null==c&&(c=1);const d=a.length,u=[];for(var m=0;m<d;m++){const e=a[m];u.push([e>>>0&255,e>>>8&255,e>>>16&255,e>>>24&255])}for(m=0;m<d;m++){let e=4294967295;for(var g=0,x=0;x<d;x++){var h=i(u[m],u[x]);x!=m&&h<e&&(e=h,g=x)}}const b=new Uint32Array(l.buffer),p=new Int16Array(t*r*4),f=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(m=0;m<f.length;m++)f[m]=255*((f[m]+.5)/16-.5);for(let v=0;v<r;v++)for(let l=0;l<t;l++){var y;m=4*(v*t+l),2!=c?y=[n(e[m]+p[m]),n(e[m+1]+p[m+1]),n(e[m+2]+p[m+2]),n(e[m+3]+p[m+3])]:(h=f[4*(3&v)+(3&l)],y=[n(e[m]+h),n(e[m+1]+h),n(e[m+2]+h),n(e[m+3]+h)]),g=0;let j=16777215;for(x=0;x<d;x++){const e=i(y,u[x]);e<j&&(j=e,g=x)}const N=u[g],w=[y[0]-N[0],y[1]-N[1],y[2]-N[2],y[3]-N[3]];1==c&&(l!=t-1&&s(w,p,m+4,7),v!=r-1&&(0!=l&&s(w,p,m+4*t-4,3),s(w,p,m+4*t,5),l!=t-1&&s(w,p,m+4*t+4,1))),o[m>>2]=g,b[m>>2]=a[g]}}function o(e,r,s,n,i){null==i&&(i={});const{crc:l}=a,o=t.writeUint,c=t.writeUshort,d=t.writeASCII;let u=8;const m=e.frames.length>1;let g,x=!1,h=33+(m?20:0);if(null!=i.sRGB&&(h+=13),null!=i.pHYs&&(h+=21),null!=i.iCCP&&(g=pako.deflate(i.iCCP),h+=21+g.length+4),3==e.ctype){for(var b=e.plte.length,p=0;p<b;p++)e.plte[p]>>>24!=255&&(x=!0);h+=8+3*b+4+(x?8+1*b+4:0)}for(var f=0;f<e.frames.length;f++)m&&(h+=38),h+=(N=e.frames[f]).cimg.length+12,0!=f&&(h+=4);h+=12;const y=new Uint8Array(h),v=[137,80,78,71,13,10,26,10];for(p=0;p<8;p++)y[p]=v[p];if(o(y,u,13),u+=4,d(y,u,"IHDR"),u+=4,o(y,u,r),u+=4,o(y,u,s),u+=4,y[u]=e.depth,u++,y[u]=e.ctype,u++,y[u]=0,u++,y[u]=0,u++,y[u]=0,u++,o(y,u,l(y,u-17,17)),u+=4,null!=i.sRGB&&(o(y,u,1),u+=4,d(y,u,"sRGB"),u+=4,y[u]=i.sRGB,u++,o(y,u,l(y,u-5,5)),u+=4),null!=i.iCCP){const e=13+g.length;o(y,u,e),u+=4,d(y,u,"iCCP"),u+=4,d(y,u,"ICC profile"),u+=11,u+=2,y.set(g,u),u+=g.length,o(y,u,l(y,u-(e+4),e+4)),u+=4}if(null!=i.pHYs&&(o(y,u,9),u+=4,d(y,u,"pHYs"),u+=4,o(y,u,i.pHYs[0]),u+=4,o(y,u,i.pHYs[1]),u+=4,y[u]=i.pHYs[2],u++,o(y,u,l(y,u-13,13)),u+=4),m&&(o(y,u,8),u+=4,d(y,u,"acTL"),u+=4,o(y,u,e.frames.length),u+=4,o(y,u,null!=i.loop?i.loop:0),u+=4,o(y,u,l(y,u-12,12)),u+=4),3==e.ctype){for(o(y,u,3*(b=e.plte.length)),u+=4,d(y,u,"PLTE"),u+=4,p=0;p<b;p++){const t=3*p,r=e.plte[p],a=255&r,s=r>>>8&255,n=r>>>16&255;y[u+t+0]=a,y[u+t+1]=s,y[u+t+2]=n}if(u+=3*b,o(y,u,l(y,u-3*b-4,3*b+4)),u+=4,x){for(o(y,u,b),u+=4,d(y,u,"tRNS"),u+=4,p=0;p<b;p++)y[u+p]=e.plte[p]>>>24&255;u+=b,o(y,u,l(y,u-b-4,b+4)),u+=4}}let j=0;for(f=0;f<e.frames.length;f++){var N=e.frames[f];m&&(o(y,u,26),u+=4,d(y,u,"fcTL"),u+=4,o(y,u,j++),u+=4,o(y,u,N.rect.width),u+=4,o(y,u,N.rect.height),u+=4,o(y,u,N.rect.x),u+=4,o(y,u,N.rect.y),u+=4,c(y,u,n[f]),u+=2,c(y,u,1e3),u+=2,y[u]=N.dispose,u++,y[u]=N.blend,u++,o(y,u,l(y,u-30,30)),u+=4);const t=N.cimg;o(y,u,(b=t.length)+(0==f?0:4)),u+=4;const r=u;d(y,u,0==f?"IDAT":"fdAT"),u+=4,0!=f&&(o(y,u,j++),u+=4),y.set(t,u),u+=b,o(y,u,l(y,r,u-r)),u+=4}return o(y,u,0),u+=4,d(y,u,"IEND"),u+=4,o(y,u,l(y,u-4,4)),u+=4,y.buffer}function c(e,t,r){for(let a=0;a<e.frames.length;a++){const s=e.frames[a];s.rect.width;const n=s.rect.height,i=new Uint8Array(n*s.bpl+n);s.cimg=g(s.img,n,s.bpp,s.bpl,i,t,r)}}function d(t,r,a,s,n){const i=n[0],o=n[1],c=n[2],d=n[3],g=n[4],x=n[5];let b=6,p=8,f=255;for(var y=0;y<t.length;y++){const e=new Uint8Array(t[y]);for(var v=e.length,j=0;j<v;j+=4)f&=e[j+3]}const N=255!=f,w=function(t,r,a,s,n,i){const l=[];for(var o=0;o<t.length;o++){const u=new Uint8Array(t[o]),g=new Uint32Array(u.buffer);var c;let h=0,b=0,p=r,f=a,y=s?1:0;if(0!=o){const v=i||s||1==o||0!=l[o-2].dispose?1:2;let j=0,N=1e9;for(let e=0;e<v;e++){var d=new Uint8Array(t[o-1-e]);const s=new Uint32Array(t[o-1-e]);let i=r,l=a,c=-1,u=-1;for(let e=0;e<a;e++)for(let t=0;t<r;t++)g[x=e*r+t]!=s[x]&&(t<i&&(i=t),t>c&&(c=t),e<l&&(l=e),e>u&&(u=e));-1==c&&(i=l=c=u=0),n&&(!(1&~i)&&i--,!(1&~l)&&l--);const m=(c-i+1)*(u-l+1);m<N&&(N=m,j=e,h=i,b=l,p=c-i+1,f=u-l+1)}d=new Uint8Array(t[o-1-j]),1==j&&(l[o-1].dispose=2),c=new Uint8Array(p*f*4),e(d,r,a,c,p,f,-h,-b,0),y=e(u,r,a,c,p,f,-h,-b,3)?1:0,1==y?m(u,r,a,c,{x:h,y:b,width:p,height:f}):e(u,r,a,c,p,f,-h,-b,0)}else c=u.slice(0);l.push({rect:{x:h,y:b,width:p,height:f},img:c,blend:y,dispose:0})}if(s)for(o=0;o<l.length;o++){if(1==(h=l[o]).blend)continue;const e=h.rect,s=l[o-1].rect,i=Math.min(e.x,s.x),c=Math.min(e.y,s.y),d={x:i,y:c,width:Math.max(e.x+e.width,s.x+s.width)-i,height:Math.max(e.y+e.height,s.y+s.height)-c};l[o-1].dispose=1,o-1!=0&&u(t,r,a,l,o-1,d,n),u(t,r,a,l,o,d,n)}let g=0;if(1!=t.length)for(var x=0;x<l.length;x++){var h;g+=(h=l[x]).rect.width*h.rect.height}return l}(t,r,a,i,o,c),k={},S=[],_=[];if(0!=s){const e=[];for(j=0;j<w.length;j++)e.push(w[j].img.buffer);const t=h(function(e){let t=0;for(var r=0;r<e.length;r++)t+=e[r].byteLength;const a=new Uint8Array(t);let s=0;for(r=0;r<e.length;r++){const t=new Uint8Array(e[r]),n=t.length;for(let e=0;e<n;e+=4){let r=t[e],n=t[e+1],i=t[e+2];const l=t[e+3];0==l&&(r=n=i=0),a[s+e]=r,a[s+e+1]=n,a[s+e+2]=i,a[s+e+3]=l}s+=n}return a.buffer}(e),s);for(j=0;j<t.plte.length;j++)S.push(t.plte[j].est.rgba);let r=0;for(j=0;j<w.length;j++){const e=(C=w[j]).img.length;var A=new Uint8Array(t.inds.buffer,r>>2,e>>2);_.push(A);const a=new Uint8Array(t.abuf,r,e);x&&l(C.img,C.rect.width,C.rect.height,S,a,A),C.img.set(a),r+=e}}else for(y=0;y<w.length;y++){var C=w[y];const e=new Uint32Array(C.img.buffer);var P=C.rect.width;for(v=e.length,A=new Uint8Array(v),_.push(A),j=0;j<v;j++){const t=e[j];if(0!=j&&t==e[j-1])A[j]=A[j-1];else if(j>P&&t==e[j-P])A[j]=A[j-P];else{let e=k[t];if(null==e&&(k[t]=e=S.length,S.push(t),S.length>=300))break;A[j]=e}}}const I=S.length;for(I<=256&&0==g&&(p=I<=2?1:I<=4?2:I<=16?4:8,p=Math.max(p,d)),y=0;y<w.length;y++){(C=w[y]).rect.x,C.rect.y,P=C.rect.width;const e=C.rect.height;let t=C.img;new Uint32Array(t.buffer);let r=4*P,a=4;if(I<=256&&0==g){r=Math.ceil(p*P/8);var U=new Uint8Array(r*e);const s=_[y];for(let t=0;t<e;t++){j=t*r;const e=t*P;if(8==p)for(var L=0;L<P;L++)U[j+L]=s[e+L];else if(4==p)for(L=0;L<P;L++)U[j+(L>>1)]|=s[e+L]<<4-4*(1&L);else if(2==p)for(L=0;L<P;L++)U[j+(L>>2)]|=s[e+L]<<6-2*(3&L);else if(1==p)for(L=0;L<P;L++)U[j+(L>>3)]|=s[e+L]<<7-1*(7&L)}t=U,b=3,a=1}else if(0==N&&1==w.length){U=new Uint8Array(P*e*3);const s=P*e;for(j=0;j<s;j++){const e=3*j,r=4*j;U[e]=t[r],U[e+1]=t[r+1],U[e+2]=t[r+2]}t=U,b=2,a=3,r=3*P}C.img=t,C.bpl=r,C.bpp=a}return{ctype:b,depth:p,plte:S,frames:w}}function u(t,r,a,s,n,i,l){const o=Uint8Array,c=Uint32Array,d=new o(t[n-1]),u=new c(t[n-1]),g=n+1<t.length?new o(t[n+1]):null,x=new o(t[n]),h=new c(x.buffer);let b=r,p=a,f=-1,y=-1;for(let e=0;e<i.height;e++)for(let t=0;t<i.width;t++){const a=i.x+t,l=i.y+e,o=l*r+a,c=h[o];0==c||0==s[n-1].dispose&&u[o]==c&&(null==g||0!=g[4*o+3])||(a<b&&(b=a),a>f&&(f=a),l<p&&(p=l),l>y&&(y=l))}-1==f&&(b=p=f=y=0),l&&(!(1&~b)&&b--,!(1&~p)&&p--),i={x:b,y:p,width:f-b+1,height:y-p+1};const v=s[n];v.rect=i,v.blend=1,v.img=new Uint8Array(i.width*i.height*4),0==s[n-1].dispose?(e(d,r,a,v.img,i.width,i.height,-i.x,-i.y,0),m(x,r,a,v.img,i)):e(x,r,a,v.img,i.width,i.height,-i.x,-i.y,0)}function m(t,r,a,s,n){e(t,r,a,s,n.width,n.height,-n.x,-n.y,2)}function g(e,t,r,a,s,n,i){const l=[];let o,c=[0,1,2,3,4];-1!=n?c=[n]:(t*a>5e5||1==r)&&(c=[0]),i&&(o={level:0});const d=ke;for(var u=0;u<c.length;u++){for(let n=0;n<t;n++)x(s,e,n,a,r,c[u]);l.push(d.deflate(s,o))}let m,g=1e9;for(u=0;u<l.length;u++)l[u].length<g&&(m=u,g=l[u].length);return l[m]}function x(e,t,a,s,n,i){const l=a*s;let o=l+a;if(e[o]=i,o++,0==i)if(s<500)for(var c=0;c<s;c++)e[o+c]=t[l+c];else e.set(new Uint8Array(t.buffer,l,s),o);else if(1==i){for(c=0;c<n;c++)e[o+c]=t[l+c];for(c=n;c<s;c++)e[o+c]=t[l+c]-t[l+c-n]+256&255}else if(0==a){for(c=0;c<n;c++)e[o+c]=t[l+c];if(2==i)for(c=n;c<s;c++)e[o+c]=t[l+c];if(3==i)for(c=n;c<s;c++)e[o+c]=t[l+c]-(t[l+c-n]>>1)+256&255;if(4==i)for(c=n;c<s;c++)e[o+c]=t[l+c]-r(t[l+c-n],0,0)+256&255}else{if(2==i)for(c=0;c<s;c++)e[o+c]=t[l+c]+256-t[l+c-s]&255;if(3==i){for(c=0;c<n;c++)e[o+c]=t[l+c]+256-(t[l+c-s]>>1)&255;for(c=n;c<s;c++)e[o+c]=t[l+c]+256-(t[l+c-s]+t[l+c-n]>>1)&255}if(4==i){for(c=0;c<n;c++)e[o+c]=t[l+c]+256-r(0,t[l+c-s],0)&255;for(c=n;c<s;c++)e[o+c]=t[l+c]+256-r(t[l+c-n],t[l+c-s],t[l+c-n-s])&255}}}function h(e,t){const r=new Uint8Array(e),a=r.slice(0),s=new Uint32Array(a.buffer),n=b(a,t),i=n[0],l=n[1],o=r.length,c=new Uint8Array(o>>2);let d;if(r.length<2e7)for(var u=0;u<o;u+=4)d=p(i,m=r[u]*(1/255),g=r[u+1]*(1/255),x=r[u+2]*(1/255),h=r[u+3]*(1/255)),c[u>>2]=d.ind,s[u>>2]=d.est.rgba;else for(u=0;u<o;u+=4){var m=r[u]*(1/255),g=r[u+1]*(1/255),x=r[u+2]*(1/255),h=r[u+3]*(1/255);for(d=i;d.left;)d=f(d.est,m,g,x,h)<=0?d.left:d.right;c[u>>2]=d.ind,s[u>>2]=d.est.rgba}return{abuf:a.buffer,inds:c,plte:l}}function b(e,t,r){null==r&&(r=1e-4);const a=new Uint32Array(e.buffer),s={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};s.bst=j(e,s.i0,s.i1),s.est=N(s.bst);const n=[s];for(;n.length<t;){let t=0,s=0;for(var i=0;i<n.length;i++)n[i].est.L>t&&(t=n[i].est.L,s=i);if(t<r)break;const l=n[s],o=y(e,a,l.i0,l.i1,l.est.e,l.est.eMq255);if(l.i0>=o||l.i1<=o){l.est.L=0;continue}const c={i0:l.i0,i1:o,bst:null,est:null,tdst:0,left:null,right:null};c.bst=j(e,c.i0,c.i1),c.est=N(c.bst);const d={i0:o,i1:l.i1,bst:null,est:null,tdst:0,left:null,right:null};for(d.bst={R:[],m:[],N:l.bst.N-c.bst.N},i=0;i<16;i++)d.bst.R[i]=l.bst.R[i]-c.bst.R[i];for(i=0;i<4;i++)d.bst.m[i]=l.bst.m[i]-c.bst.m[i];d.est=N(d.bst),l.left=c,l.right=d,n[s]=c,n.push(d)}for(n.sort((e,t)=>t.bst.N-e.bst.N),i=0;i<n.length;i++)n[i].ind=i;return[s,n]}function p(e,t,r,a,s){if(null==e.left)return e.tdst=function(e,t,r,a,s){const n=t-e[0],i=r-e[1],l=a-e[2],o=s-e[3];return n*n+i*i+l*l+o*o}(e.est.q,t,r,a,s),e;const n=f(e.est,t,r,a,s);let i=e.left,l=e.right;n>0&&(i=e.right,l=e.left);const o=p(i,t,r,a,s);if(o.tdst<=n*n)return o;const c=p(l,t,r,a,s);return c.tdst<o.tdst?c:o}function f(e,t,r,a,s){const{e:n}=e;return n[0]*t+n[1]*r+n[2]*a+n[3]*s-e.eMq}function y(e,t,r,a,s,n){for(a-=4;r<a;){for(;v(e,r,s)<=n;)r+=4;for(;v(e,a,s)>n;)a-=4;if(r>=a)break;const i=t[r>>2];t[r>>2]=t[a>>2],t[a>>2]=i,r+=4,a-=4}for(;v(e,r,s)>n;)r-=4;return r+4}function v(e,t,r){return e[t]*r[0]+e[t+1]*r[1]+e[t+2]*r[2]+e[t+3]*r[3]}function j(e,t,r){const a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=[0,0,0,0],n=r-t>>2;for(let i=t;i<r;i+=4){const t=e[i]*(1/255),r=e[i+1]*(1/255),n=e[i+2]*(1/255),l=e[i+3]*(1/255);s[0]+=t,s[1]+=r,s[2]+=n,s[3]+=l,a[0]+=t*t,a[1]+=t*r,a[2]+=t*n,a[3]+=t*l,a[5]+=r*r,a[6]+=r*n,a[7]+=r*l,a[10]+=n*n,a[11]+=n*l,a[15]+=l*l}return a[4]=a[1],a[8]=a[2],a[9]=a[6],a[12]=a[3],a[13]=a[7],a[14]=a[11],{R:a,m:s,N:n}}function N(e){const{R:t}=e,{m:r}=e,{N:a}=e,s=r[0],n=r[1],i=r[2],l=r[3],o=0==a?0:1/a,c=[t[0]-s*s*o,t[1]-s*n*o,t[2]-s*i*o,t[3]-s*l*o,t[4]-n*s*o,t[5]-n*n*o,t[6]-n*i*o,t[7]-n*l*o,t[8]-i*s*o,t[9]-i*n*o,t[10]-i*i*o,t[11]-i*l*o,t[12]-l*s*o,t[13]-l*n*o,t[14]-l*i*o,t[15]-l*l*o],d=c,u=w;let m=[Math.random(),Math.random(),Math.random(),Math.random()],g=0,x=0;if(0!=a)for(let b=0;b<16&&(m=u.multVec(d,m),x=Math.sqrt(u.dot(m,m)),m=u.sml(1/x,m),!(0!=b&&Math.abs(x-g)<1e-9));b++)g=x;const h=[s*o,n*o,i*o,l*o];return{Cov:c,q:h,e:m,L:g,eMq255:u.dot(u.sml(255,h),m),eMq:u.dot(m,h),rgba:(Math.round(255*h[3])<<24|Math.round(255*h[2])<<16|Math.round(255*h[1])<<8|Math.round(255*h[0]))>>>0}}var w={multVec:(e,t)=>[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],sml:(e,t)=>[e*t[0],e*t[1],e*t[2],e*t[3]]};Se.encode=function(e,t,r,a,s,n,i){null==a&&(a=0),null==i&&(i=!1);const l=d(e,t,r,a,[!1,!1,!1,0,i,!1]);return c(l,-1),o(l,t,r,s,n)},Se.encodeLL=function(e,t,r,a,s,n,i,l){const d={ctype:0+(1==a?0:2)+(0==s?0:4),depth:n,frames:[]},u=(a+s)*n,m=u*t;for(let o=0;o<e.length;o++)d.frames.push({rect:{x:0,y:0,width:t,height:r},img:new Uint8Array(e[o]),blend:0,dispose:1,bpp:Math.ceil(u/8),bpl:Math.ceil(m/8)});return c(d,0,!0),o(d,t,r,i,l)},Se.encode.compress=d,Se.encode.dither=l,Se.quantize=h,Se.quantize.getKDtree=b,Se.quantize.getNearest=p}();const _e={toArrayBuffer(e,t){const r=e.width,a=e.height,s=r<<2,n=e.getContext("2d").getImageData(0,0,r,a),i=new Uint32Array(n.data.buffer),l=(32*r+31)/32<<2,o=l*a,c=122+o,d=new ArrayBuffer(c),u=new DataView(d),m=1<<20;let g,x,h,b,p=m,f=0,y=0,v=0;function j(e){u.setUint16(y,e,!0),y+=2}function N(e){u.setUint32(y,e,!0),y+=4}function w(e){y+=e}j(19778),N(c),w(4),N(122),N(108),N(r),N(-a>>>0),j(1),j(32),N(3),N(o),N(2835),N(2835),w(8),N(16711680),N(65280),N(255),N(4278190080),N(1466527264),function e(){for(;f<a&&p>0;){for(b=122+f*l,g=0;g<s;)p--,x=i[v++],h=x>>>24,u.setUint32(b+g,x<<8|h),g+=4;f++}v<i.length?(p=m,setTimeout(e,_e._dly)):t(d)}()},toBlob(e,t){this.toArrayBuffer(e,e=>{t(new Blob([e],{type:"image/bmp"}))})},_dly:9};var Ae={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Ce={[Ae.CHROME]:16384,[Ae.FIREFOX]:11180,[Ae.DESKTOP_SAFARI]:16384,[Ae.IE]:8192,[Ae.IOS]:4096,[Ae.ETC]:8192};const Pe="undefined"!=typeof window,Ie="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,Ue=Pe&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Le=(Pe||Ie)&&(Ue&&Ue.getOriginalSymbol(window,"File")||"undefined"!=typeof File&&File),Fe=(Pe||Ie)&&(Ue&&Ue.getOriginalSymbol(window,"FileReader")||"undefined"!=typeof FileReader&&FileReader);function Ee(e,t,r=Date.now()){return new Promise(a=>{const s=e.split(","),n=s[0].match(/:(.*?);/)[1],i=globalThis.atob(s[1]);let l=i.length;const o=new Uint8Array(l);for(;l--;)o[l]=i.charCodeAt(l);const c=new Blob([o],{type:n});c.name=t,c.lastModified=r,a(c)})}function qe(e){return new Promise((t,r)=>{const a=new Fe;a.onload=()=>t(a.result),a.onerror=e=>r(e),a.readAsDataURL(e)})}function De(e){return new Promise((t,r)=>{const a=new Image;a.onload=()=>t(a),a.onerror=e=>r(e),a.src=e})}function Re(){if(void 0!==Re.cachedResult)return Re.cachedResult;let e=Ae.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=Ae.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=Ae.IOS:/Safari/i.test(t)?e=Ae.DESKTOP_SAFARI:/Firefox/i.test(t)?e=Ae.FIREFOX:(/MSIE/i.test(t)||1==!!document.documentMode)&&(e=Ae.IE),Re.cachedResult=e,Re.cachedResult}function Me(e,t){const r=Re(),a=Ce[r];let s=e,n=t,i=s*n;const l=s>n?n/s:s/n;for(;i>a*a;){const e=(a+s)/2,t=(a+n)/2;e<t?(n=t,s=t*l):(n=e*l,s=e),i=s*n}return{width:s,height:n}}function Te(e,t){let r,a;try{if(r=new OffscreenCanvas(e,t),a=r.getContext("2d"),null===a)throw new Error("getContext of OffscreenCanvas returns null")}catch(s){r=document.createElement("canvas"),a=r.getContext("2d")}return r.width=e,r.height=t,[r,a]}function $e(e,t){const{width:r,height:a}=Me(e.width,e.height),[s,n]=Te(r,a);return t&&/jpe?g/.test(t)&&(n.fillStyle="white",n.fillRect(0,0,s.width,s.height)),n.drawImage(e,0,0,s.width,s.height),s}function Oe(){return void 0!==Oe.cachedResult||(Oe.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"undefined"!=typeof document&&"ontouchend"in document),Oe.cachedResult}function ze(e,t={}){return new Promise(function(r,a){let s,n;var i=function(){try{return n=$e(s,t.fileType||e.type),r([s,n])}catch(i){return a(i)}},l=function(t){try{var r=function(e){try{throw e}catch(t){return a(t)}};try{let t;return qe(e).then(function(e){try{return t=e,De(t).then(function(e){try{return s=e,function(){try{return i()}catch(e){return a(e)}}()}catch(t){return r(t)}},r)}catch(n){return r(n)}},r)}catch(n){r(n)}}catch(n){return a(n)}};try{if(Oe()||[Ae.DESKTOP_SAFARI,Ae.MOBILE_SAFARI].includes(Re()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then(function(e){try{return s=e,i()}catch(t){return l()}},l)}catch(o){l()}})}function Qe(e,t,r,a,s=1){return new Promise(function(n,i){let l;if("image/png"===t){let n,i,c;return n=e.getContext("2d"),({data:i}=n.getImageData(0,0,e.width,e.height)),c=Se.encode([i.buffer],e.width,e.height,4096*s),l=new Blob([c],{type:t}),l.name=r,l.lastModified=a,o.call(this)}{let n=function(){return o.call(this)};if("image/bmp"===t)return new Promise(t=>_e.toBlob(e,t)).then(function(e){try{return l=e,l.name=r,l.lastModified=a,n.call(this)}catch(t){return i(t)}}.bind(this),i);{let o=function(){return n.call(this)};if("function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return e.convertToBlob({type:t,quality:s}).then(function(e){try{return l=e,l.name=r,l.lastModified=a,o.call(this)}catch(t){return i(t)}}.bind(this),i);{let n;return n=e.toDataURL(t,s),Ee(n,r,a).then(function(e){try{return l=e,o.call(this)}catch(t){return i(t)}}.bind(this),i)}}}function o(){return n(l)}})}function Be(e){e.width=0,e.height=0}function Ve(){return new Promise(function(e,t){let r,a,s,n;return void 0!==Ve.cachedResult?e(Ve.cachedResult):Ee("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(i){try{return r=i,ze(r).then(function(i){try{return a=i[1],Qe(a,r.type,r.name,r.lastModified).then(function(r){try{return s=r,Be(a),ze(s).then(function(r){try{return n=r[0],Ve.cachedResult=1===n.width&&2===n.height,e(Ve.cachedResult)}catch(a){return t(a)}},t)}catch(i){return t(i)}},t)}catch(l){return t(l)}},t)}catch(l){return t(l)}},t)})}function He(e){return new Promise((t,r)=>{const a=new Fe;a.onload=e=>{const r=new DataView(e.target.result);if(65496!=r.getUint16(0,!1))return t(-2);const a=r.byteLength;let s=2;for(;s<a;){if(r.getUint16(s+2,!1)<=8)return t(-1);const e=r.getUint16(s,!1);if(s+=2,65505==e){if(1165519206!=r.getUint32(s+=2,!1))return t(-1);const e=18761==r.getUint16(s+=6,!1);s+=r.getUint32(s+4,e);const a=r.getUint16(s,e);s+=2;for(let n=0;n<a;n++)if(274==r.getUint16(s+12*n,e))return t(r.getUint16(s+12*n+8,e))}else{if(65280&~e)break;s+=r.getUint16(s,!1)}}return t(-1)},a.onerror=e=>r(e),a.readAsArrayBuffer(e)})}function Ge(e,t){const{width:r}=e,{height:a}=e,{maxWidthOrHeight:s}=t;let n,i=e;return isFinite(s)&&(r>s||a>s)&&([i,n]=Te(r,a),r>a?(i.width=s,i.height=a/r*s):(i.width=r/a*s,i.height=s),n.drawImage(e,0,0,i.width,i.height),Be(e)),i}function We(e,t){const{width:r}=e,{height:a}=e,[s,n]=Te(r,a);switch(t>4&&t<9?(s.width=a,s.height=r):(s.width=r,s.height=a),t){case 2:n.transform(-1,0,0,1,r,0);break;case 3:n.transform(-1,0,0,-1,r,a);break;case 4:n.transform(1,0,0,-1,0,a);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,a,0);break;case 7:n.transform(0,-1,-1,0,a,r);break;case 8:n.transform(0,-1,1,0,0,r)}return n.drawImage(e,0,0,r,a),Be(e),s}function Ke(e,t,r=0){return new Promise(function(a,s){let n,i,l,o,c,d,u,m,g,x,h,b,p,f,y,v,j,N,w,k;function S(e=5){if(t.signal&&t.signal.aborted)throw t.signal.reason;n+=e,t.onProgress(Math.min(n,100))}function _(e){if(t.signal&&t.signal.aborted)throw t.signal.reason;n=Math.min(Math.max(e,n),100),t.onProgress(n)}return n=r,i=t.maxIteration||10,l=1024*t.maxSizeMB*1024,S(),ze(e,t).then(function(r){try{return[,o]=r,S(),c=Ge(o,t),S(),new Promise(function(r,a){var s;if(!(s=t.exifOrientation))return He(e).then(function(e){try{return s=e,n.call(this)}catch(t){return a(t)}}.bind(this),a);function n(){return r(s)}return n.call(this)}).then(function(r){try{return d=r,S(),Ve().then(function(r){try{return u=r?c:We(c,d),S(),m=t.initialQuality||1,g=t.fileType||e.type,Qe(u,g,e.name,e.lastModified,m).then(function(r){try{{let d=function(){if(i--&&(y>l||y>p)){let t,r;return t=k?.95*w.width:w.width,r=k?.95*w.height:w.height,[j,N]=Te(t,r),N.drawImage(w,0,0,t,r),m*="image/png"===g?.85:.95,Qe(j,g,e.name,e.lastModified,m).then(function(e){try{return v=e,Be(w),w=j,y=v.size,_(Math.min(99,Math.floor((f-y)/(f-l)*100))),d}catch(t){return s(t)}},s)}return[1]},A=function(){return Be(w),Be(j),Be(c),Be(u),Be(o),_(100),a(v)};return x=r,S(),h=x.size>l,b=x.size>e.size,h||b?(p=e.size,f=x.size,y=f,w=u,k=!t.alwaysKeepResolution&&h,(n=function(e){for(;e;){if(e.then)return void e.then(n,s);try{if(e.pop){if(e.length)return e.pop()?A.call(this):e;e=d}else e=e.call(this)}catch(t){return s(t)}}}.bind(this))(d)):(_(100),a(x));var n}}catch(d){return s(d)}}.bind(this),s)}catch(n){return s(n)}}.bind(this),s)}catch(n){return s(n)}}.bind(this),s)}catch(n){return s(n)}}.bind(this),s)})}let Xe;function Ye(e,t){return new Promise(function(r,a){let s,n,i,l,o,c;if(s={...t},i=0,({onProgress:l}=s),s.maxSizeMB=s.maxSizeMB||Number.POSITIVE_INFINITY,o="boolean"!=typeof s.useWebWorker||s.useWebWorker,delete s.useWebWorker,s.onProgress=e=>{i=e,"function"==typeof l&&l(i)},!(e instanceof Blob||e instanceof Le))return a(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return a(new Error("The file given is not an image"));if(c="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!o||"function"!=typeof Worker||c)return Ke(e,s).then(function(e){try{return n=e,m.call(this)}catch(t){return a(t)}}.bind(this),a);var d=function(){try{return m.call(this)}catch(e){return a(e)}}.bind(this),u=function(t){try{return Ke(e,s).then(function(e){try{return n=e,d()}catch(t){return a(t)}},a)}catch(r){return a(r)}};try{return s.libURL=s.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",function(e,t){return new Promise((r,a)=>{Xe||(Xe=function(e){const t=[];return"function"==typeof e?t.push(`(${e})()`):t.push(e),URL.createObjectURL(new Blob(t))}("\nlet scriptImported = false\nself.addEventListener('message', async (e) => {\n  const { file, id, imageCompressionLibUrl, options } = e.data\n  options.onProgress = (progress) => self.postMessage({ progress, id })\n  try {\n    if (!scriptImported) {\n      // console.log('[worker] importScripts', imageCompressionLibUrl)\n      self.importScripts(imageCompressionLibUrl)\n      scriptImported = true\n    }\n    // console.log('[worker] self', self)\n    const compressedFile = await imageCompression(file, options)\n    self.postMessage({ file: compressedFile, id })\n  } catch (e) {\n    // console.error('[worker] error', e)\n    self.postMessage({ error: e.message + '\\n' + e.stack, id })\n  }\n})\n"));const s=new Worker(Xe);s.addEventListener("message",function(e){if(t.signal&&t.signal.aborted)s.terminate();else if(void 0===e.data.progress){if(e.data.error)return a(new Error(e.data.error)),void s.terminate();r(e.data.file),s.terminate()}else t.onProgress(e.data.progress)}),s.addEventListener("error",a),t.signal&&t.signal.addEventListener("abort",()=>{a(t.signal.reason),s.terminate()}),s.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:{...t,onProgress:void 0,signal:void 0}})})}(e,s).then(function(e){try{return n=e,d()}catch(t){return u()}},u)}catch(g){u()}function m(){try{n.name=e.name,n.lastModified=e.lastModified}catch(g){}try{s.preserveExif&&"image/jpeg"===e.type&&(!s.fileType||s.fileType&&s.fileType===e.type)&&(n=be(e,n))}catch(g){}return r(n)}})}Ye.getDataUrlFromFile=qe,Ye.getFilefromDataUrl=Ee,Ye.loadImage=De,Ye.drawImageInCanvas=$e,Ye.drawFileInCanvas=ze,Ye.canvasToFile=Qe,Ye.getExifOrientation=He,Ye.handleMaxWidthOrHeight=Ge,Ye.followExifOrientation=We,Ye.cleanupCanvasMemory=Be,Ye.isAutoOrientationInBrowser=Ve,Ye.approximateBelowMaximumCanvasSizeOfBrowser=Me,Ye.copyExifWithoutOrientation=be,Ye.getBrowserName=Re,Ye.version="2.0.2";const Ze=({productId:r,userId:a,existingImages:s=[],onImagesChange:n,maxImages:i=5,bucket:l="product-images",className:o=""})=>{const[c,u]=d.useState([]),[h,b]=d.useState(!1),[p,f]=d.useState({}),[y,v]=d.useState(!1),j=d.useRef(null);d.useEffect(()=>{if(s&&s.length>0){const e=s.map((e,t)=>({id:e.id||`existing-${t}`,url:e.image_url||e.url||"",thumbnailUrl:e.thumbnail_url||e.thumbnailUrl||e.image_url||e.url||"",fileName:e.file_name||e.fileName||`image-${t}.jpg`,fileSize:e.file_size||e.fileSize||0,isPrimary:e.is_primary||e.isPrimary||0===t,uploadedAt:e.created_at||e.uploadedAt||(new Date).toISOString()}));u(e)}},[]);const N=async e=>{try{const a=e.name.split(".").pop(),s=`${r}/${Date.now()}-${Math.random().toString(36).substring(7)}.${a}`;f(t=>({...t,[e.name]:10}));const n=await(async e=>{try{const t={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,fileType:"image/webp"};return await Ye(e,t)}catch(o){return e}})(e);f(t=>({...t,[e.name]:30}));const{data:i,error:o}=await t.storage.from(l).upload(s,n,{cacheControl:"3600",upsert:!1});if(o)throw o;f(t=>({...t,[e.name]:70}));const{data:{publicUrl:d}}=t.storage.from(l).getPublicUrl(s);return f(t=>({...t,[e.name]:100})),{id:`${Date.now()}-${Math.random().toString(36).substring(7)}`,url:d,thumbnailUrl:d,fileName:e.name,fileSize:n.size,isPrimary:0===c.length,uploadedAt:(new Date).toISOString()}}catch(a){return null}finally{setTimeout(()=>{f(t=>{const r={...t};return delete r[e.name],r})},1e3)}},w=d.useCallback(async e=>{if(!e||h)return;const t=Array.from(e),r=i-c.length,a=t.slice(0,r);if(0!==a.length){b(!0);try{const e=a.map(e=>N(e)),t=(await Promise.all(e)).filter(e=>null!==e);if(t.length>0){const e=[...c,...t];u(e),n(e)}}catch(s){}finally{b(!1)}}else alert(`Maximum ${i} images allowed`)},[c,i,h,n]);return e.jsxs("div",{className:`space-y-4 ${o}`,children:[c.length<i&&e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${y?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${h?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onDragOver:e=>{e.preventDefault(),v(!0)},onDragLeave:e=>{e.preventDefault(),v(!1)},onDrop:e=>{e.preventDefault(),v(!1),w(e.dataTransfer.files)},onClick:()=>{var e;return!h&&(null==(e=j.current)?void 0:e.click())},children:[e.jsx(m,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:h?"Uploading...":"Drag and drop images here, or click to select"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Supports: JPG, PNG, GIF (Max ",i," images)"]}),e.jsx("input",{ref:j,type:"file",multiple:!0,accept:"image/*",onChange:e=>w(e.target.files),className:"hidden",disabled:h})]}),c.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:c.map((r,a)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100 border border-gray-200",children:e.jsx("img",{src:r.thumbnailUrl||r.url,alt:r.fileName,className:"w-full h-full object-cover",onError:e=>{e.target.src=r.url}})}),void 0!==p[r.fileName]&&p[r.fileName]<100&&e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-70 rounded-lg flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-white text-xs mb-2",children:"Uploading..."}),e.jsx("div",{className:"w-3/4 bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-400 h-1.5 rounded-full transition-all duration-300",style:{width:`${p[r.fileName]}%`}})})]}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 rounded-lg",children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[!r.isPrimary&&e.jsx("button",{onClick:()=>(e=>{if(e===c.findIndex(e=>e.isPrimary))return;const t=c.map((t,r)=>({...t,isPrimary:r===e}));u(t),n(t)})(a),className:"p-1.5 bg-white rounded-full shadow-sm hover:bg-yellow-50 transition-colors",title:"Set as primary",disabled:h,children:e.jsx(g,{size:14,className:"text-yellow-500"})}),e.jsx("button",{onClick:()=>(async e=>{const r=c[e];if(r.url)try{const e=r.url.split("/"),a=e.indexOf(l);if(-1!==a){const r=e.slice(a+1).join("/");await t.storage.from(l).remove([r])}}catch(s){}const a=c.filter((t,r)=>r!==e);r.isPrimary&&a.length>0&&(a[0].isPrimary=!0),u(a),n(a)})(a),className:"p-1.5 bg-white rounded-full shadow-sm hover:bg-red-50 transition-colors",title:"Remove image",disabled:h,children:e.jsx(x,{size:14,className:"text-red-500"})})]}),r.isPrimary&&e.jsx("div",{className:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("div",{className:"px-2 py-1 bg-yellow-500 text-white text-xs rounded-full flex items-center gap-1 shadow-lg",children:[e.jsx(g,{size:12,fill:"white"}),"Primary"]})})]}),r.isPrimary&&e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx("div",{className:"px-2 py-0.5 bg-yellow-500 text-white text-xs rounded-full flex items-center gap-1",children:e.jsx(g,{size:10,fill:"white"})})})]},r.id))}),c.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:[c.length," of ",i," images uploaded"]})]})},Je=({variants:t,setVariants:r,useVariants:a,setUseVariants:s,showVariants:n,setShowVariants:i,isReorderingVariants:l,setIsReorderingVariants:o,draggedVariantIndex:c,setDraggedVariantIndex:u,onVariantSpecificationsClick:m,basePartNumber:g,mainProductImages:x})=>{const[k,S]=d.useState({}),_=(e,t,a)=>{r(r=>r.map((r,s)=>s===e?{...r,[t]:a}:r))},A=e=>`${g}-V${e.toString().padStart(2,"0")}`,C=e=>{if(!e&&0!==e)return"";const t="string"==typeof e?parseFloat(e.replace(/,/g,"")):e;return isNaN(t)?"":t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})},P=(e,t,r)=>{const a=(e=>{const t=e.replace(/,/g,""),r=parseFloat(t);return isNaN(r)?0:r})(r);_(e,t,a)},I=(e,t)=>{S(r=>({...r,[`${e}-${t}`]:!0}))},U=(e,t)=>{S(r=>({...r,[`${e}-${t}`]:!1}))},L=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},F=(e,t)=>{const r=e.toLowerCase(),a=t.toLowerCase();if(r.includes("storage")||r.includes("capacity")||r.includes("disk")){if(a.includes("gb")||a.includes("gigabyte"))return t;if(a.includes("tb")||a.includes("terabyte"))return t;if(a.includes("mb")||a.includes("megabyte"))return t;if(/^\d+$/.test(t))return`${t} GB`}if(r.includes("ram")||r.includes("memory")||r.includes("ddr")){if(a.includes("gb")||a.includes("gigabyte"))return t;if(a.includes("mb")||a.includes("megabyte"))return t;if(/^\d+$/.test(t))return`${t} GB`}if(r.includes("screen")||r.includes("display")||r.includes("monitor")||r.includes("size")){if(a.includes("inch")||a.includes('"')||a.includes("in"))return t;if(/^\d+(\.\d+)?$/.test(t))return`${t}"`}if(r.includes("weight")||r.includes("mass")){if(a.includes("kg")||a.includes("kilogram"))return t;if(a.includes("g")||a.includes("gram"))return t;if(a.includes("lb")||a.includes("pound"))return t;if(/^\d+(\.\d+)?$/.test(t))return`${t} kg`}if(r.includes("battery")||r.includes("mah")){if(a.includes("mah")||a.includes("milliampere"))return t;if(a.includes("wh")||a.includes("watt"))return t;if(/^\d+$/.test(t))return`${t} mAh`}if(r.includes("processor")||r.includes("cpu")||r.includes("ghz")){if(a.includes("ghz")||a.includes("gigahertz"))return t;if(a.includes("mhz")||a.includes("megahertz"))return t;if(/^\d+(\.\d+)?$/.test(t))return`${t} GHz`}if(r.includes("resolution")||r.includes("pixel")||r.includes("hd")){if(a.includes("p")||a.includes("pixel"))return t;if(a.includes("x")&&/^\d+x\d+$/.test(t))return t}if(r.includes("dimension")||r.includes("length")||r.includes("width")||r.includes("height")){if(a.includes("cm")||a.includes("centimeter"))return t;if(a.includes("mm")||a.includes("millimeter"))return t;if(a.includes("inch")||a.includes('"')||a.includes("in"))return t;if(/^\d+(\.\d+)?$/.test(t))return`${t} cm`}return t};return e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(h,{size:20,className:"text-green-600"}),"Spare Part Variants"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a&&t.length>0&&e.jsx(e.Fragment,{children:e.jsxs("button",{type:"button",onClick:()=>o(!l),className:"text-xs px-3 py-1 rounded "+(l?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"),title:"Toggle reorder mode",children:[e.jsx(b,{size:14,className:"inline mr-1"}),l?"Done":"Reorder"]})}),e.jsx("button",{type:"button",role:"switch","aria-checked":a,onClick:()=>{s(!a)},className:"relative inline-flex h-6 w-11 items-center rounded-full "+(a?"bg-blue-600":"bg-gray-300"),"aria-label":"Toggle variants",children:e.jsx("span",{className:"inline-block h-5 w-5 transform rounded-full bg-white transition "+(a?"translate-x-5":"translate-x-1")})})]})]}),a&&n&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:t.map((t,a)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",draggable:l,onDragStart:e=>((e,t)=>{u(t),e.dataTransfer.effectAllowed="move"})(e,a),onDragOver:L,onDrop:e=>((e,t)=>{e.preventDefault(),null!==c&&c!==t&&(r(e=>{const r=[...e],a=r[c];return r.splice(c,1),r.splice(t,0,a),r}),u(null))})(e,a),onDragEnd:()=>u(null),style:{cursor:l?"grabbing":"grab"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l&&e.jsx("div",{className:"w-6 h-6 flex items-center justify-center text-gray-400",children:e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 6h8v2H8V6zm0 5h8v2H8v-2zm0 5h8v2H8v-2z"})})}),e.jsx("h4",{className:"font-medium text-gray-900",children:t.name||`Variant ${a+1}`})]}),e.jsx("div",{className:"flex items-center gap-2",children:!l&&e.jsx("button",{type:"button",onClick:()=>(e=>{r(t=>t.filter((t,r)=>r!==e))})(a),className:"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50 transition-colors","aria-label":"Remove variant",children:e.jsx(p,{size:16})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.name,onChange:e=>_(a,"name",e.target.value),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors border-gray-300 focus:border-blue-500",placeholder:"Variant name",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(f,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SKU (Auto Generated)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.sku,readOnly:!0,className:"w-full py-3 pl-12 pr-4 bg-gray-100 border-2 rounded-lg border-gray-300 text-gray-600 cursor-not-allowed",placeholder:"Auto-generated"}),e.jsx(y,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"SKU is automatically generated for this variant"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Variant Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover rounded-lg"}):x&&x.length>0?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:x[0],alt:`${t.name} (using main product image)`,className:"w-full h-full object-cover rounded-lg opacity-60"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-600 bg-white/80 px-1 rounded",children:"Main"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(v,{size:24,className:"text-gray-400 mx-auto mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"No image"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Ze,{onImageChange:e=>((e,t)=>{if(t){const r=URL.createObjectURL(t);_(e,"image_file",t),_(e,"image_url",r)}else _(e,"image_file",null),_(e,"image_url","")})(a,e),currentImage:t.image_file,className:"w-full",accept:"image/*",maxSize:5242880}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Upload a specific image for this variant. If no image is uploaded, the main product image will be used."})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsx("button",{type:"button",onClick:()=>m(a),className:"group w-full bg-gradient-to-r from-white/50 to-white/30 backdrop-blur-md border-2 border-gray-300 rounded-xl hover:border-purple-500 hover:shadow-lg hover:scale-[1.02] transition-all duration-300 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center group-hover:from-purple-600 group-hover:to-purple-700 transition-all duration-300 shadow-md group-hover:shadow-lg",children:e.jsx(h,{className:"w-5 h-5 text-white"})}),t.attributes&&Object.keys(t.attributes).length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center shadow-md",children:e.jsx(j,{className:"w-2.5 h-2.5 text-white"})})]}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 group-hover:text-purple-900 transition-colors duration-300",children:"Specifications"}),t.attributes&&Object.keys(t.attributes).length>0?e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"grid grid-cols-2 gap-1 max-h-12 overflow-y-auto",children:Object.entries(t.attributes).slice(0,4).map(([t,r])=>e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-md px-1.5 py-0.5",children:[e.jsx("div",{className:"text-xs font-medium text-purple-800 truncate",children:t}),e.jsx("div",{className:"text-xs text-purple-600 truncate",children:F(t,String(r))})]},t))}),Object.keys(t.attributes).length>4&&e.jsxs("div",{className:"text-xs text-purple-600 mt-0.5",children:["+",Object.keys(t.attributes).length-4," more"]})]}):e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Add variant specifications"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.attributes&&Object.keys(t.attributes).length>0&&e.jsx("div",{className:"px-2.5 py-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white text-xs font-bold rounded-full shadow-md",children:Object.keys(t.attributes).length}),e.jsx("div",{className:"w-6 h-6 bg-gray-100 group-hover:bg-purple-100 rounded-lg flex items-center justify-center transition-all duration-300",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500 group-hover:text-purple-600 transition-colors duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Price *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors border-gray-300 focus:border-blue-500",placeholder:"0",autoComplete:"off",autoCorrect:"off",spellCheck:!1,value:t.cost_price&&0!==t.cost_price?C(t.cost_price):"",onChange:e=>{const t=e.target.value;(""===t||/^[\d,]*\.?\d*$/.test(t))&&P(a,"cost_price",t)},onFocus:()=>I(a,"cost_price"),onBlur:()=>U(a,"cost_price")}),e.jsx(N,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selling Price *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors border-gray-300 focus:border-blue-500",placeholder:"0",autoComplete:"off",autoCorrect:"off",spellCheck:!1,value:t.selling_price&&0!==t.selling_price?C(t.selling_price):"",onChange:e=>{const t=e.target.value;(""===t||/^[\d,]*\.?\d*$/.test(t))&&P(a,"selling_price",t)},onFocus:()=>I(a,"selling_price"),onBlur:()=>U(a,"selling_price")}),e.jsx(N,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock Quantity *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:0===t.quantity?"":t.quantity||"",onChange:e=>_(a,"quantity",Math.max(0,parseInt(e.target.value)||0)),onFocus:e=>{0===t.quantity&&(e.target.value="")},className:"w-full py-3 px-20 bg-white/30 backdrop-blur-md border-2 rounded-lg text-center text-lg font-semibold text-gray-900 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"0",min:"0",step:"1"}),e.jsx("button",{type:"button",onClick:()=>_(a,"quantity",Math.max(0,(t.quantity||0)-1)),className:"absolute left-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Decrease stock quantity",children:""}),e.jsx("button",{type:"button",onClick:()=>_(a,"quantity",(t.quantity||0)+1),className:"absolute right-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Increase stock quantity",children:"+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Stock Level *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:0===t.min_quantity?"":t.min_quantity||"",onChange:e=>_(a,"min_quantity",Math.max(0,parseInt(e.target.value)||0)),onFocus:e=>{0===t.min_quantity&&(e.target.value="")},className:"w-full py-3 px-20 bg-white/30 backdrop-blur-md border-2 rounded-lg text-center text-lg font-semibold text-gray-900 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"2",min:"0",step:"1"}),e.jsx("button",{type:"button",onClick:()=>_(a,"min_quantity",Math.max(0,(t.min_quantity||0)-1)),className:"absolute left-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Decrease minimum stock level",children:""}),e.jsx("button",{type:"button",onClick:()=>_(a,"min_quantity",(t.min_quantity||0)+1),className:"absolute right-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Increase minimum stock level",children:"+"})]})]})]})]},a))}),e.jsxs("button",{type:"button",onClick:()=>{const e=t.length>0?t[t.length-1]:null,a={name:`Variant ${t.length+1}`,sku:A(t.length+1),cost_price:(null==e?void 0:e.cost_price)||0,selling_price:(null==e?void 0:e.selling_price)||0,quantity:(null==e?void 0:e.quantity)||0,min_quantity:(null==e?void 0:e.min_quantity)||2,attributes:(null==e?void 0:e.attributes)?{...e.attributes}:{}};r(e=>[...e,a])},className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all flex items-center justify-center gap-2 text-gray-600 hover:text-blue-600",children:[e.jsx(w,{size:20}),"Add New Variant"]})]})]})},et=async(e,r=5)=>{try{if(!e||e.length<2)return[];const a=await(async e=>{try{const{data:r,error:a}=await t.from("lats_spare_parts").select("brand, updated_at").not("brand","is",null).neq("brand","").ilike("brand",`%${e}%`).eq("is_active",!0);if(a)throw a;const s=new Map;return(r||[]).forEach(e=>{var t;const r=null==(t=e.brand)?void 0:t.trim();if(r){const t=s.get(r);t?(t.count+=1,e.updated_at>t.lastUsed&&(t.lastUsed=e.updated_at)):s.set(r,{count:1,lastUsed:e.updated_at})}}),{data:Array.from(s.entries()).map(([e,t])=>({name:e,count:t.count,lastUsed:t.lastUsed})).sort((t,r)=>{const a=t.name.toLowerCase()===e.toLowerCase(),s=r.name.toLowerCase()===e.toLowerCase();return a&&!s?-1:!a&&s?1:r.count-t.count}),message:"Brands found successfully",ok:!0}}catch(r){return{data:[],message:r instanceof Error?r.message:"Failed to search brands",ok:!1}}})(e);if(!a.ok)return[];return a.data.slice(0,r).map(e=>e.name)}catch(a){return[]}},tt=({value:t,onChange:r,placeholder:a="e.g., Apple, Samsung",className:s="",error:n,required:i=!1})=>{const[l,o]=d.useState([]),[c,u]=d.useState(!1),[m,g]=d.useState(!1),[h,b]=d.useState(t),p=d.useRef(null),f=d.useRef(null);d.useEffect(()=>{b(t)},[t]),d.useEffect(()=>{const e=setTimeout(async()=>{if(h.length>=2){g(!0);try{const e=await et(h);o(e),u(e.length>0)}catch(e){o([]),u(!1)}finally{g(!1)}}else o([]),u(!1)},300);return()=>clearTimeout(e)},[h]),d.useEffect(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&p.current&&!p.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const y=e=>{var t;b(e),r(e),u(!1),null==(t=p.current)||t.focus()};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:p,type:"text",value:h,onChange:e=>{const t=e.target.value;b(t),r(t)},onKeyDown:e=>{var t;if("Escape"===e.key)u(!1);else if("ArrowDown"===e.key){e.preventDefault();const r=null==(t=f.current)?void 0:t.querySelector("button");r&&r.focus()}},onFocus:()=>{l.length>0&&u(!0)},className:`w-full py-3 pl-12 pr-10 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none transition-colors text-sm ${n?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"} ${s}`,placeholder:a,required:i,autoComplete:"off",spellCheck:!1}),e.jsx(k,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:16}),h&&e.jsx("button",{type:"button",onClick:()=>{var e;b(""),r(""),u(!1),null==(e=p.current)||e.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Clear input",children:e.jsx(x,{size:14,className:"text-gray-500"})}),m&&e.jsx("div",{className:"absolute right-8 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]}),c&&l.length>0&&e.jsx("div",{ref:f,className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:l.map((t,r)=>e.jsx("button",{type:"button",onClick:()=>y(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0 transition-colors",onKeyDown:e=>{var r;if("ArrowDown"===e.key){e.preventDefault();const t=e.currentTarget.nextElementSibling;t&&t.focus()}else if("ArrowUp"===e.key){e.preventDefault();const t=e.currentTarget.previousElementSibling;t?t.focus():null==(r=p.current)||r.focus()}else"Enter"===e.key&&(e.preventDefault(),y(t))},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:t})]})},t))}),n&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:n})]})};const rt=new class{async getUserDevicePreferences(){try{const{data:e,error:r}=await t.from("user_device_preferences").select("*").order("last_used",{ascending:!1});if(r)throw r;return e||[]}catch(e){return[]}}async saveDevicePreference(e){try{const{data:r,error:a}=await t.from("user_device_preferences").upsert({device_name:e.device_name,device_category:e.device_category,device_brand:e.device_brand,usage_count:1,last_used:(new Date).toISOString()},{onConflict:"user_id,device_name",ignoreDuplicates:!1}).select().single();if(a)throw a;return r}catch(r){return null}}async incrementDeviceUsage(e){try{const{error:r}=await t.rpc("increment_device_usage",{device_name_param:e});if(r)throw r}catch(r){}}async removeDevicePreference(e){try{const{error:r}=await t.from("user_device_preferences").delete().eq("device_name",e);if(r)throw r;return!0}catch(r){return!1}}async getMostUsedDevices(e=10){try{const{data:r,error:a}=await t.from("user_device_preferences").select("*").order("usage_count",{ascending:!1}).limit(e);if(a)throw a;return r||[]}catch(r){return[]}}async getRecentDevices(e=10){try{const{data:r,error:a}=await t.from("user_device_preferences").select("*").order("last_used",{ascending:!1}).limit(e);if(a)throw a;return r||[]}catch(r){return[]}}async searchDevices(e,r=8){try{const{data:a,error:s}=await t.from("user_device_preferences").select("*").ilike("device_name",`%${e}%`).order("usage_count",{ascending:!1}).limit(r);if(s)throw s;return a||[]}catch(a){return[]}}};const at=new class{constructor(){this.STORAGE_KEY="lats_saved_devices",this.cache=new Map,this.cacheLoaded=!1,this.isProduction=!0,this.isProduction=!1,this.loadCache()}async loadDevices(){return this.isProduction?await this.loadFromDatabase():await this.loadFromLocalStorage()}async saveDevice(e,t,r){const a={device_name:e,device_category:t,device_brand:r,usage_count:1,last_used:(new Date).toISOString()};return this.isProduction?await this.saveToDatabase(a):await this.saveToLocalStorage(a)}async incrementUsage(e){this.isProduction?await this.incrementUsageInDatabase(e):await this.incrementUsageInLocalStorage(e)}async removeDevice(e){return this.isProduction?await this.removeFromDatabase(e):await this.removeFromLocalStorage(e)}async searchDevices(e){try{if(this.isProduction)try{const{error:r}=await t.from("user_device_preferences").select("id").limit(1);if(!r||"42P01"!==r.code)return await rt.searchDevices(e)}catch(r){}return(await this.loadDevices()).filter(t=>{var r,a;return t.device_name.toLowerCase().includes(e.toLowerCase())||(null==(r=t.device_brand)?void 0:r.toLowerCase().includes(e.toLowerCase()))||(null==(a=t.device_category)?void 0:a.toLowerCase().includes(e.toLowerCase()))}).sort((e,t)=>t.usage_count-e.usage_count).slice(0,8)}catch(r){return[]}}async loadFromDatabase(){try{const{data:e,error:r}=await t.from("user_device_preferences").select("id").limit(1);if(r&&"42P01"===r.code)return await this.loadFromLocalStorage();const a=(await rt.getUserDevicePreferences()).map(e=>({device_name:e.device_name,device_category:e.device_category,device_brand:e.device_brand,usage_count:e.usage_count,last_used:e.last_used}));return this.updateCache(a),a}catch(e){return await this.loadFromLocalStorage()}}async saveToDatabase(e){try{const{error:r}=await t.from("user_device_preferences").select("id").limit(1);if(r&&"42P01"===r.code)return await this.saveToLocalStorage(e);return!!(await rt.saveDevicePreference(e))&&(this.updateCacheItem(e),!0)}catch(r){return await this.saveToLocalStorage(e)}}async incrementUsageInDatabase(e){try{const{error:r}=await t.from("user_device_preferences").select("id").limit(1);if(r&&"42P01"===r.code)return void(await this.incrementUsageInLocalStorage(e));await rt.incrementDeviceUsage(e),this.incrementCacheUsage(e)}catch(r){await this.incrementUsageInLocalStorage(e)}}async removeFromDatabase(e){try{const{error:r}=await t.from("user_device_preferences").select("id").limit(1);if(r&&"42P01"===r.code)return await this.removeFromLocalStorage(e);return!!(await rt.removeDevicePreference(e))&&(this.removeFromCache(e),!0)}catch(r){return await this.removeFromLocalStorage(e)}}async loadFromLocalStorage(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);return this.updateCache(t),t}return[]}catch(e){return[]}}async saveToLocalStorage(e){try{const t=await this.loadFromLocalStorage(),r=t.findIndex(t=>t.device_name===e.device_name);return r>=0?t[r]=e:t.push(e),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.updateCache(t),_.success(`"${e.device_name}" added to your device suggestions!`,{duration:3e3,icon:""}),!0}catch(t){return _.error("Failed to save device to suggestions"),!1}}async incrementUsageInLocalStorage(e){try{const t=await this.loadFromLocalStorage(),r=t.find(t=>t.device_name===e);r&&(r.usage_count+=1,r.last_used=(new Date).toISOString(),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.updateCache(t))}catch(t){}}async removeFromLocalStorage(e){try{const t=(await this.loadFromLocalStorage()).filter(t=>t.device_name!==e);return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.updateCache(t),_.success(`"${e}" removed from suggestions`),!0}catch(t){return!1}}loadCache(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);this.updateCache(t)}}catch(e){}}updateCache(e){this.cache.clear(),e.forEach(e=>{this.cache.set(e.device_name,e)}),this.cacheLoaded=!0}updateCacheItem(e){this.cache.set(e.device_name,e)}incrementCacheUsage(e){const t=this.cache.get(e);t&&(t.usage_count+=1,t.last_used=(new Date).toISOString(),this.cache.set(e,t))}removeFromCache(e){this.cache.delete(e)}getCachedDevices(){return Array.from(this.cache.values())}isCacheLoaded(){return this.cacheLoaded}getStorageMode(){return this.isProduction?"database":"localStorage"}},st=({sparePart:t,onSave:i,onCancel:l})=>{var o,c,u,m;const{currentUser:g}=r(),{categories:b,suppliers:p,loadSparePartCategories:y,loadSuppliers:k}=a(),[z,Q]=d.useState([]),[B,V]=d.useState([]),[H,G]=d.useState(!1),[W,K]=d.useState(!1),[X,Y]=d.useState({name:"",categoryId:"",partNumber:"",brand:"",supplierId:"",condition:"new",description:"",costPrice:0,sellingPrice:0,quantity:0,minQuantity:0,storeLocationId:"",shelfId:"",location:"",compatibleDevices:"",images:[]}),[Z,J]=d.useState({}),[ee,te]=d.useState(!1),[re,ge]=d.useState(!1),[xe,he]=d.useState([]),[be,pe]=d.useState({}),[fe,ye]=d.useState(!1),[ve,je]=d.useState(""),[Ne,we]=d.useState(""),[ke,Se]=d.useState(""),[_e,Ae]=d.useState([]),[Ce,Pe]=d.useState(!1),[Ie,Ue]=d.useState(!1),[Le,Fe]=d.useState(!1),[Ee,qe]=d.useState(null),[De,Re]=d.useState(!1),[Me,Te]=d.useState(null),[$e,Oe]=d.useState(null),[ze,Qe]=d.useState(""),[Be,Ve]=d.useState("laptop"),[He,Ge]=d.useState("temp-sparepart-"+Date.now()),[We,Ke]=d.useState(!1),[Xe,Ye]=d.useState(""),[et,rt]=d.useState([]),[st,nt]=d.useState(!1),[it,lt]=d.useState(""),[ot,ct]=d.useState([]),[dt,ut]=d.useState([]),[mt,gt]=d.useState(!1),xt=[{name:"iPhone 15 Pro Max",category:"smartphone",brand:"Apple"},{name:"iPhone 15 Pro",category:"smartphone",brand:"Apple"},{name:"iPhone 15 Plus",category:"smartphone",brand:"Apple"},{name:"iPhone 15",category:"smartphone",brand:"Apple"},{name:"iPhone 14 Pro Max",category:"smartphone",brand:"Apple"},{name:"iPhone 14 Pro",category:"smartphone",brand:"Apple"},{name:"iPhone 14 Plus",category:"smartphone",brand:"Apple"},{name:"iPhone 14",category:"smartphone",brand:"Apple"},{name:"iPhone 13 Pro Max",category:"smartphone",brand:"Apple"},{name:"iPhone 13 Pro",category:"smartphone",brand:"Apple"},{name:"iPhone 13",category:"smartphone",brand:"Apple"},{name:"iPhone 12 Pro Max",category:"smartphone",brand:"Apple"},{name:"iPhone 12 Pro",category:"smartphone",brand:"Apple"},{name:"iPhone 12",category:"smartphone",brand:"Apple"},{name:"iPhone SE (3rd gen)",category:"smartphone",brand:"Apple"},{name:'iPad Pro 12.9" (6th gen)',category:"tablet",brand:"Apple"},{name:'iPad Pro 11" (4th gen)',category:"tablet",brand:"Apple"},{name:"iPad Air (5th gen)",category:"tablet",brand:"Apple"},{name:"iPad (10th gen)",category:"tablet",brand:"Apple"},{name:"iPad mini (6th gen)",category:"tablet",brand:"Apple"},{name:'MacBook Pro 16" M3 Max',category:"laptop",brand:"Apple"},{name:'MacBook Pro 14" M3 Pro',category:"laptop",brand:"Apple"},{name:'MacBook Air 15" M2',category:"laptop",brand:"Apple"},{name:'MacBook Air 13" M2',category:"laptop",brand:"Apple"},{name:'iMac 24" M1',category:"desktop",brand:"Apple"},{name:"Mac Studio M2 Ultra",category:"desktop",brand:"Apple"},{name:"Apple Watch Series 9",category:"watch",brand:"Apple"},{name:"Apple Watch Ultra 2",category:"watch",brand:"Apple"},{name:"Galaxy S24 Ultra",category:"smartphone",brand:"Samsung"},{name:"Galaxy S24+",category:"smartphone",brand:"Samsung"},{name:"Galaxy S24",category:"smartphone",brand:"Samsung"},{name:"Galaxy S23 Ultra",category:"smartphone",brand:"Samsung"},{name:"Galaxy S23+",category:"smartphone",brand:"Samsung"},{name:"Galaxy S23",category:"smartphone",brand:"Samsung"},{name:"Galaxy Z Fold 5",category:"smartphone",brand:"Samsung"},{name:"Galaxy Z Flip 5",category:"smartphone",brand:"Samsung"},{name:"Galaxy Tab S9 Ultra",category:"tablet",brand:"Samsung"},{name:"Galaxy Tab S9+",category:"tablet",brand:"Samsung"},{name:"Galaxy Tab S9",category:"tablet",brand:"Samsung"},{name:"Galaxy Book4 Ultra",category:"laptop",brand:"Samsung"},{name:"Galaxy Book4 Pro 360",category:"laptop",brand:"Samsung"},{name:"Pixel 8 Pro",category:"smartphone",brand:"Google"},{name:"Pixel 8",category:"smartphone",brand:"Google"},{name:"Pixel 7a",category:"smartphone",brand:"Google"},{name:"Pixel Tablet",category:"tablet",brand:"Google"},{name:"Pixelbook Go",category:"laptop",brand:"Google"},{name:"OnePlus 12",category:"smartphone",brand:"OnePlus"},{name:"OnePlus 11",category:"smartphone",brand:"OnePlus"},{name:"OnePlus Open",category:"smartphone",brand:"OnePlus"},{name:"OnePlus Pad",category:"tablet",brand:"OnePlus"},{name:"Xiaomi 14 Pro",category:"smartphone",brand:"Xiaomi"},{name:"Xiaomi 14",category:"smartphone",brand:"Xiaomi"},{name:"Redmi Note 13 Pro",category:"smartphone",brand:"Xiaomi"},{name:"Xiaomi Pad 6",category:"tablet",brand:"Xiaomi"},{name:"Steam Deck OLED",category:"gaming",brand:"Valve"},{name:"Nintendo Switch OLED",category:"gaming",brand:"Nintendo"},{name:"PlayStation 5",category:"gaming",brand:"Sony"},{name:"Xbox Series X",category:"gaming",brand:"Microsoft"},{name:"AirPods Pro (2nd gen)",category:"audio",brand:"Apple"},{name:"AirPods Max",category:"audio",brand:"Apple"},{name:"Sony WH-1000XM5",category:"audio",brand:"Sony"},{name:"Bose QuietComfort 45",category:"audio",brand:"Bose"},{name:"Magic Keyboard",category:"accessory",brand:"Apple"},{name:"Apple Pencil (2nd gen)",category:"accessory",brand:"Apple"},{name:"Samsung S Pen",category:"accessory",brand:"Samsung"},{name:"USB-C Hub",category:"accessory",brand:"Generic"},{name:"Lightning Cable",category:"accessory",brand:"Apple"},{name:"USB-C Cable",category:"accessory",brand:"Generic"},{name:"Wireless Charger",category:"accessory",brand:"Generic"}],ht=t=>{const r=t.toLowerCase();return r.includes("iphone")||r.includes("galaxy s")||r.includes("pixel")?e.jsx(E,{className:"w-4 h-4"}):r.includes("ipad")||r.includes("galaxy tab")||r.includes("tablet")?e.jsx(q,{className:"w-4 h-4"}):r.includes("macbook")||r.includes("galaxy book")||r.includes("laptop")?e.jsx(D,{className:"w-4 h-4"}):r.includes("imac")||r.includes("mac studio")||r.includes("desktop")?e.jsx(R,{className:"w-4 h-4"}):r.includes("watch")?e.jsx(M,{className:"w-4 h-4"}):r.includes("airpods")||r.includes("headphones")||r.includes("audio")?e.jsx(T,{className:"w-4 h-4"}):r.includes("camera")?e.jsx($,{className:"w-4 h-4"}):r.includes("steam deck")||r.includes("switch")||r.includes("playstation")||r.includes("xbox")?e.jsx(O,{className:"w-4 h-4"}):e.jsx(E,{className:"w-4 h-4"})},bt=async e=>{if(e.length<2)return[];const t=e.toLowerCase();return[...xt.filter(e=>e.name.toLowerCase().includes(t)||e.brand.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)).map(e=>({name:e.name,type:"built-in"})),...(await at.searchDevices(e)).map(e=>({name:e.device_name,type:"saved"}))].filter((e,t,r)=>t===r.findIndex(t=>t.name===e.name)).slice(0,8).map(e=>e.name)},pt=async e=>{if(e.trim()&&!ot.includes(e.trim())){const t=e.trim(),r=[...ot,t];ct(r),Y(e=>({...e,compatibleDevices:r.join(", ")})),lt(""),nt(!1);if(!xt.some(e=>e.name===t)){const e=ft(t),r=yt(t);await at.saveDevice(t,e,r),await vt()}else await at.incrementUsage(t)}},ft=e=>{const t=e.toLowerCase();return t.includes("iphone")||t.includes("galaxy s")||t.includes("pixel")?"smartphone":t.includes("ipad")||t.includes("galaxy tab")||t.includes("tablet")?"tablet":t.includes("macbook")||t.includes("galaxy book")||t.includes("laptop")?"laptop":t.includes("imac")||t.includes("mac studio")||t.includes("desktop")?"desktop":t.includes("watch")?"watch":t.includes("airpods")||t.includes("headphones")||t.includes("audio")?"audio":t.includes("camera")?"camera":t.includes("steam deck")||t.includes("switch")||t.includes("playstation")||t.includes("xbox")?"gaming":"accessory"},yt=e=>{const t=e.toLowerCase();return t.includes("iphone")||t.includes("ipad")||t.includes("macbook")||t.includes("imac")||t.includes("watch")||t.includes("airpods")?"Apple":t.includes("galaxy")||t.includes("samsung")?"Samsung":t.includes("pixel")?"Google":t.includes("oneplus")?"OnePlus":t.includes("xiaomi")||t.includes("redmi")?"Xiaomi":t.includes("steam deck")?"Valve":t.includes("switch")?"Nintendo":t.includes("playstation")?"Sony":t.includes("xbox")?"Microsoft":"Generic"},vt=async()=>{try{gt(!0);const e=await at.loadDevices();ut(e)}catch(e){ut([])}finally{gt(!1)}};d.useEffect(()=>{vt()},[]),d.useEffect(()=>{if(X.compatibleDevices){const e=X.compatibleDevices.split(",").map(e=>e.trim()).filter(Boolean);ct(e)}},[X.compatibleDevices]),d.useEffect(()=>{y(),k()},[y,k]),d.useEffect(()=>{Pt()},[Ie]),d.useEffect(()=>{(async()=>{try{G(!0);const e=await ce.getAll();Q(e)}catch(e){_.error("Failed to load store locations. Please check your connection and try again."),Q([])}finally{G(!1)}})()},[]),d.useEffect(()=>{(async()=>{if(X.storeLocationId)try{K(!0),V([])}catch(e){_.error("Failed to load shelves"),V([])}finally{K(!1)}else V([])})()},[X.storeLocationId]),d.useEffect(()=>{kt()},[]),d.useEffect(()=>{xe.length>0&&St()},[xe]),d.useEffect(()=>{var e;fe&&je(X.storageRoomId||(null==(e=xe[0])?void 0:e.id)||"")},[fe,X.storageRoomId,xe]),d.useEffect(()=>{var e;if(t){const r={name:t.name,categoryId:t.category_id,partNumber:t.part_number,brand:t.brand||"",supplierId:t.supplier_id||null,condition:t.condition||"new",description:t.description||"",costPrice:t.cost_price,sellingPrice:t.selling_price,quantity:t.quantity,minQuantity:t.min_quantity,storageRoomId:t.storage_room_id||"",shelfId:t.shelf_id||"",storeLocationId:t.storage_room_id||"",location:t.location||"",compatibleDevices:t.compatible_devices||"",images:[]};Y(r);const a=t.variants&&t.variants.length>0,s=(null==(e=t.metadata)?void 0:e.useVariants)||a;if(s&&a)Ue(!0),Ae(t.variants),Pe(!0);else if(s&&!a){Ue(!0);const e=Ct("Default",0);Ae([e]),Pe(!0)}t.location&&Nt(t.location),jt()}},[t]);const jt=async()=>{if(null==t?void 0:t.id)try{const{getSparePartImages:e}=await ae(()=>import("./index-222cfb29.js").then(e=>e.aS),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),r=await e(t.id);if(r&&r.length>0){const e=r.map((e,t)=>({id:e.id,url:e.image_url,thumbnailUrl:e.thumbnail_url||e.image_url,fileName:e.file_name||`image-${t+1}`,fileSize:e.file_size||0,isPrimary:e.is_primary||!1,uploadedAt:e.created_at||(new Date).toISOString(),mimeType:e.mime_type||"image/jpeg",image_url:e.image_url,file_name:e.file_name,file_size:e.file_size,mime_type:e.mime_type,is_primary:e.is_primary}));Y(t=>({...t,images:e}))}else{const e=t.images||[];if(e.length>0){const t=e.map((e,t)=>({id:`fallback-${t}`,url:e,thumbnailUrl:e,fileName:`image-${t+1}.jpg`,fileSize:0,isPrimary:0===t,uploadedAt:(new Date).toISOString(),mimeType:"image/jpeg",image_url:e,file_name:`image-${t+1}.jpg`,file_size:0,mime_type:"image/jpeg",is_primary:0===t}));Y(e=>({...e,images:t}))}else Y(e=>({...e,images:[]}))}}catch(e){_.error("Failed to load images for editing"),Y(e=>({...e,images:[]}))}},Nt=async e=>{},wt=(e,t)=>{Y(r=>({...r,[e]:t})),Z[e]&&J(t=>({...t,[e]:""}))},kt=async()=>{try{const e=await de.getAll();he(e||[])}catch(e){_.error("Failed to load storage rooms. Please check your connection and try again."),he([])}},St=async()=>{try{const e={};for(const t of xe){const r=await ue.getShelvesByStorageRoom(t.id);e[t.id]=r||[]}pe(e)}catch(e){_.error("Failed to load shelves. Please check your connection and try again."),pe({})}},_t=()=>(be[ve]||[]).sort((e,t)=>{const r=e.name.toLowerCase().localeCompare(t.name.toLowerCase());return 0!==r?r:e.id.localeCompare(t.id)}),At=()=>{let e=_t();return Ne&&(e=e.filter(e=>e.code.toLowerCase().includes(Ne.toLowerCase())||e.name&&e.name.toLowerCase().includes(Ne.toLowerCase()))),ke&&(e=e.filter(e=>e.code.toUpperCase().includes(ke))),e},Ct=(e,t=0)=>{const r=e||(0===t?"Default":`Variant ${t+1}`),a=0===t?"DEFAULT":`V${String(t+1).padStart(2,"0")}`;return{name:r,sku:`${X.partNumber}-${a}`,cost_price:X.costPrice||0,selling_price:X.sellingPrice||0,quantity:X.quantity||0,min_quantity:X.minQuantity||0,attributes:{},image_url:X.images&&X.images.length>0?X.images[0].image_url||X.images[0].url:void 0}};d.useEffect(()=>{var e;if(Ie&&_e.length>0){const t=Ct((null==(e=_e[0])?void 0:e.name)||"Default",0);Ae(e=>e.map((e,r)=>{if(0===r){return{...e,...t,name:e.name||t.name,attributes:e.attributes||{}}}return e}))}},[X.costPrice,X.sellingPrice,X.quantity,X.minQuantity,X.partNumber,Ie]);const Pt=()=>{if(Ie&&0===_e.length){const e=Ct("Default",0);Ae([e]),Pe(!0)}},It=(e,t,r)=>{const a={..._e[e].attributes,[t]:r};Lt(e,"attributes",a)},Ut=e=>{if(ze.trim()){((e,t,r="")=>{const a={..._e[e].attributes,[t]:r};Lt(e,"attributes",a)})(e,ze.trim().toLowerCase().replace(/\s+/g,"_")),Oe(null),Qe("")}},Lt=(e,t,r)=>{Ae(a=>a.map((a,s)=>s===e?{...a,[t]:r}:a))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"w-full max-w-3xl max-h-[85vh] overflow-y-auto",children:e.jsxs(s,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t?"Edit Part":"Add Part"})]}),e.jsx("button",{onClick:l,className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:e.jsx(x,{className:"w-4 h-4"})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return X.name.trim()?X.name.trim().length<2&&(e.name="Name must be at least 2 characters long"):e.name="Spare part name is required",X.categoryId||(e.categoryId="Category is required"),X.partNumber.trim()?X.partNumber.trim().length<2&&(e.partNumber="Part number must be at least 2 characters long"):e.partNumber="Part number is required",Ie||(X.costPrice<0?e.costPrice="Cost price cannot be negative":0===X.costPrice&&(e.costPrice="Cost price must be greater than 0"),X.sellingPrice<0?e.sellingPrice="Selling price cannot be negative":0===X.sellingPrice&&(e.sellingPrice="Selling price must be greater than 0"),X.quantity<0&&(e.quantity="Stock quantity cannot be negative"),X.minQuantity<0&&(e.minQuantity="Minimum stock level cannot be negative"),X.minQuantity>X.quantity&&(e.minQuantity="Minimum stock level cannot be greater than current quantity")),Ie&&(0===_e.length?e.variants="At least one variant is required when using variants":_e.forEach((t,r)=>{t.name&&""!==t.name.trim()||(e[`variant_${r}_name`]="Variant name is required"),t.cost_price<0&&(e[`variant_${r}_costPrice`]="Variant cost price must be 0 or greater"),t.selling_price<0&&(e[`variant_${r}_sellingPrice`]="Variant selling price must be 0 or greater"),t.quantity<0&&(e[`variant_${r}_quantity`]="Variant stock quantity must be 0 or greater"),t.min_quantity<0&&(e[`variant_${r}_minQuantity`]="Variant min stock level must be 0 or greater")})),J(e),0===Object.keys(e).length})()){te(!0);try{const e={...X,id:null==t?void 0:t.id,createdBy:null==g?void 0:g.id,updatedBy:null==g?void 0:g.id,useVariants:Ie,variants:Ie?_e:[]};await i(e)}catch(r){_.error(r.message||"Failed to save spare part")}finally{te(!1)}}else _.error("Please fix the errors before submitting")},className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(f,{size:16,className:"text-blue-600"}),"Basic Info"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"spare-part-name",className:"block mb-1 font-medium text-sm "+(Z.name?"text-red-600":"text-gray-700"),children:"Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"spare-part-name",type:"text",className:"w-full py-2 pl-10 pr-3 bg-white/30 backdrop-blur-md border-2 rounded focus:outline-none transition-colors text-sm "+(Z.name?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"),placeholder:"e.g., iPhone 14 Screen",value:X.name,onChange:e=>wt("name",e.target.value),required:!0}),e.jsx(f,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:14})]}),Z.name&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:Z.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"part-number",className:"block mb-1 font-medium text-sm "+(Z.partNumber?"text-red-600":"text-gray-700"),children:"Part Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"part-number",type:"text",className:"w-full py-2 pl-10 pr-3 bg-white/30 backdrop-blur-md border-2 rounded focus:outline-none transition-colors text-sm "+(Z.partNumber?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"),placeholder:"e.g., IP14-SCR-001",value:X.partNumber,onChange:e=>wt("partNumber",e.target.value),required:!0}),e.jsx(A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:14})]}),Z.partNumber&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:Z.partNumber})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block mb-1 font-medium text-sm "+(Z.categoryId?"text-red-600":"text-gray-700"),children:"Category *"}),e.jsx(se,{value:X.categoryId,onChange:e=>wt("categoryId",e),placeholder:"Select category",categories:b,required:!0,error:Z.categoryId,className:"w-full"}),Z.categoryId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:Z.categoryId})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"supplier",className:"block mb-2 font-medium text-gray-700",children:"Supplier"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:"supplier",className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-colors",value:X.supplierId,onChange:e=>wt("supplierId",e.target.value),children:[e.jsx("option",{value:"",children:"Select Supplier"}),p.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("svg",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",width:"18",height:"18",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"condition",className:"block mb-2 font-medium text-gray-700",children:"Condition"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"new",label:"New",color:"bg-green-500 hover:bg-green-600 border-green-500"},{value:"used",label:"Used",color:"bg-blue-500 hover:bg-blue-600 border-blue-500"},{value:"refurbished",label:"Refurbished",color:"bg-purple-500 hover:bg-purple-600 border-purple-500"}].map(t=>e.jsx("button",{type:"button",onClick:()=>wt("condition",t.value),className:"py-3 px-4 rounded-lg border-2 transition-all duration-200 font-medium "+(X.condition===t.value?`${t.color} text-white`:"bg-gray-100 hover:bg-gray-200 border-gray-300 text-gray-700"),children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"brand",className:"block mb-2 font-medium text-gray-700",children:"Brand"}),e.jsx(tt,{value:X.brand,onChange:e=>wt("brand",e),placeholder:"e.g., Apple, Samsung",className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block mb-2 text-sm font-medium text-gray-700",children:"Description (optional)"}),e.jsxs("div",{className:"relative",children:[re?e.jsx("textarea",{id:"description",value:X.description,onChange:e=>wt("description",e.target.value),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-all duration-200 resize-none",placeholder:"Describe the spare part, its specifications, and any important details...",maxLength:500,rows:4,onBlur:()=>ge(!1),autoFocus:!0}):e.jsx("input",{id:"description",type:"text",value:X.description,onChange:e=>wt("description",e.target.value),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-all duration-200",placeholder:"Brief description...",maxLength:200,onFocus:()=>ge(!0)}),e.jsx(C,{className:"absolute left-3 text-gray-500 transition-all duration-200 "+(re?"top-4":"top-1/2 -translate-y-1/2"),size:16})]}),re&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[X.description.length,"/500 characters"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"compatible-devices",className:"block mb-2 font-medium text-gray-700",children:["Compatible Devices",e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",ot.length," selected)"]})]}),ot.length>0&&e.jsx("div",{className:"mb-3 flex flex-wrap gap-2",children:ot.map((t,r)=>e.jsxs("div",{className:"inline-flex items-center gap-1 px-3 py-1.5 bg-blue-100 text-blue-800 rounded-full text-sm font-medium border border-blue-200",children:[ht(t),e.jsx("span",{className:"max-w-[200px] truncate",children:t}),e.jsx("button",{type:"button",onClick:()=>(e=>{const t=ot.filter(t=>t!==e);ct(t),Y(e=>({...e,compatibleDevices:t.join(", ")}))})(t),className:"ml-1 p-0.5 hover:bg-blue-200 rounded-full transition-colors",children:e.jsx(P,{className:"w-3 h-3"})})]},r))}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"compatible-devices",className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Type device name (e.g., iPhone 15, Galaxy S24, MacBook Pro)...",value:it,onChange:async e=>{const t=e.target.value;if(lt(t),t.length>=2){const e=await bt(t);rt(e),nt(e.length>0)}else nt(!1),rt([])},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),it.trim()&&pt(it.trim())),"Escape"===e.key&&nt(!1)},onFocus:async()=>{if(it.length>=2){const e=await bt(it);rt(e),nt(e.length>0)}},onBlur:()=>{setTimeout(()=>nt(!1),200)}}),e.jsx(S,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 w-4 h-4"}),st&&et.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",children:et.map((t,r)=>{const a=xt.some(e=>e.name===t),s=dt.find(e=>e.device_name===t),n=!!s,i=xt.find(e=>e.name===t);return e.jsxs("button",{type:"button",className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3 border-b border-gray-100 last:border-b-0 transition-colors",onClick:()=>pt(t),children:[e.jsx("div",{className:"text-gray-500",children:ht(t)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[t,n&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full",children:["Saved (",(null==s?void 0:s.usage_count)||0,"x)"]}),a&&!n&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full",children:"Built-in"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:i?`${i.brand}  ${i.category}`:s?`${s.device_brand||"Generic"}  ${s.device_category||"Device"}`:"Custom device"})]}),n&&e.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),(async e=>{try{await at.removeDevice(e)&&await vt()}catch(t){}})(t)},className:"p-1 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-colors",title:"Remove from saved devices",children:e.jsx(P,{className:"w-4 h-4"})})]},r)})})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsx("span",{children:" Start typing to see device suggestions"}),e.jsx("span",{children:" Press Enter to add custom device"}),e.jsx("span",{children:" Click suggestions to add quickly"}),e.jsx("span",{children:" Custom devices are saved automatically"})]})}),dt.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-xs font-medium text-green-700 flex items-center gap-1",children:[e.jsx("span",{children:""}),"Your saved devices (",dt.length,")",e.jsxs("span",{className:"text-xs text-green-600 ml-2",children:["(",at.getStorageMode(),")"]})]}),e.jsx("button",{type:"button",onClick:async()=>{const e=dt.slice(-3);for(const t of e)await pt(t.device_name)},className:"text-xs text-green-600 hover:text-green-800 font-medium",children:"Add recent"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[dt.sort((e,t)=>new Date(t.last_used).getTime()-new Date(e.last_used).getTime()).slice(0,5).map(t=>e.jsxs("button",{type:"button",onClick:()=>pt(t.device_name),disabled:ot.includes(t.device_name),className:"px-2 py-1 text-xs bg-green-100 hover:bg-green-200 disabled:bg-gray-50 disabled:text-gray-400 text-green-700 rounded-full border border-green-200 transition-colors",children:["+ ",t.device_name,t.usage_count>1&&e.jsxs("span",{className:"ml-1 text-green-600",children:["(",t.usage_count,"x)"]})]},t.device_name)),dt.length>5&&e.jsxs("span",{className:"text-xs text-green-600 px-2 py-1",children:["+",dt.length-5," more..."]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"Popular devices:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:["iPhone 15 Pro","iPhone 14","Galaxy S24","MacBook Pro","iPad Air"].map(t=>e.jsxs("button",{type:"button",onClick:()=>pt(t),disabled:ot.includes(t),className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-full border border-gray-200 transition-colors",children:["+ ",t]},t))})]})]})]}),!Ie&&e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(N,{size:18,className:"text-green-600"}),"Pricing & Stock"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:"Cost Price *"}),e.jsx(ne,{value:X.costPrice,onChange:e=>wt("costPrice",e),placeholder:"0.00",className:"w-full "+(Z.costPrice?"border-red-500":""),required:!0,error:Z.costPrice})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:"Selling Price *"}),e.jsx(ne,{value:X.sellingPrice,onChange:e=>wt("sellingPrice",e),placeholder:"0.00",className:"w-full "+(Z.sellingPrice?"border-red-500":""),required:!0,error:Z.sellingPrice})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stock-quantity",className:"block mb-2 text-sm font-medium "+(Z.quantity?"text-red-600":"text-gray-700"),children:"Stock Quantity *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:0===X.quantity?"":X.quantity||"",onChange:e=>wt("quantity",Math.max(0,parseInt(e.target.value)||0)),onFocus:e=>{0===X.quantity&&(e.target.value="")},className:"w-full py-3 px-20 bg-white/30 backdrop-blur-md border-2 rounded-lg text-center text-lg font-semibold text-gray-900 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"0",min:"0",step:"1"}),e.jsx("button",{type:"button",onClick:()=>wt("quantity",Math.max(0,(X.quantity||0)-1)),className:"absolute left-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Decrease stock quantity",children:""}),e.jsx("div",{className:"absolute right-1 top-1/2 -translate-y-1/2",children:e.jsx("button",{type:"button",onClick:()=>wt("quantity",(X.quantity||0)+1),className:"w-10 h-10 sm:w-12 sm:h-12 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Increase stock quantity",children:"+"})})]}),Z.quantity&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:Z.quantity})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"min-stock-level",className:"block mb-2 text-sm font-medium "+(Z.minQuantity?"text-red-600":"text-gray-700"),children:"Min Stock Level *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:0===X.minQuantity?"":X.minQuantity||"",onChange:e=>wt("minQuantity",Math.max(0,parseInt(e.target.value)||0)),onFocus:e=>{0===X.minQuantity&&(e.target.value="")},className:"w-full py-3 px-20 bg-white/30 backdrop-blur-md border-2 rounded-lg text-center text-lg font-semibold text-gray-900 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"2",min:"0",step:"1"}),e.jsx("button",{type:"button",onClick:()=>wt("minQuantity",Math.max(0,(X.minQuantity||0)-1)),className:"absolute left-1 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Decrease minimum stock level",children:""}),e.jsx("div",{className:"absolute right-1 top-1/2 -translate-y-1/2",children:e.jsx("button",{type:"button",onClick:()=>wt("minQuantity",(X.minQuantity||0)+1),className:"w-10 h-10 sm:w-12 sm:h-12 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center text-xl font-bold transition-colors","aria-label":"Increase minimum stock level",children:"+"})})]}),Z.minQuantity&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:Z.minQuantity})]})]}),X.sellingPrice>0&&X.costPrice>0&&e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Profit Margin:"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["TZS ",me.number(X.sellingPrice-X.costPrice),"(",((X.sellingPrice-X.costPrice)/X.sellingPrice*100).toFixed(1),"%)"]})]})})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(I,{size:18,className:"text-blue-600"}),"Storage Location"]}),0===xe.length&&!H&&e.jsx("div",{className:"mb-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3 text-amber-800",children:[e.jsx(f,{size:24,className:"text-amber-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"No Storage Data Available"}),e.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:["You need to create storage rooms and shelves before adding spare parts. Go to ",e.jsx("strong",{children:"Settings  Storage Management"})," to set up your storage infrastructure."]})]}),e.jsx("button",{type:"button",onClick:()=>{kt(),St()},className:"px-3 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors text-sm font-medium",children:"Retry"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Storage Location (optional)"}),e.jsxs("button",{type:"button",onClick:()=>ye(!0),disabled:H||0===xe.length,className:`w-full py-4 pl-12 pr-4 bg-gradient-to-r from-white/50 to-white/30 backdrop-blur-md border-2 rounded-xl focus:outline-none transition-all duration-300 text-left shadow-sm hover:shadow-md ${Z.storeLocationId||Z.shelfId?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500 hover:border-blue-400"} ${H||0===xe.length?"opacity-50 cursor-not-allowed":"hover:scale-[1.02]"}`,children:[e.jsx(I,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20}),e.jsx("span",{className:"text-base "+(X.storageRoomId&&X.shelfId?"text-gray-900 font-semibold":"text-gray-500"),children:(()=>{var e;if(!X.storageRoomId||!X.shelfId)return"Select storage location";const t=xe.find(e=>e.id===X.storageRoomId),r=null==(e=be[X.storageRoomId])?void 0:e.find(e=>e.id===X.shelfId);return t&&r?`${t.code} - ${r.code}`:"Select storage location"})()}),X.storageRoomId&&X.shelfId&&e.jsx(j,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-green-500",size:20})]}),(Z.storeLocationId||Z.shelfId)&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-red-500 rounded-full"}),Z.storeLocationId||Z.shelfId]})]})]}),e.jsx(Je,{variants:_e,setVariants:Ae,useVariants:Ie,setUseVariants:e=>{if(Ue(e),e)if(0===_e.length){const e=Ct("Default",0);Ae([e]),Pe(!0),_.success("Default variant created from main product data")}else Pe(!0);else Ae([]),Pe(!1),_("Variants disabled - using main product data")},showVariants:Ce,setShowVariants:Pe,isReorderingVariants:Le,setIsReorderingVariants:Fe,draggedVariantIndex:Ee,setDraggedVariantIndex:qe,onVariantSpecificationsClick:e=>{Te(e),Re(!0)},basePartNumber:X.partNumber,mainProductImages:X.images}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"w-6 h-6 bg-pink-100 rounded-lg flex items-center justify-center",children:e.jsx(v,{className:"w-3 h-3 text-pink-600","aria-hidden":"true"})}),e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Spare Part Images"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(Ze,{productId:He,userId:(null==g?void 0:g.id)||"",existingImages:X.images,onImagesChange:e=>{const t=e.map(e=>({id:e.id,image_url:e.url,thumbnail_url:e.thumbnailUrl||e.url,file_name:e.fileName,file_size:e.fileSize,is_primary:e.isPrimary,uploaded_by:e.uploadedAt,created_at:e.uploadedAt}));Y(e=>({...e,images:t})),e.length>0&&_.success(`${e.length} image${e.length>1?"s":""} uploaded successfully!`)},maxFiles:5})})]}),We&&Xe&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(QrCode,{className:"w-5 h-5 text-blue-600"}),"QR Code Preview"]}),e.jsx(n,{type:"button",onClick:()=>Ke(!1),variant:"outline",size:"sm",children:e.jsx(x,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:Xe,alt:"QR Code",className:"border border-gray-300 rounded-lg shadow-sm"}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Part Number: ",X.partNumber]}),e.jsxs(n,{type:"button",onClick:()=>{const e=JSON.stringify({type:"spare-part",id:(null==t?void 0:t.id)||He,name:X.name,partNumber:X.partNumber});Ye(`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(e)}`),Ke(!0)},className:"mt-3 flex items-center gap-2",children:[e.jsx(Download,{className:"w-4 h-4"}),"Download QR Code"]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:l,disabled:ee,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-3 rounded-lg font-semibold transition-all duration-200 "+(ee?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 shadow-lg"),disabled:ee,children:ee?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),t?"Update":"Create"]})})]})]})]})})}),fe&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[95vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(I,{size:28,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Select Storage Location"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Choose a storage room and shelf for your spare part"})]})]}),e.jsx("button",{onClick:()=>ye(!1),className:"p-3 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(x,{size:24,className:"text-gray-500"})})]}),e.jsx("div",{className:"border-b border-gray-100 bg-white",children:e.jsx("div",{className:"flex overflow-x-auto px-6 py-4 gap-2",children:xe.map(t=>{const r=(e=>{const t={A:{bg:"bg-green-500",hover:"hover:bg-green-600",border:"border-green-500",text:"text-green-600",bgLight:"bg-green-50"},B:{bg:"bg-blue-500",hover:"hover:bg-blue-600",border:"border-blue-500",text:"text-blue-600",bgLight:"bg-blue-50"},C:{bg:"bg-purple-500",hover:"hover:bg-purple-600",border:"border-purple-500",text:"text-purple-600",bgLight:"bg-purple-50"},D:{bg:"bg-orange-500",hover:"hover:bg-orange-600",border:"border-orange-500",text:"text-orange-600",bgLight:"bg-orange-50"},E:{bg:"bg-red-500",hover:"hover:bg-red-600",border:"border-red-500",text:"text-red-600",bgLight:"bg-red-50"},F:{bg:"bg-indigo-500",hover:"hover:bg-indigo-600",border:"border-indigo-500",text:"text-indigo-600",bgLight:"bg-indigo-50"},G:{bg:"bg-pink-500",hover:"hover:bg-pink-600",border:"border-pink-500",text:"text-pink-600",bgLight:"bg-pink-50"},H:{bg:"bg-yellow-500",hover:"hover:bg-yellow-600",border:"border-yellow-500",text:"text-yellow-600",bgLight:"bg-yellow-50"}};return t[e.charAt(0).toUpperCase()]||t.A})(t.code);return e.jsx("button",{onClick:()=>je(t.id),className:"flex-shrink-0 px-6 py-3 rounded-xl font-medium transition-all duration-300 "+(ve===t.id?`${r.text} ${r.bgLight} border-2 ${r.border} shadow-md`:"text-gray-600 hover:text-gray-900 hover:bg-gray-50 border-2 border-transparent"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${ve===t.id?r.bg:"bg-gray-100"}`,children:e.jsx(L,{size:16,className:ve===t.id?"text-white":"text-gray-500"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:"text-xs opacity-75",children:t.code})]})]})},t.id)})})}),e.jsx("div",{className:"p-6 border-b border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search shelves...",value:Ne,onChange:e=>we(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto",children:[e.jsx("button",{onClick:()=>Se(""),className:"px-4 py-2 rounded-lg font-medium transition-colors "+(""===ke?"bg-blue-500 text-white":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"),children:"All"}),(()=>{const e=_t(),t=new Set;return e.forEach(e=>{const r=e.code.toUpperCase();for(let a=0;a<r.length;a++){const e=r[a];if(e>="A"&&e<="Z"){t.add(e);break}}}),Array.from(t).sort()})().map(t=>e.jsx("button",{onClick:()=>Se(ke===t?"":t),className:"px-4 py-2 rounded-lg font-medium transition-colors "+(ke===t?"bg-blue-500 text-white":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"),children:t},t))]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:At().length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:At().map((t,r)=>{var a;const s=X.storageRoomId===ve&&X.shelfId===t.id,n=(i=t.code.charAt(0).toUpperCase())&&{A:{bg:"bg-blue-500",hover:"hover:bg-blue-600",border:"border-blue-500",text:"text-blue-600",bgLight:"bg-blue-50"},B:{bg:"bg-green-500",hover:"hover:bg-green-600",border:"border-green-500",text:"text-green-600",bgLight:"bg-green-50"},C:{bg:"bg-purple-500",hover:"hover:bg-purple-600",border:"border-purple-500",text:"text-purple-600",bgLight:"bg-purple-50"},D:{bg:"bg-orange-500",hover:"hover:bg-orange-600",border:"border-orange-500",text:"text-orange-600",bgLight:"bg-orange-50"},E:{bg:"bg-red-500",hover:"hover:bg-red-600",border:"border-red-500",text:"text-red-600",bgLight:"bg-red-50"},F:{bg:"bg-teal-500",hover:"hover:bg-teal-600",border:"border-teal-500",text:"text-teal-600",bgLight:"bg-teal-50"},G:{bg:"bg-pink-500",hover:"hover:bg-pink-600",border:"border-pink-500",text:"text-pink-600",bgLight:"bg-pink-50"},H:{bg:"bg-indigo-500",hover:"hover:bg-indigo-600",border:"border-indigo-500",text:"text-indigo-600",bgLight:"bg-indigo-50"},I:{bg:"bg-emerald-500",hover:"hover:bg-emerald-600",border:"border-emerald-500",text:"text-emerald-600",bgLight:"bg-emerald-50"},J:{bg:"bg-cyan-500",hover:"hover:bg-cyan-600",border:"border-cyan-500",text:"text-cyan-600",bgLight:"bg-cyan-50"},K:{bg:"bg-lime-500",hover:"hover:bg-lime-600",border:"border-lime-500",text:"text-lime-600",bgLight:"bg-lime-50"},L:{bg:"bg-amber-500",hover:"hover:bg-amber-600",border:"border-amber-500",text:"text-amber-600",bgLight:"bg-amber-50"},M:{bg:"bg-rose-500",hover:"hover:bg-rose-600",border:"border-rose-500",text:"text-rose-600",bgLight:"bg-rose-50"},N:{bg:"bg-violet-500",hover:"hover:bg-violet-600",border:"border-violet-500",text:"text-violet-600",bgLight:"bg-violet-50"},O:{bg:"bg-sky-500",hover:"hover:bg-sky-600",border:"border-sky-500",text:"text-sky-600",bgLight:"bg-sky-50"},P:{bg:"bg-fuchsia-500",hover:"hover:bg-fuchsia-600",border:"border-fuchsia-500",text:"text-fuchsia-600",bgLight:"bg-fuchsia-50"},Q:{bg:"bg-slate-500",hover:"hover:bg-slate-600",border:"border-slate-500",text:"text-slate-600",bgLight:"bg-slate-50"},R:{bg:"bg-zinc-500",hover:"hover:bg-zinc-600",border:"border-zinc-500",text:"text-zinc-600",bgLight:"bg-zinc-50"},S:{bg:"bg-stone-500",hover:"hover:bg-stone-600",border:"border-stone-500",text:"text-stone-600",bgLight:"bg-stone-50"},T:{bg:"bg-neutral-500",hover:"hover:bg-neutral-600",border:"border-neutral-500",text:"text-neutral-600",bgLight:"bg-neutral-50"},U:{bg:"bg-blue-400",hover:"hover:bg-blue-500",border:"border-blue-400",text:"text-blue-500",bgLight:"bg-blue-25"},V:{bg:"bg-green-400",hover:"hover:bg-green-500",border:"border-green-400",text:"text-green-500",bgLight:"bg-green-25"},W:{bg:"bg-purple-400",hover:"hover:bg-purple-500",border:"border-purple-400",text:"text-purple-500",bgLight:"bg-purple-25"},X:{bg:"bg-orange-400",hover:"hover:bg-orange-500",border:"border-orange-400",text:"text-orange-500",bgLight:"bg-orange-25"},Y:{bg:"bg-red-400",hover:"hover:bg-red-500",border:"border-red-400",text:"text-red-500",bgLight:"bg-red-25"},Z:{bg:"bg-teal-400",hover:"hover:bg-teal-500",border:"border-teal-400",text:"text-teal-500",bgLight:"bg-teal-25"},0:{bg:"bg-gray-600",hover:"hover:bg-gray-700",border:"border-gray-600",text:"text-gray-600",bgLight:"bg-gray-100"},1:{bg:"bg-blue-600",hover:"hover:bg-blue-700",border:"border-blue-600",text:"text-blue-600",bgLight:"bg-blue-100"},2:{bg:"bg-green-600",hover:"hover:bg-green-700",border:"border-green-600",text:"text-green-600",bgLight:"bg-green-100"},3:{bg:"bg-purple-600",hover:"hover:bg-purple-700",border:"border-purple-600",text:"text-purple-600",bgLight:"bg-purple-100"},4:{bg:"bg-orange-600",hover:"hover:bg-orange-700",border:"border-orange-600",text:"text-orange-600",bgLight:"bg-orange-100"},5:{bg:"bg-red-600",hover:"hover:bg-red-700",border:"border-red-600",text:"text-red-600",bgLight:"bg-red-100"},6:{bg:"bg-teal-600",hover:"hover:bg-teal-700",border:"border-teal-600",text:"text-teal-600",bgLight:"bg-teal-100"},7:{bg:"bg-pink-600",hover:"hover:bg-pink-700",border:"border-pink-600",text:"text-pink-600",bgLight:"bg-pink-100"},8:{bg:"bg-indigo-600",hover:"hover:bg-indigo-700",border:"border-indigo-600",text:"text-indigo-600",bgLight:"bg-indigo-100"},9:{bg:"bg-emerald-600",hover:"hover:bg-emerald-700",border:"border-emerald-600",text:"text-emerald-600",bgLight:"bg-emerald-100"}}[i.toUpperCase()]||{bg:"bg-gray-500",hover:"hover:bg-gray-600",border:"border-gray-500",text:"text-gray-600",bgLight:"bg-gray-50"};var i;const l=null==(a=t.code.toUpperCase().match(/[A-Z]/))?void 0:a[0],o=l?(e=>({A:"bg-gradient-to-br from-blue-400 to-blue-500",B:"bg-gradient-to-br from-green-400 to-green-500",C:"bg-gradient-to-br from-purple-400 to-purple-500",D:"bg-gradient-to-br from-orange-400 to-orange-500",E:"bg-gradient-to-br from-red-400 to-red-500",F:"bg-gradient-to-br from-teal-400 to-teal-500",G:"bg-gradient-to-br from-pink-400 to-pink-500",H:"bg-gradient-to-br from-indigo-400 to-indigo-500",I:"bg-gradient-to-br from-emerald-400 to-emerald-500",J:"bg-gradient-to-br from-cyan-400 to-cyan-500",K:"bg-gradient-to-br from-lime-400 to-lime-500",L:"bg-gradient-to-br from-amber-400 to-amber-500",M:"bg-gradient-to-br from-rose-400 to-rose-500",N:"bg-gradient-to-br from-violet-400 to-violet-500",O:"bg-gradient-to-br from-sky-400 to-sky-500",P:"bg-gradient-to-br from-fuchsia-400 to-fuchsia-500",Q:"bg-gradient-to-br from-slate-400 to-slate-500",R:"bg-gradient-to-br from-zinc-400 to-zinc-500",S:"bg-gradient-to-br from-stone-400 to-stone-500",T:"bg-gradient-to-br from-neutral-400 to-neutral-500",U:"bg-gradient-to-br from-yellow-400 to-yellow-500",V:"bg-gradient-to-br from-orange-500 to-orange-600",W:"bg-gradient-to-br from-red-500 to-red-600",X:"bg-gradient-to-br from-pink-500 to-pink-600",Y:"bg-gradient-to-br from-purple-500 to-purple-600",Z:"bg-gradient-to-br from-indigo-500 to-indigo-600",0:"bg-gradient-to-br from-gray-300 to-gray-400",1:"bg-gradient-to-br from-blue-600 to-blue-700",2:"bg-gradient-to-br from-green-600 to-green-700",3:"bg-gradient-to-br from-teal-600 to-teal-700",4:"bg-gradient-to-br from-cyan-600 to-cyan-700",5:"bg-gradient-to-br from-lime-600 to-lime-700",6:"bg-gradient-to-br from-amber-600 to-amber-700",7:"bg-gradient-to-br from-emerald-600 to-emerald-700",8:"bg-gradient-to-br from-rose-600 to-rose-700",9:"bg-gradient-to-br from-violet-600 to-violet-700"}[e]||"bg-gradient-to-br from-gray-200 to-gray-300"))(l):"bg-gradient-to-br from-gray-50 to-gray-100/50";return e.jsx("button",{onClick:()=>{return e=ve,r=t.id,Y(t=>({...t,storageRoomId:e,shelfId:r})),void ye(!1);var e,r},className:"group relative overflow-hidden transition-all duration-500 text-left "+(s?"transform scale-105 shadow-2xl":"hover:transform hover:scale-102 hover:shadow-xl"),children:e.jsxs("div",{className:"relative h-32 rounded-3xl border-2 transition-all duration-500 "+(s?`${n.border} ${n.bgLight}`:`border-gray-200 ${o} hover:border-gray-300`),children:[e.jsxs("div",{className:"absolute inset-0 opacity-10 transition-opacity duration-500 "+(s?"opacity-20":"group-hover:opacity-15"),children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${n.bg} rounded-3xl`}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(255,255,255,0.3),transparent_50%)]"})]}),e.jsxs("div",{className:"relative h-full flex items-center justify-between p-6",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-5xl font-black tracking-tight transition-all duration-500 text-white",children:t.code}),e.jsx("div",{className:"text-base font-medium transition-all duration-500 "+(s?"text-white opacity-90":"text-white opacity-80"),children:"Storage Shelf"})]})}),l&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center text-2xl font-black transition-all duration-500 border-2 "+(s?`${o} text-white shadow-xl border-white/90`:`${o} text-white shadow-md border-white/80`),children:l}),s&&e.jsx("div",{className:`absolute inset-0 rounded-2xl ${n.bg} opacity-30 blur-md`})]})]}),s&&e.jsx("div",{className:`absolute -top-2 -right-2 w-8 h-8 rounded-full ${n.bg} flex items-center justify-center shadow-lg animate-pulse`,children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("div",{className:"absolute inset-0 rounded-3xl border-2 border-transparent transition-all duration-500 "+(s?`${n.border} opacity-100`:"group-hover:border-gray-300 opacity-0 group-hover:opacity-100")})]})},t.id)})}):e.jsxs("div",{className:"text-center py-16",children:[e.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-2 bg-white rounded-full flex items-center justify-center",children:e.jsx(F,{size:36,className:"text-gray-400"})})]}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"No Shelves Found"}),e.jsx("p",{className:"text-gray-600 max-w-lg mx-auto leading-relaxed",children:Ne||ke?"Try adjusting your search or filter criteria to discover available shelves.":"No shelves are currently available in this storage room."})]})}),e.jsxs("div",{className:"flex justify-between items-center p-6 border-t border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[At().length," shelf",1!==At().length?"es":""," found"]}),e.jsx("button",{onClick:()=>ye(!1),className:"px-6 py-2 text-gray-600 hover:text-gray-800 transition-colors font-medium",children:"Cancel"})]})]})}),De&&null!==Me&&e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50 p-2",role:"dialog","aria-modal":"true","aria-labelledby":"variant-specifications-modal-title",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-4xl w-full max-h-[85vh] overflow-hidden mx-auto",children:[e.jsx("div",{className:"bg-blue-600 p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("h2",{id:"variant-specifications-modal-title",className:"text-lg font-semibold",children:"Variant Specs"}),e.jsx("p",{className:"text-blue-100 text-xs",children:(null==(o=_e[Me])?void 0:o.name)||`Variant ${Me+1}`})]})]}),e.jsx("button",{onClick:()=>Re(!1),className:"p-1 hover:bg-white/20 rounded transition-colors","aria-label":"Close modal",children:e.jsx(x,{size:18})})]})}),e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-4 py-2",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto",children:ie.map(t=>{const r=t.icon,a=Be===t.id;return e.jsxs("button",{onClick:()=>Ve(t.id),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors "+(a?`bg-${t.color}-500 text-white`:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-100"),children:[e.jsx(r,{size:14}),t.name]},t.id)})})}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(85vh-140px)]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(w,{size:16,className:"text-blue-600"}),null==(c=ie.find(e=>e.id===Be))?void 0:c.name]}),Object.entries(le(Be)).map(([t,r])=>0===r.length?null:e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-xs font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:oe(t)}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",r.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:r.map(t=>{var r,a;const s=t.icon,n=(null==(a=null==(r=_e[Me])?void 0:r.attributes)?void 0:a[t.key])||"",i="boolean"===t.type;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(s,{size:12,className:"text-gray-500"}),t.name,t.unit&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.unit,")"]})]}),i?e.jsx("button",{type:"button",onClick:()=>It(Me,t.key,!n),className:"w-full p-2 border rounded-lg transition-colors "+(n?"bg-green-50 border-green-300 text-green-800":"bg-white border-gray-300 text-gray-600 hover:border-blue-500 hover:bg-blue-50"),children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(j,{size:14,className:n?"text-green-600":"text-gray-400"})})}):"select"===t.type&&t.options?e.jsxs("select",{value:n,onChange:e=>It(Me,t.key,e.target.value),className:"w-full py-1.5 px-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",children:[e.jsx("option",{value:"",children:"Select"}),t.options.map(t=>e.jsx("option",{value:t,children:t},t))]}):e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number"===t.type?"number":"text",value:n,onChange:e=>It(Me,t.key,e.target.value),placeholder:t.placeholder||`Enter ${t.name.toLowerCase()}`,className:"w-full py-1.5 px-2 pr-6 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),n&&e.jsx("button",{type:"button",onClick:()=>It(Me,t.key,""),className:"absolute right-1 top-1.5 text-red-500 hover:text-red-700",title:"Clear value",children:e.jsx(x,{size:12})})]})]},t.key)})})]},t))]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(w,{size:16,className:"text-gray-600"}),"Custom"]}),$e===Me?e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:ze,onChange:e=>Qe(e.target.value),placeholder:"Enter custom spec name...",className:"flex-1 py-1.5 px-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-xs",onKeyPress:e=>{"Enter"===e.key&&ze.trim()&&Ut(Me)},autoFocus:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx("button",{type:"button",onClick:()=>Ut(Me),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>{Oe(null),Qe("")},className:"px-3 py-1.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-xs font-medium",children:"Cancel"})]})}):e.jsxs("button",{type:"button",onClick:()=>{Oe(Me),Qe("")},className:"flex items-center gap-2 p-2 bg-white border border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors w-full",children:[e.jsx(w,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Add Custom"})]})]}),(null==(u=_e[Me])?void 0:u.attributes)&&Object.keys(_e[Me].attributes).length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(j,{size:16,className:"text-green-600"}),"Current",e.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs font-medium",children:Object.keys(_e[Me].attributes).length})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:Object.entries(_e[Me].attributes).map(([t,r])=>e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-green-800 capitalize truncate",children:t.replace(/_/g," ")}),e.jsx("div",{className:"text-xs text-green-600 truncate",children:String(r)||"Not set"})]}),e.jsx("button",{type:"button",onClick:()=>((e,t)=>{const r={..._e[e].attributes};delete r[t],Lt(e,"attributes",r)})(Me,t),className:"ml-1 text-red-500 hover:text-red-700 flex-shrink-0",title:"Remove specification",children:e.jsx(x,{size:12})})]})},t))})]})]})}),e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-gray-600",children:(null==(m=_e[Me])?void 0:m.attributes)&&Object.keys(_e[Me].attributes).length>0?`${Object.keys(_e[Me].attributes).length} spec${1!==Object.keys(_e[Me].attributes).length?"s":""} added`:"No specs added yet"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Re(!1),className:"px-3 py-1.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors text-xs font-medium",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>{Re(!1),_.success("Variant specifications saved successfully!")},className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium",children:"Save"})]})]})})]})})]})},nt=({sparePart:t,onSave:r,onCancel:i})=>{const{categories:l,suppliers:o,loadSparePartCategories:c,loadSuppliers:u}=a(),[m,g]=d.useState(1),[h,b]=d.useState(!1),[p,y]=d.useState({name:(null==t?void 0:t.name)||"",partNumber:(null==t?void 0:t.part_number)||"",categoryId:(null==t?void 0:t.category_id)||null,brand:(null==t?void 0:t.brand)||"",description:(null==t?void 0:t.description)||"",costPrice:(null==t?void 0:t.cost_price)||0,sellingPrice:(null==t?void 0:t.selling_price)||0,quantity:(null==t?void 0:t.quantity)||0,minQuantity:(null==t?void 0:t.min_quantity)||0,location:(null==t?void 0:t.location)||"",supplierId:(null==t?void 0:t.supplier_id)||null,images:(null==t?void 0:t.images)||[],condition:(null==t?void 0:t.condition)||"new"}),[v,w]=d.useState({}),k=[{id:1,title:"Basic Info",icon:f,description:"Name, category, and description"},{id:2,title:"Pricing & Stock",icon:N,description:"Cost, price, and inventory"},{id:3,title:"Location & Images",icon:I,description:"Storage location and photos"}],S=e=>{const t={};switch(e){case 1:p.name.trim()||(t.name="Name is required"),p.categoryId||(t.categoryId="Category is required");break;case 2:p.costPrice<0&&(t.costPrice="Cost price cannot be negative"),p.sellingPrice<0&&(t.sellingPrice="Selling price cannot be negative"),p.quantity<0&&(t.quantity="Quantity cannot be negative"),p.minQuantity<0&&(t.minQuantity="Minimum quantity cannot be negative")}return w(t),0===Object.keys(t).length},A=(e,t)=>{y(r=>({...r,[e]:t})),v[e]&&w(t=>({...t,[e]:""}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(s,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Edit Spare Part":"Add New Spare Part"}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600",children:e.jsx(x,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:k.map((t,r)=>{const a=t.icon,s=m===t.id,n=m>t.id;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full border-2 "+(s?"border-blue-500 bg-blue-500 text-white":n?"border-green-500 bg-green-500 text-white":"border-gray-300 bg-white text-gray-400"),children:n?e.jsx(j,{className:"w-5 h-5"}):e.jsx(a,{className:"w-5 h-5"})}),r<k.length-1&&e.jsx("div",{className:"w-16 h-0.5 mx-2 "+(n?"bg-green-500":"bg-gray-300")})]},t.id)})}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Step ",m," of ",k.length,": ",k[m-1].title]}),e.jsx("p",{className:"text-xs text-gray-500",children:k[m-1].description})]})]}),e.jsx("div",{className:"mb-6",children:(()=>{switch(m){case 1:return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Part Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:e=>A("name",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(v.name?"border-red-500":"border-gray-300"),placeholder:"Enter part name"}),v.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:v.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Part Number"}),e.jsx("input",{type:"text",value:p.partNumber,onChange:e=>A("partNumber",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter part number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),e.jsx(se,{value:p.categoryId,onChange:e=>A("categoryId",e),categories:l,error:v.categoryId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand"}),e.jsx("input",{type:"text",value:p.brand,onChange:e=>A("brand",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter brand name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:e=>A("description",e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter part description"})]})]});case 2:return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Price"}),e.jsx(ne,{value:p.costPrice,onChange:e=>A("costPrice",e),placeholder:"0.00",error:v.costPrice})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selling Price"}),e.jsx(ne,{value:p.sellingPrice,onChange:e=>A("sellingPrice",e),placeholder:"0.00",error:v.sellingPrice})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Quantity"}),e.jsx("input",{type:"number",min:"0",value:p.quantity,onChange:e=>A("quantity",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(v.quantity?"border-red-500":"border-gray-300")}),v.quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:v.quantity})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Quantity"}),e.jsx("input",{type:"number",min:"0",value:p.minQuantity,onChange:e=>A("minQuantity",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(v.minQuantity?"border-red-500":"border-gray-300")}),v.minQuantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:v.minQuantity})]})]})]});case 3:return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Storage Location"}),e.jsx("input",{type:"text",value:p.location,onChange:e=>A("location",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Shelf A1, Room 2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier"}),e.jsxs("select",{value:p.supplierId||"",onChange:e=>A("supplierId",e.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select supplier"}),o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Condition"}),e.jsxs("select",{value:p.condition,onChange:e=>A("condition",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"used",children:"Used"}),e.jsx("option",{value:"refurbished",children:"Refurbished"}),e.jsx("option",{value:"damaged",children:"Damaged"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Images"}),e.jsx(Ze,{images:p.images,onImagesChange:e=>A("images",e),maxImages:5,className:"w-full"})]})]});default:return null}})()}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(n,{onClick:()=>{g(e=>Math.max(e-1,1))},disabled:1===m,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Previous"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{onClick:i,variant:"outline",children:"Cancel"}),m<k.length?e.jsxs(n,{onClick:()=>{S(m)&&g(e=>Math.min(e+1,k.length))},className:"flex items-center gap-2",children:["Next",e.jsx(Q,{className:"w-4 h-4"})]}):e.jsx(n,{onClick:async()=>{if(S(m)){b(!0);try{await r(p)}catch(e){_.error("Failed to save spare part")}finally{b(!1)}}},disabled:h,className:"flex items-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4"}),t?"Update Part":"Create Part"]})})]})]})]})})})},it=({sparePart:t,onUse:a,onCancel:i})=>{r();const[l,o]=d.useState(1),[c,u]=d.useState(""),[m,g]=d.useState(""),[h,b]=d.useState({}),[p,y]=d.useState(!1),v=(e,t)=>{switch(e){case"quantity":o(t);break;case"reason":u(t);break;case"notes":g(t)}h[e]&&b(t=>({...t,[e]:""}))},j=t.quantity-l,N=j<=t.min_quantity,w=0===j;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 z-50",children:e.jsx(s,{className:"w-full max-w-sm",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-red-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Use Part"})]}),e.jsx("button",{onClick:i,className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:e.jsx(x,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.part_number})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Available:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:t.quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Min:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:t.min_quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Cost:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:me.currency(t.cost_price)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Price:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:me.currency(t.selling_price)})]})]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return l<=0&&(e.quantity="Quantity must be greater than 0"),l>t.quantity&&(e.quantity=`Cannot use more than available quantity (${t.quantity})`),c.trim()||(e.reason="Reason is required"),b(e),0===Object.keys(e).length})()){y(!0);try{await a(l,c,m)}catch(r){}finally{y(!1)}}},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity to Use *"}),e.jsx("input",{type:"number",min:"1",max:t.quantity,value:l,onChange:e=>v("quantity",parseInt(e.target.value)||0),className:"w-full px-2 py-1.5 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm "+(h.quantity?"border-red-300":"border-gray-300"),placeholder:"1"}),h.quantity&&e.jsxs("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),h.quantity]}),l>0&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Remaining: ",e.jsx("span",{className:"font-medium "+(w?"text-red-600":N?"text-yellow-600":"text-green-600"),children:j}),w&&" (Out of stock)",N&&!w&&" (Low stock)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Reason for Use *"}),e.jsxs("select",{value:c,onChange:e=>v("reason",e.target.value),className:"w-full px-2 py-1.5 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm "+(h.reason?"border-red-300":"border-gray-300"),children:[e.jsx("option",{value:"",children:"Select a reason"}),["Device Repair","Maintenance","Customer Service","Testing","Training","Warranty Claim","Quality Control","Other"].map(t=>e.jsx("option",{value:t,children:t},t))]}),h.reason&&e.jsxs("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),h.reason]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Additional Notes"}),e.jsx("textarea",{value:m,onChange:e=>v("notes",e.target.value),rows:2,className:"w-full px-2 py-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Optional notes about this usage..."})]}),l>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2 text-sm",children:"Usage Summary"}),e.jsxs("div",{className:"space-y-1 text-xs text-blue-800",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Quantity:"}),e.jsx("span",{className:"font-medium",children:l})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cost Value:"}),e.jsx("span",{className:"font-medium",children:me.currency(l*t.cost_price)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Selling Value:"}),e.jsx("span",{className:"font-medium",children:me.currency(l*t.selling_price)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Remaining:"}),e.jsx("span",{className:"font-medium "+(w?"text-red-600":N?"text-yellow-600":"text-green-600"),children:j})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3 border-t border-gray-200",children:[e.jsx(n,{type:"button",variant:"outline",onClick:i,disabled:p,className:"text-sm px-3 py-1.5",children:"Cancel"}),e.jsxs(n,{type:"submit",disabled:p||l<=0||l>t.quantity,className:"flex items-center gap-1 text-sm px-3 py-1.5",children:[e.jsx(B,{className:"w-3 h-3"}),p?"Recording...":"Record Usage"]})]})]})]})})})},lt=({isOpen:t,onClose:r,sparePart:a,currency:u,onEdit:m,onDelete:g,onUse:b,onSparePartUpdated:p})=>{var y,v,j,k,S,P;d.useEffect(()=>{if(t&&(null==a?void 0:a.id)){ae(0),F(),E(),a.location&&be({storeLocation:null,storageRoom:null,storeShelf:null,fallbackLocation:a.location}),U();const e=setTimeout(()=>{fe(!1)},1e4);return()=>clearTimeout(e)}},[t,null==a?void 0:a.id]);const U=async()=>{var e,t;if(null==a?void 0:a.id)try{fe(!0);const s={storeLocation:null,storageRoom:null,storeShelf:null},n=[],i={};if(a.storage_room_id&&(i.storageRoom=de.getById(a.storage_room_id),n.push(i.storageRoom)),a.shelf_id&&(i.storeShelf=ue.getById(a.shelf_id),n.push(i.storeShelf)),n.length>0)try{const a=await Promise.allSettled(n.map(e=>Promise.race([e,new Promise((e,t)=>setTimeout(()=>t(new Error("API call timeout")),5e3))])));if(i.storageRoom){const e=a[0];"fulfilled"===e.status&&e.value&&(s.storageRoom=e.value)}const l=i.storageRoom?1:0;if(i.storeShelf){const e=a[l];"fulfilled"===e.status&&e.value&&(s.storeShelf=e.value)}let o=null;if((null==(e=s.storageRoom)?void 0:e.store_location_id)?o=s.storageRoom.store_location_id:(null==(t=s.storeShelf)?void 0:t.store_location_id)&&(o=s.storeShelf.store_location_id),o)try{const e=await Promise.race([ce.getById(o),new Promise((e,t)=>setTimeout(()=>t(new Error("Store location API timeout")),3e3))]);s.storeLocation=e}catch(r){}}catch(r){}be(s)}catch(r){be(null)}finally{fe(!1)}},F=async()=>{if(null==a?void 0:a.id)try{te(!0);const e=await i(a.id);if(e&&e.length>0){const t=e.map(e=>{const t=l.sanitizeImageUrl(e.image_url,e.file_name);return t.isSanitized,{id:e.id,url:t.url,thumbnailUrl:e.thumbnail_url?l.sanitizeImageUrl(e.thumbnail_url,`thumb-${e.file_name}`).url:t.url,fileName:e.file_name,fileSize:e.file_size||0,isPrimary:e.is_primary||!1,uploadedAt:e.created_at||(new Date).toISOString()}});V(t)}else if(a.images&&Array.isArray(a.images)&&a.images.length>0){const e=a.images.map((e,t)=>{const r=l.sanitizeImageUrl(e,`spare-part-image-${t+1}`);return{id:`spare-part-image-${t}`,url:r.url,thumbnailUrl:r.url,fileName:`spare-part-image-${t+1}`,fileSize:0,isPrimary:0===t,uploadedAt:a.created_at||(new Date).toISOString()}});V(e)}else V([])}catch(e){V([])}finally{te(!1)}},E=async()=>{var e;if(null==a?void 0:a.id)try{le(!0);const t=await o(a.id);ne(t);const r=await c(a.id);me(r);t.length,a.use_variants||(null==(e=a.metadata)||e.useVariants)}catch(t){ne([]),me(null)}finally{le(!1)}},[q,D]=d.useState(1),[R,M]=d.useState(""),[T,$]=d.useState(""),[O,z]=d.useState(!1);d.useState(!1),d.useState(!1),d.useState((null==a?void 0:a.quantity)||0),d.useState(null);const[Q,V]=d.useState([]),[ee,te]=d.useState(!1),[re,ae]=d.useState(0),[se,ne]=d.useState([]),[ie,le]=d.useState(!1),[oe,me]=d.useState(null),[he,be]=d.useState(null),[pe,fe]=d.useState(!1),ye=ge.find(e=>"TZS"===e.code)||ge[0],ve=u||ye,[je,Ne]=d.useState("overview"),we=d.useMemo(()=>{var e;if((a.use_variants||(null==(e=a.metadata)?void 0:e.useVariants)||!1)&&se.length>0){const e=se.reduce((e,t)=>e+(t.quantity||0),0),t=se.reduce((e,t)=>e+t.selling_price*t.quantity,0),r=se.reduce((e,t)=>e+t.cost_price*t.quantity,0),a=e>0?t/e:0,s=e>0?r/e:0,n=a-s;return{totalQuantity:e,totalValue:t,totalCost:r,totalProfit:t-r,avgSellingPrice:a,avgCostPrice:s,avgProfit:n,margin:s>0?n/s*100:0,usesVariants:!0}}{const e=a.quantity||0,t=a.selling_price*e,r=a.cost_price*e,s=t-r,n=a.cost_price>0?(a.selling_price-a.cost_price)/a.cost_price*100:0;return{totalQuantity:e,totalValue:t,totalCost:r,totalProfit:s,avgSellingPrice:a.selling_price,avgCostPrice:a.cost_price,avgProfit:a.selling_price-a.cost_price,margin:n,usesVariants:!1}}},[a,se]);if(!t||!a||!ve)return null;const ke=a.created_at?Math.floor((Date.now()-new Date(a.created_at).getTime())/864e5):0,Se=Math.round((a.name?20:0)+(a.description?15:0)+(a.brand?10:0)+(a.location?10:0)+(a.compatible_devices?15:0)+(a.cost_price>0?15:0)+(a.selling_price>0?15:0));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/40 backdrop-blur-sm",onClick:r,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-2 sm:p-4 overflow-y-auto",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsxs("div",{className:"relative bg-white rounded-lg sm:rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] sm:max-h-[85vh] overflow-hidden flex flex-col my-2 sm:my-4",onClick:e=>e.stopPropagation(),style:{pointerEvents:"auto"},children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 flex-shrink-0",children:e.jsx(H,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 truncate",children:a.name}),a.part_number&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded-full",children:a.part_number})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["Part Number: ",a.part_number||"N/A"]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+(we.totalQuantity>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:we.totalQuantity>0?"In Stock":"Out of Stock"})})]})]})]}),e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors flex-shrink-0",children:e.jsx(x,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex w-full",children:[e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),Ne("overview")},className:"flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors "+("overview"===je?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]})}),e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),Ne("analytics")},className:"flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors "+("analytics"===je?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"Analytics"})]})}),e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),Ne("variants")},className:"flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors "+("variants"===je?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{children:"Variants"}),se.length>0&&e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-1.5 py-0.5 rounded-full",children:se.length})]})}),e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),Ne("details")},className:"flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors "+("details"===je?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:"Details"})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:e.jsxs("div",{className:"p-3 sm:p-4",children:["overview"===je&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border border-emerald-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-emerald-700 uppercase tracking-wide mb-1",children:"Total Value"}),e.jsx("div",{className:"text-sm font-bold text-emerald-900",children:xe(we.totalValue,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Profit"}),e.jsx("div",{className:"text-sm font-bold text-blue-900",children:xe(we.totalProfit,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 uppercase tracking-wide mb-1",children:"Margin"}),e.jsxs("div",{className:"text-sm font-bold text-orange-900",children:[we.margin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-purple-700 uppercase tracking-wide mb-1",children:"Investment"}),e.jsx("div",{className:"text-sm font-bold text-purple-900",children:xe(we.totalCost,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3 sm:gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Images"}),ee?e.jsx("div",{className:"aspect-square relative rounded-lg overflow-hidden bg-gray-50 border border-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading images..."})]})}):Q.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"aspect-square relative rounded-lg overflow-hidden bg-gray-50 border border-gray-200",children:e.jsx("img",{src:(null==(y=Q[re])?void 0:y.thumbnailUrl)||(null==(v=Q[re])?void 0:v.url)||(null==(j=Q[0])?void 0:j.thumbnailUrl)||(null==(k=Q[0])?void 0:k.url),alt:a.name,className:"w-full h-full object-cover"})}),Q.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Q.map((t,r)=>e.jsx("button",{onClick:()=>ae(r),className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden border-2 transition-all "+(r===re?"border-blue-500":"border-gray-200 hover:border-gray-300"),children:e.jsx("img",{src:t.thumbnailUrl||t.url,alt:`${a.name} ${r+1}`,className:"w-full h-full object-cover"})},t.id))})]}):e.jsx("div",{className:"aspect-square relative rounded-xl overflow-hidden bg-gradient-to-br from-blue-100 to-indigo-100 border-2 border-dashed border-blue-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-16 h-16 text-blue-400 mx-auto mb-2"}),e.jsx("p",{className:"text-blue-600 font-medium text-sm",children:"No images available"}),e.jsx("p",{className:"text-blue-500 text-xs mt-1",children:"Upload images to display here"})]})})]}),a.description&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Description"}),e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed bg-gray-50 rounded-lg p-3",children:a.description})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(G,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Basic Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(S=a.category)?void 0:S.name)||"Uncategorized"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),e.jsx("p",{className:"text-sm font-medium "+(a.is_active?"text-green-600":"text-red-600"),children:a.is_active?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Part ID"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:a.id})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Part Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:a.part_number})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:we.usesVariants?"Total Stock":"Current Stock"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[we.totalQuantity," units"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Min Stock"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[a.min_quantity," units"]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(N,{className:"w-5 h-5 text-green-600"}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-800",children:["Pricing Summary",we.usesVariants&&e.jsx("span",{className:"text-xs text-blue-600 ml-2",children:"(Variants)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:we.usesVariants?"Avg Selling Price":"Selling Price"}),e.jsx("p",{className:"text-sm font-bold text-green-600",children:xe(we.avgSellingPrice,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:we.usesVariants?"Avg Cost Price":"Cost Price"}),e.jsx("p",{className:"text-sm font-bold text-red-600",children:xe(we.avgCostPrice,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:we.usesVariants?"Avg Profit/Unit":"Profit/Unit"}),e.jsx("p",{className:"text-sm font-bold text-blue-600",children:xe(we.avgProfit,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Markup"}),e.jsxs("p",{className:"text-sm font-bold text-purple-600",children:[we.margin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"col-span-2 space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Value"}),e.jsx("p",{className:"text-xl font-bold text-orange-600",children:xe(we.totalValue,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})]}),a.supplier&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(L,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Supplier Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.supplier.name})]}),a.supplier.email&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.supplier.email})]}),a.supplier.phone&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Phone"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.supplier.phone})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(K,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Status & Details"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Condition"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:a.condition||"New"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Brand"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.brand||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Stock Status"}),e.jsx("p",{className:"text-sm font-medium "+(0===we.totalQuantity?"text-red-600":we.totalQuantity<=a.min_quantity?"text-orange-600":"text-green-600"),children:0===we.totalQuantity?"Out of Stock":we.totalQuantity<=a.min_quantity?"Low Stock":"In Stock"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Location"}),pe?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."})]}):he?e.jsxs("div",{className:"text-sm",children:[he.storeLocation&&e.jsx("p",{className:"font-medium text-gray-900",children:he.storeLocation.name}),he.storageRoom&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Room: ",he.storageRoom.code]}),he.storeShelf&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Shelf: ",he.storeShelf.code]}),!he.storeLocation&&!he.storageRoom&&!he.storeShelf&&e.jsx("p",{className:"text-sm text-gray-500",children:he.fallbackLocation||a.location||"Not Set"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:a.location||"Not Set"})]})]})]})]})]})]}),"analytics"===je&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(X,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Performance Metrics"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-green-700 uppercase tracking-wide mb-1",children:"Stock Turnover"}),e.jsx("div",{className:"text-sm font-bold text-green-900",children:ke>0?(we.totalQuantity/ke).toFixed(2):"N/A"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Inventory Value"}),e.jsx("div",{className:"text-sm font-bold text-blue-900",children:xe(we.totalCost,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-purple-700 uppercase tracking-wide mb-1",children:"Retail Value"}),e.jsx("div",{className:"text-sm font-bold text-purple-900",children:xe(we.totalValue,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 uppercase tracking-wide mb-1",children:"Profit Potential"}),e.jsx("div",{className:"text-sm font-bold text-orange-900",children:xe(we.totalProfit,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(W,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Data Quality & Analytics"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Data Completeness"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${Se}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[Se,"%"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Days in Inventory"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[ke," days"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.created_at?new Date(a.created_at).toLocaleDateString():"Unknown"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.updated_at?new Date(a.updated_at).toLocaleDateString():"Never"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(Y,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Recommendations"})]}),e.jsx("div",{className:"space-y-2",children:(()=>{const t=[];return we.totalQuantity<=a.min_quantity&&t.push({type:"warning",message:"Stock is low and needs reordering"}),we.avgCostPrice>0&&we.avgSellingPrice<=we.avgCostPrice&&t.push({type:"error",message:"Average selling price is at or below average cost price - review pricing strategy"}),Se<60&&t.push({type:"info",message:"Spare part data is incomplete - consider adding missing information"}),0===t.length&&t.push({type:"success",message:"Spare part is in good condition with no immediate actions needed"}),t.map((t,r)=>e.jsx("div",{className:"p-3 rounded-lg "+("error"===t.type?"bg-red-50 border border-red-200":"warning"===t.type?"bg-orange-50 border border-orange-200":"info"===t.type?"bg-blue-50 border border-blue-200":"bg-green-50 border border-green-200"),children:e.jsx("p",{className:"text-sm font-medium "+("error"===t.type?"text-red-800":"warning"===t.type?"text-orange-800":"info"===t.type?"text-blue-800":"text-green-800"),children:t.message})},r))})()})]})]}),"variants"===je&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Variants Overview"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>E(),className:"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),"Refresh"]})})]}),ie?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading variants..."})]})}):e.jsxs("div",{className:"space-y-4",children:[oe&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide mb-1",children:"Total Variants"}),e.jsx("div",{className:"text-sm font-bold text-blue-900",children:oe.totalVariants})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-green-700 uppercase tracking-wide mb-1",children:"In Stock"}),e.jsx("div",{className:"text-sm font-bold text-green-900",children:oe.inStockVariants})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 uppercase tracking-wide mb-1",children:"Low Stock"}),e.jsx("div",{className:"text-sm font-bold text-orange-900",children:oe.lowStockVariants})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-medium text-purple-700 uppercase tracking-wide mb-1",children:"Total Value"}),e.jsx("div",{className:"text-sm font-bold text-purple-900",children:xe(oe.totalValue,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]})]}),se.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Variant Details"}),se.map((t,r)=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-300 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.name}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-mono",children:t.sku}),t.is_active?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"Active"}):e.jsx("span",{className:"text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded-full",children:"Inactive"})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.description}),t.variant_attributes&&Object.keys(t.variant_attributes).length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-1",children:"Specifications:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(t.variant_attributes).map(([t,r])=>e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded",children:[t,": ",String(r)]},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Stock:"}),e.jsx("span",{className:"font-medium ml-1",children:t.quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Min Stock:"}),e.jsx("span",{className:"font-medium ml-1",children:t.min_quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Cost Price:"}),e.jsx("span",{className:"font-medium text-red-600 ml-1",children:xe(t.cost_price,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Selling Price:"}),e.jsx("span",{className:"font-medium text-green-600 ml-1",children:xe(t.selling_price,ve).replace(/\.00$/,"").replace(/\.0$/,"")})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 ml-4",children:[0===t.quantity?e.jsx("span",{className:"w-4 h-4 bg-red-500 rounded-full",title:"Out of Stock"}):t.quantity<=t.min_quantity?e.jsx("span",{className:"w-4 h-4 bg-orange-500 rounded-full",title:"Low Stock"}):e.jsx("span",{className:"w-4 h-4 bg-green-500 rounded-full",title:"In Stock"}),e.jsx("span",{className:"text-xs text-gray-500",children:0===t.quantity?"Out of Stock":t.quantity<=t.min_quantity?"Low Stock":"In Stock"})]})]})},t.id||r))]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"No variants found"}),e.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Variants allow you to manage different specifications, prices, and stock levels for this spare part."}),e.jsxs("div",{className:"text-xs text-gray-400",children:[e.jsx("p",{children:" Create variants for different qualities (Original, Compatible, Refurbished)"}),e.jsx("p",{children:" Set different prices and stock levels for each variant"}),e.jsx("p",{children:" Track variant-specific attributes and specifications"})]})]})]})]})}),"details"===je&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(A,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Spare Part Identification"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Part Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:a.part_number})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Spare Part ID"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:a.id})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Storage & Location"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Location"}),pe?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."})]}):he?e.jsxs("div",{className:"text-sm",children:[he.storeLocation&&e.jsx("p",{className:"font-medium text-gray-900",children:he.storeLocation.name}),he.storageRoom&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Room: ",he.storageRoom.code]}),he.storeShelf&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Shelf: ",he.storeShelf.code]}),!he.storeLocation&&!he.storageRoom&&!he.storeShelf&&e.jsx("p",{className:"text-sm text-gray-500",children:he.fallbackLocation||a.location||"Not Set"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:a.location||"Not Set"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(P=a.category)?void 0:P.name)||"Uncategorized"})]})]})]}),a.compatible_devices&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(h,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Compatible Devices"})]}),e.jsx("div",{className:"text-sm text-gray-600 bg-gray-50 rounded-lg p-3",children:a.compatible_devices})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-100",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>z(!0),disabled:0===we.totalQuantity,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium",children:[e.jsx(B,{className:"w-4 h-4"}),"Use Spare Part"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Close"}),m&&e.jsxs("button",{onClick:()=>m(a),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(J,{className:"w-4 h-4"}),"Edit"]})]})]})]})})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"w-full max-w-md mx-4",children:e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Use Spare Part"}),e.jsx("button",{onClick:()=>z(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx(x,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity to Use"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>D(Math.max(1,q-1)),disabled:q<=1,className:"w-10 h-10 flex items-center justify-center border-2 border-blue-300 rounded-lg hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(B,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{className:"w-16 text-center font-bold text-xl text-gray-900",children:q}),e.jsx("button",{onClick:()=>D(Math.min(we.totalQuantity,q+1)),disabled:q>=we.totalQuantity,className:"w-10 h-10 flex items-center justify-center border-2 border-blue-300 rounded-lg hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(w,{className:"w-4 h-4 text-blue-600"})})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Available: ",we.totalQuantity," units"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Usage *"}),e.jsx("input",{type:"text",value:R,onChange:e=>M(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Device repair, Maintenance",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:T,onChange:e=>$(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Additional notes..."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-6 pt-4 border-t border-gray-200",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>z(!1),children:"Cancel"}),e.jsx(n,{type:"button",onClick:()=>{q>we.totalQuantity?_.error("Cannot use more than available quantity"):R.trim()?b&&(b(q,R,T),z(!1),D(1),M(""),$(""),_.success(`Used ${q} units of ${a.name}`)):_.error("Please provide a reason for usage")},disabled:!R.trim()||q>we.totalQuantity,className:"bg-blue-600 text-white hover:bg-blue-700",icon:e.jsx(B,{size:18}),children:"Use Spare Part"})]})]})})})]})},ot=()=>{const{spareParts:t,categories:r,isLoading:i,error:l,loadSpareParts:o,loadCategories:c,createOrUpdateSparePart:m,updateSparePart:g,deleteSparePart:x,useSparePart:h}=a(),[b,y]=d.useState(""),[v,j]=d.useState("all"),[N,k]=d.useState("all"),[A,C]=d.useState("grid"),[I,U]=d.useState("name"),[L,F]=d.useState("asc"),[E,q]=d.useState([]),[D,R]=d.useState(!1),[M,T]=d.useState(!1),[$,O]=d.useState(!1),[z,Q]=d.useState(!1),[G,W]=d.useState(!1),[X,Y]=d.useState(null),[ae,se]=d.useState(null),[ne,ie]=d.useState(null),[le,oe]=d.useState({spareParts:null,categories:null,lastLoad:0}),[ce,de]=d.useState(!0);d.useEffect(()=>{(async()=>{const e=Date.now();if(le.spareParts&&le.categories&&e-le.lastLoad<3e5)return void de(!1);performance.now();try{const[t,r]=await Promise.allSettled([o(),c()]);performance.now();oe({spareParts:"fulfilled"===t.status?t.value:null,categories:"fulfilled"===r.status?r.value:null,lastLoad:e}),"rejected"===t.status&&_.error("Failed to load spare parts data"),"rejected"===r.status&&_.error("Failed to load categories data")}catch(t){_.error("Critical error loading data. Please refresh the page.")}finally{de(!1)}})()},[o,c]),d.useEffect(()=>{const e=()=>{R(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),d.useEffect(()=>{const e=e=>{o()};return window.addEventListener("lats:spare-parts-updated",e),()=>{window.removeEventListener("lats:spare-parts-updated",e)}},[o]);const ue=e=>{q(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},ge=()=>{const e=be.filter(e=>E.includes(e.id)).map(e=>({name:e.name,partNumber:e.part_number||"",category:ve(e.category_id),quantity:e.quantity,minQuantity:e.min_quantity,costPrice:e.cost_price,sellingPrice:e.selling_price,location:e.location||"",description:e.description||""})),t=[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).map(e=>`"${e}"`).join(","))].join("\n"),r=new Blob([t],{type:"text/csv"}),a=window.URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`spare-parts-export-${(new Date).toISOString().split("T")[0]}.csv`,s.click(),window.URL.revokeObjectURL(a),_.success(`Exported ${e.length} spare parts to CSV`)},xe=u.useMemo(()=>{const e=t.filter(e=>e.quantity<=e.min_quantity&&e.quantity>0),r=t.filter(e=>0===e.quantity);return{lowStock:e,outOfStock:r,reorderSuggestions:t.filter(e=>e.quantity<=e.min_quantity).map(e=>({...e,suggestedReorder:Math.max(2*e.min_quantity,10),urgency:0===e.quantity?"critical":e.quantity<=.5*e.min_quantity?"high":"medium"})),total:e.length+r.length}},[t]),be=u.useMemo(()=>{const e=t.filter(e=>{var t,r;const a=e.name.toLowerCase().includes(b.toLowerCase())||(null==(t=e.part_number)?void 0:t.toLowerCase().includes(b.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(b.toLowerCase())),s="all"===v||e.category_id===v;let n=!0;switch(N){case"in-stock":n=e.quantity>e.min_quantity;break;case"low-stock":n=e.quantity<=e.min_quantity&&e.quantity>0;break;case"out-of-stock":n=0===e.quantity}return a&&s&&n});return e.sort((e,t)=>{let r,a;switch(I){case"name":default:r=e.name,a=t.name;break;case"quantity":r=e.quantity,a=t.quantity;break;case"cost":r=e.cost_price,a=t.cost_price;break;case"selling":r=e.selling_price,a=t.selling_price}return"asc"===L?r>a?1:-1:r<a?1:-1}),e},[t,b,v,N,I,L]),pe=async e=>{try{const t=(e=>{const t=[];return e.name&&"string"==typeof e.name&&e.name.trim()||t.push("Part name is required"),e.name&&"string"==typeof e.name&&(e.name=e.name.trim().substring(0,255)),e.description&&"string"==typeof e.description&&(e.description=e.description.trim().substring(0,1e3)),void 0!==e.quantity&&("number"!=typeof e.quantity||e.quantity<0)&&t.push("Quantity must be a non-negative number"),void 0!==e.minQuantity&&("number"!=typeof e.minQuantity||e.minQuantity<0)&&t.push("Minimum quantity must be a non-negative number"),void 0!==e.costPrice&&("number"!=typeof e.costPrice||e.costPrice<0)&&t.push("Cost price must be a non-negative number"),void 0!==e.sellingPrice&&("number"!=typeof e.sellingPrice||e.sellingPrice<0)&&t.push("Selling price must be a non-negative number"),void 0!==e.quantity&&void 0!==e.minQuantity&&"number"==typeof e.quantity&&"number"==typeof e.minQuantity&&e.quantity<e.minQuantity&&t.push("Current quantity cannot be less than minimum quantity"),{isValid:0===t.length,errors:t}})(e);if(!t.isValid)return void _.error(`Validation failed: ${t.errors.join(", ")}`);const r=(e=>{const t={name:e.name,partNumber:e.partNumber,categoryId:e.categoryId,brand:e.brand,supplierId:e.supplierId,condition:e.condition,description:e.description,costPrice:e.costPrice,sellingPrice:e.sellingPrice,quantity:e.quantity,minQuantity:e.minQuantity,location:e.location,compatibleDevices:e.compatibleDevices};return e.storageRoomId&&(t.storageRoomId=e.storageRoomId),e.shelfId&&(t.shelfId=e.shelfId),Array.isArray(e.images)&&e.images.length>0&&(t.images=e.images),e.partType&&(t.partType=e.partType),e.primaryDeviceType&&(t.primaryDeviceType=e.primaryDeviceType),e.searchTags&&(t.searchTags=e.searchTags),void 0!==e.useVariants&&(t.useVariants=e.useVariants),Array.isArray(e.variants)&&e.variants.length>0&&(t.variants=e.variants),t})(e);if(X){const e=await g(X.id,r);e.ok?(_.success("Spare part updated successfully"),T(!1),O(!1),Y(null),await o()):_.error(e.message||"Failed to update spare part")}else{const e=await m(r);if(e.ok){switch(e.operationType){case"CREATE_NEW":_.success(" New spare part created successfully!");break;case"UPDATE_EXISTING":_.success(" Spare part updated instead of created. A part with this part number already existed and was updated.");break;default:_.success("Spare part saved successfully")}T(!1),await o()}else{const t=e.errorType,r=e.message||"Failed to create spare part";switch(t){case"DUPLICATE_PART_NUMBER":_.error(` Part number already exists! ${r.split(":")[1]||r}`);break;case"DUPLICATE_CONSTRAINT":_.error(` Duplicate data! ${r.split(":")[1]||r}`);break;case"FOREIGN_KEY_VIOLATION":_.error(` Invalid selection! ${r.split(":")[1]||r}`);break;case"CHECK_CONSTRAINT_VIOLATION":_.error(` Invalid data! ${r.split(":")[1]||r}`);break;case"DATABASE_ERROR":_.error(` Database error! ${r.split(":")[1]||r}`);break;default:_.error(r)}}}}catch(t){_.error("An unexpected error occurred while saving the spare part")}},fe=async e=>{if(window.confirm("Are you sure you want to delete this spare part?"))try{const t=await x(e);t.ok?(_.success("Spare part deleted successfully"),await o()):_.error(t.message||"Failed to delete spare part")}catch(t){_.error("An error occurred")}},ye=e=>{ie(e),W(!0)},ve=e=>{const t=r.find(t=>t.id===e);return(null==t?void 0:t.name)||"Unknown"},je=e=>0===e.quantity?{status:"out-of-stock",color:"text-red-500",bg:"bg-red-100"}:e.quantity<=e.min_quantity?{status:"low-stock",color:"text-yellow-500",bg:"bg-yellow-100"}:{status:"in-stock",color:"text-green-500",bg:"bg-green-100"};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(H,{className:"text-orange-600 w-8 h-8"}),"Spare Parts Inventory"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage inventory, track usage, and monitor stock levels"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>{Y(null),O(!0)},className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-orange-600 text-white hover:bg-orange-700 transition-colors text-sm",children:[e.jsx(w,{size:18}),"Add Part"]}),e.jsxs("button",{onClick:()=>{Y(null),T(!0)},className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors text-sm bg-white",children:[e.jsx(f,{size:18}),"Advanced"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Parts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:be.length})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"In Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.filter(e=>e.quantity>e.min_quantity).length})]})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg p-5 hover:bg-yellow-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-7 h-7 text-yellow-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Low Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:xe.lowStock.length})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-5 hover:bg-red-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-7 h-7 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Out of Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:xe.outOfStock.length})]})]})})]}),xe.total>0&&e.jsxs(s,{className:"mb-4 p-4 border-l-4 border-l-yellow-500",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(V,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-1",children:"Stock Alerts & Reorder Suggestions"}),e.jsxs("div",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsxs("p",{children:[" ",xe.outOfStock.length," parts out of stock (Critical)"]}),e.jsxs("p",{children:[" ",xe.lowStock.length," parts with low stock"]}),e.jsxs("p",{children:[" ",xe.reorderSuggestions.length," parts need reordering"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[xe.outOfStock.length>0&&e.jsxs(n,{size:"sm",onClick:()=>k("out-of-stock"),className:"bg-red-600 text-white hover:bg-red-700",children:["View Critical (",xe.outOfStock.length,")"]}),xe.lowStock.length>0&&e.jsxs(n,{size:"sm",onClick:()=>k("low-stock"),className:"bg-yellow-600 text-white hover:bg-yellow-700",children:["View Low Stock (",xe.lowStock.length,")"]}),xe.reorderSuggestions.length>0&&e.jsx(n,{size:"sm",onClick:ge,className:"bg-blue-600 text-white hover:bg-blue-700",children:"Export Reorder List"})]})]}),xe.reorderSuggestions.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-yellow-200",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Quick Reorder Suggestions:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:xe.reorderSuggestions.slice(0,6).map(t=>e.jsxs("div",{className:"p-2 rounded text-xs "+("critical"===t.urgency?"bg-red-100 text-red-800":"high"===t.urgency?"bg-orange-100 text-orange-800":"bg-yellow-100 text-yellow-800"),children:[e.jsx("div",{className:"font-medium truncate",children:t.name}),e.jsxs("div",{children:["Current: ",t.quantity," | Suggested: ",t.suggestedReorder]})]},t.id))}),xe.reorderSuggestions.length>6&&e.jsxs("p",{className:"text-xs text-yellow-600 mt-2",children:["+",xe.reorderSuggestions.length-6," more parts need attention"]})]})]}),E.length>0&&e.jsx(s,{className:"bg-orange-50 border-orange-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-orange-900",children:[E.length," part",1!==E.length?"s":""," selected"]}),e.jsx("button",{onClick:()=>q([]),className:"text-xs text-orange-600 hover:text-orange-800 underline",children:"Clear selection"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ge,className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-green-600 text-white hover:bg-green-700 transition-colors text-sm",children:[e.jsx(f,{className:"w-4 h-4"}),"Export CSV"]}),e.jsxs("button",{onClick:async()=>{if(0===E.length)return;if(window.confirm(`Are you sure you want to delete ${E.length} spare parts?`))try{const e=E.map(e=>x(e));await Promise.all(e),_.success(`Successfully deleted ${E.length} spare parts`),q([])}catch(e){_.error("Failed to delete some spare parts")}},className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-red-600 text-white hover:bg-red-700 transition-colors text-sm",children:[e.jsx(p,{className:"w-4 h-4"}),"Delete"]})]})]})}),e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search parts, numbers, or descriptions...",value:b,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-gray-900"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("select",{value:v,onChange:e=>j(e.target.value),className:"px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-gray-900 bg-white",children:[e.jsx("option",{value:"all",children:"All Categories"}),r.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:N,onChange:e=>k(e.target.value),className:"px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-gray-900 bg-white",children:[e.jsx("option",{value:"all",children:"All Stock"}),e.jsx("option",{value:"in-stock",children:"In Stock"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"out-of-stock",children:"Out of Stock"})]}),e.jsxs("select",{value:I,onChange:e=>U(e.target.value),className:"px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-gray-900 bg-white",children:[e.jsx("option",{value:"name",children:"Sort: Name"}),e.jsx("option",{value:"quantity",children:"Sort: Quantity"}),e.jsx("option",{value:"cost",children:"Sort: Cost"}),e.jsx("option",{value:"selling",children:"Sort: Price"})]}),e.jsxs("button",{onClick:async()=>{await o(),_.success("Data refreshed successfully")},disabled:i,className:"flex items-center gap-2 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 bg-white",children:[e.jsx(Z,{className:"w-4 h-4 "+(i?"animate-spin":"")}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs("div",{className:"flex gap-1 border border-gray-300 rounded-lg p-1 bg-white",children:[e.jsx("button",{onClick:()=>C("grid"),className:"p-2 rounded transition-colors "+("grid"===A?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"),title:"Grid View",children:e.jsx(ee,{className:"w-4 h-4"})}),!D&&e.jsx("button",{onClick:()=>C("list"),className:"p-2 rounded transition-colors "+("list"===A?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"),title:"Table View",children:e.jsx(te,{className:"w-4 h-4"})})]})]})]})}),l&&e.jsx(s,{className:"bg-red-50 border-red-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:l})]})]})}),i||ce?e.jsx(s,{className:"p-12",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Z,{className:"w-8 h-8 animate-spin text-orange-500"}),e.jsx("span",{className:"ml-4 text-gray-700 font-medium",children:"Loading spare parts..."})]})}):0===be.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(f,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No spare parts found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:b||"all"!==v||"all"!==N?"Try adjusting your search or filters":"Get started by adding your first spare part"}),!b&&"all"===v&&"all"===N&&e.jsxs("button",{onClick:()=>{Y(null),T(!0)},className:"inline-flex items-center gap-2 px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Spare Part"})]})]}):"grid"===A?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(280px, 100%), 1fr))",gap:"clamp(1rem, 2vw, 1.5rem)",gridAutoRows:"1fr"},children:be.map(t=>{const r=je(t),a=E.includes(t.id);return e.jsxs(s,{className:"overflow-hidden hover:shadow-lg transition-all "+(a?"ring-2 ring-orange-500 bg-orange-50":""),children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full h-40 bg-gray-100 flex items-center justify-center cursor-pointer",onClick:()=>ye(t),children:t.images&&t.images.length>0?e.jsx(he,{src:t.images[0],alt:t.name,className:"w-full h-full object-cover"}):e.jsx(f,{className:"w-16 h-16 text-gray-400"})}),e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-semibold ${r.bg} ${r.color} shadow-sm`,children:r.status.replace("-"," ")}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("input",{type:"checkbox",checked:a,onChange:()=>ue(t.id),className:"h-5 w-5 text-orange-600 focus:ring-orange-500 border-gray-300 rounded shadow-sm"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-bold text-gray-900 truncate text-base",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.part_number})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:ve(t.category_id)})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Quantity"}),e.jsxs("p",{className:"text-sm font-bold "+(t.quantity<=t.min_quantity?"text-red-600":"text-green-600"),children:[t.quantity,"/",t.min_quantity]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Cost"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:me.currency(t.cost_price)})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Price"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:me.currency(t.selling_price)})]})]}),t.location&&e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Location: ",e.jsx("span",{className:"font-medium text-gray-900",children:t.location})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>ye(t),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm font-medium",children:[e.jsx(re,{className:"w-4 h-4"}),"View"]}),e.jsx("button",{onClick:()=>{se(t),Q(!0)},disabled:0===t.quantity,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Use Part",children:e.jsx(B,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>{Y(t),T(!0)},className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Edit Part",children:e.jsx(J,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>fe(t.id),className:"p-2 border border-red-300 rounded-lg hover:bg-red-50 transition-colors",title:"Delete Part",children:e.jsx(p,{className:"w-4 h-4 text-red-600"})})]})]})]},t.id)})}):e.jsxs(s,{className:"overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-3",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center text-xs font-semibold text-gray-700 uppercase",children:[e.jsxs("div",{className:"col-span-1 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E.length===be.length&&be.length>0,onChange:()=>{E.length===be.length?q([]):q(be.map(e=>e.id))},className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),e.jsx("span",{children:"Image"})]}),e.jsx("div",{className:"col-span-2",children:"Part Details"}),e.jsx("div",{className:"col-span-2",children:"Category"}),e.jsx("div",{className:"col-span-1 text-center",children:"Quantity"}),e.jsx("div",{className:"col-span-1",children:"Pricing"}),e.jsx("div",{className:"col-span-2",children:"Location"}),e.jsx("div",{className:"col-span-1 text-center",children:"Status"}),e.jsx("div",{className:"col-span-2 text-center",children:"Actions"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:be.map(t=>{const r=je(t),a=E.includes(t.id);return e.jsx("div",{className:"hover:bg-gray-50 transition-colors "+(a?"bg-orange-50":""),children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center px-6 py-4",children:[e.jsxs("div",{className:"col-span-1 flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:()=>ue(t.id),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center cursor-pointer",onClick:()=>ye(t),children:t.images&&t.images.length>0?e.jsx(he,{src:t.images[0],alt:t.name,className:"w-full h-full object-cover"}):e.jsx(f,{className:"w-6 h-6 text-gray-400"})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"font-bold text-gray-900",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.part_number}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 truncate mt-1",children:t.description})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(f,{className:"w-4 h-4 text-purple-600"})}),e.jsx("span",{className:"font-medium text-gray-900",children:ve(t.category_id)})]})}),e.jsxs("div",{className:"col-span-1 text-center",children:[e.jsx("div",{className:"text-2xl font-bold "+(t.quantity<=t.min_quantity?"text-red-600":"text-green-600"),children:t.quantity}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Min: ",t.min_quantity]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:me.currency(t.cost_price)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Sell: ",me.currency(t.selling_price)]})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.location||"Not set"})}),e.jsx("div",{className:"col-span-1 flex justify-center",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold ${r.bg} ${r.color}`,children:r.status.replace("-"," ")})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>ye(t),className:"p-2 text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors",title:"View Details",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{se(t),Q(!0)},disabled:0===t.quantity,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Use Part",children:e.jsx(B,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>{Y(t),T(!0)},className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Edit Part",children:e.jsx(J,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>fe(t.id),className:"p-2 border border-red-300 rounded-lg hover:bg-red-50 transition-colors",title:"Delete Part",children:e.jsx(p,{className:"w-4 h-4 text-red-600"})})]})})]})},t.id)})})]}),M&&e.jsx(st,{sparePart:X,onSave:pe,onCancel:()=>{T(!1),Y(null)}}),$&&e.jsx(nt,{sparePart:X,onSave:pe,onCancel:()=>{O(!1),Y(null)}}),z&&ae&&e.jsx(it,{sparePart:ae,onUse:async(e,t,r)=>{if(ae)try{const a=await h(ae.id,e,t,r);a.ok?(_.success("Spare part usage recorded successfully"),Q(!1),se(null),await o()):_.error(a.message||"Failed to record spare part usage")}catch(a){_.error("An unexpected error occurred while recording usage")}},onCancel:()=>{Q(!1),se(null)}}),G&&ne&&e.jsx(lt,{isOpen:G,onClose:()=>{W(!1),ie(null)},sparePart:ne,currency:{code:"TZS",name:"Tanzanian Shilling",symbol:"TZS",flag:""},onEdit:e=>{Y(e),W(!1),T(!0)},onDelete:async e=>{await fe(e),W(!1),ie(null)},onUse:async(e,t,r)=>{if(ne)try{const a=await h(ne.id,e,t,r);a.ok?(_.success("Spare part usage recorded successfully"),await o()):_.error(a.message||"Failed to record spare part usage")}catch(a){_.error("An unexpected error occurred while recording usage")}}})]})};export{ot as default};
