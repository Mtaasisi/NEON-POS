import{j as e,s,G as t,c as a,u as r,d as l,h as i,i as n,k as d,b as c,a as o,r as m,l as x}from"./index-222cfb29.js";import{r as u,b as p}from"./vendor-a2ff445a.js";import{S as g}from"./SearchBar-2b6f451f.js";import{G as h}from"./GlassSelect-3b56e5f5.js";import{B as b}from"./BackButton-e41d1482.js";import{t as j}from"./toastUtils-fdf4803f.js";import{_ as f}from"./supabase-7e851d02.js";import{x as y,X as v,N,n as w,y as k,O as C,Q as S,d as _,V as D,U as P,f as A,Y as $,_ as T,r as R,$ as q,A as L,a0 as M,h as E,a1 as I,a2 as F,m as z,I as U,a3 as H,e as O,u as B,a4 as K,a5 as W,a6 as V,a7 as Q,a8 as Y,a9 as Z,aa as G,ab as J,a as X,b as ee,ac as se,ad as te,ae,af as re,q as le}from"./ui-551a39a6.js";import{u as ie,S as ne}from"./useSuccessModal-e8b7d685.js";import{S as de}from"./SuccessModalIcons-20b743c5.js";import{G as ce}from"./GlassInput-ba5c3c0d.js";import{P as oe}from"./PaymentsPopupModal-70ab4c91.js";import{C as me}from"./CustomerDetailModal-9e075bf1.js";import{a as xe}from"./routing-a2f0f6d2.js";import{C as ue}from"./CBMCalculatorModal-f5dbe117.js";import"./utils-fb833cf6.js";import"./charts-66cc82bb.js";import"./useBodyScrollLock-0216d39f.js";import"./appointments-4d8aac45.js";import"./Modal-ccfa5014.js";import"./CustomerForm-05944812.js";import"./returns-0428af68.js";import"./whatsappService-37f3bd6b.js";import"./AppointmentModal-4524caae.js";import"./format-0f0b2647.js";import"./index-0096d614.js";import"./pdf-33d2fdad.js";const pe=({status:s,className:t="",isUpdating:a=!1})=>{const{bg:r,text:l,label:i}=(e=>{switch(e){case"assigned":return{bg:"bg-gradient-to-r from-amber-500/80 to-orange-500/80",text:"text-white",label:"Assigned"};case"diagnosis-started":return{bg:"bg-gradient-to-r from-blue-500/80 to-blue-600/80",text:"text-white",label:"Diagnosis"};case"awaiting-parts":return{bg:"bg-gradient-to-r from-amber-600/80 to-orange-700/80",text:"text-white",label:"Awaiting Parts"};case"parts-arrived":return{bg:"bg-gradient-to-r from-green-500/80 to-emerald-500/80",text:"text-white",label:"Parts Arrived"};case"in-repair":return{bg:"bg-gradient-to-r from-purple-500/80 to-indigo-500/80",text:"text-white",label:"Repairing"};case"reassembled-testing":return{bg:"bg-gradient-to-r from-cyan-500/80 to-blue-400/80",text:"text-white",label:"Testing"};case"repair-complete":return{bg:"bg-gradient-to-r from-emerald-500/80 to-green-500/80",text:"text-white",label:"Complete"};case"returned-to-customer-care":return{bg:"bg-gradient-to-r from-teal-500/80 to-cyan-500/80",text:"text-white",label:"Back to CC"};case"done":return{bg:"bg-gradient-to-r from-gray-500/80 to-gray-700/80",text:"text-white",label:"Done"};case"failed":return{bg:"bg-gradient-to-r from-red-500/80 to-pink-500/80",text:"text-white",label:"Failed"};default:return{bg:"bg-gradient-to-r from-gray-200/80 to-gray-300/80",text:"text-gray-800",label:e}}})(s);return e.jsxs("span",{className:`\n      ${r} ${l} px-3 py-1 rounded-full text-sm font-medium\n      backdrop-blur-xl inline-flex items-center gap-1\n      border border-white/20 shadow-sm\n      transform transition-all duration-300\n      hover:border-white/40 hover:shadow-lg\n      whitespace-nowrap\n      max-w-[120px] overflow-hidden text-ellipsis\n      flex-shrink-0\n      ${a?"animate-pulse":""}\n      ${t}\n    `,children:[i,a&&e.jsx("span",{className:"ml-1",children:"â³"})]})},ge=async(e,t)=>{try{const a=await(async e=>{try{const{data:t,error:a}=await s.from("devices").select("repair_cost").eq("id",e).single(),{data:r,error:l}=await s.from("repair_parts").select("total_cost, status").eq("device_id",e),i=(null==r?void 0:r.filter(e=>["needed","received","used"].includes(e.status)).reduce((e,s)=>e+(s.total_cost||0),0))||0,{data:n,error:d}=await s.from("customer_payments").select("id, amount, status, payment_type, method, payment_date").eq("device_id",e).order("payment_date",{ascending:!1}),c=(null==n?void 0:n.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.amount,0))||0,o=(null==n?void 0:n.filter(e=>"pending"===e.status).reduce((e,s)=>e+s.amount,0))||0;return{repairCost:(null==t?void 0:t.repair_cost)||0,sparePartsCost:i,totalPaid:c,totalPending:o,payments:n||[]}}catch(t){return{repairCost:0,sparePartsCost:0,totalPaid:0,totalPending:0,payments:[]}}})(e),r=[];if(a.repairCost>0){a.payments.some(e=>"payment"===e.payment_type&&"pending"===e.status)||r.push({customer_id:t,device_id:e,amount:a.repairCost,method:"cash",payment_type:"payment",status:"pending",payment_date:(new Date).toISOString(),notes:"Repair cost payment"})}if(a.sparePartsCost>0){a.payments.some(e=>{var s;return"payment"===e.payment_type&&(null==(s=e.notes)?void 0:s.includes("spare parts"))})||r.push({customer_id:t,device_id:e,amount:a.sparePartsCost,method:"cash",payment_type:"payment",status:"pending",payment_date:(new Date).toISOString(),notes:"Spare parts cost payment"})}if(r.length>0){const{error:e}=await s.from("customer_payments").insert(r);if(e)return!1}return!0}catch(a){return!1}},he=({isOpen:s,onClose:a,onSave:r,editingPart:l})=>{const i=ie(),[n,d]=u.useState({name:(null==l?void 0:l.name)||"",description:(null==l?void 0:l.description)||"",quantity:(null==l?void 0:l.quantity)||1,cost:(null==l?void 0:l.cost)||0,status:(null==l?void 0:l.status)||"ordered",supplier:(null==l?void 0:l.supplier)||"",estimatedArrival:(null==l?void 0:l.estimatedArrival)||"",notes:(null==l?void 0:l.notes)||""}),[c,o]=u.useState({}),m=e=>{if(e.preventDefault(),!(()=>{const e={};return n.name.trim()||(e.name="Part name is required"),n.description.trim()||(e.description="Description is required"),n.quantity<=0&&(e.quantity="Quantity must be greater than 0"),n.cost<=0&&(e.cost="Cost must be greater than 0"),n.supplier.trim()||(e.supplier="Supplier is required"),o(e),0===Object.keys(e).length})())return void w.error("Please fix the errors before saving");const s={id:(null==l?void 0:l.id)||`part_${Date.now()}`,...n};r(s),i.show(l?`${n.name} has been updated successfully!`:`${n.name} has been added to repair parts!`,{title:l?"Part Updated! âœ…":"Part Added! âœ…",icon:de.repairCompleted,autoCloseDelay:3e3}),a()},x=(e,s)=>{d(t=>({...t,[e]:s})),c[e]&&o(s=>({...s,[e]:""}))};return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:l?"Edit Part":"Add New Part"}),e.jsx("p",{className:"text-sm text-gray-600",children:l?"Update part information":"Add a new part to the repair order"})]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(v,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Part Name *"}),e.jsx("input",{type:"text",value:n.name,onChange:e=>x("name",e.target.value),className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(c.name?"border-red-300":"border-gray-300"),placeholder:"e.g., Screen Assembly"}),c.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier *"}),e.jsx("input",{type:"text",value:n.supplier,onChange:e=>x("supplier",e.target.value),className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(c.supplier?"border-red-300":"border-gray-300"),placeholder:"e.g., TechParts Ltd"}),c.supplier&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.supplier})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{value:n.description,onChange:e=>x("description",e.target.value),className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none "+(c.description?"border-red-300":"border-gray-300"),rows:3,placeholder:"Detailed description of the part..."}),c.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),e.jsx("input",{type:"number",min:"1",value:n.quantity,onChange:e=>x("quantity",parseInt(e.target.value)||1),className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(c.quantity?"border-red-300":"border-gray-300")}),c.quantity&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.quantity})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost (TSH) *"}),e.jsx("input",{type:"number",min:"0",step:"100",value:n.cost,onChange:e=>x("cost",parseInt(e.target.value)||0),className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(c.cost?"border-red-300":"border-gray-300"),placeholder:"0"}),c.cost&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.cost})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:n.status,onChange:e=>x("status",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ordered",children:"Ordered"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"received",children:"Received"}),e.jsx("option",{value:"installed",children:"Installed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Arrival"}),e.jsx("input",{type:"date",value:n.estimatedArrival,onChange:e=>x("estimatedArrival",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:n.notes,onChange:e=>x("notes",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,placeholder:"Additional notes about this part..."})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Cost:"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[(n.cost*n.quantity).toLocaleString()," TSH"]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200",children:[e.jsx(t,{variant:"outline",onClick:a,size:"md",children:"Cancel"}),e.jsx(t,{variant:"primary",onClick:m,size:"md",icon:e.jsx(N,{className:"w-4 h-4"}),children:l?"Update Part":"Add Part"})]})]}),e.jsx(ne,{...i.props})]}):null},be=({device:s,onPartsSelected:i,onClose:n,isOpen:d})=>{const{spareParts:c,categories:o,isLoading:m,loadSpareParts:x,loadCategories:p}=a(),[g,b]=u.useState(""),[j,f]=u.useState("all"),[N,P]=u.useState([]),[A,$]=u.useState(!1),{currentUser:T}=r(),R="admin"===(null==T?void 0:T.role),q=c.filter(e=>{var s;const t=e.name.toLowerCase().includes(g.toLowerCase())||e.part_number.toLowerCase().includes(g.toLowerCase())||(null==(s=e.brand)?void 0:s.toLowerCase().includes(g.toLowerCase())),a="all"===j||e.category_id===j,r=e.quantity>0,l=e.is_active;return t&&a&&r&&l});u.useEffect(()=>{d&&(x(),p())},[d,x,p]),u.useEffect(()=>{},[c,m,q,g,j,d]);const L=(e,s)=>{const t=c.find(s=>s.id===e);if(!t)return;if(s>t.quantity)return void w.error(`Cannot select ${s}. Only ${t.quantity} available in stock.`);if(s<1)return void w.error("Quantity must be at least 1.");const a=Math.max(1,Math.min(s,t.quantity));P(s=>s.map(s=>s.spare_part_id===e?{...s,quantity:a,total_cost:a*s.cost_per_unit}:s))},M=N.reduce((e,s)=>e+s.total_cost,0),E=N.reduce((e,s)=>e+s.quantity,0);return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[85vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Select Parts"}),e.jsxs("p",{className:"text-blue-100 text-sm",children:[s.brand," ",s.model]})]})]}),e.jsx("button",{onClick:n,className:"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center hover:bg-opacity-30 transition-colors",children:e.jsx(v,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[calc(85vh-100px)]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Search Parts"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 w-3 h-3"}),e.jsx(ce,{value:g,onChange:e=>b(e.target.value),placeholder:"Search by name, part number, or brand...",className:"pl-8 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs(h,{value:j,onChange:e=>f(e.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),N.length>0&&e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Selected Parts (",N.length,")"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",E," parts",R&&` â€¢ ${M.toLocaleString()} TZS`]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>$(!A),children:[A?"Hide":"Show"," Details"]})]})]}),A&&e.jsx("div",{className:"space-y-3",children:N.map(s=>{const t=c.find(e=>e.id===s.spare_part_id);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.part_number," â€¢ ",s.cost_per_unit.toLocaleString()," TZS each"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(s.spare_part_id,s.quantity-1),className:"w-8 h-8 bg-gray-200 rounded-lg flex items-center justify-center hover:bg-gray-300",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-12 text-center font-medium",children:s.quantity}),e.jsx("button",{onClick:()=>L(s.spare_part_id,s.quantity+1),className:"w-8 h-8 bg-gray-200 rounded-lg flex items-center justify-center hover:bg-gray-300",disabled:t&&s.quantity>=t.quantity,children:e.jsx(S,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[s.total_cost.toLocaleString()," TZS"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Max: ",(null==t?void 0:t.quantity)||0]})]}),e.jsx("button",{onClick:()=>{return e=s.spare_part_id,P(s=>s.filter(s=>s.spare_part_id!==e)),void w.success("Part removed from selection");var e},className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center hover:bg-red-200 text-red-600",children:e.jsx(v,{className:"w-4 h-4"})})]})]},s.spare_part_id)})})]}),m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading spare parts..."})]}):0===q.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No spare parts found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search criteria or check if parts are in stock"}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:[e.jsxs("p",{children:["Total spare parts in database: ",c.length]}),e.jsxs("p",{children:["Filtered results: ",q.length]})]})]}):e.jsx(e.Fragment,{children:0===q.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No spare parts found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search criteria or check if parts are in stock"}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:[e.jsxs("p",{children:["Total spare parts in database: ",c.length]}),e.jsxs("p",{children:["Filtered results: ",q.length]})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(s=>{var a;const r=N.some(e=>e.spare_part_id===s.id),i=(null==(a=N.find(e=>e.spare_part_id===s.id))?void 0:a.quantity)||0;return e.jsxs(l,{className:"p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["#",s.part_number]}),s.brand&&e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Brand: ",s.brand]})]}),r&&e.jsx("div",{className:"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(_,{className:"w-4 h-4 text-green-600"})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Price:"}),e.jsxs("span",{className:"font-medium",children:[s.selling_price.toLocaleString()," TZS"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Stock:"}),e.jsxs("span",{className:"font-medium "+(s.quantity>10?"text-green-600":s.quantity>0?"text-yellow-600":"text-red-600"),children:[s.quantity," available"]})]}),i>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Selected:"}),e.jsx("span",{className:"font-medium text-blue-600",children:i})]})]}),e.jsx(t,{onClick:()=>(e=>{if(e.quantity<=0)return void w.error(`${e.name} is out of stock.`);const s=N.find(s=>s.spare_part_id===e.id);if(s){if(s.quantity+1>e.quantity)return void w.error(`Cannot add more. Only ${e.quantity} available in stock.`);P(s=>s.map(s=>s.spare_part_id===e.id?{...s,quantity:Math.min(s.quantity+1,e.quantity),total_cost:Math.min(s.quantity+1,e.quantity)*s.cost_per_unit}:s))}else{const s={spare_part_id:e.id,name:e.name,part_number:e.part_number,quantity:1,cost_per_unit:e.selling_price,total_cost:e.selling_price,notes:""};P(e=>[...e,s])}w.success("Part added to selection")})(s),disabled:0===s.quantity,className:"w-full",variant:r?"outline":"primary",children:r?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add More"]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Add to Selection"]})})]},s.id)})})})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:N.length>0&&e.jsxs(e.Fragment,{children:[N.length," parts selected",R&&` â€¢ ${M.toLocaleString()} TZS`]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(t,{variant:"outline",onClick:n,children:"Cancel"}),e.jsxs(t,{onClick:()=>{0!==N.length?(i(N),n()):w.error("Please select at least one part")},disabled:0===N.length,children:["Confirm Selection (",N.length,")"]})]})]})]})}):null};function je(e,s,t){if(!e||0===e.length)return{valid:!0,message:"No parts required for this repair"};if(["diagnosis-started -> in-repair","awaiting-parts -> in-repair","parts-arrived -> in-repair","in-repair -> reassembled-testing","reassembled-testing -> repair-complete"].includes(`${s} -> ${t}`)){if(!e.every(e=>"accepted"===e.status||"received"===e.status||"used"===e.status)){const s=e.filter(e=>"accepted"!==e.status&&"received"!==e.status&&"used"!==e.status),t=[...new Set(s.map(e=>e.status))];return{valid:!1,message:`Cannot continue repair: ${s.length} part(s) still pending (${t.join(", ")}). All parts must be accepted before continuing.`}}}return{valid:!0,message:"Repair can continue"}}function fe(e,s){if(!e||0===e.length)return{shouldProgress:!1,nextStatus:null,message:"No parts to monitor"};if(!e.every(e=>"received"===e.status||"used"===e.status))return{shouldProgress:!1,nextStatus:null,message:"Not all parts are ready yet"};const t={"diagnosis-started":"in-repair","awaiting-parts":"parts-arrived","parts-arrived":"in-repair"}[s];return t?{shouldProgress:!0,nextStatus:t,message:`All parts received! Auto-progressing from ${s} to ${t}`}:{shouldProgress:!1,nextStatus:null,message:"No auto-progression rule for current status"}}const ye=({device:a,currentUser:r,onStatusUpdate:c,onPartsUpdate:o})=>{const[m,x]=u.useState(null),[p,g]=u.useState(!1),[h,b]=u.useState(0),[j,N]=u.useState([]),[k,C]=u.useState([]),[D,z]=u.useState(!1),[U,H]=u.useState(!1),[O,B]=u.useState(""),[K,W]=u.useState(!1),[V,Q]=u.useState([]),[Y,Z]=u.useState(!1),[G,J]=u.useState(!1),[X,ee]=u.useState(""),[se,te]=u.useState(!1),[ae,re]=u.useState(null),[le,ie]=u.useState(!1),[ne,de]=u.useState(!1),ce=async(e,s)=>{await c(a.id,e,s)},me=async e=>{if(O.trim()){W(!0);try{const{default:t}=await f(()=>import("./index-222cfb29.js").then(e=>e.aU),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{data:r,error:l}=await s.from("customers").select("phone").eq("id",a.customerId).single();if(l||!(null==r?void 0:r.phone))return void w.error("Customer phone number not found");if("sms"===e){const e=await t.sendSMS(r.phone,O);e.success?w.success("SMS sent successfully"):w.error(`SMS failed: ${e.error}`)}else{const e=await t.sendSMS(r.phone,O);e.success?w.success("WhatsApp message sent successfully"):w.error(`WhatsApp failed: ${e.error}`)}H(!1),B("")}catch(t){w.error("Failed to send message")}finally{W(!1)}}else w.error("Please enter a message")},xe=()=>{const e=j.filter(e=>"needed"===e.status||"ordered"===e.status);V.length===e.length?Q([]):Q(e.map(e=>e.id))},ue=async()=>{if("done"!==a.status&&"failed"!==a.status)if(0!==V.length){Z(!0);try{const{acceptSpareParts:e}=await f(()=>import("./index-222cfb29.js").then(e=>e.aS),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=await e(V);if(s.ok&&s.data){const e=j.map(e=>V.includes(e.id)?{...e,status:"accepted"}:e);if(N(e),w.success(s.message),Q([]),a&&a.id){const{areAllSparePartsReady:e}=await f(()=>import("./index-222cfb29.js").then(e=>e.aS),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=await e(a.id);s.ready?(await ce("parts-arrived"),w.success('âœ… All parts accepted! Device status updated to "Parts Arrived". You can now start repair work.')):w.success(`âœ… Parts accepted! ${s.message}. Continue accepting remaining parts to start repair work.`)}}else w.error(`âŒ Failed to accept parts: ${s.message||"Please try again or contact support if the issue persists."}`)}catch(e){w.error("âŒ Failed to accept parts. Please try again or contact support if the issue persists.")}finally{Z(!1)}}else w.error("âš ï¸ Please select parts from the list below to accept them. Click on the checkboxes next to the parts you want to accept.");else w.error("ðŸš« Cannot accept parts for finished devices. This device is already completed.")};u.useEffect(()=>{(null==a?void 0:a.id)&&pe()},[null==a?void 0:a.id]),u.useEffect(()=>{const e=setInterval(()=>{["diagnosis-started","awaiting-parts","parts-arrived"].includes(a.status)&&j.length>0&&(async()=>{if(j.length>0){const s=fe(j,a.status);if(s.shouldProgress&&s.nextStatus)try{w.success(`ðŸš€ ${s.message}`,{duration:4e3,icon:"ðŸ”„"}),await ce(s.nextStatus),w.success(`âœ… Repair progressed to: ${s.nextStatus.replace("-"," ")}`,{duration:5e3,icon:"ðŸŽ‰"})}catch(e){w.error("Failed to auto-progress repair status. Please try again.")}}})()},3e4);return()=>clearInterval(e)},[a.status,j]),u.useEffect(()=>{if(j.length>0){const e=fe(j,a.status);if(e.shouldProgress&&e.nextStatus){j.every(e=>"received"===e.status||"used"===e.status)&&setTimeout(async()=>{try{w.success(`ðŸš€ ${e.message}`,{duration:4e3,icon:"ðŸ”„"}),await ce(e.nextStatus),w.success(`âœ… Repair auto-progressed to: ${e.nextStatus.replace("-"," ")}`,{duration:5e3,icon:"ðŸŽ‰"})}catch(s){w.error("Failed to auto-progress repair status. Please update manually.")}},1500)}}},[a.status,j]);const pe=async()=>{if(null==a?void 0:a.id){z(!0);try{const e=await i(a.id);if(e.ok&&e.data){const s=e.data.map(e=>{var s,t,a,r;return{id:e.id,name:(null==(s=e.spare_part)?void 0:s.name)||"Unknown Part",description:(null==(t=e.spare_part)?void 0:t.description)||"",quantity:e.quantity_needed||0,cost:e.cost_per_unit||0,status:e.status||"needed",supplier:(null==(r=null==(a=e.spare_part)?void 0:a.supplier)?void 0:r.name)||"Unknown",estimatedArrival:e.estimated_arrival||null,notes:e.notes||""}});if(C(j),N(s),j.length>0&&function(e,s){if(!e||!s)return!1;if(e.length!==s.length)return!0;for(let t=0;t<s.length;t++){const a=e[t],r=s[t];if(a&&r&&a.status!==r.status&&("received"===r.status||"used"===r.status))return!0}return!1}(j,s)){const e=fe(s,a.status);e.shouldProgress&&e.nextStatus&&(w.success(`ðŸš€ ${e.message}`,{duration:4e3,icon:"ðŸ”„"}),setTimeout(async()=>{try{await ce(e.nextStatus),w.success(`âœ… Repair automatically progressed to: ${e.nextStatus.replace("-"," ")}`,{duration:5e3,icon:"ðŸŽ‰"})}catch(s){w.error("Failed to auto-progress repair status. Please update manually.")}},2e3))}}else N([])}catch(e){N([])}finally{z(!1)}}},ge=e=>{switch(e){case"ordered":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"shipped":return"bg-blue-100 text-blue-800 border-blue-200";case"received":return"bg-green-100 text-green-800 border-green-200";case"installed":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ye=s=>{switch(s){case"ordered":return e.jsx(A,{className:"w-4 h-4"});case"shipped":return e.jsx($,{className:"w-4 h-4"});case"received":return e.jsx(y,{className:"w-4 h-4"});case"installed":return e.jsx(_,{className:"w-4 h-4"});default:return e.jsx(L,{className:"w-4 h-4"})}},ve=async()=>{try{await c(a.id,"in-repair","Parts received, starting repair work")}catch(e){w.error("Failed to update repair status")}},Ne=(e,s)=>{if("done"===a.status||"failed"===a.status)return void w.error("ðŸš« Cannot update part status for finished devices. This device is already completed.");const t=j.map(t=>t.id===e?{...t,status:s}:t);N(t),null==o||o(t),w.success(`Part status updated to ${s}`)},we=e=>{if("done"===a.status||"failed"===a.status)return w.error("ðŸš« Cannot add parts for finished devices. This device is already completed."),void te(!1);N(s=>[...s,e]),null==o||o([...j,e]),te(!1)},ke=e=>{if("done"===a.status||"failed"===a.status)return w.error("ðŸš« Cannot edit parts for finished devices. This device is already completed."),void re(null);const s=j.map(s=>s.id===e.id?e:s);N(s),null==o||o(s),re(null)},Ce=e=>{if("done"===a.status||"failed"===a.status)return void w.error("ðŸš« Cannot delete parts for finished devices. This device is already completed.");const s=j.filter(s=>s.id!==e);N(s),null==o||o(s),w.success("Part removed successfully")},Se=()=>j.reduce((e,s)=>e+s.cost*s.quantity,0),_e=()=>{const e=j.length,s=j.filter(e=>"received"===e.status||"installed"===e.status).length;return e>0?Math.round(s/e*100):0};if("awaiting-parts"===a.status)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-orange-900",children:"Awaiting Parts"}),e.jsx("p",{className:"text-orange-700",children:"Waiting for replacement parts to arrive"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[_e(),"%"]}),e.jsx("div",{className:"text-sm text-orange-600",children:"Parts Ready"})]})]}),e.jsx("div",{className:"w-full bg-orange-200 rounded-full h-3 mb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-amber-500 h-3 rounded-full transition-all duration-500",style:{width:`${_e()}%`}})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-orange-600 mb-1",children:"Total Parts"}),e.jsx("div",{className:"text-lg font-bold text-orange-900",children:j.length})]}),e.jsxs("div",{className:"bg-white/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-orange-600 mb-1",children:"Received"}),e.jsx("div",{className:"text-lg font-bold text-orange-900",children:j.filter(e=>"received"===e.status||"installed"===e.status).length})]}),e.jsxs("div",{className:"bg-white/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-orange-600 mb-1",children:"Total Cost"}),e.jsxs("div",{className:"text-lg font-bold text-orange-900",children:[Se().toLocaleString()," TSH"]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.map(s=>e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Qty: ",s.quantity]}),e.jsxs("span",{children:["Cost: ",s.cost.toLocaleString()," TSH"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${ge(s.status)}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[ye(s.status),s.status]})})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:["Supplier: ",s.supplier]})]}),s.estimatedArrival&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:["ETA: ",s.estimatedArrival]})]}),s.notes&&e.jsx("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:s.notes})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:["ordered"===s.status&&e.jsxs(t,{variant:"primary",size:"sm",onClick:()=>Ne(s.id,"shipped"),children:[e.jsx($,{className:"w-4 h-4"}),"Mark Shipped"]}),"shipped"===s.status&&e.jsxs(t,{variant:"success",size:"sm",onClick:()=>Ne(s.id,"received"),children:[e.jsx(y,{className:"w-4 h-4"}),"Mark Received"]}),"received"===s.status&&e.jsxs(t,{variant:"secondary",size:"sm",onClick:()=>Ne(s.id,"installed"),children:[e.jsx(T,{className:"w-4 h-4"}),"Mark Installed"]}),e.jsxs("div",{className:"flex gap-1 ml-auto",children:[e.jsx("button",{onClick:()=>{"done"!==a.status&&"failed"!==a.status?re(s):w.error("ðŸš« Cannot edit parts for finished devices. This device is already completed.")},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit part",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ce(s.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete part",children:e.jsx(q,{className:"w-4 h-4"})})]})]})]},s.id))}),j.some(e=>"received"===e.status)&&j.every(e=>"received"===e.status||"installed"===e.status)&&e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-green-900",children:"Ready to Start Repair"}),e.jsx("p",{className:"text-green-700",children:"All required parts have been received"})]})]}),e.jsxs(t,{variant:"success",size:"lg",onClick:ve,className:"px-6 py-3",children:[e.jsx(T,{className:"w-5 h-5"}),"Start Repair"]})]})}),e.jsxs("div",{className:"flex justify-center gap-4",children:["done"!==a.status&&"failed"!==a.status&&e.jsxs(t,{variant:"outline",onClick:()=>te(!0),className:"px-6 py-3",children:[e.jsx(S,{className:"w-5 h-5"}),"Add Part"]}),e.jsxs(t,{variant:"primary",onClick:()=>ie(!0),className:"px-6 py-3",children:[e.jsx(y,{className:"w-5 h-5"}),"Manage Spare Parts"]})]}),e.jsx(he,{isOpen:se,onClose:()=>te(!1),onSave:we}),e.jsx(he,{isOpen:!!ae,onClose:()=>re(null),onSave:ke,editingPart:ae}),le&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-purple-600"}),"Manage Spare Parts"]}),e.jsx("button",{onClick:()=>ie(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(v,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"space-y-4",children:["done"!==a.status&&"failed"!==a.status&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(t,{variant:"primary",onClick:()=>te(!0),className:"px-4 py-2",children:[e.jsx(S,{className:"w-4 h-4"}),"Add New Part"]})}),j.length>0?e.jsx("div",{className:"space-y-3",children:j.map(s=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium "+("ordered"===s.status?"bg-blue-100 text-blue-800":"shipped"===s.status?"bg-yellow-100 text-yellow-800":"received"===s.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{children:["Quantity: ",s.quantity]}),e.jsxs("div",{children:["Cost: ",n(s.cost)]}),e.jsxs("div",{children:["Total: ",n(s.quantity*s.cost)]}),e.jsxs("div",{children:["Supplier: ",s.supplier]})]}),s.notes&&e.jsxs("div",{className:"text-sm text-gray-500 italic mb-3",children:["Note: ",s.notes]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:["ordered"===s.status&&e.jsxs(t,{variant:"primary",size:"sm",onClick:()=>Ne(s.id,"shipped"),children:[e.jsx($,{className:"w-4 h-4"}),"Mark Shipped"]}),"shipped"===s.status&&e.jsxs(t,{variant:"success",size:"sm",onClick:()=>Ne(s.id,"received"),children:[e.jsx(_,{className:"w-4 h-4"}),"Mark Received"]}),"received"===s.status&&e.jsxs(t,{variant:"success",size:"sm",onClick:()=>Ne(s.id,"installed"),children:[e.jsx(T,{className:"w-4 h-4"}),"Mark Installed"]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>{"done"!==a.status&&"failed"!==a.status?(re(s),te(!0)):w.error("ðŸš« Cannot edit parts for finished devices. This device is already completed.")},children:[e.jsx(R,{className:"w-4 h-4"}),"Edit"]}),e.jsxs(t,{variant:"danger",size:"sm",onClick:()=>Ce(s.id),children:[e.jsx(q,{className:"w-4 h-4"}),"Delete"]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No spare parts added"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add spare parts needed for this repair"}),e.jsxs(t,{variant:"primary",onClick:()=>te(!0),className:"px-6 py-3",children:[e.jsx(S,{className:"w-4 h-4"}),"Add First Part"]})]})]})}),e.jsx("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200",children:e.jsx(t,{variant:"outline",onClick:()=>ie(!1),children:"Close"})})]})})]});if("parts-arrived"===a.status)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-green-900",children:"Parts Arrived"}),e.jsx("p",{className:"text-green-700",children:"All required parts have been received and are ready for repair"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-900",children:"100%"}),e.jsx("div",{className:"text-sm text-green-600",children:"Parts Ready"})]})]}),e.jsx("div",{className:"w-full bg-green-200 rounded-full h-3 mb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-500 w-full"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Total Parts"}),e.jsx("div",{className:"text-lg font-bold text-green-900",children:j.length})]}),e.jsxs("div",{className:"bg-white/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Received"}),e.jsx("div",{className:"text-lg font-bold text-green-900",children:j.filter(e=>"received"===e.status||"installed"===e.status).length})]}),e.jsxs("div",{className:"bg-white/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Total Cost"}),e.jsxs("div",{className:"text-lg font-bold text-green-900",children:[Se().toLocaleString()," TSH"]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("received"===s.status?"bg-green-100 text-green-700":"installed"===s.status?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:s.status})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Cost:"})," ",s.cost.toLocaleString()," TSH"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Supplier:"})," ",s.supplier]}),s.description&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Description:"})," ",s.description]}),s.notes&&e.jsx("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:s.notes})]})]},s.id))}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(t,{variant:"primary",size:"lg",onClick:()=>c(a.id,"in-repair"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(T,{className:"w-5 h-5"}),"Start Repair"]})})]});const De=u.useMemo(()=>{const s=[],t="technician"===(null==r?void 0:r.role)&&a.assignedTo===r.id,l="admin"===(null==r?void 0:r.role),i="customer-care"===(null==r?void 0:r.role);if("assigned"===a.status&&(t||l||i)&&s.push({id:"start-diagnosis",title:"Start Diagnosis",description:"Begin diagnostic process",icon:e.jsx(L,{className:"w-6 h-6"}),color:"bg-yellow-500",action:async()=>{await ce("diagnosis-started","Diagnostic process started")}}),"diagnosis-started"===a.status&&(t||l)){!function(e){!(!e||0===e.length)&&e.some(e=>"received"!==e.status&&"used"!==e.status)}(j);const t=je(j,a.status,"in-repair");t.valid?s.push({id:"start-repair",title:"Start Repair",description:"Begin repair work with available parts",icon:e.jsx(T,{className:"w-6 h-6"}),color:"bg-purple-500",action:async()=>{x("start-repair");try{await c(a.id,"in-repair")}finally{x(null)}}}):s.push({id:"start-repair-disabled",title:"Start Repair",description:t.message||"Cannot start repair",icon:e.jsx(T,{className:"w-6 h-6"}),color:"bg-gray-400 cursor-not-allowed",disabled:!0,action:async()=>{w.error(t.message||"Cannot start repair")}})}if("awaiting-parts"===a.status&&(t||l||i)){const t=function(e){return!e||0===e.length||e.every(e=>"accepted"===e.status||"received"===e.status||"used"===e.status)}(j);t?s.push({id:"parts-arrived",title:"Parts Arrived",description:"All parts received, ready to start repair",icon:e.jsx(y,{className:"w-6 h-6"}),color:"bg-green-500",action:async()=>{x("parts-arrived");try{await c(a.id,"parts-arrived")}finally{x(null)}}}):s.push({id:"check-parts",title:"Check Parts Status",description:"Review spare parts delivery status",icon:e.jsx(y,{className:"w-6 h-6"}),color:"bg-blue-500",action:async()=>{ie(!0)}})}if("parts-arrived"===a.status&&(t||l)){const t=je(j,a.status,"in-repair");t.valid?s.push({id:"start-repair",title:"Start Repair",description:"Begin repair work with all parts ready",icon:e.jsx(T,{className:"w-6 h-6"}),color:"bg-purple-500",action:async()=>{x("start-repair");try{await c(a.id,"in-repair")}finally{x(null)}}}):s.push({id:"start-repair-disabled",title:"Start Repair",description:t.message||"Cannot start repair",icon:e.jsx(T,{className:"w-6 h-6"}),color:"bg-gray-400 cursor-not-allowed",disabled:!0,action:async()=>{w.error(t.message||"Cannot start repair")}})}if("in-repair"===a.status&&(t||l)){const t=je(j,a.status,"reassembled-testing");t.valid?s.push({id:"testing",title:"Start Testing",description:"Device reassembled, begin testing",icon:e.jsx(_,{className:"w-6 h-6"}),color:"bg-indigo-500",action:async()=>{x("testing");try{await c(a.id,"reassembled-testing")}finally{x(null)}}}):s.push({id:"testing-disabled",title:"Start Testing",description:t.message||"Cannot start testing",icon:e.jsx(_,{className:"w-6 h-6"}),color:"bg-gray-400 cursor-not-allowed",disabled:!0,action:async()=>{w.error(t.message||"Cannot start testing")}})}if("reassembled-testing"===a.status&&(t||l)){const t=je(j,a.status,"repair-complete");t.valid?s.push({id:"complete",title:"Complete Repair",description:"Repair completed successfully",icon:e.jsx(_,{className:"w-6 h-6"}),color:"bg-green-500",action:async()=>{x("complete");try{await c(a.id,"repair-complete")}finally{x(null)}}}):s.push({id:"complete-disabled",title:"Complete Repair",description:t.message||"Cannot complete repair",icon:e.jsx(_,{className:"w-6 h-6"}),color:"bg-gray-400 cursor-not-allowed",disabled:!0,action:async()=>{w.error(t.message||"Cannot complete repair")}})}if("repair-complete"===a.status&&(t||l||i)&&s.push({id:"return-to-customer-care",title:"Return to Customer Care",description:"Device ready for customer pickup",icon:e.jsx(M,{className:"w-6 h-6"}),color:"bg-teal-500",action:async()=>{x("return-to-customer-care");try{await c(a.id,"returned-to-customer-care")}finally{x(null)}}}),"returned-to-customer-care"===a.status&&(l||i)&&s.push({id:"mark-done",title:"Mark as Done",description:"Customer has received device",icon:e.jsx(_,{className:"w-6 h-6"}),color:"bg-green-600",action:async()=>{x("mark-done");try{await c(a.id,"done")}finally{x(null)}}}),["diagnosis-started","awaiting-parts","parts-arrived","in-repair","reassembled-testing"].includes(a.status)&&(t||l)&&s.push({id:"mark-failed",title:"Mark as Failed",description:"Mark repair as failed - cannot be completed",icon:e.jsx(E,{className:"w-6 h-6"}),color:"bg-red-500",action:async()=>{x("mark-failed");try{await c(a.id,"failed")}finally{x(null)}}}),(i||l)&&a.customerId&&"assigned"!==a.status&&s.push({id:"send-sms",title:"Send SMS to Customer",description:"Send status update SMS to customer",icon:e.jsx(I,{className:"w-6 h-6"}),color:"bg-indigo-500",action:async()=>{(()=>{const e=a.customerName||"Mteja",s=`${a.brand} ${a.model}`||"kifaa chako",t=((e,s,t)=>({assigned:`Hujambo ${s}! Kifaa chako ${t} kimepewa technician. Tutakujulisha mwendelezo wa ukarabati. - LATS CHANCE`,"diagnosis-started":`Hujambo ${s}! Kifaa chako ${t} kimeanza diagnosis. Technician anachunguza tatizo. Tutakujulisha matokeo. - LATS CHANCE`,"awaiting-parts":`Hujambo ${s}! Kifaa chako ${t} kinahitaji spare parts. Tunasubiri parts kufika, tutakujulisha. - LATS CHANCE`,"in-repair":`Hujambo ${s}! Kifaa chako ${t} kinakarabatiwa. Technician anafanya kazi, tutakujulisha mwendelezo. - LATS CHANCE`,"repair-complete":`Hujambo ${s}! Kifaa chako ${t} kimekarabatiwa! Unaweza kuja kukichukua. - LATS CHANCE`,"reassembled-testing":`Hujambo ${s}! Kifaa chako ${t} kimekarabatiwa na kinajaribiwa. Karibu kukichukua. - LATS CHANCE`,"returned-to-customer-care":`Hujambo ${s}! Kifaa chako ${t} kimekarabatiwa na kiko tayari kuchukuliwa. Karibu ofisini. - LATS CHANCE`,done:`Asante ${s}! Kifaa chako ${t} kimechukuliwa. Karibu tena! - LATS CHANCE`,failed:`Hujambo ${s}. Kuna tatizo na kifaa chako ${t}. Tunaomba uje ofisini kujadili. - LATS CHANCE`}[e]||`Hujambo ${s}! Kuna update kuhusu kifaa chako ${t}. - LATS CHANCE`))(a.status,e,s);B(t),H(!0)})()}}),i||l){const t=j.filter(e=>"needed"===e.status||"ordered"===e.status);t.length>0&&s.push({id:"accept-parts",title:"Accept Spare Parts",description:`Accept ${t.length} requested spare parts`,icon:e.jsx(F,{className:"w-6 h-6"}),color:"bg-green-500",action:async()=>{w.success("ðŸ“‹ Parts Management: Use the parts list below to select and accept parts. Click on individual parts to mark them as accepted before starting repair work.")}})}return s},[a.status,a.assignedTo,null==r?void 0:r.role,null==r?void 0:r.id,j,m]),Pe=De;return"done"===a.status?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Repair Completed! ðŸŽ‰"}),e.jsx("p",{className:"text-gray-600",children:"Device has been successfully repaired and returned to customer"}),e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Status:"})," ",a.status," (100% Complete)"]})})]}):0===Pe.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Actions Available"}),e.jsxs("p",{className:"text-gray-600",children:["Current status: ",a.status]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:Pe.map(s=>e.jsxs("button",{onClick:s.action,disabled:null!==m||s.disabled,className:`\n                group relative overflow-hidden rounded-xl p-4 transition-all duration-300 w-full\n                ${null!==m||s.disabled?"opacity-50 cursor-not-allowed":"hover:scale-[1.01] hover:shadow-lg"}\n                ${"bg-indigo-500"===s.color?"bg-gradient-to-br from-indigo-500 to-indigo-600":"bg-purple-500"===s.color?"bg-gradient-to-br from-purple-500 to-purple-600":"bg-green-500"===s.color?"bg-gradient-to-br from-green-500 to-green-600":"bg-orange-500"===s.color?"bg-gradient-to-br from-orange-500 to-orange-600":"bg-blue-500"===s.color?"bg-gradient-to-br from-blue-500 to-blue-600":"bg-red-500"===s.color?"bg-gradient-to-br from-red-500 to-red-600":"bg-gray-400"===s.color?"bg-gradient-to-br from-gray-400 to-gray-500":"bg-gradient-to-br from-slate-500 to-slate-600"}\n                shadow-md hover:shadow-xl\n              `,children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"relative flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:e.jsx("div",{className:"text-white",children:s.icon})}),e.jsx("div",{className:"flex-1 text-left",children:m===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-white font-semibold",children:"Updating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-white font-bold text-lg mb-1",children:s.title}),e.jsx("p",{className:"text-white/80 text-sm",children:s.description})]})}),m!==s.id&&e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center group-hover:bg-white/30 transition-colors",children:e.jsx("svg",{className:"w-4 h-4 text-white transform group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]},s.id))})}),("customer-care"===(null==r?void 0:r.role)||"admin"===(null==r?void 0:r.role))&&j.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Spare Parts Management"})]}),D?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"animate-pulse bg-gray-200 h-16 rounded-lg"},s))}):e.jsxs("div",{className:"space-y-4",children:[(()=>{const s=j.filter(e=>"needed"===e.status||"ordered"===e.status);return s.length>0?e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:V.length===s.length&&s.length>0,onChange:xe,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Select All (",s.length," actionable)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:ue,disabled:0===V.length||Y,className:"flex items-center gap-1 px-3 py-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg text-xs font-medium transition-colors",children:[e.jsx(F,{className:"w-3 h-3"}),"Accept (",V.length,")"]}),e.jsxs("button",{onClick:()=>J(!0),disabled:0===V.length||Y,className:"flex items-center gap-1 px-3 py-1 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg text-xs font-medium transition-colors",children:[e.jsx(E,{className:"w-3 h-3"}),"Decline (",V.length,")"]})]})]}),Y&&e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-sm text-blue-600",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-300 border-t-blue-600 rounded-full animate-spin"}),"Processing..."]})})]}):null})(),e.jsx("div",{className:"space-y-2",children:j.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[("needed"===s.status||"ordered"===s.status)&&e.jsx("input",{type:"checkbox",checked:V.includes(s.id),onChange:()=>{return e=s.id,void Q(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:s.name||"Unknown Part"}),e.jsxs("div",{className:"text-xs text-gray-600 truncate",children:["Qty: ",s.quantity," â€¢ ",n(s.cost)," each"]}),s.notes&&e.jsx("div",{className:"text-xs text-gray-500 italic truncate",children:s.notes})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("needed"===s.status?"bg-yellow-100 text-yellow-800":"ordered"===s.status?"bg-blue-100 text-blue-800":"accepted"===s.status?"bg-purple-100 text-purple-800":"received"===s.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.status})})]},s.id))})]})]}),e.jsx(oe,{isOpen:p,onClose:()=>{g(!1),b(0)},amount:h,customerId:(null==a?void 0:a.customerId)||"",customerName:(null==a?void 0:a.customerName)||"Unknown Customer",description:`Device payment - ${null==a?void 0:a.brand} ${null==a?void 0:a.model}`,onPaymentComplete:async(e,t)=>{try{const{error:r}=await s.from("customer_payments").insert({customer_id:null==a?void 0:a.customerId,device_id:null==a?void 0:a.id,amount:t||e.amount,method:e.method||"cash",payment_type:"payment",status:"completed",payment_date:(new Date).toISOString(),currency:"TZS",payment_account_id:e.paymentAccountId||null,payment_method_id:e.paymentMethodId||null,reference:e.reference||null,notes:`Device payment - ${null==a?void 0:a.brand} ${null==a?void 0:a.model}`,created_at:(new Date).toISOString()});if(r)throw r;w.success(`Payment of ${n(t||e.amount)} recorded successfully`),g(!1)}catch(r){w.error("Failed to record payment")}},deviceId:null==a?void 0:a.id,allowPriceEdit:!0,paymentType:"cash_in",title:"Device Repair Payment"}),a&&e.jsx(be,{device:a,isOpen:ne,onClose:()=>{de(!1)},onPartsSelected:async e=>{if(a)if("done"!==a.status&&"failed"!==a.status)try{await Promise.all(e.map(async e=>{const s={device_id:a.id,spare_part_id:e.spare_part_id,quantity_needed:e.quantity,cost_per_unit:e.cost_per_unit,notes:e.notes||""};return await d(s)})),w.success(`${e.length} parts requested successfully`),pe()}catch(s){w.error("Failed to request parts")}else w.error("ðŸš« Cannot request parts for finished devices. This device is already completed.")}}),U&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Send Message to Customer"}),e.jsx("button",{onClick:()=>{H(!1),B("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(v,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message (Swahili)"}),e.jsx("textarea",{value:O,onChange:e=>B(e.target.value),placeholder:"Enter your message here...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none",rows:4}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Character count: ",O.length]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>me("sms"),disabled:K||!O.trim(),className:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[K?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),"Send SMS"]}),e.jsxs("button",{onClick:()=>me("whatsapp"),disabled:K||!O.trim(),className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[K?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),"Send WhatsApp"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>{H(!1),B("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"})})]})]})})}),G&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Reject Spare Parts"}),e.jsx("button",{onClick:()=>{J(!1),ee("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(v,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsxs("strong",{children:[V.length," parts"]}),' will be rejected and returned to "needed" status.']})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rejection Reason (Optional)"}),e.jsx("textarea",{value:X,onChange:e=>ee(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:3,placeholder:"Enter reason for rejection..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{J(!1),ee("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if("done"!==a.status&&"failed"!==a.status)if(0!==V.length){Z(!0);try{const{rejectSpareParts:e}=await f(()=>import("./index-222cfb29.js").then(e=>e.aS),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=await e(V,X);if(s.ok&&s.data){const e=j.map(e=>V.includes(e.id)?{...e,status:"needed",notes:X?`Rejected by customer care: ${X}`:e.notes}:e);N(e),w.success(s.message),Q([]),J(!1),ee("")}else w.error(s.message||"Failed to reject parts")}catch(e){w.error("Failed to reject parts")}finally{Z(!1)}}else w.error("Please select parts to reject");else w.error("ðŸš« Cannot reject parts for finished devices. This device is already completed.")},disabled:Y,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[Y&&e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Reject Parts"]})]})]})]})})})]})},ve=({isOpen:a,onClose:l,deviceId:x})=>{var g,h,b,f,N,w,C;const{currentUser:S}=r(),{devices:D,getDeviceById:A,updateDeviceStatus:$}=c(),{customers:R}=o();xe();const q=D.find(e=>e.id===x)||null;u.useState(!1);const[M,I]=u.useState("overview"),[F,Z]=u.useState({}),[G,J]=u.useState(""),[X,ee]=u.useState(!1),[se,te]=u.useState([]),[ae,re]=u.useState(!1),[le,ie]=u.useState(!1),[ne,de]=u.useState([]),[ce,oe]=u.useState(!1),[ue,he]=u.useState(!1),[je,fe]=u.useState(""),[ve,Ne]=u.useState(null);u.useState(!1);const[we,ke]=u.useState(null),[Ce,Se]=u.useState(null),[_e,De]=u.useState(!1);u.useEffect(()=>{if(q){const e=[];q.assignedTo&&e.push(q.assignedTo),q.transitions&&q.transitions.forEach(s=>{s.performedBy&&!e.includes(s.performedBy)&&e.push(s.performedBy)});const s=e.filter(e=>!F[e]&&"system"!==e);s.length>0&&Re(s)}},[q,F]),u.useEffect(()=>{ke(q?{repairCost:Number(q.repairCost)||0,depositAmount:Number(q.depositAmount)||0}:null)},[q]),u.useEffect(()=>{if(!(null==q?void 0:q.expectedReturnDate))return void J("");const e=()=>{const e=new Date,s=new Date(q.expectedReturnDate).getTime()-e.getTime();if(s<=-864e5)return void J("Overdue");const t=Math.floor(s/864e5),a=Math.floor(s%864e5/36e5),r=Math.floor(s%36e5/6e4);if(t>0)J(`${t}d ${a}h ${r}m`);else if(a>0)J(`${a}h ${r}m`);else if(r>0)J(`${r}m`);else{const e=Math.floor(Math.abs(s)/36e5),t=Math.floor(Math.abs(s)%36e5/6e4);J(e>0?`${e}h ${t}m overdue`:`${t}m overdue`)}};e();const s=setInterval(e,6e4);return()=>clearInterval(s)},[null==q?void 0:q.expectedReturnDate]),u.useEffect(()=>{q&&a&&(Pe(),$e(q.id),Te(q.id),Ae(q.id))},[q,a]);const Pe=async()=>{try{const{data:e,error:t}=await s.from("users").select("id, full_name, username, email").not("id","is",null);if(t)return;if(e){const s={};e.forEach(e=>{s[e.id]=e.full_name||e.username||e.email||"Unknown User"}),Z(s)}}catch(e){}},Ae=async e=>{try{const{data:t,error:a}=await s.from("customer_payments").select("amount, status").eq("device_id",e);if(a)return;const r={totalPaid:0,totalPending:0,totalFailed:0};t&&t.forEach(e=>{const s=Number(e.amount)||0;switch(e.status){case"completed":r.totalPaid+=s;break;case"pending":r.totalPending+=s;break;case"failed":r.totalFailed+=s}}),Ne(r)}catch(t){}},$e=async e=>{re(!0);try{const s=await i(e);s.ok&&s.data?te(s.data):te([])}catch(s){te([])}finally{re(!1)}},Te=async e=>{var t,a;De(!0);try{const[r,l]=await Promise.all([s.from("devices").select("diagnostic_checklist").eq("id",e).single(),s.from("diagnostic_checks").select("*").eq("diagnostic_device_id",e).order("created_at",{ascending:!1})]);let i=null;if(null==(t=r.data)?void 0:t.diagnostic_checklist){const e="string"==typeof r.data.diagnostic_checklist?JSON.parse(r.data.diagnostic_checklist):r.data.diagnostic_checklist;let s=null,t=e.overall_status||e.overallStatus;if(e.checklist_items&&Array.isArray(e.checklist_items)){const a=e.checklist_items.length,r=e.checklist_items.filter(e=>"passed"===e.result).length,l=e.checklist_items.filter(e=>"failed"===e.result).length;s={total:a,passed:r,failed:l,pending:e.checklist_items.filter(e=>!e.completed).length,lastUpdated:e.updated_at||e.completed_at};i={items:e.checklist_items.map(e=>({test:e.title,result:e.result,notes:e.notes,completed:e.completed})),summary:s,overallStatus:t,individualChecks:e.checklist_items,technicianNotes:e.technician_notes,source:"device_checklist"}}else if(e.items&&Array.isArray(e.items)){const a=e.items.length,r=e.items.filter(e=>"passed"===e.result).length,l=e.items.filter(e=>"failed"===e.result).length;s={total:a,passed:r,failed:l,pending:e.items.filter(e=>!e.completed).length,lastUpdated:e.last_updated||e.updated_at},i={items:e.items,summary:s,overallStatus:t,individualChecks:e.items,technicianNotes:e.notes,source:"device_checklist"}}else i={...e,source:"device_checklist"}}if(l.data&&l.data.length>0){const e=l.data,s=e.length,t=e.filter(e=>"passed"===e.result).length,r=e.filter(e=>"failed"===e.result).length,n={total:s,passed:t,failed:r,pending:0,lastUpdated:null==(a=e[0])?void 0:a.created_at};i=i?{...i,individualChecks:e,summary:{...i.summary,...n}}:{items:e.map(e=>({test:e.test_item,result:e.result,notes:e.remarks,completed:!0})),summary:n,overallStatus:r>0?"issues-found":"all-passed",individualChecks:e,source:"diagnostic_checks"}}Se(i)}catch(r){Se(null)}finally{De(!1)}},Re=async e=>{if(0!==e.length)try{const{data:t,error:a}=await s.from("users").select("id, full_name, username").in("id",e);if(a)return;if(t){const e={};t.forEach(s=>{e[s.id]=s.full_name||s.username||"Unknown User"}),Z(s=>({...s,...e}))}}catch(t){}},qe=()=>{if(!q)return 0;return{assigned:0,"diagnosis-started":20,"awaiting-parts":30,"in-repair":60,"reassembled-testing":80,"repair-complete":90,"returned-to-customer-care":95,done:100,failed:0}[q.status]||0},Le=(null==q?void 0:q.assignedTo)===(null==S?void 0:S.id),Me=R.find(e=>e.id===(null==q?void 0:q.customerId)),Ee=async(e,s,t)=>{if(q&&q.id===e)try{if(q.status===s)return void j.info(`Device is already in "${s}" status`);if("in-repair"===s){({isValid:!0,errors:[]}).isValid}if("repair-complete"===s&&q.customerId)try{await ge(e,q.customerId),j.success("Pending payments created for repair completion")}catch(a){j.error("Failed to create pending payments - please check payment setup")}await $(e,s,t||"")?(j.success(`Status updated to "${s}" successfully`),"repair-complete"!==s&&"process-payments"!==s||await Ae(e),"awaiting-parts"!==s&&"parts-arrived"!==s&&"in-repair"!==s||await $e(e)):j.error(`Failed to update status to "${s}". Please try again.`)}catch(a){a instanceof Error?j.error(`Status update failed: ${a.message}`):j.error("Failed to update status. Please check your connection and try again.")}else j.error("Invalid device for status update")},Ie=async()=>{if(q&&Me)try{let e="";const t=`${q.brand} ${q.model}`,a=Me.name||"Valued Customer";switch(q.status){case"diagnosis-started":e=`Hello ${a}, your ${t} (Serial: ${q.serialNumber}) is now being diagnosed. We'll update you soon. - LATS CHANCE`;break;case"awaiting-parts":e=`Hello ${a}, we're waiting for parts for your ${t}. We'll notify you when they arrive. - LATS CHANCE`;break;case"in-repair":e=`Hello ${a}, your ${t} is currently being repaired. We'll update you on progress. - LATS CHANCE`;break;case"repair-complete":e=`Hello ${a}, your ${t} repair is complete! Please visit us to collect your device. - LATS CHANCE`;break;case"done":e=`Hello ${a}, thank you for choosing LATS CHANCE! Your ${t} is ready for collection. - LATS CHANCE`;break;default:e=`Hello ${a}, this is an update about your ${t} repair. Current status: ${q.status}. - LATS CHANCE`}const{error:r}=await s.from("customer_communications").insert({customer_id:Me.id,device_id:q.id,type:"sms",message:e,status:"sent",sent_by:null==S?void 0:S.id,sent_at:(new Date).toISOString()});if(r)return void j.error("Failed to save SMS record");j.success(`SMS sent to ${Me.phone||"customer"}: "${e.substring(0,50)}..."`)}catch(e){j.error("Failed to send SMS")}},Fe=()=>{const e=se.filter(e=>"needed"===e.status||"ordered"===e.status);ne.length===e.length?de([]):de(e.map(e=>e.id))};return a?q?q?p.createPortal(e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center p-2 sm:p-4 overflow-y-auto",style:{zIndex:99999},children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:e=>{e.preventDefault(),l()}}),e.jsxs("div",{className:"relative bg-white rounded-lg sm:rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] sm:max-h-[85vh] overflow-hidden flex flex-col my-2 sm:my-4",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 flex-shrink-0",children:e.jsx(z,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold text-gray-900 truncate",children:[q.brand," ",q.model]}),q.model&&q.model.includes("(")&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded-full",children:(null==(g=q.model.match(/\(([^)]+)\)/))?void 0:g[1])||""})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["Serial: ",q.serialNumber]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(pe,{status:q.status})})]})]})]}),e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),l()},className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors flex-shrink-0",children:e.jsx(v,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex w-full",children:[e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),I("overview")},className:"flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors "+("overview"===M?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]})}),e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),I("repair")},className:"flex-1 py-3 px-4 border-b-2 font-medium text-sm transition-colors "+("repair"===M?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Repair"})]})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[e.jsxs("div",{className:"p-3 sm:p-4",children:["overview"===M&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3 sm:gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-1.5 border-b border-gray-100",children:[e.jsx(z,{className:"w-4 h-4 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Device Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Device Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:q.model||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Serial Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono truncate",children:q.serialNumber||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(pe,{status:q.status})})]}),q.assignedTo&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Assigned To"}),e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 bg-blue-50 text-blue-700 rounded-lg text-xs font-medium border border-blue-200",children:[e.jsx(P,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:(ze=q.assignedTo,ze?F[ze]?F[ze]:"system"===ze?"System":ze.slice(0,8)+"...":"Unknown")})]})})]}),q.estimatedHours&&e.jsxs("div",{className:"space-y-1 sm:col-span-2",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Estimated Hours"}),e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 text-green-700 rounded-lg text-xs font-medium border border-green-200",children:[e.jsx(H,{className:"w-3 h-3"}),q.estimatedHours,"h"]})})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-1.5 border-b border-gray-100",children:[e.jsx(L,{className:"w-4 h-4 text-red-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Issue & Problem"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Issue Description"}),e.jsx("div",{className:"bg-red-50 p-2 rounded-lg border border-red-100 max-h-24 overflow-y-auto",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 break-words",children:q.issueDescription||"No issue description provided"})})]}),q.diagnosisRequired&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Diagnosis Required"}),e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Yes - Diagnosis Required"}),e.jsx("span",{className:"sm:hidden",children:"Diagnosis Required"})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-1.5 border-b border-gray-100",children:[e.jsx(B,{className:"w-4 h-4 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Dates & Timeline"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(q.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(q.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Expected Return"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(q.expectedReturnDate).toLocaleDateString()}),G&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium "+("Overdue"===G?"bg-red-100 text-red-700 border border-red-200":G.includes("overdue")?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-orange-100 text-orange-700 border border-orange-200"),children:[e.jsx(H,{className:"w-3 h-3"}),G]})]})]}),q.lastReturnDate&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Last Return"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(q.lastReturnDate).toLocaleDateString()})]})]})]}),q.deviceCondition&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(K,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Device Condition"})]}),e.jsx("div",{className:"space-y-2",children:"object"==typeof q.deviceCondition?e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(q.deviceCondition).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 capitalize",children:s.replace(/([A-Z])/g," $1").trim()}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+(t?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:t?"Yes":"No"})]},s))}):e.jsx("p",{className:"text-sm font-medium text-gray-900 bg-gray-50 p-2 rounded",children:q.deviceCondition})})]}),q.repairChecklist&&"done"!==q.status&&"failed"!==q.status&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(T,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Repair Progress"})]}),e.jsx("div",{className:"bg-green-50 p-3 rounded-lg border border-green-100",children:(()=>{try{const s="string"==typeof q.repairChecklist?JSON.parse(q.repairChecklist):q.repairChecklist;if(s.items){const t=s.items.filter(e=>e.completed).length,a=s.items.length,r=Math.round(t/a*100);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:[t,"/",a," Steps Complete"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[r,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-green-500 h-3 rounded-full transition-all duration-300",style:{width:`${r}%`}})})]})}return e.jsx("p",{className:"text-sm text-gray-600",children:"Repair workflow available"})}catch{return e.jsx("p",{className:"text-sm text-gray-600",children:"Repair data available"})}})()})]}),(q.warrantyStart||q.warrantyEnd||q.warrantyStatus||q.repairCount)&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(K,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Warranty Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[q.warrantyStart&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Warranty Start"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(q.warrantyStart).toLocaleDateString()})]}),q.warrantyEnd&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Warranty End"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(q.warrantyEnd).toLocaleDateString()})]}),q.warrantyStatus&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Warranty Status"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:q.warrantyStatus})]}),q.repairCount&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Repair Count"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:q.repairCount})]})]})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:["done"!==q.status&&"failed"!==q.status&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Status Actions"})]}),e.jsx(ye,{device:q,currentUser:S,onStatusUpdate:Ee,onPartsUpdate:e=>{}})]}),"done"!==q.status&&"failed"!==q.status&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-3 sm:p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 sm:w-5 sm:h-5 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Requested Spare Parts"})]}),se.length>0&&e.jsxs("span",{className:"text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded-full",children:[se.length," parts"]})]}),ae?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 rounded w-3/4"}),e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 rounded w-1/2"})]}):se.length>0?e.jsxs("div",{className:"space-y-2",children:[("customer-care"===(null==S?void 0:S.role)||"admin"===(null==S?void 0:S.role))&&(()=>{const s=se.filter(e=>"needed"===e.status||"ordered"===e.status);return s.length>0?e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ne.length===s.length&&s.length>0,onChange:Fe,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Select All (",s.length," actionable)"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>he(!0),disabled:0===ne.length||ce,className:"flex items-center gap-1 px-3 py-1 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg text-xs font-medium transition-colors",children:[e.jsx(E,{className:"w-3 h-3"}),"Decline (",ne.length,")"]})})]}),ce&&e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-sm text-blue-600",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-300 border-t-blue-600 rounded-full animate-spin"}),"Processing..."]})})]}):null})(),se.slice(0,3).map(s=>{var t;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[("customer-care"===(null==S?void 0:S.role)||"admin"===(null==S?void 0:S.role))&&("needed"===s.status||"ordered"===s.status)&&e.jsx("input",{type:"checkbox",checked:ne.includes(s.id),onChange:()=>{return e=s.id,void de(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},className:"w-3 h-3 sm:w-4 sm:h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900 truncate",children:(null==(t=s.spare_part)?void 0:t.name)||"Unknown Part"}),e.jsxs("div",{className:"text-xs text-gray-600 truncate",children:["Qty: ",s.quantity_needed," â€¢ ",n(s.cost_per_unit)," each"]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("span",{className:"inline-flex items-center px-1 sm:px-2 py-1 rounded-full text-xs font-medium "+("needed"===s.status?"bg-yellow-100 text-yellow-800":"ordered"===s.status?"bg-blue-100 text-blue-800":"accepted"===s.status?"bg-purple-100 text-purple-800":"received"===s.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:[e.jsx("span",{className:"hidden sm:inline",children:s.status}),e.jsx("span",{className:"sm:hidden",children:s.status.charAt(0).toUpperCase()})]})})]},s.id)}),se.length>3&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>I("repair"),className:"text-xs text-purple-600 hover:text-purple-700 font-medium",children:["View all ",se.length," parts â†’"]})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(y,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No spare parts requested yet"})]}),"technician"===(null==S?void 0:S.role)&&q.assignedTo===S.id||"admin"===(null==S?void 0:S.role)?e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),ie(!0)},className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium text-sm",children:[e.jsx(y,{className:"w-4 h-4"}),"Request Parts"]})}):null]}),(q.unlockCode||q.deviceNotes)&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx(W,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Additional Information"})]}),e.jsxs("div",{className:"space-y-3",children:[q.unlockCode&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Unlock Code"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono bg-gray-50 p-2 rounded",children:q.unlockCode})]}),q.deviceNotes&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Device Notes"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 bg-gray-50 p-3 rounded-lg",children:q.deviceNotes})]})]})]}),"done"===q.status&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(_,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-green-800",children:"Repair Completed! ðŸŽ‰"}),e.jsx("p",{className:"text-green-600",children:"Device has been successfully repaired and returned to customer"})]})]}),e.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-800 font-semibold",children:"Status: Complete"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"100%"}),e.jsx("div",{className:"text-xs text-green-600",children:"Complete"})]})]}),q.completedAt&&e.jsx("div",{className:"mt-3 pt-3 border-t border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Completed on:"})," ",new Date(q.completedAt).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})})]})]})]})]})}),"repair"===M&&q&&e.jsxs("div",{className:"space-y-6",children:["done"===q.status||"failed"===q.status?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Status Actions"})]}),e.jsx(ye,{device:q,currentUser:S,onStatusUpdate:Ee,onPartsUpdate:e=>{}})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Requested Spare Parts"})]}),ae?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"animate-pulse bg-gray-200 h-16 rounded-lg"},s))}):se.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:se.map(s=>{var t,a;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:(null==(t=s.spare_part)?void 0:t.name)||"Unknown Part"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["#",(null==(a=s.spare_part)?void 0:a.part_number)||"N/A"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:["Quantity: ",s.quantity_needed]}),e.jsxs("div",{children:["Cost: ",n(s.cost_per_unit)," each"]}),e.jsxs("div",{children:["Total: ",n(s.quantity_needed*s.cost_per_unit)]}),e.jsxs("div",{children:["Used: ",s.quantity_used||0]})]}),s.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-500 italic",children:["Note: ",s.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium "+("needed"===s.status?"bg-yellow-100 text-yellow-800":"ordered"===s.status?"bg-blue-100 text-blue-800":"received"===s.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.status}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(s.created_at).toLocaleDateString()})]})]},s.id)})}),"technician"===(null==S?void 0:S.role)&&q.assignedTo===S.id||"admin"===(null==S?void 0:S.role)?e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>ie(!0),className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium text-sm w-full justify-center",children:[e.jsx(y,{className:"w-4 h-4"}),"Request More Parts"]})}):null]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No spare parts requested"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Request spare parts needed for this repair"}),"technician"===(null==S?void 0:S.role)&&q.assignedTo===S.id||"admin"===(null==S?void 0:S.role)?e.jsxs("button",{onClick:()=>ie(!0),className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors font-medium text-sm mx-auto",children:[e.jsx(y,{className:"w-4 h-4"}),"Request Parts"]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Contact your assigned technician or admin to request parts"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Status Actions"})]}),e.jsx(ye,{device:q,currentUser:S,onStatusUpdate:Ee,onPartsUpdate:e=>{}})]})]}),"done"!==q.status&&"failed"!==q.status&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(V,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Repair Progress"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Overall Progress"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[qe(),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${qe()}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"Diagnosis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"Repair"})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(k,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Diagnostic Progress"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_e&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-blue-600",children:"Loading..."})]}),e.jsx("button",{onClick:()=>{(null==q?void 0:q.id)&&Te(q.id)},disabled:_e,className:"p-1 text-gray-400 hover:text-blue-600 transition-colors disabled:opacity-50",title:"Refresh diagnostic data",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:_e?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Fetching diagnostic data..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 rounded w-3/4"}),e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 rounded w-1/2"})]})]}):Ce?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-blue-600 font-semibold text-lg",children:["Total Tests: ",(null==(h=Ce.summary)?void 0:h.total)||0]}),e.jsx("span",{className:"text-sm text-gray-600 px-3 py-1 bg-white rounded-full border",children:"all-passed"===Ce.overallStatus?"All Passed":"issues-found"===Ce.overallStatus?"Issues Found":Ce.overallStatus||"In Progress"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-green-100 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-green-600 font-bold text-xl",children:(null==(b=Ce.summary)?void 0:b.passed)||0}),e.jsx("div",{className:"text-xs text-green-700 font-medium",children:"Passed"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-100 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-red-600 font-bold text-xl",children:(null==(f=Ce.summary)?void 0:f.failed)||0}),e.jsx("div",{className:"text-xs text-red-700 font-medium",children:"Failed"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-100 rounded-lg border border-yellow-200",children:[e.jsx("div",{className:"text-yellow-600 font-bold text-xl",children:(null==(N=Ce.summary)?void 0:N.pending)||0}),e.jsx("div",{className:"text-xs text-yellow-700 font-medium",children:"Pending"})]})]}),"admin"===(null==S?void 0:S.role)&&(null==(w=Ce.summary)?void 0:w.failed)>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(L,{className:"w-4 h-4 text-red-500"}),e.jsx("h4",{className:"text-sm font-semibold text-red-700",children:"Admin Review - Failed Diagnostics"})]}),e.jsxs("div",{className:"space-y-3",children:[null==(C=Ce.individualChecks)?void 0:C.filter(e=>"failed"===e.result).map((s,t)=>e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:s.title||s.test_item||`Test ${t+1}`})]}),s.notes&&e.jsxs("p",{className:"text-xs text-red-700 mb-2",children:[e.jsx("strong",{children:"Failure Reason:"})," ",s.notes]}),s.remarks&&e.jsxs("p",{className:"text-xs text-red-600 mb-2",children:[e.jsx("strong",{children:"Technician Notes:"})," ",s.remarks]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-xs text-red-600 font-medium block mb-1",children:"Admin Comment:"}),e.jsx("textarea",{className:"w-full text-xs p-2 border border-red-200 rounded resize-none focus:ring-1 focus:ring-red-500 focus:border-red-500",rows:2,placeholder:"Add admin comment about this failure...",defaultValue:s.adminComment||"",onChange:e=>{}})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-xs text-red-500 font-medium",children:s.completed_at?new Date(s.completed_at).toLocaleDateString():"Unknown"})})]})},t)),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{onClick:()=>{j.success("Admin comments saved successfully")},className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-lg transition-colors",children:"Save Admin Comments"})})]})]})]}):q.diagnosticChecklist?(()=>{try{const s="string"==typeof q.diagnosticChecklist?JSON.parse(q.diagnosticChecklist):q.diagnosticChecklist;if(s.summary){const{total:t,passed:a,failed:r,pending:l}=s.summary;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-blue-600 font-semibold text-lg",children:["Total Tests: ",t]}),e.jsx("span",{className:"text-sm text-gray-600 px-3 py-1 bg-white rounded-full border",children:s.overallStatus||"In Progress"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-green-100 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-green-600 font-bold text-xl",children:a}),e.jsx("div",{className:"text-xs text-green-700 font-medium",children:"Passed"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-100 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-red-600 font-bold text-xl",children:r}),e.jsx("div",{className:"text-xs text-red-700 font-medium",children:"Failed"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-100 rounded-lg border border-yellow-200",children:[e.jsx("div",{className:"text-yellow-600 font-bold text-xl",children:l}),e.jsx("div",{className:"text-xs text-yellow-700 font-medium",children:"Pending"})]})]})]})}return e.jsx("p",{className:"text-sm text-gray-600",children:"Diagnostic tests available"})}catch{return e.jsx("p",{className:"text-sm text-gray-600",children:"Diagnostic data available"})}})():e.jsxs("div",{className:"text-center py-6",children:[e.jsx(k,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"No diagnostic data available"}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Check console logs for diagnostic data fetching details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>{j.info('Use the "Start Diagnosis" button in the repair status section')},className:"block w-full text-sm text-gray-400 font-medium py-2 px-4 bg-gray-50 rounded-lg transition-colors cursor-not-allowed",disabled:!0,children:"Start Diagnostics â†’ (Use Repair Status Section)"}),e.jsx("button",{onClick:()=>{(null==q?void 0:q.id)&&Te(q.id)},className:"block w-full text-sm text-gray-600 hover:text-gray-700 font-medium py-2 px-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:"Refresh Data"})]})]})})]})]}),!1]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100 bg-gray-50 px-4 py-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:"assigned"!==q.status&&e.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),Ie()},className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium text-xs",children:[e.jsx(Q,{className:"w-3 h-3"}),"SMS"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),l()},className:"px-3 py-1.5 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors text-xs font-medium",children:"Close"}),"technician"!==(null==S?void 0:S.role)&&e.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),(()=>{if(!q)return;const e={device:`${q.brand} ${q.model}`,serialNumber:q.serialNumber,customer:(null==Me?void 0:Me.name)||"Unknown Customer",repairCost:(null==we?void 0:we.repairCost)||0,depositAmount:(null==we?void 0:we.depositAmount)||0,totalPaid:(null==ve?void 0:ve.totalPaid)||0,status:q.status,date:(new Date).toLocaleDateString()},s=window.open("","_blank");s?(s.document.write(`\n        <html>\n          <head>\n            <title>Repair Receipt - ${e.device}</title>\n            <style>\n              body { font-family: Arial, sans-serif; margin: 20px; }\n              .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; }\n              .section { margin: 15px 0; }\n              .row { display: flex; justify-content: space-between; margin: 5px 0; }\n              .total { font-weight: bold; border-top: 1px solid #333; padding-top: 10px; }\n            </style>\n          </head>\n          <body>\n            <div class="header">\n              <h2>Device Repair Receipt</h2>\n              <p>LATS CHANCE Repair Center</p>\n            </div>\n            <div class="section">\n              <div class="row"><span>Device:</span><span>${e.device}</span></div>\n              <div class="row"><span>Serial:</span><span>${e.serialNumber}</span></div>\n              <div class="row"><span>Customer:</span><span>${e.customer}</span></div>\n              <div class="row"><span>Date:</span><span>${e.date}</span></div>\n              <div class="row"><span>Status:</span><span>${e.status}</span></div>\n            </div>\n            <div class="section">\n              <div class="row"><span>Repair Cost:</span><span>${n(e.repairCost)}</span></div>\n              <div class="row"><span>Deposit:</span><span>${n(e.depositAmount)}</span></div>\n              <div class="row total"><span>Total Paid:</span><span>${n(e.totalPaid)}</span></div>\n            </div>\n          </body>\n        </html>\n      `),s.document.close(),s.print(),j.success("Receipt generated successfully")):j.error("Unable to open print window. Please check your browser settings.")})()},className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-medium text-xs",children:[e.jsx(Y,{className:"w-3 h-3"}),"Print"]}),e.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),I("repair")},className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium text-xs",children:[e.jsx(T,{className:"w-3 h-3"}),"Repair"]})]})]})]}),Me&&e.jsx(me,{isOpen:X,onClose:()=>ee(!1),customer:Me,onEdit:e=>{}}),q&&e.jsx(be,{device:q,isOpen:le,onClose:()=>ie(!1),onPartsSelected:async e=>{if(q)try{const s=await Promise.all(e.map(async e=>{const s={device_id:q.id,spare_part_id:e.spare_part_id,quantity_needed:e.quantity,cost_per_unit:e.cost_per_unit,notes:e.notes||`Requested for ${q.brand} ${q.model} repair`};return await d(s)})),t=s.filter(e=>e.ok),a=s.filter(e=>!e.ok);t.length>0&&(j.success(`Successfully requested ${t.length} spare parts`),await $e(q.id)),a.length>0&&j.error(`Failed to request ${a.length} spare parts`)}catch(s){j.error("Failed to request spare parts")}}}),ue&&p.createPortal(e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm",style:{zIndex:1e5},children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Reject Spare Parts"}),e.jsx("button",{onClick:()=>{he(!1),fe("")},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:e.jsx(v,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsxs("strong",{children:[ne.length," parts"]}),' will be rejected and returned to "needed" status.']})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rejection Reason (Optional)"}),e.jsx("textarea",{value:je,onChange:e=>fe(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:3,placeholder:"Enter reason for rejection..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{he(!1),fe("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if(0!==ne.length){oe(!0);try{const e=await m(ne,je);if(e.ok&&e.data){const s=se.map(e=>ne.includes(e.id)?{...e,status:"needed",notes:je?`Rejected by customer care: ${je}`:e.notes}:e);te(s),j.success(e.message),de([]),he(!1),fe("")}else j.error(e.message||"Failed to reject parts")}catch(e){j.error("Failed to reject parts")}finally{oe(!1)}}else j.error("Please select parts to reject")},disabled:ce,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[ce&&e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Reject Parts"]})]})]})]})})}),document.body),e.jsx("div",{className:"xl:hidden bg-white border-t border-gray-200 p-2 sm:p-3",children:e.jsxs("div",{className:"flex gap-1.5",children:[(Le||"admin"===(null==S?void 0:S.role)||"customer-care"===(null==S?void 0:S.role))&&e.jsx(e.Fragment,{children:e.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),ie(!0)},className:"flex-1 flex items-center justify-center gap-1.5 px-2 py-1.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors font-medium text-xs",children:[e.jsx(y,{className:"w-3 h-3"}),"Parts"]})}),"customer-care"===(null==S?void 0:S.role)&&Me&&"assigned"!==q.status&&e.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),Ie()},className:"flex-1 flex items-center justify-center gap-1.5 px-2 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium text-xs",children:[e.jsx(Q,{className:"w-3 h-3"}),"SMS"]})]})})]})]}),document.body):p.createPortal(e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm",style:{zIndex:99999},children:e.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx(L,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Device Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The device you're looking for doesn't exist or has been deleted."}),e.jsx(t,{onClick:l,variant:"primary",children:"Close"})]})})}),document.body):p.createPortal(e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm",style:{zIndex:99999},children:e.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-2xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Loading device details..."})]})})}),document.body):null;var ze},Ne=()=>{var t,a;const i=xe(),{currentUser:n}=r();let d=[],o=!1,m=null,p=null;try{const e=c();d=(null==e?void 0:e.devices)||[],o=(null==e?void 0:e.loading)||!1,m=(null==e?void 0:e.deleteDevice)||null,p=(null==e?void 0:e.addDevice)||null}catch(ye){}const[j,f]=u.useState(""),[y,N]=u.useState("all"),[k,C]=u.useState("all"),[D,P]=u.useState("all"),[A,$]=u.useState("all"),[q,M]=u.useState("table"),[E,I]=u.useState("createdAt"),[F,U]=u.useState("desc"),[H,O]=u.useState(!1),[K,W]=u.useState([]),[V,Q]=u.useState([]),[Y,ie]=u.useState(!1),[ne,de]=u.useState(!1),[ce,oe]=u.useState(null),[me,ge]=u.useState(null),[he,be]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const{data:e}=await s.from("users").select("id, full_name, email").eq("role","technician");W(e||[]);const{data:t}=await s.from("customers").select("id, name, phone").order("name");Q(t||[])}catch(ye){}})()},[]);const je=u.useMemo(()=>{const e=d.filter(e=>{var s;const t=""===j||e.brand.toLowerCase().includes(j.toLowerCase())||e.model.toLowerCase().includes(j.toLowerCase())||(null==(s=e.serialNumber)?void 0:s.toLowerCase().includes(j.toLowerCase()))||e.customerName.toLowerCase().includes(j.toLowerCase())||e.phoneNumber.includes(j),a="all"===y||e.status===y,r="all"===k||e.assignedTo===k,l="all"===D||e.customerId===D;let i=!0;if("all"!==A){const s=new Date(e.createdAt),t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(a.getTime()-6048e5),l=new Date(a.getTime()-2592e6);switch(A){case"today":i=s>=a;break;case"week":i=s>=r;break;case"month":i=s>=l}}return t&&a&&r&&l&&i});return e.sort((e,s)=>{let t,a;switch(E){case"createdAt":default:t=new Date(e.createdAt),a=new Date(s.createdAt);break;case"expectedReturnDate":t=new Date(e.expectedReturnDate),a=new Date(s.expectedReturnDate);break;case"status":t=e.status,a=s.status;break;case"customerName":t=e.customerName,a=s.customerName}return"asc"===F?t>a?1:-1:t<a?1:-1}),e},[d,j,y,k,D,A,E,F]),fe=u.useMemo(()=>({total:d.length,active:d.filter(e=>!["done","failed"].includes(e.status)).length,overdue:d.filter(e=>"done"!==e.status&&"failed"!==e.status&&(!!e.expectedReturnDate&&new Date(e.expectedReturnDate)<new Date)).length,completed:d.filter(e=>"done"===e.status).length,failed:d.filter(e=>"failed"===e.status).length}),[d]);return o?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#3498db]"}),e.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading devices..."})]})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{to:"/dashboard"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Device Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage all devices in the repair system"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>be(!0),className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-green-600 text-white hover:bg-green-700 transition-colors text-sm",title:"CBM Calculator",children:[e.jsx(Z,{size:18}),"CBM"]}),e.jsxs("button",{onClick:()=>i("/devices/new"),className:"flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(S,{size:18}),"Add Device"]}),((null==(t=null==n?void 0:n.permissions)?void 0:t.includes("all"))||(null==(a=null==n?void 0:n.permissions)?void 0:a.includes("edit_settings"))||"admin"===(null==n?void 0:n.role))&&e.jsx("button",{onClick:()=>setShowTemplateManagerModal(!0),className:"flex items-center gap-2 px-3 py-2.5 rounded-lg font-medium bg-gray-600 text-white hover:bg-gray-700 transition-colors",children:e.jsx(G,{size:18})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Devices"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:fe.total})]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-5 hover:bg-orange-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"w-7 h-7 text-orange-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:fe.active})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-5 hover:bg-red-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-7 h-7 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:fe.overdue})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:fe.completed})]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-5 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"w-7 h-7 text-gray-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:fe.failed})]})]})})]}),e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(g,{onSearch:f,placeholder:"Search devices by brand, model, serial number, or customer...",className:"w-full",suggestions:d.map(e=>`${e.brand} ${e.model}`),searchKey:"device_search"})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(h,{options:[{value:"all",label:"All Status"},{value:"assigned",label:"Assigned"},{value:"diagnosis-started",label:"Diagnosis Started"},{value:"awaiting-parts",label:"Awaiting Parts"},{value:"in-repair",label:"In Repair"},{value:"reassembled-testing",label:"Testing"},{value:"repair-complete",label:"Repair Complete"},{value:"returned-to-customer-care",label:"Returned to Care"},{value:"done",label:"Done"},{value:"failed",label:"Failed"}],value:y,onChange:e=>N(e),placeholder:"Filter by Status",className:"min-w-[150px]"}),e.jsxs("button",{onClick:()=>O(!H),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(H?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(J,{size:16}),"More Filters",H?e.jsx(X,{size:16}):e.jsx(ee,{size:16})]}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 p-1",children:[e.jsxs("button",{onClick:()=>M("table"),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-md transition-colors "+("table"===q?"bg-white text-gray-900 shadow-sm":"text-gray-600"),children:[e.jsx(se,{size:16}),"Table"]}),e.jsxs("button",{onClick:()=>M("grid"),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-md transition-colors "+("grid"===q?"bg-white text-gray-900 shadow-sm":"text-gray-600"),children:[e.jsx(te,{size:16}),"Grid"]})]})]})]}),H&&e.jsxs("div",{className:"pt-4 border-t border-gray-200 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(h,{options:[{value:"all",label:"All Technicians"},...K.map(e=>({value:e.id,label:e.full_name}))],value:k,onChange:C,placeholder:"Filter by Technician",className:"w-full"}),e.jsx(h,{options:[{value:"all",label:"All Customers"},...V.map(e=>({value:e.id,label:e.name}))],value:D,onChange:P,placeholder:"Filter by Customer",className:"w-full"}),e.jsx(h,{options:[{value:"all",label:"All Time"},{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"}],value:A,onChange:e=>$(e),placeholder:"Filter by Date",className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"Sort by:"}),e.jsxs("select",{value:E,onChange:e=>I(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#3498db] focus:border-transparent bg-white",children:[e.jsx("option",{value:"createdAt",children:"Date Created"}),e.jsx("option",{value:"expectedReturnDate",children:"Return Date"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"customerName",children:"Customer Name"})]}),e.jsx("button",{onClick:()=>U("asc"===F?"desc":"asc"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"asc"===F?"Ascending":"Descending",children:"asc"===F?e.jsx(ae,{size:18}):e.jsx(re,{size:18})})]}),e.jsx("button",{onClick:()=>{f(""),N("all"),C("all"),P("all"),$("all")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Clear All Filters"})]})]})]})}),e.jsxs(l,{className:"p-6",children:["table"===q?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Device"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Customer"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Issue"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Return Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:je.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-[#3498db]/10 rounded-lg flex items-center justify-center",children:e.jsx(z,{className:"w-5 h-5 text-[#3498db]"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[s.brand," ",s.model]}),s.serialNumber&&e.jsxs("p",{className:"text-xs text-gray-500",children:["S/N: ",s.serialNumber]})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.customerName}),e.jsx("p",{className:"text-sm text-gray-500",children:s.phoneNumber})]})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("p",{className:"text-sm text-gray-700 truncate max-w-[250px]",title:s.issueDescription||s.issue,children:s.issueDescription||s.issue||"No description"}),s.estimatedHours&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Est: ",s.estimatedHours,"h"]})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(pe,{status:s.status})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.expectedReturnDate?new Date(s.expectedReturnDate).toLocaleDateString():"Not set"})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{onClick:()=>{oe(s.id),ie(!0)},className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:[e.jsx(le,{size:13}),"View"]}),e.jsxs("button",{onClick:()=>{ge(s),de(!0)},className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-gray-600 text-white hover:bg-gray-700 transition-colors",children:[e.jsx(R,{size:13}),"Edit"]})]})})]},s.id))})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:je.map(s=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 hover:border-gray-300 transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2.5 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 text-sm truncate",children:[s.brand," ",s.model]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s.serialNumber||"No S/N"})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Customer"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate ml-2",title:s.customerName,children:s.customerName})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Status"}),e.jsx(pe,{status:s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Issue"}),e.jsx("span",{className:"text-xs text-gray-700 truncate ml-2 max-w-[150px]",title:s.issueDescription||s.issue,children:s.issueDescription||s.issue||"No description"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Return Date"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-700",children:s.expectedReturnDate?new Date(s.expectedReturnDate).toLocaleDateString():"Not set"})]})]}),s.estimatedHours&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Estimated"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[s.estimatedHours,"h"]})]})]}),e.jsxs("div",{className:"flex gap-1.5 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>{oe(s.id),ie(!0)},className:"flex-1 flex items-center justify-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:[e.jsx(le,{size:13}),"View"]}),e.jsxs("button",{onClick:()=>{ge(s),de(!0)},className:"flex-1 flex items-center justify-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-gray-600 text-white hover:bg-gray-700 transition-colors",children:[e.jsx(R,{size:13}),"Edit"]})]})]},s.id))}),0===je.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No devices found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:j||"all"!==y||"all"!==k||"all"!==D||"all"!==A?"Try adjusting your search or filters":"Get started by adding your first device"}),!j&&"all"===y&&"all"===k&&"all"===D&&"all"===A&&e.jsxs("button",{onClick:()=>i("/devices/new"),className:"flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors mx-auto",children:[e.jsx(S,{size:18}),"Add Your First Device"]})]})]}),ce&&e.jsx(ve,{isOpen:Y,onClose:()=>{ie(!1),oe(null)},deviceId:ce}),me&&ne&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4",style:{zIndex:99999},children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Edit Device"}),e.jsx("button",{onClick:()=>{de(!1),ge(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(v,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),null==me?void 0:me.id)try{await x(me.id,me),w.success("Device updated successfully"),de(!1),ge(null),window.location.reload()}catch(ye){w.error("Failed to update device")}},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand"}),e.jsx("input",{type:"text",value:(null==me?void 0:me.brand)||"",onChange:e=>me&&ge({...me,brand:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),e.jsx("input",{type:"text",value:(null==me?void 0:me.model)||"",onChange:e=>me&&ge({...me,model:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Serial Number"}),e.jsx("input",{type:"text",value:(null==me?void 0:me.serialNumber)||"",onChange:e=>me&&ge({...me,serialNumber:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Issue Description"}),e.jsx("textarea",{value:(null==me?void 0:me.issueDescription)||"",onChange:e=>me&&ge({...me,issueDescription:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:(null==me?void 0:me.status)||"",onChange:e=>me&&ge({...me,status:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"diagnosis-started",children:"Diagnosis Started"}),e.jsx("option",{value:"awaiting-parts",children:"Awaiting Parts"}),e.jsx("option",{value:"parts-arrived",children:"Parts Arrived"}),e.jsx("option",{value:"in-repair",children:"In Repair"}),e.jsx("option",{value:"reassembled-testing",children:"Reassembled Testing"}),e.jsx("option",{value:"repair-complete",children:"Repair Complete"}),e.jsx("option",{value:"returned-to-customer-care",children:"Returned to Customer Care"}),e.jsx("option",{value:"done",children:"Done"}),e.jsx("option",{value:"failed",children:"Failed"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{de(!1),ge(null)},className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200",children:"Save Changes"})]})]})]})})}),e.jsx(ue,{isOpen:he,onClose:()=>be(!1)})]})};export{Ne as DevicesPage,Ne as default};
