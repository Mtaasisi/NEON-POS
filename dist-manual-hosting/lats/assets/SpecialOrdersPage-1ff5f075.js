import{s as e,u as r,a as t,v as s,j as a,t as n}from"./index-222cfb29.js";import{r as l}from"./vendor-a2ff445a.js";import{w as o}from"./whatsappService-37f3bd6b.js";import{B as i}from"./BackButton-e41d1482.js";import{Q as d,y as c,x as u,v as m,D as p,aT as x,$ as g,X as b,n as h,bD as y,bE as f,e as _,d as v}from"./ui-551a39a6.js";import"./supabase-7e851d02.js";import"./routing-a2f0f6d2.js";const j=new class{async generateOrderNumber(){const{data:r,error:t}=await e.from("customer_special_orders").select("order_number").order("created_at",{ascending:!1}).limit(1);if(t)return`SPO-${Date.now().toString().slice(-6)}`;if(!r||0===r.length)return"SPO-001";const s=r[0].order_number.match(/SPO-(\d+)/);if(s){return`SPO-${(parseInt(s[1])+1).toString().padStart(3,"0")}`}return`SPO-${Date.now().toString().slice(-6)}`}async createSpecialOrder(r,t){try{const s=await this.generateOrderNumber(),a=r.total_amount-r.deposit_paid,{data:n,error:l}=await e.from("customer_special_orders").insert({order_number:s,customer_id:r.customer_id,product_name:r.product_name,product_description:r.product_description,quantity:r.quantity,unit_price:r.unit_price,total_amount:r.total_amount,deposit_paid:r.deposit_paid,balance_due:a,expected_arrival_date:r.expected_arrival_date,supplier_name:r.supplier_name,supplier_reference:r.supplier_reference,country_of_origin:r.country_of_origin,tracking_number:r.tracking_number,notes:r.notes,internal_notes:r.internal_notes,status:"deposit_received",created_by:t}).select().single();if(l)throw l;if(r.deposit_paid>0){const{error:a}=await e.from("special_order_payments").insert({special_order_id:n.id,customer_id:r.customer_id,amount:r.deposit_paid,payment_method:r.payment_method,account_id:r.account_id,reference_number:`${s}-DEPOSIT`,notes:"Initial deposit",created_by:t});await this.updateFinanceAccount(r.account_id,r.deposit_paid)}return await this.sendOrderCreatedNotification(n.id,t),{success:!0,order:n}}catch(s){return{success:!1,error:s.message}}}async updateSpecialOrder(r,t,s){try{const{data:a,error:n}=await e.from("customer_special_orders").update({...t,updated_at:(new Date).toISOString()}).eq("id",r).select().single();if(n)throw n;return t.status&&await this.sendStatusUpdateNotification(r,t.status,s),{success:!0,order:a}}catch(a){return{success:!1,error:a.message}}}async recordPayment(r,t){try{const{data:s,error:a}=await e.from("special_order_payments").insert({...r,created_by:t}).select().single();if(a)throw a;return await this.updateFinanceAccount(r.account_id,r.amount),await this.sendPaymentReceivedNotification(r.special_order_id,r.amount,t),{success:!0,payment:s}}catch(s){return{success:!1,error:s.message}}}async getAllSpecialOrders(r){try{let t=e.from("customer_special_orders").select("\n          *,\n          customer:customers(id, name, phone, email),\n          payments:special_order_payments!special_order_id(*)\n        ").order("created_at",{ascending:!1});r&&(t=t.eq("branch_id",r));const{data:s,error:a}=await t;if(a)throw a;return s||[]}catch(t){return[]}}async getSpecialOrderById(r){try{const{data:t,error:s}=await e.from("customer_special_orders").select("\n          *,\n          customer:customers(id, name, phone, email),\n          payments:special_order_payments!special_order_id(*)\n        ").eq("id",r).single();if(s)throw s;return t}catch(t){return null}}async getCustomerSpecialOrders(r){try{const{data:t,error:s}=await e.from("customer_special_orders").select("*").eq("customer_id",r).order("created_at",{ascending:!1});if(s)throw s;return t||[]}catch(t){return[]}}async getStatistics(r){try{let t=e.from("customer_special_orders").select("*");r&&(t=t.eq("branch_id",r));const{data:s,error:a}=await t;if(a)throw a;const n=s||[];return{total:n.length,deposit_received:n.filter(e=>"deposit_received"===e.status).length,ordered:n.filter(e=>"ordered"===e.status).length,in_transit:n.filter(e=>"in_transit"===e.status).length,arrived:n.filter(e=>"arrived"===e.status).length,ready_for_pickup:n.filter(e=>"ready_for_pickup"===e.status).length,delivered:n.filter(e=>"delivered"===e.status).length,cancelled:n.filter(e=>"cancelled"===e.status).length,total_value:n.reduce((e,r)=>e+Number(r.total_amount||0),0),total_deposits:n.reduce((e,r)=>e+Number(r.deposit_paid||0),0),total_balance_due:n.reduce((e,r)=>e+Number(r.balance_due||0),0)}}catch(t){return{total:0,deposit_received:0,ordered:0,in_transit:0,arrived:0,ready_for_pickup:0,delivered:0,cancelled:0,total_value:0,total_deposits:0,total_balance_due:0}}}async deleteSpecialOrder(r){try{const{error:t}=await e.from("customer_special_orders").delete().eq("id",r);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:t.message}}}async updateFinanceAccount(r,t){try{const{data:s,error:a}=await e.from("finance_accounts").select("balance").eq("id",r).single();if(a||!s)return;const n=Number(s.balance)+t,{error:l}=await e.from("finance_accounts").update({balance:n,updated_at:(new Date).toISOString()}).eq("id",r)}catch(s){}}async sendOrderCreatedNotification(r,t){try{const a=await this.getSpecialOrderById(r);if(!a||!a.customer)return;const n=`âœ… Special Order Confirmed!\n\nThank you for your order ${a.order_number}!\n\nProduct: ${a.product_name}\nQuantity: ${a.quantity}\nTotal: ${this.formatCurrency(a.total_amount)}\nDeposit Paid: ${this.formatCurrency(a.deposit_paid)}\nBalance: ${this.formatCurrency(a.balance_due)}\n\n${a.expected_arrival_date?`Expected Arrival: ${this.formatDate(a.expected_arrival_date)}\n`:""}We'll keep you updated on your order status!`;a.customer.phone&&await o.sendWhatsAppMessage(a.customer.phone,n,a.customer_id);try{await e.from("notifications").insert({user_id:t,type:"payment",category:"payment",title:"Special Order Created",message:`Order ${a.order_number} created for ${a.customer.name}`,priority:"normal",status:"unread",metadata:{orderId:a.id,orderNumber:a.order_number}})}catch(s){}}catch(s){}}async sendStatusUpdateNotification(r,t,s){try{const n=await this.getSpecialOrderById(r);if(!n||!n.customer)return;const l={deposit_received:"âœ… Deposit Received",ordered:"ðŸ“¦ Ordered from Supplier",in_transit:"ðŸš¢ In Transit",arrived:"âœ¨ Arrived at Store",ready_for_pickup:"ðŸŽ‰ Ready for Pickup",delivered:"âœ… Delivered",cancelled:"âŒ Cancelled"},i={deposit_received:`Your deposit of ${this.formatCurrency(n.deposit_paid)} has been received for order ${n.order_number}.`,ordered:`Good news! We've ordered your ${n.product_name} from ${n.country_of_origin||"our supplier"}. ${n.tracking_number?`Tracking: ${n.tracking_number}`:"We'll update you when it ships."}`,in_transit:`Your ${n.product_name} is on the way! ${n.expected_arrival_date?`Expected arrival: ${this.formatDate(n.expected_arrival_date)}`:""}`,arrived:`Great news! Your ${n.product_name} has arrived!${n.balance_due>0?`\n\nBalance due: ${this.formatCurrency(n.balance_due)}\nPlease visit us to collect your order.`:"\nReady for pickup!"}`,ready_for_pickup:`Your ${n.product_name} is ready for pickup! Please visit our store to collect it.`,delivered:`Thank you! Your order ${n.order_number} has been completed. We hope you enjoy your ${n.product_name}!`,cancelled:`Your order ${n.order_number} has been cancelled. Please contact us if you have any questions.`},d=l[t],c=`${d}\n\nOrder: ${n.order_number}\nProduct: ${n.product_name}\n\n${i[t]}`;n.customer.phone&&await o.sendWhatsAppMessage(n.customer.phone,c,n.customer_id);try{await e.from("notifications").insert({user_id:s,type:"system",category:"general",title:d,message:`Order ${n.order_number} - ${n.product_name}`,priority:"arrived"===t?"high":"normal",status:"unread",metadata:{orderId:n.id,status:t}})}catch(a){}}catch(a){}}async sendPaymentReceivedNotification(r,t,s){try{const n=await this.getSpecialOrderById(r);if(!n||!n.customer)return;const l=`âœ… Payment Received!\n\nOrder: ${n.order_number}\nProduct: ${n.product_name}\n\nAmount Paid: ${this.formatCurrency(t)}\nTotal Paid: ${this.formatCurrency(n.deposit_paid)}\nRemaining Balance: ${this.formatCurrency(n.balance_due)}\n\nThank you for your payment!`;n.customer.phone&&await o.sendWhatsAppMessage(n.customer.phone,l,n.customer_id);try{await e.from("notifications").insert({user_id:s,type:"payment",category:"payment",title:"Payment Received",message:`${this.formatCurrency(t)} received for order ${n.order_number}`,priority:"normal",status:"unread",metadata:{orderId:n.id,amount:t}})}catch(a){}}catch(a){}}formatCurrency(e){return new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(e)}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}},N=()=>{const{currentUser:e}=r(),{customers:o}=t(),{currentBranch:N}=s(),[k,O]=l.useState([]),[P,$]=l.useState(null),[q,A]=l.useState(!0),[D,T]=l.useState(!1),[I,F]=l.useState(!1),[z,R]=l.useState(!1),[B,U]=l.useState(null),[M,Z]=l.useState("all"),[E,L]=l.useState(""),[W,Y]=l.useState([]),Q=async()=>{A(!0);try{const e=await j.getAllSpecialOrders(null==N?void 0:N.id);O(e);const r=await j.getStatistics(null==N?void 0:N.id);$(r)}catch(e){h.error("Failed to load special orders")}finally{A(!1)}};l.useEffect(()=>{Q(),(async()=>{try{const e=await n.getPaymentMethods();Y(e)}catch(e){}})()},[N]);const G=l.useMemo(()=>k.filter(e=>{var r;const t="all"===M||e.status===M,s=""===E||e.order_number.toLowerCase().includes(E.toLowerCase())||e.product_name.toLowerCase().includes(E.toLowerCase())||(null==(r=e.customer)?void 0:r.name.toLowerCase().includes(E.toLowerCase()));return t&&s}),[k,M,E]),H=e=>({deposit_received:a.jsx(p,{size:14}),ordered:a.jsx(u,{size:14}),in_transit:a.jsx(y,{size:14}),arrived:a.jsx(f,{size:14}),ready_for_pickup:a.jsx(_,{size:14}),delivered:a.jsx(v,{size:14}),cancelled:a.jsx(b,{size:14})}[e]),J=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(e);return q?a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading special orders..."})]})}):a.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[a.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(i,{to:"/dashboard"}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Special Orders"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Manage pre-orders and import requests"})]})]}),a.jsxs("button",{onClick:()=>T(!0),className:"flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm",children:[a.jsx(d,{size:18}),"New Special Order"]})]}),P&&a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-3",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P.total}),a.jsx("div",{className:"text-xs text-gray-600",children:"Total Orders"})]}),a.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-600",children:P.deposit_received+P.ordered+P.in_transit}),a.jsx("div",{className:"text-xs text-blue-600",children:"In Progress"})]}),a.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600",children:P.arrived+P.ready_for_pickup}),a.jsx("div",{className:"text-xs text-green-600",children:"Ready"})]}),a.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[a.jsx("div",{className:"text-2xl font-bold text-purple-600",children:J(P.total_balance_due)}),a.jsx("div",{className:"text-xs text-purple-600",children:"Balance Due"})]})]}),a.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 space-y-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),a.jsx("input",{type:"text",placeholder:"Search orders, products, customers...",value:E,onChange:e=>L(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("select",{value:M,onChange:e=>Z(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"deposit_received",children:"Deposit Received"}),a.jsx("option",{value:"ordered",children:"Ordered"}),a.jsx("option",{value:"in_transit",children:"In Transit"}),a.jsx("option",{value:"arrived",children:"Arrived"}),a.jsx("option",{value:"ready_for_pickup",children:"Ready for Pickup"}),a.jsx("option",{value:"delivered",children:"Delivered"}),a.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})}),a.jsx("div",{className:"space-y-3",children:0===G.length?a.jsxs("div",{className:"bg-white rounded-lg p-12 text-center border border-gray-200",children:[a.jsx(u,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"No special orders found"}),a.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Create your first special order to get started"}),a.jsxs("button",{onClick:()=>T(!0),className:"mt-4 px-5 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm inline-flex items-center gap-2",children:[a.jsx(d,{size:18}),"New Special Order"]})]}):G.map(e=>{var r,t;return a.jsx("div",{className:"bg-white rounded-lg p-5 border border-gray-200 hover:shadow-md transition-shadow",children:a.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[a.jsx("div",{className:"flex-1 space-y-2",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(u,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:e.order_number}),a.jsxs("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold flex items-center gap-1 ${t=e.status,{deposit_received:"bg-blue-100 text-blue-700",ordered:"bg-purple-100 text-purple-700",in_transit:"bg-yellow-100 text-yellow-700",arrived:"bg-green-100 text-green-700",ready_for_pickup:"bg-emerald-100 text-emerald-700",delivered:"bg-gray-100 text-gray-700",cancelled:"bg-red-100 text-red-700"}[t]||"bg-gray-100 text-gray-700"}`,children:[H(e.status),e.status.replace("_"," ").toUpperCase()]})]}),a.jsx("p",{className:"text-gray-700 font-medium mt-1",children:e.product_name}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mt-1",children:[a.jsxs("span",{children:["Customer: ",null==(r=e.customer)?void 0:r.name]}),a.jsx("span",{children:"â€¢"}),a.jsxs("span",{children:["Qty: ",e.quantity]}),e.country_of_origin&&a.jsxs(a.Fragment,{children:[a.jsx("span",{children:"â€¢"}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(m,{size:14}),e.country_of_origin]})]})]})]})]})}),a.jsxs("div",{className:"flex flex-col lg:items-end gap-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-xs text-gray-600",children:["Total: ",a.jsx("span",{className:"font-bold text-gray-900",children:J(e.total_amount)})]}),a.jsxs("div",{className:"text-xs text-green-600",children:["Paid: ",a.jsx("span",{className:"font-bold",children:J(e.deposit_paid)})]}),e.balance_due>0&&a.jsxs("div",{className:"text-xs text-red-600",children:["Balance: ",a.jsx("span",{className:"font-bold",children:J(e.balance_due)})]})]}),a.jsxs("div",{className:"flex gap-2",children:[e.balance_due>0&&a.jsxs("button",{onClick:()=>{U(e),F(!0)},className:"px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-xs font-medium flex items-center gap-1",children:[a.jsx(p,{size:14}),"Record Payment"]}),a.jsxs("button",{onClick:()=>{U(e),R(!0)},className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs font-medium flex items-center gap-1",children:[a.jsx(x,{size:14}),"Update"]}),a.jsx("button",{onClick:()=>(async e=>{if(!confirm("Are you sure you want to delete this special order?"))return;const r=await j.deleteSpecialOrder(e);r.success?(h.success("Special order deleted successfully"),Q()):h.error(r.error||"Failed to delete order")})(e.id),className:"px-3 py-1.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-xs font-medium",children:a.jsx(g,{size:14})})]})]})]})},e.id)})}),D&&a.jsx(w,{isOpen:D,onClose:()=>T(!1),onSuccess:()=>{T(!1),Q()},customers:o,paymentAccounts:W,currentUser:e}),I&&B&&a.jsx(S,{isOpen:I,onClose:()=>{F(!1),U(null)},onSuccess:()=>{F(!1),U(null),Q()},order:B,paymentAccounts:W,currentUser:e}),z&&B&&a.jsx(C,{isOpen:z,onClose:()=>{R(!1),U(null)},onSuccess:()=>{R(!1),U(null),Q()},order:B,currentUser:e})]})},w=({isOpen:e,onClose:r,onSuccess:t,customers:s,paymentAccounts:n,currentUser:o})=>{const[i,d]=l.useState({customer_id:"",product_name:"",product_description:"",quantity:1,unit_price:0,total_amount:0,deposit_paid:0,supplier_name:"",supplier_reference:"",country_of_origin:"",tracking_number:"",expected_arrival_date:"",notes:"",internal_notes:"",payment_method:"cash",account_id:""}),[c,m]=l.useState(!1);l.useEffect(()=>{i.quantity&&i.unit_price&&d(e=>({...e,total_amount:e.quantity*e.unit_price}))},[i.quantity,i.unit_price]);return e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(u,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Special Order"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Pre-order or import request"})]})]}),a.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(b,{size:20})})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i.customer_id&&i.product_name&&i.account_id){m(!0);try{const e=await j.createSpecialOrder(i,null==o?void 0:o.id);e.success?(h.success("Special order created successfully!"),t()):h.error(e.error||"Failed to create special order")}catch(r){h.error(r.message||"An error occurred")}finally{m(!1)}}else h.error("Please fill in all required fields")},className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Customer ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:i.customer_id,onChange:e=>d(r=>({...r,customer_id:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[a.jsx("option",{value:"",children:"Select Customer"}),s.map(e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.phone]},e.id))]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Product Name ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:i.product_name,onChange:e=>d(r=>({...r,product_name:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., iPhone 15 Pro Max",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Description"}),a.jsx("textarea",{value:i.product_description,onChange:e=>d(r=>({...r,product_description:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Specifications, color, etc.",rows:2})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Quantity ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",value:i.quantity,onChange:e=>d(r=>({...r,quantity:parseInt(e.target.value)||0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Unit Price ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",value:i.unit_price,onChange:e=>d(r=>({...r,unit_price:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",step:"0.01",required:!0})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Amount"}),a.jsx("input",{type:"number",value:i.total_amount,readOnly:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Deposit Paid ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",value:i.deposit_paid,onChange:e=>d(r=>({...r,deposit_paid:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",step:"0.01",required:!0})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Method ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:i.payment_method,onChange:e=>d(r=>({...r,payment_method:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[a.jsx("option",{value:"cash",children:"Cash"}),a.jsx("option",{value:"mobile_money",children:"Mobile Money"}),a.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),a.jsx("option",{value:"card",children:"Card"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Account ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:i.account_id,onChange:e=>d(r=>({...r,account_id:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[a.jsx("option",{value:"",children:"Select Account"}),n.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Name"}),a.jsx("input",{type:"text",value:i.supplier_name,onChange:e=>d(r=>({...r,supplier_name:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Supplier or store name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Reference"}),a.jsx("input",{type:"text",value:i.supplier_reference,onChange:e=>d(r=>({...r,supplier_reference:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Invoice/Order number"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country of Origin"}),a.jsx("input",{type:"text",value:i.country_of_origin,onChange:e=>d(r=>({...r,country_of_origin:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Dubai, China"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tracking Number"}),a.jsx("input",{type:"text",value:i.tracking_number,onChange:e=>d(r=>({...r,tracking_number:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Shipping tracking number"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Arrival Date"}),a.jsx("input",{type:"date",value:i.expected_arrival_date,onChange:e=>d(r=>({...r,expected_arrival_date:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),a.jsx("textarea",{value:i.notes,onChange:e=>d(r=>({...r,notes:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Customer-facing notes...",rows:2})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Internal Notes"}),a.jsx("textarea",{value:i.internal_notes,onChange:e=>d(r=>({...r,internal_notes:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-yellow-50 border-yellow-200",placeholder:"Staff-only notes (not visible to customer)...",rows:2})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:c,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Creating...":"Create Special Order"})]})]})]})}):null},S=({isOpen:e,onClose:r,onSuccess:t,order:s,paymentAccounts:n,currentUser:o})=>{var i;const[d,c]=l.useState({special_order_id:s.id,customer_id:s.customer_id,amount:s.balance_due,payment_method:"cash",account_id:"",reference_number:"",notes:""}),[u,m]=l.useState(!1);return e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(p,{className:"w-5 h-5 text-green-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Record Payment"}),a.jsx("p",{className:"text-sm text-gray-600",children:s.order_number})]})]}),a.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(b,{size:20})})]}),a.jsx("div",{className:"p-6 bg-gray-50 border-b border-gray-200",children:a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Product:"}),a.jsx("span",{className:"font-medium text-gray-900",children:s.product_name})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Customer:"}),a.jsx("span",{className:"font-medium text-gray-900",children:null==(i=s.customer)?void 0:i.name})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Total Amount:"}),a.jsx("span",{className:"font-bold text-gray-900",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(s.total_amount)})]}),a.jsxs("div",{className:"flex justify-between text-green-600",children:[a.jsx("span",{children:"Paid:"}),a.jsx("span",{className:"font-bold",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(s.deposit_paid)})]}),a.jsxs("div",{className:"flex justify-between text-red-600 text-base",children:[a.jsx("span",{children:"Balance Due:"}),a.jsx("span",{className:"font-bold",children:new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(s.balance_due)})]})]})}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d.account_id){m(!0);try{const e=await j.recordPayment(d,null==o?void 0:o.id);e.success?(h.success("Payment recorded successfully!"),t()):h.error(e.error||"Failed to record payment")}catch(r){h.error(r.message||"An error occurred")}finally{m(!1)}}else h.error("Please select a payment account")},className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Amount ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",value:d.amount,onChange:e=>c(r=>({...r,amount:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",max:s.balance_due,step:"0.01",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Method ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:d.payment_method,onChange:e=>c(r=>({...r,payment_method:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[a.jsx("option",{value:"cash",children:"Cash"}),a.jsx("option",{value:"mobile_money",children:"Mobile Money"}),a.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),a.jsx("option",{value:"card",children:"Card"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Account ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:d.account_id,onChange:e=>c(r=>({...r,account_id:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[a.jsx("option",{value:"",children:"Select Account"}),n.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number"}),a.jsx("input",{type:"text",value:d.reference_number,onChange:e=>c(r=>({...r,reference_number:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Transaction reference"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),a.jsx("textarea",{value:d.notes,onChange:e=>c(r=>({...r,notes:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Payment notes...",rows:2})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-4 py-2.5 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Recording...":"Record Payment"})]})]})]})}):null},C=({isOpen:e,onClose:r,onSuccess:t,order:s,currentUser:n})=>{const[o,i]=l.useState({status:s.status,tracking_number:s.tracking_number||"",supplier_reference:s.supplier_reference||"",expected_arrival_date:s.expected_arrival_date||"",actual_arrival_date:s.actual_arrival_date||"",notes:s.notes||"",internal_notes:s.internal_notes||""}),[d,c]=l.useState(!1);return e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(x,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Order Status"}),a.jsx("p",{className:"text-sm text-gray-600",children:s.order_number})]})]}),a.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(b,{size:20})})]}),a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(!0);try{const e=await j.updateSpecialOrder(s.id,o,null==n?void 0:n.id);e.success?(h.success("Order updated successfully!"),t()):h.error(e.error||"Failed to update order")}catch(r){h.error(r.message||"An error occurred")}finally{c(!1)}},className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Status ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:o.status,onChange:e=>i(r=>({...r,status:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[a.jsx("option",{value:"deposit_received",children:"Deposit Received"}),a.jsx("option",{value:"ordered",children:"Ordered"}),a.jsx("option",{value:"in_transit",children:"In Transit"}),a.jsx("option",{value:"arrived",children:"Arrived"}),a.jsx("option",{value:"ready_for_pickup",children:"Ready for Pickup"}),a.jsx("option",{value:"delivered",children:"Delivered"}),a.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tracking Number"}),a.jsx("input",{type:"text",value:o.tracking_number,onChange:e=>i(r=>({...r,tracking_number:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Shipment tracking number"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Reference"}),a.jsx("input",{type:"text",value:o.supplier_reference,onChange:e=>i(r=>({...r,supplier_reference:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Supplier order reference"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Arrival"}),a.jsx("input",{type:"date",value:o.expected_arrival_date,onChange:e=>i(r=>({...r,expected_arrival_date:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Actual Arrival"}),a.jsx("input",{type:"date",value:o.actual_arrival_date,onChange:e=>i(r=>({...r,actual_arrival_date:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Notes"}),a.jsx("textarea",{value:o.notes,onChange:e=>i(r=>({...r,notes:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes visible to customer...",rows:2})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Internal Notes"}),a.jsx("textarea",{value:o.internal_notes,onChange:e=>i(r=>({...r,internal_notes:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Internal notes (not visible to customer)...",rows:2})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:d,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Updating...":"Update Order"})]})]})]})}):null};export{N as default};
