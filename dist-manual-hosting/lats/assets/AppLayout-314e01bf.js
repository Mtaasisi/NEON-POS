import{u as e,s as t,q as s,j as r,t as a,G as n,v as l,a as i,w as o,b as d}from"./index-222cfb29.js";import{r as c,b as m}from"./vendor-a2ff445a.js";import{u,a as x,O as g,L as h}from"./routing-a2f0f6d2.js";import{u as b}from"./useBusinessInfo-13b9c3ff.js";import{A as p}from"./AddCustomerModal-a69277f6.js";import{r as f}from"./reminderApi-01c80b0e.js";import{ay as y,v,b as j,az as w,z as N,Z as k,ah as C,e as S,aA as $,d as _,aB as z,D,a5 as E,aC as A,aD as F,m as I,n as T,am as R,u as L,f as P,aE as M,U as W,X as O,y as q,aF as B,i as U,V as G,t as K,x as H,a1 as J,aG as Q,aH as Y,aI as V,Q as Z,ab as X,T as ee,ao as te,a as se,aa as re,a4 as ae,aJ as ne,aK as le,aL as ie,_ as oe,aM as de,aN as ce,Y as me,aO as ue,p as xe,a0 as ge,s as he,aP as be}from"./ui-551a39a6.js";import{M as pe}from"./Modal-ccfa5014.js";import{G as fe}from"./GlassInput-ba5c3c0d.js";import{G as ye}from"./GlassSelect-3b56e5f5.js";import{u as ve}from"./useBodyScrollLock-0216d39f.js";import{S as je,a as we}from"./SearchResults-b4708312.js";import"./supabase-7e851d02.js";import"./CustomerForm-05944812.js";import"./phoneUtils-1ba19aca.js";import"./useSuccessModal-e8b7d685.js";import"./SuccessModalIcons-20b743c5.js";import"./utils-fb833cf6.js";import"./charts-66cc82bb.js";const Ne={formatTime(e){const t=new Date(e),s=(new Date).getTime()-t.getTime(),r=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<1?"Just now":r<60?`${r}m ago`:a<24?`${a}h ago`:n<7?`${n}d ago`:t.toLocaleDateString()},getNotificationIcon:e=>({device_status_change:"ðŸ“±",new_customer:"ðŸ‘¤",payment_received:"ðŸ’°",inventory_low:"ðŸ“¦",system_alert:"âš ï¸",appointment_reminder:"ðŸ“…",diagnostic_complete:"ðŸ”",repair_complete:"âœ…",customer_feedback:"ðŸ’¬",whatsapp_message:"ðŸ“±",backup_complete:"ðŸ’¾",security_alert:"ðŸ”’",goal_achieved:"ðŸŽ¯",overdue_device:"â°",new_remark:"ðŸ’­",loyalty_points:"â­",bulk_sms_sent:"ðŸ“¨",export_complete:"ðŸ“Š"}[e]||"ðŸ””"),getNotificationColor(e){const t={low:"text-gray-500 bg-gray-50",normal:"text-blue-600 bg-blue-50",high:"text-orange-600 bg-orange-50",urgent:"text-red-600 bg-red-50"};return t[e]||t.normal},getNotificationBorderColor(e){const t={low:"border-gray-200",normal:"border-blue-200",high:"border-orange-200",urgent:"border-red-200"};return t[e]||t.normal},getCategoryDisplayName:e=>({devices:"Devices",customers:"Customers",payments:"Payments",inventory:"Inventory",system:"System",appointments:"Appointments",loyalty:"Loyalty",communications:"Communications",backup:"Backup",security:"Security",goals:"Goals"}[e]||e),getPriorityDisplayName:e=>({low:"Low",normal:"Normal",high:"High",urgent:"Urgent"}[e]||e),groupNotifications(e){const t={};return e.forEach(e=>{const s=`${e.type}_${e.category}`;t[s]||(t[s]={id:s,type:e.type,category:e.category,title:this.getCategoryDisplayName(e.category),notifications:[],unreadCount:0,createdAt:e.createdAt,latestNotification:e}),t[s].notifications.push(e),"unread"===e.status&&t[s].unreadCount++,new Date(e.createdAt)>new Date(t[s].latestNotification.createdAt)&&(t[s].latestNotification=e,t[s].createdAt=e.createdAt)}),Object.values(t).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())},filterNotifications:(e,t)=>e.filter(e=>{if(t.status&&t.status.length>0&&!t.status.includes(e.status))return!1;if(t.category&&t.category.length>0&&!t.category.includes(e.category))return!1;if(t.priority&&t.priority.length>0&&!t.priority.includes(e.priority))return!1;if(t.type&&t.type.length>0&&!t.type.includes(e.type))return!1;if(t.search){const s=t.search.toLowerCase(),r=e.title.toLowerCase().includes(s),a=e.message.toLowerCase().includes(s);if(!r&&!a)return!1}return!0}),sortNotifications:(e,t="date",s="desc")=>e&&Array.isArray(e)?[...e].sort((e,r)=>{let a=0;switch(t){case"date":a=new Date(e.createdAt).getTime()-new Date(r.createdAt).getTime();break;case"priority":const t={urgent:4,high:3,normal:2,low:1};a=t[e.priority]-t[r.priority];break;case"category":a=e.category.localeCompare(r.category)}return"desc"===s?-a:a}):[],isRecent(e){const t=new Date,s=new Date(e.createdAt);return(t.getTime()-s.getTime())/36e5<24},getGroupSummary(e){const{notifications:t,unreadCount:s}=e;return 1===t.length?t[0].message:s>0?`${s} new ${e.type.replace("_"," ")} notification${s>1?"s":""}`:`${t.length} ${e.type.replace("_"," ")} notification${t.length>1?"s":""}`},generateNotificationId:()=>`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,validateNotification:e=>["type","category","title","message","priority"].every(t=>void 0!==e[t])};function ke(e){return{id:e.id,type:e.type,category:e.category,title:e.title,message:e.message,priority:e.priority,status:e.status,createdAt:e.created_at,readAt:e.read_at,actionedAt:e.actioned_at,dismissedAt:e.dismissed_at,actionedBy:e.actioned_by,dismissedBy:e.dismissed_by,deviceId:e.device_id,customerId:e.customer_id,userId:e.user_id,appointmentId:e.appointment_id,diagnosticId:e.diagnostic_id,metadata:e.metadata,icon:e.icon,color:e.color,actionUrl:e.action_url,actionText:e.action_text,groupId:e.group_id,isGrouped:e.is_grouped,groupCount:e.group_count}}const Ce=()=>{const{currentUser:s}=e(),[r,a]=c.useState([]),[n,l]=c.useState(!1),[i,o]=c.useState(null),[d,m]=c.useState({}),[u,x]=c.useState({total:0,unread:0,read:0,actioned:0,dismissed:0,byCategory:{},byPriority:{},byType:{},today:0,thisWeek:0,thisMonth:0}),g=c.useCallback(async()=>{if(s){l(!0),o(null);try{let e=t.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});d.status&&d.status.length>0&&(e=e.in("status",d.status)),d.category&&d.category.length>0&&(e=e.in("category",d.category)),d.priority&&d.priority.length>0&&(e=e.in("priority",d.priority)),d.type&&d.type.length>0&&(e=e.in("type",d.type)),d.dateRange&&(e=e.gte("created_at",d.dateRange.start).lte("created_at",d.dateRange.end)),d.deviceId&&(e=e.eq("device_id",d.deviceId)),d.customerId&&(e=e.eq("customer_id",d.customerId));const{data:r,error:n}=await e;if(n)throw n;let l=(r||[]).map(ke);d.search&&(l=Ne.filterNotifications(l,{search:d.search})),a(l)}catch(e){o(e instanceof Error?e.message:"Failed to fetch notifications")}finally{l(!1)}}},[s,d]),h=c.useCallback(e=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(s.getTime()-6048e5),a=new Date(s.getFullYear(),s.getMonth()-1,s.getDate()),n={total:e.length,unread:e.filter(e=>"unread"===e.status).length,read:e.filter(e=>"read"===e.status).length,actioned:e.filter(e=>"actioned"===e.status).length,dismissed:e.filter(e=>"dismissed"===e.status).length,byCategory:{},byPriority:{},byType:{},today:e.filter(e=>new Date(e.createdAt)>=s).length,thisWeek:e.filter(e=>new Date(e.createdAt)>=r).length,thisMonth:e.filter(e=>new Date(e.createdAt)>=a).length};return e.forEach(e=>{n.byCategory[e.category]=(n.byCategory[e.category]||0)+1,n.byPriority[e.priority]=(n.byPriority[e.priority]||0)+1,n.byType[e.type]=(n.byType[e.type]||0)+1}),n},[]),b=c.useCallback(async(e,r,n)=>{if(s)try{const l={status:r};"read"===r?l.read_at=(new Date).toISOString():"actioned"===r?(l.actioned_at=(new Date).toISOString(),l.actioned_by=n||s.id):"dismissed"===r&&(l.dismissed_at=(new Date).toISOString(),l.dismissed_by=n||s.id);const{error:i}=await t.from("notifications").update(l).eq("id",e).eq("user_id",s.id);if(i)throw i;a(t=>t.map(t=>t.id===e?{...t,...l}:t))}catch(l){o(l instanceof Error?l.message:"Failed to update notification")}},[s]),p=c.useCallback(e=>b(e,"read"),[b]),f=c.useCallback((e,t)=>b(e,"actioned",t),[b]),y=c.useCallback((e,t)=>b(e,"dismissed",t),[b]),v=c.useCallback(async()=>{if(s)try{const{error:e}=await t.from("notifications").update({status:"read",read_at:(new Date).toISOString()}).eq("user_id",s.id).eq("status","unread");if(e)throw e;a(e=>e.map(e=>"unread"===e.status?{...e,status:"read",readAt:(new Date).toISOString()}:e))}catch(e){o(e instanceof Error?e.message:"Failed to mark all as read")}},[s]),j=c.useCallback(async()=>{if(s)try{const{error:e}=await t.from("notifications").delete().eq("user_id",s.id);if(e)throw e;a([])}catch(e){o(e instanceof Error?e.message:"Failed to clear notifications")}},[s]),w=c.useMemo(()=>{let e=r;return d.status&&d.status.length>0&&(e=e.filter(e=>d.status.includes(e.status))),d.category&&d.category.length>0&&(e=e.filter(e=>d.category.includes(e.category))),d.priority&&d.priority.length>0&&(e=e.filter(e=>d.priority.includes(e.priority))),d.type&&d.type.length>0&&(e=e.filter(e=>d.type.includes(e.type))),d.search&&(e=Ne.filterNotifications(e,{search:d.search})),Ne.sortNotifications(e,"date","desc")},[r,d]),N=c.useMemo(()=>w.filter(e=>"unread"===e.status),[w]),k=c.useMemo(()=>w.filter(e=>Ne.isRecent(e)),[w]);return c.useEffect(()=>{const e=h(r);x(e)},[r,h]),c.useEffect(()=>{g()},[g]),c.useEffect(()=>{if(!s)return;const e=t.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${s.id}`},e=>{if("INSERT"===e.eventType){const t=ke(e.new);a(e=>[t,...e])}else if("UPDATE"===e.eventType){const t=ke(e.new);a(e=>e.map(e=>e.id===t.id?t:e))}else"DELETE"===e.eventType&&a(t=>t.filter(t=>t.id!==e.old.id))}).subscribe();return()=>{e.unsubscribe()}},[s]),{notifications:w,unreadNotifications:N,recentNotifications:k,loading:n,error:i,stats:u,filters:d,setFilters:m,markAsRead:p,markAsActioned:f,dismissNotification:y,markAllAsRead:v,clearAllNotifications:j,refetch:g}},Se=({className:a=""})=>{const{currentUser:n}=e(),{isDark:l}=s(),[i,o]=c.useState([]),[d,m]=c.useState(""),[u,x]=c.useState(!1),[g,h]=c.useState(!0);c.useEffect(()=>{b()},[]);const b=async()=>{try{const{data:e,error:s}=await t.from("store_locations").select("id, name, code, city, is_main, data_isolation_mode, is_active").eq("is_active",!0).order("is_main",{ascending:!1});if(s)return void h(!1);o(e||[]);const r=localStorage.getItem("current_branch_id"),a=null==e?void 0:e.find(e=>e.is_main),n=(null==e?void 0:e.find(e=>e.id===r))||a||(null==e?void 0:e[0]);n&&(m(n.id),localStorage.setItem("current_branch_id",n.id)),h(!1)}catch(e){h(!1)}};if("admin"!==(null==n?void 0:n.role))return null;if(g)return r.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg shadow-sm bg-blue-600 text-white ${a}`,children:[r.jsx("div",{className:"p-1 rounded bg-white/15",children:r.jsx(y,{className:"w-3.5 h-3.5 text-white animate-pulse"})}),r.jsx("span",{className:"text-xs font-medium text-white",children:"Loading..."})]});const p=i.find(e=>e.id===d);if(!p)return r.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg shadow-sm ${l?"bg-gray-600":"bg-gray-500"} text-white ${a}`,children:[r.jsx("div",{className:"p-1 rounded bg-white/15",children:r.jsx(y,{className:"w-3.5 h-3.5 text-white"})}),r.jsx("span",{className:"text-xs font-medium text-white",children:"No branches"})]});return r.jsxs("div",{className:`relative ${a}`,children:[r.jsxs("button",{onClick:()=>{x(!u)},className:`group flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-300 cursor-pointer ${u?"shadow-md scale-105":"shadow-sm"} ${l?"bg-blue-600 hover:bg-blue-500":"bg-blue-600 hover:bg-blue-700"} text-white`,title:"Click to switch branches",children:[r.jsx("div",{className:"p-1 rounded transition-all bg-white/15 group-hover:bg-white/25",children:r.jsx(y,{className:"w-3.5 h-3.5 text-white"})}),r.jsxs("div",{className:"flex flex-col items-start flex-1 min-w-0",children:[r.jsx("span",{className:"text-xs font-semibold text-white truncate w-full leading-tight",children:p.name}),r.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-white/80",children:[r.jsx(v,{className:"w-2.5 h-2.5 flex-shrink-0"}),r.jsx("span",{className:"truncate",children:p.city})]})]}),r.jsx(j,{className:"w-3.5 h-3.5 text-white/70 flex-shrink-0 transition-transform duration-300 "+(u?"rotate-180":"")})]}),u&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>x(!1)}),r.jsxs("div",{className:"absolute top-full mt-2 right-0 w-80 rounded-lg shadow-xl border-2 z-50 max-h-96 overflow-auto "+(l?"bg-slate-800 border-blue-500":"bg-white border-blue-300"),children:[r.jsx("div",{className:"px-4 py-3 border-b bg-blue-600 border-blue-500",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(y,{className:"w-4 h-4 text-white"}),r.jsxs("h3",{className:"text-xs font-bold uppercase text-white",children:["Switch Branch (",i.length,")"]})]})}),r.jsx("div",{className:"p-2",children:i.map(e=>{const t=e.id===d,s="shared"===(a=e.data_isolation_mode)?"ðŸŒ":"isolated"===a?"ðŸ”’":"hybrid"===a?"âš–ï¸":"ðŸª";var a;const n=(e=>"shared"===e?"text-blue-600":"isolated"===e?"text-red-600":"hybrid"===e?"text-purple-600":"text-gray-600")(e.data_isolation_mode);return r.jsxs("button",{onClick:()=>(e=>{const t=i.find(t=>t.id===e);t&&(m(e),localStorage.setItem("current_branch_id",e),x(!1),N.success(`Switching to ${t.name}...`,{duration:1500}),setTimeout(()=>{window.location.reload()},500))})(e.id),className:"w-full flex items-start gap-3 px-3 py-2 rounded-lg transition-colors "+(t?l?"bg-blue-900/30 border-2 border-blue-600":"bg-blue-50 border-2 border-blue-200":l?"hover:bg-slate-700/50 border-2 border-transparent":"hover:bg-gray-50 border-2 border-transparent"),children:[r.jsx("div",{className:"flex-shrink-0 mt-1",children:t?r.jsx("div",{className:"w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center",children:r.jsx(w,{className:"w-3 h-3 text-white"})}):r.jsx("div",{className:"w-5 h-5 border-2 border-gray-300 rounded-full"})}),r.jsxs("div",{className:"flex-1 text-left min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"font-medium truncate "+(t?l?"text-blue-300":"text-blue-900":l?"text-gray-200":"text-gray-900"),children:e.name}),e.is_main&&r.jsx("span",{className:"px-1.5 py-0.5 text-xs font-semibold rounded "+(l?"bg-green-900/30 text-green-400":"bg-green-100 text-green-700"),children:"Main"})]}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx("span",{className:"text-xs "+(l?"text-gray-400":"text-gray-500"),children:e.code}),r.jsx("span",{className:"text-xs "+(l?"text-gray-600":"text-gray-300"),children:"â€¢"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(v,{className:"w-3 h-3 "+(l?"text-gray-500":"text-gray-400")}),r.jsx("span",{className:"text-xs "+(l?"text-gray-400":"text-gray-500"),children:e.city})]})]}),e.data_isolation_mode&&r.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[r.jsx("span",{className:"text-sm",children:s}),r.jsx("span",{className:`text-xs font-medium ${n}`,children:"shared"===e.data_isolation_mode?"Shared":"isolated"===e.data_isolation_mode?"Isolated":"Hybrid"})]})]})]},e.id)})}),r.jsx("div",{className:"border-t p-3 "+(l?"border-blue-500 bg-slate-900":"border-blue-300 bg-gray-50"),children:r.jsxs("div",{className:"text-center space-y-2",children:[r.jsxs("p",{className:"text-xs "+(l?"text-gray-300":"text-gray-600"),children:[i.length," branch",1!==i.length?"es":""," available"]}),r.jsxs("button",{onClick:e=>{e.stopPropagation(),x(!1),window.location.href="/admin-settings?section=stores"},className:"text-xs font-semibold flex items-center gap-1 mx-auto px-3 py-1.5 rounded-md transition-all bg-blue-600 hover:bg-blue-700 text-white",children:[r.jsx(y,{className:"w-3 h-3"}),"Manage Stores"]})]})})]})]})]})},$e=({isOpen:s,onClose:l,onSuccess:i})=>{const{currentUser:o}=e(),[d,m]=c.useState(!1),[u,x]=c.useState([]),[g,h]=c.useState([]),[b,p]=c.useState(0),[f,y]=c.useState(!1);ve(s);const[v,j]=c.useState({account_id:"",category:"",description:"",amount:"",vendor_name:"",reference_number:""}),w="customer-care"===(null==o?void 0:o.role),N="admin"===(null==o?void 0:o.role);c.useEffect(()=>{s&&(R(),w&&(async()=>{if(w){y(!0);try{const e=(new Date).toISOString().split("T")[0],{data:s,error:r}=await t.from("lats_sales").select("total_amount").gte("created_at",`${e}T00:00:00`).lte("created_at",`${e}T23:59:59`).eq("status","completed");if(r)throw r;const a=(null==s?void 0:s.reduce((e,t)=>e+(t.total_amount||0),0))||0;p(a)}catch(e){p(0)}finally{y(!1)}}})())},[s,w]);const R=async()=>{try{const e=await a.getPaymentMethods();let s=e;if(w){const t=e.find(e=>"cash"===e.type);s=t?[t]:[]}x(s),s.length>0&&!v.account_id&&j(e=>({...e,account_id:s[0].id}));const{data:r}=await t.from("expense_categories").select("*").eq("is_active",!0).order("name");h(r||[])}catch(e){}},L=(e,t)=>{j(s=>({...s,[e]:t}))},P=async()=>{try{if(!v.account_id||!v.amount||!v.description)return void T.error("Please fill in amount and description");const e=parseFloat(v.amount);if(isNaN(e)||e<=0)return void T.error("Please enter a valid amount");if(w&&e>b)return void T.error(`Amount exceeds daily sales (TSh ${b.toLocaleString()})`);m(!0);const s=v.reference_number||`EXP-${Date.now()}`,r="admin"===(null==o?void 0:o.role),a=r?"approved":"pending",{error:n}=await t.from("account_transactions").insert({account_id:v.account_id,transaction_type:"expense",amount:e,description:v.category?`${v.category}: ${v.description}`:v.description,reference_number:s,status:a,metadata:{category:v.category||"Other",vendor_name:v.vendor_name||null,expense_date:(new Date).toISOString().split("T")[0],created_via:"quick_expense",user_role:null==o?void 0:o.role,daily_sales_at_time:w?b:null,approval_status:a,requires_approval:!r},created_by:null==o?void 0:o.id});if(n)throw n;const d=u.find(e=>e.id===v.account_id);r?T.success(`Expense recorded! ${(null==d?void 0:d.name)||"Account"} balance updated.`,{duration:3e3}):T.success("Expense submitted for admin approval! Pending review.",{duration:3e3}),j({account_id:u.length>0?u[0].id:"",category:"",description:"",amount:"",vendor_name:"",reference_number:""}),i&&i(),l()}catch(e){T.error(e.message||"Failed to record expense")}finally{m(!1)}};return r.jsx(pe,{isOpen:s,onClose:l,title:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"p-2 bg-gradient-to-br from-red-500 to-red-600 rounded-lg",children:r.jsx(k,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Expense"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Fast expense entry (Ctrl+Enter to save)"})]})]}),children:r.jsxs("div",{className:"space-y-4",onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey&&P()},children:[w&&r.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-xl p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-3 bg-blue-500 rounded-lg",children:r.jsx(C,{className:"w-6 h-6 text-white"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-sm font-medium text-blue-900",children:"Daily Sales Available"}),r.jsx("div",{className:"text-2xl font-bold text-blue-700",children:f?r.jsx("span",{className:"text-sm",children:"Loading..."}):`TSh ${b.toLocaleString()}`}),r.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"You can record expenses up to today's sales amount"})]})]})}),N&&r.jsx("div",{className:"bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-xl p-3",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(S,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{className:"text-sm text-green-800",children:"Admin: Full access to all accounts with no limits"})]})}),!w&&u.length>1&&r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx($,{className:"w-4 h-4"}),"Pay from Account"]}),r.jsx("div",{className:"grid grid-cols-2 gap-3",children:u.map(e=>{const t=(e=>{switch(e.toLowerCase()){case"cash":return z;case"bank":return A;case"mobile_money":return I;case"credit_card":return $;default:return F}})(e.type),s=(e=>{switch(e.toLowerCase()){case"cash":return"green";case"bank":return"blue";case"mobile_money":return"purple";case"credit_card":return"indigo";default:return"gray"}})(e.type),a=v.account_id===e.id,n=e.balance||0,l={green:{bg:a?"bg-green-50":"bg-white hover:bg-green-50",border:a?"border-green-500 ring-2 ring-green-200":"border-gray-200 hover:border-green-300",iconBg:a?"bg-green-600":"bg-green-100",iconText:a?"text-white":"text-green-600",text:a?"text-green-900":"text-gray-900",amount:a?"text-green-700":"text-green-600"},blue:{bg:a?"bg-blue-50":"bg-white hover:bg-blue-50",border:a?"border-blue-500 ring-2 ring-blue-200":"border-gray-200 hover:border-blue-300",iconBg:a?"bg-blue-600":"bg-blue-100",iconText:a?"text-white":"text-blue-600",text:a?"text-blue-900":"text-gray-900",amount:a?"text-blue-700":"text-blue-600"},purple:{bg:a?"bg-purple-50":"bg-white hover:bg-purple-50",border:a?"border-purple-500 ring-2 ring-purple-200":"border-gray-200 hover:border-purple-300",iconBg:a?"bg-purple-600":"bg-purple-100",iconText:a?"text-white":"text-purple-600",text:a?"text-purple-900":"text-gray-900",amount:a?"text-purple-700":"text-purple-600"},indigo:{bg:a?"bg-indigo-50":"bg-white hover:bg-indigo-50",border:a?"border-indigo-500 ring-2 ring-indigo-200":"border-gray-200 hover:border-indigo-300",iconBg:a?"bg-indigo-600":"bg-indigo-100",iconText:a?"text-white":"text-indigo-600",text:a?"text-indigo-900":"text-gray-900",amount:a?"text-indigo-700":"text-indigo-600"}}[s]||{bg:a?"bg-gray-50":"bg-white hover:bg-gray-50",border:a?"border-gray-500 ring-2 ring-gray-200":"border-gray-200 hover:border-gray-300",iconBg:a?"bg-gray-600":"bg-gray-100",iconText:a?"text-white":"text-gray-600",text:"text-gray-900",amount:a?"text-gray-700":"text-gray-600"};return r.jsx("button",{onClick:()=>{return t=e.id,void j(e=>({...e,account_id:t}));var t},type:"button",className:`\n                      p-4 rounded-xl border-2 transition-all\n                      ${l.bg} ${l.border}\n                      ${a?"shadow-lg":"shadow hover:shadow-md"}\n                    `,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-10 h-10 rounded-lg ${l.iconBg} flex items-center justify-center`,children:r.jsx(t,{className:`w-5 h-5 ${l.iconText}`})}),r.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[r.jsx("div",{className:`font-semibold text-sm truncate ${l.text}`,children:e.name}),r.jsxs("div",{className:`text-xs font-semibold tabular-nums ${l.amount}`,children:["TSh ",n.toLocaleString()]})]}),a&&r.jsx(_,{className:"w-5 h-5 text-green-600 shrink-0"})]})},e.id)})})]}),w&&u.length>0&&r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(z,{className:"w-4 h-4"}),"Pay from Cash Account"]}),r.jsx("div",{className:"p-4 rounded-xl border-2 border-green-500 bg-green-50 shadow-lg ring-2 ring-green-200",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-600 flex items-center justify-center",children:r.jsx(z,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[r.jsx("div",{className:"font-semibold text-sm truncate text-green-900",children:u[0].name}),r.jsxs("div",{className:"text-xs font-semibold tabular-nums text-green-700",children:["TSh ",(u[0].balance||0).toLocaleString()]})]}),r.jsx(_,{className:"w-5 h-5 text-green-600 shrink-0"})]})})]}),r.jsx("div",{children:r.jsx(ye,{label:"Category",value:v.category,onChange:e=>L("category",e),options:g.map(e=>({value:e.name,label:e.name})),placeholder:"Select category...",className:"text-sm"})}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[r.jsx(D,{className:"w-4 h-4"}),"Amount (TSh) *",w&&r.jsxs("span",{className:"text-xs text-blue-600 ml-auto",children:["(Max: TSh ",b.toLocaleString(),")"]})]}),r.jsxs("div",{className:"relative",children:[r.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"text",value:v.amount?(e=>{const t=e.replace(/[^\d.]/g,"").split("."),s=t[0],r=t[1],a=s.replace(/\B(?=(\d{3})+(?!\d))/g,",");return void 0!==r?`${a}.${r}`:a})(v.amount):"",onChange:e=>{const t=e.target.value.replace(/,/g,"");(""===t||/^\d*\.?\d{0,2}$/.test(t))&&j(e=>({...e,amount:t}))},placeholder:"0",autoFocus:!0,className:"w-full pl-10 pr-4 py-3 text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]}),w&&v.amount&&r.jsx("div",{className:"mt-1 text-xs",children:parseFloat(v.amount)>b?r.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[r.jsx(S,{className:"w-3 h-3"}),r.jsx("span",{children:"Amount exceeds daily sales limit"})]}):r.jsx("div",{className:"flex items-center gap-1 text-green-600",children:r.jsx("span",{children:"âœ“ Within daily sales limit"})})})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[r.jsx(E,{className:"w-4 h-4"}),"Description *"]}),r.jsx(fe,{type:"text",value:v.description,onChange:e=>L("description",e.target.value),placeholder:"What was this expense for?",className:"text-base"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[r.jsx(A,{className:"w-4 h-4"}),"Vendor (optional)"]}),r.jsx(fe,{type:"text",value:v.vendor_name,onChange:e=>L("vendor_name",e.target.value),placeholder:"Supplier or vendor name"})]}),r.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[r.jsx(n,{variant:"secondary",onClick:l,className:"flex-1",disabled:d,children:"Cancel"}),r.jsx(n,{onClick:P,className:"flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700",disabled:d||w&&parseFloat(v.amount)>b,children:d?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Recording..."]}):r.jsxs(r.Fragment,{children:[r.jsx(k,{className:"w-4 h-4 mr-2"}),"Record Expense"]})})]}),r.jsxs("div",{className:"text-center text-xs text-gray-500 pt-2 border-t flex items-center justify-center gap-2",children:[r.jsx(k,{className:"w-3 h-3"}),r.jsxs("span",{children:["Tip: Press ",r.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Ctrl"})," + ",r.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Enter"})," to save quickly"]})]})]})})},_e=({isOpen:t,onClose:s,onSuccess:a})=>{const{currentUser:o}=e(),{currentBranch:d}=l(),{customers:m}=i(),[u,x]=c.useState(!1),[g,h]=c.useState(!1),[b,p]=c.useState(""),y=c.useMemo(()=>{const e=b.toLowerCase().trim();return m.filter(t=>{var s,r;return t.name.toLowerCase().includes(e)||(null==(s=t.email)?void 0:s.toLowerCase().includes(e))||(null==(r=t.phone)?void 0:r.toLowerCase().includes(e))}).slice(0,20)},[b,m]),[v,j]=c.useState({title:"",description:"",date:"",time:"",priority:"medium",category:"general",notifyBefore:15,relatedTo:void 0,recurring:{enabled:!1,type:"daily",interval:1,endDate:void 0}});c.useEffect(()=>{if(t){const e=new Date,t=new Date(e);t.setDate(t.getDate()+1);const s=new Date(e.getTime()+36e5);j({title:"",description:"",date:t.toISOString().split("T")[0],time:s.toTimeString().slice(0,5),priority:"medium",category:"general",notifyBefore:15,relatedTo:void 0,recurring:{enabled:!1,type:"daily",interval:1,endDate:void 0}})}},[t]);const w=(e,t)=>{j(s=>({...s,[e]:t}))},N=async()=>{try{if(!v.title||!v.date||!v.time)return void T.error("Please fill in title, date, and time");if(!d)return void T.error("No branch selected");x(!0),await f.createReminder({...v,assignedTo:null==o?void 0:o.id,createdBy:null==o?void 0:o.id,branchId:d.id}),T.success("Reminder created successfully!",{duration:3e3}),j({title:"",description:"",date:"",time:"",priority:"medium",category:"general",notifyBefore:15,relatedTo:void 0,recurring:{enabled:!1,type:"daily",interval:1,endDate:void 0}}),a&&a(),s()}catch(e){T.error(e.message||"Failed to create reminder")}finally{x(!1)}};return r.jsx(pe,{isOpen:t,onClose:s,title:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg",children:r.jsx(k,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Reminder"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Fast reminder creation (Ctrl+Enter to save)"})]})]}),children:r.jsxs("div",{className:"space-y-4",onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey&&N()},children:[r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[r.jsx(R,{className:"w-4 h-4"}),"Reminder Title *"]}),r.jsx(fe,{type:"text",value:v.title,onChange:e=>w("title",e.target.value),placeholder:"What do you need to remember?",autoFocus:!0,className:"text-base"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[r.jsx(L,{className:"w-4 h-4"}),"Date *"]}),r.jsx(fe,{type:"date",value:v.date,onChange:e=>w("date",e.target.value),className:"text-sm"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[r.jsx(P,{className:"w-4 h-4"}),"Time *"]}),r.jsx(fe,{type:"time",value:v.time,onChange:e=>w("time",e.target.value),className:"text-sm"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsx("div",{children:r.jsx(ye,{label:"Priority",value:v.priority,onChange:e=>w("priority",e),options:[{value:"low",label:"Low Priority"},{value:"medium",label:"Medium Priority"},{value:"high",label:"High Priority"}],className:"text-sm"})}),r.jsx("div",{children:r.jsx(ye,{label:"Category",value:v.category,onChange:e=>w("category",e),options:[{value:"general",label:"General"},{value:"device",label:"Device"},{value:"customer",label:"Customer"},{value:"appointment",label:"Appointment"},{value:"payment",label:"Payment"},{value:"other",label:"Other"}],className:"text-sm"})})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1",children:[r.jsx(S,{className:"w-4 h-4"}),"Description (optional)"]}),r.jsx(fe,{type:"text",value:v.description,onChange:e=>w("description",e.target.value),placeholder:"Additional details...",className:"text-sm"})]}),r.jsx("div",{children:r.jsx(ye,{label:"Notify me",value:v.notifyBefore,onChange:e=>w("notifyBefore",parseInt(e)),options:[{value:5,label:"5 minutes before"},{value:15,label:"15 minutes before"},{value:30,label:"30 minutes before"},{value:60,label:"1 hour before"},{value:120,label:"2 hours before"},{value:240,label:"4 hours before"},{value:1440,label:"1 day before"}],className:"text-sm"})}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(M,{className:"w-4 h-4"}),"Link to Customer (optional)"]}),v.relatedTo?r.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsx(W,{className:"w-4 h-4 text-blue-600"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-blue-900",children:v.relatedTo.name}),r.jsx("div",{className:"text-sm text-blue-600",children:(()=>{const e=m.find(e=>{var t;return e.id===(null==(t=v.relatedTo)?void 0:t.id)});return(null==e?void 0:e.phone)?e.phone:""})()})]}),r.jsx("button",{type:"button",onClick:()=>{j(e=>({...e,relatedTo:void 0})),p("")},className:"text-blue-600 hover:text-blue-800 transition-colors",children:r.jsx(O,{className:"w-4 h-4"})})]}):r.jsxs("div",{className:"space-y-2",children:[r.jsxs("button",{type:"button",onClick:()=>h(!g),className:"w-full flex items-center gap-2 p-3 border border-gray-300 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors",children:[r.jsx(W,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-gray-600",children:"Link to a customer"}),r.jsx(q,{className:"w-4 h-4 text-gray-400 ml-auto"})]}),g&&r.jsxs("div",{className:"border border-gray-200 rounded-lg bg-white shadow-sm",children:[r.jsx("div",{className:"p-3 border-b border-gray-200",children:r.jsxs("div",{className:"relative",children:[r.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",value:b,onChange:e=>p(e.target.value),placeholder:"Search customers by name, phone, or email...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",autoFocus:!0})]})}),r.jsx("div",{className:"max-h-48 overflow-y-auto",children:y.length>0?r.jsx("div",{className:"space-y-1 p-2",children:y.map(e=>r.jsxs("button",{type:"button",onClick:()=>{j(t=>({...t,relatedTo:{type:"customer",id:e.id,name:e.name}})),h(!1),p("")},className:"w-full flex items-center gap-3 p-2 rounded-lg hover:bg-blue-50 transition-colors text-left",children:[r.jsx(W,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.name}),r.jsxs("div",{className:"text-sm text-gray-500 truncate",children:[e.phone&&r.jsx("span",{children:e.phone}),e.email&&r.jsx("span",{className:"ml-2",children:e.email})]})]})]},e.id))}):r.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:b?"No customers found":"Start typing to search customers..."})})]})]})]}),r.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[r.jsx(n,{variant:"secondary",onClick:s,className:"flex-1",disabled:u,children:"Cancel"}),r.jsx(n,{onClick:N,className:"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700",disabled:u||!v.title||!v.date||!v.time,children:u?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):r.jsxs(r.Fragment,{children:[r.jsx(k,{className:"w-4 h-4 mr-2"}),"Create Reminder"]})})]}),r.jsxs("div",{className:"text-center text-xs text-gray-500 pt-2 border-t flex items-center justify-center gap-2",children:[r.jsx(k,{className:"w-3 h-3"}),r.jsxs("span",{children:["Tip: Press ",r.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Ctrl"})," + ",r.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"Enter"})," to save quickly"]})]})]})})},ze=({onMenuToggle:t,isMenuOpen:a,isNavCollapsed:n})=>{var l,m;const{currentUser:g,logout:h}=e(),{isDark:b}=s(),{openSearch:p}=o(),[y,v]=c.useState(!1),[w,N]=c.useState(!1);let k=[];try{const e=d();k=e.devices||[]}catch(xe){k=[]}const{customers:C}=i(),S=x(),$=u(),{notifications:_,unreadNotifications:z,markAsRead:E,_markAsActioned:A,dismissNotification:F}=Ce(),[T,L]=c.useState(!1),[M,W]=c.useState(!1),[X,ee]=c.useState(navigator.onLine),[te,se]=c.useState(new Date),[re,ae]=c.useState(0),[ne,le]=c.useState(!1),{handleBackClick:ie,previousPage:oe}=(()=>{const e=u(),t=x(),[s,r]=c.useState(null);c.useEffect(()=>{const t=e.pathname,a=localStorage.getItem("navigationHistory");let n=[];if(a)try{n=JSON.parse(a)}catch(xe){}if(0!==n.length&&n[n.length-1]===t||(n.push(t),n.length>10&&(n=n.slice(-10)),localStorage.setItem("navigationHistory",JSON.stringify(n))),n.length>1){const e=n[n.length-2];e!==s&&r(e)}},[e.pathname,s]);const a=c.useCallback(()=>{t(s||"/dashboard")},[s,t]);return{previousPage:s,handleBackClick:a,navigate:t}})();c.useEffect(()=>{const e=setInterval(()=>{se(new Date)},6e4);return()=>clearInterval(e)},[]),c.useEffect(()=>{const e=async()=>{try{const[e,t]=await Promise.all([f.getPendingReminders(),f.getOverdueReminders()]);ae(t.length)}catch(xe){}};e();const t=setInterval(e,3e5);return()=>clearInterval(t)},[]);const de=c.useRef(null),ce=c.useRef(null);c.useEffect(()=>{const e=e=>{de.current&&!de.current.contains(e.target)&&L(!1),ce.current&&!ce.current.contains(e.target)&&W(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),c.useEffect(()=>{const e=()=>{le(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)}},[]);const me=(()=>{const e=new Date;new Date(e.getTime()-864e5);return{activeDevices:k.filter(e=>"done"!==e.status&&"failed"!==e.status).length,newCustomers:C.filter(e=>!1===e.isRead||void 0===e.isRead).length,overdueDevices:k.filter(t=>{if("done"===t.status||"failed"===t.status)return!1;if(!t.expectedReturnDate)return!1;return new Date(t.expectedReturnDate)<e}).length}})(),ue=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1).replace(/\.0$/,"")+"K":e<1e6?Math.round(e/1e3)+"K":(e/1e6).toFixed(1).replace(/\.0$/,"")+"M";return(()=>{const e=[],t=g.permissions||[],s=t.includes("all");(s||t.includes("create_customers")||"admin"===g.role)&&e.push({label:"Add Customer",icon:r.jsx(K,{size:16}),action:()=>S("/customers")}),(s||t.includes("add_device")||"admin"===g.role||"customer-care"===g.role)&&e.push({label:"Add Device",icon:r.jsx(I,{size:16}),action:()=>S("/devices/new")}),(s||t.includes("add_products")||"admin"===g.role)&&e.push({label:"Add Product",icon:r.jsx(Z,{size:16}),action:()=>S("/lats/add-product")}),(s||t.includes("view_inventory")||"admin"===g.role)&&e.push({label:"Unified Inventory",icon:r.jsx(H,{size:16}),action:()=>S("/lats/unified-inventory")}),(s||"admin"===g.role)&&e.push({label:"SMS Centre",icon:r.jsx(J,{size:16}),action:()=>S("/sms")})})(),r.jsxs("header",{className:"sticky top-0 z-20 transition-all duration-500 "+(n?"md:ml-[5.5rem]":"md:ml-72"),children:[r.jsx("div",{className:`topbar ${b?"bg-slate-900/90":"bg-white/80"} backdrop-blur-xl ${b?"border-slate-700/50":"border-white/30"} border-b shadow-lg`,children:r.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:t,className:`p-2.5 rounded-lg ${b?"bg-slate-800/60 hover:bg-slate-700/60":"bg-white/30 hover:bg-white/50"} transition-all duration-300 backdrop-blur-sm md:hidden ${b?"border-slate-600":"border-white/30"} border shadow-sm`,children:a?r.jsx(O,{size:20,className:b?"text-gray-200":"text-gray-700"}):r.jsx(B,{size:20,className:b?"text-gray-200":"text-gray-700"})}),r.jsx("button",{onClick:ie,className:`p-2.5 rounded-lg ${b?"bg-slate-800/60 hover:bg-slate-700/60":"bg-white/30 hover:bg-white/50"} transition-all duration-300 backdrop-blur-sm ${b?"border-slate-600":"border-white/30"} border shadow-sm`,title:oe?"Go Back":"Go to Dashboard",children:r.jsx(U,{size:18,className:b?"text-gray-200":"text-gray-700"})})]}),r.jsxs("div",{className:"hidden md:flex items-center gap-3 flex-1 max-w-4xl mx-4",children:[r.jsx("button",{onClick:()=>p(),className:`p-2.5 rounded-lg transition-all duration-200 ${b?"bg-slate-800/60 hover:bg-slate-700/60 text-gray-300 border border-slate-700":"bg-white/60 hover:bg-white/80 text-gray-700 border border-gray-200"} cursor-pointer backdrop-blur-sm shadow-sm hover:shadow-md`,title:"Search (âŒ˜K)",children:r.jsx(q,{size:20})}),r.jsxs("div",{className:"flex items-center gap-3",children:["admin"===(null==g?void 0:g.role)&&r.jsxs("button",{onClick:()=>v(!0),className:"flex items-center justify-center gap-2 px-5 py-3 min-w-[110px] rounded-lg bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",title:"Quick Expense (âš¡ Fast Entry)",children:[r.jsx(D,{size:18}),r.jsx("span",{className:"hidden lg:inline font-medium",children:"Expense"})]}),r.jsxs("button",{onClick:()=>N(!0),className:"flex items-center justify-center gap-2 px-5 py-3 min-w-[110px] rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",title:"Quick Reminder (âš¡ Fast Entry)",children:[r.jsx(R,{size:18}),r.jsx("span",{className:"hidden lg:inline font-medium",children:"Reminder"})]}),"technician"!==(null==g?void 0:g.role)&&r.jsxs("div",{className:"relative",ref:ce,children:[r.jsxs("button",{onClick:()=>W(!M),className:"flex items-center justify-center gap-2 px-5 py-3 min-w-[110px] rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",children:[r.jsx("span",{className:"font-medium",children:"Create"}),r.jsx(j,{size:18,className:"transition-transform duration-200 "+(M?"rotate-180":"")})]}),M&&r.jsx("div",{className:`absolute right-0 top-full mt-2 w-80 ${b?"bg-slate-800 border-slate-700":"bg-white border-gray-200"} rounded-lg shadow-lg border z-50`,children:r.jsxs("div",{className:"p-4 space-y-3",children:[r.jsxs("button",{onClick:()=>{S("/pos"),W(!1)},className:`w-full flex items-center gap-3 p-3 rounded-lg ${b?"hover:bg-emerald-900/30":"hover:bg-emerald-50"} transition-colors group`,children:[r.jsx("div",{className:"p-2 rounded-lg bg-emerald-500 text-white",children:r.jsx(G,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium "+(b?"text-white":"text-gray-900"),children:"New Sale"}),r.jsx("p",{className:"text-sm "+(b?"text-gray-400":"text-gray-600"),children:"Start POS transaction"})]})]}),r.jsxs("button",{onClick:()=>{S("/devices/new"),W(!1)},className:`w-full flex items-center gap-3 p-3 rounded-lg ${b?"hover:bg-blue-900/30":"hover:bg-blue-50"} transition-colors group`,children:[r.jsx("div",{className:"p-2 rounded-lg bg-blue-500 text-white",children:r.jsx(I,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium "+(b?"text-white":"text-gray-900"),children:"New Device"}),r.jsx("p",{className:"text-sm "+(b?"text-gray-400":"text-gray-600"),children:"Add device for repair"})]})]}),r.jsxs("button",{onClick:()=>{S("/customers"),W(!1)},className:`w-full flex items-center gap-3 p-3 rounded-lg ${b?"hover:bg-purple-900/30":"hover:bg-purple-50"} transition-colors group`,children:[r.jsx("div",{className:"p-2 rounded-lg bg-purple-500 text-white",children:r.jsx(K,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium "+(b?"text-white":"text-gray-900"),children:"Add Customer"}),r.jsx("p",{className:"text-sm "+(b?"text-gray-400":"text-gray-600"),children:"Register new customer"})]})]}),((null==(l=g.permissions)?void 0:l.includes("all"))||"admin"===g.role)&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:()=>{v(!0),W(!1)},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-red-50 transition-colors group border-2 border-red-100",children:[r.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-r from-red-500 to-red-600 text-white",children:r.jsx(D,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium text-gray-900",children:"âš¡ Quick Expense"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Fast expense entry"})]})]}),r.jsxs("button",{onClick:()=>{S("/lats/add-product"),W(!1)},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-orange-50 transition-colors group",children:[r.jsx("div",{className:"p-2 rounded-lg bg-orange-500 text-white",children:r.jsx(H,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Add Product"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Add new inventory item"})]})]})]}),((null==(m=g.permissions)?void 0:m.includes("all"))||"admin"===g.role||"customer-care"===g.role)&&r.jsxs("button",{onClick:()=>{S("/sms"),W(!1)},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-indigo-50 transition-colors group",children:[r.jsx("div",{className:"p-2 rounded-lg bg-indigo-500 text-white",children:r.jsx(J,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium text-gray-900",children:"SMS Centre"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Send messages to customers"})]})]})]})})]})]})]}),"technician"===(null==g?void 0:g.role)&&r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("button",{onClick:()=>S("/lats/spare-parts"),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-orange-600 hover:bg-orange-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",children:[r.jsx(H,{size:16}),r.jsx("span",{className:"font-medium",children:"Spare Parts"})]})}),"technician"!==(null==g?void 0:g.role)&&r.jsxs("div",{className:"hidden lg:flex items-center gap-1",children:[r.jsxs("div",{className:"relative group",children:[r.jsx("button",{onClick:()=>S("/pos"),className:"p-3 rounded-lg transition-all duration-300 backdrop-blur-sm border shadow-sm hover:scale-110 "+($.pathname.includes("/pos")?"bg-emerald-500 text-white border-emerald-400":b?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/30 hover:bg-white/50 border-white/30"),title:"POS System",children:r.jsx(G,{size:18,className:$.pathname.includes("/pos")?"text-white":b?"text-gray-200":"text-gray-700"})}),r.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${b?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["POS System",r.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent "+(b?"border-t-slate-800/95":"border-t-white/95")})]})]}),r.jsxs("div",{className:"relative group",children:[r.jsx("button",{onClick:()=>S("/customers"),className:"p-3 rounded-lg transition-all duration-300 backdrop-blur-sm border shadow-sm hover:scale-110 "+($.pathname.includes("/customers")?"bg-purple-500 text-white border-purple-400":b?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/30 hover:bg-white/50 border-white/30"),title:"Customers",children:r.jsx(K,{size:18,className:$.pathname.includes("/customers")?"text-white":b?"text-gray-200":"text-gray-700"})}),r.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${b?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["Customers",r.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent "+(b?"border-t-slate-800/95":"border-t-white/95")})]})]}),r.jsxs("div",{className:"relative group",children:[r.jsx("button",{onClick:()=>S("/devices"),className:"p-3 rounded-lg transition-all duration-300 backdrop-blur-sm border shadow-sm hover:scale-110 "+($.pathname.includes("/devices")?"bg-blue-500 text-white border-blue-400":b?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/30 hover:bg-white/50 border-white/30"),title:"Devices",children:r.jsx(I,{size:18,className:$.pathname.includes("/devices")?"text-white":b?"text-gray-200":"text-gray-700"})}),r.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${b?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["Devices",r.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent "+(b?"border-t-slate-800/95":"border-t-white/95")})]})]}),r.jsxs("div",{className:"relative group",children:[r.jsxs("button",{onClick:()=>S("/reminders"),className:"p-3 rounded-lg transition-all duration-300 backdrop-blur-sm border shadow-sm hover:scale-110 relative "+($.pathname.includes("/reminders")?"bg-yellow-500 text-white border-yellow-400":b?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/30 hover:bg-white/50 border-white/30"),title:"Reminders",children:[r.jsx(P,{size:18,className:$.pathname.includes("/reminders")?"text-white":b?"text-gray-200":"text-gray-700"}),re>0&&r.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center border-2 border-white shadow-sm",children:r.jsx("span",{className:"text-[10px] text-white font-bold",children:re>9?"9+":re})})]}),r.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${b?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["Reminders ",re>0?`(${re} overdue)`:"",r.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent "+(b?"border-t-slate-800/95":"border-t-white/95")})]})]}),"admin"===(null==g?void 0:g.role)&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"relative group",children:[r.jsx("button",{onClick:()=>S("/lats/unified-inventory"),className:"p-3 rounded-lg transition-all duration-300 backdrop-blur-sm border shadow-sm hover:scale-110 "+($.pathname.includes("/lats/unified-inventory")?"bg-orange-500 text-white border-orange-400":b?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/30 hover:bg-white/50 border-white/30"),title:"Inventory",children:r.jsx(Q,{size:18,className:$.pathname.includes("/lats/unified-inventory")?"text-white":b?"text-gray-200":"text-gray-700"})}),r.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 ${b?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:["Inventory",r.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent "+(b?"border-t-slate-800/95":"border-t-white/95")})]})]})})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"hidden lg:flex items-center gap-4",children:[me.activeDevices>0&&r.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-blue-100 text-blue-700 backdrop-blur-sm border border-blue-200 shadow-sm",children:[r.jsx(I,{size:14}),r.jsx("span",{className:"text-xs font-semibold",children:ue(me.activeDevices)})]}),me.overdueDevices>0&&r.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-red-100 text-red-700 backdrop-blur-sm border border-red-200 shadow-sm",children:[r.jsx(P,{size:14}),r.jsx("span",{className:"text-xs font-semibold",children:ue(me.overdueDevices)})]}),"technician"!==(null==g?void 0:g.role)&&me.newCustomers>0&&r.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-green-100 text-green-700 backdrop-blur-sm border border-green-200 shadow-sm",children:[r.jsx(K,{size:14}),r.jsx("span",{className:"text-xs font-semibold",children:ue(me.newCustomers)})]})]}),r.jsx("div",{className:"hidden sm:flex items-center justify-center w-6 h-6",children:r.jsx("div",{className:`w-2 h-2 rounded-full ${X?"bg-green-500":"bg-red-500"} animate-pulse`})}),r.jsx("button",{onClick:async()=>{try{if(document.fullscreenElement)document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen();else{const e=document.documentElement;e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.mozRequestFullScreen?await e.mozRequestFullScreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}}catch(xe){}},className:`p-2.5 rounded-lg ${b?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/30 hover:bg-white/50 border-white/30"} transition-all duration-300 backdrop-blur-sm border shadow-sm active:scale-95`,title:ne?"Exit Fullscreen (ESC)":"Enter Fullscreen",children:ne?r.jsx(Y,{size:20,className:b?"text-gray-200":"text-gray-700"}):r.jsx(V,{size:20,className:b?"text-gray-200":"text-gray-700"})}),r.jsxs("div",{className:"relative",ref:de,children:[r.jsxs("button",{onClick:()=>L(!T),className:`p-2.5 rounded-lg ${b?"bg-slate-800/60 hover:bg-slate-700/60 border-slate-600":"bg-white/30 hover:bg-white/50 border-white/30"} transition-all duration-300 backdrop-blur-sm border relative shadow-sm`,children:[r.jsx(R,{size:20,className:b?"text-gray-200":"text-gray-700"}),z.length>0&&r.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full notification-badge border-2 border-white shadow-sm flex items-center justify-center",children:r.jsx("span",{className:"text-xs text-white font-bold",children:z.length>9?"9+":z.length})})]}),T&&r.jsx("div",{className:`absolute right-0 top-full mt-3 w-80 ${b?"bg-slate-800/95":"bg-white/95"} backdrop-blur-xl rounded-xl shadow-xl ${b?"border-slate-700":"border-white/30"} border z-50 max-h-96 overflow-y-auto`,children:r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:"font-semibold "+(b?"text-white":"text-gray-900"),children:"Notifications"}),z.length>0&&r.jsxs("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:[z.length," unread"]})]}),r.jsx("div",{className:"space-y-2",children:_.length>0?_.slice(0,8).map(e=>r.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border transition-all duration-200 hover:shadow-sm cursor-pointer "+("unread"===e.status?b?"bg-blue-900/30 border-blue-700":"bg-blue-50 border-blue-200":b?"bg-slate-700/30 border-slate-600":"bg-gray-50 border-gray-200"),onClick:()=>{"unread"===e.status&&E(e.id),e.actionUrl&&(S(e.actionUrl),L(!1))},children:[r.jsx("div",{className:`p-2 rounded-full text-lg ${e.color||"bg-gray-500"}`,children:e.icon||"ðŸ””"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium "+("unread"===e.status?b?"text-white":"text-gray-900":b?"text-gray-300":"text-gray-700"),children:e.title}),r.jsx("p",{className:"text-xs mt-1 line-clamp-2 "+(b?"text-gray-400":"text-gray-600"),children:e.message}),r.jsx("p",{className:"text-xs mt-1 text-gray-500",children:new Date(e.createdAt).toLocaleString()})]}),r.jsxs("div",{className:"flex flex-col gap-1",children:["unread"===e.status&&r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),r.jsx("button",{onClick:t=>{t.stopPropagation(),F(e.id)},className:(b?"text-gray-500 hover:text-gray-300":"text-gray-400 hover:text-gray-600")+" transition-colors",title:"Dismiss",children:r.jsx(O,{size:12})})]})]},e.id)):r.jsxs("div",{className:"text-center py-6 "+(b?"text-gray-400":"text-gray-500"),children:[r.jsx(R,{size:24,className:"mx-auto mb-2 opacity-50"}),r.jsx("p",{className:"text-sm font-medium",children:"No notifications"})]})}),_.length>8&&r.jsx("div",{className:`mt-3 pt-3 ${b?"border-slate-700":"border-gray-200"} border-t`,children:r.jsx("button",{onClick:()=>{S("/notifications"),L(!1)},className:"w-full text-center text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View all notifications"})})]})})]}),"admin"===(null==g?void 0:g.role)&&r.jsx(Se,{})]})]})}),r.jsxs("div",{className:`md:hidden px-4 py-3 ${b?"bg-slate-900/40":"bg-white/20"} backdrop-blur-sm ${b?"border-slate-700/50":"border-white/20"} border-b`,children:[r.jsxs("div",{className:"flex items-center gap-3 justify-end",children:[r.jsx("button",{onClick:()=>p(),className:`p-2.5 rounded-lg transition-all duration-200 ${b?"bg-slate-800/60 hover:bg-slate-700/60 text-gray-300 border border-slate-700":"bg-white/60 hover:bg-white/80 text-gray-700 border border-gray-200"} cursor-pointer backdrop-blur-sm shadow-sm hover:shadow-md`,title:"Search",children:r.jsx(q,{size:20})}),r.jsx("button",{onClick:()=>W(!M),className:"p-2.5 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-all duration-300 shadow-sm hover:shadow-md",children:r.jsx(Z,{size:20})})]}),M&&r.jsx("div",{className:`mt-3 p-4 ${b?"bg-slate-800 border-slate-700":"bg-white border-gray-200"} rounded-lg shadow-lg border`,children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("button",{onClick:()=>{S("/pos"),W(!1)},className:`w-full flex items-center gap-3 p-3 rounded-lg ${b?"hover:bg-emerald-900/30":"hover:bg-emerald-50"} transition-colors`,children:[r.jsx("div",{className:"p-2 rounded-lg bg-emerald-500 text-white",children:r.jsx(G,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium "+(b?"text-white":"text-gray-900"),children:"New Sale"}),r.jsx("p",{className:"text-sm "+(b?"text-gray-400":"text-gray-600"),children:"Start POS transaction"})]})]}),r.jsxs("button",{onClick:()=>{S("/devices/new"),W(!1)},className:`w-full flex items-center gap-3 p-3 rounded-lg ${b?"hover:bg-blue-900/30":"hover:bg-blue-50"} transition-colors`,children:[r.jsx("div",{className:"p-2 rounded-lg bg-blue-500 text-white",children:r.jsx(I,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium "+(b?"text-white":"text-gray-900"),children:"New Device"}),r.jsx("p",{className:"text-sm "+(b?"text-gray-400":"text-gray-600"),children:"Add device for repair"})]})]}),r.jsxs("button",{onClick:()=>{S("/customers"),W(!1)},className:`w-full flex items-center gap-3 p-3 rounded-lg ${b?"hover:bg-purple-900/30":"hover:bg-purple-50"} transition-colors`,children:[r.jsx("div",{className:"p-2 rounded-lg bg-purple-500 text-white",children:r.jsx(K,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium "+(b?"text-white":"text-gray-900"),children:"Add Customer"}),r.jsx("p",{className:"text-sm "+(b?"text-gray-400":"text-gray-600"),children:"Register new customer"})]})]}),"admin"===(null==g?void 0:g.role)&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:()=>{S("/lats/add-product"),W(!1)},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-orange-50 transition-colors",children:[r.jsx("div",{className:"p-2 rounded-lg bg-orange-500 text-white",children:r.jsx(H,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Add Product"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Add new inventory item"})]})]}),r.jsxs("button",{onClick:()=>{S("/sms"),W(!1)},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-indigo-50 transition-colors",children:[r.jsx("div",{className:"p-2 rounded-lg bg-indigo-500 text-white",children:r.jsx(J,{size:20})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-medium text-gray-900",children:"SMS Centre"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Send messages to customers"})]})]})]})]})})]}),r.jsx($e,{isOpen:y,onClose:()=>v(!1),onSuccess:()=>{}}),r.jsx(_e,{isOpen:w,onClose:()=>N(!1),onSuccess:()=>{}})]})},De=({isOpen:e,onClose:t,onApply:s,currentFilters:a})=>{var n,l,i,o;const[d,m]=c.useState(a);return e?r.jsxs("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl p-6 border border-white/50 shadow-2xl",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(X,{className:"text-blue-600",size:20}),r.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Advanced Filters"})]}),r.jsx("button",{onClick:t,className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:r.jsx(O,{size:18,className:"text-gray-500"})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),r.jsxs("select",{value:d.status||"",onChange:e=>m({...d,status:e.target.value||void 0}),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"All Statuses"}),r.jsx("option",{value:"active",children:"Active"}),r.jsx("option",{value:"done",children:"Done"}),r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"overdue",children:"Overdue"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1",children:[r.jsx(v,{size:14}),"Location"]}),r.jsx("input",{type:"text",value:d.location||"",onChange:e=>m({...d,location:e.target.value||void 0}),placeholder:"e.g., Dar es Salaam",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1",children:[r.jsx(ee,{size:14}),"Category"]}),r.jsx("input",{type:"text",value:d.category||"",onChange:e=>m({...d,category:e.target.value||void 0}),placeholder:"e.g., smartphones",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1",children:[r.jsx(D,{size:14}),"Price Range (TZS)"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"number",value:(null==(n=d.price)?void 0:n.split("-")[0])||"",onChange:e=>{var t;const s=(null==(t=d.price)?void 0:t.split("-")[1])||"";m({...d,price:e.target.value?`${e.target.value}${s?`-${s}`:""}`:void 0})},placeholder:"Min",className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"}),r.jsx("span",{className:"self-center text-gray-500",children:"-"}),r.jsx("input",{type:"number",value:(null==(l=d.price)?void 0:l.split("-")[1])||"",onChange:e=>{var t;const s=(null==(t=d.price)?void 0:t.split("-")[0])||"0";m({...d,price:e.target.value?`${s}-${e.target.value}`:s||void 0})},placeholder:"Max",className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1",children:[r.jsx(L,{size:14}),"Date Range"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"date",value:(null==(i=d.date)?void 0:i.split("-")[0])||"",onChange:e=>{var t;const s=(null==(t=d.date)?void 0:t.split("-")[1])||"";m({...d,date:e.target.value?`${e.target.value}${s?`-${s}`:""}`:void 0})},className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"}),r.jsx("span",{className:"self-center text-gray-500",children:"-"}),r.jsx("input",{type:"date",value:(null==(o=d.date)?void 0:o.split("-")[1])||"",onChange:e=>{var t;const s=(null==(t=d.date)?void 0:t.split("-")[0])||"";m({...d,date:e.target.value?`${s}-${e.target.value}`:s||void 0})},className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Name"}),r.jsx("input",{type:"text",value:d.customer||"",onChange:e=>m({...d,customer:e.target.value||void 0}),placeholder:"Search by customer name",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Device Model"}),r.jsx("input",{type:"text",value:d.model||"",onChange:e=>m({...d,model:e.target.value||void 0}),placeholder:"e.g., iPhone 13",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),r.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-gray-200",children:[r.jsx("button",{onClick:()=>{m({}),s({}),t()},className:"flex-1 px-4 py-2.5 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Reset All"}),r.jsx("button",{onClick:()=>{s(d),t()},className:"flex-1 px-4 py-2.5 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium hover:from-blue-600 hover:to-purple-600 shadow-lg hover:shadow-xl transition-all",children:"Apply Filters"})]}),Object.keys(d).filter(e=>d[e]).length>0&&r.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:[Object.keys(d).filter(e=>d[e]).length," active filter(s)"]})]}):null},Ee=({isOpen:t,onClose:a,initialQuery:n=""})=>{const{currentUser:l}=e(),{isDark:o}=s();let u=[];try{const e=d();u=(null==e?void 0:e.devices)||[]}catch(C){}const{customers:x}=i(),[g,h]=c.useState(n),[b,p]=c.useState("all"),[f,y]=c.useState([]),[v,j]=c.useState(!1),[w,N]=c.useState({});ve(t),c.useEffect(()=>{const e=localStorage.getItem("recentSearches");if(e)try{y(JSON.parse(e))}catch(C){}},[]),c.useEffect(()=>{t&&n&&h(n)},[t,n]),c.useEffect(()=>{if(!t)return;const e=e=>{"Escape"===e.key&&k()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t]);const k=()=>{h(""),p("all"),a()};return t?m.createPortal(r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed",onClick:e=>{e.target===e.currentTarget&&k()},style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)"}}),r.jsx("div",{className:"fixed flex items-start justify-center pt-12",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:r.jsxs("div",{className:`\n            relative w-full max-w-4xl mx-auto mb-8\n            ${o?"bg-slate-900/95":"bg-white/95"}\n            backdrop-blur-2xl rounded-2xl shadow-2xl\n            ${o?"border border-slate-700/50":"border border-white/50"}\n            overflow-hidden\n            transition-all duration-300\n          `,style:{maxHeight:"calc(90vh - 200px)",animation:"slideDown 0.3s ease-out",pointerEvents:"auto",margin:"0 1rem"},onClick:e=>e.stopPropagation(),children:[r.jsx("div",{className:`\n          sticky top-0 z-20\n          ${o?"bg-slate-800/90":"bg-white/90"}\n          backdrop-blur-xl border-b\n          ${o?"border-slate-700/50":"border-gray-200/50"}\n          shadow-sm\n        `,children:r.jsxs("div",{className:"px-6 py-4",children:[r.jsxs("form",{onSubmit:e=>{e.preventDefault(),g.trim()&&(e=>{if(!e.trim())return;const t=[e,...f.filter(t=>t!==e)].slice(0,10);y(t),localStorage.setItem("recentSearches",JSON.stringify(t))})(g)},className:"relative group",children:[r.jsx("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:r.jsx(q,{className:`\n                    transition-colors duration-200\n                    ${g?o?"text-blue-400":"text-blue-500":o?"text-gray-500":"text-gray-400"}\n                    group-focus-within:${o?"text-blue-400":"text-blue-500"}\n                  `,size:20})}),r.jsx("input",{type:"text",placeholder:"Search...",value:g,onChange:e=>h(e.target.value),className:`\n                  w-full pl-12 pr-24 py-3.5 rounded-xl\n                  ${o?"bg-slate-700/50 border-slate-600/50 text-white placeholder-gray-400":"bg-gray-50/50 border-gray-300/50 text-gray-900 placeholder-gray-500"}\n                  border focus:outline-none\n                  focus:${o?"border-blue-500 bg-slate-700":"border-blue-400 bg-white"}\n                  focus:ring-2 focus:ring-blue-500/20\n                  transition-all duration-200\n                  text-base\n                `,autoFocus:!0}),r.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[r.jsxs("button",{type:"button",onClick:()=>j(!v),className:`\n                    p-1.5 rounded-lg flex items-center gap-1 transition-all duration-200\n                    ${v?"bg-blue-500 text-white shadow-lg":o?"bg-slate-600/50 hover:bg-slate-600 text-gray-300":"bg-gray-200/50 hover:bg-gray-300 text-gray-600"}\n                  `,title:"Advanced Filters",children:[r.jsx(X,{size:14}),Object.keys(w).filter(e=>w[e]).length>0&&r.jsx("span",{className:"text-xs font-bold",children:Object.keys(w).filter(e=>w[e]).length})]}),g&&r.jsx("button",{type:"button",onClick:()=>{h("")},className:`\n                      p-1.5 rounded-lg\n                      ${o?"bg-slate-600/50 hover:bg-slate-600 text-gray-300":"bg-gray-200/50 hover:bg-gray-300 text-gray-600"}\n                      transition-all duration-200\n                    `,children:r.jsx(O,{size:14})}),r.jsx("button",{onClick:k,className:`\n                    p-1.5 rounded-lg\n                    ${o?"bg-slate-600/50 hover:bg-slate-600 text-gray-300":"bg-gray-200/50 hover:bg-gray-300 text-gray-600"}\n                    transition-all duration-200\n                  `,type:"button",children:r.jsx("kbd",{className:"text-xs font-mono",children:"ESC"})})]})]}),r.jsxs("div",{className:`\n              flex items-center gap-3 mt-3 text-xs\n              ${o?"text-gray-500":"text-gray-400"}\n            `,children:[r.jsx("kbd",{className:"px-1.5 py-0.5 rounded font-mono "+(o?"bg-slate-700 text-gray-300":"bg-gray-200/50 text-gray-700"),children:"â†‘â†“"}),r.jsx("kbd",{className:"px-1.5 py-0.5 rounded font-mono "+(o?"bg-slate-700 text-gray-300":"bg-gray-200/50 text-gray-700"),children:"Enter"}),r.jsx("kbd",{className:"px-1.5 py-0.5 rounded font-mono "+(o?"bg-slate-700 text-gray-300":"bg-gray-200/50 text-gray-700"),children:"ESC"})]})]})}),r.jsxs("div",{className:`\n            overflow-y-auto px-6 py-6\n            ${o?"bg-slate-900/50":"bg-gray-50/30"}\n          `,style:{maxHeight:"calc(100vh - 300px)",minHeight:"400px"},children:[v&&r.jsx("div",{className:"mb-6",children:r.jsx(De,{isOpen:v,onClose:()=>j(!1),onApply:e=>{N(e);const t=Object.entries(e).filter(([e,t])=>t).map(([e,t])=>`${e}:${t}`).join(" ");t&&h(e=>`${e} ${t}`.trim())},currentFilters:w})}),g?r.jsx(we,{query:g,filter:b,onFilterChange:p,userRole:l.role,devices:u,customers:x}):r.jsx(je,{recentSearches:f,onSearch:h,onRemoveSearch:e=>{const t=f.filter(t=>t!==e);y(t),localStorage.setItem("recentSearches",JSON.stringify(t))},userRole:l.role})]}),r.jsx("style",{children:"\n          @keyframes fadeIn {\n            from {\n              opacity: 0;\n            }\n            to {\n              opacity: 1;\n            }\n          }\n\n          @keyframes slideDown {\n            from {\n              opacity: 0;\n              transform: translateY(-20px) scale(0.95);\n            }\n            to {\n              opacity: 1;\n              transform: translateY(0) scale(1);\n            }\n          }\n        "})]})})]}),document.body):null},Ae=()=>{const{isOpen:e,initialQuery:t,openSearch:s,closeSearch:a}=o();return c.useEffect(()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),e.stopPropagation(),s())};return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}},[s]),r.jsx(Ee,{isOpen:e,onClose:a,initialQuery:t})},Fe=({count:e,className:t="",compact:s=!1})=>{const a="string"==typeof e?parseInt(e,10):e;return a<=0||isNaN(a)?null:s?r.jsx("div",{className:"absolute -top-1 -right-1 z-10",children:r.jsx("span",{className:"bg-red-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center border border-white shadow",children:a>99?"99+":a})}):r.jsx("span",{className:`\n      inline-flex items-center justify-center\n      min-w-[20px] h-5 px-1.5\n      text-xs font-bold text-white\n      bg-red-500 rounded-full\n      ${t}\n    `,children:a>99?"99+":a})},Ie=()=>{var t,a,l,o,m,f,y,v,w,N;const{currentUser:k,logout:C}=e(),{isDark:S}=s();let _=[],z=[];try{const e=d();_=(null==e?void 0:e.devices)||[]}catch(Se){_=[]}try{const e=i();z=(null==e?void 0:e.customers)||[]}catch(Se){z=[]}const{businessInfo:E}=b(),[A,F]=c.useState(!1),[T,M]=c.useState(!0),[O,q]=c.useState(!1),[B,U]=c.useState(!1),[Y,V]=c.useState(!1),[Z,X]=c.useState(()=>{const e=localStorage.getItem("navReadItems");return e?new Set(JSON.parse(e)):new Set}),[ee,pe]=c.useState(!1),fe=x(),ye=u(),ve=c.useRef(null);c.useEffect(()=>{const e=()=>{pe(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const je="/pos"===ye.pathname,we=e=>{X(t=>{const s=new Set([...t,e]);return localStorage.setItem("navReadItems",JSON.stringify([...s])),s})};c.useEffect(()=>{ye.pathname&&we(ye.pathname)},[ye.pathname]),c.useEffect(()=>{const e=e=>{ve.current&&!ve.current.contains(e.target)&&(U(!1),V(!1))};return B&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[B]);const Ne=(()=>{const e=new Date,t=new Date(e.getTime()-864e5),s=new Date(e.getTime()-6048e5);return{totalDevices:_.length,activeDevices:_.filter(e=>"done"!==e.status&&"failed"!==e.status).length,recentDevices:_.filter(e=>new Date(e.createdAt||e.updatedAt)>t).length,overdueDevices:_.filter(t=>{if("done"===t.status||"failed"===t.status)return!1;if(!t.expectedReturnDate)return!1;return new Date(t.expectedReturnDate)<e}).length,recentCustomers:z.filter(e=>{if(!e.created_at)return!1;return new Date(e.created_at)>s}).length,newCustomers:z.filter(e=>!1===e.isRead||void 0===e.isRead).length}})();c.useEffect(()=>{k||(localStorage.setItem("postLoginRedirect",ye.pathname),fe("/login"))},[k,ye.pathname,fe]);if(!k)return null;const ke=(e,t)=>!t||t<=0||Z.has(e)?0:t,Ce=(()=>{if("technician"===(null==k?void 0:k.role))return[{path:"/dashboard",label:"Dashboard",icon:r.jsx(le,{size:20,strokeWidth:1.5}),roles:["technician"],count:Ne.activeDevices},{path:"/devices",label:"My Devices",icon:r.jsx(I,{size:20,strokeWidth:1.5}),roles:["technician"],count:Ne.activeDevices+Ne.overdueDevices},{path:"/lats/spare-parts",label:"Spare Parts",icon:r.jsx(H,{size:20,strokeWidth:1.5}),roles:["technician"],count:Math.floor(2*Math.random())}];return[{path:"/dashboard",label:"Dashboard",icon:r.jsx(le,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:Ne.activeDevices},{path:"/pos",label:"POS System",icon:r.jsx(G,{size:20,strokeWidth:1.5}),roles:["admin","customer-care"],count:0},{path:"/lats/trade-in/management",label:"Trade-in",icon:r.jsx(ie,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/devices",label:"Devices",icon:r.jsx(I,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:Ne.activeDevices+Ne.overdueDevices},{path:"/customers",label:"Customers",icon:r.jsx(K,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:Ne.newCustomers},{path:"/appointments",label:"Appointments",icon:r.jsx(L,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:0},{path:"/reminders",label:"Reminders",icon:r.jsx(R,{size:20,strokeWidth:1.5}),roles:["admin","customer-care","technician"],count:0},{path:"/lats/unified-inventory",label:"Inventory",icon:r.jsx(H,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/lats/spare-parts",label:"Spare Parts",icon:r.jsx(oe,{size:20,strokeWidth:1.5}),roles:["admin","technician"],count:0},{path:"/lats/storage-rooms",label:"Storage Rooms",icon:r.jsx(Q,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/lats/stock-transfers",label:"Stock Transfers",icon:r.jsx(de,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/lats/purchase-orders",label:"Purchase Orders",icon:r.jsx(ce,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/special-orders",label:"Special Orders",icon:r.jsx(me,{size:20,strokeWidth:1.5}),roles:["admin","sales","manager","customer-care"],count:0},{path:"/installments",label:"Installment Plans",icon:r.jsx(D,{size:20,strokeWidth:1.5}),roles:["admin","sales","manager","customer-care"],count:0},{path:"/lats/sales-reports",label:"Sales Reports",icon:r.jsx(ue,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/payments",label:"Payments",icon:r.jsx($,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/lats/loyalty",label:"Loyalty Program",icon:r.jsx(xe,{size:20,strokeWidth:1.5}),roles:["admin"],count:0},{path:"/employees",label:"Employees",icon:r.jsx(ge,{size:20,strokeWidth:1.5}),roles:["admin","manager"],count:0},{path:"/my-attendance",label:"My Attendance",icon:r.jsx(P,{size:20,strokeWidth:1.5}),roles:["admin","manager","cashier","customer-care","technician","inventory-manager"],count:0},{path:"/lats/whatsapp-chat",label:"WhatsApp",icon:r.jsx(he,{size:20,strokeWidth:1.5}),roles:["admin","customer-care"],count:0},{path:"/sms",label:"SMS",icon:r.jsx(J,{size:20,strokeWidth:1.5}),roles:["admin","customer-care"],count:0},{path:"/customer-portal/products",label:"Customer Portal",icon:r.jsx(be,{size:20,strokeWidth:1.5}),roles:["admin"],count:0,badge:"ðŸŒ"}].filter(e=>e.roles.includes(k.role))})();return je?r.jsx("div",{className:"min-h-screen",style:{backgroundColor:"transparent"},children:r.jsx("main",{className:"min-h-screen relative z-10 pt-0 pb-8",children:r.jsx(g,{})})}):r.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"transparent","--sidebar-width":ee?"0px":T?"88px":"288px","--topbar-height":"64px"},children:[r.jsx(ze,{onMenuToggle:()=>F(!A),isMenuOpen:A,isNavCollapsed:T}),A&&r.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-30 md:hidden",onClick:()=>F(!1)}),r.jsx("div",{className:`\n          fixed top-0 bottom-0 left-0 z-40 w-64 md:w-72 \n          ${S?"bg-slate-900/95":"bg-white/80"} backdrop-blur-xl \n          ${S?"border-slate-700/50":"border-white/30"} border-r shadow-xl\n          transition-all duration-500 transform\n          ${A?"translate-x-0":"-translate-x-full md:translate-x-0"} \n          ${T?"md:w-[5.5rem]":"md:w-72"}\n          sidebar-hover sidebar-bg\n        `,onMouseEnter:()=>{window.innerWidth>=768&&T&&M(!1)},onMouseLeave:()=>{window.innerWidth>=768&&!T&&M(!0)},children:r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx("div",{className:`\n            p-6 ${S?"border-slate-700/50":"border-white/20"} border-b flex items-center \n            ${S?"bg-slate-900/40":"bg-white/20"}\n            ${T?"justify-center":""}\n          `,children:r.jsxs("div",{className:"flex items-center gap-3 w-full",children:[(null==E?void 0:E.logo)?r.jsx("div",{className:"relative",children:r.jsx("div",{className:"rounded-full bg-white shadow-lg overflow-hidden flex items-center justify-center "+(T?"w-10 h-10":"w-12 h-12"),children:r.jsx("img",{src:E.logo,alt:E.name||"Business Logo",className:"w-full h-full object-cover"})})}):r.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 text-white shadow-lg "+(T?"w-10 h-10":""),children:r.jsx(I,{className:"h-6 w-6 "+(T?"scale-90":""),strokeWidth:1.5})}),r.jsxs("div",{className:`transition-opacity duration-300 ${T?"md:hidden":""} min-w-0 flex-1`,children:[r.jsx("h1",{className:"font-bold text-xl truncate "+(S?"text-white":"text-gray-900"),children:(null==E?void 0:E.name)||"inauzwa"}),(null==E?void 0:E.address)&&r.jsx("p",{className:"text-sm truncate "+(S?"text-gray-400":"text-gray-600"),children:E.address})]})]})}),r.jsx("nav",{className:`flex-1 ${T?"p-2 scrollbar-hide":"p-4 sidebar-scrollbar"} overflow-y-auto`,children:r.jsx("ul",{className:"space-y-1",children:Ce.map(e=>r.jsx("li",{children:r.jsxs("div",{className:"relative group",children:[r.jsxs(h,{to:e.path,className:`\n                        flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-300\n                        ${T?"justify-center":""}\n                        ${ye.pathname===e.path?S?"bg-gradient-to-r from-blue-600/20 to-indigo-600/20 text-blue-400 font-medium shadow-sm backdrop-blur-sm border border-blue-500/30":"bg-gradient-to-r from-blue-500/10 to-indigo-500/10 text-blue-700 font-medium shadow-sm backdrop-blur-sm border border-blue-200/30":S?"text-gray-300 hover:bg-slate-800/60 hover:text-white":"text-gray-700 hover:bg-white/40 hover:text-gray-900"}\n                      `,onClick:()=>{F(!1),we(e.path)},children:[r.jsxs("span",{className:`\n                      ${ye.pathname===e.path?S?"text-blue-400":"text-blue-600":S?"text-gray-400":"text-blue-500"}\n                      ${T?"w-8 h-8 flex items-center justify-center":""}\n                      relative\n                    `,children:[e.icon,ke(e.path,e.count)>0&&T&&r.jsx(Fe,{count:ke(e.path,e.count),compact:!0})]}),r.jsx("span",{className:`transition-opacity duration-300 ${T?"md:hidden":""} flex-1`,children:e.label}),ke(e.path,e.count)>0&&!T&&r.jsx(Fe,{count:ke(e.path,e.count),className:""+(T?"md:hidden":"")}),ye.pathname===e.path&&r.jsx(te,{size:16,strokeWidth:1.5,className:`\n                          ml-auto ${S?"text-blue-400":"text-blue-500"}\n                          ${T?"md:hidden":""}\n                        `})]}),T&&r.jsxs("div",{className:`absolute left-full ml-2 top-1/2 transform -translate-y-1/2 px-3 py-2 \n                        ${S?"bg-slate-800/95 border-slate-600/50 text-gray-200":"bg-white/95 border-gray-200/50 text-gray-700"} \n                        backdrop-blur-sm border text-xs font-medium rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap z-50`,children:[e.label,r.jsx("div",{className:"absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent \n                          "+(S?"border-r-slate-800/95":"border-r-white/95")})]})]})},e.path))})}),r.jsxs("div",{className:`${T?"p-2":"p-4"} ${S?"border-slate-700/50":"border-white/20"} border-t relative`,ref:ve,children:[r.jsxs("div",{className:`\n              flex items-center gap-3 p-2 rounded-lg\n              ${S?"bg-gradient-to-br from-slate-800 to-slate-900":"bg-gradient-to-br from-gray-100 to-gray-50"}\n              backdrop-blur-sm mb-4 \n              ${T?"justify-center":""}\n            `,children:[r.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg",children:r.jsx(W,{size:20,strokeWidth:1.5})}),r.jsxs("div",{className:`transition-opacity duration-300 ${T?"md:hidden":""} min-w-0 flex-1`,children:[r.jsx("p",{className:"font-medium truncate "+(S?"text-white":"text-gray-900"),children:k.name}),r.jsxs("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),U(!B),V(!1)},onMouseEnter:()=>!B&&V(!0),onMouseLeave:()=>V(!1),className:`flex items-center gap-1 w-full text-left text-sm capitalize ${S?"text-gray-400 hover:text-gray-300":"text-gray-600 hover:text-gray-800"} cursor-pointer transition-colors`,children:[r.jsx("span",{className:"truncate",children:k.role.replace("-"," ")}),B?r.jsx(se,{size:14}):r.jsx(j,{size:14})]})]})]}),Y&&!B&&!T&&r.jsx("div",{className:`\n                  absolute bottom-full left-0 right-0 mb-2 mx-4\n                  ${S?"bg-gradient-to-br from-slate-800/95 to-slate-900/95":"bg-gradient-to-br from-white/95 to-gray-50/95"}\n                  backdrop-blur-xl rounded-lg shadow-xl border\n                  ${S?"border-slate-700/50":"border-white/20"}\n                  overflow-hidden\n                  animate-in fade-in duration-150\n                  p-3\n                `,style:{zIndex:9999},onMouseEnter:()=>V(!0),onMouseLeave:()=>V(!1),children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-xs "+(S?"text-gray-400":"text-gray-600"),children:"Click to view menu"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(re,{size:14,className:S?"text-gray-500":"text-gray-400",strokeWidth:1.5}),((null==(t=k.permissions)?void 0:t.includes("all"))||(null==(a=k.permissions)?void 0:a.includes("manage_users"))||"admin"===k.role)&&r.jsx(K,{size:14,className:S?"text-gray-500":"text-gray-400",strokeWidth:1.5}),r.jsx(W,{size:14,className:S?"text-gray-500":"text-gray-400",strokeWidth:1.5})]})]})}),Y&&!B&&T&&r.jsxs("div",{className:`\n                  absolute bottom-full left-full ml-2 mb-2\n                  ${S?"bg-gradient-to-br from-slate-800/95 to-slate-900/95":"bg-gradient-to-br from-white/95 to-gray-50/95"}\n                  backdrop-blur-xl rounded-lg shadow-xl border\n                  ${S?"border-slate-700/50":"border-white/20"}\n                  overflow-hidden\n                  animate-in fade-in duration-150\n                  px-3 py-2 flex gap-2\n                `,style:{zIndex:9999},onMouseEnter:()=>V(!0),onMouseLeave:()=>V(!1),children:[r.jsx(re,{size:14,className:S?"text-gray-400":"text-gray-500",strokeWidth:1.5}),((null==(l=k.permissions)?void 0:l.includes("all"))||(null==(o=k.permissions)?void 0:o.includes("manage_users"))||"admin"===k.role)&&r.jsx(K,{size:14,className:S?"text-gray-400":"text-gray-500",strokeWidth:1.5}),r.jsx(W,{size:14,className:S?"text-gray-400":"text-gray-500",strokeWidth:1.5})]}),B&&T&&r.jsx("div",{className:`\n                  absolute bottom-full left-full ml-2 mb-2\n                  ${S?"bg-gradient-to-br from-slate-800/95 to-slate-900/95":"bg-gradient-to-br from-white/95 to-gray-50/95"}\n                  backdrop-blur-xl rounded-xl shadow-2xl border\n                  ${S?"border-slate-700/50":"border-white/20"}\n                  overflow-hidden\n                  animate-in slide-in-from-left-2 fade-in duration-200\n                  w-48\n                `,style:{zIndex:9999},children:r.jsxs("div",{className:"py-2 px-2",children:[r.jsxs("button",{onClick:()=>{fe("/admin-settings"),U(!1)},className:`\n                      w-full px-3 py-2 text-left text-sm rounded-lg\n                      ${S?"text-gray-300 hover:bg-slate-700/50 hover:text-white":"text-gray-700 hover:bg-gray-100/80 hover:text-gray-900"}\n                      transition-all duration-200 flex items-center gap-3\n                    `,children:[r.jsx(re,{size:16,strokeWidth:1.5}),r.jsx("span",{children:"Settings"})]}),((null==(m=k.permissions)?void 0:m.includes("all"))||(null==(f=k.permissions)?void 0:f.includes("manage_users"))||"admin"===k.role)&&r.jsxs("button",{onClick:()=>{fe("/users"),U(!1)},className:`\n                        w-full px-3 py-2 text-left text-sm rounded-lg\n                        ${S?"text-gray-300 hover:bg-slate-700/50 hover:text-white":"text-gray-700 hover:bg-gray-100/80 hover:text-gray-900"}\n                        transition-all duration-200 flex items-center gap-3\n                      `,children:[r.jsx(K,{size:16,strokeWidth:1.5}),r.jsx("span",{children:"Users"})]}),r.jsxs("button",{onClick:()=>{alert(`Name: ${k.name}\nRole: ${k.role}\nEmail: ${k.email||"N/A"}\nID: ${k.id}`),U(!1)},className:`\n                      w-full px-3 py-2 text-left text-sm rounded-lg\n                      ${S?"text-gray-300 hover:bg-slate-700/50 hover:text-white":"text-gray-700 hover:bg-gray-100/80 hover:text-gray-900"}\n                      transition-all duration-200 flex items-center gap-3\n                    `,children:[r.jsx(W,{size:16,strokeWidth:1.5}),r.jsx("span",{children:"Info"})]})]})}),B&&!T&&r.jsxs("div",{className:`\n                  absolute bottom-full left-0 right-0 mb-2 mx-4\n                  ${S?"bg-gradient-to-br from-slate-800/95 to-slate-900/95":"bg-gradient-to-br from-white/95 to-gray-50/95"}\n                  backdrop-blur-xl rounded-xl shadow-2xl border\n                  ${S?"border-slate-700/50":"border-white/20"}\n                  overflow-hidden\n                  animate-in slide-in-from-bottom-2 fade-in duration-200\n                `,style:{zIndex:9999},children:[r.jsxs("div",{className:`\n                  p-4 \n                  ${S?"bg-gradient-to-br from-indigo-600/20 to-purple-600/20 border-b border-slate-700/50":"bg-gradient-to-br from-indigo-50 to-purple-50 border-b border-gray-200/50"}\n                `,children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg",children:r.jsx(W,{size:16,strokeWidth:1.5})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-semibold truncate "+(S?"text-white":"text-gray-900"),children:k.name}),r.jsx("p",{className:"text-xs truncate "+(S?"text-gray-400":"text-gray-600"),children:k.email||"No email"})]})]}),r.jsx("div",{className:`\n                    mt-2 px-2 py-1 rounded-md inline-block text-xs font-medium capitalize\n                    ${S?"bg-slate-800/50 text-indigo-400":"bg-white/50 text-indigo-600"}\n                  `,children:k.role.replace("-"," ")})]}),r.jsxs("div",{className:"py-2 px-2",children:[r.jsxs("button",{onClick:()=>{fe("/settings"),U(!1)},className:`\n                      w-full px-3 py-2.5 text-left text-sm rounded-lg\n                      ${S?"text-gray-300 hover:bg-slate-700/50 hover:text-white":"text-gray-700 hover:bg-gray-100/80 hover:text-gray-900"}\n                      transition-all duration-200 flex items-center gap-3\n                      group\n                    `,children:[r.jsx("div",{className:`\n                      p-1.5 rounded-md\n                      ${S?"bg-slate-700/50 group-hover:bg-indigo-600":"bg-gray-100 group-hover:bg-indigo-600"}\n                      transition-colors duration-200\n                    `,children:r.jsx(re,{size:14,className:"group-hover:text-white",strokeWidth:1.5})}),r.jsx("span",{className:"font-medium",children:"Settings"})]}),"admin"===(null==k?void 0:k.role)&&r.jsxs("button",{onClick:()=>{fe("/admin-settings"),U(!1)},className:`\n                        w-full px-3 py-2.5 text-left text-sm rounded-lg mt-1\n                        ${S?"text-gray-300 hover:bg-slate-700/50 hover:text-white":"text-gray-700 hover:bg-gray-100/80 hover:text-gray-900"}\n                        transition-all duration-200 flex items-center gap-3\n                        group\n                      `,children:[r.jsx("div",{className:`\n                        p-1.5 rounded-md\n                        ${S?"bg-slate-700/50 group-hover:bg-red-600":"bg-gray-100 group-hover:bg-red-600"}\n                        transition-colors duration-200\n                      `,children:r.jsx(ae,{size:14,className:"group-hover:text-white",strokeWidth:1.5})}),r.jsx("span",{className:"font-medium",children:"Admin Settings"})]}),((null==(y=k.permissions)?void 0:y.includes("all"))||(null==(v=k.permissions)?void 0:v.includes("manage_users"))||"admin"===k.role)&&r.jsxs("button",{onClick:()=>{fe("/users"),U(!1)},className:`\n                        w-full px-3 py-2.5 text-left text-sm rounded-lg\n                        ${S?"text-gray-300 hover:bg-slate-700/50 hover:text-white":"text-gray-700 hover:bg-gray-100/80 hover:text-gray-900"}\n                        transition-all duration-200 flex items-center gap-3\n                        group\n                      `,children:[r.jsx("div",{className:`\n                        p-1.5 rounded-md\n                        ${S?"bg-slate-700/50 group-hover:bg-purple-600":"bg-gray-100 group-hover:bg-purple-600"}\n                        transition-colors duration-200\n                      `,children:r.jsx(K,{size:14,className:"group-hover:text-white",strokeWidth:1.5})}),r.jsx("span",{className:"font-medium",children:"User Management"})]}),r.jsxs("button",{onClick:()=>{alert(`Name: ${k.name}\nRole: ${k.role}\nEmail: ${k.email||"N/A"}\nID: ${k.id}`),U(!1)},className:`\n                      w-full px-3 py-2.5 text-left text-sm rounded-lg\n                      ${S?"text-gray-300 hover:bg-slate-700/50 hover:text-white":"text-gray-700 hover:bg-gray-100/80 hover:text-gray-900"}\n                      transition-all duration-200 flex items-center gap-3\n                      group\n                    `,children:[r.jsx("div",{className:`\n                      p-1.5 rounded-md\n                      ${S?"bg-slate-700/50 group-hover:bg-blue-600":"bg-gray-100 group-hover:bg-blue-600"}\n                      transition-colors duration-200\n                    `,children:r.jsx(W,{size:14,className:"group-hover:text-white",strokeWidth:1.5})}),r.jsx("span",{className:"font-medium",children:"Account Info"})]})]})]}),r.jsxs(n,{onClick:()=>{C(),fe("/login")},variant:"danger",className:"w-full "+(T?"justify-center px-0":"justify-start"),children:[r.jsx(ne,{size:18,strokeWidth:1.5}),r.jsx("span",{className:"transition-opacity duration-300 "+(T?"md:hidden":""),children:"Logout"})]})]})]})}),r.jsxs("main",{className:"transition-all duration-500 min-h-screen relative z-10 pt-0 pb-8 "+(T?"md:ml-[5.5rem]":"md:ml-72"),children:[r.jsx(g,{}),((null==(w=k.permissions)?void 0:w.includes("all"))||(null==(N=k.permissions)?void 0:N.includes("create_customers"))||"admin"===k.role||"customer-care"===k.role)&&r.jsx(r.Fragment,{children:r.jsx(p,{isOpen:O,onClose:()=>q(!1)})}),r.jsx(Ae,{})]})]})};export{Ie as default};
