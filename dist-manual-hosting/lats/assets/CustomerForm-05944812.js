import{j as e,s as a,e as t}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import{U as r,A as l,P as o,v as n,b as i,i as c,X as d,R as m,az as u,t as h,a0 as b,bG as p,bH as x,aP as g,aA as f,bI as y,y as j,aC as v,u as N,bJ as w}from"./ui-551a39a6.js";function C({key:e,formData:a,setFormData:t,clearOnSubmit:r=!1,submitted:l=!1}){const o=s.useRef(!0);s.useEffect(()=>{const a=localStorage.getItem(e);if(a)try{const e=JSON.parse(a);t(e)}catch(s){}},[e]),s.useEffect(()=>{o.current?o.current=!1:localStorage.setItem(e,JSON.stringify(a))},[a,e]),s.useEffect(()=>{r&&l&&localStorage.removeItem(e)},[r,l,e]);return{clearDraft:()=>localStorage.removeItem(e)}}const k={name:"",email:"",phone:"",whatsapp:"",gender:"",city:"",birthMonth:"",birthDay:"",referralSource:"",notes:"",referralSourceCustom:""},S=e=>{const a=e.replace(/\D/g,"");return a.startsWith("255")?a:a.startsWith("0")?"255"+a.substring(1):9===a.length?"255"+a:a},M=e=>{const a=S(e);return/^255[67]\d{8}$/.test(a)},D=({onSubmit:D,onCancel:A,isLoading:z=!1,initialValues:B={},showBackAction:E=!1,onBack:T,renderActionsInModal:W=!1,children:L})=>{const[F,I]=s.useState({...k,...B}),[O,q]=s.useState({}),[P,R]=s.useState(!0),[$,J]=s.useState([]),[G,H]=s.useState(!1),[U,K]=s.useState(!1),[V,_]=s.useState(!1),[Q,X]=s.useState(!1),[Y,Z]=s.useState(!1),[ee,ae]=s.useState(!1),[te,se]=s.useState(!1),[re,le]=s.useState(!1),[oe,ne]=s.useState(!1),ie=s.useRef(null);s.useEffect(()=>{ie.current&&ie.current.focus()},[]);const{clearDraft:ce}=C({key:"customer_form_draft",formData:F,setFormData:I,clearOnSubmit:!0,submitted:te});s.useEffect(()=>{I({...k,...B})},[JSON.stringify(B)]);const de=["Dar es Salaam","Arusha","Mwanza","Dodoma","Mbeya","Tanga","Morogoro","Iringa","Tabora","Kigoma","Mara","Kagera","Shinyanga","Singida","Rukwa","Ruvuma","Lindi","Mtwara","Pwani","Manyara","Geita","Simiyu","Katavi","Njombe","Songwe"],me=["January","February","March","April","May","June","July","August","September","October","November","December"],ue=Array.from({length:31},(e,a)=>(a+1).toString()),he=()=>e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"})}),be=[{label:"Friend",icon:e.jsx(h,{className:"w-5 h-5"})},{label:"Walk-in",icon:e.jsx(b,{className:"w-5 h-5"})},{label:"Facebook",icon:e.jsx(p,{className:"w-5 h-5"})},{label:"Instagram",icon:e.jsx(x,{className:"w-5 h-5"})},{label:"Tiktok",icon:e.jsx(he,{})},{label:"Website",icon:e.jsx(g,{className:"w-5 h-5"})},{label:"Business Card",icon:e.jsx(f,{className:"w-5 h-5"})},{label:"Newspaper",icon:e.jsx(y,{className:"w-5 h-5"})},{label:"Google Search",icon:e.jsx(j,{className:"w-5 h-5"})},{label:"Billboard",icon:e.jsx(v,{className:"w-5 h-5"})},{label:"Event",icon:e.jsx(N,{className:"w-5 h-5"})},{label:"Other",icon:e.jsx(w,{className:"w-5 h-5"})}],pe=null==B?void 0:B.id;s.useEffect(()=>{const e=e=>{const a=e.target;U&&!a.closest('[data-dropdown="region"]')&&K(!1),V&&!a.closest('[data-dropdown="month"]')&&_(!1),Q&&!a.closest('[data-dropdown="day"]')&&X(!1),Y&&!a.closest('[data-dropdown="referral"]')&&Z(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[U,V,Q,Y]);s.useEffect(()=>{const e=setTimeout(()=>{F.phone&&F.phone.length>=10&&(async e=>{if(e&&!(e.length<9)){ae(!0);try{const t=S(e),{data:s,error:r}=await a.from("customers").select("id, name, phone, email");if(r)return;const l=s?s.filter(e=>S(e.phone||"")===t&&(!pe||e.id!==pe)):[];l.length>0?(J(l),H(!0),q(e=>({...e,phone:pe?"Another customer with this phone number already exists.":"A customer with this phone number already exists."}))):(J([]),H(!1),q(e=>{const a={...e};return delete a.phone,a}))}catch(t){}finally{ae(!1)}}})(F.phone)},500);return()=>clearTimeout(e)},[F.phone]);const xe=e=>{const{name:a,value:t}=e.target;let s=t;"name"===a&&(s=t.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")),I(e=>({...e,[a]:s})),"phone"===a&&P&&I(e=>({...e,whatsapp:s})),O[a]&&q(e=>({...e,[a]:""}))},ge=async e=>{e.preventDefault(),q({});const a={};if(F.name.trim()||(a.name="Name is required"),F.phone.trim()?M(F.phone)||(a.phone="Please enter a valid Tanzania phone number (e.g., 0712345678 or +255712345678)"):a.phone="Phone number is required",G&&$.length>0&&(a.phone="A customer with this phone number already exists. Please use a different phone number."),F.gender||(a.gender="Gender is required"),(F.birthMonth||F.birthDay)&&(F.birthMonth||(a.birthMonth="Birth month is required if birthday is provided"),F.birthDay||(a.birthDay="Birth day is required if birthday is provided"),F.birthMonth&&F.birthDay)){const e=me.indexOf(F.birthMonth),t=parseInt(F.birthDay),s=[31,29,31,30,31,30,31,31,30,31,30,31];e>=0&&t>s[e]&&(a.birthDay=`${F.birthMonth} has only ${s[e]} days`)}if(P&&F.whatsapp&&!M(F.whatsapp)&&(a.whatsapp="Please enter a valid WhatsApp number"),Object.keys(a).length>0)q(a);else if(navigator.onLine)try{await D(F),se(!0)}catch(s){}else await t({type:"submitData",payload:F}),ne(!0),I({...k}),setTimeout(()=>ne(!1),3e3)},fe=!!F.id,ye=[E&&T?{icon:e.jsx(c,{}),label:"Back",onClick:T,color:"primary"}:null,{icon:e.jsx(d,{}),label:"Cancel",onClick:A,color:"danger"},{icon:e.jsx(m,{}),label:"Reset",onClick:()=>{I({...k}),ce()},color:"secondary"},{icon:z?e.jsx(m,{className:"animate-spin"}):e.jsx(u,{}),label:z?fe?"Updating...":"Adding...":fe?"Update Customer":"Add Customer",onClick:()=>{},color:"success",disabled:z}].filter(Boolean),je=be,ve=s.useMemo(()=>de.filter(e=>e.toLowerCase().includes(F.city.toLowerCase())||""===F.city),[F.city]),Ne=s.useMemo(()=>me.filter(e=>e.toLowerCase().includes(F.birthMonth.toLowerCase())||""===F.birthMonth),[F.birthMonth]),we=s.useMemo(()=>ue.filter(e=>e.includes(F.birthDay)||""===F.birthDay),[F.birthDay]);const Ce=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-gray-700 mb-2 font-medium",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:ie,type:"text",name:"name",value:F.name||"",onChange:xe,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none "+(O.name?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-blue-500"),placeholder:"Enter customer name",required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1,maxLength:100,"aria-label":"Customer name","aria-required":"true"}),e.jsx(r,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),O.name&&e.jsxs("div",{className:"mt-1 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(l,{size:16,className:"text-red-500"}),O.name]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 mb-2 font-medium",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",name:"phone",value:F.phone||"",onChange:xe,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none "+(O.phone?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-blue-500"),placeholder:"e.g., 0712345678 or +255712345678",required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1,maxLength:15,"aria-label":"Customer phone number","aria-required":"true"}),e.jsx(o,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),ee&&e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})})]}),O.phone&&e.jsxs("div",{className:"mt-1 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(l,{size:16,className:"text-red-500"}),O.phone]}),G&&$.length>0&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(l,{size:16,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Existing customer found:"})]}),$.map((a,t)=>e.jsxs("div",{className:"text-sm text-yellow-700",children:["â€¢ ",a.name," (",a.phone,") ",a.email&&`- ${a.email}`]},a.id))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-gray-700 font-medium",children:"WhatsApp"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"hasWhatsapp",checked:P,onChange:e=>{R(e.target.checked),e.target.checked?F.phone&&I(e=>({...e,whatsapp:F.phone})):I(e=>({...e,whatsapp:""}))},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("label",{htmlFor:"hasWhatsapp",className:"text-sm text-gray-600",children:"Has WhatsApp"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"whatsapp",value:F.whatsapp||"",onChange:xe,disabled:!P,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none "+(P?"border-gray-300 focus:border-blue-500":"border-gray-200 bg-gray-50 text-gray-500"),placeholder:P?"Enter WhatsApp number":"WhatsApp disabled",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-label":"WhatsApp number","aria-disabled":!P}),e.jsx(o,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),O.whatsapp&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:O.whatsapp})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Region"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"city",value:F.city||"",onChange:xe,onFocus:()=>K(!0),onBlur:()=>setTimeout(()=>K(!1),200),className:"w-full min-h-[48px] py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Type or select region",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-label":"Region or city",role:"combobox","aria-expanded":U,"aria-autocomplete":"list"}),e.jsx(n,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(i,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),U&&e.jsxs("div",{"data-dropdown":"region",className:"absolute top-full left-0 right-0 mt-1 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto",role:"listbox","aria-label":"Region options",children:[ve.map((a,t)=>e.jsx("div",{className:"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>{I(e=>({...e,city:a})),K(!1)},children:a},a)),0===ve.length&&e.jsx("div",{className:"px-4 py-3 text-gray-500",children:"No matching regions found"})]})]})]}),e.jsxs("div",{className:"md:col-span-1 flex flex-col justify-end",children:[e.jsxs("label",{className:"block text-gray-700 mb-2 font-medium",children:["Gender ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex gap-3",children:[{value:"male",label:"Male",icon:"ðŸ‘¨"},{value:"female",label:"Female",icon:"ðŸ‘©"}].map(a=>{const t=F.gender===a.value;return e.jsxs("button",{type:"button",onClick:()=>{I(e=>({...e,gender:a.value})),O.gender&&q(e=>{const a={...e};return delete a.gender,a})},className:`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-lg border-2 text-sm font-medium transition-all duration-200 cursor-pointer relative\n                  ${O.gender&&!t?"border-red-500 bg-red-50":t?"male"===a.value?"bg-blue-600 text-white border-blue-600 shadow-lg":"bg-pink-600 text-white border-pink-600 shadow-lg":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400 hover:shadow-md"}\n                  focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-opacity-50\n                  h-[52px]`,style:{userSelect:"none"},"aria-label":`Select ${a.label}`,"aria-pressed":t,children:[e.jsx("span",{className:"text-lg",children:a.icon}),e.jsx("span",{className:"font-medium",children:a.label})]},a.value)})}),O.gender&&e.jsxs("div",{className:"mt-1 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(l,{size:16,className:"text-red-500"}),O.gender]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Birthday"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"birthMonth",value:F.birthMonth||"",onChange:xe,onFocus:()=>_(!0),onBlur:()=>setTimeout(()=>_(!1),200),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none "+(O.birthMonth?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-blue-500"),placeholder:"Type or select month",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-label":"Birth month",role:"combobox","aria-expanded":V,"aria-autocomplete":"list"}),e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"ðŸŽ‚"}),e.jsx(i,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),V&&e.jsxs("div",{"data-dropdown":"month",className:"absolute top-full left-0 right-0 mt-1 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto p-2",role:"listbox","aria-label":"Month options",children:[e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Ne.map(a=>e.jsx("div",{className:"px-3 py-2 hover:bg-blue-50 cursor-pointer rounded text-sm",onClick:()=>{I(e=>({...e,birthMonth:a})),_(!1)},children:a},a))}),0===Ne.length&&e.jsx("div",{className:"px-4 py-3 text-gray-500",children:"No matching months found"})]}),O.birthMonth&&e.jsxs("div",{className:"mt-1 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(l,{size:16,className:"text-red-500"}),O.birthMonth]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"birthDay",value:F.birthDay||"",onChange:xe,onFocus:()=>X(!0),onBlur:()=>setTimeout(()=>X(!1),200),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none "+(O.birthDay?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-blue-500"),placeholder:"Type or select day",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-label":"Birth day",role:"combobox","aria-expanded":Q,"aria-autocomplete":"list"}),e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"ðŸŽ‰"}),e.jsx(i,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),Q&&e.jsxs("div",{"data-dropdown":"day",className:"absolute top-full left-0 right-0 mt-1 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto p-2",role:"listbox","aria-label":"Day options",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1",children:we.map(a=>e.jsx("div",{className:"px-2 py-2 hover:bg-blue-50 cursor-pointer rounded text-sm text-center",onClick:()=>{I(e=>({...e,birthDay:a})),X(!1)},children:a},a))}),0===we.length&&e.jsx("div",{className:"px-4 py-3 text-gray-500",children:"No matching days found"})]}),O.birthDay&&e.jsxs("div",{className:"mt-1 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(l,{size:16,className:"text-red-500"}),O.birthDay]})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"How did you hear about us?"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:je.map(a=>{const t=F.referralSource===a.label;return e.jsxs("button",{type:"button",onClick:()=>{return e=a.label,void I(a=>({...a,referralSource:e}));var e},className:"flex items-center gap-2 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors "+(t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),style:{userSelect:"none"},children:[e.jsx("span",{className:t?"text-white":"text-gray-500",children:a.icon}),e.jsx("span",{className:"text-xs",children:a.label})]},a.label)})}),"Other"===F.referralSource&&e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",name:"referralSourceCustom",value:F.referralSourceCustom||"",onChange:e=>I(a=>({...a,referralSourceCustom:e.target.value})),className:"w-full py-2.5 px-3 bg-white border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-sm",placeholder:"Please specify...",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-label":"Custom referral source"})})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:re?e.jsx("button",{type:"button",onClick:()=>le(!1),className:"text-gray-500 hover:underline text-sm mt-2",children:"Hide Notes"}):e.jsx("button",{type:"button",onClick:()=>le(!0),className:"text-blue-600 hover:underline text-sm mt-2",children:"+ Add Notes"})}),re&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Notes"}),e.jsx("textarea",{name:"notes",value:F.notes||"",onChange:xe,rows:2,className:"w-full min-h-[48px] py-3 px-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none resize-none",placeholder:"Additional notes",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-label":"Additional notes"})]})]})}),ke=e.jsxs("div",{style:{position:"relative"},children:[oe&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg text-center text-base font-semibold animate-fade-in",children:"Customer saved offline! Will sync when you are back online."}),e.jsx("form",{id:"customer-form",onSubmit:ge,className:"space-y-6",children:Ce()})]});if(W&&"function"==typeof L){return L(e.jsx("div",{className:"flex gap-3 w-full justify-end",children:ye.map((a,t)=>{const{icon:s,label:r,onClick:l,color:o,disabled:n}=a;return e.jsxs("button",{type:t===ye.length-1?"submit":"button",onClick:t===ye.length-1?e=>{e.preventDefault();const a=document.getElementById("customer-form");a&&a.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}:l,disabled:n,className:`flex-1 inline-flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-semibold text-base transition-all duration-200 shadow-sm ml-2\n                ${"danger"===o?"bg-rose-500 text-white hover:bg-rose-600 hover:shadow-md":"success"===o?"bg-emerald-500 text-white hover:bg-emerald-600 hover:shadow-md":"primary"===o?"bg-blue-500 text-white hover:bg-blue-600 hover:shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-md"}\n                ${n?"opacity-50 cursor-not-allowed":"active:scale-95"}\n                focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-opacity-50\n              `,children:[s," ",r]},r)})}),e.jsx("form",{id:"customer-form",onSubmit:ge,className:"space-y-6",children:Ce()}))}return ke};export{D as C,C as u};
