import{u as e,j as t,d as s,G as l,m as r,s as a}from"./index-222cfb29.js";import{r as n}from"./vendor-a2ff445a.js";import{a4 as i,X as o,ai as d,o as c,aj as m,I as h,d as u,e as x,al as p,n as g,i as b,q as f,t as y}from"./ui-551a39a6.js";import{f as j,a as w}from"./phoneUtils-1ba19aca.js";import{a as v}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";const N=({isOpen:b,onClose:f,onImportComplete:y})=>{const{currentUser:v}=e(),[N,S]=n.useState(null),[C,k]=n.useState([]),[D,L]=n.useState([]),[I,M]=n.useState(!1),[F,z]=n.useState(!1),[E,R]=n.useState("upload"),[T,$]=n.useState(0),[A,P]=n.useState([]),[O,B]=n.useState([]),[V,U]=n.useState(!1),[q,H]=n.useState(!1),[G,K]=n.useState(!1),[J,W]=n.useState([]),[Y,_]=n.useState(!1),[Q,Z]=n.useState(new Set),[X,ee]=n.useState(new Map),[te,se]=n.useState(!0),[le,re]=n.useState([]),[ae,ne]=n.useState([]),[ie,oe]=n.useState(null),[de,ce]=n.useState(""),[me,he]=n.useState(!0),[ue,xe]=n.useState({}),[pe,ge]=n.useState([]),[be]=n.useState({name:["name","full name","customer name","first name","client name","customer","client","fullname","firstname","lastname","first name","last name","fullname","customer full name","client full name","person name","contact name"],phone:["phone","phone number","mobile","mobile phone","primary phone","phone 1 - value","contact","contact number","telephone","tel","cell","cell phone","mobile number","phone number","contact phone","primary contact","phone contact","mobile contact","telephone number"],whatsapp:["whatsapp","whatsapp number","whats app","whatsapp phone","wa","whatsapp contact","whatsapp number","whatsapp contact","whats app number","whatsapp mobile","wa number","wa contact"],gender:["gender","sex","male/female","m/f","gender identity","male or female","m or f","gender type","sex type"],city:["city","location","home city","business city","town","address","residence","home town","business town","home location","business location","home address","business address","city location","town location"],notes:["notes","comments","remarks","description","details","additional info","extra info","customer notes","client notes","additional notes","extra notes","remarks notes","description notes"],loyaltyLevel:["loyalty","loyalty level","level","customer level","tier","membership level","loyalty tier","customer tier","membership tier","loyalty status","customer status","level status"],colorTag:["color tag","tag","customer tag","status tag","priority","category","type","customer type","client type","priority tag","category tag","status type"],birthMonth:["birth month","month","birthday month","month of birth","dob month","birth month","month of birth","birthday month","birth month number","month number"],birthDay:["birth day","day","birthday day","day of birth","dob day","birth date","birth day","day of birth","birthday day","birth day number","day number"],referralSource:["referral source","referral","referred by","referral resource","how did you hear","source","referrer source","how did you hear about us","how did you find us","referral method","referral type","referral source type"],referralSourceCustom:["referral source custom","custom referral","other referral","custom source","other referral source","custom referral source","other source"],locationDescription:["location description","address","home address","business address","street address","full address","detailed address","home location","business location","street location","full location","detailed location"],nationalId:["national id","id number","national id number","identity number","id card","passport number","national id number","identity card","id card number","passport id","national identity","identity card number"],referredBy:["referred by","referrer","who referred","referred by name","referrer name","who referred you","referred by person","referrer person","who referred customer"],totalSpent:["total spent","spent","total amount","amount spent","total purchase","total value","total amount spent","total purchase amount","total value spent","customer spent","client spent"],points:["points","loyalty points","reward points","customer points","bonus points","loyalty reward points","customer reward points","bonus reward points","points earned","points accumulated"],isActive:["is active","active","status","customer status","active status","customer active","client active","active customer","active client","customer is active","client is active"],profileImage:["profile image","image","photo","picture","avatar","profile picture","customer image","client image","profile photo","customer photo","client photo","profile avatar"],birthday:["birthday","birth day","birth","birth date","date of birth","dob","birth date","birthday date","date of birth","birthday day","birth day date"]}),fe=n.useRef(null),ye=j,je=w,we=(e,t,s)=>{const l=s[t];return void 0!==l&&l>=0&&l<e.length&&e[l]||""},ve=e=>{if(!e)return"";const t=e.trim();return t===t.toUpperCase()&&t.length>1||t===t.toUpperCase()?t.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase()):t},Ne=e=>{if(!e)return"other";const t=e.trim().toLowerCase();return"male"===t||"m"===t?"male":"female"===t||"f"===t?"female":"other"},Se=e=>{if(!e)return"";const t=e.trim(),s={mtandaoni:"Social Media",physically:"Walk-in",recommendation:"Friend","social media":"Social Media",facebook:"Facebook",google:"Google",friend:"Friend",family:"Family",colleague:"Colleague",advertisement:"Advertisement",website:"Website","walk-in":"Walk-in",referral:"Referral",other:"Other"},l=t.toLowerCase();return s[l]?s[l]:t===t.toUpperCase()&&t.length>1?t.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase()):t},Ce=e=>{if(!e)return"";const t=e.trim(),s={dsm:"Dar es Salaam",dar:"Dar es Salaam","dar es":"Dar es Salaam","dar es salaam":"Dar es Salaam",mara:"Mara",moro:"Morogoro",arusha:"Arusha",mwanza:"Mwanza",dodoma:"Dodoma",tanga:"Tanga",mbeya:"Mbeya",morogoro:"Morogoro",tabora:"Tabora",singida:"Singida",kigoma:"Kigoma",shinyanga:"Shinyanga",kagera:"Kagera",manyara:"Manyara",njombe:"Njombe",katavi:"Katavi",geita:"Geita",simiyu:"Simiyu",songwe:"Songwe"},l=t.toLowerCase();return s[l]?s[l]:t},ke=e=>{if(!e)return{month:"",day:""};const t=e.trim().toLowerCase(),s=t.match(/^(\d{1,2})-([a-z]{3,})$/);if(s){const e=s[1],t={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"}[s[2]];if(t)return{month:t,day:e}}const l=t.match(/^([a-z]{3,})-(\d{1,2})$/);if(l){const e=l[1],t=l[2],s={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"}[e];if(s)return{month:s,day:t}}return{month:"",day:""}},De=e=>{if(!e)return"new";return{new:"new",vip:"vip",complainer:"complainer",purchased:"purchased","not new":"new",normal:"new",regular:"new",standard:"new",basic:"new",premium:"vip",important:"vip",priority:"vip",problem:"complainer",issue:"complainer",buyer:"purchased",customer:"purchased",buying:"purchased"}[e.trim().toLowerCase()]||"new"},Le=(e,t)=>{var s,l;const r=[];if((null==(s=e.name)?void 0:s.trim())||r.push(`Row ${t}: Name is required`),(null==(l=e.phone)?void 0:l.trim())?/^[+]?[0-9\s\-()]{8,}$/.test(e.phone)||r.push(`Row ${t}: Invalid phone number format`):r.push(`Row ${t}: Phone number is required`),e.gender&&!["male","female","other"].includes(e.gender)&&r.push(`Row ${t}: Gender must be male, female, or other`),e.loyaltyLevel&&!["bronze","silver","gold","platinum"].includes(e.loyaltyLevel)&&r.push(`Row ${t}: Invalid loyalty level`),e.birthMonth&&!e.birthDay&&r.push(`Row ${t}: Birth day is required if birth month is provided`),e.birthDay&&!e.birthMonth&&r.push(`Row ${t}: Birth month is required if birth day is provided`),e.birthDay){const s=parseInt(e.birthDay);(isNaN(s)||s<1||s>31)&&r.push(`Row ${t}: Birth day must be a number between 1-31`)}return r},Ie=(e,t)=>Le(e,t+2),Me=(e,t,s)=>Ie(e,t).some(e=>e.toLowerCase().includes(s.toLowerCase())||"name"===s&&e.includes("Name is required")||"phone"===s&&(e.includes("Phone number is required")||e.includes("Invalid phone number format"))),Fe=(e,t,s)=>Ie(e,t).find(e=>e.toLowerCase().includes(s.toLowerCase())||"name"===s&&e.includes("Name is required")||"phone"===s&&(e.includes("Phone number is required")||e.includes("Invalid phone number format")))||"",ze=async e=>{var t;if(b)try{M(!0),B([]);const s=(await e.text()).split("\n").filter(e=>e.trim());if(s.length<2)return void g.error("File must contain at least a header row and one data row");const l=(null==(t=s[0])?void 0:t.split(",").map(e=>e.trim()))||[],r=(e=>{const t={},s=e.map(e=>e.trim().toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," "));return Object.entries(be).forEach(([e,l])=>{let r=-1,a=0;s.forEach((t,s)=>{l.forEach(l=>{if(t===l)a<100&&(a=100,r=s);else if(t.includes(l)||l.includes(t)){const e=Math.min(t.length,l.length)/Math.max(t.length,l.length)*80;e>a&&(a=e,r=s)}else{const e=l.split(" "),n=t.split(" ");let i=0;if(e.forEach(e=>{e.length>2&&n.some(t=>t.includes(e)||e.includes(t))&&i++}),i>0){const t=i/e.length*60;t>a&&(a=t,r=s)}}a<40&&({name:["nm","n","full nm","customer nm"],phone:["ph","p","tel","mobile","mob","cell"],whatsapp:["wa","whats","whats app"],gender:["sex","g","m/f","male/female"],city:["location","loc","town","address"],notes:["comment","cmt","remark","desc"],loyalty:["loyal","level","tier","status"],birth:["dob","birthday","birth day"],referral:["ref","referred","source"],total:["amount","sum","spent","value"],points:["pts","reward","bonus"],active:["status","is active","customer status"],image:["photo","pic","picture","avatar"]}[e]||[]).forEach(e=>{if(t.includes(e)||e.includes(t)){const e=50;e>a&&(a=e,r=s)}})})}),-1!==r&&(t[e]=r)}),t})(l);xe(r),ge(l);const n=Object.keys(r).length,i=Object.keys(be).length;0;const o=Object.entries(r).map(([e,t])=>`${e}: "${l[t]||"Unknown"}" (column ${t+1})`).join(", ");n>0?g.success(`‚úÖ Detected ${n}/${i} columns: ${o}`):g("‚ö†Ô∏è Could not detect columns automatically. Please use the template format.");const d=[],c=[];for(let e=1;e<s.length;e++){const t=s[e].trim();if(!t)continue;const l=t.split(",").map(e=>e.trim().replace(/^"|"$/g,"")),a=we(l,"name",r),n=we(l,"phone",r),i=we(l,"whatsapp",r),o=we(l,"gender",r),m=we(l,"city",r),h=we(l,"notes",r),u=we(l,"loyaltyLevel",r),x=we(l,"colorTag",r),p=we(l,"birthMonth",r),g=we(l,"birthDay",r),b=we(l,"referralSource",r),f=we(l,"referralSourceCustom",r),y=we(l,"locationDescription",r),j=we(l,"nationalId",r),w=we(l,"referredBy",r),v=we(l,"totalSpent",r),N=we(l,"points",r),S=we(l,"isActive",r),C=we(l,"profileImage",r),k=we(l,"birthday",r),D={name:ve(a),email:"",phone:ye(n),gender:Ne(o||"other"),city:Ce(m),whatsapp:je(i),notes:h,loyaltyLevel:u||"bronze",colorTag:De(x||"new"),birthMonth:p,birthDay:g,referralSource:Se(b),referralSourceCustom:f,locationDescription:y,nationalId:j,referredBy:w,totalSpent:parseFloat(v||"0")||0,points:parseInt(N||"0")||0,isActive:"false"!==S,profileImage:C};if(k){const e=ke(k);e.month&&e.day&&(D.birthMonth=e.month,D.birthDay=e.day)}if(D.birthMonth&&D.birthMonth.includes("-")){const e=ke(D.birthMonth);e.month&&e.day&&(D.birthMonth=e.month,D.birthDay=e.day)}const L=Le(D,e+1);c.push(...L),D.name&&D.phone&&d.push(D)}const m=(e=>{const t=new Map,s=[];return e.forEach((e,s)=>{const l=ye(e.phone);l&&(t.has(l)||t.set(l,[]),t.get(l).push(s+2))}),t.forEach((e,t)=>{e.length>1&&s.push(`Duplicate phone number "${t}" found in rows: ${e.join(", ")}`)}),s})(d),h=[...c,...m],u=await(async e=>{const t=new Map;try{const s=e.map(e=>ye(e.phone)).filter(e=>e);if(s.length>0){const{data:e,error:l}=await a.from("customers").select("id, name, phone").in("phone",s);!l&&e&&e.forEach(e=>{t.set(e.phone,e)})}}catch(s){}return t})(d);if(ee(u),B(c),ne(m),k(d),W([...d]),L(d),re(d),R("preview"),h.length>0){const e=c.length,t=m.length;g.error(`Found ${e} validation errors and ${t} duplicate entries. Please review before importing.`)}else{const e=u.size,t=d.length-e;g.success(`Processed ${d.length} customers. ${t} new, ${e} existing will be skipped.`)}}catch(s){g.error("Error processing file. Please ensure it's a valid CSV/Excel file.")}finally{M(!1)}},Ee=()=>{S(null),k([]),W([]),L([]),re([]),R("upload"),M(!1),z(!1),K(!1),_(!1),Z(new Set),$(0),P([]),B([]),ne([]),ee(new Map),se(!1),xe({}),ge([]),U(!1),H(!1),fe.current&&(fe.current.value=""),f()},Re=()=>{const e=new Blob(["\ufeffName,Phone Number,WhatsApp Number,Gender,City,Notes,Loyalty Level,Color Tag,Birth Month,Birth Day,Referral Source,Location Description,National ID,Referred By,Total Spent,Points,Is Active,Email,Profile Image\nJohn Doe,+255712345678,+255712345678,male,Dar es Salaam,Regular customer prefers phone calls,bronze,new,3,15,social media,123 Main Street Dar es Salaam,1234567890123456,Jane Smith,50000,100,true,john.doe@email.com,https://example.com/profile.jpg\nJane Smith,+255723456789,+255723456789,female,Arusha,VIP customer very satisfied,silver,vip,6,22,recommendation,456 Business Ave Arusha,2345678901234567,Mike Johnson,75000,150,true,jane.smith@email.com,\nMike Johnson,+255734567890,+255734567890,male,Mwanza,Regular customer,gold,new,12,5,physically,789 Home Road Mwanza,3456789012345678,Alice Brown,100000,200,true,mike.johnson@email.com,\nAlice Brown,+255745678901,+255745678901,female,Dodoma,Social media customer,platinum,purchased,9,10,facebook,321 Social Street Dodoma,4567890123456789,John Doe,150000,300,true,alice.brown@email.com,"],{type:"text/csv;charset=utf-8;"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="customer_import_template.csv",s.click(),window.URL.revokeObjectURL(t),g.success("Template downloaded! Use this format for best results. Gender: male/female/other, Loyalty: bronze/silver/gold/platinum, Color Tag: new/vip/complainer/purchased")};n.useEffect(()=>{const e=()=>{const e=document.body,t=e.classList.contains("sidebar-open")||e.classList.contains("sidebar-visible")||null!==document.querySelector(".sidebar:not(.hidden)");he(t)};return e(),window.addEventListener("resize",e),document.addEventListener("DOMContentLoaded",e),()=>{window.removeEventListener("resize",e),document.removeEventListener("DOMContentLoaded",e)}},[]);const Te=(e,t,s)=>{(null==ie?void 0:ie.row)===e&&(null==ie?void 0:ie.field)===t||(!ie||ie.row===e&&ie.field===t||$e(de),oe({row:e,field:t}),ce(s),setTimeout(()=>{const s=document.querySelector(`input[data-row="${e}"][data-field="${t}"], select[data-row="${e}"][data-field="${t}"], textarea[data-row="${e}"][data-field="${t}"]`);s&&(s.focus(),(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement)&&s.setSelectionRange(s.value.length,s.value.length))},0))},$e=e=>{if(ie){const t=[...le],{row:s,field:l}=ie;if("birthday"===l){const l=e.trim().split(" ");2===l.length&&(t[s].birthMonth=l[0],t[s].birthDay=l[1])}else"gender"===l?["male","female","other"].includes(e.toLowerCase())&&(t[s].gender=e.toLowerCase()):"loyaltyLevel"===l?["bronze","silver","gold","platinum"].includes(e.toLowerCase())&&(t[s].loyaltyLevel=e.toLowerCase()):"colorTag"===l?["new","vip","complainer","purchased"].includes(e.toLowerCase())&&(t[s].colorTag=e.toLowerCase()):t[s][l]=e;re(t),k(t)}oe(null),ce("")},Ae=e=>{"Enter"===e.key?$e(de):"Escape"===e.key&&(oe(null),ce(""))};return b&&["admin","customer-care"].includes((null==v?void 0:v.role)||"")?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4 transition-all duration-300 ml-0",style:{marginLeft:me?"280px":"0px",left:"0",right:"0"},children:t.jsxs(s,{className:"w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-green-500"}),"Import Customers from Excel (Skip Existing)"]}),t.jsx("button",{onClick:Ee,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:t.jsx(o,{className:"w-5 h-5"})})]}),"upload"===E&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx(d,{className:"w-12 h-12 mx-auto text-blue-500 mb-2"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"Upload Customer Data"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Import customers from Excel/CSV file with intelligent column detection. The system automatically detects column positions regardless of their order!"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("button",{onClick:()=>{var e;return null==(e=fe.current)?void 0:e.click()},disabled:I,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors",children:[t.jsx(d,{className:"w-4 h-4 mr-2 inline"}),I?"Processing...":"Choose File"]}),t.jsxs("button",{onClick:()=>{R("preview"),K(!0),W([{name:"",email:"",phone:"",gender:"other",city:"",whatsapp:"",birthMonth:"",birthDay:"",referralSource:"",notes:"",loyaltyLevel:"bronze",colorTag:"new"}])},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[t.jsx(c,{className:"w-4 h-4 mr-2 inline"}),"Manual Entry"]}),t.jsxs("button",{onClick:Re,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[t.jsx(m,{className:"w-4 h-4 mr-2 inline"}),"Download Template"]}),t.jsx("div",{className:"flex items-center justify-center text-sm text-gray-500",children:"or"})]}),t.jsx("input",{ref:fe,type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){if(s.size>5242880)return void g.error("File size must be less than 5MB");k([]),B([]),xe({}),S(s),ze(s)}},className:"hidden"})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-blue-800 mb-2 flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4"}),"Import Features:"]}),t.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Intelligent Column Detection"})," - Automatically detects column positions regardless of order"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Auto-skip existing customers"})," - Based on phone number or email"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Duplicate detection"})," - Checks for duplicate phones/emails within Excel file"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Required fields:"})," name, phone"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Optional fields:"})," email, gender, city, whatsapp, birth month/day, referral source, notes, loyalty level, color tag, location description, national id, referred by, total spent, points, is active, profile image"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Tanzania phone formatting:"})," Automatically adds +255 country code to all numbers"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Validation:"})," Checks for valid email format and required fields"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Scroll to view all customers"}),' - Click "Show All Customers" to see complete list']})]})]})]}),"preview"===E&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-2xl p-6 mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-white font-bold text-sm",children:"üìà"})}),"Import Summary"]}),t.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Ready to Import"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-blue-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-white font-bold text-sm",children:"üë•"})}),t.jsx("div",{className:"text-xs text-blue-600 font-medium",children:"TOTAL"})]}),t.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:C.length}),t.jsx("div",{className:"text-xs text-gray-500",children:"Customers Found"})]}),t.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-yellow-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-white font-bold text-sm",children:"‚è≠Ô∏è"})}),t.jsx("div",{className:"text-xs text-yellow-600 font-medium",children:"SKIP"})]}),t.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-1",children:X.size}),t.jsx("div",{className:"text-xs text-gray-500",children:"Already Exist"})]}),t.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-green-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),t.jsx("div",{className:"text-xs text-green-600 font-medium",children:"IMPORT"})]}),t.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:C.length-X.size}),t.jsx("div",{className:"text-xs text-gray-500",children:"New Customers"})]})]})]}),Object.keys(ue).length>0&&t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[t.jsxs("h4",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[t.jsx(u,{className:"w-4 h-4"}),"Intelligent Column Detection"]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 text-sm",children:Object.entries(ue).map(([e,s])=>t.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg p-2 border border-blue-100",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),t.jsx("span",{className:"text-blue-700 font-medium capitalize",children:e.replace(/([A-Z])/g," $1").trim()}),t.jsxs("span",{className:"text-blue-500 text-xs",children:["Col ",s+1]})]},e))}),t.jsxs("div",{className:"mt-3 p-2 bg-blue-100 rounded text-sm text-blue-800",children:[t.jsx("strong",{children:"Smart Detection:"})," The system automatically detected ",Object.keys(ue).length," columns from your Excel file. You can change column positions in your file and the system will still work correctly!"]})]}),O.length>0&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[t.jsx(x,{className:"w-4 h-4"}),"Validation Summary"]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:O.length}),t.jsx("div",{className:"text-red-700",children:"Total Errors"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:O.filter(e=>e.includes("Name is required")).length}),t.jsx("div",{className:"text-yellow-700",children:"Missing Names"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-orange-600",children:O.filter(e=>e.includes("Phone")).length}),t.jsx("div",{className:"text-orange-700",children:"Phone Issues"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:C.length-O.filter(e=>e.includes("Row")).length}),t.jsx("div",{className:"text-green-700",children:"Valid Rows"})]})]}),t.jsxs("div",{className:"mt-3 p-3 bg-blue-100 rounded text-sm text-blue-800",children:[t.jsx("strong",{children:"Quick Fix Options:"}),t.jsxs("ul",{className:"mt-2 space-y-1",children:[t.jsxs("li",{children:["‚Ä¢ ",t.jsxs("button",{onClick:()=>U(!V),className:"text-blue-600 hover:underline",children:[V?"Hide":"Show"," detailed error list"]})]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("button",{onClick:()=>{const e=J.map(e=>{var t,s;const l={...e};if((null==(t=l.name)?void 0:t.trim())||(l.name="Unknown Customer"),null==(s=l.phone)?void 0:s.trim()){if(!/^[+]?[0-9\s\-()]{8,}$/.test(l.phone)){const e=l.phone.replace(/[^\d+]/g,"");l.phone=e.length>=8?e:"0000000000"}}else l.phone="0000000000";if(l.gender&&!["male","female","other"].includes(l.gender)&&(l.gender="other"),l.loyaltyLevel&&!["bronze","silver","gold","platinum"].includes(l.loyaltyLevel)&&(l.loyaltyLevel="bronze"),l.birthDay){const e=parseInt(l.birthDay);(isNaN(e)||e<1||e>31)&&(l.birthDay="")}return l});W(e);const t=[];e.forEach((e,s)=>{const l=Le(e,s+2);t.push(...l)}),B(t),J.length,t.length,g.success(`Auto-fixed ${J.length-t.length} rows. ${t.length} errors remain.`)},className:"text-blue-600 hover:underline",children:"Auto-fix common issues"})]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("button",{onClick:Re,className:"text-blue-600 hover:underline",children:"Download template for correct format"})]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsxs("button",{onClick:()=>H(!q),className:"text-blue-600 hover:underline",children:[q?"Hide":"Show"," format guide"]})]}),t.jsx("li",{children:"‚Ä¢ Rows with validation errors will be automatically skipped during import"}),t.jsx("li",{children:"‚Ä¢ You can edit individual rows in the table below to fix errors"})]})]})]}),V&&t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-yellow-800 mb-2 flex items-center gap-2",children:[t.jsx(x,{className:"w-4 h-4"}),"Detailed Validation Errors (",O.length," rows will be skipped):"]}),t.jsx("div",{className:"max-h-64 overflow-y-auto",children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:O.map((e,s)=>t.jsxs("div",{className:"py-1 px-2 bg-yellow-100 rounded text-sm text-yellow-800 border border-yellow-200",children:["‚Ä¢ ",e]},s))})}),t.jsxs("div",{className:"mt-3 p-2 bg-yellow-100 rounded text-sm text-yellow-800",children:[t.jsx("strong",{children:"Note:"})," Rows with validation errors will be automatically skipped during import. Valid customers will still be imported successfully."]})]})]}),q&&t.jsxs("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-green-800 mb-3 flex items-center gap-2",children:[t.jsx(Award,{className:"w-4 h-4"}),"Excel Import Format Guide"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-green-700 mb-2",children:"Required Fields:"}),t.jsxs("ul",{className:"space-y-1 text-green-600",children:[t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Name:"})," Customer's full name (required)"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Phone Number:"})," Primary contact number (required)"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Gender:"})," male, female, or other"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"City:"})," Customer's city/location"]})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-green-700 mb-2",children:"Optional Fields:"}),t.jsxs("ul",{className:"space-y-1 text-green-600",children:[t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"WhatsApp:"})," WhatsApp number"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Notes:"})," Customer notes/comments"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Loyalty Level:"})," bronze, silver, gold, platinum"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Color Tag:"})," new, vip, complainer, purchased"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Birth Month/Day:"})," Numbers (1-12 for month, 1-31 for day)"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Referral Source:"})," How customer found you"]})]})]})]}),t.jsxs("div",{className:"mt-3 p-2 bg-green-100 rounded text-sm text-green-800",children:[t.jsx("strong",{children:"Tips:"})," Use the template for best results. Phone numbers should include country code (+255 for Tanzania). Gender and loyalty level are case-sensitive."]})]}),Object.keys(ue).length>0&&t.jsxs("div",{className:"mb-4 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[t.jsx(u,{className:"w-4 h-4"}),"Column Mapping Detected:"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.entries(ue).map(([e,s])=>{const l=pe[s]||"Unknown";return t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-100 rounded",children:[t.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),t.jsxs("span",{className:"text-blue-700 font-medium",children:[e,":"]}),t.jsxs("span",{className:"text-blue-600",children:['"',l,'"']})]},e)})}),t.jsxs("div",{className:"mt-3 p-2 bg-blue-100 rounded text-sm text-blue-800",children:[t.jsx("strong",{children:"Note:"})," The system automatically mapped your Excel columns to the correct fields. If any mapping looks incorrect, please use the template format."]})]}),O.length>0&&t.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-yellow-800 mb-3 flex items-center gap-2",children:[t.jsx(x,{className:"w-4 h-4"}),"Field Validation Summary:"]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),t.jsxs("span",{className:"text-yellow-700",children:["Name: ",O.filter(e=>e.includes("Name is required")).length," missing"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),t.jsxs("span",{className:"text-yellow-700",children:["Phone: ",O.filter(e=>e.includes("Phone")).length," issues"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),t.jsxs("span",{className:"text-green-700",children:["Valid rows: ",C.length-O.filter(e=>e.includes("Row")).length," ready"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),t.jsxs("span",{className:"text-blue-700",children:["Total rows: ",C.length]})]})]})]}),t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-green-800 mb-2 flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4"}),"Dropdown Values for Excel:"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-green-700",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Gender:"})," male, female, other"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Loyalty Level:"})," bronze, silver, gold, platinum"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Color Tag:"})," new, vip, complainer, purchased"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Referral Source:"})," MTANDAONI, RECOMMENDATION, PHYSICALLY, INSTAGRAM, FACEBOOK, GOOGLE, FRIEND, FAMILY, OTHER"]})]})]}),t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-yellow-800 mb-2 flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4"}),"How to Add Dropdowns in Excel:"]}),t.jsxs("ol",{className:"text-sm text-yellow-700 space-y-1",children:[t.jsx("li",{children:"1. Select the column you want to add dropdown to (e.g., Gender column)"}),t.jsxs("li",{children:["2. Go to ",t.jsx("strong",{children:"Data"})," tab ‚Üí ",t.jsx("strong",{children:"Data Validation"})]}),t.jsxs("li",{children:["3. Choose ",t.jsx("strong",{children:"List"}),' from "Allow" dropdown']}),t.jsx("li",{children:'4. In "Source" field, enter values separated by commas (e.g., male,female,other)'}),t.jsxs("li",{children:["5. Click ",t.jsx("strong",{children:"OK"})," to apply"]})]})]}),t.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm min-w-full",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Name"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Phone"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"City"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Gender"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"WhatsApp"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Birthday"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Notes"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Loyalty"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Tag"}),t.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:le.map((e,s)=>{var l;const r=ye(e.phone),a=null==(l=e.email)?void 0:l.toLowerCase(),n=X.get(r),i=a?X.get(a):null,o=n||i;return t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors "+(Ie(e,s).length>0?"bg-yellow-50":""),children:[t.jsxs("td",{className:"p-3 font-medium cursor-pointer hover:bg-blue-50 relative "+(Me(e,s,"name")?"bg-yellow-100 border-l-4 border-yellow-500":"text-gray-900"),onClick:t=>{t.stopPropagation(),Te(s,"name",e.name)},title:Me(e,s,"name")?Fe(e,s,"name"):"",children:[Me(e,s,"name")&&t.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-white text-xs",children:"‚ö†Ô∏è"})}),(null==ie?void 0:ie.row)===s&&"name"===(null==ie?void 0:ie.field)?t.jsx("input",{type:"text",value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),className:"w-full h-full bg-transparent border-none outline-none text-sm font-medium text-gray-900 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"name",autoFocus:!0}):t.jsx("span",{className:Me(e,s,"name")?"text-yellow-800":"",children:e.name||(Me(e,s,"name")?"‚ö†Ô∏è Required":"")})]}),t.jsxs("td",{className:"p-3 cursor-pointer hover:bg-blue-50 relative "+(Me(e,s,"phone")?"bg-yellow-100 border-l-4 border-yellow-500":"text-gray-700"),onClick:t=>{t.stopPropagation(),Te(s,"phone",e.phone)},title:Me(e,s,"phone")?Fe(e,s,"phone"):"",children:[Me(e,s,"phone")&&t.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-white text-xs",children:"‚ö†Ô∏è"})}),(null==ie?void 0:ie.row)===s&&"phone"===(null==ie?void 0:ie.field)?t.jsx("input",{type:"text",value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"phone",autoFocus:!0}):t.jsx("span",{className:Me(e,s,"phone")?"text-yellow-800":"",children:e.phone||(Me(e,s,"phone")?"‚ö†Ô∏è Required":"")})]}),t.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:t=>{t.stopPropagation(),Te(s,"city",e.city||"")},children:(null==ie?void 0:ie.row)===s&&"city"===(null==ie?void 0:ie.field)?t.jsx("input",{type:"text",value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"city",autoFocus:!0}):e.city||"-"}),t.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:t=>{t.stopPropagation(),Te(s,"gender",e.gender||"")},children:(null==ie?void 0:ie.row)===s&&"gender"===(null==ie?void 0:ie.field)?t.jsxs("select",{value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"gender",autoFocus:!0,children:[t.jsx("option",{value:"",children:"Select Gender"}),t.jsx("option",{value:"male",children:"Male"}),t.jsx("option",{value:"female",children:"Female"}),t.jsx("option",{value:"other",children:"Other"})]}):e.gender||"-"}),t.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:t=>{t.stopPropagation(),Te(s,"whatsapp",e.whatsapp||"")},children:(null==ie?void 0:ie.row)===s&&"whatsapp"===(null==ie?void 0:ie.field)?t.jsx("input",{type:"text",value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"whatsapp",autoFocus:!0}):e.whatsapp||"-"}),t.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:t=>{t.stopPropagation(),Te(s,"birthday",e.birthMonth&&e.birthDay?`${e.birthMonth} ${e.birthDay}`:"")},children:(null==ie?void 0:ie.row)===s&&"birthday"===(null==ie?void 0:ie.field)?t.jsx("input",{type:"text",value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),placeholder:"e.g., January 15",className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"birthday",autoFocus:!0}):e.birthMonth&&e.birthDay?`${e.birthMonth} ${e.birthDay}`:"-"}),t.jsx("td",{className:"p-3 text-gray-700 max-w-xs truncate cursor-pointer hover:bg-blue-50",title:e.notes||"",onClick:t=>{t.stopPropagation(),Te(s,"notes",e.notes||"")},children:(null==ie?void 0:ie.row)===s&&"notes"===(null==ie?void 0:ie.field)?t.jsx("textarea",{value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0 resize-none",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"notes",rows:1,autoFocus:!0}):e.notes||"-"}),t.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:t=>{t.stopPropagation(),Te(s,"loyaltyLevel",e.loyaltyLevel||"")},children:(null==ie?void 0:ie.row)===s&&"loyaltyLevel"===(null==ie?void 0:ie.field)?t.jsxs("select",{value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"loyaltyLevel",autoFocus:!0,children:[t.jsx("option",{value:"",children:"Select Level"}),t.jsx("option",{value:"bronze",children:"Bronze"}),t.jsx("option",{value:"silver",children:"Silver"}),t.jsx("option",{value:"gold",children:"Gold"}),t.jsx("option",{value:"platinum",children:"Platinum"})]}):e.loyaltyLevel||"bronze"}),t.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:t=>{t.stopPropagation(),Te(s,"colorTag",e.colorTag||"")},children:(null==ie?void 0:ie.row)===s&&"colorTag"===(null==ie?void 0:ie.field)?t.jsxs("select",{value:de,onChange:e=>ce(e.target.value),onKeyDown:Ae,onBlur:()=>$e(de),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":s,"data-field":"colorTag",autoFocus:!0,children:[t.jsx("option",{value:"",children:"Select Tag"}),t.jsx("option",{value:"normal",children:"Normal"}),t.jsx("option",{value:"vip",children:"VIP"}),t.jsx("option",{value:"complainer",children:"Complainer"}),t.jsx("option",{value:"purchased",children:"Purchased"})]}):e.colorTag||"new"}),t.jsx("td",{className:"p-3",children:o?t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:[t.jsx(p,{className:"w-3 h-3"}),"Skip"]}):t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:[t.jsx(u,{className:"w-3 h-3"}),"Import"]})})]},s)})})]})})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>R("upload"),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:"Back"}),t.jsx("button",{onClick:()=>{R("import"),setTimeout(()=>{(async()=>{if("admin"!==(null==v?void 0:v.role))return void g.error("Only administrators can import customers. You can view the preview and results.");const e=G?J:C;if(0===e.length)return void g.error("No data to import. Please add at least one customer.");O.length>0&&g.error(`Found ${O.length} validation errors. Invalid rows will be skipped.`);try{z(!0),$(0),P([]);const s=[],l=[];for(let o=0;o<e.length;o++){const a=e[o],n=ye(a.phone),i=Le(a,o+2);if(i.length>0){l.push({success:!1,skipped:!0,reason:`Validation errors: ${i.join(", ")}`,rowNumber:o+2});continue}if(X.get(n)){const e="Phone number already exists";l.push({success:!1,skipped:!0,reason:e,rowNumber:o+2})}else try{const e=await r({id:crypto.randomUUID(),name:a.name,email:a.email,phone:n,gender:a.gender,city:a.city,whatsapp:je(a.whatsapp||""),initialNotes:a.notes,loyaltyLevel:a.loyaltyLevel||"bronze",colorTag:a.colorTag||"new",birthMonth:a.birthMonth,birthDay:a.birthDay,referralSource:a.referralSource,joinedDate:(new Date).toISOString(),totalSpent:a.totalSpent||0,points:a.points||0,lastVisit:(new Date).toISOString(),isActive:!1!==a.isActive,notes:[],referrals:[]});e?(s.push(e),l.push({success:!0,customer:e,rowNumber:o+2})):l.push({success:!1,error:"Failed to create customer",rowNumber:o+2})}catch(t){l.push({success:!1,error:t instanceof Error?t.message:"Unknown error",rowNumber:o+2})}$((o+1)/e.length*100),P(l)}const a=l.filter(e=>e.success).length,n=l.filter(e=>e.skipped).length,i=l.filter(e=>!e.success&&!e.skipped).length;a>0&&(g.success(`Successfully imported ${a} customers!`),y(s)),n>0&&g.success(`Skipped ${n} rows (validation errors or existing customers).`),i>0&&g.error(`${i} customers failed to import. Check the results below.`),R("import")}catch(t){g.error("Error importing customers. Please try again.")}finally{z(!1)}})()},100)},className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm font-medium transition-colors",children:O.length>0?"Continue (Skip Invalid Rows)":"Continue to Import"})]})]}),"import"===E&&t.jsxs("div",{className:"space-y-6",children:[F?t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"Importing Customers"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Progress: ",Math.round(T),"% (",A.length,"/",C.length,")"]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${T}%`}})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center",children:[t.jsx(u,{className:"w-12 h-12 mx-auto text-green-500 mb-2"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"Import Complete"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Import results for ",C.length," customers"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Imported"}),t.jsx("p",{className:"text-2xl font-bold text-green-900",children:A.filter(e=>e.success).length})]}),t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-yellow-800 mb-1",children:"Skipped"}),t.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:A.filter(e=>e.skipped).length})]}),t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Failed"}),t.jsx("p",{className:"text-2xl font-bold text-red-900",children:A.filter(e=>!e.success&&!e.skipped).length})]})]}),A.filter(e=>e.skipped).length>0&&t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Skipped Customers:"}),t.jsx("div",{className:"max-h-32 overflow-y-auto",children:t.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[A.filter(e=>e.skipped).slice(0,10).map((e,s)=>t.jsxs("li",{children:["Row ",e.rowNumber,": ",e.reason]},s)),A.filter(e=>e.skipped).length>10&&t.jsxs("li",{className:"text-yellow-600",children:["... and ",A.filter(e=>e.skipped).length-10," more skipped"]})]})})]}),A.filter(e=>!e.success&&!e.skipped).length>0&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Failed Imports:"}),t.jsx("div",{className:"max-h-32 overflow-y-auto",children:t.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:A.filter(e=>!e.success&&!e.skipped).map((e,s)=>t.jsxs("li",{children:["Row ",e.rowNumber,": ",e.error]},s))})})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx(l,{onClick:()=>R("preview"),variant:"secondary",className:"flex-1",disabled:F,children:"Back"}),t.jsx(l,{onClick:Ee,disabled:F,className:"flex-1",children:F?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"Close"]})})]})]})]})}):null},S=()=>{const r=v(),{currentUser:a}=e(),[i,o]=n.useState(!1),[c,m]=n.useState([]);return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center mb-6",children:[t.jsx("button",{onClick:()=>r("/customers"),className:"mr-4 p-2 hover:bg-white/50 rounded-lg transition-colors",children:t.jsx(b,{className:"w-5 h-5"})}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Import Customers from Excel"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs(s,{className:"p-6",children:[t.jsxs("div",{className:"text-center mb-6",children:["admin"===(null==a?void 0:a.role)?t.jsx(d,{className:"w-16 h-16 mx-auto text-blue-500 mb-4"}):t.jsx(f,{className:"w-16 h-16 mx-auto text-green-500 mb-4"}),t.jsx("h2",{className:"text-xl font-semibold mb-2",children:"admin"===(null==a?void 0:a.role)?"Bulk Import Customers":"View Import Results"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"admin"===(null==a?void 0:a.role)?"Import customers from Excel/CSV files. Existing customers will be automatically skipped.":"View import results and customer data. Only administrators can perform imports."})]}),t.jsx("div",{className:"space-y-4 mb-6",children:"admin"===(null==a?void 0:a.role)?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[t.jsx(u,{className:"w-5 h-5 text-green-500"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-blue-900",children:"Auto-skip existing customers"}),t.jsx("p",{className:"text-sm text-blue-700",children:"Based on phone number or email"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[t.jsx(y,{className:"w-5 h-5 text-green-500"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-green-900",children:"Bulk processing"}),t.jsx("p",{className:"text-sm text-green-700",children:"Import hundreds of customers at once"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg",children:[t.jsx(p,{className:"w-5 h-5 text-yellow-500"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-yellow-900",children:"Smart validation"}),t.jsx("p",{className:"text-sm text-yellow-700",children:"Automatic phone formatting and validation"})]})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[t.jsx(f,{className:"w-5 h-5 text-green-500"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-green-900",children:"View import results"}),t.jsx("p",{className:"text-sm text-green-700",children:"See what passed and failed"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[t.jsx(u,{className:"w-5 h-5 text-blue-500"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-blue-900",children:"Track progress"}),t.jsx("p",{className:"text-sm text-blue-700",children:"Monitor import status and results"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg",children:[t.jsx(x,{className:"w-5 h-5 text-yellow-500"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-yellow-900",children:"Read-only access"}),t.jsx("p",{className:"text-sm text-yellow-700",children:"View data without import permissions"})]})]})]})}),t.jsx(l,{onClick:()=>o(!0),className:"w-full",children:"admin"===(null==a?void 0:a.role)?t.jsxs(t.Fragment,{children:[t.jsx(d,{className:"w-4 h-4 mr-2"}),"Start Import"]}):t.jsxs(t.Fragment,{children:[t.jsx(f,{className:"w-4 h-4 mr-2"}),"View Import"]})})]}),t.jsxs(s,{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"admin"===(null==a?void 0:a.role)?"How to Import":"How to View Results"}),t.jsx("div",{className:"space-y-4",children:"admin"===(null==a?void 0:a.role)?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"Prepare your file"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Use CSV format with headers: name, phone, email, gender, city, etc."})]})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"2"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"Upload and preview"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Review the data and see which customers will be imported vs skipped"})]})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"3"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"Import and confirm"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Start the import process and review results"})]})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"View import status"}),t.jsx("p",{className:"text-sm text-gray-600",children:"See which customers were imported, skipped, or failed"})]})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"2"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"Review results"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Check detailed information about import outcomes"})]})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"3"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"Monitor progress"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Track import progress and final results"})]})]})]})}),"admin"===(null==a?void 0:a.role)&&t.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[t.jsx("h3",{className:"font-medium mb-2",children:"Required Fields:"}),t.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"name"})," - Customer's full name"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"phone"})," - Phone number (auto-formats with 255 prefix)"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"email"})," - Email address (optional)"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"gender"})," - male, female, or other"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"city"})," - City/location"]})]})]})]})]}),c.length>0&&t.jsxs(s,{className:"mt-6 p-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Recent Imports"}),t.jsx("div",{className:"space-y-3",children:c.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(u,{className:"w-5 h-5 text-green-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"Import completed"}),t.jsx("p",{className:"text-sm text-gray-600",children:e.timestamp})]})]}),t.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[t.jsxs("span",{className:"text-green-600",children:[e.imported.length," imported"]}),e.skipped>0&&t.jsxs("span",{className:"text-yellow-600",children:[e.skipped," skipped"]}),e.failed>0&&t.jsxs("span",{className:"text-red-600",children:[e.failed," failed"]})]})]},s))})]})]}),t.jsx(N,{isOpen:i,onClose:()=>o(!1),onImportComplete:e=>{const t={imported:e,skipped:0,failed:0,timestamp:(new Date).toLocaleString()};m(e=>[t,...e.slice(0,4)])}})]})};export{S as default};
