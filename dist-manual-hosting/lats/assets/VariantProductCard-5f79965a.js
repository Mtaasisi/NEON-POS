import{_ as e}from"./supabase-7e851d02.js";import{j as t,F as r,s,aj as a}from"./index-222cfb29.js";import{r as n,b as i}from"./vendor-a2ff445a.js";import{R as l}from"./robustImageService-2422a1f9.js";import{x as o,b5 as d,X as c,e as m,T as u,a as x,b as h,n as g,q as p,r as b,$ as f}from"./ui-551a39a6.js";import{format as v}from"./format-0f0b2647.js";import{g as y,a as j,i as N,b as w}from"./productUtils-6e390a72.js";import{a as _}from"./routing-a2f0f6d2.js";const C=({images:e=[],productName:r,productId:s,size:a="md",className:i="",showFallback:c=!0})=>{const[m,u]=n.useState(!1),[x,h]=n.useState(!0),[g,p]=n.useState([]),[b,f]=n.useState(!1);n.useEffect(()=>{(async()=>{if(!(e&&e.length>0)&&s)try{f(!0);const e=await l.getProductImages(s);p(e)}catch(t){p([])}finally{f(!1)}})()},[s,e]);const v=g.length>0?g.map(e=>e.thumbnailUrl&&e.thumbnailUrl!==e.url&&""!==e.thumbnailUrl.trim()?e.thumbnailUrl:e.url):e&&e.length>0?e.map(e=>"string"==typeof e?e:e.thumbnailUrl||e.url||e):[],y=b||x,j={sm:"w-10 h-10",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-20 h-20"},N=i.includes("w-full")||i.includes("h-full"),w={sm:"w-5 h-5",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-10 h-10"};if(!v.length||m)return c?t.jsx("div",{className:`${N?"":j[a]} bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg flex items-center justify-center ${i}`,children:t.jsx(o,{className:`${N?"w-8 h-8":w[a]} text-gray-400`})}):null;const _=v[0]&&(v[0].includes(".png")||v[0].includes("image/png"));return t.jsxs("div",{className:`${N?"":j[a]} relative rounded-lg overflow-hidden ${i}`,children:[y&&t.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse flex items-center justify-center",children:t.jsx(d,{className:`${N?"w-8 h-8":w[a]} text-gray-400`})}),_&&t.jsx("div",{className:"absolute inset-0 bg-white"}),t.jsx("img",{src:v[0],alt:r,className:"w-full h-full object-cover "+(_?"relative z-10":""),onError:e=>{u(!0),h(!1)},onLoad:()=>{h(!1)},style:{display:y?"none":"block"}})]})};class k{constructor(){this.stockCache={},this.cacheTimestamp=0,this.CACHE_DURATION=6e4}static getInstance(){return k.instance||(k.instance=new k),k.instance}isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}async getStockLevels(e){try{const t=Date.now(),a={},n=[];if(e.forEach(e=>{this.stockCache[e]&&t-this.cacheTimestamp<this.CACHE_DURATION?a[e]=this.stockCache[e]:n.push(e)}),0===n.length)return a;0;const i=n.filter(e=>this.isValidUUID(e)),l=n.filter(e=>!this.isValidUUID(e)),o={};if(l.forEach(e=>{o[e]=[]}),0===i.length)return{...a,...o};const d=r();let c=s.from("lats_product_variants").select("id, product_id, sku, name, variant_name, quantity, branch_id, is_shared").in("product_id",i).is("parent_variant_id",null);d&&(c=c.or(`branch_id.eq.${d},is_shared.eq.true`));const{data:m,error:u}=await c;if(u)throw u;const x={};return null==m||m.forEach(e=>{const t=e.product_id;x[t]||(x[t]=[]),x[t].push({productId:t,variantId:e.id,quantity:e.quantity||0,sku:e.sku||"",name:e.variant_name||e.name||""})}),i.forEach(e=>{x[e]||(x[e]=[])}),Object.assign(this.stockCache,x),this.cacheTimestamp=t,Object.entries(x).forEach(([e,t])=>{t.reduce((e,t)=>e+t.quantity,0)}),{...a,...x,...o}}catch(t){const r={};return e.forEach(e=>{r[e]=[]}),r}}async getProductStock(e){return(await this.getStockLevels([e]))[e]||[]}async getStockBySKU(e){try{0;const t=r();let a=s.from("lats_product_variants").select("id, product_id, sku, name, variant_name, quantity, branch_id, is_shared").eq("sku",e);t&&(a=a.or(`branch_id.eq.${t},is_shared.eq.true`));const{data:n,error:i}=await a.single();return i||!n?null:{productId:n.product_id,variantId:n.id,quantity:n.quantity||0,sku:n.sku||"",name:n.variant_name||n.name||""}}catch(t){return null}}clearCache(){this.stockCache={},this.cacheTimestamp=0}async getTotalStock(e){return(await this.getProductStock(e)).reduce((e,t)=>e+t.quantity,0)}}const S=()=>{const e=a();return{formatCurrency:e.formatCurrency,formatDate:e.formatDate,formatTime:e.formatTime,showProductImages:e.showProductImages,showStockLevels:e.showStockLevels,showPrices:e.showPrices,showBarcodes:e.showBarcodes,autoCompleteSearch:e.autoCompleteSearch,confirmDelete:e.confirmDelete,showConfirmations:e.showConfirmations,enableSoundEffects:e.enableSoundEffects,enableAnimations:e.enableAnimations,productsPerPage:e.productsPerPage,settings:e.settings,loading:e.loading,error:e.error,refreshSettings:e.refreshSettings,getProductImageClass:()=>e.showProductImages?"product-image":"hidden-by-setting",getPriceClass:()=>e.showPrices?"price price-display":"hidden-by-setting",getBarcodeClass:()=>e.showBarcodes?"barcode barcode-display":"hidden-by-setting",getAnimationClass:()=>e.enableAnimations?"animate-enabled":"animate-disabled",getSoundClass:()=>e.enableSoundEffects?"sound-enabled":"sound-disabled",isDarkMode:()=>!!e.settings&&("dark"===e.settings.theme||"auto"===e.settings.theme&&window.matchMedia("(prefers-color-scheme: dark)").matches),isSwahili:()=>{var t;return"sw"===(null==(t=e.settings)?void 0:t.language)},isFrench:()=>{var t;return"fr"===(null==(t=e.settings)?void 0:t.language)},isEnglish:()=>{var t;return"en"===(null==(t=e.settings)?void 0:t.language)},getCurrencySymbol:()=>{var t;const r=(null==(t=e.settings)?void 0:t.currency)||"TZS";switch(r){case"TZS":return"TSh";case"USD":return"$";case"EUR":return"â‚¬";case"GBP":return"Â£";default:return r}},getStockLevelClass:(t,r=5,s=10)=>e.showStockLevels?t<=r?"stock-level stock-level-low":t<=s?"stock-level stock-level-medium":"stock-level stock-level-high":"hidden-by-setting",shouldShowConfirmation:t=>!!e.showConfirmations&&("delete"===t&&e.confirmDelete,!0),getSearchConfig:()=>{var t;return{autoComplete:e.autoCompleteSearch,maxResults:(null==(t=e.settings)?void 0:t.max_search_results)||50,debounceTime:300}},getCacheConfig:()=>{var t,r,s;return{enabled:(null==(t=e.settings)?void 0:t.enable_caching)||!0,duration:(null==(r=e.settings)?void 0:r.cache_duration)||300,lazyLoading:(null==(s=e.settings)?void 0:s.enable_lazy_loading)||!0}}}},q=({isOpen:e,onClose:r,product:a,onSelectVariant:l})=>{var d;const[p,b]=n.useState(new Set),[f,y]=n.useState({}),[j,N]=n.useState(new Set),[w,_]=n.useState({}),[C,k]=n.useState({}),[S,q]=n.useState({}),[P,E]=n.useState(0),[$,I]=n.useState({});n.useEffect(()=>{if(e){E(0);const e=async()=>{var e;if(1===(null==(e=null==a?void 0:a.variants)?void 0:e.length)){const e=a.variants[0];let r=e.is_parent||"parent"===e.variant_type;if(!r)try{const{count:t}=await s.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("parent_variant_id",e.id).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0);r=(t||0)>0}catch(t){}if(r){const t=new Set([e.id]);b(t),T(e.id)}}};setTimeout(()=>{e()},100)}else b(new Set),y({}),N(new Set),_({}),k({}),q({}),E(0),I({})},[e,a]);const L=n.useCallback(async()=>{if(!(null==a?void 0:a.variants))return;const e=a.variants.map(e=>e.id);try{const{data:t,error:r}=await s.from("lats_product_variants").select("parent_variant_id").in("parent_variant_id",e).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0);if(!r&&t){const e={};t.forEach(t=>{e[t.parent_variant_id]=(e[t.parent_variant_id]||0)+1}),k(e)}}catch(t){}},[a]);if(n.useEffect(()=>{e&&(null==a?void 0:a.variants)&&L()},[e,a,L]),n.useEffect(()=>{var t;if(e&&a){null==(t=a.variants)||t.filter(e=>e.quantity>0&&!1!==e.is_active)}},[e,a]),n.useEffect(()=>{if(!e)return;const t=e=>{var t;const s=(null==(t=a.variants)?void 0:t.filter(e=>e.quantity>0&&!1!==e.is_active))||[];switch(e.key){case"Escape":r();break;case"ArrowDown":e.preventDefault(),E(e=>Math.min(e+1,s.length-1));break;case"ArrowUp":e.preventDefault(),E(e=>Math.max(e-1,0));break;case"Enter":if(e.preventDefault(),s[P]){const e=s[P];D(e)?A(e.id):U(e)}}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,P,a,r]),!e||!a)return null;const D=e=>{const t=!0===e.is_parent||"parent"===e.variant_type||"parent"===e.variantType,r=(C[e.id]||0)>0;return t||r},T=async e=>{if(!f[e]){N(t=>new Set(t).add(e));try{const{data:t,error:r}=await s.from("lats_product_variants").select("*").eq("parent_variant_id",e).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0).order("created_at",{ascending:!1});if(r)throw r;if(t&&t.length>0){const r=t.map(t=>{var r,s,a,n,i,l;const o=(null==(r=t.variant_attributes)?void 0:r.imei)||(null==(s=t.variant_attributes)?void 0:s.IMEI)||t.imei||t.sku||"N/A",d=(null==(a=t.variant_attributes)?void 0:a.serial_number)||(null==(n=t.variant_attributes)?void 0:n.serialNumber)||(null==(i=t.variant_attributes)?void 0:i.serial)||t.serial_number||o,c=(null==(l=t.variant_attributes)?void 0:l.condition)||t.condition||"New";return{id:t.id,name:t.variant_name||`IMEI: ${o}`,sku:t.sku||o,quantity:t.quantity||0,sellingPrice:t.selling_price||t.sellingPrice||t.price||0,imei:o,serialNumber:d,condition:c,variant_attributes:t.variant_attributes,is_imei_child:!0,parent_variant_id:e,...t}});y(t=>({...t,[e]:r}))}else y(t=>({...t,[e]:[]}))}catch(t){g.error("Failed to load device variants"),y(t=>({...t,[e]:[]}))}finally{N(t=>{const r=new Set(t);return r.delete(e),r})}}},A=async e=>{const t=new Set(p);t.has(e)?t.delete(e):(t.add(e),f[e]||await T(e)),b(t)},U=e=>{const t=w[e.id]||1;if(D(e)){const s=f[e.id];s&&0!==s.length?(g.error("Please select a specific device from the list"),p.has(e.id)||A(e.id)):(l(a,e,t),r())}else l(a,e,t),r()},F=(e,t)=>{_(r=>{const s=r[e]||1,a=Math.max(1,s+t);return{...r,[e]:a}})},V=e=>{switch(null==e?void 0:e.toLowerCase()){case"new":return"bg-green-100 text-green-800 border-green-200";case"used":return"bg-blue-100 text-blue-800 border-blue-200";case"refurbished":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},B=(null==(d=a.variants)?void 0:d.filter(e=>e.quantity>0&&!1!==e.is_active))||[];return i.createPortal(t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9998] transition-opacity duration-300",onClick:r}),t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 pointer-events-none",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden pointer-events-auto transform transition-all duration-300 scale-100 relative",onClick:e=>e.stopPropagation(),children:[t.jsx("button",{onClick:r,className:"absolute top-6 right-6 w-10 h-10 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-all shadow-lg z-50 hover:scale-110",children:t.jsx(c,{className:"w-5 h-5"})}),t.jsxs("div",{className:"p-8 text-center bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 border-b border-purple-100",children:[t.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg bg-gradient-to-br from-purple-600 to-blue-600",children:t.jsx(o,{className:"w-10 h-10 text-white"})}),t.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:(()=>{var e;if(1===(null==(e=null==a?void 0:a.variants)?void 0:e.length)){const e=a.variants[0],t=e.is_parent||"parent"===e.variant_type,r=(C[e.id]||0)>0;if(t||r)return"Select Device"}return"Select Variant"})()}),t.jsx("p",{className:"text-purple-600 font-medium text-lg",children:a.name})]}),t.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-240px)] p-6 bg-gray-50",children:[0===B.length?t.jsxs("div",{className:"text-center py-16 bg-white rounded-2xl shadow-sm",children:[t.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-md",children:t.jsx(m,{className:"w-10 h-10 text-gray-400"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"No Variants Available"}),t.jsx("p",{className:"text-gray-600 text-lg",children:"This product has no available variants in stock."})]}):t.jsx("div",{className:"space-y-4",children:B.map((e,r)=>{const s=D(e),a=p.has(e.id),n=f[e.id]||[],i=j.has(e.id),l=w[e.id]||1,d=void 0!==f[e.id],g=C[e.id]||0,b=r===P,y=((e,t)=>{var r;const s=(null==(r=S[t])?void 0:r.toLowerCase())||"";return s?e.filter(e=>{const t=(e.imei||"").toLowerCase(),r=(e.serialNumber||"").toLowerCase(),a=(e.condition||"").toLowerCase();return t.includes(s)||r.includes(s)||a.includes(s)}):e})(n,e.id),N=1===B.length&&s&&d&&n.length>0;return t.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden transition-all shadow-lg "+(b?"ring-4 ring-purple-300 shadow-2xl scale-[1.02]":"hover:shadow-xl hover:scale-[1.01]"),children:[!N&&t.jsx("div",{className:"p-6 "+(s?"bg-gradient-to-br from-purple-100 via-purple-50 to-blue-100":"bg-gradient-to-br from-white to-gray-50"),children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:e.name||e.variant_name||"Unnamed Variant"}),s&&t.jsxs("span",{className:"px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white text-sm font-bold rounded-full shadow-lg",children:[g," ",1===g?"device":"devices"]})]}),t.jsxs("div",{className:"flex items-center gap-6 text-base text-gray-600",children:[e.sku&&t.jsxs("div",{className:"flex items-center gap-2 bg-white/70 px-3 py-1.5 rounded-lg",children:[t.jsx(u,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"font-medium",children:e.sku})]}),t.jsx("div",{className:"font-bold text-green-600 text-2xl",children:v.currency(e.sellingPrice||e.selling_price||0)}),!s&&t.jsxs("div",{className:"text-gray-600 font-medium",children:["Stock: ",t.jsx("span",{className:"font-bold text-blue-600",children:e.quantity||0})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!s&&t.jsxs("div",{className:"flex items-center gap-2 bg-white border-2 border-gray-200 rounded-lg px-1",children:[t.jsx("button",{onClick:t=>{t.stopPropagation(),F(e.id,-1)},className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded transition-colors",disabled:l<=1,children:"-"}),t.jsx("span",{className:"w-8 text-center font-semibold",children:l}),t.jsx("button",{onClick:t=>{t.stopPropagation(),F(e.id,1)},className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded transition-colors",disabled:l>=(e.quantity||0),children:"+"})]}),s?t.jsx("button",{onClick:()=>A(e.id),className:"px-6 py-3.5 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl flex items-center gap-2 text-base hover:scale-105",children:a?t.jsxs(t.Fragment,{children:["Hide Devices",t.jsx(x,{className:"w-5 h-5"})]}):t.jsxs(t.Fragment,{children:["Show Devices",t.jsx(h,{className:"w-5 h-5"})]})}):t.jsx("button",{onClick:()=>U(e),className:"px-8 py-3.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl text-base hover:scale-105",children:"Add to Cart"})]})]})}),s&&(a||N)&&t.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 p-6 "+(N?"":"border-t-2 border-purple-200"),children:i?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),t.jsx("p",{className:"text-gray-600 mt-2",children:"Loading devices..."})]}):0===n.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(m,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-600",children:"No specific devices available"}),t.jsx("button",{onClick:()=>U(e),className:"mt-4 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Add Parent Variant"})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[t.jsxs("h4",{className:"text-lg font-bold text-gray-900",children:["ðŸ“± Available Devices (",y.length,n.length!==y.length?` of ${n.length}`:"",")"]}),n.length>3&&t.jsxs("div",{className:"relative flex-1 max-w-sm",children:[t.jsx("input",{type:"text",placeholder:"ðŸ” Search IMEI, S/N...",value:S[e.id]||"",onChange:t=>q(r=>({...r,[e.id]:t.target.value})),className:"w-full px-4 py-2.5 text-sm border-2 border-purple-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white shadow-sm font-medium",onClick:e=>e.stopPropagation()}),S[e.id]&&t.jsx("button",{onClick:t=>{t.stopPropagation(),q(t=>({...t,[e.id]:""}))},className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:t.jsx(c,{className:"w-4 h-4"})})]})]}),0===y.length?t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(m,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{className:"text-sm",children:"No devices match your search"}),t.jsx("button",{onClick:()=>q(t=>({...t,[e.id]:""})),className:"mt-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Clear search"})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:y.map((r,s)=>{const a=$[e.id]===s;return t.jsxs("div",{className:"p-4 rounded-xl transition-all bg-white cursor-pointer group relative overflow-hidden "+(a?"ring-4 ring-green-400 shadow-2xl scale-105":"shadow-md hover:shadow-xl hover:scale-[1.02] border-2 border-gray-200 hover:border-green-400"),onClick:()=>U(r),title:`Click to select ${r.imei}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center flex-shrink-0",children:t.jsx(o,{className:"w-5 h-5 text-blue-600"})}),t.jsx("span",{className:"font-mono text-base font-bold text-gray-900 truncate",children:r.imei})]}),t.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-green-600",children:[t.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),t.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})})]}),t.jsxs("div",{className:"space-y-2",children:[r.serialNumber&&t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-1.5 rounded-lg",children:[t.jsx(u,{className:"w-4 h-4 text-purple-600"}),t.jsxs("span",{className:"truncate font-medium",children:["S/N: ",r.serialNumber]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2 mt-2 border-t-2 border-gray-100",children:[t.jsx("span",{className:`inline-flex px-3 py-1.5 rounded-full text-xs font-bold shadow-sm ${V(r.condition)}`,children:r.condition}),t.jsx("span",{className:"text-lg font-bold text-green-600",children:v.currency(r.sellingPrice)})]})]}),t.jsx("div",{className:"absolute inset-0 bg-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none rounded-lg"})]},r.id)})})]})})]},e.id)})}),t.jsx("div",{className:"mt-6 pt-6 border-t-2 border-purple-100",children:t.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm text-gray-600",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("kbd",{className:"px-3 py-2 bg-white rounded-lg border-2 border-purple-200 shadow-sm font-bold text-purple-700",children:"â†‘â†“"}),t.jsx("span",{className:"font-medium",children:"Navigate"})]}),t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("kbd",{className:"px-3 py-2 bg-white rounded-lg border-2 border-green-200 shadow-sm font-bold text-green-700",children:"Enter"}),t.jsx("span",{className:"font-medium",children:"Select"})]}),t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("kbd",{className:"px-3 py-2 bg-white rounded-lg border-2 border-red-200 shadow-sm font-bold text-red-700",children:"Esc"}),t.jsx("span",{className:"font-medium",children:"Close"})]})]})})]})]})})]}),document.body)},P=({product:r,onAddToCart:s,onViewDetails:a,onView:i,onEdit:l,onDelete:o,variant:d="default",showStockInfo:c=!0,showCategory:m=!0,showActions:u=!1,isSelected:x=!1,onSelect:h,showCheckbox:g=!1,className:P="",primaryColor:E="blue",actionText:$="Add to Cart",allowOutOfStockSelection:I=!1,realTimeStockData:L})=>{var D,T,A,U,F,V,B,O;const[z,M]=n.useState(!1),[R,H]=n.useState(new Map),[K,Z]=n.useState(!1),[G,W]=n.useState(null),J=S(),{showProductImages:Q,showStockLevels:X,showPrices:Y,showBarcodes:ee}=J;_(),n.useState(null),n.useState(!1),n.useState(!1);const[te,re]=n.useState(!1);n.useEffect(()=>{M(!1)},[]),n.useEffect(()=>{if(!L&&(null==r?void 0:r.id)){const e=setTimeout(()=>{oe()},100);return()=>clearTimeout(e)}},[null==r?void 0:r.id,L]);const se=(()=>{switch(E){case"orange":return{hoverBorder:"hover:border-orange-300",textColor:"text-orange-600",iconColor:"text-orange-600",priceColor:"text-orange-900",errorColor:"text-orange-600"};case"green":return{hoverBorder:"hover:border-green-300",textColor:"text-green-600",iconColor:"text-green-600",priceColor:"text-green-900",errorColor:"text-green-600"};case"purple":return{hoverBorder:"hover:border-purple-300",textColor:"text-purple-600",iconColor:"text-purple-600",priceColor:"text-purple-900",errorColor:"text-purple-600"};default:return{hoverBorder:"hover:border-blue-300",textColor:"text-blue-600",iconColor:"text-blue-600",priceColor:"text-blue-900",errorColor:"text-blue-600"}}})();if(!r)return t.jsx("div",{className:"p-4 border border-red-200 bg-red-50 rounded-lg",children:t.jsx("p",{className:"text-red-600 text-sm",children:"Product data is missing"})});let ae,ne;try{ae=y(r),ne=j(r)}catch(fe){return M(!0),t.jsxs("div",{className:"p-4 border border-red-200 bg-red-50 rounded-lg",children:[t.jsx("p",{className:"text-red-600 text-sm",children:"Error loading product data"}),t.jsx("button",{onClick:()=>M(!1),className:"mt-2 text-blue-600 text-xs hover:underline",children:"Try again"})]})}const ie=()=>{if(!r.variants||0===r.variants.length)return t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200",children:"No Variants"});if(!ae)return null;const e=r.variants.every(e=>(e.quantity??0)<=0),s=r.variants.some(e=>(e.quantity??0)<=0),a=r.variants.reduce((e,t)=>e+(t.quantity??0),0);return e?t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-200",children:"Out of Stock"}):s&&r.variants.length>1?t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200",children:"Limited Stock"}):a<=10?t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200",children:"Low Stock"}):t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 border border-green-200",children:"In Stock"})},le=()=>{if(!r.variants||0===r.variants.length)return"No variants";const e=r.variants.map(e=>Number(e.sellingPrice)||0).filter(e=>e>0).sort((e,t)=>e-t);return 0===e.length?"No price set":`$${e[0].toFixed(2)}`},oe=async()=>{if((null==r?void 0:r.id)&&!L)try{Z(!0);const e=k.getInstance(),t=await e.getStockLevels([r.id]),s=new Map;Object.entries(t).forEach(([e,t])=>{const r=t.reduce((e,t)=>e+t.quantity,0);s.set(e,r)}),H(s),W(new Date)}catch(fe){}finally{Z(!1)}},de=()=>w(r),ce=async()=>{var t;if(u&&i)return void i(r);if(!r.variants||0===r.variants.length)return;if(a)return void a(r);const n=(null==(t=r.variants)?void 0:t.every(e=>(e.quantity??0)<=0))??!0;if(!I&&n)return;const l=r.variants&&r.variants.length>1,o=r.variants&&1===r.variants.length;if(l)re(!0);else{if(o){const t=r.variants[0],s=t.is_parent||"parent"===t.variant_type;let a=!1;if(!s)try{const{supabase:r}=await e(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{count:s}=await r.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("parent_variant_id",t.id).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0);a=(s||0)>0}catch(fe){}if(s||a)return void re(!0)}if(ae&&(ae.quantity??0)>0)s&&s(r,ae,1);else if(!I)return}};N(r);const me=(()=>{if(!r.images||0===r.images.length)return[];return r.images.map((e,t)=>({id:`temp-${r.id}-${t}`,url:e,thumbnailUrl:e,fileName:`product-image-${t+1}`,fileSize:0,isPrimary:0===t,uploadedAt:(new Date).toISOString()}))})();if("compact"===d){const e=!r.variants||0===r.variants.length,s=(null==(D=r.variants)?void 0:D.every(e=>(e.quantity??0)<=0))??!0,a=e&&!I||!I&&s;return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 transition-all duration-200 flex flex-col h-full ${P} ${a?"opacity-50 cursor-not-allowed":`cursor-pointer ${se.hoverBorder} hover:shadow-lg active:scale-98`} ${e&&!I?"border-gray-300 bg-gray-50":""}`,onClick:ce,title:e&&!I?"This product has no variants and cannot be added to cart. Please add variants in the inventory management.":`Click to ${$.toLowerCase()}`,children:[t.jsx("div",{className:"w-full mb-3 cursor-pointer hover:opacity-90 transition-opacity",onClick:e=>{e.stopPropagation()},children:t.jsx(C,{images:me.map(e=>e.url),productName:r.name,size:"md",className:"w-full h-32 sm:h-36 md:h-40 object-cover rounded-lg"})}),t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsx("h3",{className:"font-semibold text-sm sm:text-base mb-2 truncate "+(e&&!I?"text-gray-500":"text-gray-900"),title:r.name,children:r.name}),t.jsx("p",{className:"text-xs text-gray-500 font-mono mb-2 truncate",children:(null==ae?void 0:ae.sku)||"N/A"}),m&&(r.categoryName||(null==(T=r.category)?void 0:T.name))&&t.jsx("div",{className:"mb-2",children:t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs bg-purple-50 text-purple-700 border border-purple-200 font-medium truncate max-w-full",children:["ðŸ“¦ ",r.categoryName||(null==(A=r.category)?void 0:A.name)]})}),t.jsx("div",{className:"mb-3",children:ie()}),t.jsx("div",{className:"flex-1"}),t.jsxs("div",{className:"mt-auto pt-2 border-t border-gray-100",children:[Y&&t.jsx("div",{className:`font-bold text-lg truncate ${e&&!I?"text-gray-500":se.priceColor}`,title:le(),children:le()}),X&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1 truncate",children:["Stock: ",de(),r.variants&&r.variants.length>1&&t.jsxs("span",{className:"ml-1 text-gray-400",children:["(",r.variants.filter(e=>(e.quantity??0)>0).length,"/",r.variants.length,")"]})]})]})]})]})})}const ue=!r.variants||0===r.variants.length,xe=(null==(U=r.variants)?void 0:U.every(e=>(e.quantity??0)<=0))??!0,he=ue&&!I||!I&&xe,ge=(null==ae?void 0:ae.costPrice)||0,pe=(null==ae?void 0:ae.sellingPrice)||0,be=pe>0?((pe-ge)/pe*100).toFixed(1):"0";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`pos-product-card relative bg-white border-2 rounded-xl transition-all duration-300 overflow-hidden ${P} ${he?"opacity-50 cursor-not-allowed":`cursor-pointer ${se.hoverBorder} hover:shadow-lg active:scale-98`} ${ue&&!I?"border-gray-300 bg-gray-50":"border-gray-200"} ${x?"ring-4 ring-blue-400 border-blue-500":""}`,onClick:e=>{e.target.closest(".action-button")||(g&&h?h(r.id):ce())},title:ue&&!I?"This product has no variants and cannot be added to cart. Please add variants in the inventory management.":u?"Click to view details":`Click to ${$.toLowerCase()}`,children:[g&&t.jsx("div",{className:"absolute top-3 left-3 z-30 action-button",children:t.jsx("input",{type:"checkbox",checked:x,onChange:e=>{e.stopPropagation(),h&&h(r.id)},className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2 cursor-pointer"})}),X&&c&&t.jsxs("div",{className:"absolute top-1 right-1 sm:top-2 sm:right-2 p-1.5 sm:p-2 rounded-full border-2 border-white shadow-lg flex items-center justify-center z-20 w-8 h-8 sm:w-10 sm:h-10 transition-all duration-300 "+(de()<=0||de()<=5?"bg-gradient-to-r from-red-500 to-red-600":de()<=10?"bg-gradient-to-r from-orange-500 to-orange-600":"bg-gradient-to-r from-green-500 to-emerald-500"),children:[t.jsx("span",{className:"text-xs sm:text-sm font-bold text-white",children:K?"...":de()>=1e3?`${(de()/1e3).toFixed(1)}K`:de()}),K&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),t.jsxs("div",{className:"p-3 sm:p-4 md:p-6 cursor-pointer flex flex-col h-full",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 md:gap-4 flex-1 min-w-0",children:[Q&&t.jsxs("div",{className:`relative w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 rounded-xl flex items-center justify-center text-lg font-bold ${se.iconColor} cursor-pointer hover:opacity-90 transition-opacity`,onClick:e=>{e.stopPropagation(),setIsProductInfoOpen(!0)},children:[t.jsx(C,{images:me.map(e=>e.url),productName:r.name,size:"lg",className:"w-full h-full rounded-xl"}),r.variants&&r.variants.length>1&&t.jsx("div",{className:"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 w-5 h-5 sm:w-6 sm:h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:t.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-white",children:r.variants.length})})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-800 truncate text-sm sm:text-base md:text-lg lg:text-xl leading-tight",title:r.name,children:r.name}),t.jsxs("div",{className:"text-lg sm:text-xl md:text-2xl text-gray-700 mt-0.5 sm:mt-1 font-bold",children:["TSh ",le().replace("$","").replace(".00","").replace(".0","")]}),X&&t.jsxs("div",{className:"mt-1 sm:mt-2 flex items-center gap-1 sm:gap-2 flex-wrap",children:[t.jsxs("div",{className:"inline-flex items-center px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium transition-all duration-300 "+(de()<=0||de()<=5?"bg-red-100 text-red-700 border border-red-200":de()<=10?"bg-orange-100 text-orange-700 border border-orange-200":"bg-green-100 text-green-700 border border-green-200"),children:[t.jsx("span",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full mr-1 sm:mr-1.5 "+(de()<=0||de()<=5?"bg-red-500":de()<=10?"bg-orange-500":"bg-green-500")}),de()," in stock"]}),r.variants&&r.variants.length>1&&t.jsxs("div",{className:"text-[10px] sm:text-xs text-gray-500",children:[r.variants.filter(e=>(e.quantity??0)>0).length,"/",r.variants.length," variants"]})]})]})]})}),u?t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-3",children:[Y&&t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-gray-500 font-medium",children:"Cost"}),t.jsx("span",{className:"text-gray-900 font-semibold",children:v.currency(ge)})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-gray-500 font-medium",children:"Selling"}),t.jsx("span",{className:"text-green-700 font-semibold",children:v.currency(pe)})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-gray-500 font-medium",children:"Margin"}),t.jsxs("span",{className:"font-semibold "+(parseFloat(be)<10?"text-red-600":parseFloat(be)<30?"text-orange-600":"text-green-600"),children:[be,"%"]})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[(r.shelfCode||r.shelfName||r.storeLocationName||r.storageRoomName)&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-blue-50 text-blue-700 border border-blue-200 text-xs",children:["ðŸ“ ",r.shelfCode||r.shelfName||r.storeLocationName||r.storageRoomName]}),m&&(r.categoryName||(null==(F=r.category)?void 0:F.name))&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium",children:["ðŸ“¦ ",r.categoryName||(null==(V=r.category)?void 0:V.name)]}),r.supplierName&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-green-50 text-green-700 border border-green-200 text-xs",children:["ðŸ¢ ",r.supplierName]}),r.isFeatured&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-yellow-50 text-yellow-700 border border-yellow-200 text-xs font-medium",children:"â­ Featured"})]}),r.variants&&r.variants.length>1&&t.jsx("div",{className:"flex items-center justify-between text-xs bg-gradient-to-r from-indigo-50 to-purple-50 px-3 py-2 rounded-lg",children:t.jsxs("span",{className:"text-gray-600",children:[t.jsx("span",{className:"font-semibold text-indigo-700",children:r.variants.length})," variants available"]})})]}):t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("div",{className:"flex items-center gap-4",children:(r.shelfCode||r.shelfName||r.storeLocationName||r.storageRoomName)&&t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-blue-50 text-blue-700 border border-blue-200 text-xs",children:["ðŸ“¦ ",r.shelfCode||r.shelfName||r.storeLocationName||r.storageRoomName||"Shelf Info"]})})}),t.jsx("div",{className:"flex items-center gap-2",children:m&&(r.categoryName||(null==(B=r.category)?void 0:B.name))&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium",children:["ðŸ“¦ ",r.categoryName||(null==(O=r.category)?void 0:O.name)]})})]})}),t.jsx("div",{className:"flex-1"}),u?t.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-200 space-y-2 action-button",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[i&&t.jsxs("button",{onClick:e=>{e.stopPropagation(),i(r)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[t.jsx(p,{className:"w-3.5 h-3.5"}),"View"]}),l&&t.jsxs("button",{onClick:e=>{e.stopPropagation(),l(r)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-green-50 text-green-700 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[t.jsx(b,{className:"w-3.5 h-3.5"}),"Edit"]}),o&&t.jsxs("button",{onClick:e=>{e.stopPropagation(),o(r)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 rounded-lg transition-colors",children:[t.jsx(f,{className:"w-3.5 h-3.5"}),"Delete"]})]}),t.jsxs("div",{className:"flex items-center justify-between text-xs px-2",children:[t.jsx("span",{className:"text-gray-500",children:"Status:"}),t.jsx("span",{className:"font-medium "+(r.isActive?"text-green-600":"text-gray-400"),children:r.isActive?"â— Active":"â—‹ Inactive"})]})]}):he?null:t.jsx("div",{className:"mt-auto pt-3 border-t border-gray-100",children:t.jsxs("div",{className:`text-center text-sm font-medium ${se.textColor} opacity-70 hover:opacity-100 transition-opacity`,children:["Click to ",$]})})]})]}),t.jsx(q,{isOpen:te,onClose:()=>re(!1),product:r,onSelectVariant:(e,t,r)=>{s&&s(e,t,r)}})]})};export{C as P,k as R,P as V,q as a,S as u};
