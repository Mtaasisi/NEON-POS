import{_ as e}from"./supabase-7e851d02.js";import{j as t,G as s,u as a,aC as r,ay as l,aD as n,aj as i,d as o,s as d,aE as c,o as m,n as u,v as x,t as g,c as h,a as p,C as b,aF as f,aG as y,aH as v,aI as j,aJ as N,T as w,as as S,aK as C}from"./index-222cfb29.js";import{R as k,r as _,b as P}from"./vendor-a2ff445a.js";import{r as D,V as T,D as I}from"./rbac-bc517d81.js";import{u as E,a as A}from"./routing-a2f0f6d2.js";import{ao as L,H as F,k as O,b6 as $,t as M,aA as R,$ as U,a5 as z,aa as q,R as V,m as B,aX as Z,aH as Q,aI as W,n as G,y as K,cB as H,x as Y,bR as J,ad as X,ac as ee,X as te,T as se,O as ae,Q as re,r as le,V as ne,aq as ie,P as oe,U as de,bx as ce,h as me,ap as ue,aL as xe,w as ge,o as he,D as pe,Y as be,v as fe,d as ye,f as ve,j as je,p as Ne,az as we,e as Se,a1 as Ce,b as ke,ag as _e,u as Pe,N as De,ax as Te,ah as Ie,aj as Ee,g as Ae,a9 as Le,q as Fe,a8 as Oe,b4 as $e,A as Me,br as Re,ak as Ue,bK as ze,ar as qe,s as Ve,a7 as Be,cs as Ze,ab as Qe}from"./ui-551a39a6.js";import{u as We}from"./usePOSClickSounds-710a2a1b.js";import{V as Ge,R as Ke,u as He,P as Ye,a as Je}from"./VariantProductCard-5f79965a.js";import{u as Xe}from"./useBodyScrollLock-0216d39f.js";import{G as et}from"./GlassBadge-18f019e2.js";import{format as tt}from"./format-0f0b2647.js";import{S as st}from"./SafeImage-bfaf74c6.js";import{a as at,b as rt,f as lt}from"./specificationUtils-8355804c.js";import{P as nt}from"./PriceInput-e1556d5b.js";import{C as it}from"./CategoryInput-bba1731d.js";import{A as ot}from"./AddCustomerModal-a69277f6.js";import{s as dt}from"./search-674d386b.js";import{c as ct,s as mt,S as ut}from"./ShareReceiptModal-4bab199d.js";import{C as xt}from"./CustomerDetailModal-9e075bf1.js";import{G as gt}from"./GlassInput-ba5c3c0d.js";import{i as ht}from"./installmentService-e14bbda4.js";import{T as pt}from"./TradeInContractModal-dd90079f.js";import{paymentTrackingService as bt}from"./paymentTrackingService-7b6db13e.js";import{P as ft}from"./PaymentsPopupModal-70ab4c91.js";import{g as yt,a as vt,i as jt,b as Nt}from"./productUtils-6e390a72.js";import{d as wt}from"./draftService-0e50dcac.js";import{u as St,S as Ct}from"./useSuccessModal-e8b7d685.js";import{S as kt}from"./SuccessModalIcons-20b743c5.js";const _t={"/lats/quick-cash":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/quick-cash",name:"Quick Cash"}],"/lats/unified-inventory":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/unified-inventory",name:"Unified Inventory Management"}],"/lats/customers":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/customers",name:"Customer Management"}],"/lats/analytics":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/analytics",name:"Business Analytics"}],"/lats/sales-analytics":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/sales-analytics",name:"Sales Analytics"}],"/lats/sales-reports":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/sales-reports",name:"Sales Reports"}],"/lats/loyalty":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/loyalty",name:"Customer Loyalty"}],"/lats/payments":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/payments",name:"Payment Tracking"}],"/lats/add-product":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/unified-inventory",name:"Unified Inventory Management"},{path:"/lats/add-product",name:"Add Product"}],"/lats/products/:productId/edit":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/unified-inventory",name:"Unified Inventory Management"},{path:"/lats/products/:productId/edit",name:"Edit Product"}],"/lats/inventory/new":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/unified-inventory",name:"Unified Inventory Management"},{path:"/lats/inventory/new",name:"Add Product"}],"/lats/inventory/products/new":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/unified-inventory",name:"Unified Inventory Management"},{path:"/lats/inventory/products/new",name:"Add Product"}],"/lats/payment-settings":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/payment-settings",name:"Payment Settings"}],"/lats/payment-history":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/payment-history",name:"Payment History"}],"/lats/payment-analytics":[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats/payment-analytics",name:"Payment Analytics"}]},Pt=({className:e=""})=>{const a=E(),r=A(),l=(()=>{const e=a.pathname;if(_t[e])return _t[e];for(const[t,s]of Object.entries(_t))if(e.startsWith(t+"/"))return s;return e.startsWith("/lats/")?[{path:"/dashboard",name:"Dashboard",icon:F},{path:"/lats",name:"LATS System"}]:[{path:"/dashboard",name:"Dashboard",icon:F}]})();return l.length<=1?null:t.jsx("nav",{className:`flex items-center space-x-2 text-sm ${e}`,children:l.map((e,a)=>{const n=e.icon,i=a===l.length-1;return t.jsxs(k.Fragment,{children:[t.jsxs(s,{onClick:()=>r(e.path),variant:i?"secondary":"ghost",className:(i?"text-gray-900 font-medium cursor-default":"text-gray-600 hover:text-gray-900")+" px-2 py-1 text-sm",disabled:i,children:[n&&t.jsx(n,{size:14,className:"mr-1"}),e.name]}),!i&&t.jsx(L,{size:14,className:"text-gray-400"})]},e.path)})})},Dt=({cartItemsCount:e,totalAmount:s,onProcessPayment:r,onClearCart:l,onScanQrCode:n,onAddCustomer:i,onViewReceipts:o,onViewSales:d,onOpenPaymentTracking:c,onOpenDrafts:m,isProcessingPayment:u,hasSelectedCustomer:x,draftCount:g=0,todaysSales:h=0,isDailyClosed:p=!1,onCloseDay:b,canCloseDay:f=!1,onViewAnalytics:y,onPaymentTracking:v,onCustomers:j,onReports:N,onRefreshData:w,onSettings:S})=>{var C,P;const{currentUser:T,logout:I}=a(),{playPaymentSound:E,playDeleteSound:L,playClickSound:K}=We(),H=()=>{E(),r()},Y=()=>{L(),l()},J=A(),[X,ee]=_.useState(!1),[te,se]=_.useState(()=>{const e=localStorage.getItem("pos_view_mode");return"mobile"===e||"desktop"===e?e:"desktop"}),ae=null==T?void 0:T.role;D.can(ae,"reports","view"),D.can(ae,"settings","view"),k.useEffect(()=>{const e=()=>{ee(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)}},[]),k.useEffect(()=>{document.body.setAttribute("data-view-mode",te)},[te]);return t.jsx("header",{className:"sticky top-0 z-20 bg-white/95 backdrop-blur-sm border-b border-gray-200 shadow-sm",children:t.jsxs("div",{className:"px-3 py-2 sm:px-6 sm:py-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:"Customer Care POS"}),p&&t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-orange-100 text-orange-700 rounded-lg text-xs font-medium",children:[t.jsx(O,{size:12}),t.jsx("span",{children:"Day Closed"})]})]}),t.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Desktop Point of Sale System"})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm sm:text-lg font-semibold text-gray-900",children:(new Date).toLocaleTimeString("en-TZ",{hour:"2-digit",minute:"2-digit"})}),t.jsx("div",{className:"text-xs sm:text-sm text-gray-600 hidden sm:block",children:(new Date).toLocaleDateString("en-TZ",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),t.jsx("div",{className:"text-xs text-gray-600 sm:hidden",children:(new Date).toLocaleDateString("en-TZ",{month:"short",day:"numeric"})})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 sm:gap-0",children:[t.jsx("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-start",children:t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[t.jsxs("button",{onClick:()=>{K(),n()},className:"flex items-center gap-1 sm:gap-3 px-2 sm:px-4 py-2 sm:py-3 bg-green-50 text-green-700 rounded-lg active:bg-green-100 transition-all duration-200 border border-green-200 shadow-sm touch-target",children:[t.jsx($,{size:16,className:"sm:hidden"}),t.jsx($,{size:18,className:"hidden sm:block"}),t.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Scan"})]}),((null==(C=T.permissions)?void 0:C.includes("all"))||(null==(P=T.permissions)?void 0:P.includes("access_pos"))||"admin"===T.role||"customer-care"===T.role)&&t.jsxs("button",{onClick:()=>{K(),i()},className:"flex items-center gap-1 sm:gap-3 px-2 sm:px-4 py-2 sm:py-3 bg-blue-50 text-blue-700 rounded-lg active:bg-blue-100 transition-all duration-200 border border-blue-200 shadow-sm touch-target",children:[t.jsx(M,{size:16,className:"sm:hidden"}),t.jsx(M,{size:18,className:"hidden sm:block"}),t.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Add Customer"})]})]})}),t.jsx("div",{className:"flex items-center justify-center w-full sm:w-auto",children:t.jsx("button",{onClick:()=>{K(),d()},className:"flex items-center gap-3 px-4 py-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-all duration-200 border border-blue-200 shadow-sm hover:shadow-md min-h-[44px] min-w-[44px]",title:"View Sales Report",children:t.jsx("span",{className:"text-sm font-medium",children:(re=h,new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(re))})})}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-start",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:hidden",children:[e>0&&t.jsxs("button",{onClick:H,disabled:u,className:"flex items-center gap-1 px-3 py-2 bg-emerald-500 text-white rounded-lg active:bg-emerald-600 disabled:bg-gray-400 transition-all duration-200 font-semibold shadow-md touch-target",children:[t.jsx(R,{size:16}),t.jsx("span",{className:"text-xs font-medium",children:u?"Processing...":"Pay"})]}),e>0&&t.jsxs("button",{onClick:Y,className:"flex items-center gap-1 px-2 py-2 bg-red-50 text-red-700 rounded-lg active:bg-red-100 transition-all duration-200 border border-red-200 shadow-sm touch-target",title:"Clear Cart",children:[t.jsx(U,{size:16}),t.jsx("span",{className:"text-xs font-medium",children:"Clear"})]}),b&&f&&!p&&t.jsxs("button",{onClick:()=>{K(),b()},className:"flex items-center gap-1 px-2 py-2 bg-red-500 text-white rounded-lg active:bg-red-600 transition-all duration-200 font-semibold shadow-md touch-target",title:"Close Daily Sales",children:[t.jsx(O,{size:16}),t.jsx("span",{className:"text-xs font-medium",children:"Close"})]})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-3",children:[v&&t.jsxs("button",{onClick:()=>{K(),null==v||v()},className:"flex items-center gap-3 px-4 py-3 bg-emerald-50 text-emerald-700 rounded-lg hover:bg-emerald-100 transition-all duration-200 border border-emerald-200 shadow-sm hover:shadow-md min-h-[44px] min-w-[44px]",title:"Payment Tracking",children:[t.jsx(z,{size:18}),t.jsx("span",{className:"text-sm font-medium",children:"Payments"})]}),b&&f&&!p&&t.jsxs("button",{onClick:()=>{K(),b()},className:"flex items-center gap-3 px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all duration-200 font-semibold shadow-md min-h-[44px] min-w-[44px]",title:"Close Daily Sales",children:[t.jsx(O,{size:18}),t.jsx("span",{className:"text-sm font-medium",children:"Close Day"})]}),e>0&&t.jsxs("button",{onClick:H,disabled:u||!x,className:"flex items-center gap-3 px-5 py-3 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 disabled:bg-gray-400 transition-all duration-200 font-semibold shadow-md min-h-[44px] min-w-[44px]",title:x?u?"Processing payment...":"Process payment":"Please select a customer first",children:[t.jsx(R,{size:18}),t.jsx("span",{className:"text-sm font-medium",children:u?"Processing...":"Pay"})]}),e>0&&t.jsxs("button",{onClick:Y,className:"flex items-center gap-3 px-4 py-3 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-all duration-200 border border-red-200 shadow-sm min-h-[44px] min-w-[44px]",title:"Clear Cart",children:[t.jsx(U,{size:18}),t.jsx("span",{className:"text-sm font-medium",children:"Clear"})]})]}),t.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[t.jsxs("button",{onClick:()=>{K(),J("/dashboard")},className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-2 sm:py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 shadow-sm touch-target",title:"Exit to Dashboard",children:[t.jsx(F,{size:16,className:"sm:hidden"}),t.jsx(F,{size:18,className:"hidden sm:block"}),t.jsx("span",{className:"text-xs sm:text-sm font-medium hidden sm:inline",children:"Exit"})]}),S&&"admin"===(null==T?void 0:T.role)&&t.jsxs("button",{onClick:()=>{K(),S()},className:"p-2 sm:p-3 text-gray-600 active:text-gray-800 active:bg-gray-100 rounded-lg transition-all duration-200 shadow-sm touch-target flex items-center justify-center",title:"POS Settings",children:[t.jsx(q,{size:16,className:"sm:hidden"}),t.jsx(q,{size:18,className:"hidden sm:block"})]}),w&&t.jsxs("button",{onClick:()=>{K(),w()},className:"p-2 sm:p-3 text-gray-600 active:text-gray-800 active:bg-gray-100 rounded-lg transition-all duration-200 shadow-sm touch-target flex items-center justify-center",title:"Refresh Data",children:[t.jsx(V,{size:16,className:"sm:hidden"}),t.jsx(V,{size:18,className:"hidden sm:block"})]}),t.jsx("button",{onClick:()=>{const e="desktop"===te?"mobile":"desktop";se(e),localStorage.setItem("pos_view_mode",e),K(),G.success(`Switched to ${e} view`,{icon:"mobile"===e?"ðŸ“±":"ðŸ–¥ï¸",duration:2e3}),window.dispatchEvent(new Event("viewModeChanged")),window.dispatchEvent(new Event("resize"))},className:"p-2 sm:p-3 rounded-lg transition-all duration-200 active:scale-95 shadow-sm touch-target flex items-center justify-center "+("mobile"===te?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"mobile"===te?"Switch to Desktop View":"Switch to Mobile View",children:"mobile"===te?t.jsxs(t.Fragment,{children:[t.jsx(B,{size:16,className:"sm:hidden"}),t.jsx(B,{size:18,className:"hidden sm:block"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Z,{size:16,className:"sm:hidden"}),t.jsx(Z,{size:18,className:"hidden sm:block"})]})}),t.jsx("button",{onClick:async()=>{try{if(document.fullscreenElement)document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen(),K(),G.success("Exited fullscreen mode");else{const e=document.documentElement;e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.mozRequestFullScreen?await e.mozRequestFullScreen():e.msRequestFullscreen&&await e.msRequestFullscreen(),K(),G.success("Entered fullscreen mode")}}catch(e){G.error("Failed to toggle fullscreen")}},className:"hidden sm:flex p-3 text-neutral-600 hover:text-neutral-800 hover:bg-neutral-100 rounded-lg transition-all duration-200 shadow-soft min-h-[44px] min-w-[44px] items-center justify-center",title:X?"Exit Fullscreen":"Enter Fullscreen",children:X?t.jsx(Q,{size:18}):t.jsx(W,{size:18})})]})]})]})]})});var re};function Tt(){const[,e]=_.useState({});return _.useEffect(()=>r(()=>{e({})}),[]),{t:l,locale:n()}}const It=({products:e,searchQuery:s,setSearchQuery:r,isSearching:l,showAdvancedFilters:n,setShowAdvancedFilters:d,selectedCategory:c,setSelectedCategory:m,selectedBrand:u,setSelectedBrand:x,priceRange:g,setPriceRange:h,stockFilter:p,setStockFilter:b,sortBy:f,setSortBy:y,sortOrder:v,setSortOrder:j,categories:N,brands:w,onAddToCart:S,onAddExternalProduct:C,onSearch:k,onScanQrCode:P,currentPage:T,setCurrentPage:I,totalPages:E,productsPerPage:A})=>{const{productsPerRow:L}=i(),{currentUser:F}=a(),O=null==F?void 0:F.role,$=D.can(O,"products","create"),{playClickSound:M}=We(),{t:R}=Tt();_.useEffect(()=>{I(1)},[A,I]),_.useState(!1),_.useState([]);const[U,z]=_.useState(!1),[q,V]=_.useState(!1),[B,Z]=_.useState("grid");Xe(q);const[Q,W]=_.useState(new Map),[se,ae]=_.useState(!1);_.useEffect(()=>{(async()=>{if(e&&0!==e.length)try{ae(!0);const t=e.map(e=>e.id),s=Ke.getInstance(),a=await s.getStockLevels(t),r=new Map;Object.entries(a).forEach(([e,t])=>{const s=t.reduce((e,t)=>e+t.quantity,0);r.set(e,s)}),W(r)}catch(t){}finally{ae(!1)}})()},[e]);const re=[...e.filter(e=>{var t,a,r,l,n;if(s.trim()){const l=s.toLowerCase();if(!((null==(t=e.name)?void 0:t.toLowerCase().includes(l))||(null==(a=e.sku)?void 0:a.toLowerCase().includes(l))||(null==(r=e.category)?void 0:r.name)&&e.category.name.toLowerCase().includes(l)||e.variants&&e.variants.some(e=>{var t,s,a;return(null==(t=e.name)?void 0:t.toLowerCase().includes(l))||(null==(s=e.sku)?void 0:s.toLowerCase().includes(l))||(null==(a=e.barcode)?void 0:a.toLowerCase().includes(l))})))return!1}if(c&&(null==(l=e.category)?void 0:l.name)!==c)return!1;const i=null==(n=e.variants)?void 0:n[0],o=(null==i?void 0:i.sellingPrice)||e.price||0,d=(null==i?void 0:i.quantity)||e.stockQuantity||0;if(g.min&&o<parseFloat(g.min))return!1;if(g.max&&o>parseFloat(g.max))return!1;switch(p){case"in-stock":if(d<=0)return!1;break;case"low-stock":if(d>10||d<=0)return!1;break;case"out-of-stock":if(d>0)return!1}return!0})].sort((e,t)=>{var s,a;let r=0;const l=null==(s=e.variants)?void 0:s[0],n=null==(a=t.variants)?void 0:a[0],i=(null==l?void 0:l.sellingPrice)||e.price||0,o=(null==n?void 0:n.sellingPrice)||t.price||0,d=(null==l?void 0:l.quantity)||e.stockQuantity||0,c=(null==n?void 0:n.quantity)||t.stockQuantity||0;switch(f){case"name":r=e.name.localeCompare(t.name);break;case"price":r=i-o;break;case"stock":r=d-c;break;case"recent":r=e.id.localeCompare(t.id);break;case"sales":r=c-d}return"asc"===v?r:-r}),le=re;return t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsxs(o,{className:"p-6 h-full flex flex-col overflow-hidden",children:[t.jsx("div",{className:"flex-shrink-0 mb-4",children:t.jsxs("div",{className:"bg-white/70 backdrop-blur-xl rounded-xl border border-white/30 shadow-lg p-4 mb-4",children:[t.jsx("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx("input",{type:"text",placeholder:`${R("common.search")} ${R("common.products").toLowerCase()}...`,value:s,onChange:e=>{const t=e.target.value;r(t),z(!1)},onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),s.trim()&&k(s.trim()))},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/80"})]})})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs("select",{value:f,onChange:e=>y(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 bg-white/80 text-sm",children:[t.jsx("option",{value:"sales",children:"Best Selling"}),t.jsx("option",{value:"name",children:"Name"}),t.jsx("option",{value:"price",children:"Price"}),t.jsx("option",{value:"stock",children:"Stock"})]}),t.jsx("button",{onClick:()=>{M(),j("asc"===v?"desc":"asc")},className:"px-3 py-2 text-sm bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors",children:"asc"===v?"â†‘":"â†“"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"number",placeholder:`Min ${R("common.price")}`,value:g.min,onChange:e=>h({...g,min:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 bg-white/80 text-sm w-24"}),t.jsx("input",{type:"number",placeholder:`Max ${R("common.price")}`,value:g.max,onChange:e=>h({...g,max:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 bg-white/80 text-sm w-24"})]}),t.jsx("button",{onClick:()=>{M(),r(""),m(""),x(""),h({min:"",max:""}),b("all")},className:"px-3 py-2 text-sm bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors",children:"Clear"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[t.jsx("button",{onClick:()=>{M(),m("")},className:"px-3 py-2 text-sm transition-colors "+(""===c?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"),children:"All"}),N.slice(0,3).map(e=>t.jsx("button",{onClick:()=>{M(),m(e)},className:"px-3 py-2 text-sm transition-colors "+(c===e?"bg-green-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"),children:e},e)),N.length>3&&t.jsx("button",{onClick:()=>{M(),V(!0)},className:"px-3 py-2 text-sm bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors border-l border-gray-300",title:"Show all categories",children:t.jsx(H,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[t.jsx("button",{onClick:()=>{M(),b("all")},className:"px-3 py-1.5 text-sm transition-colors "+("all"===p?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"),children:"All"}),t.jsx("button",{onClick:()=>{M(),b("in-stock")},className:"px-3 py-1.5 text-sm transition-colors "+("in-stock"===p?"bg-green-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"),children:"In Stock"}),t.jsx("button",{onClick:()=>{M(),b("low-stock")},className:"px-3 py-1.5 text-sm transition-colors "+("low-stock"===p?"bg-orange-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"),children:"Low Stock"})]}),t.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[$&&t.jsx("button",{onClick:()=>{M(),C()},className:"px-3 py-1.5 text-sm bg-green-600 text-white hover:bg-green-700 transition-colors",title:"Add Product",children:t.jsx(Y,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{var e;M(),s.trim()&&(e=s.trim(),/^\d{8,}$/.test(e)?P?P():G("QrCode scanning not available"):k(e))},className:"px-3 py-1.5 text-sm bg-blue-600 text-white hover:bg-blue-700 transition-colors",title:"Scan",children:t.jsx(J,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden ml-auto",children:[t.jsx("button",{onClick:()=>{M(),Z("grid")},className:"px-3 py-1.5 text-sm transition-colors "+("grid"===B?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"),title:"Grid View",children:t.jsx(X,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{M(),Z("list")},className:"px-3 py-1.5 text-sm transition-colors "+("list"===B?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"),title:"List View",children:t.jsx(ee,{className:"w-4 h-4"})})]})]})]})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden pos-products-scroll",style:{minHeight:0},children:le.length>0?"grid"===B?t.jsx("div",{className:"w-full max-w-full mx-auto px-3 sm:px-4 md:px-6 pb-6",children:t.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${L}, 1fr)`,gap:"clamp(1rem, 2vw, 1.5rem)",gridAutoRows:"1fr"},children:le.map(e=>t.jsx(Ge,{product:e,onAddToCart:S,realTimeStockData:Q,className:"w-full h-full"},e.id))})}):t.jsx("div",{className:"space-y-3 pb-4",children:le.map(e=>{var s,a;const r=null==(s=e.variants)?void 0:s.map(e=>({...e,id:e.id,name:e.name||e.variant_name,sku:e.sku,barcode:e.barcode,price:e.selling_price||e.sellingPrice||e.price||0,sellingPrice:e.selling_price||e.sellingPrice||e.price||0,costPrice:e.costPrice||e.cost_price||0,quantity:e.quantity??e.stockQuantity??e.stock_quantity??0,stockQuantity:e.stockQuantity??e.quantity??e.stock_quantity??0,minStockLevel:e.minStockLevel||e.min_stock_level||e.minQuantity||e.min_quantity||0,attributes:e.attributes||{}})),l=null==r?void 0:r[0],n=r&&r.length>1,i=Number((null==l?void 0:l.sellingPrice)||e.price||0);let o=0;const d=Q.get(e.id);o=null!=d?d:l?l.stockQuantity||0:e.stockQuantity??e.totalQuantity??0;const c=o<=0,m=o>0&&o<=10;return t.jsx("div",{className:"group bg-gradient-to-r from-white to-gray-50/30 rounded-xl border border-gray-200/80 hover:border-blue-300 hover:shadow-lg transition-all duration-200 p-4",children:t.jsxs("div",{className:"flex items-center gap-5",children:[t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl overflow-hidden shadow-sm ring-2 ring-white group-hover:ring-blue-100 transition-all",children:e.image?t.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-50",children:t.jsx(Y,{className:"w-10 h-10 text-blue-300"})})}),t.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 rounded-full border-2 border-white shadow-sm "+(c?"bg-red-500":m?"bg-orange-500":"bg-green-500")})]}),t.jsxs("div",{className:"flex-1 min-w-0 space-y-1.5",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-lg truncate group-hover:text-blue-700 transition-colors",title:e.name,children:e.name}),t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[((null==l?void 0:l.sku)||e.sku)&&t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300"}),t.jsx("span",{className:"font-mono",children:(null==l?void 0:l.sku)||e.sku})]}),r&&r.length>1&&t.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-purple-50 text-purple-700 border border-purple-200/50",children:[t.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),r.length," Variants"]}),(null==(a=e.category)?void 0:a.name)&&t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200/50",children:e.category.name}),t.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-semibold "+(c?"bg-red-50 text-red-700 border border-red-200/50":m?"bg-orange-50 text-orange-700 border border-orange-200/50":"bg-green-50 text-green-700 border border-green-200/50"),children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full "+(c?"bg-red-500":m?"bg-orange-500":"bg-green-500")}),c?"Out of Stock":`${o} units`]})]})]}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-6",children:[t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-2xl font-bold text-gray-900 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:["TSh ",i.toLocaleString()]}),t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"per unit"})]}),t.jsx("button",{onClick:()=>{M();const t={...e,variants:r};l?S(t,l):S(t)},disabled:c,className:`\n                              px-6 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap\n                              ${c?"bg-gray-100 text-gray-400 cursor-not-allowed":n?"bg-purple-600 text-white hover:bg-purple-700 active:bg-purple-800":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"}\n                            `,children:c?"Unavailable":n?"Select Variant":"Add to Cart"})]})]})},e.id)})}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[t.jsx(Y,{className:"w-16 h-16 mb-4 opacity-50"}),t.jsx("p",{className:"text-lg font-medium mb-2",children:"No products found"}),t.jsx("p",{className:"text-sm text-center",children:"Try adjusting your search or filters to find what you're looking for."})]})}),t.jsx("div",{className:"flex-shrink-0 mt-4 pt-4 border-t border-gray-200",children:t.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Showing ",le.length," of ",re.length," products"]})})]}),q&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Select Category"}),t.jsx("button",{onClick:()=>{M(),V(!1)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(te,{className:"w-5 h-5 text-gray-500"})})]}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:[t.jsx("button",{onClick:()=>{M(),m(""),V(!1)},className:"p-4 rounded-lg border-2 transition-all hover:shadow-md "+(""===c?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"),children:t.jsx("div",{className:"text-center",children:t.jsx("div",{className:"text-sm font-medium",children:"All Categories"})})}),N.map(e=>t.jsx("button",{onClick:()=>{M(),m(e),V(!1)},className:"p-4 rounded-lg border-2 transition-all hover:shadow-md "+(c===e?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"),children:t.jsx("div",{className:"text-center",children:t.jsx("div",{className:"text-sm font-medium truncate",title:e,children:e})})},e))]})}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[t.jsxs("div",{className:"text-sm text-gray-500",children:[N.length," categories available"]}),t.jsx("button",{onClick:()=>{M(),V(!1)},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Close"})]})]})})]})},Et=e=>e&&0!==e.length?e.map((e,t)=>({id:`temp-${t}`,url:e,thumbnailUrl:e,fileName:`product-image-${t+1}`,fileSize:0,isPrimary:0===t,uploadedAt:(new Date).toISOString()})):[],At=({item:e,onQuantityChange:s,onRemove:a,onVariantChange:r,onTagsChange:l,availableVariants:n=[],showStockInfo:i=!0,variant:o="default",className:d=""})=>{const[c,m]=_.useState(!1),[u,x]=_.useState(e.quantity),[g,h]=_.useState(!1),[p,b]=_.useState(!1),[f,y]=_.useState(""),{playClickSound:v,playDeleteSound:j}=We(),N=e.unitPrice*e.quantity,w=e.availableQuantity,S=e.quantity>w?"insufficient":w<=5?"low":"normal",C=e=>{e<=0?a():s(e)},k=()=>{if(f.trim()&&l){const t=e.tags||[];t.includes(f.trim())||(l([...t,f.trim()]),v()),y(""),b(!1)}},P=n.length>1,D=e.image||null;return"compact"===o?t.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200 ${d}`,children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:D?t.jsx(st,{images:Et([D]),productName:e.productName,size:"sm",className:"w-full h-full rounded-lg"}):t.jsx(Y,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-gray-900 truncate text-sm",children:e.productName}),"Default"!==e.variantName&&t.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-600 mt-1",children:t.jsx("span",{className:"text-blue-600",children:e.variantName})}),e.selectedSerialNumbers&&e.selectedSerialNumbers.length>0?t.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mt-1",children:[t.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-green-500 rounded-full"}),t.jsxs("span",{children:["IMEI: ",e.selectedSerialNumbers.map(e=>e.imei||e.serial_number).join(", ")]})]}):null,t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Available: ",t.jsxs("span",{className:"font-medium",children:[w," units"]})]}),e.tags&&e.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.map((e,s)=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-50 text-blue-700 rounded-full text-xs font-medium border border-blue-200",children:[t.jsx(se,{className:"w-2.5 h-2.5"}),e]},s))})]})]}),t.jsx("button",{type:"button",onClick:a,className:"flex-shrink-0 inline-flex items-center justify-center w-8 h-8 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200",children:t.jsx(U,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center justify-between gap-4 pt-2 border-t border-gray-100",children:[t.jsxs("div",{className:"flex-shrink-0",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:"Total"}),t.jsx("div",{className:"font-bold text-lg text-gray-900",children:tt.money(N)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantity:"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("button",{type:"button",onClick:()=>C(e.quantity-1),disabled:e.quantity<=1,className:"inline-flex items-center justify-center w-8 h-8 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t.jsx(ae,{className:"w-3 h-3"})}),t.jsx("span",{className:"w-12 text-center font-semibold text-base px-2 py-1.5 bg-gray-50 rounded-md border border-gray-200",children:e.quantity}),t.jsx("button",{type:"button",onClick:()=>C(e.quantity+1),disabled:e.quantity>=w,className:"inline-flex items-center justify-center w-8 h-8 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t.jsx(re,{className:"w-3 h-3"})})]})]})]})]}),"insufficient"===S&&t.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-lg",children:t.jsxs("div",{className:"text-sm text-red-800",children:[t.jsx("strong",{children:"Warning:"})," Requested quantity (",e.quantity,") exceeds available stock (",w,")"]})})]}):t.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-200 ${d}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[t.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl flex items-center justify-center flex-shrink-0 overflow-hidden",children:D?t.jsx(st,{images:Et([D]),productName:e.productName,size:"sm",className:"w-full h-full rounded-xl"}):t.jsx(Y,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:e.productName}),"Default"!==e.variantName&&t.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600 mt-1",children:t.jsx("span",{className:"text-blue-600 font-medium",children:e.variantName})}),e.selectedSerialNumbers&&e.selectedSerialNumbers.length>0&&t.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 mt-1 font-medium",children:[t.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-green-500 rounded-full"}),t.jsxs("span",{children:["IMEI: ",e.selectedSerialNumbers.map(e=>e.imei||e.serial_number).join(", ")]})]}),e.attributes&&Object.keys(e.attributes).length>0&&t.jsxs("div",{className:"mt-3",children:[t.jsx("div",{className:"space-y-1.5",children:Object.entries(e.attributes).slice(0,6).map(([e,s])=>{const a=at(e),r=rt(e),l=lt(e,s);return t.jsx("div",{className:`p-2 rounded-md border ${(e=>{const t=e.toLowerCase();return t.includes("ram")?"bg-emerald-50 text-emerald-800 border-emerald-200":t.includes("storage")||t.includes("memory")?"bg-blue-50 text-blue-800 border-blue-200":t.includes("processor")||t.includes("cpu")?"bg-purple-50 text-purple-800 border-purple-200":t.includes("screen")||t.includes("display")?"bg-orange-50 text-orange-800 border-orange-200":t.includes("battery")?"bg-teal-50 text-teal-800 border-teal-200":t.includes("camera")?"bg-pink-50 text-pink-800 border-pink-200":t.includes("color")?"bg-red-50 text-red-800 border-red-200":t.includes("weight")||t.includes("size")?"bg-gray-50 text-gray-800 border-gray-200":t.includes("charger")||t.includes("port")?"bg-cyan-50 text-cyan-800 border-cyan-200":"bg-slate-50 text-slate-800 border-slate-200"})(e)} hover:shadow-sm transition-all duration-200 cursor-help`,title:r,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[a&&t.jsx(a,{className:"w-3.5 h-3.5 flex-shrink-0"}),t.jsx("div",{children:t.jsx("div",{className:"text-xs font-medium capitalize text-gray-700",children:e.replace(/([A-Z])/g," $1").trim()})})]}),t.jsx("div",{className:"text-xs font-semibold",children:l})]})},e)})}),Object.keys(e.attributes).length>6&&t.jsx("div",{className:"text-center mt-2",children:t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full border border-gray-200 bg-gray-50 text-gray-600 text-xs font-medium",children:["+",Object.keys(e.attributes).length-6," more"]})})]}),P&&t.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 mt-1",children:[t.jsx(se,{className:"w-3 h-3"}),t.jsx("span",{children:"Click to change variant"})]})]})]}),"insufficient"===S&&(()=>{switch(S){case"insufficient":return t.jsx(et,{variant:"error",size:"sm",children:"Insufficient Stock"});case"low":return t.jsx(et,{variant:"warning",size:"sm",children:"Low Stock"});default:return t.jsx(et,{variant:"success",size:"sm",children:"In Stock"})}})()]}),t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("div",{children:i&&t.jsxs("div",{className:"text-sm text-gray-600",children:["Available: ",w," units"]})}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-bold text-2xl text-gray-900",children:tt.money(N)}),P&&r&&t.jsxs("button",{onClick:()=>h(!g),className:"mt-2 inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:[t.jsx(le,{className:"w-3 h-3"}),"Change Variant"]})]})]}),g&&P&&r&&t.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Select Variant:"}),t.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:n.map(s=>{const a=s.id===e.variantId,l=s.quantity<=0?"out-of-stock":s.quantity<=5?"low":"normal";return t.jsx("div",{className:"p-2 rounded-lg border cursor-pointer transition-all "+(a?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>{return e=s.id,r&&r(e),void h(!1);var e},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-sm",children:s.name}),t.jsx("div",{className:"text-xs text-gray-600 flex items-center gap-2",children:t.jsx("span",{className:"font-mono",children:s.sku})}),Object.entries(s.attributes).length>0&&t.jsx("div",{className:"mt-2",children:t.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(s.attributes).map(([e,s])=>t.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${(e=>{const t=e.toLowerCase();return t.includes("ram")?"bg-green-100 text-green-700":t.includes("storage")||t.includes("memory")?"bg-blue-100 text-blue-700":t.includes("processor")||t.includes("cpu")?"bg-purple-100 text-purple-700":t.includes("screen")||t.includes("display")?"bg-orange-100 text-orange-700":t.includes("battery")?"bg-teal-100 text-teal-700":t.includes("camera")?"bg-pink-100 text-pink-700":t.includes("color")?"bg-red-100 text-red-700":t.includes("size")?"bg-gray-100 text-gray-700":"bg-indigo-100 text-indigo-700"})(e)}`,children:[e.replace(/_/g," "),": ",s]},e))})})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-bold text-sm",children:tt.money(s.sellingPrice)}),t.jsxs("div",{className:"text-xs "+("out-of-stock"===l?"text-red-600":"low"===l?"text-orange-600":"text-green-600"),children:["Stock: ",s.quantity]})]})]})},s.id)})})]}),l&&t.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("h4",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[t.jsx(se,{className:"w-4 h-4 text-blue-600"}),"Product Tags"]}),t.jsx("button",{onClick:()=>{v(),b(!p)},className:"text-xs px-2 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:p?"Cancel":"+ Add Tag"})]}),e.tags&&e.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:e.tags.map((s,a)=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 rounded-full text-xs font-medium border border-blue-200 hover:shadow-sm transition-all",children:[t.jsx(se,{className:"w-3 h-3"}),s,t.jsx("button",{onClick:()=>(t=>{if(l){const s=e.tags||[];l(s.filter(e=>e!==t)),v()}})(s),className:"ml-1 hover:bg-blue-200 rounded-full p-0.5 transition-colors",children:t.jsx(te,{className:"w-3 h-3"})})]},a))}),p&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:f,onChange:e=>y(e.target.value),onKeyPress:e=>"Enter"===e.key&&k(),placeholder:"Enter tag name...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),t.jsx("button",{onClick:k,disabled:!f.trim(),className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:"Add"})]}),(!e.tags||0===e.tags.length)&&!p&&t.jsx("p",{className:"text-xs text-gray-500 italic",children:"No tags added yet"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantity:"}),c?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"number",min:"1",max:w,value:u,onChange:e=>{const t=parseInt(e.target.value)||0;x(t)},className:"w-20 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),t.jsx("button",{onClick:()=>{C(u),m(!1)},disabled:u<=0||u>w,className:"inline-flex items-center justify-center w-8 h-8 text-sm font-medium text-white bg-green-600 border border-transparent rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"âœ“"}),t.jsx("button",{onClick:()=>{x(e.quantity),m(!1)},className:"inline-flex items-center justify-center w-8 h-8 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"âœ•"})]}):t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>{v(),C(e.quantity-1)},disabled:e.quantity<=1,className:"inline-flex items-center justify-center w-10 h-10 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(ae,{className:"w-4 h-4"})}),t.jsx("span",{className:"w-16 text-center font-semibold text-lg cursor-pointer hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-200",onClick:()=>{v(),m(!0)},children:e.quantity}),t.jsx("button",{onClick:()=>{v(),C(e.quantity+1)},disabled:e.quantity>=w,className:"inline-flex items-center justify-center w-10 h-10 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(re,{className:"w-4 h-4"})})]})]}),t.jsxs("button",{onClick:()=>{j(),a()},className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200",children:[t.jsx(U,{className:"w-4 h-4"}),"Remove"]})]}),"insufficient"===S&&t.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsxs("div",{className:"text-sm text-red-800",children:[t.jsx("strong",{children:"Warning:"})," Requested quantity (",e.quantity,") exceeds available stock (",w,")"]})})]})},Lt=({cartItems:e,selectedCustomer:s,onRemoveCustomer:a,onShowCustomerSearch:r,onShowCustomerDetails:l,onUpdateCartItemQuantity:n,onRemoveCartItem:i,onUpdateCartItemTags:d,onApplyDiscount:c,onProcessPayment:m,onShowInstallmentModal:u,onShowTradeInModal:x,onShowDiscountModal:g,onClearDiscount:h,dynamicPricingEnabled:p=!1,totalAmount:b,discountAmount:f,discountPercentage:y=0,taxAmount:v,taxRate:j,finalAmount:N,onEditCustomer:w,isTaxEnabled:S=!0})=>{const C=e.reduce((e,t)=>e+t.quantity,0),{playClickSound:k,playPaymentSound:_,playDeleteSound:P}=We();return t.jsx("div",{className:"lg:w-[450px] flex-shrink-0 pos-cart-section",children:t.jsxs(o,{className:"p-6 h-full flex flex-col",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6 flex-shrink-0",children:[t.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:t.jsx(ne,{className:"w-6 h-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Shopping Cart"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[e.length," items in cart"]})]})]}),t.jsx("div",{className:"mb-6",children:s?t.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border-2 border-blue-200 hover:border-blue-300 hover:shadow-md transition-all duration-300 animate-in fade-in slide-in-from-top-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"relative group",children:[t.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-base shadow-sm group-hover:scale-110 transition-transform duration-300",children:s.name.charAt(0)}),t.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full border-2 border-white flex items-center justify-center shadow-sm animate-bounce "+("vip"===s.colorTag||"vip"===s.loyaltyLevel||"premium"===s.loyaltyLevel?"bg-amber-500":"bg-emerald-500"),children:t.jsx(ie,{className:"w-3 h-3 text-white"})})]}),t.jsxs("div",{children:[t.jsx("div",{className:"font-bold text-gray-900",children:s.name}),t.jsxs("div",{className:"text-sm text-gray-700 flex items-center gap-2 mt-0.5",children:[t.jsx(oe,{className:"w-3.5 h-3.5"}),s.phone]}),t.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold transition-all duration-300 hover:scale-105 "+("vip"===s.colorTag||"vip"===s.loyaltyLevel||"premium"===s.loyaltyLevel?"bg-amber-100 text-amber-800 border-2 border-amber-300 hover:bg-amber-200":"bg-emerald-100 text-emerald-800 border-2 border-emerald-300 hover:bg-emerald-200"),children:"vip"===s.colorTag||"vip"===s.loyaltyLevel||"premium"===s.loyaltyLevel?"VIP":"Active"}),t.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-semibold text-gray-800 bg-white px-3 py-1 rounded-full border-2 border-gray-200 shadow-sm hover:scale-105 hover:border-blue-300 transition-all duration-300",children:[t.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),s.points," points"]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>{k(),l(s)},className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-all duration-200 hover:scale-110 active:scale-95",title:"View customer details",children:t.jsx(de,{className:"w-5 h-5"})}),w&&t.jsx("button",{onClick:()=>{k(),w(s)},className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-all duration-200 hover:scale-110 active:scale-95",title:"Edit customer information",children:t.jsx(ce,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>{P(),a()},className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-all duration-200 hover:scale-110 active:scale-95 hover:rotate-6",children:t.jsx(me,{className:"w-5 h-5"})})]})]})}):t.jsx("div",{className:"space-y-3",children:t.jsxs("button",{onClick:()=>{k(),r()},className:"w-full flex items-center justify-center gap-3 p-4 text-base border-2 border-blue-200 rounded-xl bg-white text-gray-900 hover:border-blue-300 hover:shadow-lg transition-all duration-200",children:[t.jsx(K,{className:"w-5 h-5 text-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"Search Customer"}),t.jsx(re,{className:"w-4 h-4 text-blue-500"})]})})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(ne,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cart is empty"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Add products to start a transaction"})]}):t.jsxs(t.Fragment,{children:[p&&t.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-800",children:[t.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Dynamic pricing is active"]})}),t.jsx("div",{className:"space-y-3 mb-6",children:e.map(e=>t.jsx(At,{item:e,onQuantityChange:t=>n(e.id,t),onRemove:()=>i(e.id),onTagsChange:d?t=>d(e.id,t):void 0,variant:"compact"},e.id))})]})}),e.length>0&&t.jsxs("div",{className:"flex-shrink-0 border-t-2 border-gray-300 pt-4 space-y-3",children:[t.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50 border-2 border-gray-200 rounded-xl p-4 space-y-3 shadow-sm",children:[t.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[t.jsx("span",{className:"text-base font-bold text-gray-900",children:"Quantity:"}),t.jsx("span",{className:"text-lg font-extrabold text-gray-900",children:C})]}),t.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[t.jsxs("span",{className:"text-base font-bold text-gray-900",children:["Subtotal (",C," ",1===C?"item":"items","):"]}),t.jsxs("span",{className:"text-lg font-extrabold text-gray-900",children:["TZS ",b.toLocaleString()]})]}),t.jsx("div",{className:"space-y-2",children:f>0?t.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-100 border-2 border-green-300 rounded-lg shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-green-200 rounded-lg",children:t.jsx(ue,{className:"w-5 h-5 text-green-700"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm font-extrabold text-green-900",children:["Discount Applied ",y>0&&`(${y}%)`]}),t.jsxs("div",{className:"text-sm font-bold text-green-700",children:["-TZS ",f.toLocaleString()]})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>{k(),g()},className:"p-2 text-green-700 hover:text-green-800 hover:bg-green-200 rounded-lg transition-colors",title:"Edit Discount",children:t.jsx(ce,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>{P(),h()},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-100 rounded-lg transition-colors",title:"Remove Discount",children:t.jsx(me,{className:"w-5 h-5"})})]})]}):t.jsxs("button",{onClick:()=>{k(),g()},className:"w-full flex items-center justify-center gap-2 p-4 border-3 border-dashed border-purple-300 rounded-xl text-purple-700 hover:border-purple-500 hover:text-purple-800 hover:bg-purple-100 transition-all duration-200 group shadow-sm bg-purple-50",children:[t.jsx("div",{className:"p-1.5 bg-purple-200 group-hover:bg-purple-300 rounded-lg transition-colors",children:t.jsx(ue,{className:"w-5 h-5"})}),t.jsx("span",{className:"text-base font-extrabold",children:"Add Discount"})]})}),S&&t.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[t.jsxs("span",{className:"text-base font-bold text-gray-900",children:["Tax (VAT ",j,"%):"]}),t.jsxs("span",{className:"text-lg font-extrabold text-gray-900",children:["TZS ",v.toLocaleString()]})]}),t.jsxs("div",{className:"flex justify-between items-center bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 rounded-lg p-3 shadow-md",children:[t.jsx("span",{className:"text-xl font-extrabold text-gray-900",children:"Total:"}),t.jsxs("span",{className:"text-2xl font-black text-green-600",children:["TZS ",N.toLocaleString()]})]})]}),!s&&t.jsx("div",{className:"p-4 bg-gradient-to-r from-amber-100 to-orange-100 border-3 border-amber-400 rounded-xl shadow-md",children:t.jsxs("div",{className:"flex items-center gap-3 text-base text-amber-900",children:[t.jsx("div",{className:"w-3 h-3 bg-amber-600 rounded-full animate-pulse"}),t.jsx("span",{className:"font-extrabold",children:"Please select a customer to proceed"})]})}),u&&t.jsxs("button",{onClick:()=>{k(),u()},disabled:0===e.length||!s,className:"w-full bg-purple-500 hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-2",title:s?0===e.length?"Add items to cart first":"Create installment plan":"Please select a customer first",children:[t.jsx(R,{className:"w-5 h-5"}),"Installment Plan"]}),x&&t.jsxs("button",{onClick:()=>{k(),x()},disabled:0===e.length||!s,className:"w-full bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-2",title:s?0===e.length?"Add items to cart first":"Add trade-in device":"Please select a customer first",children:[t.jsx(xe,{className:"w-5 h-5"}),"Add Trade-In"]}),t.jsx("button",{onClick:()=>{_(),m()},disabled:0===e.length||!s,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 shadow-lg hover:shadow-xl",title:s?0===e.length?"Add items to cart first":"Process payment":"Please select a customer first",children:"Process Payment"})]})]})})},Ft=({isOpen:e,onClose:s,onProductAdded:a})=>{const[r,l]=_.useState({name:"",sku:"",price:0,quantity:1,category:"",barcode:"",notes:"",supplierName:"",supplierPhone:"",purchaseDate:"",purchasePrice:0,purchaseQuantity:1,warrantyInfo:"",returnPolicy:"",productCondition:"new"}),[n,i]=_.useState(!1),[o,m]=_.useState(!1),[u,x]=_.useState(!1),[g,h]=_.useState([]),[p,b]=_.useState(!1);_.useEffect(()=>{(async()=>{if(e){b(!0);try{const e=await c();h(e);const t=(new Date).toISOString().split("T")[0],s=Date.now().toString().slice(-6),a=`EXT-${s}-${Math.random().toString(36).substring(2,5).toUpperCase()}`;l(e=>({...e,purchaseDate:t,sku:a}))}catch(t){}finally{b(!1)}}})()},[e]);const f=(e,t)=>{l(s=>({...s,[e]:t}))},y=[].filter(e=>e.name.toLowerCase().includes(r.supplierName.toLowerCase())||e.phone.includes(r.supplierName));return e?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed bg-black/60",onClick:s,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),t.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:t.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-orange-500 rounded-lg",children:t.jsx(Y,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Add External Product"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Quick entry for products not in inventory"})]})]}),t.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(te,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:async e=>{var t,s,n,o,c,u,g,h,p;if(e.preventDefault(),r.name.trim())if(r.sku.trim())if(r.price<=0)alert("Please enter a valid price greater than 0");else if(r.quantity<=0)alert("Please enter a valid quantity greater than 0");else if(r.supplierName.trim())if(r.purchasePrice<=0)alert("Please enter a valid purchase price greater than 0");else if(r.purchaseQuantity<=0)alert("Please enter a valid purchase quantity greater than 0");else{i(!0);try{const e={name:r.name.trim(),sku:r.sku.trim(),category:r.category.trim()||null,barcode:(null==(t=r.barcode)?void 0:t.trim())||null,supplier_name:r.supplierName.trim(),supplier_phone:(null==(s=r.supplierPhone)?void 0:s.trim())||null,purchase_date:r.purchaseDate,purchase_price:r.purchasePrice,purchase_quantity:r.purchaseQuantity,selling_price:r.price,warranty_info:(null==(n=r.warrantyInfo)?void 0:n.trim())||null,product_condition:r.productCondition,notes:(null==(o=r.notes)?void 0:o.trim())||null},i=(await(async e=>{try{const{data:t,error:s}=await d.from("lats_external_products").insert([e]).select().single();if(s)throw s;return t}catch(t){throw t}})(e),{name:r.name.trim(),sku:r.sku.trim(),price:r.price,quantity:r.quantity,category:r.category.trim(),barcode:(null==(c=r.barcode)?void 0:c.trim())||"",notes:(null==(u=r.notes)?void 0:u.trim())||"",supplierName:r.supplierName.trim(),supplierPhone:null==(g=r.supplierPhone)?void 0:g.trim(),purchaseDate:r.purchaseDate,purchasePrice:r.purchasePrice,purchaseQuantity:r.purchaseQuantity,warrantyInfo:null==(h=r.warrantyInfo)?void 0:h.trim(),returnPolicy:null==(p=r.returnPolicy)?void 0:p.trim(),productCondition:r.productCondition});a(i);const b=Date.now().toString().slice(-6),f=Math.random().toString(36).substring(2,5).toUpperCase();l({name:"",sku:`EXT-${b}-${f}`,price:0,quantity:1,category:"",barcode:"",notes:"",supplierName:"",supplierPhone:"",purchaseDate:(new Date).toISOString().split("T")[0],purchasePrice:0,purchaseQuantity:1,warrantyInfo:"",returnPolicy:"",productCondition:"new"}),m(!1),x(!1)}catch(b){alert("Failed to add external product. Please try again.")}finally{i(!1)}}else alert("Please enter a supplier name");else alert("Please enter a SKU or generate one");else alert("Please enter a product name")},className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product Name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:r.name,onChange:e=>f("name",e.target.value),className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",placeholder:"Enter product name",required:!0}),t.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["SKU/QrCode/Serial ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:r.sku,onChange:e=>f("sku",e.target.value),className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",placeholder:"Auto-generated SKU",required:!0}),t.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),t.jsx(it,{value:r.category,onChange:e=>{const t=g.find(t=>t.id===e);f("category",(null==t?void 0:t.name)||"")},categories:g,placeholder:"Select category",disabled:p,className:"w-full"})]})}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product Condition ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"new",label:"New",color:"bg-green-500 hover:bg-green-600 border-green-500"},{value:"used",label:"Used",color:"bg-blue-500 hover:bg-blue-600 border-blue-500"},{value:"refurbished",label:"Refurbished",color:"bg-purple-500 hover:bg-purple-600 border-purple-500"}].map(e=>t.jsx("button",{type:"button",onClick:()=>f("productCondition",e.value),className:"px-4 py-3 text-sm font-medium rounded-lg border-2 transition-all "+(r.productCondition===e.value?`${e.color} text-white`:"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:e.label},e.value))})]})]}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Supplier Name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:r.supplierName,onChange:e=>{f("supplierName",e.target.value),x(e.target.value.length>0)},onFocus:()=>x(r.supplierName.length>0),onBlur:()=>setTimeout(()=>x(!1),200),className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",placeholder:"Enter supplier name",required:!0}),t.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]}),u&&y.length>0&&t.jsxs("div",{className:"absolute z-50 w-full mt-2 bg-white border border-gray-300 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:[y.map(e=>t.jsxs("div",{onClick:()=>(e=>{l(t=>({...t,supplierName:e.name,supplierPhone:e.phone})),x(!1)})(e),className:"p-3 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors last:border-b-0",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.name}),t.jsx("div",{className:"text-sm text-gray-600",children:e.phone})]},e.id)),t.jsxs("button",{onClick:()=>{x(!1)},className:"w-full p-3 border-t border-gray-200 bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors flex items-center justify-center gap-2 font-medium",children:[t.jsx(he,{className:"w-4 h-4"}),"Create New Supplier"]})]})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Purchase Price (TZS) ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(nt,{value:r.purchasePrice,onChange:e=>f("purchasePrice",e),placeholder:"0",className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",required:!0}),t.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Purchase Quantity ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"number",min:"1",value:r.purchaseQuantity,onChange:e=>f("purchaseQuantity",parseInt(e.target.value)||1),className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",required:!0}),t.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Selling Price (TZS) ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(nt,{value:r.price,onChange:e=>f("price",e),placeholder:"0",className:"w-full py-3 pl-10 pr-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors",required:!0}),t.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warranty (Months)"}),t.jsx("div",{className:"grid grid-cols-4 gap-3",children:[0,3,6,12].map(e=>t.jsx("button",{type:"button",onClick:()=>f("warrantyInfo",0===e?"No warranty":`${e} months`),className:"px-4 py-3 text-sm font-medium rounded-lg border-2 transition-all "+(r.warrantyInfo===(0===e?"No warranty":`${e} months`)?"bg-orange-500 text-white border-orange-500":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:0===e?"None":`${e}m`},e))})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Additional Notes"}),t.jsx("button",{type:"button",onClick:()=>m(!o),className:"p-1.5 text-orange-600 hover:text-orange-800 hover:bg-orange-50 rounded transition-colors",children:t.jsx(re,{className:"w-4 h-4 transition-transform "+(o?"rotate-45":"")})})]}),o&&t.jsx("textarea",{value:r.notes,onChange:e=>f("notes",e.target.value),className:"w-full py-3 px-4 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:outline-none transition-colors resize-none",placeholder:"Any additional notes about the product or supplier",rows:3})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-red-50 border-2 border-orange-200 rounded-lg p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Order Summary"}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["TZS ",r.price.toLocaleString()]}),t.jsxs("div",{className:"text-xs text-gray-600 font-medium mt-1",children:["Profit: TZS ",((r.price-r.purchasePrice)*r.quantity).toLocaleString()]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsx("div",{className:"text-gray-600",children:t.jsx("span",{className:"font-medium text-gray-800",children:r.name||"Product name"})}),t.jsx("div",{className:"text-right text-gray-600",children:t.jsx("span",{className:"font-medium text-gray-800",children:r.supplierName||"Supplier"})}),t.jsx("div",{className:"text-gray-600",children:r.category||"No category"}),t.jsx("div",{className:"text-right",children:t.jsx("span",{className:"px-2 py-1 bg-white rounded text-xs font-medium capitalize text-gray-700",children:r.productCondition})})]})]}),t.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 mt-6 pt-6",children:[t.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white text-gray-700 border-2 border-gray-300 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:n||!r.name||!r.sku||r.price<=0,className:"flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg font-medium hover:from-orange-600 hover:to-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg",children:n?"Adding Product...":"Add to Cart"})]})]})]})})})]}):null},Ot=({subtotal:e,deliverySettings:s,onDeliveryFeeChange:a})=>{const[r,l]=_.useState(s.deliveryMethod||"standard"),[n,i]=_.useState(s.deliveryDistance||0),[o,d]=_.useState(""),c=_.useCallback((e,t,a)=>{if(!(null==s?void 0:s.enable_delivery))return 0;if(e>=s.free_delivery_threshold)return 0;let r=s.default_delivery_fee||2e3;switch(t){case"express":r*=1.5;break;case"same-day":r*=2;break;default:r*=1}if(a>0){r+=500*Math.ceil(a/5)}const l=(new Date).getHours();return l>=17&&l<=19?r*=1.2:(l>=22||l<=6)&&(r*=1.3),e>=5e4?r*=.8:e>=25e3&&(r*=.9),Math.round(r)},[s]);if(k.useEffect(()=>{const t=c(e,r,n);a(t)},[e,r,n,o,c,a]),!s.enable_delivery)return null;const m=c(e,r,n),u=e>=s.free_delivery_threshold;return t.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Delivery Options"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Method"}),t.jsxs("select",{value:r,onChange:e=>l(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"standard",children:"Standard (2-3 days)"}),t.jsx("option",{value:"express",children:"Express (1-2 days)"}),t.jsx("option",{value:"same-day",children:"Same Day"})]})]}),s.enable_delivery_areas&&s.delivery_areas&&s.delivery_areas.length>0&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Area"}),t.jsxs("select",{value:o,onChange:e=>d(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select area"}),s.delivery_areas.map(e=>{var a;return t.jsxs("option",{value:e,children:[e," (",(null==(a=s.area_delivery_fees)?void 0:a[e])||s.default_delivery_fee," TZS)"]},e)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Distance (km)"}),t.jsx("input",{type:"number",value:n,onChange:e=>i(Number(e.target.value)),min:"0",step:"0.5",className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter delivery distance"})]}),t.jsxs("div",{className:"bg-gray-50 rounded-md p-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Base Fee:"}),t.jsx("span",{className:"text-sm font-medium",children:o&&s.area_delivery_fees[o]?`${s.area_delivery_fees[o]} TZS (${o})`:`${s.default_delivery_fee} TZS (Default)`})]}),"standard"!==r&&t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:["express"===r?"Express Premium (+50%)":"Same Day Premium (+100%)",":"]}),t.jsxs("span",{className:"text-sm font-medium",children:["+","express"===r?Math.round(.5*s.default_delivery_fee):s.default_delivery_fee," TZS"]})]}),n>0&&t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Distance Fee:"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",500*Math.ceil(n/5)," TZS"]})]}),(()=>{const e=(new Date).getHours();return e>=17&&e<=19?t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Rush Hour Fee (+20%):"}),t.jsxs("span",{className:"text-sm font-medium text-orange-600",children:["+",Math.round(.2*m)," TZS"]})]}):e>=22||e<=6?t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Late Night Fee (+30%):"}),t.jsxs("span",{className:"text-sm font-medium text-orange-600",children:["+",Math.round(.3*m)," TZS"]})]}):null})(),e>=25e3&&t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:[e>=5e4?"Large Order Discount (-20%)":"Medium Order Discount (-10%)",":"]}),t.jsxs("span",{className:"text-sm font-medium text-green-600",children:["-",Math.round(m*(e>=5e4?.2:.1))," TZS"]})]}),t.jsx("div",{className:"border-t border-gray-200 mt-2 pt-2",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-base font-semibold text-gray-800",children:"Total Delivery Fee:"}),t.jsx("span",{className:"text-base font-bold text-blue-600",children:u?"FREE":`${m} TZS`})]})})]}),u&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:t.jsx("div",{className:"flex items-center",children:t.jsxs("span",{className:"text-green-600 font-medium",children:["ðŸŽ‰ Free delivery! Order value exceeds ",s.free_delivery_threshold," TZS"]})})})]})]})},$t=({isOpen:e,onClose:a,onDeliverySet:r,selectedCustomer:l,deliverySettings:n,subtotal:i=0})=>{var d;const[c,m]=_.useState({customerName:(null==l?void 0:l.name)||"",customerPhone:(null==l?void 0:l.phone)||"",deliveryAddress:"",deliveryDate:"",deliveryTime:"",deliveryNotes:"",deliveryFee:0,deliveryMethod:"standard",deliveryArea:"",deliveryDistance:0});k.useEffect(()=>{l&&m(e=>({...e,customerName:l.name,customerPhone:l.phone}))},[l]);const[u,x]=_.useState(!1),g=(e,t)=>{m(s=>({...s,[e]:t}))},h=[{id:"standard",name:"Standard Delivery",time:"2-3 business days",fee:500},{id:"express",name:"Express Delivery",time:"1-2 business days",fee:1e3},{id:"same-day",name:"Same Day Delivery",time:"Same day",fee:2e3}];return e?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:t.jsx(o,{className:"max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl",children:t.jsx(be,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Delivery Setup"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Configure delivery options for this order"})]})]}),t.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(te,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:async e=>{e.preventDefault(),x(!0);try{await new Promise(e=>setTimeout(e,1e3)),r(c)}catch(t){}finally{x(!1)}},className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[t.jsx(de,{className:"w-4 h-4"}),"Customer Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Name"}),t.jsx("input",{type:"text",value:c.customerName,onChange:e=>g("customerName",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Enter customer name",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),t.jsx("input",{type:"tel",value:c.customerPhone,onChange:e=>g("customerPhone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Enter phone number",required:!0})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[t.jsx(fe,{className:"w-4 h-4"}),"Delivery Address"]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Address"}),t.jsx("textarea",{value:c.deliveryAddress,onChange:e=>g("deliveryAddress",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Enter complete delivery address",rows:3,required:!0})]})]}),n&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[t.jsx(be,{className:"w-4 h-4"}),"Delivery Fee Calculator"]}),t.jsx(Ot,{subtotal:i,deliverySettings:n,onDeliveryFeeChange:e=>{g("deliveryFee",e)}})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[t.jsx(be,{className:"w-4 h-4"}),"Delivery Method"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:h.map(e=>t.jsxs("div",{className:"p-4 border rounded-lg cursor-pointer transition-all "+(c.deliveryMethod===e.id?"border-blue-500 bg-gradient-to-br from-blue-50 to-blue-100":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),onClick:()=>{g("deliveryMethod",e.id),g("deliveryFee",e.fee)},children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"font-medium text-gray-900",children:e.name}),c.deliveryMethod===e.id&&t.jsx(ye,{className:"w-4 h-4 text-blue-600"})]}),t.jsx("p",{className:"text-sm text-gray-600",children:e.time}),t.jsxs("p",{className:"text-sm font-medium text-blue-600",children:["TZS ",e.fee]})]},e.id))})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[t.jsx(ve,{className:"w-4 h-4"}),"Delivery Schedule"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Date"}),t.jsx("input",{type:"date",value:c.deliveryDate,onChange:e=>g("deliveryDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Time"}),t.jsxs("select",{value:c.deliveryTime,onChange:e=>g("deliveryTime",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0,children:[t.jsx("option",{value:"",children:"Select time"}),t.jsx("option",{value:"morning",children:"Morning (9 AM - 12 PM)"}),t.jsx("option",{value:"afternoon",children:"Afternoon (12 PM - 3 PM)"}),t.jsx("option",{value:"evening",children:"Evening (3 PM - 6 PM)"}),t.jsx("option",{value:"anytime",children:"Anytime"})]})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Notes"}),t.jsx("textarea",{value:c.deliveryNotes,onChange:e=>g("deliveryNotes",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Any special instructions for delivery...",rows:2})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Delivery Summary"}),t.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Delivery Method:"}),t.jsx("span",{className:"font-medium",children:null==(d=h.find(e=>e.id===c.deliveryMethod))?void 0:d.name})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Delivery Fee:"}),t.jsxs("span",{className:"font-medium text-green-600",children:["TZS ",c.deliveryFee]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Delivery Date:"}),t.jsx("span",{className:"font-medium",children:c.deliveryDate||"Not set"})]})]})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx(s,{type:"button",onClick:a,variant:"secondary",className:"flex-1",children:"Cancel"}),t.jsx(s,{type:"submit",disabled:u,className:"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:u?"Setting Delivery...":"Set Delivery"})]})]})]})})}):null},Mt=({isOpen:e,onClose:s,onCustomerSelect:a,selectedCustomer:r})=>{const[l,n]=_.useState(""),[i,o]=_.useState([]),[d,c]=_.useState(!1),[u,x]=_.useState(null),[g,h]=_.useState([]),[p,b]=_.useState(!1),[f,y]=_.useState(!1),{playClickSound:v}=We();_.useEffect(()=>{e&&(y(!1),j())},[e]),_.useEffect(()=>{const e=setTimeout(()=>{l.trim()?N(l):o(g.slice(0,24))},300);return()=>clearTimeout(e)},[l,g]);const j=async()=>{try{c(!0);const e=ct.getCustomers();if(e&&e.length>0){h(e),o(e.slice(0,24)),c(!1),y(!0);return void(ct.getCacheAge()>3e5&&m().then(e=>{e&&Array.isArray(e)&&ct.saveCustomers(e)}).catch(()=>{}))}const t=await m();if(t&&Array.isArray(t)){h(t),o(t.slice(0,24)),ct.saveCustomers(t);t.filter(e=>e.name&&e.name.trim()),t.filter(e=>e.phone&&e.phone.trim())}else if(t&&t.customers&&Array.isArray(t.customers)){h(t.customers),ct.saveCustomers(t.customers),o(t.customers.slice(0,24));t.customers.filter(e=>e.name&&e.name.trim()),t.customers.filter(e=>e.phone&&e.phone.trim())}else h([]),o([])}catch(e){x("Failed to load customers. Please try again.");try{const e=await dt("",1,100);e&&e.customers&&Array.isArray(e.customers)?(h(e.customers),o(e.customers.slice(0,24))):(h([]),o([]))}catch(t){h([]),o([])}}finally{c(!1),y(!0)}},N=async e=>{try{c(!0),x(null);const t=await dt(e,1,200);t&&t.customers?o(t.customers.slice(0,24)):t&&Array.isArray(t)?o(t.slice(0,24)):x("Failed to search customers")}catch(t){x("Failed to search customers")}finally{c(!1)}},w=e=>{v(),a(e),s(),G.success(`âœ“ Customer selected: ${e.name}`,{icon:"ðŸ‘¤",duration:2e3,style:{background:"#10b981",color:"#fff",fontWeight:"bold"}})},S=()=>{b(!0)};return Xe(e),e?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed bg-black/50",onClick:s,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),t.jsxs("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:[t.jsxs("div",{className:"w-full max-w-5xl max-h-[95vh] overflow-hidden bg-white rounded-lg shadow-xl flex flex-col",onClick:e=>e.stopPropagation(),style:{pointerEvents:"auto"},children:[t.jsx("div",{className:"flex-shrink-0 p-6 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx(de,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Select Customer"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Search and select a customer for this sale"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:j,disabled:d,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",title:"Refresh customers",children:t.jsx(V,{className:"w-6 h-6 "+(d?"animate-spin":"")})}),t.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(te,{className:"w-6 h-6"})})]})]})}),t.jsx("div",{className:"flex-shrink-0 p-6 bg-gray-50 border-b border-gray-200",children:t.jsxs("div",{className:"relative",children:[t.jsx(K,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),t.jsx("input",{type:"text",placeholder:"Search by name, phone, email, city, or any field...",value:l,onChange:e=>n(e.target.value),className:"w-full pl-12 pr-10 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900 placeholder-gray-400",autoFocus:!0}),l&&t.jsx("button",{onClick:()=>n(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 hover:bg-gray-200 rounded transition-colors",children:t.jsx(te,{className:"w-4 h-4 text-gray-400"})})]})}),t.jsxs("div",{className:"relative flex-1 overflow-y-auto p-6",style:{minHeight:"500px",maxHeight:"calc(95vh - 200px)"},children:[d&&!f&&t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white z-20",children:[t.jsx("div",{className:"relative",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"})}),t.jsx("span",{className:"mt-4 text-gray-900 font-bold text-lg",children:"Loading Customers..."}),t.jsx("span",{className:"mt-1 text-gray-600 text-sm",children:"Please wait while we fetch your customer list"})]}),u&&t.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4 mb-4",children:t.jsx("p",{className:"text-red-600 font-medium",children:u})}),i.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsx("div",{className:"flex items-center justify-between mb-6",children:t.jsx("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-3",children:l?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(K,{className:"w-5 h-5 text-blue-600"})}),t.jsx("span",{children:"Search Results"}),t.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 text-sm font-semibold rounded-full",children:[i.length," found"]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:t.jsx(de,{className:"w-5 h-5 text-green-600"})}),t.jsx("span",{children:"All Customers"}),t.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 text-sm font-semibold rounded-full",children:[i.length," total"]})]})})}),t.jsx("div",{className:"grid grid-cols-3 gap-4 pb-4",children:i.map(e=>t.jsx(Rt,{customer:e,onSelect:w,isSelected:(null==r?void 0:r.id)===e.id,searchQuery:l},e.id))})]}),l&&!d&&0===i.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-6",children:t.jsx(de,{className:"w-10 h-10 text-gray-400"})}),t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:"No customers found"}),t.jsxs("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:["No customers match your search for ",t.jsxs("span",{className:"font-semibold text-blue-600",children:['"',l,'"']})]}),t.jsxs("button",{onClick:S,className:"inline-flex items-center gap-3 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[t.jsx(re,{className:"w-5 h-5"}),"Create New Customer"]})]}),!l&&!d&&0===i.length&&f&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-6",children:t.jsx(de,{className:"w-10 h-10 text-blue-600"})}),t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:"No customers yet"}),t.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"You haven't added any customers to your system yet. Create your first customer to get started!"}),t.jsxs("button",{onClick:S,className:"inline-flex items-center gap-3 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[t.jsx(re,{className:"w-5 h-5"}),"Create Your First Customer"]})]})]}),t.jsx("div",{className:"flex-shrink-0 p-6 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-3",children:r?t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-semibold text-sm",children:r.name.charAt(0).toUpperCase()}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Selected:"}),t.jsx("span",{className:"ml-2 font-medium text-gray-900",children:r.name})]})]}):t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center",children:t.jsx(de,{className:"w-4 h-4 text-gray-500"})}),t.jsx("span",{className:"text-sm text-gray-600",children:"No customer selected"})]})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:s,className:"px-6 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:S,className:"inline-flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors",children:[t.jsx(re,{className:"w-4 h-4"}),"New Customer"]})]})]})})]}),t.jsx(ot,{isOpen:p,onClose:()=>b(!1),onCustomerCreated:e=>{h(t=>[e,...t.slice(0,4)]),v(),a(e),b(!1)},onAddAnother:()=>{b(!0)}})]})]}):null},Rt=({customer:e,onSelect:s,isSelected:a,searchQuery:r})=>{const l=(e,s)=>{if(!s||!e)return e;const a=new RegExp(`(${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.split(a).map((e,s)=>a.test(e)?t.jsx("mark",{className:"bg-yellow-200 px-1 rounded font-semibold",children:e},s):e)};return t.jsxs("div",{onClick:()=>s(e),className:"relative bg-white border-2 rounded-lg cursor-pointer transition-all duration-200 transform hover:-translate-y-1 "+(a?"border-blue-500 bg-blue-50 shadow-lg scale-105":"border-gray-200 hover:border-blue-300 hover:shadow-lg"),children:[a&&t.jsx("div",{className:"absolute top-2 right-2 w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-700 font-semibold text-sm group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors duration-200",children:e.name.charAt(0).toUpperCase()}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-semibold text-gray-900 truncate text-sm hover:text-blue-600 transition-colors",children:l(e.name,r||"")}),e.phone&&t.jsx("p",{className:"text-xs text-blue-600 font-medium truncate",children:l(e.phone,r||"")})]}),t.jsxs("div",{className:"flex items-center gap-1 transition-transform duration-200 hover:scale-110",children:[(e=>{switch(null==e?void 0:e.toLowerCase()){case"vip":return t.jsx(Ne,{className:"w-4 h-4 text-purple-500 fill-current"});case"premium":return t.jsx(Ne,{className:"w-4 h-4 text-yellow-500 fill-current"});case"regular":return t.jsx(Ne,{className:"w-4 h-4 text-blue-500 fill-current"});case"active":return t.jsx(Ne,{className:"w-4 h-4 text-green-500 fill-current"});case"payment_customer":return t.jsx(Ne,{className:"w-4 h-4 text-teal-500 fill-current"});case"engaged":return t.jsx(Ne,{className:"w-4 h-4 text-indigo-500 fill-current"});case"interested":return t.jsx(Ne,{className:"w-4 h-4 text-gray-400 fill-current"});default:return null}})(e.loyaltyLevel),t.jsx("span",{className:"text-xs text-gray-500 font-medium",children:e.loyaltyLevel||"interested"})]})]}),t.jsxs("div",{className:"space-y-1 mb-3",children:[e.email&&t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(je,{className:"w-3 h-3 text-gray-400"}),t.jsx("span",{className:"truncate",children:l(e.email,r||"")})]}),e.city&&t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx("span",{className:"w-3 h-3 text-gray-400",children:"ðŸ“"}),t.jsx("span",{className:"truncate",children:l(e.city,r||"")})]})]}),t.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-1 hover:scale-105 transition-transform",children:[t.jsx(Ne,{className:"w-3 h-3 text-gray-400"}),t.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:[e.points||0," pts"]})]}),t.jsx("div",{className:"text-xs font-bold text-gray-900 hover:text-blue-600 transition-colors",children:(e=>{const t=e||0,s=Math.abs(t)>1e12;if(!isFinite(t))return"TZS 0 âš ï¸ INVALID";const a=new Intl.NumberFormat("en-US",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);return s?`${a} âš ï¸`:a})(e.totalSpent||0)})]})]})]})},Ut=({value:e,onChange:s,placeholder:a="Search customers by name, phone, or email...",className:r="",disabled:l=!1})=>{const[n,i]=_.useState(""),[o,d]=_.useState([]),[c,m]=_.useState(!1),[u,x]=_.useState(!1),[g,h]=_.useState(-1),p=_.useRef(null),b=_.useRef(null);_.useEffect(()=>{const e=setTimeout(()=>{n.trim()?f(n):(d([]),m(!1))},300);return()=>clearTimeout(e)},[n]),_.useEffect(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&(m(!1),h(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const f=async e=>{try{x(!0);const t=await dt(e,1,20);if(t&&t.customers){const s=t.customers.map(t=>({customer:t,relevance:y(t,e),matchType:"partial"}));s.sort((e,t)=>t.relevance-e.relevance),d(s),m(!0)}else d([]),m(!1)}catch(t){G.error("Failed to search customers"),d([]),m(!1)}finally{x(!1)}},y=(e,t)=>{const s=t.toLowerCase();let a=0;return e.name.toLowerCase().includes(s)&&(a+=10,e.name.toLowerCase()===s&&(a+=5)),e.phone&&e.phone.includes(s)&&(a+=8),e.email&&e.email.toLowerCase().includes(s)&&(a+=6),a},v=e=>{const t=e.name;s(t),i(t),m(!1),h(-1),G.success(`Selected: ${e.name}`)};return t.jsxs("div",{ref:p,className:`relative ${r}`,children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{ref:b,type:"text",value:n||e,onChange:e=>{const t=e.target.value;i(t),s(t),h(-1)},onKeyDown:e=>{if(c)switch(e.key){case"ArrowDown":e.preventDefault(),h(e=>e<o.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),h(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),g>=0&&g<o.length&&v(o[g].customer);break;case"Escape":m(!1),h(-1)}},onFocus:()=>{o.length>0&&m(!0)},placeholder:a,disabled:l,className:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"}),t.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:n||e?t.jsx("button",{type:"button",onClick:()=>{var e;i(""),s(""),d([]),m(!1),h(-1),null==(e=b.current)||e.focus()},className:"p-0.5 hover:bg-gray-100 rounded transition-colors",title:"Clear",children:t.jsx(te,{className:"w-3 h-3 text-gray-400"})}):t.jsx(K,{className:"w-3 h-3 text-gray-400"})})]}),c&&t.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto",children:u?t.jsxs("div",{className:"px-3 py-2 text-sm text-gray-500 flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Searching..."]}):o.length>0?o.map((e,s)=>{return t.jsxs("div",{className:"px-3 py-2 cursor-pointer flex items-center gap-3 hover:bg-gray-50 transition-colors "+(s===g?"bg-blue-50":""),onClick:()=>v(e.customer),children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm flex-shrink-0",children:e.customer.name.charAt(0).toUpperCase()}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:e.customer.name}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.customer.phone&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(oe,{className:"w-3 h-3"}),t.jsx("span",{children:(a=e.customer.phone,a.replace(/(\d{3})(\d{3})(\d{4})/,"$1 $2 $3"))})]}),e.customer.email&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(je,{className:"w-3 h-3"}),t.jsx("span",{className:"truncate",children:e.customer.email})]})]})]}),s===g&&t.jsx(we,{className:"w-4 h-4 text-blue-500 flex-shrink-0"})]},e.customer.id);var a}):n?t.jsxs("div",{className:"px-3 py-2 text-sm text-gray-500",children:['No customers found for "',n,'"']}):null})]})},zt=({isOpen:e,onClose:s,customer:a,onCustomerUpdated:r})=>{const[l,n]=_.useState({name:"",phone:"",whatsapp:"",gender:"other",city:"",loyaltyLevel:"interested",colorTag:"new",referredBy:"",birthMonth:"",birthDay:"",notes:"",isActive:!0,whatsappOptOut:!1}),[i,o]=_.useState(!1),[d,c]=_.useState(!1),[m,x]=_.useState(!1),[g,h]=_.useState(!1),[p,b]=_.useState(!1);Xe(e),_.useEffect(()=>{if(a){const e={name:a.name||"",phone:a.phone||"",whatsapp:a.whatsapp||"",gender:a.gender||"other",city:a.city||"",loyaltyLevel:a.loyaltyLevel||"bronze",colorTag:a.colorTag||"new",referredBy:a.referredBy||"",birthMonth:a.birthMonth||"",birthDay:a.birthDay||"",notes:a.notes?Array.isArray(a.notes)?a.notes.join("\n"):a.notes:"",isActive:!1!==a.isActive,whatsappOptOut:a.whatsappOptOut||!1};n(e),c(!1)}},[a]),_.useEffect(()=>{if(a){const e=l.name!==(a.name||"")||l.phone!==(a.phone||"")||l.whatsapp!==(a.whatsapp||"")||l.gender!==(a.gender||"other")||l.city!==(a.city||"")||l.loyaltyLevel!==(a.loyaltyLevel||"bronze")||l.colorTag!==(a.colorTag||"new")||l.referredBy!==(a.referredBy||"")||l.birthMonth!==(a.birthMonth||"")||l.birthDay!==(a.birthDay||"")||l.notes!==(a.notes?Array.isArray(a.notes)?a.notes.join("\n"):a.notes:"")||l.isActive!==(!1!==a.isActive)||l.whatsappOptOut!==(a.whatsappOptOut||!1);c(e)}},[l,a]),_.useEffect(()=>{const e=e=>{const t=e.target;m&&!t.closest("[data-region-dropdown]")&&x(!1),g&&!t.closest("[data-month-dropdown]")&&h(!1),p&&!t.closest("[data-day-dropdown]")&&b(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[m,g,p]);const f=(e,t)=>{n(s=>({...s,[e]:t}))},y=async e=>{if(e.preventDefault(),a&&d){o(!0);try{const e={name:l.name.trim(),phone:l.phone.trim(),whatsapp:l.whatsapp.trim(),gender:l.gender,city:l.city.trim(),loyaltyLevel:l.loyaltyLevel,colorTag:l.colorTag,referredBy:l.referredBy.trim(),birthMonth:l.birthMonth.trim(),birthDay:l.birthDay.trim(),isActive:l.isActive,whatsappOptOut:l.whatsappOptOut};l.notes.trim()&&(e.notes=l.notes.trim().split("\n").filter(e=>e.trim())),await u(a.id,e);const t={...a,...e};r(t),G.success("Customer information updated successfully!"),s()}catch(t){G.error("Failed to update customer information")}finally{o(!1)}}else s()},v=()=>{if(d){if(!window.confirm("You have unsaved changes. Are you sure you want to close?"))return}s()},j=e=>!e||""===e.trim(),N=(()=>{if(!a)return[];const e=[];return j(a.whatsapp)&&e.push("WhatsApp"),j(a.city)&&e.push("City"),j(a.birthMonth)&&e.push("Birth Month"),j(a.birthDay)&&e.push("Birth Day"),e})(),w=["Dar es Salaam","Arusha","Mwanza","Dodoma","Mbeya","Tanga","Morogoro","Iringa","Tabora","Kigoma","Mara","Kagera","Shinyanga","Singida","Rukwa","Ruvuma","Lindi","Mtwara","Pwani","Manyara","Geita","Simiyu","Katavi","Njombe","Songwe"],S=["January","February","March","April","May","June","July","August","September","October","November","December"],C=_.useMemo(()=>w.filter(e=>e.toLowerCase().includes(l.city.toLowerCase())),[l.city]),k=Array.from({length:31},(e,t)=>(t+1).toString()),P=_.useMemo(()=>S.filter(e=>e.toLowerCase().includes(l.birthMonth.toLowerCase())||""===l.birthMonth),[l.birthMonth]),D=_.useMemo(()=>k.filter(e=>e.includes(l.birthDay)||""===l.birthDay),[l.birthDay]);return e&&a?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed bg-black/60",onClick:v,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),t.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),style:{pointerEvents:"auto"},children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:t.jsx(de,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Customer"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Update customer information"})]})]}),t.jsx("button",{onClick:v,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(te,{className:"w-5 h-5 text-gray-500"})})]}),t.jsx("form",{onSubmit:y,className:"p-6 overflow-y-auto max-h-[calc(90vh-180px)]",children:t.jsxs("div",{className:"space-y-6",children:[N.length>0&&t.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-300 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Se,{className:"w-5 h-5 text-orange-600"}),t.jsx("h3",{className:"font-semibold text-orange-800",children:"Missing Information"})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:N.map((e,s)=>t.jsx("span",{className:"px-3 py-1.5 bg-white text-orange-700 text-sm font-medium rounded-lg border border-orange-300 shadow-sm",children:e},s))})]}),t.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-5",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(de,{className:"w-5 h-5 text-blue-600"}),"Basic Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Full Name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:l.name,onChange:e=>f("name",e.target.value),className:"w-full px-4 py-3 pl-11 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-colors",placeholder:"Enter full name",required:!0}),t.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Phone Number ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"tel",value:l.phone,onChange:e=>f("phone",e.target.value),className:"w-full px-4 py-3 pl-11 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-colors",placeholder:"+255 123 456 789",required:!0}),t.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:["WhatsApp Number",j(null==a?void 0:a.whatsapp)&&t.jsx(Se,{className:"w-4 h-4 text-orange-500"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"tel",value:l.whatsapp,onChange:e=>f("whatsapp",e.target.value),className:"w-full px-4 py-3 pl-11 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-colors",placeholder:"+255 123 456 789"}),t.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Gender ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("div",{className:"flex gap-3",children:[{value:"male",label:"Male",icon:"ðŸ‘¨",color:"bg-blue-600 text-white border-blue-600 shadow-lg",hoverColor:"hover:bg-gray-50 hover:border-gray-400 hover:shadow-md"},{value:"female",label:"Female",icon:"ðŸ‘©",color:"bg-pink-600 text-white border-pink-600 shadow-lg",hoverColor:"hover:bg-gray-50 hover:border-gray-400 hover:shadow-md"}].map(e=>{const s=l.gender===e.value;return t.jsxs("button",{type:"button",onClick:()=>f("gender",e.value),className:`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-lg border-2 text-sm font-medium transition-all duration-200 cursor-pointer\n                            ${s?e.color:`bg-white text-gray-700 border-gray-300 ${e.hoverColor}`}\n                            focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-opacity-50 h-[52px]`,children:[t.jsx("span",{className:"text-xl",children:e.icon}),t.jsx("span",{children:e.label}),s&&t.jsx(we,{className:"w-4 h-4 ml-1"})]},e.value)})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Region",j(null==a?void 0:a.city)&&t.jsx(Se,{className:"w-4 h-4 text-orange-500"})]}),t.jsxs("div",{className:"relative","data-region-dropdown":!0,children:[t.jsx("input",{type:"text",value:l.city,onChange:e=>f("city",e.target.value),onFocus:()=>x(!0),onBlur:()=>setTimeout(()=>x(!1),200),className:"w-full min-h-[48px] py-3 pl-11 pr-10 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-colors",placeholder:"Type or select region",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),t.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),t.jsx(ke,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),m&&t.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto",children:[C.map(e=>t.jsx("div",{className:"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors",onClick:()=>{f("city",e),x(!1)},children:e},e)),0===C.length&&t.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:"No matching regions found"})]})]})]})]})]}),t.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-5",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(ie,{className:"w-5 h-5 text-purple-600"}),"Customer Status"]}),t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Loyalty Level"}),t.jsx("div",{className:"flex flex-wrap gap-3",children:[{value:"interested",label:"Interested",color:"bg-white text-gray-700 border-gray-300 hover:border-gray-400",activeColor:"bg-gray-500 text-white border-gray-500"},{value:"engaged",label:"Engaged",color:"bg-white text-indigo-700 border-indigo-300 hover:border-indigo-400",activeColor:"bg-indigo-500 text-white border-indigo-500"},{value:"payment_customer",label:"Payment Customer",color:"bg-white text-teal-700 border-teal-300 hover:border-teal-400",activeColor:"bg-teal-500 text-white border-teal-500"},{value:"active",label:"Active",color:"bg-white text-green-700 border-green-300 hover:border-green-400",activeColor:"bg-green-500 text-white border-green-500"},{value:"regular",label:"Regular",color:"bg-white text-blue-700 border-blue-300 hover:border-blue-400",activeColor:"bg-blue-500 text-white border-blue-500"},{value:"premium",label:"Premium",color:"bg-white text-yellow-700 border-yellow-300 hover:border-yellow-400",activeColor:"bg-yellow-500 text-white border-yellow-500"},{value:"vip",label:"VIP",color:"bg-white text-purple-700 border-purple-300 hover:border-purple-400",activeColor:"bg-purple-500 text-white border-purple-500"}].map(e=>t.jsx("button",{type:"button",onClick:()=>f("loyaltyLevel",e.value),className:`px-4 py-2.5 text-sm font-medium rounded-lg border-2 transition-all ${l.loyaltyLevel===e.value?e.activeColor:e.color}`,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Customer Tag"}),t.jsx("div",{className:"flex flex-wrap gap-3",children:[{value:"new",label:"New",color:"bg-white text-green-700 border-green-300 hover:border-green-400",activeColor:"bg-green-500 text-white border-green-500"},{value:"regular",label:"Regular",color:"bg-white text-blue-700 border-blue-300 hover:border-blue-400",activeColor:"bg-blue-500 text-white border-blue-500"},{value:"premium",label:"Premium",color:"bg-white text-yellow-700 border-yellow-300 hover:border-yellow-400",activeColor:"bg-yellow-500 text-white border-yellow-500"},{value:"vip",label:"VIP",color:"bg-white text-purple-700 border-purple-300 hover:border-purple-400",activeColor:"bg-purple-500 text-white border-purple-500"}].map(e=>t.jsx("button",{type:"button",onClick:()=>f("colorTag",e.value),className:`px-4 py-2.5 text-sm font-medium rounded-lg border-2 transition-all ${l.colorTag===e.value?e.activeColor:e.color}`,children:e.label},e.value))})]})]})]}),t.jsxs("div",{className:"bg-purple-50 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(_e,{className:"w-5 h-5 text-purple-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Referred By Customer"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Link referrer to earn points"})]})]}),t.jsx("span",{className:"px-2 py-1 bg-purple-600 text-white text-xs font-medium rounded-full",children:"Bonus Points"})]}),t.jsx(Ut,{value:l.referredBy,onChange:e=>f("referredBy",e),placeholder:"Search for the referring customer...",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900"})]}),t.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-5",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(Pe,{className:"w-5 h-5 text-pink-600"}),"Birth Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Birth Month",j(null==a?void 0:a.birthMonth)&&t.jsx(Se,{className:"w-4 h-4 text-orange-500"})]}),t.jsxs("div",{className:"relative","data-month-dropdown":!0,children:[t.jsx("input",{type:"text",value:l.birthMonth,onChange:e=>f("birthMonth",e.target.value),onFocus:()=>h(!0),onBlur:()=>setTimeout(()=>h(!1),200),className:"w-full py-3 pl-11 pr-10 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-colors",placeholder:"Type or select month",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),t.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-xl pointer-events-none",children:"ðŸŽ‚"}),t.jsx(ke,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),g&&t.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto p-2",children:[P.map(e=>t.jsx("div",{className:"px-4 py-3 hover:bg-blue-50 cursor-pointer rounded transition-colors",onClick:()=>{f("birthMonth",e),h(!1)},children:e},e)),0===P.length&&t.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:"No matching months found"})]})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Birth Day",j(null==a?void 0:a.birthDay)&&t.jsx(Se,{className:"w-4 h-4 text-orange-500"})]}),t.jsxs("div",{className:"relative","data-day-dropdown":!0,children:[t.jsx("input",{type:"text",value:l.birthDay,onChange:e=>f("birthDay",e.target.value),onFocus:()=>b(!0),onBlur:()=>setTimeout(()=>b(!1),200),className:"w-full py-3 pl-11 pr-10 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-colors",placeholder:"Type or select day",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),t.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-xl pointer-events-none",children:"ðŸŽ‰"}),t.jsx(ke,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),p&&t.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto p-2",children:[t.jsx("div",{className:"grid grid-cols-7 gap-1",children:D.map(e=>t.jsx("div",{className:"px-2 py-2 hover:bg-blue-50 cursor-pointer rounded text-sm text-center transition-colors",onClick:()=>{f("birthDay",e),b(!1)},children:e},e))}),0===D.length&&t.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:"No matching days found"})]})]})]})]})]}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),t.jsx("textarea",{value:l.notes,onChange:e=>f("notes",e.target.value),rows:4,placeholder:"Add notes about this customer...",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900 resize-none"}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Optional: Add any important information or preferences about this customer"})]})})]})}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-white",children:[t.jsx("div",{className:"text-sm",children:d&&t.jsxs("span",{className:"flex items-center gap-2 text-orange-600 font-medium",children:[t.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),"Unsaved changes"]})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{type:"button",onClick:v,disabled:i,className:"px-6 py-3 text-sm font-medium bg-white text-gray-700 border-2 border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all disabled:opacity-50",children:"Cancel"}),t.jsxs("button",{type:"submit",onClick:y,disabled:!d||i,className:"px-6 py-3 text-sm font-medium bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-md hover:shadow-lg",children:[t.jsx(De,{className:"w-4 h-4"}),i?"Saving...":"Save Changes"]})]})]})]})})]}):null};const qt=new class{async getSalesAnalytics(e="7d"){try{const s=new Date,a=new Date;switch(e){case"1d":a.setDate(s.getDate()-1);break;case"7d":default:a.setDate(s.getDate()-7);break;case"30d":a.setDate(s.getDate()-30);break;case"90d":a.setDate(s.getDate()-90)}let r=[],l=null;try{const{data:e,error:t}=await d.from("lats_sales").select("\n            id,\n            sale_number,\n            customer_id,\n            customer_name,\n            customer_phone,\n            total_amount,\n            payment_method,\n            status,\n            created_by,\n            created_at\n          ").gte("created_at",a.toISOString()).lte("created_at",s.toISOString()).order("created_at",{ascending:!1});t?(r=[],l=t):(r=e||[],l=null)}catch(t){r=[],l=t}if(l)return null;if(!r||0===r.length)return this.getEmptyData();const n=this.processDailySales(r,a,s),i=this.processTopProducts(r),o=this.processPaymentMethods(r),c=this.processCustomerSegments(r);return{dailySales:n,topProducts:i,paymentMethods:o,customerSegments:c,metrics:this.calculateMetrics(r,n)}}catch(t){return null}}processDailySales(e,t,s){const a=new Map,r=new Date(t);for(;r<=s;){const e=r.toISOString().split("T")[0];a.set(e,{sales:0,transactions:0}),r.setDate(r.getDate()+1)}return e.forEach(e=>{const t=new Date(e.created_at).toISOString().split("T")[0],s=a.get(t)||{sales:0,transactions:0};s.sales+=e.total_amount||0,s.transactions+=1,a.set(t,s)}),Array.from(a.entries()).map(([e,t])=>({date:e,sales:t.sales,transactions:t.transactions}))}processTopProducts(e){const t=new Map;e.forEach(e=>{var s;null==(s=e.lats_sale_items)||s.forEach(e=>{let s="Unknown Product";e.product_name?s=e.product_name:e.sku?s=`Product (${e.sku})`:e.product_id?s=`Product ${e.product_id.slice(0,8)}`:e.variant_id&&(s=`Variant ${e.variant_id.slice(0,8)}`);const a=t.get(s)||{sales:0,quantity:0};a.sales+=e.total_price||0,a.quantity+=e.quantity||0,t.set(s,a)})});const s=Array.from(t.values()).reduce((e,t)=>e+t.sales,0),a=Array.from(t.entries()).map(([e,t])=>({name:e,sales:t.sales,quantity:t.quantity,percentage:s>0?Math.round(t.sales/s*100):0})).sort((e,t)=>t.sales-e.sales).slice(0,5);return 0===a.length?[]:a}processPaymentMethods(e){const t=new Map;e.forEach(e=>{const s=e.payment_method||"Unknown",a=t.get(s)||0;t.set(s,a+(e.total_amount||0))});const s=Array.from(t.values()).reduce((e,t)=>e+t,0),a=Array.from(t.entries()).map(([e,t])=>({method:e,amount:t,percentage:s>0?Math.round(t/s*100):0})).sort((e,t)=>t.amount-e.amount);return 0===a.length?[]:a}processCustomerSegments(e){const t=new Map;e.forEach(e=>{const s=e.customer_id||"walk-in",a=t.get(s)||{sales:0,transactions:0};a.sales+=e.total_amount||0,a.transactions+=1,t.set(s,a)});const s=Array.from(t.values()).reduce((e,t)=>e+t.sales,0),a={"VIP Customers":{sales:0,customers:0},"Regular Customers":{sales:0,customers:0},"Walk-in Customers":{sales:0,customers:0}};t.forEach((e,t)=>{"walk-in"===t?(a["Walk-in Customers"].sales+=e.sales,a["Walk-in Customers"].customers+=1):e.sales>1e5?(a["VIP Customers"].sales+=e.sales,a["VIP Customers"].customers+=1):(a["Regular Customers"].sales+=e.sales,a["Regular Customers"].customers+=1)});const r=Object.entries(a).map(([e,t])=>({segment:e,sales:t.sales,customers:t.customers,percentage:s>0?Math.round(t.sales/s*100):0})).filter(e=>e.sales>0);return 0===r.length?[]:r}calculateMetrics(e,t){const s=e.reduce((e,t)=>e+("number"==typeof t.total_amount?t.total_amount:parseFloat(t.total_amount)||0),0),a=e.length,r=a>0?s/a:0;let l=0;if(t.length>=2){const e=t[0].sales,s=t[t.length-1].sales;e>0&&(l=(s-e)/e*100)}return{totalSales:s,totalTransactions:a,averageTransaction:r,growthRate:l}}getEmptyData(){return{dailySales:[],topProducts:[],paymentMethods:[],customerSegments:[],metrics:{totalSales:0,totalTransactions:0,averageTransaction:0,growthRate:0}}}async getSalesStats(){try{const{data:e,error:t}=await d.from("lats_sales").select("total_amount, created_at").eq("status","completed");if(t)return null;if(!e||0===e.length)return{total_sales:0,total_revenue:0,today_sales:0,today_revenue:0,this_month_sales:0,this_month_revenue:0,average_sale:0};const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(s.getFullYear(),s.getMonth(),1);let l=0,n=0,i=0;return e.forEach(e=>{const t=e.total_amount||0,s=new Date(e.created_at);l+=t,s>=a&&(n+=t),s>=r&&(i+=t)}),{total_sales:e.length,total_revenue:l,today_sales:e.filter(e=>new Date(e.created_at)>=a).length,today_revenue:n,this_month_sales:e.filter(e=>new Date(e.created_at)>=r).length,this_month_revenue:i,average_sale:e.length>0?l/e.length:0}}catch(e){return null}}},Vt=({isOpen:e,onClose:a})=>{const[r,l]=_.useState("1d"),[n,i]=_.useState(null),[d,c]=_.useState(!1),[m,u]=_.useState(null);_.useEffect(()=>{e&&x()},[e,r]);const x=async()=>{try{c(!0),u(null);const e=await qt.getSalesAnalytics(r);e?i(e):u("No sales data available for the selected period")}catch(e){u("Failed to load sales analytics data. Please try again.")}finally{c(!1)}},g=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS"}).format(e);return Xe(e),e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:t.jsxs(o,{className:"max-w-6xl w-full max-h-[90vh] overflow-y-auto p-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-purple-50 rounded-xl",children:t.jsx(Te,{className:"w-8 h-8 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Sales Analytics"}),t.jsx("p",{className:"text-base text-gray-600",children:"Comprehensive sales performance insights"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:x,disabled:d,className:"p-2 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",title:"Refresh data",children:t.jsx(V,{className:"w-5 h-5 "+(d?"animate-spin":"")})}),t.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(te,{className:"w-6 h-6"})})]})]}),t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Period:"}),t.jsx("div",{className:"flex gap-2",children:["1d","7d","30d","90d"].map(e=>t.jsx("button",{onClick:()=>l(e),disabled:d,className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(r===e?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50"),children:"1d"===e?"Today":"7d"===e?"7 Days":"30d"===e?"30 Days":"90 Days"},e))})]})}),d&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading sales analytics..."})]})}),m&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-red-500 text-2xl mb-4",children:"âš ï¸"}),t.jsx("div",{className:"text-gray-600 mb-4",children:m}),t.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Retry"})]})}),!d&&!m&&n&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(pe,{className:"w-6 h-6 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Total Sales"})]}),t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:g(n.metrics.totalSales)}),t.jsxs("div",{className:"text-sm text-blue-600",children:[n.metrics.totalTransactions," transactions"]})]}),t.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(Ie,{className:"w-6 h-6 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-700",children:"Transactions"})]}),t.jsx("div",{className:"text-2xl font-bold text-green-900",children:n.metrics.totalTransactions}),t.jsx("div",{className:"text-sm text-green-600",children:"Total orders"})]}),t.jsxs("div",{className:"p-6 bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl border border-purple-200",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(Te,{className:"w-6 h-6 text-purple-600"}),t.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Average Order"})]}),t.jsx("div",{className:"text-2xl font-bold text-purple-900",children:g(n.metrics.averageTransaction)}),t.jsx("div",{className:"text-sm text-purple-600",children:"Per transaction"})]}),t.jsxs("div",{className:"p-6 bg-gradient-to-br from-orange-50 to-amber-100 rounded-xl border border-orange-200",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(Ie,{className:"w-6 h-6 text-orange-600"}),t.jsx("span",{className:"text-sm font-medium text-orange-700",children:"Growth Rate"})]}),t.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[n.metrics.growthRate.toFixed(1),"%"]}),t.jsx("div",{className:"text-sm text-orange-600",children:"Period growth"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[t.jsxs("div",{className:"p-6 bg-gradient-to-br from-orange-50 to-amber-100 rounded-xl border border-orange-200",children:[t.jsxs("h3",{className:"font-semibold text-orange-900 mb-4 flex items-center gap-2",children:[t.jsx(Y,{className:"w-5 h-5"}),"Top Products"]}),t.jsx("div",{className:"space-y-3",children:n.topProducts.length>0?n.topProducts.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[e.quantity," units sold"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-semibold text-green-600",children:g(e.sales)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.percentage,"% of total"]})]})]},s)):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(Y,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No product sales data available"})]})})]}),t.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border border-blue-200",children:[t.jsxs("h3",{className:"font-semibold text-blue-900 mb-4 flex items-center gap-2",children:[t.jsx(pe,{className:"w-5 h-5"}),"Payment Methods"]}),t.jsx("div",{className:"space-y-3",children:n.paymentMethods.length>0?n.paymentMethods.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[t.jsx("div",{className:"flex-1",children:t.jsx("div",{className:"font-medium text-gray-900 capitalize",children:e.method})}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-semibold text-blue-600",children:g(e.amount)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.percentage,"% of total"]})]})]},s)):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(pe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No payment method data available"})]})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[t.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl border border-green-200",children:[t.jsxs("h3",{className:"font-semibold text-green-900 mb-4 flex items-center gap-2",children:[t.jsx(Ie,{className:"w-5 h-5"}),"Sales by Day"]}),t.jsx("div",{className:"space-y-2",children:n.dailySales.length>0?n.dailySales.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.date}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-semibold text-green-600",children:g(e.sales)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[e.transactions," transactions"]})]})]},s)):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(Ie,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No daily sales data available"})]})})]}),t.jsxs("div",{className:"p-6 bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl border border-purple-200",children:[t.jsxs("h3",{className:"font-semibold text-purple-900 mb-4 flex items-center gap-2",children:[t.jsx(M,{className:"w-5 h-5"}),"Customer Segments"]}),t.jsx("div",{className:"space-y-3",children:n.customerSegments.length>0?n.customerSegments.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.segment}),t.jsxs("div",{className:"text-sm text-gray-600",children:[e.customers," customers"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-semibold text-purple-600",children:g(e.sales)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.percentage,"% of total"]})]})]},s)):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(M,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No customer segment data available"})]})})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx(s,{onClick:a,variant:"secondary",className:"flex-1 py-4 text-lg font-semibold",children:"Close"}),t.jsxs(s,{onClick:()=>{if(!n)return;const e=`Period,Total Sales,Total Transactions,Average Transaction\n${r},${n.metrics.totalSales},${n.metrics.totalTransactions},${n.metrics.averageTransaction}`,t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`sales-analytics-${r}.csv`,a.click(),window.URL.revokeObjectURL(s)},className:"flex-1 py-4 text-lg font-semibold bg-gradient-to-r from-purple-500 to-indigo-600 text-white flex items-center justify-center gap-2",children:[t.jsx(Ee,{className:"w-5 h-5"}),"Export Analytics"]})]})]}),!d&&!m&&!n&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Te,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Analytics Data"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"No sales data available for the selected period"}),t.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh Data"})]})})]})}):null},Bt={API_BASE_URL:"http://localhost:8000",ENDPOINTS:{CREATE_ORDER:"/zenopay-create-order.php",CHECK_STATUS:"/zenopay-check-status.php",WEBHOOK:"/zenopay-webhook.php",USSD_POPUP:"/zenopay-ussd-popup.php",TRIGGER_USSD:"/zenopay-trigger-ussd.php"},getUrl:e=>`${Bt.API_BASE_URL}${e}`,getCreateOrderUrl:()=>Bt.getUrl(Bt.ENDPOINTS.CREATE_ORDER),getCheckStatusUrl:e=>`${Bt.getUrl(Bt.ENDPOINTS.CHECK_STATUS)}?order_id=${e}`,getWebhookUrl:()=>Bt.getUrl(Bt.ENDPOINTS.WEBHOOK),getUssdPopupUrl:()=>Bt.getUrl(Bt.ENDPOINTS.USSD_POPUP),getUssdTriggerUrl:(e,t,s)=>`${Bt.getUrl(Bt.ENDPOINTS.TRIGGER_USSD)}?phone=${encodeURIComponent(e)}&amount=${t}&order_id=${s}`},Zt=3e5,Qt={INITIATING:"Initiating USSD popup on customer phone...",SENT:"USSD popup sent successfully to customer phone",PENDING:"Waiting for customer to complete USSD payment...",TIMEOUT:"USSD popup timeout. Please try again.",ERROR:"Failed to send USSD popup. Please try again.",SUCCESS:"USSD payment completed successfully!",FAILED:"USSD payment failed. Please try again.",CANCELLED:"USSD payment was cancelled by customer."},Wt={ENABLED:!0,LOG_PREFIX:"[ZenoPay USSD]",LOG_LEVELS:{INFO:"info",WARN:"warn",ERROR:"error",DEBUG:"debug"}};class Gt{static debugLog(e,t,s){const a=(new Date).toISOString();Wt.LOG_PREFIX,e.toUpperCase();switch(e){case Wt.LOG_LEVELS.ERROR:case Wt.LOG_LEVELS.WARN:case Wt.LOG_LEVELS.DEBUG:}}static async triggerUssdPopup(e,t,s,a){try{this.debugLog("info",`Triggering USSD popup for order ${s}`,{phoneNumber:e,amount:t,orderId:s,customerName:a});const r=Bt.getUssdTriggerUrl(e,t,s);this.debugLog("debug",`Making USSD trigger request to: ${r}`);const l=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:e,amount:t,order_id:s,customer_name:a,timestamp:(new Date).toISOString(),pos_session:`pos_${Date.now()}`})}),n=await l.json();return this.debugLog("debug","USSD trigger response received",n),l.ok&&n.success?(this.debugLog("info","USSD popup triggered successfully",n),{success:!0,message:Qt.SENT,data:n}):(this.debugLog("error","USSD popup trigger failed",n),{success:!1,message:n.message||Qt.ERROR,data:n})}catch(r){return this.debugLog("error","USSD popup trigger error",r),{success:!1,message:`USSD popup error: ${r instanceof Error?r.message:"Unknown error"}`,data:r}}}static async checkUssdStatus(e){try{this.debugLog("debug",`Checking USSD status for order ${e}`);const t=await fetch(Bt.getUssdPopupUrl(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:e,check_type:"ussd_status"})}),s=await t.json();return this.debugLog("debug","USSD status check response",s),t.ok&&s.success?{success:!0,status:s.status||"pending",data:s}:{success:!1,status:"error",data:s}}catch(t){return this.debugLog("error","USSD status check error",t),{success:!1,status:"error",data:t}}}static async pollUssdStatus(e,t){const s=Date.now();let a=0;for(this.debugLog("info",`Starting USSD status polling for order ${e}`);Date.now()-s<Zt;){a++,this.debugLog("debug",`USSD status check attempt ${a} for order ${e}`);const s=await this.checkUssdStatus(e);if(s.success){if(null==t||t(s.status,s.data),"completed"===s.status)return this.debugLog("info",`USSD payment completed for order ${e}`),{success:!0,finalStatus:"completed",data:s.data};if("failed"===s.status)return this.debugLog("warn",`USSD payment failed for order ${e}`),{success:!1,finalStatus:"failed",data:s.data};if("cancelled"===s.status)return this.debugLog("warn",`USSD payment cancelled for order ${e}`),{success:!1,finalStatus:"cancelled",data:s.data}}await new Promise(e=>setTimeout(e,5e3))}return this.debugLog("warn",`USSD polling timeout for order ${e} after ${a} attempts`),{success:!1,finalStatus:"timeout",data:{attempts:a,timeout:Zt}}}}const Kt=e=>{if(!e)return"Enter reference number";const t=e.toLowerCase();return t.includes("mpesa")||t.includes("m-pesa")?"Enter M-Pesa reference (7-10 digits)":t.includes("airtel")?"Enter Airtel Money reference":t.includes("zenopay")?"Enter ZenoPay reference":"Enter reference number (6-12 characters)"},Ht=e=>{if(!e)return"Reference number from your mobile money transaction";const t=e.toLowerCase();return t.includes("mpesa")||t.includes("m-pesa")?"Enter the transaction reference from your M-Pesa confirmation message":t.includes("airtel")?"Enter the transaction reference from your Airtel Money confirmation message":t.includes("zenopay")?"Enter the transaction reference from your ZenoPay confirmation message":"Enter the transaction reference from your mobile money confirmation message"},Yt=({isOpen:e,onClose:r,onPaymentComplete:l,cartItems:n,total:i,customer:d})=>{const[c,m]=_.useState(!1),[u,x]=_.useState(!1),[g,h]=_.useState(!1),[p,b]=_.useState(null),[f,y]=_.useState(null),[v,j]=_.useState(""),[N,w]=_.useState("idle"),[S,C]=_.useState(null),[k,P]=_.useState(!1),[D,T]=_.useState(""),{currentUser:I}=a(),E=d&&d.phone,A=async e=>{if(null==d?void 0:d.phone){h(!0),w("triggering"),j(Qt.INITIATING);try{const t=await Gt.triggerUssdPopup(d.phone,i,e,d.name);t.success?(w("sent"),j(Qt.PENDING),L(e)):(w("error"),y(t.message),j(""))}catch(t){const e=t instanceof Error?t.message:"USSD popup error";w("error"),y(e),j("")}finally{h(!1)}}else y("Customer phone number is required for USSD popup")},L=e=>{const t=setInterval(async()=>{try{const s=await Gt.checkUssdStatus(e);s.success&&(w(s.status),"completed"===s.status?(j(Qt.SUCCESS),clearInterval(t),C(null),await F(p)):"failed"===s.status?(y(Qt.FAILED),j(""),clearInterval(t),C(null)):"cancelled"===s.status?(y(Qt.CANCELLED),j(""),clearInterval(t),C(null)):j(Qt.PENDING))}catch(s){}},5e3);C(t),setTimeout(()=>{t&&(clearInterval(t),C(null),"sent"!==N&&"pending"!==N||(w("timeout"),y(Qt.TIMEOUT),j("")))},Zt)},F=async e=>{try{const t={id:`sale_${Date.now()}`,saleNumber:`SALE-${Date.now().toString().slice(-6)}`,items:n.map(e=>({id:`item_${Date.now()}_${e.id}`,saleId:`sale_${Date.now()}`,productId:e.productId,variantId:e.variantId,productName:e.productName,variantName:e.variantName,sku:e.sku,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice,costPrice:0,profit:0})),subtotal:n.reduce((e,t)=>e+t.totalPrice,0),tax:.16*n.reduce((e,t)=>e+t.totalPrice,0),discount:0,total:i+.16*n.reduce((e,t)=>e+t.totalPrice,0),paymentMethod:{type:"mobile_money",details:{mobileProvider:"ZenoPay",reference:e.reference,paymentMethod:"ussd_popup"},amount:i},paymentStatus:"completed",customerId:null==d?void 0:d.id,customerName:null==d?void 0:d.name,customerPhone:null==d?void 0:d.phone,soldBy:(null==I?void 0:I.name)||(null==I?void 0:I.email)||"POS User",soldAt:(new Date).toISOString(),createdAt:(new Date).toISOString()};l(t),r()}catch(t){y("Failed to complete sale. Please contact support.")}};return _.useEffect(()=>{e||(b(null),y(null),j(""),m(!1),x(!1),h(!1),w("idle"),P(!1),T(""),S&&(clearInterval(S),C(null)))},[e,S]),_.useEffect(()=>()=>{S&&clearInterval(S)},[S]),e?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed bg-black bg-opacity-50",onClick:r,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),t.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:t.jsxs(o,{className:"w-full max-w-md p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(B,{className:"w-6 h-6 text-blue-600"}),t.jsx("h2",{className:"text-xl font-semibold",children:"Mobile Money Payment"})]}),t.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(te,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"space-y-4 mb-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-gray-600",children:"Total Amount:"}),t.jsx("span",{className:"text-2xl font-bold text-green-600",children:i.toLocaleString("en-US",{style:"currency",currency:"TZS"})})]}),d&&t.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Customer:"}),t.jsx("div",{className:"font-medium",children:d.name}),t.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[t.jsx(oe,{className:"w-3 h-3"}),d.phone]})]}),"idle"!==N&&t.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxs(et,{variant:"completed"===N?"success":"failed"===N||"cancelled"===N||"timeout"===N?"error":"sent"===N?"primary":"warning",size:"sm",children:["USSD: ",N.toUpperCase()]}),"triggering"===N&&t.jsx(Ae,{className:"w-4 h-4 animate-spin text-blue-600"})]}),"sent"===N&&t.jsxs("div",{className:"text-sm text-blue-700",children:["USSD popup sent to ",null==d?void 0:d.phone,". Waiting for customer response..."]})]}),p&&t.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxs(et,{variant:"primary",size:"sm",children:["Order: ",p.order_id.slice(-8)]}),t.jsx(et,{variant:"COMPLETED"===p.payment_status?"success":"FAILED"===p.payment_status||"CANCELLED"===p.payment_status?"error":"warning",size:"sm",children:p.payment_status})]}),p.reference&&t.jsxs("div",{className:"text-sm text-gray-600",children:["Reference: ",p.reference]})]})]}),v&&t.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ae,{className:"w-4 h-4 animate-spin text-blue-600"}),t.jsx("span",{className:"text-blue-800",children:v})]})}),f&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Se,{className:"w-4 h-4 text-red-600"}),t.jsx("span",{className:"text-red-800",children:f})]})}),t.jsxs("div",{className:"space-y-3",children:[!p&&t.jsx(s,{onClick:async()=>{if(E){m(!0),y(null),j("Creating payment order...");try{const e={buyer_email:d.email||`${d.phone}@mobile.money`,buyer_name:d.name,buyer_phone:d.phone,amount:i,metadata:{cart_items:n.map(e=>({product_id:e.productId,variant_id:e.variantId,product_name:e.productName,variant_name:e.variantName,quantity:e.quantity,price:e.unitPrice,total_price:e.totalPrice})),customer_id:d.id,pos_session_id:`pos_${Date.now()}`,order_type:"pos_sale",payment_method:"ussd_popup"}},t=await fetch(Bt.getCreateOrderUrl(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!s.success)throw new Error(s.error||"Failed to create payment order");{const e={order_id:s.order_id,buyer_email:d.email||`${d.phone}@mobile.money`,buyer_name:d.name,buyer_phone:d.phone,amount:i,payment_status:"PENDING"};b(e),j("Payment order created successfully. Triggering USSD popup..."),await A(e.order_id)}}catch(e){const t=e instanceof Error?e.message:"Failed to create payment order";y(t),j("")}finally{m(!1)}}else y("Customer phone number is required for mobile money payment")},disabled:!E||c||g,className:"w-full",size:"lg",children:c?t.jsxs(t.Fragment,{children:[t.jsx(Ae,{className:"w-4 h-4 animate-spin mr-2"}),"Creating Payment Order..."]}):g?t.jsxs(t.Fragment,{children:[t.jsx(Ae,{className:"w-4 h-4 animate-spin mr-2"}),"Sending USSD Popup..."]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"w-4 h-4 mr-2"}),"Pay with USSD Popup"]})}),"PENDING"===(null==p?void 0:p.payment_status)&&"idle"===N&&t.jsx(s,{onClick:()=>(async e=>{x(!0);try{const t=await fetch(Bt.getCheckStatusUrl(e)),s=await t.json();if(!(s.success&&s.orders.length>0))throw new Error(s.error||"Failed to check payment status");{const e=s.orders[0];b(e),"COMPLETED"===e.payment_status?(j("Payment completed successfully!"),await F(e)):"FAILED"===e.payment_status?(y("Payment failed. Please try again."),j("")):"CANCELLED"===e.payment_status?(y("Payment was cancelled by the customer."),j("")):j("Payment is still pending. Please wait...")}}catch(t){const e=t instanceof Error?t.message:"Failed to check payment status";y(e)}finally{x(!1)}})(p.order_id),disabled:u,variant:"outline",className:"w-full",children:u?t.jsxs(t.Fragment,{children:[t.jsx(Ae,{className:"w-4 h-4 animate-spin mr-2"}),"Checking Status..."]}):t.jsxs(t.Fragment,{children:[t.jsx(ye,{className:"w-4 h-4 mr-2"}),"Check Payment Status"]})}),"sent"===N&&t.jsx(s,{onClick:()=>A(p.order_id),disabled:g,variant:"outline",className:"w-full",children:g?t.jsxs(t.Fragment,{children:[t.jsx(Ae,{className:"w-4 h-4 animate-spin mr-2"}),"Resending USSD Popup..."]}):t.jsxs(t.Fragment,{children:[t.jsx(oe,{className:"w-4 h-4 mr-2"}),"Resend USSD Popup"]})}),!p&&t.jsxs(s,{onClick:()=>P(!k),variant:"outline",className:"w-full",children:[t.jsx(ce,{className:"w-4 h-4 mr-2"}),k?"Hide Manual Entry":"Enter Reference Manually"]}),k&&t.jsxs("div",{className:"space-y-3 p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reference Number *"}),t.jsx(gt,{value:D,onChange:e=>T(e),placeholder:Kt("ZenoPay"),maxLength:50}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:Ht("ZenoPay")})]}),t.jsxs(s,{onClick:async()=>{if(!D.trim())return void y("Please enter a reference number");const e=((e,t)=>{if(!e||!e.trim())return{isValid:!1,error:"Reference number is required for mobile money payments"};const s=e.trim();if(!/^[0-9A-Za-z]{6,12}$/.test(s))return{isValid:!1,error:"Please enter a valid reference number (6-12 alphanumeric characters)"};if(t){const e=t.toLowerCase();if((e.includes("mpesa")||e.includes("m-pesa"))&&!/^[0-9]{7,10}$/.test(s))return{isValid:!1,error:"M-Pesa reference number should be 7-10 digits"};if(e.includes("airtel")&&!/^[0-9A-Za-z]{6,12}$/.test(s))return{isValid:!1,error:"Airtel Money reference number should be 6-12 alphanumeric characters"};if(e.includes("zenopay")&&!/^[0-9A-Za-z]{8,12}$/.test(s))return{isValid:!1,error:"ZenoPay reference number should be 8-12 alphanumeric characters"}}return{isValid:!0}})(D,"ZenoPay");if(!e.isValid)return void y(e.error);const t={order_id:`MANUAL_${Date.now()}`,buyer_email:d.email||`${d.phone}@mobile.money`,buyer_name:d.name,buyer_phone:d.phone,amount:i,payment_status:"COMPLETED",reference:D.trim()};await F(t)},disabled:!D.trim(),className:"w-full",size:"sm",children:[t.jsx(ye,{className:"w-4 h-4 mr-2"}),"Complete Payment"]})]}),t.jsx(s,{onClick:r,variant:"ghost",className:"w-full",children:"Cancel"})]}),t.jsx("div",{className:"mt-6 p-3 bg-gray-50 rounded-lg",children:t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("div",{className:"font-medium mb-1",children:"USSD Popup Instructions:"}),t.jsxs("ul",{className:"space-y-1 text-xs",children:[t.jsxs("li",{children:["â€¢ Customer will receive a USSD popup on their phone (",null==d?void 0:d.phone,")"]}),t.jsxs("li",{children:["â€¢ USSD popup will show payment amount: ",i.toLocaleString("en-US",{style:"currency",currency:"TZS"})]}),t.jsx("li",{children:"â€¢ Customer needs to confirm payment on their mobile device"}),t.jsx("li",{children:"â€¢ Payment status will update automatically"}),t.jsx("li",{children:"â€¢ Sale will complete once payment is confirmed"}),t.jsx("li",{children:"â€¢ USSD popup will timeout after 5 minutes"})]})]})}),!1]})})]}):null},Jt=({isOpen:e,onClose:s,onSuccess:a,cartItems:r,cartTotal:l,customer:n,currentUser:i})=>{const{currentBranch:o}=x(),[d,c]=_.useState([]),[m,u]=_.useState(!1);Xe(e);const[h,p]=_.useState({down_payment:0,number_of_installments:3,payment_frequency:"monthly",start_date:(new Date).toISOString().split("T")[0],late_fee_amount:0,notes:"Created from POS",payment_method:"cash",account_id:""});_.useEffect(()=>{},[e,n,i,r,l]),_.useEffect(()=>{e&&(async()=>{try{const e=await g.getPaymentMethods();c(e)}catch(e){}})()},[e]);const b=l-h.down_payment,f=b/h.number_of_installments;return e?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed bg-black bg-opacity-50",onClick:s,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),t.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",style:{pointerEvents:"auto"},children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-purple-500 to-purple-600",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-white rounded-lg",children:t.jsx(R,{className:"w-6 h-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-white",children:"Create Installment Plan"}),t.jsx("p",{className:"text-sm text-purple-100",children:"Set up payment terms for this sale"})]})]}),t.jsx("button",{onClick:s,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:t.jsx(te,{size:24})})]}),t.jsx("div",{className:"p-6 bg-purple-50 border-b border-purple-200",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"Customer"}),t.jsx("p",{className:"font-semibold text-gray-900",children:(null==n?void 0:n.name)||"N/A"}),(null==n?void 0:n.phone)&&t.jsx("p",{className:"text-sm text-gray-600",children:n.phone})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"Total Amount"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})}),t.jsxs("p",{className:"text-sm text-gray-600",children:[(null==r?void 0:r.length)||0," items"]})]})]})}),t.jsxs("form",{onSubmit:async e=>{var t;if(e.preventDefault(),n)if(n.id)if(r&&0!==r.length)if(h.account_id)if(h.down_payment<0||h.down_payment>l)G.error("Invalid down payment amount");else if(i)if(i.id){u(!0);try{const e={customerId:n.id,customerName:n.name,customerPhone:n.phone,customerEmail:n.email,items:r.map(e=>({id:e.id,productId:e.productId,variantId:e.variantId,productName:e.productName,variantName:e.variantName||"",sku:e.sku,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice,costPrice:e.costPrice||0,profit:e.profit||0})),subtotal:l,tax:0,discount:0,total:l,paymentMethod:{type:"installment",amount:0,details:{accountId:h.account_id,reference:"Installment Plan - Payments tracked via installment_payments table",notes:`Installment Plan: ${h.number_of_installments} payments`}},paymentStatus:"completed",soldBy:(null==i?void 0:i.name)||(null==i?void 0:i.email)||"POS User",notes:`Installment Plan: ${h.number_of_installments} payments`},s=await mt.processSale(e);if(!s.success||!s.sale)throw new Error(s.error||"Failed to create sale");const d={customer_id:n.id,sale_id:s.sale.id,total_amount:l,down_payment:h.down_payment,number_of_installments:h.number_of_installments,payment_frequency:h.payment_frequency,start_date:h.start_date,late_fee_amount:h.late_fee_amount,notes:`${h.notes} - Sale: ${s.sale.saleNumber}`,payment_method:h.payment_method,account_id:h.account_id},c=await ht.createInstallmentPlan(d,i.id,null==o?void 0:o.id);c.success?(G.success(`âœ… Sale completed with installment plan!\nSale: ${s.sale.saleNumber}\nPlan: ${null==(t=c.plan)?void 0:t.plan_number}`),a()):G.error(c.error||"Failed to create installment plan")}catch(s){G.error(s.message||"An error occurred")}finally{u(!1)}}else G.error("User ID is missing. Please log in again.");else G.error("User not authenticated. Please log in again.");else G.error("Please select a payment account");else G.error("Please add items to cart first");else G.error("Customer ID is missing. Please reselect the customer.");else G.error("Customer information is missing. Please select a customer.")},className:"p-6 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Down Payment ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"number",value:h.down_payment,onChange:e=>p(t=>({...t,down_payment:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"0",max:l,step:"0.01"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Number of Installments ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"number",value:h.number_of_installments,onChange:e=>p(t=>({...t,number_of_installments:parseInt(e.target.value)||1})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1",required:!0})]})]}),t.jsx("div",{className:"p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Amount to Finance:"}),t.jsx("div",{className:"font-bold text-green-900 text-lg",children:b.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Calculated Per Installment:"}),t.jsx("div",{className:"font-bold text-green-900 text-lg",children:f.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]})]}),h.down_payment>0&&t.jsx("div",{className:"pt-2 border-t border-green-300",children:t.jsxs("p",{className:"text-xs text-green-800",children:["ðŸ’° ",t.jsxs("strong",{children:["Down payment of ",h.down_payment.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})]})," will be recorded when you create this plan. Future payments will be ",t.jsxs("strong",{children:[f.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})," each"]}),"."]})})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Frequency ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{value:h.payment_frequency,onChange:e=>p(t=>({...t,payment_frequency:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"bi_weekly",children:"Bi-Weekly"}),t.jsx("option",{value:"monthly",children:"Monthly"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Start Date ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"date",value:h.start_date,onChange:e=>p(t=>({...t,start_date:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Method ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{value:h.payment_method,onChange:e=>p(t=>({...t,payment_method:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[t.jsx("option",{value:"cash",children:"Cash"}),t.jsx("option",{value:"mobile_money",children:"Mobile Money"}),t.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),t.jsx("option",{value:"card",children:"Card"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Account ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{value:h.account_id,onChange:e=>p(t=>({...t,account_id:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[t.jsx("option",{value:"",children:"Select Account"}),d.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Late Fee Amount"}),t.jsx("input",{type:"number",value:h.late_fee_amount,onChange:e=>p(t=>({...t,late_fee_amount:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"0",step:"0.01"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),t.jsx("textarea",{value:h.notes,onChange:e=>p(t=>({...t,notes:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Additional notes...",rows:2})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:m,className:"flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:m?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Pe,{size:18}),"Create Installment Plan"]})})]})]})]})})]}):null},Xt=["Repair Cost","Cleaning Cost","Testing Cost","Refurbishment","Packaging","Storage","Insurance","Other"],es=({isOpen:e,onClose:s,transaction:a,onConfirm:r,isLoading:l=!1})=>{var n;const[i,o]=_.useState({cost_price:a.final_trade_in_value||0,additional_costs:[],total_cost:a.final_trade_in_value||0,selling_price:0,markup_percentage:30,profit_per_unit:0}),[c,m]=_.useState(!1),u=e=>{const t="string"==typeof e?parseFloat(e):e;return t%1==0?t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})};_.useEffect(()=>{if(e&&a){const e=a.final_trade_in_value||0,t=30,s=e*(1+t/100),r=s-e;o({cost_price:e,additional_costs:[],total_cost:e,selling_price:parseFloat(s.toFixed(2)),markup_percentage:t,profit_per_unit:parseFloat(r.toFixed(2))})}},[e,a]);const x=e=>{const t=i.total_cost,s=e-t,a=t>0?s/t*100:0;o({...i,selling_price:e,markup_percentage:parseFloat(a.toFixed(2)),profit_per_unit:parseFloat(s.toFixed(2))}),m(!0),setTimeout(()=>m(!1),600)},g=(e,t,s)=>{const a=i.additional_costs.map(a=>a.id===e?{...a,[t]:s}:a),r=a.reduce((e,t)=>e+t.amount,0),l=i.cost_price+r,n=i.selling_price-l,d=l>0?n/l*100:0;o({...i,additional_costs:a,total_cost:parseFloat(l.toFixed(2)),markup_percentage:parseFloat(d.toFixed(2)),profit_per_unit:parseFloat(n.toFixed(2))}),"amount"===t&&(m(!0),setTimeout(()=>m(!1),600))};if(!e)return null;const h=i.profit_per_unit>0,p=a.needs_repair||!1,b=i.selling_price>0;return t.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-[99999]",role:"dialog","aria-modal":"true","aria-labelledby":"trade-in-pricing-modal-title",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden relative",children:[t.jsx("button",{onClick:s,className:"absolute top-4 right-4 w-9 h-9 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors shadow-lg z-50",children:t.jsx(te,{className:"w-5 h-5"})}),t.jsxs("div",{className:"p-8 bg-white text-center border-b border-gray-200 flex-shrink-0",children:[t.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:t.jsx(pe,{className:"w-8 h-8 text-white"})}),t.jsx("h3",{id:"trade-in-pricing-modal-title",className:"text-2xl font-bold text-gray-900 mb-2",children:"Set Resale Price - Trade-In Device"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Configure pricing before adding to inventory"}),t.jsx("div",{className:"flex items-center justify-center gap-2 mt-4",children:b?t.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[t.jsx(ye,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm font-bold text-green-700",children:"Pricing Complete"})]}):t.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg animate-pulse",children:[t.jsx(Se,{className:"w-4 h-4 text-orange-600"}),t.jsx("span",{className:"text-sm font-bold text-orange-700",children:"Set Selling Price"})]})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto px-6 pt-6",children:[t.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-2xl p-5 mb-6 border-2 border-orange-200 shadow-sm",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md",children:t.jsx(B,{className:"w-7 h-7 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-bold text-gray-900 text-xl mb-1",children:a.device_name}),t.jsx("p",{className:"text-sm text-gray-700 font-medium mb-3",children:a.device_model}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.device_imei&&t.jsxs("span",{className:"text-xs bg-white px-3 py-1.5 rounded-lg border-2 border-gray-300 font-semibold text-gray-700",children:["ðŸ“± IMEI: ",a.device_imei]}),t.jsxs("span",{className:"text-xs px-3 py-1.5 rounded-lg border-2 font-bold "+("excellent"===a.condition_rating?"bg-green-100 border-green-300 text-green-700":"good"===a.condition_rating?"bg-blue-100 border-blue-300 text-blue-700":"fair"===a.condition_rating?"bg-yellow-100 border-yellow-300 text-yellow-700":"bg-gray-100 border-gray-300 text-gray-700"),children:["â­ Condition: ",null==(n=a.condition_rating)?void 0:n.toUpperCase()]}),p&&t.jsx("span",{className:"text-xs bg-red-500 text-white px-3 py-1.5 rounded-lg border-2 border-red-600 font-bold shadow-sm",children:"âš ï¸ Needs Repair"})]}),a.condition_description&&t.jsx("p",{className:"text-sm text-gray-600 mt-3 italic",children:a.condition_description})]})]})}),t.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[t.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Trade-In Paid"}),t.jsx("p",{className:"text-xl font-bold text-gray-900 transition-all duration-300 "+(c?"scale-110 text-blue-600":""),children:u(i.cost_price)}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"TZS"})]}),t.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total Cost"}),t.jsx("p",{className:"text-xl font-bold text-gray-900 transition-all duration-300 "+(c?"scale-110 text-blue-600":""),children:u(i.total_cost)}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"TZS"})]}),t.jsxs("div",{className:"p-4 rounded-xl border shadow-sm "+(h?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[t.jsx("p",{className:"text-xs mb-2 font-medium "+(h?"text-green-700":"text-red-700"),children:"Net Profit"}),t.jsx("p",{className:`text-xl font-bold transition-all duration-300 ${h?"text-green-600":"text-red-600"} ${c?"scale-110":""}`,children:u(i.profit_per_unit)}),t.jsx("p",{className:"text-xs mt-1 "+(h?"text-green-600":"text-red-600"),children:"TZS"})]}),t.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-200 shadow-sm",children:[t.jsx("p",{className:"text-xs text-blue-700 mb-2 font-medium",children:"Markup"}),t.jsxs("p",{className:"text-xl font-bold text-blue-600 transition-all duration-300 "+(c?"scale-110":""),children:[i.markup_percentage%1==0?i.markup_percentage:i.markup_percentage.toFixed(2),"%"]})]})]}),t.jsxs("div",{className:"border-2 border-blue-200 rounded-2xl p-6 mb-6 bg-blue-50/30 shadow-sm",children:[t.jsxs("h4",{className:"font-bold text-gray-900 mb-5 flex items-center gap-2 text-lg",children:[t.jsx(Le,{className:"w-6 h-6 text-blue-600"}),"Pricing Configuration"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[t.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-200",children:[t.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-2",children:"Selling Price *"}),t.jsx("input",{type:"text",value:u(i.selling_price),onChange:e=>{const t=e.target.value.replace(/,/g,""),s=parseFloat(t)||0;x(s)},className:"w-full px-4 py-3 border-2 border-blue-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 text-xl font-bold bg-white",placeholder:"Enter selling price"})]}),t.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-200",children:[t.jsx("label",{className:"block text-xs font-medium text-purple-700 mb-2",children:"Markup %"}),t.jsx("input",{type:"text",value:i.markup_percentage%1==0?i.markup_percentage:i.markup_percentage.toFixed(2),onChange:e=>{const t=e.target.value.replace(/,/g,"");(e=>{const t=i.total_cost,s=t*(1+e/100),a=s-t;o({...i,selling_price:parseFloat(s.toFixed(2)),markup_percentage:e,profit_per_unit:parseFloat(a.toFixed(2))}),m(!0),setTimeout(()=>m(!1),600)})(parseFloat(t)||0)},className:"w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-gray-900 text-xl font-bold bg-white"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-3 bg-blue-50 rounded-xl border border-blue-200",children:[t.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Quick Add Profit:"}),t.jsx("button",{type:"button",onClick:()=>{const e=i.total_cost;x(e+1e4)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+10K"}),t.jsx("button",{type:"button",onClick:()=>{const e=i.total_cost;x(e+5e4)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+50K"}),t.jsx("button",{type:"button",onClick:()=>{const e=i.total_cost;x(e+1e5)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+100K"}),t.jsx("button",{type:"button",onClick:()=>{const e=i.total_cost;x(e+2e5)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+200K"}),t.jsx("button",{type:"button",onClick:()=>{const e=i.total_cost;x(e+5e5)},className:"px-4 py-2 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-blue-500 hover:text-white hover:border-blue-500 rounded-lg transition-all font-semibold shadow-sm",children:"+500K"})]}),!h&&i.selling_price>0&&t.jsxs("div",{className:"mt-4 flex items-start gap-3 p-4 bg-red-50 border-2 border-red-200 rounded-xl shadow-sm",children:[t.jsx(Se,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-bold text-red-700",children:"âš ï¸ Warning: Loss on This Item"}),t.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["Selling price is below total cost. You will lose ",u(Math.abs(i.profit_per_unit))," TZS on this device."]})]})]})]}),t.jsxs("div",{className:"border-2 border-orange-200 rounded-2xl p-5 mb-4 bg-orange-50 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Additional Costs"}),t.jsxs("button",{type:"button",onClick:()=>{const e={id:`cost-${Date.now()}-${Math.random()}`,category:"Repair Cost",amount:0,description:""},t=[...i.additional_costs,e],s=t.reduce((e,t)=>e+t.amount,0),a=i.cost_price+s,r=i.selling_price-a,l=a>0?r/a*100:0;o({...i,additional_costs:t,total_cost:parseFloat(a.toFixed(2)),markup_percentage:parseFloat(l.toFixed(2)),profit_per_unit:parseFloat(r.toFixed(2))})},className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white text-sm rounded-xl transition-colors font-semibold shadow-lg",children:[t.jsx(re,{className:"w-4 h-4"}),"Add Cost"]})]}),i.additional_costs.length>0?t.jsxs("div",{className:"space-y-3",children:[i.additional_costs.map(e=>t.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white rounded-xl border-2 border-orange-200 shadow-sm",children:[t.jsx("select",{value:e.category,onChange:t=>g(e.id,"category",t.target.value),className:"flex-1 px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 font-medium",children:Xt.map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("input",{type:"text",value:u(e.amount),onChange:t=>{const s=t.target.value.replace(/,/g,""),a=parseFloat(s)||0;g(e.id,"amount",a)},placeholder:"Amount",className:"w-44 px-4 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 font-bold text-lg"}),t.jsx("input",{type:"text",value:e.description,onChange:t=>g(e.id,"description",t.target.value),placeholder:"Description (optional)",className:"flex-1 px-3 py-2.5 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200"}),t.jsx("button",{type:"button",onClick:()=>(e=>{const t=i.additional_costs.filter(t=>t.id!==e),s=t.reduce((e,t)=>e+t.amount,0),a=i.cost_price+s,r=i.selling_price-a,l=a>0?r/a*100:0;o({...i,additional_costs:t,total_cost:parseFloat(a.toFixed(2)),markup_percentage:parseFloat(l.toFixed(2)),profit_per_unit:parseFloat(r.toFixed(2))})})(e.id),className:"p-2.5 text-red-600 hover:bg-red-100 rounded-xl transition-colors",title:"Remove cost",children:t.jsx(U,{className:"w-5 h-5"})})]},e.id)),t.jsxs("div",{className:"mt-3 pt-3 border-t-2 border-orange-300 flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-gray-700 font-bold",children:"Total Additional Costs:"}),t.jsxs("span",{className:"text-xl text-orange-700 font-bold",children:[u(i.additional_costs.reduce((e,t)=>e+t.amount,0))," TZS"]})]})]}):t.jsx("div",{className:"text-sm text-gray-600 bg-white rounded-xl p-5 border-2 border-dashed border-orange-300 text-center",children:'No additional costs. Click "Add Cost" for repair, cleaning, or refurbishment expenses.'})]})]}),t.jsxs("div",{className:"p-6 pt-4 border-t border-gray-200 bg-white flex-shrink-0",children:[!b&&t.jsxs("div",{className:"mb-3 p-3 bg-orange-50 border border-orange-200 rounded-lg flex items-center gap-2",children:[t.jsx(Se,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),t.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"Please set a selling price before confirming."})]}),t.jsx("button",{type:"button",onClick:async()=>{if(i.selling_price<=0)G.error("Please set a selling price greater than 0");else{if(i.selling_price<i.total_cost){if(!window.confirm(`Warning: Selling price (${u(i.selling_price)} TZS) is below total cost (${u(i.total_cost)} TZS). Continue anyway?`))return}try{if(i.additional_costs.length>0){const{data:{user:t}}=await d.auth.getUser(),s=null==t?void 0:t.id;for(const r of i.additional_costs)if(r.amount>0)try{const{error:e}=await d.from("expenses").insert({category:r.category,amount:r.amount,description:`${r.description||r.category} for ${a.device_name} ${a.device_model} - Trade-In Transaction ${a.id}`,date:(new Date).toISOString().split("T")[0],created_by:s,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()})}catch(e){}i.additional_costs.filter(e=>e.amount>0).length>0&&G.success(`Recorded ${i.additional_costs.filter(e=>e.amount>0).length} expense entries`)}await r(i)}catch(e){G.error("Failed to save pricing")}}},disabled:l||i.selling_price<=0,className:"w-full px-6 py-3.5 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl text-lg",children:l?t.jsxs("span",{className:"flex items-center justify-center gap-2",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):i.selling_price<=0?t.jsxs("span",{className:"flex items-center justify-center gap-2",children:[t.jsx(Se,{className:"w-5 h-5"}),"Set Selling Price to Continue"]}):t.jsxs("span",{className:"flex items-center justify-center gap-2",children:[t.jsx(ye,{className:"w-5 h-5"}),"Confirm & Add to Inventory"]})}),t.jsx("p",{className:"text-xs text-center text-gray-500 mt-3",children:"Device will be added to inventory with pricing information"})]})]})})},ts=({isOpen:e,onClose:s,transaction:a})=>{if(!e||!a)return null;const r=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed bg-black/60 backdrop-blur-sm",onClick:s,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),t.jsx("div",{className:"fixed flex items-center justify-center p-4 pt-16",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full max-h-[85vh] overflow-hidden animate-slideUp",onClick:e=>e.stopPropagation(),style:{pointerEvents:"auto"},children:[t.jsxs("div",{className:"relative bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 px-8 py-6 text-white",children:[t.jsx("div",{className:"absolute inset-0 bg-black/10"}),t.jsxs("div",{className:"relative flex items-start justify-between",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:t.jsx($e,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Transaction Details"}),t.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Complete payment information"})]})]})}),t.jsx("button",{onClick:s,className:"w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg transition-all flex items-center justify-center group",children:t.jsx(te,{className:"w-5 h-5 text-white group-hover:rotate-90 transition-transform duration-300"})})]}),t.jsx("div",{className:"relative mt-4",children:t.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full border-2 ${(e=>{switch(e){case"completed":return"text-green-600 bg-green-100 border-green-200";case"pending":return"text-orange-600 bg-orange-100 border-orange-200";case"failed":return"text-red-600 bg-red-100 border-red-200";default:return"text-gray-600 bg-gray-100 border-gray-200"}})(a.status)}`,children:[(e=>{switch(e){case"completed":return t.jsx(ye,{className:"w-5 h-5 text-green-600"});case"pending":return t.jsx(ve,{className:"w-5 h-5 text-orange-600"});case"failed":return t.jsx(me,{className:"w-5 h-5 text-red-600"});default:return t.jsx(ve,{className:"w-5 h-5 text-gray-600"})}})(a.status),a.status.toUpperCase()]})})]}),t.jsxs("div",{className:"overflow-y-auto max-h-[calc(85vh-180px)] px-8 py-6 bg-gray-50",children:[t.jsxs("div",{className:"bg-gradient-to-br from-emerald-500 via-teal-600 to-cyan-600 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden mb-6",children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32"}),t.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full -ml-24 -mb-24"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(pe,{className:"w-6 h-6"}),t.jsx("span",{className:"text-sm font-medium opacity-90",children:"Transaction Amount"})]}),t.jsx("div",{className:"text-5xl font-bold mb-2",children:r(a.amount)}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-sm font-medium",children:a.paymentMethod}),a.soldItems&&a.soldItems.length>0&&t.jsxs("span",{className:"text-sm opacity-75",children:["â€¢ ",a.soldItems.length," item",1!==a.soldItems.length?"s":""," sold"]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(ge,{className:"w-5 h-5 text-blue-600"}),"Transaction Information"]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(ge,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Transaction ID"}),t.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 break-all",children:a.transactionId})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(FileText,{className:"w-5 h-5 text-green-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Reference"}),t.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900 break-all",children:a.reference})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(Calendar,{className:"w-5 h-5 text-purple-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Date & Time"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:new Date(a.timestamp).toLocaleString()})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(Activity,{className:"w-5 h-5 text-orange-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Source"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900 capitalize",children:a.source})]})]}),a.deviceName&&t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(Smartphone,{className:"w-5 h-5 text-indigo-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Device"}),t.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["ðŸ“± ",a.deviceName]})]})]}),a.fees>0&&t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[t.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(TrendingDown,{className:"w-5 h-5 text-red-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Transaction Fees"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:r(a.fees)})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(de,{className:"w-5 h-5 text-blue-600"}),"Customer Information"]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(de,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Customer Name"}),t.jsx("div",{className:"font-semibold text-gray-900",children:a.customerName})]})]}),a.customerPhone&&t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(oe,{className:"w-5 h-5 text-teal-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Phone Number"}),t.jsx("div",{className:"font-semibold text-gray-900",children:a.customerPhone})]})]}),a.customerEmail&&t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(je,{className:"w-5 h-5 text-indigo-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Email Address"}),t.jsx("div",{className:"font-semibold text-gray-900 break-all",children:a.customerEmail})]})]}),a.customerAddress&&t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(fe,{className:"w-5 h-5 text-purple-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Address"}),t.jsx("div",{className:"font-semibold text-gray-900",children:a.customerAddress})]})]}),a.customerId&&t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(ge,{className:"w-5 h-5 text-cyan-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Customer ID"}),t.jsx("div",{className:"font-mono text-sm font-semibold text-gray-900",children:a.customerId})]})]})]})]})]}),t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(ve,{className:"w-5 h-5 text-blue-600"}),"Transaction Timeline"]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(ve,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Payment Initiated"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:new Date(a.timestamp).toLocaleString()})]})]}),"completed"===a.status&&t.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(ye,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Payment Completed"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:new Date(a.timestamp).toLocaleString()})]})]}),"pending"===a.status&&t.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-orange-600 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(ve,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Payment Pending"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"Awaiting confirmation"})]})]}),"failed"===a.status&&t.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gradient-to-r from-red-50 to-rose-50 rounded-xl",children:[t.jsx("div",{className:"w-10 h-10 bg-red-600 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(me,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Payment Failed"}),t.jsx("div",{className:"text-sm font-semibold text-gray-900",children:a.failureReason||"Transaction failed"})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(Y,{className:"w-5 h-5 text-blue-600"}),"Sold Items",a.soldItems&&t.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-semibold rounded-full",children:a.soldItems.length})]}),a.soldItems&&a.soldItems.length>0?t.jsxs("div",{className:"space-y-3",children:[a.soldItems.map((e,s)=>t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.productName,t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+("product"===e.type?"bg-blue-100 text-blue-700":"service"===e.type?"bg-green-100 text-green-700":"bg-purple-100 text-purple-700"),children:e.type})]}),e.sku&&t.jsxs("div",{className:"text-sm text-gray-600 font-mono",children:["SKU: ",e.sku]}),e.category&&t.jsx("div",{className:"text-sm text-gray-600",children:e.category&&t.jsxs("span",{className:"mr-2",children:["Category: ",e.category]})}),e.variant&&t.jsxs("div",{className:"text-sm text-gray-600",children:["Variant: ",e.variant]})]}),t.jsxs("div",{className:"text-right ml-4",children:[t.jsx("div",{className:"font-semibold text-gray-900",children:r(e.totalPrice)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[e.quantity," Ã— ",r(e.unitPrice)]})]})]}),e.description&&t.jsx("div",{className:"text-sm text-gray-600 mt-2 pt-2 border-t border-gray-200",children:e.description}),e.notes&&t.jsxs("div",{className:"text-sm text-gray-500 mt-1 italic",children:["Note: ",e.notes]})]},e.id||s)),t.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"font-medium text-blue-900",children:"Total Items"}),t.jsxs("span",{className:"font-semibold text-blue-900",children:[a.soldItems.reduce((e,t)=>e+t.quantity,0)," items"]})]}),t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("span",{className:"font-medium text-blue-900",children:"Total Amount"}),t.jsx("span",{className:"font-semibold text-blue-900",children:r(a.soldItems.reduce((e,t)=>e+t.totalPrice,0))})]})]})]}):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(Y,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No sold items found for this transaction"})]})]}),a.metadata&&Object.keys(a.metadata).length>0&&t.jsxs("div",{className:"p-6 bg-white rounded-xl border border-gray-200",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(se,{className:"w-5 h-5 text-indigo-600"}),"Additional Information"]}),t.jsx("div",{className:"space-y-3",children:Object.entries(a.metadata).map(([e,s])=>t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 capitalize",children:e.replace(/([A-Z])/g," $1")}),t.jsx("span",{className:"text-sm text-gray-900",children:String(s)})]},e))})]})]})]})]}),t.jsx("div",{className:"bg-white border-t border-gray-200 px-8 py-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[t.jsx(ge,{className:"w-4 h-4"}),t.jsx("span",{children:"Transaction:"}),t.jsx("span",{className:"font-mono font-semibold text-gray-900 bg-gray-100 px-3 py-1 rounded-lg",children:a.transactionId})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:()=>{const e=`\n                    Transaction Details\n                    ===================\n                    Transaction ID: ${a.transactionId}\n                    Customer: ${a.customerName}\n                    Amount: ${r(a.amount)}\n                    Method: ${a.paymentMethod}\n                    Status: ${a.status}\n                    Date: ${new Date(a.timestamp).toLocaleString()}\n                    Reference: ${a.reference}\n                  `,t=window.open("","_blank");t&&(t.document.write(`\n                      <html>\n                        <head><title>Transaction ${a.transactionId}</title></head>\n                        <body style="font-family: monospace; font-size: 12px; line-height: 1.4;">\n                          <pre>${e}</pre>\n                        </body>\n                      </html>\n                    `),t.document.close(),t.print())},className:"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm hover:shadow-md font-medium text-sm",children:[t.jsx(Oe,{className:"w-4 h-4"}),t.jsx("span",{children:"Print"})]}),t.jsx("button",{onClick:s,className:"px-6 py-2.5 bg-gradient-to-r from-gray-700 to-gray-800 text-white rounded-xl hover:from-gray-800 hover:to-gray-900 transition-all shadow-sm hover:shadow-md font-medium",children:"Close"})]})]})})]})})]})},ss=({isOpen:e,onClose:a})=>{const[r,l]=_.useState(""),[n,i]=_.useState("all"),[c,m]=_.useState("all"),[u,x]=_.useState(""),[g,h]=_.useState(""),[p,b]=_.useState("all"),[f,y]=_.useState(!1),[v,j]=_.useState(!0),[N,w]=_.useState([]),[S,C]=_.useState({totalPayments:0,totalAmount:0,completedAmount:0,pendingAmount:0,failedAmount:0,totalFees:0,successRate:"0.0"}),[k,P]=_.useState([]),[D,T]=_.useState([]),[I,E]=_.useState([]),[A,L]=_.useState(null),[F,O]=_.useState(!1);_.useEffect(()=>{e&&U()},[e]),_.useEffect(()=>{e&&(u||g)&&U()},[u,g]),_.useEffect(()=>{if(!e)return;let t,s;const a=$(()=>{bt.clearPaymentCache(),U()},3e3);return t=d.channel("payment-tracking-pos-sales-modal").on("postgres_changes",{event:"*",schema:"public",table:"lats_sales"},e=>{a()}).subscribe(),s=d.channel("payment-tracking-device-payments-modal").on("postgres_changes",{event:"*",schema:"public",table:"customer_payments"},e=>{a()}).subscribe(),()=>{t&&t.unsubscribe(),s&&s.unsubscribe()}},[e]);const $=(e,t)=>{let s;return function(...a){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e(...a)},t)}},M=e=>{b(e);const t=new Date;switch(e){case"today":const e=t.toISOString().split("T")[0];x(e),h(e);break;case"week":const s=new Date(t);s.setDate(s.getDate()-7),x(s.toISOString().split("T")[0]),h(t.toISOString().split("T")[0]);break;case"month":const a=new Date(t);a.setMonth(a.getMonth()-1),x(a.toISOString().split("T")[0]),h(t.toISOString().split("T")[0]);break;case"last30":const r=new Date(t);r.setDate(r.getDate()-30),x(r.toISOString().split("T")[0]),h(t.toISOString().split("T")[0]);break;default:x(""),h("")}},U=async()=>{j(!0);try{const e=u||void 0,t=g||void 0,[s,a,r,l,i]=await Promise.all([bt.debouncedFetchPaymentTransactions(e,t,"all"!==c?c:void 0,"all"!==n?n:void 0),bt.calculatePaymentMetrics(e,t),bt.getPaymentMethodSummary(e,t),bt.getDailySummary(7),bt.getReconciliationRecords()]);w(s),C(a),P(r),T(l),E(i)}catch(e){}finally{j(!1)}},z=_.useMemo(()=>r.trim()?N.filter(e=>{const t=r.toLowerCase();return e.customerName.toLowerCase().includes(t)||e.transactionId.toLowerCase().includes(t)||e.reference.toLowerCase().includes(t)}):N,[N,r]),q=e=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),B=e=>{switch(e){case"completed":return"text-green-600 bg-green-100";case"pending":return"text-orange-600 bg-orange-100";case"failed":return"text-red-600 bg-red-100";case"stopped":case"cancelled":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}},Z=async e=>{if(L(e),O(!0),!e.soldItems)try{const t=await bt.fetchSoldItems(e.id,e.source);L({...e,soldItems:t})}catch(t){}};return Xe(e),e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:t.jsxs(o,{className:"max-w-7xl w-full max-h-[90vh] overflow-y-auto p-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-purple-50 rounded-xl",children:t.jsx(Te,{className:"w-8 h-8 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Payment Tracking"}),t.jsx("p",{className:"text-base text-gray-600",children:"Real-time payment monitoring & analytics"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:U,disabled:v,className:"p-2 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",title:"Refresh data",children:t.jsx(V,{className:"w-5 h-5 "+(v?"animate-spin":"")})}),t.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(te,{className:"w-6 h-6"})})]})]}),v&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading payment data..."})]})}),!v&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-8",children:[t.jsxs("div",{className:"p-5 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(R,{className:"w-5 h-5 text-blue-600"}),t.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Total Payments"})]}),t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:S.totalPayments}),t.jsx("div",{className:"text-xs text-blue-600",children:"All transactions"})]}),t.jsxs("div",{className:"p-5 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(pe,{className:"w-5 h-5 text-green-600"}),t.jsx("span",{className:"text-xs font-medium text-green-700",children:"Total Amount"})]}),t.jsx("div",{className:"text-2xl font-bold text-green-900",children:q(S.totalAmount)}),t.jsx("div",{className:"text-xs text-green-600",children:"Gross amount"})]}),t.jsxs("div",{className:"p-5 bg-gradient-to-br from-emerald-50 to-teal-100 rounded-xl border border-emerald-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(ye,{className:"w-5 h-5 text-emerald-600"}),t.jsx("span",{className:"text-xs font-medium text-emerald-700",children:"Completed"})]}),t.jsx("div",{className:"text-2xl font-bold text-emerald-900",children:q(S.completedAmount)}),t.jsxs("div",{className:"text-xs text-emerald-600",children:[S.successRate,"% success rate"]})]}),t.jsxs("div",{className:"p-5 bg-gradient-to-br from-orange-50 to-amber-100 rounded-xl border border-orange-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(ve,{className:"w-5 h-5 text-orange-600"}),t.jsx("span",{className:"text-xs font-medium text-orange-700",children:"Pending"})]}),t.jsx("div",{className:"text-2xl font-bold text-orange-900",children:q(S.pendingAmount)}),t.jsx("div",{className:"text-xs text-orange-600",children:"Awaiting confirmation"})]}),t.jsxs("div",{className:"p-5 bg-gradient-to-br from-red-50 to-rose-100 rounded-xl border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(me,{className:"w-5 h-5 text-red-600"}),t.jsx("span",{className:"text-xs font-medium text-red-700",children:"Failed"})]}),t.jsx("div",{className:"text-2xl font-bold text-red-900",children:q(S.failedAmount)}),t.jsxs("div",{className:"text-xs text-red-600",children:[z.filter(e=>"failed"===e.status).length," transactions"]})]}),t.jsxs("div",{className:"p-5 bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl border border-purple-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("span",{className:"text-lg",children:"ðŸ’¸"}),t.jsx("span",{className:"text-xs font-medium text-purple-700",children:"Total Fees"})]}),t.jsx("div",{className:"text-2xl font-bold text-purple-900",children:q(S.totalFees)}),t.jsx("div",{className:"text-xs text-purple-600",children:"Transaction fees"})]})]}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quick Filters:"}),t.jsx("button",{onClick:()=>M("all"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all "+("all"===p?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"All Time"}),t.jsx("button",{onClick:()=>M("today"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all "+("today"===p?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Today"}),t.jsx("button",{onClick:()=>M("week"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all "+("week"===p?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"This Week"}),t.jsx("button",{onClick:()=>M("month"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all "+("month"===p?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"This Month"}),t.jsx("button",{onClick:()=>M("last30"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all "+("last30"===p?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Last 30 Days"})]})}),t.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-xl border border-gray-200",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3",children:[t.jsx("input",{type:"text",placeholder:"Search payments...",value:r,onChange:e=>l(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"}),t.jsxs("select",{value:n,onChange:e=>i(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",children:[t.jsx("option",{value:"all",children:"All Methods"}),t.jsx("option",{value:"M-Pesa",children:"M-Pesa"}),t.jsx("option",{value:"Card",children:"Card"}),t.jsx("option",{value:"Cash",children:"Cash"}),t.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"})]}),t.jsxs("select",{value:c,onChange:e=>m(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"completed",children:"Completed"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"failed",children:"Failed"})]}),t.jsx("input",{type:"date",placeholder:"Start Date",value:u,onChange:e=>{x(e.target.value),b("custom")},className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"}),t.jsx("input",{type:"date",placeholder:"End Date",value:g,onChange:e=>{h(e.target.value),b("custom")},className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[t.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl border border-blue-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"font-semibold text-blue-900 flex items-center gap-2",children:[t.jsx(R,{className:"w-5 h-5"}),"Payment Transactions (",z.length,")"]}),z.length>5&&t.jsx("button",{onClick:()=>y(!f),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:f?"Show Less":`Show All (${z.length})`})]}),t.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:z.length>0?(f?z:z.slice(0,5)).map(e=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg cursor-pointer hover:bg-blue-50 hover:shadow-md transition-all duration-200 group",onClick:()=>Z(e),children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900 group-hover:text-blue-700",children:e.customerName}),t.jsx("div",{className:"text-sm text-gray-600",children:e.transactionId}),e.deviceName&&t.jsxs("div",{className:"text-xs text-blue-600",children:["ðŸ“± ",e.deviceName]})]}),t.jsxs("div",{className:"text-right flex items-center gap-2",children:[t.jsx("div",{className:"font-semibold text-blue-600",children:q(e.amount)}),t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${B(e.status)}`,children:e.status}),t.jsx(Fe,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-colors"})]})]},e.id)):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(R,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No payment transactions found"})]})})]}),t.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl border border-green-200",children:[t.jsxs("h3",{className:"font-semibold text-green-900 mb-4 flex items-center gap-2",children:[t.jsx(pe,{className:"w-5 h-5"}),"Payment Methods Distribution"]}),t.jsx("div",{className:"space-y-3",children:k.length>0?k.map((e,s)=>{const a=["bg-green-500","bg-blue-500","bg-purple-500","bg-orange-500","bg-pink-500"],r=a[s%a.length];return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900 capitalize",children:e.method}),t.jsxs("div",{className:"text-xs text-gray-600",children:[e.count," transactions"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-semibold text-green-600",children:q(e.amount)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.percentage,"%"]})]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:t.jsx("div",{className:`h-full ${r} rounded-full transition-all duration-500 flex items-center justify-end pr-2`,style:{width:`${e.percentage}%`},children:e.percentage>10&&t.jsxs("span",{className:"text-xs text-white font-bold",children:[e.percentage,"%"]})})})]},s)}):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(pe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No payment method data available"})]})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[t.jsxs("div",{className:"p-5 bg-gradient-to-br from-cyan-50 to-blue-100 rounded-xl border border-cyan-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Ie,{className:"w-5 h-5 text-cyan-600"}),t.jsx("span",{className:"text-xs font-medium text-cyan-700",children:"Avg Transaction"})]}),t.jsx("div",{className:"text-2xl font-bold text-cyan-900",children:q(S.totalPayments>0?S.totalAmount/S.totalPayments:0)}),t.jsx("div",{className:"text-xs text-cyan-600",children:"Per transaction"})]}),t.jsxs("div",{className:"p-5 bg-gradient-to-br from-indigo-50 to-purple-100 rounded-xl border border-indigo-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Y,{className:"w-5 h-5 text-indigo-600"}),t.jsx("span",{className:"text-xs font-medium text-indigo-700",children:"POS Sales"})]}),t.jsx("div",{className:"text-2xl font-bold text-indigo-900",children:z.filter(e=>"pos_sale"===e.source).length}),t.jsx("div",{className:"text-xs text-indigo-600",children:q(z.filter(e=>"pos_sale"===e.source).reduce((e,t)=>e+t.amount,0))})]}),t.jsxs("div",{className:"p-5 bg-gradient-to-br from-pink-50 to-rose-100 rounded-xl border border-pink-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(R,{className:"w-5 h-5 text-pink-600"}),t.jsx("span",{className:"text-xs font-medium text-pink-700",children:"Device Payments"})]}),t.jsx("div",{className:"text-2xl font-bold text-pink-900",children:z.filter(e=>"device_payment"===e.source).length}),t.jsx("div",{className:"text-xs text-pink-600",children:q(z.filter(e=>"device_payment"===e.source).reduce((e,t)=>e+t.amount,0))})]}),t.jsxs("div",{className:"p-5 bg-gradient-to-br from-amber-50 to-yellow-100 rounded-xl border border-amber-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Y,{className:"w-5 h-5 text-amber-600"}),t.jsx("span",{className:"text-xs font-medium text-amber-700",children:"Purchase Orders"})]}),t.jsx("div",{className:"text-2xl font-bold text-amber-900",children:z.filter(e=>"purchase_order"===e.source).length}),t.jsx("div",{className:"text-xs text-amber-600",children:q(z.filter(e=>"purchase_order"===e.source).reduce((e,t)=>e+t.amount,0))})]})]}),z.filter(e=>"failed"===e.status).length>0&&t.jsxs("div",{className:"mb-8 p-6 bg-gradient-to-br from-red-50 to-rose-100 rounded-xl border-2 border-red-200",children:[t.jsxs("h3",{className:"font-semibold text-red-900 mb-4 flex items-center gap-2",children:[t.jsx(me,{className:"w-6 h-6"}),"Failed Payments Investigation (",z.filter(e=>"failed"===e.status).length,")"]}),t.jsx("div",{className:"grid grid-cols-1 gap-3",children:z.filter(e=>"failed"===e.status).slice(0,f?void 0:3).map(e=>t.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-lg border border-red-200 cursor-pointer hover:shadow-md transition-all",onClick:()=>Z(e),children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.customerName}),t.jsx("div",{className:"text-sm text-gray-600",children:e.transactionId}),e.failureReason&&t.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["âš ï¸ ",e.failureReason]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.method," â€¢ ",new Date(e.date).toLocaleString()]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-semibold text-red-600",children:q(e.amount)}),t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-600 mt-2",children:"Failed"})]})]},e.id))}),z.filter(e=>"failed"===e.status).length>3&&t.jsx("button",{onClick:()=>y(!f),className:"mt-4 w-full py-2 text-sm text-red-600 hover:text-red-800 font-medium bg-white rounded-lg border border-red-200 hover:bg-red-50 transition-colors",children:f?"Show Less":`Show All ${z.filter(e=>"failed"===e.status).length} Failed Payments`})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[t.jsxs("div",{className:"p-6 bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl border border-purple-200",children:[t.jsxs("h3",{className:"font-semibold text-purple-900 mb-4 flex items-center gap-2",children:[t.jsx(Ie,{className:"w-5 h-5"}),"Payment Trends (Last 7 Days)"]}),D.length>0?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg",children:t.jsx("div",{className:"flex items-end justify-between gap-2 h-32",children:D.slice(0,7).reverse().map((e,s)=>{const a=Math.max(...D.slice(0,7).map(e=>e.total)),r=a>0?e.total/a*100:0;return t.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[t.jsx("div",{className:"text-xs text-gray-600 font-medium",children:q(e.total)}),t.jsx("div",{className:"w-full bg-gradient-to-t from-purple-500 to-purple-300 rounded-t-lg transition-all duration-500 hover:from-purple-600 hover:to-purple-400",style:{height:`${Math.max(r,5)}%`},title:`${new Date(e.date).toLocaleDateString()}: ${q(e.total)}`}),t.jsx("div",{className:"text-xs text-gray-500 text-center",children:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},s)})})}),t.jsx("div",{className:"space-y-2",children:D.slice(0,3).map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[t.jsx("div",{className:"font-medium text-gray-900 text-sm",children:new Date(e.date).toLocaleDateString()}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-semibold text-purple-600 text-sm",children:q(e.total)}),t.jsxs("div",{className:"text-xs text-gray-600",children:["âœ“ ",q(e.completed)," | â³ ",q(e.pending)," | âœ— ",q(e.failed)]})]})]},s))})]}):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(Ie,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No daily summary data available"})]})]}),t.jsxs("div",{className:"p-6 bg-gradient-to-br from-orange-50 to-amber-100 rounded-xl border border-orange-200",children:[t.jsxs("h3",{className:"font-semibold text-orange-900 mb-4 flex items-center gap-2",children:[t.jsx(Te,{className:"w-5 h-5"}),"Reconciliation"]}),t.jsx("div",{className:"space-y-3",children:I.length>0?I.slice(0,3).map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:new Date(e.date).toLocaleDateString()}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Expected: ",q(e.expected)," | Actual: ",q(e.actual)]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+("reconciled"===e.status?"bg-green-100 text-green-600":"bg-orange-100 text-orange-600"),children:e.status}),0!==e.variance&&t.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Variance: ",q(e.variance)]})]})]},s)):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(Te,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No reconciliation data available"})]})})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx(s,{onClick:a,variant:"secondary",className:"flex-1 py-4 text-lg font-semibold",children:"Close"}),t.jsxs(s,{onClick:()=>{const e=window.open("","_blank");if(!e)return;const t=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Payment Report - ${(new Date).toLocaleDateString()}</title>\n        <style>\n          body { font-family: Arial, sans-serif; padding: 20px; }\n          h1 { color: #333; border-bottom: 2px solid #6366f1; padding-bottom: 10px; }\n          .summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }\n          .summary-card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #666; }\n          .summary-card p { margin: 0; font-size: 24px; font-weight: bold; }\n          table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n          th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n          th { background-color: #f3f4f6; font-weight: 600; }\n          .completed { color: #10b981; }\n          .pending { color: #f59e0b; }\n          .failed { color: #ef4444; }\n          @media print { \n            body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }\n          }\n        </style>\n      </head>\n      <body>\n        <h1>Payment Tracking Report</h1>\n        <p>Generated on: ${(new Date).toLocaleString()}</p>\n        \n        <div class="summary">\n          <div class="summary-card">\n            <h3>Total Payments</h3>\n            <p>${S.totalPayments}</p>\n          </div>\n          <div class="summary-card">\n            <h3>Total Amount</h3>\n            <p>TSh ${S.totalAmount.toLocaleString()}</p>\n          </div>\n          <div class="summary-card">\n            <h3>Success Rate</h3>\n            <p>${S.successRate}%</p>\n          </div>\n        </div>\n\n        <table>\n          <thead>\n            <tr>\n              <th>Transaction ID</th>\n              <th>Customer</th>\n              <th>Amount</th>\n              <th>Method</th>\n              <th>Status</th>\n              <th>Date</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${z.map(e=>`\n              <tr>\n                <td>${e.transactionId}</td>\n                <td>${e.customerName}</td>\n                <td>TSh ${e.amount.toLocaleString()}</td>\n                <td>${e.method}</td>\n                <td class="${e.status}">${e.status}</td>\n                <td>${new Date(e.date).toLocaleDateString()}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </body>\n      </html>\n    `;e.document.write(t),e.document.close(),setTimeout(()=>{e.print()},250)},className:"flex-1 py-4 text-lg font-semibold bg-gradient-to-r from-blue-500 to-cyan-600 text-white flex items-center justify-center gap-2",children:[t.jsx(Oe,{className:"w-5 h-5"}),"Print Report"]}),t.jsxs(s,{onClick:()=>{try{const e=["Transaction ID","Customer Name","Amount","Method","Status","Date","Reference","Cashier","Source"],t=z.map(e=>[e.transactionId,e.customerName,e.amount.toFixed(2),e.method,e.status,new Date(e.date).toLocaleDateString(),e.reference,e.cashier,e.source]),s=[e.join(","),...t.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),l=URL.createObjectURL(a);r.setAttribute("href",l),r.setAttribute("download",`payment-report-${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),alert("Payment data exported successfully!")}catch(e){alert("Failed to export data")}},className:"flex-1 py-4 text-lg font-semibold bg-gradient-to-r from-purple-500 to-indigo-600 text-white flex items-center justify-center gap-2",children:[t.jsx(Ee,{className:"w-5 h-5"}),"Export CSV"]})]})]})}),!v&&0===N.length&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Te,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Payment Data"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"No payment data available for the selected period"}),t.jsx("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh Data"})]})}),t.jsx(ts,{isOpen:F,onClose:()=>{O(!1),L(null)},transaction:A})]})}):null},as=document.createElement("style");as.textContent="\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n  \n  @keyframes slideUp {\n    from {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n  \n  .animate-fadeIn {\n    animation: fadeIn 0.2s ease-out;\n  }\n  \n  .animate-slideUp {\n    animation: slideUp 0.3s ease-out;\n  }\n","undefined"==typeof document||document.getElementById("transaction-modal-animations")||(as.id="transaction-modal-animations",document.head.appendChild(as));const rs=({isOpen:e,onClose:s,onContinue:a,closureTime:r,closedBy:l,userRole:n})=>{if(!e)return null;return t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:t.jsx(Me,{className:"w-5 h-5 text-orange-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-900",children:"Daily Sales Closed"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Post-closure sale warning"})]})]}),t.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center transition-colors",children:t.jsx(te,{className:"w-4 h-4 text-gray-500"})})]}),t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(ve,{className:"w-5 h-5 text-orange-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-orange-800 font-medium",children:"Daily sales have been closed"}),t.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"This sale will be recorded for tomorrow's report and may require special handling."})]})]})}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Closed at:"}),t.jsx("span",{className:"font-medium text-gray-900",children:(e=>{if(!e)return"Unknown time";try{return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return"Unknown time"}})(r)})]}),l&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Closed by:"}),t.jsx("span",{className:"font-medium text-gray-900",children:l})]})]})}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{onClick:s,className:"flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel Sale"}),t.jsxs("button",{onClick:a,className:"flex-1 px-4 py-2.5 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center gap-2",children:[t.jsx(ye,{className:"w-4 h-4"}),"admin"===n?"Override & Continue":"Continue Sale"]})]})]})}),t.jsx("div",{className:"px-6 pb-6",children:t.jsx("p",{className:"text-xs text-gray-500 text-center",children:"admin"===n?"Admin override: Post-closure sales will be logged with override reason":"Post-closure sales will be flagged in reports for review"})})]})})},ls=({isOpen:e,onClose:s,onOpenDay:a,currentUser:r,expectedPasscode:l="1234"})=>{const[n,i]=_.useState(""),[o,d]=_.useState(!1),[c,m]=_.useState(!1);_.useEffect(()=>{4!==n.length||c||(async()=>{try{if(m(!0),n!==l)return G.error("Invalid passcode"),void i("");await a(),s()}catch(e){G.error("Failed to open day")}finally{m(!1)}})()},[n]);return e?P.createPortal(t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:99999},children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-xl w-full mx-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:t.jsx(Re,{className:"w-5 h-5 text-green-600"})}),t.jsx("div",{children:t.jsx("h3",{className:"font-semibold text-gray-900",children:"Open New Day"})})]}),t.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center transition-colors",children:t.jsx(te,{className:"w-4 h-4 text-gray-500"})})]}),t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter Passcode"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:o?"text":"password",value:n,onChange:e=>i(e.target.value),placeholder:"â€¢â€¢â€¢â€¢",className:"w-full px-6 py-4 pr-14 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-center text-3xl tracking-widest font-semibold",maxLength:4,readOnly:!0}),t.jsx("button",{type:"button",onClick:()=>d(!o),className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:o?t.jsx(Ue,{className:"w-6 h-6"}):t.jsx(Fe,{className:"w-6 h-6"})})]})]}),t.jsx("div",{children:t.jsx(T,{onKeyPress:e=>{n.length<4&&i(t=>t+e)},onBackspace:()=>{i(e=>e.slice(0,-1))},onClear:()=>{i("")},disabled:c})})]})})})]})}),document.body):null},ns=640,is=768,os=1024,ds=1280,cs=1536,ms=e=>e>=cs?"2xl":e>=ds?"xl":e>=os?"lg":e>=is?"md":e>=ns?"sm":"xs",us=(e,t)=>t>e?"portrait":"landscape",xs=()=>{const e=_.useCallback(()=>{if("undefined"==typeof window)return{isMobile:!1,isTablet:!1,isDesktop:!0,isTouchDevice:!1,screenWidth:1920,screenHeight:1080,orientation:"landscape",deviceType:"desktop",breakpoint:"2xl"};const e=window.innerWidth,t=window.innerHeight,s="undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0),a=(()=>{if("undefined"==typeof window)return!1;const e=navigator.userAgent||navigator.vendor||window.opera;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e.toLowerCase())})(),r=(()=>{if("undefined"==typeof window)return!1;const e=navigator.userAgent||navigator.vendor||window.opera,t=/ipad|tablet|playbook|silk|kindle/i.test(e.toLowerCase()),s=window.innerWidth;return t||s>=is&&s<os})(),l=(e<is||a)&&!r,n=r||e>=is&&e<os&&s,i=l?"mobile":n?"tablet":"desktop";return{isMobile:l,isTablet:n,isDesktop:!l&&!n,isTouchDevice:s,screenWidth:e,screenHeight:t,orientation:us(e,t),deviceType:i,breakpoint:ms(e)}},[]),[t,s]=_.useState(e);return _.useEffect(()=>{let t;const a=()=>{clearTimeout(t),t=setTimeout(()=>{const t=e();s(e=>e.isMobile!==t.isMobile||e.isTablet!==t.isTablet||e.deviceType!==t.deviceType||e.breakpoint!==t.breakpoint||e.orientation!==t.orientation?t:e)},150)},r=()=>{setTimeout(()=>{const t=e();s(t)},100)};window.addEventListener("resize",a),window.addEventListener("orientationchange",r);const l=e();return s(l),()=>{clearTimeout(t),window.removeEventListener("resize",a),window.removeEventListener("orientationchange",r)}},[e]),t},gs=({product:s,onAddToCart:a,onViewDetails:r,onView:l,onEdit:n,onDelete:i,variant:o="default",showStockInfo:d=!0,showCategory:c=!0,showActions:m=!1,isSelected:u=!1,onSelect:x,showCheckbox:g=!1,className:h="",primaryColor:p="blue",actionText:b="Add to Cart",allowOutOfStockSelection:f=!1,realTimeStockData:y,isVisible:v=!0,priority:j=!1})=>{var N,w,S,C,k,P;const[D,T]=_.useState(!1),[I,E]=_.useState(new Map),L=y||I,[F,O]=_.useState(!1),[$,M]=_.useState(null),R=He(),{showProductImages:z,showStockLevels:q,showPrices:V,showBarcodes:B}=R;A(),_.useState(null),_.useState(!1),_.useState(!1);const[Z,Q]=_.useState(!1);_.useState(1);const[W,G]=_.useState(j),[K,H]=_.useState(!1),[Y,J]=_.useState(!1),X=_.useRef(null);We(),_.useEffect(()=>{T(!1)},[]),_.useEffect(()=>{if(!y&&(null==s?void 0:s.id)){const e=setTimeout(()=>{ne()},100);return()=>clearTimeout(e)}},[null==s?void 0:s.id,y]);const ee=(()=>{switch(p){case"orange":return{hoverBorder:"hover:border-orange-300",textColor:"text-orange-600",iconColor:"text-orange-600",priceColor:"text-orange-900",errorColor:"text-orange-600"};case"green":return{hoverBorder:"hover:border-green-300",textColor:"text-green-600",iconColor:"text-green-600",priceColor:"text-green-900",errorColor:"text-green-600"};case"purple":return{hoverBorder:"hover:border-purple-300",textColor:"text-purple-600",iconColor:"text-purple-600",priceColor:"text-purple-900",errorColor:"text-purple-600"};default:return{hoverBorder:"hover:border-blue-300",textColor:"text-blue-600",iconColor:"text-blue-600",priceColor:"text-blue-900",errorColor:"text-blue-600"}}})();if(!s)return t.jsx("div",{className:"p-4 border border-red-200 bg-red-50 rounded-lg",children:t.jsx("p",{className:"text-red-600 text-sm",children:"Product data is missing"})});let te,se;try{te=yt(s),se=vt(s)}catch(he){return T(!0),t.jsxs("div",{className:"p-4 border border-red-200 bg-red-50 rounded-lg",children:[t.jsx("p",{className:"text-red-600 text-sm",children:"Error loading product data"}),t.jsx("button",{onClick:()=>T(!1),className:"mt-2 text-blue-600 text-xs hover:underline",children:"Try again"})]})}const ae=()=>{if(!s.variants||0===s.variants.length)return t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200",children:"No Variants"});if(!te)return null;switch(se){case"out-of-stock":return t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-200",children:"Out of Stock"});case"low-stock":return t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200",children:"Low Stock"});default:return t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 border border-green-200",children:"In Stock"})}},re=()=>{if(!s.variants||0===s.variants.length)return"No variants";const e=s.variants.map(e=>Number(e.sellingPrice)||0).filter(e=>e>0).sort((e,t)=>e-t);return 0===e.length?"No price set":`$${e[0].toFixed(2)}`},ne=async()=>{if((null==s?void 0:s.id)&&!y)try{O(!0);const e=Ke.getInstance(),t=await e.getStockLevels([s.id]),a=new Map;Object.entries(t).forEach(([e,t])=>{const s=t.reduce((e,t)=>e+t.quantity,0);a.set(e,s)}),E(a),M(new Date)}catch(he){}finally{O(!1)}},ie=()=>{const e=(null==s?void 0:s.id)&&L.get(s.id)||0;return e>0||L.has(s.id)?e:Nt(s)},oe=async()=>{if(m&&l)return void l(s);if(!s.variants||0===s.variants.length)return;if(r)return void r(s);if((!te||!f&&te.quantity<=0)&&!f)return;const t=s.variants&&s.variants.length>1,n=s.variants&&1===s.variants.length;if(t)Q(!0);else{if(n){const t=s.variants[0],a=t.is_parent||"parent"===t.variant_type;let r=!1;if(!a)try{const{supabase:s}=await e(()=>import("./index-222cfb29.js").then(e=>e.aO),["assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),{count:a}=await s.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("parent_variant_id",t.id).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0);r=(a||0)>0}catch(he){}if(a||r)return void Q(!0)}a&&a(s,te,1)}};jt(s);const de=(()=>{if(!s.images||0===s.images.length)return[];return s.images.map((e,t)=>({id:`temp-${s.id}-${t}`,url:e,thumbnailUrl:e,fileName:`product-image-${t+1}`,fileSize:0,isPrimary:0===t,uploadedAt:(new Date).toISOString()}))})();if(_.useEffect(()=>{if(j||W)return;const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(G(!0),e.disconnect())})},{rootMargin:"50px",threshold:.1});return X.current&&e.observe(X.current),()=>e.disconnect()},[j,W]),_.useEffect(()=>{if(!W)return;const e=setTimeout(()=>{H(!0)},100),t=setTimeout(()=>{J(!0)},200);return()=>{clearTimeout(e),clearTimeout(t)}},[W]),"compact"===o){const e=!s.variants||0===s.variants.length,a=e||!te||!f&&te.quantity<=0;return t.jsx(t.Fragment,{children:t.jsx("div",{className:`bg-white border border-gray-200 rounded-lg p-4 transition-all duration-200 ${h} ${a?"opacity-50 cursor-not-allowed":`cursor-pointer ${ee.hoverBorder} hover:shadow-md active:scale-95`} ${e?"border-gray-300 bg-gray-50":""}`,onClick:oe,style:{minHeight:"60px"},title:e?"This product has no variants and cannot be added to cart. Please add variants in the inventory management.":`Click to ${b.toLowerCase()}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-shrink-0 cursor-pointer hover:opacity-90 transition-opacity",onClick:e=>{e.stopPropagation()},children:t.jsx(Ye,{images:de.map(e=>e.url),productName:s.name,size:"sm",className:"w-10 h-10"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h3",{className:"font-medium truncate text-base "+(e?"text-gray-500":"text-gray-900"),title:s.name,children:s.name}),ae()]}),t.jsx("p",{className:"text-xs text-gray-500 font-mono",children:(null==te?void 0:te.sku)||"N/A"}),c&&(s.categoryName||(null==(N=s.category)?void 0:N.name))&&t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-purple-50 text-purple-700 border border-purple-200 font-medium",children:["ðŸ“¦ ",s.categoryName||(null==(w=s.category)?void 0:w.name)]})})]}),t.jsxs("div",{className:"text-right",children:[V&&t.jsx("div",{className:`font-semibold text-base ${e?"text-gray-500":ee.priceColor}`,title:re(),children:re()}),q&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Stock: ",ie()]})]})]})})})}const ce=!s.variants||0===s.variants.length,me=ce||!te||!f&&te.quantity<=0,ue=(null==te?void 0:te.costPrice)||0,xe=(null==te?void 0:te.sellingPrice)||0,ge=xe>0?((xe-ue)/xe*100).toFixed(1):"0";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`pos-product-card relative bg-white border-2 rounded-xl transition-all duration-300 overflow-hidden ${h} ${me?"opacity-50 cursor-not-allowed":`cursor-pointer ${ee.hoverBorder} hover:shadow-lg active:scale-98`} ${ce?"border-gray-300 bg-gray-50":"border-gray-200"} ${u?"ring-4 ring-blue-400 border-blue-500":""}`,onClick:e=>{e.target.closest(".action-button")||(g&&x?x(s.id):oe())},title:ce?"This product has no variants and cannot be added to cart. Please add variants in the inventory management.":m?"Click to view details":`Click to ${b.toLowerCase()}`,children:[g&&t.jsx("div",{className:"absolute top-3 left-3 z-30 action-button",children:t.jsx("input",{type:"checkbox",checked:u,onChange:e=>{e.stopPropagation(),x&&x(s.id)},className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2 cursor-pointer"})}),q&&d&&ie()>0&&t.jsxs("div",{className:"absolute top-2 right-2 p-2 rounded-full border-2 border-white shadow-lg flex items-center justify-center z-20 w-10 h-10 "+(ie()<=5?"bg-gradient-to-r from-red-500 to-red-600":ie()<=10?"bg-gradient-to-r from-orange-500 to-orange-600":"bg-gradient-to-r from-green-500 to-emerald-500"),children:[t.jsx("span",{className:"text-sm font-bold text-white",children:F?"...":ie()>=1e3?`${(ie()/1e3).toFixed(1)}K`:ie()}),F&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),t.jsxs("div",{className:"p-6 cursor-pointer flex flex-col h-full",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[z&&t.jsxs("div",{className:`relative w-20 h-20 rounded-xl flex items-center justify-center text-lg font-bold ${ee.iconColor} cursor-pointer hover:opacity-90 transition-opacity`,onClick:e=>{e.stopPropagation(),setIsProductInfoOpen(!0)},children:[t.jsx(Ye,{images:de.map(e=>e.url),productName:s.name,size:"lg",className:"w-full h-full rounded-xl"}),s.variants&&s.variants.length>1&&t.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:t.jsx("span",{className:"text-xs font-bold text-white",children:s.variants.length})})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-800 truncate text-xl leading-tight",title:s.name,children:s.name}),t.jsxs("div",{className:"text-2xl text-gray-700 mt-1 font-bold",children:["TSh ",re().replace("$","").replace(".00","").replace(".0","")]})]})]})}),m?t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-3",children:[V&&t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-gray-500 font-medium",children:"Cost"}),t.jsx("span",{className:"text-gray-900 font-semibold",children:tt.currency(ue)})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-gray-500 font-medium",children:"Selling"}),t.jsx("span",{className:"text-green-700 font-semibold",children:tt.currency(xe)})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-gray-500 font-medium",children:"Margin"}),t.jsxs("span",{className:"font-semibold "+(parseFloat(ge)<10?"text-red-600":parseFloat(ge)<30?"text-orange-600":"text-green-600"),children:[ge,"%"]})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[(s.shelfCode||s.shelfName||s.storeLocationName||s.storageRoomName)&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-blue-50 text-blue-700 border border-blue-200 text-xs",children:["ðŸ“ ",s.shelfCode||s.shelfName||s.storeLocationName||s.storageRoomName]}),c&&(s.categoryName||(null==(S=s.category)?void 0:S.name))&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium",children:["ðŸ“¦ ",s.categoryName||(null==(C=s.category)?void 0:C.name)]}),s.supplierName&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-green-50 text-green-700 border border-green-200 text-xs",children:["ðŸ¢ ",s.supplierName]}),s.isFeatured&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-yellow-50 text-yellow-700 border border-yellow-200 text-xs font-medium",children:"â­ Featured"})]}),s.variants&&s.variants.length>1&&t.jsx("div",{className:"flex items-center justify-between text-xs bg-gradient-to-r from-indigo-50 to-purple-50 px-3 py-2 rounded-lg",children:t.jsxs("span",{className:"text-gray-600",children:[t.jsx("span",{className:"font-semibold text-indigo-700",children:s.variants.length})," variants available"]})})]}):t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("div",{className:"flex items-center gap-4",children:(s.shelfCode||s.shelfName||s.storeLocationName||s.storageRoomName)&&t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-blue-50 text-blue-700 border border-blue-200 text-xs",children:["ðŸ“¦ ",s.shelfCode||s.shelfName||s.storeLocationName||s.storageRoomName||"Shelf Info"]})})}),t.jsx("div",{className:"flex items-center gap-2",children:c&&(s.categoryName||(null==(k=s.category)?void 0:k.name))&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium",children:["ðŸ“¦ ",s.categoryName||(null==(P=s.category)?void 0:P.name)]})})]})}),t.jsx("div",{className:"flex-1"}),m?t.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-200 space-y-2 action-button",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[l&&t.jsxs("button",{onClick:e=>{e.stopPropagation(),l(s)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[t.jsx(Fe,{className:"w-3.5 h-3.5"}),"View"]}),n&&t.jsxs("button",{onClick:e=>{e.stopPropagation(),n(s)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-green-50 text-green-700 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[t.jsx(le,{className:"w-3.5 h-3.5"}),"Edit"]}),i&&t.jsxs("button",{onClick:e=>{e.stopPropagation(),i(s)},className:"flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 rounded-lg transition-colors",children:[t.jsx(U,{className:"w-3.5 h-3.5"}),"Delete"]})]}),t.jsxs("div",{className:"flex items-center justify-between text-xs px-2",children:[t.jsx("span",{className:"text-gray-500",children:"Status:"}),t.jsx("span",{className:"font-medium "+(s.isActive?"text-green-600":"text-gray-400"),children:s.isActive?"â— Active":"â—‹ Inactive"})]})]}):me?null:t.jsx("div",{className:"mt-auto pt-3 border-t border-gray-100",children:t.jsxs("div",{className:`text-center text-sm font-medium ${ee.textColor} opacity-70 hover:opacity-100 transition-opacity`,children:["Click to ",b]})})]})]}),t.jsx(Je,{isOpen:Z,onClose:()=>Q(!1),product:s,onSelectVariant:(e,t,s)=>{a&&a(e,t,s)}})]})},hs=({children:e,delay:s=100,isVisible:a=!0,priority:r=!1,className:l="",fallback:n})=>{const[i,o]=_.useState(r),[d,c]=_.useState(r),m=_.useRef(null);_.useEffect(()=>{if(r||i)return;const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(o(!0),e.disconnect())})},{rootMargin:"20px",threshold:.1});return m.current&&e.observe(m.current),()=>e.disconnect()},[r,i]),_.useEffect(()=>{if(!i)return;const e=setTimeout(()=>{c(!0)},s);return()=>clearTimeout(e)},[i,s]);const u=t.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[t.jsx(Ae,{size:14,className:"animate-spin"}),t.jsx("span",{className:"text-sm",children:"Loading..."})]});return t.jsx("div",{ref:m,className:`transition-all duration-300 ${d?"opacity-100":"opacity-0"} ${l}`,children:d?e:n||u})},ps={mobile:"grid-cols-1",smallMobile:"grid-cols-2",tablet:"sm:grid-cols-2 md:grid-cols-3",desktop:"lg:grid-cols-4 xl:grid-cols-4",hd:"xl:grid-cols-4 2xl:grid-cols-4",ultraHd:"2xl:grid-cols-4 3xl:grid-cols-5",adaptive:{xs:"grid-cols-1",sm:"grid-cols-2",md:"grid-cols-3",lg:"grid-cols-4",xl:"grid-cols-4","2xl":"grid-cols-4","3xl":"grid-cols-5","4xl":"grid-cols-5"}},bs={gap:{mobile:"gap-2",tablet:"sm:gap-3",desktop:"lg:gap-4",hd:"xl:gap-4",compact:"gap-2"},padding:{mobile:"p-3",tablet:"sm:p-4",desktop:"lg:p-4",hd:"xl:p-5",compact:"p-2"}},fs={mobile:"py-2 px-3",tablet:"sm:py-2 sm:px-3",desktop:"lg:py-2 lg:px-4",hd:"xl:py-3 xl:px-4",compact:"py-1 px-2"},ys=({products:e,onAddToCart:s,isLoading:a,batchSize:r=10,enableVirtualization:l=!0,enableDynamicGrid:n=!0,minCardWidth:i=200,maxColumns:o=3})=>{const[d,c]=_.useState(r),[m,u]=_.useState(new Map),[x,g]=_.useState(!1),h=_.useRef(null);_.useEffect(()=>{(async()=>{if(e&&0!==e.length)try{g(!0);const t=e.map(e=>e.id),s=Ke.getInstance(),a=await s.getStockLevels(t),r=new Map;Object.entries(a).forEach(([e,t])=>{const s=t.reduce((e,t)=>e+t.quantity,0);r.set(e,s)}),u(r)}catch(t){}finally{g(!1)}})()},[e]);const{columns:p,containerWidth:b,getGridClasses:f,getOptimalCardWidth:y}=((e={})=>{const{containerRef:t,minCardWidth:s=200,maxColumns:a=8,gap:r=16,containerPadding:l=32}=e,[n,i]=_.useState({minCardWidth:s,maxColumns:a,gap:r,containerPadding:l}),[o,d]=_.useState(1),[c,m]=_.useState(0),u=_.useCallback(e=>{const t=e-l,n=s+r,i=Math.floor(t/n);return Math.max(1,Math.min(i,a))},[s,a,r,l]),x=_.useCallback(()=>{if(null==t?void 0:t.current){const e=t.current.offsetWidth;m(e);const s=u(e);d(s)}else{const e=window.innerWidth;m(e);const t=u(e);d(t)}},[t,u]);_.useEffect(()=>{x();let e=null;return(null==t?void 0:t.current)&&window.ResizeObserver?(e=new ResizeObserver(()=>{x()}),e.observe(t.current)):window.addEventListener("resize",x),()=>{e?e.disconnect():window.removeEventListener("resize",x)}},[x]);const g=_.useCallback(()=>{const e="grid";return o<=1?`${e} grid-cols-1`:o<=2?`${e} grid-cols-1 sm:grid-cols-2`:o<=3?`${e} grid-cols-1 sm:grid-cols-2 md:grid-cols-3`:o<=4?`${e} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4`:o<=5?`${e} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5`:o<=6?`${e} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6`:o<=7?`${e} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 3xl:grid-cols-7`:`${e} grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 3xl:grid-cols-7 4xl:grid-cols-8`},[o]),h=_.useCallback(()=>{if(0===c)return s;const e=(c-l-(o-1)*r)/o;return Math.max(s,e)},[c,o,r,l,s]);return{columns:o,containerWidth:c,gridConfig:n,getGridClasses:g,getOptimalCardWidth:h,updateGrid:x}})({containerRef:h,minCardWidth:i,maxColumns:o,gap:12,containerPadding:16}),v=e,j=_.useMemo(()=>l?v.slice(0,d):v,[v,d,l]),N=_.useCallback(()=>{c(e=>Math.min(e+r,v.length))},[r,v.length]);k.useEffect(()=>{c(r)},[e,r]);const w=d<v.length;return t.jsx("div",{className:"h-full flex flex-col",children:t.jsx("div",{className:`flex-1 overflow-y-auto ${bs.padding.mobile} ${bs.padding.tablet} ${bs.padding.desktop} ${bs.padding.hd}`,children:a?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):0===v.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Y,{size:48,className:"mx-auto text-gray-300 mb-4"}),t.jsxs(hs,{priority:!0,children:[t.jsx("p",{className:"text-gray-500 font-medium",children:"No products found"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Try adjusting your search or filters"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{ref:h,className:n?`${f()} ${bs.gap.mobile} ${bs.gap.tablet} ${bs.gap.desktop} ${bs.gap.hd}`:`grid ${ps.mobile} ${ps.tablet} ${ps.desktop} ${ps.hd} ${ps.ultraHd} ${bs.gap.mobile} ${bs.gap.tablet} ${bs.gap.desktop} ${bs.gap.hd}`,children:j.map((e,a)=>t.jsx(gs,{product:e,onAddToCart:s,priority:a<4,realTimeStockData:m},e.id))}),w&&t.jsx("div",{className:"mt-4 text-center",children:t.jsxs("button",{onClick:N,className:`${fs.mobile} ${fs.tablet} ${fs.desktop} ${fs.hd} bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition-colors text-xs`,children:["Load More (",v.length-d," remaining)"]})})]})})})},vs=({isOpen:e,onClose:s,customerId:a,customerName:r,customerPhone:l})=>{const{playClickSound:n}=We(),{currentBranchId:i}=x(),[o,c]=_.useState("overview"),[m,u]=_.useState(!0),[g,h]=_.useState(null);_.useEffect(()=>{let t=!0;return e&&a&&p(t),()=>{t=!1}},[e,a]);const p=async(e=!0)=>{u(!0);try{const{data:s,error:r}=await d.from("lats_customers").select("*").eq("id",a).single();if(!e)return;if(r)throw r;if(!s)throw new Error("Customer not found");const{data:l,error:n}=await d.from("lats_sales").select("id, sale_number, total_amount, subtotal, created_at, status").eq("customer_id",a).eq("branch_id",i).order("created_at",{ascending:!1}).limit(10),o=l||[],c=o.reduce((e,t)=>e+("number"==typeof t.total_amount?t.total_amount:parseFloat(t.total_amount)||0),0),m=o.length,u=m>0?c/m:0,x=o.length>0?o[0].created_at:null;let g=[];if(o.length>0)try{const e=o.map(e=>e.id),{data:t}=await d.from("lats_sale_items").select("product_id, quantity").in("sale_id",e);if(t&&t.length>0){const e=[...new Set(t.map(e=>e.product_id))],{data:s}=await d.from("lats_products").select("id, name").in("id",e),a={};t.forEach(e=>{const t=null==s?void 0:s.find(t=>t.id===e.product_id),r=(null==t?void 0:t.name)||"Unknown Product";a[r]=(a[r]||0)+e.quantity}),g=Object.entries(a).sort(([,e],[,t])=>t-e).slice(0,3).map(([e])=>e)}}catch(t){}const p=(null==s?void 0:s.loyalty_points)||0;let b="interested";p>=1e3?b="vip":p>=700?b="premium":p>=400?b="regular":p>=200?b="active":p>=100?b="payment_customer":p>=50&&(b="engaged"),h({id:s.id,name:s.name,phone:s.phone,email:s.email,location:s.location||s.city||"N/A",joinDate:s.created_at,status:s.status||"active",loyaltyTier:b,points:p,totalSpent:c,totalPurchases:m,avgOrderValue:u,lastPurchase:x,favoriteProducts:g,purchases:o.map(e=>({id:e.id,saleNumber:e.sale_number,date:e.created_at,amount:e.total_amount,items:0,status:e.status}))})}catch(t){const s=t instanceof Error?t.message:"Unknown error",a=s.includes("not found")||s.includes("Customer not found");e&&!a&&G.error("Failed to load customer data")}finally{e&&u(!1)}};if(!e)return null;if(m)return t.jsx("div",{className:"fixed inset-0 z-50 bg-white overflow-y-auto",children:t.jsx("div",{className:"flex items-center justify-center h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Ae,{className:"w-12 h-12 text-blue-600 animate-spin mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 font-medium",children:"Loading customer details..."})]})})});if(!g)return t.jsx("div",{className:"fixed inset-0 z-50 bg-white overflow-y-auto",children:t.jsx("div",{className:"flex items-center justify-center h-screen",children:t.jsxs("div",{className:"text-center p-4",children:[t.jsx(de,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 font-medium mb-4",children:"Customer not found"}),t.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Go Back"})]})})});const b=(e=>{switch(e.toLowerCase()){case"vip":return{bg:"bg-purple-500",text:"text-purple-600",icon:"ðŸ‘‘"};case"premium":return{bg:"bg-yellow-500",text:"text-yellow-600",icon:"ðŸ†"};case"regular":return{bg:"bg-blue-500",text:"text-blue-600",icon:"â­"};case"active":return{bg:"bg-green-500",text:"text-green-600",icon:"âœ“"};case"payment_customer":return{bg:"bg-teal-500",text:"text-teal-600",icon:"ðŸ’³"};case"engaged":return{bg:"bg-indigo-500",text:"text-indigo-600",icon:"ðŸ“Š"};case"interested":return{bg:"bg-gray-500",text:"text-gray-600",icon:"ðŸ‘€"};default:return{bg:"bg-gray-500",text:"text-gray-600",icon:"ðŸ‘¤"}}})(g.loyaltyTier);return t.jsxs("div",{className:"fixed inset-0 z-50 bg-white overflow-y-auto",children:[t.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("button",{onClick:()=>{n(),s()},className:"flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(te,{size:18}),t.jsx("span",{className:"text-sm font-medium",children:"Back"})]}),t.jsxs("button",{onClick:()=>{n(),G.success("Edit mode coming soon!")},className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[t.jsx(le,{size:18}),t.jsx("span",{className:"text-sm font-medium",children:"Edit"})]})]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customer Details"})]})}),t.jsxs("div",{className:"p-3 space-y-3 pb-20",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:`w-14 h-14 ${b.bg} rounded-lg flex items-center justify-center text-white font-bold text-xl`,children:g.name.charAt(0).toUpperCase()}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:g.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"âœ“ Active"}),t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium "+("text-yellow-600"===b.text?"bg-yellow-100 text-yellow-800":"text-purple-600"===b.text?"bg-purple-100 text-purple-800":"bg-orange-100 text-orange-800"),children:[b.icon," ",g.loyaltyTier.charAt(0).toUpperCase()+g.loyaltyTier.slice(1)]})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[t.jsx(oe,{className:"w-4 h-4 text-blue-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Phone"}),t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:g.phone})]})]}),t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[t.jsx(je,{className:"w-4 h-4 text-purple-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Email"}),t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:g.email})]})]}),t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[t.jsx(fe,{className:"w-4 h-4 text-green-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Location"}),t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:g.location})]})]}),t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[t.jsx(Pe,{className:"w-4 h-4 text-orange-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Member Since"}),t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Date(g.joinDate).toLocaleDateString()})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(ze,{className:"w-4 h-4 text-blue-600"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Purchases"})]}),t.jsx("p",{className:"text-xl font-bold text-gray-900",children:g.totalPurchases}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"orders"})]}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(pe,{className:"w-4 h-4 text-green-600"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Total Spent"})]}),t.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["TZS ",(g.totalSpent/1e6).toFixed(1),"M"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"lifetime"})]}),t.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(Ne,{className:"w-4 h-4 text-purple-600"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Points"})]}),t.jsx("p",{className:"text-xl font-bold text-gray-900",children:g.points}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"available"})]}),t.jsxs("div",{className:"bg-orange-50 rounded-lg p-3 border border-orange-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(Ie,{className:"w-4 h-4 text-orange-600"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Avg Order"})]}),t.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["TZS ",(g.avgOrderValue/1e3).toFixed(0),"K"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"per order"})]})]}),t.jsxs("div",{className:"flex rounded-full bg-gray-100 p-1 gap-1",children:[t.jsx("button",{onClick:()=>{n(),c("overview")},className:"flex-1 px-4 py-2 text-sm font-medium rounded-full transition-colors "+("overview"===o?"bg-blue-500 text-white":"text-gray-600 hover:text-gray-900"),children:"Overview"}),t.jsx("button",{onClick:()=>{n(),c("purchases")},className:"flex-1 px-4 py-2 text-sm font-medium rounded-full transition-colors "+("purchases"===o?"bg-blue-500 text-white":"text-gray-600 hover:text-gray-900"),children:"Purchases"}),t.jsx("button",{onClick:()=>{n(),c("loyalty")},className:"flex-1 px-4 py-2 text-sm font-medium rounded-full transition-colors "+("loyalty"===o?"bg-blue-500 text-white":"text-gray-600 hover:text-gray-900"),children:"Loyalty"})]}),"overview"===o&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[t.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(ve,{className:"w-4 h-4 text-blue-600"}),"Recent Activity"]}),t.jsxs("div",{className:"space-y-2",children:[g.lastPurchase&&t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg",children:t.jsx(ze,{className:"w-3 h-3 text-green-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Last Purchase"}),t.jsx("p",{className:"text-xs text-gray-600",children:new Date(g.lastPurchase).toLocaleDateString()})]})]}),t.jsxs("p",{className:"text-xs font-bold text-gray-900",children:["TZS ",g.purchases.length>0?(g.purchases[0].amount/1e3).toFixed(0):"0","K"]})]}),t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-purple-100 rounded-lg",children:t.jsx(Ne,{className:"w-3 h-3 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Points Earned"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Last 30 days"})]})]}),t.jsx("p",{className:"text-xs font-bold text-gray-900",children:"+250 pts"})]})]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[t.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(qe,{className:"w-4 h-4 text-orange-600"}),"Favorite Products"]}),t.jsx("div",{className:"space-y-2",children:g.favoriteProducts.length>0?g.favoriteProducts.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[t.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx("span",{className:"text-xs font-bold text-blue-600",children:s+1})}),t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:e})]},s)):t.jsxs("div",{className:"text-center py-6",children:[t.jsx(qe,{className:"w-10 h-10 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-gray-500",children:"No favorite products yet"})]})})]})]}),"purchases"===o&&t.jsx("div",{className:"space-y-3",children:t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[t.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(ze,{className:"w-4 h-4 text-blue-600"}),"Purchase History"]}),t.jsx("div",{className:"space-y-2",children:g.purchases.length>0?g.purchases.map(e=>t.jsxs("div",{className:"p-2 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Order #",e.saleNumber||e.id]}),t.jsx("p",{className:"text-xs text-gray-600",children:new Date(e.date).toLocaleDateString()})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"text-sm font-bold text-gray-900",children:["TZS ",(e.amount/1e3).toFixed(0),"K"]}),t.jsxs("p",{className:"text-xs text-gray-600",children:[e.items," items"]})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium "+("completed"===e.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:"completed"===e.status?"âœ“ Completed":e.status}),t.jsx("button",{className:"text-xs text-blue-600 font-semibold hover:text-blue-700",children:"View Details"})]})]},e.id)):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ze,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-gray-500",children:"No purchases yet"})]})})]})}),"loyalty"===o&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(Ne,{className:"w-4 h-4 text-purple-600"}),"Points Balance"]}),t.jsxs("div",{className:"text-center mb-3",children:[t.jsx("p",{className:"text-3xl font-black text-purple-600",children:g.points}),t.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Available Points"})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Progress to Next Tier"}),t.jsxs("span",{className:"text-xs font-semibold text-gray-900",children:[Math.min(g.points/5e3*100,100).toFixed(0),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-purple-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${Math.min(g.points/5e3*100,100)}%`}})}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:5e3-g.points>0?5e3-g.points+" points to Platinum tier":"Platinum tier achieved!"})]}),t.jsxs("div",{className:"p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[t.jsx("p",{className:"text-sm font-semibold text-yellow-900 mb-2",children:"Your Benefits:"}),t.jsxs("ul",{className:"space-y-1 text-xs text-yellow-800",children:[t.jsx("li",{children:"â€¢ 7% discount on all purchases"}),t.jsx("li",{children:"â€¢ Special birthday rewards"}),t.jsx("li",{children:"â€¢ Priority customer support"}),t.jsx("li",{children:"â€¢ Exclusive member offers"})]})]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[t.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(Te,{className:"w-4 h-4 text-indigo-600"}),"Points History"]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Purchase Reward"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Oct 15, 2024"})]}),t.jsx("p",{className:"text-sm font-bold text-green-600",children:"+45 pts"})]}),t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Purchase Reward"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Oct 10, 2024"})]}),t.jsx("p",{className:"text-sm font-bold text-green-600",children:"+29 pts"})]}),t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Birthday Bonus"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Sep 01, 2024"})]}),t.jsx("p",{className:"text-sm font-bold text-green-600",children:"+100 pts"})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("button",{onClick:()=>{n(),G.success("SMS feature coming soon!")},className:"flex items-center gap-2 px-3 py-2.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:[t.jsx(oe,{size:16}),t.jsx("span",{children:"Send SMS"})]}),t.jsxs("button",{onClick:()=>{n(),G.success("WhatsApp feature coming soon!")},className:"flex items-center gap-2 px-3 py-2.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm font-medium",children:[t.jsx(Ve,{size:16}),t.jsx("span",{children:"WhatsApp"})]}),t.jsxs("button",{onClick:()=>{n(),G.success("Rewards feature coming soon!")},className:"flex items-center gap-2 px-3 py-2.5 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium",children:[t.jsx(_e,{size:16}),t.jsx("span",{children:"Give Reward"})]}),t.jsxs("button",{onClick:()=>{n(),G.success("Email feature coming soon!")},className:"flex items-center gap-2 px-3 py-2.5 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors text-sm font-medium",children:[t.jsx(Be,{size:16}),t.jsx("span",{children:"Send Email"})]})]})]})]})},js=({cartItems:e,selectedCustomer:s,searchQuery:r,onSearchChange:l,products:n,onAddToCart:i,onUpdateCartItemQuantity:o,onRemoveCartItem:c,onProcessPayment:m,onClearCart:u,onShowCustomerSearch:g,onAddCustomer:h,onRemoveCustomer:p,onScanBarcode:b,onViewReceipts:f,onToggleSettings:y,onViewSales:v,onShowDiscountModal:j,totalAmount:N,discountAmount:w,taxAmount:S,finalAmount:C,isProcessingPayment:k,todaysSales:P,isTaxEnabled:D,taxRate:T,isQrCodeScannerEnabled:I})=>{var E,A;const{currentUser:L}=a(),{currentBranch:F}=x(),O=null==F?void 0:F.id,[M,R]=_.useState("products"),[U,z]=_.useState(!1),[V,Q]=_.useState("grid"),[W,H]=_.useState(!1),[J,X]=_.useState(null),[se,ae]=_.useState(()=>{const e=localStorage.getItem("pos_view_mode");return"mobile"===e||"desktop"===e?e:"mobile"}),[le,ce]=_.useState([]),[xe,ge]=_.useState(!1),[he,pe]=_.useState(0),{playClickSound:be,playCartAddSound:fe,playPaymentSound:ye,playDeleteSound:ve}=We(),je=e.reduce((e,t)=>e+(t.quantity||0),0),we=C;_.useEffect(()=>{(async()=>{if(O){ge(!0);try{const{count:e}=await d.from("lats_customers").select("id",{count:"exact",head:!0}).eq("branch_id",O);pe(e||0);const{data:t,error:s}=await d.from("lats_customers").select("id, name, phone, email, location, city, loyalty_points, created_at").eq("branch_id",O).order("created_at",{ascending:!1}).limit(8);if(s)return;if(t&&t.length>0){const e=await Promise.all(t.map(async e=>{const{data:t}=await d.from("lats_sales").select("total_amount").eq("customer_id",e.id).eq("branch_id",O),s=(null==t?void 0:t.reduce((e,t)=>e+("number"==typeof t.total_amount?t.total_amount:parseFloat(t.total_amount)||0),0))||0,a=e.loyalty_points||0;let r="interested",l="gray";return a>=1e3?(r="vip",l="purple"):a>=700?(r="premium",l="yellow"):a>=400?(r="regular",l="blue"):a>=200?(r="active",l="green"):a>=100?(r="payment_customer",l="teal"):a>=50&&(r="engaged",l="indigo"),{...e,totalSpent:s,loyaltyTier:r,tierColor:l}}));ce(e)}}catch(e){}finally{ge(!1)}}})()},[O]),_.useEffect(()=>{e.length},[e.length]),_.useEffect(()=>{document.body.setAttribute("data-view-mode",se)},[se]);const Se=()=>t.jsx("div",{className:"sticky top-0 z-40 border-b border-gray-200 shadow-md",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)"}}),Ce=()=>t.jsx("div",{className:"fixed bottom-0 left-0 right-0 border-t-2 border-gray-300 z-[9999] pb-safe",style:{minHeight:"60px",boxShadow:"0 -2px 10px rgba(0,0,0,0.1)",background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)"},children:t.jsxs("div",{className:"flex items-center justify-around py-1",children:[t.jsxs("button",{onClick:()=>{be(),R("products"),z(!1)},className:"flex flex-col items-center py-2 px-3 transition-colors duration-150 "+("products"===M?"text-blue-600":"text-gray-400"),children:[t.jsx(Y,{size:18,className:"mb-1"}),t.jsx("span",{className:"text-xs font-medium",children:"Products"})]}),t.jsxs("button",{onClick:()=>{be(),R("cart"),z(!0)},className:"flex flex-col items-center py-2 px-3 transition-colors duration-150 relative "+("cart"===M?"text-green-600":"text-gray-400"),children:[t.jsxs("div",{className:"relative",children:[t.jsx(ne,{size:18,className:"mb-1"}),je>0&&t.jsx("span",{className:"absolute -top-1 -right-2 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold",children:je>9?"9+":je})]}),t.jsx("span",{className:"text-xs font-medium",children:"Cart"})]}),t.jsxs("button",{onClick:()=>{be(),R("customers"),z(!1)},className:"flex flex-col items-center py-2 px-3 transition-colors duration-150 "+("customers"===M?"text-purple-600":"text-gray-400"),children:[t.jsx(de,{size:18,className:"mb-1"}),t.jsx("span",{className:"text-xs font-medium",children:"Customers"})]}),t.jsxs("button",{onClick:()=>{be(),R("more"),z(!1)},className:"flex flex-col items-center py-2 px-3 transition-colors duration-150 "+("more"===M?"text-gray-600":"text-gray-400"),children:[t.jsx(q,{size:18,className:"mb-1"}),t.jsx("span",{className:"text-xs font-medium",children:"More"})]})]})}),ke=_.useMemo(()=>{if(!r.trim())return n;const e=r.toLowerCase();return n.filter(t=>{var s,a,r,l;return!!(null==(s=t.name)?void 0:s.toLowerCase().includes(e))||(!!(null==(a=t.sku)?void 0:a.toLowerCase().includes(e))||(!!(null==(r=t.categoryName)?void 0:r.toLowerCase().includes(e))||!!(null==(l=t.variants)?void 0:l.some(t=>{var s,a,r;return(null==(s=t.name)?void 0:s.toLowerCase().includes(e))||(null==(a=t.sku)?void 0:a.toLowerCase().includes(e))||(null==(r=t.barcode)?void 0:r.toLowerCase().includes(e))}))))})},[n,r]),_e=e.reduce((e,t)=>e+t.quantity,0),Pe=()=>U&&"cart"===M&&t.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col",style:{background:"rgba(249, 250, 251, 0.95)",backdropFilter:"blur(10px)"},children:[t.jsx("div",{className:"bg-white border-b border-gray-200 flex-shrink-0 shadow-md",children:t.jsxs("div",{className:"flex items-center justify-between p-4 safe-area-pt",children:[t.jsx("button",{onClick:()=>{be(),z(!1),R("products")},className:"p-2 rounded-lg hover:bg-gray-100 transition-all active:scale-95",children:t.jsx(te,{size:24,className:"text-gray-600"})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:t.jsx(ne,{className:"w-5 h-5 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Shopping Cart"}),t.jsxs("p",{className:"text-xs text-gray-600",children:[e.length," items in cart"]})]})]}),t.jsx("button",{onClick:()=>{0!==e.length?(ve(),u(),G.success("Cart cleared")):G.error("Cart is already empty")},className:"text-red-500 text-sm font-bold hover:bg-red-50 px-3 py-2 rounded-lg transition-all active:scale-95",disabled:0===e.length,children:"Clear"})]})}),t.jsx("div",{className:"bg-white border-b border-gray-200 p-4 flex-shrink-0",children:s?t.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border-2 border-blue-200 hover:border-blue-300 transition-all duration-300",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-base shadow-sm",children:s.name.charAt(0)}),t.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full border-2 border-white flex items-center justify-center shadow-sm "+("vip"===s.colorTag||"vip"===s.loyaltyLevel||"premium"===s.loyaltyLevel?"bg-amber-500":"bg-emerald-500"),children:t.jsx(ie,{className:"w-3 h-3 text-white"})})]}),t.jsxs("div",{children:[t.jsx("div",{className:"font-bold text-gray-900",children:s.name}),t.jsxs("div",{className:"text-sm text-gray-700 flex items-center gap-2 mt-0.5",children:[t.jsx(oe,{className:"w-3.5 h-3.5"}),s.phone]}),t.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold "+("vip"===s.colorTag||"vip"===s.loyaltyLevel||"premium"===s.loyaltyLevel?"bg-amber-100 text-amber-800 border-2 border-amber-300":"bg-emerald-100 text-emerald-800 border-2 border-emerald-300"),children:"vip"===s.colorTag||"vip"===s.loyaltyLevel||"premium"===s.loyaltyLevel?"VIP":"Active"}),t.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-semibold text-gray-800 bg-white px-3 py-1 rounded-full border-2 border-gray-200 shadow-sm",children:[t.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),s.points," points"]})]})]})]}),t.jsx("button",{onClick:()=>{ve(),p()},className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-all duration-200",children:t.jsx(me,{className:"w-5 h-5"})})]})}):t.jsxs("button",{onClick:()=>{be(),g()},className:"w-full flex items-center justify-center gap-3 p-4 text-base border-2 border-blue-200 rounded-xl bg-white text-gray-900 hover:border-blue-300 transition-all duration-200",children:[t.jsx(K,{className:"w-5 h-5 text-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"Search Customer"}),t.jsx(re,{className:"w-4 h-4 text-blue-500"})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 mobile-scroll",children:0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(ne,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cart is empty"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Add products to start a transaction"})]}):t.jsx("div",{className:"space-y-3 pb-32",children:e.map(e=>t.jsx(At,{item:e,onQuantityChange:t=>o(e.id,t),onRemove:()=>c(e.id)},e.id))})}),e.length>0&&t.jsx("div",{className:"border-t-2 border-gray-300 bg-white flex-shrink-0 pb-safe shadow-lg",children:t.jsxs("div",{className:"p-4 space-y-3",children:[t.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50 border-2 border-gray-200 rounded-xl p-4 space-y-3 shadow-sm",children:[t.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[t.jsx("span",{className:"text-base font-bold text-gray-900",children:"Quantity:"}),t.jsx("span",{className:"text-lg font-extrabold text-gray-900",children:_e})]}),t.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[t.jsxs("span",{className:"text-base font-bold text-gray-900",children:["Subtotal (",_e," ",1===_e?"item":"items","):"]}),t.jsxs("span",{className:"text-lg font-extrabold text-gray-900",children:["TZS ",N.toLocaleString()]})]}),t.jsx("div",{className:"space-y-2",children:w>0?t.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-100 border-2 border-green-300 rounded-lg shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-green-200 rounded-lg",children:t.jsx(ue,{className:"w-5 h-5 text-green-700"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-extrabold text-green-900",children:"Discount Applied"}),t.jsxs("div",{className:"text-sm font-bold text-green-700",children:["-TZS ",w.toLocaleString()]})]})]}),t.jsx("button",{onClick:()=>{ve(),G.success("Discount removed")},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-100 rounded-lg transition-colors",title:"Remove Discount",children:t.jsx(me,{className:"w-5 h-5"})})]}):t.jsxs("button",{onClick:()=>{be(),j()},className:"w-full flex items-center justify-center gap-2 p-4 border-3 border-dashed border-purple-300 rounded-xl text-purple-700 hover:border-purple-500 hover:text-purple-800 hover:bg-purple-100 transition-all duration-200 shadow-sm bg-purple-50",children:[t.jsx("div",{className:"p-1.5 bg-purple-200 rounded-lg",children:t.jsx(ue,{className:"w-5 h-5"})}),t.jsx("span",{className:"text-base font-extrabold",children:"Add Discount"})]})}),D&&t.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-300",children:[t.jsxs("span",{className:"text-base font-bold text-gray-900",children:["Tax (VAT ",T,"%):"]}),t.jsxs("span",{className:"text-lg font-extrabold text-gray-900",children:["TZS ",S.toLocaleString()]})]}),t.jsxs("div",{className:"flex justify-between items-center bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 rounded-lg p-3 shadow-md",children:[t.jsx("span",{className:"text-xl font-extrabold text-gray-900",children:"Total:"}),t.jsxs("span",{className:"text-2xl font-black text-green-600",children:["TZS ",C.toLocaleString()]})]})]}),!s&&t.jsx("div",{className:"p-4 bg-gradient-to-r from-amber-100 to-orange-100 border-3 border-amber-400 rounded-xl shadow-md",children:t.jsxs("div",{className:"flex items-center gap-3 text-base text-amber-900",children:[t.jsx("div",{className:"w-3 h-3 bg-amber-600 rounded-full animate-pulse"}),t.jsx("span",{className:"font-extrabold",children:"Please select a customer to proceed"})]})}),t.jsx("button",{onClick:()=>{s?(ye(),m()):G.error("Please select a customer first")},disabled:0===e.length||!s||k,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 shadow-lg",title:s?0===e.length?"Add items to cart first":"Process payment":"Please select a customer first",children:k?"Processing...":"Process Payment"})]})})]});return t.jsxs("div",{className:"h-screen flex flex-col overflow-hidden",style:{background:"transparent"},children:[t.jsx(Se,{}),t.jsxs("div",{className:"flex-1 overflow-hidden",children:["products"===M&&!U&&t.jsxs("div",{className:"h-full flex flex-col",style:{background:"transparent"},children:[t.jsx("div",{className:"border-b border-gray-200 shadow-sm flex-shrink-0",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)"},children:t.jsxs("div",{className:"px-4 py-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"font-bold text-gray-800 text-xl flex items-center gap-2",children:[t.jsx(Y,{className:"w-6 h-6 text-green-600"}),"Products"]}),t.jsxs("p",{className:"text-sm text-gray-600 mt-0.5",children:[ke.length," ",1===ke.length?"product":"products"," available"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{const e="desktop"===se?"mobile":"desktop";ae(e),localStorage.setItem("pos_view_mode",e),be(),G.success(`Switched to ${e} view`,{icon:"mobile"===e?"ðŸ“±":"ðŸ–¥ï¸",duration:2e3}),window.dispatchEvent(new Event("viewModeChanged")),window.dispatchEvent(new Event("resize"))},className:"p-2 rounded-lg transition-all shadow-sm "+("mobile"===se?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),title:"mobile"===se?"Switch to Desktop View":"Switch to Mobile View",children:"mobile"===se?t.jsx(B,{size:18}):t.jsx(Z,{size:18})}),t.jsxs("div",{className:"flex gap-1 bg-gray-100 rounded-lg p-1",children:[t.jsx("button",{onClick:()=>{be(),Q("grid")},className:"p-2 rounded-lg transition-all "+("grid"===V?"bg-white shadow-sm text-blue-600":"text-gray-600"),title:"Grid View",children:t.jsx(Ze,{size:18})}),t.jsx("button",{onClick:()=>{be(),Q("list")},className:"p-2 rounded-lg transition-all "+("list"===V?"bg-white shadow-sm text-blue-600":"text-gray-600"),title:"List View",children:t.jsx(ee,{size:18})})]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Search products by name, SKU...",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"}),r&&t.jsx("button",{onClick:()=>l(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:t.jsx(te,{size:18})})]}),I&&t.jsx("div",{className:"mt-3 flex gap-2",children:t.jsxs("button",{onClick:()=>{be(),b()},className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white font-medium rounded-lg active:scale-95 transition-all shadow-sm",children:[t.jsx($,{size:16}),t.jsx("span",{className:"text-sm",children:"Scan Barcode"})]})})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto pb-20 mobile-scroll",children:0===ke.length?t.jsx("div",{className:"flex items-center justify-center h-full p-6",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:t.jsx(Y,{className:"w-12 h-12 text-gray-400"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),t.jsx("p",{className:"text-gray-600 mb-4",children:r?`No products match "${r}"`:"No products available in the database"}),r&&t.jsx("button",{onClick:()=>l(""),className:"px-4 py-2 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition-colors",children:"Clear Search"})]})}):t.jsx("div",{className:"p-3",children:t.jsx(ys,{products:ke,onAddToCart:(e,t,s)=>{i(e,t,s),fe(),G.success(`Added ${e.name} to cart`)},isLoading:!1,minCardWidth:200,maxColumns:3,enableDynamicGrid:!0})})})]}),"customers"===M&&t.jsxs("div",{className:"h-full overflow-y-auto pb-20",style:{background:"transparent"},children:[t.jsx("div",{className:"sticky top-0 z-10 px-4 py-4 shadow-sm",style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)"},children:t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-gray-900 text-xl",children:"Customer Management"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Manage your customer database"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{be(),g()},className:"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"Search Customers",children:t.jsx(K,{size:18})}),t.jsx("button",{onClick:()=>{be(),h()},className:"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors",title:"Add New Customer",children:t.jsx(re,{size:18})})]})]})}),t.jsxs("div",{className:"p-4 space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Overview"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(de,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Customers"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"1,247"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1,200 active"})]})]})}),t.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ne,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Points"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"128K"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"102 avg"})]})]})}),t.jsx("div",{className:"bg-purple-50 rounded-lg p-5 hover:bg-purple-100 transition-colors",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ie,{className:"w-7 h-7 text-purple-600 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"VIP Members"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"45"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"3.6% of total"})]})]})}),t.jsx("div",{className:"bg-orange-50 rounded-lg p-5 hover:bg-orange-100 transition-colors",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ie,{className:"w-7 h-7 text-orange-600 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Revenue"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"TSh 8.2M"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"from customers"})]})]})})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Search & Filter"}),t.jsx("div",{className:"backdrop-blur-xl rounded-xl border p-4 transition-all duration-300",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search customers by name, phone, or email...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm bg-white"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Qe,{className:"w-5 h-5 text-gray-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filter:"})]}),t.jsxs("div",{className:"flex flex-wrap rounded-full bg-gray-100 p-1 gap-1",children:[t.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors bg-blue-500 text-white",children:"All"}),t.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors text-gray-600 hover:text-gray-900",children:"Platinum"}),t.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors text-gray-600 hover:text-gray-900",children:"Gold"}),t.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors text-gray-600 hover:text-gray-900",children:"Silver"}),t.jsx("button",{className:"px-3 py-1.5 text-xs font-medium rounded-full transition-colors text-gray-600 hover:text-gray-900",children:"Bronze"})]})]})]})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between px-2",children:[t.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide",children:"Customer List"}),t.jsxs("button",{onClick:()=>{be(),g()},className:"text-blue-600 text-xs font-semibold hover:text-blue-700 flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-blue-50 transition-colors",children:[t.jsx("span",{children:"View All"}),t.jsx("span",{className:"bg-blue-100 px-1.5 py-0.5 rounded-full text-blue-700",children:he.toLocaleString()})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:xe?t.jsxs("div",{className:"col-span-2 text-center py-8",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading customers..."})]}):le.length>0?le.map(e=>(e=>{const s=e.name.charAt(0).toUpperCase(),a=e.location||e.city||"N/A";return t.jsx("div",{onClick:()=>{be(),X({id:e.id,name:e.name,phone:e.phone}),H(!0)},className:`relative bg-white border border-gray-200 rounded-lg cursor-pointer transition-all duration-200 hover:border-${e.tierColor}-500`,children:t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("div",{className:`w-10 h-10 ${l=e.tierColor,{purple:"bg-purple-500",yellow:"bg-yellow-500",gray:"bg-gray-500",orange:"bg-orange-500",blue:"bg-blue-500",green:"bg-green-500",pink:"bg-pink-500",cyan:"bg-cyan-500"}[l]||"bg-blue-500"} rounded-lg flex items-center justify-center text-white font-bold text-sm`,children:s}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-semibold text-gray-900 truncate text-sm",children:e.name}),t.jsx("p",{className:"text-xs text-blue-600 font-medium truncate",children:e.phone})]})]}),t.jsxs("div",{className:"flex items-center gap-1 mb-2 justify-center",children:[t.jsx(Ne,{className:`w-3 h-3 text-${e.tierColor}-500 fill-current`}),t.jsx("span",{className:"text-xs text-gray-700 font-semibold capitalize",children:e.loyaltyTier})]}),"N/A"!==a&&t.jsx("div",{className:"space-y-1 mb-3",children:t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[t.jsx("span",{className:"text-gray-400",children:"ðŸ“"}),t.jsx("span",{className:"truncate",children:a})]})}),t.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ne,{className:"w-3 h-3 text-gray-400"}),t.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:[e.loyalty_points||0," pts"]})]}),t.jsx("div",{className:"text-xs font-bold text-gray-900",children:(r=e.totalSpent,r>=1e6?`TZS ${(r/1e6).toFixed(1)}M`:r>=1e3?`TZS ${(r/1e3).toFixed(0)}K`:`TZS ${r.toLocaleString()}`)})]})]})},e.id);var r,l})(e)):t.jsxs("div",{className:"col-span-2 text-center py-8",children:[t.jsx(de,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-gray-600",children:"No customers found"}),t.jsx("button",{onClick:()=>{be(),h()},className:"mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium",children:"Add First Customer"})]})}),t.jsxs("button",{onClick:()=>{be(),g(),G.success("Opening customer search...",{icon:"ðŸ”",duration:2e3})},className:"w-full px-4 py-3 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center gap-2",children:[t.jsx(K,{size:18}),t.jsxs("span",{children:["View All Customers (",he.toLocaleString(),")"]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Loyalty Program"}),t.jsxs("div",{className:"backdrop-blur-xl rounded-xl border p-4 transition-all duration-300 hover:shadow-xl",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Membership Tiers"}),t.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[t.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"font-semibold text-purple-900",children:"Platinum"}),t.jsx("span",{className:"text-sm font-medium text-purple-500",children:"10% OFF"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Points Range:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:"1,000+"})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Benefits:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:"Priority + Exclusive"})]})]})]}),t.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"font-semibold text-yellow-900",children:"Gold"}),t.jsx("span",{className:"text-sm font-medium text-yellow-600",children:"7% OFF"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Points Range:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:"500-999"})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Benefits:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:"Special + Birthday"})]})]})]}),t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"font-semibold text-gray-900",children:"Silver"}),t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"5% OFF"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Points Range:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:"200-499"})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Benefits:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:"Regular + Perks"})]})]})]})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Analytics & Insights"}),t.jsxs("div",{className:"backdrop-blur-xl rounded-xl border p-4 transition-all duration-300 hover:shadow-xl",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Performance Metrics"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Return Rate"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"68%"})]}),t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Avg Rating"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"4.2â˜…"})]}),t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"New This Month"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"+156"})]}),t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Active Today"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"89"})]})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:()=>{be(),g()},className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm",children:[t.jsx(K,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Search"})]}),t.jsxs("button",{onClick:()=>{be(),h()},className:"flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium bg-green-600 text-white hover:bg-green-700 transition-colors text-sm",children:[t.jsx(re,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"New"})]}),t.jsxs("button",{className:"flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors text-sm",children:[t.jsx(Ee,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Export"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide px-2",children:"Best Practices"}),t.jsxs("div",{className:"backdrop-blur-xl rounded-xl border p-5 transition-all duration-300 hover:shadow-xl",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Customer Management Tips"}),t.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[t.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-1.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Keep customer data updated regularly"})]})}),t.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-1.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Use loyalty programs to increase retention"})]})}),t.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full mt-1.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Track purchase patterns for better service"})]})}),t.jsx("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full mt-1.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Send personalized messages to VIP customers"})]})})]})]})]})]})]}),"more"===M&&t.jsx("div",{className:"h-full overflow-y-auto p-4 pb-20",style:{background:"transparent"},children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-lg font-bold mb-3",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)",padding:"12px",borderRadius:"12px",color:"#111827"},children:"Quick Actions"}),t.jsxs("button",{onClick:()=>{be(),v()},className:"w-full py-4 bg-blue-500 text-white font-semibold rounded-xl active:bg-blue-600 transition-colors flex items-center justify-center gap-2 shadow-sm",children:[t.jsx($e,{size:18}),"View Sales Reports"]}),t.jsxs("button",{onClick:()=>{be(),f()},className:"w-full py-4 bg-green-500 text-white font-semibold rounded-xl active:bg-green-600 transition-colors flex items-center justify-center gap-2 shadow-sm",children:[t.jsx($e,{size:18}),"View Receipts"]}),((null==(E=null==L?void 0:L.permissions)?void 0:E.includes("all"))||(null==(A=null==L?void 0:L.permissions)?void 0:A.includes("view_settings"))||"admin"===(null==L?void 0:L.role))&&t.jsxs("button",{onClick:()=>{be(),y()},className:"w-full py-4 bg-gray-700 text-white font-semibold rounded-xl active:bg-gray-800 transition-colors flex items-center justify-center gap-2 shadow-sm",children:[t.jsx(q,{size:18}),"POS Settings"]}),t.jsxs("div",{className:"mt-6 p-4 rounded-xl shadow-sm border border-gray-200",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)"},children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Today's Summary"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Date:"}),t.jsx("span",{className:"font-medium",children:(new Date).toLocaleDateString()})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Time:"}),t.jsx("span",{className:"font-medium",children:(new Date).toLocaleTimeString()})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Cart Items:"}),t.jsx("span",{className:"font-medium",children:je})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Cart Total:"}),t.jsxs("span",{className:"font-medium",children:["TSh ",we.toLocaleString()]})]}),t.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-200",children:[t.jsx("span",{className:"text-gray-900 font-semibold",children:"Today's Sales:"}),t.jsxs("span",{className:"font-bold text-green-600",children:["TSh ",P.toLocaleString()]})]})]})]})]})})]}),t.jsx(Ce,{}),t.jsx(Pe,{}),J&&t.jsx(vs,{isOpen:W,onClose:()=>{H(!1),X(null)},customerId:J.id,customerName:J.name,customerPhone:J.phone}),t.jsx("style",{children:"\n        .pb-safe {\n          padding-bottom: env(safe-area-inset-bottom);\n        }\n        .mobile-scroll {\n          -webkit-overflow-scrolling: touch;\n          overscroll-behavior: contain;\n        }\n      "})]})},Ns=k.lazy(()=>e(()=>import("./POSSettingsModal-d1fa822f.js"),["assets/POSSettingsModal-d1fa822f.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css","assets/useBodyScrollLock-0216d39f.js","assets/format-0f0b2647.js","assets/useBusinessInfo-13b9c3ff.js","assets/rbac-bc517d81.js","assets/usePOSClickSounds-710a2a1b.js","assets/VariantProductCard-5f79965a.js","assets/robustImageService-2422a1f9.js","assets/productUtils-6e390a72.js","assets/GlassBadge-18f019e2.js","assets/utils-fb833cf6.js","assets/charts-66cc82bb.js","assets/SafeImage-bfaf74c6.js","assets/specificationUtils-8355804c.js","assets/PriceInput-e1556d5b.js","assets/CategoryInput-bba1731d.js","assets/AddCustomerModal-a69277f6.js","assets/CustomerForm-05944812.js","assets/phoneUtils-1ba19aca.js","assets/useSuccessModal-e8b7d685.js","assets/SuccessModalIcons-20b743c5.js","assets/search-674d386b.js","assets/ShareReceiptModal-4bab199d.js","assets/CustomerDetailModal-9e075bf1.js","assets/appointments-4d8aac45.js","assets/Modal-ccfa5014.js","assets/returns-0428af68.js","assets/whatsappService-37f3bd6b.js","assets/AppointmentModal-4524caae.js","assets/index-0096d614.js","assets/pdf-33d2fdad.js","assets/GlassInput-ba5c3c0d.js","assets/installmentService-e14bbda4.js","assets/TradeInContractModal-dd90079f.js","assets/toPropertyKey-7f87613e.js","assets/tradeInApi-966791f7.js","assets/paymentTrackingService-7b6db13e.js","assets/PaymentsPopupModal-70ab4c91.js","assets/draftService-0e50dcac.js"])),ws=k.lazy(()=>e(()=>import("./POSDiscountModal-2f614292.js"),["assets/POSDiscountModal-2f614292.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css","assets/useBodyScrollLock-0216d39f.js"])),Ss=k.lazy(()=>e(()=>import("./POSReceiptModal-d3703863.js"),["assets/POSReceiptModal-d3703863.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css","assets/useBluetoothPrinter-08dc31b9.js","assets/useBusinessInfo-13b9c3ff.js","assets/useBodyScrollLock-0216d39f.js"])),Cs=()=>t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),t.jsx("p",{className:"mt-4 text-center text-gray-600",children:"Loading..."})]})}),ks=_.forwardRef((e,s)=>t.jsx(_.Suspense,{fallback:t.jsx(Cs,{}),children:t.jsx(Ns,{...e,ref:s})}));ks.displayName="POSSettingsModalWrapper";const _s=e=>t.jsx(_.Suspense,{fallback:t.jsx(Cs,{}),children:t.jsx(ws,{...e})}),Ps=e=>t.jsx(_.Suspense,{fallback:t.jsx(Cs,{}),children:t.jsx(Ss,{...e})}),Ds=({isOpen:e,onClose:a,onLoadDraft:r,currentDraftId:l})=>{const[n,i]=_.useState([]),[d,c]=_.useState(!1),[m,u]=_.useState(null);_.useEffect(()=>{e&&x()},[e]);const x=()=>{c(!0);try{const e=wt.getAllDrafts();i(e)}catch(e){}finally{c(!1)}},g=e=>e.reduce((e,t)=>{var s,a;return e+(t.unitPrice||(null==(a=null==(s=t.variants)?void 0:s[0])?void 0:a.price)||0)*(t.quantity||1)},0);return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsx(o,{className:"w-full max-w-4xl max-h-[90vh] overflow-hidden",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ve,{className:"w-6 h-6 text-blue-500"}),t.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Saved Drafts"})]}),t.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:t.jsx(te,{className:"w-5 h-5"})})]}),d?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):0===n.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ve,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 text-lg",children:"No saved drafts found"}),t.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Your cart will be automatically saved as a draft when you close the page"})]}):t.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:n.map(e=>{return t.jsx("div",{className:`p-4 border rounded-lg transition-all cursor-pointer ${(null==m?void 0:m.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"} ${l===e.id?"ring-2 ring-green-500":""}`,onClick:()=>(e=>{u(e)})(e),children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(ve,{className:"w-4 h-4 text-gray-500"}),t.jsx("span",{className:"text-sm text-gray-500",children:(r=e.updatedAt,new Date(r).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}),l===e.id&&t.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"Current"})]}),t.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Y,{className:"w-4 h-4 text-gray-500"}),t.jsxs("span",{children:[(a=e.cartItems,a.reduce((e,t)=>e+(t.quantity||1),0))," items"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-gray-500",children:"Total:"}),t.jsxs("span",{className:"font-semibold",children:["KES ",g(e.cartItems).toLocaleString()]})]}),e.customer&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(de,{className:"w-4 h-4 text-gray-500"}),t.jsx("span",{children:e.customer.name})]})]}),e.notes&&t.jsxs("p",{className:"text-sm text-gray-600 mt-2 italic",children:['"',e.notes,'"']})]}),t.jsx("div",{className:"flex items-center gap-2 ml-4",children:t.jsx(s,{size:"sm",variant:"outline",onClick:t=>{var s;t.stopPropagation(),s=e.id,window.confirm("Are you sure you want to delete this draft?")&&wt.deleteDraft(s)&&x()},className:"text-red-600 hover:text-red-700",children:t.jsx(U,{className:"w-4 h-4"})})})]})},e.id);var a,r})}),m&&t.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Se,{className:"w-5 h-5 text-blue-600"}),t.jsx("span",{className:"font-semibold text-blue-800",children:"Load this draft?"})]}),t.jsx("p",{className:"text-sm text-blue-700 mb-4",children:"This will replace your current cart with the selected draft."}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(s,{onClick:()=>{m&&(r(m),a())},className:"bg-blue-600 hover:bg-blue-700",children:[t.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Load Draft"]}),t.jsx(s,{variant:"outline",onClick:()=>u(null),children:"Cancel"})]})]}),t.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[t.jsxs("span",{children:[n.length," draft",1!==n.length?"s":""," saved"]}),t.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete all drafts?")&&(wt.clearAllDrafts(),x())},className:"text-red-600 hover:text-red-700",children:"Clear All"})]})})]})})}):null},Ts=({draftCount:e,onViewDrafts:a,onDismiss:r,isVisible:l})=>l&&0!==e?t.jsx("div",{className:"fixed top-4 right-4 z-40 animate-in slide-in-from-right duration-300",children:t.jsx(o,{className:"p-4 shadow-lg border-l-4 border-blue-500",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(ve,{className:"w-5 h-5 text-blue-500"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-sm font-medium text-gray-800",children:[e," saved draft",1!==e?"s":""," available"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You can continue from where you left off"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(s,{size:"sm",onClick:a,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[t.jsx(Ee,{className:"w-4 h-4 mr-1"}),"View"]}),t.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:t.jsx(te,{className:"w-4 h-4 text-gray-500"})})]})]})})}):null,Is={enableDelivery:!1,enableLoyaltyProgram:!0,enableCustomerProfiles:!0,enablePaymentTracking:!0,enableDynamicPricing:!0},Es=k.lazy(()=>e(()=>import("./TradeInCalculator-fb3e1cc9.js"),["assets/TradeInCalculator-fb3e1cc9.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css","assets/tradeInApi-966791f7.js","assets/format-0f0b2647.js"])),As=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var s,r,l;const n=A(),{playClickSound:i,playPaymentSound:o,playDeleteSound:c}=We(),{isMobile:m,isTablet:u,deviceType:g}=xs(),[P,T]=_.useState(()=>{const e=localStorage.getItem("pos_view_mode");return"mobile"===e||"desktop"===e?e:"auto"});_.useEffect(()=>{const e=()=>{const e=localStorage.getItem("pos_view_mode");"mobile"!==e&&"desktop"!==e||T(e)};window.addEventListener("storage",e);const t=()=>e();return window.addEventListener("viewModeChanged",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("viewModeChanged",t)}},[]);const E="auto"===P?m:"mobile"===P,L=_.useRef(!1);_.useEffect(()=>{L.current,0},[m,u,g,P,E]);const[F,O]=_.useState(null),{sales:$}=h(),M=_.useMemo(()=>{if(F){return $.filter(e=>e.created_at&&e.created_at>=F).reduce((e,t)=>e+("number"==typeof t.total_amount?t.total_amount:parseFloat(t.total_amount)||0),0)}const e=(new Date).toISOString().split("T")[0];return $.filter(t=>{if(!t.created_at)return!1;return("string"==typeof t.created_at?t.created_at:new Date(t.created_at).toISOString()).startsWith(e)}).reduce((e,t)=>e+("number"==typeof t.total_amount?t.total_amount:parseFloat(t.total_amount)||0),0)},[$,F]);_.useEffect(()=>{0},[F]);const{customers:R}=p(),{currentUser:U}=a();x();const z=St(),q=null==U?void 0:U.role,V=D.canUser(U,"pos","view"),B=D.canUser(U,"pos","sell");D.canUser(U,"pos","refund"),D.canUser(U,"pos","void"),D.canUser(U,"pos-inventory","view");const Z=D.canUser(U,"pos-inventory","search"),Q=D.canUser(U,"pos-inventory","add-to-cart"),W=D.canUser(U,"sales","create");D.canUser(U,"sales","view"),D.canUser(U,"sales","edit"),D.canUser(U,"sales","delete"),D.canUser(U,"sales","refund");const{settings:K}=b(),{settings:H}=f(),{settings:Y}=y(),{settings:J}=v();(e=>{const[t,s]=_.useState(e.deliveryMethod||"standard"),[a,r]=_.useState(e.deliveryDistance||0),[l,n]=_.useState(0),i=_.useCallback((s,r)=>{var l;if(!(null==e?void 0:e.enable_delivery))return{baseFee:0,methodMultiplier:1,distanceFee:0,timeMultiplier:1,orderDiscount:1,finalFee:0,isFreeDelivery:!1,breakdown:{base:0,method:0,distance:0,time:0,discount:0}};if(s>=e.free_delivery_threshold)return{baseFee:e.default_delivery_fee,methodMultiplier:1,distanceFee:0,timeMultiplier:1,orderDiscount:1,finalFee:0,isFreeDelivery:!0,breakdown:{base:0,method:0,distance:0,time:0,discount:0}};let n=e.default_delivery_fee||2e3;e.enable_delivery_areas&&r&&(null==(l=e.area_delivery_fees)?void 0:l[r])&&(n=e.area_delivery_fees[r]);let i=1,o=0,d=1,c=1;switch(t){case"express":i=1.5;break;case"same-day":i=2;break;default:i=1}a>0&&(o=500*Math.ceil(a/5));const m=(new Date).getHours();m>=17&&m<=19?d=1.2:(m>=22||m<=6)&&(d=1.3),s>=5e4?c=.8:s>=25e3&&(c=.9);const u=n*i,x=u*d,g=x+o,h=Math.round(g*c);return{baseFee:n,methodMultiplier:i,distanceFee:o,timeMultiplier:d,orderDiscount:c,finalFee:h,isFreeDelivery:!1,breakdown:{base:n,method:u-n,distance:o,time:x-u,discount:g-h}}},[e,t,a]),o=_.useCallback(e=>{s(e)},[]),d=_.useCallback(e=>{r(e)},[]),c=_.useCallback(e=>{switch(e){case"express":return{name:"Express Delivery",time:"1-2 business days",multiplier:1.5};case"same-day":return{name:"Same Day Delivery",time:"Same day",multiplier:2};default:return{name:"Standard Delivery",time:"2-3 business days",multiplier:1}}},[]),m=_.useCallback(()=>{const e=(new Date).getHours();return e>=17&&e<=19?{type:"rush_hour",name:"Rush Hour",multiplier:1.2,description:"5 PM - 7 PM"}:e>=22||e<=6?{type:"late_night",name:"Late Night",multiplier:1.3,description:"10 PM - 6 AM"}:{type:"normal",name:"Normal Hours",multiplier:1,description:"Regular pricing"}},[]),u=_.useCallback(e=>e>=5e4?{type:"large_order",name:"Large Order Discount",multiplier:.8,description:"Orders over 50K TZS"}:e>=25e3?{type:"medium_order",name:"Medium Order Discount",multiplier:.9,description:"Orders over 25K TZS"}:{type:"no_discount",name:"No Discount",multiplier:1,description:"Standard pricing"},[])})(J),_.useState("");const{settings:X}=j(),{settings:ee}=N(),te=(null==K?void 0:K.products_per_page)||20,{products:se,categories:ae,loadProducts:re,loadCategories:le,loadSuppliers:ne,loadSales:ie}=h(),oe=_.useRef(!1),de=_.useRef(!1),[ce,me]=_.useState(new Map),ue=_.useMemo(()=>{if(0===se.length)return[];const e=se;return 0===ae.length?e.map(e=>{var t;const s=null==(t=e.variants)?void 0:t.map(t=>{const s=`${e.id}-${t.id}`,a=ce.get(s)||0,r=t.stockQuantity??t.quantity??0,l=Math.max(0,r-a);return{...t,quantity:l,stockQuantity:l,_originalQuantity:r}});return{...e,variants:s,categoryName:"Uncategorized",category:void 0}}):e.map(e=>{var t,s;const a=e.categoryId||e.category_id||(null==(t=e.category)?void 0:t.id);let r="Unknown Category",l=null;if(a&&ae.length>0&&(l=ae.find(e=>e.id===a),l&&(r=l.name)),!l&&e.name&&ae.length>0){const t=e.name.toLowerCase();l=ae.find(e=>{const s=e.name.toLowerCase();return t.includes(s)||s.includes(t)}),l&&(r=l.name)}const n=null==(s=e.variants)?void 0:s.map(t=>{const s=`${e.id}-${t.id}`,a=ce.get(s)||0,r=t.stockQuantity??t.quantity??0,l=Math.max(0,r-a);return{...t,quantity:l,stockQuantity:l,_originalQuantity:r}});return{...e,variants:n,categoryName:r,category:e.category||(l?{id:l.id,name:l.name,description:l.description,color:l.color}:void 0)}})},[se,ae,ce]);_.useEffect(()=>{if(se.length>0&&!oe.current){ue.length;se.length,oe.current=!0}else 0===se.length&&oe.current&&(oe.current=!1)},[se.length,ue.length]);const[xe,ge]=_.useState(!1),[he,pe]=_.useState(0),be=null==ee?void 0:ee.enable_caching,[fe,ye]=_.useState(1),[ve,je]=_.useState(1),[Ne,we]=_.useState(""),[Se,Ce]=_.useState(!1);((e,t)=>{const[s,a]=_.useState(e);_.useEffect(()=>{const s=setTimeout(()=>{a(e)},t);return()=>{clearTimeout(s)}},[e,t])})(Ne,(null==X?void 0:X.search_debounce_time)||300);const[ke,_e]=_.useState(""),[Pe,De]=_.useState(""),[Te,Ie]=_.useState({min:"",max:""}),[Ee,Ae]=_.useState("all"),[Le,Fe]=_.useState(!1),[Oe,$e]=_.useState("sales"),[Me,Re]=_.useState("desc"),[Ue,ze]=_.useState(!1),{features:qe,isDeliveryEnabled:Ve,isLoyaltyEnabled:Be,isCustomerProfilesEnabled:Ze,isPaymentTrackingEnabled:Qe,isDynamicPricingEnabled:Ge}=(()=>{const[e,t]=_.useState(Is),[s,a]=_.useState(!0);return _.useEffect(()=>{(()=>{try{const e=localStorage.getItem("lats-pos-features");if(e){const s=JSON.parse(e);t({...Is,...s})}}catch(e){}finally{a(!1)}})();const e=e=>{if("lats-pos-features"===e.key&&e.newValue)try{const s=JSON.parse(e.newValue);t({...Is,...s})}catch(s){}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[]),{features:e,isLoading:s,updateFeatures:s=>{const a={...e,...s};t(a),localStorage.setItem("lats-pos-features",JSON.stringify(a))},isDeliveryEnabled:()=>e.enableDelivery,isLoyaltyEnabled:()=>e.enableLoyaltyProgram,isCustomerProfilesEnabled:()=>e.enableCustomerProfiles,isPaymentTrackingEnabled:()=>e.enablePaymentTracking,isDynamicPricingEnabled:()=>e.enableDynamicPricing}})(),[Ke,He]=_.useState(""),[Ye,Je]=_.useState(!1),[Xe,et]=_.useState(!1),[st,at]=_.useState(!1),[rt,lt]=_.useState(!1),[nt,it]=_.useState(!1),[dt,ct]=_.useState(!1);_.useState(null);const[gt,ht]=_.useState([]),[bt,yt]=_.useState(!1),[vt,jt]=_.useState(null),[Nt,_t]=_.useState(null),[Tt,Et]=_.useState("");_.useState(new Set),_.useState([]),_.useState([]);const[At,Ot]=_.useState(!1),[Rt,Ut]=_.useState(!1),[qt,Bt]=_.useState(!1),[Zt,Qt]=_.useState(!1),[Wt,Gt]=_.useState(!1),[Kt,Ht]=_.useState(!1),[Xt,ts]=_.useState(!1),[as,ns]=_.useState(!1);_.useState("");const{saveDraft:is,loadDraft:os,getAllDrafts:ds,deleteCurrentDraft:cs,hasUnsavedChanges:ms,currentDraftId:us}=(({cartItems:e,customer:t,deliveryInfo:s,notes:a})=>{const[r,l]=_.useState(null),[n,i]=_.useState(!1);_.useEffect(()=>{if(e&&e.length>0){const r=setTimeout(()=>{try{const r=wt.savePOSDraft(e,t,s,a);l(r),i(!1)}catch(r){}},2e3);return()=>clearTimeout(r)}},[e,t,s,a]),_.useEffect(()=>{const t=wt.getLatestDraft();!t||e&&0!==e.length||l(t.id)},[e]);const o=_.useCallback(r=>{if(!e||0===e.length)return null;try{const n=wt.savePOSDraft(e,t,s,r||a);return l(n),i(!1),n}catch(n){return null}},[e,t,s,a]),d=_.useCallback(e=>(l(e.id),i(!1),e),[]),c=_.useCallback(()=>{if(r){const e=wt.deleteDraft(r);return e&&(l(null),i(!1)),e}return!1},[r]),m=_.useCallback(()=>{const e=wt.clearAllDrafts();return e&&(l(null),i(!1)),e},[]),u=_.useCallback(()=>wt.getAllDrafts(),[]),x=_.useCallback(()=>wt.hasDrafts(),[]),g=_.useCallback(()=>{i(!0)},[]);return{currentDraftId:r,hasUnsavedChanges:n,saveDraft:o,loadDraft:d,deleteCurrentDraft:c,clearAllDrafts:m,getAllDrafts:u,hasDrafts:x,markAsChanged:g}})({cartItems:gt,customer:vt}),[gs,hs]=_.useState(0),[ps,bs]=_.useState(!1),[fs,ys]=_.useState("percentage"),[vs,Ns]=_.useState("");_.useState({totalSales:0,totalTransactions:0,averageTransactionValue:0,topSellingProducts:[]}),_.useState(!1),_.useState([]),_.useState({startTime:new Date,totalSales:0,totalTransactions:0});const[ws,Ss]=_.useState(!1),[Cs,As]=_.useState(""),[Ls,Fs]=_.useState(!1);_.useState([]),_.useState({header:"",footer:"",includeLogo:!0,includeQR:!0});const[Os,$s]=_.useState([]),[Ms,Rs]=_.useState(!1),[Us,zs]=_.useState(null),[qs,Vs]=_.useState("thermal"),[Bs,Zs]=_.useState(!1),[Qs,Ws]=_.useState(10),[Gs,Ks]=_.useState([]),[Hs,Ys]=_.useState(!1),[Js,Xs]=_.useState(!1),[ea,ta]=_.useState(!1),[sa,aa]=_.useState(!1),[ra,la]=_.useState(null),[na,ia]=_.useState(!1),[oa,da]=_.useState(!1),[ca,ma]=_.useState(!1),[ua,xa]=_.useState(!1),[ga,ha]=_.useState(null),[pa,ba]=_.useState({});_.useState({}),_.useState({});const[fa,ya]=_.useState(!1),[va,ja]=_.useState(null),[Na,wa]=_.useState(!1),[Sa,Ca]=_.useState(""),[ka,_a]=_.useState(""),[Pa,Da]=_.useState(!1),[Ta,Ia]=_.useState(!1),[Ea,Aa]=_.useState(!1),[La,Fa]=_.useState(!1),[Oa,$a]=_.useState(!1),[Ma,Ra]=_.useState(!1),[Ua,za]=_.useState(null),[qa,Va]=_.useState(null),[Ba,Za]=_.useState(0),Qa=_.useRef(null),[Wa,Ga]=_.useState(!1),Ka=_.useRef(null);_.useRef(null),_.useRef(null),_.useRef(null),_.useRef(null),_.useRef(null),_.useRef(null),_.useRef(null),_.useRef(null),_.useRef(null),_.useRef(null),_.useRef(null);const[Ha,Ya]=_.useState(!1),[Ja,Xa]=_.useState("general");_.useEffect(()=>{U&&Et(U.name||U.email||"POS User")},[U]),_.useEffect(()=>{window.SoundManager=w},[]),_.useEffect(()=>{!U||V||n("/dashboard")},[U,V,n]);const er=_.useMemo(()=>!!U&&(D.canUser(U,"reports","daily-close")||"admin"===U.role||"manager"===U.role||"owner"===U.role),[U]);if(_.useEffect(()=>{const e=(new Date).toDateString();localStorage.getItem("inventoryAlertsDismissedToday")===e?Xs(!0):(Xs(!1),localStorage.removeItem("inventoryAlertsDismissedToday"));const t=setInterval(()=>{const e=(new Date).toDateString(),t=localStorage.getItem("inventoryAlertsDismissedToday");t&&t!==e&&(Xs(!1),localStorage.removeItem("inventoryAlertsDismissedToday"))},6e4);return()=>clearInterval(t)},[]),_.useEffect(()=>{se.length>0&&ir()},[se,Qs]),_.useEffect(()=>{if(de.current)return;de.current=!0;(!xe||be&&Date.now()-he>3e5)&&(async()=>{try{const e=Date.now(),t=await Promise.allSettled([re({page:1,limit:200}),le()]),s=Date.now()-e;Promise.allSettled([ne(),ie()]).then(()=>{}).catch(e=>{});const a=t.map((e,t)=>"rejected"===e.status?["products","categories"][t]:null).filter(Boolean);a.length>0?G.error(`Failed to load: ${a.join(", ")}. Please refresh.`):s>15e3?G.success("POS ready! (Database took a moment to wake up)",{duration:3e3}):G.success("POS ready!",{duration:2e3}),ge(!0),pe(Date.now())}catch(e){G.error("Critical error loading POS data. Please refresh the page.")}})()},[xe,he,be,re,le,ne,ie]),_.useEffect(()=>{},[ae]),_.useEffect(()=>{(async()=>{})()},[]),!U||!V)return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-orange-50",children:t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"text-red-600 mb-4",children:t.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access the POS system."}),t.jsx("button",{onClick:()=>{i(),n("/dashboard")},className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Go to Dashboard"})]})});_.useEffect(()=>{const e=e=>{setTimeout(()=>{re()},500)},t=e=>{setTimeout(()=>{re(),ie()},500)},s=S.subscribe("lats:stock.updated",e),a=S.subscribe("lats:sale.completed",t);return window.addEventListener("stockUpdated",e),window.addEventListener("saleCompleted",t),()=>{s(),a(),window.removeEventListener("stockUpdated",e),window.removeEventListener("saleCompleted",t)}},[re,ie]);const tr=()=>{try{if(!vt)return void G.success("No customer to remove.");jt(null),G.success("Customer removed")}catch(e){G.error("Failed to remove customer. Please try again.")}},sr=()=>{Ze()?Qt(!0):G.error("Customer Profiles feature is disabled. Enable it in POS Settings > Features")},ar=()=>{Ze()?Bt(!0):G.error("Customer Profiles feature is disabled. Enable it in POS Settings > Features")},rr=()=>{Qe()?Ga(!0):G.error("Payment Tracking feature is disabled. Enable it in POS Settings > Features")},lr=()=>{Ge()?Da(!0):G.error("Dynamic Pricing feature is disabled. Enable it in POS Settings > Features")},nr=()=>{try{if(!Z)return;if(!(null==Y?void 0:Y.enable_barcode_scanner))return void G.error("QrCode scanning is not enabled in settings.");if(0===se.length)return void G.error("No products available for scanning. Please load products first.");Ss(!0),Fs(!0),As(""),G.success("QrCode scanner started. Scan a product barcode."),G.success("Please use your external barcode scanner device to scan products"),Fs(!1)}catch(e){G.error("Failed to start barcode scanner. Please try again."),Ss(!1),Fs(!1)}},ir=_.useCallback(()=>{try{const e=Qs||5,t=se.filter(t=>{var s;const a=(null==(s=t.variants)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0;return a<=e&&a>=0});if(t.length>0){const e=t.map(e=>{var t;return{productId:e.id,productName:e.name,currentStock:(null==(t=e.variants)?void 0:t.reduce((e,t)=>e+(t.quantity||0),0))||0,threshold:Qs||5,type:"low_stock"}});Ks(e);const s=e.some(e=>!Gs.some(t=>t.productId===e.productId&&t.currentStock===e.currentStock));if(Js){ta(!0);const e=setTimeout(()=>{ta(!1)},5e3);return()=>clearTimeout(e)}Hs&&!s||(Zs(!0),s&&Ys(!1))}else Ks([])}catch(e){G.error("Failed to check inventory levels")}},[se,Qs,Gs,Js,Hs]),or=(e=!1)=>{if(Zs(!1),Ys(!0),e){const e=(new Date).toDateString();localStorage.setItem("inventoryAlertsDismissedToday",e),Xs(!0)}};_.useEffect(()=>{if(Bs){const e=setTimeout(()=>{or()},1e4);return()=>clearTimeout(e)}},[Bs]),_.useEffect(()=>{(async()=>{var e,t,s,a,r,l,n,i,o,c,m,u,x,g,h,p,b,f;try{const v=(new Date).toISOString().split("T")[0];let j=null,N=null;try{const e=await d.from("daily_sales_closures").select("id, date, closed_at, closed_by").eq("date",v).maybeSingle();j=e.data,N=e.error}catch(y){if((null==(e=y.message)?void 0:e.includes("400"))||(null==(t=y.message)?void 0:t.includes("Bad Request"))||(null==(s=y.message)?void 0:s.includes("relation"))||(null==(a=y.message)?void 0:a.includes("does not exist")))return aa(!1),la(null),void O((new Date).toISOString())}if(N)if("PGRST116"===N.code);else if("42P01"===N.code||"42703"===N.code||(null==(r=N.message)?void 0:r.includes("400"))||(null==(l=N.message)?void 0:l.includes("Bad Request")))return aa(!1),la(null),void O((new Date).toISOString());if(j)aa(!0),la({closedAt:j.closed_at,closedBy:j.closed_by}),da(!0),O(null);else{let e=null,t=null;try{const s=await d.from("daily_opening_sessions").select("id, date, opened_at, opened_by").eq("date",v).eq("is_active",!0).maybeSingle();e=s.data,t=s.error}catch(y){if((null==(n=y.message)?void 0:n.includes("400"))||(null==(i=y.message)?void 0:i.includes("Bad Request"))||(null==(o=y.message)?void 0:o.includes("relation"))||(null==(c=y.message)?void 0:c.includes("does not exist")))return aa(!1),la(null),void O((new Date).toISOString())}if(t)if("PGRST116"===t.code);else if("42P01"===t.code||"42703"===t.code||(null==(m=t.message)?void 0:m.includes("400"))||(null==(u=t.message)?void 0:u.includes("Bad Request")))return aa(!1),la(null),void O((new Date).toISOString());if(e)aa(!1),la(null),O(e.opened_at);else{let e=null,t=null;try{const s=await d.from("daily_opening_sessions").insert([{date:v,opened_at:(new Date).toISOString(),opened_by:(null==U?void 0:U.role)||"system",opened_by_user_id:null==U?void 0:U.id,is_active:!0}]).select().single();e=s.data,t=s.error}catch(y){if((null==(x=y.message)?void 0:x.includes("400"))||(null==(g=y.message)?void 0:g.includes("Bad Request"))||(null==(h=y.message)?void 0:h.includes("relation"))||(null==(p=y.message)?void 0:p.includes("does not exist")))return O((new Date).toISOString()),aa(!1),void la(null)}if(t)if("42P01"===t.code||"42703"===t.code||(null==(b=t.message)?void 0:b.includes("400"))||(null==(f=t.message)?void 0:f.includes("Bad Request")))O((new Date).toISOString());else if("23505"===t.code)try{const{data:e,error:t}=await d.from("daily_opening_sessions").select("id, date, opened_at, opened_by").eq("date",v).eq("is_active",!0).maybeSingle();O(t?(new Date).toISOString():e?e.opened_at:(new Date).toISOString())}catch(y){O((new Date).toISOString())}else O((new Date).toISOString());else O(e?e.opened_at:(new Date).toISOString());aa(!1),la(null)}}}catch(y){aa(!1),la(null),O((new Date).toISOString())}})()},[U]);_.useEffect(()=>{Ms&&(async()=>{try{const e=$.map((e,t)=>{var s;return{id:e.id,saleId:e.id,date:e.created_at||e.soldAt||(new Date).toISOString(),total:e.total_amount||e.total||0,customer:e.customer_name||e.customerName||"Walk-in Customer",items:(null==(s=e.items)?void 0:s.length)||0}});$s(e)}catch(e){G.error("Failed to load receipt history")}})()},[Ms,$]);const dr=_.useCallback(async e=>{try{const{data:t}=await d.from("lats_product_variants").select("id, variant_name, name, is_parent, variant_type, quantity").eq("product_id",e.id).eq("is_active",!0).is("parent_variant_id",null).gt("quantity",0);if(!t||0===t.length)return!1;for(const e of t)if(e.is_parent||"parent"===e.variant_type){const{count:t}=await d.from("lats_product_variants").select("id",{count:"exact",head:!0}).eq("parent_variant_id",e.id).eq("variant_type","imei_child").eq("is_active",!0).gt("quantity",0);if(t&&t>0)return!0}return!1}catch(t){return!1}},[]),cr=_.useCallback(async(e,t,s=1)=>{var a;try{if(!Q)return void G.error("You do not have permission to add items to cart");if(!e||!e.id)return void G.error("Invalid product. Please try again.");if(!t||"default"===t.id){if(await dr(e))return void G.error("Please select a specific device variant first")}const r=(null==t?void 0:t.sellingPrice)??(null==t?void 0:t.price)??e.price,l="string"==typeof r?parseFloat(r):Number(r);if(null==l||isNaN(l)||l<0)return void G.error("Invalid product price. Please contact support.");const n=(null==t?void 0:t._originalQuantity)??(null==t?void 0:t.stockQuantity)??(null==t?void 0:t.quantity)??e.stockQuantity??e.quantity??0;if(n<=0)return void G.error(`${e.name} is out of stock`);const i=gt.find(s=>s.productId===e.id&&(!t||s.variantId===t.id));if(i){if(i.quantity+s>n)return void G.error(`Only ${n} units available for ${e.name}`);const a=i.quantity+s,r="string"==typeof i.unitPrice?parseFloat(i.unitPrice):Number(i.unitPrice),l=a*r;ht(e=>e.map(e=>e.id===i.id?{...e,quantity:a,totalPrice:l}:e));const o=`${e.id}-${(null==t?void 0:t.id)||"default"}`,d=(ce.get(o)||0)+s;me(e=>{const t=new Map(e);return t.set(o,d),t}),G.success(`${e.name} quantity updated to ${a}`)}else{const r={id:`${e.id}-${(null==t?void 0:t.id)||"default"}-${Date.now()}`,productId:e.id,variantId:(null==t?void 0:t.id)||"default",productName:e.name,variantName:(null==t?void 0:t.name)||"Default",sku:(null==t?void 0:t.sku)||e.sku||"N/A",quantity:s,unitPrice:l,totalPrice:l*s,availableQuantity:n,image:e.thumbnail_url||e.image,selectedIMEIVariants:t&&(null==(a=t.attributes)?void 0:a.imei)?[t]:[]};ht(e=>[...e,r]);const i=`${e.id}-${(null==t?void 0:t.id)||"default"}`,o=(ce.get(i)||0)+s;me(e=>{const t=new Map(e);return t.set(i,o),t}),n-o<=0&&G(`${e.name} is now out of stock`,{icon:"â„¹ï¸"}),G.success(`${s}x ${e.name} added to cart`)}}catch(r){G.error("Failed to add item to cart. Please try again.")}},[Q,gt,dr,ce]),mr=_.useCallback((e,t)=>{try{if(!e)return void G.error("Invalid item ID. Please try again.");if(t<0)return void G.error("Quantity cannot be negative.");if(0===t)return void xr(e);const s=gt.find(t=>t.id===e);if(!s)return void G.error("Item not found in cart.");if(t>s.availableQuantity)return void G.error(`Only ${s.availableQuantity} units available`);const a="string"==typeof s.unitPrice?parseFloat(s.unitPrice):Number(s.unitPrice),r=t*a,l=t-s.quantity,n=`${s.productId}-${s.variantId}`;ht(s=>s.map(s=>s.id===e?{...s,quantity:t,totalPrice:r}:s)),me(e=>{const t=new Map(e),s=(t.get(n)||0)+l;return s<=0?t.delete(n):t.set(n,s),t})}catch(s){G.error("Failed to update item quantity. Please try again.")}},[gt]),ur=_.useCallback((e,t)=>{try{if(!e)return void G.error("Invalid item ID. Please try again.");if(!gt.find(t=>t.id===e))return void G.error("Item not found in cart.");ht(s=>s.map(s=>s.id===e?{...s,tags:t}:s))}catch(s){G.error("Failed to update item tags. Please try again.")}},[gt]),xr=_.useCallback(e=>{try{if(!e)return void G.error("Invalid item ID. Please try again.");const t=gt.find(t=>t.id===e);if(t){ht(t=>t.filter(t=>t.id!==e));const s=`${t.productId}-${t.variantId}`;me(e=>{const a=new Map(e),r=(a.get(s)||0)-t.quantity;return r<=0?a.delete(s):a.set(s,r),a}),G.success(`${t.productName} removed from cart`)}else G.error("Item not found in cart.")}catch(t){G.error("Failed to remove item from cart. Please try again.")}},[gt]),gr=_.useCallback(()=>{try{if(0===gt.length)return void G.success("Cart is already empty.");ht([]),me(new Map),hs(0),Ns(""),ys("percentage"),G.success("Cart cleared successfully")}catch(e){G.error("Failed to clear cart. Please try again.")}},[gt]),hr=async()=>{try{if(!B||!W)return void G.error("You do not have permission to process sales");if(0===gt.length)return void G.error("Cart is empty. Please add items before processing payment.");const e=gt.filter(e=>!e.totalPrice||e.totalPrice<=0||isNaN(e.totalPrice)||!e.unitPrice||e.unitPrice<=0||isNaN(e.unitPrice));if(e.length>0)return void G.error(`Invalid prices found for: ${e.map(e=>e.productName).join(", ")}`);if(isNaN(fr)||fr<=0)return void G.error("Cart total is invalid. Please check item prices.");if(yr>=fr)return void G.error(`Discount (${tt.money(yr)}) cannot exceed total (${tt.money(fr)})`);if(wr<=0)return void G.error("Invalid total amount. Please check your cart items and discount.");!vt&&wr>5e4&&G.error("Customer information is recommended for payments over 50,000 TZS");const t=(await Promise.all(gt.map(async e=>{try{const{data:t}=await d.from("lats_product_variants").select("id, variant_attributes").eq("product_id",e.productId).not("variant_attributes->imei","is",null).eq("is_active",!0).gt("quantity",0).limit(1);if(t&&t.length>0){return{item:e,requiresIMEI:!0,hasSelected:e.selectedIMEIVariants&&e.selectedIMEIVariants.length>0}}return null}catch(t){return null}}))).filter(e=>null!==e&&e.requiresIMEI&&!e.hasSelected);if(t.length>0){const e=t.map(e=>e.item.productName).join(", ");return void G.error(`Please select IMEI/Serial numbers for: ${e}`)}if(sa)return void ia(!0);et(!0)}catch(e){G.error("Failed to initialize payment. Please try again.")}},pr=(null==K?void 0:K.tax_rate)||18,br=!1!==(null==K?void 0:K.enable_tax),fr=_.useMemo(()=>gt.reduce((e,t)=>{const s="string"==typeof t.totalPrice?parseFloat(t.totalPrice):Number(t.totalPrice||0);return isNaN(s)?e:e+s},0),[gt]),yr=gs||0,vr=fr>0?Math.round(yr/fr*100):0,jr=fr-yr,Nr=br?jr*pr/100:0,wr=jr+Nr,Sr=_.useCallback((e,t)=>{try{ys(e),Ns(t);const s="percentage"===e?fr*parseFloat(t)/100:parseFloat(t);hs(s),bs(!1),G.success("Discount applied successfully")}catch(s){G.error("Failed to apply discount. Please try again.")}},[fr]),Cr=null==Y?void 0:Y.enable_barcode_scanner;return E?t.jsxs(t.Fragment,{children:[t.jsx(js,{cartItems:gt,selectedCustomer:vt,searchQuery:Ne,onSearchChange:we,products:ue,onAddToCart:cr,onUpdateCartItemQuantity:mr,onRemoveCartItem:xr,onProcessPayment:hr,onClearCart:gr,onShowCustomerSearch:()=>sr(),onAddCustomer:()=>ar(),onRemoveCustomer:tr,onScanBarcode:nr,onViewReceipts:()=>alert("Receipts view coming soon!"),onToggleSettings:()=>Ya(!0),onViewSales:async()=>{await ie(),n("/lats/sales-reports")},onShowDiscountModal:()=>bs(!0),totalAmount:fr,discountAmount:yr,taxAmount:Nr,finalAmount:wr,isProcessingPayment:Ye,todaysSales:M,isTaxEnabled:br,taxRate:pr,isQrCodeScannerEnabled:Cr}),t.jsx(Ft,{isOpen:At,onClose:()=>Ot(!1),onProductAdded:e=>{cr(e),Ot(!1)}}),t.jsx(Mt,{isOpen:Zt,onClose:()=>Qt(!1),onCustomerSelect:e=>{jt(e),Qt(!1),G.success(`Customer "${e.name}" selected!`)},selectedCustomer:vt}),t.jsx(ot,{isOpen:qt,onClose:()=>Bt(!1),onCustomerCreated:e=>{jt(e),Bt(!1),G.success(`New customer "${e.name}" created and selected!`)},onAddAnother:()=>{Bt(!0)}}),t.jsx(zt,{isOpen:Wt,onClose:()=>Gt(!1),customer:vt,onCustomerUpdated:e=>{jt(e),Gt(!1),G.success("Customer updated successfully!")}}),t.jsx(xt,{isOpen:Kt,onClose:()=>Ht(!1),customer:vt,onEdit:e=>{Ht(!1),Gt(!0)}}),t.jsx(_s,{isOpen:ps,onClose:()=>bs(!1),onApplyDiscount:Sr,cartSubtotal:fr,discountValue:vs,setDiscountValue:Ns,discountType:fs,setDiscountType:ys,appliedDiscount:gs}),t.jsx(ks,{ref:Ka,isOpen:Ha,onClose:()=>Ya(!1)}),t.jsx(Vt,{isOpen:Pa,onClose:()=>Da(!1)}),t.jsx(ss,{isOpen:Wa,onClose:()=>Ga(!1)}),t.jsx(Ps,{isOpen:nt,onClose:()=>it(!1),receiptData:Nt,onShare:()=>ct(!0)}),t.jsx(ut,{isOpen:dt,onClose:()=>ct(!1),receiptData:Nt}),t.jsx(Ds,{isOpen:Xt,onClose:()=>ts(!1),drafts:ds(),onLoadDraft:os,onDeleteDraft:cs}),t.jsx(Ts,{drafts:ds(),onLoadDraft:e=>{os(e),G.success("Draft loaded successfully!")}}),t.jsx(I,{isOpen:ca,onClose:()=>ma(!1),onDayClosed:()=>{aa(!0),ma(!1),G.success("Day closed successfully!")},sessionStartTime:F}),t.jsx(ft,{isOpen:Xe,onClose:()=>et(!1),amount:Ba>0?wr-Ba:wr,customerId:null==vt?void 0:vt.id,customerName:(null==vt?void 0:vt.name)||"Walk-in Customer",description:`POS Sale - ${gt.length} items${Ba>0?` (Trade-In: -${tt.money(Ba)})`:""}`,onPaymentComplete:async(t,s)=>{var a,r;try{if(!t||0===t.length)throw new Error("No payment data received");const n=Ba>0?wr-Ba:wr,i=s||n;Math.abs(i-n);const c={customerId:(null==vt?void 0:vt.id)||null,customerName:(null==vt?void 0:vt.name)||"Walk-in Customer",customerPhone:(null==vt?void 0:vt.phone)||null,customerEmail:(null==vt?void 0:vt.email)||null,items:gt.map(e=>({id:e.id,productId:e.productId,variantId:e.variantId,productName:e.productName,variantName:e.variantName,sku:e.sku,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice,costPrice:0,profit:0,selectedSerialNumbers:e.selectedSerialNumbers||[]})),subtotal:fr,tax:Nr,discount:gs,discountType:fs,discountValue:parseFloat(vs)||0,total:wr,paymentMethod:{type:1===t.length?t[0].paymentMethod:"multiple",details:{payments:t.map(e=>({method:e.paymentMethod,amount:e.amount,accountId:e.paymentAccountId,reference:e.reference,notes:e.notes,timestamp:e.timestamp})),totalPaid:i},amount:i},paymentStatus:"completed",soldBy:Tt||"POS User",soldAt:(new Date).toISOString(),notes:t.map(e=>e.notes).filter(Boolean).join("; ")||void 0},m=await mt.processSale(c);if(m.success){const n=s||wr,i=null==(a=m.sale)?void 0:a.saleNumber,c=qa||Qa.current,u="admin"===q;if(c&&c.id)try{if(u){const{completeTradeInTransaction:t}=await e(()=>import("./tradeInApi-966791f7.js").then(e=>e.l),["assets/tradeInApi-966791f7.js","assets/vendor-a2ff445a.js","assets/index-222cfb29.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=await t(c.id);s.success?(Va(s.data),Qa.current=s.data):G.error("Warning: Failed to mark trade-in as completed")}else{const{data:e,error:t}=await d.from("lats_trade_in_transactions").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:(null==U?void 0:U.id)||null}).eq("id",c.id).select().single();!t&&e?(G.success("âœ… Trade-in submitted for admin review. Admin will add device to inventory with pricing."),Va(e),Qa.current=e):G.error("Warning: Failed to submit trade-in for approval")}}catch(l){G.error("Warning: Failed to update trade-in status")}const x={id:(null==(r=m.sale)?void 0:r.id)||"",date:(new Date).toLocaleDateString(),time:(new Date).toLocaleTimeString(),items:gt.map(e=>({productName:e.productName,variantName:e.variantName,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice,serialNumbers:e.selectedSerialNumbers||[]})),customer:vt?{name:vt.name,phone:vt.phone,email:vt.email}:null,subtotal:fr,tax:Nr,discount:gs,total:wr,paymentMethod:{name:1===t.length?t[0].paymentMethod:"Multiple Payments",description:1===t.length?`${t[0].paymentMethod} - ${tt.money(t[0].amount)}`:`${t.length} payment methods - ${tt.money(n)}`,icon:"ðŸ’³"},cashier:Tt||"POS User",receiptNumber:i||"N/A"};_t(x),et(!1),setTimeout(()=>{z.show(`Payment of ${tt.money(n)} processed successfully!${i?` Sale #${i}`:""}`,{title:"Sale Complete! ðŸŽ‰",icon:kt.paymentReceived,autoCloseDelay:0,actionButtons:[{label:"Share Receipt",onClick:()=>{lt(!0)},variant:"primary"},{label:"View Receipt",onClick:()=>{it(!0)},variant:"secondary"},{label:"Continue",onClick:()=>{z.hide()},variant:"secondary"}]})},50),setTimeout(()=>{gr(),hs(0),Ns(""),ys("percentage"),setDiscountPercentage(0),jt(null),loadTodaysSales(),o()},100)}else G.error(m.error||"Failed to process sale"),et(!1)}catch(l){if("ValidationError"===(null==l?void 0:l.name)||"PaymentValidationError"===(null==l?void 0:l.name))G.error(l.message||"Payment validation failed");else{if("UserCancelledError"!==(null==l?void 0:l.name))throw l;G("Payment cancelled",{icon:"âŒ",duration:2e3}),z.show("Payment was cancelled. Cart has been preserved.",{title:"Payment Received! ðŸ’°",icon:kt.paymentReceived,autoCloseDelay:3e3}),et(!1)}}}}),t.jsx(rs,{isOpen:na,onClose:()=>ia(!1),onContinue:()=>{ia(!1),et(!0)},closureTime:null==ra?void 0:ra.closedAt,closedBy:null==ra?void 0:ra.closedBy,userRole:null==U?void 0:U.role}),t.jsx(ls,{isOpen:oa,onClose:()=>da(!1),onDayOpened:e=>{O((new Date).toISOString()),aa(!1),da(!1),G.success("Day opened successfully!")}}),t.jsx(Ct,{...z})]}):t.jsxs("div",{className:"min-h-screen pos-auto-scale","data-pos-page":"true",children:[t.jsx(Pt,{}),t.jsx(Dt,{cartItemsCount:gt.length,totalAmount:fr,onProcessPayment:hr,onClearCart:gr,onScanQrCode:Cr?nr:()=>{},onAddCustomer:()=>ar(),onViewReceipts:()=>{alert("Receipts view coming soon!")},onViewSales:async()=>{await ie(),n("/lats/sales-reports")},onOpenPaymentTracking:()=>{rr()},onOpenDrafts:()=>ts(!0),isProcessingPayment:Ye,hasSelectedCustomer:!!vt,draftCount:ds().length,onViewAnalytics:()=>lr(),onPaymentTracking:()=>rr(),onCustomers:()=>ar(),onReports:()=>lr(),onRefreshData:async()=>{try{await Promise.all([re(),ie(),le(),ne()]),G.success("Data refreshed successfully")}catch(e){G.error("Failed to refresh some data")}},onSettings:()=>Ya(!0),todaysSales:M,isDailyClosed:sa,onCloseDay:()=>ma(!0),canCloseDay:er}),t.jsx("div",{className:"p-4 sm:p-6 max-w-full mx-auto pos-page-container overflow-hidden h-[calc(100vh-120px)]",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full",children:[t.jsxs("div",{className:"flex-1 min-h-0 relative h-full",children:[xe||0!==ue.length?null:t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/70 backdrop-blur rounded-lg shadow-lg z-10",children:t.jsxs("div",{className:"text-center p-12",children:[t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Loading Products..."}),t.jsx("p",{className:"text-gray-600",children:"Please wait while we fetch your inventory"}),t.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"First load may take a few seconds"})]})}),t.jsx(It,{products:ue,searchQuery:Ne,setSearchQuery:we,isSearching:Se,showAdvancedFilters:Le,setShowAdvancedFilters:Fe,selectedCategory:ke,setSelectedCategory:_e,selectedBrand:Pe,setSelectedBrand:De,priceRange:Te,setPriceRange:Ie,stockFilter:Ee,setStockFilter:Ae,sortBy:Oe,setSortBy:$e,sortOrder:Me,setSortOrder:Re,categories:(null==ae?void 0:ae.map(e=>e.name))||[],brands:[],onAddToCart:cr,onAddExternalProduct:()=>Ot(!0),onSearch:e=>{/^\d{8,}$/.test(e)?nr():yt(!0)},onScanQrCode:nr,currentPage:fe,setCurrentPage:ye,totalPages:ve,productsPerPage:te})]}),t.jsx(Lt,{cartItems:gt,selectedCustomer:vt,onRemoveCustomer:tr,onShowCustomerSearch:()=>sr(),onShowCustomerDetails:()=>{vt&&(ja(vt),ya(!0))},onUpdateCartItemQuantity:mr,onRemoveCartItem:xr,onUpdateCartItemTags:ur,onApplyDiscount:(e,t)=>{const s="percentage"===e?fr*parseFloat(t.toString())/100:parseFloat(t.toString());hs(s),bs(!1)},onProcessPayment:hr,onShowInstallmentModal:()=>Aa(!0),onShowTradeInModal:()=>{0!==gt.length?vt?Fa(!0):G.error("Please select a customer first"):G.error("Add items to cart first")},onShowDiscountModal:()=>bs(!0),onClearDiscount:()=>{hs(0),Ns(""),ys("percentage")},dynamicPricingEnabled:null==H?void 0:H.enable_dynamic_pricing,totalAmount:fr,discountAmount:yr,discountPercentage:vr,taxAmount:Nr,taxRate:pr,finalAmount:wr,onEditCustomer:e=>Gt(!0),isTaxEnabled:br})]})}),t.jsx(Ft,{isOpen:At,onClose:()=>Ot(!1),onProductAdded:e=>{cr(e),Ot(!1)}}),Ze()&&t.jsxs(t.Fragment,{children:[t.jsx(Mt,{isOpen:Zt,onClose:()=>Qt(!1),onCustomerSelect:e=>{jt(e),Qt(!1),G.success(`Customer "${e.name}" selected!`)},selectedCustomer:vt}),t.jsx(ot,{isOpen:qt,onClose:()=>Bt(!1),onCustomerCreated:e=>{jt(e),Bt(!1),G.success(`New customer "${e.name}" created and selected!`)},onAddAnother:()=>{Bt(!0)}}),t.jsx(zt,{isOpen:Wt,onClose:()=>Gt(!1),customer:vt,onCustomerUpdated:e=>{jt(e),Gt(!1)}})]}),t.jsx(Ds,{isOpen:Xt,onClose:()=>ts(!1),onLoadDraft:os,currentDraftId:us||void 0}),Ge()&&t.jsx(Vt,{isOpen:Pa,onClose:()=>Da(!1)}),t.jsx(Yt,{isOpen:Ta,onClose:()=>Ia(!1),cartItems:gt,total:wr,onPaymentComplete:async t=>{var s,a,r;try{if(!vt&&!Ke)return void G.error("Please select a customer or enter customer name");const n={customerId:(null==vt?void 0:vt.id)||null,customerName:(null==vt?void 0:vt.name)||Ke||"Walk-in Customer",customerPhone:(null==vt?void 0:vt.phone)||null,customerEmail:(null==vt?void 0:vt.email)||null,items:gt.map(e=>({id:e.id,productId:e.productId,variantId:e.variantId,productName:e.productName,variantName:e.variantName,sku:e.sku,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice,costPrice:0,profit:0})),subtotal:fr,tax:Nr,discount:gs,discountType:fs,discountValue:parseFloat(vs)||0,total:wr,paymentMethod:{type:"zenopay",details:{transactionId:t.id,provider:"ZenoPay"},amount:wr},paymentStatus:"completed",soldBy:Tt||"POS User",soldAt:(new Date).toISOString(),notes:`ZenoPay Transaction ID: ${t.id||"N/A"}`},i=await mt.processSale(n);if(!i.success)throw new Error(i.error||"Failed to process sale");{const t=qa||Qa.current,n="admin"===q;if(t&&t.id)try{if(n){const{completeTradeInTransaction:s}=await e(()=>import("./tradeInApi-966791f7.js").then(e=>e.l),["assets/tradeInApi-966791f7.js","assets/vendor-a2ff445a.js","assets/index-222cfb29.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),a=await s(t.id);a.success&&(Va(a.data),Qa.current=a.data,!qa&&Qa.current&&Va(Qa.current),Ra(!0))}else{const{data:e,error:s}=await d.from("lats_trade_in_transactions").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:(null==U?void 0:U.id)||null}).eq("id",t.id).select().single();!s&&e?(G.success("âœ… Trade-in submitted for admin review. Admin will add device to inventory with pricing."),Va(e),Qa.current=e):G.error("Warning: Failed to submit trade-in for approval")}}catch(l){}const o={id:(null==(s=i.sale)?void 0:s.id)||"",date:(new Date).toLocaleDateString(),time:(new Date).toLocaleTimeString(),items:gt.map(e=>({productName:e.productName,variantName:e.variantName,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice})),customer:vt?{name:vt.name,phone:vt.phone,email:vt.email}:null,subtotal:fr,tax:Nr,discount:gs,total:wr,paymentMethod:{name:"ZenoPay",description:`ZenoPay - ${tt.money(wr)}`,icon:"ðŸ’³"},cashier:Tt||"POS User",receiptNumber:(null==(a=i.sale)?void 0:a.saleNumber)||"N/A"},c=null==(r=i.sale)?void 0:r.saleNumber;_t(o),Ia(!1),setTimeout(()=>{z.show("ZenoPay payment completed successfully!"+(c?` Sale #${c}`:""),{title:"Sale Complete! ðŸŽ‰",icon:kt.saleCompleted,autoCloseDelay:0,actionButtons:[{label:"Share Receipt",onClick:()=>{lt(!0)},variant:"primary"},{label:"New Sale",onClick:()=>{},variant:"secondary"}]})},100),setTimeout(()=>{gr(),jt(null)},150)}}catch(l){G.error(`Payment completed but failed to process sale: ${l instanceof Error?l.message:"Unknown error"}`)}},customer:vt}),Ea&&vt&&t.jsx(Jt,{isOpen:Ea,onClose:()=>Aa(!1),onSuccess:async()=>{const t=qa||Qa.current,s="admin"===q;if(t&&t.id)try{if(s){const{completeTradeInTransaction:s}=await e(()=>import("./tradeInApi-966791f7.js").then(e=>e.l),["assets/tradeInApi-966791f7.js","assets/vendor-a2ff445a.js","assets/index-222cfb29.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),a=await s(t.id);a.success&&(Va(a.data),Qa.current=a.data,!qa&&Qa.current&&Va(Qa.current),Ra(!0))}else{const{data:e,error:s}=await d.from("lats_trade_in_transactions").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:(null==U?void 0:U.id)||null}).eq("id",t.id).select().single();!s&&e?(G.success("âœ… Trade-in submitted for admin review. Admin will add device to inventory with pricing."),Va(e),Qa.current=e):G.error("Warning: Failed to submit trade-in for approval")}}catch(a){}Aa(!1),gr(),G.success("âœ… Sale completed with installment plan!")},cartItems:gt,cartTotal:wr,customer:vt,currentUser:U}),La&&t.jsx(k.Suspense,{fallback:t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}),children:t.jsx(Es,{isOpen:La,onClose:()=>Fa(!1),newDevicePrice:wr,onTradeInComplete:async t=>{if(vt)if(0!==gt.length){za(t),Za(t.final_trade_in_value);try{const{createTradeInTransaction:s}=await e(()=>import("./tradeInApi-966791f7.js").then(e=>e.l),["assets/tradeInApi-966791f7.js","assets/vendor-a2ff445a.js","assets/index-222cfb29.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),a=gt[0],r=(null==a?void 0:a.product_id)||null,l=(null==a?void 0:a.variant_id)||null,n=await s({customer_id:(null==vt?void 0:vt.id)||"",device_name:t.trade_in_details.device_name,device_model:t.trade_in_details.device_model,device_imei:t.trade_in_details.device_imei,base_trade_in_price:t.trade_in_details.base_price,condition_rating:t.trade_in_details.condition_rating,condition_description:t.trade_in_details.condition_description,damage_items:t.trade_in_details.damage_items,new_product_id:r,new_variant_id:l,new_device_price:wr,customer_payment_amount:t.customer_payment_amount});n.success&&n.data?(Va(n.data),Qa.current=n.data,Fa(!1),G.success(`Trade-in added: ${t.trade_in_details.device_name} for ${t.final_trade_in_value.toLocaleString()} TZS`),$a(!0)):G.error(n.error||"Failed to create trade-in transaction")}catch(s){G.error("Failed to create trade-in transaction")}}else G.error("Please add items to cart before trade-in");else G.error("Please select a customer before adding trade-in")}})}),qa&&t.jsx(pt,{isOpen:Oa,transaction:qa,onClose:()=>$a(!1),onContractSigned:()=>{G.success("Contract signed successfully!"),$a(!1),setTimeout(()=>{et(!0)},300)}}),qa&&t.jsx(es,{isOpen:Ma,transaction:qa,onClose:()=>Ra(!1),onConfirm:async t=>{if(qa)try{const{addTradeInDeviceToInventory:s,getOrCreateTradeInCategory:a}=await e(()=>import("./tradeInInventoryService-846f4ac7.js"),["assets/tradeInInventoryService-846f4ac7.js","assets/index-222cfb29.js","assets/vendor-a2ff445a.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),r=await a(),l=await s({transaction:qa,categoryId:r,locationId:null,needsRepair:qa.needs_repair||!1,resalePrice:t.selling_price});l.success?(G.success("âœ… Trade-in device added to inventory with pricing!"),Ra(!1),Va(null),Qa.current=null,za(null),Za(0),setTimeout(()=>{gr(),jt(null)},150)):G.error("Failed to add trade-in to inventory: "+l.error)}catch(s){const e=s instanceof Error?s.message:"Failed to add trade-in to inventory";G.error(e)}else G.error("No trade-in transaction found")}}),Qe()&&t.jsx(ss,{isOpen:Wa,onClose:()=>Ga(!1)}),t.jsx(ft,{isOpen:Xe,onClose:()=>et(!1),amount:Ba>0?wr-Ba:wr,customerId:null==vt?void 0:vt.id,customerName:(null==vt?void 0:vt.name)||"Walk-in Customer",description:`POS Sale - ${gt.length} items${Ba>0?` (Trade-In: -${tt.money(Ba)})`:""}`,onPaymentComplete:async(t,s)=>{var a,r;try{if(!t||0===t.length)throw new Error("No payment data received");const n=Ba>0?wr-Ba:wr,i=s||n;Math.abs(i-n);let o=t.map(e=>e.notes).filter(Boolean).join("; ");if(qa&&Ua){const e=`Trade-In: ${qa.device_name} ${qa.device_model} (IMEI: ${qa.device_imei||"N/A"}) - Trade-In Value: ${tt.money(Ua.final_trade_in_value)} - Customer Payment: ${tt.money(Ua.customer_payment_amount)} - Transaction ID: ${qa.id}`;o=o?`${o}; ${e}`:e}const c={customerId:(null==vt?void 0:vt.id)||null,customerName:(null==vt?void 0:vt.name)||"Walk-in Customer",customerPhone:(null==vt?void 0:vt.phone)||null,customerEmail:(null==vt?void 0:vt.email)||null,items:gt.map(e=>({id:e.id,productId:e.productId,variantId:e.variantId,productName:e.productName,variantName:e.variantName,sku:e.sku,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice,costPrice:0,profit:0,...e.tags&&e.tags.length>0&&{tags:e.tags},...e.selectedSerialNumbers&&e.selectedSerialNumbers.length>0&&{serialNumbers:e.selectedSerialNumbers}})),subtotal:fr,tax:Nr,discount:gs,discountType:fs,discountValue:parseFloat(vs)||0,tradeInDiscount:Ba||0,tradeInTransactionId:(null==qa?void 0:qa.id)||null,total:wr,paymentMethod:{type:1===t.length?t[0].paymentMethod:"multiple",details:{payments:t.map(e=>({method:e.paymentMethod,amount:e.amount,accountId:e.paymentAccountId,reference:e.reference,notes:e.notes,timestamp:e.timestamp})),totalPaid:i,...qa&&{tradeIn:{transactionId:qa.id,deviceName:qa.device_name,deviceModel:qa.device_model,deviceImei:qa.device_imei,tradeInValue:(null==Ua?void 0:Ua.final_trade_in_value)||0}}},amount:i},paymentStatus:"completed",soldBy:Tt||"POS User",soldAt:(new Date).toISOString(),notes:o||void 0},m=await mt.processSale(c);if(!m.success)throw new Error(m.error||"Failed to process sale");{const n=s||wr,i=null==(a=m.sale)?void 0:a.saleNumber,o=qa||Qa.current,c="admin"===q;if(o&&o.id)try{if(c){const{completeTradeInTransaction:t}=await e(()=>import("./tradeInApi-966791f7.js").then(e=>e.l),["assets/tradeInApi-966791f7.js","assets/vendor-a2ff445a.js","assets/index-222cfb29.js","assets/supabase-7e851d02.js","assets/routing-a2f0f6d2.js","assets/ui-551a39a6.js","assets/index-d3868143.css"]),s=await t(o.id);s.success?(Va(s.data),Qa.current=s.data,!qa&&Qa.current&&Va(Qa.current),Ra(!0)):G.error("Warning: Failed to mark trade-in as completed")}else{const{data:e,error:t}=await d.from("lats_trade_in_transactions").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:(null==U?void 0:U.id)||null}).eq("id",o.id).select().single();!t&&e?(G.success("âœ… Trade-in submitted for admin review. Admin will add device to inventory with pricing."),Va(e),Qa.current=e):G.error("Warning: Failed to submit trade-in for approval")}}catch(l){G.error("Warning: Failed to update trade-in status")}const u={id:(null==(r=m.sale)?void 0:r.id)||"",date:(new Date).toLocaleDateString(),time:(new Date).toLocaleTimeString(),items:gt.map(e=>({productName:e.productName,variantName:e.variantName,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice})),customer:vt?{name:vt.name,phone:vt.phone,email:vt.email}:null,subtotal:fr,tax:Nr,discount:gs,tradeInDiscount:Ba||0,tradeInDetails:qa?{deviceName:qa.device_name,deviceModel:qa.device_model,deviceImei:qa.device_imei,tradeInValue:(null==Ua?void 0:Ua.final_trade_in_value)||0,conditionRating:qa.condition_rating,transactionId:qa.id}:null,total:wr,paymentMethod:{name:1===t.length?t[0].paymentMethod:"Multiple Payments",description:1===t.length?`${t[0].paymentMethod} - ${tt.money(t[0].amount)}`:`${t.length} payment methods - ${tt.money(n)}`,icon:"ðŸ’³"},cashier:Tt||"POS User",receiptNumber:i||"N/A"};_t(u),et(!1),setTimeout(()=>{z.show(`Payment of ${tt.money(n)} processed successfully!${i?` Sale #${i}`:""}`,{title:"Sale Complete! ðŸŽ‰",icon:kt.paymentReceived,autoCloseDelay:0,actionButtons:[{label:"Share Receipt",onClick:()=>{lt(!0)},variant:"primary"},{label:"New Sale",onClick:()=>{},variant:"secondary"}]})},100);qa||Qa.current||setTimeout(()=>{gr(),jt(null)},150)}}catch(l){if(!(l instanceof Error))throw l;if(["Customer information is required","No payment data received","Failed to process sale","Database connection error","Invalid payment method"].some(e=>l.message.toLowerCase().includes(e.toLowerCase())))throw l;{const e=s||wr;z.show(`Payment of ${tt.money(e)} processed successfully!`,{title:"Payment Received! ðŸ’°",icon:kt.paymentReceived,autoCloseDelay:3e3}),et(!1)}}},title:"Process POS Payment"}),t.jsx(ks,{ref:Ka,isOpen:Ha,onClose:()=>Ya(!1),activeTab:Ja,onTabChange:Xa,onSaveSettings:async e=>{ze(!0);try{if(!e||"object"!=typeof e)throw new Error("Invalid settings data");await C.saveAllSettings(e),G.success("Settings saved successfully")}catch(t){t instanceof Error?t.message.includes("network")||t.message.includes("fetch")?G.error("Network error. Please check your connection and try again."):t.message.includes("permission")||t.message.includes("unauthorized")?G.error("Permission denied. Please check your access rights."):t.message.includes("validation")?G.error("Invalid settings data. Please check your input and try again."):G.error(`Failed to save settings: ${t.message}`):G.error("Failed to save settings. Please try again.")}finally{ze(!1)}},isSaving:Ue}),t.jsx(_s,{isOpen:ps,onClose:()=>bs(!1),onApplyDiscount:Sr,onClearDiscount:()=>{hs(0),Ns(""),ys("percentage")},currentTotal:fr,hasExistingDiscount:yr>0}),t.jsx(Ps,{isOpen:st,onClose:()=>at(!1),receipt:Nt,onPrint:e=>{Vs(e)},onEmail:e=>{}}),ws&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"QrCode Scanner"}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[t.jsx("div",{className:"text-blue-600 text-2xl mb-2",children:"ðŸ“±"}),t.jsx("p",{className:"text-blue-800 font-medium",children:"External QrCode Scanner"}),t.jsx("p",{className:"text-blue-600 text-sm mt-1",children:"Use your connected barcode scanner device to scan product barcodes"})]}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Scanner is ready and waiting for input"})]}),Cs&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-4",children:t.jsx("p",{className:"text-red-600 text-sm",children:Cs})}),t.jsx("div",{className:"flex gap-2 justify-end",children:t.jsx("button",{onClick:()=>{i(),Ss(!1),Fs(!1),As(""),G("QrCode scanner stopped")},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Stop Scanner"})})]})}),t.jsx(xt,{isOpen:fa,onClose:()=>ya(!1),customer:va,onEdit:e=>{jt(e),ja(e),ya(!1)}}),t.jsx(rs,{isOpen:na,onClose:()=>ia(!1),onContinue:()=>{ia(!1),et(!0)},closureTime:null==ra?void 0:ra.closedAt,closedBy:null==ra?void 0:ra.closedBy,userRole:null==U?void 0:U.role}),t.jsx(ls,{isOpen:oa,onClose:()=>da(!1),expectedPasscode:(null==K?void 0:K.day_closing_passcode)||"1234",onOpenDay:async()=>{try{const e=(new Date).toISOString().split("T")[0],t=(new Date).toISOString(),{error:s}=await d.from("daily_sales_closures").eq("date",e).delete(),{data:a,error:r}=await d.from("daily_opening_sessions").insert([{date:e,opened_at:t,opened_by:(null==U?void 0:U.role)||"system",opened_by_user_id:null==U?void 0:U.id,is_active:!0,notes:"Day opened after closure"}]).select().single();r&&G.error("Failed to create session, but day is opened"),aa(!1),la(null),da(!1),O(t),G.success("ðŸŽ‰ New day started! Counter reset."),ie()}catch(e){G.error("Error opening day")}},currentUser:U,lastClosureInfo:ra}),t.jsx(I,{isOpen:ca,onClose:()=>ma(!1),expectedPasscode:(null==K?void 0:K.day_closing_passcode)||"1234",onComplete:()=>{aa(!0),la({closedAt:(new Date).toISOString(),closedBy:(null==U?void 0:U.name)||(null==U?void 0:U.email)||"Unknown"}),ma(!1)},currentUser:U}),Bs&&t.jsxs("div",{className:"fixed top-4 right-4 z-50 w-96 animate-slide-in",children:[t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-red-200 overflow-hidden",children:[t.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-orange-500 px-4 py-3 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t.jsxs("h3",{className:"text-white font-semibold text-sm",children:[Gs.length," Low Stock ",1!==Gs.length?"Items":"Item"]})]}),t.jsx("button",{onClick:()=>{i(),or()},className:"text-white hover:text-red-100 transition-colors",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"max-h-72 overflow-y-auto bg-gray-50",children:[Gs.length>0?Gs.slice(0,5).map((e,s)=>t.jsx("div",{className:`px-4 py-3 bg-white ${s!==Gs.length-1&&4!==s?"border-b border-gray-100":""} hover:bg-red-50 transition-colors`,children:t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:e.productName}),t.jsxs("div",{className:"text-xs text-gray-600 mt-0.5",children:["Stock: ",t.jsx("span",{className:"font-semibold text-red-600",children:e.currentStock})," / ",e.threshold]})]}),t.jsx("div",{className:"flex-shrink-0",children:t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Low"})})]})},e.productId)):t.jsx("div",{className:"px-4 py-6 text-center",children:t.jsx("p",{className:"text-gray-500 text-sm",children:"No inventory alerts"})}),Gs.length>5&&t.jsx("div",{className:"px-4 py-2 bg-gray-100 text-center",children:t.jsxs("p",{className:"text-xs text-gray-600",children:["+",Gs.length-5," more items"]})})]}),t.jsxs("div",{className:"bg-white px-4 py-3 flex gap-2 border-t border-gray-200",children:[t.jsx("button",{onClick:()=>{i(),or(!0)},className:"flex-1 px-3 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-xs font-medium",children:"Hide Today"}),t.jsx("button",{onClick:()=>{i(),Ys(!0),Zs(!1)},className:"flex-1 px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-xs font-medium",children:"Don't Show Again"})]})]}),t.jsx("div",{className:"mt-1 h-1 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-red-500 to-orange-500 animate-shrink"})})]}),ea&&t.jsx("div",{className:"fixed top-4 right-4 z-50 bg-orange-100 border border-orange-300 rounded-lg p-4 shadow-lg max-w-sm",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"w-5 h-5 text-orange-600",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-sm font-medium text-orange-800",children:"Low Stock Alert"}),t.jsxs("p",{className:"text-sm text-orange-700 mt-1",children:[Gs.length," product",1!==Gs.length?"s":""," running low on stock"]}),t.jsx("button",{onClick:()=>{ta(!1),Zs(!0)},className:"text-sm text-orange-600 hover:text-orange-800 underline mt-1",children:"View Details"})]}),t.jsx("button",{onClick:()=>{i(),ta(!1)},className:"flex-shrink-0 text-orange-400 hover:text-orange-600",children:t.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),ua&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Stock Adjustment"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),t.jsxs("select",{value:(null==ga?void 0:ga.id)||"",onChange:e=>{const t=se.find(t=>t.id===e.target.value);ha(t||null)},className:"w-full p-3 border border-gray-300 rounded-lg",children:[t.jsx("option",{value:"",children:"Select a product"}),se.map(e=>{var s;return t.jsxs("option",{value:e.id,children:[e.name," (Current: ",(null==(s=e.variants)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0,")"]},e.id)})]})]}),ga&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Adjustment Amount"}),t.jsx("input",{type:"number",placeholder:"Enter adjustment amount",className:"w-full p-3 border border-gray-300 rounded-lg",id:"adjustmentAmount"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason"}),t.jsx("input",{type:"text",placeholder:"Enter reason for adjustment",className:"w-full p-3 border border-gray-300 rounded-lg",id:"adjustmentReason"})]})]})]}),t.jsxs("div",{className:"flex gap-2 justify-end mt-6",children:[t.jsx("button",{onClick:()=>{i(),xa(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),t.jsx("button",{onClick:()=>{const e=document.getElementById("adjustmentAmount"),t=document.getElementById("adjustmentReason");ga&&e&&t&&((e,t)=>{try{const s=se.find(t=>t.id===e);if(!s)return void G.error("Product not found");G.success(`Stock adjusted for ${s.name}: ${t>0?"+":""}${t}`),xa(!1),ha(null),re()}catch(s){G.error("Failed to adjust stock")}})(ga.id,parseInt(e.value)||0,t.value)},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Adjust Stock"})]})]})}),Be()&&Na&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add Loyalty Points"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer"}),t.jsxs("select",{value:(null==vt?void 0:vt.id)||"",onChange:e=>{const t=R.find(t=>t.id===e.target.value);jt(t||null)},className:"w-full p-3 border border-gray-300 rounded-lg",children:[t.jsx("option",{value:"",children:"Select a customer"}),R.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (Current Points: ","object"==typeof pa?pa[e.id]||0:pa,")"]},e.id))]})]}),vt&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Points to Add"}),t.jsx("input",{type:"number",value:Sa,onChange:e=>Ca(e.target.value),placeholder:"Enter points to add",className:"w-full p-3 border border-gray-300 rounded-lg"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason"}),t.jsx("input",{type:"text",value:ka,onChange:e=>_a(e.target.value),placeholder:"Enter reason for points",className:"w-full p-3 border border-gray-300 rounded-lg"})]})]})]}),t.jsxs("div",{className:"flex gap-2 justify-end mt-6",children:[t.jsx("button",{onClick:()=>{i(),wa(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),t.jsx("button",{onClick:()=>{vt&&parseInt(Sa)>0&&((e,t)=>{try{const s=R.find(t=>t.id===e);if(!s)return void G.error("Customer not found");ba(s=>({...s,[e]:(s[e]||0)+t})),G.success(`Added ${t} loyalty points to ${s.name}`),wa(!1),Ca(""),_a("")}catch(s){G.error("Failed to add loyalty points")}})(vt.id,parseInt(Sa))},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Add Points"})]})]})}),Ms&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh]",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Receipt History"}),t.jsx("div",{className:"overflow-y-auto max-h-96",children:Os.length>0?t.jsx("div",{className:"space-y-2",children:Os.map(e=>t.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>{zs(e)},children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium",children:["Receipt #",e.id]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Date: ",new Date(e.date).toLocaleDateString()]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Customer: ",e.customer]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Items: ",e.items]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"font-semibold text-lg",children:["$",e.total.toFixed(2)]})})]})},e.id))}):t.jsx("p",{className:"text-gray-500 text-center py-8",children:"No receipt history found"})}),t.jsx("div",{className:"flex gap-2 justify-end mt-4",children:t.jsx("button",{onClick:()=>{i(),Rs(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Close"})})]})}),t.jsx(Ts,{draftCount:ds().length,onViewDrafts:()=>ts(!0),onDismiss:()=>ns(!1),isVisible:as&&ds().length>0}),Ve()&&Rt&&t.jsx($t,{isOpen:Rt,onClose:()=>Ut(!1),onDeliverySet:e=>{Ut(!1)}}),t.jsx(Ct,{...z.props}),t.jsx(ut,{isOpen:rt,onClose:()=>lt(!1),onPrintReceipt:()=>{at(!0),lt(!1)},receiptData:{receiptNumber:(null==Nt?void 0:Nt.receiptNumber)||"N/A",amount:(null==Nt?void 0:Nt.total)||0,customerName:(null==(s=null==Nt?void 0:Nt.customer)?void 0:s.name)||(null==vt?void 0:vt.name),customerPhone:(null==(r=null==Nt?void 0:Nt.customer)?void 0:r.phone)||(null==vt?void 0:vt.phone),customerEmail:(null==(l=null==Nt?void 0:Nt.customer)?void 0:l.email)||(null==vt?void 0:vt.email),items:(null==Nt?void 0:Nt.items)||[]}})]})}},Symbol.toStringTag,{value:"Module"}));export{As as P,Tt as u};
