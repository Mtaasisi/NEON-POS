import{j as e}from"./index-222cfb29.js";import{r as s}from"./vendor-a2ff445a.js";import{aC as t,X as r,v as a,a4 as l,n as o,cs as n,Q as i,az as c,y as d,R as m,aG as x,x as u,r as p,$ as h}from"./ui-551a39a6.js";import{s as g,a as b}from"./storeShelfApi-d8b142f6.js";import{s as f}from"./storeLocationApi-de3f7bfa.js";import{B as y}from"./BackButton-e41d1482.js";import{a as j}from"./routing-a2f0f6d2.js";import"./supabase-7e851d02.js";const v=({isOpen:n,onClose:i,storageRoom:c,onSave:d})=>{const[m,x]=s.useState([]),[u,p]=s.useState(!1),[h,b]=s.useState({store_location_id:"",name:"",code:"",description:"",floor_level:1,area_sqm:"",is_secure:!1,is_active:!0});s.useEffect(()=>{n&&y()},[n]),s.useEffect(()=>{b(c?{store_location_id:c.store_location_id||"",name:c.name||"",code:c.code||"",description:c.description||"",floor_level:c.floor_level||1,area_sqm:c.area_sqm?String(c.area_sqm):"",is_secure:c.is_secure||!1,is_active:!1!==c.is_active}:{store_location_id:"",name:"",code:"",description:"",floor_level:1,area_sqm:"",is_secure:!1,is_active:!0})},[c,n]);const y=async()=>{try{const e=await f.getAll();x(e),e.length>0&&!h.store_location_id&&b(s=>({...s,store_location_id:e[0].id}))}catch(e){}},j=async e=>{var s;if(e.preventDefault(),h.store_location_id&&h.name.trim()&&h.code.trim()){p(!0);try{const e={store_location_id:h.store_location_id,name:h.name,code:h.code,description:h.description,floor_level:h.floor_level,area_sqm:h.area_sqm?parseFloat(h.area_sqm):null,is_active:h.is_active,is_secure:h.is_secure,requires_access_card:h.is_secure};c?(await g.update({id:c.id,...e}),o.success("Storage room updated successfully")):(await g.create(e),o.success("Storage room created successfully")),d(e),i()}catch(t){"23505"===(null==t?void 0:t.code)||(null==(s=null==t?void 0:t.message)?void 0:s.includes("duplicate"))?o.error("Room code already exists in this location"):o.error("Failed to save storage room")}finally{p(!1)}}else o.error("Please fill in all required fields")};return n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50",onClick:i,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),style:{pointerEvents:"auto"},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(t,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:c?"Edit Storage Room":"New Storage Room"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:c?"Update room details":"Add shelves after creating the room"})]})]}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(r,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:j,className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Room Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:h.name,onChange:e=>b({...h,name:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900",placeholder:"e.g., Main Storage Room",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Room Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:h.code,onChange:e=>b({...h,code:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900",placeholder:"e.g., 01",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Floor Level"}),e.jsx("input",{type:"number",min:1,value:h.floor_level,onChange:e=>b({...h,floor_level:parseInt(e.target.value)||1}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Store Location ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(a,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsxs("select",{value:h.store_location_id,onChange:e=>b({...h,store_location_id:e.target.value}),className:"w-full pl-11 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900",required:!0,children:[e.jsx("option",{value:"",children:"Select location"}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Area (sqm)"}),e.jsx("input",{type:"number",step:"0.01",value:h.area_sqm,onChange:e=>b({...h,area_sqm:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900",placeholder:"e.g., 50.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:h.description,onChange:e=>b({...h,description:e.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 transition-colors text-gray-900 resize-none",placeholder:"Optional description"})]}),e.jsxs("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:h.is_active,onChange:e=>b({...h,is_active:e.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Active Room"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("input",{type:"checkbox",id:"is_secure",checked:h.is_secure,onChange:e=>b({...h,is_secure:e.target.checked}),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),e.jsxs("label",{htmlFor:"is_secure",className:"text-sm font-medium text-gray-700 cursor-pointer flex items-center gap-2",children:[e.jsx(l,{size:16}),"Secure Room (requires access)"]})]})]})]})}),e.jsx("div",{className:"flex-shrink-0 p-6 pt-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:i,disabled:u,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed bg-white",children:"Cancel"}),e.jsx("button",{type:"button",onClick:j,disabled:u,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):e.jsx(e.Fragment,{children:c?"Update Room":"Create Room"})})]})})]})})]}):null},_=({isOpen:t,onClose:l,shelf:i,storageRoom:c,onSave:d,preSelectedRow:m})=>{const[x,u]=s.useState({name:"",code:"",shelf_type:"standard",start_row:1,end_row:1,start_column:1,end_column:1,row_number:1,column_number:1,max_capacity:"",zone:"center",description:"",is_accessible:!0,requires_ladder:!1,is_refrigerated:!1}),[p,h]=s.useState(!1),[g,f]=s.useState([]),[y,j]=s.useState(!1);s.useEffect(()=>{t&&c&&v()},[t,null==c?void 0:c.id]);const v=async()=>{if(c)try{j(!0);const e=await b.getShelvesByStorageRoom(c.id);f(e)}catch(e){}finally{j(!1)}},_=()=>{if(0===g.length)return{startRow:1,endRow:1,startCol:1,endCol:1,code:"A1"};let e=0;g.forEach(s=>{const t=s.code.match(/([A-Z])(\d+)/);if(t){const s=t[1].charCodeAt(0)-64;parseInt(t[2]),s>e&&(e=s)}});const s=e+1;return{startRow:s,endRow:s,startCol:1,endCol:1,code:`${String.fromCharCode(64+s)}1`}};s.useEffect(()=>{var e;if(t)if(i)u({name:i.name,code:i.code,shelf_type:i.shelf_type,start_row:i.row_number||1,end_row:i.row_number||1,start_column:i.column_number||1,end_column:i.column_number||1,row_number:i.row_number||1,column_number:i.column_number||1,max_capacity:(null==(e=i.max_capacity)?void 0:e.toString())||"",zone:i.zone||"center",description:i.description||"",is_accessible:i.is_accessible,requires_ladder:i.requires_ladder,is_refrigerated:i.is_refrigerated});else{const e=_();u({name:"",code:e.code,shelf_type:"standard",start_row:e.startRow,end_row:e.endRow,start_column:e.startCol,end_column:e.endCol,row_number:1,column_number:1,max_capacity:"",zone:"center",description:"",is_accessible:!0,requires_ladder:!1,is_refrigerated:!1})}},[t,null==i?void 0:i.id,g,m]);const N=async e=>{if(e.preventDefault(),c){h(!0);try{if(i){const e=x.name.trim(),s=x.code.trim(),t={store_location_id:c.store_location_id,storage_room_id:c.id,name:e||s,code:s,shelf_type:x.shelf_type,row_number:x.row_number,column_number:x.column_number,floor_level:(null==c?void 0:c.floor_level)||1,zone:x.zone,is_active:!0,is_accessible:x.is_accessible,requires_ladder:x.requires_ladder,is_refrigerated:x.is_refrigerated,priority_order:0};x.description&&x.description.trim()&&(t.description=x.description.trim()),x.max_capacity&&parseInt(x.max_capacity)>0&&(t.max_capacity=parseInt(x.max_capacity)),await d(t)}else{const e=x.start_row||1,t=x.end_row||1,r=x.start_column||1,a=x.end_column||1,l=a-r+1,n=String.fromCharCode(64+e),i=String.fromCharCode(64+t);let m=0,u=0;const p=[];for(let o=e;o<=t;o++)for(let t=r;t<=a;t++){const a=String.fromCharCode(64+o),n=`${a}${t}`,i=c.code?`${c.code}${a}${t}`:n;if(g.some(e=>e.code===i)){u++,p.push(i);continue}const h={store_location_id:c.store_location_id,storage_room_id:c.id,name:i,code:i,shelf_type:x.shelf_type,row_number:o,column_number:t,floor_level:(null==c?void 0:c.floor_level)||1,zone:x.zone,is_active:!0,is_accessible:x.is_accessible,requires_ladder:x.requires_ladder,is_refrigerated:x.is_refrigerated,priority_order:(o-e)*l+(t-r)};x.max_capacity&&parseInt(x.max_capacity)>0&&(h.max_capacity=parseInt(x.max_capacity));try{await d(h),m++}catch(s){}}if(m>0){const e=c.code||"",s=`${e}${n}${r}`,t=`${s} to ${`${e}${i}${a}`}`;o.success(`✅ Created ${m} shelves (${t})!${u>0?` Skipped ${u} existing.`:""}`)}else u>0&&o.error(`All ${u} shelves already exist. No new shelves created.`)}}catch(s){o.error("Failed to save shelf")}finally{h(!1)}}else o.error("Storage room is required")};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bg-black/50",onClick:l,style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:35}}),e.jsx("div",{className:"fixed flex items-center justify-center p-4",style:{left:"var(--sidebar-width, 0px)",top:"var(--topbar-height, 64px)",right:0,bottom:0,zIndex:50,pointerEvents:"none"},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),style:{pointerEvents:"auto"},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(n,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:i?"Edit Shelf":"Create Shelves Grid"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:i?`${null==c?void 0:c.name} (${null==c?void 0:c.code})`:`Create all shelves at once • ${null==c?void 0:c.name}`})]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(r,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:N,className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-4",children:[i&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Shelf Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:x.code,onChange:e=>u({...x,code:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900",placeholder:"e.g., A1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Shelf Name"}),e.jsx("input",{type:"text",value:x.name,onChange:e=>u({...x,name:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900",placeholder:"Optional"})]})]}),i?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Row Number"}),e.jsx("input",{type:"number",min:1,max:26,value:x.row_number,onChange:e=>u({...x,row_number:parseInt(e.target.value)||1}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Row ",String.fromCharCode(64+(x.row_number||1))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Column Number"}),e.jsx("input",{type:"number",min:1,max:50,value:x.column_number,onChange:e=>u({...x,column_number:parseInt(e.target.value)||1}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Column ",x.column_number]})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-center",children:"How Many Rows?"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:1,max:26,value:x.end_row-x.start_row+1,onChange:e=>{const s=Math.max(1,Math.min(26,parseInt(e.target.value)||1)),t=_();u({...x,start_row:t.startRow,end_row:t.startRow+s-1})},className:"w-full py-4 px-16 border-2 border-gray-200 rounded-lg text-center text-2xl font-bold text-gray-900 focus:outline-none focus:border-purple-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"1"}),e.jsx("button",{type:"button",onClick:()=>{const e=x.end_row-x.start_row+1,s=Math.max(1,e-1),t=_();u({...x,start_row:t.startRow,end_row:t.startRow+s-1})},className:"absolute left-1 top-1/2 -translate-y-1/2 w-12 h-12 bg-gray-500 hover:bg-gray-600 text-white rounded-lg flex items-center justify-center text-2xl font-bold transition-colors",children:"−"}),e.jsx("button",{type:"button",onClick:()=>{const e=x.end_row-x.start_row+1,s=Math.min(26,e+1),t=_();u({...x,start_row:t.startRow,end_row:t.startRow+s-1})},className:"absolute right-1 top-1/2 -translate-y-1/2 w-12 h-12 bg-purple-600 hover:bg-purple-700 text-white rounded-lg flex items-center justify-center text-2xl font-bold transition-colors",children:"+"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center font-medium",children:["Starting from Row ",String.fromCharCode(64+(x.start_row||1))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-center",children:"How Many Columns?"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:1,max:50,value:x.end_column-x.start_column+1,onChange:e=>{const s=Math.max(1,Math.min(50,parseInt(e.target.value)||1));u({...x,start_column:1,end_column:s})},className:"w-full py-4 px-16 border-2 border-gray-200 rounded-lg text-center text-2xl font-bold text-gray-900 focus:outline-none focus:border-purple-500 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"1"}),e.jsx("button",{type:"button",onClick:()=>{const e=x.end_column-x.start_column+1,s=Math.max(1,e-1);u({...x,start_column:1,end_column:s})},className:"absolute left-1 top-1/2 -translate-y-1/2 w-12 h-12 bg-gray-500 hover:bg-gray-600 text-white rounded-lg flex items-center justify-center text-2xl font-bold transition-colors",children:"−"}),e.jsx("button",{type:"button",onClick:()=>{const e=x.end_column-x.start_column+1,s=Math.min(50,e+1);u({...x,start_column:1,end_column:s})},className:"absolute right-1 top-1/2 -translate-y-1/2 w-12 h-12 bg-purple-600 hover:bg-purple-700 text-white rounded-lg flex items-center justify-center text-2xl font-bold transition-colors",children:"+"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center font-medium",children:["Columns 1 to ",x.end_column]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-4 h-4 text-purple-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Grid Layout Preview"})]}),e.jsx("div",{className:"bg-purple-100 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs font-bold text-purple-900",children:(()=>{if(i)return x.code;const e=(null==c?void 0:c.code)||"",s=String.fromCharCode(64+x.start_row),t=String.fromCharCode(64+x.end_row);return`${`${e}${s}${x.start_column}`} → ${`${e}${t}${x.end_column}`}`})()})})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg overflow-x-auto",children:e.jsx("div",{className:"inline-block",children:(()=>{const s=i?1:x.start_row||1,t=i?x.row_number||1:x.end_row||1,r=i?1:x.start_column||1,a=i?x.column_number||1:x.end_column||1,l=Array.from({length:t-s+1},(e,t)=>s+t),o=Array.from({length:a-r+1},(e,s)=>r+s);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex mb-2",children:[e.jsx("div",{className:"w-12"}),o.map(s=>e.jsxs("div",{className:"w-20 text-center text-xs font-medium text-gray-600",children:["Col ",s]},s))]}),l.map(s=>{const t=String.fromCharCode(64+s);return e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-12 text-center",children:e.jsx("div",{className:"inline-flex items-center justify-center w-8 h-8 bg-purple-600 text-white rounded font-bold text-sm",children:t})}),o.map(r=>{const a=`${t}${r}`,l=(null==c?void 0:c.code)?`${c.code}${t}${r}`:a,o=g.find(e=>e.code===l),n=!!o&&!i,d=!n&&!i,m=i&&s===x.row_number&&r===x.column_number;return e.jsx("div",{className:"w-20 px-1",children:e.jsxs("div",{className:"h-16 rounded-lg border-2 flex flex-col items-center justify-center transition-all "+(n?"bg-gray-300 border-gray-400 cursor-not-allowed opacity-60":d||m?"bg-purple-600 border-purple-700":"bg-white border-gray-300"),title:n?`Already exists: ${o.code}`:`Will create: ${l}`,children:[e.jsx("div",{className:"font-mono font-bold text-xs "+(n?"text-gray-600":d||m?"text-white":"text-gray-700"),children:l}),(d||m)&&e.jsx("div",{className:"text-[10px] text-white font-medium mt-0.5",children:m?"EDIT":"NEW"}),n&&e.jsx("div",{className:"text-[10px] text-gray-600 font-medium mt-0.5",children:"TAKEN"})]})},r)})]},s)})]})})()})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Max Capacity ",!i&&"(per shelf)"]}),e.jsx("input",{type:"number",min:1,value:x.max_capacity,onChange:e=>u({...x,max_capacity:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900",placeholder:"Optional"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum items each shelf can hold"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Shelf Type"}),e.jsxs("select",{value:x.shelf_type,onChange:e=>u({...x,shelf_type:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900",children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"refrigerated",children:"Refrigerated"}),e.jsx("option",{value:"display",children:"Display"}),e.jsx("option",{value:"storage",children:"Storage"}),e.jsx("option",{value:"specialty",children:"Specialty"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Zone"}),e.jsxs("div",{className:"relative",children:[e.jsx(a,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsxs("select",{value:x.zone,onChange:e=>u({...x,zone:e.target.value}),className:"w-full pl-11 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900",children:[e.jsx("option",{value:"center",children:"Center"}),e.jsx("option",{value:"front",children:"Front"}),e.jsx("option",{value:"back",children:"Back"}),e.jsx("option",{value:"left",children:"Left"}),e.jsx("option",{value:"right",children:"Right"})]})]})]})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:x.description,onChange:e=>u({...x,description:e.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-gray-900 resize-none",placeholder:"Optional description"})]}),e.jsxs("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("input",{type:"checkbox",id:"is_accessible",checked:x.is_accessible,onChange:e=>u({...x,is_accessible:e.target.checked}),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("label",{htmlFor:"is_accessible",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Easily accessible"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("input",{type:"checkbox",id:"requires_ladder",checked:x.requires_ladder,onChange:e=>u({...x,requires_ladder:e.target.checked}),className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("label",{htmlFor:"requires_ladder",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Requires ladder"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("input",{type:"checkbox",id:"is_refrigerated",checked:x.is_refrigerated,onChange:e=>u({...x,is_refrigerated:e.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_refrigerated",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Refrigerated shelf"})]})]})]})]})}),e.jsx("div",{className:"flex-shrink-0 p-6 pt-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,disabled:p,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed bg-white",children:"Cancel"}),e.jsx("button",{type:"button",onClick:N,disabled:p,className:"flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):i?"Update Shelf":(()=>{const e=(x.end_row-x.start_row+1)*(x.end_column-x.start_column+1);return`Create ${e} Shelf${1!==e?"es":""}`})()})]})})]})})]}):null},N=()=>{j();const[N,w]=s.useState([]),[C,S]=s.useState([]),[k,$]=s.useState([]),[R,q]=s.useState(!1),[z,A]=s.useState(""),[F,E]=s.useState("all"),[I,L]=s.useState(!1),[M,O]=s.useState(null),[D,T]=s.useState(!1),[Z,B]=s.useState(null),[P,G]=s.useState(null),[Q,U]=s.useState([]),[W,H]=s.useState(!1),[K,J]=s.useState(!1),[V,X]=s.useState(""),[Y,ee]=s.useState(void 0),[se,te]=s.useState({total:0,active:0,secure:0,totalShelves:0,activeShelves:0});s.useEffect(()=>{re()},[]),s.useEffect(()=>{ae()},[N,z,F]);const re=async()=>{try{q(!0);const[e,s,t]=await Promise.all([g.getAll(),f.getAll(),g.getStats()]);w(e),S(s),te(t)}catch(e){o.error("Failed to load storage room data")}finally{q(!1)}},ae=()=>{let e=N;z&&(e=e.filter(e=>e.name.toLowerCase().includes(z.toLowerCase())||e.code.toLowerCase().includes(z.toLowerCase()))),"all"!==F&&(e=e.filter(e=>e.store_location_id===F)),$(e)},le=()=>{O(null),L(!0)},oe=()=>{L(!1),O(null)},ne=async e=>{try{H(!0);const s=await b.getShelvesByStorageRoom(e);U(s)}catch(s){o.error("Failed to load shelves")}finally{H(!1)}},ie=e=>{B(null),ee(e),T(!0)},ce=()=>{T(!1),B(null),ee(void 0)},de=e=>{const s=C.find(s=>s.id===e);return s?s.name:"Unknown"},me=Q.filter(e=>!V||e.code.toLowerCase().includes(V.toLowerCase())||e.name&&e.name.toLowerCase().includes(V.toLowerCase())),xe=me.reduce((e,s)=>{const t=s.code.match(/([A-Z])(\d+)$/),r=t?t[1]:"Other";return e[r]||(e[r]=[]),e[r].push(s),e},{});return R?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading storage rooms..."})]})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y,{to:"/dashboard"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Storage Rooms"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage storage rooms and shelves"})]})]}),e.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(i,{size:18}),"New Room"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-5 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(t,{className:"w-7 h-7 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Rooms"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:se.total})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-5 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"w-7 h-7 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:se.active})]})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-5 hover:bg-purple-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"w-7 h-7 text-purple-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Shelves"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:se.totalShelves})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-5 hover:bg-red-100 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"w-7 h-7 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Secure"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:se.secure})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg border-2 border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 w-full md:w-auto min-w-[300px]",children:[e.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search storage rooms...",value:z,onChange:e=>A(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"}),z&&e.jsx("button",{onClick:()=>A(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(r,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:F,onChange:e=>E(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Locations"}),C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:re,className:"flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:e.jsx(m,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border-2 border-gray-200 p-6",children:0===k.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(x,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No storage rooms found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:z||"all"!==F?"Try adjusting your search or filters":"Create your first storage room to get started"}),!z&&"all"===F&&e.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors mx-auto",children:[e.jsx(i,{size:18}),"Add Storage Room"]})]}):e.jsx("div",{className:"space-y-3",children:k.map(s=>e.jsx("div",{className:"border-2 rounded-lg p-4 hover:border-gray-300 transition-colors bg-white border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-600 font-mono",children:s.code}),s.is_secure&&e.jsxs("span",{className:"px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-700 flex items-center gap-1",children:[e.jsx(l,{size:12}),"Secure"]}),!s.is_active&&e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded",children:"Inactive"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a,{size:14}),e.jsx("span",{children:de(s.store_location_id)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{size:14}),e.jsxs("span",{children:["Floor ",s.floor_level]})]}),s.area_sqm&&e.jsxs("span",{children:[s.area_sqm," sqm"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>(async e=>{G(e),J(!0),await ne(e.id)})(s),className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-purple-600 text-white hover:bg-purple-700 transition-colors",title:"Manage Shelves",children:[e.jsx(n,{size:13}),"Shelves"]}),e.jsx("button",{onClick:()=>(e=>{O(e),L(!0)})(s),className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-gray-600 text-white hover:bg-gray-700 transition-colors",title:"Edit",children:e.jsx(p,{size:13})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm(`Are you sure you want to delete "${e.name}"?`))try{await g.delete(e.id),o.success("Storage room deleted successfully"),re()}catch(s){o.error("Failed to delete storage room")}})(s),className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium bg-red-600 text-white hover:bg-red-700 transition-colors",title:"Delete",children:e.jsx(h,{size:13})})]})]})},s.id))})}),K&&P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[9999]",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(t,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:P.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(a,{className:"w-3 h-3"}),de(P.store_location_id)]}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:P.code}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(n,{className:"w-3 h-3"}),Q.length," shelves"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:ie,className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-purple-600 text-white hover:bg-purple-700 transition-colors text-sm",children:[e.jsx(i,{size:16}),"Add Shelves"]}),e.jsx("button",{onClick:()=>{J(!1),X("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(r,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[Q.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search shelves by code or name...",value:V,onChange:e=>X(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"}),V&&e.jsx("button",{onClick:()=>X(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(r,{className:"w-4 h-4"})})]})}),W?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{className:"ml-3 text-gray-600 font-medium",children:"Loading shelves..."})]}):0===me.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(n,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No shelves found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:V?"Try a different search term":"This storage room doesn't have any shelves yet"}),!V&&e.jsxs("button",{onClick:ie,className:"flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium bg-purple-600 text-white hover:bg-purple-700 transition-colors mx-auto",children:[e.jsx(i,{size:18}),"Create Shelf Grid"]})]}):e.jsx("div",{className:"space-y-4",children:Object.entries(xe).sort(([e],[s])=>"Other"===e?1:"Other"===s?-1:e.localeCompare(s)).map(([s,t])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center text-white font-bold",children:s}),e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Row ",s]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["• ",t.length," shelf",1!==t.length?"es":""]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2",children:[t.sort((e,s)=>{const t=e.code.match(/([A-Z])(\d+)$/),r=s.code.match(/([A-Z])(\d+)$/);return(t?parseInt(t[2]):e.column_number||0)-(r?parseInt(r[2]):s.column_number||0)}).map(s=>{const t=(()=>{const e=(null==P?void 0:P.code)||"";return e&&!s.code.startsWith(e)?`${e}${s.code}`:s.code})();return e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-3 hover:border-purple-400 hover:shadow-md transition-all group",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-mono font-bold text-sm text-gray-900",children:t}),e.jsx("div",{className:"w-2 h-2 rounded-full "+(s.is_active?"bg-green-500":"bg-red-500")})]}),s.shelf_type&&"standard"!==s.shelf_type&&e.jsx("div",{className:"inline-block px-2 py-0.5 text-[10px] rounded-full font-medium "+("refrigerated"===s.shelf_type?"bg-blue-100 text-blue-700":"display"===s.shelf_type?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"),children:s.shelf_type}),e.jsxs("div",{className:"flex gap-1 pt-1",children:[e.jsx("button",{onClick:()=>(e=>{B(e),T(!0)})(s),className:"flex-1 px-2 py-1 rounded text-[10px] font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",title:"Edit",children:"Edit"}),e.jsx("button",{onClick:()=>(async e=>{if(confirm(`Are you sure you want to delete shelf "${e.code}"?`))try{await b.delete(e.id),o.success("Shelf deleted successfully"),P&&await ne(P.id)}catch(s){o.error("Failed to delete shelf")}})(s),className:"flex-1 px-2 py-1 rounded text-[10px] font-medium bg-red-100 text-red-700 hover:bg-red-200 transition-colors",title:"Delete",children:"Delete"})]})]})},s.id)}),e.jsxs("button",{onClick:()=>(async e=>{if(!P)return;const s=Q.filter(s=>{const t=s.code.match(/([A-Z])(\d+)$/);return t&&t[1]===e}),t=(s.length>0?Math.max(...s.map(e=>{const s=e.code.match(/([A-Z])(\d+)$/);return s?parseInt(s[2]):0})):0)+1,r=e.charCodeAt(0)-64,a=`${P.code}${e}${t}`,l={store_location_id:P.store_location_id,storage_room_id:P.id,name:a,code:a,shelf_type:"standard",row_number:r,column_number:t,floor_level:(null==P?void 0:P.floor_level)||1,zone:"center",is_active:!0,is_accessible:!0,requires_ladder:!1,is_refrigerated:!1,priority_order:0};try{await b.create(l),o.success(`✅ Created shelf ${a}`),await ne(P.id)}catch(n){o.error("Failed to create shelf")}})(s),className:"bg-purple-50 border-2 border-dashed border-purple-300 rounded-lg p-3 hover:border-purple-500 hover:bg-purple-100 transition-all flex flex-col items-center justify-center gap-1 min-h-[80px]",title:`Quick add next shelf to Row ${s}`,children:[e.jsx(i,{className:"w-8 h-8 text-purple-600"}),e.jsx("span",{className:"text-xs font-bold text-purple-700",children:"Quick Add"})]})]})]},s))})]})]})}),e.jsx(v,{isOpen:I,onClose:oe,storageRoom:M,onSave:async()=>{await re(),oe()}}),e.jsx(_,{isOpen:D,onClose:ce,shelf:Z,storageRoom:P,onSave:async e=>{try{if(Z)await b.update(Z.id,e),o.success("Shelf updated successfully");else{await b.create(e);o.success("Shelf created successfully")}P&&await ne(P.id),ce()}catch(s){throw o.error((null==s?void 0:s.message)||"Failed to save shelf"),s}},preSelectedRow:Y})]})};export{N as default};
