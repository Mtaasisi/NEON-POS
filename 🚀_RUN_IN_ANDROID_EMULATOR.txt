================================================================================
                  RUN APK IN ANDROID EMULATOR - STEP BY STEP
================================================================================

ðŸ“± PREREQUISITES
--------------------------------------------------------------------------------
Before starting, make sure you have:
  â–¡ Node.js installed
  â–¡ Android Studio installed
  â–¡ Android SDK installed (via Android Studio)
  â–¡ At least one Android Virtual Device (AVD) created


ðŸš€ STEP-BY-STEP INSTRUCTIONS
================================================================================

STEP 1: BUILD THE WEB APP
--------------------------------------------------------------------------------
Open terminal in project directory and run:

  npm run build

Expected output:
  âœ“ building for production...
  âœ“ 1234 modules transformed.
  dist/index.html                   1.23 kB
  dist/assets/index-abc123.js       456.78 kB
  âœ“ built in 30s

This creates the production build in the 'dist' folder.


STEP 2: SYNC WITH CAPACITOR
--------------------------------------------------------------------------------
Run this command:

  npx cap sync android

Expected output:
  âœ“ Copying web assets from dist to android/app/src/main/assets/public
  âœ“ Creating capacitor.config.json in android/app/src/main/assets
  âœ“ copy android in 123ms
  âœ“ Updating Android plugins
  âœ“ update android in 456ms
  Sync finished in 0.579s

This copies your web build to the Android project.


STEP 3: OPEN ANDROID STUDIO
--------------------------------------------------------------------------------
Run this command:

  npx cap open android

This will:
  â†’ Open Android Studio automatically
  â†’ Load your project
  â†’ Sync Gradle files (first time may take a while)

Wait for:
  "Gradle sync finished" message in Android Studio


STEP 4: START ANDROID EMULATOR
--------------------------------------------------------------------------------
In Android Studio:

Option A: Use existing emulator
  1. Click the device dropdown (top toolbar)
  2. Select your emulator (e.g., "Pixel 5 API 33")
  3. Click the green play button â–¶
  4. Wait for emulator to boot

Option B: Create new emulator (if none exists)
  1. Tools > Device Manager
  2. Click "Create Device"
  3. Select "Phone" > "Pixel 5" > Next
  4. Select "System Image" (e.g., API 33 - Android 13)
  5. Download if needed > Next
  6. Finish
  7. Click play button â–¶ to start


STEP 5: RUN THE APP
--------------------------------------------------------------------------------
Once emulator is running:

  1. Make sure emulator is selected in device dropdown
  2. Click the green play button â–¶ (or press Shift+F10)
  3. Wait for build and installation

Expected:
  â†’ Gradle builds the APK
  â†’ Installs on emulator
  â†’ App launches automatically
  â†’ Shows initialization screen (first time)
  â†’ Loads /mobile/dashboard


================================================================================
                          ALTERNATIVE: COMMAND LINE
================================================================================

If you prefer command line, after Step 2:

STEP A: List available emulators
  ~/Library/Android/sdk/emulator/emulator -list-avds

STEP B: Start an emulator
  ~/Library/Android/sdk/emulator/emulator -avd <EMULATOR_NAME> &

  Example:
  ~/Library/Android/sdk/emulator/emulator -avd Pixel_5_API_33 &

STEP C: Wait for emulator to boot
  Wait until you see the home screen

STEP D: Build and install APK
  cd android
  ./gradlew installDebug

STEP E: Launch app
  adb shell am start -n com.lats.pos/.MainActivity


================================================================================
                          TROUBLESHOOTING
================================================================================

PROBLEM: "npm run build" fails
SOLUTION:
  â†’ Check for TypeScript errors: npm run type-check
  â†’ Install dependencies: npm install
  â†’ Clear cache: rm -rf node_modules && npm install

PROBLEM: "npx cap sync android" fails
SOLUTION:
  â†’ Make sure dist folder exists
  â†’ Run: npm run build first
  â†’ Check capacitor.config.ts is correct

PROBLEM: Android Studio won't open
SOLUTION:
  â†’ Open manually: /Applications/Android Studio.app
  â†’ File > Open > Select "android" folder in your project

PROBLEM: Emulator won't start
SOLUTION:
  â†’ Check virtualization is enabled in BIOS
  â†’ Reinstall emulator from AVD Manager
  â†’ Try different API level (e.g., API 30 instead of 33)

PROBLEM: Gradle build fails
SOLUTION:
  â†’ Tools > SDK Manager > SDK Tools tab
  â†’ Install: Android SDK Build-Tools, Android Emulator, Android SDK Platform-Tools
  â†’ File > Invalidate Caches > Invalidate and Restart

PROBLEM: App crashes on launch
SOLUTION:
  â†’ Check Logcat in Android Studio for errors
  â†’ Make sure all dependencies installed: npm install
  â†’ Rebuild: Build > Clean Project, then Build > Rebuild Project

PROBLEM: Black screen or white screen
SOLUTION:
  â†’ Check Chrome DevTools: chrome://inspect (in Chrome browser on Mac)
  â†’ Enable WebView debugging in capacitor.config.ts
  â†’ Check console for JavaScript errors


================================================================================
                          VERIFY IT'S WORKING
================================================================================

âœ… WHAT YOU SHOULD SEE:

1. First Launch:
   â†’ Beautiful initialization screen with LATS POS logo
   â†’ Progress bar: "Step 1/7: Database..."
   â†’ Data syncing messages
   â†’ "Mobile app ready!" message
   â†’ Mobile dashboard with stats

2. Subsequent Launches:
   â†’ App opens instantly to /mobile/dashboard
   â†’ No initialization screen (data cached)
   â†’ Bottom navigation visible
   â†’ All mobile features work

3. Try to Access Desktop Route:
   â†’ In emulator, nothing changes (redirected automatically)
   â†’ Check Logcat: "MobileOnlyRedirect] APK detected, redirecting..."

âœ… MOBILE FEATURES TO TEST:

â–¡ Dashboard shows stats
â–¡ Tap "POS" in bottom nav â†’ Opens POS
â–¡ Tap "Inventory" â†’ Shows products
â–¡ Tap "Clients" â†’ Shows customers
â–¡ Tap "More" â†’ Shows offline controls
â–¡ Create a test sale in POS
â–¡ Check offline mode section


================================================================================
                          QUICK COMMANDS SUMMARY
================================================================================

Full process (3 commands):

  1. npm run build
  2. npx cap sync android
  3. npx cap open android

Then in Android Studio:
  â†’ Select emulator
  â†’ Click play button â–¶


================================================================================
                          DEBUGGING IN EMULATOR
================================================================================

VIEW LOGS:
  In Android Studio:
  â†’ View > Tool Windows > Logcat
  â†’ Filter by "com.lats.pos"

VIEW CONSOLE:
  In Chrome (on your Mac):
  1. Open Chrome browser
  2. Navigate to: chrome://inspect
  3. Find your app under "Remote Target"
  4. Click "inspect"
  5. See console logs, network, etc.

CHECK DATABASE:
  In Chrome DevTools:
  â†’ Application tab
  â†’ IndexedDB
  â†’ mobile-offline-pos
  â†’ See all cached data


================================================================================
                          EXPECTED BEHAVIOR
================================================================================

âœ… APK-ONLY FEATURES:
  â†’ Only /mobile/* routes accessible
  â†’ Trying /dashboard redirects to /mobile/dashboard
  â†’ Initialization screen on first launch
  â†’ All data pre-loaded
  â†’ Works offline after first sync

âœ… MOBILE UI:
  â†’ Bottom navigation (Home, Clients, POS, Inventory, More)
  â†’ Touch-optimized buttons
  â†’ Mobile-first layout
  â†’ Offline status in More tab

âœ… CONSOLE LOGS:
  ðŸš€ [MobileAppInitializer] Starting mobile app initialization...
  ðŸ“¦ [MobileCache] Retrieved X cached products
  ðŸ”„ [DataSync] Starting data sync...
  ðŸ”’ [MobileOnlyRedirect] APK detected...
  âœ… [MobileApp] Mobile app initialized successfully


================================================================================
                          NEXT STEPS
================================================================================

After running successfully in emulator:

1. TEST ALL FEATURES:
   â–¡ Dashboard
   â–¡ POS (create sale)
   â–¡ Inventory (view products)
   â–¡ Clients (view customers)
   â–¡ More (check offline mode)

2. TEST OFFLINE MODE:
   â†’ Settings > Network > Wi-Fi off
   â†’ App should still work
   â†’ Create a sale offline
   â†’ Turn Wi-Fi back on
   â†’ Sale should sync

3. BUILD RELEASE APK:
   â†’ In Android Studio: Build > Generate Signed Bundle / APK
   â†’ Follow wizard to create release APK
   â†’ Install on real device


================================================================================
                          READY TO RUN!
================================================================================

Execute these 3 commands now:

  npm run build
  npx cap sync android  
  npx cap open android

Then click play â–¶ in Android Studio!

Your mobile-only APK will launch in the emulator! ðŸš€

================================================================================

